---
title: "與 Azure VPN 閘道的高可用性組態 aaaOverview |Microsoft 文件"
description: "本文提供使用 Azure VPN 閘道的高可用性組態選項概觀。"
services: vpn-gateway
documentationcenter: na
author: yushwang
manager: rossort
editor: 
tags: 
ms.assetid: a8bfc955-de49-4172-95ac-5257e262d7ea
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/24/2016
ms.author: yushwang
ms.openlocfilehash: 316293b9ac79645bf9bb9e89fbc4aa8f3eacd209
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="highly-available-cross-premises-and-vnet-to-vnet-connectivity"></a><span data-ttu-id="ffea0-103">高可用性跨單位和 VNet 對 VNet 連線</span><span class="sxs-lookup"><span data-stu-id="ffea0-103">Highly Available Cross-Premises and VNet-to-VNet Connectivity</span></span>
<span data-ttu-id="ffea0-104">本文針對使用 Azure VPN 閘道的跨單位和 VNet 對 VNet 連線提供高可用性組態選項的概觀。</span><span class="sxs-lookup"><span data-stu-id="ffea0-104">This article provides an overview of Highly Available configuration options for your cross-premises and VNet-to-VNet connectivity using Azure VPN gateways.</span></span>

## <span data-ttu-id="ffea0-105"><a name = "activestandby"></a>關於 Azure VPN 閘道備援</span><span class="sxs-lookup"><span data-stu-id="ffea0-105"><a name = "activestandby"></a>About Azure VPN gateway redundancy</span></span>
<span data-ttu-id="ffea0-106">每個 Azure VPN 閘道都是由作用中-待命組態中的兩個執行個體組成。</span><span class="sxs-lookup"><span data-stu-id="ffea0-106">Every Azure VPN gateway consists of two instances in an active-standby configuration.</span></span> <span data-ttu-id="ffea0-107">任何已規劃的維修或非計劃的中斷發生 toohello 作用中的執行個體，會自動接管 （容錯移轉） hello 待命執行個體，並將其恢復 hello S2S VPN 或 VNet 對 VNet 連線中。</span><span class="sxs-lookup"><span data-stu-id="ffea0-107">For any planned maintenance or unplanned disruption that happens toohello active instance, hello standby instance would take over (failover) automatically, and resume hello S2S VPN or VNet-to-VNet connections.</span></span> <span data-ttu-id="ffea0-108">hello 切換會短暫中斷。</span><span class="sxs-lookup"><span data-stu-id="ffea0-108">hello switch over will cause a brief interruption.</span></span> <span data-ttu-id="ffea0-109">若是計劃性維護，應 10 too15 秒內還原 hello 連線。</span><span class="sxs-lookup"><span data-stu-id="ffea0-109">For planned maintenance, hello connectivity should be restored within 10 too15 seconds.</span></span> <span data-ttu-id="ffea0-110">未規劃的問題，hello 連接復原將會比較長，關於 1 分鐘 too1 和半分鐘 hello 最壞的情況下。</span><span class="sxs-lookup"><span data-stu-id="ffea0-110">For unplanned issues, hello connection recovery will be longer, about 1 minute too1 and a half minutes in hello worst case.</span></span> <span data-ttu-id="ffea0-111">P2S VPN 用戶端連線 toohello 閘道 hello P2S 連線將會中斷而且 hello 的使用者需要 tooreconnect 從 hello 用戶端電腦。</span><span class="sxs-lookup"><span data-stu-id="ffea0-111">For P2S VPN client connections toohello gateway, hello P2S connections will be disconnected and hello users will need tooreconnect from hello client machines.</span></span>

![作用中-待命](./media/vpn-gateway-highlyavailable/active-standby.png)

## <a name="highly-available-cross-premises-connectivity"></a><span data-ttu-id="ffea0-113">高可用性跨單位連線</span><span class="sxs-lookup"><span data-stu-id="ffea0-113">Highly Available Cross-Premises Connectivity</span></span>
<span data-ttu-id="ffea0-114">tooprovide 更佳的可用性，對您的跨內部部署連線，有幾個選項：</span><span class="sxs-lookup"><span data-stu-id="ffea0-114">tooprovide better availability for your cross premises connections, there are a couple of options available:</span></span>

* <span data-ttu-id="ffea0-115">多個內部部署 VPN 裝置</span><span class="sxs-lookup"><span data-stu-id="ffea0-115">Multiple on-premises VPN devices</span></span>
* <span data-ttu-id="ffea0-116">主動-主動 Azure VPN 閘道</span><span class="sxs-lookup"><span data-stu-id="ffea0-116">Active-active Azure VPN gateway</span></span>
* <span data-ttu-id="ffea0-117">兩者的組合</span><span class="sxs-lookup"><span data-stu-id="ffea0-117">Combination of both</span></span>

### <span data-ttu-id="ffea0-118"><a name = "activeactiveonprem"></a>多個內部部署 VPN 裝置</span><span class="sxs-lookup"><span data-stu-id="ffea0-118"><a name = "activeactiveonprem"></a>Multiple on-premises VPN devices</span></span>
<span data-ttu-id="ffea0-119">Hello 下列圖表所示，您可以從您在內部部署網路 tooconnect tooyour Azure VPN 閘道，使用多個 VPN 裝置：</span><span class="sxs-lookup"><span data-stu-id="ffea0-119">You can use multiple VPN devices from your on-premises network tooconnect tooyour Azure VPN gateway, as shown in hello following diagram:</span></span>

![多個內部部署 VPN](./media/vpn-gateway-highlyavailable/multiple-onprem-vpns.png)

<span data-ttu-id="ffea0-121">這個組態可提供多個使用中的通道，從 hello 相同 Azure VPN 閘道 tooyour 在內部部署中的裝置 hello 相同的位置。</span><span class="sxs-lookup"><span data-stu-id="ffea0-121">This configuration provides multiple active tunnels from hello same Azure VPN gateway tooyour on-premises devices in hello same location.</span></span> <span data-ttu-id="ffea0-122">有一些需求和限制︰</span><span class="sxs-lookup"><span data-stu-id="ffea0-122">There are some requirements and constraints:</span></span>

1. <span data-ttu-id="ffea0-123">您需要 toocreate 多 S2S VPN 連線從您的 VPN 裝置 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="ffea0-123">You need toocreate multiple S2S VPN connections from your VPN devices tooAzure.</span></span> <span data-ttu-id="ffea0-124">當您從 hello 連接多個 VPN 裝置相同的內部部署網路 tooAzure，您需要從 Azure VPN 閘道 toohello 區域網路閘道的 toocreate 一個區域網路閘道的每個 VPN 裝置，以及一個連線。</span><span class="sxs-lookup"><span data-stu-id="ffea0-124">When you connect multiple VPN devices from hello same on-premises network tooAzure, you need toocreate one local network gateway for each VPN device, and one connection from your Azure VPN gateway toohello local network gateway.</span></span>
2. <span data-ttu-id="ffea0-125">對應 tooyour VPN 裝置 hello 區域網路閘道必須 hello"GatewayIpAddress"屬性中唯一的公用 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="ffea0-125">hello local network gateways corresponding tooyour VPN devices must have unique public IP addresses in hello "GatewayIpAddress" property.</span></span>
3. <span data-ttu-id="ffea0-126">此組態需要 BGP。</span><span class="sxs-lookup"><span data-stu-id="ffea0-126">BGP is required for this configuration.</span></span> <span data-ttu-id="ffea0-127">代表的 VPN 裝置每個區域網路閘道必須擁有 hello"BgpPeerIpAddress"屬性中指定唯一 BGP 對等體 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="ffea0-127">Each local network gateway representing a VPN device must have a unique BGP peer IP address specified in hello "BgpPeerIpAddress" property.</span></span>
4. <span data-ttu-id="ffea0-128">在每個區域網路閘道的 hello AddressPrefix 屬性欄位不得重疊。</span><span class="sxs-lookup"><span data-stu-id="ffea0-128">hello AddressPrefix property field in each local network gateway must not overlap.</span></span> <span data-ttu-id="ffea0-129">您應該指定 /32 hello"BgpPeerIpAddress"hello AddressPrefix 欄位中，例如 10.200.200.254/32 CIDR 格式。</span><span class="sxs-lookup"><span data-stu-id="ffea0-129">You should specify hello "BgpPeerIpAddress" in /32 CIDR format in hello AddressPrefix field, for example, 10.200.200.254/32.</span></span>
5. <span data-ttu-id="ffea0-130">您應該使用 BGP tooadvertise hello 相同的前置詞的 hello 相同的內部部署網路首碼 tooyour Azure VPN 閘道和 hello 流量會透過轉送這些通道同時。</span><span class="sxs-lookup"><span data-stu-id="ffea0-130">You should use BGP tooadvertise hello same prefixes of hello same on-premises network prefixes tooyour Azure VPN gateway, and hello traffic will be forwarded through these tunnels simultaneously.</span></span>
6. <span data-ttu-id="ffea0-131">每個連接納入 hello Azure VPN 閘道，10 Basic 和 Standard Sku 的通道數目上限和 30 HighPerformance sku。</span><span class="sxs-lookup"><span data-stu-id="ffea0-131">Each connection is counted against hello maximum number of tunnels for your Azure VPN gateway, 10 for Basic and Standard SKUs, and 30 for HighPerformance SKU.</span></span> 

<span data-ttu-id="ffea0-132">此設定會 hello Azure VPN 閘道是仍在使用中-待命模式，因此 hello 相同容錯移轉行為以及所述，仍會發生短暫中斷[上方](#activestandby)。</span><span class="sxs-lookup"><span data-stu-id="ffea0-132">In this configuration, hello Azure VPN gateway is still in active-standby mode, so hello same failover behavior and brief interruption will still happen as described [above](#activestandby).</span></span> <span data-ttu-id="ffea0-133">但這項設定可防範內部部署網路和 VPN 裝置發生錯誤或中斷。</span><span class="sxs-lookup"><span data-stu-id="ffea0-133">But this setup guards against failures or interruptions on your on-premises network and VPN devices.</span></span>

### <a name="active-active-azure-vpn-gateway"></a><span data-ttu-id="ffea0-134">主動-主動 Azure VPN 閘道</span><span class="sxs-lookup"><span data-stu-id="ffea0-134">Active-active Azure VPN gateway</span></span>
<span data-ttu-id="ffea0-135">您現在可以建立 Azure VPN 閘道在主動-主動組態中，其中的 hello 閘道 Vm，就會建立 S2S VPN 通道 tooyour 在內部部署 VPN 裝置，為顯示 hello 下列兩個執行個體的圖表：</span><span class="sxs-lookup"><span data-stu-id="ffea0-135">You can now create an Azure VPN gateway in an active-active configuration, where both instances of hello gateway VMs will establish S2S VPN tunnels tooyour on-premises VPN device, as shown hello following diagram:</span></span>

![主動-主動](./media/vpn-gateway-highlyavailable/active-active.png)

<span data-ttu-id="ffea0-137">在此組態中，每個 Azure 閘道執行個體都會有唯一的公用 IP 位址，而每個建立的 IPsec/IKE S2S VPN 通道 tooyour 在內部部署 VPN 裝置區域網路閘道與連接中指定。</span><span class="sxs-lookup"><span data-stu-id="ffea0-137">In this configuration, each Azure gateway instance will have a unique public IP address, and each will establish an IPsec/IKE S2S VPN tunnel tooyour on-premises VPN device specified in your local network gateway and connection.</span></span> <span data-ttu-id="ffea0-138">請注意，這兩個 VPN 通道是實際的部份 hello 相同的連接。</span><span class="sxs-lookup"><span data-stu-id="ffea0-138">Note that both VPN tunnels are actually part of hello same connection.</span></span> <span data-ttu-id="ffea0-139">您仍將會需要您在內部部署 VPN 裝置 tooaccept tooconfigure 或建立兩個 S2S VPN 通道 toothose 兩個 Azure VPN 閘道的公用 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="ffea0-139">You will still need tooconfigure your on-premises VPN device tooaccept or establish two S2S VPN tunnels toothose two Azure VPN gateway public IP addresses.</span></span>

<span data-ttu-id="ffea0-140">由於 hello Azure 閘道器執行個體都在主動-主動組態中，從您的 Azure 虛擬網路 tooyour hello 流量在內部網路將會同時路由傳送透過這兩個通道，即使在內部部署 VPN 裝置可能優先於一個通道hello 其他。</span><span class="sxs-lookup"><span data-stu-id="ffea0-140">Because hello Azure gateway instances are in active-active configuration, hello traffic from your Azure virtual network tooyour on-premises network will be routed through both tunnels simultaneously, even if your on-premises VPN device may favor one tunnel over hello other.</span></span> <span data-ttu-id="ffea0-141">請注意的 hello 相同的 TCP 或 UDP 流量將一律周遊 hello 相同通道或路徑，但除非維護事件發生在其中一個 hello 執行個體。</span><span class="sxs-lookup"><span data-stu-id="ffea0-141">Note though hello same TCP or UDP flow will always traverse hello same tunnel or path, unless a maintenance event happens on one of hello instances.</span></span>

<span data-ttu-id="ffea0-142">當已規劃的維修或非計劃的事件發生時 tooone 閘道執行個體時，該執行個體 tooyour hello IPsec 通道內部部署 VPN 裝置將會中斷。</span><span class="sxs-lookup"><span data-stu-id="ffea0-142">When a planned maintenance or unplanned event happens tooone gateway instance, hello IPsec tunnel from that instance tooyour on-premises VPN device will be disconnected.</span></span> <span data-ttu-id="ffea0-143">hello 對應路由 VPN 裝置上的應該移除或撤銷自動使 hello 流量將會切換 toohello 透過其他使用中 IPsec 通道。</span><span class="sxs-lookup"><span data-stu-id="ffea0-143">hello corresponding routes on your VPN devices should be removed or withdrawn automatically so that hello traffic will be switched over toohello other active IPsec tunnel.</span></span> <span data-ttu-id="ffea0-144">上 hello Azure 端，透過 hello 參數將會自動從 hello 影響執行個體 toohello 作用中執行個體。</span><span class="sxs-lookup"><span data-stu-id="ffea0-144">On hello Azure side, hello switch over will happen automatically from hello affected instance toohello active instance.</span></span>

### <a name="dual-redundancy-active-active-vpn-gateways-for-both-azure-and-on-premises-networks"></a><span data-ttu-id="ffea0-145">雙重備援︰Azure 和內部部署網路的主動-主動 VPN 閘道</span><span class="sxs-lookup"><span data-stu-id="ffea0-145">Dual-redundancy: active-active VPN gateways for both Azure and on-premises networks</span></span>
<span data-ttu-id="ffea0-146">hello 最可靠的方式是 toocombine hello 主動-主動閘道網路與 Azure 上的 hello 如下圖所示。</span><span class="sxs-lookup"><span data-stu-id="ffea0-146">hello most reliable option is toocombine hello active-active gateways on both your network and Azure, as shown in hello diagram below.</span></span>

![雙重備援](./media/vpn-gateway-highlyavailable/dual-redundancy.png)

<span data-ttu-id="ffea0-148">這裡您建立和設定 hello Azure VPN 閘道在主動-主動組態中，建立兩個區域網路閘道和兩個連線，您的兩個內部部署 VPN 裝置如上面所述。</span><span class="sxs-lookup"><span data-stu-id="ffea0-148">Here you create and setup hello Azure VPN gateway in an active-active configuration, and create two local network gateways and two connections for your two on-premises VPN devices as described above.</span></span> <span data-ttu-id="ffea0-149">hello 結果會是 4 的 IPsec 通道，您的 Azure 虛擬網路與內部部署網路之間的完整網狀的連線。</span><span class="sxs-lookup"><span data-stu-id="ffea0-149">hello result is a full mesh connectivity of 4 IPsec tunnels between your Azure virtual network and your on-premises network.</span></span>

<span data-ttu-id="ffea0-150">所有的閘道和通道 hello Azure 端從作用中，所以 hello 流量會散佈到所有的 4 通道同時，雖然每個 TCP 或 UDP 流量會再次遵循 hello 相同通道或從路徑 hello Azure 端。</span><span class="sxs-lookup"><span data-stu-id="ffea0-150">All gateways and tunnels are active from hello Azure side, so hello traffic will be spread among all 4 tunnels simultaneously, although each TCP or UDP flow will again follow hello same tunnel or path from hello Azure side.</span></span> <span data-ttu-id="ffea0-151">即使所分配 hello 流量，您可能會看到稍微更佳的輸送量，透過 hello IPsec 通道，這項設定的 hello 主要目標是要讓高可用性。</span><span class="sxs-lookup"><span data-stu-id="ffea0-151">Even though by spreading hello traffic, you may see slightly better throughput over hello IPsec tunnels, hello primary goal of this configuration is for high availability.</span></span> <span data-ttu-id="ffea0-152">而且很難 tooprovide hello 度量 toohello 本質統計 hello 分配，因為不同的應用程式流量條件將會影響 hello 彙總輸送量。</span><span class="sxs-lookup"><span data-stu-id="ffea0-152">And due toohello statistical nature of hello spreading, it is difficult tooprovide hello measurement on how different application traffic conditions will affect hello aggregate throughput.</span></span>

<span data-ttu-id="ffea0-153">此拓撲需要兩個區域網路閘道及兩個連線 toosupport hello 對內部部署 VPN 裝置，和 BGP 是必要的 tooallow hello 兩個連線 toohello 相同的內部部署網路。</span><span class="sxs-lookup"><span data-stu-id="ffea0-153">This topology will require two local network gateways and two connections toosupport hello pair of on-premises VPN devices, and BGP is required tooallow hello two connections toohello same on-premises network.</span></span> <span data-ttu-id="ffea0-154">這些需求都是相同 hello 與 hello[上方](#activeactiveonprem)。</span><span class="sxs-lookup"><span data-stu-id="ffea0-154">These requirements are hello same as hello [above](#activeactiveonprem).</span></span> 

## <a name="highly-available-vnet-to-vnet-connectivity-through-azure-vpn-gateways"></a><span data-ttu-id="ffea0-155">透過 Azure VPN 閘道的高可用性 VNet 對 VNet 連線</span><span class="sxs-lookup"><span data-stu-id="ffea0-155">Highly Available VNet-to-VNet Connectivity through Azure VPN Gateways</span></span>
<span data-ttu-id="ffea0-156">hello 相同主動-主動組態也可以套用 tooAzure VNet 對 VNet 連線。</span><span class="sxs-lookup"><span data-stu-id="ffea0-156">hello same active-active configuration can also apply tooAzure VNet-to-VNet connections.</span></span> <span data-ttu-id="ffea0-157">您可以建立兩個虛擬網路，主動-主動 VPN 閘道，並將它們連接在一起的 tooform hello 完整相同 mesh 4 hello 圖表下方的 hello 中所示的兩個 Vnet 之間的通道之連線：</span><span class="sxs-lookup"><span data-stu-id="ffea0-157">You can create active-active VPN gateways for both virtual networks, and connect them together tooform hello same full mesh connectivity of 4 tunnels between hello two VNets, as shown in hello diagram below:</span></span>

![VNet 對 VNet](./media/vpn-gateway-highlyavailable/vnet-to-vnet.png)

<span data-ttu-id="ffea0-159">這可確保永遠都會有一組通道 hello 兩個虛擬網路間所有的計劃性的維護事件，提供更好的可用性。</span><span class="sxs-lookup"><span data-stu-id="ffea0-159">This ensures there are always a pair of tunnels between hello two virtual networks for any planned maintenance events, providing even better availability.</span></span> <span data-ttu-id="ffea0-160">即使 hello 相同的跨單位連線的拓撲需要兩個連接，如上所示的 hello VNet 對 VNet 拓撲將需要每個閘道只能有一個連線。</span><span class="sxs-lookup"><span data-stu-id="ffea0-160">Even though hello same topology for cross-premises connectivity requires two connections, hello VNet-to-VNet topology shown above will need only one connection for each gateway.</span></span> <span data-ttu-id="ffea0-161">此外，BGP 是選擇性，除非透過 hello VNet 對 VNet 連線的傳輸路由是必要的。</span><span class="sxs-lookup"><span data-stu-id="ffea0-161">Additionally, BGP is optional unless transit routing over hello VNet-to-VNet connection is required.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ffea0-162">後續步驟</span><span class="sxs-lookup"><span data-stu-id="ffea0-162">Next steps</span></span>
<span data-ttu-id="ffea0-163">請參閱[跨單位和 VNet 對 VNet 連線設定主動-主動 VPN 閘道](vpn-gateway-activeactive-rm-powershell.md)步驟 tooconfigure 主動-主動跨單位和 VNet 對 VNet 連線。</span><span class="sxs-lookup"><span data-stu-id="ffea0-163">See [Configuring Active-Active VPN Gateways for Cross-Premises and VNet-to-VNet Connections](vpn-gateway-activeactive-rm-powershell.md) for steps tooconfigure active-active cross-premises and VNet-to-VNet connections.</span></span>

