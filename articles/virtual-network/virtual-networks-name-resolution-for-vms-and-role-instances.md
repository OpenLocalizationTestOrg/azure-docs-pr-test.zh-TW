---
title: "aaaResolution Vm 和角色執行個體"
description: "Azure IaaS、混合式解決方案、不同雲端服務之間、Active Directory 以及使用專屬 DNS 伺服器的名稱解析案例  "
services: virtual-network
documentationcenter: na
author: GarethBradshawMSFT
manager: carmonm
editor: tysonn
ms.assetid: 5d73edde-979a-470a-b28c-e103fcf07e3e
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/06/2016
ms.author: telmos
ms.openlocfilehash: 0ec7903cf200c1d04d75601a5b0cefe4268f3dcf
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="name-resolution-for-vms-and-role-instances"></a><span data-ttu-id="840dc-103">VM 與角色執行個體的名稱解析</span><span class="sxs-lookup"><span data-stu-id="840dc-103">Name Resolution for VMs and Role Instances</span></span>
<span data-ttu-id="840dc-104">根據您如何使用 Azure toohost IaaS、 PaaS 及混合式解決方案，您可能需要 tooallow hello Vm 和角色執行個體，您會建立 toocommunicate 彼此。</span><span class="sxs-lookup"><span data-stu-id="840dc-104">Depending on how you use Azure toohost IaaS, PaaS, and hybrid solutions, you may need tooallow hello VMs and role instances that you create toocommunicate with each other.</span></span> <span data-ttu-id="840dc-105">雖然可以完成這項通訊所使用的 IP 位址是更簡單 toouse 名稱可以輕鬆記住並不會變更。</span><span class="sxs-lookup"><span data-stu-id="840dc-105">Although this communication can be done by using IP addresses, it is much simpler toouse names that can be easily remembered and do not change.</span></span> 

<span data-ttu-id="840dc-106">當角色執行個體和 Azure 中裝載的 Vm 需要 tooresolve 網域名稱 toointernal IP 位址時，可以使用兩種方法之一：</span><span class="sxs-lookup"><span data-stu-id="840dc-106">When role instances and VMs hosted in Azure need tooresolve domain names toointernal IP addresses, they can use one of two methods:</span></span>

* [<span data-ttu-id="840dc-107">Azure 提供的名稱解析</span><span class="sxs-lookup"><span data-stu-id="840dc-107">Azure-provided name resolution</span></span>](#azure-provided-name-resolution)
* <span data-ttu-id="840dc-108">[使用您自己的 DNS 伺服器的名稱解析](#name-resolution-using-your-own-dns-server)（其中可能正查詢 toohello Azure 提供的 DNS 伺服器）</span><span class="sxs-lookup"><span data-stu-id="840dc-108">[Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server) (which may forward queries toohello Azure-provided DNS servers)</span></span> 

<span data-ttu-id="840dc-109">您使用的名稱解析的 hello 類型取決於您的 Vm 和角色執行個體需要如何彼此 toocommunicate。</span><span class="sxs-lookup"><span data-stu-id="840dc-109">hello type of name resolution you use depends on how your VMs and role instances need toocommunicate with each other.</span></span>

<span data-ttu-id="840dc-110">**hello 下表說明案例和對應的名稱解析方案：**</span><span class="sxs-lookup"><span data-stu-id="840dc-110">**hello following table illustrates scenarios and corresponding name resolution solutions:**</span></span>

| <span data-ttu-id="840dc-111">**案例**</span><span class="sxs-lookup"><span data-stu-id="840dc-111">**Scenario**</span></span> | <span data-ttu-id="840dc-112">**方案**</span><span class="sxs-lookup"><span data-stu-id="840dc-112">**Solution**</span></span> | <span data-ttu-id="840dc-113">**尾碼**</span><span class="sxs-lookup"><span data-stu-id="840dc-113">**Suffix**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="840dc-114">角色執行個體或 Vm 之間的名稱解析位於 hello 相同雲端服務或虛擬網路</span><span class="sxs-lookup"><span data-stu-id="840dc-114">Name resolution between role instances or VMs located in hello same cloud service or virtual network</span></span> |[<span data-ttu-id="840dc-115">Azure 提供的名稱解析</span><span class="sxs-lookup"><span data-stu-id="840dc-115">Azure-provided name resolution</span></span>](#azure-provided-name-resolution) |<span data-ttu-id="840dc-116">主機名稱或 FQDN</span><span class="sxs-lookup"><span data-stu-id="840dc-116">hostname or FQDN</span></span> |
| <span data-ttu-id="840dc-117">位於不同虛擬網路中的角色執行個體或 VM 之間的名稱解析</span><span class="sxs-lookup"><span data-stu-id="840dc-117">Name resolution between role instances or VMs located in different virtual networks</span></span> |<span data-ttu-id="840dc-118">客戶管理的 DNS 伺服器將 vnet 之間的查詢轉送供 Azure (DNS Proxy) 解析。</span><span class="sxs-lookup"><span data-stu-id="840dc-118">Customer-managed DNS servers forwarding queries between vnets for resolution by Azure (DNS proxy).</span></span>  <span data-ttu-id="840dc-119">請參閱 [使用專屬 DNS 伺服器的名稱解析](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="840dc-119">see [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="840dc-120">僅 FQDN</span><span class="sxs-lookup"><span data-stu-id="840dc-120">FQDN only</span></span> |
| <span data-ttu-id="840dc-121">解析 Azure 中角色執行個體或 VM 的內部部署電腦及伺服器名稱</span><span class="sxs-lookup"><span data-stu-id="840dc-121">Resolution of on-premises computer and service names from role instances or VMs in Azure</span></span> |<span data-ttu-id="840dc-122">客戶管理的 DNS 伺服器 (例如內部部署的網域控制站、本機唯讀網域控制站或使用區域傳輸同步的次要 DNS)。</span><span class="sxs-lookup"><span data-stu-id="840dc-122">Customer-managed DNS servers (e.g. on-premises domain controller, local read-only domain controller or a DNS secondary synced using zone transfers).</span></span>  <span data-ttu-id="840dc-123">請參閱 [使用專屬 DNS 伺服器的名稱解析](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="840dc-123">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="840dc-124">僅 FQDN</span><span class="sxs-lookup"><span data-stu-id="840dc-124">FQDN only</span></span> |
| <span data-ttu-id="840dc-125">從內部部署電腦解析 Azure 主機名稱</span><span class="sxs-lookup"><span data-stu-id="840dc-125">Resolution of Azure hostnames from on-premises computers</span></span> |<span data-ttu-id="840dc-126">轉寄查詢 tooa 客戶管理 proxy 中的 DNS 伺服器 hello 對應 vnet，hello proxy 伺服器將轉寄查詢 tooAzure 進行解析。</span><span class="sxs-lookup"><span data-stu-id="840dc-126">Forward queries tooa customer-managed DNS proxy server in hello corresponding vnet, hello proxy server forwards queries tooAzure for resolution.</span></span> <span data-ttu-id="840dc-127">請參閱 [使用專屬 DNS 伺服器的名稱解析](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="840dc-127">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="840dc-128">僅 FQDN</span><span class="sxs-lookup"><span data-stu-id="840dc-128">FQDN only</span></span> |
| <span data-ttu-id="840dc-129">內部 IP 的反向 DNS</span><span class="sxs-lookup"><span data-stu-id="840dc-129">Reverse DNS for internal IPs</span></span> |[<span data-ttu-id="840dc-130">使用專屬 DNS 伺服器的名稱解析</span><span class="sxs-lookup"><span data-stu-id="840dc-130">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server) |<span data-ttu-id="840dc-131">n/a</span><span class="sxs-lookup"><span data-stu-id="840dc-131">n/a</span></span> |
| <span data-ttu-id="840dc-132">位於不同雲端服務，不在虛擬網路中的 VM 或角色執行個體之間的名稱解析</span><span class="sxs-lookup"><span data-stu-id="840dc-132">Name resolution between VMs or role instances located in different cloud services, not in a virtual network</span></span> |<span data-ttu-id="840dc-133">不適用。</span><span class="sxs-lookup"><span data-stu-id="840dc-133">Not applicable.</span></span> <span data-ttu-id="840dc-134">虛擬網路外部不支援不同雲端服務中 VM 和角色執行個體之間的連線。</span><span class="sxs-lookup"><span data-stu-id="840dc-134">Connectivity between VMs and role instances in different cloud services is not supported outside a virtual network.</span></span> |<span data-ttu-id="840dc-135">n/a</span><span class="sxs-lookup"><span data-stu-id="840dc-135">n/a</span></span> |

## <a name="azure-provided-name-resolution"></a><span data-ttu-id="840dc-136">Azure 提供的名稱解析</span><span class="sxs-lookup"><span data-stu-id="840dc-136">Azure-provided name resolution</span></span>
<span data-ttu-id="840dc-137">公用 DNS 名稱解析，以及 Azure 提供的內部名稱解析的 Vm 和角色執行個體中的 hello 相同虛擬網路或雲端服務。</span><span class="sxs-lookup"><span data-stu-id="840dc-137">Along with resolution of public DNS names, Azure provides internal name resolution for VMs and role instances that reside within hello same virtual network or cloud service.</span></span>  <span data-ttu-id="840dc-138">雲端服務中的 Vm/執行個體共用相同的 DNS 尾碼 （因此 hello 單獨的主機名稱就已足夠），但傳統虛擬網路不同雲端服務中有不同的 DNS 尾碼 hello FQDN 是不同的雲端服務之間所需的 tooresolve 名稱 hello。</span><span class="sxs-lookup"><span data-stu-id="840dc-138">VMs/instances in a cloud service share hello same DNS suffix (so hello hostname alone is sufficient) but in classic virtual networks different cloud services have different DNS suffixes so hello FQDN is needed tooresolve names between different cloud services.</span></span>  <span data-ttu-id="840dc-139">Hello Resource Manager 部署模型中的虛擬網路，hello DNS 尾碼一致 hello 虛擬網路上 （因此不需要 hello FQDN），且 DNS 名稱可以指派 tooboth Nic 和 Vm。</span><span class="sxs-lookup"><span data-stu-id="840dc-139">In virtual networks in hello Resource Manager deployment model, hello DNS suffix is consistent across hello virtual network (so hello FQDN is not needed) and DNS names can be assigned tooboth NICs and VMs.</span></span> <span data-ttu-id="840dc-140">雖然 Azure 提供名稱解析不需要任何設定，它並不 hello 適用於所有部署案例中，選擇 hello 如上表所示。</span><span class="sxs-lookup"><span data-stu-id="840dc-140">Although Azure-provided name resolution does not require any configuration, it is not hello appropriate choice for all deployment scenarios, as seen on hello table above.</span></span>

> [!NOTE]
> <span data-ttu-id="840dc-141">在 web 和背景工作角色的 hello 情況下，您也可以存取 hello 內部 IP 位址的 hello 角色名稱和執行個體使用依據編號 hello Azure 服務管理 REST API 角色執行個體。</span><span class="sxs-lookup"><span data-stu-id="840dc-141">In hello case of web and worker roles, you can also access hello internal IP addresses of role instances based on hello role name and instance number using hello Azure Service Management REST API.</span></span> <span data-ttu-id="840dc-142">如需詳細資訊，請參閱 [服務管理 REST API 參考](https://msdn.microsoft.com/library/azure/ee460799.aspx)。</span><span class="sxs-lookup"><span data-stu-id="840dc-142">For more information, see [Service Management REST API Reference](https://msdn.microsoft.com/library/azure/ee460799.aspx).</span></span>
> 
> 

### <a name="features-and-considerations"></a><span data-ttu-id="840dc-143">功能和注意事項</span><span class="sxs-lookup"><span data-stu-id="840dc-143">Features and Considerations</span></span>
<span data-ttu-id="840dc-144">**功能：**</span><span class="sxs-lookup"><span data-stu-id="840dc-144">**Features:**</span></span>

* <span data-ttu-id="840dc-145">容易使用： 在順序 toouse Azure 提供名稱解析不需要任何設定。</span><span class="sxs-lookup"><span data-stu-id="840dc-145">Ease of use: No configuration is required in order toouse Azure-provided name resolution.</span></span>
* <span data-ttu-id="840dc-146">hello Azure 提供名稱解析服務是高可用性，儲存您的 hello 需要 toocreate 和管理叢集的 DNS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="840dc-146">hello Azure-provided name resolution service is highly available, saving you hello need toocreate and manage clusters of your own DNS servers.</span></span>
* <span data-ttu-id="840dc-147">可以使用您自己的 DNS 伺服器 tooresolve 搭配內部部署和 Azure 的主機名稱。</span><span class="sxs-lookup"><span data-stu-id="840dc-147">Can be used in conjunction with your own DNS servers tooresolve both on-premises and Azure hostnames.</span></span>
* <span data-ttu-id="840dc-148">名稱解析是提供角色執行個體/中的 Vm 之間 hello 相同雲端服務，而不需為 fqdn。</span><span class="sxs-lookup"><span data-stu-id="840dc-148">Name resolution is provided between role instances/VMs within hello same cloud service without need for a FQDN.</span></span>
* <span data-ttu-id="840dc-149">使用 hello Resource Manager 部署模型，而需要在 hello FQDN 的虛擬網路中的 Vm 之間提供名稱解析。</span><span class="sxs-lookup"><span data-stu-id="840dc-149">Name resolution is provided between VMs in virtual networks that use hello Resource Manager deployment model, without need for hello FQDN.</span></span> <span data-ttu-id="840dc-150">Hello 傳統部署模型中的虛擬網路需要 hello FQDN 時解析不同雲端服務中的名稱。</span><span class="sxs-lookup"><span data-stu-id="840dc-150">Virtual networks in hello classic deployment model require hello FQDN when resolving names in different cloud services.</span></span> 
* <span data-ttu-id="840dc-151">您可以使用最能描述部署的主機名稱，而不是使用自動產生的名稱。</span><span class="sxs-lookup"><span data-stu-id="840dc-151">You can use hostnames that best describe your deployments, rather than working with auto-generated names.</span></span>

<bpt id="p1">**</bpt>Considerations:<ept id="p1">**</ept>

* <span data-ttu-id="840dc-153">hello Azure 建立的 DNS 尾碼不能修改。</span><span class="sxs-lookup"><span data-stu-id="840dc-153">hello Azure-created DNS suffix cannot be modified.</span></span>
* <span data-ttu-id="840dc-154">您無法手動註冊您自己的記錄。</span><span class="sxs-lookup"><span data-stu-id="840dc-154">You cannot manually register your own records.</span></span>
* <span data-ttu-id="840dc-155">不支援 WINS 和 NetBIOS。</span><span class="sxs-lookup"><span data-stu-id="840dc-155">WINS and NetBIOS are not supported.</span></span> <span data-ttu-id="840dc-156">(您無法在「Windows 檔案總管」中看到您的 VM)。</span><span class="sxs-lookup"><span data-stu-id="840dc-156">(You cannot see your VMs in Windows Explorer.)</span></span>
* <span data-ttu-id="840dc-157">主機名稱必須是 DNS 相容 (只能使用 0-9、a-z 和 '-'，無法以 '-' 開始或結束。</span><span class="sxs-lookup"><span data-stu-id="840dc-157">Hostnames must be DNS-compatible (They must use only 0-9, a-z and '-', and cannot start or end with a '-'.</span></span> <span data-ttu-id="840dc-158">請參閱 RFC 3696 第 2 節)。</span><span class="sxs-lookup"><span data-stu-id="840dc-158">See RFC 3696 section 2.)</span></span>
* <span data-ttu-id="840dc-159">每個 VM 的 DNS 查詢流量已經過節流。</span><span class="sxs-lookup"><span data-stu-id="840dc-159">DNS query traffic is throttled for each VM.</span></span> <span data-ttu-id="840dc-160">這應該不會影響大部分的應用程式。</span><span class="sxs-lookup"><span data-stu-id="840dc-160">This shouldn't impact most applications.</span></span>  <span data-ttu-id="840dc-161">如果觀察到要求節流，請確定用戶端快取已啟用。</span><span class="sxs-lookup"><span data-stu-id="840dc-161">If request throttling is observed, ensure that client-side caching is enabled.</span></span>  <span data-ttu-id="840dc-162">如需詳細資訊，請參閱[取得 hello 大部分 Azure 提供名稱解析](#Getting-the-most-from-Azure-provided-name-resolution)。</span><span class="sxs-lookup"><span data-stu-id="840dc-162">For more details, see [Getting hello most from Azure-provided name resolution](#Getting-the-most-from-Azure-provided-name-resolution).</span></span>
* <span data-ttu-id="840dc-163">只有 hello 前 180 個雲端服務中的 Vm 會註冊為傳統部署模型中每個虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="840dc-163">Only VMs in hello first 180 cloud services are registered for each virtual network in a classic deployment model.</span></span> <span data-ttu-id="840dc-164">這不適用 toovirtual 網路資源管理員部署模型中。</span><span class="sxs-lookup"><span data-stu-id="840dc-164">This does not apply toovirtual networks in Resource Manager deployment models.</span></span>

### <a name="getting-hello-most-from-azure-provided-name-resolution"></a><span data-ttu-id="840dc-165">取得 hello 大部分 Azure 提供名稱解析</span><span class="sxs-lookup"><span data-stu-id="840dc-165">Getting hello most from Azure-provided name resolution</span></span>
<bpt id="p1">**</bpt>Client-side Caching:<ept id="p1">**</ept>

<span data-ttu-id="840dc-167">並非每個 DNS 查詢需要 toobe hello 網路間傳送。</span><span class="sxs-lookup"><span data-stu-id="840dc-167">Not every DNS query needs toobe sent across hello network.</span></span>  <span data-ttu-id="840dc-168">用戶端快取有助於降低延遲，並改善恢復功能 toonetwork 音效解析從本機快取的重複執行 DNS 查詢。</span><span class="sxs-lookup"><span data-stu-id="840dc-168">Client-side caching helps reduce latency and improve resilience toonetwork blips by resolving recurring DNS queries from a local cache.</span></span>  <span data-ttu-id="840dc-169">DNS 記錄包含存留時間 (TTL) 可讓 hello 快取 toostore hello 記錄越久，而不會影響記錄的最新狀態，因此用戶端快取是適用於大部分的情況。</span><span class="sxs-lookup"><span data-stu-id="840dc-169">DNS records contain a Time-To-Live (TTL) which allows hello cache toostore hello record for as long as possible without impacting record freshness, so client-side caching is suitable for most situations.</span></span>

<span data-ttu-id="840dc-170">hello 預設 Windows DNS 用戶端都有內建的 DNS 快取。</span><span class="sxs-lookup"><span data-stu-id="840dc-170">hello default Windows DNS Client has a DNS cache built-in.</span></span>  <span data-ttu-id="840dc-171">某些 Linux 散發版本不包含快取預設情況下，建議您，加入一個 tooeach Linux VM （檢查後，還沒有在本機快取）。</span><span class="sxs-lookup"><span data-stu-id="840dc-171">Some Linux distros do not include caching by default, it is recommended that one be added tooeach Linux VM (after checking that there isn't a local cache already).</span></span>

<span data-ttu-id="840dc-172">有不同 DNS 快取可用的封裝，例如 dnsmasq，以下是 hello 步驟 tooinstall dnsmasq hello 最常見的散發版本上：</span><span class="sxs-lookup"><span data-stu-id="840dc-172">There are a number of different DNS caching packages available, e.g. dnsmasq, here are hello steps tooinstall dnsmasq on hello most common distros:</span></span>

* <span data-ttu-id="840dc-173">Ubuntu (使用 resolvconf)：</span><span class="sxs-lookup"><span data-stu-id="840dc-173">**Ubuntu (uses resolvconf)**:</span></span>
  * <span data-ttu-id="840dc-174">只安裝 hello dnsmasq 封裝 ("sudo apt get 安裝 dnsmasq")。</span><span class="sxs-lookup"><span data-stu-id="840dc-174">just install hello dnsmasq package (“sudo apt-get install dnsmasq”).</span></span>
* <span data-ttu-id="840dc-175">SUSE (使用 netconf)：</span><span class="sxs-lookup"><span data-stu-id="840dc-175">**SUSE (uses netconf)**:</span></span>
  * <span data-ttu-id="840dc-176">安裝 hello dnsmasq 套件 ("sudo zypper 安裝 dnsmasq")</span><span class="sxs-lookup"><span data-stu-id="840dc-176">install hello dnsmasq package (“sudo zypper install dnsmasq”)</span></span> 
  * <span data-ttu-id="840dc-177">啟用 hello dnsmasq 服務 (「 systemctl 啟用 dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="840dc-177">enable hello dnsmasq service (“systemctl enable dnsmasq.service”)</span></span> 
  * <span data-ttu-id="840dc-178">啟動 hello dnsmasq 服務 (「 systemctl 開始 dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="840dc-178">start hello dnsmasq service (“systemctl start dnsmasq.service”)</span></span> 
  * <span data-ttu-id="840dc-179">編輯"/ 等/sysconfig/網路/config"，並變更 NETCONFIG_DNS_FORWARDER =""太"dnsmasq"</span><span class="sxs-lookup"><span data-stu-id="840dc-179">edit “/etc/sysconfig/network/config” and change NETCONFIG_DNS_FORWARDER="" too”dnsmasq”</span></span>
  * <span data-ttu-id="840dc-180">更新 resolv.conf （「 netconfig 更新 」） tooset hello 快取為 hello 本機 DNS 解析程式</span><span class="sxs-lookup"><span data-stu-id="840dc-180">update resolv.conf ("netconfig update") tooset hello cache as hello local DNS resolver</span></span>
* <span data-ttu-id="840dc-181">OpenLogic (使用 NetworkManager)：</span><span class="sxs-lookup"><span data-stu-id="840dc-181">**OpenLogic (uses NetworkManager)**:</span></span>
  * <span data-ttu-id="840dc-182">安裝 hello dnsmasq 套件 ("sudo yum 安裝 dnsmasq")</span><span class="sxs-lookup"><span data-stu-id="840dc-182">install hello dnsmasq package (“sudo yum install dnsmasq”)</span></span>
  * <span data-ttu-id="840dc-183">啟用 hello dnsmasq 服務 (「 systemctl 啟用 dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="840dc-183">enable hello dnsmasq service (“systemctl enable dnsmasq.service”)</span></span>
  * <span data-ttu-id="840dc-184">啟動 hello dnsmasq 服務 (「 systemctl 開始 dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="840dc-184">start hello dnsmasq service (“systemctl start dnsmasq.service”)</span></span>
  * <span data-ttu-id="840dc-185">新增 「 前面加上的網域名稱伺服器 127.0.0.1;"too"/etc/dhclient-eth0.conf"</span><span class="sxs-lookup"><span data-stu-id="840dc-185">add “prepend domain-name-servers 127.0.0.1;” too“/etc/dhclient-eth0.conf”</span></span>
  * <span data-ttu-id="840dc-186">hello 本機 DNS 解析程式時重新啟動 hello 網路服務 （「 網路重新啟動服務 」） tooset hello 快取</span><span class="sxs-lookup"><span data-stu-id="840dc-186">restart hello network service (“service network restart”) tooset hello cache as hello local DNS resolver</span></span>

> [!NOTE]
> <span data-ttu-id="840dc-187">hello 'dnsmasq' 封裝都只有一個 hello 許多可用的 DNS 快取適用於 Linux。</span><span class="sxs-lookup"><span data-stu-id="840dc-187">hello 'dnsmasq' package is only one of hello many DNS caches available for Linux.</span></span>  <span data-ttu-id="840dc-188">使用它之前，請檢查特定需求的適用性，而且沒有安裝其他快取。</span><span class="sxs-lookup"><span data-stu-id="840dc-188">Before using it, please check its suitability for your particular needs and that no other cache is installed.</span></span>
> 
> 

<bpt id="p1">**</bpt>Client-side Retries:<ept id="p1">**</ept>

<span data-ttu-id="840dc-190">DNS 主要是 UDP 通訊協定。</span><span class="sxs-lookup"><span data-stu-id="840dc-190">DNS is primarily a UDP protocol.</span></span>  <span data-ttu-id="840dc-191">Hello UDP 通訊協定並不保證訊息傳遞，如 hello DNS 通訊協定本身被處理重試邏輯。</span><span class="sxs-lookup"><span data-stu-id="840dc-191">As hello UDP protocol doesn't guarantee message delivery, retry logic is handled in hello DNS protocol itself.</span></span>  <span data-ttu-id="840dc-192">每個 DNS 用戶端 （作業系統） 可以展現不同的重試邏輯，根據 hello 建立者喜好設定：</span><span class="sxs-lookup"><span data-stu-id="840dc-192">Each DNS client (operating system) can exhibit different retry logic depending on hello creators preference:</span></span>

* <span data-ttu-id="840dc-193">Windows 作業系統會在 1 秒後重試，然後再依序隔 2、4、4 秒後重試。</span><span class="sxs-lookup"><span data-stu-id="840dc-193">Windows operating systems retry after 1 second and then again after another 2, 4 and another 4 seconds.</span></span> 
* <span data-ttu-id="840dc-194">hello 預設 Linux 安裝後的重試 5 秒。</span><span class="sxs-lookup"><span data-stu-id="840dc-194">hello default Linux setup retries after 5 seconds.</span></span>  <span data-ttu-id="840dc-195">它會建議 toochange 此 tooretry 5 次秒的間隔 1。</span><span class="sxs-lookup"><span data-stu-id="840dc-195">It is recommended toochange this tooretry 5 times at 1 second intervals.</span></span>  

<span data-ttu-id="840dc-196">toocheck hello Linux VM，'cat /etc/resolv.conf' 上的目前設定，並查看 hello [選項] 行，例如：</span><span class="sxs-lookup"><span data-stu-id="840dc-196">toocheck hello current settings on a Linux VM, 'cat /etc/resolv.conf' and look at hello 'options' line, e.g.:</span></span>

    options timeout:1 attempts:5

<span data-ttu-id="840dc-197">hello resolv.conf 檔案通常是自動產生，無法編輯。</span><span class="sxs-lookup"><span data-stu-id="840dc-197">hello resolv.conf file is usually auto-generated and should not be edited.</span></span>  <span data-ttu-id="840dc-198">hello 新增 hello [選項] 列的特定步驟會因 distro:</span><span class="sxs-lookup"><span data-stu-id="840dc-198">hello specific steps for adding hello 'options' line vary by distro:</span></span>

* <span data-ttu-id="840dc-199"> (使用 resolvconf)：</span><span class="sxs-lookup"><span data-stu-id="840dc-199">**Ubuntu** (uses resolvconf):</span></span>
  * <span data-ttu-id="840dc-200">新增 hello 選項列 too'/etc/resolveconf/resolv.conf.d/head'</span><span class="sxs-lookup"><span data-stu-id="840dc-200">add hello options line too'/etc/resolveconf/resolv.conf.d/head'</span></span> 
  * <span data-ttu-id="840dc-201">執行 ' resolvconf u' tooupdate</span><span class="sxs-lookup"><span data-stu-id="840dc-201">run 'resolvconf -u' tooupdate</span></span>
* <span data-ttu-id="840dc-202"> (使用 netconf)：</span><span class="sxs-lookup"><span data-stu-id="840dc-202">**SUSE** (uses netconf):</span></span>
  * <span data-ttu-id="840dc-203">新增 ' timeout:1 嘗試次數： 5' toohello NETCONFIG_DNS_RESOLVER_OPTIONS =""參數的 '/ 等/sysconfig/網路/config'</span><span class="sxs-lookup"><span data-stu-id="840dc-203">add 'timeout:1 attempts:5' toohello NETCONFIG_DNS_RESOLVER_OPTIONS="" parameter in '/etc/sysconfig/network/config'</span></span> 
  * <span data-ttu-id="840dc-204">執行 'netconfig 更新' tooupdate</span><span class="sxs-lookup"><span data-stu-id="840dc-204">run 'netconfig update' tooupdate</span></span>
* <span data-ttu-id="840dc-205"> (使用 NetworkManager)：</span><span class="sxs-lookup"><span data-stu-id="840dc-205">**OpenLogic** (uses NetworkManager):</span></span>
  * <span data-ttu-id="840dc-206">新增 '回應 」 選項 timeout:1 嘗試次數： 5 」' too'/etc/NetworkManager/dispatcher.d/11-dhclient'</span><span class="sxs-lookup"><span data-stu-id="840dc-206">add 'echo "options timeout:1 attempts:5"' too'/etc/NetworkManager/dispatcher.d/11-dhclient'</span></span> 
  * <span data-ttu-id="840dc-207">執行 'service 網路 restart' tooupdate</span><span class="sxs-lookup"><span data-stu-id="840dc-207">run 'service network restart' tooupdate</span></span>

## <a name="name-resolution-using-your-own-dns-server"></a><span data-ttu-id="840dc-208">使用專屬 DNS 伺服器的名稱解析</span><span class="sxs-lookup"><span data-stu-id="840dc-208">Name resolution using your own DNS server</span></span>
<span data-ttu-id="840dc-209">在您的名稱解析需求可能會超過 Azure 所提供，例如當 hello 功能使用 Active Directory 網域，或當您需要虛擬網路 (vnet) 之間的 DNS 解析，有數個情況。</span><span class="sxs-lookup"><span data-stu-id="840dc-209">There are a number of situations where your name resolution needs may go beyond hello features provided by Azure, for example when using Active Directory domains or when you require DNS resolution between virtual networks (vnets).</span></span>  <span data-ttu-id="840dc-210">toocover 這些案例中，Azure 提供 hello 能力您 toouse 您自己的 DNS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="840dc-210">toocover these scenarios, Azure provides hello ability for you toouse your own DNS servers.</span></span>  

<span data-ttu-id="840dc-211">虛擬網路中的 DNS 伺服器可以轉送 tooresolve 該虛擬網路內的主機名稱的 DNS 查詢 tooAzure 的遞迴解析程式。</span><span class="sxs-lookup"><span data-stu-id="840dc-211">DNS servers within a virtual network can forward DNS queries tooAzure's recursive resolvers tooresolve hostnames within that virtual network.</span></span>  <span data-ttu-id="840dc-212">例如，在 Azure 中執行網域控制站 (DC) 可以回應 tooDNS 查詢其網域，轉送所有其他查詢 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="840dc-212">For example, a Domain Controller (DC) running in Azure can respond tooDNS queries for its domains and forward all other queries tooAzure.</span></span>  <span data-ttu-id="840dc-213">這可讓 Vm toosee 您的內部部署資源 （透過 hello DC) 和 Azure 提供的主機名稱 （透過 hello 轉寄站）。</span><span class="sxs-lookup"><span data-stu-id="840dc-213">This allows VMs toosee both your on-premises resources (via hello DC) and Azure-provided hostnames (via hello forwarder).</span></span>  <span data-ttu-id="840dc-214">存取 tooAzure 遞迴解析程式會透過 hello 虛擬 IP 168.63.129.16 提供。</span><span class="sxs-lookup"><span data-stu-id="840dc-214">Access tooAzure's recursive resolvers is provided via hello virtual IP 168.63.129.16.</span></span>

<span data-ttu-id="840dc-215">DNS 轉寄也啟用間 vnet DNS 解析，並可讓您在內部部署機器 tooresolve Azure 提供的主機名稱。</span><span class="sxs-lookup"><span data-stu-id="840dc-215">DNS forwarding also enables inter-vnet DNS resolution and allows your on-premises machines tooresolve Azure-provided hostnames.</span></span>  <span data-ttu-id="840dc-216">若要 tooresolve VM 的主機名稱、 hello VM 的 DNS 伺服器必須位於 hello 相同虛擬網路，而且會設定的 tooforward 主機名稱查詢 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="840dc-216">In order tooresolve a VM's hostname, hello DNS server VM must reside in hello same virtual network and be configured tooforward hostname queries tooAzure.</span></span>  <span data-ttu-id="840dc-217">Hello DNS 尾碼不是在每個 vnet 中，您可以使用條件轉寄規則 toosend DNS 查詢 toohello 更正 vnet 進行解析。</span><span class="sxs-lookup"><span data-stu-id="840dc-217">As hello DNS suffix is different in each vnet, you can use conditional forwarding rules toosend DNS queries toohello correct vnet for resolution.</span></span>  <span data-ttu-id="840dc-218">hello 下列影像顯示兩個 vnet 與內部部署網路進行間 vnet DNS 解析使用此方法。</span><span class="sxs-lookup"><span data-stu-id="840dc-218">hello following image shows two vnets and an on-premises network doing inter-vnet DNS resolution using this method.</span></span>  <span data-ttu-id="840dc-219">範例 DNS 轉寄站位於 hello [Azure 快速入門範本組件庫](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/)和[GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder)。</span><span class="sxs-lookup"><span data-stu-id="840dc-219">An example DNS forwarder is available in hello [Azure Quickstart Templates gallery](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/) and [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder).</span></span>

![虛擬網路之間的 DNS](./media/virtual-networks-name-resolution-for-vms-and-role-instances/inter-vnet-dns.png)

<span data-ttu-id="840dc-221">使用 Azure 提供的名稱解析，內部的 DNS 尾碼時 (*。 internal.cloudapp.net) 提供的 tooeach VM 使用 DHCP。</span><span class="sxs-lookup"><span data-stu-id="840dc-221">When using Azure-provided name resolution, an Internal DNS suffix (*.internal.cloudapp.net) is provided tooeach VM using DHCP.</span></span>  <span data-ttu-id="840dc-222">這會啟用主機名稱解析為 hello hello internal.cloudapp.net 區域中的記錄的主機名稱。</span><span class="sxs-lookup"><span data-stu-id="840dc-222">This enables hostname resolution as hello hostname records are in hello internal.cloudapp.net zone.</span></span>  <span data-ttu-id="840dc-223">當使用您自己的名稱解析方案，hello IDN 尾碼不是會提供 tooVMs，因為它會干擾其他 DNS 的架構 （例如加入網域的案例）。</span><span class="sxs-lookup"><span data-stu-id="840dc-223">When using your own name resolution solution, hello IDNS suffix is not supplied tooVMs because it interferes with other DNS architectures (like domain-joined scenarios).</span></span>  <span data-ttu-id="840dc-224">我們會改為提供一個沒有作用的預留位置 (reddog.microsoft.com)。</span><span class="sxs-lookup"><span data-stu-id="840dc-224">Instead we provide a non-functioning placeholder (reddog.microsoft.com).</span></span>  

<span data-ttu-id="840dc-225">如有需要可以使用 PowerShell 或 hello API 決定 hello 內部的 DNS 尾碼：</span><span class="sxs-lookup"><span data-stu-id="840dc-225">If needed, hello Internal DNS suffix can be determined using PowerShell or hello API:</span></span>

* <span data-ttu-id="840dc-226">資源管理員部署模型中的虛擬網路，hello 尾碼是可透過 hello[網路介面卡](https://msdn.microsoft.com/library/azure/mt163668.aspx)資源或透過 hello [Get AzureRmNetworkInterface](https://msdn.microsoft.com/library/mt619434.aspx) cmdlet。</span><span class="sxs-lookup"><span data-stu-id="840dc-226">For virtual networks in Resource Manager deployment models, hello suffix is available via hello [network interface card](https://msdn.microsoft.com/library/azure/mt163668.aspx) resource or via hello [Get-AzureRmNetworkInterface](https://msdn.microsoft.com/library/mt619434.aspx) cmdlet.</span></span>    
* <span data-ttu-id="840dc-227">在傳統部署模型中，hello 尾碼是可透過 hello[取得部署 API](https://msdn.microsoft.com/library/azure/ee460804.aspx)呼叫或透過 hello [Get-azurevm-偵錯](https://msdn.microsoft.com/library/azure/dn495236.aspx)cmdlet。</span><span class="sxs-lookup"><span data-stu-id="840dc-227">In classic deployment models, hello suffix is available via hello [Get Deployment API](https://msdn.microsoft.com/library/azure/ee460804.aspx) call or via hello [Get-AzureVM -Debug](https://msdn.microsoft.com/library/azure/dn495236.aspx) cmdlet.</span></span>

<span data-ttu-id="840dc-228">如果轉送查詢 tooAzure 不符合您的需求，您需要 tooprovide 自己的 DNS 解決方案。</span><span class="sxs-lookup"><span data-stu-id="840dc-228">If forwarding queries tooAzure doesn't suit your needs, you will need tooprovide your own DNS solution.</span></span>  <span data-ttu-id="840dc-229">您的 DNS 解決方案將需要：</span><span class="sxs-lookup"><span data-stu-id="840dc-229">Your DNS solution will need to:</span></span>

* <span data-ttu-id="840dc-230">提供適當的主機名稱解析，例如透過 [DDNS](virtual-networks-name-resolution-ddns.md)。</span><span class="sxs-lookup"><span data-stu-id="840dc-230">Provide appropriate hostname resolution, e.g. via [DDNS](virtual-networks-name-resolution-ddns.md).</span></span>  <span data-ttu-id="840dc-231">請注意，如果不當使用 DDNS 您可能需要 toodisable DNS 記錄清除，Azure 的 DHCP 租用很長，以及清除可能會移除 DNS 記錄。</span><span class="sxs-lookup"><span data-stu-id="840dc-231">Note, if using DDNS you may need toodisable DNS record scavenging as Azure's DHCP leases are very long and scavenging may remove DNS records prematurely.</span></span> 
* <span data-ttu-id="840dc-232">提供適當的遞迴解析 tooallow 解析的外部網域名稱。</span><span class="sxs-lookup"><span data-stu-id="840dc-232">Provide appropriate recursive resolution tooallow resolution of external domain names.</span></span>
* <span data-ttu-id="840dc-233">是可存取 （TCP 和 UDP 連接埠 53） 從它做，是無法 tooaccess 的 hello 用戶端 hello 網際網路。</span><span class="sxs-lookup"><span data-stu-id="840dc-233">Be accessible (TCP and UDP on port 53) from hello clients it serves and be able tooaccess hello internet.</span></span>
* <span data-ttu-id="840dc-234">受到保護免於從 hello 存取網際網路，toomitigate 外部代理程式所帶來的威脅。</span><span class="sxs-lookup"><span data-stu-id="840dc-234">Be secured against access from hello internet, toomitigate threats posed by external agents.</span></span>

> [!NOTE]
> <span data-ttu-id="840dc-235">為了達到最佳效能，使用 Azure Vm 做為 DNS 伺服器時，應該停用 IPv6 和[執行個體層級公用 IP](virtual-networks-instance-level-public-ip.md)應指派 tooeach VM 的 DNS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="840dc-235">For best performance, when using Azure VMs as DNS servers, IPv6 should be disabled and an [Instance-Level Public IP](virtual-networks-instance-level-public-ip.md) should be assigned tooeach DNS server VM.</span></span>  <span data-ttu-id="840dc-236">如果您選擇 toouse Windows Server 做為 DNS 伺服器，[本文](http://blogs.technet.com/b/networking/archive/2015/08/19/name-resolution-performance-of-a-recursive-windows-dns-server-2012-r2.aspx)提供額外的效能分析和最佳化。</span><span class="sxs-lookup"><span data-stu-id="840dc-236">If you choose toouse Windows Server as your DNS server, [this article](http://blogs.technet.com/b/networking/archive/2015/08/19/name-resolution-performance-of-a-recursive-windows-dns-server-2012-r2.aspx) provides additional performance analysis and optimizations.</span></span>
> 
> 

### <a name="specifying-dns-servers"></a><span data-ttu-id="840dc-237">指定 DNS 伺服器</span><span class="sxs-lookup"><span data-stu-id="840dc-237">Specifying DNS servers</span></span>
<span data-ttu-id="840dc-238">當使用您自己的 DNS 伺服器，Azure 會提供 hello 能力 toospecify 每個虛擬網路的多個 DNS 伺服器或每個網路介面 （資源管理員）/雲端服務 （傳統）。</span><span class="sxs-lookup"><span data-stu-id="840dc-238">When using your own DNS servers, Azure provides hello ability toospecify multiple DNS servers per virtual network or per network interface (Resource Manager) / cloud service (classic).</span></span>  <span data-ttu-id="840dc-239">指定雲端服務/網路介面的 DNS 伺服器會透過所指定的虛擬網路的 hello 取得優先順序。</span><span class="sxs-lookup"><span data-stu-id="840dc-239">DNS servers specified for a cloud service/network interface get precedence over those specified for hello virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="840dc-240">網路連接屬性，例如 DNS 伺服器 Ip 時，應該不直接在 Windows Vm 內編輯，因為它們可能會取得在服務期間清除治療 hello 虛擬網路介面卡取得取代時。</span><span class="sxs-lookup"><span data-stu-id="840dc-240">Network connection properties, such as DNS server IPs, should not be edited directly within Windows VMs as they may get erased during service heal when hello virtual network adaptor gets replaced.</span></span> 
> 
> 

<span data-ttu-id="840dc-241">使用 hello 資源管理員部署模型時，可以在 hello 入口網站應用程式開發介面/範本中指定 DNS 伺服器 ([vnet](https://msdn.microsoft.com/library/azure/mt163661.aspx)， [nic](https://msdn.microsoft.com/library/azure/mt163668.aspx)) 或 PowerShell ([vnet](https://msdn.microsoft.com/library/mt603657.aspx)， [nic](https://msdn.microsoft.com/library/mt619370.aspx))。</span><span class="sxs-lookup"><span data-stu-id="840dc-241">When using hello Resource Manager deployment model, DNS servers can be specified in hello Portal, API/Templates ([vnet](https://msdn.microsoft.com/library/azure/mt163661.aspx), [nic](https://msdn.microsoft.com/library/azure/mt163668.aspx)) or PowerShell ([vnet](https://msdn.microsoft.com/library/mt603657.aspx), [nic](https://msdn.microsoft.com/library/mt619370.aspx)).</span></span>

<span data-ttu-id="840dc-242">使用 hello 傳統部署模型時，DNS 伺服器可以指定 hello 虛擬網路的 hello 入口網站或[hello*網路組態*檔案](https://msdn.microsoft.com/library/azure/jj157100)。</span><span class="sxs-lookup"><span data-stu-id="840dc-242">When using hello classic deployment model, DNS servers for hello virtual network can be specified in hello Portal or [hello *Network Configuration* file](https://msdn.microsoft.com/library/azure/jj157100).</span></span>  <span data-ttu-id="840dc-243">雲端服務，透過指定 hello DNS 伺服器[hello*服務組態*檔案](https://msdn.microsoft.com/library/azure/ee758710)或在 PowerShell 中 ([New-azurevm](https://msdn.microsoft.com/library/azure/dn495254.aspx))。</span><span class="sxs-lookup"><span data-stu-id="840dc-243">For cloud services, hello DNS servers are specified via [hello *Service Configuration* file](https://msdn.microsoft.com/library/azure/ee758710) or in PowerShell ([New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx)).</span></span>

> [!NOTE]
> <span data-ttu-id="840dc-244">如果您變更已部署的虛擬網路/虛擬機器的 hello DNS 設定，您需要 toorestart 每個受影響的 VM hello 變更 tootake 效果。</span><span class="sxs-lookup"><span data-stu-id="840dc-244">If you change hello DNS settings for a virtual network/virtual machine that is already deployed, you need toorestart each affected VM for hello changes tootake effect.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="840dc-245">後續步驟</span><span class="sxs-lookup"><span data-stu-id="840dc-245">Next steps</span></span>
<span data-ttu-id="840dc-246">資源管理員部署模型：</span><span class="sxs-lookup"><span data-stu-id="840dc-246">Resource Manager deployment model:</span></span>

* [<span data-ttu-id="840dc-247">建立或更新虛擬網路</span><span class="sxs-lookup"><span data-stu-id="840dc-247">Create or update a virtual network</span></span>](https://msdn.microsoft.com/library/azure/mt163661.aspx)
* [<span data-ttu-id="840dc-248">建立或更新網路介面卡</span><span class="sxs-lookup"><span data-stu-id="840dc-248">Create or update a network interface card</span></span>](https://msdn.microsoft.com/library/azure/mt163668.aspx)
* [<span data-ttu-id="840dc-249">New-AzureRmVirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="840dc-249">New-AzureRmVirtualNetwork</span></span>](https://msdn.microsoft.com/library/mt603657.aspx)
* [<span data-ttu-id="840dc-250">New-AzureRmNetworkInterface</span><span class="sxs-lookup"><span data-stu-id="840dc-250">New-AzureRmNetworkInterface</span></span>](https://msdn.microsoft.com/library/mt619370.aspx)

<span data-ttu-id="840dc-251">傳統部署模型：</span><span class="sxs-lookup"><span data-stu-id="840dc-251">Classic deployment model:</span></span>

* [<span data-ttu-id="840dc-252">Azure 服務組態結構描述</span><span class="sxs-lookup"><span data-stu-id="840dc-252">Azure Service Configuration Schema</span></span>](https://msdn.microsoft.com/library/azure/ee758710)
* [<span data-ttu-id="840dc-253">虛擬網路組態結構描述</span><span class="sxs-lookup"><span data-stu-id="840dc-253">Virtual Network Configuration Schema</span></span>](https://msdn.microsoft.com/library/azure/jj157100)
* [<span data-ttu-id="840dc-254">使用網路組態檔設定虛擬網路</span><span class="sxs-lookup"><span data-stu-id="840dc-254">Configure a Virtual Network by Using a Network Configuration File</span></span>](virtual-networks-using-network-configuration-file.md) 

