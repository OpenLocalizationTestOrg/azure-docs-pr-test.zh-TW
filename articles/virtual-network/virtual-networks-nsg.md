---
title: "Azure 中的網路安全性群組 | Microsoft Docs"
description: "深入了解如何在 Azure 中使用分散式防火牆和網路安全性群組，來隔離及控制虛擬網路中的流量流程。"
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: 20e850fc-6456-4b5f-9a3f-a8379b052bc9
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/11/2016
ms.author: jdial
ms.openlocfilehash: fac6ee69b5f0377e0515ac9abeb28788cbef9b79
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/18/2017
---
# <a name="filter-network-traffic-with-network-security-groups"></a><span data-ttu-id="5f2ef-103">使用網路安全性群組來篩選網路流量</span><span class="sxs-lookup"><span data-stu-id="5f2ef-103">Filter network traffic with network security groups</span></span>

<span data-ttu-id="5f2ef-104">網路安全性群組 (NSG) 包含安全性規則的清單，可允許或拒絕已連線至 Azure 虛擬網路 (VNet) 之資源的網路流量。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-104">A network security group (NSG) contains a list of security rules that allow or deny network traffic to resources connected to Azure Virtual Networks (VNet).</span></span> <span data-ttu-id="5f2ef-105">NSG 可以與子網路、個別 VM (傳統) 或已連結至 VM (Resource Manager) 的個別網路介面 (NIC) 建立關聯。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-105">NSGs can be associated to subnets, individual VMs (classic), or individual network interfaces (NIC) attached to VMs (Resource Manager).</span></span> <span data-ttu-id="5f2ef-106">當 NSG 與子網路相關聯時，系統會將規則套用至已連線至子網路的所有資源。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-106">When an NSG is associated to a subnet, the rules apply to all resources connected to the subnet.</span></span> <span data-ttu-id="5f2ef-107">建立 NSG 與 VM 或 NIC 的關聯也可以進一步限制流量。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-107">Traffic can further be restricted by also associating an NSG to a VM or NIC.</span></span>

> [!NOTE]
> <span data-ttu-id="5f2ef-108">Azure 建立和處理資源的部署模型有二種：[Resource Manager 和傳統](../resource-manager-deployment-model.md)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-108">Azure has two different deployment models for creating and working with resources:  [Resource Manager and classic](../resource-manager-deployment-model.md).</span></span> <span data-ttu-id="5f2ef-109">本文將說明如何使用這兩個模型，但 Microsoft 建議大多數新的部署請使用 Resource Manager 模型。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-109">This article covers using both models, but Microsoft recommends that most new deployments use the Resource Manager model.</span></span>

## <a name="nsg-resource"></a><span data-ttu-id="5f2ef-110">NSG 資源</span><span class="sxs-lookup"><span data-stu-id="5f2ef-110">NSG resource</span></span>
<span data-ttu-id="5f2ef-111">NSG 包含下列屬性：</span><span class="sxs-lookup"><span data-stu-id="5f2ef-111">NSGs contain the following properties:</span></span>

| <span data-ttu-id="5f2ef-112">屬性</span><span class="sxs-lookup"><span data-stu-id="5f2ef-112">Property</span></span> | <span data-ttu-id="5f2ef-113">說明</span><span class="sxs-lookup"><span data-stu-id="5f2ef-113">Description</span></span> | <span data-ttu-id="5f2ef-114">條件約束</span><span class="sxs-lookup"><span data-stu-id="5f2ef-114">Constraints</span></span> | <span data-ttu-id="5f2ef-115">考量</span><span class="sxs-lookup"><span data-stu-id="5f2ef-115">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="5f2ef-116">名稱</span><span class="sxs-lookup"><span data-stu-id="5f2ef-116">Name</span></span> |<span data-ttu-id="5f2ef-117">NSG 的名稱</span><span class="sxs-lookup"><span data-stu-id="5f2ef-117">Name for the NSG</span></span> |<span data-ttu-id="5f2ef-118">必須是區域內唯一的。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-118">Must be unique within the region.</span></span><br/><span data-ttu-id="5f2ef-119">可以包含字母、數字、底線、句號和連字號。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-119">Can contain letters, numbers, underscores, periods, and hyphens.</span></span><br/><span data-ttu-id="5f2ef-120">必須以字母或數字開頭。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-120">Must start with a letter or number.</span></span><br/><span data-ttu-id="5f2ef-121">必須以字母、數字或底線結尾。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-121">Must end with a letter, number, or underscore.</span></span><br/><span data-ttu-id="5f2ef-122">不能超過 80 個字元。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-122">Cannot exceed 80 characters.</span></span> |<span data-ttu-id="5f2ef-123">因為您可能需要建立數個 NSG，請確定您的命名慣例可讓您輕鬆識別 NSG 的功能。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-123">Since you may need to create several NSGs, make sure you have a naming convention that makes it easy to identify the function of your NSGs.</span></span> |
| <span data-ttu-id="5f2ef-124">區域</span><span class="sxs-lookup"><span data-stu-id="5f2ef-124">Region</span></span> |<span data-ttu-id="5f2ef-125">在其中建立 NSG 的 [Azure 區域](https://azure.microsoft.com/regions)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-125">Azure [region](https://azure.microsoft.com/regions) where the NSG is created.</span></span> |<span data-ttu-id="5f2ef-126">NSG 只能與 NSG 相同區域內的資源相關聯。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-126">NSGs can only be associated to resources within the same region as the NSG.</span></span> |<span data-ttu-id="5f2ef-127">若要了解每個區域可以有多少個 NSM ，請閱讀 [Azure 限制](../azure-subscription-service-limits.md#virtual-networking-limits-classic)一文。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-127">To learn about how many NSGs you can have per region, read the [Azure limits](../azure-subscription-service-limits.md#virtual-networking-limits-classic) article.</span></span>|
| <span data-ttu-id="5f2ef-128">資源群組</span><span class="sxs-lookup"><span data-stu-id="5f2ef-128">Resource group</span></span> |<span data-ttu-id="5f2ef-129">NSG 所在的[資源群組](../azure-resource-manager/resource-group-overview.md#resource-groups)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-129">The [resource group](../azure-resource-manager/resource-group-overview.md#resource-groups) the NSG exists in.</span></span> |<span data-ttu-id="5f2ef-130">雖然 NSG 存在於資源群組中，它可以與任何資源群組中的資源相關聯，只要資源是與 NSG 相同的 Azure 區域的一部分。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-130">Although an NSG exists in a resource group, it can be associated to resources in any resource group, as long as the resource is part of the same Azure region as the NSG.</span></span> |<span data-ttu-id="5f2ef-131">資源群組用來以部署單位的形式一起管理多個資源。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-131">Resource groups are used to manage multiple resources together, as a deployment unit.</span></span><br/><span data-ttu-id="5f2ef-132">您可以考慮將 NSG 其相關聯的資源群組在一起。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-132">You may consider grouping the NSG with resources it is associated to.</span></span> |
| <span data-ttu-id="5f2ef-133">規則</span><span class="sxs-lookup"><span data-stu-id="5f2ef-133">Rules</span></span> |<span data-ttu-id="5f2ef-134">定義允許或拒絕流量的輸入或輸出規則。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-134">Inbound or outbound rules that define what traffic is allowed or denied.</span></span> | |<span data-ttu-id="5f2ef-135">請參閱本文的 [NSG 規則](#Nsg-rules)一節。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-135">See the [NSG rules](#Nsg-rules) section of this article.</span></span> |

> [!NOTE]
> <span data-ttu-id="5f2ef-136">端點式 ACL 和網路安全性群組，不支援用於相同的 VM 執行個體。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-136">Endpoint-based ACLs and network security groups are not supported on the same VM instance.</span></span> <span data-ttu-id="5f2ef-137">如果您想要使用 NSG 且已經擁有就地端點 ACL，請先移除端點 ACL。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-137">If you want to use an NSG and have an endpoint ACL already in place, first remove the endpoint ACL.</span></span> <span data-ttu-id="5f2ef-138">若要了解如何移除 ACL，請閱讀[使用 PowerShell 管理端點的存取控制清單 (ACL)](virtual-networks-acl-powershell.md) 一文。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-138">To learn how to remove an ACL, read the [Managing Access Control Lists (ACLs) for Endpoints by using PowerShell](virtual-networks-acl-powershell.md) article.</span></span>
> 

### <a name="nsg-rules"></a><span data-ttu-id="5f2ef-139">NSG 規則</span><span class="sxs-lookup"><span data-stu-id="5f2ef-139">NSG rules</span></span>
<span data-ttu-id="5f2ef-140">NSG 規則包含下列屬性：</span><span class="sxs-lookup"><span data-stu-id="5f2ef-140">NSG rules contain the following properties:</span></span>

| <span data-ttu-id="5f2ef-141">屬性</span><span class="sxs-lookup"><span data-stu-id="5f2ef-141">Property</span></span> | <span data-ttu-id="5f2ef-142">說明</span><span class="sxs-lookup"><span data-stu-id="5f2ef-142">Description</span></span> | <span data-ttu-id="5f2ef-143">條件約束</span><span class="sxs-lookup"><span data-stu-id="5f2ef-143">Constraints</span></span> | <span data-ttu-id="5f2ef-144">考量</span><span class="sxs-lookup"><span data-stu-id="5f2ef-144">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="5f2ef-145">**名稱**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-145">**Name**</span></span> |<span data-ttu-id="5f2ef-146">規則的名稱。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-146">Name for the rule.</span></span> |<span data-ttu-id="5f2ef-147">必須是區域內唯一的。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-147">Must be unique within the region.</span></span><br/><span data-ttu-id="5f2ef-148">可以包含字母、數字、底線、句號和連字號。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-148">Can contain letters, numbers, underscores, periods, and hyphens.</span></span><br/><span data-ttu-id="5f2ef-149">必須以字母或數字開頭。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-149">Must start with a letter or number.</span></span><br/><span data-ttu-id="5f2ef-150">必須以字母、數字或底線結尾。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-150">Must end with a letter, number, or underscore.</span></span><br/><span data-ttu-id="5f2ef-151">不能超過 80 個字元。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-151">Cannot exceed 80 characters.</span></span> |<span data-ttu-id="5f2ef-152">在 NSG 內可以有數個規則，因此請確定您遵循可讓您識別規則的功能的命名慣例。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-152">You may have several rules within an NSG, so make sure you follow a naming convention that allows you to identify the function of your rule.</span></span> |
| <span data-ttu-id="5f2ef-153">**通訊協定**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-153">**Protocol**</span></span> |<span data-ttu-id="5f2ef-154">規則要符合的通訊協定。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-154">Protocol to match for the rule.</span></span> |<span data-ttu-id="5f2ef-155">TCP、UDP 或 *</span><span class="sxs-lookup"><span data-stu-id="5f2ef-155">TCP, UDP, or *</span></span> |<span data-ttu-id="5f2ef-156">使用 * 做為通訊協定包含 ICMP (僅東西流量)，以及 UDP 和 TCP，而且可能會降低您需要的規則數目。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-156">Using * as a protocol includes ICMP (East-West traffic only), as well as UDP and TCP, and may reduce the number of rules you need.</span></span><br/><span data-ttu-id="5f2ef-157">同時，使用 * 可能會是過於廣泛的方法，因此建議您只有在必要時使用 *。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-157">At the same time, using * might be too broad an approach, so it's recommended that you use * only when necessary.</span></span> |
| <span data-ttu-id="5f2ef-158">**來源連接埠範圍**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-158">**Source port range**</span></span> |<span data-ttu-id="5f2ef-159">規則要符合的來源連接埠範圍。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-159">Source port range to match for the rule.</span></span> |<span data-ttu-id="5f2ef-160">1 到 65535 的單一連接埠號碼、連接埠範圍 (例如：1-65535)，或 * (所有連接埠)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-160">Single port number from 1 to 65535, port range (example: 1-65535), or * (for all ports).</span></span> |<span data-ttu-id="5f2ef-161">來源連接埠可以是暫時的。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-161">Source ports could be ephemeral.</span></span> <span data-ttu-id="5f2ef-162">除非您的用戶端程式是使用特定連接埠，否則在大部分情況下請使用 *。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-162">Unless your client program is using a specific port, use * in most cases.</span></span><br/><span data-ttu-id="5f2ef-163">請嘗試儘可能使用連接埠範圍以避免需要多個規則。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-163">Try to use port ranges as much as possible to avoid the need for multiple rules.</span></span><br/><span data-ttu-id="5f2ef-164">多個連接埠或連接埠範圍不可使用逗號分組。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-164">Multiple ports or port ranges cannot be grouped by a comma.</span></span> |
| <span data-ttu-id="5f2ef-165">**目的地連接埠範圍**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-165">**Destination port range**</span></span> |<span data-ttu-id="5f2ef-166">規則要符合的目的地連接埠範圍。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-166">Destination port range to match for the rule.</span></span> |<span data-ttu-id="5f2ef-167">1 到 65535 的單一連接埠號碼、連接埠範圍 (例如：1-65535)，或 \* (所有連接埠)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-167">Single port number from 1 to 65535, port range (example: 1-65535), or \* (for all ports).</span></span> |<span data-ttu-id="5f2ef-168">請嘗試儘可能使用連接埠範圍以避免需要多個規則。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-168">Try to use port ranges as much as possible to avoid the need for multiple rules.</span></span><br/><span data-ttu-id="5f2ef-169">多個連接埠或連接埠範圍不可使用逗號分組。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-169">Multiple ports or port ranges cannot be grouped by a comma.</span></span> |
| <span data-ttu-id="5f2ef-170">**來源位址首碼**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-170">**Source address prefix**</span></span> |<span data-ttu-id="5f2ef-171">規則要符合的來源位址首碼或標籤。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-171">Source address prefix or tag to match for the rule.</span></span> |<span data-ttu-id="5f2ef-172">單一 IP 位址 (例如：10.10.10.10)、IP 子網路 (例如：192.168.1.0/24)、[預設標籤](#default-tags)或 * (用於所有位址)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-172">Single IP address (example: 10.10.10.10), IP subnet (example: 192.168.1.0/24), [default tag](#default-tags), or * (for all addresses).</span></span> |<span data-ttu-id="5f2ef-173">考慮使用範圍、預設標籤和 * 以降低規則的數量。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-173">Consider using ranges, default tags, and * to reduce the number of rules.</span></span> |
| <span data-ttu-id="5f2ef-174">**Destination address prefix**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-174">**Destination address prefix**</span></span> |<span data-ttu-id="5f2ef-175">規則要符合的目的地位址首碼或標籤。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-175">Destination address prefix or tag to match for the rule.</span></span> | <span data-ttu-id="5f2ef-176">單一 IP 位址 (例如：10.10.10.10)、IP 子網路 (例如：192.168.1.0/24)、[預設標籤](#default-tags)或 * (用於所有位址)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-176">Single IP address (example: 10.10.10.10), IP subnet (example: 192.168.1.0/24), [default tag](#default-tags), or * (for all addresses).</span></span> |<span data-ttu-id="5f2ef-177">考慮使用範圍、預設標籤和 * 以降低規則的數量。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-177">Consider using ranges, default tags, and * to reduce the number of rules.</span></span> |
| <span data-ttu-id="5f2ef-178">**Direction**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-178">**Direction**</span></span> |<span data-ttu-id="5f2ef-179">規則要符合的流量方向。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-179">Direction of traffic to match for the rule.</span></span> |<span data-ttu-id="5f2ef-180">輸入或輸出。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-180">Inbound or outbound.</span></span> |<span data-ttu-id="5f2ef-181">輸入和輸出規則會根據方向分別處理。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-181">Inbound and outbound rules are processed separately, based on direction.</span></span> |
| <span data-ttu-id="5f2ef-182">**優先順序**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-182">**Priority**</span></span> |<span data-ttu-id="5f2ef-183">系統會依照規則優先順序檢查規則。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-183">Rules are checked in the order of priority.</span></span> <span data-ttu-id="5f2ef-184">一旦套用規則，就不會再測試規則是否符合。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-184">Once a rule applies, no more rules are tested for matching.</span></span> | <span data-ttu-id="5f2ef-185">100 和 4096 之間的數字。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-185">Number between 100 and 4096.</span></span> | <span data-ttu-id="5f2ef-186">考慮為每個規則建立 100 的跳躍優先順序，以保留空間給您未來可能建立的新規則。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-186">Consider creating rules jumping priorities by 100 for each rule to leave space for new rules you might create in the future.</span></span> |
| <span data-ttu-id="5f2ef-187">**Access**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-187">**Access**</span></span> |<span data-ttu-id="5f2ef-188">如果規則符合，要套用的存取類型。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-188">Type of access to apply if the rule matches.</span></span> | <span data-ttu-id="5f2ef-189">允許或拒絕。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-189">Allow or deny.</span></span> | <span data-ttu-id="5f2ef-190">請注意，如果找不到封包的允許規則，則會捨棄封包。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-190">Keep in mind that if an allow rule is not found for a packet, the packet is dropped.</span></span> |

<span data-ttu-id="5f2ef-191">NSG 包含兩組規則：輸入和輸出。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-191">NSGs contain two sets of rules: Inbound and outbound.</span></span> <span data-ttu-id="5f2ef-192">規則的優先順序在每一個集合中必須是唯一的。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-192">The priority for a rule must be unique within each set.</span></span> 

![NSG 規則處理](./media/virtual-network-nsg-overview/figure3.png) 

<span data-ttu-id="5f2ef-194">上圖顯示 NSG 規則的處理方式。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-194">The previous picture shows how NSG rules are processed.</span></span>

### <a name="default-tags"></a><span data-ttu-id="5f2ef-195">預設標籤</span><span class="sxs-lookup"><span data-stu-id="5f2ef-195">Default Tags</span></span>
<span data-ttu-id="5f2ef-196">預設標籤是系統提供的識別項，用來解決 IP 位址的類別。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-196">Default tags are system-provided identifiers to address a category of IP addresses.</span></span> <span data-ttu-id="5f2ef-197">您可以在任何規則的**來源位址首碼**和**目的地位址首碼**屬性使用預設標籤。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-197">You can use default tags in the **source address prefix** and **destination address prefix** properties of any rule.</span></span> <span data-ttu-id="5f2ef-198">有三個您可使用的預設標籤：</span><span class="sxs-lookup"><span data-stu-id="5f2ef-198">There are three default tags you can use:</span></span>

* <span data-ttu-id="5f2ef-199">**VirtualNetwork** (Resource Manager) (適用於傳統部署的 **VIRTUAL_NETWORK**)：這個標籤包含虛擬網路位址空間 (在 Azure 中定義的 CIDR 範圍)、所有已連線的內部部署位址空間以及已連線的 Azure VNet (區域網路)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-199">**VirtualNetwork** (Resource Manager) (**VIRTUAL_NETWORK** for classic): This tag includes the virtual network address space (CIDR ranges defined in Azure), all connected on-premises address spaces, and connected Azure VNets (local networks).</span></span>
* <span data-ttu-id="5f2ef-200">**AzureLoadBalancer** (Resource Manager) (適用於傳統部署的 **AZURE_LOADBALANCER**)：這個標籤代表 Azure 基礎結構的負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-200">**AzureLoadBalancer** (Resource Manager) (**AZURE_LOADBALANCER** for classic): This tag denotes Azure’s infrastructure load balancer.</span></span> <span data-ttu-id="5f2ef-201">此標籤會轉譯成做為 Azure 健康狀態探查來源的 Azure 資料中心 IP。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-201">The tag translates to an Azure datacenter IP where Azure’s health probes originate.</span></span>
* <span data-ttu-id="5f2ef-202">**Internet** (Resource Manager) (適用於傳統部署的 **INTERNET**)：這個標籤代表虛擬網路以外且可以透過公用網際網路進行存取的 IP 位址空間。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-202">**Internet** (Resource Manager) (**INTERNET** for classic): This tag denotes the IP address space that is outside the virtual network and reachable by public Internet.</span></span> <span data-ttu-id="5f2ef-203">此範圍也包括 [Azure 擁有的公用 IP 空間](https://www.microsoft.com/download/details.aspx?id=41653)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-203">The range includes the [Azure owned public IP space](https://www.microsoft.com/download/details.aspx?id=41653).</span></span>

### <a name="default-rules"></a><span data-ttu-id="5f2ef-204">預設規則</span><span class="sxs-lookup"><span data-stu-id="5f2ef-204">Default rules</span></span>
<span data-ttu-id="5f2ef-205">所有 NSG 都包含一組預設規則。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-205">All NSGs contain a set of default rules.</span></span> <span data-ttu-id="5f2ef-206">預設規則無法刪除，但因為其會指派為最低優先權，因此可以由您所建立的規則覆寫預設規則。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-206">The default rules cannot be deleted, but because they are assigned the lowest priority, they can be overridden by the rules that you create.</span></span> 

<span data-ttu-id="5f2ef-207">預設規則可允許及不允許流量，如下所示︰</span><span class="sxs-lookup"><span data-stu-id="5f2ef-207">The default rules allow and disallow traffic as follows:</span></span>
- <span data-ttu-id="5f2ef-208">虛擬網路中的流量起始和結束同時允許輸入和輸出方向。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-208">**Virtual network:** Traffic originating and ending in a virtual network is allowed both in inbound and outbound directions.</span></span>
- <span data-ttu-id="5f2ef-209">**網際網路︰**允許輸出流量，但會封鎖輸入流量。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-209">**Internet:** Outbound traffic is allowed, but inbound traffic is blocked.</span></span>
- <span data-ttu-id="5f2ef-210">**負載平衡器︰**允許 Azure 的負載平衡器探查 VM 和角色執行個體的健康狀態。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-210">**Load balancer:** Allow Azure’s load balancer to probe the health of your VMs and role instances.</span></span> <span data-ttu-id="5f2ef-211">如果您不使用負載平衡的集合，則可以覆寫此規則。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-211">If you are not using a load balanced set you can override this rule.</span></span>

<span data-ttu-id="5f2ef-212">**輸入預設規則**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-212">**Inbound default rules**</span></span>

| <span data-ttu-id="5f2ef-213">名稱</span><span class="sxs-lookup"><span data-stu-id="5f2ef-213">Name</span></span> | <span data-ttu-id="5f2ef-214">優先順序</span><span class="sxs-lookup"><span data-stu-id="5f2ef-214">Priority</span></span> | <span data-ttu-id="5f2ef-215">來源 IP</span><span class="sxs-lookup"><span data-stu-id="5f2ef-215">Source IP</span></span> | <span data-ttu-id="5f2ef-216">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-216">Source Port</span></span> | <span data-ttu-id="5f2ef-217">目的地 IP</span><span class="sxs-lookup"><span data-stu-id="5f2ef-217">Destination IP</span></span> | <span data-ttu-id="5f2ef-218">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-218">Destination Port</span></span> | <span data-ttu-id="5f2ef-219">通訊協定</span><span class="sxs-lookup"><span data-stu-id="5f2ef-219">Protocol</span></span> | <span data-ttu-id="5f2ef-220">Access</span><span class="sxs-lookup"><span data-stu-id="5f2ef-220">Access</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="5f2ef-221">AllowVNetInBound</span><span class="sxs-lookup"><span data-stu-id="5f2ef-221">AllowVNetInBound</span></span> |<span data-ttu-id="5f2ef-222">65000</span><span class="sxs-lookup"><span data-stu-id="5f2ef-222">65000</span></span> | <span data-ttu-id="5f2ef-223">VirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="5f2ef-223">VirtualNetwork</span></span> | * | <span data-ttu-id="5f2ef-224">VirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="5f2ef-224">VirtualNetwork</span></span> | * | * | <span data-ttu-id="5f2ef-225">允許</span><span class="sxs-lookup"><span data-stu-id="5f2ef-225">Allow</span></span> |
| <span data-ttu-id="5f2ef-226">AllowAzureLoadBalancerInBound</span><span class="sxs-lookup"><span data-stu-id="5f2ef-226">AllowAzureLoadBalancerInBound</span></span> | <span data-ttu-id="5f2ef-227">65001</span><span class="sxs-lookup"><span data-stu-id="5f2ef-227">65001</span></span> | <span data-ttu-id="5f2ef-228">AzureLoadBalancer</span><span class="sxs-lookup"><span data-stu-id="5f2ef-228">AzureLoadBalancer</span></span> | * | * | * | * | <span data-ttu-id="5f2ef-229">允許</span><span class="sxs-lookup"><span data-stu-id="5f2ef-229">Allow</span></span> |
| <span data-ttu-id="5f2ef-230">DenyAllInBound</span><span class="sxs-lookup"><span data-stu-id="5f2ef-230">DenyAllInBound</span></span> |<span data-ttu-id="5f2ef-231">65500</span><span class="sxs-lookup"><span data-stu-id="5f2ef-231">65500</span></span> | * | * | * | * | * | <span data-ttu-id="5f2ef-232">拒絕</span><span class="sxs-lookup"><span data-stu-id="5f2ef-232">Deny</span></span> |

<span data-ttu-id="5f2ef-233">**輸出預設規則**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-233">**Outbound default rules**</span></span>

| <span data-ttu-id="5f2ef-234">名稱</span><span class="sxs-lookup"><span data-stu-id="5f2ef-234">Name</span></span> | <span data-ttu-id="5f2ef-235">優先順序</span><span class="sxs-lookup"><span data-stu-id="5f2ef-235">Priority</span></span> | <span data-ttu-id="5f2ef-236">來源 IP</span><span class="sxs-lookup"><span data-stu-id="5f2ef-236">Source IP</span></span> | <span data-ttu-id="5f2ef-237">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-237">Source Port</span></span> | <span data-ttu-id="5f2ef-238">目的地 IP</span><span class="sxs-lookup"><span data-stu-id="5f2ef-238">Destination IP</span></span> | <span data-ttu-id="5f2ef-239">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-239">Destination Port</span></span> | <span data-ttu-id="5f2ef-240">通訊協定</span><span class="sxs-lookup"><span data-stu-id="5f2ef-240">Protocol</span></span> | <span data-ttu-id="5f2ef-241">Access</span><span class="sxs-lookup"><span data-stu-id="5f2ef-241">Access</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="5f2ef-242">AllowVnetOutBound</span><span class="sxs-lookup"><span data-stu-id="5f2ef-242">AllowVnetOutBound</span></span> | <span data-ttu-id="5f2ef-243">65000</span><span class="sxs-lookup"><span data-stu-id="5f2ef-243">65000</span></span> | <span data-ttu-id="5f2ef-244">VirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="5f2ef-244">VirtualNetwork</span></span> | * | <span data-ttu-id="5f2ef-245">VirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="5f2ef-245">VirtualNetwork</span></span> | * | * | <span data-ttu-id="5f2ef-246">允許</span><span class="sxs-lookup"><span data-stu-id="5f2ef-246">Allow</span></span> |
| <span data-ttu-id="5f2ef-247">AllowInternetOutBound</span><span class="sxs-lookup"><span data-stu-id="5f2ef-247">AllowInternetOutBound</span></span> | <span data-ttu-id="5f2ef-248">65001</span><span class="sxs-lookup"><span data-stu-id="5f2ef-248">65001</span></span> | * | * | <span data-ttu-id="5f2ef-249">Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-249">Internet</span></span> | * | * | <span data-ttu-id="5f2ef-250">允許</span><span class="sxs-lookup"><span data-stu-id="5f2ef-250">Allow</span></span> |
| <span data-ttu-id="5f2ef-251">DenyAllOutBound</span><span class="sxs-lookup"><span data-stu-id="5f2ef-251">DenyAllOutBound</span></span> | <span data-ttu-id="5f2ef-252">65500</span><span class="sxs-lookup"><span data-stu-id="5f2ef-252">65500</span></span> | * | * | * | * | * | <span data-ttu-id="5f2ef-253">拒絕</span><span class="sxs-lookup"><span data-stu-id="5f2ef-253">Deny</span></span> |

## <a name="associating-nsgs"></a><span data-ttu-id="5f2ef-254">建立 NSG 關聯</span><span class="sxs-lookup"><span data-stu-id="5f2ef-254">Associating NSGs</span></span>
<span data-ttu-id="5f2ef-255">視您使用的部署模型而定，您可以將 NSG 與 VM、NIC 和子網路建立關聯，如下所示：</span><span class="sxs-lookup"><span data-stu-id="5f2ef-255">You can associate an NSG to VMs, NICs, and subnets, depending on the deployment model you are using, as follows:</span></span>

* <span data-ttu-id="5f2ef-256">**VM (僅限傳統)：**安全性規則會套用至 VM 的所有流量 (雙向)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-256">**VM (classic only):** Security rules are applied to all traffic to/from the VM.</span></span> 
* <span data-ttu-id="5f2ef-257">**NIC (僅限 Resource Manager)：**安全性規則會套用至 NSG 相關聯之 NIC 的所有流量 (雙向)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-257">**NIC (Resource Manager only):** Security rules are applied to all traffic to/from the NIC the NSG is associated to.</span></span> <span data-ttu-id="5f2ef-258">在多重 NIC 的 VM 中，您可以將不同 (或相同) 的 NSG 個別套用至每個 NIC。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-258">In a multi-NIC VM, you can apply different (or the same) NSG to each NIC individually.</span></span> 
* <span data-ttu-id="5f2ef-259">**子網路 (Resource Manager 和傳統)：**安全性規則會套用至連線至 VNet 之任何資源的任何流量 (雙向)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-259">**Subnet (Resource Manager and classic):** Security rules are applied to any traffic to/from any resources connected to the VNet.</span></span>

<span data-ttu-id="5f2ef-260">您可以將不同的 NSG 與 VM (或 NIC，依部署模型而定) 進行關聯，也可與 NIC 或 VM 連線的子網域進行關聯。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-260">You can associate different NSGs to a VM (or NIC, depending on the deployment model) and the subnet that a NIC or VM is connected to.</span></span> <span data-ttu-id="5f2ef-261">安全性規則會依每個 NSG 中的優先順序，以下列順序套用到流量：</span><span class="sxs-lookup"><span data-stu-id="5f2ef-261">Security rules are applied to the traffic, by priority, in each NSG, in the following order:</span></span>

- <span data-ttu-id="5f2ef-262">**輸入流量**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-262">**Inbound traffic**</span></span>

  1. <span data-ttu-id="5f2ef-263">**NSG 套用至子網路：**如果子網路 NSG 有拒絕流量的相符規則，封包會遭到捨棄。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-263">**NSG applied to subnet:** If a subnet NSG has a matching rule to deny traffic, the packet is dropped.</span></span>

  2. <span data-ttu-id="5f2ef-264">**NSG 套用至 NIC** (Resource Manager) 或 VM (傳統)：如果 VM\NIC NSG 有拒絕流量的相符規則，封包會在 VM\NIC 遭到捨棄，即使子網路 NSG 有允許流量的相符規則。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-264">**NSG applied to NIC** (Resource Manager) or VM (classic): If VM\NIC NSG has a matching rule that denies traffic, packets are dropped at the VM\NIC, even if a subnet NSG has a matching rule that allows traffic.</span></span>

- <span data-ttu-id="5f2ef-265">**輸出流量**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-265">**Outbound traffic**</span></span>

  1. <span data-ttu-id="5f2ef-266">**NSG 套用至 NIC** (Resource Manager) 或 VM (傳統)：如果 VM\NIC NSG 有拒絕流量的相符規則，封包會遭到捨棄。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-266">**NSG applied to NIC** (Resource Manager) or VM (classic): If a VM\NIC NSG has a matching rule that denies traffic, packets are dropped.</span></span>

  2. <span data-ttu-id="5f2ef-267">**NSG 套用至子網路：**如果子網路 NSG 有拒絕流量的相符規則，封包會遭到捨棄，即使 VM\NIC NSG 有允許流量的相符規則。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-267">**NSG applied to subnet:** If a subnet NSG has a matching rule that denies traffic, packets are dropped, even if a VM\NIC NSG has a matching rule that allows traffic.</span></span>

> [!NOTE]
> <span data-ttu-id="5f2ef-268">雖然您只能將單一 NSG 與子網路、VM 或 NIC 建立關聯，但您可以盡量將同一個 NSG 與許多您想要的資源建立關聯。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-268">Although you can only associate a single NSG to a subnet, VM, or NIC; you can associate the same NSG to as many resources as you want.</span></span>
>

## <a name="implementation"></a><span data-ttu-id="5f2ef-269">實作</span><span class="sxs-lookup"><span data-stu-id="5f2ef-269">Implementation</span></span>
<span data-ttu-id="5f2ef-270">您可以使用下列工具，在 Resource Manager 或傳統部署模型中實作 NSG：</span><span class="sxs-lookup"><span data-stu-id="5f2ef-270">You can implement NSGs in the Resource Manager or classic deployment models using the following tools:</span></span>

| <span data-ttu-id="5f2ef-271">部署工具</span><span class="sxs-lookup"><span data-stu-id="5f2ef-271">Deployment tool</span></span> | <span data-ttu-id="5f2ef-272">傳統</span><span class="sxs-lookup"><span data-stu-id="5f2ef-272">Classic</span></span> | <span data-ttu-id="5f2ef-273">Resource Manager</span><span class="sxs-lookup"><span data-stu-id="5f2ef-273">Resource Manager</span></span> |
| --- | --- | --- |
| <span data-ttu-id="5f2ef-274">Azure 入口網站</span><span class="sxs-lookup"><span data-stu-id="5f2ef-274">Azure portal</span></span>   | <span data-ttu-id="5f2ef-275">是</span><span class="sxs-lookup"><span data-stu-id="5f2ef-275">Yes</span></span> | [<span data-ttu-id="5f2ef-276">是</span><span class="sxs-lookup"><span data-stu-id="5f2ef-276">Yes</span></span>](virtual-networks-create-nsg-arm-pportal.md) |
| <span data-ttu-id="5f2ef-277">PowerShell</span><span class="sxs-lookup"><span data-stu-id="5f2ef-277">PowerShell</span></span>     | [<span data-ttu-id="5f2ef-278">是</span><span class="sxs-lookup"><span data-stu-id="5f2ef-278">Yes</span></span>](virtual-networks-create-nsg-classic-ps.md) | [<span data-ttu-id="5f2ef-279">是</span><span class="sxs-lookup"><span data-stu-id="5f2ef-279">Yes</span></span>](virtual-networks-create-nsg-arm-ps.md) |
| <span data-ttu-id="5f2ef-280">Azure CLI **V1**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-280">Azure CLI **V1**</span></span>   | [<span data-ttu-id="5f2ef-281">是</span><span class="sxs-lookup"><span data-stu-id="5f2ef-281">Yes</span></span>](virtual-networks-create-nsg-classic-cli.md) | [<span data-ttu-id="5f2ef-282">是</span><span class="sxs-lookup"><span data-stu-id="5f2ef-282">Yes</span></span>](virtual-networks-create-nsg-cli-nodejs.md) |
| <span data-ttu-id="5f2ef-283">Azure CLI **V2**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-283">Azure CLI **V2**</span></span>   | <span data-ttu-id="5f2ef-284">否</span><span class="sxs-lookup"><span data-stu-id="5f2ef-284">No</span></span> | [<span data-ttu-id="5f2ef-285">是</span><span class="sxs-lookup"><span data-stu-id="5f2ef-285">Yes</span></span>](virtual-networks-create-nsg-arm-cli.md) |
| <span data-ttu-id="5f2ef-286">Azure Resource Manager 範本</span><span class="sxs-lookup"><span data-stu-id="5f2ef-286">Azure Resource Manager template</span></span>   | <span data-ttu-id="5f2ef-287">否</span><span class="sxs-lookup"><span data-stu-id="5f2ef-287">No</span></span>  | [<span data-ttu-id="5f2ef-288">是</span><span class="sxs-lookup"><span data-stu-id="5f2ef-288">Yes</span></span>](virtual-networks-create-nsg-arm-template.md) |

## <a name="planning"></a><span data-ttu-id="5f2ef-289">規劃</span><span class="sxs-lookup"><span data-stu-id="5f2ef-289">Planning</span></span>
<span data-ttu-id="5f2ef-290">實作 NSG 之前，您需要回答下列問題：</span><span class="sxs-lookup"><span data-stu-id="5f2ef-290">Before implementing NSGs, you need to answer the following questions:</span></span>

1. <span data-ttu-id="5f2ef-291">您要篩選何種資源類型的流量 (雙向)？</span><span class="sxs-lookup"><span data-stu-id="5f2ef-291">What types of resources do you want to filter traffic to or from?</span></span> <span data-ttu-id="5f2ef-292">您可以取得各種資源，例如 NIC (Resource Manager)、VM (傳統)、雲端服務、應用程式服務環境和 VM 擴展集。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-292">You can connect resources such as NICs (Resource Manager), VMs (classic), Cloud Services, Application Service Environments, and VM Scale Sets.</span></span> 
2. <span data-ttu-id="5f2ef-293">您想要篩選的資源流量是往返於連線至現有 VNet 中的子網路嗎？</span><span class="sxs-lookup"><span data-stu-id="5f2ef-293">Are the resources you want to filter traffic to/from connected to subnets in existing VNets?</span></span>

<span data-ttu-id="5f2ef-294">如需 Azure 中的網路安全性規劃的詳細資訊，請閱讀[雲端服務和網路安全性](../best-practices-network-security.md)一文。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-294">For more information on planning for network security in Azure, read the [Cloud services and network security](../best-practices-network-security.md) article.</span></span> 

## <a name="design-considerations"></a><span data-ttu-id="5f2ef-295">設計考量</span><span class="sxs-lookup"><span data-stu-id="5f2ef-295">Design considerations</span></span>
<span data-ttu-id="5f2ef-296">一旦您知道[規劃](#Planning)一節中問題的答案，在定義您的 NSG 之前，請檢閱下列章節：</span><span class="sxs-lookup"><span data-stu-id="5f2ef-296">Once you know the answers to the questions in the [Planning](#Planning) section, review the following sections before defining your NSGs:</span></span>

### <a name="limits"></a><span data-ttu-id="5f2ef-297">限制</span><span class="sxs-lookup"><span data-stu-id="5f2ef-297">Limits</span></span>
<span data-ttu-id="5f2ef-298">您可以在訂用帳戶中擁有的 NSG 數目和每個 NSG 的規則數目有一些限制。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-298">There are limits to the number of NSGs you can have in a subscription and number of rules per NSG.</span></span> <span data-ttu-id="5f2ef-299">若要深入了解限制，請參閱 [Azure 限制](../azure-subscription-service-limits.md#networking-limits)文章。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-299">To learn more about the limits, read the [Azure limits](../azure-subscription-service-limits.md#networking-limits) article.</span></span>

### <a name="vnet-and-subnet-design"></a><span data-ttu-id="5f2ef-300">VNet 和子網路的設計</span><span class="sxs-lookup"><span data-stu-id="5f2ef-300">VNet and subnet design</span></span>
<span data-ttu-id="5f2ef-301">由於 NSG 可以套用至子網路，依子網路群組您的資源並將 NSG 套用至子網路，即可減少 NSG 的數量。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-301">Since NSGs can be applied to subnets, you can minimize the number of NSGs by grouping your resources by subnet, and applying NSGs to subnets.</span></span>  <span data-ttu-id="5f2ef-302">如果您決定將 NSG 套用至子網路，可能會發現您擁有的現有 VNet 與子網路未使用 記憶中的 NSG 定義。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-302">If you decide to apply NSGs to subnets, you may find that existing VNets and subnets you have were not defined with NSGs in mind.</span></span> <span data-ttu-id="5f2ef-303">您可能需要定義新 VNet 和子網路以支援 NSG 設計，並將新資源部署至新的子網路。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-303">You may need to define new VNets and subnets to support your NSG design and deploy your new resources to your new subnets.</span></span> <span data-ttu-id="5f2ef-304">然後您就可以定義移轉策略，將現有的資源移至新的子網路。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-304">You could then define a migration strategy to move existing resources to the new subnets.</span></span> 

### <a name="special-rules"></a><span data-ttu-id="5f2ef-305">特殊規則</span><span class="sxs-lookup"><span data-stu-id="5f2ef-305">Special rules</span></span>
<span data-ttu-id="5f2ef-306">如果您封鎖這些規則允許的流量，您的基礎結構便無法與基本 Azure 服務進行通訊：</span><span class="sxs-lookup"><span data-stu-id="5f2ef-306">If you block traffic allowed by the following rules, your infrastructure can't communicate with essential Azure services:</span></span>

* <span data-ttu-id="5f2ef-307">**主機節點的虛擬 IP：** 基本的基礎結構服務，例如 DHCP、DNS 和健康狀態監控是透過虛擬化主機 IP 位址 168.63.129.16 所提供。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-307">**Virtual IP of the host node:** Basic infrastructure services such as DHCP, DNS, and health monitoring are provided through the virtualized host IP address 168.63.129.16.</span></span> <span data-ttu-id="5f2ef-308">這個公用 IP 位址屬於 Microsoft，而且是針對此目的唯一用於所有區域的虛擬 IP。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-308">This public IP address belongs to Microsoft and is the only virtualized IP address used in all regions for this purpose.</span></span> <span data-ttu-id="5f2ef-309">此 IP 位址會對應至伺服器電腦的實體 IP 位址 (主機節點)，該伺服器用來主控 VM。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-309">This IP address maps to the physical IP address of the server machine (host node) hosting the VM.</span></span> <span data-ttu-id="5f2ef-310">主機節點的作用如同 DHCP 轉送、DNS 遞迴解析程式，以及負載平衡器健康狀態探查和電腦健康狀態探查的探查來源。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-310">The host node acts as the DHCP relay, the DNS recursive resolver, and the probe source for the load balancer health probe and the machine health probe.</span></span> <span data-ttu-id="5f2ef-311">此 IP 位址的通訊並不是攻擊。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-311">Communication to this IP address is not an attack.</span></span>
* <span data-ttu-id="5f2ef-312">**授權 (金鑰管理服務)**：在 VM 中執行的 Windows 映像必須獲得授權。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-312">**Licensing (Key Management Service):** Windows images running in VMs must be licensed.</span></span> <span data-ttu-id="5f2ef-313">若要確保授權，授權要求會傳送至處理此類查詢的金鑰管理服務主機伺服器。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-313">To ensure licensing, a request is sent to the Key Management Service host servers that handle such queries.</span></span> <span data-ttu-id="5f2ef-314">此要求是透過連接埠 1688 輸出。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-314">The request is made outbound through port 1688.</span></span>

### <a name="icmp-traffic"></a><span data-ttu-id="5f2ef-315">ICMP 流量</span><span class="sxs-lookup"><span data-stu-id="5f2ef-315">ICMP traffic</span></span>
<span data-ttu-id="5f2ef-316">目前的 NSG 規則僅可用於通訊協定 TCP 或 UDP。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-316">The current NSG rules only allow for protocols *TCP* or *UDP*.</span></span> <span data-ttu-id="5f2ef-317">*ICMP*沒有特定的標記。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-317">There is not a specific tag for *ICMP*.</span></span> <span data-ttu-id="5f2ef-318">不過，系統會藉由 AllowVNetInBound 預設規則來允許 VNet 內的 ICMP 流量，該規則會允許 VNet 內任何連接埠和通訊協定的流量 (雙向)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-318">However, ICMP traffic is allowed within a VNet by the AllowVNetInBound default rule, that allows traffic to and from any port and protocol within the VNet.</span></span>

### <a name="subnets"></a><span data-ttu-id="5f2ef-319">子網路</span><span class="sxs-lookup"><span data-stu-id="5f2ef-319">Subnets</span></span>
* <span data-ttu-id="5f2ef-320">請考慮您的工作負載所需要的階層數目。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-320">Consider the number of tiers your workload requires.</span></span> <span data-ttu-id="5f2ef-321">每個層級可以使用子網路與套用至子網路的 NSG 來隔離。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-321">Each tier can be isolated by using a subnet, with an NSG applied to the subnet.</span></span> 
* <span data-ttu-id="5f2ef-322">如果您需要為 VPN 閘道或 ExpressRoute 線路實作子網路，請**不要**將 NSG 套用至該子網路。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-322">If you need to implement a subnet for a VPN gateway, or ExpressRoute circuit, do **not** apply an NSG to that subnet.</span></span> <span data-ttu-id="5f2ef-323">如果您這麼做，跨 VNet 或跨單位連線將會失敗。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-323">If you do so, cross-VNet or cross-premises connectivity may fail.</span></span> 
* <span data-ttu-id="5f2ef-324">如果您需要實作網路虛擬應用裝置 (NVA)，請將 NVA 與自己的子網路連線，並建立 NVA 的雙向使用者定義路由 (UDR)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-324">If you need to implement a network virtual appliance (NVA), connect the NVA to its own subnet and create user-defined routes (UDR) to and from the NVA.</span></span> <span data-ttu-id="5f2ef-325">您可以實作子網路層級 NSG，以篩選流入和流出此子網路的流量。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-325">You can implement a subnet level NSG to filter traffic in and out of this subnet.</span></span> <span data-ttu-id="5f2ef-326">若要深入了解 UDR，請閱讀[使用者定義的路由](virtual-networks-udr-overview.md)一文。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-326">To learn more about UDRs, read the [User-defined routes](virtual-networks-udr-overview.md) article.</span></span>

### <a name="load-balancers"></a><span data-ttu-id="5f2ef-327">負載平衡器</span><span class="sxs-lookup"><span data-stu-id="5f2ef-327">Load balancers</span></span>
* <span data-ttu-id="5f2ef-328">針對每個工作負載所使用的每個負載平衡器，考慮負載平衡和網路位址轉譯 (NAT) 規則。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-328">Consider the load balancing and network address translation (NAT) rules for each load balancer used by each of your workloads.</span></span> <span data-ttu-id="5f2ef-329">NAT 規則會繫結至包含 NIC (Resource Manager) 或 VM/雲端服務角色執行個體 (傳統) 的後端集區。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-329">NAT rules are bound to a back-end pool that contains NICs (Resource Manager) or VMs/Cloud Services role instances (classic).</span></span> <span data-ttu-id="5f2ef-330">請考慮為每個後端集區建立 NSG，僅允許透過負載平衡器中實作的規則對應的流量。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-330">Consider creating an NSG for each back-end pool, allowing only traffic mapped through the rules implemented in the load balancers.</span></span> <span data-ttu-id="5f2ef-331">為每個後端集區建立 NSG 可保證直接進入後端集區 (而不會透過負載平衡器) 傳遞的流量也會受到篩選。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-331">Creating an NSG for each back-end pool guarantees that traffic coming to the back-end pool directly (rather than through the load balancer), is also filtered.</span></span>
* <span data-ttu-id="5f2ef-332">在傳統部署中，您會建立端點，該端點可將負載平衡器上的連接埠對應至您的 VM 或角色執行個體上的連接埠。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-332">In classic deployments, you create endpoints that map ports on a load balancer to ports on your VMs or role instances.</span></span> <span data-ttu-id="5f2ef-333">您也可以透過 Resource Manager 建立自己個別對外公開的負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-333">You can also create your own individual public-facing load balancer through Resource Manager.</span></span> <span data-ttu-id="5f2ef-334">連入流量的目的地連接埠是 VM 或角色執行個體中的實際通訊埠，而不是負載平衡器所公開的連接埠。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-334">The destination port for incoming traffic is the actual port in the VM or role instance, not the port exposed by a load balancer.</span></span> <span data-ttu-id="5f2ef-335">連線至 VM 的來源連接埠和位址是在網際網路中遠端電腦上的連接埠和位址，而不是負載平衡器所公開的連接埠和位址。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-335">The source port and address for the connection to the VM is a port and address on the remote computer in the Internet, not the port and address exposed by the load balancer.</span></span>
* <span data-ttu-id="5f2ef-336">當您建立 NSG 來篩選透過內部負載平衡器 (ILB) 的流量時，套用的來源連接埠和位址範圍是來自原始電腦，而不是負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-336">When you create NSGs to filter traffic coming through an internal load balancer (ILB), the source port and address range applied are  from the originating computer, not the load balancer.</span></span> <span data-ttu-id="5f2ef-337">目的地連接埠和位址範圍屬於目的地電腦，而不是負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-337">The destination port and address range are those of the destination computer, not the load balancer.</span></span>

### <a name="other"></a><span data-ttu-id="5f2ef-338">其他</span><span class="sxs-lookup"><span data-stu-id="5f2ef-338">Other</span></span>
* <span data-ttu-id="5f2ef-339">不支援將端點式存取控制清單 (ACL) 和 NSG 用於相同的 VM 執行個體。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-339">Endpoint-based access control lists (ACL) and NSGs are not supported on the same VM instance.</span></span> <span data-ttu-id="5f2ef-340">如果您想要使用 NSG 且已經擁有就地端點 ACL，請先移除端點 ACL。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-340">If you want to use an NSG and have an endpoint ACL already in place, first remove the endpoint ACL.</span></span> <span data-ttu-id="5f2ef-341">如需如何移除端點 ACL 的詳細資訊，請參閱[管理端點 ACL](virtual-networks-acl-powershell.md)一文。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-341">For information about how to remove an endpoint ACL, see the [Manage endpoint ACLs](virtual-networks-acl-powershell.md) article.</span></span>
* <span data-ttu-id="5f2ef-342">在 Resource Manager 中，您可以對具有多個 NIC 的 VM 使用與 NIC 相關聯的 NSG，根據每個 NIC 啟用管理 (遠端存取)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-342">In Resource Manager, you can use an NSG associated to a NIC for VMs with multiple NICs to enable management (remote access) on a per NIC basis.</span></span> <span data-ttu-id="5f2ef-343">建立唯一 NSG 與每個 NIC 的關聯可以區隔所有 NIC 的流量類型。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-343">Associating unique NSGs to each NIC enables separation of traffic types across NICs.</span></span>
* <span data-ttu-id="5f2ef-344">與使用負載平衡器類似，篩選來自其他 VNet 的流量時，您必須使用遠端電腦的來源位址範圍，而不是連接 VNet 的閘道。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-344">Similar to the use of load balancers, when filtering traffic from other VNets, you must use the source address range of the remote computer, not the gateway connecting the VNets.</span></span>
* <span data-ttu-id="5f2ef-345">許多 Azure 服務無法連線至 VNet。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-345">Many Azure services cannot be connected to VNets.</span></span> <span data-ttu-id="5f2ef-346">如果 Azure 資源未連線至 VNet，您便無法使用 NSG 來篩選對資源的流量。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-346">If an Azure resource is not connected to a VNet, you cannot use an NSG to filter traffic to the resource.</span></span>  <span data-ttu-id="5f2ef-347">閱讀您所使用的服務文件，以判斷服務是否可以連線到 VNet。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-347">Read the documentation for the services you use to determine whether the service can be connected to a VNet.</span></span>

## <a name="sample-deployment"></a><span data-ttu-id="5f2ef-348">部署範例</span><span class="sxs-lookup"><span data-stu-id="5f2ef-348">Sample deployment</span></span>
<span data-ttu-id="5f2ef-349">為了說明本文中的資訊應用，請考慮下圖所示之雙層應用程式的常見案例：</span><span class="sxs-lookup"><span data-stu-id="5f2ef-349">To illustrate the application of the information in this article, consider a common scenario of a two tier application shown in the following picture:</span></span>

![NSG](./media/virtual-network-nsg-overview/figure1.png)

<span data-ttu-id="5f2ef-351">如圖表所示，Web1 和 Web2 VM 連線至 FrontEnd 子網路，而 DB1 和 DB2 VM 連線至 BackEnd 子網路。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-351">As shown in the diagram, the *Web1* and *Web2* VMs are connected to the *FrontEnd* subnet, and the *DB1* and *DB2* VMs are connected to the *BackEnd* subnet.</span></span>  <span data-ttu-id="5f2ef-352">這兩個子網路屬於 *TestVNet* VNet。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-352">Both subnets are part of the *TestVNet* VNet.</span></span> <span data-ttu-id="5f2ef-353">每個在 Azure VM 中執行的應用程式元件都會連線至 VNet。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-353">The application components each run within an Azure VM connected to a VNet.</span></span> <span data-ttu-id="5f2ef-354">此案例具有下列需求︰</span><span class="sxs-lookup"><span data-stu-id="5f2ef-354">The scenario has the following requirements:</span></span>

1. <span data-ttu-id="5f2ef-355">間隔 WEB 與 DB 伺服器之間的流量。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-355">Separation of traffic between the WEB and DB servers.</span></span>
2. <span data-ttu-id="5f2ef-356">負載平衡規則會將來自負載平衡器的流量轉送至所有 Web 伺服器的連接埠 80。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-356">Load balancing rules forward traffic from the load balancer to all web servers on port 80.</span></span>
3. <span data-ttu-id="5f2ef-357">負載平衡器 NAT 規則會將進入通訊埠 50001 上負載平衡器的流量轉送至 WEB1 VM 上的連接埠 3389。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-357">Load balancer NAT rules forward traffic coming into the load balancer on port 50001 to port 3389 on the WEB1 VM.</span></span>
4. <span data-ttu-id="5f2ef-358">無法從網際網路存取前端或後端 VM，但要求 2 和 3 除外。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-358">No access to the front-end or back-end VMs from the Internet, except requirements 2 and 3.</span></span>
5. <span data-ttu-id="5f2ef-359">沒有來自 WEB 或 DB 伺服器的輸出網際網路存取。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-359">No outbound Internet access from the WEB or DB servers.</span></span>
6. <span data-ttu-id="5f2ef-360">允許從前端子網路存取任何 Web 伺服器的連接埠 3389。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-360">Access from the FrontEnd subnet is allowed to port 3389 of any web server.</span></span>
7. <span data-ttu-id="5f2ef-361">允許從前端子網路存取任何 DB 伺服器的連接埠 3389。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-361">Access from the FrontEnd subnet is allowed to port 3389 of any DB server.</span></span>
8. <span data-ttu-id="5f2ef-362">允許從前端子網路存取所有 DB 伺服器的連接埠 1433。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-362">Access from the FrontEnd subnet is allowed to port 1433 of all DB servers.</span></span>
9. <span data-ttu-id="5f2ef-363">區隔 DB 伺服器中不同 NIC 上的管理流量 (連接埠 3389) 和資料庫流量 (1433)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-363">Separation of management traffic (port 3389) and database traffic (1433) on different NICs in DB servers.</span></span>

<span data-ttu-id="5f2ef-364">需求 1-6 (需求 3 和 4 除外) 均限制在子網路空間。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-364">Requirements 1-6 (except requirements 3 and 4) are all confined to subnet spaces.</span></span> <span data-ttu-id="5f2ef-365">下列 NSG 符合先前的需求，同時將所需的 NSG 數目降至最低︰</span><span class="sxs-lookup"><span data-stu-id="5f2ef-365">The following NSGs meet the previous requirements, while minimizing the number of NSGs required:</span></span>

### <a name="frontend"></a><span data-ttu-id="5f2ef-366">FrontEnd</span><span class="sxs-lookup"><span data-stu-id="5f2ef-366">FrontEnd</span></span>
<span data-ttu-id="5f2ef-367">**輸入規則**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-367">**Inbound rules**</span></span>

| <span data-ttu-id="5f2ef-368">規則</span><span class="sxs-lookup"><span data-stu-id="5f2ef-368">Rule</span></span> | <span data-ttu-id="5f2ef-369">Access</span><span class="sxs-lookup"><span data-stu-id="5f2ef-369">Access</span></span> | <span data-ttu-id="5f2ef-370">優先順序</span><span class="sxs-lookup"><span data-stu-id="5f2ef-370">Priority</span></span> | <span data-ttu-id="5f2ef-371">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-371">Source address range</span></span> | <span data-ttu-id="5f2ef-372">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-372">Source port</span></span> | <span data-ttu-id="5f2ef-373">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-373">Destination address range</span></span> | <span data-ttu-id="5f2ef-374">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-374">Destination port</span></span> | <span data-ttu-id="5f2ef-375">通訊協定</span><span class="sxs-lookup"><span data-stu-id="5f2ef-375">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="5f2ef-376">Allow-Inbound-HTTP-Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-376">Allow-Inbound-HTTP-Internet</span></span> | <span data-ttu-id="5f2ef-377">允許</span><span class="sxs-lookup"><span data-stu-id="5f2ef-377">Allow</span></span> | <span data-ttu-id="5f2ef-378">100</span><span class="sxs-lookup"><span data-stu-id="5f2ef-378">100</span></span> | <span data-ttu-id="5f2ef-379">Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-379">Internet</span></span> | * | * | <span data-ttu-id="5f2ef-380">80</span><span class="sxs-lookup"><span data-stu-id="5f2ef-380">80</span></span> | <span data-ttu-id="5f2ef-381">TCP</span><span class="sxs-lookup"><span data-stu-id="5f2ef-381">TCP</span></span> |
| <span data-ttu-id="5f2ef-382">Allow-Inbound-RDP-Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-382">Allow-Inbound-RDP-Internet</span></span> | <span data-ttu-id="5f2ef-383">允許</span><span class="sxs-lookup"><span data-stu-id="5f2ef-383">Allow</span></span> | <span data-ttu-id="5f2ef-384">200</span><span class="sxs-lookup"><span data-stu-id="5f2ef-384">200</span></span> | <span data-ttu-id="5f2ef-385">Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-385">Internet</span></span> | * | * | <span data-ttu-id="5f2ef-386">3389</span><span class="sxs-lookup"><span data-stu-id="5f2ef-386">3389</span></span> | <span data-ttu-id="5f2ef-387">TCP</span><span class="sxs-lookup"><span data-stu-id="5f2ef-387">TCP</span></span> |
| <span data-ttu-id="5f2ef-388">Deny-Inbound-All</span><span class="sxs-lookup"><span data-stu-id="5f2ef-388">Deny-Inbound-All</span></span> | <span data-ttu-id="5f2ef-389">拒絕</span><span class="sxs-lookup"><span data-stu-id="5f2ef-389">Deny</span></span> | <span data-ttu-id="5f2ef-390">300</span><span class="sxs-lookup"><span data-stu-id="5f2ef-390">300</span></span> | <span data-ttu-id="5f2ef-391">Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-391">Internet</span></span> | * | * | * | <span data-ttu-id="5f2ef-392">TCP</span><span class="sxs-lookup"><span data-stu-id="5f2ef-392">TCP</span></span> |

<span data-ttu-id="5f2ef-393">**輸出規則**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-393">**Outbound rules**</span></span>

| <span data-ttu-id="5f2ef-394">規則</span><span class="sxs-lookup"><span data-stu-id="5f2ef-394">Rule</span></span> | <span data-ttu-id="5f2ef-395">Access</span><span class="sxs-lookup"><span data-stu-id="5f2ef-395">Access</span></span> | <span data-ttu-id="5f2ef-396">優先順序</span><span class="sxs-lookup"><span data-stu-id="5f2ef-396">Priority</span></span> | <span data-ttu-id="5f2ef-397">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-397">Source address range</span></span> | <span data-ttu-id="5f2ef-398">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-398">Source port</span></span> | <span data-ttu-id="5f2ef-399">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-399">Destination address range</span></span> | <span data-ttu-id="5f2ef-400">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-400">Destination port</span></span> | <span data-ttu-id="5f2ef-401">通訊協定</span><span class="sxs-lookup"><span data-stu-id="5f2ef-401">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="5f2ef-402">Deny-Internet-All</span><span class="sxs-lookup"><span data-stu-id="5f2ef-402">Deny-Internet-All</span></span> |<span data-ttu-id="5f2ef-403">拒絕</span><span class="sxs-lookup"><span data-stu-id="5f2ef-403">Deny</span></span> |<span data-ttu-id="5f2ef-404">100</span><span class="sxs-lookup"><span data-stu-id="5f2ef-404">100</span></span> | * | * | <span data-ttu-id="5f2ef-405">Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-405">Internet</span></span> | * | * |

### <a name="backend"></a><span data-ttu-id="5f2ef-406">BackEnd</span><span class="sxs-lookup"><span data-stu-id="5f2ef-406">BackEnd</span></span>
<span data-ttu-id="5f2ef-407">**輸入規則**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-407">**Inbound rules**</span></span>

| <span data-ttu-id="5f2ef-408">規則</span><span class="sxs-lookup"><span data-stu-id="5f2ef-408">Rule</span></span> | <span data-ttu-id="5f2ef-409">Access</span><span class="sxs-lookup"><span data-stu-id="5f2ef-409">Access</span></span> | <span data-ttu-id="5f2ef-410">優先順序</span><span class="sxs-lookup"><span data-stu-id="5f2ef-410">Priority</span></span> | <span data-ttu-id="5f2ef-411">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-411">Source address range</span></span> | <span data-ttu-id="5f2ef-412">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-412">Source port</span></span> | <span data-ttu-id="5f2ef-413">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-413">Destination address range</span></span> | <span data-ttu-id="5f2ef-414">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-414">Destination port</span></span> | <span data-ttu-id="5f2ef-415">通訊協定</span><span class="sxs-lookup"><span data-stu-id="5f2ef-415">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="5f2ef-416">Deny-Internet-All</span><span class="sxs-lookup"><span data-stu-id="5f2ef-416">Deny-Internet-All</span></span> | <span data-ttu-id="5f2ef-417">拒絕</span><span class="sxs-lookup"><span data-stu-id="5f2ef-417">Deny</span></span> | <span data-ttu-id="5f2ef-418">100</span><span class="sxs-lookup"><span data-stu-id="5f2ef-418">100</span></span> | <span data-ttu-id="5f2ef-419">Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-419">Internet</span></span> | * | * | * | * |

<span data-ttu-id="5f2ef-420">**輸出規則**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-420">**Outbound rules**</span></span>

| <span data-ttu-id="5f2ef-421">規則</span><span class="sxs-lookup"><span data-stu-id="5f2ef-421">Rule</span></span> | <span data-ttu-id="5f2ef-422">Access</span><span class="sxs-lookup"><span data-stu-id="5f2ef-422">Access</span></span> | <span data-ttu-id="5f2ef-423">優先順序</span><span class="sxs-lookup"><span data-stu-id="5f2ef-423">Priority</span></span> | <span data-ttu-id="5f2ef-424">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-424">Source address range</span></span> | <span data-ttu-id="5f2ef-425">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-425">Source port</span></span> | <span data-ttu-id="5f2ef-426">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-426">Destination address range</span></span> | <span data-ttu-id="5f2ef-427">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-427">Destination port</span></span> | <span data-ttu-id="5f2ef-428">通訊協定</span><span class="sxs-lookup"><span data-stu-id="5f2ef-428">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="5f2ef-429">Deny-Internet-All</span><span class="sxs-lookup"><span data-stu-id="5f2ef-429">Deny-Internet-All</span></span> | <span data-ttu-id="5f2ef-430">拒絕</span><span class="sxs-lookup"><span data-stu-id="5f2ef-430">Deny</span></span> | <span data-ttu-id="5f2ef-431">100</span><span class="sxs-lookup"><span data-stu-id="5f2ef-431">100</span></span> | * | * | <span data-ttu-id="5f2ef-432">Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-432">Internet</span></span> | * | * |

<span data-ttu-id="5f2ef-433">建立下列 NSG 並與下列 VM 中的 NIC 產生關聯︰</span><span class="sxs-lookup"><span data-stu-id="5f2ef-433">The following NSGs are created and associated to NICs in the following VMs:</span></span>

### <a name="web1"></a><span data-ttu-id="5f2ef-434">WEB1</span><span class="sxs-lookup"><span data-stu-id="5f2ef-434">WEB1</span></span>
<span data-ttu-id="5f2ef-435">**輸入規則**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-435">**Inbound rules**</span></span>

| <span data-ttu-id="5f2ef-436">規則</span><span class="sxs-lookup"><span data-stu-id="5f2ef-436">Rule</span></span> | <span data-ttu-id="5f2ef-437">Access</span><span class="sxs-lookup"><span data-stu-id="5f2ef-437">Access</span></span> | <span data-ttu-id="5f2ef-438">優先順序</span><span class="sxs-lookup"><span data-stu-id="5f2ef-438">Priority</span></span> | <span data-ttu-id="5f2ef-439">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-439">Source address range</span></span> | <span data-ttu-id="5f2ef-440">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-440">Source port</span></span> | <span data-ttu-id="5f2ef-441">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-441">Destination address range</span></span> | <span data-ttu-id="5f2ef-442">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-442">Destination port</span></span> | <span data-ttu-id="5f2ef-443">通訊協定</span><span class="sxs-lookup"><span data-stu-id="5f2ef-443">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="5f2ef-444">Allow-Inbound-RDP-Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-444">Allow-Inbound-RDP-Internet</span></span> | <span data-ttu-id="5f2ef-445">允許</span><span class="sxs-lookup"><span data-stu-id="5f2ef-445">Allow</span></span> | <span data-ttu-id="5f2ef-446">100</span><span class="sxs-lookup"><span data-stu-id="5f2ef-446">100</span></span> | <span data-ttu-id="5f2ef-447">Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-447">Internet</span></span> | * | * | <span data-ttu-id="5f2ef-448">3389</span><span class="sxs-lookup"><span data-stu-id="5f2ef-448">3389</span></span> | <span data-ttu-id="5f2ef-449">TCP</span><span class="sxs-lookup"><span data-stu-id="5f2ef-449">TCP</span></span> |
| <span data-ttu-id="5f2ef-450">Allow-Inbound-HTTP-Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-450">Allow-Inbound-HTTP-Internet</span></span> | <span data-ttu-id="5f2ef-451">允許</span><span class="sxs-lookup"><span data-stu-id="5f2ef-451">Allow</span></span> | <span data-ttu-id="5f2ef-452">200</span><span class="sxs-lookup"><span data-stu-id="5f2ef-452">200</span></span> | <span data-ttu-id="5f2ef-453">Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-453">Internet</span></span> | * | * | <span data-ttu-id="5f2ef-454">80</span><span class="sxs-lookup"><span data-stu-id="5f2ef-454">80</span></span> | <span data-ttu-id="5f2ef-455">TCP</span><span class="sxs-lookup"><span data-stu-id="5f2ef-455">TCP</span></span> |

> [!NOTE]
> <span data-ttu-id="5f2ef-456">前一個規則的來源位址範圍是**網際網路**，而不是負載平衡器的虛擬 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-456">The source address range for the previous rules is **Internet**, not the virtual IP address of for the load balancer.</span></span> <span data-ttu-id="5f2ef-457">來源連接埠是 *，而不是 500001。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-457">The source port is *, not 500001.</span></span> <span data-ttu-id="5f2ef-458">負載平衡器的 NAT 規則與 NSG 全性規則不同。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-458">NAT rules for load balancers are not the same as NSG security rules.</span></span> <span data-ttu-id="5f2ef-459">NSG 安全性規則永遠與流量的原始來源和最終目的地相關，而**不是**兩者之間的負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-459">NSG security rules are always related to the original source and final destination of traffic, **not** the load balancer between the two.</span></span> 
> 
> 

### <a name="web2"></a><span data-ttu-id="5f2ef-460">WEB2</span><span class="sxs-lookup"><span data-stu-id="5f2ef-460">WEB2</span></span>
<span data-ttu-id="5f2ef-461">**輸入規則**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-461">**Inbound rules**</span></span>

| <span data-ttu-id="5f2ef-462">規則</span><span class="sxs-lookup"><span data-stu-id="5f2ef-462">Rule</span></span> | <span data-ttu-id="5f2ef-463">Access</span><span class="sxs-lookup"><span data-stu-id="5f2ef-463">Access</span></span> | <span data-ttu-id="5f2ef-464">優先順序</span><span class="sxs-lookup"><span data-stu-id="5f2ef-464">Priority</span></span> | <span data-ttu-id="5f2ef-465">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-465">Source address range</span></span> | <span data-ttu-id="5f2ef-466">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-466">Source port</span></span> | <span data-ttu-id="5f2ef-467">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-467">Destination address range</span></span> | <span data-ttu-id="5f2ef-468">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-468">Destination port</span></span> | <span data-ttu-id="5f2ef-469">通訊協定</span><span class="sxs-lookup"><span data-stu-id="5f2ef-469">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="5f2ef-470">Deny-Inbound-RDP-Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-470">Deny-Inbound-RDP-Internet</span></span> | <span data-ttu-id="5f2ef-471">拒絕</span><span class="sxs-lookup"><span data-stu-id="5f2ef-471">Deny</span></span> | <span data-ttu-id="5f2ef-472">100</span><span class="sxs-lookup"><span data-stu-id="5f2ef-472">100</span></span> | <span data-ttu-id="5f2ef-473">Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-473">Internet</span></span> | * | * | <span data-ttu-id="5f2ef-474">3389</span><span class="sxs-lookup"><span data-stu-id="5f2ef-474">3389</span></span> | <span data-ttu-id="5f2ef-475">TCP</span><span class="sxs-lookup"><span data-stu-id="5f2ef-475">TCP</span></span> |
| <span data-ttu-id="5f2ef-476">Allow-Inbound-HTTP-Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-476">Allow-Inbound-HTTP-Internet</span></span> | <span data-ttu-id="5f2ef-477">允許</span><span class="sxs-lookup"><span data-stu-id="5f2ef-477">Allow</span></span> | <span data-ttu-id="5f2ef-478">200</span><span class="sxs-lookup"><span data-stu-id="5f2ef-478">200</span></span> | <span data-ttu-id="5f2ef-479">Internet</span><span class="sxs-lookup"><span data-stu-id="5f2ef-479">Internet</span></span> | * | * | <span data-ttu-id="5f2ef-480">80</span><span class="sxs-lookup"><span data-stu-id="5f2ef-480">80</span></span> | <span data-ttu-id="5f2ef-481">TCP</span><span class="sxs-lookup"><span data-stu-id="5f2ef-481">TCP</span></span> |

### <a name="db-servers-management-nic"></a><span data-ttu-id="5f2ef-482">DB 伺服器 (管理 NIC)</span><span class="sxs-lookup"><span data-stu-id="5f2ef-482">DB servers (Management NIC)</span></span>
<span data-ttu-id="5f2ef-483">**輸入規則**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-483">**Inbound rules**</span></span>

| <span data-ttu-id="5f2ef-484">規則</span><span class="sxs-lookup"><span data-stu-id="5f2ef-484">Rule</span></span> | <span data-ttu-id="5f2ef-485">Access</span><span class="sxs-lookup"><span data-stu-id="5f2ef-485">Access</span></span> | <span data-ttu-id="5f2ef-486">優先順序</span><span class="sxs-lookup"><span data-stu-id="5f2ef-486">Priority</span></span> | <span data-ttu-id="5f2ef-487">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-487">Source address range</span></span> | <span data-ttu-id="5f2ef-488">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-488">Source port</span></span> | <span data-ttu-id="5f2ef-489">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-489">Destination address range</span></span> | <span data-ttu-id="5f2ef-490">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-490">Destination port</span></span> | <span data-ttu-id="5f2ef-491">通訊協定</span><span class="sxs-lookup"><span data-stu-id="5f2ef-491">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="5f2ef-492">Allow-Inbound-RDP-Front-end</span><span class="sxs-lookup"><span data-stu-id="5f2ef-492">Allow-Inbound-RDP-Front-end</span></span> | <span data-ttu-id="5f2ef-493">允許</span><span class="sxs-lookup"><span data-stu-id="5f2ef-493">Allow</span></span> | <span data-ttu-id="5f2ef-494">100</span><span class="sxs-lookup"><span data-stu-id="5f2ef-494">100</span></span> | <span data-ttu-id="5f2ef-495">192.168.1.0/24</span><span class="sxs-lookup"><span data-stu-id="5f2ef-495">192.168.1.0/24</span></span> | * | * | <span data-ttu-id="5f2ef-496">3389</span><span class="sxs-lookup"><span data-stu-id="5f2ef-496">3389</span></span> | <span data-ttu-id="5f2ef-497">TCP</span><span class="sxs-lookup"><span data-stu-id="5f2ef-497">TCP</span></span> |

### <a name="db-servers-database-traffic-nic"></a><span data-ttu-id="5f2ef-498">DB 伺服器 (資料庫流量 NIC)</span><span class="sxs-lookup"><span data-stu-id="5f2ef-498">DB servers (Database traffic NIC)</span></span>
<span data-ttu-id="5f2ef-499">**輸入規則**</span><span class="sxs-lookup"><span data-stu-id="5f2ef-499">**Inbound rules**</span></span>

| <span data-ttu-id="5f2ef-500">規則</span><span class="sxs-lookup"><span data-stu-id="5f2ef-500">Rule</span></span> | <span data-ttu-id="5f2ef-501">Access</span><span class="sxs-lookup"><span data-stu-id="5f2ef-501">Access</span></span> | <span data-ttu-id="5f2ef-502">優先順序</span><span class="sxs-lookup"><span data-stu-id="5f2ef-502">Priority</span></span> | <span data-ttu-id="5f2ef-503">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-503">Source address range</span></span> | <span data-ttu-id="5f2ef-504">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-504">Source port</span></span> | <span data-ttu-id="5f2ef-505">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="5f2ef-505">Destination address range</span></span> | <span data-ttu-id="5f2ef-506">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="5f2ef-506">Destination port</span></span> | <span data-ttu-id="5f2ef-507">通訊協定</span><span class="sxs-lookup"><span data-stu-id="5f2ef-507">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="5f2ef-508">Allow-Inbound-SQL-Front-end</span><span class="sxs-lookup"><span data-stu-id="5f2ef-508">Allow-Inbound-SQL-Front-end</span></span> | <span data-ttu-id="5f2ef-509">允許</span><span class="sxs-lookup"><span data-stu-id="5f2ef-509">Allow</span></span> | <span data-ttu-id="5f2ef-510">100</span><span class="sxs-lookup"><span data-stu-id="5f2ef-510">100</span></span> | <span data-ttu-id="5f2ef-511">192.168.1.0/24</span><span class="sxs-lookup"><span data-stu-id="5f2ef-511">192.168.1.0/24</span></span> | * | * | <span data-ttu-id="5f2ef-512">1433</span><span class="sxs-lookup"><span data-stu-id="5f2ef-512">1433</span></span> | <span data-ttu-id="5f2ef-513">TCP</span><span class="sxs-lookup"><span data-stu-id="5f2ef-513">TCP</span></span> |

<span data-ttu-id="5f2ef-514">因為某些 NSG 與個別的 NIC 關聯，所以這些規則適用於透過 Resource Manager 部署的資源。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-514">Since some of the NSGs are associated to individual NICs, the rules are for resources deployed through Resource Manager.</span></span> <span data-ttu-id="5f2ef-515">視子網路與 NIC 的關聯方式而定，會結合兩者的規則。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-515">Rules are combined for subnet and NIC, depending on how they are associated.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="5f2ef-516">後續步驟</span><span class="sxs-lookup"><span data-stu-id="5f2ef-516">Next steps</span></span>
* <span data-ttu-id="5f2ef-517">[部署 NSG (Resource Manager)](virtual-networks-create-nsg-arm-pportal.md)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-517">[Deploy NSGs (Resource Manager)](virtual-networks-create-nsg-arm-pportal.md).</span></span>
* <span data-ttu-id="5f2ef-518">[部署 NSG (傳統)](virtual-networks-create-nsg-classic-ps.md).</span><span class="sxs-lookup"><span data-stu-id="5f2ef-518">[Deploy NSGs (classic)](virtual-networks-create-nsg-classic-ps.md).</span></span>
* <span data-ttu-id="5f2ef-519">[管理 NSG 記錄檔](virtual-network-nsg-manage-log.md)。</span><span class="sxs-lookup"><span data-stu-id="5f2ef-519">[Manage NSG logs](virtual-network-nsg-manage-log.md).</span></span>
* <span data-ttu-id="5f2ef-520">[針對 NSG 進行疑難排解] (virtual-network-nsg-troubleshoot-portal.md)</span><span class="sxs-lookup"><span data-stu-id="5f2ef-520">[Troubleshoot NSGs] (virtual-network-nsg-troubleshoot-portal.md)</span></span>
