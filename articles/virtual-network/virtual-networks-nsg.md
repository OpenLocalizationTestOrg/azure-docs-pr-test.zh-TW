---
title: "在 Azure 中的 aaaNetwork 安全性群組 |Microsoft 文件"
description: "了解如何 tooisolate 和控制流量虛擬網路使用網路安全性群組在 Azure 中使用分散式的 hello 防火牆內。"
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: 20e850fc-6456-4b5f-9a3f-a8379b052bc9
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/11/2016
ms.author: jdial
ms.openlocfilehash: 3528ce833dab17977327c3c9ae0e78316e5e6a05
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="filter-network-traffic-with-network-security-groups"></a><span data-ttu-id="cfa91-103">使用網路安全性群組來篩選網路流量</span><span class="sxs-lookup"><span data-stu-id="cfa91-103">Filter network traffic with network security groups</span></span>

<span data-ttu-id="cfa91-104">網路安全性群組 (NSG) 包含可允許或拒絕網路流量 tooresources 連接 tooAzure 虛擬網路 (VNet) 安全性規則的清單。</span><span class="sxs-lookup"><span data-stu-id="cfa91-104">A network security group (NSG) contains a list of security rules that allow or deny network traffic tooresources connected tooAzure Virtual Networks (VNet).</span></span> <span data-ttu-id="cfa91-105">Nsg 可以是相關聯的 toosubnets，個別 Vm （傳統），或個別的網路介面 (NIC) 附加 tooVMs （資源管理員）。</span><span class="sxs-lookup"><span data-stu-id="cfa91-105">NSGs can be associated toosubnets, individual VMs (classic), or individual network interfaces (NIC) attached tooVMs (Resource Manager).</span></span> <span data-ttu-id="cfa91-106">當 NSG 相關聯的 tooa 子網路，hello 規則適用於 tooall 資源連線的 toohello 子網路。</span><span class="sxs-lookup"><span data-stu-id="cfa91-106">When an NSG is associated tooa subnet, hello rules apply tooall resources connected toohello subnet.</span></span> <span data-ttu-id="cfa91-107">流量可以進一步限制也關聯 NSG tooa VM 或 nic。</span><span class="sxs-lookup"><span data-stu-id="cfa91-107">Traffic can further be restricted by also associating an NSG tooa VM or NIC.</span></span>

> [!NOTE]
> <span data-ttu-id="cfa91-108">Azure 建立和處理資源的部署模型有二種：[Resource Manager 和傳統](../resource-manager-deployment-model.md)。</span><span class="sxs-lookup"><span data-stu-id="cfa91-108">Azure has two different deployment models for creating and working with resources:  [Resource Manager and classic](../resource-manager-deployment-model.md).</span></span> <span data-ttu-id="cfa91-109">本文將說明如何使用這兩個模型，但 Microsoft 建議的最新的部署使用 hello 資源管理員的模型。</span><span class="sxs-lookup"><span data-stu-id="cfa91-109">This article covers using both models, but Microsoft recommends that most new deployments use hello Resource Manager model.</span></span>

## <a name="nsg-resource"></a><span data-ttu-id="cfa91-110">NSG 資源</span><span class="sxs-lookup"><span data-stu-id="cfa91-110">NSG resource</span></span>
<span data-ttu-id="cfa91-111">Nsg 包含下列屬性的 hello:</span><span class="sxs-lookup"><span data-stu-id="cfa91-111">NSGs contain hello following properties:</span></span>

| <span data-ttu-id="cfa91-112">屬性</span><span class="sxs-lookup"><span data-stu-id="cfa91-112">Property</span></span> | <span data-ttu-id="cfa91-113">說明</span><span class="sxs-lookup"><span data-stu-id="cfa91-113">Description</span></span> | <span data-ttu-id="cfa91-114">條件約束</span><span class="sxs-lookup"><span data-stu-id="cfa91-114">Constraints</span></span> | <span data-ttu-id="cfa91-115">考量</span><span class="sxs-lookup"><span data-stu-id="cfa91-115">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="cfa91-116">名稱</span><span class="sxs-lookup"><span data-stu-id="cfa91-116">Name</span></span> |<span data-ttu-id="cfa91-117">Hello NSG 的名稱</span><span class="sxs-lookup"><span data-stu-id="cfa91-117">Name for hello NSG</span></span> |<span data-ttu-id="cfa91-118">必須是唯一 hello 區域內。</span><span class="sxs-lookup"><span data-stu-id="cfa91-118">Must be unique within hello region.</span></span><br/><span data-ttu-id="cfa91-119">可以包含字母、數字、底線、句號和連字號。</span><span class="sxs-lookup"><span data-stu-id="cfa91-119">Can contain letters, numbers, underscores, periods, and hyphens.</span></span><br/><span data-ttu-id="cfa91-120">必須以字母或數字開頭。</span><span class="sxs-lookup"><span data-stu-id="cfa91-120">Must start with a letter or number.</span></span><br/><span data-ttu-id="cfa91-121">必須以字母、數字或底線結尾。</span><span class="sxs-lookup"><span data-stu-id="cfa91-121">Must end with a letter, number, or underscore.</span></span><br/><span data-ttu-id="cfa91-122">不能超過 80 個字元。</span><span class="sxs-lookup"><span data-stu-id="cfa91-122">Cannot exceed 80 characters.</span></span> |<span data-ttu-id="cfa91-123">因為您可能需要數個 Nsg toocreate，請確定您擁有可讓您 Nsg 輕鬆 tooidentify hello 函式命名慣例。</span><span class="sxs-lookup"><span data-stu-id="cfa91-123">Since you may need toocreate several NSGs, make sure you have a naming convention that makes it easy tooidentify hello function of your NSGs.</span></span> |
| <span data-ttu-id="cfa91-124">區域</span><span class="sxs-lookup"><span data-stu-id="cfa91-124">Region</span></span> |<span data-ttu-id="cfa91-125">Azure[區域](https://azure.microsoft.com/regions)hello NSG 建立的位置。</span><span class="sxs-lookup"><span data-stu-id="cfa91-125">Azure [region](https://azure.microsoft.com/regions) where hello NSG is created.</span></span> |<span data-ttu-id="cfa91-126">Nsg 只能是關聯的 tooresources 內 hello hello NSG 與相同的區域。</span><span class="sxs-lookup"><span data-stu-id="cfa91-126">NSGs can only be associated tooresources within hello same region as hello NSG.</span></span> |<span data-ttu-id="cfa91-127">每個區域，可以有多少 Nsg 相關 toolearn 讀取 hello [Azure 限制](../azure-subscription-service-limits.md#virtual-networking-limits-classic)發行項。</span><span class="sxs-lookup"><span data-stu-id="cfa91-127">toolearn about how many NSGs you can have per region, read hello [Azure limits](../azure-subscription-service-limits.md#virtual-networking-limits-classic) article.</span></span>|
| <span data-ttu-id="cfa91-128">資源群組</span><span class="sxs-lookup"><span data-stu-id="cfa91-128">Resource group</span></span> |<span data-ttu-id="cfa91-129">hello[資源群組](../azure-resource-manager/resource-group-overview.md#resource-groups)NSG 存在於 hello。</span><span class="sxs-lookup"><span data-stu-id="cfa91-129">hello [resource group](../azure-resource-manager/resource-group-overview.md#resource-groups) hello NSG exists in.</span></span> |<span data-ttu-id="cfa91-130">雖然 NSG 存在於資源群組中，可能很關聯的 tooresources 在資源群組中，只要 hello 資源屬於 hello 與 hello NSG 的相同 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="cfa91-130">Although an NSG exists in a resource group, it can be associated tooresources in any resource group, as long as hello resource is part of hello same Azure region as hello NSG.</span></span> |<span data-ttu-id="cfa91-131">資源群組在一起，因為部署單位的多個資源都使用的 toomanage。</span><span class="sxs-lookup"><span data-stu-id="cfa91-131">Resource groups are used toomanage multiple resources together, as a deployment unit.</span></span><br/><span data-ttu-id="cfa91-132">您可以考慮分組 hello NSG 與它相關聯的資源。</span><span class="sxs-lookup"><span data-stu-id="cfa91-132">You may consider grouping hello NSG with resources it is associated to.</span></span> |
| <span data-ttu-id="cfa91-133">規則</span><span class="sxs-lookup"><span data-stu-id="cfa91-133">Rules</span></span> |<span data-ttu-id="cfa91-134">定義允許或拒絕流量的輸入或輸出規則。</span><span class="sxs-lookup"><span data-stu-id="cfa91-134">Inbound or outbound rules that define what traffic is allowed or denied.</span></span> | |<span data-ttu-id="cfa91-135">請參閱 hello [NSG 規則](#Nsg-rules)本文一節。</span><span class="sxs-lookup"><span data-stu-id="cfa91-135">See hello [NSG rules](#Nsg-rules) section of this article.</span></span> |

> [!NOTE]
> <span data-ttu-id="cfa91-136">以端點為基礎的 Acl 和網路安全性上不支援群組 hello 相同的 VM 執行個體。</span><span class="sxs-lookup"><span data-stu-id="cfa91-136">Endpoint-based ACLs and network security groups are not supported on hello same VM instance.</span></span> <span data-ttu-id="cfa91-137">如果您想 toouse NSG，且已備妥端點 ACL，請先移除 hello 端點 ACL。</span><span class="sxs-lookup"><span data-stu-id="cfa91-137">If you want toouse an NSG and have an endpoint ACL already in place, first remove hello endpoint ACL.</span></span> <span data-ttu-id="cfa91-138">toolearn tooremove ACL，如何讀取 hello[管理存取控制清單 (Acl) 的 PowerShell，透過端點](virtual-networks-acl-powershell.md)發行項。</span><span class="sxs-lookup"><span data-stu-id="cfa91-138">toolearn how tooremove an ACL, read hello [Managing Access Control Lists (ACLs) for Endpoints by using PowerShell](virtual-networks-acl-powershell.md) article.</span></span>
> 

### <a name="nsg-rules"></a><span data-ttu-id="cfa91-139">NSG 規則</span><span class="sxs-lookup"><span data-stu-id="cfa91-139">NSG rules</span></span>
<span data-ttu-id="cfa91-140">NSG 規則包含下列屬性的 hello:</span><span class="sxs-lookup"><span data-stu-id="cfa91-140">NSG rules contain hello following properties:</span></span>

| <span data-ttu-id="cfa91-141">屬性</span><span class="sxs-lookup"><span data-stu-id="cfa91-141">Property</span></span> | <span data-ttu-id="cfa91-142">說明</span><span class="sxs-lookup"><span data-stu-id="cfa91-142">Description</span></span> | <span data-ttu-id="cfa91-143">條件約束</span><span class="sxs-lookup"><span data-stu-id="cfa91-143">Constraints</span></span> | <span data-ttu-id="cfa91-144">考量</span><span class="sxs-lookup"><span data-stu-id="cfa91-144">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="cfa91-145">**名稱**</span><span class="sxs-lookup"><span data-stu-id="cfa91-145">**Name**</span></span> |<span data-ttu-id="cfa91-146">Hello 規則的名稱。</span><span class="sxs-lookup"><span data-stu-id="cfa91-146">Name for hello rule.</span></span> |<span data-ttu-id="cfa91-147">必須是唯一 hello 區域內。</span><span class="sxs-lookup"><span data-stu-id="cfa91-147">Must be unique within hello region.</span></span><br/><span data-ttu-id="cfa91-148">可以包含字母、數字、底線、句號和連字號。</span><span class="sxs-lookup"><span data-stu-id="cfa91-148">Can contain letters, numbers, underscores, periods, and hyphens.</span></span><br/><span data-ttu-id="cfa91-149">必須以字母或數字開頭。</span><span class="sxs-lookup"><span data-stu-id="cfa91-149">Must start with a letter or number.</span></span><br/><span data-ttu-id="cfa91-150">必須以字母、數字或底線結尾。</span><span class="sxs-lookup"><span data-stu-id="cfa91-150">Must end with a letter, number, or underscore.</span></span><br/><span data-ttu-id="cfa91-151">不能超過 80 個字元。</span><span class="sxs-lookup"><span data-stu-id="cfa91-151">Cannot exceed 80 characters.</span></span> |<span data-ttu-id="cfa91-152">您可能有數個 NSG 中的規則，因此請確定您遵循命名慣例，可讓您 tooidentify hello 函式的規則。</span><span class="sxs-lookup"><span data-stu-id="cfa91-152">You may have several rules within an NSG, so make sure you follow a naming convention that allows you tooidentify hello function of your rule.</span></span> |
| <span data-ttu-id="cfa91-153">**通訊協定**</span><span class="sxs-lookup"><span data-stu-id="cfa91-153">**Protocol**</span></span> |<span data-ttu-id="cfa91-154">通訊協定 toomatch hello 規則。</span><span class="sxs-lookup"><span data-stu-id="cfa91-154">Protocol toomatch for hello rule.</span></span> |<span data-ttu-id="cfa91-155">TCP、UDP 或 *</span><span class="sxs-lookup"><span data-stu-id="cfa91-155">TCP, UDP, or *</span></span> |<span data-ttu-id="cfa91-156">使用 * 因為通訊協定包含 ICMP （東西流量），做為以及 UDP 和 TCP，而且可能會減少您需要的規則的 hello 數目。</span><span class="sxs-lookup"><span data-stu-id="cfa91-156">Using * as a protocol includes ICMP (East-West traffic only), as well as UDP and TCP, and may reduce hello number of rules you need.</span></span><br/><span data-ttu-id="cfa91-157">在 hello 相同時，使用 * 可能是過於廣泛的方法，因此建議您使用 * 只在必要時。</span><span class="sxs-lookup"><span data-stu-id="cfa91-157">At hello same time, using * might be too broad an approach, so it's recommended that you use * only when necessary.</span></span> |
| <span data-ttu-id="cfa91-158">**來源連接埠範圍**</span><span class="sxs-lookup"><span data-stu-id="cfa91-158">**Source port range**</span></span> |<span data-ttu-id="cfa91-159">來源連接埠範圍 toomatch hello 規則。</span><span class="sxs-lookup"><span data-stu-id="cfa91-159">Source port range toomatch for hello rule.</span></span> |<span data-ttu-id="cfa91-160">單一連接埠號碼從 1 too65535，連接埠範圍 (範例： 1-65535)，或 * （適用於所有連接埠）。</span><span class="sxs-lookup"><span data-stu-id="cfa91-160">Single port number from 1 too65535, port range (example: 1-65535), or * (for all ports).</span></span> |<span data-ttu-id="cfa91-161">來源連接埠可以是暫時的。</span><span class="sxs-lookup"><span data-stu-id="cfa91-161">Source ports could be ephemeral.</span></span> <span data-ttu-id="cfa91-162">除非您的用戶端程式是使用特定連接埠，否則在大部分情況下請使用 *。</span><span class="sxs-lookup"><span data-stu-id="cfa91-162">Unless your client program is using a specific port, use * in most cases.</span></span><br/><span data-ttu-id="cfa91-163">儘可能 tooavoid hello 需要多個規則，再試一次 toouse 連接埠範圍。</span><span class="sxs-lookup"><span data-stu-id="cfa91-163">Try toouse port ranges as much as possible tooavoid hello need for multiple rules.</span></span><br/><span data-ttu-id="cfa91-164">多個連接埠或連接埠範圍不可使用逗號分組。</span><span class="sxs-lookup"><span data-stu-id="cfa91-164">Multiple ports or port ranges cannot be grouped by a comma.</span></span> |
| <span data-ttu-id="cfa91-165">**目的地連接埠範圍**</span><span class="sxs-lookup"><span data-stu-id="cfa91-165">**Destination port range**</span></span> |<span data-ttu-id="cfa91-166">目的地連接埠範圍 toomatch hello 規則。</span><span class="sxs-lookup"><span data-stu-id="cfa91-166">Destination port range toomatch for hello rule.</span></span> |<span data-ttu-id="cfa91-167">單一連接埠號碼從 1 too65535，連接埠範圍 (範例： 1-65535)，或\*（適用於所有連接埠）。</span><span class="sxs-lookup"><span data-stu-id="cfa91-167">Single port number from 1 too65535, port range (example: 1-65535), or \* (for all ports).</span></span> |<span data-ttu-id="cfa91-168">儘可能 tooavoid hello 需要多個規則，再試一次 toouse 連接埠範圍。</span><span class="sxs-lookup"><span data-stu-id="cfa91-168">Try toouse port ranges as much as possible tooavoid hello need for multiple rules.</span></span><br/><span data-ttu-id="cfa91-169">多個連接埠或連接埠範圍不可使用逗號分組。</span><span class="sxs-lookup"><span data-stu-id="cfa91-169">Multiple ports or port ranges cannot be grouped by a comma.</span></span> |
| <span data-ttu-id="cfa91-170">**來源位址首碼**</span><span class="sxs-lookup"><span data-stu-id="cfa91-170">**Source address prefix**</span></span> |<span data-ttu-id="cfa91-171">來源位址前置詞或標記 toomatch hello 規則。</span><span class="sxs-lookup"><span data-stu-id="cfa91-171">Source address prefix or tag toomatch for hello rule.</span></span> |<span data-ttu-id="cfa91-172">單一 IP 位址 (例如：10.10.10.10)、IP 子網路 (例如：192.168.1.0/24)、[預設標籤](#default-tags)或 * (用於所有位址)。</span><span class="sxs-lookup"><span data-stu-id="cfa91-172">Single IP address (example: 10.10.10.10), IP subnet (example: 192.168.1.0/24), [default tag](#default-tags), or * (for all addresses).</span></span> |<span data-ttu-id="cfa91-173">請考慮使用範圍的預設標記和 * tooreduce hello 的規則數目。</span><span class="sxs-lookup"><span data-stu-id="cfa91-173">Consider using ranges, default tags, and * tooreduce hello number of rules.</span></span> |
| <span data-ttu-id="cfa91-174">**Destination address prefix**</span><span class="sxs-lookup"><span data-stu-id="cfa91-174">**Destination address prefix**</span></span> |<span data-ttu-id="cfa91-175">目的地位址前置詞或標記 toomatch hello 規則。</span><span class="sxs-lookup"><span data-stu-id="cfa91-175">Destination address prefix or tag toomatch for hello rule.</span></span> | <span data-ttu-id="cfa91-176">單一 IP 位址 (例如：10.10.10.10)、IP 子網路 (例如：192.168.1.0/24)、[預設標籤](#default-tags)或 * (用於所有位址)。</span><span class="sxs-lookup"><span data-stu-id="cfa91-176">Single IP address (example: 10.10.10.10), IP subnet (example: 192.168.1.0/24), [default tag](#default-tags), or * (for all addresses).</span></span> |<span data-ttu-id="cfa91-177">請考慮使用範圍的預設標記和 * tooreduce hello 的規則數目。</span><span class="sxs-lookup"><span data-stu-id="cfa91-177">Consider using ranges, default tags, and * tooreduce hello number of rules.</span></span> |
| <span data-ttu-id="cfa91-178">**Direction**</span><span class="sxs-lookup"><span data-stu-id="cfa91-178">**Direction**</span></span> |<span data-ttu-id="cfa91-179">Hello 規則的流量 toomatch 的方向。</span><span class="sxs-lookup"><span data-stu-id="cfa91-179">Direction of traffic toomatch for hello rule.</span></span> |<span data-ttu-id="cfa91-180">輸入或輸出。</span><span class="sxs-lookup"><span data-stu-id="cfa91-180">Inbound or outbound.</span></span> |<span data-ttu-id="cfa91-181">輸入和輸出規則會根據方向分別處理。</span><span class="sxs-lookup"><span data-stu-id="cfa91-181">Inbound and outbound rules are processed separately, based on direction.</span></span> |
| <span data-ttu-id="cfa91-182">**優先順序**</span><span class="sxs-lookup"><span data-stu-id="cfa91-182">**Priority**</span></span> |<span data-ttu-id="cfa91-183">Hello 依優先順序會檢查規則。</span><span class="sxs-lookup"><span data-stu-id="cfa91-183">Rules are checked in hello order of priority.</span></span> <span data-ttu-id="cfa91-184">一旦套用規則，就不會再測試規則是否符合。</span><span class="sxs-lookup"><span data-stu-id="cfa91-184">Once a rule applies, no more rules are tested for matching.</span></span> | <span data-ttu-id="cfa91-185">100 和 4096 之間的數字。</span><span class="sxs-lookup"><span data-stu-id="cfa91-185">Number between 100 and 4096.</span></span> | <span data-ttu-id="cfa91-186">請考慮建立您可能會在建立 hello 未來跳躍新規則的每個規則 tooleave 空間 100 的優先權規則。</span><span class="sxs-lookup"><span data-stu-id="cfa91-186">Consider creating rules jumping priorities by 100 for each rule tooleave space for new rules you might create in hello future.</span></span> |
| <span data-ttu-id="cfa91-187">**Access**</span><span class="sxs-lookup"><span data-stu-id="cfa91-187">**Access**</span></span> |<span data-ttu-id="cfa91-188">類型存取 tooapply hello 規則會比對。</span><span class="sxs-lookup"><span data-stu-id="cfa91-188">Type of access tooapply if hello rule matches.</span></span> | <span data-ttu-id="cfa91-189">允許或拒絕。</span><span class="sxs-lookup"><span data-stu-id="cfa91-189">Allow or deny.</span></span> | <span data-ttu-id="cfa91-190">請記住，如果允許規則中找不到封包，hello 封包會卸除。</span><span class="sxs-lookup"><span data-stu-id="cfa91-190">Keep in mind that if an allow rule is not found for a packet, hello packet is dropped.</span></span> |

<span data-ttu-id="cfa91-191">NSG 包含兩組規則：輸入和輸出。</span><span class="sxs-lookup"><span data-stu-id="cfa91-191">NSGs contain two sets of rules: Inbound and outbound.</span></span> <span data-ttu-id="cfa91-192">hello 優先順序規則必須是每一組唯一的。</span><span class="sxs-lookup"><span data-stu-id="cfa91-192">hello priority for a rule must be unique within each set.</span></span> 

![NSG 規則處理](./media/virtual-network-nsg-overview/figure3.png) 

<span data-ttu-id="cfa91-194">hello 如上圖所示 NSG 規則的處理方式。</span><span class="sxs-lookup"><span data-stu-id="cfa91-194">hello previous picture shows how NSG rules are processed.</span></span>

### <a name="default-tags"></a><span data-ttu-id="cfa91-195">預設標籤</span><span class="sxs-lookup"><span data-stu-id="cfa91-195">Default Tags</span></span>
<span data-ttu-id="cfa91-196">預設標記是系統提供的識別項 tooaddress 分類的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="cfa91-196">Default tags are system-provided identifiers tooaddress a category of IP addresses.</span></span> <span data-ttu-id="cfa91-197">您可以使用預設標記中 hello**來源位址首碼**和**目的地位址首碼**任何規則的屬性。</span><span class="sxs-lookup"><span data-stu-id="cfa91-197">You can use default tags in hello **source address prefix** and **destination address prefix** properties of any rule.</span></span> <span data-ttu-id="cfa91-198">有三個您可使用的預設標籤：</span><span class="sxs-lookup"><span data-stu-id="cfa91-198">There are three default tags you can use:</span></span>

* <span data-ttu-id="cfa91-199">**VirtualNetwork** （資源管理員） (**VIRTUAL_NETWORK**的傳統): 此標記包含 hello 虛擬網路位址空間 （在 Azure 中定義的 CIDR 範圍），針對所有連線在內部部署位址空間，以及連接Azure Vnet （區域網路）。</span><span class="sxs-lookup"><span data-stu-id="cfa91-199">**VirtualNetwork** (Resource Manager) (**VIRTUAL_NETWORK** for classic): This tag includes hello virtual network address space (CIDR ranges defined in Azure), all connected on-premises address spaces, and connected Azure VNets (local networks).</span></span>
* <span data-ttu-id="cfa91-200">**AzureLoadBalancer** (Resource Manager) (適用於傳統部署的 **AZURE_LOADBALANCER**)：這個標籤代表 Azure 基礎結構的負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="cfa91-200">**AzureLoadBalancer** (Resource Manager) (**AZURE_LOADBALANCER** for classic): This tag denotes Azure’s infrastructure load balancer.</span></span> <span data-ttu-id="cfa91-201">hello 標記會轉譯的 tooan 源自 Azure 的健全狀況探查位置的 Azure 資料中心 IP。</span><span class="sxs-lookup"><span data-stu-id="cfa91-201">hello tag translates tooan Azure datacenter IP where Azure’s health probes originate.</span></span>
* <span data-ttu-id="cfa91-202">**網際網路**（資源管理員） (**網際網路**的傳統): 此標記代表位於 hello 虛擬網路外可經由公用網際網路的 hello IP 位址空間。</span><span class="sxs-lookup"><span data-stu-id="cfa91-202">**Internet** (Resource Manager) (**INTERNET** for classic): This tag denotes hello IP address space that is outside hello virtual network and reachable by public Internet.</span></span> <span data-ttu-id="cfa91-203">hello 範圍包括 hello [Azure 所擁有的公用 IP 空間](https://www.microsoft.com/download/details.aspx?id=41653)。</span><span class="sxs-lookup"><span data-stu-id="cfa91-203">hello range includes hello [Azure owned public IP space](https://www.microsoft.com/download/details.aspx?id=41653).</span></span>

### <a name="default-rules"></a><span data-ttu-id="cfa91-204">預設規則</span><span class="sxs-lookup"><span data-stu-id="cfa91-204">Default rules</span></span>
<span data-ttu-id="cfa91-205">所有 NSG 都包含一組預設規則。</span><span class="sxs-lookup"><span data-stu-id="cfa91-205">All NSGs contain a set of default rules.</span></span> <span data-ttu-id="cfa91-206">無法刪除 hello 預設規則，但它們指派 hello 最低優先權，因為它們會覆寫由您所建立的 hello 規則。</span><span class="sxs-lookup"><span data-stu-id="cfa91-206">hello default rules cannot be deleted, but because they are assigned hello lowest priority, they can be overridden by hello rules that you create.</span></span> 

<span data-ttu-id="cfa91-207">hello 預設規則允許及不允許流量，如下所示：</span><span class="sxs-lookup"><span data-stu-id="cfa91-207">hello default rules allow and disallow traffic as follows:</span></span>
- <span data-ttu-id="cfa91-208">虛擬網路中的流量起始和結束同時允許輸入和輸出方向。</span><span class="sxs-lookup"><span data-stu-id="cfa91-208">**Virtual network:** Traffic originating and ending in a virtual network is allowed both in inbound and outbound directions.</span></span>
- <span data-ttu-id="cfa91-209">**網際網路︰**允許輸出流量，但會封鎖輸入流量。</span><span class="sxs-lookup"><span data-stu-id="cfa91-209">**Internet:** Outbound traffic is allowed, but inbound traffic is blocked.</span></span>
- <span data-ttu-id="cfa91-210">**負載平衡器：**允許 Azure 負載平衡器 tooprobe hello 和健康狀態的 Vm 角色執行個體。</span><span class="sxs-lookup"><span data-stu-id="cfa91-210">**Load balancer:** Allow Azure’s load balancer tooprobe hello health of your VMs and role instances.</span></span> <span data-ttu-id="cfa91-211">如果您不使用負載平衡的集合，則可以覆寫此規則。</span><span class="sxs-lookup"><span data-stu-id="cfa91-211">If you are not using a load balanced set you can override this rule.</span></span>

<span data-ttu-id="cfa91-212">**輸入預設規則**</span><span class="sxs-lookup"><span data-stu-id="cfa91-212">**Inbound default rules**</span></span>

| <span data-ttu-id="cfa91-213">名稱</span><span class="sxs-lookup"><span data-stu-id="cfa91-213">Name</span></span> | <span data-ttu-id="cfa91-214">優先順序</span><span class="sxs-lookup"><span data-stu-id="cfa91-214">Priority</span></span> | <span data-ttu-id="cfa91-215">來源 IP</span><span class="sxs-lookup"><span data-stu-id="cfa91-215">Source IP</span></span> | <span data-ttu-id="cfa91-216">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-216">Source Port</span></span> | <span data-ttu-id="cfa91-217">目的地 IP</span><span class="sxs-lookup"><span data-stu-id="cfa91-217">Destination IP</span></span> | <span data-ttu-id="cfa91-218">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-218">Destination Port</span></span> | <span data-ttu-id="cfa91-219">通訊協定</span><span class="sxs-lookup"><span data-stu-id="cfa91-219">Protocol</span></span> | <span data-ttu-id="cfa91-220">Access</span><span class="sxs-lookup"><span data-stu-id="cfa91-220">Access</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="cfa91-221">AllowVNetInBound</span><span class="sxs-lookup"><span data-stu-id="cfa91-221">AllowVNetInBound</span></span> |<span data-ttu-id="cfa91-222">65000</span><span class="sxs-lookup"><span data-stu-id="cfa91-222">65000</span></span> | <span data-ttu-id="cfa91-223">VirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="cfa91-223">VirtualNetwork</span></span> | * | <span data-ttu-id="cfa91-224">VirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="cfa91-224">VirtualNetwork</span></span> | * | * | <span data-ttu-id="cfa91-225">允許</span><span class="sxs-lookup"><span data-stu-id="cfa91-225">Allow</span></span> |
| <span data-ttu-id="cfa91-226">AllowAzureLoadBalancerInBound</span><span class="sxs-lookup"><span data-stu-id="cfa91-226">AllowAzureLoadBalancerInBound</span></span> | <span data-ttu-id="cfa91-227">65001</span><span class="sxs-lookup"><span data-stu-id="cfa91-227">65001</span></span> | <span data-ttu-id="cfa91-228">AzureLoadBalancer</span><span class="sxs-lookup"><span data-stu-id="cfa91-228">AzureLoadBalancer</span></span> | * | * | * | * | <span data-ttu-id="cfa91-229">允許</span><span class="sxs-lookup"><span data-stu-id="cfa91-229">Allow</span></span> |
| <span data-ttu-id="cfa91-230">DenyAllInBound</span><span class="sxs-lookup"><span data-stu-id="cfa91-230">DenyAllInBound</span></span> |<span data-ttu-id="cfa91-231">65500</span><span class="sxs-lookup"><span data-stu-id="cfa91-231">65500</span></span> | * | * | * | * | * | <span data-ttu-id="cfa91-232">拒絕</span><span class="sxs-lookup"><span data-stu-id="cfa91-232">Deny</span></span> |

<span data-ttu-id="cfa91-233">**輸出預設規則**</span><span class="sxs-lookup"><span data-stu-id="cfa91-233">**Outbound default rules**</span></span>

| <span data-ttu-id="cfa91-234">名稱</span><span class="sxs-lookup"><span data-stu-id="cfa91-234">Name</span></span> | <span data-ttu-id="cfa91-235">優先順序</span><span class="sxs-lookup"><span data-stu-id="cfa91-235">Priority</span></span> | <span data-ttu-id="cfa91-236">來源 IP</span><span class="sxs-lookup"><span data-stu-id="cfa91-236">Source IP</span></span> | <span data-ttu-id="cfa91-237">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-237">Source Port</span></span> | <span data-ttu-id="cfa91-238">目的地 IP</span><span class="sxs-lookup"><span data-stu-id="cfa91-238">Destination IP</span></span> | <span data-ttu-id="cfa91-239">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-239">Destination Port</span></span> | <span data-ttu-id="cfa91-240">通訊協定</span><span class="sxs-lookup"><span data-stu-id="cfa91-240">Protocol</span></span> | <span data-ttu-id="cfa91-241">Access</span><span class="sxs-lookup"><span data-stu-id="cfa91-241">Access</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="cfa91-242">AllowVnetOutBound</span><span class="sxs-lookup"><span data-stu-id="cfa91-242">AllowVnetOutBound</span></span> | <span data-ttu-id="cfa91-243">65000</span><span class="sxs-lookup"><span data-stu-id="cfa91-243">65000</span></span> | <span data-ttu-id="cfa91-244">VirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="cfa91-244">VirtualNetwork</span></span> | * | <span data-ttu-id="cfa91-245">VirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="cfa91-245">VirtualNetwork</span></span> | * | * | <span data-ttu-id="cfa91-246">允許</span><span class="sxs-lookup"><span data-stu-id="cfa91-246">Allow</span></span> |
| <span data-ttu-id="cfa91-247">AllowInternetOutBound</span><span class="sxs-lookup"><span data-stu-id="cfa91-247">AllowInternetOutBound</span></span> | <span data-ttu-id="cfa91-248">65001</span><span class="sxs-lookup"><span data-stu-id="cfa91-248">65001</span></span> | * | * | <span data-ttu-id="cfa91-249">Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-249">Internet</span></span> | * | * | <span data-ttu-id="cfa91-250">允許</span><span class="sxs-lookup"><span data-stu-id="cfa91-250">Allow</span></span> |
| <span data-ttu-id="cfa91-251">DenyAllOutBound</span><span class="sxs-lookup"><span data-stu-id="cfa91-251">DenyAllOutBound</span></span> | <span data-ttu-id="cfa91-252">65500</span><span class="sxs-lookup"><span data-stu-id="cfa91-252">65500</span></span> | * | * | * | * | * | <span data-ttu-id="cfa91-253">拒絕</span><span class="sxs-lookup"><span data-stu-id="cfa91-253">Deny</span></span> |

## <a name="associating-nsgs"></a><span data-ttu-id="cfa91-254">建立 NSG 關聯</span><span class="sxs-lookup"><span data-stu-id="cfa91-254">Associating NSGs</span></span>
<span data-ttu-id="cfa91-255">您可以將關聯 NSG tooVMs、 的 Nic 和子網路，視您使用，，如下所示的 hello 部署模型而定：</span><span class="sxs-lookup"><span data-stu-id="cfa91-255">You can associate an NSG tooVMs, NICs, and subnets, depending on hello deployment model you are using, as follows:</span></span>

* <span data-ttu-id="cfa91-256">**VM （僅傳統）：**套用安全性規則 tooall 流量，從中 hello VM。</span><span class="sxs-lookup"><span data-stu-id="cfa91-256">**VM (classic only):** Security rules are applied tooall traffic to/from hello VM.</span></span> 
* <span data-ttu-id="cfa91-257">**NIC （資源管理員）：**套用安全性規則 tooall 流量，從中 hello NIC hello NSG 與其相關聯。</span><span class="sxs-lookup"><span data-stu-id="cfa91-257">**NIC (Resource Manager only):** Security rules are applied tooall traffic to/from hello NIC hello NSG is associated to.</span></span> <span data-ttu-id="cfa91-258">在多個 NIC VM 中，您可以套用不同的 （或相同 hello） NSG tooeach NIC 個別。</span><span class="sxs-lookup"><span data-stu-id="cfa91-258">In a multi-NIC VM, you can apply different (or hello same) NSG tooeach NIC individually.</span></span> 
* <span data-ttu-id="cfa91-259">**子網路 （「 資源管理員 」 和 「 傳統 」）：**安全性規則套用至 azure 或從任何資源 tooany 流量連接 toohello VNet。</span><span class="sxs-lookup"><span data-stu-id="cfa91-259">**Subnet (Resource Manager and classic):** Security rules are applied tooany traffic to/from any resources connected toohello VNet.</span></span>

<span data-ttu-id="cfa91-260">您可以將不同 Nsg tooa VM （或 NIC，視 hello 部署模型而定） 與 hello NIC 或 VM 連線到子網路。</span><span class="sxs-lookup"><span data-stu-id="cfa91-260">You can associate different NSGs tooa VM (or NIC, depending on hello deployment model) and hello subnet that a NIC or VM is connected to.</span></span> <span data-ttu-id="cfa91-261">安全性規則套用的 toohello 流量 hello 中的每個 NSG 中的優先順序，依下列順序：</span><span class="sxs-lookup"><span data-stu-id="cfa91-261">Security rules are applied toohello traffic, by priority, in each NSG, in hello following order:</span></span>

- <span data-ttu-id="cfa91-262">**輸入流量**</span><span class="sxs-lookup"><span data-stu-id="cfa91-262">**Inbound traffic**</span></span>

  1. <span data-ttu-id="cfa91-263">**NSG 套用 toosubnet:** hello 封包的 nsg 關聯的子網路具有比對的規則 toodeny 流量，如果卸除。</span><span class="sxs-lookup"><span data-stu-id="cfa91-263">**NSG applied toosubnet:** If a subnet NSG has a matching rule toodeny traffic, hello packet is dropped.</span></span>

  2. <span data-ttu-id="cfa91-264">**NSG 套用 tooNIC** （資源管理員） 或 VM （傳統）： 如果 VM\NIC NSG 具有相符的規則，拒絕的流量，封包，會卸除 hello VM\NIC，即使 NSG 的子網路具有相符的規則，允許流量。</span><span class="sxs-lookup"><span data-stu-id="cfa91-264">**NSG applied tooNIC** (Resource Manager) or VM (classic): If VM\NIC NSG has a matching rule that denies traffic, packets are dropped at hello VM\NIC, even if a subnet NSG has a matching rule that allows traffic.</span></span>

- <span data-ttu-id="cfa91-265">**輸出流量**</span><span class="sxs-lookup"><span data-stu-id="cfa91-265">**Outbound traffic**</span></span>

  1. <span data-ttu-id="cfa91-266">**NSG 套用 tooNIC** （資源管理員） 或 VM （傳統）： 如果 VM\NIC NSG 有相符的規則，拒絕的流量，就會捨棄封包。</span><span class="sxs-lookup"><span data-stu-id="cfa91-266">**NSG applied tooNIC** (Resource Manager) or VM (classic): If a VM\NIC NSG has a matching rule that denies traffic, packets are dropped.</span></span>

  2. <span data-ttu-id="cfa91-267">**NSG 套用 toosubnet:**如果 NSG 的子網路具有相符的規則，拒絕的流量，封包被丟棄，即使 VM\NIC NSG 具有相符的規則，允許流量。</span><span class="sxs-lookup"><span data-stu-id="cfa91-267">**NSG applied toosubnet:** If a subnet NSG has a matching rule that denies traffic, packets are dropped, even if a VM\NIC NSG has a matching rule that allows traffic.</span></span>

> [!NOTE]
> <span data-ttu-id="cfa91-268">雖然您可以只將單一 NSG tooa 子網路、 VM 或 NIC;您可以將關聯 hello 相同 NSG tooas 許多資源，您的需要。</span><span class="sxs-lookup"><span data-stu-id="cfa91-268">Although you can only associate a single NSG tooa subnet, VM, or NIC; you can associate hello same NSG tooas many resources as you want.</span></span>
>

## <a name="implementation"></a><span data-ttu-id="cfa91-269">實作</span><span class="sxs-lookup"><span data-stu-id="cfa91-269">Implementation</span></span>
<span data-ttu-id="cfa91-270">您可以實作 Nsg hello 資源管理員或使用下列工具 hello 傳統部署模型中：</span><span class="sxs-lookup"><span data-stu-id="cfa91-270">You can implement NSGs in hello Resource Manager or classic deployment models using hello following tools:</span></span>

| <span data-ttu-id="cfa91-271">部署工具</span><span class="sxs-lookup"><span data-stu-id="cfa91-271">Deployment tool</span></span> | <span data-ttu-id="cfa91-272">傳統</span><span class="sxs-lookup"><span data-stu-id="cfa91-272">Classic</span></span> | <span data-ttu-id="cfa91-273">Resource Manager</span><span class="sxs-lookup"><span data-stu-id="cfa91-273">Resource Manager</span></span> |
| --- | --- | --- |
| <span data-ttu-id="cfa91-274">Azure 入口網站</span><span class="sxs-lookup"><span data-stu-id="cfa91-274">Azure portal</span></span>   | <span data-ttu-id="cfa91-275">是</span><span class="sxs-lookup"><span data-stu-id="cfa91-275">Yes</span></span> | [<span data-ttu-id="cfa91-276">是</span><span class="sxs-lookup"><span data-stu-id="cfa91-276">Yes</span></span>](virtual-networks-create-nsg-arm-pportal.md) |
| <span data-ttu-id="cfa91-277">PowerShell</span><span class="sxs-lookup"><span data-stu-id="cfa91-277">PowerShell</span></span>     | [<span data-ttu-id="cfa91-278">是</span><span class="sxs-lookup"><span data-stu-id="cfa91-278">Yes</span></span>](virtual-networks-create-nsg-classic-ps.md) | [<span data-ttu-id="cfa91-279">是</span><span class="sxs-lookup"><span data-stu-id="cfa91-279">Yes</span></span>](virtual-networks-create-nsg-arm-ps.md) |
| <span data-ttu-id="cfa91-280">Azure CLI **V1**</span><span class="sxs-lookup"><span data-stu-id="cfa91-280">Azure CLI **V1**</span></span>   | [<span data-ttu-id="cfa91-281">是</span><span class="sxs-lookup"><span data-stu-id="cfa91-281">Yes</span></span>](virtual-networks-create-nsg-classic-cli.md) | [<span data-ttu-id="cfa91-282">是</span><span class="sxs-lookup"><span data-stu-id="cfa91-282">Yes</span></span>](virtual-networks-create-nsg-cli-nodejs.md) |
| <span data-ttu-id="cfa91-283">Azure CLI **V2**</span><span class="sxs-lookup"><span data-stu-id="cfa91-283">Azure CLI **V2**</span></span>   | <span data-ttu-id="cfa91-284">否</span><span class="sxs-lookup"><span data-stu-id="cfa91-284">No</span></span> | [<span data-ttu-id="cfa91-285">是</span><span class="sxs-lookup"><span data-stu-id="cfa91-285">Yes</span></span>](virtual-networks-create-nsg-arm-cli.md) |
| <span data-ttu-id="cfa91-286">Azure Resource Manager 範本</span><span class="sxs-lookup"><span data-stu-id="cfa91-286">Azure Resource Manager template</span></span>   | <span data-ttu-id="cfa91-287">否</span><span class="sxs-lookup"><span data-stu-id="cfa91-287">No</span></span>  | [<span data-ttu-id="cfa91-288">是</span><span class="sxs-lookup"><span data-stu-id="cfa91-288">Yes</span></span>](virtual-networks-create-nsg-arm-template.md) |

## <a name="planning"></a><span data-ttu-id="cfa91-289">規劃</span><span class="sxs-lookup"><span data-stu-id="cfa91-289">Planning</span></span>
<span data-ttu-id="cfa91-290">在實作之前 Nsg，您需要 tooanswer hello 下列問題：</span><span class="sxs-lookup"><span data-stu-id="cfa91-290">Before implementing NSGs, you need tooanswer hello following questions:</span></span>

1. <span data-ttu-id="cfa91-291">您想從 toofilter 流量 tooor 什麼類型的資源？</span><span class="sxs-lookup"><span data-stu-id="cfa91-291">What types of resources do you want toofilter traffic tooor from?</span></span> <span data-ttu-id="cfa91-292">您可以取得各種資源，例如 NIC (Resource Manager)、VM (傳統)、雲端服務、應用程式服務環境和 VM 擴展集。</span><span class="sxs-lookup"><span data-stu-id="cfa91-292">You can connect resources such as NICs (Resource Manager), VMs (classic), Cloud Services, Application Service Environments, and VM Scale Sets.</span></span> 
2. <span data-ttu-id="cfa91-293">是您想要從連接中的現有 Vnet toosubnets toofilter 流量的 hello 資源嗎？</span><span class="sxs-lookup"><span data-stu-id="cfa91-293">Are hello resources you want toofilter traffic to/from connected toosubnets in existing VNets?</span></span>

<span data-ttu-id="cfa91-294">規劃 Azure 中的網路安全性的詳細資訊，請參閱 hello[雲端服務和網路安全性](../best-practices-network-security.md)發行項。</span><span class="sxs-lookup"><span data-stu-id="cfa91-294">For more information on planning for network security in Azure, read hello [Cloud services and network security](../best-practices-network-security.md) article.</span></span> 

## <a name="design-considerations"></a><span data-ttu-id="cfa91-295">設計考量</span><span class="sxs-lookup"><span data-stu-id="cfa91-295">Design considerations</span></span>
<span data-ttu-id="cfa91-296">一旦您知道 hello 答案 toohello 問題中 hello[規劃](#Planning)區段中，檢閱下列各節定義 Nsg 之前的 hello:</span><span class="sxs-lookup"><span data-stu-id="cfa91-296">Once you know hello answers toohello questions in hello [Planning](#Planning) section, review hello following sections before defining your NSGs:</span></span>

### <a name="limits"></a><span data-ttu-id="cfa91-297">限制</span><span class="sxs-lookup"><span data-stu-id="cfa91-297">Limits</span></span>
<span data-ttu-id="cfa91-298">您可以在訂用帳戶的 Nsg 的 toohello 數目和每個 NSG 的規則數目沒有限制。</span><span class="sxs-lookup"><span data-stu-id="cfa91-298">There are limits toohello number of NSGs you can have in a subscription and number of rules per NSG.</span></span> <span data-ttu-id="cfa91-299">深入了解 hello 限制、 讀取 hello toolearn [Azure 限制](../azure-subscription-service-limits.md#networking-limits)發行項。</span><span class="sxs-lookup"><span data-stu-id="cfa91-299">toolearn more about hello limits, read hello [Azure limits](../azure-subscription-service-limits.md#networking-limits) article.</span></span>

### <a name="vnet-and-subnet-design"></a><span data-ttu-id="cfa91-300">VNet 和子網路的設計</span><span class="sxs-lookup"><span data-stu-id="cfa91-300">VNet and subnet design</span></span>
<span data-ttu-id="cfa91-301">Nsg 可以套用的 toosubnets，因為您可以透過您的資源群組的子網路，並套用 Nsg toosubnets 降低 hello Nsg 的數目。</span><span class="sxs-lookup"><span data-stu-id="cfa91-301">Since NSGs can be applied toosubnets, you can minimize hello number of NSGs by grouping your resources by subnet, and applying NSGs toosubnets.</span></span>  <span data-ttu-id="cfa91-302">如果您決定 tooapply Nsg toosubnets，您可能會發現，現有的 Vnet 子網路，您有不使用定義及 Nsg 記住。</span><span class="sxs-lookup"><span data-stu-id="cfa91-302">If you decide tooapply NSGs toosubnets, you may find that existing VNets and subnets you have were not defined with NSGs in mind.</span></span> <span data-ttu-id="cfa91-303">您可能需要 toodefine 新的 Vnet 和子網路 toosupport NSG 設計和部署您新資源 tooyour 新的子網路。</span><span class="sxs-lookup"><span data-stu-id="cfa91-303">You may need toodefine new VNets and subnets toosupport your NSG design and deploy your new resources tooyour new subnets.</span></span> <span data-ttu-id="cfa91-304">接著，您無法定義現有的資源 toohello 新的子網路移轉策略 toomove。</span><span class="sxs-lookup"><span data-stu-id="cfa91-304">You could then define a migration strategy toomove existing resources toohello new subnets.</span></span> 

### <a name="special-rules"></a><span data-ttu-id="cfa91-305">特殊規則</span><span class="sxs-lookup"><span data-stu-id="cfa91-305">Special rules</span></span>
<span data-ttu-id="cfa91-306">如果您封鎖 hello 下列規則所允許的流量，您的基礎結構無法與 Azure 的基本服務：</span><span class="sxs-lookup"><span data-stu-id="cfa91-306">If you block traffic allowed by hello following rules, your infrastructure can't communicate with essential Azure services:</span></span>

* <span data-ttu-id="cfa91-307">**Hello 主機節點的虛擬 IP:**基本基礎結構服務，例如 DHCP、 DNS 及狀況監控透過提供 hello 虛擬化主機 IP 位址 168.63.129.16。</span><span class="sxs-lookup"><span data-stu-id="cfa91-307">**Virtual IP of hello host node:** Basic infrastructure services such as DHCP, DNS, and health monitoring are provided through hello virtualized host IP address 168.63.129.16.</span></span> <span data-ttu-id="cfa91-308">這個公用 IP 位址所屬 tooMicrosoft 且 hello 唯一虛擬化的 IP 位址在所有區域用於此目的。</span><span class="sxs-lookup"><span data-stu-id="cfa91-308">This public IP address belongs tooMicrosoft and is hello only virtualized IP address used in all regions for this purpose.</span></span> <span data-ttu-id="cfa91-309">此 IP 位址對應 toohello 實體 IP 位址 hello server 電腦 （主機節點） 的裝載 hello VM。</span><span class="sxs-lookup"><span data-stu-id="cfa91-309">This IP address maps toohello physical IP address of hello server machine (host node) hosting hello VM.</span></span> <span data-ttu-id="cfa91-310">hello 主機節點做為 hello DHCP 轉送、 hello DNS 遞迴解析程式，以及 hello 探查來源 hello 負載平衡器健全狀況探查與 hello 機器健全狀況探查。</span><span class="sxs-lookup"><span data-stu-id="cfa91-310">hello host node acts as hello DHCP relay, hello DNS recursive resolver, and hello probe source for hello load balancer health probe and hello machine health probe.</span></span> <span data-ttu-id="cfa91-311">通訊 toothis IP 位址不是攻擊。</span><span class="sxs-lookup"><span data-stu-id="cfa91-311">Communication toothis IP address is not an attack.</span></span>
* <span data-ttu-id="cfa91-312">**授權 (金鑰管理服務)**：在 VM 中執行的 Windows 映像必須獲得授權。</span><span class="sxs-lookup"><span data-stu-id="cfa91-312">**Licensing (Key Management Service):** Windows images running in VMs must be licensed.</span></span> <span data-ttu-id="cfa91-313">tooensure 授權，要求會傳送 toohello 金鑰管理服務主機伺服器可處理這類查詢。</span><span class="sxs-lookup"><span data-stu-id="cfa91-313">tooensure licensing, a request is sent toohello Key Management Service host servers that handle such queries.</span></span> <span data-ttu-id="cfa91-314">hello 要求是透過輸出連接埠 1688年。</span><span class="sxs-lookup"><span data-stu-id="cfa91-314">hello request is made outbound through port 1688.</span></span>

### <a name="icmp-traffic"></a><span data-ttu-id="cfa91-315">ICMP 流量</span><span class="sxs-lookup"><span data-stu-id="cfa91-315">ICMP traffic</span></span>
<span data-ttu-id="cfa91-316">hello 目前的 NSG 規則只允許通訊協定*TCP*或*UDP*。</span><span class="sxs-lookup"><span data-stu-id="cfa91-316">hello current NSG rules only allow for protocols *TCP* or *UDP*.</span></span> <span data-ttu-id="cfa91-317">*ICMP*沒有特定的標記。</span><span class="sxs-lookup"><span data-stu-id="cfa91-317">There is not a specific tag for *ICMP*.</span></span> <span data-ttu-id="cfa91-318">不過，允許 ICMP 流量是 VNet 中的 hello AllowVNetInBound 預設規則，以允許從任何連接埠和通訊協定 hello VNet 內的流量 tooand。</span><span class="sxs-lookup"><span data-stu-id="cfa91-318">However, ICMP traffic is allowed within a VNet by hello AllowVNetInBound default rule, that allows traffic tooand from any port and protocol within hello VNet.</span></span>

### <a name="subnets"></a><span data-ttu-id="cfa91-319">子網路</span><span class="sxs-lookup"><span data-stu-id="cfa91-319">Subnets</span></span>
* <span data-ttu-id="cfa91-320">請考慮您的工作負載需要的階層的 hello 數目。</span><span class="sxs-lookup"><span data-stu-id="cfa91-320">Consider hello number of tiers your workload requires.</span></span> <span data-ttu-id="cfa91-321">每一層可以使用子網路，與套用的 NSG toohello 子網路隔離。</span><span class="sxs-lookup"><span data-stu-id="cfa91-321">Each tier can be isolated by using a subnet, with an NSG applied toohello subnet.</span></span> 
* <span data-ttu-id="cfa91-322">如果您需要 tooimplement 子網路的 VPN 閘道或 ExpressRoute 循環時，請勿**不**套用 NSG toothat 子網路。</span><span class="sxs-lookup"><span data-stu-id="cfa91-322">If you need tooimplement a subnet for a VPN gateway, or ExpressRoute circuit, do **not** apply an NSG toothat subnet.</span></span> <span data-ttu-id="cfa91-323">如果您這麼做，跨 VNet 或跨單位連線將會失敗。</span><span class="sxs-lookup"><span data-stu-id="cfa91-323">If you do so, cross-VNet or cross-premises connectivity may fail.</span></span> 
* <span data-ttu-id="cfa91-324">如果您需要 tooimplement 網路虛擬應用裝置 (NVA)，連接 hello NVA tooits 自己的子網路，然後從 hello NVA 建立使用者定義的路由 (UDR) tooand。</span><span class="sxs-lookup"><span data-stu-id="cfa91-324">If you need tooimplement a network virtual appliance (NVA), connect hello NVA tooits own subnet and create user-defined routes (UDR) tooand from hello NVA.</span></span> <span data-ttu-id="cfa91-325">您可以實作的子網路層級 NSG toofilter 流量進出此子網路。</span><span class="sxs-lookup"><span data-stu-id="cfa91-325">You can implement a subnet level NSG toofilter traffic in and out of this subnet.</span></span> <span data-ttu-id="cfa91-326">深入了解 UDRs，讀取 hello toolearn[使用者定義的路由](virtual-networks-udr-overview.md)發行項。</span><span class="sxs-lookup"><span data-stu-id="cfa91-326">toolearn more about UDRs, read hello [User-defined routes](virtual-networks-udr-overview.md) article.</span></span>

### <a name="load-balancers"></a><span data-ttu-id="cfa91-327">負載平衡器</span><span class="sxs-lookup"><span data-stu-id="cfa91-327">Load balancers</span></span>
* <span data-ttu-id="cfa91-328">請考慮 hello 負載平衡和網路位址轉譯 (NAT) 規則，每個工作負載所使用的每個負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="cfa91-328">Consider hello load balancing and network address translation (NAT) rules for each load balancer used by each of your workloads.</span></span> <span data-ttu-id="cfa91-329">NAT 規則都包含 Nic （資源管理員） 或 Vm/雲端服務角色執行個體 （傳統） 的繫結的 tooa 後端集區。</span><span class="sxs-lookup"><span data-stu-id="cfa91-329">NAT rules are bound tooa back-end pool that contains NICs (Resource Manager) or VMs/Cloud Services role instances (classic).</span></span> <span data-ttu-id="cfa91-330">請考慮建立 NSG 針對每個後端集區中，允許只會透過實作 hello 負載平衡器中的 hello 規則對應的流量。</span><span class="sxs-lookup"><span data-stu-id="cfa91-330">Consider creating an NSG for each back-end pool, allowing only traffic mapped through hello rules implemented in hello load balancers.</span></span> <span data-ttu-id="cfa91-331">建立每個後端集區 NSG，可以保證會同時篩選直接 （而非透過 hello 負載平衡器），傳 toohello 後端集區的流量。</span><span class="sxs-lookup"><span data-stu-id="cfa91-331">Creating an NSG for each back-end pool guarantees that traffic coming toohello back-end pool directly (rather than through hello load balancer), is also filtered.</span></span>
* <span data-ttu-id="cfa91-332">在傳統的部署中，您會建立對應的 Vm 或角色執行個體上的負載平衡器 tooports 上的連接埠的端點。</span><span class="sxs-lookup"><span data-stu-id="cfa91-332">In classic deployments, you create endpoints that map ports on a load balancer tooports on your VMs or role instances.</span></span> <span data-ttu-id="cfa91-333">您也可以透過 Resource Manager 建立自己個別對外公開的負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="cfa91-333">You can also create your own individual public-facing load balancer through Resource Manager.</span></span> <span data-ttu-id="cfa91-334">hello hello VM 中的實際通訊埠或角色執行個體，不在負載平衡器所公開的 hello 連接埠的連入流量的 hello 目的地連接埠。</span><span class="sxs-lookup"><span data-stu-id="cfa91-334">hello destination port for incoming traffic is hello actual port in hello VM or role instance, not hello port exposed by a load balancer.</span></span> <span data-ttu-id="cfa91-335">hello 來源連接埠和位址 hello 連接 toohello VM 位於連接埠和位址 hello hello 網際網路中的遠端電腦，而不 hello 連接埠和 hello 負載平衡器所公開的位址。</span><span class="sxs-lookup"><span data-stu-id="cfa91-335">hello source port and address for hello connection toohello VM is a port and address on hello remote computer in hello Internet, not hello port and address exposed by hello load balancer.</span></span>
* <span data-ttu-id="cfa91-336">當您建立內部負載平衡器 (ILB) 通過的 Nsg toofilter 流量時，hello 來源連接埠和位址範圍套用為 hello 原始電腦，不 hello 負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="cfa91-336">When you create NSGs toofilter traffic coming through an internal load balancer (ILB), hello source port and address range applied are  from hello originating computer, not hello load balancer.</span></span> <span data-ttu-id="cfa91-337">hello 目的地連接埠和位址範圍是 hello 目的地電腦，不 hello 負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="cfa91-337">hello destination port and address range are those of hello destination computer, not hello load balancer.</span></span>

### <a name="other"></a><span data-ttu-id="cfa91-338">其他</span><span class="sxs-lookup"><span data-stu-id="cfa91-338">Other</span></span>
* <span data-ttu-id="cfa91-339">以端點為基礎的存取控制清單 (ACL) 和 Nsg hello 上不支援相同的 VM 執行個體。</span><span class="sxs-lookup"><span data-stu-id="cfa91-339">Endpoint-based access control lists (ACL) and NSGs are not supported on hello same VM instance.</span></span> <span data-ttu-id="cfa91-340">如果您想 toouse NSG，且已備妥端點 ACL，請先移除 hello 端點 ACL。</span><span class="sxs-lookup"><span data-stu-id="cfa91-340">If you want toouse an NSG and have an endpoint ACL already in place, first remove hello endpoint ACL.</span></span> <span data-ttu-id="cfa91-341">如需有關資訊 tooremove 端點 ACL，請參閱 hello[管理端點 Acl](virtual-networks-acl-powershell.md)發行項。</span><span class="sxs-lookup"><span data-stu-id="cfa91-341">For information about how tooremove an endpoint ACL, see hello [Manage endpoint ACLs](virtual-networks-acl-powershell.md) article.</span></span>
* <span data-ttu-id="cfa91-342">資源管理員 中，您可以使用 NSG 相關聯 tooa NIC 的 Vm 與每個 NIC 為基礎的多個 Nic tooenable 管理 （遠端存取）。</span><span class="sxs-lookup"><span data-stu-id="cfa91-342">In Resource Manager, you can use an NSG associated tooa NIC for VMs with multiple NICs tooenable management (remote access) on a per NIC basis.</span></span> <span data-ttu-id="cfa91-343">唯一 Nsg tooeach NIC 建立關聯可讓 Nic 的流量類型分隔。</span><span class="sxs-lookup"><span data-stu-id="cfa91-343">Associating unique NSGs tooeach NIC enables separation of traffic types across NICs.</span></span>
* <span data-ttu-id="cfa91-344">類似 toohello 的負載平衡器、 篩選來自其他 Vnet 流量時，您必須使用 hello 來源位址範圍的 hello 遠端電腦時，不會 hello 連接 hello Vnet 的閘道。</span><span class="sxs-lookup"><span data-stu-id="cfa91-344">Similar toohello use of load balancers, when filtering traffic from other VNets, you must use hello source address range of hello remote computer, not hello gateway connecting hello VNets.</span></span>
* <span data-ttu-id="cfa91-345">許多 Azure 服務不能連接的 tooVNets。</span><span class="sxs-lookup"><span data-stu-id="cfa91-345">Many Azure services cannot be connected tooVNets.</span></span> <span data-ttu-id="cfa91-346">如果一項 Azure 資源無法連線的 tooa VNet，您無法使用 NSG toofilter 流量 toohello 資源。</span><span class="sxs-lookup"><span data-stu-id="cfa91-346">If an Azure resource is not connected tooa VNet, you cannot use an NSG toofilter traffic toohello resource.</span></span>  <span data-ttu-id="cfa91-347">Hello 服務可以連線的 tooa VNet 是否使用 toodetermine 讀取 hello 文件以 hello 服務。</span><span class="sxs-lookup"><span data-stu-id="cfa91-347">Read hello documentation for hello services you use toodetermine whether hello service can be connected tooa VNet.</span></span>

## <a name="sample-deployment"></a><span data-ttu-id="cfa91-348">部署範例</span><span class="sxs-lookup"><span data-stu-id="cfa91-348">Sample deployment</span></span>
<span data-ttu-id="cfa91-349">tooillustrate hello 應用程式的此篇文章中的 hello 資訊，請考慮 hello 下列圖片所示的兩層式應用程式的常見的案例：</span><span class="sxs-lookup"><span data-stu-id="cfa91-349">tooillustrate hello application of hello information in this article, consider a common scenario of a two tier application shown in hello following picture:</span></span>

![NSG](./media/virtual-network-nsg-overview/figure1.png)

<span data-ttu-id="cfa91-351">Hello 圖表所示，hello *Web1*和*Web2* Vm 會連線的 toohello*前端*子網路和 hello *DB1*和*DB2* Vm 會連線的 toohello*後端*子網路。</span><span class="sxs-lookup"><span data-stu-id="cfa91-351">As shown in hello diagram, hello *Web1* and *Web2* VMs are connected toohello *FrontEnd* subnet, and hello *DB1* and *DB2* VMs are connected toohello *BackEnd* subnet.</span></span>  <span data-ttu-id="cfa91-352">這兩個子網路屬於 hello *TestVNet* VNet。</span><span class="sxs-lookup"><span data-stu-id="cfa91-352">Both subnets are part of hello *TestVNet* VNet.</span></span> <span data-ttu-id="cfa91-353">hello 應用程式元件每個執行的 Azure VM 連接 tooa VNet 內。</span><span class="sxs-lookup"><span data-stu-id="cfa91-353">hello application components each run within an Azure VM connected tooa VNet.</span></span> <span data-ttu-id="cfa91-354">hello 案例具有下列需求的 hello:</span><span class="sxs-lookup"><span data-stu-id="cfa91-354">hello scenario has hello following requirements:</span></span>

1. <span data-ttu-id="cfa91-355">分隔的 hello WEB 和 DB 伺服器之間的流量。</span><span class="sxs-lookup"><span data-stu-id="cfa91-355">Separation of traffic between hello WEB and DB servers.</span></span>
2. <span data-ttu-id="cfa91-356">負載平衡規則從 hello 負載平衡器 tooall web 伺服器連接埠 80 上的轉送流量。</span><span class="sxs-lookup"><span data-stu-id="cfa91-356">Load balancing rules forward traffic from hello load balancer tooall web servers on port 80.</span></span>
3. <span data-ttu-id="cfa91-357">負載平衡器 NAT 規則轉送流量進入 hello 負載平衡器上的連接埠 50001 tooport 3389，hello WEB1 VM 上。</span><span class="sxs-lookup"><span data-stu-id="cfa91-357">Load balancer NAT rules forward traffic coming into hello load balancer on port 50001 tooport 3389 on hello WEB1 VM.</span></span>
4. <span data-ttu-id="cfa91-358">沒有存取 toohello 前端或後端 Vm 從 hello 網際網路，除了需求 2 和 3。</span><span class="sxs-lookup"><span data-stu-id="cfa91-358">No access toohello front-end or back-end VMs from hello Internet, except requirements 2 and 3.</span></span>
5. <span data-ttu-id="cfa91-359">從 hello WEB 或 DB 伺服器沒有傳出網際網路存取。</span><span class="sxs-lookup"><span data-stu-id="cfa91-359">No outbound Internet access from hello WEB or DB servers.</span></span>
6. <span data-ttu-id="cfa91-360">從 hello FrontEnd 子網路的存取為 allowed tooport 3389 的任何 web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="cfa91-360">Access from hello FrontEnd subnet is allowed tooport 3389 of any web server.</span></span>
7. <span data-ttu-id="cfa91-361">從 hello FrontEnd 子網路的存取為 allowed tooport 3389 任何 DB 伺服器。</span><span class="sxs-lookup"><span data-stu-id="cfa91-361">Access from hello FrontEnd subnet is allowed tooport 3389 of any DB server.</span></span>
8. <span data-ttu-id="cfa91-362">從 hello FrontEnd 子網路的存取為 allowed tooport 1433 的所有資料庫伺服器。</span><span class="sxs-lookup"><span data-stu-id="cfa91-362">Access from hello FrontEnd subnet is allowed tooport 1433 of all DB servers.</span></span>
9. <span data-ttu-id="cfa91-363">區隔 DB 伺服器中不同 NIC 上的管理流量 (連接埠 3389) 和資料庫流量 (1433)。</span><span class="sxs-lookup"><span data-stu-id="cfa91-363">Separation of management traffic (port 3389) and database traffic (1433) on different NICs in DB servers.</span></span>

<span data-ttu-id="cfa91-364">需求 1-6 （除了需求 3 和 4） 是所有的局部的 toosubnet 空格。</span><span class="sxs-lookup"><span data-stu-id="cfa91-364">Requirements 1-6 (except requirements 3 and 4) are all confined toosubnet spaces.</span></span> <span data-ttu-id="cfa91-365">hello 下列 Nsg 符合 hello 先前的需求降至最低所需的 Nsg 的 hello 數目：</span><span class="sxs-lookup"><span data-stu-id="cfa91-365">hello following NSGs meet hello previous requirements, while minimizing hello number of NSGs required:</span></span>

### <a name="frontend"></a><span data-ttu-id="cfa91-366">FrontEnd</span><span class="sxs-lookup"><span data-stu-id="cfa91-366">FrontEnd</span></span>
<span data-ttu-id="cfa91-367">**輸入規則**</span><span class="sxs-lookup"><span data-stu-id="cfa91-367">**Inbound rules**</span></span>

| <span data-ttu-id="cfa91-368">規則</span><span class="sxs-lookup"><span data-stu-id="cfa91-368">Rule</span></span> | <span data-ttu-id="cfa91-369">Access</span><span class="sxs-lookup"><span data-stu-id="cfa91-369">Access</span></span> | <span data-ttu-id="cfa91-370">優先順序</span><span class="sxs-lookup"><span data-stu-id="cfa91-370">Priority</span></span> | <span data-ttu-id="cfa91-371">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-371">Source address range</span></span> | <span data-ttu-id="cfa91-372">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-372">Source port</span></span> | <span data-ttu-id="cfa91-373">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-373">Destination address range</span></span> | <span data-ttu-id="cfa91-374">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-374">Destination port</span></span> | <span data-ttu-id="cfa91-375">通訊協定</span><span class="sxs-lookup"><span data-stu-id="cfa91-375">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="cfa91-376">Allow-Inbound-HTTP-Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-376">Allow-Inbound-HTTP-Internet</span></span> | <span data-ttu-id="cfa91-377">允許</span><span class="sxs-lookup"><span data-stu-id="cfa91-377">Allow</span></span> | <span data-ttu-id="cfa91-378">100</span><span class="sxs-lookup"><span data-stu-id="cfa91-378">100</span></span> | <span data-ttu-id="cfa91-379">Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-379">Internet</span></span> | * | * | <span data-ttu-id="cfa91-380">80</span><span class="sxs-lookup"><span data-stu-id="cfa91-380">80</span></span> | <span data-ttu-id="cfa91-381">TCP</span><span class="sxs-lookup"><span data-stu-id="cfa91-381">TCP</span></span> |
| <span data-ttu-id="cfa91-382">Allow-Inbound-RDP-Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-382">Allow-Inbound-RDP-Internet</span></span> | <span data-ttu-id="cfa91-383">允許</span><span class="sxs-lookup"><span data-stu-id="cfa91-383">Allow</span></span> | <span data-ttu-id="cfa91-384">200</span><span class="sxs-lookup"><span data-stu-id="cfa91-384">200</span></span> | <span data-ttu-id="cfa91-385">Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-385">Internet</span></span> | * | * | <span data-ttu-id="cfa91-386">3389</span><span class="sxs-lookup"><span data-stu-id="cfa91-386">3389</span></span> | <span data-ttu-id="cfa91-387">TCP</span><span class="sxs-lookup"><span data-stu-id="cfa91-387">TCP</span></span> |
| <span data-ttu-id="cfa91-388">Deny-Inbound-All</span><span class="sxs-lookup"><span data-stu-id="cfa91-388">Deny-Inbound-All</span></span> | <span data-ttu-id="cfa91-389">拒絕</span><span class="sxs-lookup"><span data-stu-id="cfa91-389">Deny</span></span> | <span data-ttu-id="cfa91-390">300</span><span class="sxs-lookup"><span data-stu-id="cfa91-390">300</span></span> | <span data-ttu-id="cfa91-391">Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-391">Internet</span></span> | * | * | * | <span data-ttu-id="cfa91-392">TCP</span><span class="sxs-lookup"><span data-stu-id="cfa91-392">TCP</span></span> |

<span data-ttu-id="cfa91-393">**輸出規則**</span><span class="sxs-lookup"><span data-stu-id="cfa91-393">**Outbound rules**</span></span>

| <span data-ttu-id="cfa91-394">規則</span><span class="sxs-lookup"><span data-stu-id="cfa91-394">Rule</span></span> | <span data-ttu-id="cfa91-395">Access</span><span class="sxs-lookup"><span data-stu-id="cfa91-395">Access</span></span> | <span data-ttu-id="cfa91-396">優先順序</span><span class="sxs-lookup"><span data-stu-id="cfa91-396">Priority</span></span> | <span data-ttu-id="cfa91-397">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-397">Source address range</span></span> | <span data-ttu-id="cfa91-398">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-398">Source port</span></span> | <span data-ttu-id="cfa91-399">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-399">Destination address range</span></span> | <span data-ttu-id="cfa91-400">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-400">Destination port</span></span> | <span data-ttu-id="cfa91-401">通訊協定</span><span class="sxs-lookup"><span data-stu-id="cfa91-401">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="cfa91-402">Deny-Internet-All</span><span class="sxs-lookup"><span data-stu-id="cfa91-402">Deny-Internet-All</span></span> |<span data-ttu-id="cfa91-403">拒絕</span><span class="sxs-lookup"><span data-stu-id="cfa91-403">Deny</span></span> |<span data-ttu-id="cfa91-404">100</span><span class="sxs-lookup"><span data-stu-id="cfa91-404">100</span></span> | * | * | <span data-ttu-id="cfa91-405">Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-405">Internet</span></span> | * | * |

### <a name="backend"></a><span data-ttu-id="cfa91-406">BackEnd</span><span class="sxs-lookup"><span data-stu-id="cfa91-406">BackEnd</span></span>
<span data-ttu-id="cfa91-407">**輸入規則**</span><span class="sxs-lookup"><span data-stu-id="cfa91-407">**Inbound rules**</span></span>

| <span data-ttu-id="cfa91-408">規則</span><span class="sxs-lookup"><span data-stu-id="cfa91-408">Rule</span></span> | <span data-ttu-id="cfa91-409">Access</span><span class="sxs-lookup"><span data-stu-id="cfa91-409">Access</span></span> | <span data-ttu-id="cfa91-410">優先順序</span><span class="sxs-lookup"><span data-stu-id="cfa91-410">Priority</span></span> | <span data-ttu-id="cfa91-411">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-411">Source address range</span></span> | <span data-ttu-id="cfa91-412">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-412">Source port</span></span> | <span data-ttu-id="cfa91-413">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-413">Destination address range</span></span> | <span data-ttu-id="cfa91-414">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-414">Destination port</span></span> | <span data-ttu-id="cfa91-415">通訊協定</span><span class="sxs-lookup"><span data-stu-id="cfa91-415">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="cfa91-416">Deny-Internet-All</span><span class="sxs-lookup"><span data-stu-id="cfa91-416">Deny-Internet-All</span></span> | <span data-ttu-id="cfa91-417">拒絕</span><span class="sxs-lookup"><span data-stu-id="cfa91-417">Deny</span></span> | <span data-ttu-id="cfa91-418">100</span><span class="sxs-lookup"><span data-stu-id="cfa91-418">100</span></span> | <span data-ttu-id="cfa91-419">Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-419">Internet</span></span> | * | * | * | * |

<span data-ttu-id="cfa91-420">**輸出規則**</span><span class="sxs-lookup"><span data-stu-id="cfa91-420">**Outbound rules**</span></span>

| <span data-ttu-id="cfa91-421">規則</span><span class="sxs-lookup"><span data-stu-id="cfa91-421">Rule</span></span> | <span data-ttu-id="cfa91-422">Access</span><span class="sxs-lookup"><span data-stu-id="cfa91-422">Access</span></span> | <span data-ttu-id="cfa91-423">優先順序</span><span class="sxs-lookup"><span data-stu-id="cfa91-423">Priority</span></span> | <span data-ttu-id="cfa91-424">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-424">Source address range</span></span> | <span data-ttu-id="cfa91-425">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-425">Source port</span></span> | <span data-ttu-id="cfa91-426">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-426">Destination address range</span></span> | <span data-ttu-id="cfa91-427">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-427">Destination port</span></span> | <span data-ttu-id="cfa91-428">通訊協定</span><span class="sxs-lookup"><span data-stu-id="cfa91-428">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="cfa91-429">Deny-Internet-All</span><span class="sxs-lookup"><span data-stu-id="cfa91-429">Deny-Internet-All</span></span> | <span data-ttu-id="cfa91-430">拒絕</span><span class="sxs-lookup"><span data-stu-id="cfa91-430">Deny</span></span> | <span data-ttu-id="cfa91-431">100</span><span class="sxs-lookup"><span data-stu-id="cfa91-431">100</span></span> | * | * | <span data-ttu-id="cfa91-432">Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-432">Internet</span></span> | * | * |

<span data-ttu-id="cfa91-433">下列 Nsg 會建立並關聯 tooNICs hello 遵循 Vm 中的 hello:</span><span class="sxs-lookup"><span data-stu-id="cfa91-433">hello following NSGs are created and associated tooNICs in hello following VMs:</span></span>

### <a name="web1"></a><span data-ttu-id="cfa91-434">WEB1</span><span class="sxs-lookup"><span data-stu-id="cfa91-434">WEB1</span></span>
<span data-ttu-id="cfa91-435">**輸入規則**</span><span class="sxs-lookup"><span data-stu-id="cfa91-435">**Inbound rules**</span></span>

| <span data-ttu-id="cfa91-436">規則</span><span class="sxs-lookup"><span data-stu-id="cfa91-436">Rule</span></span> | <span data-ttu-id="cfa91-437">Access</span><span class="sxs-lookup"><span data-stu-id="cfa91-437">Access</span></span> | <span data-ttu-id="cfa91-438">優先順序</span><span class="sxs-lookup"><span data-stu-id="cfa91-438">Priority</span></span> | <span data-ttu-id="cfa91-439">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-439">Source address range</span></span> | <span data-ttu-id="cfa91-440">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-440">Source port</span></span> | <span data-ttu-id="cfa91-441">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-441">Destination address range</span></span> | <span data-ttu-id="cfa91-442">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-442">Destination port</span></span> | <span data-ttu-id="cfa91-443">通訊協定</span><span class="sxs-lookup"><span data-stu-id="cfa91-443">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="cfa91-444">Allow-Inbound-RDP-Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-444">Allow-Inbound-RDP-Internet</span></span> | <span data-ttu-id="cfa91-445">允許</span><span class="sxs-lookup"><span data-stu-id="cfa91-445">Allow</span></span> | <span data-ttu-id="cfa91-446">100</span><span class="sxs-lookup"><span data-stu-id="cfa91-446">100</span></span> | <span data-ttu-id="cfa91-447">Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-447">Internet</span></span> | * | * | <span data-ttu-id="cfa91-448">3389</span><span class="sxs-lookup"><span data-stu-id="cfa91-448">3389</span></span> | <span data-ttu-id="cfa91-449">TCP</span><span class="sxs-lookup"><span data-stu-id="cfa91-449">TCP</span></span> |
| <span data-ttu-id="cfa91-450">Allow-Inbound-HTTP-Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-450">Allow-Inbound-HTTP-Internet</span></span> | <span data-ttu-id="cfa91-451">允許</span><span class="sxs-lookup"><span data-stu-id="cfa91-451">Allow</span></span> | <span data-ttu-id="cfa91-452">200</span><span class="sxs-lookup"><span data-stu-id="cfa91-452">200</span></span> | <span data-ttu-id="cfa91-453">Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-453">Internet</span></span> | * | * | <span data-ttu-id="cfa91-454">80</span><span class="sxs-lookup"><span data-stu-id="cfa91-454">80</span></span> | <span data-ttu-id="cfa91-455">TCP</span><span class="sxs-lookup"><span data-stu-id="cfa91-455">TCP</span></span> |

> [!NOTE]
> <span data-ttu-id="cfa91-456">hello hello 一個規則的來源位址範圍是**網際網路**，不 hello 虛擬 IP 位址的 hello 負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="cfa91-456">hello source address range for hello previous rules is **Internet**, not hello virtual IP address of for hello load balancer.</span></span> <span data-ttu-id="cfa91-457">hello 來源連接埠是 *、 不 500001。</span><span class="sxs-lookup"><span data-stu-id="cfa91-457">hello source port is *, not 500001.</span></span> <span data-ttu-id="cfa91-458">針對負載平衡器 NAT 規則不會 hello 與 NSG 安全性規則相同。</span><span class="sxs-lookup"><span data-stu-id="cfa91-458">NAT rules for load balancers are not hello same as NSG security rules.</span></span> <span data-ttu-id="cfa91-459">NSG 安全性規則都相關的 toohello 原始來源和最終目的地的流量，**不**hello hello 兩者之間的負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="cfa91-459">NSG security rules are always related toohello original source and final destination of traffic, **not** hello load balancer between hello two.</span></span> 
> 
> 

### <a name="web2"></a><span data-ttu-id="cfa91-460">WEB2</span><span class="sxs-lookup"><span data-stu-id="cfa91-460">WEB2</span></span>
<span data-ttu-id="cfa91-461">**輸入規則**</span><span class="sxs-lookup"><span data-stu-id="cfa91-461">**Inbound rules**</span></span>

| <span data-ttu-id="cfa91-462">規則</span><span class="sxs-lookup"><span data-stu-id="cfa91-462">Rule</span></span> | <span data-ttu-id="cfa91-463">Access</span><span class="sxs-lookup"><span data-stu-id="cfa91-463">Access</span></span> | <span data-ttu-id="cfa91-464">優先順序</span><span class="sxs-lookup"><span data-stu-id="cfa91-464">Priority</span></span> | <span data-ttu-id="cfa91-465">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-465">Source address range</span></span> | <span data-ttu-id="cfa91-466">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-466">Source port</span></span> | <span data-ttu-id="cfa91-467">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-467">Destination address range</span></span> | <span data-ttu-id="cfa91-468">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-468">Destination port</span></span> | <span data-ttu-id="cfa91-469">通訊協定</span><span class="sxs-lookup"><span data-stu-id="cfa91-469">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="cfa91-470">Deny-Inbound-RDP-Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-470">Deny-Inbound-RDP-Internet</span></span> | <span data-ttu-id="cfa91-471">拒絕</span><span class="sxs-lookup"><span data-stu-id="cfa91-471">Deny</span></span> | <span data-ttu-id="cfa91-472">100</span><span class="sxs-lookup"><span data-stu-id="cfa91-472">100</span></span> | <span data-ttu-id="cfa91-473">Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-473">Internet</span></span> | * | * | <span data-ttu-id="cfa91-474">3389</span><span class="sxs-lookup"><span data-stu-id="cfa91-474">3389</span></span> | <span data-ttu-id="cfa91-475">TCP</span><span class="sxs-lookup"><span data-stu-id="cfa91-475">TCP</span></span> |
| <span data-ttu-id="cfa91-476">Allow-Inbound-HTTP-Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-476">Allow-Inbound-HTTP-Internet</span></span> | <span data-ttu-id="cfa91-477">允許</span><span class="sxs-lookup"><span data-stu-id="cfa91-477">Allow</span></span> | <span data-ttu-id="cfa91-478">200</span><span class="sxs-lookup"><span data-stu-id="cfa91-478">200</span></span> | <span data-ttu-id="cfa91-479">Internet</span><span class="sxs-lookup"><span data-stu-id="cfa91-479">Internet</span></span> | * | * | <span data-ttu-id="cfa91-480">80</span><span class="sxs-lookup"><span data-stu-id="cfa91-480">80</span></span> | <span data-ttu-id="cfa91-481">TCP</span><span class="sxs-lookup"><span data-stu-id="cfa91-481">TCP</span></span> |

### <a name="db-servers-management-nic"></a><span data-ttu-id="cfa91-482">DB 伺服器 (管理 NIC)</span><span class="sxs-lookup"><span data-stu-id="cfa91-482">DB servers (Management NIC)</span></span>
<span data-ttu-id="cfa91-483">**輸入規則**</span><span class="sxs-lookup"><span data-stu-id="cfa91-483">**Inbound rules**</span></span>

| <span data-ttu-id="cfa91-484">規則</span><span class="sxs-lookup"><span data-stu-id="cfa91-484">Rule</span></span> | <span data-ttu-id="cfa91-485">Access</span><span class="sxs-lookup"><span data-stu-id="cfa91-485">Access</span></span> | <span data-ttu-id="cfa91-486">優先順序</span><span class="sxs-lookup"><span data-stu-id="cfa91-486">Priority</span></span> | <span data-ttu-id="cfa91-487">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-487">Source address range</span></span> | <span data-ttu-id="cfa91-488">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-488">Source port</span></span> | <span data-ttu-id="cfa91-489">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-489">Destination address range</span></span> | <span data-ttu-id="cfa91-490">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-490">Destination port</span></span> | <span data-ttu-id="cfa91-491">通訊協定</span><span class="sxs-lookup"><span data-stu-id="cfa91-491">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="cfa91-492">Allow-Inbound-RDP-Front-end</span><span class="sxs-lookup"><span data-stu-id="cfa91-492">Allow-Inbound-RDP-Front-end</span></span> | <span data-ttu-id="cfa91-493">允許</span><span class="sxs-lookup"><span data-stu-id="cfa91-493">Allow</span></span> | <span data-ttu-id="cfa91-494">100</span><span class="sxs-lookup"><span data-stu-id="cfa91-494">100</span></span> | <span data-ttu-id="cfa91-495">192.168.1.0/24</span><span class="sxs-lookup"><span data-stu-id="cfa91-495">192.168.1.0/24</span></span> | * | * | <span data-ttu-id="cfa91-496">3389</span><span class="sxs-lookup"><span data-stu-id="cfa91-496">3389</span></span> | <span data-ttu-id="cfa91-497">TCP</span><span class="sxs-lookup"><span data-stu-id="cfa91-497">TCP</span></span> |

### <a name="db-servers-database-traffic-nic"></a><span data-ttu-id="cfa91-498">DB 伺服器 (資料庫流量 NIC)</span><span class="sxs-lookup"><span data-stu-id="cfa91-498">DB servers (Database traffic NIC)</span></span>
<span data-ttu-id="cfa91-499">**輸入規則**</span><span class="sxs-lookup"><span data-stu-id="cfa91-499">**Inbound rules**</span></span>

| <span data-ttu-id="cfa91-500">規則</span><span class="sxs-lookup"><span data-stu-id="cfa91-500">Rule</span></span> | <span data-ttu-id="cfa91-501">Access</span><span class="sxs-lookup"><span data-stu-id="cfa91-501">Access</span></span> | <span data-ttu-id="cfa91-502">優先順序</span><span class="sxs-lookup"><span data-stu-id="cfa91-502">Priority</span></span> | <span data-ttu-id="cfa91-503">來源位址範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-503">Source address range</span></span> | <span data-ttu-id="cfa91-504">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-504">Source port</span></span> | <span data-ttu-id="cfa91-505">目的地連接埠範圍</span><span class="sxs-lookup"><span data-stu-id="cfa91-505">Destination address range</span></span> | <span data-ttu-id="cfa91-506">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="cfa91-506">Destination port</span></span> | <span data-ttu-id="cfa91-507">通訊協定</span><span class="sxs-lookup"><span data-stu-id="cfa91-507">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="cfa91-508">Allow-Inbound-SQL-Front-end</span><span class="sxs-lookup"><span data-stu-id="cfa91-508">Allow-Inbound-SQL-Front-end</span></span> | <span data-ttu-id="cfa91-509">允許</span><span class="sxs-lookup"><span data-stu-id="cfa91-509">Allow</span></span> | <span data-ttu-id="cfa91-510">100</span><span class="sxs-lookup"><span data-stu-id="cfa91-510">100</span></span> | <span data-ttu-id="cfa91-511">192.168.1.0/24</span><span class="sxs-lookup"><span data-stu-id="cfa91-511">192.168.1.0/24</span></span> | * | * | <span data-ttu-id="cfa91-512">1433</span><span class="sxs-lookup"><span data-stu-id="cfa91-512">1433</span></span> | <span data-ttu-id="cfa91-513">TCP</span><span class="sxs-lookup"><span data-stu-id="cfa91-513">TCP</span></span> |

<span data-ttu-id="cfa91-514">由於某些 hello Nsg 相關聯的 tooindividual Nic，hello 規則是部署透過資源管理員的資源。</span><span class="sxs-lookup"><span data-stu-id="cfa91-514">Since some of hello NSGs are associated tooindividual NICs, hello rules are for resources deployed through Resource Manager.</span></span> <span data-ttu-id="cfa91-515">視子網路與 NIC 的關聯方式而定，會結合兩者的規則。</span><span class="sxs-lookup"><span data-stu-id="cfa91-515">Rules are combined for subnet and NIC, depending on how they are associated.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="cfa91-516">後續步驟</span><span class="sxs-lookup"><span data-stu-id="cfa91-516">Next steps</span></span>
* <span data-ttu-id="cfa91-517">[部署 NSG (Resource Manager)](virtual-networks-create-nsg-arm-pportal.md)。</span><span class="sxs-lookup"><span data-stu-id="cfa91-517">[Deploy NSGs (Resource Manager)](virtual-networks-create-nsg-arm-pportal.md).</span></span>
* <span data-ttu-id="cfa91-518">[部署 NSG (傳統)](virtual-networks-create-nsg-classic-ps.md).</span><span class="sxs-lookup"><span data-stu-id="cfa91-518">[Deploy NSGs (classic)](virtual-networks-create-nsg-classic-ps.md).</span></span>
* <span data-ttu-id="cfa91-519">[管理 NSG 記錄檔](virtual-network-nsg-manage-log.md)。</span><span class="sxs-lookup"><span data-stu-id="cfa91-519">[Manage NSG logs](virtual-network-nsg-manage-log.md).</span></span>
* <span data-ttu-id="cfa91-520">[針對 NSG 進行疑難排解] (virtual-network-nsg-troubleshoot-portal.md)</span><span class="sxs-lookup"><span data-stu-id="cfa91-520">[Troubleshoot NSGs] (virtual-network-nsg-troubleshoot-portal.md)</span></span>
