---
title: "Azure 虛擬網路 (VNet) 規劃與設計指南 | Microsoft Docs"
description: "了解如何根據您的隔離、連線和位置需求，在 Azure 中規劃及設計虛擬網路。"
services: virtual-network
documentationcenter: na
author: jimdial
manager: carmonm
editor: tysonn
ms.assetid: 3a4a9aea-7608-4d2e-bb3c-40de2e537200
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/08/2016
ms.author: jdial
ms.openlocfilehash: 9a0126235c9ff3fec05d7709bdee95ab4832a33b
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/18/2017
---
# <a name="plan-and-design-azure-virtual-networks"></a><span data-ttu-id="4328f-103">規劃和設計 Azure 虛擬網路</span><span class="sxs-lookup"><span data-stu-id="4328f-103">Plan and design Azure Virtual Networks</span></span>
<span data-ttu-id="4328f-104">建立要實驗的 VNet 很簡單，但關鍵在於，您會隨著時間部署多個 Vnet，以支援您的組織的生產需求。</span><span class="sxs-lookup"><span data-stu-id="4328f-104">Creating a VNet to experiment with is easy enough, but chances are, you will deploy multiple VNets over time to support the production needs of your organization.</span></span> <span data-ttu-id="4328f-105">經過一些規劃和設計，您就能夠部署 Vnet 且更有效率地連接您所需的資源。</span><span class="sxs-lookup"><span data-stu-id="4328f-105">With some planning and design, you will be able to deploy VNets and connect the resources you need more effectively.</span></span> <span data-ttu-id="4328f-106">如果您不熟悉 VNet，建議您先[了解 Vnet](virtual-networks-overview.md) 及[如何部署](virtual-networks-create-vnet-arm-pportal.md) Vnet，再繼續執行。</span><span class="sxs-lookup"><span data-stu-id="4328f-106">If you are not familiar with VNets, it's recommended that you [learn about VNets](virtual-networks-overview.md) and [how to deploy](virtual-networks-create-vnet-arm-pportal.md) one before proceeding.</span></span>

## <a name="plan"></a><span data-ttu-id="4328f-107">規劃</span><span class="sxs-lookup"><span data-stu-id="4328f-107">Plan</span></span>
<span data-ttu-id="4328f-108">徹底了解 Azure 訂用帳戶、區域和網路資源是成功的關鍵。</span><span class="sxs-lookup"><span data-stu-id="4328f-108">A thorough understanding of Azure subscriptions, regions, and network resources is critical for success.</span></span> <span data-ttu-id="4328f-109">您可以使用以下的考量事項清單做為起點。</span><span class="sxs-lookup"><span data-stu-id="4328f-109">You can use the list of considerations below as a starting point.</span></span> <span data-ttu-id="4328f-110">一旦了解這些考量，您即可定義網路設計需求。</span><span class="sxs-lookup"><span data-stu-id="4328f-110">Once you understand those considerations, you can define the requirements for your network design.</span></span>

### <a name="considerations"></a><span data-ttu-id="4328f-111">考量</span><span class="sxs-lookup"><span data-stu-id="4328f-111">Considerations</span></span>
<span data-ttu-id="4328f-112">在回答底下的規劃問題之前，請先考慮下列各項：</span><span class="sxs-lookup"><span data-stu-id="4328f-112">Before answering the planning questions below, consider the following:</span></span>

* <span data-ttu-id="4328f-113">您在 Azure 中建立的所有項目都是由一或多個資源所組成。</span><span class="sxs-lookup"><span data-stu-id="4328f-113">Everything you create in Azure is composed of one or more resources.</span></span> <span data-ttu-id="4328f-114">虛擬機器 (VM) 是資源、VM 所用的網路介面卡 (NIC) 是資源、NIC 所用的公用 IP 位址是資源、NIC 所連接的 VNet 是資源。</span><span class="sxs-lookup"><span data-stu-id="4328f-114">A virtual machine (VM) is a resource, the network adapter interface (NIC) used by a VM is a resource, the public IP address used by a NIC is a resource, the VNet the NIC is connected to is a resource.</span></span>
* <span data-ttu-id="4328f-115">您可在 [Azure 區域](https://azure.microsoft.com/regions/#services) 和訂用帳戶中建立資源。</span><span class="sxs-lookup"><span data-stu-id="4328f-115">You create resources within an [Azure region](https://azure.microsoft.com/regions/#services) and subscription.</span></span> <span data-ttu-id="4328f-116">而系統只能裝資源連線到與資源所在相同區域和訂用帳戶中的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="4328f-116">Resources can only be connected to a virtual network that exists in the same region and subscription the resource is in.</span></span>
* <span data-ttu-id="4328f-117">您可以使用以下方式，彼此連線至虛擬網路：</span><span class="sxs-lookup"><span data-stu-id="4328f-117">You can connect virtual networks to each other by using:</span></span>
    * <span data-ttu-id="4328f-118">**[虛擬網路對等互連](virtual-network-peering-overview.md)**：虛擬網路必須存在於同一個 Azure 區域中。</span><span class="sxs-lookup"><span data-stu-id="4328f-118">**[Virtual network peering](virtual-network-peering-overview.md)**: The virtual networks must exist in the same Azure region.</span></span> <span data-ttu-id="4328f-119">對等互連虛擬網路中資源間的頻寬會相同，就像資源已連線至相同的虛擬網路一樣。</span><span class="sxs-lookup"><span data-stu-id="4328f-119">Bandwidth between resources in peered virtual networks is the same as if the resources were connected to the same virtual network.</span></span>
    * <span data-ttu-id="4328f-120">**Azure [VPN 閘道](../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md)**：虛擬網路可以位於相同或不同的 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="4328f-120">**An Azure [VPN Gateway](../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md)**: The virtual networks can exist in the same, or different Azure regions.</span></span> <span data-ttu-id="4328f-121">透過 VPN 閘道連線之虛擬網路中的資源間的頻寬，受限於 VPN 閘道的頻寬。</span><span class="sxs-lookup"><span data-stu-id="4328f-121">Bandwidth between resources in virtual networks connected through a VPN Gateway is limited by the bandwidth of the VPN Gateway.</span></span>
* <span data-ttu-id="4328f-122">您可以使用 Azure 中提供的其中一個[連線選項](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)，將 VNet 連接到內部部署網路。</span><span class="sxs-lookup"><span data-stu-id="4328f-122">You can connect VNets to your on-premises network by using one of the [connectivity options](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti) available in Azure.</span></span>
* <span data-ttu-id="4328f-123">不同的資源可以聚集在[資源群組](../azure-resource-manager/resource-group-overview.md#resource-groups)中，以便更容易以單位形式管理資源。</span><span class="sxs-lookup"><span data-stu-id="4328f-123">Different resources can be grouped together in [resource groups](../azure-resource-manager/resource-group-overview.md#resource-groups), making it easier to manage the resource as a unit.</span></span> <span data-ttu-id="4328f-124">資源群組可以包含來自多個區域的資源，只要資源屬於相同的訂用帳戶即可。</span><span class="sxs-lookup"><span data-stu-id="4328f-124">A resource group can contain resources from multiple regions, as long as the resources belong to the same subscription.</span></span>

### <a name="define-requirements"></a><span data-ttu-id="4328f-125">定義需求</span><span class="sxs-lookup"><span data-stu-id="4328f-125">Define requirements</span></span>
<span data-ttu-id="4328f-126">使用下列問題做為您的 Azure 網路設計起點。</span><span class="sxs-lookup"><span data-stu-id="4328f-126">Use the questions below as a starting point for your Azure network design.</span></span>    

1. <span data-ttu-id="4328f-127">您會使用哪些 Azure 位置來託管 Vnet？</span><span class="sxs-lookup"><span data-stu-id="4328f-127">What Azure locations will you use to host VNets?</span></span>
2. <span data-ttu-id="4328f-128">您是否需要在這些 Azure 位置之間提供通訊？</span><span class="sxs-lookup"><span data-stu-id="4328f-128">Do you need to provide communication between these Azure locations?</span></span>
3. <span data-ttu-id="4328f-129">您是否需要提供 Azure VNet 與您的內部部署資料中心之間的通訊？</span><span class="sxs-lookup"><span data-stu-id="4328f-129">Do you need to provide communication between your Azure VNet(s) and your on-premises datacenter(s)?</span></span>
4. <span data-ttu-id="4328f-130">您的解決方式需要多少個基礎結構即服務 (IaaS) VM、雲端服務角色和 Web 應用程式？</span><span class="sxs-lookup"><span data-stu-id="4328f-130">How many Infrastructure as a Service (IaaS) VMs, cloud services roles, and web apps do you need for your solution?</span></span>
5. <span data-ttu-id="4328f-131">您是否需要根據 VM 群組隔離流量 (也就是前端 Web 伺服器和後端資料庫伺服器)？</span><span class="sxs-lookup"><span data-stu-id="4328f-131">Do you need to isolate traffic based on groups of VMs (i.e. front end web servers and back end database servers)?</span></span>
6. <span data-ttu-id="4328f-132">您是否需要使用虛擬應用裝置來控制流量？</span><span class="sxs-lookup"><span data-stu-id="4328f-132">Do you need to control traffic flow using virtual appliances?</span></span>
7. <span data-ttu-id="4328f-133">使用者是否需要不同 Azure 資源的不同權限？</span><span class="sxs-lookup"><span data-stu-id="4328f-133">Do users need different sets of permissions to different Azure resources?</span></span>

### <a name="understand-vnet-and-subnet-properties"></a><span data-ttu-id="4328f-134">了解 VNet 和子網路屬性</span><span class="sxs-lookup"><span data-stu-id="4328f-134">Understand VNet and subnet properties</span></span>
<span data-ttu-id="4328f-135">VNet 和子網路資源有助於定義在 Azure 中執行之工作負載的安全性範圍。</span><span class="sxs-lookup"><span data-stu-id="4328f-135">VNet and subnets resources help define a security boundary for workloads running in Azure.</span></span> <span data-ttu-id="4328f-136">VNET 可由一組位址空間集合所界定 (此集合定義為 CIDR 區塊)。</span><span class="sxs-lookup"><span data-stu-id="4328f-136">A VNet is characterized by a collection of address spaces, defined as CIDR blocks.</span></span>

> [!NOTE]
> <span data-ttu-id="4328f-137">網路管理員都熟悉 CIDR 標記法。</span><span class="sxs-lookup"><span data-stu-id="4328f-137">Network administrators are familiar with CIDR notation.</span></span> <span data-ttu-id="4328f-138">如果您不熟悉 CIDR，請 [深入了解](http://whatismyipaddress.com/cidr)。</span><span class="sxs-lookup"><span data-stu-id="4328f-138">If you are not familiar with CIDR, [learn more about it](http://whatismyipaddress.com/cidr).</span></span>
>
>

<span data-ttu-id="4328f-139">VNET 包含下列屬性：</span><span class="sxs-lookup"><span data-stu-id="4328f-139">VNets contain the following properties.</span></span>

| <span data-ttu-id="4328f-140">屬性</span><span class="sxs-lookup"><span data-stu-id="4328f-140">Property</span></span> | <span data-ttu-id="4328f-141">說明</span><span class="sxs-lookup"><span data-stu-id="4328f-141">Description</span></span> | <span data-ttu-id="4328f-142">條件約束</span><span class="sxs-lookup"><span data-stu-id="4328f-142">Constraints</span></span> |
| --- | --- | --- |
| <span data-ttu-id="4328f-143">**name**</span><span class="sxs-lookup"><span data-stu-id="4328f-143">**name**</span></span> |<span data-ttu-id="4328f-144">VNet 名稱</span><span class="sxs-lookup"><span data-stu-id="4328f-144">VNet name</span></span> |<span data-ttu-id="4328f-145">最多 80 個字元的字串。</span><span class="sxs-lookup"><span data-stu-id="4328f-145">String of up to 80 characters.</span></span> <span data-ttu-id="4328f-146">可以包含字母、數字、底線、句號或連字號。</span><span class="sxs-lookup"><span data-stu-id="4328f-146">May contain letters, numbers, underscore, periods, or hyphens.</span></span> <span data-ttu-id="4328f-147">必須以字母或數字開頭。</span><span class="sxs-lookup"><span data-stu-id="4328f-147">Must start with a letter or number.</span></span> <span data-ttu-id="4328f-148">必須以字母、數字或底線結尾。</span><span class="sxs-lookup"><span data-stu-id="4328f-148">Must end with a letter, number, or underscore.</span></span> <span data-ttu-id="4328f-149">可以包含大寫或小寫字母。</span><span class="sxs-lookup"><span data-stu-id="4328f-149">Can contains upper or lower case letters.</span></span> |
| <span data-ttu-id="4328f-150">**位置**</span><span class="sxs-lookup"><span data-stu-id="4328f-150">**location**</span></span> |<span data-ttu-id="4328f-151">Azure 位置 (也稱為區域)。</span><span class="sxs-lookup"><span data-stu-id="4328f-151">Azure location (also referred to as region).</span></span> |<span data-ttu-id="4328f-152">必須是其中一個有效的 Azure 位置。</span><span class="sxs-lookup"><span data-stu-id="4328f-152">Must be one of the valid Azure locations.</span></span> |
| <span data-ttu-id="4328f-153">**addressSpace**</span><span class="sxs-lookup"><span data-stu-id="4328f-153">**addressSpace**</span></span> |<span data-ttu-id="4328f-154">CIDR 標記法中，構成 VNET 的位址首碼的集合。</span><span class="sxs-lookup"><span data-stu-id="4328f-154">Collection of address prefixes that make up the VNet in CIDR notation.</span></span> |<span data-ttu-id="4328f-155">必須是有效的 CIDR 位址區塊陣列，包括公用 IP 位址範圍。</span><span class="sxs-lookup"><span data-stu-id="4328f-155">Must be an array of valid CIDR address blocks, including public IP address ranges.</span></span> |
| <span data-ttu-id="4328f-156">**子網路**</span><span class="sxs-lookup"><span data-stu-id="4328f-156">**subnets**</span></span> |<span data-ttu-id="4328f-157">構成 VNET 的子網路的集合</span><span class="sxs-lookup"><span data-stu-id="4328f-157">Collection of subnets that make up the VNet</span></span> |<span data-ttu-id="4328f-158">請參閱下面的子網路屬性表格。</span><span class="sxs-lookup"><span data-stu-id="4328f-158">see the subnet properties table below.</span></span> |
| <span data-ttu-id="4328f-159">**dhcpOptions**</span><span class="sxs-lookup"><span data-stu-id="4328f-159">**dhcpOptions**</span></span> |<span data-ttu-id="4328f-160">包含名為 **dnsServers**之單一必要屬性的物件。</span><span class="sxs-lookup"><span data-stu-id="4328f-160">Object that contains a single required property named **dnsServers**.</span></span> | |
| <span data-ttu-id="4328f-161">**dnsServers**</span><span class="sxs-lookup"><span data-stu-id="4328f-161">**dnsServers**</span></span> |<span data-ttu-id="4328f-162">VNet 所使用的 DNS 伺服器陣列。</span><span class="sxs-lookup"><span data-stu-id="4328f-162">Array of DNS servers used by the VNet.</span></span> <span data-ttu-id="4328f-163">如果未指定任何伺服器，則會使用 Azure 內部名稱解析。</span><span class="sxs-lookup"><span data-stu-id="4328f-163">If no server is specified, Azure internal name resolution is used.</span></span> |<span data-ttu-id="4328f-164">必須是最多 10 個 DNS 伺服器的陣列 (依 IP 位址排列)。</span><span class="sxs-lookup"><span data-stu-id="4328f-164">Must be an array of up to 10 DNS servers, by IP address.</span></span> |

<span data-ttu-id="4328f-165">子網路是 VNET 的子資源，而且有助於使用 IP 位址首碼來定義 CIDR 區塊內位址空間的區段。</span><span class="sxs-lookup"><span data-stu-id="4328f-165">A subnet is a child resource of a VNet, and helps define segments of address spaces within a CIDR block, using IP address prefixes.</span></span> <span data-ttu-id="4328f-166">NIC 可以加入子網路和連接到 VM，提供各種工作負載的連線。</span><span class="sxs-lookup"><span data-stu-id="4328f-166">NICs can be added to subnets, and connected to VMs, providing connectivity for various workloads.</span></span>

<span data-ttu-id="4328f-167">子網路包含下列屬性：</span><span class="sxs-lookup"><span data-stu-id="4328f-167">Subnets contain the following properties.</span></span>

| <span data-ttu-id="4328f-168">屬性</span><span class="sxs-lookup"><span data-stu-id="4328f-168">Property</span></span> | <span data-ttu-id="4328f-169">說明</span><span class="sxs-lookup"><span data-stu-id="4328f-169">Description</span></span> | <span data-ttu-id="4328f-170">條件約束</span><span class="sxs-lookup"><span data-stu-id="4328f-170">Constraints</span></span> |
| --- | --- | --- |
| <span data-ttu-id="4328f-171">**name**</span><span class="sxs-lookup"><span data-stu-id="4328f-171">**name**</span></span> |<span data-ttu-id="4328f-172">子網路名稱</span><span class="sxs-lookup"><span data-stu-id="4328f-172">Subnet name</span></span> |<span data-ttu-id="4328f-173">最多 80 個字元的字串。</span><span class="sxs-lookup"><span data-stu-id="4328f-173">String of up to 80 characters.</span></span> <span data-ttu-id="4328f-174">可以包含字母、數字、底線、句號或連字號。</span><span class="sxs-lookup"><span data-stu-id="4328f-174">May contain letters, numbers, underscore, periods, or hyphens.</span></span> <span data-ttu-id="4328f-175">必須以字母或數字開頭。</span><span class="sxs-lookup"><span data-stu-id="4328f-175">Must start with a letter or number.</span></span> <span data-ttu-id="4328f-176">必須以字母、數字或底線結尾。</span><span class="sxs-lookup"><span data-stu-id="4328f-176">Must end with a letter, number, or underscore.</span></span> <span data-ttu-id="4328f-177">可以包含大寫或小寫字母。</span><span class="sxs-lookup"><span data-stu-id="4328f-177">Can contains upper or lower case letters.</span></span> |
| <span data-ttu-id="4328f-178">**位置**</span><span class="sxs-lookup"><span data-stu-id="4328f-178">**location**</span></span> |<span data-ttu-id="4328f-179">Azure 位置 (也稱為區域)。</span><span class="sxs-lookup"><span data-stu-id="4328f-179">Azure location (also referred to as region).</span></span> |<span data-ttu-id="4328f-180">必須是其中一個有效的 Azure 位置。</span><span class="sxs-lookup"><span data-stu-id="4328f-180">Must be one of the valid Azure locations.</span></span> |
| <span data-ttu-id="4328f-181">**addressPrefix**</span><span class="sxs-lookup"><span data-stu-id="4328f-181">**addressPrefix**</span></span> |<span data-ttu-id="4328f-182">CIDR 標記法中，構成的子網路的單一位址首碼</span><span class="sxs-lookup"><span data-stu-id="4328f-182">Single address prefix that make up the subnet in CIDR notation</span></span> |<span data-ttu-id="4328f-183">必須是屬於 VNet 的其中一個位址空間的單一 CIDR 區塊。</span><span class="sxs-lookup"><span data-stu-id="4328f-183">Must be a single CIDR block that is part of one of the VNet's address spaces.</span></span> |
| <span data-ttu-id="4328f-184">**networkSecurityGroup**</span><span class="sxs-lookup"><span data-stu-id="4328f-184">**networkSecurityGroup**</span></span> |<span data-ttu-id="4328f-185">套用至子網路的 NSG</span><span class="sxs-lookup"><span data-stu-id="4328f-185">NSG applied to the subnet</span></span> | |
| <span data-ttu-id="4328f-186">**routeTable**</span><span class="sxs-lookup"><span data-stu-id="4328f-186">**routeTable**</span></span> |<span data-ttu-id="4328f-187">套用至子網路的路由表</span><span class="sxs-lookup"><span data-stu-id="4328f-187">Route table applied to the subnet</span></span> | |
| <span data-ttu-id="4328f-188">**ipConfigurations**</span><span class="sxs-lookup"><span data-stu-id="4328f-188">**ipConfigurations**</span></span> |<span data-ttu-id="4328f-189">NIC 用於連線至子網路的 IP 設定物件的集合</span><span class="sxs-lookup"><span data-stu-id="4328f-189">Collection of IP configuration objects used by NICs connected to the subnet</span></span> | |

### <a name="name-resolution"></a><span data-ttu-id="4328f-190">名稱解析</span><span class="sxs-lookup"><span data-stu-id="4328f-190">Name resolution</span></span>
<span data-ttu-id="4328f-191">根據預設，您的 VNet 會使用 [Azure 提供的名稱解析](virtual-networks-name-resolution-for-vms-and-role-instances.md)來解析 VNet 內部和公用網際網路上的名稱。</span><span class="sxs-lookup"><span data-stu-id="4328f-191">By default, your VNet uses [Azure-provided name resolution](virtual-networks-name-resolution-for-vms-and-role-instances.md) to resolve names inside the VNet, and on the public Internet.</span></span> <span data-ttu-id="4328f-192">不過，如果您要將 Vnet 連接到您的內部部署資料中心，您需要提供 [自己的 DNS 伺服器](virtual-networks-name-resolution-for-vms-and-role-instances.md) 來解析您網路之間的名稱。</span><span class="sxs-lookup"><span data-stu-id="4328f-192">However, if you connect your VNets to your on-premises data centers, you need to provide [your own DNS server](virtual-networks-name-resolution-for-vms-and-role-instances.md) to resolve names between your networks.</span></span>  

### <a name="limits"></a><span data-ttu-id="4328f-193">限制</span><span class="sxs-lookup"><span data-stu-id="4328f-193">Limits</span></span>
<span data-ttu-id="4328f-194">請檢閱 [Azure 限制](../azure-subscription-service-limits.md#networking-limits)一文中的網路功能限制，以確保您的設計未與任何限制發生衝突。</span><span class="sxs-lookup"><span data-stu-id="4328f-194">Review the networking limits in the [Azure limits](../azure-subscription-service-limits.md#networking-limits) article to ensure that your design doesn't conflict with any of the limits.</span></span> <span data-ttu-id="4328f-195">您可以開啟支援票證來提高部分限制。</span><span class="sxs-lookup"><span data-stu-id="4328f-195">Some limits can be increased by opening a support ticket.</span></span>

### <a name="role-based-access-control-rbac"></a><span data-ttu-id="4328f-196">角色型存取控制 (RBAC)</span><span class="sxs-lookup"><span data-stu-id="4328f-196">Role-Based Access Control (RBAC)</span></span>
<span data-ttu-id="4328f-197">您可以使用 [Azure RBAC](../active-directory/role-based-access-built-in-roles.md) 來控制不同使用者對於 Azure 中不同資源的存取層級。</span><span class="sxs-lookup"><span data-stu-id="4328f-197">You can use [Azure RBAC](../active-directory/role-based-access-built-in-roles.md) to control the level of access different users may have to different resources in Azure.</span></span> <span data-ttu-id="4328f-198">如此一來，您可以根據小組需求分隔其所完成的工作。</span><span class="sxs-lookup"><span data-stu-id="4328f-198">That way you can segregate the work done by your team based on their needs.</span></span>

<span data-ttu-id="4328f-199">只要已連接虛擬網路，具備 **網路參與者** 角色的使用者即可完全控制 Azure 資源管理員的虛擬網路資源。</span><span class="sxs-lookup"><span data-stu-id="4328f-199">As far as virtual networks are concerned, users in the **Network Contributor** role have full control over Azure Resource Manager virtual network resources.</span></span> <span data-ttu-id="4328f-200">同樣地，具備 **傳統網路參與者** 角色的使用者可完全控制傳統的虛擬網路資源。</span><span class="sxs-lookup"><span data-stu-id="4328f-200">Similarly, users in the **Classic Network Contributor** role have full control over classic virtual network resources.</span></span>

> [!NOTE]
> <span data-ttu-id="4328f-201">您也可以 [建立自己的角色](../active-directory/role-based-access-control-configure.md) ，以區分您的系統管理需求。</span><span class="sxs-lookup"><span data-stu-id="4328f-201">You can also [create your own roles](../active-directory/role-based-access-control-configure.md) to separate your administrative needs.</span></span>
>
>

## <a name="design"></a><span data-ttu-id="4328f-202">設計</span><span class="sxs-lookup"><span data-stu-id="4328f-202">Design</span></span>
<span data-ttu-id="4328f-203">一旦您知道 [計劃](#Plan) 小節中問題的答案，在定義您的 VNet 之前，請檢閱下列項目。</span><span class="sxs-lookup"><span data-stu-id="4328f-203">Once you know the answers to the questions in the [Plan](#Plan) section, review the following before defining your VNets.</span></span>

### <a name="number-of-subscriptions-and-vnets"></a><span data-ttu-id="4328f-204">訂用帳戶和 VNet 數目</span><span class="sxs-lookup"><span data-stu-id="4328f-204">Number of subscriptions and VNets</span></span>
<span data-ttu-id="4328f-205">您應該考慮在下列情況下建立多個 Vnet：</span><span class="sxs-lookup"><span data-stu-id="4328f-205">You should consider creating multiple VNets in the following scenarios:</span></span>

* <span data-ttu-id="4328f-206">**需要放在不同 Azure 位置的 VM**。</span><span class="sxs-lookup"><span data-stu-id="4328f-206">**VMs that need to be placed in different Azure locations**.</span></span> <span data-ttu-id="4328f-207">Azure 中的 Vnet 有區域性。</span><span class="sxs-lookup"><span data-stu-id="4328f-207">VNets in Azure are regional.</span></span> <span data-ttu-id="4328f-208">不能跨區使用。</span><span class="sxs-lookup"><span data-stu-id="4328f-208">They cannot span locations.</span></span> <span data-ttu-id="4328f-209">因此，對於您要託管 VM 的每個 Azure 位置，至少需要有一個 VNet。</span><span class="sxs-lookup"><span data-stu-id="4328f-209">Therefore you need at least one VNet for each Azure location you want to host VMs in.</span></span>
* <span data-ttu-id="4328f-210">**工作負載必須彼此完全分隔**。</span><span class="sxs-lookup"><span data-stu-id="4328f-210">**Workloads that need to be completely isolated from one another**.</span></span> <span data-ttu-id="4328f-211">您可以建立個別的 VNet (其甚至使用相同的 IP 位址空間)，以找出彼此不同的工作負載。</span><span class="sxs-lookup"><span data-stu-id="4328f-211">You can create separate VNets, that even use the same IP address spaces, to isolate different workloads from one another.</span></span>

<span data-ttu-id="4328f-212">請記住，您在上面看見的限制是依每個區域、每個訂用帳戶而定。</span><span class="sxs-lookup"><span data-stu-id="4328f-212">Keep in mind that the limits you see above are per region, per subscription.</span></span> <span data-ttu-id="4328f-213">這表示您可以使用多個訂用帳戶，以增加能夠在 Azure 中維護的資源限制。</span><span class="sxs-lookup"><span data-stu-id="4328f-213">That means you can use multiple subscriptions to increase the limit of resources you can maintain in Azure.</span></span> <span data-ttu-id="4328f-214">您可以使用站對站 VPN 或 ExpressRoute 電路來連接不同訂用帳戶中的 Vnet。</span><span class="sxs-lookup"><span data-stu-id="4328f-214">You can use a site-to-site VPN, or an ExpressRoute circuit, to connect VNets in different subscriptions.</span></span>

### <a name="subscription-and-vnet-design-patterns"></a><span data-ttu-id="4328f-215">訂用帳戶和 VNet 設計模式</span><span class="sxs-lookup"><span data-stu-id="4328f-215">Subscription and VNet design patterns</span></span>
<span data-ttu-id="4328f-216">下表顯示使用訂用帳戶和 Vnet 的一些常見的設計模式。</span><span class="sxs-lookup"><span data-stu-id="4328f-216">The table below shows some common design patterns for using subscriptions and VNets.</span></span>

| <span data-ttu-id="4328f-217">案例</span><span class="sxs-lookup"><span data-stu-id="4328f-217">Scenario</span></span> | <span data-ttu-id="4328f-218">圖表</span><span class="sxs-lookup"><span data-stu-id="4328f-218">Diagram</span></span> | <span data-ttu-id="4328f-219">優點</span><span class="sxs-lookup"><span data-stu-id="4328f-219">Pros</span></span> | <span data-ttu-id="4328f-220">缺點</span><span class="sxs-lookup"><span data-stu-id="4328f-220">Cons</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="4328f-221">單一訂用帳戶，每個應用程式有兩個 Vnet</span><span class="sxs-lookup"><span data-stu-id="4328f-221">Single subscription, two VNets per app</span></span> |![單一訂用帳戶](./media/virtual-network-vnet-plan-design-arm/figure1.png) |<span data-ttu-id="4328f-223">只要管理一個訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="4328f-223">Only one subscription to manage.</span></span> |<span data-ttu-id="4328f-224">每個 Azure 區域的 VNet 數目上限。</span><span class="sxs-lookup"><span data-stu-id="4328f-224">Maximum number of VNets per Azure region.</span></span> <span data-ttu-id="4328f-225">您之後會需要更多訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="4328f-225">You need more subscriptions after that.</span></span> <span data-ttu-id="4328f-226">請檢閱 [Azure 限制](../azure-subscription-service-limits.md#networking-limits)一文以了解詳細資料。</span><span class="sxs-lookup"><span data-stu-id="4328f-226">Review the [Azure limits](../azure-subscription-service-limits.md#networking-limits) article for details.</span></span> |
| <span data-ttu-id="4328f-227">每個應用程式有一個訂用帳戶，每個應用程式有兩個 VNet</span><span class="sxs-lookup"><span data-stu-id="4328f-227">One subscription per app, two VNets per app</span></span> |![單一訂用帳戶](./media/virtual-network-vnet-plan-design-arm/figure2.png) |<span data-ttu-id="4328f-229">每個訂用帳戶只使用兩個 VNet。</span><span class="sxs-lookup"><span data-stu-id="4328f-229">Uses only two VNets per subscription.</span></span> |<span data-ttu-id="4328f-230">應用程式過多時會比較難以管理。</span><span class="sxs-lookup"><span data-stu-id="4328f-230">Harder to manage when there are too many apps.</span></span> |
| <span data-ttu-id="4328f-231">每個業務單位有一個訂用帳戶，每個應用程式有兩個 VNet。</span><span class="sxs-lookup"><span data-stu-id="4328f-231">One subscription per business unit, two VNets per app.</span></span> |![單一訂用帳戶](./media/virtual-network-vnet-plan-design-arm/figure3.png) |<span data-ttu-id="4328f-233">平衡訂用帳戶與 VNet 的數目。</span><span class="sxs-lookup"><span data-stu-id="4328f-233">Balance between number of subscriptions and VNets.</span></span> |<span data-ttu-id="4328f-234">每個業務單位 (訂用帳戶) 的 VNet 數目上限。</span><span class="sxs-lookup"><span data-stu-id="4328f-234">Maximum number of VNets per business unit (subscription).</span></span> <span data-ttu-id="4328f-235">請檢閱 [Azure 限制](../azure-subscription-service-limits.md#networking-limits)一文以了解詳細資料。</span><span class="sxs-lookup"><span data-stu-id="4328f-235">Review the [Azure limits](../azure-subscription-service-limits.md#networking-limits) article for details.</span></span> |
| <span data-ttu-id="4328f-236">每個業務單位有一個訂用帳戶，每個應用程式群組有兩個 VNet。</span><span class="sxs-lookup"><span data-stu-id="4328f-236">One subscription per business unit, two VNets per group of apps.</span></span> |![單一訂用帳戶](./media/virtual-network-vnet-plan-design-arm/figure4.png) |<span data-ttu-id="4328f-238">平衡訂用帳戶與 VNet 的數目。</span><span class="sxs-lookup"><span data-stu-id="4328f-238">Balance between number of subscriptions and VNets.</span></span> |<span data-ttu-id="4328f-239">必須使用子網路和 NSG 隔離應用程式。</span><span class="sxs-lookup"><span data-stu-id="4328f-239">Apps must be isolated by using subnets and NSGs.</span></span> |

### <a name="number-of-subnets"></a><span data-ttu-id="4328f-240">子網路數目</span><span class="sxs-lookup"><span data-stu-id="4328f-240">Number of subnets</span></span>
<span data-ttu-id="4328f-241">您應該考慮在下列情況下，在一個 VNet 中建立多個子網路：</span><span class="sxs-lookup"><span data-stu-id="4328f-241">You should consider multiple subnets in a VNet in the following scenarios:</span></span>

* <span data-ttu-id="4328f-242">**子網路中的所有 NIC 沒有足夠的私人 IP 位址**。</span><span class="sxs-lookup"><span data-stu-id="4328f-242">**Not enough private IP addresses for all NICs in a subnet**.</span></span> <span data-ttu-id="4328f-243">如果您的子網路位址空間包含的 IP 位址不足以支援子網路中的 NIC 數目，則需要建立多個子網路。</span><span class="sxs-lookup"><span data-stu-id="4328f-243">If your subnet address space does not contain enough IP addresses for the number of NICs in the subnet, you need to create multiple subnets.</span></span> <span data-ttu-id="4328f-244">請記住，Azure 會在每個子網路中保留 5 個不能使用的私人 IP 位址：位址空間的第一個和最後一個位址 (用於子網路位址，以及多點傳送) 以及要內部使用的 3 個位址 (用於 DHCP 和 DNS)。</span><span class="sxs-lookup"><span data-stu-id="4328f-244">Keep in mind that Azure reserves 5 private IP addresses from each subnet that cannot be used: the first and last addresses of the address space (for the subnet address, and multicast) and 3 addresses to be used internally (for DHCP and DNS purposes).</span></span>
* <span data-ttu-id="4328f-245">**安全性**。</span><span class="sxs-lookup"><span data-stu-id="4328f-245">**Security**.</span></span> <span data-ttu-id="4328f-246">您可以使用子網路分隔有多層結構的工作負載 VM 群組，然後對這些子網路套用不同的 [網路安全性群組 (NSG)](virtual-networks-nsg.md#subnets) 。</span><span class="sxs-lookup"><span data-stu-id="4328f-246">You can use subnets to separate groups of VMs from one another for workloads that have a multi-layer structure, and apply different [network security groups (NSGs)](virtual-networks-nsg.md#subnets) for those subnets.</span></span>
* <span data-ttu-id="4328f-247">**混合式連線**。</span><span class="sxs-lookup"><span data-stu-id="4328f-247">**Hybrid connectivity**.</span></span> <span data-ttu-id="4328f-248">您可以使用 VPN 閘道與 ExpressRoute 電路讓 VNet 彼此[連接](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)，以及連接至您的內部部署資料中心。</span><span class="sxs-lookup"><span data-stu-id="4328f-248">You can use VPN gateways and ExpressRoute circuits to [connect](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti) your VNets to one another, and to your on-premises data center(s).</span></span> <span data-ttu-id="4328f-249">VPN 閘道與 ExpressRoute 電路需要建立自己的子網路。</span><span class="sxs-lookup"><span data-stu-id="4328f-249">VPN gateways and ExpressRoute circuits require a subnet of their own to be created.</span></span>
* <span data-ttu-id="4328f-250">**虛擬應用裝置**。</span><span class="sxs-lookup"><span data-stu-id="4328f-250">**Virtual appliances**.</span></span> <span data-ttu-id="4328f-251">您可以在 Azure VNet 中使用虛擬應用裝置，例如防火牆、WAN 加速器或 VPN 閘道。</span><span class="sxs-lookup"><span data-stu-id="4328f-251">You can use a virtual appliance, such as a firewall, WAN accelerator, or VPN gateway in an Azure VNet.</span></span> <span data-ttu-id="4328f-252">當您這樣做時，需要 [將傳送流量路由](virtual-networks-udr-overview.md) 到這些應用裝置，並將它們隔離在自己的子網路中。</span><span class="sxs-lookup"><span data-stu-id="4328f-252">When you do so, you need to [route traffic](virtual-networks-udr-overview.md) to those appliances and isolate them in their own subnet.</span></span>

### <a name="subnet-and-nsg-design-patterns"></a><span data-ttu-id="4328f-253">子網路和 NSG 設計模式</span><span class="sxs-lookup"><span data-stu-id="4328f-253">Subnet and NSG design patterns</span></span>
<span data-ttu-id="4328f-254">下表顯示使用子網路的一些常見的設計模式。</span><span class="sxs-lookup"><span data-stu-id="4328f-254">The table below shows some common design patterns for using subnets.</span></span>

| <span data-ttu-id="4328f-255">案例</span><span class="sxs-lookup"><span data-stu-id="4328f-255">Scenario</span></span> | <span data-ttu-id="4328f-256">圖表</span><span class="sxs-lookup"><span data-stu-id="4328f-256">Diagram</span></span> | <span data-ttu-id="4328f-257">優點</span><span class="sxs-lookup"><span data-stu-id="4328f-257">Pros</span></span> | <span data-ttu-id="4328f-258">缺點</span><span class="sxs-lookup"><span data-stu-id="4328f-258">Cons</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="4328f-259">單一子網路，每個應用程式層的每個應用程式有多個 NSG</span><span class="sxs-lookup"><span data-stu-id="4328f-259">Single subnet, NSGs per application layer, per app</span></span> |![單一子網路](./media/virtual-network-vnet-plan-design-arm/figure5.png) |<span data-ttu-id="4328f-261">只要管理一個子網路。</span><span class="sxs-lookup"><span data-stu-id="4328f-261">Only one subnet to manage.</span></span> |<span data-ttu-id="4328f-262">隔離每個應用程式所需的多個 NSG。</span><span class="sxs-lookup"><span data-stu-id="4328f-262">Multiple NSGs necessary to isolate each application.</span></span> |
| <span data-ttu-id="4328f-263">每個應用程式有一個子網路，每個應用程式層有多個 NSG</span><span class="sxs-lookup"><span data-stu-id="4328f-263">One subnet per app, NSGs per application layer</span></span> |![每個應用程式的子網路](./media/virtual-network-vnet-plan-design-arm/figure6.png) |<span data-ttu-id="4328f-265">要管理的 NSG 比較少。</span><span class="sxs-lookup"><span data-stu-id="4328f-265">Fewer NSGs to manage.</span></span> |<span data-ttu-id="4328f-266">要管理多個子網路。</span><span class="sxs-lookup"><span data-stu-id="4328f-266">Multiple subnets to manage.</span></span> |
| <span data-ttu-id="4328f-267">每個應用程式層有一個子網路，每個應用程式有多個 NSG。</span><span class="sxs-lookup"><span data-stu-id="4328f-267">One subnet per application layer, NSGs per app.</span></span> |![每一層級的子網路](./media/virtual-network-vnet-plan-design-arm/figure7.png) |<span data-ttu-id="4328f-269">平衡子網路與 NSG 的數目。</span><span class="sxs-lookup"><span data-stu-id="4328f-269">Balance between number of subnets and NSGs.</span></span> |<span data-ttu-id="4328f-270">每個訂用帳戶的 NSG 數目上限。</span><span class="sxs-lookup"><span data-stu-id="4328f-270">Maximum number of NSGs per subscription.</span></span> <span data-ttu-id="4328f-271">請檢閱 [Azure 限制](../azure-subscription-service-limits.md#networking-limits)一文以了解詳細資料。</span><span class="sxs-lookup"><span data-stu-id="4328f-271">Review the [Azure limits](../azure-subscription-service-limits.md#networking-limits) article for details.</span></span> |
| <span data-ttu-id="4328f-272">每個應用程式層的每個應用程式有一個子網路，每個子網路有多個 NSG</span><span class="sxs-lookup"><span data-stu-id="4328f-272">One subnet per application layer, per app, NSGs per subnet</span></span> |![每個應用程式的每個層級的子網路](./media/virtual-network-vnet-plan-design-arm/figure8.png) |<span data-ttu-id="4328f-274">NSG 數目可能比較少。</span><span class="sxs-lookup"><span data-stu-id="4328f-274">Possibly smaller number of NSGs.</span></span> |<span data-ttu-id="4328f-275">要管理多個子網路。</span><span class="sxs-lookup"><span data-stu-id="4328f-275">Multiple subnets to manage.</span></span> |

## <a name="sample-design"></a><span data-ttu-id="4328f-276">設計範例</span><span class="sxs-lookup"><span data-stu-id="4328f-276">Sample design</span></span>
<span data-ttu-id="4328f-277">為了說明本文中的資訊應用，請考慮下列案例。</span><span class="sxs-lookup"><span data-stu-id="4328f-277">To illustrate the application of the information in this article, consider the following scenario.</span></span>

<span data-ttu-id="4328f-278">您任職的公司在北美洲有 2 個資料中心，在歐洲也有兩個資料中心。</span><span class="sxs-lookup"><span data-stu-id="4328f-278">You work for a company that has 2 data centers in North America, and two data centers Europe.</span></span> <span data-ttu-id="4328f-279">您發現有 2 個不同的業務單位維護 6 個不同的客戶面向應用程式，而您想要將這些應用程式移轉至 Azure 做為先驅。</span><span class="sxs-lookup"><span data-stu-id="4328f-279">You identified 6 different customer facing applications maintained by 2 different business units that you want to migrate to Azure as a pilot.</span></span> <span data-ttu-id="4328f-280">應用程式的基本架構如下所示：</span><span class="sxs-lookup"><span data-stu-id="4328f-280">The basic architecture for the applications are as follows:</span></span>

* <span data-ttu-id="4328f-281">App1、App2、App3 和 App4 是在執行 Ubuntu 的 Linux 伺服器上裝載的 Web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="4328f-281">App1, App2, App3, and App4 are web applications hosted on Linux servers running Ubuntu.</span></span> <span data-ttu-id="4328f-282">每個應用程式會連接到個別應用程式伺服器，這些伺服器在 Linux 伺服器上託管 RESTful 服務。</span><span class="sxs-lookup"><span data-stu-id="4328f-282">Each application connects to a separate application server that hosts RESTful services on Linux servers.</span></span> <span data-ttu-id="4328f-283">RESTful 服務會連接到後端 MySQL 資料庫。</span><span class="sxs-lookup"><span data-stu-id="4328f-283">The RESTful services connect to a back end MySQL database.</span></span>
* <span data-ttu-id="4328f-284">App5 和 App6 是在執行 Windows Server 2012 R2 的 Windows 伺服器上裝載的 Web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="4328f-284">App5 and App6 are web applications hosted on Windows servers running Windows Server 2012 R2.</span></span> <span data-ttu-id="4328f-285">每個應用程式都會連接到後端 SQL Server 資料庫。</span><span class="sxs-lookup"><span data-stu-id="4328f-285">Each application connects to a back end SQL Server database.</span></span>
* <span data-ttu-id="4328f-286">所有應用程式目前都裝載於北美洲的其中一個公司資料中心。</span><span class="sxs-lookup"><span data-stu-id="4328f-286">All apps are currently hosted in one of the company's data centers in North America.</span></span>
* <span data-ttu-id="4328f-287">內部部署資料中心會使用 10.0.0.0/8 位址空間。</span><span class="sxs-lookup"><span data-stu-id="4328f-287">The on-premises data centers use the 10.0.0.0/8 address space.</span></span>

<span data-ttu-id="4328f-288">您需要設計符合下列需求的虛擬網路解決方案：</span><span class="sxs-lookup"><span data-stu-id="4328f-288">You need to design a virtual network solution that meets the following requirements:</span></span>

* <span data-ttu-id="4328f-289">每個業務單位不應該受其他業務單位的資源耗用量所影響。</span><span class="sxs-lookup"><span data-stu-id="4328f-289">Each business unit should not be affected by resource consumption of other business units.</span></span>
* <span data-ttu-id="4328f-290">您應該盡可能減少 VNet 和子網路的數量，以便管理。</span><span class="sxs-lookup"><span data-stu-id="4328f-290">You should minimize the amount of VNets and subnets to make management easier.</span></span>
* <span data-ttu-id="4328f-291">每個業務單位應該具有適用於所有應用程式的單一測試/開發 VNet。</span><span class="sxs-lookup"><span data-stu-id="4328f-291">Each business unit should have a single test/development VNet used for all applications.</span></span>
* <span data-ttu-id="4328f-292">每個應用程式會裝載於每個大陸 (北美洲與歐洲) 的 2 個不同 Azure 資料中心。</span><span class="sxs-lookup"><span data-stu-id="4328f-292">Each application is hosted in 2 different Azure data centers per continent (North America and Europe).</span></span>
* <span data-ttu-id="4328f-293">每個應用程式會彼此完全隔離。</span><span class="sxs-lookup"><span data-stu-id="4328f-293">Each application is completely isolated from each other.</span></span>
* <span data-ttu-id="4328f-294">客戶可以使用 HTTP 透過網際網路存取每個應用程式。</span><span class="sxs-lookup"><span data-stu-id="4328f-294">Each application can be accessed by customers over the Internet using HTTP.</span></span>
* <span data-ttu-id="4328f-295">使用者可以透過加密的通道，存取連接到內部部署資料中心的每個應用程式。</span><span class="sxs-lookup"><span data-stu-id="4328f-295">Each application can be accessed by users connected to the on-premises data centers by using an encrypted tunnel.</span></span>
* <span data-ttu-id="4328f-296">對內部部署資料中心的連線應使用現有的 VPN 裝置。</span><span class="sxs-lookup"><span data-stu-id="4328f-296">Connection to on-premises data centers should use existing VPN devices.</span></span>
* <span data-ttu-id="4328f-297">公司的網路群組應可完全控制 VNet 設定。</span><span class="sxs-lookup"><span data-stu-id="4328f-297">The company's networking group should have full control over the VNet configuration.</span></span>
* <span data-ttu-id="4328f-298">每個業務單位的開發人員應該只能將 VM 部署到現有的子網路。</span><span class="sxs-lookup"><span data-stu-id="4328f-298">Developers in each business unit should only be able to deploy VMs to existing subnets.</span></span>
* <span data-ttu-id="4328f-299">所有應用程式將跟著移轉至 Azure (隨即轉移)。</span><span class="sxs-lookup"><span data-stu-id="4328f-299">All applications will be migrated as they are to Azure (lift-and-shift).</span></span>
* <span data-ttu-id="4328f-300">每個位置的資料庫應該每天複寫到其他 Azure 地點一次。</span><span class="sxs-lookup"><span data-stu-id="4328f-300">The databases in each location should replicate to other Azure locations once a day.</span></span>
* <span data-ttu-id="4328f-301">每個應用程式應使用 5 個前端 Web 伺服器、2 個應用程式伺服器 (必要時) 以及 2 個資料庫伺服器。</span><span class="sxs-lookup"><span data-stu-id="4328f-301">Each application should use 5 front end web servers, 2 application servers (when necessary), and 2 database servers.</span></span>

### <a name="plan"></a><span data-ttu-id="4328f-302">規劃</span><span class="sxs-lookup"><span data-stu-id="4328f-302">Plan</span></span>
<span data-ttu-id="4328f-303">您應該如下所示回答 [定義需求](#Define-requirements) 一節中的問題，以便開始您的設計規劃。</span><span class="sxs-lookup"><span data-stu-id="4328f-303">You should start your design planning by answering the question in the [Define requirements](#Define-requirements) section as shown below.</span></span>

1. <span data-ttu-id="4328f-304">您會使用哪些 Azure 位置來託管 Vnet？</span><span class="sxs-lookup"><span data-stu-id="4328f-304">What Azure locations will you use to host VNets?</span></span>

    <span data-ttu-id="4328f-305">北美洲的 2 個位置，以及歐洲的 2 個位置。</span><span class="sxs-lookup"><span data-stu-id="4328f-305">2 locations in North America, and 2 locations in Europe.</span></span> <span data-ttu-id="4328f-306">您應該根據現有內部部署資料中心的實體位置進行挑選。</span><span class="sxs-lookup"><span data-stu-id="4328f-306">You should pick those based on the physical location of your existing on-premises data centers.</span></span> <span data-ttu-id="4328f-307">如此一來，從您的實體位置到 Azure 會有較佳的連線延遲性。</span><span class="sxs-lookup"><span data-stu-id="4328f-307">That way your connection from your physical locations to Azure will have a better latency.</span></span>
2. <span data-ttu-id="4328f-308">您是否需要在這些 Azure 位置之間提供通訊？</span><span class="sxs-lookup"><span data-stu-id="4328f-308">Do you need to provide communication between these Azure locations?</span></span>

    <span data-ttu-id="4328f-309">是。</span><span class="sxs-lookup"><span data-stu-id="4328f-309">Yes.</span></span> <span data-ttu-id="4328f-310">因為資料庫必須複寫到所有位置。</span><span class="sxs-lookup"><span data-stu-id="4328f-310">Since the databases must be replicated to all locations.</span></span>
3. <span data-ttu-id="4328f-311">您是否需要在 Azure VNet 與您的內部部署資料中心之間提供通訊？</span><span class="sxs-lookup"><span data-stu-id="4328f-311">Do you need to provide communication between your Azure VNet(s) and your on-premises data center(s)?</span></span>

    <span data-ttu-id="4328f-312">是。</span><span class="sxs-lookup"><span data-stu-id="4328f-312">Yes.</span></span> <span data-ttu-id="4328f-313">因為連接到內部部署資料中心的使用者必須能夠透過加密的通道來存取每個應用程式。</span><span class="sxs-lookup"><span data-stu-id="4328f-313">Since users connected to the on-premises data centers must be able to access the applications through an encrypted tunnel.</span></span>
4. <span data-ttu-id="4328f-314">您的解決方案需要多少部 IaaS VM？</span><span class="sxs-lookup"><span data-stu-id="4328f-314">How many IaaS VMs do you need for your solution?</span></span>

    <span data-ttu-id="4328f-315">200 部 IaaS VM。</span><span class="sxs-lookup"><span data-stu-id="4328f-315">200 IaaS VMs.</span></span> <span data-ttu-id="4328f-316">App1、App2、App3 和 App4 各需要 5 部 Web 伺服器、2 部應用程式伺服器，以及 2 部資料庫伺服器。</span><span class="sxs-lookup"><span data-stu-id="4328f-316">App1, App2, App3, and App4 require 5 web servers each, 2 applications servers each, and 2 database servers each.</span></span> <span data-ttu-id="4328f-317">總計每個應用程式有 9 部 IaaS VM，或 36 部 IaaS VM。</span><span class="sxs-lookup"><span data-stu-id="4328f-317">That's a total of 9 IaaS VMs per application, or 36 IaaS VMs.</span></span> <span data-ttu-id="4328f-318">App5 和 App6 各需要 5 部 Web 伺服器和 2 部資料庫伺服器。</span><span class="sxs-lookup"><span data-stu-id="4328f-318">App5 and App6 require 5 web servers and 2 database servers each.</span></span> <span data-ttu-id="4328f-319">總計每個應用程式有 7 部 IaaS VM，或 14 部 IaaS VM。</span><span class="sxs-lookup"><span data-stu-id="4328f-319">That's a total of 7 IaaS VMs per application, or 14 IaaS VMs.</span></span> <span data-ttu-id="4328f-320">因此，每個 Azure 區域中的所有應用程式需要 50 部 IaaS VM。</span><span class="sxs-lookup"><span data-stu-id="4328f-320">Therefore, you need 50 IaaS VMs for all applications in each Azure region.</span></span> <span data-ttu-id="4328f-321">因為我們需要使用 4 個區域，所以會有 200 部 IaaS VM。</span><span class="sxs-lookup"><span data-stu-id="4328f-321">Since we need to use 4 regions, there will be 200 IaaS VMs.</span></span>

    <span data-ttu-id="4328f-322">您也必須在每個 VNet 或您的內部部署資料中心提供 DNS 伺服器，以解析 Azure IaaS VM 和內部部署網路之間的名稱。</span><span class="sxs-lookup"><span data-stu-id="4328f-322">You will also need to provide DNS servers in each VNet, or in your on-premises data centers to resolve name between your Azure IaaS VMs and your on-premises network.</span></span>
5. <span data-ttu-id="4328f-323">您是否需要根據 VM 群組隔離流量 (也就是前端 Web 伺服器和後端資料庫伺服器)？</span><span class="sxs-lookup"><span data-stu-id="4328f-323">Do you need to isolate traffic based on groups of VMs (i.e. front end web servers and back end database servers)?</span></span>

    <span data-ttu-id="4328f-324">是。</span><span class="sxs-lookup"><span data-stu-id="4328f-324">Yes.</span></span> <span data-ttu-id="4328f-325">每個應用程式應該彼此完全隔離，而且每個應用程式層也應該隔離。</span><span class="sxs-lookup"><span data-stu-id="4328f-325">Each application should be completely isolated from each other, and each application layer should also be isolated.</span></span>
6. <span data-ttu-id="4328f-326">您是否需要使用虛擬應用裝置來控制流量？</span><span class="sxs-lookup"><span data-stu-id="4328f-326">Do you need to control traffic flow using virtual appliances?</span></span>

    <span data-ttu-id="4328f-327">否。</span><span class="sxs-lookup"><span data-stu-id="4328f-327">No.</span></span> <span data-ttu-id="4328f-328">虛擬應用裝置可用來提供更充分的流量控制，包括更多詳細的資料層記錄。</span><span class="sxs-lookup"><span data-stu-id="4328f-328">Virtual appliances can be used to provide more control over traffic flow, including more detailed data plane logging.</span></span>
7. <span data-ttu-id="4328f-329">使用者是否需要不同 Azure 資源的不同權限？</span><span class="sxs-lookup"><span data-stu-id="4328f-329">Do users need different sets of permissions to different Azure resources?</span></span>

    <span data-ttu-id="4328f-330">是。</span><span class="sxs-lookup"><span data-stu-id="4328f-330">Yes.</span></span> <span data-ttu-id="4328f-331">網路小組必須能完全控制虛擬網路設定，而開發人員應該只能將其 VM 部署到現有的子網路。</span><span class="sxs-lookup"><span data-stu-id="4328f-331">The networking team needs full control on the virtual networking settings, while developers should only be able to deploy their VMs to pre-existing subnets.</span></span>

### <a name="design"></a><span data-ttu-id="4328f-332">設計</span><span class="sxs-lookup"><span data-stu-id="4328f-332">Design</span></span>
<span data-ttu-id="4328f-333">您應該遵循指定訂用帳戶、VNet、子網路和 NSG 使用的設計。</span><span class="sxs-lookup"><span data-stu-id="4328f-333">You should follow the design specifying subscriptions, VNets, subnets, and NSGs.</span></span> <span data-ttu-id="4328f-334">我們會在此討論 NSG，但您應該先深入了解 [NSG](virtual-networks-nsg.md) ，再完成您的設計。</span><span class="sxs-lookup"><span data-stu-id="4328f-334">We will discuss NSGs here, but you should learn more about [NSGs](virtual-networks-nsg.md) before finishing your design.</span></span>

<span data-ttu-id="4328f-335">**訂用帳戶和 VNet 數目**</span><span class="sxs-lookup"><span data-stu-id="4328f-335">**Number of subscriptions and VNets**</span></span>

<span data-ttu-id="4328f-336">下列需求與訂用帳戶和 VNet 相關：</span><span class="sxs-lookup"><span data-stu-id="4328f-336">The following requirements are related to subscriptions and VNets:</span></span>

* <span data-ttu-id="4328f-337">每個業務單位不應該受其他業務單位的資源耗用量所影響。</span><span class="sxs-lookup"><span data-stu-id="4328f-337">Each business unit should not be affected by resource consumption of other business units.</span></span>
* <span data-ttu-id="4328f-338">您應該盡可能減少 VNet 和子網路的數量。</span><span class="sxs-lookup"><span data-stu-id="4328f-338">You should minimize the amount of VNets and subnets.</span></span>
* <span data-ttu-id="4328f-339">每個業務單位應該具有適用於所有應用程式的單一測試/開發 VNet。</span><span class="sxs-lookup"><span data-stu-id="4328f-339">Each business unit should have a single test/development VNet used for all applications.</span></span>
* <span data-ttu-id="4328f-340">每個應用程式會裝載於每個大陸 (北美洲與歐洲) 的 2 個不同 Azure 資料中心。</span><span class="sxs-lookup"><span data-stu-id="4328f-340">Each application is hosted in 2 different Azure data centers per continent (North America and Europe).</span></span>

<span data-ttu-id="4328f-341">根據上述需求，每個業務單位都需有一個訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="4328f-341">Based on those requirements, you need a subscription for each business unit.</span></span> <span data-ttu-id="4328f-342">如此一來，業務單位的資源耗用量就不會計入其他業務單位的限制。</span><span class="sxs-lookup"><span data-stu-id="4328f-342">That way, consumption of resources from a business unit will not count towards limits for other business units.</span></span> <span data-ttu-id="4328f-343">而且因為您想要將 VNet 數目降到最低，所以應該考慮使用 **每個業務單位有一個訂用帳戶，每個應用程式群組有兩部 VNet** 的模式，如下所示。</span><span class="sxs-lookup"><span data-stu-id="4328f-343">And since you want to minimize the number of VNets, you should consider using the **one subscription per business unit, two VNets per group of apps** pattern as seen below.</span></span>

![單一訂用帳戶](./media/virtual-network-vnet-plan-design-arm/figure9.png)

<span data-ttu-id="4328f-345">您也需要為每個 VNet 指定位址空間。</span><span class="sxs-lookup"><span data-stu-id="4328f-345">You also need to specify the address space for each VNet.</span></span> <span data-ttu-id="4328f-346">因為您需要內部部署資料中心與 Azure 區域之間的連線，所以用於 Azure VNet 的位址空間不與內部部署網路衝突，而每個 VNet 所用的位址空間不得與其他現有的 VNet 衝突。</span><span class="sxs-lookup"><span data-stu-id="4328f-346">Since you need connectivity between the on-premises data centers and the Azure regions, the address space used for Azure VNets cannot clash with the on-premises network, and the address space used by each VNet should not clash with other existing VNets.</span></span> <span data-ttu-id="4328f-347">您可以使用下表中的位址空間，以滿足這些需求。</span><span class="sxs-lookup"><span data-stu-id="4328f-347">You could use the address spaces in the table below to satisfy these requirements.</span></span>  

| <span data-ttu-id="4328f-348">**訂用帳戶**</span><span class="sxs-lookup"><span data-stu-id="4328f-348">**Subscription**</span></span> | <span data-ttu-id="4328f-349">**VNet**</span><span class="sxs-lookup"><span data-stu-id="4328f-349">**VNet**</span></span> | <span data-ttu-id="4328f-350">**Azure 區域**</span><span class="sxs-lookup"><span data-stu-id="4328f-350">**Azure region**</span></span> | <span data-ttu-id="4328f-351">**位址空間**</span><span class="sxs-lookup"><span data-stu-id="4328f-351">**Address space**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="4328f-352">BU1</span><span class="sxs-lookup"><span data-stu-id="4328f-352">BU1</span></span> |<span data-ttu-id="4328f-353">ProdBU1US1</span><span class="sxs-lookup"><span data-stu-id="4328f-353">ProdBU1US1</span></span> |<span data-ttu-id="4328f-354">美國西部</span><span class="sxs-lookup"><span data-stu-id="4328f-354">West US</span></span> |<span data-ttu-id="4328f-355">172.16.0.0/16</span><span class="sxs-lookup"><span data-stu-id="4328f-355">172.16.0.0/16</span></span> |
| <span data-ttu-id="4328f-356">BU1</span><span class="sxs-lookup"><span data-stu-id="4328f-356">BU1</span></span> |<span data-ttu-id="4328f-357">ProdBU1US2</span><span class="sxs-lookup"><span data-stu-id="4328f-357">ProdBU1US2</span></span> |<span data-ttu-id="4328f-358">美國東部</span><span class="sxs-lookup"><span data-stu-id="4328f-358">East US</span></span> |<span data-ttu-id="4328f-359">172.17.0.0/16</span><span class="sxs-lookup"><span data-stu-id="4328f-359">172.17.0.0/16</span></span> |
| <span data-ttu-id="4328f-360">BU1</span><span class="sxs-lookup"><span data-stu-id="4328f-360">BU1</span></span> |<span data-ttu-id="4328f-361">ProdBU1EU1</span><span class="sxs-lookup"><span data-stu-id="4328f-361">ProdBU1EU1</span></span> |<span data-ttu-id="4328f-362">北歐</span><span class="sxs-lookup"><span data-stu-id="4328f-362">North Europe</span></span> |<span data-ttu-id="4328f-363">172.18.0.0/16</span><span class="sxs-lookup"><span data-stu-id="4328f-363">172.18.0.0/16</span></span> |
| <span data-ttu-id="4328f-364">BU1</span><span class="sxs-lookup"><span data-stu-id="4328f-364">BU1</span></span> |<span data-ttu-id="4328f-365">ProdBU1EU2</span><span class="sxs-lookup"><span data-stu-id="4328f-365">ProdBU1EU2</span></span> |<span data-ttu-id="4328f-366">西歐</span><span class="sxs-lookup"><span data-stu-id="4328f-366">West Europe</span></span> |<span data-ttu-id="4328f-367">172.19.0.0/16</span><span class="sxs-lookup"><span data-stu-id="4328f-367">172.19.0.0/16</span></span> |
| <span data-ttu-id="4328f-368">BU1</span><span class="sxs-lookup"><span data-stu-id="4328f-368">BU1</span></span> |<span data-ttu-id="4328f-369">TestDevBU1</span><span class="sxs-lookup"><span data-stu-id="4328f-369">TestDevBU1</span></span> |<span data-ttu-id="4328f-370">美國西部</span><span class="sxs-lookup"><span data-stu-id="4328f-370">West US</span></span> |<span data-ttu-id="4328f-371">172.20.0.0/16</span><span class="sxs-lookup"><span data-stu-id="4328f-371">172.20.0.0/16</span></span> |
| <span data-ttu-id="4328f-372">BU2</span><span class="sxs-lookup"><span data-stu-id="4328f-372">BU2</span></span> |<span data-ttu-id="4328f-373">TestDevBU2</span><span class="sxs-lookup"><span data-stu-id="4328f-373">TestDevBU2</span></span> |<span data-ttu-id="4328f-374">美國西部</span><span class="sxs-lookup"><span data-stu-id="4328f-374">West US</span></span> |<span data-ttu-id="4328f-375">172.21.0.0/16</span><span class="sxs-lookup"><span data-stu-id="4328f-375">172.21.0.0/16</span></span> |
| <span data-ttu-id="4328f-376">BU2</span><span class="sxs-lookup"><span data-stu-id="4328f-376">BU2</span></span> |<span data-ttu-id="4328f-377">ProdBU2US1</span><span class="sxs-lookup"><span data-stu-id="4328f-377">ProdBU2US1</span></span> |<span data-ttu-id="4328f-378">美國西部</span><span class="sxs-lookup"><span data-stu-id="4328f-378">West US</span></span> |<span data-ttu-id="4328f-379">172.22.0.0/16</span><span class="sxs-lookup"><span data-stu-id="4328f-379">172.22.0.0/16</span></span> |
| <span data-ttu-id="4328f-380">BU2</span><span class="sxs-lookup"><span data-stu-id="4328f-380">BU2</span></span> |<span data-ttu-id="4328f-381">ProdBU2US2</span><span class="sxs-lookup"><span data-stu-id="4328f-381">ProdBU2US2</span></span> |<span data-ttu-id="4328f-382">美國東部</span><span class="sxs-lookup"><span data-stu-id="4328f-382">East US</span></span> |<span data-ttu-id="4328f-383">172.23.0.0/16</span><span class="sxs-lookup"><span data-stu-id="4328f-383">172.23.0.0/16</span></span> |
| <span data-ttu-id="4328f-384">BU2</span><span class="sxs-lookup"><span data-stu-id="4328f-384">BU2</span></span> |<span data-ttu-id="4328f-385">ProdBU2EU1</span><span class="sxs-lookup"><span data-stu-id="4328f-385">ProdBU2EU1</span></span> |<span data-ttu-id="4328f-386">北歐</span><span class="sxs-lookup"><span data-stu-id="4328f-386">North Europe</span></span> |<span data-ttu-id="4328f-387">172.24.0.0/16</span><span class="sxs-lookup"><span data-stu-id="4328f-387">172.24.0.0/16</span></span> |
| <span data-ttu-id="4328f-388">BU2</span><span class="sxs-lookup"><span data-stu-id="4328f-388">BU2</span></span> |<span data-ttu-id="4328f-389">ProdBU2EU2</span><span class="sxs-lookup"><span data-stu-id="4328f-389">ProdBU2EU2</span></span> |<span data-ttu-id="4328f-390">西歐</span><span class="sxs-lookup"><span data-stu-id="4328f-390">West Europe</span></span> |<span data-ttu-id="4328f-391">172.25.0.0/16</span><span class="sxs-lookup"><span data-stu-id="4328f-391">172.25.0.0/16</span></span> |

<span data-ttu-id="4328f-392">**子網路數和 NSG 的數目**</span><span class="sxs-lookup"><span data-stu-id="4328f-392">**Number of subnets and NSGs**</span></span>

<span data-ttu-id="4328f-393">下列需求與子網路和 NSG 相關：</span><span class="sxs-lookup"><span data-stu-id="4328f-393">The following requirements are related to subnets and NSGs:</span></span>

* <span data-ttu-id="4328f-394">您應該盡可能減少 VNet 和子網路的數量。</span><span class="sxs-lookup"><span data-stu-id="4328f-394">You should minimize the amount of VNets and subnets.</span></span>
* <span data-ttu-id="4328f-395">每個應用程式會彼此完全隔離。</span><span class="sxs-lookup"><span data-stu-id="4328f-395">Each application is completely isolated from each other.</span></span>
* <span data-ttu-id="4328f-396">客戶可以使用 HTTP 透過網際網路存取每個應用程式。</span><span class="sxs-lookup"><span data-stu-id="4328f-396">Each application can be accessed by customers over the Internet using HTTP.</span></span>
* <span data-ttu-id="4328f-397">使用者可以透過加密的通道，存取連接到內部部署資料中心的每個應用程式。</span><span class="sxs-lookup"><span data-stu-id="4328f-397">Each application can be accessed by users connected to the on-premises data centers by using an encrypted tunnel.</span></span>
* <span data-ttu-id="4328f-398">對內部部署資料中心的連線應使用現有的 VPN 裝置。</span><span class="sxs-lookup"><span data-stu-id="4328f-398">Connection to on-premises data centers should use existing VPN devices.</span></span>
* <span data-ttu-id="4328f-399">每個位置的資料庫應該每天複寫到其他 Azure 地點一次。</span><span class="sxs-lookup"><span data-stu-id="4328f-399">The databases in each location should replicate to other Azure locations once a day.</span></span>

<span data-ttu-id="4328f-400">您可以根據這些需求，在每個應用程式層中使用一個子網路，並使用 NSG 來篩選每個應用程式的流量。</span><span class="sxs-lookup"><span data-stu-id="4328f-400">Based on those requirements, you could use one subnet per application layer, and use NSGs to filter traffic per application.</span></span> <span data-ttu-id="4328f-401">如此一來，每個 VNet 只有 3 個子網路 (前端、應用程式層和資料層)，而每個子網路的每個應用程式有一個 NSG。</span><span class="sxs-lookup"><span data-stu-id="4328f-401">That way, you only have 3 subnets in each VNet (front end, application layer, and data layer) and one NSG per application per subnet.</span></span> <span data-ttu-id="4328f-402">在此情況下，您應該考慮使用 **每個應用程式層有一個子網路，每個應用程式有多個 NSG** 設計模式。</span><span class="sxs-lookup"><span data-stu-id="4328f-402">In this case, you should consider using the **one subnet per application layer, NSGs per app** design pattern.</span></span> <span data-ttu-id="4328f-403">下圖說明如何使用代表 **ProdBU1US1** VNet 的設計模式。</span><span class="sxs-lookup"><span data-stu-id="4328f-403">The figure below shows the use of the design pattern representing the **ProdBU1US1** VNet.</span></span>

![每一層級一個子網路，每一層級的每個應用程式一個 NSG](./media/virtual-network-vnet-plan-design-arm/figure11.png)

<span data-ttu-id="4328f-405">不過，您也需要針對 VNet 與內部部署資料中心之間的 VPN 連線，建立額外的子網路。</span><span class="sxs-lookup"><span data-stu-id="4328f-405">However, you also need to create an extra subnet for the VPN connectivity between the VNets, and your on-premises data centers.</span></span> <span data-ttu-id="4328f-406">而且需要為每個 VNet 指定位址空間。</span><span class="sxs-lookup"><span data-stu-id="4328f-406">And you need to specify the address space for each subnet.</span></span> <span data-ttu-id="4328f-407">下圖顯示 **ProdBU1US1** VNet 的範例解決方案。</span><span class="sxs-lookup"><span data-stu-id="4328f-407">The figure below shows a sample solution for **ProdBU1US1** VNet.</span></span> <span data-ttu-id="4328f-408">您會為每個 VNet 複寫此案例。</span><span class="sxs-lookup"><span data-stu-id="4328f-408">You would replicate this scenario for each VNet.</span></span> <span data-ttu-id="4328f-409">每個顏色都代表不同的應用程式。</span><span class="sxs-lookup"><span data-stu-id="4328f-409">Each color represents a different application.</span></span>

![VNet 範例](./media/virtual-network-vnet-plan-design-arm/figure10.png)

<span data-ttu-id="4328f-411">**存取控制**</span><span class="sxs-lookup"><span data-stu-id="4328f-411">**Access Control**</span></span>

<span data-ttu-id="4328f-412">下列需求與存取控制相關：</span><span class="sxs-lookup"><span data-stu-id="4328f-412">The following requirements are related to access control:</span></span>

* <span data-ttu-id="4328f-413">公司的網路群組應可完全控制 VNet 設定。</span><span class="sxs-lookup"><span data-stu-id="4328f-413">The company's networking group should have full control over the VNet configuration.</span></span>
* <span data-ttu-id="4328f-414">每個業務單位的開發人員應該只能將 VM 部署到現有的子網路。</span><span class="sxs-lookup"><span data-stu-id="4328f-414">Developers in each business unit should only be able to deploy VMs to existing subnets.</span></span>

<span data-ttu-id="4328f-415">根據上述需求，您可以將網路小組的使用者加入至每個訂用帳戶中的內建 **網路參與者** 角色，並且為每個訂用帳戶中的應用程式開發人員建立自訂角色，並賦予他們將 VM 加入至現有子網路的權限。</span><span class="sxs-lookup"><span data-stu-id="4328f-415">Based on those requirements, you could add users from the networking team to the built-in **Network Contributor** role in each subscription; and create a custom role for the application developers in each subscription giving them rights to add VMs to existing subnets.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4328f-416">後續步驟</span><span class="sxs-lookup"><span data-stu-id="4328f-416">Next steps</span></span>
* <span data-ttu-id="4328f-417">[部署虛擬網路](virtual-networks-create-vnet-arm-template-click.md) 。</span><span class="sxs-lookup"><span data-stu-id="4328f-417">[Deploy a virtual network](virtual-networks-create-vnet-arm-template-click.md) based on a scenario.</span></span>
* <span data-ttu-id="4328f-418">了解如何使 IaaS VM [負載平衡](../load-balancer/load-balancer-overview.md)及[管理多個 Azure 區域的路由傳送](../traffic-manager/traffic-manager-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="4328f-418">Understand how to [load balance](../load-balancer/load-balancer-overview.md) IaaS VMs and [manage routing over multiple Azure regions](../traffic-manager/traffic-manager-overview.md).</span></span>
* <span data-ttu-id="4328f-419">深入了解 [NSG，以及如何規劃和設計](virtual-networks-nsg.md) NSG 方案。</span><span class="sxs-lookup"><span data-stu-id="4328f-419">Learn more about [NSGs and how to plan and design](virtual-networks-nsg.md) an NSG solution.</span></span>
* <span data-ttu-id="4328f-420">深入了解您的 [跨單位和 VNet 連線選項](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)。</span><span class="sxs-lookup"><span data-stu-id="4328f-420">Learn more about your [cross-premises and VNet connectivity options](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti).</span></span>
