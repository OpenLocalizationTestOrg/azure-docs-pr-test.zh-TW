---
title: "向外延展雲端資料庫之間的 aaaMoving 資料 |Microsoft 文件"
description: "說明如何 toomanipulate 分區移動資料，透過使用彈性的自我裝載服務資料庫和應用程式開發介面。"
services: sql-database
documentationcenter: 
manager: jhubbard
author: ddove
ms.assetid: 204fd902-0397-4185-985a-dea3ed7c7d9f
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/24/2016
ms.author: ddove
ms.openlocfilehash: 629dee06e22609e9b61edf93ba5c38d997132d8c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="moving-data-between-scaled-out-cloud-databases"></a><span data-ttu-id="bd60b-103">在向外延展的雲端資料庫之間移動資料</span><span class="sxs-lookup"><span data-stu-id="bd60b-103">Moving data between scaled-out cloud databases</span></span>
<span data-ttu-id="bd60b-104">如果您是軟體即服務開發人員，而且您的應用程式突然經過極大的需求，您會需要 tooaccommodate hello 成長。</span><span class="sxs-lookup"><span data-stu-id="bd60b-104">If you are a Software as a Service developer, and suddenly your app undergoes tremendous demand, you need tooaccommodate hello growth.</span></span> <span data-ttu-id="bd60b-105">所以，您加入了更多的資料庫 (分區)。</span><span class="sxs-lookup"><span data-stu-id="bd60b-105">So you add more databases (shards).</span></span> <span data-ttu-id="bd60b-106">如何發佈 hello 資料 toohello 新資料庫而不會中斷 hello 資料完整性？</span><span class="sxs-lookup"><span data-stu-id="bd60b-106">How do you redistribute hello data toohello new databases without disrupting hello data integrity?</span></span> <span data-ttu-id="bd60b-107">使用 hello**分割合併工具**toomove 資料從受條件約束資料庫 toohello 新資料庫。</span><span class="sxs-lookup"><span data-stu-id="bd60b-107">Use hello **split-merge tool** toomove data from constrained databases toohello new databases.</span></span>  

<span data-ttu-id="bd60b-108">為 Azure web 服務會執行 hello 分割合併工具。</span><span class="sxs-lookup"><span data-stu-id="bd60b-108">hello split-merge tool runs as an Azure web service.</span></span> <span data-ttu-id="bd60b-109">系統管理員或開發人員會使用 hello 工具 toomove shardlet 不同的資料庫 （分區） 間 （從分區資料）。</span><span class="sxs-lookup"><span data-stu-id="bd60b-109">An administrator or developer uses hello tool toomove shardlets (data from a shard) between different databases (shards).</span></span> <span data-ttu-id="bd60b-110">hello 工具會使用分區對應管理 toomaintain hello 服務中繼資料資料庫中，並確保一致的對應。</span><span class="sxs-lookup"><span data-stu-id="bd60b-110">hello tool uses shard map management toomaintain hello service metadata database, and ensure consistent mappings.</span></span>

![概觀][1]

## <a name="download"></a><span data-ttu-id="bd60b-112">下載</span><span class="sxs-lookup"><span data-stu-id="bd60b-112">Download</span></span>
[<span data-ttu-id="bd60b-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span><span class="sxs-lookup"><span data-stu-id="bd60b-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span></span>](http://www.nuget.org/packages/Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge/)

## <a name="documentation"></a><span data-ttu-id="bd60b-114">文件</span><span class="sxs-lookup"><span data-stu-id="bd60b-114">Documentation</span></span>
1. [<span data-ttu-id="bd60b-115">彈性資料庫分割合併工具教學課程</span><span class="sxs-lookup"><span data-stu-id="bd60b-115">Elastic database Split-Merge tool tutorial</span></span>](sql-database-elastic-scale-configure-deploy-split-and-merge.md)
2. [<span data-ttu-id="bd60b-116">Split-Merge 安全性設定</span><span class="sxs-lookup"><span data-stu-id="bd60b-116">Split-Merge security configuration</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
3. [<span data-ttu-id="bd60b-117">分割合併安全性考量</span><span class="sxs-lookup"><span data-stu-id="bd60b-117">Split-merge security considerations</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
4. [<span data-ttu-id="bd60b-118">分區對應管理</span><span class="sxs-lookup"><span data-stu-id="bd60b-118">Shard map management</span></span>](sql-database-elastic-scale-shard-map-management.md)
5. [<span data-ttu-id="bd60b-119">移轉現有的資料庫 tooscale 外</span><span class="sxs-lookup"><span data-stu-id="bd60b-119">Migrate existing databases tooscale-out</span></span>](sql-database-elastic-convert-to-use-elastic-tools.md)
6. [<span data-ttu-id="bd60b-120">彈性資料庫功能概觀</span><span class="sxs-lookup"><span data-stu-id="bd60b-120">Elastic database tools</span></span>](sql-database-elastic-scale-introduction.md)
7. [<span data-ttu-id="bd60b-121">彈性資料庫工具字彙</span><span class="sxs-lookup"><span data-stu-id="bd60b-121">Elastic Database tools glossary</span></span>](sql-database-elastic-scale-glossary.md)

## <a name="why-use-hello-split-merge-tool"></a><span data-ttu-id="bd60b-122">為何要使用 hello 分割合併工具嗎？</span><span class="sxs-lookup"><span data-stu-id="bd60b-122">Why use hello split-merge tool?</span></span>
<span data-ttu-id="bd60b-123">**彈性**</span><span class="sxs-lookup"><span data-stu-id="bd60b-123">**Flexibility**</span></span>

<span data-ttu-id="bd60b-124">應用程式需要 toostretch 超出 hello 限制單一 Azure SQL DB 資料庫的彈性。</span><span class="sxs-lookup"><span data-stu-id="bd60b-124">Applications need toostretch flexibly beyond hello limits of a single Azure SQL DB database.</span></span> <span data-ttu-id="bd60b-125">使用 hello 工具 toomove 資料做為所需的 toonew 資料庫，同時保有完整性。</span><span class="sxs-lookup"><span data-stu-id="bd60b-125">Use hello tool toomove data as needed toonew databases while retaining integrity.</span></span>

<span data-ttu-id="bd60b-126">**分割 toogrow**</span><span class="sxs-lookup"><span data-stu-id="bd60b-126">**Split toogrow**</span></span> 

<span data-ttu-id="bd60b-127">您需要 tooincrease 整體容量 toohandle 爆炸性成長。</span><span class="sxs-lookup"><span data-stu-id="bd60b-127">You need tooincrease overall capacity toohandle explosive growth.</span></span> <span data-ttu-id="bd60b-128">toodo 分區化 hello 資料和散發以累加方式多個資料庫，直到符合容量需求，因此，建立額外的容量。</span><span class="sxs-lookup"><span data-stu-id="bd60b-128">toodo so, create additional capacity by sharding hello data and by distributing it across incrementally more databases until capacity needs are fulfilled.</span></span> <span data-ttu-id="bd60b-129">這是基本的使用範例 hello 'split' 功能。</span><span class="sxs-lookup"><span data-stu-id="bd60b-129">This is a prime example of hello ‘split’ feature.</span></span> 

<span data-ttu-id="bd60b-130">**合併 tooshrink**</span><span class="sxs-lookup"><span data-stu-id="bd60b-130">**Merge tooshrink**</span></span>

<span data-ttu-id="bd60b-131">容量必須壓縮 toohello 商務的季節性本質上到期。</span><span class="sxs-lookup"><span data-stu-id="bd60b-131">Capacity needs shrink due toohello seasonal nature of a business.</span></span> <span data-ttu-id="bd60b-132">hello 工具可讓商務會變慢時 toofewer 延展單位調降規模。</span><span class="sxs-lookup"><span data-stu-id="bd60b-132">hello tool lets you scale down toofewer scale units when business slows.</span></span> <span data-ttu-id="bd60b-133">hello 彈性延展分割合併服務中的 hello 'merge' 功能涵蓋這項需求。</span><span class="sxs-lookup"><span data-stu-id="bd60b-133">hello ‘merge’ feature in hello Elastic Scale split-merge Service covers this requirement.</span></span> 

<span data-ttu-id="bd60b-134">**移動 Shardlet 來管理作用區**</span><span class="sxs-lookup"><span data-stu-id="bd60b-134">**Manage hotspots by moving shardlets**</span></span>

<span data-ttu-id="bd60b-135">與每個資料庫的多個租用戶，shardlet tooshards hello 配置可能會導致 toocapacity 瓶頸，在某些分區。</span><span class="sxs-lookup"><span data-stu-id="bd60b-135">With multiple tenants per database, hello allocation of shardlets tooshards can lead toocapacity bottlenecks on some shards.</span></span> <span data-ttu-id="bd60b-136">這需要重新配置 shardlet 或移動忙碌的 shardlet toonew 或較少使用的分區。</span><span class="sxs-lookup"><span data-stu-id="bd60b-136">This requires re-allocating shardlets or moving busy shardlets toonew or less utilized shards.</span></span> 

## <a name="concepts--key-features"></a><span data-ttu-id="bd60b-137">概念和重要功能</span><span class="sxs-lookup"><span data-stu-id="bd60b-137">Concepts & key features</span></span>
<span data-ttu-id="bd60b-138">**客戶主控式服務**</span><span class="sxs-lookup"><span data-stu-id="bd60b-138">**Customer-hosted services**</span></span>

<span data-ttu-id="bd60b-139">以的客戶裝載服務的形式提供 hello 分割合併。</span><span class="sxs-lookup"><span data-stu-id="bd60b-139">hello split-merge is delivered as a customer-hosted service.</span></span> <span data-ttu-id="bd60b-140">您必須部署並裝載在 Microsoft Azure 訂用帳戶中的 hello 服務。</span><span class="sxs-lookup"><span data-stu-id="bd60b-140">You must deploy and host hello service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="bd60b-141">您從 NuGet 下載的 hello 套件包含您的特定部署的 hello 資訊與組態範本 toocomplete。</span><span class="sxs-lookup"><span data-stu-id="bd60b-141">hello package you download from NuGet contains a configuration template toocomplete with hello information for your specific deployment.</span></span> <span data-ttu-id="bd60b-142">請參閱 hello[分割合併教學課程](sql-database-elastic-scale-configure-deploy-split-and-merge.md)如需詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="bd60b-142">See hello [split-merge tutorial](sql-database-elastic-scale-configure-deploy-split-and-merge.md) for details.</span></span> <span data-ttu-id="bd60b-143">因為 hello 服務以執行您的 Azure 訂用帳戶中，您可以控制和設定大部分的 hello 服務的安全性層面。</span><span class="sxs-lookup"><span data-stu-id="bd60b-143">Since hello service runs in your Azure subscription, you can control and configure most security aspects of hello service.</span></span> <span data-ttu-id="bd60b-144">hello 預設範本包含 hello 選項 tooconfigure SSL 憑證為基礎的用戶端驗證、 加密的預存的認證、 DoS 保護和 IP 限制。</span><span class="sxs-lookup"><span data-stu-id="bd60b-144">hello default template includes hello options tooconfigure SSL, certificate-based client authentication, encryption for stored credentials, DoS guarding and IP restrictions.</span></span> <span data-ttu-id="bd60b-145">您可以找到更多有關 hello 安全性層面 hello 下列文件中[分割合併安全性組態](sql-database-elastic-scale-split-merge-security-configuration.md)。</span><span class="sxs-lookup"><span data-stu-id="bd60b-145">You can find more information on hello security aspects in hello following document [split-merge security configuration](sql-database-elastic-scale-split-merge-security-configuration.md).</span></span>

<span data-ttu-id="bd60b-146">hello 預設部署一個背景工作與一個 web 角色執行的服務。</span><span class="sxs-lookup"><span data-stu-id="bd60b-146">hello default deployed service runs with one worker and one web role.</span></span> <span data-ttu-id="bd60b-147">每個 Azure 雲端服務中使用 hello A1 VM 大小。</span><span class="sxs-lookup"><span data-stu-id="bd60b-147">Each uses hello A1 VM size in Azure Cloud Services.</span></span> <span data-ttu-id="bd60b-148">雖然部署 hello 封裝時，您無法修改這些設定，您無法在 hello （透過 hello Azure 入口網站) 執行雲端服務中的成功部署之後變更它們。</span><span class="sxs-lookup"><span data-stu-id="bd60b-148">While you cannot modify these settings when deploying hello package, you could change them after a successful deployment in hello running cloud service, (through hello Azure portal).</span></span> <span data-ttu-id="bd60b-149">請注意該 hello 背景工作角色都不應該設定用於多個單一執行個體若是技術原因。</span><span class="sxs-lookup"><span data-stu-id="bd60b-149">Note that hello worker role must not be configured for more than a single instance for technical reasons.</span></span> 

<span data-ttu-id="bd60b-150">**分區對應整合**</span><span class="sxs-lookup"><span data-stu-id="bd60b-150">**Shard map integration**</span></span>

<span data-ttu-id="bd60b-151">hello 分割合併服務互動的 hello 應用程式的 hello 分區對應。</span><span class="sxs-lookup"><span data-stu-id="bd60b-151">hello split-merge service interacts with hello shard map of hello application.</span></span> <span data-ttu-id="bd60b-152">當使用 hello 分割合併服務 toosplit 或合併的範圍或 toomove shardlet 分區之間，hello 服務會自動保留向上 toodate hello 分區對應。</span><span class="sxs-lookup"><span data-stu-id="bd60b-152">When using hello split-merge service toosplit or merge ranges or toomove shardlets between shards, hello service automatically keeps hello shard map up toodate.</span></span> <span data-ttu-id="bd60b-153">toodo 因此 hello 服務連接 toohello 分區對應管理員 hello 應用程式資料庫，然後當作分割/合併/移動要求正在進行維護範圍和對應。</span><span class="sxs-lookup"><span data-stu-id="bd60b-153">toodo so, hello service connects toohello shard map manager database of hello application and maintains ranges and mappings as split/merge/move requests progress.</span></span> <span data-ttu-id="bd60b-154">這可確保該 hello 分區對應一律顯示最新的檢視時分割合併作業會繼續。</span><span class="sxs-lookup"><span data-stu-id="bd60b-154">This ensures that hello shard map always presents an up-to-date view when split-merge operations are going on.</span></span> <span data-ttu-id="bd60b-155">分割時，merge range 和 shardlet 移動作業是移動 hello 來源分區 toohello 目標分區的 shardlet 批次來實作。</span><span class="sxs-lookup"><span data-stu-id="bd60b-155">Split, merge and shardlet movement operations are implemented by moving a batch of shardlets from hello source shard toohello target shard.</span></span> <span data-ttu-id="bd60b-156">Hello shardlet 移動作業 hello shardlet 主旨 toohello 目前批次期間會標示為離線 hello 分區對應中，且無法使用資料依存路由連線使用 hello **OpenConnectionForKey**應用程式開發介面。</span><span class="sxs-lookup"><span data-stu-id="bd60b-156">During hello shardlet movement operation hello shardlets subject toohello current batch are marked as offline in hello shard map and are unavailable for data-dependent routing connections using hello **OpenConnectionForKey** API.</span></span> 

<span data-ttu-id="bd60b-157">**一致的 Shardlet 連線**</span><span class="sxs-lookup"><span data-stu-id="bd60b-157">**Consistent shardlet connections**</span></span>

<span data-ttu-id="bd60b-158">任何分區對應提供資料依存路由連線 toohello 分區儲存 hello shardlet 時開始一個新的批次的 shardlet 移動資料，會從 hello 分區對應這些 shardlet 遭到封鎖的應用程式開發介面 toohello 已清除和後續連線時hello 資料移動是順序 tooavoid 不一致的問題進行中。</span><span class="sxs-lookup"><span data-stu-id="bd60b-158">When data movement starts for a new batch of shardlets, any shard-map provided data-dependent routing connections toohello shard storing hello shardlet are killed and subsequent connections from hello shard map APIs toohello these shardlets are blocked while hello data movement is in progress in order tooavoid inconsistencies.</span></span> <span data-ttu-id="bd60b-159">在 hello 相同分區化也會取得清除時，但會一次成功連線 tooother shardlet 立即在重試。</span><span class="sxs-lookup"><span data-stu-id="bd60b-159">Connections tooother shardlets on hello same shard will also get killed, but will succeed again immediately on retry.</span></span> <span data-ttu-id="bd60b-160">移動 hello 批次時，一旦 hello shardlet 標記為線上，再為 hello 目標分區，並從 hello 來源分區移除 hello 來源資料。</span><span class="sxs-lookup"><span data-stu-id="bd60b-160">Once hello batch is moved, hello shardlets are marked online again for hello target shard and hello source data is removed from hello source shard.</span></span> <span data-ttu-id="bd60b-161">hello 服務會執行下列步驟，每個批次，直到所有 shardlet 已都移動。</span><span class="sxs-lookup"><span data-stu-id="bd60b-161">hello service goes through these steps for every batch until all shardlets have been moved.</span></span> <span data-ttu-id="bd60b-162">這會導致 tooseveral 連線終止作業 hello 課程 hello 完成分割/合併/移動作業的期間。</span><span class="sxs-lookup"><span data-stu-id="bd60b-162">This will lead tooseveral connection kill operations during hello course of hello complete split/merge/move operation.</span></span>  

<span data-ttu-id="bd60b-163">**管理 Shardlet 可用性**</span><span class="sxs-lookup"><span data-stu-id="bd60b-163">**Managing shardlet availability**</span></span>

<span data-ttu-id="bd60b-164">限制 hello 連接終止的 shardlet 如同上面所討論的 toohello 目前批次會無法使用 tooone 批次的 shardlet 的 hello 範圍限制一次。</span><span class="sxs-lookup"><span data-stu-id="bd60b-164">Limiting hello connection killing toohello current batch of shardlets as discussed above restricts hello scope of unavailability tooone batch of shardlets at a time.</span></span> <span data-ttu-id="bd60b-165">這是慣用方法其中 hello 完成分區會保持離線狀態及其所有 shardlet hello 課程分割或合併作業的期間。</span><span class="sxs-lookup"><span data-stu-id="bd60b-165">This is preferred over an approach where hello complete shard would remain offline for all its shardlets during hello course of a split or merge operation.</span></span> <span data-ttu-id="bd60b-166">批次，一次定義為 hello 數目相異的 shardlet toomove hello 大小是設定參數。</span><span class="sxs-lookup"><span data-stu-id="bd60b-166">hello size of a batch, defined as hello number of distinct shardlets toomove at a time, is a configuration parameter.</span></span> <span data-ttu-id="bd60b-167">它可以定義每個分割及合併作業視 hello 應用程式的可用性和效能需求而定。</span><span class="sxs-lookup"><span data-stu-id="bd60b-167">It can be defined for each split and merge operation depending on hello application’s availability and performance needs.</span></span> <span data-ttu-id="bd60b-168">請注意，正在鎖定 hello 分區對應中的 hello 範圍可能大於指定的 hello 批次大小。</span><span class="sxs-lookup"><span data-stu-id="bd60b-168">Note that hello range that is being locked in hello shard map may be larger than hello batch size specified.</span></span> <span data-ttu-id="bd60b-169">這是因為 hello 服務會挑選 hello 範圍的大小，使得 hello 的分區化索引鍵值 hello 資料中的實際數目大約符合 hello 批次大小。</span><span class="sxs-lookup"><span data-stu-id="bd60b-169">This is because hello service picks hello range size such that hello actual number of sharding key values in hello data approximately matches hello batch size.</span></span> <span data-ttu-id="bd60b-170">這是重要的 tooremember 特別沒有嚴密填入的分區化索引鍵。</span><span class="sxs-lookup"><span data-stu-id="bd60b-170">This is important tooremember in particular for sparsely populated sharding keys.</span></span> 

<span data-ttu-id="bd60b-171">**中繼資料儲存體**</span><span class="sxs-lookup"><span data-stu-id="bd60b-171">**Metadata storage**</span></span>

<span data-ttu-id="bd60b-172">hello 分割合併服務會使用其狀態和 tookeep 要求處理期間會記錄資料庫 toomaintain。</span><span class="sxs-lookup"><span data-stu-id="bd60b-172">hello split-merge service uses a database toomaintain its status and tookeep logs during request processing.</span></span> <span data-ttu-id="bd60b-173">hello 使用者在其訂用帳戶中建立此資料庫，並提供它 hello 連接字串 hello hello 服務部署的組態檔中。</span><span class="sxs-lookup"><span data-stu-id="bd60b-173">hello user creates this database in their subscription and provides hello connection string for it in hello configuration file for hello service deployment.</span></span> <span data-ttu-id="bd60b-174">從 hello 使用者的組織的系統管理員也可以連接 toothis 資料庫 tooreview 要求進度和 tooinvestigate 詳細潛在的失敗有關的資訊。</span><span class="sxs-lookup"><span data-stu-id="bd60b-174">Administrators from hello user’s organization can also connect toothis database tooreview request progress and tooinvestigate detailed information regarding potential failures.</span></span>

<span data-ttu-id="bd60b-175">**分區化感知**</span><span class="sxs-lookup"><span data-stu-id="bd60b-175">**Sharding-awareness**</span></span>

<span data-ttu-id="bd60b-176">hello 分割合併服務區別 （1） 分區化資料表、 （2） 的參考資料表，以及 （3） 標準的資料表。</span><span class="sxs-lookup"><span data-stu-id="bd60b-176">hello split-merge service differentiates between (1) sharded tables, (2) reference tables, and (3) normal tables.</span></span> <span data-ttu-id="bd60b-177">hello 語意分割/合併/移動作業使用的 hello 資料表 hello 類型而定，以及定義如下：</span><span class="sxs-lookup"><span data-stu-id="bd60b-177">hello semantics of a split/merge/move operation depend on hello type of hello table used and are defined as follows:</span></span> 

* <span data-ttu-id="bd60b-178">**分區化資料表**： 分割、 合併和移動作業從來源 tootarget 分區中移動 shardlet。</span><span class="sxs-lookup"><span data-stu-id="bd60b-178">**Sharded tables**: Split, merge, and move operations move shardlets from source tootarget shard.</span></span> <span data-ttu-id="bd60b-179">Hello 順利完成之後整體要求，這些 shardlet 不再存在 hello 來源。</span><span class="sxs-lookup"><span data-stu-id="bd60b-179">After successful completion of hello overall request, those shardlets are no longer present on hello source.</span></span> <span data-ttu-id="bd60b-180">請注意，需要在 hello 目標分區 tooexist hello 目標資料表，而且不能包含的 hello 作業的 hello 目標範圍先前 tooprocessing 中的資料。</span><span class="sxs-lookup"><span data-stu-id="bd60b-180">Note that hello target tables need tooexist on hello target shard and must not contain data in hello target range prior tooprocessing of hello operation.</span></span> 
* <span data-ttu-id="bd60b-181">**參考資料表**： 參考資料表，hello 分割合併，並移動作業的 hello 資料複製 hello 來源 toohello 目標分區。</span><span class="sxs-lookup"><span data-stu-id="bd60b-181">**Reference tables**: For reference tables, hello split, merge and move operations copy hello data from hello source toohello target shard.</span></span> <span data-ttu-id="bd60b-182">不過請注意，是否任何資料列已存在於此資料表上 hello 目標 hello 目標分區給定資料表上會發生任何變更。</span><span class="sxs-lookup"><span data-stu-id="bd60b-182">Note, however, that no changes occur on hello target shard for a given table if any row is already present in this table on hello target.</span></span> <span data-ttu-id="bd60b-183">hello 資料表具有空的未處理任何參考資料表複製作業 tooget toobe。</span><span class="sxs-lookup"><span data-stu-id="bd60b-183">hello table has toobe empty for any reference table copy operation tooget processed.</span></span>
* <span data-ttu-id="bd60b-184">**其他資料表**： 其他資料表可以在 hello 來源或分割及合併作業的 hello 目標存在。</span><span class="sxs-lookup"><span data-stu-id="bd60b-184">**Other Tables**: Other tables can be present on either hello source or hello target of a split and merge operation.</span></span> <span data-ttu-id="bd60b-185">hello 分割合併服務會忽略這些資料表的任何資料移動或複製作業。</span><span class="sxs-lookup"><span data-stu-id="bd60b-185">hello split-merge service disregards these tables for any data movement or copy operations.</span></span> <span data-ttu-id="bd60b-186">但是請注意，在有條件約束時，它們會干擾這些作業。</span><span class="sxs-lookup"><span data-stu-id="bd60b-186">Note, however, that they can interfere with these operations in case of constraints.</span></span>

<span data-ttu-id="bd60b-187">hello 與分區化資料表的參考資訊係由 hello **SchemaInfo** hello 分區對應上的應用程式開發介面。</span><span class="sxs-lookup"><span data-stu-id="bd60b-187">hello information on reference vs. sharded tables is provided by hello **SchemaInfo** APIs on hello shard map.</span></span> <span data-ttu-id="bd60b-188">hello 下列範例會說明這些 Api 上指定的分區對應管理員物件 smm hello 用法：</span><span class="sxs-lookup"><span data-stu-id="bd60b-188">hello following example illustrates hello use of these APIs on a given shard map manager object smm:</span></span> 

    // Create hello schema annotations 
    SchemaInfo schemaInfo = new SchemaInfo(); 

    // Reference tables 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "region")); 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "nation")); 

    // Sharded tables 
    schemaInfo.Add(new ShardedTableInfo("dbo", "customer", "C_CUSTKEY")); 
    schemaInfo.Add(new ShardedTableInfo("dbo", "orders", "O_CUSTKEY")); 

    // Publish 
    smm.GetSchemaInfoCollection().Add(Configuration.ShardMapName, schemaInfo); 

<span data-ttu-id="bd60b-189">hello 資料表的 'region' 及 '民族' 定義為參考資料表，並將複製的分割/合併/移動作業。</span><span class="sxs-lookup"><span data-stu-id="bd60b-189">hello tables ‘region’ and ‘nation’ are defined as reference tables and will be copied with split/merge/move operations.</span></span> <span data-ttu-id="bd60b-190">‘customer’ 和 ‘orders’ 接著定義為分區化資料表。</span><span class="sxs-lookup"><span data-stu-id="bd60b-190">‘customer’ and ‘orders’ in turn are defined as sharded tables.</span></span> <span data-ttu-id="bd60b-191">C_CUSTKEY 和 O_CUSTKEY 做為 hello 分區化索引鍵。</span><span class="sxs-lookup"><span data-stu-id="bd60b-191">C_CUSTKEY and O_CUSTKEY serve as hello sharding key.</span></span> 

<span data-ttu-id="bd60b-192">**參考完整性**</span><span class="sxs-lookup"><span data-stu-id="bd60b-192">**Referential Integrity**</span></span>

<span data-ttu-id="bd60b-193">hello 分割合併服務會分析資料表之間的相依性，並使用外部索引鍵主索引鍵關聯性 toostage hello 作業來移動參考資料表和 shardlet。</span><span class="sxs-lookup"><span data-stu-id="bd60b-193">hello split-merge service analyzes dependencies between tables and uses foreign key-primary key relationships toostage hello operations for moving reference tables and shardlets.</span></span> <span data-ttu-id="bd60b-194">一般而言會先根據相依性順序複製參考資料表，然後在每個批次中再根據相依性順序複製 Shardlet。</span><span class="sxs-lookup"><span data-stu-id="bd60b-194">In general, reference tables are copied first in dependency order, then shardlets are copied in order of their dependencies within each batch.</span></span> <span data-ttu-id="bd60b-195">這是必要的如此 hello 新資料到達時，系統會接受 FK PK hello 目標分區的條件約束。</span><span class="sxs-lookup"><span data-stu-id="bd60b-195">This is necessary so that FK-PK constraints on hello target shard are honored as hello new data arrives.</span></span> 

<span data-ttu-id="bd60b-196">**分區對應一致性與最終完成**</span><span class="sxs-lookup"><span data-stu-id="bd60b-196">**Shard Map Consistency and Eventual Completion**</span></span>

<span data-ttu-id="bd60b-197">失敗 hello 存在，請在 hello 分割合併服務任何中斷之後繼續作業，以外的工具 toocomplete 任何要求正在進行中。</span><span class="sxs-lookup"><span data-stu-id="bd60b-197">In hello presence of failures, hello split-merge service resumes operations after any outage and aims toocomplete any in progress requests.</span></span> <span data-ttu-id="bd60b-198">不過，可能無法復原的情況下，例如遺失或無法修復危害 hello 目標分區時。</span><span class="sxs-lookup"><span data-stu-id="bd60b-198">However, there may be unrecoverable situations, e.g., when hello target shard is lost or compromised beyond repair.</span></span> <span data-ttu-id="bd60b-199">在這些情況下，某些原本 toobe 移動的 shardlet 可能繼續 tooreside hello 來源分區上。</span><span class="sxs-lookup"><span data-stu-id="bd60b-199">Under those circumstances, some shardlets that were supposed toobe moved may continue tooreside on hello source shard.</span></span> <span data-ttu-id="bd60b-200">hello 服務會確保 hello 必要的資料已順利複製的 toohello 目標後，才會更新 shardlet 對應。</span><span class="sxs-lookup"><span data-stu-id="bd60b-200">hello service ensures that shardlet mappings are only updated after hello necessary data has been successfully copied toohello target.</span></span> <span data-ttu-id="bd60b-201">當所有其資料已複製 toohello 目標，而且已成功更新 hello 對應的對應，Shardlet 只會刪除 hello 來源。</span><span class="sxs-lookup"><span data-stu-id="bd60b-201">Shardlets are only deleted on hello source once all their data has been copied toohello target and hello corresponding mappings have been updated successfully.</span></span> <span data-ttu-id="bd60b-202">在開啟時 hello 範圍已經線上 hello 目標分區 hello 刪除作業就會發生在 hello 背景。</span><span class="sxs-lookup"><span data-stu-id="bd60b-202">hello deletion operation happens in hello background while hello range is already online on hello target shard.</span></span> <span data-ttu-id="bd60b-203">hello 分割合併服務一律可以確保儲存在 hello 分區對應中的 hello 對應的正確性。</span><span class="sxs-lookup"><span data-stu-id="bd60b-203">hello split-merge service always ensures correctness of hello mappings stored in hello shard map.</span></span>

## <a name="hello-split-merge-user-interface"></a><span data-ttu-id="bd60b-204">hello 分割合併使用者介面</span><span class="sxs-lookup"><span data-stu-id="bd60b-204">hello split-merge user interface</span></span>
<span data-ttu-id="bd60b-205">hello 分割合併服務封裝包含背景工作角色和 web 角色。</span><span class="sxs-lookup"><span data-stu-id="bd60b-205">hello split-merge service package includes a worker role and a web role.</span></span> <span data-ttu-id="bd60b-206">hello web 角色是使用的 toosubmit 分割合併要求，以互動方式。</span><span class="sxs-lookup"><span data-stu-id="bd60b-206">hello web role is used toosubmit split-merge requests in an interactive way.</span></span> <span data-ttu-id="bd60b-207">如下所示為 hello hello 使用者介面的主要元件：</span><span class="sxs-lookup"><span data-stu-id="bd60b-207">hello main components of hello user interface are as follows:</span></span>

* <span data-ttu-id="bd60b-208">作業類型： hello 作業類型是作業的控制 hello 種類的 hello 服務此要求所執行的選項按鈕。</span><span class="sxs-lookup"><span data-stu-id="bd60b-208">Operation Type: hello operation type is a radio button that controls hello kind of operation performed by hello service for this request.</span></span> <span data-ttu-id="bd60b-209">您可以選擇 hello 分割、 合併和移動案例。</span><span class="sxs-lookup"><span data-stu-id="bd60b-209">You can choose between hello split, merge and move scenarios.</span></span> <span data-ttu-id="bd60b-210">您也可以取消先前提交的作業。</span><span class="sxs-lookup"><span data-stu-id="bd60b-210">You can also cancel a previously submitted operation.</span></span> <span data-ttu-id="bd60b-211">您可以在範圍分區對應中使用分割、合併和移動等要求。</span><span class="sxs-lookup"><span data-stu-id="bd60b-211">You can use split, merge and move requests for range shard maps.</span></span> <span data-ttu-id="bd60b-212">清單分區對應僅支援移動作業。</span><span class="sxs-lookup"><span data-stu-id="bd60b-212">List shard maps only support move operations.</span></span>
* <span data-ttu-id="bd60b-213">分區對應： hello 的下一節有關 hello 分區對應和 hello database 主控分區對應的要求參數封面資訊。</span><span class="sxs-lookup"><span data-stu-id="bd60b-213">Shard Map: hello next section of request parameters cover information about hello shard map and hello database hosting your shard map.</span></span> <span data-ttu-id="bd60b-214">特別是，則需要 hello Azure SQL Database 伺服器和資料庫裝載 hello shardmap tooprovide hello 名稱、 認證 tooconnect toohello 分區對應資料庫，而且最後 hello hello 分區對應的名稱。</span><span class="sxs-lookup"><span data-stu-id="bd60b-214">In particular, you need tooprovide hello name of hello Azure SQL Database server and database hosting hello shardmap, credentials tooconnect toohello shard map database, and finally hello name of hello shard map.</span></span> <span data-ttu-id="bd60b-215">目前，hello 作業只會接受一組認證。</span><span class="sxs-lookup"><span data-stu-id="bd60b-215">Currently, hello operation only accepts a single set of credentials.</span></span> <span data-ttu-id="bd60b-216">這些認證需要 toohave 足夠的權限 tooperform 變更 toohello 分區對應，以及在 hello 分區 toohello 使用者資料。</span><span class="sxs-lookup"><span data-stu-id="bd60b-216">These credentials need toohave sufficient permissions tooperform changes toohello shard map as well as toohello user data on hello shards.</span></span>
* <span data-ttu-id="bd60b-217">來源範圍 (分割和合併)：分割及合併作業會採用其低和高索引鍵處理該範圍。</span><span class="sxs-lookup"><span data-stu-id="bd60b-217">Source Range (split and merge): A split and merge operation processes a range using its low and high key.</span></span> <span data-ttu-id="bd60b-218">toospecify unbounded 高索引鍵值，核取的操作 hello 「 高索引鍵是最大 」 核取方塊，並將 hello 高索引鍵欄位保留空白。</span><span class="sxs-lookup"><span data-stu-id="bd60b-218">toospecify an operation with an unbounded high key value, check hello “High key is max” check box and leave hello high key field empty.</span></span> <span data-ttu-id="bd60b-219">對應和其分區對應中的界限，hello 範圍索引鍵指定值，會執行不需要 tooprecisely 相符。</span><span class="sxs-lookup"><span data-stu-id="bd60b-219">hello range key values that you specify do not need tooprecisely match a mapping and its boundaries in your shard map.</span></span> <span data-ttu-id="bd60b-220">如果您未指定任何範圍界限完全 hello 服務將 hello 最接近的範圍為您自動推斷。</span><span class="sxs-lookup"><span data-stu-id="bd60b-220">If you do not specify any range boundaries at all hello service will infer hello closest range for you automatically.</span></span> <span data-ttu-id="bd60b-221">您可以指定的分區對應中使用 hello GetMappings.ps1 PowerShell 指令碼 tooretrieve hello 目前的對應。</span><span class="sxs-lookup"><span data-stu-id="bd60b-221">You can use hello GetMappings.ps1 PowerShell script tooretrieve hello current mappings in a given shard map.</span></span>
* <span data-ttu-id="bd60b-222">分割來源行為 （分割）： 分割作業定義 hello 點 toosplit hello 來源範圍。</span><span class="sxs-lookup"><span data-stu-id="bd60b-222">Split Source Behavior (split): For split operations, define hello point toosplit hello source range.</span></span> <span data-ttu-id="bd60b-223">您藉由提供您要執行 hello 分割 toooccur hello 分區化索引鍵。</span><span class="sxs-lookup"><span data-stu-id="bd60b-223">You do this by providing hello sharding key where you want hello split toooccur.</span></span> <span data-ttu-id="bd60b-224">使用 [hello] 選項按鈕指定您是否要 hello 下半部的 hello （不含 hello 分割索引鍵） 的範圍 toomove，或是要 hello 上半部 toomove （包括 hello 分割索引鍵）。</span><span class="sxs-lookup"><span data-stu-id="bd60b-224">Use hello radio button specify whether you want hello lower part of hello range (excluding hello split key) toomove, or whether you want hello upper part toomove (including hello split key).</span></span>
* <span data-ttu-id="bd60b-225">來源 Shardlet （移動）： 移動作業會與不同分割或合併作業，因為它們不需要範圍 toodescribe hello 來源。</span><span class="sxs-lookup"><span data-stu-id="bd60b-225">Source Shardlet (move): Move operations are different from split or merge operations as they do not require a range toodescribe hello source.</span></span> <span data-ttu-id="bd60b-226">移動來源只需識別 hello 分區化索引鍵值您計劃 toomove。</span><span class="sxs-lookup"><span data-stu-id="bd60b-226">A source for move is simply identified by hello sharding key value that you plan toomove.</span></span>
* <span data-ttu-id="bd60b-227">目標分區 （分割）： 一旦您已經提供 hello 資訊 hello split 作業來源，您需要的 toodefine 您要執行 hello 資料 toobe 複製 tooby 提供 hello Azure SQL Db 伺服器及 hello 目標的資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="bd60b-227">Target Shard (split): Once you have provided hello information on hello source of your split operation, you need toodefine where you want hello data toobe copied tooby providing hello Azure SQL Db server and database name for hello target.</span></span>
* <span data-ttu-id="bd60b-228">在目標範圍 （合併）： 合併作業移動 shardlet tooan 現有分區。</span><span class="sxs-lookup"><span data-stu-id="bd60b-228">Target Range (merge): Merge operations move shardlets tooan existing shard.</span></span> <span data-ttu-id="bd60b-229">您可以識別 hello 現有分區藉由提供您想要使用 toomerge hello 現有範圍的 hello 範圍界限。</span><span class="sxs-lookup"><span data-stu-id="bd60b-229">You identify hello existing shard by providing hello range boundaries of hello existing range that you want toomerge with.</span></span>
* <span data-ttu-id="bd60b-230">批次大小： hello 批次大小控制 hello 將離線期間 hello 資料移動一次的 shardlet 數目。</span><span class="sxs-lookup"><span data-stu-id="bd60b-230">Batch Size: hello batch size controls hello number of shardlets that will go offline at a time during hello data movement.</span></span> <span data-ttu-id="bd60b-231">這是整數值都區分 toolong 週期的 shardlet 的停機時間時，可使用較小的值。</span><span class="sxs-lookup"><span data-stu-id="bd60b-231">This is an integer value where you can use smaller values when you are sensitive toolong periods of downtime for shardlets.</span></span> <span data-ttu-id="bd60b-232">較大的值會增加所給定的 shardlet 是 hello 時間離線，但可能會改善效能。</span><span class="sxs-lookup"><span data-stu-id="bd60b-232">Larger values will increase hello time that a given shardlet is offline but may improve performance.</span></span>
* <span data-ttu-id="bd60b-233">作業識別碼 （取消）： 如果您不再需要的進行中作業，您可以取消 hello 作業提供其在此欄位中的作業識別碼。</span><span class="sxs-lookup"><span data-stu-id="bd60b-233">Operation Id (Cancel): If you have an ongoing operation that is no longer needed, you can cancel hello operation by providing its operation ID in this field.</span></span> <span data-ttu-id="bd60b-234">您可以從 hello 要求狀態資料表擷取 hello 作業 ID （請參閱 > 一節 8.1） 或從您送出 hello 要求 hello 網頁瀏覽器中的 hello 輸出。</span><span class="sxs-lookup"><span data-stu-id="bd60b-234">You can retrieve hello operation ID from hello request status table (see Section 8.1) or from hello output in hello web browser where you submitted hello request.</span></span>

## <a name="requirements-and-limitations"></a><span data-ttu-id="bd60b-235">需求和限制</span><span class="sxs-lookup"><span data-stu-id="bd60b-235">Requirements and Limitations</span></span>
<span data-ttu-id="bd60b-236">hello 目前的實作中的 hello 分割合併服務是主體 toohello 下列需求和限制：</span><span class="sxs-lookup"><span data-stu-id="bd60b-236">hello current implementation of hello split-merge service is subject toohello following requirements and limitations:</span></span> 

* <span data-ttu-id="bd60b-237">hello 分區需要 tooexist 和 hello 分區對應中註冊，才能執行這些分區分割 merge 作業。</span><span class="sxs-lookup"><span data-stu-id="bd60b-237">hello shards need tooexist and be registered in hello shard map before a split-merge operation on these shards can be performed.</span></span> 
* <span data-ttu-id="bd60b-238">hello 服務不會建立資料表或其他任何資料庫物件會自動做為其作業的一部分。</span><span class="sxs-lookup"><span data-stu-id="bd60b-238">hello service does not create tables or any other database objects automatically as part of its operations.</span></span> <span data-ttu-id="bd60b-239">這表示 hello 所有分區化資料表的結構描述和參考資料表需要 tooexist hello 目標分區先前 tooany 分割/合併/移動作業。</span><span class="sxs-lookup"><span data-stu-id="bd60b-239">This means that hello schema for all sharded tables and reference tables need tooexist on hello target shard prior tooany split/merge/move operation.</span></span> <span data-ttu-id="bd60b-240">分區化資料表尤其是需要的 toobe 空 hello 範圍新 shardlet 的 toobe 分割/合併/移動作業所加入的位置中。</span><span class="sxs-lookup"><span data-stu-id="bd60b-240">Sharded tables in particular are required toobe empty in hello range where new shardlets are toobe added by a split/merge/move operation.</span></span> <span data-ttu-id="bd60b-241">否則，hello 作業將會失敗 hello 目標分區執行 hello 初始一致性的檢查。</span><span class="sxs-lookup"><span data-stu-id="bd60b-241">Otherwise, hello operation will fail hello initial consistency check on hello target shard.</span></span> <span data-ttu-id="bd60b-242">也請注意，如果 hello 參考資料表是空的只會複製參考資料，而且沒有任何一致性保證與 hello 參考資料表上的考慮 tooother 並行寫入作業。</span><span class="sxs-lookup"><span data-stu-id="bd60b-242">Also note that reference data is only copied if hello reference table is empty and that there are no consistency guarantees with regard tooother concurrent write operations on hello reference tables.</span></span> <span data-ttu-id="bd60b-243">我們建議您這樣做： 當執行分割/合併作業，任何寫入作業變更 toohello 參考資料表。</span><span class="sxs-lookup"><span data-stu-id="bd60b-243">We recommend this: when running split/merge operations, no other write operations make changes toohello reference tables.</span></span>
* <span data-ttu-id="bd60b-244">hello 服務會依賴唯一索引或索引鍵包含 hello 分區化索引鍵 tooimprove 效能和可靠性，大型的 shardlet 所建立的資料列識別。</span><span class="sxs-lookup"><span data-stu-id="bd60b-244">hello service relies on row identity established by a unique index or key that includes hello sharding key tooimprove performance and reliability for large shardlets.</span></span> <span data-ttu-id="bd60b-245">如此 hello 服務 toomove 資料即使細微比只 hello 分區化索引鍵值。</span><span class="sxs-lookup"><span data-stu-id="bd60b-245">This allows hello service toomove data at an even finer granularity than just hello sharding key value.</span></span> <span data-ttu-id="bd60b-246">這有助於 tooreduce hello 最大記錄檔空間量以及 hello 作業期間所需的鎖定。</span><span class="sxs-lookup"><span data-stu-id="bd60b-246">This helps tooreduce hello maximum amount of log space and locks that are required during hello operation.</span></span> <span data-ttu-id="bd60b-247">請考慮建立唯一索引或主索引鍵包括 hello 給定資料表上的分區化索引鍵，如果您想 toouse 該資料表具有分割/合併/移動要求。</span><span class="sxs-lookup"><span data-stu-id="bd60b-247">Consider creating a unique index or a primary key including hello sharding key on a given table if you want toouse that table with split/merge/move requests.</span></span> <span data-ttu-id="bd60b-248">基於效能考量，hello 分區化索引鍵應該是 hello hello 索引鍵或 hello 索引中的前置資料行。</span><span class="sxs-lookup"><span data-stu-id="bd60b-248">For performance reasons, hello sharding key should be hello leading column in hello key or hello index.</span></span>
* <span data-ttu-id="bd60b-249">在 hello 要求處理期間，某些 shardlet 資料可能會出現 hello 來源和 hello 目標分區。</span><span class="sxs-lookup"><span data-stu-id="bd60b-249">During hello course of request processing, some shardlet data may be present both on hello source and hello target shard.</span></span> <span data-ttu-id="bd60b-250">這是必要 tooprotect 故障期間 hello shardlet 移動。</span><span class="sxs-lookup"><span data-stu-id="bd60b-250">This is necessary tooprotect against failures during hello shardlet movement.</span></span> <span data-ttu-id="bd60b-251">hello 與 hello 分區對應的分割-合併的整合可確保透過 hello 資料依存路由應用程式開發介面使用的連線 hello **OpenConnectionForKey**方法 hello 分區對應上的看不到任何不一致的中繼狀態。</span><span class="sxs-lookup"><span data-stu-id="bd60b-251">hello integration of split-merge with hello shard map ensures that connections through hello data dependent routing APIs using hello **OpenConnectionForKey** method on hello shard map do not see any inconsistent intermediate states.</span></span> <span data-ttu-id="bd60b-252">不過，當連接 toohello 來源或 hello 目標分區不使用 hello **OpenConnectionForKey**方法，不一致的中繼狀態可能會看到當分割/合併/移動要求所進行的作業。</span><span class="sxs-lookup"><span data-stu-id="bd60b-252">However, when connecting toohello source or hello target shards without using hello **OpenConnectionForKey** method, inconsistent intermediate states might be visible when split/merge/move requests are going on.</span></span> <span data-ttu-id="bd60b-253">這些連線可能會顯示部分或重複的結果，根據 hello 計時或 hello 分區基礎 hello 連接。</span><span class="sxs-lookup"><span data-stu-id="bd60b-253">These connections may show partial or duplicate results depending on hello timing or hello shard underlying hello connection.</span></span> <span data-ttu-id="bd60b-254">這項限制目前包含彈性延展多-Shard-查詢所進行的 hello 連線。</span><span class="sxs-lookup"><span data-stu-id="bd60b-254">This limitation currently includes hello connections made by Elastic Scale Multi-Shard-Queries.</span></span>
* <span data-ttu-id="bd60b-255">hello hello 分割合併服務的中繼資料資料庫必須不同的角色之間共用。</span><span class="sxs-lookup"><span data-stu-id="bd60b-255">hello metadata database for hello split-merge service must not be shared between different roles.</span></span> <span data-ttu-id="bd60b-256">例如，角色執行臨時比 hello 生產角色需要 toopoint tooa 不同的中繼資料資料庫中的 hello 分割合併服務。</span><span class="sxs-lookup"><span data-stu-id="bd60b-256">For example, a role of hello split-merge service running in staging needs toopoint tooa different metadata database than hello production role.</span></span>

## <a name="billing"></a><span data-ttu-id="bd60b-257">計費</span><span class="sxs-lookup"><span data-stu-id="bd60b-257">Billing</span></span>
<span data-ttu-id="bd60b-258">hello 分割合併服務會執行您的 Microsoft Azure 訂用帳戶中的雲端服務。</span><span class="sxs-lookup"><span data-stu-id="bd60b-258">hello split-merge service runs as a cloud service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="bd60b-259">因此雲端服務的費用 tooyour hello 服務執行個體。</span><span class="sxs-lookup"><span data-stu-id="bd60b-259">Therefore charges for cloud services apply tooyour instance of hello service.</span></span> <span data-ttu-id="bd60b-260">除非您經常執行分割/合併/移動作業，否則建議您刪除分割合併雲端服務。</span><span class="sxs-lookup"><span data-stu-id="bd60b-260">Unless you frequently perform split/merge/move operations, we recommend you delete your split-merge cloud service.</span></span> <span data-ttu-id="bd60b-261">這可以節省執行中或已部署的雲端服務執行個體的成本。</span><span class="sxs-lookup"><span data-stu-id="bd60b-261">That saves costs for running or deployed cloud service instances.</span></span> <span data-ttu-id="bd60b-262">您可以重新部署並啟動您隨時可執行的設定，每當您需要 tooperform 分割或合併作業。</span><span class="sxs-lookup"><span data-stu-id="bd60b-262">You can re-deploy and start your readily runnable configuration whenever you need tooperform split or merge operations.</span></span> 

## <a name="monitoring"></a><span data-ttu-id="bd60b-263">監視</span><span class="sxs-lookup"><span data-stu-id="bd60b-263">Monitoring</span></span>
### <a name="status-tables"></a><span data-ttu-id="bd60b-264">狀態資料表</span><span class="sxs-lookup"><span data-stu-id="bd60b-264">Status tables</span></span>
<span data-ttu-id="bd60b-265">hello 分割合併服務提供 hello **RequestStatus**監視的要求已完成與進行中的 hello 中繼資料存放區資料庫中的資料表。</span><span class="sxs-lookup"><span data-stu-id="bd60b-265">hello split-merge Service provides hello **RequestStatus** table in hello metadata store database for monitoring of completed and ongoing requests.</span></span> <span data-ttu-id="bd60b-266">hello 資料表會列出每個分割合併要求已送出的 toothis hello 分割合併服務執行個體的資料列。</span><span class="sxs-lookup"><span data-stu-id="bd60b-266">hello table lists a row for each split-merge request that has been submitted toothis instance of hello split-merge service.</span></span> <span data-ttu-id="bd60b-267">它提供下列資訊為每個要求的 hello:</span><span class="sxs-lookup"><span data-stu-id="bd60b-267">It gives hello following information for each request:</span></span>

* <span data-ttu-id="bd60b-268">**時間戳記**: hello hello 要求啟動時的日期和時間。</span><span class="sxs-lookup"><span data-stu-id="bd60b-268">**Timestamp**: hello time and date when hello request was started.</span></span>
* <span data-ttu-id="bd60b-269">**OperationId**： 唯一識別 hello 要求的 GUID。</span><span class="sxs-lookup"><span data-stu-id="bd60b-269">**OperationId**: A GUID that uniquely identifies hello request.</span></span> <span data-ttu-id="bd60b-270">這項要求也可以使用的 toocancel hello 作業仍在進行中時。</span><span class="sxs-lookup"><span data-stu-id="bd60b-270">This request can also be used toocancel hello operation while it is still ongoing.</span></span>
* <span data-ttu-id="bd60b-271">**狀態**: hello hello 要求的目前狀態。</span><span class="sxs-lookup"><span data-stu-id="bd60b-271">**Status**: hello current state of hello request.</span></span> <span data-ttu-id="bd60b-272">對於進行中的要求，它也會列出 hello 在哪一個 hello 是要求的目前階段。</span><span class="sxs-lookup"><span data-stu-id="bd60b-272">For ongoing requests, it also lists hello current phase in which hello request is.</span></span>
* <span data-ttu-id="bd60b-273">**CancelRequest**: 旗標，指出是否 hello 要求已取消。</span><span class="sxs-lookup"><span data-stu-id="bd60b-273">**CancelRequest**: A flag that indicates whether hello request has been cancelled.</span></span>
* <span data-ttu-id="bd60b-274">**進度**: hello 作業完成的百分比估計。</span><span class="sxs-lookup"><span data-stu-id="bd60b-274">**Progress**: A percentage estimate of completion for hello operation.</span></span> <span data-ttu-id="bd60b-275">一個 50 的值會指出 hello 作業已完成大約 50%。</span><span class="sxs-lookup"><span data-stu-id="bd60b-275">A value of 50 indicates that hello operation is approximately 50% complete.</span></span>
* <span data-ttu-id="bd60b-276">**Details**：XML 值，提供更詳細的進度報表。</span><span class="sxs-lookup"><span data-stu-id="bd60b-276">**Details**: An XML value that provides a more detailed progress report.</span></span> <span data-ttu-id="bd60b-277">hello 進度 報表會隨著個資料列集都會從來源 tootarget 複製定期更新。</span><span class="sxs-lookup"><span data-stu-id="bd60b-277">hello progress report is periodically updated as sets of rows are copied from source tootarget.</span></span> <span data-ttu-id="bd60b-278">如果發生失敗或例外狀況，此資料行也包含 hello 失敗的詳細的資訊。</span><span class="sxs-lookup"><span data-stu-id="bd60b-278">In case of failures or exceptions, this column also includes more detailed information about hello failure.</span></span>

### <a name="azure-diagnostics"></a><span data-ttu-id="bd60b-279">Azure 診斷</span><span class="sxs-lookup"><span data-stu-id="bd60b-279">Azure Diagnostics</span></span>
<span data-ttu-id="bd60b-280">hello 分割合併服務會使用 Azure 診斷以 Azure SDK 2.5 監視和診斷。</span><span class="sxs-lookup"><span data-stu-id="bd60b-280">hello split-merge service uses Azure Diagnostics based on Azure SDK 2.5 for monitoring and diagnostics.</span></span> <span data-ttu-id="bd60b-281">您控制 hello 診斷組態，如這裡所說明：[在 Azure 雲端服務和虛擬機器中啟用診斷](../cloud-services/cloud-services-dotnet-diagnostics.md)。</span><span class="sxs-lookup"><span data-stu-id="bd60b-281">You control hello diagnostics configuration as explained here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> <span data-ttu-id="bd60b-282">hello 下載封裝包含兩個診斷組態-一個用於 hello web 角色，一個 hello 背景工作角色。</span><span class="sxs-lookup"><span data-stu-id="bd60b-282">hello download package includes two diagnostics configurations - one for hello web role and one for hello worker role.</span></span> <span data-ttu-id="bd60b-283">請遵循從 hello 指引，這些 hello 服務的診斷組態[Microsoft Azure 中雲端服務基本概念](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649)。</span><span class="sxs-lookup"><span data-stu-id="bd60b-283">These diagnostics configurations for hello service follow hello guidance from [Cloud Service Fundamentals in Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649).</span></span> <span data-ttu-id="bd60b-284">其中包括 hello 定義 toolog 效能計數器、 IIS 記錄檔、 Windows 事件記錄檔，以及分割合併應用程式事件記錄檔。</span><span class="sxs-lookup"><span data-stu-id="bd60b-284">It includes hello definitions toolog Performance Counters, IIS logs, Windows Event Logs, and split-merge application event logs.</span></span> 

## <a name="deploy-diagnostics"></a><span data-ttu-id="bd60b-285">部署診斷</span><span class="sxs-lookup"><span data-stu-id="bd60b-285">Deploy Diagnostics</span></span>
<span data-ttu-id="bd60b-286">tooenable 監視和診斷使用 hello hello NuGet 封裝，執行下列命令，使用 Azure PowerShell 的 hello 所提供的 hello web 和背景工作角色的診斷組態：</span><span class="sxs-lookup"><span data-stu-id="bd60b-286">tooenable monitoring and diagnostics using hello diagnostic configuration for hello web and worker roles provided by hello NuGet package, run hello following commands using Azure PowerShell:</span></span> 

    $storage_name = "<YourAzureStorageAccount>" 

    $key = "<YourAzureStorageAccountKey" 

    $storageContext = New-AzureStorageContext -StorageAccountName $storage_name -StorageAccountKey $key  


    $config_path = "<YourFilePath>\SplitMergeWebContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWeb" 


    $config_path = "<YourFilePath>\SplitMergeWorkerContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWorker" 

<span data-ttu-id="bd60b-287">您可以找到更多有關如何 tooconfigure 和部署以下的診斷設定：[在 Azure 雲端服務和虛擬機器中啟用診斷](../cloud-services/cloud-services-dotnet-diagnostics.md)。</span><span class="sxs-lookup"><span data-stu-id="bd60b-287">You can find more information on how tooconfigure and deploy diagnostics settings here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> 

## <a name="retrieve-diagnostics"></a><span data-ttu-id="bd60b-288">擷取診斷</span><span class="sxs-lookup"><span data-stu-id="bd60b-288">Retrieve diagnostics</span></span>
<span data-ttu-id="bd60b-289">您可以從 hello Azure hello 伺服器總管 樹狀目錄的組件中的 hello Visual Studio 伺服器總管，輕鬆存取您的診斷。</span><span class="sxs-lookup"><span data-stu-id="bd60b-289">You can easily access your diagnostics from hello Visual Studio Server Explorer in hello Azure part of hello Server Explorer tree.</span></span> <span data-ttu-id="bd60b-290">開啟 Visual Studio 執行個體，並在 hello 功能表列中按一下 [檢視] 和 [伺服器總管]。</span><span class="sxs-lookup"><span data-stu-id="bd60b-290">Open a Visual Studio instance, and in hello menu bar click View, and Server Explorer.</span></span> <span data-ttu-id="bd60b-291">按一下 hello Azure 圖示 tooconnect tooyour Azure 訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="bd60b-291">Click hello Azure icon tooconnect tooyour Azure subscription.</span></span> <span data-ttu-id="bd60b-292">然後瀏覽 tooAzure]-> [儲存體]-> [ <your storage account> ]-> [資料表]-> [WADLogsTable。</span><span class="sxs-lookup"><span data-stu-id="bd60b-292">Then navigate tooAzure -> Storage -> <your storage account> -> Tables -> WADLogsTable.</span></span> <span data-ttu-id="bd60b-293">如需詳細資訊，請參閱 [使用伺服器總管瀏覽儲存體資源](http://msdn.microsoft.com/library/azure/ff683677.aspx)。</span><span class="sxs-lookup"><span data-stu-id="bd60b-293">For more information, see [Browsing Storage Resources with Server Explorer](http://msdn.microsoft.com/library/azure/ff683677.aspx).</span></span> 

![WADLogsTable][2]

<span data-ttu-id="bd60b-295">hello WADLogsTable hello 上圖中反白顯示包含 hello hello 分割合併服務的應用程式記錄檔的事件詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="bd60b-295">hello WADLogsTable highlighted in hello figure above contains hello detailed events from hello split-merge service’s application log.</span></span> <span data-ttu-id="bd60b-296">請注意該 hello 的預設組態 hello 下載封裝導向到生產環境部署。</span><span class="sxs-lookup"><span data-stu-id="bd60b-296">Note that hello default configuration of hello downloaded package is geared towards a production deployment.</span></span> <span data-ttu-id="bd60b-297">因此，記錄檔和計數器取自 hello 服務執行個體的 hello 間隔是大型 （5 分鐘）。</span><span class="sxs-lookup"><span data-stu-id="bd60b-297">Therefore hello interval at which logs and counters are pulled from hello service instances is large (5 minutes).</span></span> <span data-ttu-id="bd60b-298">針對測試和開發，需要較低的 hello 間隔，藉由調整 hello web 或 hello 背景工作角色 tooyour hello 診斷設定。</span><span class="sxs-lookup"><span data-stu-id="bd60b-298">For test and development, lower hello interval by adjusting hello diagnostics settings of hello web or hello worker role tooyour needs.</span></span> <span data-ttu-id="bd60b-299">Hello Visual Studio 伺服器總管 （請參閱上面說明） 中的 hello 角色上按一下滑鼠右鍵，然後調整 [hello 傳輸期間在 hello] 對話方塊中的 hello 診斷組態設定：</span><span class="sxs-lookup"><span data-stu-id="bd60b-299">Right-click on hello role in hello Visual Studio Server Explorer (see above) and then adjust hello Transfer Period in hello dialog for hello Diagnostics configuration settings:</span></span> 

![組態][3]

## <a name="performance"></a><span data-ttu-id="bd60b-301">效能</span><span class="sxs-lookup"><span data-stu-id="bd60b-301">Performance</span></span>
<span data-ttu-id="bd60b-302">一般情況下，較佳的效能是 toobe 預期來自 hello 更高版本，Azure SQL Database 中的多個高效能服務層。</span><span class="sxs-lookup"><span data-stu-id="bd60b-302">In general, better performance is toobe expected from hello higher, more performant service tiers in Azure SQL Database.</span></span> <span data-ttu-id="bd60b-303">Hello 更高的服務層的高 IO、 CPU 和記憶體配置獲益 hello 大量複製和刪除 hello 分割合併服務所使用的作業。</span><span class="sxs-lookup"><span data-stu-id="bd60b-303">Higher IO, CPU and memory allocations for hello higher service tiers benefit hello bulk copy and delete operations that hello split-merge service uses.</span></span> <span data-ttu-id="bd60b-304">因此，只針對這些資料庫用於已定義的增加 hello 服務層限制一段時間。</span><span class="sxs-lookup"><span data-stu-id="bd60b-304">For that reason, increase hello service tier just for those databases for a defined, limited period of time.</span></span>

<span data-ttu-id="bd60b-305">hello 服務也會執行驗證查詢做為其正常作業的一部分。</span><span class="sxs-lookup"><span data-stu-id="bd60b-305">hello service also performs validation queries as part of its normal operations.</span></span> <span data-ttu-id="bd60b-306">這些驗證查詢檢查 hello 目標範圍中的資料的非預期出現，並確保一致的狀態從會啟動任何分割/合併/移動作業。</span><span class="sxs-lookup"><span data-stu-id="bd60b-306">These validation queries check for unexpected presence of data in hello target range and ensure that any split/merge/move operation starts from a consistent state.</span></span> <span data-ttu-id="bd60b-307">這些查詢所有工作透過 hello 操作與 hello 批次大小為 hello 要求定義的一部分提供的 hello 範圍所定義的分區化索引鍵範圍。</span><span class="sxs-lookup"><span data-stu-id="bd60b-307">These queries all work over sharding key ranges defined by hello scope of hello operation and hello batch size provided as part of hello request definition.</span></span> <span data-ttu-id="bd60b-308">這些查詢會具有最佳的索引時有 hello 分區化索引鍵如下 hello 開頭的資料行，以便於出現。</span><span class="sxs-lookup"><span data-stu-id="bd60b-308">These queries perform best when an index is present that has hello sharding key as hello leading column.</span></span> 

<span data-ttu-id="bd60b-309">此外，hello 分區化索引鍵為 hello 前置資料行的唯一性屬性將可讓 hello 服務 toouse，限制資源耗用量，以記錄檔空間和記憶體最佳化的方法。</span><span class="sxs-lookup"><span data-stu-id="bd60b-309">In addition, a uniqueness property with hello sharding key as hello leading column will allow hello service toouse an optimized approach that limits resource consumption in terms of log space and memory.</span></span> <span data-ttu-id="bd60b-310">這個唯一性屬性是必要的 toomove 大型的資料大小 （通常超過 1 GB)。</span><span class="sxs-lookup"><span data-stu-id="bd60b-310">This uniqueness property is required toomove large data sizes (typically above 1GB).</span></span> 

## <a name="how-tooupgrade"></a><span data-ttu-id="bd60b-311">如何 tooupgrade</span><span class="sxs-lookup"><span data-stu-id="bd60b-311">How tooupgrade</span></span>
1. <span data-ttu-id="bd60b-312">中的 hello 步驟[部署分割合併服務](sql-database-elastic-scale-configure-deploy-split-and-merge.md)。</span><span class="sxs-lookup"><span data-stu-id="bd60b-312">Follow hello steps in [Deploy a split-merge service](sql-database-elastic-scale-configure-deploy-split-and-merge.md).</span></span>
2. <span data-ttu-id="bd60b-313">變更雲端服務組態檔的分割合併部署 tooreflect hello 新組態參數。</span><span class="sxs-lookup"><span data-stu-id="bd60b-313">Change your cloud service configuration file for your split-merge deployment tooreflect hello new configuration parameters.</span></span> <span data-ttu-id="bd60b-314">新的必要的參數是 hello hello 用於加密的憑證資訊。</span><span class="sxs-lookup"><span data-stu-id="bd60b-314">A new required parameter is hello information about hello certificate used for encryption.</span></span> <span data-ttu-id="bd60b-315">輕鬆 toodo 這是 toocompare hello 新設定的範本檔從 hello 下載針對現有的組態。</span><span class="sxs-lookup"><span data-stu-id="bd60b-315">An easy way toodo this is toocompare hello new configuration template file from hello download against your existing configuration.</span></span> <span data-ttu-id="bd60b-316">請確認您新增 hello"DataEncryptionPrimaryCertificateThumbprint"和"DataEncryptionPrimary"hello web 和設定 hello 背景工作角色。</span><span class="sxs-lookup"><span data-stu-id="bd60b-316">Make sure you add hello settings for “DataEncryptionPrimaryCertificateThumbprint” and “DataEncryptionPrimary” for both hello web and hello worker role.</span></span>
3. <span data-ttu-id="bd60b-317">在部署之前 hello 更新 tooAzure，確定所有目前執行分割合併作業已完成。</span><span class="sxs-lookup"><span data-stu-id="bd60b-317">Before deploying hello update tooAzure, ensure that all currently running split-merge operations have finished.</span></span> <span data-ttu-id="bd60b-318">您可以輕鬆地執行這項操作藉由查詢要求進行中的 hello 分割合併中繼資料資料庫中的 hello RequestStatus 和 PendingWorkflows 資料表。</span><span class="sxs-lookup"><span data-stu-id="bd60b-318">You can easily do this by querying hello RequestStatus and PendingWorkflows tables in hello split-merge metadata database for ongoing requests.</span></span>
4. <span data-ttu-id="bd60b-319">更新現有的雲端服務部署，您的 Azure 訂閱 hello 新的套件和更新的服務組態檔中的分割合併。</span><span class="sxs-lookup"><span data-stu-id="bd60b-319">Update your existing cloud service deployment for split-merge in your Azure subscription with hello new package and your updated service configuration file.</span></span>

<span data-ttu-id="bd60b-320">您不需要分割合併 tooupgrade tooprovision 新的中繼資料資料庫。</span><span class="sxs-lookup"><span data-stu-id="bd60b-320">You do not need tooprovision a new metadata database for split-merge tooupgrade.</span></span> <span data-ttu-id="bd60b-321">hello 新版本，將會自動升級現有的中繼資料資料庫 toohello 新版本。</span><span class="sxs-lookup"><span data-stu-id="bd60b-321">hello new version will automatically upgrade your existing metadata database toohello new version.</span></span> 

## <a name="best-practices--troubleshooting"></a><span data-ttu-id="bd60b-322">最佳作法和疑難排解</span><span class="sxs-lookup"><span data-stu-id="bd60b-322">Best practices & troubleshooting</span></span>
* <span data-ttu-id="bd60b-323">定義的測試租用戶並執行您最重要的分割/合併/移動作業與 hello 測試租用戶跨數個分區。</span><span class="sxs-lookup"><span data-stu-id="bd60b-323">Define a test tenant and exercise your most important split/merge/move operations with hello test tenant across several shards.</span></span> <span data-ttu-id="bd60b-324">確定分區對應中定義的所有中繼資料是正確的 hello 作業不會違反條件約束或外部索引鍵。</span><span class="sxs-lookup"><span data-stu-id="bd60b-324">Ensure that all metadata is defined correctly in your shard map and that hello operations do not violate constraints or foreign keys.</span></span>
* <span data-ttu-id="bd60b-325">保留 hello 測試租用戶的資料大小超過 hello 最大的資料大小的最大的租用戶 tooensure 未遇到資料大小相關問題。</span><span class="sxs-lookup"><span data-stu-id="bd60b-325">Keep hello test tenant data size above hello maximum data size of your largest tenant tooensure you are not encountering data size related issues.</span></span> <span data-ttu-id="bd60b-326">這可協助您評估 hello 花的時間 toomove 周圍的單一租用戶上的上限。</span><span class="sxs-lookup"><span data-stu-id="bd60b-326">This helps you assess an upper bound on hello time it takes toomove a single tenant around.</span></span> 
* <span data-ttu-id="bd60b-327">請確定您的結構描述允許刪除動作。</span><span class="sxs-lookup"><span data-stu-id="bd60b-327">Make sure that your schema allows deletions.</span></span> <span data-ttu-id="bd60b-328">hello 分割合併服務需要來自 hello 來源分區 hello 能力 tooremove 資料 hello 資料已順利複製的 toohello 目標後。</span><span class="sxs-lookup"><span data-stu-id="bd60b-328">hello split-merge service requires hello ability tooremove data from hello source shard once hello data has been successfully copied toohello target.</span></span> <span data-ttu-id="bd60b-329">例如，**刪除觸發程序**可以避免 hello 服務刪除 hello hello 來源資料，而導致作業 toofail。</span><span class="sxs-lookup"><span data-stu-id="bd60b-329">For example, **delete triggers** can prevent hello service from deleting hello data on hello source and may cause operations toofail.</span></span>
* <span data-ttu-id="bd60b-330">hello 分區化索引鍵應該是主索引鍵或唯一索引定義中的 hello 前端資料行。</span><span class="sxs-lookup"><span data-stu-id="bd60b-330">hello sharding key should be hello leading column in your primary key or unique index definition.</span></span> <span data-ttu-id="bd60b-331">這可確保 hello hello 最佳效能分割或合併驗證查詢和 hello 實際的資料移動和刪除作業一律在分區化索引鍵範圍上運作。</span><span class="sxs-lookup"><span data-stu-id="bd60b-331">That ensures hello best performance for hello split or merge validation queries, and for hello actual data movement and deletion operations which always operate on sharding key ranges.</span></span>
* <span data-ttu-id="bd60b-332">共置分割合併服務在您的資料庫所在的 hello 區域及資料中心。</span><span class="sxs-lookup"><span data-stu-id="bd60b-332">Collocate your split-merge service in hello region and data center where your databases reside.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Anchors-->
<!--Image references-->
[1]:./media/sql-database-elastic-scale-overview-split-and-merge/split-merge-overview.png
[2]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics.png
[3]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics-config.png

