---
title: "雲端商務持續性 - 資料庫復原 - SQL Database | Microsoft Docs"
description: "了解 Azure SQL Database 如何支援雲端商務持續性和資料庫復原，以及如何協助維持任務關鍵性雲端應用程式持續執行。"
keywords: "business continuity,cloud business continuity,database disaster recovery,database recovery,商務持續性,雲端商務持續性,資料庫災害復原,資料庫復原"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: 
ms.assetid: 18e5d3f1-bfe5-4089-b6fd-76988ab29822
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 05/15/2017
ms.author: sashan
ms.openlocfilehash: cc93ee34a37a4a8688fa2eca338126c13b9940c0
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="overview-of-business-continuity-with-azure-sql-database"></a><span data-ttu-id="5c594-104">使用 Azure SQL Database 的商務持續性概觀</span><span class="sxs-lookup"><span data-stu-id="5c594-104">Overview of business continuity with Azure SQL Database</span></span>

<span data-ttu-id="5c594-105">本概觀說明 Azure SQL Database 針對商務持續性和災害復原所提供的功能。</span><span class="sxs-lookup"><span data-stu-id="5c594-105">This overview describes the capabilities that Azure SQL Database provides for business continuity and disaster recovery.</span></span> <span data-ttu-id="5c594-106">了解選項、建議和教學課程，以從可能導致資料遺失或造成資料庫和應用程式無法使用的干擾性事件中復原。</span><span class="sxs-lookup"><span data-stu-id="5c594-106">Learn about options, recommendations, and tutorials for recovering from disruptive events that could cause data loss or cause your database and application to become unavailable.</span></span> <span data-ttu-id="5c594-107">了解當使用者或應用程式錯誤影響資料完整性、Azure 區域中斷，或您的應用程式需要維護時該如何處理。</span><span class="sxs-lookup"><span data-stu-id="5c594-107">Learn what to do when a user or application error affects data integrity, an Azure region has an outage, or your application requires maintenance.</span></span>

## <a name="sql-database-features-that-you-can-use-to-provide-business-continuity"></a><span data-ttu-id="5c594-108">您可用來提供商務持續性的 SQL Database 功能</span><span class="sxs-lookup"><span data-stu-id="5c594-108">SQL Database features that you can use to provide business continuity</span></span>

<span data-ttu-id="5c594-109">SQL Database 提供幾種商務持續性功能，包括自動備份和選用的資料庫複寫。</span><span class="sxs-lookup"><span data-stu-id="5c594-109">SQL Database provides several business continuity features, including automated backups and optional database replication.</span></span> <span data-ttu-id="5c594-110">每個功能對於預估的復原時間 (ERT) 都有不同的特性，最近的交易都有可能遺失資料。</span><span class="sxs-lookup"><span data-stu-id="5c594-110">Each has different characteristics for estimated recovery time (ERT) and potential data loss for recent transactions.</span></span> <span data-ttu-id="5c594-111">一旦您了解這些選項，就可以在其中選擇，而在大部分情況下，可以針對不同情況一起搭配使用。</span><span class="sxs-lookup"><span data-stu-id="5c594-111">Once you understand these options, you can choose among them - and, in most scenarios, use them together for different scenarios.</span></span> <span data-ttu-id="5c594-112">當您開發商務持續性方案時，您必須了解應用程式在干擾性事件之後完全復原的最大可接受時間 - 這是您的復原時間目標 (RTO)。</span><span class="sxs-lookup"><span data-stu-id="5c594-112">As you develop your business continuity plan, you need to understand the maximum acceptable time before the application fully recovers after the disruptive event - this is your recovery time objective (RTO).</span></span> <span data-ttu-id="5c594-113">您也必須了解在干擾性事件之後復原時，應用程式可忍受遺失的最近資料更新 (時間間隔) 最大數量，這就是您的復原點目標 (RPO)。</span><span class="sxs-lookup"><span data-stu-id="5c594-113">You also need to understand the maximum amount of recent data updates (time interval) the application can tolerate losing when recovering after the disruptive event - this is your recovery point objective (RPO).</span></span>

<span data-ttu-id="5c594-114">下表針對三種最常見的案例提供 ERT 與 RPO 的比較。</span><span class="sxs-lookup"><span data-stu-id="5c594-114">The following table compares the ERT and RPO for the three most common scenarios.</span></span>

| <span data-ttu-id="5c594-115">功能</span><span class="sxs-lookup"><span data-stu-id="5c594-115">Capability</span></span> | <span data-ttu-id="5c594-116">基本層</span><span class="sxs-lookup"><span data-stu-id="5c594-116">Basic tier</span></span> | <span data-ttu-id="5c594-117">標準層</span><span class="sxs-lookup"><span data-stu-id="5c594-117">Standard tier</span></span> | <span data-ttu-id="5c594-118">高階層</span><span class="sxs-lookup"><span data-stu-id="5c594-118">Premium tier</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="5c594-119">從備份進行時間點還原</span><span class="sxs-lookup"><span data-stu-id="5c594-119">Point in Time Restore from backup</span></span> |<span data-ttu-id="5c594-120">7 天內的任何還原點</span><span class="sxs-lookup"><span data-stu-id="5c594-120">Any restore point within 7 days</span></span> |<span data-ttu-id="5c594-121">35 天內的任何還原點</span><span class="sxs-lookup"><span data-stu-id="5c594-121">Any restore point within 35 days</span></span> |<span data-ttu-id="5c594-122">35 天內的任何還原點</span><span class="sxs-lookup"><span data-stu-id="5c594-122">Any restore point within 35 days</span></span> |
| <span data-ttu-id="5c594-123">從異地複寫備份進行異地還原</span><span class="sxs-lookup"><span data-stu-id="5c594-123">Geo-restore from geo-replicated backups</span></span> |<span data-ttu-id="5c594-124">ERT < 12 小時，RPO < 1 小時</span><span class="sxs-lookup"><span data-stu-id="5c594-124">ERT < 12h, RPO < 1h</span></span> |<span data-ttu-id="5c594-125">ERT < 12 小時，RPO < 1 小時</span><span class="sxs-lookup"><span data-stu-id="5c594-125">ERT < 12h, RPO < 1h</span></span> |<span data-ttu-id="5c594-126">ERT < 12 小時，RPO < 1 小時</span><span class="sxs-lookup"><span data-stu-id="5c594-126">ERT < 12h, RPO < 1h</span></span> |
| <span data-ttu-id="5c594-127">從 Azure 備份保存庫還原</span><span class="sxs-lookup"><span data-stu-id="5c594-127">Restore from Azure Backup Vault</span></span> |<span data-ttu-id="5c594-128">ERT < 12 小時，RPO < 1 週</span><span class="sxs-lookup"><span data-stu-id="5c594-128">ERT < 12h, RPO < 1 wk</span></span> |<span data-ttu-id="5c594-129">ERT < 12 小時，RPO < 1 週</span><span class="sxs-lookup"><span data-stu-id="5c594-129">ERT < 12h, RPO < 1 wk</span></span> |<span data-ttu-id="5c594-130">ERT < 12 小時，RPO < 1 週</span><span class="sxs-lookup"><span data-stu-id="5c594-130">ERT < 12h, RPO < 1 wk</span></span> |
| <span data-ttu-id="5c594-131">主動式異地複寫</span><span class="sxs-lookup"><span data-stu-id="5c594-131">Active geo-replication</span></span> |<span data-ttu-id="5c594-132">ERT < 30 秒，RPO < 5 秒</span><span class="sxs-lookup"><span data-stu-id="5c594-132">ERT < 30s, RPO < 5s</span></span> |<span data-ttu-id="5c594-133">ERT < 30 秒，RPO < 5 秒</span><span class="sxs-lookup"><span data-stu-id="5c594-133">ERT < 30s, RPO < 5s</span></span> |<span data-ttu-id="5c594-134">ERT < 30 秒，RPO < 5 秒</span><span class="sxs-lookup"><span data-stu-id="5c594-134">ERT < 30s, RPO < 5s</span></span> |

### <a name="use-database-backups-to-recover-a-database"></a><span data-ttu-id="5c594-135">使用資料庫備份來復原資料庫</span><span class="sxs-lookup"><span data-stu-id="5c594-135">Use database backups to recover a database</span></span>

<span data-ttu-id="5c594-136">SQL Database 會每週自動執行完整資料庫備份、每小時自動執行差異資料庫備份，以及每 5 到 10 分鐘自動執行交易記錄備份，透過這樣的備份組合來防止您的企業遺失資料。</span><span class="sxs-lookup"><span data-stu-id="5c594-136">SQL Database automatically performs a combination of full database backups weekly, differential database backups hourly, and transaction log backups every five - ten minutes to protect your business from data loss.</span></span> <span data-ttu-id="5c594-137">針對「標準」和「進階」服務層中的資料庫，這些備份會在異地備援儲存體中儲存達 35 天，如果是「基本」服務層中的資料庫，則儲存天數為 7 天。</span><span class="sxs-lookup"><span data-stu-id="5c594-137">These backups are stored in geo-redundant storage for 35 days for databases in the Standard and Premium service tiers and 7 days for databases in the Basic service tier.</span></span> <span data-ttu-id="5c594-138">如需詳細資訊，請參閱[服務層](sql-database-service-tiers.md)。</span><span class="sxs-lookup"><span data-stu-id="5c594-138">For more information, see [service tiers](sql-database-service-tiers.md).</span></span> <span data-ttu-id="5c594-139">如果服務層的保留期間不符合您的企業需求，您可以 [變更服務層](sql-database-service-tiers.md)來增長保留期間。</span><span class="sxs-lookup"><span data-stu-id="5c594-139">If the retention period for your service tier does not meet your business requirements, you can increase the retention period by [changing the service tier](sql-database-service-tiers.md).</span></span> <span data-ttu-id="5c594-140">完整和差異資料庫備份也會複寫到[配對的資料中心](../best-practices-availability-paired-regions.md)，以防止發生資料中心中斷的情況。</span><span class="sxs-lookup"><span data-stu-id="5c594-140">The full and differential database backups are also replicated to a [paired data center](../best-practices-availability-paired-regions.md) for protection against a data center outage.</span></span> <span data-ttu-id="5c594-141">如需詳細資訊，請參閱[自動資料庫備份](sql-database-automated-backups.md)。</span><span class="sxs-lookup"><span data-stu-id="5c594-141">For more information, see [automatic database backups](sql-database-automated-backups.md).</span></span>

<span data-ttu-id="5c594-142">如果應用程式內建的保留期間不夠用，您可以藉由為資料庫設定長期保留原則來延長此期間。</span><span class="sxs-lookup"><span data-stu-id="5c594-142">If the built-in retention period is not sufficient for your application, you can extend it by configuring a database long-term retention policy.</span></span> <span data-ttu-id="5c594-143">如需詳細資訊，請參閱[長期保留](sql-database-long-term-retention.md)。</span><span class="sxs-lookup"><span data-stu-id="5c594-143">For more information, see [long-term retention](sql-database-long-term-retention.md).</span></span>

<span data-ttu-id="5c594-144">您可以使用這些自動資料庫備份，將資料庫從各種干擾性事件復原，不論是在您的資料中心內復原，還是復原到另一個資料中心，都可以。</span><span class="sxs-lookup"><span data-stu-id="5c594-144">You can use these automatic database backups to recover a database from various disruptive events, both within your data center and to another data center.</span></span> <span data-ttu-id="5c594-145">使用自動資料庫備份時，預估的復原時間取決於數個因素，包括在相同區域中同時進行復原的資料庫總數、資料庫大小、交易記錄大小，以及網路頻寬。</span><span class="sxs-lookup"><span data-stu-id="5c594-145">Using automatic database backups, the estimated time of recovery depends on several factors including the total number of databases recovering in the same region at the same time, the database size, the transaction log size, and network bandwidth.</span></span> <span data-ttu-id="5c594-146">復原時間通常不到 12 小時。</span><span class="sxs-lookup"><span data-stu-id="5c594-146">The recovery time is usually less than 12 hours.</span></span> <span data-ttu-id="5c594-147">復原到另一個資料區域時，每小時差異資料庫備份的異地備援儲存體就限制為可能遺失 1 小時的資料。</span><span class="sxs-lookup"><span data-stu-id="5c594-147">When recovering to another data region, the potential data loss is limited to 1 hour by the geo-redundant storage of hourly differential database backups.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5c594-148">若要使用自動備份來進行復原，您必須是「SQL Server 參與者」角色的成員或訂用帳戶擁有者 - 請參閱 [RBAC︰內建角色](../active-directory/role-based-access-built-in-roles.md)。</span><span class="sxs-lookup"><span data-stu-id="5c594-148">To recover using automated backups, you must be a member of the SQL Server Contributor role or the subscription owner - see [RBAC: Built-in roles](../active-directory/role-based-access-built-in-roles.md).</span></span> <span data-ttu-id="5c594-149">您可以使用 Azure 入口網站、PowerShell 或 REST API 來進行復原。</span><span class="sxs-lookup"><span data-stu-id="5c594-149">You can recover using the Azure portal, PowerShell, or the REST API.</span></span> <span data-ttu-id="5c594-150">您無法使用 Transact-SQL。</span><span class="sxs-lookup"><span data-stu-id="5c594-150">You cannot use Transact-SQL.</span></span>
>

<span data-ttu-id="5c594-151">如果您的應用程式有下列狀況，可以使用自動備份做為您的商務持續性和復原機制︰</span><span class="sxs-lookup"><span data-stu-id="5c594-151">Use automated backups as your business continuity and recovery mechanism if your application:</span></span>

* <span data-ttu-id="5c594-152">非關鍵性應用程式。</span><span class="sxs-lookup"><span data-stu-id="5c594-152">Is not considered mission critical.</span></span>
* <span data-ttu-id="5c594-153">沒有繫結 SLA - 停機 24 小時或更長的時間不會衍生財務責任。</span><span class="sxs-lookup"><span data-stu-id="5c594-153">Doesn't have a binding SLA - a downtime of 24 hours or longer does not result in financial liability.</span></span>
* <span data-ttu-id="5c594-154">資料變更率低 (每小時的交易次數低)，並且最多可接受遺失一小時的資料變更。</span><span class="sxs-lookup"><span data-stu-id="5c594-154">Has a low rate of data change (low transactions per hour) and losing up to an hour of change is an acceptable data loss.</span></span>
* <span data-ttu-id="5c594-155">成本有限。</span><span class="sxs-lookup"><span data-stu-id="5c594-155">Is cost sensitive.</span></span>

<span data-ttu-id="5c594-156">如果您需要更快速的復原，請使用[主動式異地複寫](sql-database-geo-replication-overview.md) (會接著討論)。</span><span class="sxs-lookup"><span data-stu-id="5c594-156">If you need faster recovery, use [active geo-replication](sql-database-geo-replication-overview.md) (discussed next).</span></span> <span data-ttu-id="5c594-157">如果您必須能夠復原 35 天之前的資料，請使用[長期備份保留](sql-database-long-term-retention.md)。</span><span class="sxs-lookup"><span data-stu-id="5c594-157">If you need to be able to recover data from a period older than 35 days, use [long-term backup retention](sql-database-long-term-retention.md).</span></span> 

### <a name="use-active-geo-replication-and-auto-failover-groups-in-preview-to-reduce-recovery-time-and-limit-data-loss-associated-with-a-recovery"></a><span data-ttu-id="5c594-158">使用作用中異地複寫和自動容錯移轉群組 (預覽版)，以減少復原時間並限制與復原關聯的資料損失</span><span class="sxs-lookup"><span data-stu-id="5c594-158">Use active geo-replication and auto-failover groups (in-preview) to reduce recovery time and limit data loss associated with a recovery</span></span>

<span data-ttu-id="5c594-159">除了在發生業務中斷時使用資料庫備份來進行資料庫復原之外，您還可以使用[主動式異地複寫](sql-database-geo-replication-overview.md)來設定資料庫，在您選擇的區域中最多可擁有 4 個可讀取的次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="5c594-159">In addition to using database backups for database recovery if a business disruption occurs, you can use [active geo-replication](sql-database-geo-replication-overview.md) to configure a database to have up to four readable secondary databases in the regions of your choice.</span></span> <span data-ttu-id="5c594-160">這些次要資料庫會使用非同步複寫機制與主要資料庫保持同步。</span><span class="sxs-lookup"><span data-stu-id="5c594-160">These secondary databases are kept synchronized with the primary database using an asynchronous replication mechanism.</span></span> <span data-ttu-id="5c594-161">此功能可用來防範資料中心中斷或應用程式升級期間的業務中斷。</span><span class="sxs-lookup"><span data-stu-id="5c594-161">This feature is used to protect against business disruption if a data center outage occurs or during an application upgrade.</span></span> <span data-ttu-id="5c594-162">主動式異地複寫也可用來為地理位置分散的使用者，就唯讀查詢方面提供較佳的查詢效能。</span><span class="sxs-lookup"><span data-stu-id="5c594-162">Active geo-replication can also be used to provide better query performance for read-only queries to geographically dispersed users.</span></span>

<span data-ttu-id="5c594-163">若要啟用自動透明容錯移轉，您應使用 SQL Database [自動容錯移轉群組](sql-database-geo-replication-overview.md)功能 (預覽版)，將異地複寫資料庫分組。</span><span class="sxs-lookup"><span data-stu-id="5c594-163">To enable automated and transparent failover you should organize your geo-replicated databases into groups using the [auto-failover group](sql-database-geo-replication-overview.md) feature of SQL Database (in-preview).</span></span>

<span data-ttu-id="5c594-164">如果主要資料庫意外離線，或者您需要離線進行維護活動，可以快速將次要升級成主要 (也稱為容錯移轉)，並且設定應用程式連線到已升級的主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="5c594-164">If the primary database goes offline unexpectedly or you need to take it offline for maintenance activities, you can quickly promote a secondary to become the primary (also called a failover) and configure applications to connect to the promoted primary.</span></span> <span data-ttu-id="5c594-165">若您的應用程式使用容錯移轉群組接聽程式連線至資料庫，則在完成容錯移轉後無須變更 SQL 連接字串組態。</span><span class="sxs-lookup"><span data-stu-id="5c594-165">If your application is connecting to the databases using the failover group listener, you don’t need to change the SQL connection string configuration after failover.</span></span> <span data-ttu-id="5c594-166">使用計劃性容錯移轉時，不會有任何資料遺失。</span><span class="sxs-lookup"><span data-stu-id="5c594-166">With a planned failover, there is no data loss.</span></span> <span data-ttu-id="5c594-167">使用非計劃性容錯移轉時，則由於非同步複寫的性質緣故，可能會有一些少量的資料遺失。</span><span class="sxs-lookup"><span data-stu-id="5c594-167">With an unplanned failover, there may be some small amount of data loss for very recent transactions due to the nature of asynchronous replication.</span></span> <span data-ttu-id="5c594-168">您可使用自動容錯移轉群組 (預覽版) 來自訂容錯移轉原則，以將潛在資料遺失風險降至最低。</span><span class="sxs-lookup"><span data-stu-id="5c594-168">Using auto-failover groups (in-preview), you can customize the failover policy to minimize the potential data loss.</span></span> <span data-ttu-id="5c594-169">容錯移轉之後，無論是根據計畫或當資料中心再次上線時，就可以容錯回復。</span><span class="sxs-lookup"><span data-stu-id="5c594-169">After a failover, you can later failback - either according to a plan or when the data center comes back online.</span></span> <span data-ttu-id="5c594-170">在所有情況下，使用者都會經歷短暫的停機時間，而需要重新連線。</span><span class="sxs-lookup"><span data-stu-id="5c594-170">In all cases, users experience a small amount of downtime and need to reconnect.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5c594-171">若要使用作用中異地複寫和自動容錯移轉群組 (預覽版)，您必須是訂用帳戶擁有者，或是在 SQL Server 中擁有系統管理權限。</span><span class="sxs-lookup"><span data-stu-id="5c594-171">To use active geo-replication and auto-failover groups (in-preview), you must either be the subscription owner or have administrative permissions in SQL Server.</span></span> <span data-ttu-id="5c594-172">您可以使用 Azure 入口網站、PowerShell 或 REST API 並透過 Azure 訂用帳戶的權限來進行設定和容錯移轉，也可以使用 Transact-SQL 並透過 SQL Server 權限來進行。</span><span class="sxs-lookup"><span data-stu-id="5c594-172">You can configure and fail over using the Azure portal, PowerShell, or the REST API using Azure subscription permissions or using Transact-SQL with SQL Server permissions.</span></span>
> 

<span data-ttu-id="5c594-173">如果您的應用程式符合下列任何準則，請使用主動式異地複寫和自動容錯移轉群組 (預覽版)：</span><span class="sxs-lookup"><span data-stu-id="5c594-173">Use active geo-replication and auto-failover groups (in preview) if your application meets any of these criteria:</span></span>

* <span data-ttu-id="5c594-174">是關鍵性應用程式。</span><span class="sxs-lookup"><span data-stu-id="5c594-174">Is mission critical.</span></span>
* <span data-ttu-id="5c594-175">具有服務等級協定 (SLA)，不允許 24 小時以上的停機時間。</span><span class="sxs-lookup"><span data-stu-id="5c594-175">Has a service level agreement (SLA) that does not allow for 24 hours or more of downtime.</span></span>
* <span data-ttu-id="5c594-176">停機可能會衍生財務責任。</span><span class="sxs-lookup"><span data-stu-id="5c594-176">Downtime may result in financial liability.</span></span>
* <span data-ttu-id="5c594-177">具有很高的資料變更率，而且不接受遺失一個小時的資料。</span><span class="sxs-lookup"><span data-stu-id="5c594-177">Has a high rate of data change is high and losing an hour of data is not acceptable.</span></span>
* <span data-ttu-id="5c594-178">與潛在的財務責任和相關企業損失相較下，使用主動式異地複寫的額外成本較低。</span><span class="sxs-lookup"><span data-stu-id="5c594-178">The additional cost of active geo-replication is lower than the potential financial liability and associated loss of business.</span></span>

>
> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Azure-SQL-Database-protecting-important-DBs-from-regional-disasters-is-easy/player]
>

## <a name="recover-a-database-after-a-user-or-application-error"></a><span data-ttu-id="5c594-179">在使用者或應用程式錯誤之後復原資料庫</span><span class="sxs-lookup"><span data-stu-id="5c594-179">Recover a database after a user or application error</span></span>
<span data-ttu-id="5c594-180">* 沒有人是完美的！</span><span class="sxs-lookup"><span data-stu-id="5c594-180">*No one is perfect!</span></span> <span data-ttu-id="5c594-181">使用者可能會不小心刪除某些資料、不小心卸除重要的資料表，或甚至是卸除整個資料庫。</span><span class="sxs-lookup"><span data-stu-id="5c594-181">A user might accidentally delete some data, inadvertently drop an important table, or even drop an entire database.</span></span> <span data-ttu-id="5c594-182">或者，應用程式可能會因為應用程式缺陷，而意外以不正確的資料覆寫正確的資料。</span><span class="sxs-lookup"><span data-stu-id="5c594-182">Or, an application might accidentally overwrite good data with bad data due to an application defect.</span></span>

<span data-ttu-id="5c594-183">在此案例中，以下是您的復原選項。</span><span class="sxs-lookup"><span data-stu-id="5c594-183">In this scenario, these are your recovery options.</span></span>

### <a name="perform-a-point-in-time-restore"></a><span data-ttu-id="5c594-184">執行還原時間點</span><span class="sxs-lookup"><span data-stu-id="5c594-184">Perform a point-in-time restore</span></span>
<span data-ttu-id="5c594-185">您可以使用自動備份，將資料庫的複本復原到已知是在資料庫保留期限內的時間點。</span><span class="sxs-lookup"><span data-stu-id="5c594-185">You can use the automated backups to recover a copy of your database to a known good point in time, provided that time is within the database retention period.</span></span> <span data-ttu-id="5c594-186">資料庫還原之後，您可以將原始資料庫取代為還原的資料庫，或從還原的資料將所需的資料複製到原始資料庫。</span><span class="sxs-lookup"><span data-stu-id="5c594-186">After the database is restored, you can either replace the original database with the restored database or copy the needed data from the restored data into the original database.</span></span> <span data-ttu-id="5c594-187">如果資料庫使用主動式異地複寫，我們建議從還原的複本將所需的資料複製到原始資料庫。</span><span class="sxs-lookup"><span data-stu-id="5c594-187">If the database uses active geo-replication, we recommend copying the required data from the restored copy into the original database.</span></span> <span data-ttu-id="5c594-188">如果您將原始資料庫取代為還原的資料庫，則必須重新設定並重新同步處理主動式異地複寫 (大型資料庫可能要花費很久的時間)。</span><span class="sxs-lookup"><span data-stu-id="5c594-188">If you replace the original database with the restored database, you need to reconfigure and resynchronize active geo-replication (which can take quite some time for a large database).</span></span>

<span data-ttu-id="5c594-189">如需詳細資訊以及使用 Azure 入口網站或 PowerShell 將資料庫還原至某個時間點的詳細步驟，請參閱 [還原時間點](sql-database-recovery-using-backups.md#point-in-time-restore)。</span><span class="sxs-lookup"><span data-stu-id="5c594-189">For more information and for detailed steps for restoring a database to a point in time using the Azure portal or using PowerShell, see [point-in-time restore](sql-database-recovery-using-backups.md#point-in-time-restore).</span></span> <span data-ttu-id="5c594-190">您無法使用 Transact-SQL 進行復原。</span><span class="sxs-lookup"><span data-stu-id="5c594-190">You cannot recover using Transact-SQL.</span></span>

### <a name="restore-a-deleted-database"></a><span data-ttu-id="5c594-191">還原已刪除的資料庫</span><span class="sxs-lookup"><span data-stu-id="5c594-191">Restore a deleted database</span></span>
<span data-ttu-id="5c594-192">如果資料庫已刪除，但邏輯伺服器尚未刪除，您可以將已刪除的資料庫還原到它被刪除時的時間點。</span><span class="sxs-lookup"><span data-stu-id="5c594-192">If the database is deleted but the logical server has not been deleted, you can restore the deleted database to the point at which it was deleted.</span></span> <span data-ttu-id="5c594-193">這會將資料庫備份還原到資料庫被刪除的相同邏輯 SQL 伺服器。</span><span class="sxs-lookup"><span data-stu-id="5c594-193">This restores a database backup to the same logical SQL server from which it was deleted.</span></span> <span data-ttu-id="5c594-194">您可以使用原始名稱還原，或是為還原的資料庫提供新的名稱。</span><span class="sxs-lookup"><span data-stu-id="5c594-194">You can restore it using the original name or provide a new name or the restored database.</span></span>

<span data-ttu-id="5c594-195">如需詳細資訊以及使用 Azure 入口網站或 PowerShell 來還原已刪除資料庫的詳細步驟，請參閱 [還原已刪除的資料庫](sql-database-recovery-using-backups.md#deleted-database-restore)。</span><span class="sxs-lookup"><span data-stu-id="5c594-195">For more information and for detailed steps for restoring a deleted database using the Azure portal or using PowerShell, see [restore a deleted database](sql-database-recovery-using-backups.md#deleted-database-restore).</span></span> <span data-ttu-id="5c594-196">您無法使用 Transact-SQL 進行還原。</span><span class="sxs-lookup"><span data-stu-id="5c594-196">You cannot restore using Transact-SQL.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5c594-197">如果邏輯伺服器已刪除，您就無法復原已刪除的資料庫。</span><span class="sxs-lookup"><span data-stu-id="5c594-197">If the logical server is deleted, you cannot recover a deleted database.</span></span>
>
>

### <a name="restore-from-azure-backup-vault"></a><span data-ttu-id="5c594-198">從 Azure 備份保存庫還原</span><span class="sxs-lookup"><span data-stu-id="5c594-198">Restore from Azure Backup Vault</span></span>
<span data-ttu-id="5c594-199">如果在自動備份的目前保留期間外發生資料遺失，且您的資料庫設定為長期保留，則您可以從 Azure 備份保存庫的每週備份還原至新的資料庫。</span><span class="sxs-lookup"><span data-stu-id="5c594-199">If the data loss occurred outside the current retention period for automated backups and your database is configured for long-term retention, you can restore from a weekly backup in Azure Backup Vault to a new database.</span></span> <span data-ttu-id="5c594-200">目前，您可以將原始資料庫取代為還原的資料庫，或從還原的資料庫將所需的資料複製到原始資料庫。</span><span class="sxs-lookup"><span data-stu-id="5c594-200">At this point, you can either replace the original database with the restored database or copy the needed data from the restored database into the original database.</span></span> <span data-ttu-id="5c594-201">如果您需要在主要應用程式升級之前擷取舊版資料庫，請滿足稽核員或合法順序的要求，您可以使用 Azure 備份保存庫中儲存的完整備份來建立資料庫。</span><span class="sxs-lookup"><span data-stu-id="5c594-201">If you need to retrieve an old version of your database prior to a major application upgrade, satisfy a request from auditors or a legal order, you can create a database using a full backup saved in the Azure Backup Vault.</span></span>  <span data-ttu-id="5c594-202">如需詳細資訊，請參閱[長期保存](sql-database-long-term-retention.md)。</span><span class="sxs-lookup"><span data-stu-id="5c594-202">For more information, see [Long-term retention](sql-database-long-term-retention.md).</span></span>

## <a name="recover-a-database-to-another-region-from-an-azure-regional-data-center-outage"></a><span data-ttu-id="5c594-203">將資料庫從 Azure 區域資料中心中斷復原到另一個區域</span><span class="sxs-lookup"><span data-stu-id="5c594-203">Recover a database to another region from an Azure regional data center outage</span></span>
<!-- Explain this scenario -->

<span data-ttu-id="5c594-204">雖然很罕見，但 Azure 資料中心也可能會有中斷的時候。</span><span class="sxs-lookup"><span data-stu-id="5c594-204">Although rare, an Azure data center can have an outage.</span></span> <span data-ttu-id="5c594-205">發生中斷時，可能只會讓業務中斷幾分鐘，也可能會持續幾小時。</span><span class="sxs-lookup"><span data-stu-id="5c594-205">When an outage occurs, it causes a business disruption that might only last a few minutes or might last for hours.</span></span>

* <span data-ttu-id="5c594-206">其中一個選項是在資料中心中斷結束時等待您的資料庫重新上線。</span><span class="sxs-lookup"><span data-stu-id="5c594-206">One option is to wait for your database to come back online when the data center outage is over.</span></span> <span data-ttu-id="5c594-207">這適用於可以容忍資料庫離線的應用程式。</span><span class="sxs-lookup"><span data-stu-id="5c594-207">This works for applications that can afford to have the database offline.</span></span> <span data-ttu-id="5c594-208">例如，您不需要不斷處理的開發專案或免費試用版。</span><span class="sxs-lookup"><span data-stu-id="5c594-208">For example, a development project or free trial you don't need to work on constantly.</span></span> <span data-ttu-id="5c594-209">當資料中心中斷時，您不會知道中斷會持續多久，因此這個選項僅適用於您可以一段時間暫時不需要資料庫。</span><span class="sxs-lookup"><span data-stu-id="5c594-209">When a data center has an outage, you do not know how long the outage might last, so this option only works if you don't need your database for a while.</span></span>
* <span data-ttu-id="5c594-210">另一個選項是容錯移轉到另一個資料區域 (如果您使用主動式異地複寫) 或使用異地備援資料庫備份來復原資料庫 (異地還原)。</span><span class="sxs-lookup"><span data-stu-id="5c594-210">Another option is to either fail over to another data region if you are using active geo-replication or the recover a database using geo-redundant database backups (geo-restore).</span></span> <span data-ttu-id="5c594-211">容錯移轉只需要幾秒鐘的時間，而從備份復原資料庫則需要幾個小時。</span><span class="sxs-lookup"><span data-stu-id="5c594-211">Failover takes only a few seconds while database recovery from backups takes hours.</span></span>

<span data-ttu-id="5c594-212">當您採取行動時，復原所需的時間以及會遺失多少資料，取決於您如何決定在應用程式中使用這些商務持續性功能。</span><span class="sxs-lookup"><span data-stu-id="5c594-212">When you take action, how long it takes you to recover, and how much data loss you incur depends upon how you decide to use these business continuity features in your application.</span></span> <span data-ttu-id="5c594-213">事實上，您可以根據應用程式需求，選擇使用資料庫備份和主動式異地複寫的組合。</span><span class="sxs-lookup"><span data-stu-id="5c594-213">Indeed, you may choose to use a combination of database backups and active geo-replication depending upon your application requirements.</span></span> <span data-ttu-id="5c594-214">若要探討使用這些商務持續性功能針對獨立資料庫和彈性集區進行應用程式設計時的考量，請參閱[設計雲端災害復原應用程式](sql-database-designing-cloud-solutions-for-disaster-recovery.md)和[彈性集區災害復原策略](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md)。</span><span class="sxs-lookup"><span data-stu-id="5c594-214">For a discussion of application design considerations for stand-alone databases and for elastic pools using these business continuity features, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) and [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

<span data-ttu-id="5c594-215">下列各節概述使用資料庫備份或主動式異地複寫來進行復原的步驟。</span><span class="sxs-lookup"><span data-stu-id="5c594-215">The following sections provide an overview of the steps to recover using either database backups or active geo-replication.</span></span> <span data-ttu-id="5c594-216">如需包括規劃需求的詳細步驟、復原後步驟，以及有關如何模擬中斷以執行災害復原演練的資訊，請參閱[從中斷復原 SQL Database](sql-database-disaster-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="5c594-216">For detailed steps including planning requirements, post recovery steps, and information about how to simulate an outage to perform a disaster recovery drill, see [Recover a SQL Database from an outage](sql-database-disaster-recovery.md).</span></span>

### <a name="prepare-for-an-outage"></a><span data-ttu-id="5c594-217">準備中斷</span><span class="sxs-lookup"><span data-stu-id="5c594-217">Prepare for an outage</span></span>
<span data-ttu-id="5c594-218">無論您要使用何種商務持續性功能，您都必須︰</span><span class="sxs-lookup"><span data-stu-id="5c594-218">Regardless of the business continuity feature you use, you must:</span></span>

* <span data-ttu-id="5c594-219">識別並準備目標伺服器，包括伺服器層級防火牆規則、登入和 master 資料庫層級權限。</span><span class="sxs-lookup"><span data-stu-id="5c594-219">Identify and prepare the target server, including server-level firewall rules, logins, and master database level permissions.</span></span>
* <span data-ttu-id="5c594-220">決定如何將用戶端和用戶端應用程式重新導向到新的伺服器</span><span class="sxs-lookup"><span data-stu-id="5c594-220">Determine how to redirect clients and client applications to the new server</span></span>
* <span data-ttu-id="5c594-221">記錄其他相依性，例如稽核設定和警示</span><span class="sxs-lookup"><span data-stu-id="5c594-221">Document other dependencies, such as auditing settings and alerts</span></span>

<span data-ttu-id="5c594-222">如果您沒有適當地準備，在容錯移轉或資料庫復原後讓應用程式上線將會多花費時間，而且也可能需要在有壓力的情況下進行疑難排解 - 這是不良的情況組合。</span><span class="sxs-lookup"><span data-stu-id="5c594-222">If you do not prepare properly, bringing your applications online after a failover or a database recovery takes additional time and likely also require troubleshooting at a time of stress - a bad combination.</span></span>

### <a name="fail-over-to-a-geo-replicated-secondary-database"></a><span data-ttu-id="5c594-223">容錯移轉至異地複寫的次要資料庫</span><span class="sxs-lookup"><span data-stu-id="5c594-223">Fail over to a geo-replicated secondary database</span></span>
<span data-ttu-id="5c594-224">若您使用作用中異地複寫和自動容錯移轉群組 (預覽版) 作為復原機制，則可設定自動容錯移轉原則或使用[手動容錯移轉](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-database)。</span><span class="sxs-lookup"><span data-stu-id="5c594-224">If you are using active geo-replication and auto-failover groups (in-preview) as your recovery mechanism, you can configure an automatic failover policy or use [manual failover](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-database).</span></span> <span data-ttu-id="5c594-225">啟動容錯移轉後，次要資料庫就會成為新的主要資料庫，並準備好記錄新的交易以及回應查詢 - 只會遺失尚未複寫的資料。</span><span class="sxs-lookup"><span data-stu-id="5c594-225">Once initiated, the failover causes the secondary to become the new primary and ready to record new transactions and respond to queries - with minimal data loss for the data not yet replicated.</span></span> <span data-ttu-id="5c594-226">如需關於設計容錯移轉程序的資訊，請參閱[設計雲端災害復原應用程式](sql-database-designing-cloud-solutions-for-disaster-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="5c594-226">For information on designing the failover process, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span></span>

> [!NOTE]
> <span data-ttu-id="5c594-227">資料中心恢復連線時，舊的主要複本會自動重新連線至新的主要複本，且會成為次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="5c594-227">When the data center comes back online the old primaries automatically reconnect to the new primary and become secondary databases.</span></span> <span data-ttu-id="5c594-228">若您需要將主要複本重新定位至原始區域，可手動啟動規劃的容錯移轉 (容錯回復)。</span><span class="sxs-lookup"><span data-stu-id="5c594-228">If you need to relocate the primary back to the original region, you can initiate a planned failover manually (failback).</span></span> 
> 

### <a name="perform-a-geo-restore"></a><span data-ttu-id="5c594-229">執行異地還原</span><span class="sxs-lookup"><span data-stu-id="5c594-229">Perform a geo-restore</span></span>
<span data-ttu-id="5c594-230">如果您使用自動備份搭配異地備援儲存體複寫作為復原機制，請[使用異地還原起始資料庫復原](sql-database-disaster-recovery.md#recover-using-geo-restore)。</span><span class="sxs-lookup"><span data-stu-id="5c594-230">If you are using automated backups with geo-redundant storage replication as your recovery mechanism, [initiate a database recovery using geo-restore](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span> <span data-ttu-id="5c594-231">復原通常會在 12 小時內進行 - 視最後一次每小時差異備份的執行和複寫時間而定，最多可能遺失 1 小時的資料。</span><span class="sxs-lookup"><span data-stu-id="5c594-231">Recovery usually takes place within 12 hours - with data loss of up to one hour determined by when the last hourly differential backup with taken and replicated.</span></span> <span data-ttu-id="5c594-232">在復原完成之前，資料庫無法記錄任何交易或回應任何查詢。</span><span class="sxs-lookup"><span data-stu-id="5c594-232">Until the recovery completes, the database is unable to record any transactions or respond to any queries.</span></span> <span data-ttu-id="5c594-233">雖然這會將資料庫還原到最後一個可用的時間點，但目前不支援將地區次要資料庫還原至任何時間點。</span><span class="sxs-lookup"><span data-stu-id="5c594-233">While this restores a database to the last available point in time, restoring the geo-secondary to any point in time is not currently supported.</span></span>

> [!NOTE]
> <span data-ttu-id="5c594-234">如果資料中心在您的應用程式切換到復原的資料庫之前就再次上線，您可以取消復原。</span><span class="sxs-lookup"><span data-stu-id="5c594-234">If the data center comes back online before you switch your application over to the recovered database, you can cancel the recovery.</span></span>  
>
>

### <a name="perform-post-failover--recovery-tasks"></a><span data-ttu-id="5c594-235">執行容錯移轉後/復原後工作</span><span class="sxs-lookup"><span data-stu-id="5c594-235">Perform post failover / recovery tasks</span></span>
<span data-ttu-id="5c594-236">從其中任何一種復原機制復原之後，您都必須執行下列額外的工作，您的使用者和應用程式才能回復正常執行狀態︰</span><span class="sxs-lookup"><span data-stu-id="5c594-236">After recovery from either recovery mechanism, you must perform the following additional tasks before your users and applications are back up and running:</span></span>

* <span data-ttu-id="5c594-237">重新導向用戶端與用戶端應用程式到新的伺服器與還原的資料庫</span><span class="sxs-lookup"><span data-stu-id="5c594-237">Redirect clients and client applications to the new server and restored database</span></span>
* <span data-ttu-id="5c594-238">確定有適當的伺服器層級防火牆規則供使用者連線 (或使用 [資料庫層級防火牆](sql-database-firewall-configure.md#creating-and-managing-firewall-rules))</span><span class="sxs-lookup"><span data-stu-id="5c594-238">Ensure appropriate server-level firewall rules are in place for users to connect (or use [database-level firewalls](sql-database-firewall-configure.md#creating-and-managing-firewall-rules))</span></span>
* <span data-ttu-id="5c594-239">確定有適當的登入和 master 資料庫層級權限 (或使用 [自主的使用者](https://msdn.microsoft.com/library/ff929188.aspx))</span><span class="sxs-lookup"><span data-stu-id="5c594-239">Ensure appropriate logins and master database level permissions are in place (or use [contained users](https://msdn.microsoft.com/library/ff929188.aspx))</span></span>
* <span data-ttu-id="5c594-240">依適當情況設定稽核</span><span class="sxs-lookup"><span data-stu-id="5c594-240">Configure auditing, as appropriate</span></span>
* <span data-ttu-id="5c594-241">依適當情況設定警示</span><span class="sxs-lookup"><span data-stu-id="5c594-241">Configure alerts, as appropriate</span></span>

## <a name="upgrade-an-application-with-minimal-downtime"></a><span data-ttu-id="5c594-242">在最少停機時間的情況下升級應用程式</span><span class="sxs-lookup"><span data-stu-id="5c594-242">Upgrade an application with minimal downtime</span></span>
<span data-ttu-id="5c594-243">有時，應用程式會因為計劃性維護 (例如應用程式升級) 而必須離線。</span><span class="sxs-lookup"><span data-stu-id="5c594-243">Sometimes an application must be taken offline because of planned maintenance such as an application upgrade.</span></span> <span data-ttu-id="5c594-244">[管理應用程式升級](sql-database-manage-application-rolling-upgrade.md) 說明如何使用「主動式異地複寫」來輪流升級雲端應用程式，以將升級時的停機時間縮到最短，並提供發生錯誤時的復原路徑。</span><span class="sxs-lookup"><span data-stu-id="5c594-244">[Manage application upgrades](sql-database-manage-application-rolling-upgrade.md) describes how to use active geo-replication to enable rolling upgrades of your cloud application to minimize downtime during upgrades and provide a recovery path if something goes wrong.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="5c594-245">後續步驟</span><span class="sxs-lookup"><span data-stu-id="5c594-245">Next steps</span></span>
<span data-ttu-id="5c594-246">如需獨立資料庫和彈性集區的應用程式設計考量探討，請參閱[設計雲端災害復原應用程式](sql-database-designing-cloud-solutions-for-disaster-recovery.md)和[彈性集區災害復原策略](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md)。</span><span class="sxs-lookup"><span data-stu-id="5c594-246">For a discussion of application design considerations for stand-alone databases and for elastic pools, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) and [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
