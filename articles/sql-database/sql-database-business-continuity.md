---
title: "aaaCloud 業務持續性-資料庫復原的 SQL 資料庫 |Microsoft 文件"
description: "了解 Azure SQL Database 如何支援雲端商務持續性和資料庫復原，以及如何協助維持任務關鍵性雲端應用程式持續執行。"
keywords: "business continuity,cloud business continuity,database disaster recovery,database recovery,商務持續性,雲端商務持續性,資料庫災害復原,資料庫復原"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: 
ms.assetid: 18e5d3f1-bfe5-4089-b6fd-76988ab29822
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 05/15/2017
ms.author: sashan
ms.openlocfilehash: c9a6ff86fbbc04ce839a4fca79594b573b71644c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="overview-of-business-continuity-with-azure-sql-database"></a><span data-ttu-id="9fa45-104">使用 Azure SQL Database 的商務持續性概觀</span><span class="sxs-lookup"><span data-stu-id="9fa45-104">Overview of business continuity with Azure SQL Database</span></span>

<span data-ttu-id="9fa45-105">本概觀說明 Azure SQL Database 提供業務續航力和災害復原的 hello 功能。</span><span class="sxs-lookup"><span data-stu-id="9fa45-105">This overview describes hello capabilities that Azure SQL Database provides for business continuity and disaster recovery.</span></span> <span data-ttu-id="9fa45-106">深入了解選項、 建議和教學課程，從干擾性事件可能會導致資料遺失，或造成無法使用您資料庫和應用程式 toobecome 進行復原。</span><span class="sxs-lookup"><span data-stu-id="9fa45-106">Learn about options, recommendations, and tutorials for recovering from disruptive events that could cause data loss or cause your database and application toobecome unavailable.</span></span> <span data-ttu-id="9fa45-107">使用者或應用程式的錯誤會影響資料完整性、 Azure 地區已中斷，或您的應用程式需要維護時，了解哪些 toodo。</span><span class="sxs-lookup"><span data-stu-id="9fa45-107">Learn what toodo when a user or application error affects data integrity, an Azure region has an outage, or your application requires maintenance.</span></span>

## <a name="sql-database-features-that-you-can-use-tooprovide-business-continuity"></a><span data-ttu-id="9fa45-108">SQL Database 功能，您可以使用 tooprovide 業務續航力</span><span class="sxs-lookup"><span data-stu-id="9fa45-108">SQL Database features that you can use tooprovide business continuity</span></span>

<span data-ttu-id="9fa45-109">SQL Database 提供幾種商務持續性功能，包括自動備份和選用的資料庫複寫。</span><span class="sxs-lookup"><span data-stu-id="9fa45-109">SQL Database provides several business continuity features, including automated backups and optional database replication.</span></span> <span data-ttu-id="9fa45-110">每個功能對於預估的復原時間 (ERT) 都有不同的特性，最近的交易都有可能遺失資料。</span><span class="sxs-lookup"><span data-stu-id="9fa45-110">Each has different characteristics for estimated recovery time (ERT) and potential data loss for recent transactions.</span></span> <span data-ttu-id="9fa45-111">一旦您了解這些選項，就可以在其中選擇，而在大部分情況下，可以針對不同情況一起搭配使用。</span><span class="sxs-lookup"><span data-stu-id="9fa45-111">Once you understand these options, you can choose among them - and, in most scenarios, use them together for different scenarios.</span></span> <span data-ttu-id="9fa45-112">當您開發業務續航力計劃，您需要 toounderstand hello 最大可接受的時間之前之後 hello 干擾性事件完全復原 hello 應用程式-這是您的復原時間目標 (RTO)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-112">As you develop your business continuity plan, you need toounderstand hello maximum acceptable time before hello application fully recovers after hello disruptive event - this is your recovery time objective (RTO).</span></span> <span data-ttu-id="9fa45-113">您也需要 toounderstand hello 最大數量最新資料更新 （時間間隔） hello 應用程式可以容忍遺失時復原 hello 干擾性事件之後-這是您的復原點目標 (RPO)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-113">You also need toounderstand hello maximum amount of recent data updates (time interval) hello application can tolerate losing when recovering after hello disruptive event - this is your recovery point objective (RPO).</span></span>

<span data-ttu-id="9fa45-114">下列資料表比較 hello hello hello 三個最常見的案例 ERT 和 RPO。</span><span class="sxs-lookup"><span data-stu-id="9fa45-114">hello following table compares hello ERT and RPO for hello three most common scenarios.</span></span>

| <span data-ttu-id="9fa45-115">功能</span><span class="sxs-lookup"><span data-stu-id="9fa45-115">Capability</span></span> | <span data-ttu-id="9fa45-116">基本層</span><span class="sxs-lookup"><span data-stu-id="9fa45-116">Basic tier</span></span> | <span data-ttu-id="9fa45-117">標準層</span><span class="sxs-lookup"><span data-stu-id="9fa45-117">Standard tier</span></span> | <span data-ttu-id="9fa45-118">高階層</span><span class="sxs-lookup"><span data-stu-id="9fa45-118">Premium tier</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="9fa45-119">從備份進行時間點還原</span><span class="sxs-lookup"><span data-stu-id="9fa45-119">Point in Time Restore from backup</span></span> |<span data-ttu-id="9fa45-120">7 天內的任何還原點</span><span class="sxs-lookup"><span data-stu-id="9fa45-120">Any restore point within 7 days</span></span> |<span data-ttu-id="9fa45-121">35 天內的任何還原點</span><span class="sxs-lookup"><span data-stu-id="9fa45-121">Any restore point within 35 days</span></span> |<span data-ttu-id="9fa45-122">35 天內的任何還原點</span><span class="sxs-lookup"><span data-stu-id="9fa45-122">Any restore point within 35 days</span></span> |
| <span data-ttu-id="9fa45-123">從異地複寫備份進行異地還原</span><span class="sxs-lookup"><span data-stu-id="9fa45-123">Geo-restore from geo-replicated backups</span></span> |<span data-ttu-id="9fa45-124">ERT < 12 小時，RPO < 1 小時</span><span class="sxs-lookup"><span data-stu-id="9fa45-124">ERT < 12h, RPO < 1h</span></span> |<span data-ttu-id="9fa45-125">ERT < 12 小時，RPO < 1 小時</span><span class="sxs-lookup"><span data-stu-id="9fa45-125">ERT < 12h, RPO < 1h</span></span> |<span data-ttu-id="9fa45-126">ERT < 12 小時，RPO < 1 小時</span><span class="sxs-lookup"><span data-stu-id="9fa45-126">ERT < 12h, RPO < 1h</span></span> |
| <span data-ttu-id="9fa45-127">從 Azure 備份保存庫還原</span><span class="sxs-lookup"><span data-stu-id="9fa45-127">Restore from Azure Backup Vault</span></span> |<span data-ttu-id="9fa45-128">ERT < 12 小時，RPO < 1 週</span><span class="sxs-lookup"><span data-stu-id="9fa45-128">ERT < 12h, RPO < 1 wk</span></span> |<span data-ttu-id="9fa45-129">ERT < 12 小時，RPO < 1 週</span><span class="sxs-lookup"><span data-stu-id="9fa45-129">ERT < 12h, RPO < 1 wk</span></span> |<span data-ttu-id="9fa45-130">ERT < 12 小時，RPO < 1 週</span><span class="sxs-lookup"><span data-stu-id="9fa45-130">ERT < 12h, RPO < 1 wk</span></span> |
| <span data-ttu-id="9fa45-131">主動式異地複寫</span><span class="sxs-lookup"><span data-stu-id="9fa45-131">Active geo-replication</span></span> |<span data-ttu-id="9fa45-132">ERT < 30 秒，RPO < 5 秒</span><span class="sxs-lookup"><span data-stu-id="9fa45-132">ERT < 30s, RPO < 5s</span></span> |<span data-ttu-id="9fa45-133">ERT < 30 秒，RPO < 5 秒</span><span class="sxs-lookup"><span data-stu-id="9fa45-133">ERT < 30s, RPO < 5s</span></span> |<span data-ttu-id="9fa45-134">ERT < 30 秒，RPO < 5 秒</span><span class="sxs-lookup"><span data-stu-id="9fa45-134">ERT < 30s, RPO < 5s</span></span> |

### <a name="use-database-backups-toorecover-a-database"></a><span data-ttu-id="9fa45-135">使用資料庫備份 toorecover 資料庫</span><span class="sxs-lookup"><span data-stu-id="9fa45-135">Use database backups toorecover a database</span></span>

<span data-ttu-id="9fa45-136">SQL Database 會自動執行完整資料庫備份的組合每週、 每小時、 差異資料庫備份和交易記錄備份每隔五-十分鐘後 tooprotect 您免於資料遺失的業務。</span><span class="sxs-lookup"><span data-stu-id="9fa45-136">SQL Database automatically performs a combination of full database backups weekly, differential database backups hourly, and transaction log backups every five - ten minutes tooprotect your business from data loss.</span></span> <span data-ttu-id="9fa45-137">這些備份會儲存 35 天 hello Standard 和 Premium 服務層中的資料庫則為 7 天 hello 基本服務層中的資料庫地理備援儲存體中。</span><span class="sxs-lookup"><span data-stu-id="9fa45-137">These backups are stored in geo-redundant storage for 35 days for databases in hello Standard and Premium service tiers and 7 days for databases in hello Basic service tier.</span></span> <span data-ttu-id="9fa45-138">如需詳細資訊，請參閱[服務層](sql-database-service-tiers.md)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-138">For more information, see [service tiers](sql-database-service-tiers.md).</span></span> <span data-ttu-id="9fa45-139">如果您的服務層的 hello 保留期限不符合您的業務需求，您可以保留期限，hello 由[變更 hello 服務層](sql-database-service-tiers.md)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-139">If hello retention period for your service tier does not meet your business requirements, you can increase hello retention period by [changing hello service tier](sql-database-service-tiers.md).</span></span> <span data-ttu-id="9fa45-140">hello 完整和差異資料庫備份也是複寫的 tooa[成對的資料中心](../best-practices-availability-paired-regions.md)防止資料中心完全停止運作。</span><span class="sxs-lookup"><span data-stu-id="9fa45-140">hello full and differential database backups are also replicated tooa [paired data center](../best-practices-availability-paired-regions.md) for protection against a data center outage.</span></span> <span data-ttu-id="9fa45-141">如需詳細資訊，請參閱[自動資料庫備份](sql-database-automated-backups.md)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-141">For more information, see [automatic database backups](sql-database-automated-backups.md).</span></span>

<span data-ttu-id="9fa45-142">如果 hello 內建的保留期限是不夠的您的應用程式，您可以藉由設定資料庫長期保留原則來進行擴充。</span><span class="sxs-lookup"><span data-stu-id="9fa45-142">If hello built-in retention period is not sufficient for your application, you can extend it by configuring a database long-term retention policy.</span></span> <span data-ttu-id="9fa45-143">如需詳細資訊，請參閱[長期保留](sql-database-long-term-retention.md)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-143">For more information, see [long-term retention](sql-database-long-term-retention.md).</span></span>

<span data-ttu-id="9fa45-144">您可以使用這些自動資料庫備份 toorecover 各種干擾性事件，同時您資料中心和 tooanother 資料中心內的資料庫。</span><span class="sxs-lookup"><span data-stu-id="9fa45-144">You can use these automatic database backups toorecover a database from various disruptive events, both within your data center and tooanother data center.</span></span> <span data-ttu-id="9fa45-145">使用自動資料庫備份，hello 預估復原時間取決於數個因素，包括資料庫的復原 hello 相同的 hello 總數在 hello 相同的時間、 hello 資料庫大小、 hello 交易記錄大小和網路頻寬的區域。</span><span class="sxs-lookup"><span data-stu-id="9fa45-145">Using automatic database backups, hello estimated time of recovery depends on several factors including hello total number of databases recovering in hello same region at hello same time, hello database size, hello transaction log size, and network bandwidth.</span></span> <span data-ttu-id="9fa45-146">hello 復原時間通常是不超過 12 小時。</span><span class="sxs-lookup"><span data-stu-id="9fa45-146">hello recovery time is usually less than 12 hours.</span></span> <span data-ttu-id="9fa45-147">復原時 tooanother 資料區域，hello 潛在資料遺失會是每小時的差異資料庫備份 hello 地理備援儲存體的有限的 too1 小時。</span><span class="sxs-lookup"><span data-stu-id="9fa45-147">When recovering tooanother data region, hello potential data loss is limited too1 hour by hello geo-redundant storage of hourly differential database backups.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9fa45-148">toorecover 使用自動化備份，您必須是 hello SQL Server 參與者角色或 hello 訂用帳戶擁有者的成員-請參閱[RBAC： 內建角色](../active-directory/role-based-access-built-in-roles.md)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-148">toorecover using automated backups, you must be a member of hello SQL Server Contributor role or hello subscription owner - see [RBAC: Built-in roles](../active-directory/role-based-access-built-in-roles.md).</span></span> <span data-ttu-id="9fa45-149">您可以使用 hello Azure 入口網站、 PowerShell 或 REST API hello 進行復原。</span><span class="sxs-lookup"><span data-stu-id="9fa45-149">You can recover using hello Azure portal, PowerShell, or hello REST API.</span></span> <span data-ttu-id="9fa45-150">您無法使用 Transact-SQL。</span><span class="sxs-lookup"><span data-stu-id="9fa45-150">You cannot use Transact-SQL.</span></span>
>

<span data-ttu-id="9fa45-151">如果您的應用程式有下列狀況，可以使用自動備份做為您的商務持續性和復原機制︰</span><span class="sxs-lookup"><span data-stu-id="9fa45-151">Use automated backups as your business continuity and recovery mechanism if your application:</span></span>

* <span data-ttu-id="9fa45-152">非關鍵性應用程式。</span><span class="sxs-lookup"><span data-stu-id="9fa45-152">Is not considered mission critical.</span></span>
* <span data-ttu-id="9fa45-153">沒有繫結 SLA - 停機 24 小時或更長的時間不會衍生財務責任。</span><span class="sxs-lookup"><span data-stu-id="9fa45-153">Doesn't have a binding SLA - a downtime of 24 hours or longer does not result in financial liability.</span></span>
* <span data-ttu-id="9fa45-154">具有較低的資料變更 （每小時低交易） 率，並遺失 tooan 向上一小時的變更是可接受資料遺失。</span><span class="sxs-lookup"><span data-stu-id="9fa45-154">Has a low rate of data change (low transactions per hour) and losing up tooan hour of change is an acceptable data loss.</span></span>
* <span data-ttu-id="9fa45-155">成本有限。</span><span class="sxs-lookup"><span data-stu-id="9fa45-155">Is cost sensitive.</span></span>

<span data-ttu-id="9fa45-156">如果您需要更快速的復原，請使用[主動式異地複寫](sql-database-geo-replication-overview.md) (會接著討論)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-156">If you need faster recovery, use [active geo-replication](sql-database-geo-replication-overview.md) (discussed next).</span></span> <span data-ttu-id="9fa45-157">如果您需要超過 35 天期間的 toobe 無法 toorecover 資料時，使用[長期備份的保留](sql-database-long-term-retention.md)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-157">If you need toobe able toorecover data from a period older than 35 days, use [long-term backup retention](sql-database-long-term-retention.md).</span></span> 

### <a name="use-active-geo-replication-and-auto-failover-groups-in-preview-tooreduce-recovery-time-and-limit-data-loss-associated-with-a-recovery"></a><span data-ttu-id="9fa45-158">使用作用中地理複寫 」 和 「 自動容錯移轉群組 （預覽版） tooreduce 復原時間與限制資料遺失相關聯的 recovery</span><span class="sxs-lookup"><span data-stu-id="9fa45-158">Use active geo-replication and auto-failover groups (in-preview) tooreduce recovery time and limit data loss associated with a recovery</span></span>

<span data-ttu-id="9fa45-159">此外 toousing 資料庫備份的資料庫復原業務中斷發生時，您可以使用[作用中地理複寫](sql-database-geo-replication-overview.md)tooconfigure 向上 toofour 可讀取次要區域中的資料庫 hello 資料庫 toohave 的程式選擇。</span><span class="sxs-lookup"><span data-stu-id="9fa45-159">In addition toousing database backups for database recovery if a business disruption occurs, you can use [active geo-replication](sql-database-geo-replication-overview.md) tooconfigure a database toohave up toofour readable secondary databases in hello regions of your choice.</span></span> <span data-ttu-id="9fa45-160">這些次要資料庫會保持與 hello 使用非同步複寫機制的主要資料庫同步。</span><span class="sxs-lookup"><span data-stu-id="9fa45-160">These secondary databases are kept synchronized with hello primary database using an asynchronous replication mechanism.</span></span> <span data-ttu-id="9fa45-161">這項功能是使用的 tooprotect 針對業務中斷發生資料中心中斷或應用程式在升級期間。</span><span class="sxs-lookup"><span data-stu-id="9fa45-161">This feature is used tooprotect against business disruption if a data center outage occurs or during an application upgrade.</span></span> <span data-ttu-id="9fa45-162">作用中地理複寫，也可以是唯讀查詢 toogeographically 分散的使用者使用的 tooprovide 提高查詢效能。</span><span class="sxs-lookup"><span data-stu-id="9fa45-162">Active geo-replication can also be used tooprovide better query performance for read-only queries toogeographically dispersed users.</span></span>

<span data-ttu-id="9fa45-163">tooenable 自動化和透明容錯移轉，您應該組織到您進行地理複寫的資料庫群組使用 hello[自動容錯移轉群組](sql-database-geo-replication-overview.md)SQL Database （預覽） 功能。</span><span class="sxs-lookup"><span data-stu-id="9fa45-163">tooenable automated and transparent failover you should organize your geo-replicated databases into groups using hello [auto-failover group](sql-database-geo-replication-overview.md) feature of SQL Database (in-preview).</span></span>

<span data-ttu-id="9fa45-164">如果 hello 主要資料庫會意外地離線或需要 tootake 離線維護活動，您可以快速升級次要 toobecome hello 主要 （也稱為 「 容錯移轉 」） 並設定應用程式 tooconnect toohello 升級主要。</span><span class="sxs-lookup"><span data-stu-id="9fa45-164">If hello primary database goes offline unexpectedly or you need tootake it offline for maintenance activities, you can quickly promote a secondary toobecome hello primary (also called a failover) and configure applications tooconnect toohello promoted primary.</span></span> <span data-ttu-id="9fa45-165">如果您的應用程式連接 toohello 資料庫使用 hello 容錯移轉群組接聽程式，您不需要 toochange hello SQL 連接字串組態容錯移轉之後。</span><span class="sxs-lookup"><span data-stu-id="9fa45-165">If your application is connecting toohello databases using hello failover group listener, you don’t need toochange hello SQL connection string configuration after failover.</span></span> <span data-ttu-id="9fa45-166">使用計劃性容錯移轉時，不會有任何資料遺失。</span><span class="sxs-lookup"><span data-stu-id="9fa45-166">With a planned failover, there is no data loss.</span></span> <span data-ttu-id="9fa45-167">與未規劃的容錯移轉，可能會有一些少量到期 toohello 本質的非同步複寫的最新交易遺失資料。</span><span class="sxs-lookup"><span data-stu-id="9fa45-167">With an unplanned failover, there may be some small amount of data loss for very recent transactions due toohello nature of asynchronous replication.</span></span> <span data-ttu-id="9fa45-168">使用自動容錯移轉群組 （預覽），您可以自訂 hello 容錯移轉原則 toominimize hello 潛在資料遺失。</span><span class="sxs-lookup"><span data-stu-id="9fa45-168">Using auto-failover groups (in-preview), you can customize hello failover policy toominimize hello potential data loss.</span></span> <span data-ttu-id="9fa45-169">容錯移轉之後，您可以稍後的容錯回復-相應 tooa 計劃或當 hello 資料中心再次上線。</span><span class="sxs-lookup"><span data-stu-id="9fa45-169">After a failover, you can later failback - either according tooa plan or when hello data center comes back online.</span></span> <span data-ttu-id="9fa45-170">在所有情況下，使用者體驗更少的停機時間，而且需要 tooreconnect。</span><span class="sxs-lookup"><span data-stu-id="9fa45-170">In all cases, users experience a small amount of downtime and need tooreconnect.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9fa45-171">toouse 作用中地理複寫和自動容錯移轉群組 （預覽），您必須是 hello 訂用帳戶擁有者或 SQL Server 中具有系統管理權限。</span><span class="sxs-lookup"><span data-stu-id="9fa45-171">toouse active geo-replication and auto-failover groups (in-preview), you must either be hello subscription owner or have administrative permissions in SQL Server.</span></span> <span data-ttu-id="9fa45-172">您可以設定和容錯移轉使用 hello Azure 入口網站、 PowerShell 或 hello REST API 使用 Azure 訂用帳戶的權限，或使用 SQL Server 權限的 Transact SQL。</span><span class="sxs-lookup"><span data-stu-id="9fa45-172">You can configure and fail over using hello Azure portal, PowerShell, or hello REST API using Azure subscription permissions or using Transact-SQL with SQL Server permissions.</span></span>
> 

<span data-ttu-id="9fa45-173">如果您的應用程式符合下列任何準則，請使用主動式異地複寫和自動容錯移轉群組 (預覽版)：</span><span class="sxs-lookup"><span data-stu-id="9fa45-173">Use active geo-replication and auto-failover groups (in preview) if your application meets any of these criteria:</span></span>

* <span data-ttu-id="9fa45-174">是關鍵性應用程式。</span><span class="sxs-lookup"><span data-stu-id="9fa45-174">Is mission critical.</span></span>
* <span data-ttu-id="9fa45-175">具有服務等級協定 (SLA)，不允許 24 小時以上的停機時間。</span><span class="sxs-lookup"><span data-stu-id="9fa45-175">Has a service level agreement (SLA) that does not allow for 24 hours or more of downtime.</span></span>
* <span data-ttu-id="9fa45-176">停機可能會衍生財務責任。</span><span class="sxs-lookup"><span data-stu-id="9fa45-176">Downtime may result in financial liability.</span></span>
* <span data-ttu-id="9fa45-177">具有很高的資料變更率，而且不接受遺失一個小時的資料。</span><span class="sxs-lookup"><span data-stu-id="9fa45-177">Has a high rate of data change is high and losing an hour of data is not acceptable.</span></span>
* <span data-ttu-id="9fa45-178">hello 額外的作用中地理複寫的成本低於 hello 潛在的財務損害賠償責任和關聯的商務遺失。</span><span class="sxs-lookup"><span data-stu-id="9fa45-178">hello additional cost of active geo-replication is lower than hello potential financial liability and associated loss of business.</span></span>

>
> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Azure-SQL-Database-protecting-important-DBs-from-regional-disasters-is-easy/player]
>

## <a name="recover-a-database-after-a-user-or-application-error"></a><span data-ttu-id="9fa45-179">在使用者或應用程式錯誤之後復原資料庫</span><span class="sxs-lookup"><span data-stu-id="9fa45-179">Recover a database after a user or application error</span></span>
<span data-ttu-id="9fa45-180">* 沒有人是完美的！</span><span class="sxs-lookup"><span data-stu-id="9fa45-180">*No one is perfect!</span></span> <span data-ttu-id="9fa45-181">使用者可能會不小心刪除某些資料、不小心卸除重要的資料表，或甚至是卸除整個資料庫。</span><span class="sxs-lookup"><span data-stu-id="9fa45-181">A user might accidentally delete some data, inadvertently drop an important table, or even drop an entire database.</span></span> <span data-ttu-id="9fa45-182">或者，應用程式可能會不小心覆寫良好的資料不正確的資料，因為 tooan 應用程式的缺失。</span><span class="sxs-lookup"><span data-stu-id="9fa45-182">Or, an application might accidentally overwrite good data with bad data due tooan application defect.</span></span>

<span data-ttu-id="9fa45-183">在此案例中，以下是您的復原選項。</span><span class="sxs-lookup"><span data-stu-id="9fa45-183">In this scenario, these are your recovery options.</span></span>

### <a name="perform-a-point-in-time-restore"></a><span data-ttu-id="9fa45-184">執行還原時間點</span><span class="sxs-lookup"><span data-stu-id="9fa45-184">Perform a point-in-time restore</span></span>
<span data-ttu-id="9fa45-185">假設時間為 hello 資料庫的保留期限內，您可以使用 hello 自動化備份 toorecover 已知的恰當起點的時間，您資料庫 tooa 的複本。</span><span class="sxs-lookup"><span data-stu-id="9fa45-185">You can use hello automated backups toorecover a copy of your database tooa known good point in time, provided that time is within hello database retention period.</span></span> <span data-ttu-id="9fa45-186">Hello 資料庫還原後，您可以取代 hello 還原資料庫中的 hello 原始資料庫或 hello 還原資料所需的 hello 資料複製到 hello 原始資料庫。</span><span class="sxs-lookup"><span data-stu-id="9fa45-186">After hello database is restored, you can either replace hello original database with hello restored database or copy hello needed data from hello restored data into hello original database.</span></span> <span data-ttu-id="9fa45-187">如果 hello 資料庫使用作用中地理複寫，我們建議所需的 hello 資料複製到 hello 原始資料庫的 hello 還原複本。</span><span class="sxs-lookup"><span data-stu-id="9fa45-187">If hello database uses active geo-replication, we recommend copying hello required data from hello restored copy into hello original database.</span></span> <span data-ttu-id="9fa45-188">如果您取代 hello 原始資料庫與 hello 還原資料庫時，您會需要 tooreconfigure，並重新同步處理作用中的地理複寫 （這可能要花費一段時間，大型資料庫）。</span><span class="sxs-lookup"><span data-stu-id="9fa45-188">If you replace hello original database with hello restored database, you need tooreconfigure and resynchronize active geo-replication (which can take quite some time for a large database).</span></span>

<span data-ttu-id="9fa45-189">如需詳細資訊和詳細步驟，還原時間，使用 database tooa 點 hello Azure 入口網站，或使用 PowerShell，請參閱[時間點還原](sql-database-recovery-using-backups.md#point-in-time-restore)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-189">For more information and for detailed steps for restoring a database tooa point in time using hello Azure portal or using PowerShell, see [point-in-time restore](sql-database-recovery-using-backups.md#point-in-time-restore).</span></span> <span data-ttu-id="9fa45-190">您無法使用 Transact-SQL 進行復原。</span><span class="sxs-lookup"><span data-stu-id="9fa45-190">You cannot recover using Transact-SQL.</span></span>

### <a name="restore-a-deleted-database"></a><span data-ttu-id="9fa45-191">還原已刪除的資料庫</span><span class="sxs-lookup"><span data-stu-id="9fa45-191">Restore a deleted database</span></span>
<span data-ttu-id="9fa45-192">如果 hello 資料庫已刪除，但尚未刪除 hello 邏輯伺服器，您可以還原刪除的 hello database toohello 點的已刪除。</span><span class="sxs-lookup"><span data-stu-id="9fa45-192">If hello database is deleted but hello logical server has not been deleted, you can restore hello deleted database toohello point at which it was deleted.</span></span> <span data-ttu-id="9fa45-193">這會還原資料庫備份的 toohello 邏輯已刪除的相同 SQL server。</span><span class="sxs-lookup"><span data-stu-id="9fa45-193">This restores a database backup toohello same logical SQL server from which it was deleted.</span></span> <span data-ttu-id="9fa45-194">您可以還原使用 hello 原始名稱，或提供新的名稱或 hello 還原資料庫。</span><span class="sxs-lookup"><span data-stu-id="9fa45-194">You can restore it using hello original name or provide a new name or hello restored database.</span></span>

<span data-ttu-id="9fa45-195">如需詳細資訊以及詳細的步驟來還原已刪除的資料庫使用 hello Azure 入口網站或使用 PowerShell，請參閱[還原已刪除的資料庫](sql-database-recovery-using-backups.md#deleted-database-restore)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-195">For more information and for detailed steps for restoring a deleted database using hello Azure portal or using PowerShell, see [restore a deleted database](sql-database-recovery-using-backups.md#deleted-database-restore).</span></span> <span data-ttu-id="9fa45-196">您無法使用 Transact-SQL 進行還原。</span><span class="sxs-lookup"><span data-stu-id="9fa45-196">You cannot restore using Transact-SQL.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9fa45-197">如果刪除 hello 邏輯伺服器，就無法復原已刪除的資料庫。</span><span class="sxs-lookup"><span data-stu-id="9fa45-197">If hello logical server is deleted, you cannot recover a deleted database.</span></span>
>
>

### <a name="restore-from-azure-backup-vault"></a><span data-ttu-id="9fa45-198">從 Azure 備份保存庫還原</span><span class="sxs-lookup"><span data-stu-id="9fa45-198">Restore from Azure Backup Vault</span></span>
<span data-ttu-id="9fa45-199">如果 hello 資料遺失的自動備份 hello 目前保留期間外，而設定供長期保存您的資料庫，您可以從 Azure 備份保存庫 tooa 新資料庫中的每週備份進行還原。</span><span class="sxs-lookup"><span data-stu-id="9fa45-199">If hello data loss occurred outside hello current retention period for automated backups and your database is configured for long-term retention, you can restore from a weekly backup in Azure Backup Vault tooa new database.</span></span> <span data-ttu-id="9fa45-200">此時，您可以取代 hello 還原資料庫中的 hello 原始資料庫，或 hello 還原資料庫所需的 hello 資料複製到 hello 原始資料庫。</span><span class="sxs-lookup"><span data-stu-id="9fa45-200">At this point, you can either replace hello original database with hello restored database or copy hello needed data from hello restored database into hello original database.</span></span> <span data-ttu-id="9fa45-201">如果您需要 tooretrieve 較舊版本的資料庫先前 tooa 主要的應用程式升級時，滿足要求，以從稽核員或合法的順序，您可以建立使用儲存在 hello Azure 備份保存庫的完整備份的資料庫。</span><span class="sxs-lookup"><span data-stu-id="9fa45-201">If you need tooretrieve an old version of your database prior tooa major application upgrade, satisfy a request from auditors or a legal order, you can create a database using a full backup saved in hello Azure Backup Vault.</span></span>  <span data-ttu-id="9fa45-202">如需詳細資訊，請參閱[長期保存](sql-database-long-term-retention.md)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-202">For more information, see [Long-term retention](sql-database-long-term-retention.md).</span></span>

## <a name="recover-a-database-tooanother-region-from-an-azure-regional-data-center-outage"></a><span data-ttu-id="9fa45-203">從 Azure 地區資料中心中斷復原資料庫 tooanother 區域</span><span class="sxs-lookup"><span data-stu-id="9fa45-203">Recover a database tooanother region from an Azure regional data center outage</span></span>
<!-- Explain this scenario -->

<span data-ttu-id="9fa45-204">雖然很罕見，但 Azure 資料中心也可能會有中斷的時候。</span><span class="sxs-lookup"><span data-stu-id="9fa45-204">Although rare, an Azure data center can have an outage.</span></span> <span data-ttu-id="9fa45-205">發生中斷時，可能只會讓業務中斷幾分鐘，也可能會持續幾小時。</span><span class="sxs-lookup"><span data-stu-id="9fa45-205">When an outage occurs, it causes a business disruption that might only last a few minutes or might last for hours.</span></span>

* <span data-ttu-id="9fa45-206">其中一個選項是針對上線的資料庫 toocome toowait 上方 hello 資料中心完全停止運作時。</span><span class="sxs-lookup"><span data-stu-id="9fa45-206">One option is toowait for your database toocome back online when hello data center outage is over.</span></span> <span data-ttu-id="9fa45-207">這適用於應用程式可以容忍 toohave hello 資料庫離線。</span><span class="sxs-lookup"><span data-stu-id="9fa45-207">This works for applications that can afford toohave hello database offline.</span></span> <span data-ttu-id="9fa45-208">例如，開發專案或免費試用您不需要 toowork 上持續。</span><span class="sxs-lookup"><span data-stu-id="9fa45-208">For example, a development project or free trial you don't need toowork on constantly.</span></span> <span data-ttu-id="9fa45-209">當資料中心中斷時，您不知道 hello 中斷可能時間長短，因此如果您不需要一段時間的資料庫，僅適用於此選項。</span><span class="sxs-lookup"><span data-stu-id="9fa45-209">When a data center has an outage, you do not know how long hello outage might last, so this option only works if you don't need your database for a while.</span></span>
* <span data-ttu-id="9fa45-210">如果您使用的作用中地理複寫或 hello 復原資料庫，使用異地備援資料庫備份 （「 地理還原），另一個選項的是 tooeither 失敗 tooanother 資料區域。</span><span class="sxs-lookup"><span data-stu-id="9fa45-210">Another option is tooeither fail over tooanother data region if you are using active geo-replication or hello recover a database using geo-redundant database backups (geo-restore).</span></span> <span data-ttu-id="9fa45-211">容錯移轉只需要幾秒鐘的時間，而從備份復原資料庫則需要幾個小時。</span><span class="sxs-lookup"><span data-stu-id="9fa45-211">Failover takes only a few seconds while database recovery from backups takes hours.</span></span>

<span data-ttu-id="9fa45-212">當您採取動作時，要花多久您 toorecover，以及多少資料遺失，您會產生取決於您決定如何將 toouse 這些應用程式中的業務續航力功能。</span><span class="sxs-lookup"><span data-stu-id="9fa45-212">When you take action, how long it takes you toorecover, and how much data loss you incur depends upon how you decide toouse these business continuity features in your application.</span></span> <span data-ttu-id="9fa45-213">事實上，您可以選擇 toouse 資料庫備份和應用程式的需求而定作用中地理複寫的組合。</span><span class="sxs-lookup"><span data-stu-id="9fa45-213">Indeed, you may choose toouse a combination of database backups and active geo-replication depending upon your application requirements.</span></span> <span data-ttu-id="9fa45-214">若要探討使用這些商務持續性功能針對獨立資料庫和彈性集區進行應用程式設計時的考量，請參閱[設計雲端災害復原應用程式](sql-database-designing-cloud-solutions-for-disaster-recovery.md)和[彈性集區災害復原策略](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-214">For a discussion of application design considerations for stand-alone databases and for elastic pools using these business continuity features, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) and [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

<span data-ttu-id="9fa45-215">hello 下列各節提供使用資料庫備份或作用中地理複寫的 hello 步驟 toorecover 的概觀。</span><span class="sxs-lookup"><span data-stu-id="9fa45-215">hello following sections provide an overview of hello steps toorecover using either database backups or active geo-replication.</span></span> <span data-ttu-id="9fa45-216">如需詳細步驟，包括規劃需求、 post 修復步驟和如何 toosimulate 中斷 tooperform 災害復原切入的相關資訊，請參閱[從中斷復原 SQL 資料庫](sql-database-disaster-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-216">For detailed steps including planning requirements, post recovery steps, and information about how toosimulate an outage tooperform a disaster recovery drill, see [Recover a SQL Database from an outage](sql-database-disaster-recovery.md).</span></span>

### <a name="prepare-for-an-outage"></a><span data-ttu-id="9fa45-217">準備中斷</span><span class="sxs-lookup"><span data-stu-id="9fa45-217">Prepare for an outage</span></span>
<span data-ttu-id="9fa45-218">不論您使用 hello 業務續航力功能，您必須：</span><span class="sxs-lookup"><span data-stu-id="9fa45-218">Regardless of hello business continuity feature you use, you must:</span></span>

* <span data-ttu-id="9fa45-219">識別並準備 hello 目標伺服器，包括伺服器層級防火牆規則、 登入，以及 master 資料庫層級權限。</span><span class="sxs-lookup"><span data-stu-id="9fa45-219">Identify and prepare hello target server, including server-level firewall rules, logins, and master database level permissions.</span></span>
* <span data-ttu-id="9fa45-220">判斷如何 tooredirect 用戶端和用戶端應用程式 toohello 新伺服器</span><span class="sxs-lookup"><span data-stu-id="9fa45-220">Determine how tooredirect clients and client applications toohello new server</span></span>
* <span data-ttu-id="9fa45-221">記錄其他相依性，例如稽核設定和警示</span><span class="sxs-lookup"><span data-stu-id="9fa45-221">Document other dependencies, such as auditing settings and alerts</span></span>

<span data-ttu-id="9fa45-222">如果您沒有適當地準備，在容錯移轉或資料庫復原後讓應用程式上線將會多花費時間，而且也可能需要在有壓力的情況下進行疑難排解 - 這是不良的情況組合。</span><span class="sxs-lookup"><span data-stu-id="9fa45-222">If you do not prepare properly, bringing your applications online after a failover or a database recovery takes additional time and likely also require troubleshooting at a time of stress - a bad combination.</span></span>

### <a name="fail-over-tooa-geo-replicated-secondary-database"></a><span data-ttu-id="9fa45-223">容錯移轉 tooa 異地備援的次要資料庫</span><span class="sxs-lookup"><span data-stu-id="9fa45-223">Fail over tooa geo-replicated secondary database</span></span>
<span data-ttu-id="9fa45-224">若您使用作用中異地複寫和自動容錯移轉群組 (預覽版) 作為復原機制，則可設定自動容錯移轉原則或使用[手動容錯移轉](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-database)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-224">If you are using active geo-replication and auto-failover groups (in-preview) as your recovery mechanism, you can configure an automatic failover policy or use [manual failover](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-database).</span></span> <span data-ttu-id="9fa45-225">一旦起始，hello 容錯移轉原因 hello 次要 toobecome hello 新的主要和準備 toorecord 新交易，以及回應 tooqueries-hello 尚未複寫的資料遺失最少的資料。</span><span class="sxs-lookup"><span data-stu-id="9fa45-225">Once initiated, hello failover causes hello secondary toobecome hello new primary and ready toorecord new transactions and respond tooqueries - with minimal data loss for hello data not yet replicated.</span></span> <span data-ttu-id="9fa45-226">如需設計 hello 容錯移轉程序資訊，請參閱[設計的應用程式的雲端災害復原](sql-database-designing-cloud-solutions-for-disaster-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-226">For information on designing hello failover process, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span></span>

> [!NOTE]
> <span data-ttu-id="9fa45-227">Hello 資料中心再次上線時 hello 舊主要複本會自動重新連線 toohello 新主要複本，並會變成次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="9fa45-227">When hello data center comes back online hello old primaries automatically reconnect toohello new primary and become secondary databases.</span></span> <span data-ttu-id="9fa45-228">如果您需要 toorelocate hello 主要後 toohello 原始區域，您可以手動起始已規劃的容錯移轉 （回復）。</span><span class="sxs-lookup"><span data-stu-id="9fa45-228">If you need toorelocate hello primary back toohello original region, you can initiate a planned failover manually (failback).</span></span> 
> 

### <a name="perform-a-geo-restore"></a><span data-ttu-id="9fa45-229">執行異地還原</span><span class="sxs-lookup"><span data-stu-id="9fa45-229">Perform a geo-restore</span></span>
<span data-ttu-id="9fa45-230">如果您使用自動備份搭配異地備援儲存體複寫作為復原機制，請[使用異地還原起始資料庫復原](sql-database-disaster-recovery.md#recover-using-geo-restore)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-230">If you are using automated backups with geo-redundant storage replication as your recovery mechanism, [initiate a database recovery using geo-restore](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span> <span data-ttu-id="9fa45-231">復原通常會發生在 12 小時內-向上取決於當 hello tooone 小時的資料遺失的最後一個每小時的差異備份所建立和複寫。</span><span class="sxs-lookup"><span data-stu-id="9fa45-231">Recovery usually takes place within 12 hours - with data loss of up tooone hour determined by when hello last hourly differential backup with taken and replicated.</span></span> <span data-ttu-id="9fa45-232">Hello 復原完成，直到 hello 資料庫是無法 toorecord 任何交易，或是回應 tooany 查詢。</span><span class="sxs-lookup"><span data-stu-id="9fa45-232">Until hello recovery completes, hello database is unable toorecord any transactions or respond tooany queries.</span></span> <span data-ttu-id="9fa45-233">雖然這會還原資料庫 toohello 最後一個可用的點，還原時間 hello 地理次要 tooany 點目前不支援。</span><span class="sxs-lookup"><span data-stu-id="9fa45-233">While this restores a database toohello last available point in time, restoring hello geo-secondary tooany point in time is not currently supported.</span></span>

> [!NOTE]
> <span data-ttu-id="9fa45-234">如果您的應用程式切換 toohello 復原資料庫之前，hello 資料中心再次上線，您可以取消 hello 復原。</span><span class="sxs-lookup"><span data-stu-id="9fa45-234">If hello data center comes back online before you switch your application over toohello recovered database, you can cancel hello recovery.</span></span>  
>
>

### <a name="perform-post-failover--recovery-tasks"></a><span data-ttu-id="9fa45-235">執行容錯移轉後/復原後工作</span><span class="sxs-lookup"><span data-stu-id="9fa45-235">Perform post failover / recovery tasks</span></span>
<span data-ttu-id="9fa45-236">復原後的其中一種復原機制，您必須執行下列額外的工作，您的使用者和應用程式在備份之前，執行 hello:</span><span class="sxs-lookup"><span data-stu-id="9fa45-236">After recovery from either recovery mechanism, you must perform hello following additional tasks before your users and applications are back up and running:</span></span>

* <span data-ttu-id="9fa45-237">重新導向用戶端與用戶端應用程式 toohello 新伺服器還原的資料庫</span><span class="sxs-lookup"><span data-stu-id="9fa45-237">Redirect clients and client applications toohello new server and restored database</span></span>
* <span data-ttu-id="9fa45-238">請確定適當的伺服器層級防火牆規則中進行使用者 tooconnect (或使用[資料庫層級防火牆](sql-database-firewall-configure.md#creating-and-managing-firewall-rules))</span><span class="sxs-lookup"><span data-stu-id="9fa45-238">Ensure appropriate server-level firewall rules are in place for users tooconnect (or use [database-level firewalls](sql-database-firewall-configure.md#creating-and-managing-firewall-rules))</span></span>
* <span data-ttu-id="9fa45-239">確定有適當的登入和 master 資料庫層級權限 (或使用 [自主的使用者](https://msdn.microsoft.com/library/ff929188.aspx))</span><span class="sxs-lookup"><span data-stu-id="9fa45-239">Ensure appropriate logins and master database level permissions are in place (or use [contained users](https://msdn.microsoft.com/library/ff929188.aspx))</span></span>
* <span data-ttu-id="9fa45-240">依適當情況設定稽核</span><span class="sxs-lookup"><span data-stu-id="9fa45-240">Configure auditing, as appropriate</span></span>
* <span data-ttu-id="9fa45-241">依適當情況設定警示</span><span class="sxs-lookup"><span data-stu-id="9fa45-241">Configure alerts, as appropriate</span></span>

## <a name="upgrade-an-application-with-minimal-downtime"></a><span data-ttu-id="9fa45-242">在最少停機時間的情況下升級應用程式</span><span class="sxs-lookup"><span data-stu-id="9fa45-242">Upgrade an application with minimal downtime</span></span>
<span data-ttu-id="9fa45-243">有時，應用程式會因為計劃性維護 (例如應用程式升級) 而必須離線。</span><span class="sxs-lookup"><span data-stu-id="9fa45-243">Sometimes an application must be taken offline because of planned maintenance such as an application upgrade.</span></span> <span data-ttu-id="9fa45-244">[管理應用程式的升級](sql-database-manage-application-rolling-upgrade.md)描述如何 toouse 作用中地理複寫 tooenable 輪流升級期間將雲端應用程式 toominimize 停機時間升級，並提供復原路徑，如果發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="9fa45-244">[Manage application upgrades](sql-database-manage-application-rolling-upgrade.md) describes how toouse active geo-replication tooenable rolling upgrades of your cloud application toominimize downtime during upgrades and provide a recovery path if something goes wrong.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="9fa45-245">後續步驟</span><span class="sxs-lookup"><span data-stu-id="9fa45-245">Next steps</span></span>
<span data-ttu-id="9fa45-246">如需獨立資料庫和彈性集區的應用程式設計考量探討，請參閱[設計雲端災害復原應用程式](sql-database-designing-cloud-solutions-for-disaster-recovery.md)和[彈性集區災害復原策略](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md)。</span><span class="sxs-lookup"><span data-stu-id="9fa45-246">For a discussion of application design considerations for stand-alone databases and for elastic pools, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) and [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
