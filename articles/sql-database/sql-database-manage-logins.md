---
title: "Azure SQL 登入與使用者 | Microsoft Docs"
description: "深入了解 SQL Database 安全性管理，特別是如何透過伺服器層級主體帳戶管理資料庫存取與登入安全性。"
keywords: "sql 資料庫安全性, 資料庫安全性管理, 登入安全性, 資料庫安全性, 資料庫存取權"
services: sql-database
documentationcenter: 
author: BYHAM
manager: jhubbard
editor: 
tags: 
ms.assetid: 0a65a93f-d5dc-424b-a774-7ed62d996f8c
ms.service: sql-database
ms.custom: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/23/2017
ms.author: rickbyh
ms.openlocfilehash: 51edd390c065dd7312ecc54694b5a95ecc11eab8
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="controlling-and-granting-database-access"></a><span data-ttu-id="a89ff-104">控制和授與資料庫存取權</span><span class="sxs-lookup"><span data-stu-id="a89ff-104">Controlling and granting database access</span></span>

<span data-ttu-id="a89ff-105">設定防火牆規則後，使用者可以系統管理員帳戶、資料庫擁有者或資料庫中的資料庫使用者身分連接至 SQL 資料庫。</span><span class="sxs-lookup"><span data-stu-id="a89ff-105">When firewall rules have been configured, people can connect to a SQL Database as one of the administrator accounts, as the database owner, or as a database user in the database.</span></span>  

>  [!NOTE]  
>  <span data-ttu-id="a89ff-106">本主題適用於 Azure SQL 伺服器，以及在 Azure SQL Server 上建立的 SQL Database 和 SQL 資料倉儲資料庫。</span><span class="sxs-lookup"><span data-stu-id="a89ff-106">This topic applies to Azure SQL server, and to both SQL Database and SQL Data Warehouse databases that are created on the Azure SQL server.</span></span> <span data-ttu-id="a89ff-107">為了簡單起見，參考 SQL Database 和 SQL 資料倉儲時都會使用 SQL Database。</span><span class="sxs-lookup"><span data-stu-id="a89ff-107">For simplicity, SQL Database is used when referring to both SQL Database and SQL Data Warehouse.</span></span> 
>

> [!TIP]
> <span data-ttu-id="a89ff-108">如需教學課程，請參閱[保護 Azure SQL Database](sql-database-security-tutorial.md)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-108">For a tutorial, see [Secure your Azure SQL Database](sql-database-security-tutorial.md).</span></span>
>


## <a name="unrestricted-administrative-accounts"></a><span data-ttu-id="a89ff-109">不受限制的系統管理帳戶</span><span class="sxs-lookup"><span data-stu-id="a89ff-109">Unrestricted administrative accounts</span></span>
<span data-ttu-id="a89ff-110">做為系統管理員的系統管理帳戶有兩個 (**伺服器管理員**和**Active Directory 管理員**)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-110">There are two administrative accounts (**Server admin** and **Active Directory admin**) that act as administrators.</span></span> <span data-ttu-id="a89ff-111">若要識別 SQL server 的系統管理員帳戶，請開啟 Azure 入口網站，然後瀏覽至 SQL server 的屬性。</span><span class="sxs-lookup"><span data-stu-id="a89ff-111">To identify these administrator accounts for your SQL server, open the Azure portal, and navigate to the properties of your SQL server.</span></span>

![SQL Server 系統管理員](./media/sql-database-manage-logins/sql-admins.png)

- <span data-ttu-id="a89ff-113">**伺服器管理員** </span><span class="sxs-lookup"><span data-stu-id="a89ff-113">**Server admin** </span></span>  
<span data-ttu-id="a89ff-114">當您建立 Azure SQL server 時，您必須指定**伺服器管理員登入**。</span><span class="sxs-lookup"><span data-stu-id="a89ff-114">When you create an Azure SQL server, you must designate a **Server admin login**.</span></span> <span data-ttu-id="a89ff-115">SQL Server 會將該帳戶建立為 master 資料庫中的登入。</span><span class="sxs-lookup"><span data-stu-id="a89ff-115">SQL server creates that account as a login in the master database.</span></span> <span data-ttu-id="a89ff-116">此帳戶會使用 SQL Server 驗證 (使用者名稱和密碼) 連接。</span><span class="sxs-lookup"><span data-stu-id="a89ff-116">This account connects using SQL Server authentication (user name and password).</span></span> <span data-ttu-id="a89ff-117">只有其中一個帳戶可以存在。</span><span class="sxs-lookup"><span data-stu-id="a89ff-117">Only one of these accounts can exist.</span></span>   
- <span data-ttu-id="a89ff-118">**Azure Active Directory 管理員** </span><span class="sxs-lookup"><span data-stu-id="a89ff-118">**Azure Active Directory admin** </span></span>  
<span data-ttu-id="a89ff-119">一個 Azure Active Directory 帳戶 (個人或安全性群組帳戶) 也可以設定為系統管理員。</span><span class="sxs-lookup"><span data-stu-id="a89ff-119">One Azure Active Directory account, either an individual or security group account, can also be configured as an administrator.</span></span> <span data-ttu-id="a89ff-120">選擇性地設定 Azure AD 系統管理員，但是如果您想要使用 Azure AD 帳戶連接到 SQL Database，則必須設定 Azure AD 系統管理員。</span><span class="sxs-lookup"><span data-stu-id="a89ff-120">It is optional to configure an Azure AD administrator, but an Azure AD administrator must be configured if you want to use Azure AD accounts to connect to SQL Database.</span></span> <span data-ttu-id="a89ff-121">如需有關設定 Azure Active Directory 存取權的詳細資訊，請參閱[使用 Azure Active Directory 驗證連線到 SQL Database 或 SQL 資料倉儲](sql-database-aad-authentication.md)和[適用於與 SQL Database 和 SQL 資料倉儲搭配使用之 Azure AD MFA 的 SSMS 支援](sql-database-ssms-mfa-authentication.md)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-121">For more information about configuring Azure Active Directory access, see [Connecting to SQL Database or SQL Data Warehouse By Using Azure Active Directory Authentication](sql-database-aad-authentication.md) and [SSMS support for Azure AD MFA with SQL Database and SQL Data Warehouse](sql-database-ssms-mfa-authentication.md).</span></span>
 

<span data-ttu-id="a89ff-122">**伺服器管理員**和 **Azure AD 管理員**帳戶具有下列特性︰</span><span class="sxs-lookup"><span data-stu-id="a89ff-122">The **Server admin** and **Azure AD admin** accounts has the following characteristics:</span></span>
- <span data-ttu-id="a89ff-123">這些是唯一可以自動連接到伺服器上任何 SQL Database 的帳戶。</span><span class="sxs-lookup"><span data-stu-id="a89ff-123">These are the only accounts that can automatically connect to any SQL Database on the server.</span></span> <span data-ttu-id="a89ff-124">(若要連接至使用者資料庫，其他帳戶必須是資料庫的擁有者，或在使用者資料庫中擁有使用者帳戶。)</span><span class="sxs-lookup"><span data-stu-id="a89ff-124">(To connect to a user database, other accounts must either be the owner of the database, or have a user account in the user database.)</span></span>
- <span data-ttu-id="a89ff-125">這些帳戶會輸入使用者資料庫做為 `dbo` 使用者，而且具有使用者資料庫中的所有權限。</span><span class="sxs-lookup"><span data-stu-id="a89ff-125">These accounts enter user databases as the `dbo` user and they have all the permissions in the user databases.</span></span> <span data-ttu-id="a89ff-126">(使用者資料庫的擁有者也會進入資料庫做為 `dbo` 使用者。)</span><span class="sxs-lookup"><span data-stu-id="a89ff-126">(The owner of a user database also enters the database as the `dbo` user.)</span></span> 
- <span data-ttu-id="a89ff-127">這些帳戶不會輸入 `master` 資料庫做為 `dbo` 使用者，而且具有 master 的有限權限。</span><span class="sxs-lookup"><span data-stu-id="a89ff-127">These accounts do not enter the `master` database as the `dbo` user and they have limited permissions in master.</span></span> 
- <span data-ttu-id="a89ff-128">這些帳戶不是標準 SQL Server `sysadmin` 固定伺服器角色的成員，該角色不適用於 SQL Database。</span><span class="sxs-lookup"><span data-stu-id="a89ff-128">These accounts are not members of the standard SQL Server `sysadmin` fixed server role, which is not available in SQL database.</span></span>  
- <span data-ttu-id="a89ff-129">這些帳戶可以建立、改變和卸除 master 中的資料庫、登入、使用者，以及伺服器層級防火牆規則。</span><span class="sxs-lookup"><span data-stu-id="a89ff-129">These accounts can create, alter, and drop databases, logins, users in master, and server-level firewall rules.</span></span>
- <span data-ttu-id="a89ff-130">這些帳戶可以新增和移除 `dbmanager` 和 `loginmanager` 角色的成員。</span><span class="sxs-lookup"><span data-stu-id="a89ff-130">These accounts can add and remove members to the `dbmanager` and `loginmanager` roles.</span></span>
- <span data-ttu-id="a89ff-131">這些帳戶可以檢視 `sys.sql_logins` 系統資料表。</span><span class="sxs-lookup"><span data-stu-id="a89ff-131">These accounts can view the `sys.sql_logins` system table.</span></span>

### <a name="configuring-the-firewall"></a><span data-ttu-id="a89ff-132">設定防火牆</span><span class="sxs-lookup"><span data-stu-id="a89ff-132">Configuring the firewall</span></span>
<span data-ttu-id="a89ff-133">已設定個別 IP 位址或範圍的伺服器層級防火牆時，**SQL Database 管理員**和 **Azure Active Directory 管理員**可以連接到 master 資料庫和所有使用者資料庫。</span><span class="sxs-lookup"><span data-stu-id="a89ff-133">When the server-level firewall is configured for an individual IP address or range, the **SQL server admin** and the **Azure Active Directory admin** can connect to the master database and all the user databases.</span></span> <span data-ttu-id="a89ff-134">透過 [Azure 入口網站](sql-database-get-started-portal.md) 並使用 [PowerShell](sql-database-get-started-powershell.md) 或使用 [REST API](https://msdn.microsoft.com/library/azure/dn505712.aspx) 即可設定初始伺服器層級防火牆。</span><span class="sxs-lookup"><span data-stu-id="a89ff-134">The initial server-level firewall can be configured through the [Azure portal](sql-database-get-started-portal.md), using [PowerShell](sql-database-get-started-powershell.md) or using the [REST API](https://msdn.microsoft.com/library/azure/dn505712.aspx).</span></span> <span data-ttu-id="a89ff-135">建立連線之後，也可以藉由使用 [Transact-SQL](sql-database-configure-firewall-settings.md) 來設定其他伺服器層級防火牆規則。</span><span class="sxs-lookup"><span data-stu-id="a89ff-135">Once a connection is made, additional server-level firewall rules can also be configured by using [Transact-SQL](sql-database-configure-firewall-settings.md).</span></span>

### <a name="administrator-access-path"></a><span data-ttu-id="a89ff-136">系統管理員存取路徑</span><span class="sxs-lookup"><span data-stu-id="a89ff-136">Administrator access path</span></span>
<span data-ttu-id="a89ff-137">正確設定伺服器層級防火牆後，**SQL Database 管理員**和 **Azure Active Directory 管理員**可以使用用戶端工具 (例如 SQL Server Management Studio 或 SQL Server Data Tools) 進行連接。</span><span class="sxs-lookup"><span data-stu-id="a89ff-137">When the server-level firewall is properly configured, the **SQL server admin** and the **Azure Active Directory admin** can connect using client tools such as SQL Server Management Studio or SQL Server Data Tools.</span></span> <span data-ttu-id="a89ff-138">只有最新的工具會提供所有的功能。</span><span class="sxs-lookup"><span data-stu-id="a89ff-138">Only the latest tools provide all the features and capabilities.</span></span> <span data-ttu-id="a89ff-139">下圖顯示兩個系統管理員帳戶的一般組態。</span><span class="sxs-lookup"><span data-stu-id="a89ff-139">The following diagram shows a typical configuration for the two administrator accounts.</span></span>

![系統管理員存取路徑](./media/sql-database-manage-logins/1sql-db-administrator-access.png)

<span data-ttu-id="a89ff-141">在伺服器層級防火牆中使用開啟的連接埠時，系統管理員可以連接到任何 SQL Database。</span><span class="sxs-lookup"><span data-stu-id="a89ff-141">When using an open port in the server-level firewall, administrators can connect to any SQL Database.</span></span>

### <a name="connecting-to-a-database-by-using-sql-server-management-studio"></a><span data-ttu-id="a89ff-142">使用 SQL Server Management Studio 連接到資料庫</span><span class="sxs-lookup"><span data-stu-id="a89ff-142">Connecting to a database by using SQL Server Management Studio</span></span>
<span data-ttu-id="a89ff-143">如需建立伺服器、資料庫、伺服器層級防火牆規則，以及使用 SQL Server Management Studio 來查詢資料庫的逐步解說，請參閱[透過 Azure 入口網站和 SQL Server Management Studio 來開始使用 Azure SQL Database 伺服器、資料庫和防火牆規則](sql-database-get-started-portal.md)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-143">For a walk-through of creating a server, a database, server-level firewall rules, and using SQL Server Management Studio to query a database, see [Get started with Azure SQL Database servers, databases, and firewall rules by using the Azure portal and SQL Server Management Studio](sql-database-get-started-portal.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a89ff-144">建議您一律使用最新版本的 Management Studio 保持與 Microsoft Azure 及 SQL Database 更新同步。</span><span class="sxs-lookup"><span data-stu-id="a89ff-144">It is recommended that you always use the latest version of Management Studio to remain synchronized with updates to Microsoft Azure and SQL Database.</span></span> <span data-ttu-id="a89ff-145">[更新 SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-145">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>


## <a name="additional-server-level-administrative-roles"></a><span data-ttu-id="a89ff-146">其他伺服器層級系統管理角色</span><span class="sxs-lookup"><span data-stu-id="a89ff-146">Additional server-level administrative roles</span></span>
<span data-ttu-id="a89ff-147">除了先前所討論的伺服器層級系統管理角色以外，SQL Database 還在可新增使用者帳戶的 master 資料庫中提供兩種受限的系統管理角色，以授與建立資料庫或管理登入的權限。</span><span class="sxs-lookup"><span data-stu-id="a89ff-147">In addition to the server-level administrative roles discussed previously, SQL Database provides two restricted administrative roles in the master database to which user accounts can be added that grant permissions to either create databases or manage logins.</span></span>

### <a name="database-creators"></a><span data-ttu-id="a89ff-148">資料庫建立者</span><span class="sxs-lookup"><span data-stu-id="a89ff-148">Database creators</span></span>
<span data-ttu-id="a89ff-149">其中一個系統管理角色是 **dbmanager** 角色。</span><span class="sxs-lookup"><span data-stu-id="a89ff-149">One of these administrative roles is the **dbmanager** role.</span></span> <span data-ttu-id="a89ff-150">此角色的成員可以建立新的資料庫。</span><span class="sxs-lookup"><span data-stu-id="a89ff-150">Members of this role can create new databases.</span></span> <span data-ttu-id="a89ff-151">若要使用此角色，您可在 `master` 資料庫中建立使用者，然後將該使用者新增至 **dbmanager** 資料庫角色。</span><span class="sxs-lookup"><span data-stu-id="a89ff-151">To use this role, you create a user in the `master` database and then add the user to the **dbmanager** database role.</span></span> <span data-ttu-id="a89ff-152">若要建立資料庫，使用者必須是主要資料庫中以 SQL Server 登入為基礎的使用者，或是以 Azure Active Directory 使用者為基礎的容器資料庫使用者。</span><span class="sxs-lookup"><span data-stu-id="a89ff-152">To create a database, the user must be a user based on a SQL Server login in the master database or contained database user based on an Azure Active Directory user.</span></span>

1. <span data-ttu-id="a89ff-153">使用系統管理員帳戶，連接至 master 資料庫。</span><span class="sxs-lookup"><span data-stu-id="a89ff-153">Using an administrator account, connect to the master database.</span></span>
2. <span data-ttu-id="a89ff-154">選擇性步驟︰使用 [CREATE LOGIN](https://msdn.microsoft.com/library/ms189751.aspx) 陳述式來建立 SQL Server 驗證登入。</span><span class="sxs-lookup"><span data-stu-id="a89ff-154">Optional step: Create a SQL Server authentication login, using the [CREATE LOGIN](https://msdn.microsoft.com/library/ms189751.aspx) statement.</span></span> <span data-ttu-id="a89ff-155">範例陳述式︰</span><span class="sxs-lookup"><span data-stu-id="a89ff-155">Sample statement:</span></span>
   
   ```
   CREATE LOGIN Mary WITH PASSWORD = '<strong_password>';
   ```
   
   > [!NOTE]
   > <span data-ttu-id="a89ff-156">建立登入或自主資料庫使用者時，請使用強式密碼。</span><span class="sxs-lookup"><span data-stu-id="a89ff-156">Use a strong password when creating a login or contained database user.</span></span> <span data-ttu-id="a89ff-157">如需詳細資訊，請參閱 [增強式密碼](https://msdn.microsoft.com/library/ms161962.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-157">For more information, see [Strong Passwords](https://msdn.microsoft.com/library/ms161962.aspx).</span></span>
    
   <span data-ttu-id="a89ff-158">為了改進效能，系統會暫時在資料庫層級快取登入 (伺服器層級主體)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-158">To improve performance, logins (server-level principals) are temporarily cached at the database level.</span></span> <span data-ttu-id="a89ff-159">若要重新整理驗證快取，請參閱 [DBCC FLUSHAUTHCACHE](https://msdn.microsoft.com/library/mt627793.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-159">To refresh the authentication cache, see [DBCC FLUSHAUTHCACHE](https://msdn.microsoft.com/library/mt627793.aspx).</span></span>

3. <span data-ttu-id="a89ff-160">在 master 資料庫中，藉由使用 [CREATE USER](https://msdn.microsoft.com/library/ms173463.aspx) 陳述式來建立使用者。</span><span class="sxs-lookup"><span data-stu-id="a89ff-160">In the master database, create a user by using the [CREATE USER](https://msdn.microsoft.com/library/ms173463.aspx) statement.</span></span> <span data-ttu-id="a89ff-161">使用者可以是 Azure Active Directory 驗證自主資料庫使用者 (如果您已針對 Azure AD 驗證設定您的環境)，或 SQL Server 驗證自主資料庫使用者，或根據 SQL Server 驗證登入 (在上一個步驟中建立) 的 SQL Server 驗證使用者。範例陳述式︰</span><span class="sxs-lookup"><span data-stu-id="a89ff-161">The user can be an Azure Active Directory authentication contained database user (if you have configured your environment for Azure AD authentication), or a SQL Server authentication contained database user, or a SQL Server authentication user based on a SQL Server authentication login (created in the previous step.) Sample statements:</span></span>
   
   ```
   CREATE USER [mike@contoso.com] FROM EXTERNAL PROVIDER;
   CREATE USER Tran WITH PASSWORD = '<strong_password>';
   CREATE USER Mary FROM LOGIN Mary; 
   ```

4. <span data-ttu-id="a89ff-162">藉由使用 **ALTER ROLE** 陳述式，將新的使用者新增至 [dbmanager](https://msdn.microsoft.com/library/ms189775.aspx) 資料庫角色。</span><span class="sxs-lookup"><span data-stu-id="a89ff-162">Add the new user, to the **dbmanager** database role by using the [ALTER ROLE](https://msdn.microsoft.com/library/ms189775.aspx) statement.</span></span> <span data-ttu-id="a89ff-163">範例陳述式︰</span><span class="sxs-lookup"><span data-stu-id="a89ff-163">Sample statements:</span></span>
   
   ```
   ALTER ROLE dbmanager ADD MEMBER Mary; 
   ALTER ROLE dbmanager ADD MEMBER [mike@contoso.com];
   ```
   
   > [!NOTE]
   > <span data-ttu-id="a89ff-164">dbmanager 是 master 資料庫中的資料庫角色，因此您只可以將資料庫使用者新增至 dbmanager 角色。</span><span class="sxs-lookup"><span data-stu-id="a89ff-164">The dbmanager is a database role in master database so you can only add a database user to the dbmanager role.</span></span> <span data-ttu-id="a89ff-165">您無法將伺服器層級登入新增至資料庫層級角色。</span><span class="sxs-lookup"><span data-stu-id="a89ff-165">You cannot add a server-level login to database-level role.</span></span>
    
5. <span data-ttu-id="a89ff-166">必要時，設定防火牆規則以允許新使用者連接。</span><span class="sxs-lookup"><span data-stu-id="a89ff-166">If necessary, configure a firewall rule to allow the new user to connect.</span></span> <span data-ttu-id="a89ff-167">(現有的防火牆規則可能會涵蓋新使用者。)</span><span class="sxs-lookup"><span data-stu-id="a89ff-167">(The new user might be covered by an existing firewall rule.)</span></span>

<span data-ttu-id="a89ff-168">現在使用者可以連接至 master 資料庫，而且可以建立新的資料庫。</span><span class="sxs-lookup"><span data-stu-id="a89ff-168">Now the user can connect to the master database and can create new databases.</span></span> <span data-ttu-id="a89ff-169">建立資料庫的帳戶會成為資料庫的擁有者。</span><span class="sxs-lookup"><span data-stu-id="a89ff-169">The account creating the database becomes the owner of the database.</span></span>

### <a name="login-managers"></a><span data-ttu-id="a89ff-170">登入管理員</span><span class="sxs-lookup"><span data-stu-id="a89ff-170">Login managers</span></span>
<span data-ttu-id="a89ff-171">另一個系統管理角色是登入管理員角色。</span><span class="sxs-lookup"><span data-stu-id="a89ff-171">The other administrative role is the login manager role.</span></span> <span data-ttu-id="a89ff-172">此角色的成員可以在 master 資料庫中建立新的登入。</span><span class="sxs-lookup"><span data-stu-id="a89ff-172">Members of this role can create new logins in the master database.</span></span> <span data-ttu-id="a89ff-173">如果您想要的話，可以完成相同的步驟 (建立登入和使用者，並將使用者新增至 **loginmanager** 角色)，讓使用者能夠在 master 資料庫中建立新的登入。</span><span class="sxs-lookup"><span data-stu-id="a89ff-173">If you wish, you can complete the same steps (create a login and user, and add a user to the **loginmanager** role) to enable a user to create new logins in the master.</span></span> <span data-ttu-id="a89ff-174">通常不需要登入，因為 Microsoft 建議使用自主資料庫使用者，這會在資料庫層級進行驗證，而不是根據登入來使用使用者。</span><span class="sxs-lookup"><span data-stu-id="a89ff-174">Usually logins are not necessary as Microsoft recommends using contained database users, which authenticate at the database-level instead of using users based on logins.</span></span> <span data-ttu-id="a89ff-175">如需詳細資訊，請參閱 [自主資料庫使用者 - 讓資料庫具有可攜性](https://msdn.microsoft.com/library/ff929188.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-175">For more information, see [Contained Database Users - Making Your Database Portable](https://msdn.microsoft.com/library/ff929188.aspx).</span></span>

## <a name="non-administrator-users"></a><span data-ttu-id="a89ff-176">非系統管理員的使用者</span><span class="sxs-lookup"><span data-stu-id="a89ff-176">Non-administrator users</span></span>
<span data-ttu-id="a89ff-177">一般而言，非系統管理員帳戶不需要 master 資料庫的存取權。</span><span class="sxs-lookup"><span data-stu-id="a89ff-177">Generally, non-administrator accounts do not need access to the master database.</span></span> <span data-ttu-id="a89ff-178">請使用 [CREATE USER (Transact-SQL)](https://msdn.microsoft.com/library/ms173463.aspx) 陳述式，在資料庫層級建立自主資料庫使用者。</span><span class="sxs-lookup"><span data-stu-id="a89ff-178">Create contained database users at the database level using the [CREATE USER (Transact-SQL)](https://msdn.microsoft.com/library/ms173463.aspx) statement.</span></span> <span data-ttu-id="a89ff-179">使用者可以是 Azure Active Directory 驗證自主資料庫使用者 (如果您已針對 Azure AD 驗證設定您的環境)，或 SQL Server 驗證自主資料庫使用者，或根據 SQL Server 驗證登入 (在上一個步驟中建立) 的 SQL Server 驗證使用者。如需詳細資訊，請參閱 [自主資料庫使用者 - 讓資料庫具有可攜性](https://msdn.microsoft.com/library/ff929188.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-179">The user can be an Azure Active Directory authentication contained database user (if you have configured your environment for Azure AD authentication), or a SQL Server authentication contained database user, or a SQL Server authentication user based on a SQL Server authentication login (created in the previous step.) For more information, see [Contained Database Users - Making Your Database Portable](https://msdn.microsoft.com/library/ff929188.aspx).</span></span> 

<span data-ttu-id="a89ff-180">若要建立使用者，請連線到資料庫，然後執行類似以下範例的陳述式︰</span><span class="sxs-lookup"><span data-stu-id="a89ff-180">To create users, connect to the database, and execute statements similar to the following examples:</span></span>

```
CREATE USER Mary FROM LOGIN Mary; 
CREATE USER [mike@contoso.com] FROM EXTERNAL PROVIDER;
```

<span data-ttu-id="a89ff-181">一開始，只有其中一個系統管理員或資料庫擁有者可以建立使用者。</span><span class="sxs-lookup"><span data-stu-id="a89ff-181">Initially, only one of the administrators or the owner of the database can create users.</span></span> <span data-ttu-id="a89ff-182">若要授權讓其他使用者建立新的使用者，請授與該選取的使用者 `ALTER ANY USER` 權限，例如使用下列陳述式︰</span><span class="sxs-lookup"><span data-stu-id="a89ff-182">To authorize additional users to create new users, grant that selected user the `ALTER ANY USER` permission, by using a statement such as:</span></span>

```
GRANT ALTER ANY USER TO Mary;
```

<span data-ttu-id="a89ff-183">若要將資料庫的完整控制權提供給其他使用者，請使用 `ALTER ROLE` 陳述式，讓他們成為 **db_owner** 固定資料庫角色的成員。</span><span class="sxs-lookup"><span data-stu-id="a89ff-183">To give additional users full control of the database, make them a member of the **db_owner** fixed database role using the `ALTER ROLE` statement.</span></span>

> [!NOTE]
> <span data-ttu-id="a89ff-184">要根據登入建立資料庫使用者的最常見原因，是為了應付有 SQL Server 驗證使用者需要存取多個資料庫的情況。</span><span class="sxs-lookup"><span data-stu-id="a89ff-184">The most common reason to create database users based on logins, is when you have SQL Server authentication users that need access to multiple databases.</span></span> <span data-ttu-id="a89ff-185">根據登入的使用者會繫結至登入，只會針對該登入維護一個密碼。</span><span class="sxs-lookup"><span data-stu-id="a89ff-185">Users based on logins are tied to the login, and only one password that is maintained for that login.</span></span> <span data-ttu-id="a89ff-186">在個別資料庫中的自主資料庫使用者是個別的實體，而且各個都會維護它自己的密碼。</span><span class="sxs-lookup"><span data-stu-id="a89ff-186">Contained database users in individual databases are each individual entities and each maintains its own password.</span></span> <span data-ttu-id="a89ff-187">如果它們不會維護各自的密碼相同，會造成自主資料庫使用者的混淆。</span><span class="sxs-lookup"><span data-stu-id="a89ff-187">This can confuse contained database users if they do not maintain their passwords as identical.</span></span>

### <a name="configuring-the-database-level-firewall"></a><span data-ttu-id="a89ff-188">設定資料庫層級防火牆規則</span><span class="sxs-lookup"><span data-stu-id="a89ff-188">Configuring the database-level firewall</span></span>
<span data-ttu-id="a89ff-189">最佳做法是，非系統管理員的使用者應該只能透過防火牆來存取所使用的資料庫。</span><span class="sxs-lookup"><span data-stu-id="a89ff-189">As a best practice, non-administrator users should only have access through the firewall to the databases that they use.</span></span> <span data-ttu-id="a89ff-190">做法是不透過伺服器層級防火牆授權其 IP 位址來讓他們存取所有資料庫，而是改用 [sp_set_database_firewall_rule](https://msdn.microsoft.com/library/dn270010.aspx) 陳述式來設定資料庫層級防火牆。</span><span class="sxs-lookup"><span data-stu-id="a89ff-190">Instead of authorizing their IP addresses through the server-level firewall and giving them access to all databases, use the [sp_set_database_firewall_rule](https://msdn.microsoft.com/library/dn270010.aspx) statement to configure the database-level firewall.</span></span> <span data-ttu-id="a89ff-191">無法藉由使用入口網站設定資料庫層級防火牆。</span><span class="sxs-lookup"><span data-stu-id="a89ff-191">The database-level firewall cannot be configured by using the portal.</span></span>

### <a name="non-administrator-access-path"></a><span data-ttu-id="a89ff-192">非系統管理員存取路徑</span><span class="sxs-lookup"><span data-stu-id="a89ff-192">Non-administrator access path</span></span>
<span data-ttu-id="a89ff-193">當資料庫層級防火牆設定正確時，資料庫使用者可以使用如 SQL Server Management Studio 或 SQL Server Data Tools 之類的用戶端工具來連接。</span><span class="sxs-lookup"><span data-stu-id="a89ff-193">When the database-level firewall is properly configured, the database users can connect using client tools such as SQL Server Management Studio or SQL Server Data Tools.</span></span> <span data-ttu-id="a89ff-194">只有最新的工具會提供所有的功能。</span><span class="sxs-lookup"><span data-stu-id="a89ff-194">Only the latest tools provide all the features and capabilities.</span></span> <span data-ttu-id="a89ff-195">下圖顯示一個典型的非系統管理員存取途徑。</span><span class="sxs-lookup"><span data-stu-id="a89ff-195">The following diagram shows a typical non-administrator access path.</span></span>

![非系統管理員存取路徑](./media/sql-database-manage-logins/2sql-db-nonadmin-access.png)

## <a name="groups-and-roles"></a><span data-ttu-id="a89ff-197">群組和角色</span><span class="sxs-lookup"><span data-stu-id="a89ff-197">Groups and roles</span></span>
<span data-ttu-id="a89ff-198">有效率存取管理會使用指派給群組和角色的權限，而不是指派給個別使用者的權限。</span><span class="sxs-lookup"><span data-stu-id="a89ff-198">Efficient access management uses permissions assigned to groups and roles instead of individual users.</span></span> 

- <span data-ttu-id="a89ff-199">使用 Azure Active Directory 驗證時，將 Azure Active Directory 使用者放入 Azure Active Directory 群組中。</span><span class="sxs-lookup"><span data-stu-id="a89ff-199">When using Azure Active Directory authentication, put Azure Active Directory users into an Azure Active Directory group.</span></span> <span data-ttu-id="a89ff-200">建立群組的自主資料庫使用者。</span><span class="sxs-lookup"><span data-stu-id="a89ff-200">Create a contained database user for the group.</span></span> <span data-ttu-id="a89ff-201">將一或多個資料庫使用者放入[資料庫角色](https://msdn.microsoft.com/library/ms189121)中，然後將[權限](https://msdn.microsoft.com/library/ms191291.aspx)指派給資料庫角色。</span><span class="sxs-lookup"><span data-stu-id="a89ff-201">Place one or more database users into a [database role](https://msdn.microsoft.com/library/ms189121) and then assign [permissions](https://msdn.microsoft.com/library/ms191291.aspx) to the database role.</span></span>

- <span data-ttu-id="a89ff-202">使用 SQL Server 驗證時，在資料庫中建立自主資料庫使用者。</span><span class="sxs-lookup"><span data-stu-id="a89ff-202">When using SQL Server authentication, create contained database users in the database.</span></span> <span data-ttu-id="a89ff-203">將一或多個資料庫使用者放入[資料庫角色](https://msdn.microsoft.com/library/ms189121)中，然後將[權限](https://msdn.microsoft.com/library/ms191291.aspx)指派給資料庫角色。</span><span class="sxs-lookup"><span data-stu-id="a89ff-203">Place one or more database users into a [database role](https://msdn.microsoft.com/library/ms189121) and then assign [permissions](https://msdn.microsoft.com/library/ms191291.aspx) to the database role.</span></span>

<span data-ttu-id="a89ff-204">資料庫角色可以是內建的角色，例如 **db_owner**、**db_ddladmin**、**db_datawriter**、**db_datareader**、**db_denydatawriter** 和 **db_denydatareader**。</span><span class="sxs-lookup"><span data-stu-id="a89ff-204">The database roles can be the built-in roles such as **db_owner**, **db_ddladmin**, **db_datawriter**, **db_datareader**, **db_denydatawriter**, and **db_denydatareader**.</span></span> <span data-ttu-id="a89ff-205">**db_owner** 通常是用來將完整權限授與少數幾個使用者。</span><span class="sxs-lookup"><span data-stu-id="a89ff-205">**db_owner** is commonly used to grant full permission to only a few users.</span></span> <span data-ttu-id="a89ff-206">其他固定的資料庫角色適用於快速開發簡單的資料庫，但不建議用於大多數實際執行資料庫。</span><span class="sxs-lookup"><span data-stu-id="a89ff-206">The other fixed database roles are useful for getting a simple database in development quickly, but are not recommended for most production databases.</span></span> <span data-ttu-id="a89ff-207">例如，**db_datareader** 固定資料庫角色可授與資料庫中每個資料表的讀取存取權，這通常並非絕對必要。</span><span class="sxs-lookup"><span data-stu-id="a89ff-207">For example, the **db_datareader** fixed database role grants read access to every table in the database, which is usually more than is strictly necessary.</span></span> <span data-ttu-id="a89ff-208">最好是使用 [CREATE ROLE](https://msdn.microsoft.com/library/ms187936.aspx) 陳述式來建立您自己的使用者定義資料庫角色，並謹慎地授與每個角色在業務需求上所需的最小權限。</span><span class="sxs-lookup"><span data-stu-id="a89ff-208">It is far better to use the [CREATE ROLE](https://msdn.microsoft.com/library/ms187936.aspx) statement to create your own user-defined database roles and carefully grant each role the least permissions necessary for the business need.</span></span> <span data-ttu-id="a89ff-209">當使用者是多個角色的成員時，會集所有這些角色的權限在一身。</span><span class="sxs-lookup"><span data-stu-id="a89ff-209">When a user is a member of multiple roles, they aggregate the permissions of them all.</span></span>

## <a name="permissions"></a><span data-ttu-id="a89ff-210">權限</span><span class="sxs-lookup"><span data-stu-id="a89ff-210">Permissions</span></span>
<span data-ttu-id="a89ff-211">有超過 100 個權限可在 SQL Database 中分別授與或拒絕。</span><span class="sxs-lookup"><span data-stu-id="a89ff-211">There are over 100 permissions that can be individually granted or denied in SQL Database.</span></span> <span data-ttu-id="a89ff-212">這些權限有許多為巢狀。</span><span class="sxs-lookup"><span data-stu-id="a89ff-212">Many of these permissions are nested.</span></span> <span data-ttu-id="a89ff-213">例如，結構描述上的 `UPDATE` 權限包括該結構描述中每個資料表的 `UPDATE` 權限。</span><span class="sxs-lookup"><span data-stu-id="a89ff-213">For example, the `UPDATE` permission on a schema includes the `UPDATE` permission on each table within that schema.</span></span> <span data-ttu-id="a89ff-214">如同大多數的權限系統，拒絕權限會覆寫授與權限。</span><span class="sxs-lookup"><span data-stu-id="a89ff-214">As in most permission systems, the denial of a permission overrides a grant.</span></span> <span data-ttu-id="a89ff-215">因為權限的巢狀本質和數目，可能需要仔細研究，設計適當的權限系統以便適當地保護您的資料庫。</span><span class="sxs-lookup"><span data-stu-id="a89ff-215">Because of the nested nature and the number of permissions, it can take careful study to design an appropriate permission system to properly protect your database.</span></span> <span data-ttu-id="a89ff-216">請從[權限 (Database Engine)](https://msdn.microsoft.com/library/ms191291.aspx) 的權限清單開始著手，然後檢閱[海報大小的權限圖](http://go.microsoft.com/fwlink/?LinkId=229142)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-216">Start with the list of permissions at [Permissions (Database Engine)](https://msdn.microsoft.com/library/ms191291.aspx) and review the [poster size graphic](http://go.microsoft.com/fwlink/?LinkId=229142) of the permissions.</span></span>


### <a name="considerations-and-restrictions"></a><span data-ttu-id="a89ff-217">考量和限制</span><span class="sxs-lookup"><span data-stu-id="a89ff-217">Considerations and restrictions</span></span>
<span data-ttu-id="a89ff-218">在 SQL Database 中管理登入和使用者時，請考慮下列各項︰</span><span class="sxs-lookup"><span data-stu-id="a89ff-218">When managing logins and users in SQL Database, consider the following:</span></span>

* <span data-ttu-id="a89ff-219">執行 `CREATE/ALTER/DROP DATABASE` 陳述式時，您必須連接到 **master** 資料庫。</span><span class="sxs-lookup"><span data-stu-id="a89ff-219">You must be connected to the **master** database when executing the `CREATE/ALTER/DROP DATABASE` statements.</span></span>   
* <span data-ttu-id="a89ff-220">無法更改或刪除與**伺服器管理員**登入對應的資料庫使用者。</span><span class="sxs-lookup"><span data-stu-id="a89ff-220">The database user corresponding to the **Server admin** login cannot be altered or dropped.</span></span> 
* <span data-ttu-id="a89ff-221">英文 (美國) 是**伺服器管理員**登入的預設語言。</span><span class="sxs-lookup"><span data-stu-id="a89ff-221">US-English is the default language of the **Server admin** login.</span></span>
* <span data-ttu-id="a89ff-222">只有系統管理員 (**伺服器管理員**登入或 Azure AD 系統管理員) 及 **master** 資料庫中 **dbmanager** 資料庫角色的成員，才具備執行 `CREATE DATABASE` 和 `DROP DATABASE` 陳述式的權限。</span><span class="sxs-lookup"><span data-stu-id="a89ff-222">Only the administrators (**Server admin** login or Azure AD administrator) and the members of the **dbmanager** database role in the **master** database have permission to execute the `CREATE DATABASE` and `DROP DATABASE` statements.</span></span>
* <span data-ttu-id="a89ff-223">執行 `CREATE/ALTER/DROP LOGIN` 陳述式時，您必須連接到 master 資料庫。</span><span class="sxs-lookup"><span data-stu-id="a89ff-223">You must be connected to the master database when executing the `CREATE/ALTER/DROP LOGIN` statements.</span></span> <span data-ttu-id="a89ff-224">不過，不建議使用登入。</span><span class="sxs-lookup"><span data-stu-id="a89ff-224">However using logins is discouraged.</span></span> <span data-ttu-id="a89ff-225">請改為使用自主資料庫使用者。</span><span class="sxs-lookup"><span data-stu-id="a89ff-225">Use contained database users instead.</span></span>
* <span data-ttu-id="a89ff-226">若要連接到使用者資料庫，您必須在連接字串中提供資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="a89ff-226">To connect to a user database, you must provide the name of the database in the connection string.</span></span>
* <span data-ttu-id="a89ff-227">只有伺服器層級的主體登入及 **master** 資料庫中 **loginmanager** 資料庫角色的成員，才具備執行 `CREATE LOGIN`、`ALTER LOGIN` 及 `DROP LOGIN` 陳述式的權限。</span><span class="sxs-lookup"><span data-stu-id="a89ff-227">Only the server-level principal login and the members of the **loginmanager** database role in the **master** database have permission to execute the `CREATE LOGIN`, `ALTER LOGIN`, and `DROP LOGIN` statements.</span></span>
* <span data-ttu-id="a89ff-228">在 ADO.NET 應用程式中執行 `CREATE/ALTER/DROP LOGIN` 和 `CREATE/ALTER/DROP DATABASE` 陳述式時，不允許使用參數化的命令。</span><span class="sxs-lookup"><span data-stu-id="a89ff-228">When executing the `CREATE/ALTER/DROP LOGIN` and `CREATE/ALTER/DROP DATABASE` statements in an ADO.NET application, using parameterized commands is not allowed.</span></span> <span data-ttu-id="a89ff-229">如需詳細資訊，請參閱 [命令和參數](https://msdn.microsoft.com/library/ms254953.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-229">For more information, see [Commands and Parameters](https://msdn.microsoft.com/library/ms254953.aspx).</span></span>
* <span data-ttu-id="a89ff-230">執行 `CREATE/ALTER/DROP DATABASE` 和 `CREATE/ALTER/DROP LOGIN` 陳述式時，這其中每一個陳述式在 Transact-SQL 批次中都必須是唯一的陳述式。</span><span class="sxs-lookup"><span data-stu-id="a89ff-230">When executing the `CREATE/ALTER/DROP DATABASE` and `CREATE/ALTER/DROP LOGIN` statements, each of these statements must be the only statement in a Transact-SQL batch.</span></span> <span data-ttu-id="a89ff-231">否則便會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="a89ff-231">Otherwise, an error occurs.</span></span> <span data-ttu-id="a89ff-232">例如，下列 Transact-SQL 會檢查資料庫是否存在。</span><span class="sxs-lookup"><span data-stu-id="a89ff-232">For example, the following Transact-SQL checks whether the database exists.</span></span> <span data-ttu-id="a89ff-233">如果資料庫存在，則會呼叫 `DROP DATABASE` 陳述式來移除資料庫。</span><span class="sxs-lookup"><span data-stu-id="a89ff-233">If it exists, a `DROP DATABASE` statement is called to remove the database.</span></span> <span data-ttu-id="a89ff-234">因為 `DROP DATABASE` 陳述式不是批次中唯一的陳述式，所以執行下列 Transact-SQL 陳述式時會產生錯誤。</span><span class="sxs-lookup"><span data-stu-id="a89ff-234">Because the `DROP DATABASE` statement is not the only statement in the batch, executing the following Transact-SQL statement results in an error.</span></span>

  ```
  IF EXISTS (SELECT [name]
           FROM   [sys].[databases]
           WHERE  [name] = N'database_name')
  DROP DATABASE [database_name];
  GO
  ```

* <span data-ttu-id="a89ff-235">搭配執行 `CREATE USER` 陳述式和 `FOR/FROM LOGIN` 選項時，它必須是 Transact-SQL 批次中唯一的陳述式。</span><span class="sxs-lookup"><span data-stu-id="a89ff-235">When executing the `CREATE USER` statement with the `FOR/FROM LOGIN` option, it must be the only statement in a Transact-SQL batch.</span></span>
* <span data-ttu-id="a89ff-236">搭配執行 `ALTER USER` 陳述式和 `WITH LOGIN` 選項時，它必須是 Transact-SQL 批次中唯一的陳述式。</span><span class="sxs-lookup"><span data-stu-id="a89ff-236">When executing the `ALTER USER` statement with the `WITH LOGIN` option, it must be the only statement in a Transact-SQL batch.</span></span>
* <span data-ttu-id="a89ff-237">若要 `CREATE/ALTER/DROP`，使用者必須擁有資料庫的 `ALTER ANY USER` 權限。</span><span class="sxs-lookup"><span data-stu-id="a89ff-237">To `CREATE/ALTER/DROP` a user requires the `ALTER ANY USER` permission on the database.</span></span>
* <span data-ttu-id="a89ff-238">當資料庫角色的擁有者嘗試對該資料庫角色新增或移除另一個資料庫使用者時，可能會發生下列錯誤：**使用者或角色 'Name' 並不存在於此資料庫中。**</span><span class="sxs-lookup"><span data-stu-id="a89ff-238">When the owner of a database role tries to add or remove another database user to or from that database role, the following error may occur: **User or role 'Name' does not exist in this database.**</span></span> <span data-ttu-id="a89ff-239">因為擁有者看不到使用者，所以會發生此錯誤。</span><span class="sxs-lookup"><span data-stu-id="a89ff-239">This error occurs because the user is not visible to the owner.</span></span> <span data-ttu-id="a89ff-240">若要解決這個問題，請為角色擁有者授與使用者的 `VIEW DEFINITION` 權限。</span><span class="sxs-lookup"><span data-stu-id="a89ff-240">To resolve this issue, grant the role owner the `VIEW DEFINITION` permission on the user.</span></span> 


## <a name="next-steps"></a><span data-ttu-id="a89ff-241">後續步驟</span><span class="sxs-lookup"><span data-stu-id="a89ff-241">Next steps</span></span>

- <span data-ttu-id="a89ff-242">若要深入了解防火牆規則，請參閱 [Azure SQL Database 防火牆](sql-database-firewall-configure.md)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-242">To learn more about firewall rules, see [Azure SQL Database Firewall](sql-database-firewall-configure.md).</span></span>
- <span data-ttu-id="a89ff-243">如需所有 SQL Database 安全性功能的概觀，請參閱 [SQL 安全性概觀](sql-database-security-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-243">For an overview of all the SQL Database security features, see [SQL security overview](sql-database-security-overview.md).</span></span>
- <span data-ttu-id="a89ff-244">如需教學課程，請參閱[保護 Azure SQL Database](sql-database-security-tutorial.md)。</span><span class="sxs-lookup"><span data-stu-id="a89ff-244">For a tutorial, see [Secure your Azure SQL Database](sql-database-security-tutorial.md).</span></span>
- <span data-ttu-id="a89ff-245">如需檢視和預存程序的相關資訊，請參閱[建立檢視和預存程序](https://msdn.microsoft.com/library/ms365311.aspx)</span><span class="sxs-lookup"><span data-stu-id="a89ff-245">For information about views and stored procedures, see [Creating views and stored procedures](https://msdn.microsoft.com/library/ms365311.aspx)</span></span>
- <span data-ttu-id="a89ff-246">如需授與資料庫物件存取權的相關資訊，請參閱[授與資料庫物件的存取權](https://msdn.microsoft.com/library/ms365327.aspx)</span><span class="sxs-lookup"><span data-stu-id="a89ff-246">For information about granting access to a database object, see [Granting Access to a Database Object](https://msdn.microsoft.com/library/ms365327.aspx)</span></span>
