---
title: "aaaAzure SQL Database 彈性的查詢概觀 |Microsoft 文件"
description: "Hello 彈性查詢功能的概觀"
services: sql-database
documentationcenter: 
manager: jhubbard
author: MladjoA
ms.assetid: a8bf0e2c-bc74-44d0-9b1e-bcc9a6aa2e33
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/27/2016
ms.author: mlandzic
ms.openlocfilehash: db17f551882cfcae0da67fdda12708baeb6db81c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="azure-sql-database-elastic-query-overview-preview"></a><span data-ttu-id="6a630-103">Azure SQL Database 彈性查詢概觀 (預覽)</span><span class="sxs-lookup"><span data-stu-id="6a630-103">Azure SQL Database elastic query overview (preview)</span></span>
<span data-ttu-id="6a630-104">hello 彈性的查詢功能 （處於預覽階段） 可讓您 toorun 跨越多個資料庫中 Azure SQL Database TRANSACT-SQL 查詢。</span><span class="sxs-lookup"><span data-stu-id="6a630-104">hello elastic query feature (in preview) enables you toorun a Transact-SQL query that spans multiple databases in Azure SQL Database.</span></span> <span data-ttu-id="6a630-105">可讓您 tooperform 跨資料庫查詢 tooaccess 遠端資料表，以及 tooconnect Microsoft 和協力廠商工具 （Excel、 power Bi、 Tableau 等） tooquery 到具有多個資料庫的資料層。</span><span class="sxs-lookup"><span data-stu-id="6a630-105">It allows you tooperform cross-database queries tooaccess remote tables, and tooconnect Microsoft and third party tools (Excel, PowerBI, Tableau, etc.) tooquery across data tiers with multiple databases.</span></span> <span data-ttu-id="6a630-106">使用這項功能，您可以擴充 SQL Database 中的查詢 toolarge 資料層，並將商業智慧 (BI) 報表中的 hello 結果視覺化。</span><span class="sxs-lookup"><span data-stu-id="6a630-106">Using this feature, you can scale out queries toolarge data tiers in SQL Database and visualize hello results in business intelligence (BI) reports.</span></span>


## <a name="why-use-elastic-queries"></a><span data-ttu-id="6a630-107">為何使用彈性的查詢？</span><span class="sxs-lookup"><span data-stu-id="6a630-107">Why use elastic queries?</span></span>

<span data-ttu-id="6a630-108">**Azure SQL Database**</span><span class="sxs-lookup"><span data-stu-id="6a630-108">**Azure SQL Database**</span></span>

<span data-ttu-id="6a630-109">完全在 T-SQL 中跨 Azure SQL Database 執行查詢。</span><span class="sxs-lookup"><span data-stu-id="6a630-109">Query across Azure SQL databases completely in T-SQL.</span></span> <span data-ttu-id="6a630-110">如此即可進行遠端資料庫的唯讀查詢。</span><span class="sxs-lookup"><span data-stu-id="6a630-110">This allows for read-only querying of remote databases.</span></span> <span data-ttu-id="6a630-111">這可讓目前內部部署選擇使用三和四部分名稱或連結的伺服器 tooSQL DB 的 SQL Server 客戶 toomigrate 應用程式。</span><span class="sxs-lookup"><span data-stu-id="6a630-111">This provides an option for current on-premises SQL Server customers toomigrate applications using three- and four-part names or linked server tooSQL DB.</span></span>

<span data-ttu-id="6a630-112">**適用於標準層**</span><span class="sxs-lookup"><span data-stu-id="6a630-112">**Available on standard tier**</span></span>

<span data-ttu-id="6a630-113">加法 toohello 高階效能層中的 hello 標準效能層上支援彈性查詢。</span><span class="sxs-lookup"><span data-stu-id="6a630-113">Elastic query is supported on hello Standard performance tier in addition toohello Premium performance tier.</span></span> <span data-ttu-id="6a630-114">參閱 hello 下方的預覽限制在較低效能層級的效能限制。</span><span class="sxs-lookup"><span data-stu-id="6a630-114">See hello section on Preview Limitations below on performance limitations for lower performance tiers.</span></span>

<span data-ttu-id="6a630-115">**推入 tooremote 資料庫**</span><span class="sxs-lookup"><span data-stu-id="6a630-115">**Push tooremote databases**</span></span>

<span data-ttu-id="6a630-116">彈性查詢現在可以推送執行的 SQL 參數 toohello 遠端資料庫。</span><span class="sxs-lookup"><span data-stu-id="6a630-116">Elastic queries can now push SQL parameters toohello remote databases for execution.</span></span>

<span data-ttu-id="6a630-117">**預存程序執行**</span><span class="sxs-lookup"><span data-stu-id="6a630-117">**Stored procedure execution**</span></span>

<span data-ttu-id="6a630-118">使用 [sp\_execute \_remote](https://msdn.microsoft.com/library/mt703714) 執行遠端預存程序呼叫或遠端函式。</span><span class="sxs-lookup"><span data-stu-id="6a630-118">Execute remote stored procedure calls or remote functions using [sp\_execute \_remote](https://msdn.microsoft.com/library/mt703714).</span></span>

<span data-ttu-id="6a630-119">**彈性**</span><span class="sxs-lookup"><span data-stu-id="6a630-119">**Flexibility**</span></span>

<span data-ttu-id="6a630-120">外部資料表，其中彈性查詢現在可以參考以不同的結構描述或資料表名稱 tooremote 資料表。</span><span class="sxs-lookup"><span data-stu-id="6a630-120">External tables with elastic query can now refer tooremote tables with a different schema or table name.</span></span>

## <a name="elastic-query-scenarios"></a><span data-ttu-id="6a630-121">彈性查詢案例</span><span class="sxs-lookup"><span data-stu-id="6a630-121">Elastic query scenarios</span></span>

<span data-ttu-id="6a630-122">hello 目標是 toofacilitate 查詢其中的多個資料庫參與成單一的整體結果的資料列的案例。</span><span class="sxs-lookup"><span data-stu-id="6a630-122">hello goal is toofacilitate querying scenarios where multiple databases contribute rows into a single overall result.</span></span> <span data-ttu-id="6a630-123">hello 查詢是由 hello 使用者或應用程式直接或間接透過工具已連接的 toohello 資料庫。</span><span class="sxs-lookup"><span data-stu-id="6a630-123">hello query can either be composed by hello user or application directly, or indirectly through tools that are connected toohello database.</span></span> <span data-ttu-id="6a630-124">使用商業 BI 或資料整合工具 (或無法變更的任何應用程式) 建立報告時，這特別有用。</span><span class="sxs-lookup"><span data-stu-id="6a630-124">This is especially useful when creating reports, using commercial BI or data integration tools—or any application that cannot be changed.</span></span> <span data-ttu-id="6a630-125">使用彈性的查詢，您可以查詢跨多個資料庫使用中工具，例如 Excel、 power Bi、 Tableau 或 Cognos hello 熟悉 SQL Server 的連線體驗。</span><span class="sxs-lookup"><span data-stu-id="6a630-125">With an elastic query, you can query across several databases using hello familiar SQL Server connectivity experience in tools such as Excel, PowerBI, Tableau, or Cognos.</span></span>
<span data-ttu-id="6a630-126">彈性的查詢可讓您輕鬆存取 tooan 整個資料庫集合透過 SQL Server Management Studio 或 Visual Studio 中，所發出的查詢，並加速跨資料庫查詢從 Entity Framework 或其他 ORM 環境。</span><span class="sxs-lookup"><span data-stu-id="6a630-126">An elastic query allows easy access tooan entire collection of databases through queries issued by SQL Server Management Studio or Visual Studio, and facilitates cross-database querying from Entity Framework or other ORM environments.</span></span> <span data-ttu-id="6a630-127">圖 1 顯示的案例，其中的現有雲端應用程式 (使用 hello[彈性資料庫用戶端程式庫](sql-database-elastic-database-client-library.md)) 組建的向外延展資料層，然後彈性的查詢用來跨資料庫報告。</span><span class="sxs-lookup"><span data-stu-id="6a630-127">Figure 1 shows a scenario where an existing cloud application (which uses hello [elastic database client library](sql-database-elastic-database-client-library.md)) builds on a scaled-out data tier, and an elastic query is used for cross-database reporting.</span></span>

<span data-ttu-id="6a630-128">**圖 1** 相應放大的資料層上使用的彈性查詢</span><span class="sxs-lookup"><span data-stu-id="6a630-128">**Figure 1** Elastic query used on scaled-out data tier</span></span>

![相應放大的資料層上使用的彈性查詢][1]

<span data-ttu-id="6a630-130">彈性查詢的客戶案例的下列拓撲 hello 其特性：</span><span class="sxs-lookup"><span data-stu-id="6a630-130">Customer scenarios for elastic query are characterized by hello following topologies:</span></span>

* <span data-ttu-id="6a630-131">**垂直資料分割-跨資料庫查詢**(拓撲 1): hello 資料會垂直分割的資料層中的資料庫數目之間。</span><span class="sxs-lookup"><span data-stu-id="6a630-131">**Vertical partitioning - Cross-database queries** (Topology 1): hello data is partitioned vertically between a number of databases in a data tier.</span></span> <span data-ttu-id="6a630-132">一般而言，不同的資料表集位於不同的資料庫。</span><span class="sxs-lookup"><span data-stu-id="6a630-132">Typically, different sets of tables reside on different databases.</span></span> <span data-ttu-id="6a630-133">這表示該 hello 結構描述是在不同的資料庫不同。</span><span class="sxs-lookup"><span data-stu-id="6a630-133">That means that hello schema is different on different databases.</span></span> <span data-ttu-id="6a630-134">比方說，庫存的所有資料表都位於一個資料庫上，而所有會計相關資料表則位於另一個資料庫上。</span><span class="sxs-lookup"><span data-stu-id="6a630-134">For instance, all tables for inventory are on one database while all accounting-related tables are on a second database.</span></span> <span data-ttu-id="6a630-135">利用此拓撲的常見使用案例需要一個跨 tooquery 或 toocompile 報表跨越多個資料庫中的資料表。</span><span class="sxs-lookup"><span data-stu-id="6a630-135">Common use cases with this topology require one tooquery across or toocompile reports across tables in several databases.</span></span>
* <span data-ttu-id="6a630-136">**水平資料分割-分區化**(拓撲 2): 資料水平分割層 toodistribute 在向外延展資料的資料列。</span><span class="sxs-lookup"><span data-stu-id="6a630-136">**Horizontal Partitioning - Sharding** (Topology 2): Data is partitioned horizontally toodistribute rows across a scaled out data tier.</span></span> <span data-ttu-id="6a630-137">使用這個方法，hello 結構描述等同上所有參與的資料庫。</span><span class="sxs-lookup"><span data-stu-id="6a630-137">With this approach, hello schema is identical on all participating databases.</span></span> <span data-ttu-id="6a630-138">這個方法也稱為「分區化」。</span><span class="sxs-lookup"><span data-stu-id="6a630-138">This approach is also called “sharding”.</span></span> <span data-ttu-id="6a630-139">分區化可執行，並使用 （1) hello 彈性資料庫工具程式庫或 （2） 自行區分化管理。</span><span class="sxs-lookup"><span data-stu-id="6a630-139">Sharding can be performed and managed using (1) hello elastic database tools libraries or (2) self-sharding.</span></span> <span data-ttu-id="6a630-140">彈性的查詢會是跨多個分區使用的 tooquery 或編譯的報表。</span><span class="sxs-lookup"><span data-stu-id="6a630-140">An elastic query is used tooquery or compile reports across many shards.</span></span>

> [!NOTE]
> <span data-ttu-id="6a630-141">彈性查詢是最適合偶爾 reporting 位置在大部分的 hello 處理 hello 資料層上執行。</span><span class="sxs-lookup"><span data-stu-id="6a630-141">Elastic query works best for occasional reporting scenarios where most of hello processing can be performed on hello data tier.</span></span> <span data-ttu-id="6a630-142">對於繁重的報告工作負載或有更多複雜查詢的資料倉儲案例，也請考慮使用 [Azure SQL 資料倉儲](https://azure.microsoft.com/services/sql-data-warehouse/)。</span><span class="sxs-lookup"><span data-stu-id="6a630-142">For heavy reporting workloads or data warehousing scenarios with more complex queries, also consider using [Azure SQL Data Warehouse](https://azure.microsoft.com/services/sql-data-warehouse/).</span></span>
>  

## <a name="vertical-partitioning---cross-database-queries"></a><span data-ttu-id="6a630-143">垂直資料分割 - 跨資料庫查詢</span><span class="sxs-lookup"><span data-stu-id="6a630-143">Vertical partitioning - cross-database queries</span></span>

<span data-ttu-id="6a630-144">toobegin 撰寫程式碼，請參閱[入門 （垂直資料分割） 的跨資料庫查詢](sql-database-elastic-query-getting-started-vertical.md)。</span><span class="sxs-lookup"><span data-stu-id="6a630-144">toobegin coding, see [Getting started with cross-database query (vertical partitioning)](sql-database-elastic-query-getting-started-vertical.md).</span></span>

<span data-ttu-id="6a630-145">彈性的查詢可以是使用的 toomake 資料位於 SQL database 提供 tooother SQL 資料庫。</span><span class="sxs-lookup"><span data-stu-id="6a630-145">An elastic query can be used toomake data located in a SQL database available tooother SQL databases.</span></span> <span data-ttu-id="6a630-146">這可以讓任何其他遠端的 SQL 資料庫從一個資料庫 toorefer tootables 的查詢。</span><span class="sxs-lookup"><span data-stu-id="6a630-146">This allows queries from one database toorefer tootables in any other remote SQL database.</span></span> <span data-ttu-id="6a630-147">hello 第一個步驟是 toodefine 每個遠端資料庫的外部資料來源。</span><span class="sxs-lookup"><span data-stu-id="6a630-147">hello first step is toodefine an external data source for each remote database.</span></span> <span data-ttu-id="6a630-148">hello 外部資料來源被定義在 hello 要從中 toogain 存取 tootables hello 遠端資料庫上的本機資料庫。</span><span class="sxs-lookup"><span data-stu-id="6a630-148">hello external data source is defined in hello local database from which you want toogain access tootables located on hello remote database.</span></span> <span data-ttu-id="6a630-149">不不需要在 hello 遠端資料庫上的任何變更。</span><span class="sxs-lookup"><span data-stu-id="6a630-149">No changes are necessary on hello remote database.</span></span> <span data-ttu-id="6a630-150">垂直資料分割的典型案例，不同的資料庫具有不同結構描述，彈性查詢可以使用的 tooimplement 常見使用案例，例如存取 tooreference 資料，而且跨資料庫查詢。</span><span class="sxs-lookup"><span data-stu-id="6a630-150">For typical vertical partitioning scenarios where different databases have different schemas, elastic queries can be used tooimplement common use cases such as access tooreference data and cross-database querying.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6a630-151">您必須具備 ALTER ANY EXTERNAL DATA SOURCE 權限。</span><span class="sxs-lookup"><span data-stu-id="6a630-151">You must possess ALTER ANY EXTERNAL DATA SOURCE permission.</span></span> <span data-ttu-id="6a630-152">此權限會包含 hello ALTER DATABASE 權限。</span><span class="sxs-lookup"><span data-stu-id="6a630-152">This permission is included with hello ALTER DATABASE permission.</span></span> <span data-ttu-id="6a630-153">ALTER ANY EXTERNAL DATA SOURCE 權限是必要的 toorefer toohello 基礎資料來源。</span><span class="sxs-lookup"><span data-stu-id="6a630-153">ALTER ANY EXTERNAL DATA SOURCE permissions are needed toorefer toohello underlying data source.</span></span>
>

<span data-ttu-id="6a630-154">**參考資料**: hello 拓撲用於參考資料管理。</span><span class="sxs-lookup"><span data-stu-id="6a630-154">**Reference data**: hello topology is used for reference data management.</span></span> <span data-ttu-id="6a630-155">Hello 在圖中，與參考資料的兩個資料表 （T1 和 T2） 會保留在專用的資料庫。</span><span class="sxs-lookup"><span data-stu-id="6a630-155">In hello figure below, two tables (T1 and T2) with reference data are kept on a dedicated database.</span></span> <span data-ttu-id="6a630-156">使用彈性的查詢，您現在可以存取資料表 T1 和 T2 從遠端與其他資料庫，hello 圖所示。</span><span class="sxs-lookup"><span data-stu-id="6a630-156">Using an elastic query, you can now access tables T1 and T2 remotely from other databases, as shown in hello figure.</span></span> <span data-ttu-id="6a630-157">如果參考資料表很小或參考資料表的遠端查詢有選擇性述詞，則使用拓撲 1。</span><span class="sxs-lookup"><span data-stu-id="6a630-157">Use topology 1 if reference tables are small or remote queries into reference table have selective predicates.</span></span>

<span data-ttu-id="6a630-158">**圖 2**垂直資料分割-使用彈性查詢 tooquery 參考資料</span><span class="sxs-lookup"><span data-stu-id="6a630-158">**Figure 2** Vertical partitioning - Using elastic query tooquery reference data</span></span>

![垂直資料分割-使用彈性查詢 tooquery 參考資料][3]

<span data-ttu-id="6a630-160">**跨資料庫查詢**：彈性查詢可促成需要跨多個 SQL Database 進行查詢的使用案例。</span><span class="sxs-lookup"><span data-stu-id="6a630-160">**Cross-database querying**: Elastic queries enable use cases that require querying across several SQL databases.</span></span> <span data-ttu-id="6a630-161">圖 3 顯示四個不同的資料庫：CRM、庫存、HR 和產品。</span><span class="sxs-lookup"><span data-stu-id="6a630-161">Figure 3 shows four different databases: CRM, Inventory, HR and Products.</span></span> <span data-ttu-id="6a630-162">其中一個 hello 資料庫中執行的查詢也需要存取 tooone 或所有 hello 其他資料庫。</span><span class="sxs-lookup"><span data-stu-id="6a630-162">Queries performed in one of hello databases also need access tooone or all hello other databases.</span></span> <span data-ttu-id="6a630-163">使用彈性的查詢，您可以設定此情況下您的資料庫上的每個 hello 四個資料庫執行幾個簡單的 DDL 陳述式。</span><span class="sxs-lookup"><span data-stu-id="6a630-163">Using an elastic query, you can configure your database for this case by running a few simple DDL statements on each of hello four databases.</span></span> <span data-ttu-id="6a630-164">這個單次設定之後，存取 tooa 遠端資料表的很簡單，參照 tooa 本機資料表，從您的 T-SQL 查詢，或從您的 BI 工具。</span><span class="sxs-lookup"><span data-stu-id="6a630-164">After this one-time configuration, access tooa remote table is as simple as referring tooa local table from your T-SQL queries or from your BI tools.</span></span> <span data-ttu-id="6a630-165">如果 hello 遠端查詢不會傳回較大的結果，建議使用這種方法。</span><span class="sxs-lookup"><span data-stu-id="6a630-165">This approach is recommended if hello remote queries do not return large results.</span></span>

<span data-ttu-id="6a630-166">**圖 3**垂直資料分割-跨不同資料庫使用彈性查詢 tooquery</span><span class="sxs-lookup"><span data-stu-id="6a630-166">**Figure 3** Vertical partitioning - Using elastic query tooquery across various databases</span></span>

![垂直資料分割-跨不同資料庫使用彈性查詢 tooquery][4]

<span data-ttu-id="6a630-168">hello 下列步驟設定為需要存取 tooa 資料表位於遠端的 SQL 資料庫，以 hello 相同的垂直資料分割案例的彈性資料庫查詢結構描述：</span><span class="sxs-lookup"><span data-stu-id="6a630-168">hello following steps configure elastic database queries for vertical partitioning scenarios that require access tooa table located on remote SQL databases with hello same schema:</span></span>

* <span data-ttu-id="6a630-169">[CREATE MASTER KEY](https://msdn.microsoft.com/library/ms174382.aspx) mymasterkey</span><span class="sxs-lookup"><span data-stu-id="6a630-169">[CREATE MASTER KEY](https://msdn.microsoft.com/library/ms174382.aspx) mymasterkey</span></span>
* <span data-ttu-id="6a630-170">[CREATE DATABASE SCOPED CREDENTIAL](https://msdn.microsoft.com/library/mt270260.aspx) mycredential</span><span class="sxs-lookup"><span data-stu-id="6a630-170">[CREATE DATABASE SCOPED CREDENTIAL](https://msdn.microsoft.com/library/mt270260.aspx) mycredential</span></span>
* <span data-ttu-id="6a630-171">[CREATE/DROP EXTERNAL DATA SOURCE](https://msdn.microsoft.com/library/dn935022.aspx) mydatasource (類型為 **RDBMS**</span><span class="sxs-lookup"><span data-stu-id="6a630-171">[CREATE/DROP EXTERNAL DATA SOURCE](https://msdn.microsoft.com/library/dn935022.aspx) mydatasource of type **RDBMS**</span></span>
* <span data-ttu-id="6a630-172">[CREATE/DROP EXTERNAL TABLE](https://msdn.microsoft.com/library/dn935021.aspx) mytable</span><span class="sxs-lookup"><span data-stu-id="6a630-172">[CREATE/DROP EXTERNAL TABLE](https://msdn.microsoft.com/library/dn935021.aspx) mytable</span></span>

<span data-ttu-id="6a630-173">執行之後 hello DDL 陳述式，您可以存取遠端資料表"mytable"hello，就好像是本機資料表。</span><span class="sxs-lookup"><span data-stu-id="6a630-173">After running hello DDL statements, you can access hello remote table “mytable” as though it were a local table.</span></span> <span data-ttu-id="6a630-174">Azure SQL Database 會自動開啟連線 toohello 遠端資料庫、 處理您的要求上 hello 遠端資料庫，並傳回 hello 的結果。</span><span class="sxs-lookup"><span data-stu-id="6a630-174">Azure SQL Database automatically opens a connection toohello remote database, processes your request on hello remote database, and returns hello results.</span></span>

## <a name="horizontal-partitioning---sharding"></a><span data-ttu-id="6a630-175">水平資料分割 - 分區化</span><span class="sxs-lookup"><span data-stu-id="6a630-175">Horizontal partitioning - sharding</span></span>
<span data-ttu-id="6a630-176">使用彈性查詢 tooperform 報告工作透過分區化，也就是，以水平方式分割，資料層需要[彈性資料庫分區對應](sql-database-elastic-scale-shard-map-management.md)toorepresent hello 資料庫 hello 資料層。</span><span class="sxs-lookup"><span data-stu-id="6a630-176">Using elastic query tooperform reporting tasks over a sharded, i.e., horizontally partitioned, data tier requires an [elastic database shard map](sql-database-elastic-scale-shard-map-management.md) toorepresent hello databases of hello data tier .</span></span> <span data-ttu-id="6a630-177">一般而言，只有單一分區對應用在此案例中，並具有彈性的查詢功能 （前端節點） 的專用的資料庫做為報告查詢 hello 進入點。</span><span class="sxs-lookup"><span data-stu-id="6a630-177">Typically, only a single shard map is used in this scenario and a dedicated database with elastic query capabilities (head node) serves as hello entry point for reporting queries.</span></span> <span data-ttu-id="6a630-178">此專用的資料庫需要存取 toohello 分區對應。</span><span class="sxs-lookup"><span data-stu-id="6a630-178">Only this dedicated database needs access toohello shard map.</span></span> <span data-ttu-id="6a630-179">圖 4 說明此拓撲和 hello 彈性查詢的資料庫和分區對應具有其組態。</span><span class="sxs-lookup"><span data-stu-id="6a630-179">Figure 4 illustrates this topology and its configuration with hello elastic query database and shard map.</span></span> <span data-ttu-id="6a630-180">hello 資料層中的 hello 資料庫可以是任何 Azure SQL Database 版本或版別。</span><span class="sxs-lookup"><span data-stu-id="6a630-180">hello databases in hello data tier can be of any Azure SQL Database version or edition.</span></span> <span data-ttu-id="6a630-181">如需 hello 彈性資料庫用戶端程式庫和建立分區對應的詳細資訊，請參閱[分區對應管理](sql-database-elastic-scale-shard-map-management.md)。</span><span class="sxs-lookup"><span data-stu-id="6a630-181">For more information about hello elastic database client library and creating shard maps, see [Shard map management](sql-database-elastic-scale-shard-map-management.md).</span></span>

<span data-ttu-id="6a630-182">**圖 4** 水平資料分割 - 使用彈性查詢來報告分區化資料層</span><span class="sxs-lookup"><span data-stu-id="6a630-182">**Figure 4** Horizontal partitioning - Using elastic query for reporting over sharded data tiers</span></span>

![水平資料分割 - 使用彈性查詢來報告分區化資料層][5]

> [!NOTE]
> <span data-ttu-id="6a630-184">彈性查詢資料庫 （前端節點） 可以是另一個資料庫，或者它可以是 hello 相同資料庫主機 hello 分區對應。</span><span class="sxs-lookup"><span data-stu-id="6a630-184">Elastic Query Database (head node) can be separate database, or it can be hello same database that hosts hello shard map.</span></span> <span data-ttu-id="6a630-185">任何設定的選擇，請確定該資料庫的服務和效能層是夠高 toohandle hello 預期的登入/查詢要求。</span><span class="sxs-lookup"><span data-stu-id="6a630-185">Whatever configuration you choose, make sure that service and performance tier of that database is high enough toohandle hello expected  amount of login/query requests.</span></span>

<span data-ttu-id="6a630-186">hello 下列步驟設定水平資料分割需要的案例資料表的存取 tooa 集位於的彈性資料庫查詢 （通常） 多個遠端 SQL 資料庫：</span><span class="sxs-lookup"><span data-stu-id="6a630-186">hello following steps configure elastic database queries for horizontal partitioning scenarios that require access tooa set of table that are located on (typically) several remote SQL databases:</span></span>

* <span data-ttu-id="6a630-187">[CREATE MASTER KEY](https://msdn.microsoft.com/library/ms174382.aspx) mymasterkey</span><span class="sxs-lookup"><span data-stu-id="6a630-187">[CREATE MASTER KEY](https://msdn.microsoft.com/library/ms174382.aspx) mymasterkey</span></span>
* <span data-ttu-id="6a630-188">[CREATE DATABASE SCOPED CREDENTIAL](https://msdn.microsoft.com/library/mt270260.aspx) mycredential</span><span class="sxs-lookup"><span data-stu-id="6a630-188">[CREATE DATABASE SCOPED CREDENTIAL](https://msdn.microsoft.com/library/mt270260.aspx) mycredential</span></span>
* <span data-ttu-id="6a630-189">建立[分區對應](sql-database-elastic-scale-shard-map-management.md)代表您的資料層使用 hello 彈性資料庫用戶端程式庫。</span><span class="sxs-lookup"><span data-stu-id="6a630-189">Create a [shard map](sql-database-elastic-scale-shard-map-management.md) representing your data tier using hello elastic database client library.</span></span>   
* <span data-ttu-id="6a630-190">[CREATE/DROP EXTERNAL DATA SOURCE](https://msdn.microsoft.com/library/dn935022.aspx) mydatasource (類型為 **SHARD_MAP_MANAGER**)</span><span class="sxs-lookup"><span data-stu-id="6a630-190">[CREATE/DROP EXTERNAL DATA SOURCE](https://msdn.microsoft.com/library/dn935022.aspx) mydatasource of type **SHARD_MAP_MANAGER**</span></span>
* <span data-ttu-id="6a630-191">[CREATE/DROP EXTERNAL TABLE](https://msdn.microsoft.com/library/dn935021.aspx) mytable</span><span class="sxs-lookup"><span data-stu-id="6a630-191">[CREATE/DROP EXTERNAL TABLE](https://msdn.microsoft.com/library/dn935021.aspx) mytable</span></span>

<span data-ttu-id="6a630-192">一旦您已經執行下列步驟，您就可以存取 hello 水平資料分割的資料表"mytable"，就好像是本機資料表。</span><span class="sxs-lookup"><span data-stu-id="6a630-192">Once you have performed these steps, you can access hello horizontally partitioned table “mytable” as though it were a local table.</span></span> <span data-ttu-id="6a630-193">Azure SQL Database 會自動開啟多個平行連接 toohello 遠端資料庫 hello 資料表實體上的儲存位置、 處理 hello 要求在 hello 遠端資料庫，並傳回 hello 結果。</span><span class="sxs-lookup"><span data-stu-id="6a630-193">Azure SQL Database automatically opens multiple parallel connections toohello remote databases where hello tables are physically stored, processes hello requests on hello remote databases, and returns hello results.</span></span>
<span data-ttu-id="6a630-194">Hello hello 水平資料分割案例可以在中找到所需的步驟的詳細資訊[水平資料分割的彈性查詢](sql-database-elastic-query-horizontal-partitioning.md)。</span><span class="sxs-lookup"><span data-stu-id="6a630-194">More information on hello steps required for hello horizontal partitioning scenario can be found in [elastic query for horizontal partitioning](sql-database-elastic-query-horizontal-partitioning.md).</span></span>

<span data-ttu-id="6a630-195">toobegin 撰寫程式碼，請參閱[入門水平資料分割 （分區化） 的彈性查詢](sql-database-elastic-query-getting-started.md)。</span><span class="sxs-lookup"><span data-stu-id="6a630-195">toobegin coding, see [Getting started with elastic query for horizontal partitioning (sharding)](sql-database-elastic-query-getting-started.md).</span></span>

## <a name="t-sql-querying"></a><span data-ttu-id="6a630-196">T-SQL 查詢</span><span class="sxs-lookup"><span data-stu-id="6a630-196">T-SQL querying</span></span>
<span data-ttu-id="6a630-197">一旦您已經定義外部資料來源和外部資料表，您可以使用一般 SQL Server 連接字串 tooconnect toohello 資料庫定義外部資料表的位置。</span><span class="sxs-lookup"><span data-stu-id="6a630-197">Once you have defined your external data sources and your external tables, you can use regular SQL Server connection strings tooconnect toohello databases where you defined your external tables.</span></span> <span data-ttu-id="6a630-198">您可以再執行 T-SQL 陳述式透過外部資料表在該連接上有 hello 限制如下所述。</span><span class="sxs-lookup"><span data-stu-id="6a630-198">You can then run T-SQL statements over your external tables on that connection with hello limitations outlined below.</span></span> <span data-ttu-id="6a630-199">您可以在 hello 文件集主題中找到詳細資訊和範例的 T-SQL 查詢[水平資料分割](sql-database-elastic-query-horizontal-partitioning.md)和[垂直資料分割](sql-database-elastic-query-vertical-partitioning.md)。</span><span class="sxs-lookup"><span data-stu-id="6a630-199">You can find more information and examples of T-SQL queries in hello documentation topics for [horizontal partitioning](sql-database-elastic-query-horizontal-partitioning.md) and [vertical partitioning](sql-database-elastic-query-vertical-partitioning.md).</span></span>

## <a name="connectivity-for-tools"></a><span data-ttu-id="6a630-200">工具的連線能力</span><span class="sxs-lookup"><span data-stu-id="6a630-200">Connectivity for tools</span></span>
<span data-ttu-id="6a630-201">您可以使用一般 SQL Server 連接字串 tooconnect 應用程式和 BI 或資料的整合工具 toodatabases 具有外部資料表。</span><span class="sxs-lookup"><span data-stu-id="6a630-201">You can use regular SQL Server connection strings tooconnect your applications and BI or data integration tools toodatabases that have external tables.</span></span> <span data-ttu-id="6a630-202">請確定 SQL Server 可支援做為您的工具的資料來源。</span><span class="sxs-lookup"><span data-stu-id="6a630-202">Make sure that SQL Server is supported as a data source for your tool.</span></span> <span data-ttu-id="6a630-203">一旦連接之後，請參閱 toohello 彈性查詢資料庫與 hello 外部資料表中該資料庫，就像您會執行任何其他 SQL Server 資料庫與您連接 toowith 工具。</span><span class="sxs-lookup"><span data-stu-id="6a630-203">Once connected, refer toohello elastic query database and hello external tables in that database just like you would do with any other SQL Server database that you connect toowith your tool.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6a630-204">目前不支援使用 Azure Active Directory 與彈性查詢進行驗證。</span><span class="sxs-lookup"><span data-stu-id="6a630-204">Authentication using Azure Active Directory with elastic queries is not currently supported.</span></span>
> 
> 

## <a name="cost"></a><span data-ttu-id="6a630-205">成本</span><span class="sxs-lookup"><span data-stu-id="6a630-205">Cost</span></span>
<span data-ttu-id="6a630-206">彈性查詢包含在 hello 成本的 Azure SQL Database 的資料庫。</span><span class="sxs-lookup"><span data-stu-id="6a630-206">Elastic query is included into hello cost of Azure SQL Database databases.</span></span> <span data-ttu-id="6a630-207">請注意，支援您的遠端資料庫的不同資料中心內比 hello 彈性查詢端點的拓撲，但從遠端資料庫的資料輸出會收費 regular [Azure 率](https://azure.microsoft.com/pricing/details/data-transfers/)。</span><span class="sxs-lookup"><span data-stu-id="6a630-207">Note that topologies where your remote databases are in a different data center than hello elastic query endpoint are supported, but data egress from remote databases are charged regular [Azure rates](https://azure.microsoft.com/pricing/details/data-transfers/).</span></span>

## <a name="preview-limitations"></a><span data-ttu-id="6a630-208">預覽限制</span><span class="sxs-lookup"><span data-stu-id="6a630-208">Preview limitations</span></span>
* <span data-ttu-id="6a630-209">執行第一個彈性查詢最多可能需要 tooa hello 標準效能層上幾分鐘的時間。</span><span class="sxs-lookup"><span data-stu-id="6a630-209">Running your first elastic query can take up tooa few minutes on hello Standard performance tier.</span></span> <span data-ttu-id="6a630-210">這次是必要的 tooload hello 彈性查詢功能。載入效能改善以較高的效能層。</span><span class="sxs-lookup"><span data-stu-id="6a630-210">This time is necessary tooload hello elastic query functionality; loading performance improves with higher performance tiers.</span></span>
* <span data-ttu-id="6a630-211">尚未支援來自 SSMS 或 SSDT 的外部資料來源或外部資料表的指令碼。</span><span class="sxs-lookup"><span data-stu-id="6a630-211">Scripting of external data sources or external tables from SSMS or SSDT is not yet supported.</span></span>
* <span data-ttu-id="6a630-212">SQL DB 匯入/匯出還不支援外部資料來源和外部資料表。</span><span class="sxs-lookup"><span data-stu-id="6a630-212">Import/Export for SQL DB does not yet support external data sources and external tables.</span></span> <span data-ttu-id="6a630-213">如果您需要 toouse 匯入/匯出，匯出之前先卸除這些物件，然後匯入之後重新建立它們。</span><span class="sxs-lookup"><span data-stu-id="6a630-213">If you need toouse Import/Export, drop these objects before exporting and then re-create them after importing.</span></span>
* <span data-ttu-id="6a630-214">彈性查詢時，目前僅支援唯讀存取 tooexternal 資料表。</span><span class="sxs-lookup"><span data-stu-id="6a630-214">Elastic query currently only supports read-only access tooexternal tables.</span></span> <span data-ttu-id="6a630-215">您可以不過，完整的 T-SQL 功能資料庫上使用 hello hello 外部資料表定義的位置。</span><span class="sxs-lookup"><span data-stu-id="6a630-215">You can, however, use full T-SQL functionality on hello database where hello external table is defined.</span></span> <span data-ttu-id="6a630-216">這可以是到，例如保存的暫存結果使用，例如，選取 < column_list > 到 < local_table >，或 toodefine hello 彈性查詢資料庫，而是會參照 tooexternal 資料表上預存程序很有用。</span><span class="sxs-lookup"><span data-stu-id="6a630-216">This can be useful to, e.g., persist temporary results using, e.g., SELECT <column_list> INTO <local_table>, or toodefine stored procedures on hello elastic query database which refer tooexternal tables.</span></span>
* <span data-ttu-id="6a630-217">除了 nvarchar (max) 以外，外部資料表定義不支援 LOB 類型。</span><span class="sxs-lookup"><span data-stu-id="6a630-217">Except for nvarchar(max), LOB types are not supported in external table definitions.</span></span> <span data-ttu-id="6a630-218">因應措施，您可以建立 hello 會轉換為 nvarchar （max） hello LOB 類型的遠端資料庫的檢視、 hello 檢視，而非 hello 基底資料表上定義外部資料表並再將它轉換回原始 LOB 類型 hello 在查詢中。</span><span class="sxs-lookup"><span data-stu-id="6a630-218">As a workaround, you can create a view on hello remote database that casts hello LOB type into nvarchar(max), define your external table over hello view instead of hello base table and then cast it back into hello original LOB type in your queries.</span></span>
* <span data-ttu-id="6a630-219">目前不支援外部資料表的資料行統計資料。</span><span class="sxs-lookup"><span data-stu-id="6a630-219">Column statistics over external tables are currently not supported.</span></span> <span data-ttu-id="6a630-220">資料表統計資料支援，但是需要手動建立 toobe。</span><span class="sxs-lookup"><span data-stu-id="6a630-220">Tables statistics are supported, but need toobe created manually.</span></span>

## <a name="feedback"></a><span data-ttu-id="6a630-221">意見反應</span><span class="sxs-lookup"><span data-stu-id="6a630-221">Feedback</span></span>
<span data-ttu-id="6a630-222">請您的體驗的意見反應與彈性查詢和我們分享 Disqus 下列 hello MSDN 論壇，或在 Stackoverflow 上。</span><span class="sxs-lookup"><span data-stu-id="6a630-222">Please share feedback on your experience with elastic queries with us on Disqus below, hello MSDN forums, or on Stackoverflow.</span></span> <span data-ttu-id="6a630-223">我們有興趣所有種類的 hello 服務缺失、 見諒 （功能間距） 相關的意見反應。</span><span class="sxs-lookup"><span data-stu-id="6a630-223">We are interested in all kinds of feedback about hello service (defects, rough edges, feature gaps).</span></span>

## <a name="next-steps"></a><span data-ttu-id="6a630-224">後續步驟</span><span class="sxs-lookup"><span data-stu-id="6a630-224">Next steps</span></span>

* <span data-ttu-id="6a630-225">若要開始撰寫程式碼，請參閱 [開始使用跨資料庫查詢 (垂直資料分割)](sql-database-elastic-query-getting-started-vertical.md)。</span><span class="sxs-lookup"><span data-stu-id="6a630-225">For a vertical partitioning tutorial, see [Getting started with cross-database query (vertical partitioning)](sql-database-elastic-query-getting-started-vertical.md).</span></span>
* <span data-ttu-id="6a630-226">如需垂直資料分割之資料的語法和範例查詢，請參閱[查詢垂直資料分割的資料](sql-database-elastic-query-vertical-partitioning.md)</span><span class="sxs-lookup"><span data-stu-id="6a630-226">For syntax and sample queries for vertically partitioned data, see [Querying vertically partitioned data)](sql-database-elastic-query-vertical-partitioning.md)</span></span>
* <span data-ttu-id="6a630-227">如需水平資料分割 (分區化) 教學課程，請參閱[開始使用彈性查詢進行水平資料分割 (分區化)](sql-database-elastic-query-getting-started.md)。</span><span class="sxs-lookup"><span data-stu-id="6a630-227">For a horizontal partitioning (sharding) tutorial, see [Getting started with elastic query for horizontal partitioning (sharding)](sql-database-elastic-query-getting-started.md).</span></span>
* <span data-ttu-id="6a630-228">如需水平資料分割之資料的語法和範例查詢，請參閱[查詢水平資料分割的資料](sql-database-elastic-query-horizontal-partitioning.md)</span><span class="sxs-lookup"><span data-stu-id="6a630-228">For syntax and sample queries for horizontally partitioned data, see [Querying horizontally partitioned data)](sql-database-elastic-query-horizontal-partitioning.md)</span></span>
* <span data-ttu-id="6a630-229">如需會在單一遠端 Azure SQL Database 或一組在水平資料分割配置中作為分區之資料庫上執行 Transact-SQL 陳述式的預存程序，請參閱 [sp\_execute \_remote](https://msdn.microsoft.com/library/mt703714)。</span><span class="sxs-lookup"><span data-stu-id="6a630-229">See [sp\_execute \_remote](https://msdn.microsoft.com/library/mt703714) for a stored procedure that executes a Transact-SQL statement on a single remote Azure SQL Database or set of databases serving as shards in a horizontal partitioning scheme.</span></span>

<!--Image references-->
[1]: ./media/sql-database-elastic-query-overview/overview.png
[2]: ./media/sql-database-elastic-query-overview/topology1.png
[3]: ./media/sql-database-elastic-query-overview/vertpartrrefdata.png
[4]: ./media/sql-database-elastic-query-overview/verticalpartitioning.png
[5]: ./media/sql-database-elastic-query-overview/horizontalpartitioning.png

<!--anchors-->
