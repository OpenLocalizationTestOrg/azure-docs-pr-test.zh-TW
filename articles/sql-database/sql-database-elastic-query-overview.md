---
title: "Azure SQL Database 彈性查詢概觀 | Microsoft Docs"
description: "彈性查詢功能的概觀"
services: sql-database
documentationcenter: 
manager: jhubbard
author: MladjoA
ms.assetid: a8bf0e2c-bc74-44d0-9b1e-bcc9a6aa2e33
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/27/2016
ms.author: mlandzic
ms.openlocfilehash: 9b3151248a1d036117bbdc9af03a98dff71ca535
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/18/2017
---
# <a name="azure-sql-database-elastic-query-overview-preview"></a><span data-ttu-id="f2fe0-103">Azure SQL Database 彈性查詢概觀 (預覽)</span><span class="sxs-lookup"><span data-stu-id="f2fe0-103">Azure SQL Database elastic query overview (preview)</span></span>
<span data-ttu-id="f2fe0-104">彈性查詢功能 (預覽) 可讓您在 Azure SQL Database 中執行跨多個資料庫的 Transact-SQL 查詢。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-104">The elastic query feature (in preview) enables you to run a Transact-SQL query that spans multiple databases in Azure SQL Database.</span></span> <span data-ttu-id="f2fe0-105">它可讓您執行跨資料庫查詢以存取遠端資料表，以及將 Microsoft 和協力廠商工具 (Excel、PowerBI、Tableau 等) 連接到具有多個資料庫的資料層。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-105">It allows you to perform cross-database queries to access remote tables, and to connect Microsoft and third party tools (Excel, PowerBI, Tableau, etc.) to query across data tiers with multiple databases.</span></span> <span data-ttu-id="f2fe0-106">這項功能可讓您將查詢相應放大到 SQL Database 中的大型資料層，並將結果透過商務智慧 (BI) 報告視覺化。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-106">Using this feature, you can scale out queries to large data tiers in SQL Database and visualize the results in business intelligence (BI) reports.</span></span>


## <a name="why-use-elastic-queries"></a><span data-ttu-id="f2fe0-107">為何使用彈性的查詢？</span><span class="sxs-lookup"><span data-stu-id="f2fe0-107">Why use elastic queries?</span></span>

<span data-ttu-id="f2fe0-108">**Azure SQL Database**</span><span class="sxs-lookup"><span data-stu-id="f2fe0-108">**Azure SQL Database**</span></span>

<span data-ttu-id="f2fe0-109">完全在 T-SQL 中跨 Azure SQL Database 執行查詢。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-109">Query across Azure SQL databases completely in T-SQL.</span></span> <span data-ttu-id="f2fe0-110">如此即可進行遠端資料庫的唯讀查詢。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-110">This allows for read-only querying of remote databases.</span></span> <span data-ttu-id="f2fe0-111">目前內部部署 SQL Server 客戶可選擇使用三和四部分的名稱或 SQL DB 的連結伺服器來移轉應用程式。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-111">This provides an option for current on-premises SQL Server customers to migrate applications using three- and four-part names or linked server to SQL DB.</span></span>

<span data-ttu-id="f2fe0-112">**適用於標準層**</span><span class="sxs-lookup"><span data-stu-id="f2fe0-112">**Available on standard tier**</span></span>

<span data-ttu-id="f2fe0-113">除了「進階」效能層級以外，「標準」效能層級也支援彈性查詢。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-113">Elastic query is supported on the Standard performance tier in addition to the Premium performance tier.</span></span> <span data-ttu-id="f2fe0-114">請參閱下面「預覽限制」一節中較低效能層級的效能限制。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-114">See the section on Preview Limitations below on performance limitations for lower performance tiers.</span></span>

<span data-ttu-id="f2fe0-115">**推送到遠端資料庫**</span><span class="sxs-lookup"><span data-stu-id="f2fe0-115">**Push to remote databases**</span></span>

<span data-ttu-id="f2fe0-116">彈性查詢現在可以將 SQL 參數發送至遠端資料庫以供執行。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-116">Elastic queries can now push SQL parameters to the remote databases for execution.</span></span>

<span data-ttu-id="f2fe0-117">**預存程序執行**</span><span class="sxs-lookup"><span data-stu-id="f2fe0-117">**Stored procedure execution**</span></span>

<span data-ttu-id="f2fe0-118">使用 [sp\_execute \_remote](https://msdn.microsoft.com/library/mt703714) 執行遠端預存程序呼叫或遠端函式。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-118">Execute remote stored procedure calls or remote functions using [sp\_execute \_remote](https://msdn.microsoft.com/library/mt703714).</span></span>

<span data-ttu-id="f2fe0-119">**彈性**</span><span class="sxs-lookup"><span data-stu-id="f2fe0-119">**Flexibility**</span></span>

<span data-ttu-id="f2fe0-120">具有彈性查詢的外部資料表現在可以參考具有不同結構描述或資料表名稱的遠端資料表。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-120">External tables with elastic query can now refer to remote tables with a different schema or table name.</span></span>

## <a name="elastic-query-scenarios"></a><span data-ttu-id="f2fe0-121">彈性查詢案例</span><span class="sxs-lookup"><span data-stu-id="f2fe0-121">Elastic query scenarios</span></span>

<span data-ttu-id="f2fe0-122">目標是協助查詢案例便利進行，其中由多個資料庫提供資料列給單一整體結果。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-122">The goal is to facilitate querying scenarios where multiple databases contribute rows into a single overall result.</span></span> <span data-ttu-id="f2fe0-123">查詢可以由使用者或應用程式直接撰寫，或透過連接到資料庫的工具來間接撰寫。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-123">The query can either be composed by the user or application directly, or indirectly through tools that are connected to the database.</span></span> <span data-ttu-id="f2fe0-124">使用商業 BI 或資料整合工具 (或無法變更的任何應用程式) 建立報告時，這特別有用。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-124">This is especially useful when creating reports, using commercial BI or data integration tools—or any application that cannot be changed.</span></span> <span data-ttu-id="f2fe0-125">透過彈性查詢，您可以在 Excel、PowerBI、Tableau 或 Cognos 等工具中使用熟悉的 SQL Server 連線體驗，進而查詢多個資料庫。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-125">With an elastic query, you can query across several databases using the familiar SQL Server connectivity experience in tools such as Excel, PowerBI, Tableau, or Cognos.</span></span>
<span data-ttu-id="f2fe0-126">彈性查詢可讓您透過 SQL Server Management Studio 或 Visual Studio 所發出的查詢，輕鬆存取整個資料庫集合，並協助更方便從 Entity Framework 或其他 ORM 環境執行跨資料庫查詢。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-126">An elastic query allows easy access to an entire collection of databases through queries issued by SQL Server Management Studio or Visual Studio, and facilitates cross-database querying from Entity Framework or other ORM environments.</span></span> <span data-ttu-id="f2fe0-127">圖 1 顯示的案例中，現有的雲端應用程式 (使用 [彈性資料庫用戶端程式庫](sql-database-elastic-database-client-library.md)) 根據相應放大的資料層建置，而彈性查詢用於跨資料庫報告。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-127">Figure 1 shows a scenario where an existing cloud application (which uses the [elastic database client library](sql-database-elastic-database-client-library.md)) builds on a scaled-out data tier, and an elastic query is used for cross-database reporting.</span></span>

<span data-ttu-id="f2fe0-128">**圖 1** 相應放大的資料層上使用的彈性查詢</span><span class="sxs-lookup"><span data-stu-id="f2fe0-128">**Figure 1** Elastic query used on scaled-out data tier</span></span>

![相應放大的資料層上使用的彈性查詢][1]

<span data-ttu-id="f2fe0-130">彈性查詢的客戶案例可依下列拓撲區分特性：</span><span class="sxs-lookup"><span data-stu-id="f2fe0-130">Customer scenarios for elastic query are characterized by the following topologies:</span></span>

* <span data-ttu-id="f2fe0-131">**垂直資料分割 - 跨資料庫查詢** (拓撲 1)：資料會在資料層中的幾個資料庫之間以垂直方式分割。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-131">**Vertical partitioning - Cross-database queries** (Topology 1): The data is partitioned vertically between a number of databases in a data tier.</span></span> <span data-ttu-id="f2fe0-132">一般而言，不同的資料表集位於不同的資料庫。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-132">Typically, different sets of tables reside on different databases.</span></span> <span data-ttu-id="f2fe0-133">這表示不同資料庫的結構描述不同。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-133">That means that the schema is different on different databases.</span></span> <span data-ttu-id="f2fe0-134">比方說，庫存的所有資料表都位於一個資料庫上，而所有會計相關資料表則位於另一個資料庫上。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-134">For instance, all tables for inventory are on one database while all accounting-related tables are on a second database.</span></span> <span data-ttu-id="f2fe0-135">此拓撲的常見使用案例會要求使用者跨多個資料庫中的資料表進行查詢或編譯報表。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-135">Common use cases with this topology require one to query across or to compile reports across tables in several databases.</span></span>
* <span data-ttu-id="f2fe0-136">**水平資料分割 - 分區化** (拓撲 2)：資料會以水平方式分割，以將資料列分散在相應放大的資料層中。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-136">**Horizontal Partitioning - Sharding** (Topology 2): Data is partitioned horizontally to distribute rows across a scaled out data tier.</span></span> <span data-ttu-id="f2fe0-137">使用此方法時，所有參與資料庫的結構描述都相同。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-137">With this approach, the schema is identical on all participating databases.</span></span> <span data-ttu-id="f2fe0-138">這個方法也稱為「分區化」。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-138">This approach is also called “sharding”.</span></span> <span data-ttu-id="f2fe0-139">使用 (1) 彈性資料庫工具程式庫或 (2) 自行分區化可以執行和管理分區化。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-139">Sharding can be performed and managed using (1) the elastic database tools libraries or (2) self-sharding.</span></span> <span data-ttu-id="f2fe0-140">彈性查詢用於查詢或編譯跨多個分區的報表。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-140">An elastic query is used to query or compile reports across many shards.</span></span>

> [!NOTE]
> <span data-ttu-id="f2fe0-141">彈性查詢最適合可在資料層執行大部分處理的非經常性報告案例。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-141">Elastic query works best for occasional reporting scenarios where most of the processing can be performed on the data tier.</span></span> <span data-ttu-id="f2fe0-142">對於繁重的報告工作負載或有更多複雜查詢的資料倉儲案例，也請考慮使用 [Azure SQL 資料倉儲](https://azure.microsoft.com/services/sql-data-warehouse/)。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-142">For heavy reporting workloads or data warehousing scenarios with more complex queries, also consider using [Azure SQL Data Warehouse](https://azure.microsoft.com/services/sql-data-warehouse/).</span></span>
>  

## <a name="vertical-partitioning---cross-database-queries"></a><span data-ttu-id="f2fe0-143">垂直資料分割 - 跨資料庫查詢</span><span class="sxs-lookup"><span data-stu-id="f2fe0-143">Vertical partitioning - cross-database queries</span></span>

<span data-ttu-id="f2fe0-144">若要開始撰寫程式碼，請參閱 [開始使用跨資料庫查詢 (垂直資料分割)](sql-database-elastic-query-getting-started-vertical.md)。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-144">To begin coding, see [Getting started with cross-database query (vertical partitioning)](sql-database-elastic-query-getting-started-vertical.md).</span></span>

<span data-ttu-id="f2fe0-145">彈性查詢可用來讓位於某個 SQL Database 中的資料可供其他 SQL Database 使用。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-145">An elastic query can be used to make data located in a SQL database available to other SQL databases.</span></span> <span data-ttu-id="f2fe0-146">這可讓來自一個資料庫的查詢參考任何其他遠端 SQL Database 中的資料表。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-146">This allows queries from one database to refer to tables in any other remote SQL database.</span></span> <span data-ttu-id="f2fe0-147">第一個步驟是定義每個遠端資料庫的外部資料來源。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-147">The first step is to define an external data source for each remote database.</span></span> <span data-ttu-id="f2fe0-148">外部資料來源已定義於本機資料庫中，您想要從中取得遠端資料庫上資料表的存取權。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-148">The external data source is defined in the local database from which you want to gain access to tables located on the remote database.</span></span> <span data-ttu-id="f2fe0-149">遠端資料庫不需要進行任何變更。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-149">No changes are necessary on the remote database.</span></span> <span data-ttu-id="f2fe0-150">在不同資料庫有不同結構描述的典型垂直資料分割案例中，彈性查詢可用來實作常見使用案例，例如存取參考資料和跨資料庫查詢。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-150">For typical vertical partitioning scenarios where different databases have different schemas, elastic queries can be used to implement common use cases such as access to reference data and cross-database querying.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f2fe0-151">您必須具備 ALTER ANY EXTERNAL DATA SOURCE 權限。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-151">You must possess ALTER ANY EXTERNAL DATA SOURCE permission.</span></span> <span data-ttu-id="f2fe0-152">這個權限包含在 ALTER DATABASE 權限中。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-152">This permission is included with the ALTER DATABASE permission.</span></span> <span data-ttu-id="f2fe0-153">需有 ALTER ANY EXTERNAL DATA SOURCE 權限，才能參考基礎資料來源。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-153">ALTER ANY EXTERNAL DATA SOURCE permissions are needed to refer to the underlying data source.</span></span>
>

<span data-ttu-id="f2fe0-154">**參考資料**：拓撲是用來管理參考資料。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-154">**Reference data**: The topology is used for reference data management.</span></span> <span data-ttu-id="f2fe0-155">在下圖中，包含參考資料的兩個資料表 (T1 和 T2) 會保留在專用的資料庫上。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-155">In the figure below, two tables (T1 and T2) with reference data are kept on a dedicated database.</span></span> <span data-ttu-id="f2fe0-156">利用彈性查詢，您現在可以在遠端從其他資料庫存取資料表 T1 和 T2，如圖所示。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-156">Using an elastic query, you can now access tables T1 and T2 remotely from other databases, as shown in the figure.</span></span> <span data-ttu-id="f2fe0-157">如果參考資料表很小或參考資料表的遠端查詢有選擇性述詞，則使用拓撲 1。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-157">Use topology 1 if reference tables are small or remote queries into reference table have selective predicates.</span></span>

<span data-ttu-id="f2fe0-158">**圖 2** 垂直資料分割 - 使用彈性查詢來查詢參考資料</span><span class="sxs-lookup"><span data-stu-id="f2fe0-158">**Figure 2** Vertical partitioning - Using elastic query to query reference data</span></span>

![垂直資料分割 - 使用彈性查詢來查詢參考資料][3]

<span data-ttu-id="f2fe0-160">**跨資料庫查詢**：彈性查詢可促成需要跨多個 SQL Database 進行查詢的使用案例。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-160">**Cross-database querying**: Elastic queries enable use cases that require querying across several SQL databases.</span></span> <span data-ttu-id="f2fe0-161">圖 3 顯示四個不同的資料庫：CRM、庫存、HR 和產品。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-161">Figure 3 shows four different databases: CRM, Inventory, HR and Products.</span></span> <span data-ttu-id="f2fe0-162">在其中一個資料庫中執行的查詢也需要存取另一個或其他所有資料庫。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-162">Queries performed in one of the databases also need access to one or all the other databases.</span></span> <span data-ttu-id="f2fe0-163">利用彈性查詢，您可以在上述每個資料庫上執行一些簡單的 DDL 陳述式，針對此案例設定您的資料庫。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-163">Using an elastic query, you can configure your database for this case by running a few simple DDL statements on each of the four databases.</span></span> <span data-ttu-id="f2fe0-164">進行此一次性設定之後，存取遠端資料表就像從 T-SQL 查詢或從 BI 工具參考本機資料表一樣簡單。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-164">After this one-time configuration, access to a remote table is as simple as referring to a local table from your T-SQL queries or from your BI tools.</span></span> <span data-ttu-id="f2fe0-165">如果遠端查詢未傳回大量結果，則建議使用這個方法。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-165">This approach is recommended if the remote queries do not return large results.</span></span>

<span data-ttu-id="f2fe0-166">**圖 3** 垂直資料分割 - 使用彈性查詢來查詢各種資料庫</span><span class="sxs-lookup"><span data-stu-id="f2fe0-166">**Figure 3** Vertical partitioning - Using elastic query to query across various databases</span></span>

![垂直資料分割 - 使用彈性查詢來查詢各種資料庫][4]

<span data-ttu-id="f2fe0-168">下列步驟會針對垂直資料分割案例設定彈性資料庫查詢，這些案例需要存取位於遠端 SQL Database 上具有相同結構描述的資料表：</span><span class="sxs-lookup"><span data-stu-id="f2fe0-168">The following steps configure elastic database queries for vertical partitioning scenarios that require access to a table located on remote SQL databases with the same schema:</span></span>

* <span data-ttu-id="f2fe0-169">[CREATE MASTER KEY](https://msdn.microsoft.com/library/ms174382.aspx) mymasterkey</span><span class="sxs-lookup"><span data-stu-id="f2fe0-169">[CREATE MASTER KEY](https://msdn.microsoft.com/library/ms174382.aspx) mymasterkey</span></span>
* <span data-ttu-id="f2fe0-170">[CREATE DATABASE SCOPED CREDENTIAL](https://msdn.microsoft.com/library/mt270260.aspx) mycredential</span><span class="sxs-lookup"><span data-stu-id="f2fe0-170">[CREATE DATABASE SCOPED CREDENTIAL](https://msdn.microsoft.com/library/mt270260.aspx) mycredential</span></span>
* <span data-ttu-id="f2fe0-171">[CREATE/DROP EXTERNAL DATA SOURCE](https://msdn.microsoft.com/library/dn935022.aspx) mydatasource (類型為 **RDBMS**</span><span class="sxs-lookup"><span data-stu-id="f2fe0-171">[CREATE/DROP EXTERNAL DATA SOURCE](https://msdn.microsoft.com/library/dn935022.aspx) mydatasource of type **RDBMS**</span></span>
* <span data-ttu-id="f2fe0-172">[CREATE/DROP EXTERNAL TABLE](https://msdn.microsoft.com/library/dn935021.aspx) mytable</span><span class="sxs-lookup"><span data-stu-id="f2fe0-172">[CREATE/DROP EXTERNAL TABLE](https://msdn.microsoft.com/library/dn935021.aspx) mytable</span></span>

<span data-ttu-id="f2fe0-173">執行 DDL 陳述式之後，您可以存取遠端資料表 "mytable"，就像存取本機資料表一樣。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-173">After running the DDL statements, you can access the remote table “mytable” as though it were a local table.</span></span> <span data-ttu-id="f2fe0-174">Azure SQL Database 會自動開啟遠端資料庫的連線、處理您對遠端資料庫的要求，以及傳回結果。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-174">Azure SQL Database automatically opens a connection to the remote database, processes your request on the remote database, and returns the results.</span></span>

## <a name="horizontal-partitioning---sharding"></a><span data-ttu-id="f2fe0-175">水平資料分割 - 分區化</span><span class="sxs-lookup"><span data-stu-id="f2fe0-175">Horizontal partitioning - sharding</span></span>
<span data-ttu-id="f2fe0-176">使用彈性查詢在分區化 (即水平分割) 的資料層執行報告工作時，需要 [彈性資料庫分區對應](sql-database-elastic-scale-shard-map-management.md) 來代表資料層的資料庫。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-176">Using elastic query to perform reporting tasks over a sharded, i.e., horizontally partitioned, data tier requires an [elastic database shard map](sql-database-elastic-scale-shard-map-management.md) to represent the databases of the data tier .</span></span> <span data-ttu-id="f2fe0-177">一般而言，這種情節中只會使用單一分區對應，並以具有彈性查詢功能 (前端節點) 的專用資料庫作為報告查詢的進入點。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-177">Typically, only a single shard map is used in this scenario and a dedicated database with elastic query capabilities (head node) serves as the entry point for reporting queries.</span></span> <span data-ttu-id="f2fe0-178">只有這個專用的資料庫需要存取分區對應。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-178">Only this dedicated database needs access to the shard map.</span></span> <span data-ttu-id="f2fe0-179">圖 4 說明此拓撲及其彈性查詢資料庫和分區對應的組態。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-179">Figure 4 illustrates this topology and its configuration with the elastic query database and shard map.</span></span> <span data-ttu-id="f2fe0-180">資料層中的資料庫可以是任何 Azure SQL Database 版本。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-180">The databases in the data tier can be of any Azure SQL Database version or edition.</span></span> <span data-ttu-id="f2fe0-181">如需有關彈性資料庫用戶端程式庫和建立分區對應的詳細資訊，請參閱 [分區對應管理](sql-database-elastic-scale-shard-map-management.md)。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-181">For more information about the elastic database client library and creating shard maps, see [Shard map management](sql-database-elastic-scale-shard-map-management.md).</span></span>

<span data-ttu-id="f2fe0-182">**圖 4** 水平資料分割 - 使用彈性查詢來報告分區化資料層</span><span class="sxs-lookup"><span data-stu-id="f2fe0-182">**Figure 4** Horizontal partitioning - Using elastic query for reporting over sharded data tiers</span></span>

![水平資料分割 - 使用彈性查詢來報告分區化資料層][5]

> [!NOTE]
> <span data-ttu-id="f2fe0-184">彈性查詢資料庫 (前端節點) 可以是個別的資料庫，或是裝載分區對應的相同資料庫。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-184">Elastic Query Database (head node) can be separate database, or it can be the same database that hosts the shard map.</span></span> <span data-ttu-id="f2fe0-185">無論您選擇哪一個設定，請確定該資料庫的服務和效能層級夠高，可處理預期的登入/查詢要求數量。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-185">Whatever configuration you choose, make sure that service and performance tier of that database is high enough to handle the expected  amount of login/query requests.</span></span>

<span data-ttu-id="f2fe0-186">下列步驟會針對水平資料分割案例設定彈性資料庫查詢，這些案例需要存取 (通常) 位於數個遠端 SQL Database 上的一組資料表：</span><span class="sxs-lookup"><span data-stu-id="f2fe0-186">The following steps configure elastic database queries for horizontal partitioning scenarios that require access to a set of table that are located on (typically) several remote SQL databases:</span></span>

* <span data-ttu-id="f2fe0-187">[CREATE MASTER KEY](https://msdn.microsoft.com/library/ms174382.aspx) mymasterkey</span><span class="sxs-lookup"><span data-stu-id="f2fe0-187">[CREATE MASTER KEY](https://msdn.microsoft.com/library/ms174382.aspx) mymasterkey</span></span>
* <span data-ttu-id="f2fe0-188">[CREATE DATABASE SCOPED CREDENTIAL](https://msdn.microsoft.com/library/mt270260.aspx) mycredential</span><span class="sxs-lookup"><span data-stu-id="f2fe0-188">[CREATE DATABASE SCOPED CREDENTIAL](https://msdn.microsoft.com/library/mt270260.aspx) mycredential</span></span>
* <span data-ttu-id="f2fe0-189">使用彈性資料庫用戶端程式庫，建立代表您的資料層的 [分區對應](sql-database-elastic-scale-shard-map-management.md) 。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-189">Create a [shard map](sql-database-elastic-scale-shard-map-management.md) representing your data tier using the elastic database client library.</span></span>   
* <span data-ttu-id="f2fe0-190">[CREATE/DROP EXTERNAL DATA SOURCE](https://msdn.microsoft.com/library/dn935022.aspx) mydatasource (類型為 **SHARD_MAP_MANAGER**)</span><span class="sxs-lookup"><span data-stu-id="f2fe0-190">[CREATE/DROP EXTERNAL DATA SOURCE](https://msdn.microsoft.com/library/dn935022.aspx) mydatasource of type **SHARD_MAP_MANAGER**</span></span>
* <span data-ttu-id="f2fe0-191">[CREATE/DROP EXTERNAL TABLE](https://msdn.microsoft.com/library/dn935021.aspx) mytable</span><span class="sxs-lookup"><span data-stu-id="f2fe0-191">[CREATE/DROP EXTERNAL TABLE](https://msdn.microsoft.com/library/dn935021.aspx) mytable</span></span>

<span data-ttu-id="f2fe0-192">執行這些步驟後，您即可存取水平分割的資料表 "mytable"，就像存取本機資料表一樣。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-192">Once you have performed these steps, you can access the horizontally partitioned table “mytable” as though it were a local table.</span></span> <span data-ttu-id="f2fe0-193">Azure SQL Database 會自動開啟遠端資料庫 (實際儲存資料表的位置) 的多個平行連線、處理對於遠端資料庫的要求，以及傳回結果。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-193">Azure SQL Database automatically opens multiple parallel connections to the remote databases where the tables are physically stored, processes the requests on the remote databases, and returns the results.</span></span>
<span data-ttu-id="f2fe0-194">如需水平資料分割案例所需步驟的詳細資訊，請參閱 [水平資料分割的彈性查詢](sql-database-elastic-query-horizontal-partitioning.md)。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-194">More information on the steps required for the horizontal partitioning scenario can be found in [elastic query for horizontal partitioning](sql-database-elastic-query-horizontal-partitioning.md).</span></span>

<span data-ttu-id="f2fe0-195">若要開始撰寫程式碼，請參閱[開始使用彈性查詢進行水平資料分割 (分區化)](sql-database-elastic-query-getting-started.md)。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-195">To begin coding, see [Getting started with elastic query for horizontal partitioning (sharding)](sql-database-elastic-query-getting-started.md).</span></span>

## <a name="t-sql-querying"></a><span data-ttu-id="f2fe0-196">T-SQL 查詢</span><span class="sxs-lookup"><span data-stu-id="f2fe0-196">T-SQL querying</span></span>
<span data-ttu-id="f2fe0-197">一旦您已定義外部資料來源和外部資料表，您可以使用一般 SQL Server 連接字串來連接到您定義外部資料表的資料庫。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-197">Once you have defined your external data sources and your external tables, you can use regular SQL Server connection strings to connect to the databases where you defined your external tables.</span></span> <span data-ttu-id="f2fe0-198">您可以接著對該連線上的外部資料表執行 T-SQL 陳述式，其限制如下所述。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-198">You can then run T-SQL statements over your external tables on that connection with the limitations outlined below.</span></span> <span data-ttu-id="f2fe0-199">您可以[水平資料分割](sql-database-elastic-query-horizontal-partitioning.md)和[垂直資料分割](sql-database-elastic-query-vertical-partitioning.md)文件主題中找到 T-SQL 查詢範例的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-199">You can find more information and examples of T-SQL queries in the documentation topics for [horizontal partitioning](sql-database-elastic-query-horizontal-partitioning.md) and [vertical partitioning](sql-database-elastic-query-vertical-partitioning.md).</span></span>

## <a name="connectivity-for-tools"></a><span data-ttu-id="f2fe0-200">工具的連線能力</span><span class="sxs-lookup"><span data-stu-id="f2fe0-200">Connectivity for tools</span></span>
<span data-ttu-id="f2fe0-201">您可以使用一般 SQL Server 連接字串，將您的應用程式、BI 或資料整合工具連接到具有外部資料表的資料庫。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-201">You can use regular SQL Server connection strings to connect your applications and BI or data integration tools to databases that have external tables.</span></span> <span data-ttu-id="f2fe0-202">請確定 SQL Server 可支援做為您的工具的資料來源。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-202">Make sure that SQL Server is supported as a data source for your tool.</span></span> <span data-ttu-id="f2fe0-203">連線之後，請參考彈性查詢資料庫和該資料庫中的外部資料表，就如同您會使用您的工具連接的任何其他 SQL Server 資料庫一樣。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-203">Once connected, refer to the elastic query database and the external tables in that database just like you would do with any other SQL Server database that you connect to with your tool.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f2fe0-204">目前不支援使用 Azure Active Directory 與彈性查詢進行驗證。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-204">Authentication using Azure Active Directory with elastic queries is not currently supported.</span></span>
> 
> 

## <a name="cost"></a><span data-ttu-id="f2fe0-205">成本</span><span class="sxs-lookup"><span data-stu-id="f2fe0-205">Cost</span></span>
<span data-ttu-id="f2fe0-206">彈性查詢算在 Azure SQL Database 資料庫的成本內。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-206">Elastic query is included into the cost of Azure SQL Database databases.</span></span> <span data-ttu-id="f2fe0-207">請注意，支援遠端資料庫與彈性查詢端點位於不同資料中心的拓撲，但從遠端資料庫輸出的資料以一般 [Azure 費率](https://azure.microsoft.com/pricing/details/data-transfers/)收費。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-207">Note that topologies where your remote databases are in a different data center than the elastic query endpoint are supported, but data egress from remote databases are charged regular [Azure rates](https://azure.microsoft.com/pricing/details/data-transfers/).</span></span>

## <a name="preview-limitations"></a><span data-ttu-id="f2fe0-208">預覽限制</span><span class="sxs-lookup"><span data-stu-id="f2fe0-208">Preview limitations</span></span>
* <span data-ttu-id="f2fe0-209">在標準效能層上執行第一個彈性查詢最多可能需要幾分鐘的時間。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-209">Running your first elastic query can take up to a few minutes on the Standard performance tier.</span></span> <span data-ttu-id="f2fe0-210">需要這些時間才能載入彈性查詢功能；較高效能層級改善了載入效能。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-210">This time is necessary to load the elastic query functionality; loading performance improves with higher performance tiers.</span></span>
* <span data-ttu-id="f2fe0-211">尚未支援來自 SSMS 或 SSDT 的外部資料來源或外部資料表的指令碼。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-211">Scripting of external data sources or external tables from SSMS or SSDT is not yet supported.</span></span>
* <span data-ttu-id="f2fe0-212">SQL DB 匯入/匯出還不支援外部資料來源和外部資料表。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-212">Import/Export for SQL DB does not yet support external data sources and external tables.</span></span> <span data-ttu-id="f2fe0-213">如果您需要使用匯入/匯出，請在匯出前卸除這些物件，然後在匯入後予以重新建立。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-213">If you need to use Import/Export, drop these objects before exporting and then re-create them after importing.</span></span>
* <span data-ttu-id="f2fe0-214">彈性查詢目前僅支援以唯讀方式存取外部資料表。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-214">Elastic query currently only supports read-only access to external tables.</span></span> <span data-ttu-id="f2fe0-215">不過，您可以在定義外部資料表的資料庫上使用完整的 T-SQL 功能。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-215">You can, however, use full T-SQL functionality on the database where the external table is defined.</span></span> <span data-ttu-id="f2fe0-216">這很有用，例如，使用 SELECT <column_list> INTO <local_table> 保存暫存結果，或在彈性查詢資料庫上定義預存程序來參考外部資料表。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-216">This can be useful to, e.g., persist temporary results using, e.g., SELECT <column_list> INTO <local_table>, or to define stored procedures on the elastic query database which refer to external tables.</span></span>
* <span data-ttu-id="f2fe0-217">除了 nvarchar (max) 以外，外部資料表定義不支援 LOB 類型。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-217">Except for nvarchar(max), LOB types are not supported in external table definitions.</span></span> <span data-ttu-id="f2fe0-218">若要解決此問題，您可以在將 LOB 類型轉型成 nvarchar (max) 的遠端資料庫上建立檢視表、透過此檢視表而非基底資料表定義外部資料表，然後在查詢中將它轉換回原始的 LOB 類型。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-218">As a workaround, you can create a view on the remote database that casts the LOB type into nvarchar(max), define your external table over the view instead of the base table and then cast it back into the original LOB type in your queries.</span></span>
* <span data-ttu-id="f2fe0-219">目前不支援外部資料表的資料行統計資料。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-219">Column statistics over external tables are currently not supported.</span></span> <span data-ttu-id="f2fe0-220">支援資料表統計資料，但必須以手動方式建立。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-220">Tables statistics are supported, but need to be created manually.</span></span>

## <a name="feedback"></a><span data-ttu-id="f2fe0-221">意見反應</span><span class="sxs-lookup"><span data-stu-id="f2fe0-221">Feedback</span></span>
<span data-ttu-id="f2fe0-222">請在下面 Disqus、MSDN 論壇或 Stackoverflow 上，與我們分享您的彈性查詢體驗意見。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-222">Please share feedback on your experience with elastic queries with us on Disqus below, the MSDN forums, or on Stackoverflow.</span></span> <span data-ttu-id="f2fe0-223">我們很樂意接受關於服務的各種意見 (缺失、不完善、功能落差)。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-223">We are interested in all kinds of feedback about the service (defects, rough edges, feature gaps).</span></span>

## <a name="next-steps"></a><span data-ttu-id="f2fe0-224">後續步驟</span><span class="sxs-lookup"><span data-stu-id="f2fe0-224">Next steps</span></span>

* <span data-ttu-id="f2fe0-225">若要開始撰寫程式碼，請參閱 [開始使用跨資料庫查詢 (垂直資料分割)](sql-database-elastic-query-getting-started-vertical.md)。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-225">For a vertical partitioning tutorial, see [Getting started with cross-database query (vertical partitioning)](sql-database-elastic-query-getting-started-vertical.md).</span></span>
* <span data-ttu-id="f2fe0-226">如需垂直資料分割之資料的語法和範例查詢，請參閱[查詢垂直資料分割的資料](sql-database-elastic-query-vertical-partitioning.md)</span><span class="sxs-lookup"><span data-stu-id="f2fe0-226">For syntax and sample queries for vertically partitioned data, see [Querying vertically partitioned data)](sql-database-elastic-query-vertical-partitioning.md)</span></span>
* <span data-ttu-id="f2fe0-227">如需水平資料分割 (分區化) 教學課程，請參閱[開始使用彈性查詢進行水平資料分割 (分區化)](sql-database-elastic-query-getting-started.md)。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-227">For a horizontal partitioning (sharding) tutorial, see [Getting started with elastic query for horizontal partitioning (sharding)](sql-database-elastic-query-getting-started.md).</span></span>
* <span data-ttu-id="f2fe0-228">如需水平資料分割之資料的語法和範例查詢，請參閱[查詢水平資料分割的資料](sql-database-elastic-query-horizontal-partitioning.md)</span><span class="sxs-lookup"><span data-stu-id="f2fe0-228">For syntax and sample queries for horizontally partitioned data, see [Querying horizontally partitioned data)](sql-database-elastic-query-horizontal-partitioning.md)</span></span>
* <span data-ttu-id="f2fe0-229">如需會在單一遠端 Azure SQL Database 或一組在水平資料分割配置中作為分區之資料庫上執行 Transact-SQL 陳述式的預存程序，請參閱 [sp\_execute \_remote](https://msdn.microsoft.com/library/mt703714)。</span><span class="sxs-lookup"><span data-stu-id="f2fe0-229">See [sp\_execute \_remote](https://msdn.microsoft.com/library/mt703714) for a stored procedure that executes a Transact-SQL statement on a single remote Azure SQL Database or set of databases serving as shards in a horizontal partitioning scheme.</span></span>

<!--Image references-->
[1]: ./media/sql-database-elastic-query-overview/overview.png
[2]: ./media/sql-database-elastic-query-overview/topology1.png
[3]: ./media/sql-database-elastic-query-overview/vertpartrrefdata.png
[4]: ./media/sql-database-elastic-query-overview/verticalpartitioning.png
[5]: ./media/sql-database-elastic-query-overview/horizontalpartitioning.png

<!--anchors-->
