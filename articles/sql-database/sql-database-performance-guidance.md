---
title: "aaaAzure SQL Database 效能調整指引 |Microsoft 文件"
description: "這篇文章可協助您判斷哪一個應用程式的服務層 toochoose。 它也會建議方式 tootune 您充分利用 Azure SQL Database 的應用程式 tooget hello。"
services: sql-database
documentationcenter: na
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: dd8d95fa-24b2-4233-b3f1-8e8952a7a22b
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 02/09/2017
ms.author: carlrab
ms.openlocfilehash: 2699f755391e94ab488ac1e6acedd30f8aec4488
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="tuning-performance-in-azure-sql-database"></a><span data-ttu-id="33b77-104">微調 Azure SQL Database 中的資料庫效能</span><span class="sxs-lookup"><span data-stu-id="33b77-104">Tuning performance in Azure SQL Database</span></span>

<span data-ttu-id="33b77-105">Azure SQL Database 提供[建議](sql-database-advisor.md)，您可以使用 tooimprove 效能，您的資料庫，或是您可以讓 Azure SQL Database[隨著 tooyour 應用程式的自動調整](sql-database-automatic-tuning.md)並套用變更可改善您的工作負載的效能。</span><span class="sxs-lookup"><span data-stu-id="33b77-105">Azure SQL Database provides [recommendations](sql-database-advisor.md) that you can use tooimprove performance of your database, or you can let Azure SQL Database [automatically adapt tooyour application](sql-database-automatic-tuning.md) and apply changes that will improve performance of your workload.</span></span>

<span data-ttu-id="33b77-106">在您不需要任何適用的建議，而您仍效能問題，您可能會使用下列方法 tooimprove 演唱 hello:</span><span class="sxs-lookup"><span data-stu-id="33b77-106">In you don't have any applicable recommendations, and you still have performance issues, you might use hello following methods tooimprove performances:</span></span>
1. <span data-ttu-id="33b77-107">增加[服務層](sql-database-service-tiers.md)並提供更多資源 tooyour 資料庫。</span><span class="sxs-lookup"><span data-stu-id="33b77-107">Increase [service tiers](sql-database-service-tiers.md) and provide more resources tooyour database.</span></span>
2. <span data-ttu-id="33b77-108">微調您的應用程式，並套用一些可以改善效能的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="33b77-108">Tune your application and apply some best practices that can improve performance.</span></span> 
3. <span data-ttu-id="33b77-109">變更索引和 toomore 有效率地處理資料的查詢來微調 hello 資料庫。</span><span class="sxs-lookup"><span data-stu-id="33b77-109">Tune hello database by changing indexes and queries toomore efficiently work with data.</span></span>

<span data-ttu-id="33b77-110">這些是手動方法，因為您需要 toodecide 什麼[服務層](sql-database-service-tiers.md)會選擇，或您會需要 toorewrite 應用程式或資料庫程式碼並部署 hello 變更。</span><span class="sxs-lookup"><span data-stu-id="33b77-110">These are manual methods because you need toodecide what [service tiers](sql-database-service-tiers.md) you would choose or you would need toorewrite application or database code and deply hello changes.</span></span>

## <a name="increasing-performance-tier-of-your-database"></a><span data-ttu-id="33b77-111">增加資料庫的效能層級</span><span class="sxs-lookup"><span data-stu-id="33b77-111">Increasing performance tier of your database</span></span>

<span data-ttu-id="33b77-112">Azure SQL Database 提供四個[服務層](sql-database-service-tiers.md)供您選擇：基本、標準、進階及進階 RS (以資料庫輸送量單位 (簡稱 [DTU](sql-database-what-is-a-dtu.md)) 測量效能)。</span><span class="sxs-lookup"><span data-stu-id="33b77-112">Azure SQL Database offers four [service tiers](sql-database-service-tiers.md) that you can choose from: Basic, Standard, Premium, and Premium RS (performance is measured in database throughput units, or [DTUs](sql-database-what-is-a-dtu.md).</span></span> <span data-ttu-id="33b77-113">每個服務層嚴格隔離 hello 資源可以使用 SQL database，與可保證該服務層級的效能預測性。</span><span class="sxs-lookup"><span data-stu-id="33b77-113">Each service tier strictly isolates hello resources that your SQL database can use, and guarantees predictable performance for that service level.</span></span> <span data-ttu-id="33b77-114">在本文中，我們會提供可協助您選擇您的應用程式的 hello 服務層的指引。</span><span class="sxs-lookup"><span data-stu-id="33b77-114">In this article, we offer guidance that can help you choose hello service tier for your application.</span></span> <span data-ttu-id="33b77-115">我們也將討論您可以微調您充分利用 Azure SQL Database 的應用程式 tooget hello。</span><span class="sxs-lookup"><span data-stu-id="33b77-115">We also discuss ways that you can tune your application tooget hello most from Azure SQL Database.</span></span>

> [!NOTE]
> <span data-ttu-id="33b77-116">本文著重在 Azure SQL Database 中單一資料庫的效能指引。</span><span class="sxs-lookup"><span data-stu-id="33b77-116">This article focuses on performance guidance for single databases in Azure SQL Database.</span></span> <span data-ttu-id="33b77-117">如需效能指引相關的 tooelastic 集區，請參閱[彈性集區的價格和效能考量](sql-database-elastic-pool-guidance.md)。</span><span class="sxs-lookup"><span data-stu-id="33b77-117">For performance guidance related tooelastic pools, see [Price and performance considerations for elastic pools](sql-database-elastic-pool-guidance.md).</span></span> <span data-ttu-id="33b77-118">不過請注意，您可以用來套用微調建議的彈性集區，在此發行項 toodatabases hello 的許多，並取得類似的效能優勢。</span><span class="sxs-lookup"><span data-stu-id="33b77-118">Note, though, that you can apply many of hello tuning recommendations in this article toodatabases in an elastic pool, and get similar performance benefits.</span></span>
> 

* <span data-ttu-id="33b77-119">**基本**: hello 基本服務層提供良好的效能可預測性的每個資料庫、 小時內的小時。</span><span class="sxs-lookup"><span data-stu-id="33b77-119">**Basic**: hello Basic service tier offers good performance predictability for each database, hour over hour.</span></span> <span data-ttu-id="33b77-120">在基本資料庫中，會有足夠的資源可在不會有多個並行要求的小型資料庫中支援良好的效能。</span><span class="sxs-lookup"><span data-stu-id="33b77-120">In a Basic database, sufficient resources support good performance in a small database that doesn't have multiple concurrent requests.</span></span> <span data-ttu-id="33b77-121">使用基本服務層時的一般使用案例如下：</span><span class="sxs-lookup"><span data-stu-id="33b77-121">Typical use cases when you would use Basic service tier are:</span></span>
  * <span data-ttu-id="33b77-122">**您剛開始使用 Azure SQL Database**。</span><span class="sxs-lookup"><span data-stu-id="33b77-122">**You're just getting started with Azure SQL Database**.</span></span> <span data-ttu-id="33b77-123">開發中的應用程式通常不需要很高的效能等級。</span><span class="sxs-lookup"><span data-stu-id="33b77-123">Applications that are in development often don't need high-performance levels.</span></span> <span data-ttu-id="33b77-124">基本資料庫的價格便宜，是適合用來開發或測試資料庫的理想環境。</span><span class="sxs-lookup"><span data-stu-id="33b77-124">Basic databases are an ideal environment for database development or testing, at a low price point.</span></span>
  * <span data-ttu-id="33b77-125">**您的資料庫只有單一使用者**。</span><span class="sxs-lookup"><span data-stu-id="33b77-125">**You have a database with a single user**.</span></span> <span data-ttu-id="33b77-126">將單一使用者與資料庫相關聯的應用程式通常沒有高度的並行存取和效能需求。</span><span class="sxs-lookup"><span data-stu-id="33b77-126">Applications that associate a single user with a database typically don’t have high concurrency and performance requirements.</span></span> <span data-ttu-id="33b77-127">這些應用程式是 hello Basic 服務層的候選項目。</span><span class="sxs-lookup"><span data-stu-id="33b77-127">These applications are candidates for hello Basic service tier.</span></span>
* <span data-ttu-id="33b77-128">**標準**: hello Standard 服務層提供更佳的效能可預測性，並提供良好的效能有多個並行要求的詳細資訊，例如工作群組和 web 應用程式的資料庫。</span><span class="sxs-lookup"><span data-stu-id="33b77-128">**Standard**: hello Standard service tier offers improved performance predictability and provides good performance for databases that have multiple concurrent requests, like workgroup and web applications.</span></span> <span data-ttu-id="33b77-129">當您使用標準服務層資料庫時，您可以根據可預測的效能，每分鐘調整資料庫應用程式的大小。</span><span class="sxs-lookup"><span data-stu-id="33b77-129">When you choose a Standard service tier database, you can size your database application based on predictable performance, minute over minute.</span></span>
  * <span data-ttu-id="33b77-130">**您的資料庫有多個並行要求**。</span><span class="sxs-lookup"><span data-stu-id="33b77-130">**Your database has multiple concurrent requests**.</span></span> <span data-ttu-id="33b77-131">一次服務多名使用者的應用程式通常需要較高的效能等級。</span><span class="sxs-lookup"><span data-stu-id="33b77-131">Applications that service more than one user at a time usually need higher performance levels.</span></span> <span data-ttu-id="33b77-132">例如，工作群組或 web 應用程式的支援多個並行查詢的低 toomedium IO 流量需求十分適合 hello Standard 服務層。</span><span class="sxs-lookup"><span data-stu-id="33b77-132">For example, workgroup or web applications that have low toomedium IO traffic requirements supporting multiple concurrent queries are good candidates for hello Standard service tier.</span></span>
* <span data-ttu-id="33b77-133">**Premium**: hello Premium 服務層提供可預測的效能，第二個透過第二，每個 Premium 資料庫。</span><span class="sxs-lookup"><span data-stu-id="33b77-133">**Premium**: hello Premium service tier provides predictable performance, second over second, for each Premium database.</span></span> <span data-ttu-id="33b77-134">當您選擇 hello Premium 服務層時，您可以調整大小根據 hello 尖峰負載，該資料庫的資料庫應用程式。</span><span class="sxs-lookup"><span data-stu-id="33b77-134">When you choose hello Premium service tier, you can size your database application based on hello peak load for that database.</span></span> <span data-ttu-id="33b77-135">hello 計劃移除的案例中的效能變動而可能導致小型查詢 tootake 超過預期的延遲的作業。</span><span class="sxs-lookup"><span data-stu-id="33b77-135">hello plan removes cases in which performance variance can cause small queries tootake longer than expected in latency-sensitive operations.</span></span> <span data-ttu-id="33b77-136">此模型可大幅簡化 hello 開發和產品驗證程序，針對需要 toomake 尖峰資源需求、 效能變動或查詢延遲相關的強式陳述式應用程式。</span><span class="sxs-lookup"><span data-stu-id="33b77-136">This model can greatly simplify hello development and product validation cycles for applications that need toomake strong statements about peak resource needs, performance variance, or query latency.</span></span> <span data-ttu-id="33b77-137">大多數進階服務層使用案例具有下列一或多項特性︰</span><span class="sxs-lookup"><span data-stu-id="33b77-137">Most Premium service tier use cases have one or more of these characteristics:</span></span>
  * <span data-ttu-id="33b77-138">**高尖峰負載**。</span><span class="sxs-lookup"><span data-stu-id="33b77-138">**High peak load**.</span></span> <span data-ttu-id="33b77-139">應用程式需要大量 CPU、 記憶體或輸入/輸出 (I/O) toocomplete 其作業需要專用、 高效能層級。</span><span class="sxs-lookup"><span data-stu-id="33b77-139">An application that requires substantial CPU, memory, or input/output (I/O) toocomplete its operations requires a dedicated, high-performance level.</span></span> <span data-ttu-id="33b77-140">例如，已知 tooconsume 資料庫作業數個 CPU 核心數相當長的時間是 hello Premium 服務層的候選項目。</span><span class="sxs-lookup"><span data-stu-id="33b77-140">For example, a database operation known tooconsume several CPU cores for an extended time is a candidate for hello Premium service tier.</span></span>
  * <span data-ttu-id="33b77-141">**許多並行要求**。</span><span class="sxs-lookup"><span data-stu-id="33b77-141">**Many concurrent requests**.</span></span> <span data-ttu-id="33b77-142">某些資料庫應用程式會為許多並行要求提供服務，例如，在為具有高流量的網站提供服務時。</span><span class="sxs-lookup"><span data-stu-id="33b77-142">Some database applications service many concurrent requests, for example, when serving a website that has a high traffic volume.</span></span> <span data-ttu-id="33b77-143">基本和標準服務層限制的每個資料庫的並行要求的 hello 數目。</span><span class="sxs-lookup"><span data-stu-id="33b77-143">Basic and Standard service tiers limit hello number of concurrent requests per database.</span></span> <span data-ttu-id="33b77-144">需要更多連線的應用程式需要 toochoose 適當預留大小 toohandle hello 最大要求數目。</span><span class="sxs-lookup"><span data-stu-id="33b77-144">Applications that require more connections would need toochoose an appropriate reservation size toohandle hello maximum number of needed requests.</span></span>
  * <span data-ttu-id="33b77-145">**低延遲**。</span><span class="sxs-lookup"><span data-stu-id="33b77-145">**Low latency**.</span></span> <span data-ttu-id="33b77-146">某些應用程式需要 tooguarantee 回應 hello 資料庫的最少的時間。</span><span class="sxs-lookup"><span data-stu-id="33b77-146">Some applications need tooguarantee a response from hello database in minimal time.</span></span> <span data-ttu-id="33b77-147">特定的預存程序稱為更廣泛的客戶作業的一部分，您可能必須需求 toohave 從該呼叫傳回超過 20 毫秒，99%的 hello 時間。</span><span class="sxs-lookup"><span data-stu-id="33b77-147">If a specific stored procedure is called as part of a broader customer operation, you might have a requirement toohave a return from that call in no more than 20 milliseconds, 99 percent of hello time.</span></span> <span data-ttu-id="33b77-148">此類型的應用程式從 hello Premium 服務層的優點，toomake 確定該 hello 必要的運算能力使用。</span><span class="sxs-lookup"><span data-stu-id="33b77-148">This type of application benefits from hello Premium service tier, toomake sure that hello required computing power is available.</span></span>
* <span data-ttu-id="33b77-149">**Premium RS**: hello Premium RS 層專為設計，不需要大量 IO 的工作負載 hello 最高的可用性保證。</span><span class="sxs-lookup"><span data-stu-id="33b77-149">**Premium RS**: hello Premium RS tier is designed for IO-intensive workloads that do not require hello highest availability guarantees.</span></span> <span data-ttu-id="33b77-150">範例包括高效能工作負載或其中 hello 資料庫不是 hello 系統的記錄分析工作負載測試。</span><span class="sxs-lookup"><span data-stu-id="33b77-150">Examples include testing high-performance workloads, or an analytical workload where hello database is not hello system of record.</span></span>

<span data-ttu-id="33b77-151">您需要 SQL database 的 hello 服務層級取決於每個資源維度的 hello 尖峰負載需求。</span><span class="sxs-lookup"><span data-stu-id="33b77-151">hello service level that you need for your SQL database depends on hello peak load requirements for each resource dimension.</span></span> <span data-ttu-id="33b77-152">有些應用程式雖使用少量的某一資源，但卻對其他資源有大量需求。</span><span class="sxs-lookup"><span data-stu-id="33b77-152">Some applications use a trivial amount of a single resource, but have significant requirements for other resources.</span></span>

### <a name="service-tier-capabilities-and-limits"></a><span data-ttu-id="33b77-153">服務層的功能和限制</span><span class="sxs-lookup"><span data-stu-id="33b77-153">Service tier capabilities and limits</span></span>

<span data-ttu-id="33b77-154">在每個服務層，您可以設定 hello 效能層級，讓您擁有 hello 彈性 toopay 只針對您需要的 hello 容量。</span><span class="sxs-lookup"><span data-stu-id="33b77-154">At each service tier, you set hello performance level, so you have hello flexibility toopay only for hello capacity you need.</span></span> <span data-ttu-id="33b77-155">您可以在工作負載變更時向上或向下 [調整容量](sql-database-service-tiers.md)。</span><span class="sxs-lookup"><span data-stu-id="33b77-155">You can [adjust capacity](sql-database-service-tiers.md), up or down, as workload changes.</span></span> <span data-ttu-id="33b77-156">例如，如果在 hello 後-學校購物旺季期間，資料庫工作負載很高，您可能會增加 hello hello 資料庫的效能層級設定的時間，7 月到 9。</span><span class="sxs-lookup"><span data-stu-id="33b77-156">For example, if your database workload is high during hello back-to-school shopping season, you might increase hello performance level for hello database for a set time, July through September.</span></span> <span data-ttu-id="33b77-157">當旺季結束時，您可以將效能等級降低。</span><span class="sxs-lookup"><span data-stu-id="33b77-157">You can reduce it when your peak season ends.</span></span> <span data-ttu-id="33b77-158">您可以減少您付費最佳化您的業務您雲端環境 toohello 季節分析。</span><span class="sxs-lookup"><span data-stu-id="33b77-158">You can minimize what you pay by optimizing your cloud environment toohello seasonality of your business.</span></span> <span data-ttu-id="33b77-159">此模型也非常適合軟體產品發行週期。</span><span class="sxs-lookup"><span data-stu-id="33b77-159">This model also works well for software product release cycles.</span></span> <span data-ttu-id="33b77-160">測試小組可以在執行測試回合時配置容量，然後在測試完成時釋放該容量。</span><span class="sxs-lookup"><span data-stu-id="33b77-160">A test team might allocate capacity while it does test runs, and then release that capacity when they finish testing.</span></span> <span data-ttu-id="33b77-161">在容量要求模型中，您可以在需要時付費使用容量，避免將支出花費在可能很少使用的專用資源上。</span><span class="sxs-lookup"><span data-stu-id="33b77-161">In a capacity request model, you pay for capacity as you need it, and avoid spending on dedicated resources that you might rarely use.</span></span>

### <a name="why-service-tiers"></a><span data-ttu-id="33b77-162">為何使用服務層？</span><span class="sxs-lookup"><span data-stu-id="33b77-162">Why service tiers?</span></span>
<span data-ttu-id="33b77-163">雖然每個資料庫工作負載各有不同的服務層的 hello 用途是 tooprovide 各種效能層級的效能可預測性。</span><span class="sxs-lookup"><span data-stu-id="33b77-163">Although each database workload can differ, hello purpose of service tiers is tooprovide performance predictability at various performance levels.</span></span> <span data-ttu-id="33b77-164">對資料庫有大規模資源需求的客戶，則可以在更專用的運算環境中工作。</span><span class="sxs-lookup"><span data-stu-id="33b77-164">Customers with large-scale database resource requirements can work in a more dedicated computing environment.</span></span>

## <a name="tune-your-application"></a><span data-ttu-id="33b77-165">微調應用程式</span><span class="sxs-lookup"><span data-stu-id="33b77-165">Tune your application</span></span>
<span data-ttu-id="33b77-166">在傳統的內部部署 SQL Server，hello 的初始容量規劃的程序通常會分開與 hello 的生產環境中執行應用程式的程序。</span><span class="sxs-lookup"><span data-stu-id="33b77-166">In traditional on-premises SQL Server, hello process of initial capacity planning often is separated from hello process of running an application in production.</span></span> <span data-ttu-id="33b77-167">先購買硬體和產品授權，之後再微調效能。</span><span class="sxs-lookup"><span data-stu-id="33b77-167">Hardware and product licenses are purchased first, and performance tuning is done afterward.</span></span> <span data-ttu-id="33b77-168">當您使用 Azure SQL Database 時，就是個不錯的主意 toointerweave hello 處理執行應用程式和微調。</span><span class="sxs-lookup"><span data-stu-id="33b77-168">When you use Azure SQL Database, it's a good idea toointerweave hello process of running an application and tuning it.</span></span> <span data-ttu-id="33b77-169">與 hello 隨選容量付費的模型，您可以微調您的應用程式 toouse hello 需要最少資源，而不是過度佈建硬體根據未來的成長計畫應用程式，通常就是不正確的猜測。</span><span class="sxs-lookup"><span data-stu-id="33b77-169">With hello model of paying for capacity on demand, you can tune your application toouse hello minimum resources needed now, instead of overprovisioning on hardware based on guesses of future growth plans for an application, which often are incorrect.</span></span> <span data-ttu-id="33b77-170">有些客戶可能會選擇不 tootune 應用程式，並改為選擇 toooverprovision 硬體資源。</span><span class="sxs-lookup"><span data-stu-id="33b77-170">Some customers might choose not tootune an application, and instead choose toooverprovision hardware resources.</span></span> <span data-ttu-id="33b77-171">如果您不想 toochange 關鍵應用程式繁忙期間，這種方法可能是不錯的想法。</span><span class="sxs-lookup"><span data-stu-id="33b77-171">This approach might be a good idea if you don't want toochange a key application during a busy period.</span></span> <span data-ttu-id="33b77-172">但是，微調應用程式可以最小化資源需求，並降低每月帳單金額當您使用 Azure SQL Database 中的 hello 服務層。</span><span class="sxs-lookup"><span data-stu-id="33b77-172">But, tuning an application can minimize resource requirements and lower monthly bills when you use hello service tiers in Azure SQL Database.</span></span>

### <a name="application-characteristics"></a><span data-ttu-id="33b77-173">應用程式特性</span><span class="sxs-lookup"><span data-stu-id="33b77-173">Application characteristics</span></span>
<span data-ttu-id="33b77-174">雖然 Azure SQL Database 服務層是設計的 tooimprove 效能穩定性和可預測性應用程式，但是一些最佳作法可協助您微調您的應用程式 toobetter 利用 hello 效能層級的資源。</span><span class="sxs-lookup"><span data-stu-id="33b77-174">Although Azure SQL Database service tiers are designed tooimprove performance stability and predictability for an application, some best practices can help you tune your application toobetter take advantage of hello resources at a performance level.</span></span> <span data-ttu-id="33b77-175">雖然許多應用程式有大幅的效能改善只是藉由切換 tooa 較高的效能層級或服務層，某些應用程式需要其他微調 toobenefit 較高層級的服務。</span><span class="sxs-lookup"><span data-stu-id="33b77-175">Although many applications have significant performance gains simply by switching tooa higher performance level or service tier, some applications need additional tuning toobenefit from a higher level of service.</span></span> <span data-ttu-id="33b77-176">為了提高效能，請考慮為具有下列特性的應用程式進行額外的應用程式微調︰</span><span class="sxs-lookup"><span data-stu-id="33b77-176">For increased performance, consider additional application tuning for applications that have these characteristics:</span></span>

* <span data-ttu-id="33b77-177">**因為「多對話」行為而使效能變慢的應用程式**。</span><span class="sxs-lookup"><span data-stu-id="33b77-177">**Applications that have slow performance because of "chatty" behavior**.</span></span> <span data-ttu-id="33b77-178">多對話的應用程式進行過多的資料存取作業機密 toonetwork 延遲。</span><span class="sxs-lookup"><span data-stu-id="33b77-178">Chatty applications make excessive data access operations that are sensitive toonetwork latency.</span></span> <span data-ttu-id="33b77-179">您可能需要 toomodify 這些種類的應用程式 tooreduce hello 資料存取作業 toohello SQL 資料庫數目。</span><span class="sxs-lookup"><span data-stu-id="33b77-179">You might need toomodify these kinds of applications tooreduce hello number of data access operations toohello SQL database.</span></span> <span data-ttu-id="33b77-180">例如，您可能會使用技術如批次處理臨機操作查詢或移動 hello 查詢 toostored 程序來改善應用程式的效能。</span><span class="sxs-lookup"><span data-stu-id="33b77-180">For example, you might improve application performance by using techniques like batching ad-hoc queries or moving hello queries toostored procedures.</span></span> <span data-ttu-id="33b77-181">如需詳細資訊，請參閱 [批次查詢](#batch-queries)。</span><span class="sxs-lookup"><span data-stu-id="33b77-181">For more information, see [Batch queries](#batch-queries).</span></span>
* <span data-ttu-id="33b77-182">**無法由整部單一電腦支援之具有大量工作負載的資料庫**。</span><span class="sxs-lookup"><span data-stu-id="33b77-182">**Databases with an intensive workload that can't be supported by an entire single machine**.</span></span> <span data-ttu-id="33b77-183">資料庫如果超出最高 Premium 效能層級 hello hello 資源可能受益於向外延展 hello 工作負載。</span><span class="sxs-lookup"><span data-stu-id="33b77-183">Databases that exceed hello resources of hello highest Premium performance level might benefit from scaling out hello workload.</span></span> <span data-ttu-id="33b77-184">如需詳細資訊，請參閱[跨資料庫分區化](#cross-database-sharding)和[功能資料分割](#functional-partitioning)。</span><span class="sxs-lookup"><span data-stu-id="33b77-184">For more information, see [Cross-database sharding](#cross-database-sharding) and [Functional partitioning](#functional-partitioning).</span></span>
* <span data-ttu-id="33b77-185">**具有次佳查詢的應用程式**。</span><span class="sxs-lookup"><span data-stu-id="33b77-185">**Applications that have suboptimal queries**.</span></span> <span data-ttu-id="33b77-186">應用程式，特別是那些在 hello 資料存取層中，有未經適當微調的查詢可能不會受益較高的效能層級。</span><span class="sxs-lookup"><span data-stu-id="33b77-186">Applications, especially those in hello data access layer, that have poorly tuned queries might not benefit from a higher performance level.</span></span> <span data-ttu-id="33b77-187">這包括缺少 WHERE 子句、具有遺漏的索引或具有過時統計資料的查詢。</span><span class="sxs-lookup"><span data-stu-id="33b77-187">This includes queries that lack a WHERE clause, have missing indexes, or have outdated statistics.</span></span> <span data-ttu-id="33b77-188">這些應用程式會受益於標準查詢效能微調技術。</span><span class="sxs-lookup"><span data-stu-id="33b77-188">These applications benefit from standard query performance-tuning techniques.</span></span> <span data-ttu-id="33b77-189">如需詳細資訊，請參閱[遺漏索引](#identifying-and-adding-missing-indexes)和[查詢微調和提示](#query-tuning-and-hinting)。</span><span class="sxs-lookup"><span data-stu-id="33b77-189">For more information, see [Missing indexes](#identifying-and-adding-missing-indexes) and [Query tuning and hinting](#query-tuning-and-hinting).</span></span>
* <span data-ttu-id="33b77-190">**具有次佳資料存取設計的應用程式**。</span><span class="sxs-lookup"><span data-stu-id="33b77-190">**Applications that have suboptimal data access design**.</span></span> <span data-ttu-id="33b77-191">具有內在資料存取並行問題的應用程式，例如死結，可能無法受益於較高的效能等級。</span><span class="sxs-lookup"><span data-stu-id="33b77-191">Applications that have inherent data access concurrency issues, for example deadlocking, might not benefit from a higher performance level.</span></span> <span data-ttu-id="33b77-192">請考慮減少針對 hello Azure SQL Database 上 hello 用戶端快取資料以 hello Azure 快取服務的來回存取或另一種快取技術。</span><span class="sxs-lookup"><span data-stu-id="33b77-192">Consider reducing round trips against hello Azure SQL Database by caching data on hello client side with hello Azure Caching service or another caching technology.</span></span> <span data-ttu-id="33b77-193">請參閱 [應用程式層快取](#application-tier-caching)。</span><span class="sxs-lookup"><span data-stu-id="33b77-193">See [Application tier caching](#application-tier-caching).</span></span>

## <a name="tune-your-database"></a><span data-ttu-id="33b77-194">微調資料庫</span><span class="sxs-lookup"><span data-stu-id="33b77-194">Tune your database</span></span>
<span data-ttu-id="33b77-195">在本節中，我們查看一些技術，您可以使用 tootune Azure SQL Database toogain hello 達到最佳效能，您的應用程式，並執行以 hello 最低效能層級。</span><span class="sxs-lookup"><span data-stu-id="33b77-195">In this section, we look at some techniques that you can use tootune Azure SQL Database toogain hello best performance for your application and run it at hello lowest possible performance level.</span></span> <span data-ttu-id="33b77-196">其中一些技術符合傳統的 SQL Server 微調最佳做法，但有些則是特定 tooAzure SQL 資料庫。</span><span class="sxs-lookup"><span data-stu-id="33b77-196">Some of these techniques match traditional SQL Server tuning best practices, but others are specific tooAzure SQL Database.</span></span> <span data-ttu-id="33b77-197">在某些情況下，您可以檢查資料庫 toofind 區域 toofurther 微調的 hello 耗用資源，並擴充 Azure SQL Database 中的傳統 SQL Server 技術 toowork。</span><span class="sxs-lookup"><span data-stu-id="33b77-197">In some cases, you can examine hello consumed resources for a database toofind areas toofurther tune and extend traditional SQL Server techniques toowork in Azure SQL Database.</span></span>

### <a name="identify-performance-issues-using-azure-portal"></a><span data-ttu-id="33b77-198">使用 Azure 入口網站找出效能問題</span><span class="sxs-lookup"><span data-stu-id="33b77-198">Identify performance issues using Azure portal</span></span>
<span data-ttu-id="33b77-199">hello 遵循 hello Azure 入口網站中的工具可協助您分析及修正效能問題與您的 SQL 資料庫：</span><span class="sxs-lookup"><span data-stu-id="33b77-199">hello following tools in hello Azure portal can help you analyze and fix performance issues with your SQL database:</span></span>

* [<span data-ttu-id="33b77-200">查詢效能深入解析</span><span class="sxs-lookup"><span data-stu-id="33b77-200">Query Performance Insight</span></span>](sql-database-query-performance.md)
* [<span data-ttu-id="33b77-201">SQL Database 建議程式</span><span class="sxs-lookup"><span data-stu-id="33b77-201">SQL Database Advisor</span></span>](sql-database-advisor.md)

<span data-ttu-id="33b77-202">hello Azure 入口網站有這兩種工具的詳細資訊及如何 toouse 它們。</span><span class="sxs-lookup"><span data-stu-id="33b77-202">hello Azure portal has more information about both of these tools and how toouse them.</span></span> <span data-ttu-id="33b77-203">tooefficiently 診斷並更正問題，建議您先嘗試 hello Azure 入口網站中的 hello 工具。</span><span class="sxs-lookup"><span data-stu-id="33b77-203">tooefficiently diagnose and correct problems, we recommend that you first try hello tools in hello Azure portal.</span></span> <span data-ttu-id="33b77-204">我們建議您使用 hello 手動微調我們將討論接下來，遺漏索引和查詢微調，在特殊情況下的方法。</span><span class="sxs-lookup"><span data-stu-id="33b77-204">We recommend that you use hello manual tuning approaches that we discuss next, for missing indexes and query tuning, in special cases.</span></span>

<span data-ttu-id="33b77-205">如需識別 Azure SQL Database 中問題的詳細資訊，可在[效能監視](sql-database-single-database-monitor.md)一文中找到。</span><span class="sxs-lookup"><span data-stu-id="33b77-205">Find more information about identifying issues in Azure SQL Database on [performance monitoring](sql-database-single-database-monitor.md) article.</span></span>

### <a name="identifying-and-adding-missing-indexes"></a><span data-ttu-id="33b77-206">找出並新增遺漏的索引</span><span class="sxs-lookup"><span data-stu-id="33b77-206">Identifying and adding missing indexes</span></span>
<span data-ttu-id="33b77-207">常見的問題，OLTP 資料庫效能的相關 toohello 實體資料庫設計。</span><span class="sxs-lookup"><span data-stu-id="33b77-207">A common problem in OLTP database performance relates toohello physical database design.</span></span> <span data-ttu-id="33b77-208">資料庫結構描述的設計和轉移通常不會經過大規模測試 (無論是在負載或資料數量)。</span><span class="sxs-lookup"><span data-stu-id="33b77-208">Often, database schemas are designed and shipped without testing at scale (either in load or in data volume).</span></span> <span data-ttu-id="33b77-209">不幸的是，hello 效能的查詢計劃可能會接受小的標尺上，但大大降級生產層級的資料磁碟區 之下。</span><span class="sxs-lookup"><span data-stu-id="33b77-209">Unfortunately, hello performance of a query plan might be acceptable on a small scale but degrade substantially under production-level data volumes.</span></span> <span data-ttu-id="33b77-210">hello 此問題最常見來源是 hello 缺乏適當的索引 toosatisfy 篩選或查詢中的其他限制。</span><span class="sxs-lookup"><span data-stu-id="33b77-210">hello most common source of this issue is hello lack of appropriate indexes toosatisfy filters or other restrictions in a query.</span></span> <span data-ttu-id="33b77-211">遺漏的索引通常會在索引搜尋可以滿足時，以資料表掃描的形式呈現。</span><span class="sxs-lookup"><span data-stu-id="33b77-211">Often, missing indexes manifests as a table scan when an index seek could suffice.</span></span>

<span data-ttu-id="33b77-212">在此範例中，hello 選取的查詢計劃使用掃描時即已足夠搜尋：</span><span class="sxs-lookup"><span data-stu-id="33b77-212">In this example, hello selected query plan uses a scan when a seek would suffice:</span></span>

    DROP TABLE dbo.missingindex;
    CREATE TABLE dbo.missingindex (col1 INT IDENTITY PRIMARY KEY, col2 INT);
    DECLARE @a int = 0;
    SET NOCOUNT ON;
    BEGIN TRANSACTION
    WHILE @a < 20000
    BEGIN
        INSERT INTO dbo.missingindex(col2) VALUES (@a);
        SET @a += 1;
    END
    COMMIT TRANSACTION;
    GO
    SELECT m1.col1
    FROM dbo.missingindex m1 INNER JOIN dbo.missingindex m2 ON(m1.col1=m2.col1)
    WHERE m1.col2 = 4;

![具有遺漏索引的查詢計劃](./media/sql-database-performance-guidance/query_plan_missing_indexes.png)

<span data-ttu-id="33b77-214">Azure SQL Database 可協助您尋找和修正常見的遺漏索引狀況。</span><span class="sxs-lookup"><span data-stu-id="33b77-214">Azure SQL Database can help you find and fix common missing index conditions.</span></span> <span data-ttu-id="33b77-215">Azure SQL Database 內建的 Dmv 查看所在的索引將大幅降低 hello 估計成本 toorun 查詢的查詢編譯。</span><span class="sxs-lookup"><span data-stu-id="33b77-215">DMVs that are built into Azure SQL Database look at query compilations in which an index would significantly reduce hello estimated cost toorun a query.</span></span> <span data-ttu-id="33b77-216">執行查詢時，SQL Database 可讓您追蹤每個查詢計劃的執行頻率，並追蹤 hello 預估執行查詢計劃與 hello hello 之間的間距想像一個該索引存在位置。</span><span class="sxs-lookup"><span data-stu-id="33b77-216">During query execution, SQL Database tracks how often each query plan is executed, and tracks hello estimated gap between hello executing query plan and hello imagined one where that index existed.</span></span> <span data-ttu-id="33b77-217">您可以使用這些 Dmv tooquickly 猜測哪些變更 tooyour 實體資料庫設計可能會改善資料庫和及其真實工作負載的整體工作負載成本。</span><span class="sxs-lookup"><span data-stu-id="33b77-217">You can use these DMVs tooquickly guess which changes tooyour physical database design might improve overall workload cost for a database and its real workload.</span></span>

<span data-ttu-id="33b77-218">您可以使用這個查詢 tooevaluate 可能會遺漏索引：</span><span class="sxs-lookup"><span data-stu-id="33b77-218">You can use this query tooevaluate potential missing indexes:</span></span>

    SELECT CONVERT (varchar, getdate(), 126) AS runtime,
        mig.index_group_handle, mid.index_handle,
        CONVERT (decimal (28,1), migs.avg_total_user_cost * migs.avg_user_impact *
                (migs.user_seeks + migs.user_scans)) AS improvement_measure,
        'CREATE INDEX missing_index_' + CONVERT (varchar, mig.index_group_handle) + '_' +
                  CONVERT (varchar, mid.index_handle) + ' ON ' + mid.statement + '
                  (' + ISNULL (mid.equality_columns,'')
                  + CASE WHEN mid.equality_columns IS NOT NULL
                              AND mid.inequality_columns IS NOT NULL
                         THEN ',' ELSE '' END + ISNULL (mid.inequality_columns, '')
                  + ')'
                  + ISNULL (' INCLUDE (' + mid.included_columns + ')', '') AS create_index_statement,
        migs.*,
        mid.database_id,
        mid.[object_id]
    FROM sys.dm_db_missing_index_groups AS mig
    INNER JOIN sys.dm_db_missing_index_group_stats AS migs
        ON migs.group_handle = mig.index_group_handle
    INNER JOIN sys.dm_db_missing_index_details AS mid
        ON mig.index_handle = mid.index_handle
    ORDER BY migs.avg_total_user_cost * migs.avg_user_impact * (migs.user_seeks + migs.user_scans) DESC

<span data-ttu-id="33b77-219">在此範例中，hello 查詢導致這項建議：</span><span class="sxs-lookup"><span data-stu-id="33b77-219">In this example, hello query resulted in this suggestion:</span></span>

    CREATE INDEX missing_index_5006_5005 ON [dbo].[missingindex] ([col2])  

<span data-ttu-id="33b77-220">它建立之後，該相同的 SELECT 陳述式會挑選不同的計劃，而不是掃描的速度，會使用搜尋，並接著會更有效率地執行 hello 計劃：</span><span class="sxs-lookup"><span data-stu-id="33b77-220">After it's created, that same SELECT statement picks a different plan, which uses a seek instead of a scan, and then executes hello plan more efficiently:</span></span>

![具有已更正索引的查詢計劃](./media/sql-database-performance-guidance/query_plan_corrected_indexes.png)

<span data-ttu-id="33b77-222">hello 重要深入解析為該 hello 共用 I/O 容量，商品系統限制比專用的伺服器電腦的多。</span><span class="sxs-lookup"><span data-stu-id="33b77-222">hello key insight is that hello I/O capacity of a shared, commodity system is more limited than that of a dedicated server machine.</span></span> <span data-ttu-id="33b77-223">最小化在 hello DTU hello Azure SQL Database 服務層的每個效能層級的 hello 系統的不必要 I/O tootake 優點最大沒有 premium。</span><span class="sxs-lookup"><span data-stu-id="33b77-223">There's a premium on minimizing unnecessary I/O tootake maximum advantage of hello system in hello DTU of each performance level of hello Azure SQL Database service tiers.</span></span> <span data-ttu-id="33b77-224">選擇適當的實體資料庫設計可以大幅改善個別查詢的 hello 延遲、 改善並行處理的要求每個延展單位的 hello 輸送量和 hello 成本必要的 toosatisfy hello 查詢降至最低。</span><span class="sxs-lookup"><span data-stu-id="33b77-224">Appropriate physical database design choices can significantly improve hello latency for individual queries, improve hello throughput of concurrent requests handled per scale unit, and minimize hello costs required toosatisfy hello query.</span></span> <span data-ttu-id="33b77-225">如需 hello 遺漏索引 Dmv 的詳細資訊，請參閱[sys.dm_db_missing_index_details](https://msdn.microsoft.com/library/ms345434.aspx)。</span><span class="sxs-lookup"><span data-stu-id="33b77-225">For more information about hello missing index DMVs, see [sys.dm_db_missing_index_details](https://msdn.microsoft.com/library/ms345434.aspx).</span></span>

### <a name="query-tuning-and-hinting"></a><span data-ttu-id="33b77-226">查詢微調和提示</span><span class="sxs-lookup"><span data-stu-id="33b77-226">Query tuning and hinting</span></span>
<span data-ttu-id="33b77-227">Azure SQL Database 中的 hello 查詢最佳化工具是類似 toohello 傳統 SQL Server 查詢最佳化工具。</span><span class="sxs-lookup"><span data-stu-id="33b77-227">hello query optimizer in Azure SQL Database is similar toohello traditional SQL Server query optimizer.</span></span> <span data-ttu-id="33b77-228">大部分的 hello 最佳做法可以微調查詢和了解 hello 推理模型限制 hello 查詢最佳化工具也會套用 tooAzure SQL 資料庫。</span><span class="sxs-lookup"><span data-stu-id="33b77-228">Most of hello best practices for tuning queries and understanding hello reasoning model limitations for hello query optimizer also apply tooAzure SQL Database.</span></span> <span data-ttu-id="33b77-229">如果您微調查詢 Azure SQL Database 中的，您可能會收到 hello 減少彙整資源需求的另一個好處。</span><span class="sxs-lookup"><span data-stu-id="33b77-229">If you tune queries in Azure SQL Database, you might get hello additional benefit of reducing aggregate resource demands.</span></span> <span data-ttu-id="33b77-230">您的應用程式可能無法 toorun 較低的成本較從未微調的同等項目，因為它可以在較低的效能層級執行。</span><span class="sxs-lookup"><span data-stu-id="33b77-230">Your application might be able toorun at a lower cost than an untuned equivalent because it can run at a lower performance level.</span></span>

<span data-ttu-id="33b77-231">一般 SQL Server 中，且這也適用於 SQL Database tooAzure 範例是 hello 查詢最佳化工具 「 探查 」 參數的方式。</span><span class="sxs-lookup"><span data-stu-id="33b77-231">An example that is common in SQL Server and which also applies tooAzure SQL Database is how hello query optimizer "sniffs" parameters.</span></span> <span data-ttu-id="33b77-232">在編譯期間，hello 查詢最佳化工具會評估 hello 參數 toodetermine 目前值，是否可以產生更接近最佳的查詢計劃。</span><span class="sxs-lookup"><span data-stu-id="33b77-232">During compilation, hello query optimizer evaluates hello current value of a parameter toodetermine whether it can generate a more optimal query plan.</span></span> <span data-ttu-id="33b77-233">雖然這個策略通常會導致 tooa 速度明顯比編譯時沒有已知的參數值的計劃的查詢計畫，但目前 ﹐ imperfectly 同時在 SQL Server 和 Azure SQL Database 中。</span><span class="sxs-lookup"><span data-stu-id="33b77-233">Although this strategy often can lead tooa query plan that is significantly faster than a plan compiled without known parameter values, currently it works imperfectly both in SQL Server and in Azure SQL Database.</span></span> <span data-ttu-id="33b77-234">有時不已探查 hello 參數，以及有時 hello 已探查參數但 hello 產生的計畫為次佳的 hello 組完整的工作負載中的參數值。</span><span class="sxs-lookup"><span data-stu-id="33b77-234">Sometimes hello parameter is not sniffed, and sometimes hello parameter is sniffed but hello generated plan is suboptimal for hello full set of parameter values in a workload.</span></span> <span data-ttu-id="33b77-235">Microsoft 包含查詢提示 （指示詞），因此您可以更自覺指定意圖及覆寫參數探查 hello 預設行為。</span><span class="sxs-lookup"><span data-stu-id="33b77-235">Microsoft includes query hints (directives) so that you can specify intent more deliberately and override hello default behavior of parameter sniffing.</span></span> <span data-ttu-id="33b77-236">通常，如果您使用提示時，您可以修正所在 hello 預設 SQL Server 或 Azure SQL Database 行為並不完美對特定客戶工作負載的情況。</span><span class="sxs-lookup"><span data-stu-id="33b77-236">Often, if you use hints, you can fix cases in which hello default SQL Server or Azure SQL Database behavior is imperfect for a specific customer workload.</span></span>

<span data-ttu-id="33b77-237">hello 下一個範例示範如何 hello 查詢處理器在其中產生次佳的效能和資源需求的計劃。</span><span class="sxs-lookup"><span data-stu-id="33b77-237">hello next example demonstrates how hello query processor can generate a plan that is suboptimal both for performance and resource requirements.</span></span> <span data-ttu-id="33b77-238">此範例也會示範如果您使用查詢提示，則可以降低 SQL Database 的查詢執行時間和資源需求︰</span><span class="sxs-lookup"><span data-stu-id="33b77-238">This example also shows that if you use a query hint, you can reduce query run time and resource requirements for your SQL database:</span></span>

    DROP TABLE psptest1;
    CREATE TABLE psptest1(col1 int primary key identity, col2 int, col3 binary(200));

    DECLARE @a int = 0;
    SET NOCOUNT ON;
    BEGIN TRANSACTION
    WHILE @a < 20000
    BEGIN
        INSERT INTO psptest1(col2) values (1);
        INSERT INTO psptest1(col2) values (@a);
        SET @a += 1;
    END
    COMMIT TRANSACTION
    CREATE INDEX i1 on psptest1(col2);
    GO

    CREATE PROCEDURE psp1 (@param1 int)
    AS
    BEGIN
        INSERT INTO t1 SELECT * FROM psptest1
        WHERE col2 = @param1
        ORDER BY col2;
    END
    GO

    CREATE PROCEDURE psp2 (@param2 int)
    AS
    BEGIN
        INSERT INTO t1 SELECT * FROM psptest1 WHERE col2 = @param2
        ORDER BY col2
        OPTION (OPTIMIZE FOR (@param2 UNKNOWN))
    END
    GO

    CREATE TABLE t1 (col1 int primary key, col2 int, col3 binary(200));
    GO

<span data-ttu-id="33b77-239">hello 安裝程式碼會建立具有扭曲資料分佈的資料表。</span><span class="sxs-lookup"><span data-stu-id="33b77-239">hello setup code creates a table that has skewed data distribution.</span></span> <span data-ttu-id="33b77-240">hello 最佳查詢計劃與已選取哪一個參數為基礎。</span><span class="sxs-lookup"><span data-stu-id="33b77-240">hello optimal query plan differs based on which parameter is selected.</span></span> <span data-ttu-id="33b77-241">不幸的是，hello 計畫快取行為不會永遠重新編譯 hello 查詢是根據 hello 最常用的參數值。</span><span class="sxs-lookup"><span data-stu-id="33b77-241">Unfortunately, hello plan caching behavior doesn't always recompile hello query based on hello most common parameter value.</span></span> <span data-ttu-id="33b77-242">因此，它可能會快取並用於許多值，即使在不同的計劃可能平均是較佳的計劃選擇次佳計畫 toobe。</span><span class="sxs-lookup"><span data-stu-id="33b77-242">So, it's possible for a suboptimal plan toobe cached and used for many values, even when a different plan might be a better plan choice on average.</span></span> <span data-ttu-id="33b77-243">接著 hello 查詢計畫會建立兩個完全相同，不同之處在於其中一個有特殊的查詢提示的預存程序。</span><span class="sxs-lookup"><span data-stu-id="33b77-243">Then hello query plan creates two stored procedures that are identical, except that one has a special query hint.</span></span>

<span data-ttu-id="33b77-244">**範例 (第 1 部分)**</span><span class="sxs-lookup"><span data-stu-id="33b77-244">**Example, part 1**</span></span>

    -- Prime Procedure Cache with scan plan
    EXEC psp1 @param1=1;
    TRUNCATE TABLE t1;

    -- Iterate multiple times tooshow hello performance difference
    DECLARE @i int = 0;
    WHILE @i < 1000
    BEGIN
        EXEC psp1 @param1=2;
        TRUNCATE TABLE t1;
        SET @i += 1;
    END

<span data-ttu-id="33b77-245">**範例 (第 2 部分)**</span><span class="sxs-lookup"><span data-stu-id="33b77-245">**Example, part 2**</span></span>

<span data-ttu-id="33b77-246">（我們建議您等待至少 10 分鐘的時間才能開始 hello 範例中，第 2 部分，以便在 hello 所產生的遙測資料截然不同 hello 結果）。</span><span class="sxs-lookup"><span data-stu-id="33b77-246">(We recommend that you wait at least 10 minutes before you begin part 2 of hello example, so that hello results are distinct in hello resulting telemetry data.)</span></span>

    EXEC psp2 @param2=1;
    TRUNCATE TABLE t1;

    DECLARE @i int = 0;
    WHILE @i < 1000
    BEGIN
        EXEC psp2 @param2=2;
        TRUNCATE TABLE t1;
        SET @i += 1;
    END

<span data-ttu-id="33b77-247">此範例中的每個部分嘗試 toorun 參數化的 insert 陳述式 1,000 次 (toogenerate 足夠的負載 toouse 做為測試資料集)。</span><span class="sxs-lookup"><span data-stu-id="33b77-247">Each part of this example attempts toorun a parameterized insert statement 1,000 times (toogenerate a sufficient load toouse as a test data set).</span></span> <span data-ttu-id="33b77-248">當它執行預存程序時，hello 查詢處理器會檢查其 （參數 「 探查 」） 的第一次編譯期間所傳入 toohello 程序的 hello 參數值。</span><span class="sxs-lookup"><span data-stu-id="33b77-248">When it executes stored procedures, hello query processor examines hello parameter value that is passed toohello procedure during its first compilation (parameter "sniffing").</span></span> <span data-ttu-id="33b77-249">hello 處理器快取 hello 產生的計畫，而且會將它用於更新的引動過程，即使 hello 參數值不同。</span><span class="sxs-lookup"><span data-stu-id="33b77-249">hello processor caches hello resulting plan and uses it for later invocations, even if hello parameter value is different.</span></span> <span data-ttu-id="33b77-250">hello 最佳計劃可能會不能在所有情況下。</span><span class="sxs-lookup"><span data-stu-id="33b77-250">hello optimal plan might not be used in all cases.</span></span> <span data-ttu-id="33b77-251">有時候您需要 tooguide hello 最佳化工具 toopick hello 平均案例，而不是 hello 特定情況下從第一次編譯 hello 查詢更佳的計劃。</span><span class="sxs-lookup"><span data-stu-id="33b77-251">Sometimes you need tooguide hello optimizer toopick a plan that is better for hello average case rather than hello specific case from when hello query was first compiled.</span></span> <span data-ttu-id="33b77-252">在此範例中，hello 初始計畫會產生 「 掃描 」 計畫，讀取所有資料列 toofind 每個符合 hello 參數的值：</span><span class="sxs-lookup"><span data-stu-id="33b77-252">In this example, hello initial plan generates a "scan" plan that reads all rows toofind each value that matches hello parameter:</span></span>

![使用掃描計劃微調查詢](./media/sql-database-performance-guidance/query_tuning_1.png)

<span data-ttu-id="33b77-254">因為我們使用 hello 值 1 執行 hello 程序，所以 hello 產生的計畫適合 hello 值 1 但 hello 資料表中的所有其他值的次佳。</span><span class="sxs-lookup"><span data-stu-id="33b77-254">Because we executed hello procedure by using hello value 1, hello resulting plan was optimal for hello value 1 but was suboptimal for all other values in hello table.</span></span> <span data-ttu-id="33b77-255">hello 結果可能不是您想要一樣 toopick 每個計劃，隨機的因為 hello 計畫執行速度更慢，並使用更多資源。</span><span class="sxs-lookup"><span data-stu-id="33b77-255">hello result likely isn't what you would want if you were toopick each plan randomly, because hello plan performs more slowly and uses more resources.</span></span>

<span data-ttu-id="33b77-256">如果您執行與 hello 測試`SET STATISTICS IO`設定得`ON`，在此範例中的 hello 邏輯掃描工作已完成幕後 hello。</span><span class="sxs-lookup"><span data-stu-id="33b77-256">If you run hello test with `SET STATISTICS IO` set too`ON`, hello logical scan work in this example is done behind hello scenes.</span></span> <span data-ttu-id="33b77-257">您可以看到有 1,148 讀取 hello 計劃 （這是沒有效率，如果 hello 平均案例是 tooreturn 只有一個資料列） 所完成：</span><span class="sxs-lookup"><span data-stu-id="33b77-257">You can see that there are 1,148 reads done by hello plan (which is inefficient, if hello average case is tooreturn just one row):</span></span>

![使用邏輯掃描微調查詢](./media/sql-database-performance-guidance/query_tuning_2.png)

<span data-ttu-id="33b77-259">hello 第二個部分的 hello 範例 hello 編譯過程中使用查詢提示 tootell hello 最佳化工具 toouse 特定值。</span><span class="sxs-lookup"><span data-stu-id="33b77-259">hello second part of hello example uses a query hint tootell hello optimizer toouse a specific value during hello compilation process.</span></span> <span data-ttu-id="33b77-260">在此情況下，它會強制 hello 查詢處理器 tooignore hello 傳遞值當做 hello 參數，並改為 tooassume `UNKNOWN`。</span><span class="sxs-lookup"><span data-stu-id="33b77-260">In this case, it forces hello query processor tooignore hello value that is passed as hello parameter, and instead tooassume `UNKNOWN`.</span></span> <span data-ttu-id="33b77-261">這是指具有 hello 資料表 （忽略誤差） 中的 hello 平均頻率的 tooa 值。</span><span class="sxs-lookup"><span data-stu-id="33b77-261">This refers tooa value that has hello average frequency in hello table (ignoring skew).</span></span> <span data-ttu-id="33b77-262">hello 產生的計畫是以搜尋為基礎的計畫，比較快，使用較少的資源平均，比 hello 計畫在這個範例的第 1 部分：</span><span class="sxs-lookup"><span data-stu-id="33b77-262">hello resulting plan is a seek-based plan that is faster and uses fewer resources, on average, than hello plan in part 1 of this example:</span></span>

![使用查詢提示微調查詢](./media/sql-database-performance-guidance/query_tuning_3.png)

<span data-ttu-id="33b77-264">您可以看到在 hello hello 效果**sys.resource_stats**資料表 （沒有從您執行 hello 測試並 hello 資料時於其中填入 hello 資料表 hello 時間延遲）。</span><span class="sxs-lookup"><span data-stu-id="33b77-264">You can see hello effect in hello **sys.resource_stats** table (there is a delay from hello time that you execute hello test and when hello data populates hello table).</span></span> <span data-ttu-id="33b77-265">此範例中，第 1 部分期間 hello 22:25:00 時段執行和第 2 部分在 22:35:00 執行。</span><span class="sxs-lookup"><span data-stu-id="33b77-265">For this example, part 1 executed during hello 22:25:00 time window, and part 2 executed at 22:35:00.</span></span> <span data-ttu-id="33b77-266">hello 較早的時段使用的資源比 hello （因為計畫效率改善） 更新版本的其中一個該時間視窗中。</span><span class="sxs-lookup"><span data-stu-id="33b77-266">hello earlier time window used more resources in that time window than hello later one (because of plan efficiency improvements).</span></span>

    SELECT TOP 1000 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![查詢微調範例結果](./media/sql-database-performance-guidance/query_tuning_4.png)

> [!NOTE]
> <span data-ttu-id="33b77-268">雖然在此範例中的 hello 磁碟區是刻意小，hello 的次佳參數的效果可能會顯著，尤其是較大的資料庫。</span><span class="sxs-lookup"><span data-stu-id="33b77-268">Although hello volume in this example is intentionally small, hello effect of suboptimal parameters can be substantial, especially on larger databases.</span></span> <span data-ttu-id="33b77-269">hello 差異，在極端的情況下，可以在快速的情況下 （秒） 之間的速度慢的情況下的小時。</span><span class="sxs-lookup"><span data-stu-id="33b77-269">hello difference, in extreme cases, can be between seconds for fast cases and hours for slow cases.</span></span>
> 
> 

<span data-ttu-id="33b77-270">您可以檢查**sys.resource_stats** toodetermine 是否 hello 測試更多或較少使用的資源使用比其他測試。</span><span class="sxs-lookup"><span data-stu-id="33b77-270">You can examine **sys.resource_stats** toodetermine whether hello resource for a test uses more or fewer resources than another test.</span></span> <span data-ttu-id="33b77-271">當您比較資料時，區隔 hello 計時的測試，讓它們不在 hello hello 在同一個 5 分鐘視窗**sys.resource_stats**檢視。</span><span class="sxs-lookup"><span data-stu-id="33b77-271">When you compare data, separate hello timing of tests so that they are not in hello same 5-minute window in hello **sys.resource_stats** view.</span></span> <span data-ttu-id="33b77-272">hello hello 練習的目標是 toominimize hello 的資源總數和不 toominimize hello 尖峰資源。</span><span class="sxs-lookup"><span data-stu-id="33b77-272">hello goal of hello exercise is toominimize hello total amount of resources used, and not toominimize hello peak resources.</span></span> <span data-ttu-id="33b77-273">一般而言，最佳化一段延遲的程式碼也可減少資源耗用量。</span><span class="sxs-lookup"><span data-stu-id="33b77-273">Generally, optimizing a piece of code for latency also reduces resource consumption.</span></span> <span data-ttu-id="33b77-274">請確定 hello 做的變更 tooan 應用程式所需，且 hello 變更不造成負面影響的人可能會在 hello 應用程式中使用查詢提示的 hello 客戶經驗。</span><span class="sxs-lookup"><span data-stu-id="33b77-274">Make sure that hello changes you make tooan application are necessary, and that hello changes don't negatively affect hello customer experience for someone who might be using query hints in hello application.</span></span>

<span data-ttu-id="33b77-275">通常如果工作負載有一組重複查詢，它會建立有意義 toocapture 並驗證 hello 牽動計畫選擇，因為它在磁碟機 hello 最低資源大小單位必要的 toohost hello 資料庫。</span><span class="sxs-lookup"><span data-stu-id="33b77-275">If a workload has a set of repeating queries, often it makes sense toocapture and validate hello optimality of your plan choices because it drives hello minimum resource size unit required toohost hello database.</span></span> <span data-ttu-id="33b77-276">進行驗證後，偶爾重新檢查您要確定它們已不降級 toohelp hello 計劃。</span><span class="sxs-lookup"><span data-stu-id="33b77-276">After you validate it, occasionally reexamine hello plans toohelp you make sure that they have not degraded.</span></span> <span data-ttu-id="33b77-277">您可以深入了解 [查詢提示 (Transact-SQL)](https://msdn.microsoft.com/library/ms181714.aspx)。</span><span class="sxs-lookup"><span data-stu-id="33b77-277">You can learn more about [query hints (Transact-SQL)](https://msdn.microsoft.com/library/ms181714.aspx).</span></span>

### <a name="cross-database-sharding"></a><span data-ttu-id="33b77-278">跨資料庫分區化</span><span class="sxs-lookup"><span data-stu-id="33b77-278">Cross-database sharding</span></span>
<span data-ttu-id="33b77-279">Azure SQL Database 在商用硬體上執行，因為單一資料庫的 hello 容量限制會低於傳統的內部部署 SQL Server 安裝。</span><span class="sxs-lookup"><span data-stu-id="33b77-279">Because Azure SQL Database runs on commodity hardware, hello capacity limits for a single database are lower than for a traditional on-premises SQL Server installation.</span></span> <span data-ttu-id="33b77-280">Hello 限制 Azure SQL Database 中的單一資料庫內不適合 hello 作業時，有些客戶的使用分區化技術 toospread 資料庫作業的多個資料庫。</span><span class="sxs-lookup"><span data-stu-id="33b77-280">Some customers use sharding techniques toospread database operations over multiple databases when hello operations don't fit inside hello limits of a single database in Azure SQL Database.</span></span> <span data-ttu-id="33b77-281">在 Azure SQL Database 上使用分區化技術的大部分客戶都會在跨多個資料庫的單一維度上分割其資料。</span><span class="sxs-lookup"><span data-stu-id="33b77-281">Most customers who use sharding techniques in Azure SQL Database split their data on a single dimension across multiple databases.</span></span> <span data-ttu-id="33b77-282">這個方法時，您需要 toounderstand OLTP 應用程式通常會執行適用於 tooonly 一個資料列或 tooa 小型群組 hello 結構描述中的資料列的交易。</span><span class="sxs-lookup"><span data-stu-id="33b77-282">For this approach, you need toounderstand that OLTP applications often perform transactions that apply tooonly one row or tooa small group of rows in hello schema.</span></span>

> [!NOTE]
> <span data-ttu-id="33b77-283">SQL Database 現在提供程式庫 tooassist 與分區化。</span><span class="sxs-lookup"><span data-stu-id="33b77-283">SQL Database now provides a library tooassist with sharding.</span></span> <span data-ttu-id="33b77-284">如需詳細資訊，請參閱 [彈性資料庫用戶端程式庫概觀](sql-database-elastic-database-client-library.md)。</span><span class="sxs-lookup"><span data-stu-id="33b77-284">For more information, see [Elastic Database client library overview](sql-database-elastic-database-client-library.md).</span></span>
> 
> 

<span data-ttu-id="33b77-285">例如，如果資料庫有客戶名稱、 訂單及訂單詳細資料 （例如 hello 隨附於 SQL Server 的傳統範例 Northwind 資料庫)，您無法這個資料分割成多個資料庫分組為 hello 與客戶相關的訂單與訂單詳細資料資訊。</span><span class="sxs-lookup"><span data-stu-id="33b77-285">For example, if a database has customer name, order, and order details (like hello traditional example Northwind database that ships with SQL Server), you could split this data into multiple databases by grouping a customer with hello related order and order detail information.</span></span> <span data-ttu-id="33b77-286">您可保證 hello 客戶的資料保持在單一資料庫中。</span><span class="sxs-lookup"><span data-stu-id="33b77-286">You can guarantee that hello customer's data stays in a single database.</span></span> <span data-ttu-id="33b77-287">hello 應用程式會將不同客戶分割到各個資料庫，有效地將 hello 負載分散到多個資料庫。</span><span class="sxs-lookup"><span data-stu-id="33b77-287">hello application would split different customers across databases, effectively spreading hello load across multiple databases.</span></span> <span data-ttu-id="33b77-288">分區化中，客戶不只可以避免在 hello 最大資料庫大小上限，但 Azure SQL Database 也可以處理的工作負載，會明顯地大於 hello 限制的 hello 不同的效能層級，只要每個個別資料庫符合其DTU。</span><span class="sxs-lookup"><span data-stu-id="33b77-288">With sharding, customers not only can avoid hello maximum database size limit, but Azure SQL Database also can process workloads that are significantly larger than hello limits of hello different performance levels, as long as each individual database fits into its DTU.</span></span>

<span data-ttu-id="33b77-289">資料庫分區化不會減少方案的 hello 彙整資源容量，卻是非常有效率地支援非常大型的解決方案，跨多個資料庫。</span><span class="sxs-lookup"><span data-stu-id="33b77-289">Although database sharding doesn't reduce hello aggregate resource capacity for a solution, it's highly effective at supporting very large solutions that are spread over multiple databases.</span></span> <span data-ttu-id="33b77-290">每個資料庫可以在不同的效能層級 toosupport 非常大，資源需求高的 「 有效 」 資料庫中執行。</span><span class="sxs-lookup"><span data-stu-id="33b77-290">Each database can run at a different performance level toosupport very large, "effective" databases with high resource requirements.</span></span>

### <a name="functional-partitioning"></a><span data-ttu-id="33b77-291">功能資料分割</span><span class="sxs-lookup"><span data-stu-id="33b77-291">Functional partitioning</span></span>
<span data-ttu-id="33b77-292">SQL Server 使用者通常會在單一資料庫內結合許多功能。</span><span class="sxs-lookup"><span data-stu-id="33b77-292">SQL Server users often combine many functions in a single database.</span></span> <span data-ttu-id="33b77-293">例如，如果某個應用程式邏輯 toomanage 商店庫存的該資料庫可能有清查之後，追蹤採購單、 預存程序，以及管理月底的報告的索引或具體化檢視相關聯的邏輯。</span><span class="sxs-lookup"><span data-stu-id="33b77-293">For example, if an application has logic toomanage inventory for a store, that database might have logic associated with inventory, tracking purchase orders, stored procedures, and indexed or materialized views that manage end-of-month reporting.</span></span> <span data-ttu-id="33b77-294">這項技術可讓您更輕鬆 tooadminister hello 資料庫作業，像是備份，但它也會跨所有應用程式功能需要您 toosize hello 硬體 toohandle hello 尖峰負載。</span><span class="sxs-lookup"><span data-stu-id="33b77-294">This technique makes it easier tooadminister hello database for operations like backup, but it also requires you toosize hello hardware toohandle hello peak load across all functions of an application.</span></span>

<span data-ttu-id="33b77-295">如果您使用 Azure SQL Database 中的向外延展架構，它是個不錯的主意 toosplit 的不同功能成不同的資料庫應用程式。</span><span class="sxs-lookup"><span data-stu-id="33b77-295">If you use a scale-out architecture in Azure SQL Database, it's a good idea toosplit different functions of an application into different databases.</span></span> <span data-ttu-id="33b77-296">使用這項技術時，每個應用程式都可以獨立縮放。</span><span class="sxs-lookup"><span data-stu-id="33b77-296">By using this technique, each application scales independently.</span></span> <span data-ttu-id="33b77-297">當應用程式變得忙碌 （並 hello hello 資料庫增加的負載），hello 管理員可以選擇每個函式的獨立的效能層級 hello 應用程式中。</span><span class="sxs-lookup"><span data-stu-id="33b77-297">As an application becomes busier (and hello load on hello database increases), hello administrator can choose independent performance levels for each function in hello application.</span></span> <span data-ttu-id="33b77-298">Hello 限制，這種架構，與在應用程式可以是大於單一商用電腦可處理因為 hello 負載分散在多部電腦。</span><span class="sxs-lookup"><span data-stu-id="33b77-298">At hello limit, with this architecture, an application can be larger than a single commodity machine can handle because hello load is spread across multiple machines.</span></span>

### <a name="batch-queries"></a><span data-ttu-id="33b77-299">批次查詢</span><span class="sxs-lookup"><span data-stu-id="33b77-299">Batch queries</span></span>
<span data-ttu-id="33b77-300">對於使用大量的存取資料的應用程式，經常臨機操作查詢，大量的回應時間是花費在 hello 應用程式層與 hello Azure SQL Database 層之間的網路通訊。</span><span class="sxs-lookup"><span data-stu-id="33b77-300">For applications that access data by using high-volume, frequent, ad hoc querying, a substantial amount of response time is spent on network communication between hello application tier and hello Azure SQL Database tier.</span></span> <span data-ttu-id="33b77-301">即使同時 hello 應用程式和 Azure SQL Database 位於相同的資料中心，hello hello 兩者之間的網路延遲可能會大量的資料存取作業放大的 hello。</span><span class="sxs-lookup"><span data-stu-id="33b77-301">Even when both hello application and Azure SQL Database are in hello same data center, hello network latency between hello two might be magnified by a large number of data access operations.</span></span> <span data-ttu-id="33b77-302">round tooreduce hello 網路往返 hello 資料存取作業時，請考慮使用 hello 選項 tooeither 批次 hello 臨機操作查詢或 toocompile 它們做為預存程序。</span><span class="sxs-lookup"><span data-stu-id="33b77-302">tooreduce hello network round trips for hello data access operations, consider using hello option tooeither batch hello ad hoc queries, or toocompile them as stored procedures.</span></span> <span data-ttu-id="33b77-303">如果您批次 hello 臨機操作查詢，您可以以單一路線 tooAzure SQL Database 中的一個大型批次傳送多個查詢。</span><span class="sxs-lookup"><span data-stu-id="33b77-303">If you batch hello ad hoc queries, you can send multiple queries as one large batch in a single trip tooAzure SQL Database.</span></span> <span data-ttu-id="33b77-304">如果您編譯的預存程序中的臨機操作查詢，您無法達到的 hello 如同批次處理它們結果相同。</span><span class="sxs-lookup"><span data-stu-id="33b77-304">If you compile ad hoc queries in a stored procedure, you could achieve hello same result as if you batch them.</span></span> <span data-ttu-id="33b77-305">使用預存程序也可讓您 hello 優點增加快取 hello Azure SQL Database 中的查詢計畫，因此您可以使用 hello hello 機會預存程序一次。</span><span class="sxs-lookup"><span data-stu-id="33b77-305">Using a stored procedure also gives you hello benefit of increasing hello chances of caching hello query plans in Azure SQL Database so you can use hello stored procedure again.</span></span>

<span data-ttu-id="33b77-306">某些應用程式是寫入密集型的。</span><span class="sxs-lookup"><span data-stu-id="33b77-306">Some applications are write-intensive.</span></span> <span data-ttu-id="33b77-307">有時候，您可以考慮 toobatch 如何一起寫入減少 hello 總 I/O 負載的資料庫上。</span><span class="sxs-lookup"><span data-stu-id="33b77-307">Sometimes you can reduce hello total I/O load on a database by considering how toobatch writes together.</span></span> <span data-ttu-id="33b77-308">這通常與在預存程序及特定查詢內使用明確的交易而不是自動認可的交易一樣容易。</span><span class="sxs-lookup"><span data-stu-id="33b77-308">Often, this is as simple as using explicit transactions instead of auto-commit transactions in stored procedures and ad hoc batches.</span></span> <span data-ttu-id="33b77-309">如需評估您可以使用的不同技術，請參閱 [Azure 中 SQL Database 應用程式的批次處理技術](https://msdn.microsoft.com/library/windowsazure/dn132615.aspx)。</span><span class="sxs-lookup"><span data-stu-id="33b77-309">For an evaluation of different techniques you can use, see [Batching techniques for SQL Database applications in Azure](https://msdn.microsoft.com/library/windowsazure/dn132615.aspx).</span></span> <span data-ttu-id="33b77-310">實驗您自己的工作負載 toofind hello 右模型進行批次處理。</span><span class="sxs-lookup"><span data-stu-id="33b77-310">Experiment with your own workload toofind hello right model for batching.</span></span> <span data-ttu-id="33b77-311">會確定 toounderstand 模型可能會有稍微不同的交易一致性保證。</span><span class="sxs-lookup"><span data-stu-id="33b77-311">Be sure toounderstand that a model might have slightly different transactional consistency guarantees.</span></span> <span data-ttu-id="33b77-312">Hello 適當工作負載，資源使用量降到最低必須尋找 hello 的一致性與效能取捨的正確組合。</span><span class="sxs-lookup"><span data-stu-id="33b77-312">Finding hello right workload that minimizes resource use requires finding hello right combination of consistency and performance trade-offs.</span></span>

### <a name="application-tier-caching"></a><span data-ttu-id="33b77-313">應用程式層快取</span><span class="sxs-lookup"><span data-stu-id="33b77-313">Application-tier caching</span></span>
<span data-ttu-id="33b77-314">某些資料庫應用程式具有大量讀取工作負載。</span><span class="sxs-lookup"><span data-stu-id="33b77-314">Some database applications have read-heavy workloads.</span></span> <span data-ttu-id="33b77-315">快取層級可能會降低 hello hello 資料庫上的負載，並使用 Azure SQL Database 可能會降低 hello 效能層級需要的 toosupport 資料庫。</span><span class="sxs-lookup"><span data-stu-id="33b77-315">Caching layers might reduce hello load on hello database and might potentially reduce hello performance level required toosupport a database by using Azure SQL Database.</span></span> <span data-ttu-id="33b77-316">與[Azure Redis 快取](https://azure.microsoft.com/services/cache/)，如果您有大量讀取工作負載時，您可以一次讀取 hello 資料 (或可能是應用程式層電腦，根據設定的方式每一次)，然後將存放在您的 SQL 資料庫以外的該資料。</span><span class="sxs-lookup"><span data-stu-id="33b77-316">With [Azure Redis Cache](https://azure.microsoft.com/services/cache/), if you have a read-heavy workload, you can read hello data once (or perhaps once per application-tier machine, depending on how it is configured), and then store that data outside your SQL database.</span></span> <span data-ttu-id="33b77-317">這是方式 tooreduce 資料庫負載 （CPU 和讀取 I/O），但會影響交易一致性，因為從 hello 快取讀取的 hello 資料可能會與 hello 資料庫中的 hello 資料同步處理。</span><span class="sxs-lookup"><span data-stu-id="33b77-317">This is a way tooreduce database load (CPU and read I/O), but there is an effect on transactional consistency because hello data being read from hello cache might be out of sync with hello data in hello database.</span></span> <span data-ttu-id="33b77-318">雖然許多應用程式可接受一定程度的不一致性，但並非所有工作負載都是如此。</span><span class="sxs-lookup"><span data-stu-id="33b77-318">Although in many applications some level of inconsistency is acceptable, that's not true for all workloads.</span></span> <span data-ttu-id="33b77-319">您應該充分了解應用程式的任何需求，然後再實作應用程式層快取策略。</span><span class="sxs-lookup"><span data-stu-id="33b77-319">You should fully understand any application requirements before you implement an application-tier caching strategy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="33b77-320">後續步驟</span><span class="sxs-lookup"><span data-stu-id="33b77-320">Next steps</span></span>
* <span data-ttu-id="33b77-321">如需服務層的詳細資訊，請參閱 [SQL Database 選項和效能](sql-database-service-tiers.md)</span><span class="sxs-lookup"><span data-stu-id="33b77-321">For more information about service tiers, see [SQL Database options and performance](sql-database-service-tiers.md)</span></span>
* <span data-ttu-id="33b77-322">如需彈性集區的詳細資訊，請參閱[什麼是 Azure 彈性集區？](sql-database-elastic-pool.md)</span><span class="sxs-lookup"><span data-stu-id="33b77-322">For more information about elastic pools, see [What is an Azure elastic pool?](sql-database-elastic-pool.md)</span></span>
* <span data-ttu-id="33b77-323">效能和彈性集區的相關資訊，請參閱[時 tooconsider 彈性集區](sql-database-elastic-pool-guidance.md)</span><span class="sxs-lookup"><span data-stu-id="33b77-323">For information about performance and elastic pools, see [When tooconsider an elastic pool](sql-database-elastic-pool-guidance.md)</span></span>

