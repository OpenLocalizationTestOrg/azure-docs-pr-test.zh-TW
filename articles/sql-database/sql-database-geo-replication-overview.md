---
title: "容錯移轉群組和主動式異地複寫 - Azure SQL Database | Microsoft Docs"
description: "自動容錯移轉群組與主動式異地複寫可讓您在任何 Azure 資料中心設定 4 個資料庫複本，在發生中斷情況時自動進行容錯移轉。"
services: sql-database
documentationcenter: na
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 2a29f657-82fb-4283-9a83-e14a144bfd93
ms.service: sql-database
ms.custom: business continuity
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: NA
ms.date: 07/10/2017
ms.author: sashan
ms.openlocfilehash: 9a2171f59c6192115dc1820e7f033fd783c9e077
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="overview-failover-groups-and-active-geo-replication"></a><span data-ttu-id="ac377-103">概觀︰容錯移轉群組和主動式異地複寫</span><span class="sxs-lookup"><span data-stu-id="ac377-103">Overview: Failover groups and active geo-replication</span></span>
<span data-ttu-id="ac377-104">主動式異地複寫可讓您在相同或不同資料中心位置 (區域) 中設定最多 4 個可讀取的次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-104">Active geo-replication enables you to configure up to four readable secondary databases in the same or different data center locations (regions).</span></span> <span data-ttu-id="ac377-105">在資料中心中斷或在無法連線至主要資料庫的情況下，便可使用次要資料庫進行查詢和容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ac377-105">Secondary databases are available for querying and for failover in the case of a data center outage or the inability to connect to the primary database.</span></span> <span data-ttu-id="ac377-106">容錯移轉必須由使用者的應用程式手動起始。</span><span class="sxs-lookup"><span data-stu-id="ac377-106">The failover must be initiated manually by the application of the user.</span></span> <span data-ttu-id="ac377-107">容錯移轉之後，新的主要資料庫會有不同的連接端點。</span><span class="sxs-lookup"><span data-stu-id="ac377-107">After failover, the new primary has a different connection end-point.</span></span> 

> [!NOTE]
> <span data-ttu-id="ac377-108">主動式異地複寫可供所有區域之所有服務層中的所有資料庫使用。</span><span class="sxs-lookup"><span data-stu-id="ac377-108">Active geo-replication is available for all databases in all service tiers in all regions.</span></span>
>  

<span data-ttu-id="ac377-109">Azure SQL Database 的自動容錯移轉群組 (預覽版) 是一項 SQL Database 功能，其設計目的是要自動管理異地複寫關聯性、連線能力和大規模容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ac377-109">Azure SQL Database auto-failover groups (in-preview) is a SQL Database feature designed to automatically manage geo-replication relationship, connectivity, and failover at scale.</span></span> <span data-ttu-id="ac377-110">客戶若使用此功能，就能夠在導致主要區域中完全或部分喪失 SQL Database 服務可用性的嚴重區域失敗或其他非計劃事件之後，自動復原次要地區中的多個相關資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-110">With it, the customers gain the ability to automatically recover multiple related databases in the secondary region after catastrophic regional failures or other unplanned events that result in full or partial loss of the SQL Database service’s availability in the primary region.</span></span> <span data-ttu-id="ac377-111">此外，他們可以使用可讀取次要資料庫來卸載唯讀工作負載。</span><span class="sxs-lookup"><span data-stu-id="ac377-111">Additionally, they can use the readable secondary databases to offload read-only workloads.</span></span>  <span data-ttu-id="ac377-112">因為自動容錯移轉群組牽涉到多個資料庫，所以必須在主要伺服器上進行設定。</span><span class="sxs-lookup"><span data-stu-id="ac377-112">Because auto-failover groups involve multiple databases they must be configured on the primary server.</span></span> <span data-ttu-id="ac377-113">主要和次要伺服器都必須位於相同的訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="ac377-113">Both primary and secondary servers must be in the same subscription.</span></span> <span data-ttu-id="ac377-114">自動容錯移轉群組支援將群組中的所有資料庫都只複寫到不同區域的一部次要伺服器。</span><span class="sxs-lookup"><span data-stu-id="ac377-114">Auto-failover groups support replication of all databases in the group to only one secondary server in a different region.</span></span> <span data-ttu-id="ac377-115">主動式異地複寫在未搭配自動容錯移轉群組時，於任何區域中最多可以有 4 個次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-115">Active geo-replication, without auto-failover groups, allows up to 4 secondaries in any region.</span></span>

<span data-ttu-id="ac377-116">如果您使用主動式異地複寫，而且主要資料庫因為任何原因而失敗，或者只是需要離線，您可以起始容錯移轉至任何次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-116">If you are using active geo-replication and for any reason your primary database fails, or simply needs to be taken offline, you can initiate failover to any of your secondary databases.</span></span> <span data-ttu-id="ac377-117">容錯移轉至其中一個次要資料庫啟動時，所有其他次要複本會自動連結至新的主要複本。</span><span class="sxs-lookup"><span data-stu-id="ac377-117">When failover is activated to one of the secondary databases, all other secondaries are automatically linked to the new primary.</span></span> <span data-ttu-id="ac377-118">如果您使用自動容錯移轉群組 (預覽版) 來管理資料庫復原，則影響群組中一或多個資料庫的任何中斷都會造自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ac377-118">If you are using auto-failover groups (in-preview) to manage database recovery and any outage that impacts one or several of the databases in the group results in automatic failover.</span></span> <span data-ttu-id="ac377-119">您可以設定最符合您應用程式需求的自動容錯移轉原則，或者您可以選擇不設定而使用手動啟動。</span><span class="sxs-lookup"><span data-stu-id="ac377-119">You can configure the auto-failover policy that best meets your application needs, or you can opt out and use manual activation.</span></span> <span data-ttu-id="ac377-120">此外，自動容錯移轉群組 (預覽版) 還提供在容錯移轉期間仍保持不變的讀寫和唯讀接聽程式端點。</span><span class="sxs-lookup"><span data-stu-id="ac377-120">In addition, auto-failover groups (in-preview) provide read-write and read-only listener end-points that remain unchanged during failovers.</span></span> <span data-ttu-id="ac377-121">無論您使用手動或自動啟動容錯移轉，容錯移轉都會將群組中所有次要資料庫切換到主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-121">Whether you use manual or automatic failover activation, failover switches all secondary databases in the group to primary.</span></span> <span data-ttu-id="ac377-122">資料庫容錯移轉完成後，DNS 記錄會自動更新以將端點重新導向至新的區域。</span><span class="sxs-lookup"><span data-stu-id="ac377-122">After the database failover is completed, the DNS record is automatically updated to redirect the end-points to the new region.</span></span>

<span data-ttu-id="ac377-123">您可以使用主動式異地複寫管理伺服器上或彈性集區中個別資料庫或一組資料庫的複寫和容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ac377-123">You can manage replication and failover of an individual database or a set of databases on a server or in an elastic pool using active geo-replication.</span></span> <span data-ttu-id="ac377-124">您可以使用 [Azure 入口網站](sql-database-geo-replication-portal.md)、[PowerShell](sql-database-geo-replication-powershell.md)、[Transact-SQL](sql-database-geo-replication-transact-sql.md) 或 [REST API](https://msdn.microsoft.com/library/azure/mt163685.aspx) 來進行。</span><span class="sxs-lookup"><span data-stu-id="ac377-124">You can do that using the [Azure portal](sql-database-geo-replication-portal.md), [PowerShell](sql-database-geo-replication-powershell.md), [Transact-SQL](sql-database-geo-replication-transact-sql.md), or the [REST API](https://msdn.microsoft.com/library/azure/mt163685.aspx).</span></span> <span data-ttu-id="ac377-125">容錯移轉之後，請確認已在新的主要資料庫上設定伺服器和資料庫的驗證需求。</span><span class="sxs-lookup"><span data-stu-id="ac377-125">After failover, ensure the authentication requirements for your server and database are configured on the new primary.</span></span> <span data-ttu-id="ac377-126">如需詳細資訊，請參閱 [災害復原後的 SQL Database 安全性](sql-database-geo-replication-security-config.md)。</span><span class="sxs-lookup"><span data-stu-id="ac377-126">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span> <span data-ttu-id="ac377-127">這適用於主動式異地複寫和自動容錯移轉群組 (預覽版) 兩者。</span><span class="sxs-lookup"><span data-stu-id="ac377-127">This applies both to active geo-replication and auto-failover groups (in-preview).</span></span>

<span data-ttu-id="ac377-128">主動式異地複寫會利用 SQL Server 的 [Always On (英文)](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) 技術，使用讀取認可快照隔離 (RCSI) 以非同步方式將主要資料庫上認可的交易複寫到次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-128">Active geo-replication leverages the [Always On](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) technology of SQL Server to asynchronously replicate committed transactions on the primary database to a secondary database using read committed snapshot isolation (RCSI).</span></span> <span data-ttu-id="ac377-129">自動容錯移轉群組在主動式異地複寫之上提供群組語意，但使用相同的非同步複寫機制。</span><span class="sxs-lookup"><span data-stu-id="ac377-129">Auto-failover groups provide the group semantics on top of active geo-replication but the same asynchronous replication mechanism is used.</span></span> <span data-ttu-id="ac377-130">雖然次要資料可能會在任何指定時間點稍微落後主要資料庫，但是次要資料保證絕對不會含有部分交易。</span><span class="sxs-lookup"><span data-stu-id="ac377-130">While at any given point, the secondary database might be slightly behind the primary database, the secondary data is guaranteed to never have partial transactions.</span></span> <span data-ttu-id="ac377-131">跨區域備援可讓應用程式從天然災害、災難性人為錯誤或惡意行為所造成的全部或部分資料中心永久遺失快速復原。</span><span class="sxs-lookup"><span data-stu-id="ac377-131">Cross-region redundancy enables applications to quickly recover from a permanent loss of an entire datacenter or parts of a datacenter caused by natural disasters, catastrophic human errors, or malicious acts.</span></span> <span data-ttu-id="ac377-132">在 [商務持續性概觀](sql-database-business-continuity.md)中可以找到特定的 RPO 資料。</span><span class="sxs-lookup"><span data-stu-id="ac377-132">The specific RPO data can be found at [Overview of Business Continuity](sql-database-business-continuity.md).</span></span>

<span data-ttu-id="ac377-133">下圖顯示以美國中北部區域的主要資料庫和美國中南部區域的次要資料庫所設定的作用中異地複寫範例。</span><span class="sxs-lookup"><span data-stu-id="ac377-133">The following figure shows an example of active geo-replication configured with a primary in the North Central US region and secondary in the South Central US region.</span></span>

![異地複寫關聯性](./media/sql-database-active-geo-replication/geo-replication-relationship.png)

<span data-ttu-id="ac377-135">因為次要資料庫可讀取，所以可用來卸載唯讀工作負載，例如報告作業。</span><span class="sxs-lookup"><span data-stu-id="ac377-135">Because the secondary databases are readable, they can be used to offload read-only workloads such as reporting jobs.</span></span> <span data-ttu-id="ac377-136">如果您使用主動式異地複寫，可以在具有主要資料庫的相同區域中建立次要資料庫，但這樣不會增加應用程式發生嚴重失敗時的恢復能力。</span><span class="sxs-lookup"><span data-stu-id="ac377-136">If you are using active geo-replication, it is possible to create the secondary database in the same region with the primary, but it does not increase the application's resilience to catastrophic failures.</span></span> <span data-ttu-id="ac377-137">如果您使用自動容錯移轉群組 (預覽版)，則一律要在不同區域中建立次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-137">If you are using auto-failover groups (in-preview), your secondary database is always created in a different region.</span></span>

<span data-ttu-id="ac377-138">除了災害復原之外，主動式異地複寫還可用於下列案例︰</span><span class="sxs-lookup"><span data-stu-id="ac377-138">In addition to disaster recovery active geo-replication can be used in the following scenarios:</span></span>

* <span data-ttu-id="ac377-139">**資料庫移轉**：您可以使用主動式異地複寫，以最少的停機時間將資料庫從一部伺服器移轉到另一個線上伺服器。</span><span class="sxs-lookup"><span data-stu-id="ac377-139">**Database migration**: You can use active geo-replication to migrate a database from one server to another online with minimum downtime.</span></span>
* <span data-ttu-id="ac377-140">**應用程式升級**：您可以在應用程式升級期間建立額外的次要資料庫做為容錯回復複本。</span><span class="sxs-lookup"><span data-stu-id="ac377-140">**Application upgrades**: You can create an extra secondary as a fail back copy during application upgrades.</span></span>

<span data-ttu-id="ac377-141">若要達到真正的業務持續性，新增資料中心之間的資料庫備援只是解決方案的一部分。</span><span class="sxs-lookup"><span data-stu-id="ac377-141">To achieve real business continuity, adding database redundancy between datacenters is only part of the solution.</span></span> <span data-ttu-id="ac377-142">在災難性失敗後要端對端復原應用程式 (服務) 需要復原構成服務的所有元件和任何相依的服務。</span><span class="sxs-lookup"><span data-stu-id="ac377-142">Recovering an application (service) end-to-end after a catastrophic failure requires recovery of all components that constitute the service and any dependent services.</span></span> <span data-ttu-id="ac377-143">這些元件的範例包括用戶端軟體 (例如自訂 JavaScript 的瀏覽器)、web 前端、儲存體和 DNS。</span><span class="sxs-lookup"><span data-stu-id="ac377-143">Examples of these components include the client software (for example, a browser with a custom JavaScript), web front ends, storage, and DNS.</span></span> <span data-ttu-id="ac377-144">所有元件都必須對相同的失敗具有恢復功能，並且在應用程式的復原時間目標 (RTO) 內可供使用。</span><span class="sxs-lookup"><span data-stu-id="ac377-144">It is critical that all components are resilient to the same failures and become available within the recovery time objective (RTO) of your application.</span></span> <span data-ttu-id="ac377-145">因此，您需要識別所有相依服務並了解其提供的保證與功能。</span><span class="sxs-lookup"><span data-stu-id="ac377-145">Therefore, you need to identify all dependent services and understand the guarantees and capabilities they provide.</span></span> <span data-ttu-id="ac377-146">然後，您必須採取適當步驟以確保服務功能在它所依賴的服務容錯移轉期間都正常。</span><span class="sxs-lookup"><span data-stu-id="ac377-146">Then, you must take adequate steps to ensure that your service functions during the failover of the services on which it depends.</span></span> <span data-ttu-id="ac377-147">如需有關設計災害復原解決方案的詳細資訊，請參閱[使用主動式異地複寫設計災害復原的雲端解決方案](sql-database-designing-cloud-solutions-for-disaster-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="ac377-147">For more information about designing solutions for disaster recovery, see [Designing Cloud Solutions for Disaster Recovery Using active geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span></span>

## <a name="active-geo-replication-capabilities"></a><span data-ttu-id="ac377-148">主動式異地複寫功能</span><span class="sxs-lookup"><span data-stu-id="ac377-148">Active geo-replication capabilities</span></span>
<span data-ttu-id="ac377-149">主動式異地複寫功能提供下列基本功能：</span><span class="sxs-lookup"><span data-stu-id="ac377-149">The active geo-replication feature provides the following essential capabilities:</span></span>
* <span data-ttu-id="ac377-150">**自動非同步複寫**︰您只能藉由加入至現有資料庫來建立次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-150">**Automatic Asynchronous Replication**: You can only create a secondary database by adding to an existing database.</span></span> <span data-ttu-id="ac377-151">您可以在任何 Azure SQL Database 伺服器建立次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-151">The secondary can be created in any Azure SQL Database server.</span></span> <span data-ttu-id="ac377-152">一旦建立之後，次要資料庫就要填入從主要資料庫複製的資料。</span><span class="sxs-lookup"><span data-stu-id="ac377-152">Once created, the secondary database is populated with the data copied from the primary database.</span></span> <span data-ttu-id="ac377-153">這個程序稱為植入。</span><span class="sxs-lookup"><span data-stu-id="ac377-153">This process is known as seeding.</span></span> <span data-ttu-id="ac377-154">建立並植入次要資料庫之後，主要資料庫的更新會以非同步方式自動複製到次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-154">After secondary database has been created and seeded, updates to the primary database are asynchronously replicated to the secondary database automatically.</span></span> <span data-ttu-id="ac377-155">非同步複寫表示交易會先在主要資料庫上受到認可，才會複製到次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-155">Asynchronous replication means that transactions are committed on the primary database before they are replicated to the secondary database.</span></span> 
* <span data-ttu-id="ac377-156">**可讀取的次要資料庫**：應用程式可以存取次要資料庫，使用用於存取主要資料庫的相同安全性主體或不同安全性主體進行唯讀作業。</span><span class="sxs-lookup"><span data-stu-id="ac377-156">**Readable secondary databases**: An application can access a secondary database for read-only operations using the same or different security principals used for accessing the primary database.</span></span> <span data-ttu-id="ac377-157">在快照集隔離模式中執行次要資料庫，以確保主要資料庫更新的複寫 (記錄重播) 不會被次要資料庫上執行的查詢延遲。</span><span class="sxs-lookup"><span data-stu-id="ac377-157">The secondary databases operate in snapshot isolation mode to ensure replication of the updates of the primary (log replay) is not delayed by queries executed on the secondary.</span></span>

   > [!NOTE]
   > <span data-ttu-id="ac377-158">如果有從主要資料庫接收的結構描述更新，則次要資料庫上的記錄重播會延遲，因為它需要次要資料庫上的結構描述鎖定。</span><span class="sxs-lookup"><span data-stu-id="ac377-158">The log replay is delayed on the secondary database if there are schema updates that it is receiving from the Primary that require a schema lock on the secondary database.</span></span> 
   > 

* <span data-ttu-id="ac377-159">**多個可讀取次要資料庫**：兩個或以上的次要資料庫可增加主要資料庫和應用程式的備援和保護層級。</span><span class="sxs-lookup"><span data-stu-id="ac377-159">**Multiple readable secondaries**: Two or more secondary databases increase redundancy and level of protection for the primary database and application.</span></span> <span data-ttu-id="ac377-160">如果有多個次要資料庫存在，即使其中一個次要資料庫失敗，應用程式仍會受到保護。</span><span class="sxs-lookup"><span data-stu-id="ac377-160">If multiple secondary databases exist, the application remains protected even if one of the secondary databases fails.</span></span> <span data-ttu-id="ac377-161">如果只有一個次要資料庫卻失敗了，應用程式會暴露在更高的風險中，直到建立新的次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-161">If there is only one secondary database, and it fails, the application is exposed to higher risk until a new secondary database is created.</span></span>

   > [!NOTE]
   > <span data-ttu-id="ac377-162">如果您使用主動式異地複寫建置分散在世界各地的應用程式，而且必須在 4 個以上的區域中提供唯讀存取資料，您可以建立次要資料庫的次要資料庫 (稱為鏈結的程序)。</span><span class="sxs-lookup"><span data-stu-id="ac377-162">If you are using active geo-replication to build a globally distributed application and need to provide read-only access to data in more than 4 regions, you can create secondary of a secondary (a process known as chaining).</span></span> <span data-ttu-id="ac377-163">如此一來您就可以達到幾乎無限擴充的資料庫複寫。</span><span class="sxs-lookup"><span data-stu-id="ac377-163">This way you can achieve virtually unlimited scale of database replication.</span></span> <span data-ttu-id="ac377-164">此外，鏈結可減少來自主要資料庫的複寫額外負荷。</span><span class="sxs-lookup"><span data-stu-id="ac377-164">In addition, chaining reduces the overhead of replication from the primary database.</span></span> <span data-ttu-id="ac377-165">缺點是會增加分葉最尾端之次要資料庫上的複寫延遲。</span><span class="sxs-lookup"><span data-stu-id="ac377-165">The trade-off is the increased replication lag on the leaf-most secondary databases.</span></span> <span data-ttu-id="ac377-166">。</span><span class="sxs-lookup"><span data-stu-id="ac377-166">.</span></span> 
   >

* <span data-ttu-id="ac377-167">**支援彈性集區資料庫**：您可以為任何彈性集區中的任何資料庫設定主動式異地複寫。</span><span class="sxs-lookup"><span data-stu-id="ac377-167">**Support of elastic pool databases**: Active geo-replication can be configured for any database in any elastic pool.</span></span> <span data-ttu-id="ac377-168">次要資料庫可以在其他彈性集區中。</span><span class="sxs-lookup"><span data-stu-id="ac377-168">The secondary database can be in another elastic pool.</span></span> <span data-ttu-id="ac377-169">對於一般資料庫，只要服務層相同，次要資料庫可以是彈性集區，反之亦然。</span><span class="sxs-lookup"><span data-stu-id="ac377-169">For regular databases, the secondary can be an elastic pool and vice versa as long as the service tiers are the same.</span></span> 
* <span data-ttu-id="ac377-170">**次要資料庫的可設定效能層級**︰可以使用比主要資料庫低的效能層級建立次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-170">**Configurable performance level of the secondary database**: A secondary database can be created with lower performance level than the primary.</span></span> <span data-ttu-id="ac377-171">主要和次要資料庫必須有相同的服務層。</span><span class="sxs-lookup"><span data-stu-id="ac377-171">Both primary and secondary databases are required to have the same service tier.</span></span> <span data-ttu-id="ac377-172">對於具有高資料庫寫入活動的應用程式不建議使用這個選項，因為增加的複寫延遲會提高容錯移轉後遺失重要資料的風險。</span><span class="sxs-lookup"><span data-stu-id="ac377-172">This option is not recommended for applications with high database write activity because the increased replication lag increases the risk of substantial data loss after a failover.</span></span> <span data-ttu-id="ac377-173">此外，在容錯移轉之後應用程式的效能會受到影響，直到新的主要資料庫升級至較高的效能層級。</span><span class="sxs-lookup"><span data-stu-id="ac377-173">In addition, after failover the application’s performance is impacted until the new primary is upgraded to a higher performance level.</span></span> <span data-ttu-id="ac377-174">在 Azure 入口網站上的記錄 IO 百分比圖表，提供預估次要資料庫承受複寫負載所需的最少效能層級的好方法。</span><span class="sxs-lookup"><span data-stu-id="ac377-174">The log IO percentage chart on Azure portal provides a good way to estimate the minimal performance level of the secondary that is required to sustain the replication load.</span></span> <span data-ttu-id="ac377-175">例如，如果您的主要資料庫是 P6 (1000 DTU) 和其記錄 IO 百分比為 50%，則次要資料庫必須至少是 P4 (500 DTU)。</span><span class="sxs-lookup"><span data-stu-id="ac377-175">For example, if your Primary database is P6 (1000 DTU) and its log IO percent is 50% the secondary needs to be at least P4 (500 DTU).</span></span> <span data-ttu-id="ac377-176">您也可以使用 [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) 或 [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) 資料庫檢視來擷取記錄 IO 資料。</span><span class="sxs-lookup"><span data-stu-id="ac377-176">You can also retrieve the log IO data using [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) or [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) database views.</span></span>  <span data-ttu-id="ac377-177">如需 SQL Database 效能層級的詳細資訊，請參閱 [SQL Database 選項和效能](sql-database-service-tiers.md)。</span><span class="sxs-lookup"><span data-stu-id="ac377-177">For more information on the SQL Database performance levels, see [SQL Database options and performance](sql-database-service-tiers.md).</span></span> 
* <span data-ttu-id="ac377-178">**使用者控制的容錯移轉和容錯回復**：應用程式或使用者可以隨時明確也將次要資料庫切換到主要角色。</span><span class="sxs-lookup"><span data-stu-id="ac377-178">**User-controlled failover and failback**: A secondary database can explicitly be switched to the primary role at any time by the application or the user.</span></span> <span data-ttu-id="ac377-179">在實際的中斷期間，應該使用「非計劃性」選項，這樣會立即將次要升級為主要。</span><span class="sxs-lookup"><span data-stu-id="ac377-179">During a real outage the “unplanned” option should be used, which immediately promotes a secondary to be the primary.</span></span> <span data-ttu-id="ac377-180">當失敗的主要資料庫復原，並且可再次使用時，系統會自動將復原的主要資料庫標示為次要資料庫，並讓它與新的主要資料庫保持更新。</span><span class="sxs-lookup"><span data-stu-id="ac377-180">When the failed primary recovers and is available again, the system automatically marks the recovered primary as a secondary and bring it up-to-date with the new primary.</span></span> <span data-ttu-id="ac377-181">由於複寫的非同步本質，如果主要資料庫在將最新的變更複寫至次要資料庫之前失敗，則非計劃的容錯移轉期間會有少量的資料遺失。</span><span class="sxs-lookup"><span data-stu-id="ac377-181">Due to the asynchronous nature of replication, a small amount of data can be lost during unplanned failovers if a primary fails before it replicates the most recent changes to the secondary.</span></span> <span data-ttu-id="ac377-182">當具有多個次要資料庫的主要資料庫容錯移轉時，系統會自動重新設定複寫關聯性，並且將剩餘的次要資料庫連結至新升級的主要資料庫，而不需要任何使用者介入。</span><span class="sxs-lookup"><span data-stu-id="ac377-182">When a primary with multiple secondaries fails over, the system automatically reconfigures the replication relationships and links the remaining secondaries to the newly promoted primary without requiring any user intervention.</span></span> <span data-ttu-id="ac377-183">解決造成容錯移轉的中斷之後，可能想要讓應用程式返回主要區域。</span><span class="sxs-lookup"><span data-stu-id="ac377-183">After the outage that caused the failover is mitigated, it may be desirable to return the application to the primary region.</span></span> <span data-ttu-id="ac377-184">若要這麼做，應該使用「計劃」選項叫用容錯移轉命令。</span><span class="sxs-lookup"><span data-stu-id="ac377-184">To do that, the failover command should be invoked with the “planned” option.</span></span> 
* <span data-ttu-id="ac377-185">**保持認證和防火牆規則同步**︰我們建議針對異地複寫資料庫使用 [資料庫防火牆規則](sql-database-firewall-configure.md) ，這樣一來，這些規則可以使用資料庫複寫，以確保所有次要資料庫具有與主要資料庫相同的防火牆規則。</span><span class="sxs-lookup"><span data-stu-id="ac377-185">**Keeping credentials and firewall rules in sync**: We recommend using [database firewall rules](sql-database-firewall-configure.md) for geo-replicated databases so these rules can be replicated with the database to ensure all secondary databases have the same firewall rules as the primary.</span></span> <span data-ttu-id="ac377-186">此方法不需要客戶手動設定及維護同時裝載主要和次要資料庫之伺服器上的防火牆規則。</span><span class="sxs-lookup"><span data-stu-id="ac377-186">This approach eliminates the need for customers to manually configure and maintain firewall rules on servers hosting both the primary and secondary databases.</span></span> <span data-ttu-id="ac377-187">同樣地，針對資料存取使用 [自主資料庫使用者](sql-database-manage-logins.md) ，確保主要與次要資料庫永遠具有相同的使用者認證，在容錯移轉時不會因為登入和密碼不相符而有任何中斷。</span><span class="sxs-lookup"><span data-stu-id="ac377-187">Similarly, using [contained database users](sql-database-manage-logins.md) for data access ensures both primary and secondary databases always have the same user credentials so during a failover, there is no disruptions due to mismatches with logins and passwords.</span></span> <span data-ttu-id="ac377-188">使用額外的 [Azure Active Directory](../active-directory/active-directory-whatis.md)，客戶可以管理主要和次要資料庫的使用者存取，並且排除在資料庫中管理認證的需求。</span><span class="sxs-lookup"><span data-stu-id="ac377-188">With the addition of [Azure Active Directory](../active-directory/active-directory-whatis.md), customers can manage user access to both primary and secondary databases and eliminating the need for managing credentials in databases altogether.</span></span>

## <a name="auto-failover-group-capabilities"></a><span data-ttu-id="ac377-189">自動容錯移轉群組功能</span><span class="sxs-lookup"><span data-stu-id="ac377-189">Auto-failover group capabilities</span></span>

<span data-ttu-id="ac377-190">自動容錯移轉群組功能支援群組層級的複寫和自動容錯移轉，提供強大的主動式異地複寫抽象概念。</span><span class="sxs-lookup"><span data-stu-id="ac377-190">Auto-failover groups feature provides a powerful abstraction of active geo-replication by supporting group level replication and automatic failover.</span></span> <span data-ttu-id="ac377-191">此外，它提供額外的接聽程式端點，不需要在容錯移轉之後變更 SQL 連接字串。</span><span class="sxs-lookup"><span data-stu-id="ac377-191">In addition, it removes the necessity to change the SQL connection string after failover by providing the additional listener end-points.</span></span> 

* <span data-ttu-id="ac377-192">**容錯移轉群組**︰可以在不同區域 (主要和次要伺服器) 的兩部伺服器之間建立一或多個容錯移轉群組。</span><span class="sxs-lookup"><span data-stu-id="ac377-192">**Failover group**: One or many failover groups can be created between two servers in different regions (primary and secondary servers).</span></span> <span data-ttu-id="ac377-193">每個群組可包含一或多個作為復原單位的資料庫，以防所有或部分的主要資料庫因為主要區域服務中斷而變成無法使用。</span><span class="sxs-lookup"><span data-stu-id="ac377-193">Each group can include one or several databases that are recovered as a unit in case all or some primary databases become unavailable due to an outage in the primary region.</span></span>  
* <span data-ttu-id="ac377-194">**主要伺服器**︰容錯移轉群組中裝載主要資料庫的伺服器。</span><span class="sxs-lookup"><span data-stu-id="ac377-194">**Primary server**: A server that hosts the primary databases in the failover group.</span></span>
* <span data-ttu-id="ac377-195">**次要伺服器**︰容錯移轉群組中裝載次要資料庫的伺服器。</span><span class="sxs-lookup"><span data-stu-id="ac377-195">**Secondary server**: A server that hosts the secondary databases in the failover group.</span></span> <span data-ttu-id="ac377-196">次要伺服器和主要伺服器不能位於相同區域。</span><span class="sxs-lookup"><span data-stu-id="ac377-196">The secondary server cannot be in the same region as the primary server.</span></span>
* <span data-ttu-id="ac377-197">**在容錯移轉群組中新增資料庫**︰您可以將伺服器或彈性集區內的多個資料庫放在同一個容錯移轉群組中。</span><span class="sxs-lookup"><span data-stu-id="ac377-197">**Adding databases to failover group**: You can put several databases within a server or within an elastic pool into the same failover group.</span></span> <span data-ttu-id="ac377-198">如果您在群組中新增獨立的資料庫，它會使用相同的版本和效能層級自動建立次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-198">If you add a standalone database to the group, it automatically creates a secondary database using the same edition and performance level.</span></span> <span data-ttu-id="ac377-199">如果主要資料庫在彈性集區中，則會使用相同名稱在該彈性集區中建立次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-199">If the primary database is in an elastic pool, the secondary is automatically created in the elastic pool with the same name.</span></span> <span data-ttu-id="ac377-200">如果您新增在次要伺服器中已經有次要資料庫的資料庫，群組就會繼承該異地複寫。</span><span class="sxs-lookup"><span data-stu-id="ac377-200">If you add a database that already has a secondary database in the secondary server, that geo-replication is inherited by the group.</span></span>

   > [!NOTE]
   > <span data-ttu-id="ac377-201">新增在伺服器中已經有次要資料庫但不屬於容錯移轉群組一部分的資料庫時，會在次要伺服器中建立新的次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-201">When adding a database that already has a secondary database in a server that is not part of the failover group, a new secondary is created in the secondary server.</span></span> 
   >

* <span data-ttu-id="ac377-202">**容錯移轉群組讀寫接聽程式**︰指向目前主要伺服器 URL 且格式為 **&lt;容錯移轉群組名稱&gt;.database.windows.net** 的 DNS CNAME 記錄。</span><span class="sxs-lookup"><span data-stu-id="ac377-202">**Failover group read-write listener**: A DNS CNAME record formed as **&lt;failover-group-name&gt;.database.windows.net** that points to the current primary server URL.</span></span> <span data-ttu-id="ac377-203">它可讓讀寫 SQL 應用程式在容錯移轉之後，當主要資料庫變更時毫無障礙地重新連線至主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-203">It allows the read-write SQL applications to transparently reconnect to the primary database when the primary changes after failover.</span></span> 
* <span data-ttu-id="ac377-204">**容錯移轉群組唯讀接聽程式**︰指向目前次要伺服器 URL 且格式為 **&lt;容錯移轉群組名稱&gt;.secondary.database.windows.net** 的 DNS CNAME 記錄。</span><span class="sxs-lookup"><span data-stu-id="ac377-204">**Failover group read-only listener**: A DNS CNAME record formed as **&lt;failover-group-name&gt;.secondary.database.windows.net** that points to the secondary server’s URL.</span></span> <span data-ttu-id="ac377-205">它可讓唯讀 SQL 應用程式使用指定的負載平衡規則毫無障礙地連線到次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-205">It allows the read-only SQL applications to transparently connect to the secondary database using the specified load-balancing rules.</span></span> <span data-ttu-id="ac377-206">您可以選擇性指定當次要伺服器無法使用時，是否要將唯讀流量自動重新導向到主要伺服器。</span><span class="sxs-lookup"><span data-stu-id="ac377-206">Optionally you can specify if you want the read-only traffic to be automatically re-directed to the primary server when the secondary server is not available.</span></span>
* <span data-ttu-id="ac377-207">**自動容錯移轉原則**︰容錯移轉群組預設是利用自動容錯移轉原則設定。</span><span class="sxs-lookup"><span data-stu-id="ac377-207">**Automatic failover policy**: By default, the failover group is configured with an automatic failover policy.</span></span> <span data-ttu-id="ac377-208">一旦偵測到失敗，系統就會觸發容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ac377-208">The system triggers failover as soon as the failure is detected.</span></span> <span data-ttu-id="ac377-209">如果您想要控制應用程式的容錯移轉工作流程，可以關閉自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ac377-209">If you want to control the failover workflow from the application, you can turn off automatic failover.</span></span> 
* <span data-ttu-id="ac377-210">**手動容錯移轉**︰無論自動容錯移轉設定為何，您都可以在任何時候手動起始容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ac377-210">**Manual failover**: You can initiate failover manually at any time regardless of the automatic failover configuration.</span></span> <span data-ttu-id="ac377-211">如果未設定自動容錯移轉原則，就需要手動容錯移轉才能復原容錯移轉群組中的資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-211">If automatic failover policy is not configured manual failover is required to recover databases in the failover group.</span></span> <span data-ttu-id="ac377-212">您可以起始強制或易用容錯移轉 (具有完整的資料同步處理)。</span><span class="sxs-lookup"><span data-stu-id="ac377-212">You can initiate forced or friendly failover (with full data synchronization).</span></span> <span data-ttu-id="ac377-213">後者可用來將作用中伺服器重新放置到主要區域。</span><span class="sxs-lookup"><span data-stu-id="ac377-213">The latter could be used to relocate the active server to the primary region.</span></span> <span data-ttu-id="ac377-214">容錯移轉完成時，DNS 記錄會自動更新以確保能連線到正確的伺服器。</span><span class="sxs-lookup"><span data-stu-id="ac377-214">When failover is completed the DNS records are automatically updated to ensure connectivity to the correct server.</span></span>
* <span data-ttu-id="ac377-215">**資料遺失的寬限期**︰因為主要和次要資料庫是使用非同步複寫進行同步處理，容錯移轉可能會導致資料遺失。</span><span class="sxs-lookup"><span data-stu-id="ac377-215">**Grace period with data loss**: Because the primary and secondary databases are synchronized using asynchronous replication the failover may result in data loss.</span></span> <span data-ttu-id="ac377-216">您可以自訂自動容錯移轉原則，以反映應用程式對資料遺失的容錯程度。</span><span class="sxs-lookup"><span data-stu-id="ac377-216">You can customize the automatic failover policy to reflect your application’s tolerance to data loss.</span></span> <span data-ttu-id="ac377-217">設定 **GracePeriodWithDataLossHours**，可以控制系統在起始可能造成資料遺失的容錯移轉之前等候的時間長度。</span><span class="sxs-lookup"><span data-stu-id="ac377-217">By configuring **GracePeriodWithDataLossHours**, you can control how long the system waits before initiating the failover that is likely to result data loss.</span></span> 

   > [!NOTE]
   > <span data-ttu-id="ac377-218">當系統偵測到群組中的資料庫仍保持線上狀態 (例如，中斷只影響了服務控制平面) 時，它會立即啟動具完整資料同步處理的容錯移轉 (易用容錯移轉)，無論 **GracePeriodWithDataLossHours** 所設定的值為何。</span><span class="sxs-lookup"><span data-stu-id="ac377-218">When system detects that the databases in the group are still online (for example, the outage only impacted the service control plane), it immediately activates the failover with full data synchronization (friendly failover) regardless of the value set by **GracePeriodWithDataLossHours**.</span></span> <span data-ttu-id="ac377-219">此行為可確保復原期間不會遺失任何資料。</span><span class="sxs-lookup"><span data-stu-id="ac377-219">This behavior ensures that there is no data loss during the recovery.</span></span> <span data-ttu-id="ac377-220">寬限期只有在無法使用易用容錯移轉時才有效。</span><span class="sxs-lookup"><span data-stu-id="ac377-220">The grace period takes effect only when a friendly failover is not possible.</span></span> <span data-ttu-id="ac377-221">如果中斷情況在寬限期到期之前就趨緩，則不會啟動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ac377-221">If the outage is mitigated before the grace period expires, the failover is not activated.</span></span>
   >

* <span data-ttu-id="ac377-222">**多個容錯移轉群組**︰您可以為相同的兩部伺服器設定多個容錯移轉群組來控制容錯移轉的規模。</span><span class="sxs-lookup"><span data-stu-id="ac377-222">**Multiple failover groups**: You can configure multiple failover groups for the same pair of servers to control the scale of failovers.</span></span> <span data-ttu-id="ac377-223">每個群組分別進行容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ac377-223">Each group fails over independently.</span></span> <span data-ttu-id="ac377-224">如果您的多租用戶應用程式使用彈性集區，可以使用這項功能來混合每個集區中的主要和次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-224">If your multi-tenant application uses elastic pools, you can use this capability to mix primary and secondary databases in each pool.</span></span> <span data-ttu-id="ac377-225">如此一來，可以讓中斷只影響一半的租用戶。</span><span class="sxs-lookup"><span data-stu-id="ac377-225">This way you can reduce the impact of an outage to only half of the tenants.</span></span>

## <a name="best-practices-of-building-highly-available-service"></a><span data-ttu-id="ac377-226">建置高可用性服務的最佳作法</span><span class="sxs-lookup"><span data-stu-id="ac377-226">Best practices of building highly available service</span></span>

<span data-ttu-id="ac377-227">若要建置使用 Azure SQL Database 的高可用性服務，客戶應遵循下列指導方針︰</span><span class="sxs-lookup"><span data-stu-id="ac377-227">To build a highly available service that uses Azure SQL database the customers should follow these guidelines:</span></span>
- <span data-ttu-id="ac377-228">**使用容錯移轉群組**︰可以在位於不同區域 (主要和次要伺服器) 的兩部伺服器之間建立一或多個容錯移轉群組。</span><span class="sxs-lookup"><span data-stu-id="ac377-228">**Use failover group**: One or many failover groups can be created between two servers in different regions (primary and secondary servers).</span></span> <span data-ttu-id="ac377-229">每個群組可包含一或多個作為復原單位的資料庫，以防所有或部分的主要資料庫因為主要區域服務中斷而變成無法使用。</span><span class="sxs-lookup"><span data-stu-id="ac377-229">Each group can include one or several databases that are recovered as a unit in case all or some primary databases become unavailable due to an outage in the primary region.</span></span> <span data-ttu-id="ac377-230">容錯移轉群組會使用和主要資料庫相同的服務目標，來建立異地次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-230">The failover group creates geo-secondary database with the same service objective as the primary.</span></span> <span data-ttu-id="ac377-231">如果您在容錯移轉群組中新增現有的異地複寫關聯性，請確定地區次要資料庫所設定的服務等級目標和主要資料庫相同。</span><span class="sxs-lookup"><span data-stu-id="ac377-231">If you add an existing geo-replication relationship to the failover group make sure the geo-secondary is configured with the same service level objective as the primary.</span></span>
- <span data-ttu-id="ac377-232">**針對 OLTP 工作負載使用讀取寫入接聽程式**：在執行 OLTP 作業時使用 **&lt;容錯移轉群組名稱&gt;.database.windows.net** 作為伺服器 URL，連線將會自動導向至主要伺服器。</span><span class="sxs-lookup"><span data-stu-id="ac377-232">**Use read-write listener for OLTP workload**: When performing OLTP operations use **&lt;failover-group-name&gt;.database.windows.net** as the server URL and the connections will be automatically directed to the primary.</span></span> <span data-ttu-id="ac377-233">在容錯移轉之後，將不會變更此 URL。</span><span class="sxs-lookup"><span data-stu-id="ac377-233">This URL will not change after the failover.</span></span>  
<span data-ttu-id="ac377-234">請注意，容錯移轉牽涉到更新 DNS 記錄，因此只有在重新整理用戶端 DNS 快取之後，才會將用戶端連線重新導向至新的主要伺服器。</span><span class="sxs-lookup"><span data-stu-id="ac377-234">Note the failover involves updating the DNS record so the client connections will be redirected to the new primary only after the client DNS cache is refreshed.</span></span>
- <span data-ttu-id="ac377-235">**針對唯讀工作負載使用唯讀接聽程式**：如果您有容忍某些過時資料的邏輯隔離唯讀工作負載，則可以使用應用程式中的次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-235">**Use read-only listener for read-only workload**: If you have a logically isolated read-only workload that is tolerant to certain staleness of data, you can use the secondary database in the application.</span></span> <span data-ttu-id="ac377-236">針對唯讀工作階段，請使用 **&lt;容錯移轉群組名稱&gt;.secondary.database.windows.net** 作為伺服器 URL，連線將會自動導向至次要伺服器。</span><span class="sxs-lookup"><span data-stu-id="ac377-236">For read-only sessions use **&lt;failover-group-name&gt;.secondary.database.windows.net** as the server URL and the connection will be automatically directed to the secondary.</span></span> <span data-ttu-id="ac377-237">也建議您使用 **ApplicationIntent=ReadOnly**，在連接字串中表示讀取意圖。</span><span class="sxs-lookup"><span data-stu-id="ac377-237">It is also recommended that you indicate in connection string read intent by using **ApplicationIntent=ReadOnly**.</span></span> 
- <span data-ttu-id="ac377-238">**對效能降低做好心理準備**：應用程式的其餘部分或所使用的其他服務並不會影響 SQL 的容錯移轉決策。</span><span class="sxs-lookup"><span data-stu-id="ac377-238">**Be prepared for perf degradation**: SQL failover decision is independent from the rest of the application or other services used.</span></span> <span data-ttu-id="ac377-239">應用程式可能會「混用」某個區域的某些元件和另一個區域的某些元件。</span><span class="sxs-lookup"><span data-stu-id="ac377-239">The application may be “mixed” with some components in one region and some in another.</span></span> <span data-ttu-id="ac377-240">若要避免效能降低，請務必要在 DR 區域中部署備援應用程式，並遵循本文中的指導方針。</span><span class="sxs-lookup"><span data-stu-id="ac377-240">To avoid the degradation, ensure the redundant application deployment in the DR region and follow the guidelines in this article.</span></span>  
<span data-ttu-id="ac377-241">請注意，DR 區域中的應用程式不一定非得使用不同的連接字串。</span><span class="sxs-lookup"><span data-stu-id="ac377-241">Note the application in the DR region does not have to use a different connection string.</span></span>  
- <span data-ttu-id="ac377-242">**對資料遺失做好心理準備**：如果系統偵測到服務中斷，SQL 會在就我們所知並無資料遺失時，自動觸發讀寫容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ac377-242">**Prepare for data loss**: If an outage is detected, SQL automatically triggers read-write failover if there is zero data loss to the best of our knowledge.</span></span> <span data-ttu-id="ac377-243">否則，它會等候您透過 **GracePeriodWithDataLossHours** 所指定的這段時間。</span><span class="sxs-lookup"><span data-stu-id="ac377-243">Otherwise, it waits for the period you specified by **GracePeriodWithDataLossHours**.</span></span> <span data-ttu-id="ac377-244">如果您指定了 **GracePeriodWithDataLossHours**，請做好可能會遺失資料的心理準備。</span><span class="sxs-lookup"><span data-stu-id="ac377-244">If you specified **GracePeriodWithDataLossHours**, be prepared for data loss.</span></span> <span data-ttu-id="ac377-245">服務中斷期間，Azure 一般會傾向維持可用性。</span><span class="sxs-lookup"><span data-stu-id="ac377-245">In general, during outages, Azure favors availability.</span></span> <span data-ttu-id="ac377-246">如果您無法承擔資料遺失情況，請務必將 **GracePeriodWithDataLossHours** 設定為足夠大的數字，例如 24 小時。</span><span class="sxs-lookup"><span data-stu-id="ac377-246">If you cannot afford data loss, make sure to set **GracePeriodWithDataLossHours** to a sufficiently large number, such as 24 hours.</span></span> 


## <a name="upgrading-or-downgrading-a-primary-database"></a><span data-ttu-id="ac377-247">升級或降級主要資料庫</span><span class="sxs-lookup"><span data-stu-id="ac377-247">Upgrading or downgrading a primary database</span></span>
<span data-ttu-id="ac377-248">您可以將主要資料庫升級或降級至不同的效能層級 (在相同的服務層內)，而不會中斷連接任何次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-248">You can upgrade or downgrade a primary database to a different performance level (within the same service tier) without disconnecting any secondary databases.</span></span> <span data-ttu-id="ac377-249">升級時，我們建議您先升級次要資料庫，然後再升級主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-249">When upgrading, we recommend that you upgrade the secondary database first, and then upgrade the primary.</span></span> <span data-ttu-id="ac377-250">降級時，順序相反︰先降級主要資料庫，然後再降級次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-250">When downgrading, reverse the order: downgrade the primary first, and then downgrade the secondary.</span></span> <span data-ttu-id="ac377-251">當您將資料庫升級或降級到不同的服務層時，會強制執行這項建議。</span><span class="sxs-lookup"><span data-stu-id="ac377-251">When you upgrade or downgrade the database to a different service tier this recommendation is enforced.</span></span> 

> [!NOTE]
> <span data-ttu-id="ac377-252">如果您已在容錯移轉群組設定中建立次要資料庫，則不建議降級次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-252">If you created secondary database as part of the failover group configuration it is not recommended to downgrade the secondary database.</span></span> <span data-ttu-id="ac377-253">這是為了確保您的資料層在容錯移轉啟動之後有足夠的容量來處理一般工作負載。</span><span class="sxs-lookup"><span data-stu-id="ac377-253">This is to ensure your data tier has sufficient capacity to process your regular workload after failover is activated.</span></span> 
>

## <a name="preventing-the-loss-of-critical-data"></a><span data-ttu-id="ac377-254">防止重要資料遺失</span><span class="sxs-lookup"><span data-stu-id="ac377-254">Preventing the loss of critical data</span></span>
<span data-ttu-id="ac377-255">由於廣域網路的高度延遲，連續複製採用非同步複寫機制。</span><span class="sxs-lookup"><span data-stu-id="ac377-255">Due to the high latency of wide area networks, continuous copy uses an asynchronous replication mechanism.</span></span> <span data-ttu-id="ac377-256">如果發生失敗，非同步複寫導致部分資料遺失是無法避免的。</span><span class="sxs-lookup"><span data-stu-id="ac377-256">Asynchronous replication makes some data loss unavoidable if a failure occurs.</span></span> <span data-ttu-id="ac377-257">不過，有些應用程式可能會要求資料不能遺失。</span><span class="sxs-lookup"><span data-stu-id="ac377-257">However, some applications may require no data loss.</span></span> <span data-ttu-id="ac377-258">若要保護這些重大更新，應用程式開發人員可以在認可交易後立即呼叫 [sp_wait_for_database_copy_sync](https://msdn.microsoft.com/library/dn467644.aspx) 系統程序。</span><span class="sxs-lookup"><span data-stu-id="ac377-258">To protect these critical updates, an application developer can call the [sp_wait_for_database_copy_sync](https://msdn.microsoft.com/library/dn467644.aspx) system procedure immediately after committing the transaction.</span></span> <span data-ttu-id="ac377-259">呼叫 **sp_wait_for_database_copy_sync** 會封鎖呼叫執行緒，直到最後認可的交易傳輸到次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-259">Calling **sp_wait_for_database_copy_sync** blocks the calling thread until the last committed transaction has been transmitted to the secondary database.</span></span> <span data-ttu-id="ac377-260">不過，它不會等候在次要資料庫上重新執行和認可傳輸的交易。</span><span class="sxs-lookup"><span data-stu-id="ac377-260">However, it does not wait for the transmitted transactions to be replayed and committed on the secondary.</span></span> <span data-ttu-id="ac377-261">**sp_wait_for_database_copy_sync** 以特定的連續複製連結為範圍。</span><span class="sxs-lookup"><span data-stu-id="ac377-261">**sp_wait_for_database_copy_sync** is scoped to a specific continuous copy link.</span></span> <span data-ttu-id="ac377-262">任何具備主要資料庫連接權限的使用者都可以呼叫此程序。</span><span class="sxs-lookup"><span data-stu-id="ac377-262">Any user with the connection rights to the primary database can call this procedure.</span></span>

> [!NOTE]
> <span data-ttu-id="ac377-263">**sp_wait_for_database_copy_sync** 可避免在容錯移轉之後資料遺失，但是不保證讀取權限會完整同步。</span><span class="sxs-lookup"><span data-stu-id="ac377-263">**sp_wait_for_database_copy_sync** will prevent data loss after failover, but it will not guarantee full synchronization for read access.</span></span> <span data-ttu-id="ac377-264">**sp_wait_for_database_copy_sync** 程序呼叫所造成的延遲可能會相當明顯，且取決於呼叫時的交易記錄大小。</span><span class="sxs-lookup"><span data-stu-id="ac377-264">The delay caused by a **sp_wait_for_database_copy_sync** procedure call can be significant and depends on the size of the transaction log at the time of the call.</span></span> 
> 

## <a name="programmatically-managing-failover-groups-and-active-geo-replication"></a><span data-ttu-id="ac377-265">以程式設計方式管理容錯移轉群組和主動式異地複寫</span><span class="sxs-lookup"><span data-stu-id="ac377-265">Programmatically managing failover groups and active geo-replication</span></span>
<span data-ttu-id="ac377-266">如前所述，自動容錯移轉群組 (預覽版) 和主動式異地複寫也可以使用 Azure PowerShell 和 REST API，以程式設計的方式管理。</span><span class="sxs-lookup"><span data-stu-id="ac377-266">As discussed previously, auto-failover groups (in-preview) and active geo-replication can also be managed programmatically using Azure PowerShell and the REST API.</span></span> <span data-ttu-id="ac377-267">下表描述可用的命令集。</span><span class="sxs-lookup"><span data-stu-id="ac377-267">The following tables describe the set of commands available.</span></span>

<span data-ttu-id="ac377-268">**Azure Resource Manager API 和以角色為基礎的安全性**︰主動式異地複寫包含一組可管理的 Azure Resource Manager API，包括 [Azure SQL Database REST API](https://docs.microsoft.com/rest/api/sql/) 和 [Azure PowerShell Cmdlet](https://docs.microsoft.com/powershell/azure/overview)。</span><span class="sxs-lookup"><span data-stu-id="ac377-268">**Azure Resource Manager API and role-based security**: Active geo-replication includes a set of Azure Resource Manager APIs for management, including the [Azure SQL Database REST API](https://docs.microsoft.com/rest/api/sql/) and [Azure PowerShell cmdlets](https://docs.microsoft.com/powershell/azure/overview).</span></span> <span data-ttu-id="ac377-269">這些 API 需要使用資源群組，並支援以角色為基礎的安全性 (RBAC)。</span><span class="sxs-lookup"><span data-stu-id="ac377-269">These APIs require the use of resource groups and support role-based security (RBAC).</span></span> <span data-ttu-id="ac377-270">如需如何實作存取角色的詳細資訊，請參閱 [Azure 角色型存取控制](../active-directory/role-based-access-control-what-is.md)。</span><span class="sxs-lookup"><span data-stu-id="ac377-270">For more information on how to implement access roles, see [Azure Role-Based Access Control](../active-directory/role-based-access-control-what-is.md).</span></span>

> [!NOTE]
> <span data-ttu-id="ac377-271">只有在使用以 [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) 為基礎的 [Azure SQL REST API](https://msdn.microsoft.com/library/azure/mt163571.aspx) 和 [Azure SQL Database PowerShell Cmdlet](https://msdn.microsoft.com/library/azure/mt574084.aspx) 時，才支援主動式異地複寫的許多新功能。</span><span class="sxs-lookup"><span data-stu-id="ac377-271">Many new features of active geo-replication are only supported using [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) based [Azure SQL REST API](https://msdn.microsoft.com/library/azure/mt163571.aspx) and [Azure SQL Database PowerShell cmdlets](https://msdn.microsoft.com/library/azure/mt574084.aspx).</span></span> <span data-ttu-id="ac377-272">[(傳統) REST API](https://msdn.microsoft.com/library/azure/dn505719.aspx) 和 [Azure SQL Database (傳統) Cmdlet](https://msdn.microsoft.com/library/azure/dn546723.aspx) 支援回溯相容性，因此建議使用以 Azure Resource Manager 為基礎的 API。</span><span class="sxs-lookup"><span data-stu-id="ac377-272">The [(classic) REST API](https://msdn.microsoft.com/library/azure/dn505719.aspx) and [Azure SQL Database (classic) cmdlets](https://msdn.microsoft.com/library/azure/dn546723.aspx) are supported for backward compatibility so using the Azure Resource Manager-based APIs are recommended.</span></span> 
> 

## <a name="manage-sql-database-failover-using-using-transact-sql"></a><span data-ttu-id="ac377-273">管理 SQL database 容錯移轉使用 TRANSACT-SQL</span><span class="sxs-lookup"><span data-stu-id="ac377-273">Manage SQL database failover using using Transact-SQL</span></span>

| <span data-ttu-id="ac377-274">命令</span><span class="sxs-lookup"><span data-stu-id="ac377-274">Command</span></span> | <span data-ttu-id="ac377-275">說明</span><span class="sxs-lookup"><span data-stu-id="ac377-275">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="ac377-276">ALTER DATABASE (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="ac377-276">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="ac377-277">使用 ADD SECONDARY ON SERVER 引數，針對現有資料庫建立次要資料庫並開始資料複寫</span><span class="sxs-lookup"><span data-stu-id="ac377-277">Use ADD SECONDARY ON SERVER argument to create a secondary database for an existing database and starts data replication</span></span> |
| [<span data-ttu-id="ac377-278">ALTER DATABASE (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="ac377-278">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="ac377-279">使用 FAILOVER 或 FORCE_FAILOVER_ALLOW_DATA_LOSS，將次要資料庫切換為主要資料庫以便開始容錯移轉</span><span class="sxs-lookup"><span data-stu-id="ac377-279">Use FAILOVER or FORCE_FAILOVER_ALLOW_DATA_LOSS to switch a secondary database to be primary to initiate failover</span></span> |
| [<span data-ttu-id="ac377-280">ALTER DATABASE (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="ac377-280">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="ac377-281">使用 REMOVE SECONDARY ON SERVER，來終止 SQL Database 和指定次要資料庫間的資料複寫。</span><span class="sxs-lookup"><span data-stu-id="ac377-281">Use REMOVE SECONDARY ON SERVER to terminate a data replication between a SQL Database and the specified secondary database.</span></span> |
| [<span data-ttu-id="ac377-282">sys.geo_replication_links (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="ac377-282">sys.geo_replication_links (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt575501.aspx) |<span data-ttu-id="ac377-283">針對 Azure SQL Database 邏輯伺服器上的每個資料庫，傳回所有結束複寫連結的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="ac377-283">Returns information about all existing replication links for each database on the Azure SQL Database logical server.</span></span> |
| [<span data-ttu-id="ac377-284">sys.dm_geo_replication_link_status (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="ac377-284">sys.dm_geo_replication_link_status (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt575504.aspx) |<span data-ttu-id="ac377-285">針對指定的 SQL Database，取得上次複寫時間、上次複寫延遲，以及複寫連結的其他相關資訊。</span><span class="sxs-lookup"><span data-stu-id="ac377-285">Gets the last replication time, last replication lag, and other information about the replication link for a given SQL database.</span></span> |
| [<span data-ttu-id="ac377-286">sys.dm_operation_status (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="ac377-286">sys.dm_operation_status (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/dn270022.aspx) |<span data-ttu-id="ac377-287">顯示所有資料庫作業的狀態，包括複寫連結的狀態。</span><span class="sxs-lookup"><span data-stu-id="ac377-287">Shows the status for all database operations including the status of the replication links.</span></span> |
| [<span data-ttu-id="ac377-288">sp_wait_for_database_copy_sync (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="ac377-288">sp_wait_for_database_copy_sync (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/dn467644.aspx) |<span data-ttu-id="ac377-289">導致應用程式等候，直到作用中次要資料庫複寫並認可所有認可的交易為止。</span><span class="sxs-lookup"><span data-stu-id="ac377-289">causes the application to wait until all committed transactions are replicated and acknowledged by the active secondary database.</span></span> |
|  | |

## <a name="manage-sql-database-failover-using-using-powershell"></a><span data-ttu-id="ac377-290">SQL 資料庫容錯移轉使用使用 PowerShell 管理</span><span class="sxs-lookup"><span data-stu-id="ac377-290">Manage SQL database failover using using PowerShell</span></span>

| <span data-ttu-id="ac377-291">Cmdlet</span><span class="sxs-lookup"><span data-stu-id="ac377-291">Cmdlet</span></span> | <span data-ttu-id="ac377-292">說明</span><span class="sxs-lookup"><span data-stu-id="ac377-292">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="ac377-293">Get-AzureRmSqlDatabase</span><span class="sxs-lookup"><span data-stu-id="ac377-293">Get-AzureRmSqlDatabase</span></span>](/powershell/module/azurerm.sql/get-azurermsqldatabase) |<span data-ttu-id="ac377-294">取得一或多個資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-294">Gets one or more databases.</span></span> |
| [<span data-ttu-id="ac377-295">New-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="ac377-295">New-AzureRmSqlDatabaseSecondary</span></span>](/powershell/module/azurerm.sql/new-azurermsqldatabasesecondary) |<span data-ttu-id="ac377-296">針對現有資料庫建立次要資料庫並開始資料複寫。</span><span class="sxs-lookup"><span data-stu-id="ac377-296">Creates a secondary database for an existing database and starts data replication.</span></span> |
| [<span data-ttu-id="ac377-297">Set-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="ac377-297">Set-AzureRmSqlDatabaseSecondary</span></span>](/powershell/module/azurerm.sql/set-azurermsqldatabasesecondary) |<span data-ttu-id="ac377-298">將次要資料庫切換為主要資料庫以開始容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ac377-298">Switches a secondary database to be primary to initiate failover.</span></span> |
| [<span data-ttu-id="ac377-299">Remove-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="ac377-299">Remove-AzureRmSqlDatabaseSecondary</span></span>](/powershell/module/azurerm.sql/remove-azurermsqldatabasesecondary) |<span data-ttu-id="ac377-300">終止 SQL Database 和指定次要資料庫間的資料複寫。</span><span class="sxs-lookup"><span data-stu-id="ac377-300">Terminates data replication between a SQL Database and the specified secondary database.</span></span> |
| [<span data-ttu-id="ac377-301">Get-AzureRmSqlDatabaseReplicationLink</span><span class="sxs-lookup"><span data-stu-id="ac377-301">Get-AzureRmSqlDatabaseReplicationLink</span></span>](/powershell/module/azurerm.sql/get-azurermsqldatabasereplicationlink) |<span data-ttu-id="ac377-302">取得 Azure SQL Database 和資源群組或 SQL Server 之間的異地複寫連結。</span><span class="sxs-lookup"><span data-stu-id="ac377-302">Gets the geo-replication links between an Azure SQL Database and a resource group or SQL Server.</span></span> |
| [<span data-ttu-id="ac377-303">New-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="ac377-303">New-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/set-azurermsqldatabasefailovergroup) |   <span data-ttu-id="ac377-304">此命令會建立容錯移轉群組，並同時在主要和次要伺服器上註冊</span><span class="sxs-lookup"><span data-stu-id="ac377-304">This command creates a failover group and registers it on both primary and secondary servers</span></span>|
| [<span data-ttu-id="ac377-305">Remove-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="ac377-305">Remove-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/remove-azurermsqldatabasefailovergroup) | <span data-ttu-id="ac377-306">從伺服器移除容錯移轉群組，並刪除包含群組的所有次要資料庫</span><span class="sxs-lookup"><span data-stu-id="ac377-306">Removes the failover group from the server and deletes all secondary databases included the group</span></span> |
| [<span data-ttu-id="ac377-307">Get-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="ac377-307">Get-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/get-azurermsqldatabasefailovergroup) | <span data-ttu-id="ac377-308">擷取容錯移轉群組設定</span><span class="sxs-lookup"><span data-stu-id="ac377-308">Retrieves the failover group configuration</span></span> |
| [<span data-ttu-id="ac377-309">Set-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="ac377-309">Set-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/set-azurermsqldatabasefailovergroup) |   <span data-ttu-id="ac377-310">修改容錯移轉群組的設定</span><span class="sxs-lookup"><span data-stu-id="ac377-310">Modifies the configuration of the failover group</span></span> |
| [<span data-ttu-id="ac377-311">Switch-AzureRMSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="ac377-311">Switch-AzureRMSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/switch-azurermsqldatabasefailovergroup) | <span data-ttu-id="ac377-312">觸發容錯移轉群組的容錯移轉到次要伺服器</span><span class="sxs-lookup"><span data-stu-id="ac377-312">Triggers failover of the failover group to the secondary server</span></span> |
|  | |

> [!IMPORTANT]
> <span data-ttu-id="ac377-313">如需範例指令碼，請參閱[使用作用中異地複寫設定單一資料庫並進行容錯移轉](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)、[使用作用中異地複寫設定集區資料庫並進行容錯移轉](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md)和[設定單一資料庫的容錯移轉群組並進行容錯移轉] \(預覽\) (scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md。</span><span class="sxs-lookup"><span data-stu-id="ac377-313">For sample scripts, see [Configure and failover a single database using active geo-replication](scripts/sql-database-setup-geodr-and-failover-database-powershell.md), [Configure and failover a pooled database using active geo-replication](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md), and  [Configure and failover a failover group for a single database (preview)](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md.</span></span>
>

## <a name="manage-sql-database-failover-using-the-rest-api"></a><span data-ttu-id="ac377-314">使用 REST API 管理 SQL 資料庫容錯移轉</span><span class="sxs-lookup"><span data-stu-id="ac377-314">Manage SQL database failover using the REST API</span></span>
| <span data-ttu-id="ac377-315">API</span><span class="sxs-lookup"><span data-stu-id="ac377-315">API</span></span> | <span data-ttu-id="ac377-316">說明</span><span class="sxs-lookup"><span data-stu-id="ac377-316">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="ac377-317">Create or Update Database (createMode=Restore)</span><span class="sxs-lookup"><span data-stu-id="ac377-317">Create or Update Database (createMode=Restore)</span></span>](/rest/api/sql/Databases/CreateOrUpdate) |<span data-ttu-id="ac377-318">建立、更新或還原主要或次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-318">Creates, updates, or restores a primary or a secondary database.</span></span> |
| [<span data-ttu-id="ac377-319">取得建立或更新資料庫狀態</span><span class="sxs-lookup"><span data-stu-id="ac377-319">Get Create or Update Database Status</span></span>](/rest/api/sql/Databases/CreateOrUpdate) |<span data-ttu-id="ac377-320">在建立作業期間傳回狀態。</span><span class="sxs-lookup"><span data-stu-id="ac377-320">Returns the status during a create operation.</span></span> |
| [<span data-ttu-id="ac377-321">將次要資料庫設定為主要資料庫 (計劃性容錯移轉)</span><span class="sxs-lookup"><span data-stu-id="ac377-321">Set Secondary Database as Primary (Planned Failover)</span></span>](https://docs.microsoft.com/rest/api/sql/replicationlinkss#ReplicationLinks_Failover) |<span data-ttu-id="ac377-322">從目前主要複本資料庫進行容錯移轉，以設定主要的複本資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-322">Sets which replica database is primary by failing over from the current primary replica database.</span></span> |
| [<span data-ttu-id="ac377-323">將次要資料庫設定為主要資料庫 (非計劃的容錯移轉)</span><span class="sxs-lookup"><span data-stu-id="ac377-323">Set Secondary Database as Primary (Unplanned Failover)</span></span>](https://docs.microsoft.com/rest/api/sql/replicationlinks#ReplicationLinks_FailoverAllowDataLoss) |<span data-ttu-id="ac377-324">從目前主要複本資料庫進行容錯移轉，以設定主要的複本資料庫。</span><span class="sxs-lookup"><span data-stu-id="ac377-324">Sets which replica database is primary by failing over from the current primary replica database.</span></span> <span data-ttu-id="ac377-325">這項作業可能會導致資料遺失。</span><span class="sxs-lookup"><span data-stu-id="ac377-325">This operation might result in data loss.</span></span> |
| [<span data-ttu-id="ac377-326">取得複寫連結</span><span class="sxs-lookup"><span data-stu-id="ac377-326">Get Replication Link</span></span>](/rest/api/sql/replicationlinks/get) |<span data-ttu-id="ac377-327">取得異地複寫關聯性中指定 SQL Database 的特定複寫連結。</span><span class="sxs-lookup"><span data-stu-id="ac377-327">Gets a specific replication link for a given SQL database in a geo-replication partnership.</span></span> <span data-ttu-id="ac377-328">它會擷取 sys.geo_replication_links 目錄檢視中顯示的資訊。</span><span class="sxs-lookup"><span data-stu-id="ac377-328">It retrieves the information visible in the sys.geo_replication_links catalog view.</span></span> |
| [<span data-ttu-id="ac377-329">複寫連結 - 依資料庫列示</span><span class="sxs-lookup"><span data-stu-id="ac377-329">Replication Links - List By Database</span></span>](/rest/api/sql/replicationlinks/listbydatabase) | <span data-ttu-id="ac377-330">取得異地複寫關聯性中指定 SQL Database 的所有複寫連結。</span><span class="sxs-lookup"><span data-stu-id="ac377-330">Gets all replication links for a given SQL database in a geo-replication partnership.</span></span> <span data-ttu-id="ac377-331">它會擷取 sys.geo_replication_links 目錄檢視中顯示的資訊。</span><span class="sxs-lookup"><span data-stu-id="ac377-331">It retrieves the information visible in the sys.geo_replication_links catalog view.</span></span> |
| [<span data-ttu-id="ac377-332">刪除複寫連結</span><span class="sxs-lookup"><span data-stu-id="ac377-332">Delete Replication Link</span></span>](/rest/api/sql/databases/delete) | <span data-ttu-id="ac377-333">刪除資料庫複寫連結。</span><span class="sxs-lookup"><span data-stu-id="ac377-333">Deletes a database replication link.</span></span> <span data-ttu-id="ac377-334">無法在容錯移轉期間進行。</span><span class="sxs-lookup"><span data-stu-id="ac377-334">Cannot be done during failover.</span></span> |
| <span data-ttu-id="ac377-335">[建立或更新容錯移轉群組]/rest/api/sql/failovergroups/createorupdate)</span><span class="sxs-lookup"><span data-stu-id="ac377-335">[Create or Update Failover Group]/rest/api/sql/failovergroups/createorupdate)</span></span> | <span data-ttu-id="ac377-336">建立或更新容錯移轉群組</span><span class="sxs-lookup"><span data-stu-id="ac377-336">Creates or updates a failover group</span></span> |
| [<span data-ttu-id="ac377-337">刪除容錯移轉群組</span><span class="sxs-lookup"><span data-stu-id="ac377-337">Delete Failover Group</span></span>](/rest/api/sql/failovergroups/delete) | <span data-ttu-id="ac377-338">從伺服器中移除容錯移轉群組</span><span class="sxs-lookup"><span data-stu-id="ac377-338">Removes the failover group from the server</span></span> |
| [<span data-ttu-id="ac377-339">容錯移轉 (計劃性)</span><span class="sxs-lookup"><span data-stu-id="ac377-339">Failover (Planned)</span></span>](/rest/api/sql/failovergroups/failover) | <span data-ttu-id="ac377-340">從目前主要伺服器容錯移轉到此伺服器。</span><span class="sxs-lookup"><span data-stu-id="ac377-340">Fails over from the current primary server to this server.</span></span> |
| [<span data-ttu-id="ac377-341">強制容錯移轉允許資料遺失</span><span class="sxs-lookup"><span data-stu-id="ac377-341">Force Failover Allow Data Loss</span></span>](/rest/api/sql/failovergroups/forcefailoverallowdataloss) |<span data-ttu-id="ac377-342">從目前主要伺服器容錯移轉到此伺服器。</span><span class="sxs-lookup"><span data-stu-id="ac377-342">ails over from the current primary server to this server.</span></span> <span data-ttu-id="ac377-343">這項作業可能會導致資料遺失。</span><span class="sxs-lookup"><span data-stu-id="ac377-343">This operation might result in data loss.</span></span> |
| [<span data-ttu-id="ac377-344">取得容錯移轉群組</span><span class="sxs-lookup"><span data-stu-id="ac377-344">Get Failover Group</span></span>](/rest/api/sql/failovergroups/get) | <span data-ttu-id="ac377-345">取得容錯移轉群組。</span><span class="sxs-lookup"><span data-stu-id="ac377-345">Gets a failover group.</span></span> |
| [<span data-ttu-id="ac377-346">依伺服器列出容錯移轉群組</span><span class="sxs-lookup"><span data-stu-id="ac377-346">List Failover Groups By Server</span></span>](/rest/api/sql/failovergroups/listbyserver) | <span data-ttu-id="ac377-347">列出伺服器中的容錯移轉群組。</span><span class="sxs-lookup"><span data-stu-id="ac377-347">Lists the failover groups in a server.</span></span> |
| [<span data-ttu-id="ac377-348">更新容錯移轉群組</span><span class="sxs-lookup"><span data-stu-id="ac377-348">Update Failover Group</span></span>](/rest/api/sql/failovergroups/update) | <span data-ttu-id="ac377-349">更新容錯移轉群組。</span><span class="sxs-lookup"><span data-stu-id="ac377-349">Updates a failover group.</span></span> |
|  | |

## <a name="next-steps"></a><span data-ttu-id="ac377-350">後續步驟</span><span class="sxs-lookup"><span data-stu-id="ac377-350">Next steps</span></span>
* <span data-ttu-id="ac377-351">如需範例指令碼，請參閱：</span><span class="sxs-lookup"><span data-stu-id="ac377-351">For sample scripts, see:</span></span>
   - [<span data-ttu-id="ac377-352">使用作用中異地複寫設定單一資料庫並進行容錯移轉</span><span class="sxs-lookup"><span data-stu-id="ac377-352">Configure and failover a single database using active geo-replication</span></span>](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
   - [<span data-ttu-id="ac377-353">使用作用中異地複寫設定集區資料庫並進行容錯移轉</span><span class="sxs-lookup"><span data-stu-id="ac377-353">Configure and failover a pooled database using active geo-replication</span></span>](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md)
   - [<span data-ttu-id="ac377-354">設定單一資料庫的容錯移轉群組並進行容錯移轉 (預覽)</span><span class="sxs-lookup"><span data-stu-id="ac377-354">Configure and failover a failover group for a single database (preview)</span></span>](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md)
* <span data-ttu-id="ac377-355">如需商務持續性概觀和案例，請參閱 [商務持續性概觀](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="ac377-355">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="ac377-356">若要了解 Azure SQL Database 自動備份，請參閱 [SQL Database 自動備份](sql-database-automated-backups.md)。</span><span class="sxs-lookup"><span data-stu-id="ac377-356">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="ac377-357">若要了解如何使用自動備份進行復原，請參閱 [從服務起始的備份還原資料庫](sql-database-recovery-using-backups.md)。</span><span class="sxs-lookup"><span data-stu-id="ac377-357">To learn about using automated backups for recovery, see [Restore a database from the service-initiated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="ac377-358">若要深入了解新的主要伺服器和資料庫的驗證需求，請參閱 [災害復原後的 SQL Database 安全性](sql-database-geo-replication-security-config.md)。</span><span class="sxs-lookup"><span data-stu-id="ac377-358">To learn about authentication requirements for a new primary server and database, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>

