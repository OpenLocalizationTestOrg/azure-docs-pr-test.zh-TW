---
title: "aaaFailover 群組和作用中地理複寫的 Azure SQL Database |Microsoft 文件"
description: "自動容錯移轉群組與作用中地理複寫可讓您的資料庫中任何 hello Azure 資料中心和 autoomatically 中斷的 hello 事件中的容錯移轉的 toosetup 4 複本。"
services: sql-database
documentationcenter: na
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 2a29f657-82fb-4283-9a83-e14a144bfd93
ms.service: sql-database
ms.custom: business continuity
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: NA
ms.date: 07/10/2017
ms.author: sashan
ms.openlocfilehash: 7a39af8505624c0f19c5abccff051af836b1f9bc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="overview-failover-groups-and-active-geo-replication"></a><span data-ttu-id="081ad-103">概觀︰容錯移轉群組和主動式異地複寫</span><span class="sxs-lookup"><span data-stu-id="081ad-103">Overview: Failover groups and active geo-replication</span></span>
<span data-ttu-id="081ad-104">作用中地理複寫可讓您向上 toofour 可讀取的次要資料庫在 hello tooconfigure 相同或不同資料中心位置 （地區）。</span><span class="sxs-lookup"><span data-stu-id="081ad-104">Active geo-replication enables you tooconfigure up toofour readable secondary databases in hello same or different data center locations (regions).</span></span> <span data-ttu-id="081ad-105">次要資料庫可用來查詢和在 hello 案例中的資料中心中斷或 hello 無法 tooconnect toohello 主要資料庫的容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-105">Secondary databases are available for querying and for failover in hello case of a data center outage or hello inability tooconnect toohello primary database.</span></span> <span data-ttu-id="081ad-106">hello 應用程式的 hello 使用者必須手動起始 hello 容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-106">hello failover must be initiated manually by hello application of hello user.</span></span> <span data-ttu-id="081ad-107">容錯移轉之後，hello 新主要複本會有不同的連接端點。</span><span class="sxs-lookup"><span data-stu-id="081ad-107">After failover, hello new primary has a different connection end-point.</span></span> 

> [!NOTE]
> <span data-ttu-id="081ad-108">主動式異地複寫可供所有區域之所有服務層中的所有資料庫使用。</span><span class="sxs-lookup"><span data-stu-id="081ad-108">Active geo-replication is available for all databases in all service tiers in all regions.</span></span>
>  

<span data-ttu-id="081ad-109">Azure SQL Database 自動容錯移轉群組 （預覽版） 是 SQL Database 功能，特別設計 tooautomatically 管理地理複寫 」 關係、 連接及大規模的容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-109">Azure SQL Database auto-failover groups (in-preview) is a SQL Database feature designed tooautomatically manage geo-replication relationship, connectivity, and failover at scale.</span></span> <span data-ttu-id="081ad-110">Hello 客戶獲得 hello 能力 tooautomatically 之後地區的災難性失敗或其他非計劃的事件，SQL Database 服務會導致完整或部分遺失的 hello, 復原 hello 次要區域中的多個相關的資料庫hello 主要區域中的可用性。</span><span class="sxs-lookup"><span data-stu-id="081ad-110">With it, hello customers gain hello ability tooautomatically recover multiple related databases in hello secondary region after catastrophic regional failures or other unplanned events that result in full or partial loss of hello SQL Database service’s availability in hello primary region.</span></span> <span data-ttu-id="081ad-111">此外，他們可以使用 hello 可讀取次要資料庫 toooffload 唯讀工作負載。</span><span class="sxs-lookup"><span data-stu-id="081ad-111">Additionally, they can use hello readable secondary databases toooffload read-only workloads.</span></span>  <span data-ttu-id="081ad-112">因為自動容錯移轉群組包含多個資料庫，因此必須設定 hello 主要伺服器上。</span><span class="sxs-lookup"><span data-stu-id="081ad-112">Because auto-failover groups involve multiple databases they must be configured on hello primary server.</span></span> <span data-ttu-id="081ad-113">主要和次要伺服器都必須在 hello 相同訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="081ad-113">Both primary and secondary servers must be in hello same subscription.</span></span> <span data-ttu-id="081ad-114">自動容錯移轉群組支援 hello 群組 tooonly 一部次要伺服器位於不同的區域中的所有資料庫的複寫。</span><span class="sxs-lookup"><span data-stu-id="081ad-114">Auto-failover groups support replication of all databases in hello group tooonly one secondary server in a different region.</span></span> <span data-ttu-id="081ad-115">作用中地理複寫，不含自動容錯移轉群組，可讓向上 too4 次要資料庫的任何區域中。</span><span class="sxs-lookup"><span data-stu-id="081ad-115">Active geo-replication, without auto-failover groups, allows up too4 secondaries in any region.</span></span>

<span data-ttu-id="081ad-116">如果您使用作用中地理複寫和任何主要資料庫失敗，原因或只需要 toobe，使其離線，您可以起始容錯移轉 tooany 的次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-116">If you are using active geo-replication and for any reason your primary database fails, or simply needs toobe taken offline, you can initiate failover tooany of your secondary databases.</span></span> <span data-ttu-id="081ad-117">所有其他次要資料庫啟動的 tooone hello 次要資料庫的容錯移轉時，會自動連結的 toohello 新主要複本。</span><span class="sxs-lookup"><span data-stu-id="081ad-117">When failover is activated tooone of hello secondary databases, all other secondaries are automatically linked toohello new primary.</span></span> <span data-ttu-id="081ad-118">如果您使用自動容錯移轉群組 （預覽） toomanage 資料庫復原和任何會影響一個或多個自動容錯移轉中的 hello 群組結果中的 hello 資料庫的中斷。</span><span class="sxs-lookup"><span data-stu-id="081ad-118">If you are using auto-failover groups (in-preview) toomanage database recovery and any outage that impacts one or several of hello databases in hello group results in automatic failover.</span></span> <span data-ttu-id="081ad-119">您可以設定 hello 自動容錯移轉原則以最符合您應用程式的需求，或者您可以退出，並使用手動啟動。</span><span class="sxs-lookup"><span data-stu-id="081ad-119">You can configure hello auto-failover policy that best meets your application needs, or you can opt out and use manual activation.</span></span> <span data-ttu-id="081ad-120">此外，自動容錯移轉群組 (預覽版) 還提供在容錯移轉期間仍保持不變的讀寫和唯讀接聽程式端點。</span><span class="sxs-lookup"><span data-stu-id="081ad-120">In addition, auto-failover groups (in-preview) provide read-write and read-only listener end-points that remain unchanged during failovers.</span></span> <span data-ttu-id="081ad-121">無論您是使用手動或自動容錯移轉啟用，容錯移轉會在 hello 群組 tooprimary 切換所有次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-121">Whether you use manual or automatic failover activation, failover switches all secondary databases in hello group tooprimary.</span></span> <span data-ttu-id="081ad-122">Hello 資料庫容錯移轉完成之後，hello DNS 記錄是自動更新的 tooredirect hello 端點 toohello 新區域。</span><span class="sxs-lookup"><span data-stu-id="081ad-122">After hello database failover is completed, hello DNS record is automatically updated tooredirect hello end-points toohello new region.</span></span>

<span data-ttu-id="081ad-123">您可以使用主動式異地複寫管理伺服器上或彈性集區中個別資料庫或一組資料庫的複寫和容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-123">You can manage replication and failover of an individual database or a set of databases on a server or in an elastic pool using active geo-replication.</span></span> <span data-ttu-id="081ad-124">您可以使用 hello [Azure 入口網站](sql-database-geo-replication-portal.md)， [PowerShell](sql-database-geo-replication-powershell.md)， [TRANSACT-SQL](sql-database-geo-replication-transact-sql.md)，或使用 hello [REST API](https://msdn.microsoft.com/library/azure/mt163685.aspx)。</span><span class="sxs-lookup"><span data-stu-id="081ad-124">You can do that using hello [Azure portal](sql-database-geo-replication-portal.md), [PowerShell](sql-database-geo-replication-powershell.md), [Transact-SQL](sql-database-geo-replication-transact-sql.md), or hello [REST API](https://msdn.microsoft.com/library/azure/mt163685.aspx).</span></span> <span data-ttu-id="081ad-125">容錯移轉之後，確定已 hello 新主要複本上設定您的伺服器和資料庫的 hello 驗證需求。</span><span class="sxs-lookup"><span data-stu-id="081ad-125">After failover, ensure hello authentication requirements for your server and database are configured on hello new primary.</span></span> <span data-ttu-id="081ad-126">如需詳細資訊，請參閱 [災害復原後的 SQL Database 安全性](sql-database-geo-replication-security-config.md)。</span><span class="sxs-lookup"><span data-stu-id="081ad-126">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span> <span data-ttu-id="081ad-127">這適用於這兩個 tooactive 地理複寫 」 和 「 自動容錯移轉群組 （預覽）。</span><span class="sxs-lookup"><span data-stu-id="081ad-127">This applies both tooactive geo-replication and auto-failover groups (in-preview).</span></span>

<span data-ttu-id="081ad-128">作用中地理複寫會運用 hello [Always On](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server)技術的 SQL Server tooasynchronously 複寫 hello 主要資料庫 tooa 次要資料庫上使用 read committed 快照集隔離 (RCSI) 已認可的交易。</span><span class="sxs-lookup"><span data-stu-id="081ad-128">Active geo-replication leverages hello [Always On](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) technology of SQL Server tooasynchronously replicate committed transactions on hello primary database tooa secondary database using read committed snapshot isolation (RCSI).</span></span> <span data-ttu-id="081ad-129">自動容錯移轉群組提供在作用中地理複寫，但使用相同的非同步複寫機制 hello 之上 hello 群組語意。</span><span class="sxs-lookup"><span data-stu-id="081ad-129">Auto-failover groups provide hello group semantics on top of active geo-replication but hello same asynchronous replication mechanism is used.</span></span> <span data-ttu-id="081ad-130">在任何指定的時間點，而 hello 次要資料庫可能稍微落後主要資料庫的 hello、 hello 次要資料保證 toonever 有部分的交易。</span><span class="sxs-lookup"><span data-stu-id="081ad-130">While at any given point, hello secondary database might be slightly behind hello primary database, hello secondary data is guaranteed toonever have partial transactions.</span></span> <span data-ttu-id="081ad-131">跨區域備援可讓您免於永久遺失的整個資料中心或部分天災、 災難性人為錯誤或惡意行為造成資料中心的應用程式 tooquickly 復原。</span><span class="sxs-lookup"><span data-stu-id="081ad-131">Cross-region redundancy enables applications tooquickly recover from a permanent loss of an entire datacenter or parts of a datacenter caused by natural disasters, catastrophic human errors, or malicious acts.</span></span> <span data-ttu-id="081ad-132">hello 特定 RPO 的資料，請參閱[業務續航力概觀](sql-database-business-continuity.md)。</span><span class="sxs-lookup"><span data-stu-id="081ad-132">hello specific RPO data can be found at [Overview of Business Continuity](sql-database-business-continuity.md).</span></span>

<span data-ttu-id="081ad-133">hello 下圖顯示範例的作用中地理複寫設定，在 hello 美國中北部區域的主要和次要 hello 美國中南部區域中。</span><span class="sxs-lookup"><span data-stu-id="081ad-133">hello following figure shows an example of active geo-replication configured with a primary in hello North Central US region and secondary in hello South Central US region.</span></span>

![異地複寫關聯性](./media/sql-database-active-geo-replication/geo-replication-relationship.png)

<span data-ttu-id="081ad-135">Hello 次要資料庫是可讀取的因為它們可能會報告工作，例如使用的 toooffload 唯讀工作負載。</span><span class="sxs-lookup"><span data-stu-id="081ad-135">Because hello secondary databases are readable, they can be used toooffload read-only workloads such as reporting jobs.</span></span> <span data-ttu-id="081ad-136">如果您使用的作用中地理複寫，很可能 toocreate hello 次要資料庫在 hello 相同地區具有 hello 主要伺服器上，但它不會增加 hello 應用程式的恢復功能 toocatastrophic 失敗。</span><span class="sxs-lookup"><span data-stu-id="081ad-136">If you are using active geo-replication, it is possible toocreate hello secondary database in hello same region with hello primary, but it does not increase hello application's resilience toocatastrophic failures.</span></span> <span data-ttu-id="081ad-137">如果您使用自動容錯移轉群組 (預覽版)，則一律要在不同區域中建立次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-137">If you are using auto-failover groups (in-preview), your secondary database is always created in a different region.</span></span>

<span data-ttu-id="081ad-138">此外 toodisaster 復原作用中地理複寫可用於下列案例的 hello:</span><span class="sxs-lookup"><span data-stu-id="081ad-138">In addition toodisaster recovery active geo-replication can be used in hello following scenarios:</span></span>

* <span data-ttu-id="081ad-139">**資料庫移轉**： 您可以使用作用中地理複寫 toomigrate 將資料庫從一部伺服器 tooanother 線上以最少的停機時間。</span><span class="sxs-lookup"><span data-stu-id="081ad-139">**Database migration**: You can use active geo-replication toomigrate a database from one server tooanother online with minimum downtime.</span></span>
* <span data-ttu-id="081ad-140">**應用程式升級**：您可以在應用程式升級期間建立額外的次要資料庫做為容錯回復複本。</span><span class="sxs-lookup"><span data-stu-id="081ad-140">**Application upgrades**: You can create an extra secondary as a fail back copy during application upgrades.</span></span>

<span data-ttu-id="081ad-141">tooachieve 真正的業務連續性，請新增資料中心之間的資料庫備援是屬於 hello 方案。</span><span class="sxs-lookup"><span data-stu-id="081ad-141">tooachieve real business continuity, adding database redundancy between datacenters is only part of hello solution.</span></span> <span data-ttu-id="081ad-142">嚴重的失敗需要的所有元件構成 hello 服務和任何相依的服務復原之後復原應用程式 （服務） 端對端。</span><span class="sxs-lookup"><span data-stu-id="081ad-142">Recovering an application (service) end-to-end after a catastrophic failure requires recovery of all components that constitute hello service and any dependent services.</span></span> <span data-ttu-id="081ad-143">這些元件的範例包括 hello 用戶端軟體 （例如，含自訂 JavaScript 的瀏覽器）、 web 前端、 儲存及 DNS。</span><span class="sxs-lookup"><span data-stu-id="081ad-143">Examples of these components include hello client software (for example, a browser with a custom JavaScript), web front ends, storage, and DNS.</span></span> <span data-ttu-id="081ad-144">很重要的所有元件為彈性 toohello 相同的失敗，而且 hello 復原時間目標 (RTO) 的應用程式內變為可用。</span><span class="sxs-lookup"><span data-stu-id="081ad-144">It is critical that all components are resilient toohello same failures and become available within hello recovery time objective (RTO) of your application.</span></span> <span data-ttu-id="081ad-145">因此，您需要 tooidentify 所有相依的服務，並了解 hello 保證與它們所提供的功能。</span><span class="sxs-lookup"><span data-stu-id="081ad-145">Therefore, you need tooidentify all dependent services and understand hello guarantees and capabilities they provide.</span></span> <span data-ttu-id="081ad-146">然後，您必須採取服務函式期間 hello 它所依賴的 hello 服務的容錯移轉的適當的步驟，tooensure。</span><span class="sxs-lookup"><span data-stu-id="081ad-146">Then, you must take adequate steps tooensure that your service functions during hello failover of hello services on which it depends.</span></span> <span data-ttu-id="081ad-147">如需有關設計災害復原解決方案的詳細資訊，請參閱[使用主動式異地複寫設計災害復原的雲端解決方案](sql-database-designing-cloud-solutions-for-disaster-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="081ad-147">For more information about designing solutions for disaster recovery, see [Designing Cloud Solutions for Disaster Recovery Using active geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span></span>

## <a name="active-geo-replication-capabilities"></a><span data-ttu-id="081ad-148">主動式異地複寫功能</span><span class="sxs-lookup"><span data-stu-id="081ad-148">Active geo-replication capabilities</span></span>
<span data-ttu-id="081ad-149">hello 作用中地理複寫功能提供下列基本功能的 hello:</span><span class="sxs-lookup"><span data-stu-id="081ad-149">hello active geo-replication feature provides hello following essential capabilities:</span></span>
* <span data-ttu-id="081ad-150">**自動非同步複寫**： 您只能藉由新增 tooan 現有的資料庫建立次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-150">**Automatic Asynchronous Replication**: You can only create a secondary database by adding tooan existing database.</span></span> <span data-ttu-id="081ad-151">次要的 hello 可由任何 Azure SQL Database 伺服器中。</span><span class="sxs-lookup"><span data-stu-id="081ad-151">hello secondary can be created in any Azure SQL Database server.</span></span> <span data-ttu-id="081ad-152">一旦建立，hello 次要資料庫會填入 hello hello 主要資料庫從複製的資料。</span><span class="sxs-lookup"><span data-stu-id="081ad-152">Once created, hello secondary database is populated with hello data copied from hello primary database.</span></span> <span data-ttu-id="081ad-153">這個程序稱為植入。</span><span class="sxs-lookup"><span data-stu-id="081ad-153">This process is known as seeding.</span></span> <span data-ttu-id="081ad-154">建立並植入次要資料庫之後，更新 toohello 主要資料庫會以非同步方式自動複寫 toohello 次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-154">After secondary database has been created and seeded, updates toohello primary database are asynchronously replicated toohello secondary database automatically.</span></span> <span data-ttu-id="081ad-155">非同步複寫表示複寫的 toohello 次要資料庫之前，會 hello 主要資料庫上認可交易。</span><span class="sxs-lookup"><span data-stu-id="081ad-155">Asynchronous replication means that transactions are committed on hello primary database before they are replicated toohello secondary database.</span></span> 
* <span data-ttu-id="081ad-156">**可讀取次要資料庫**： 應用程式可以存取的次要資料庫的唯讀作業使用 hello 相同或不同的安全性主體用於存取 hello 主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-156">**Readable secondary databases**: An application can access a secondary database for read-only operations using hello same or different security principals used for accessing hello primary database.</span></span> <span data-ttu-id="081ad-157">hello 次要資料庫在運作，快照集隔離 hello 次要上執行的查詢不延遲模式 tooensure 複寫的主要 hello hello 更新 （重新顯示記錄檔）。</span><span class="sxs-lookup"><span data-stu-id="081ad-157">hello secondary databases operate in snapshot isolation mode tooensure replication of hello updates of hello primary (log replay) is not delayed by queries executed on hello secondary.</span></span>

   > [!NOTE]
   > <span data-ttu-id="081ad-158">如果沒有結構描述更新接收 hello 需要 hello 次要資料庫的結構描述鎖定的主要 hello 次要資料庫上 hello 記錄重新執行就會延遲。</span><span class="sxs-lookup"><span data-stu-id="081ad-158">hello log replay is delayed on hello secondary database if there are schema updates that it is receiving from hello Primary that require a schema lock on hello secondary database.</span></span> 
   > 

* <span data-ttu-id="081ad-159">**多個可讀取次要複本**： 兩個或多個次要資料庫增加備援和保護 hello 主要資料庫和應用程式層級。</span><span class="sxs-lookup"><span data-stu-id="081ad-159">**Multiple readable secondaries**: Two or more secondary databases increase redundancy and level of protection for hello primary database and application.</span></span> <span data-ttu-id="081ad-160">如果存在多個次要資料庫，即使其中一個 hello 次要資料庫失敗 hello 應用程式仍受到保護。</span><span class="sxs-lookup"><span data-stu-id="081ad-160">If multiple secondary databases exist, hello application remains protected even if one of hello secondary databases fails.</span></span> <span data-ttu-id="081ad-161">如果只有一個次要資料庫，但又失敗，系統會公開 hello 應用程式建立新的次要資料庫之前 toohigher 風險。</span><span class="sxs-lookup"><span data-stu-id="081ad-161">If there is only one secondary database, and it fails, hello application is exposed toohigher risk until a new secondary database is created.</span></span>

   > [!NOTE]
   > <span data-ttu-id="081ad-162">如果您使用作用中地理複寫 toobuild 全域散發的應用程式需要 tooprovide 唯讀存取 toodata 超過 4 區域中的，您可以建立次要的次要資料庫 （稱為鏈結的程序）。</span><span class="sxs-lookup"><span data-stu-id="081ad-162">If you are using active geo-replication toobuild a globally distributed application and need tooprovide read-only access toodata in more than 4 regions, you can create secondary of a secondary (a process known as chaining).</span></span> <span data-ttu-id="081ad-163">如此一來您就可以達到幾乎無限擴充的資料庫複寫。</span><span class="sxs-lookup"><span data-stu-id="081ad-163">This way you can achieve virtually unlimited scale of database replication.</span></span> <span data-ttu-id="081ad-164">此外，鏈結可減少 hello 的 hello 主要資料庫複寫的額外負荷。</span><span class="sxs-lookup"><span data-stu-id="081ad-164">In addition, chaining reduces hello overhead of replication from hello primary database.</span></span> <span data-ttu-id="081ad-165">hello 代價是 hello 最分葉的次要資料庫上的 hello 增加的複寫延遲。</span><span class="sxs-lookup"><span data-stu-id="081ad-165">hello trade-off is hello increased replication lag on hello leaf-most secondary databases.</span></span> <span data-ttu-id="081ad-166">.</span><span class="sxs-lookup"><span data-stu-id="081ad-166">.</span></span> 
   >

* <span data-ttu-id="081ad-167">**支援彈性集區資料庫**：您可以為任何彈性集區中的任何資料庫設定主動式異地複寫。</span><span class="sxs-lookup"><span data-stu-id="081ad-167">**Support of elastic pool databases**: Active geo-replication can be configured for any database in any elastic pool.</span></span> <span data-ttu-id="081ad-168">hello 次要資料庫可以是另一個彈性集區中。</span><span class="sxs-lookup"><span data-stu-id="081ad-168">hello secondary database can be in another elastic pool.</span></span> <span data-ttu-id="081ad-169">一般的資料庫，次要 hello 可以彈性集區，而且相同，反之亦然 hello 只要 hello 服務層。</span><span class="sxs-lookup"><span data-stu-id="081ad-169">For regular databases, hello secondary can be an elastic pool and vice versa as long as hello service tiers are hello same.</span></span> 
* <span data-ttu-id="081ad-170">**Hello 次要資料庫可設定的效能層級**： 次要資料庫可以使用建立 hello 較低效能層級主要。</span><span class="sxs-lookup"><span data-stu-id="081ad-170">**Configurable performance level of hello secondary database**: A secondary database can be created with lower performance level than hello primary.</span></span> <span data-ttu-id="081ad-171">主要與次要資料庫所需 toohave hello 相同服務層。</span><span class="sxs-lookup"><span data-stu-id="081ad-171">Both primary and secondary databases are required toohave hello same service tier.</span></span> <span data-ttu-id="081ad-172">這個選項不是建議應用程式使用高資料庫寫入活動因為 hello 增加的複寫延遲會增加容錯移轉之後的 hello 大量的資料遺失風險。</span><span class="sxs-lookup"><span data-stu-id="081ad-172">This option is not recommended for applications with high database write activity because hello increased replication lag increases hello risk of substantial data loss after a failover.</span></span> <span data-ttu-id="081ad-173">此外，容錯移轉 hello 應用程式的效能會受到影響之前 hello 新主要就升級的 tooa 較高的效能層級。</span><span class="sxs-lookup"><span data-stu-id="081ad-173">In addition, after failover hello application’s performance is impacted until hello new primary is upgraded tooa higher performance level.</span></span> <span data-ttu-id="081ad-174">hello Azure 入口網站上的記錄 IO 百分比圖表提供很好的方式 tooestimate hello 所需要的 toosustain hello 複寫負載的 hello 次要的最少的效能層級。</span><span class="sxs-lookup"><span data-stu-id="081ad-174">hello log IO percentage chart on Azure portal provides a good way tooestimate hello minimal performance level of hello secondary that is required toosustain hello replication load.</span></span> <span data-ttu-id="081ad-175">例如，如果主要資料庫是 P6 (1000 DTU) 和其記錄 IO 百分比為 50 %hello 次要需要至少 toobe P4 (500 DTU)。</span><span class="sxs-lookup"><span data-stu-id="081ad-175">For example, if your Primary database is P6 (1000 DTU) and its log IO percent is 50% hello secondary needs toobe at least P4 (500 DTU).</span></span> <span data-ttu-id="081ad-176">您也可以擷取 hello 記錄 IO 資料使用[sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx)或[sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx)資料庫檢視。</span><span class="sxs-lookup"><span data-stu-id="081ad-176">You can also retrieve hello log IO data using [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) or [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) database views.</span></span>  <span data-ttu-id="081ad-177">如需有關 hello SQL Database 效能層級的詳細資訊，請參閱[SQL Database 選項及效能](sql-database-service-tiers.md)。</span><span class="sxs-lookup"><span data-stu-id="081ad-177">For more information on hello SQL Database performance levels, see [SQL Database options and performance](sql-database-service-tiers.md).</span></span> 
* <span data-ttu-id="081ad-178">**使用者控制的容錯移轉和容錯回復**:，次要資料庫可以明確 hello 應用程式或 hello 使用者隨時都能切換的 toohello 主要角色。</span><span class="sxs-lookup"><span data-stu-id="081ad-178">**User-controlled failover and failback**: A secondary database can explicitly be switched toohello primary role at any time by hello application or hello user.</span></span> <span data-ttu-id="081ad-179">實際中斷 hello 期間 「 非計劃 」 選項應，其立即升級次要 toobe hello 主要。</span><span class="sxs-lookup"><span data-stu-id="081ad-179">During a real outage hello “unplanned” option should be used, which immediately promotes a secondary toobe hello primary.</span></span> <span data-ttu-id="081ad-180">Hello 失敗的主要復原和可用時同樣地，hello 系統自動標記 hello 復原主要為次要資料庫並使它與 hello 新主要複本的最新狀態。</span><span class="sxs-lookup"><span data-stu-id="081ad-180">When hello failed primary recovers and is available again, hello system automatically marks hello recovered primary as a secondary and bring it up-to-date with hello new primary.</span></span> <span data-ttu-id="081ad-181">由於複寫 toohello 非同步本質，少量資料可能會遺失未規劃的容錯移轉期間如果主要無法在複寫 hello 最新變更 toohello 次要前。</span><span class="sxs-lookup"><span data-stu-id="081ad-181">Due toohello asynchronous nature of replication, a small amount of data can be lost during unplanned failovers if a primary fails before it replicates hello most recent changes toohello secondary.</span></span> <span data-ttu-id="081ad-182">當多個次要複本與主要容錯移轉時，hello 系統會自動重新設定 hello 複寫關聯性和連結 hello 新剩餘的次要複本 toohello 升級主要而不需要使用者介入。</span><span class="sxs-lookup"><span data-stu-id="081ad-182">When a primary with multiple secondaries fails over, hello system automatically reconfigures hello replication relationships and links hello remaining secondaries toohello newly promoted primary without requiring any user intervention.</span></span> <span data-ttu-id="081ad-183">降低 hello 中斷造成 hello 容錯移轉之後，它可能會希望 tooreturn hello 應用程式 toohello 主要區域。</span><span class="sxs-lookup"><span data-stu-id="081ad-183">After hello outage that caused hello failover is mitigated, it may be desirable tooreturn hello application toohello primary region.</span></span> <span data-ttu-id="081ad-184">toodo hello 容錯移轉命令，應以 hello 叫用 「 計劃 」 選項。</span><span class="sxs-lookup"><span data-stu-id="081ad-184">toodo that, hello failover command should be invoked with hello “planned” option.</span></span> 
* <span data-ttu-id="081ad-185">**保持認證和防火牆規則的同步**： 我們建議使用[資料庫防火牆規則](sql-database-firewall-configure.md)地理複寫的資料庫，這些規則可以複寫 hello 資料庫 tooensure 與所有次要資料庫有hello hello 主要相同的防火牆規則。</span><span class="sxs-lookup"><span data-stu-id="081ad-185">**Keeping credentials and firewall rules in sync**: We recommend using [database firewall rules](sql-database-firewall-configure.md) for geo-replicated databases so these rules can be replicated with hello database tooensure all secondary databases have hello same firewall rules as hello primary.</span></span> <span data-ttu-id="081ad-186">這種方法可以降低對的客戶 toomanually 設定及維護主控同時 hello 主要與次要資料庫伺服器上的防火牆規則的 hello 需求。</span><span class="sxs-lookup"><span data-stu-id="081ad-186">This approach eliminates hello need for customers toomanually configure and maintain firewall rules on servers hosting both hello primary and secondary databases.</span></span> <span data-ttu-id="081ad-187">同樣地，使用[自主資料庫使用者](sql-database-manage-logins.md)資料存取可確保主要與次要資料庫一律具有相同的使用者認證，因此容錯移轉期間，沒有任何中斷的 hello 與登入到期 toomismatches 和密碼。</span><span class="sxs-lookup"><span data-stu-id="081ad-187">Similarly, using [contained database users](sql-database-manage-logins.md) for data access ensures both primary and secondary databases always have hello same user credentials so during a failover, there is no disruptions due toomismatches with logins and passwords.</span></span> <span data-ttu-id="081ad-188">Hello 加入[Azure Active Directory](../active-directory/active-directory-whatis.md)，客戶可以管理使用者存取 tooboth 主要和次要資料庫，以及消除 hello 需要完全管理資料庫中的認證。</span><span class="sxs-lookup"><span data-stu-id="081ad-188">With hello addition of [Azure Active Directory](../active-directory/active-directory-whatis.md), customers can manage user access tooboth primary and secondary databases and eliminating hello need for managing credentials in databases altogether.</span></span>

## <a name="auto-failover-group-capabilities"></a><span data-ttu-id="081ad-189">自動容錯移轉群組功能</span><span class="sxs-lookup"><span data-stu-id="081ad-189">Auto-failover group capabilities</span></span>

<span data-ttu-id="081ad-190">自動容錯移轉群組功能支援群組層級的複寫和自動容錯移轉，提供強大的主動式異地複寫抽象概念。</span><span class="sxs-lookup"><span data-stu-id="081ad-190">Auto-failover groups feature provides a powerful abstraction of active geo-replication by supporting group level replication and automatic failover.</span></span> <span data-ttu-id="081ad-191">此外，它會移除 hello 您不再需要 toochange hello SQL 連接字串在容錯移轉之後提供 hello 其他接聽程式端點。</span><span class="sxs-lookup"><span data-stu-id="081ad-191">In addition, it removes hello necessity toochange hello SQL connection string after failover by providing hello additional listener end-points.</span></span> 

* <span data-ttu-id="081ad-192">**容錯移轉群組**︰可以在不同區域 (主要和次要伺服器) 的兩部伺服器之間建立一或多個容錯移轉群組。</span><span class="sxs-lookup"><span data-stu-id="081ad-192">**Failover group**: One or many failover groups can be created between two servers in different regions (primary and secondary servers).</span></span> <span data-ttu-id="081ad-193">每個群組可包含一或多個資料庫，以防所有或部分的主要資料庫變成無法使用，因為 tooan 中斷 hello 主要區域中，做為一個單位復原。</span><span class="sxs-lookup"><span data-stu-id="081ad-193">Each group can include one or several databases that are recovered as a unit in case all or some primary databases become unavailable due tooan outage in hello primary region.</span></span>  
* <span data-ttu-id="081ad-194">**主要伺服器**： 裝載 hello hello 容錯移轉群組中的主要資料庫的伺服器。</span><span class="sxs-lookup"><span data-stu-id="081ad-194">**Primary server**: A server that hosts hello primary databases in hello failover group.</span></span>
* <span data-ttu-id="081ad-195">**次要伺服器**： 裝載 hello hello 容錯移轉群組中的次要資料庫的伺服器。</span><span class="sxs-lookup"><span data-stu-id="081ad-195">**Secondary server**: A server that hosts hello secondary databases in hello failover group.</span></span> <span data-ttu-id="081ad-196">hello 次要伺服器不能在 hello 與 hello 主要伺服器相同的區域。</span><span class="sxs-lookup"><span data-stu-id="081ad-196">hello secondary server cannot be in hello same region as hello primary server.</span></span>
* <span data-ttu-id="081ad-197">**加入資料庫 toofailover 群組**： 您可以放在伺服器中的多個資料庫，或在彈性集區至 hello 相同容錯移轉群組。</span><span class="sxs-lookup"><span data-stu-id="081ad-197">**Adding databases toofailover group**: You can put several databases within a server or within an elastic pool into hello same failover group.</span></span> <span data-ttu-id="081ad-198">如果您新增獨立資料庫 toohello 群組時，它會自動建立次要資料庫使用 hello 相同的版本和效能層級。</span><span class="sxs-lookup"><span data-stu-id="081ad-198">If you add a standalone database toohello group, it automatically creates a secondary database using hello same edition and performance level.</span></span> <span data-ttu-id="081ad-199">如果 hello 主要資料庫是彈性集區中，次要 hello 會自動建立 hello 彈性集區中以 hello 相同名稱。</span><span class="sxs-lookup"><span data-stu-id="081ad-199">If hello primary database is in an elastic pool, hello secondary is automatically created in hello elastic pool with hello same name.</span></span> <span data-ttu-id="081ad-200">如果您新增已包含 hello 次要伺服器中的 次要資料庫的資料庫，hello 群組都會繼承，地理複寫。</span><span class="sxs-lookup"><span data-stu-id="081ad-200">If you add a database that already has a secondary database in hello secondary server, that geo-replication is inherited by hello group.</span></span>

   > [!NOTE]
   > <span data-ttu-id="081ad-201">將已有不是 hello 容錯移轉群組一部分的伺服器中的 次要資料庫的資料庫時，hello 次要伺服器中建立新的次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-201">When adding a database that already has a secondary database in a server that is not part of hello failover group, a new secondary is created in hello secondary server.</span></span> 
   >

* <span data-ttu-id="081ad-202">**容錯移轉群組讀取寫入接聽程式**： 做為格式正確的 DNS CNAME 記錄**&lt;容錯移轉-群組-名稱&gt;。.database.windows.net** ，以指 toohello 目前的主要伺服器 URL。</span><span class="sxs-lookup"><span data-stu-id="081ad-202">**Failover group read-write listener**: A DNS CNAME record formed as **&lt;failover-group-name&gt;.database.windows.net** that points toohello current primary server URL.</span></span> <span data-ttu-id="081ad-203">它允許 hello 讀寫 SQL 應用程式時容錯移轉之後變更 hello 主要 tootransparently 重新連線 toohello 主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-203">It allows hello read-write SQL applications tootransparently reconnect toohello primary database when hello primary changes after failover.</span></span> 
* <span data-ttu-id="081ad-204">**容錯移轉群組唯讀接聽程式**： 做為格式正確的 DNS CNAME 記錄**&lt;容錯移轉-群組-名稱&gt;。 secondary.database.windows.net** ，以指 toohello 次要伺服器的 URL。</span><span class="sxs-lookup"><span data-stu-id="081ad-204">**Failover group read-only listener**: A DNS CNAME record formed as **&lt;failover-group-name&gt;.secondary.database.windows.net** that points toohello secondary server’s URL.</span></span> <span data-ttu-id="081ad-205">它允許 hello 唯讀 tootransparently 連接的 SQL 應用程式使用 hello toohello 次要資料庫，指定負載平衡規則。</span><span class="sxs-lookup"><span data-stu-id="081ad-205">It allows hello read-only SQL applications tootransparently connect toohello secondary database using hello specified load-balancing rules.</span></span> <span data-ttu-id="081ad-206">您可以選擇指定是否您想 hello 唯讀流量 toobe 自動重新導向 toohello 主要伺服器無法使用 hello 次要伺服器時。</span><span class="sxs-lookup"><span data-stu-id="081ad-206">Optionally you can specify if you want hello read-only traffic toobe automatically re-directed toohello primary server when hello secondary server is not available.</span></span>
* <span data-ttu-id="081ad-207">**自動容錯移轉原則**： 根據預設，使用自動容錯移轉原則設定 hello 容錯移轉群組。</span><span class="sxs-lookup"><span data-stu-id="081ad-207">**Automatic failover policy**: By default, hello failover group is configured with an automatic failover policy.</span></span> <span data-ttu-id="081ad-208">一旦偵測到 hello 失敗 hello 系統會觸發容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-208">hello system triggers failover as soon as hello failure is detected.</span></span> <span data-ttu-id="081ad-209">如果您想從 hello 應用程式的 toocontrol hello 容錯移轉工作流程時，您可以關閉自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-209">If you want toocontrol hello failover workflow from hello application, you can turn off automatic failover.</span></span> 
* <span data-ttu-id="081ad-210">**手動容錯移轉**： 您可以在任何時間，而不管 hello 自動容錯移轉設定為何，手動起始容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-210">**Manual failover**: You can initiate failover manually at any time regardless of hello automatic failover configuration.</span></span> <span data-ttu-id="081ad-211">如果自動容錯移轉原則無法設定的手動容錯移轉是必要的 toorecover hello 容錯移轉群組中的資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-211">If automatic failover policy is not configured manual failover is required toorecover databases in hello failover group.</span></span> <span data-ttu-id="081ad-212">您可以起始強制或易用容錯移轉 (具有完整的資料同步處理)。</span><span class="sxs-lookup"><span data-stu-id="081ad-212">You can initiate forced or friendly failover (with full data synchronization).</span></span> <span data-ttu-id="081ad-213">hello 後者可能是使用的 toorelocate hello active server toohello 主要區域。</span><span class="sxs-lookup"><span data-stu-id="081ad-213">hello latter could be used toorelocate hello active server toohello primary region.</span></span> <span data-ttu-id="081ad-214">完成容錯移轉時 hello DNS 記錄將會自動更新的 tooensure 連線 toohello 正確的伺服器。</span><span class="sxs-lookup"><span data-stu-id="081ad-214">When failover is completed hello DNS records are automatically updated tooensure connectivity toohello correct server.</span></span>
* <span data-ttu-id="081ad-215">**會遺失資料的寬限期內**： 因為 hello 主要與次要資料庫已同步處理使用非同步複寫 hello 容錯移轉可能會導致資料遺失。</span><span class="sxs-lookup"><span data-stu-id="081ad-215">**Grace period with data loss**: Because hello primary and secondary databases are synchronized using asynchronous replication hello failover may result in data loss.</span></span> <span data-ttu-id="081ad-216">您可以自訂 hello 自動容錯移轉原則 tooreflect 應用程式的容錯 toodata 遺失。</span><span class="sxs-lookup"><span data-stu-id="081ad-216">You can customize hello automatic failover policy tooreflect your application’s tolerance toodata loss.</span></span> <span data-ttu-id="081ad-217">藉由設定**GracePeriodWithDataLossHours**，您可以控制 hello 系統初始化 tooresult 可能資料遺失的 hello 容錯移轉之前等候的時間長度。</span><span class="sxs-lookup"><span data-stu-id="081ad-217">By configuring **GracePeriodWithDataLossHours**, you can control how long hello system waits before initiating hello failover that is likely tooresult data loss.</span></span> 

   > [!NOTE]
   > <span data-ttu-id="081ad-218">當系統偵測到 hello 群組中的 hello 資料庫均仍保持線上狀態 （例如，hello 中斷只影響 hello 服務控制平面），它會立即啟動 hello 容錯移轉，不論 hello 值的完整資料同步處理 （好記的容錯移轉）設定**GracePeriodWithDataLossHours**。</span><span class="sxs-lookup"><span data-stu-id="081ad-218">When system detects that hello databases in hello group are still online (for example, hello outage only impacted hello service control plane), it immediately activates hello failover with full data synchronization (friendly failover) regardless of hello value set by **GracePeriodWithDataLossHours**.</span></span> <span data-ttu-id="081ad-219">此行為可確保在 hello 復原期間會遺失任何資料。</span><span class="sxs-lookup"><span data-stu-id="081ad-219">This behavior ensures that there is no data loss during hello recovery.</span></span> <span data-ttu-id="081ad-220">hello 寬限期在易記的容錯移轉不可能時，才會生效。</span><span class="sxs-lookup"><span data-stu-id="081ad-220">hello grace period takes effect only when a friendly failover is not possible.</span></span> <span data-ttu-id="081ad-221">Hello 中斷降低 hello 寬限期到期之前，如果未啟用 hello 容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-221">If hello outage is mitigated before hello grace period expires, hello failover is not activated.</span></span>
   >

* <span data-ttu-id="081ad-222">**多個容錯移轉群組**： 您可以設定多個容錯移轉群組 hello 同一對伺服器的容錯移轉期間 toocontrol hello 標尺。</span><span class="sxs-lookup"><span data-stu-id="081ad-222">**Multiple failover groups**: You can configure multiple failover groups for hello same pair of servers toocontrol hello scale of failovers.</span></span> <span data-ttu-id="081ad-223">每個群組分別進行容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-223">Each group fails over independently.</span></span> <span data-ttu-id="081ad-224">如果您的多租用戶應用程式使用彈性集區，您可以使用此功能 toomix 主要與次要資料庫中每個集區。</span><span class="sxs-lookup"><span data-stu-id="081ad-224">If your multi-tenant application uses elastic pools, you can use this capability toomix primary and secondary databases in each pool.</span></span> <span data-ttu-id="081ad-225">這種方式可以減少在 hello 影響的中斷 tooonly hello 租用戶的下半部。</span><span class="sxs-lookup"><span data-stu-id="081ad-225">This way you can reduce hello impact of an outage tooonly half of hello tenants.</span></span>

## <a name="best-practices-of-building-highly-available-service"></a><span data-ttu-id="081ad-226">建置高可用性服務的最佳作法</span><span class="sxs-lookup"><span data-stu-id="081ad-226">Best practices of building highly available service</span></span>

<span data-ttu-id="081ad-227">toobuild 高可用性的服務使用 Azure SQL database hello 客戶應該遵循這些指導方針：</span><span class="sxs-lookup"><span data-stu-id="081ad-227">toobuild a highly available service that uses Azure SQL database hello customers should follow these guidelines:</span></span>
- <span data-ttu-id="081ad-228">**使用容錯移轉群組**︰可以在位於不同區域 (主要和次要伺服器) 的兩部伺服器之間建立一或多個容錯移轉群組。</span><span class="sxs-lookup"><span data-stu-id="081ad-228">**Use failover group**: One or many failover groups can be created between two servers in different regions (primary and secondary servers).</span></span> <span data-ttu-id="081ad-229">每個群組可包含一或多個資料庫，以防所有或部分的主要資料庫變成無法使用，因為 tooan 中斷 hello 主要區域中，做為一個單位復原。</span><span class="sxs-lookup"><span data-stu-id="081ad-229">Each group can include one or several databases that are recovered as a unit in case all or some primary databases become unavailable due tooan outage in hello primary region.</span></span> <span data-ttu-id="081ad-230">hello 容錯移轉群組會建立相同服務做為 hello 主要目標的 hello 地理次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-230">hello failover group creates geo-secondary database with hello same service objective as hello primary.</span></span> <span data-ttu-id="081ad-231">如果您將加入現有異地複寫關聯性 toohello 容錯移轉群組請確定 hello 地理-次要複本已設定相同服務等級目標為 hello 與 hello 主要。</span><span class="sxs-lookup"><span data-stu-id="081ad-231">If you add an existing geo-replication relationship toohello failover group make sure hello geo-secondary is configured with hello same service level objective as hello primary.</span></span>
- <span data-ttu-id="081ad-232">**使用針對 OLTP 工作負載的讀取寫入接聽程式**： 在執行 OLTP 作業使用**&lt;容錯移轉-群組-名稱&gt;。.database.windows.net**當 hello 伺服器 URL 和 hello 連線將會自動導向的 toohello 主要。</span><span class="sxs-lookup"><span data-stu-id="081ad-232">**Use read-write listener for OLTP workload**: When performing OLTP operations use **&lt;failover-group-name&gt;.database.windows.net** as hello server URL and hello connections will be automatically directed toohello primary.</span></span> <span data-ttu-id="081ad-233">Hello 容錯移轉之後，不會變更此 URL。</span><span class="sxs-lookup"><span data-stu-id="081ad-233">This URL will not change after hello failover.</span></span>  
<span data-ttu-id="081ad-234">請注意 hello 容錯移轉牽涉到更新 DNS 記錄，所以 hello 用戶端連接會重新導向的 toohello 新主要 hello 用戶端之後，才 DNS 快取重新整理的 hello。</span><span class="sxs-lookup"><span data-stu-id="081ad-234">Note hello failover involves updating hello DNS record so hello client connections will be redirected toohello new primary only after hello client DNS cache is refreshed.</span></span>
- <span data-ttu-id="081ad-235">**用於唯讀工作負載的唯讀狀態的接聽程式**： 如果您有邏輯上隔離的唯讀工作負載的容錯 toocertain 過時的資料，您可以使用 hello 次要資料庫中 hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="081ad-235">**Use read-only listener for read-only workload**: If you have a logically isolated read-only workload that is tolerant toocertain staleness of data, you can use hello secondary database in hello application.</span></span> <span data-ttu-id="081ad-236">唯讀的工作階段使用**&lt;容錯移轉-群組-名稱&gt;。 secondary.database.windows.net**當 hello 伺服器 URL 和 hello 連接將會自動導向的 toohello 次要。</span><span class="sxs-lookup"><span data-stu-id="081ad-236">For read-only sessions use **&lt;failover-group-name&gt;.secondary.database.windows.net** as hello server URL and hello connection will be automatically directed toohello secondary.</span></span> <span data-ttu-id="081ad-237">也建議您使用 **ApplicationIntent=ReadOnly**，在連接字串中表示讀取意圖。</span><span class="sxs-lookup"><span data-stu-id="081ad-237">It is also recommended that you indicate in connection string read intent by using **ApplicationIntent=ReadOnly**.</span></span> 
- <span data-ttu-id="081ad-238">**準備效能降低的**: hello 其餘 hello 應用程式或使用其他服務與 SQL 容錯移轉決策無關。</span><span class="sxs-lookup"><span data-stu-id="081ad-238">**Be prepared for perf degradation**: SQL failover decision is independent from hello rest of hello application or other services used.</span></span> <span data-ttu-id="081ad-239">hello 應用程式可能是"mixed"的一個區域，在另一個部分中的部分元件。</span><span class="sxs-lookup"><span data-stu-id="081ad-239">hello application may be “mixed” with some components in one region and some in another.</span></span> <span data-ttu-id="081ad-240">tooavoid hello 變差，確保 hello DR 區域中的 hello 多餘的應用程式部署，並遵循本文章中的 hello 指導方針。</span><span class="sxs-lookup"><span data-stu-id="081ad-240">tooavoid hello degradation, ensure hello redundant application deployment in hello DR region and follow hello guidelines in this article.</span></span>  
<span data-ttu-id="081ad-241">請注意 hello DR 區域中的 hello 應用程式沒有 toouse 不同的連接字串。</span><span class="sxs-lookup"><span data-stu-id="081ad-241">Note hello application in hello DR region does not have toouse a different connection string.</span></span>  
- <span data-ttu-id="081ad-242">**準備資料遺失的**： 如果沒有零的資料遺失 toohello 我們知識的最佳偵測到發生中斷時，如果 SQL 自動觸發讀寫容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-242">**Prepare for data loss**: If an outage is detected, SQL automatically triggers read-write failover if there is zero data loss toohello best of our knowledge.</span></span> <span data-ttu-id="081ad-243">否則，它會等候您所指定的 hello 週期**GracePeriodWithDataLossHours**。</span><span class="sxs-lookup"><span data-stu-id="081ad-243">Otherwise, it waits for hello period you specified by **GracePeriodWithDataLossHours**.</span></span> <span data-ttu-id="081ad-244">如果您指定了 **GracePeriodWithDataLossHours**，請做好可能會遺失資料的心理準備。</span><span class="sxs-lookup"><span data-stu-id="081ad-244">If you specified **GracePeriodWithDataLossHours**, be prepared for data loss.</span></span> <span data-ttu-id="081ad-245">服務中斷期間，Azure 一般會傾向維持可用性。</span><span class="sxs-lookup"><span data-stu-id="081ad-245">In general, during outages, Azure favors availability.</span></span> <span data-ttu-id="081ad-246">如果您無法容忍遺失資料，請確定 tooset **GracePeriodWithDataLossHours** tooa 夠大的數目，例如 24 小時。</span><span class="sxs-lookup"><span data-stu-id="081ad-246">If you cannot afford data loss, make sure tooset **GracePeriodWithDataLossHours** tooa sufficiently large number, such as 24 hours.</span></span> 


## <a name="upgrading-or-downgrading-a-primary-database"></a><span data-ttu-id="081ad-247">升級或降級主要資料庫</span><span class="sxs-lookup"><span data-stu-id="081ad-247">Upgrading or downgrading a primary database</span></span>
<span data-ttu-id="081ad-248">您可以升級或降級的主要資料庫 tooa 不同的效能層級 （hello 內相同服務層） 而不中斷連線的任何次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-248">You can upgrade or downgrade a primary database tooa different performance level (within hello same service tier) without disconnecting any secondary databases.</span></span> <span data-ttu-id="081ad-249">升級時，我們建議您先升級 hello 次要資料庫，然後再升級 hello 主要。</span><span class="sxs-lookup"><span data-stu-id="081ad-249">When upgrading, we recommend that you upgrade hello secondary database first, and then upgrade hello primary.</span></span> <span data-ttu-id="081ad-250">降級時，會反向 hello 順序： 首先，降級 hello 主要和再降級 hello 次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-250">When downgrading, reverse hello order: downgrade hello primary first, and then downgrade hello secondary.</span></span> <span data-ttu-id="081ad-251">當您升級或降級 hello 資料庫 tooa 不同服務層會強制執行這項建議。</span><span class="sxs-lookup"><span data-stu-id="081ad-251">When you upgrade or downgrade hello database tooa different service tier this recommendation is enforced.</span></span> 

> [!NOTE]
> <span data-ttu-id="081ad-252">如果您為 hello 容錯移轉群組組態的一部分建立次要資料庫不是建議的 toodowngrade hello 次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-252">If you created secondary database as part of hello failover group configuration it is not recommended toodowngrade hello secondary database.</span></span> <span data-ttu-id="081ad-253">這是 tooensure 您的資料層擁有足夠的容量 tooprocess 您的一般工作負載後啟動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-253">This is tooensure your data tier has sufficient capacity tooprocess your regular workload after failover is activated.</span></span> 
>

## <a name="preventing-hello-loss-of-critical-data"></a><span data-ttu-id="081ad-254">防止 hello 遺失重要資料</span><span class="sxs-lookup"><span data-stu-id="081ad-254">Preventing hello loss of critical data</span></span>
<span data-ttu-id="081ad-255">由於廣域網路的 toohello 高延遲，連續複製採用非同步複寫機制。</span><span class="sxs-lookup"><span data-stu-id="081ad-255">Due toohello high latency of wide area networks, continuous copy uses an asynchronous replication mechanism.</span></span> <span data-ttu-id="081ad-256">如果發生失敗，非同步複寫導致部分資料遺失是無法避免的。</span><span class="sxs-lookup"><span data-stu-id="081ad-256">Asynchronous replication makes some data loss unavoidable if a failure occurs.</span></span> <span data-ttu-id="081ad-257">不過，有些應用程式可能會要求資料不能遺失。</span><span class="sxs-lookup"><span data-stu-id="081ad-257">However, some applications may require no data loss.</span></span> <span data-ttu-id="081ad-258">tooprotect 這些重大更新、 應用程式開發人員可以呼叫 hello [sp_wait_for_database_copy_sync](https://msdn.microsoft.com/library/dn467644.aspx)認可 hello 交易之後立即系統程序。</span><span class="sxs-lookup"><span data-stu-id="081ad-258">tooprotect these critical updates, an application developer can call hello [sp_wait_for_database_copy_sync](https://msdn.microsoft.com/library/dn467644.aspx) system procedure immediately after committing hello transaction.</span></span> <span data-ttu-id="081ad-259">呼叫**sp_wait_for_database_copy_sync**區塊 hello 呼叫執行緒，直到 hello 最後認可的交易已經傳送 toohello 次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-259">Calling **sp_wait_for_database_copy_sync** blocks hello calling thread until hello last committed transaction has been transmitted toohello secondary database.</span></span> <span data-ttu-id="081ad-260">不過，它不會等候傳送嗨交易 toobe 重新執行，而且在次要 hello 認可。</span><span class="sxs-lookup"><span data-stu-id="081ad-260">However, it does not wait for hello transmitted transactions toobe replayed and committed on hello secondary.</span></span> <span data-ttu-id="081ad-261">**sp_wait_for_database_copy_sync**是已設定領域的 tooa 特定的連續複製連結。</span><span class="sxs-lookup"><span data-stu-id="081ad-261">**sp_wait_for_database_copy_sync** is scoped tooa specific continuous copy link.</span></span> <span data-ttu-id="081ad-262">具有 hello 連接權限 toohello 主要資料庫的任何使用者都可以呼叫此程序。</span><span class="sxs-lookup"><span data-stu-id="081ad-262">Any user with hello connection rights toohello primary database can call this procedure.</span></span>

> [!NOTE]
> <span data-ttu-id="081ad-263">**sp_wait_for_database_copy_sync** 可避免在容錯移轉之後資料遺失，但是不保證讀取權限會完整同步。</span><span class="sxs-lookup"><span data-stu-id="081ad-263">**sp_wait_for_database_copy_sync** will prevent data loss after failover, but it will not guarantee full synchronization for read access.</span></span> <span data-ttu-id="081ad-264">hello 所造成的延遲**sp_wait_for_database_copy_sync**程序呼叫可能會很顯著，而在 hello 呼叫 hello 時間取決於 hello hello 交易記錄檔大小。</span><span class="sxs-lookup"><span data-stu-id="081ad-264">hello delay caused by a **sp_wait_for_database_copy_sync** procedure call can be significant and depends on hello size of hello transaction log at hello time of hello call.</span></span> 
> 

## <a name="programmatically-managing-failover-groups-and-active-geo-replication"></a><span data-ttu-id="081ad-265">以程式設計方式管理容錯移轉群組和主動式異地複寫</span><span class="sxs-lookup"><span data-stu-id="081ad-265">Programmatically managing failover groups and active geo-replication</span></span>
<span data-ttu-id="081ad-266">如前所述，自動容錯移轉群組 （預覽） 和作用中地理複寫也可使用 Azure PowerShell 以程式設計方式，和 hello REST API。</span><span class="sxs-lookup"><span data-stu-id="081ad-266">As discussed previously, auto-failover groups (in-preview) and active geo-replication can also be managed programmatically using Azure PowerShell and hello REST API.</span></span> <span data-ttu-id="081ad-267">hello 下表描述可用的命令 hello 集。</span><span class="sxs-lookup"><span data-stu-id="081ad-267">hello following tables describe hello set of commands available.</span></span>

<span data-ttu-id="081ad-268">**Azure 資源管理員 API 和以角色為基礎的安全性**： 作用中地理複寫包含一組 Azure 資源管理員 Api 進行管理，包括 hello [Azure SQL Database REST API](https://docs.microsoft.com/rest/api/sql/)和[AzurePowerShell 指令程式](https://docs.microsoft.com/powershell/azure/overview)。</span><span class="sxs-lookup"><span data-stu-id="081ad-268">**Azure Resource Manager API and role-based security**: Active geo-replication includes a set of Azure Resource Manager APIs for management, including hello [Azure SQL Database REST API](https://docs.microsoft.com/rest/api/sql/) and [Azure PowerShell cmdlets](https://docs.microsoft.com/powershell/azure/overview).</span></span> <span data-ttu-id="081ad-269">這些 Api 需要 hello 使用的資源群組，並支援以角色為基礎的安全性 (RBAC)。</span><span class="sxs-lookup"><span data-stu-id="081ad-269">These APIs require hello use of resource groups and support role-based security (RBAC).</span></span> <span data-ttu-id="081ad-270">如需有關如何 tooimplement 存取角色的詳細資訊，請參閱[所有存取控制](../active-directory/role-based-access-control-what-is.md)。</span><span class="sxs-lookup"><span data-stu-id="081ad-270">For more information on how tooimplement access roles, see [Azure Role-Based Access Control](../active-directory/role-based-access-control-what-is.md).</span></span>

> [!NOTE]
> <span data-ttu-id="081ad-271">只有在使用以 [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) 為基礎的 [Azure SQL REST API](https://msdn.microsoft.com/library/azure/mt163571.aspx) 和 [Azure SQL Database PowerShell Cmdlet](https://msdn.microsoft.com/library/azure/mt574084.aspx) 時，才支援主動式異地複寫的許多新功能。</span><span class="sxs-lookup"><span data-stu-id="081ad-271">Many new features of active geo-replication are only supported using [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) based [Azure SQL REST API](https://msdn.microsoft.com/library/azure/mt163571.aspx) and [Azure SQL Database PowerShell cmdlets](https://msdn.microsoft.com/library/azure/mt574084.aspx).</span></span> <span data-ttu-id="081ad-272">hello [（傳統） REST API](https://msdn.microsoft.com/library/azure/dn505719.aspx)和[Azure SQL Database （傳統） cmdlet](https://msdn.microsoft.com/library/azure/dn546723.aspx)支援回溯相容性，因此使用的 hello 建議使用 Azure Resource Manager 為基礎的 API。</span><span class="sxs-lookup"><span data-stu-id="081ad-272">hello [(classic) REST API](https://msdn.microsoft.com/library/azure/dn505719.aspx) and [Azure SQL Database (classic) cmdlets](https://msdn.microsoft.com/library/azure/dn546723.aspx) are supported for backward compatibility so using hello Azure Resource Manager-based APIs are recommended.</span></span> 
> 

## <a name="manage-sql-database-failover-using-using-transact-sql"></a><span data-ttu-id="081ad-273">管理 SQL database 容錯移轉使用 TRANSACT-SQL</span><span class="sxs-lookup"><span data-stu-id="081ad-273">Manage SQL database failover using using Transact-SQL</span></span>

| <span data-ttu-id="081ad-274">命令</span><span class="sxs-lookup"><span data-stu-id="081ad-274">Command</span></span> | <span data-ttu-id="081ad-275">說明</span><span class="sxs-lookup"><span data-stu-id="081ad-275">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="081ad-276">ALTER DATABASE (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="081ad-276">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="081ad-277">新增次要 ON SERVER 引數 toocreate 次要資料庫用於現有的資料庫，並開始資料複寫</span><span class="sxs-lookup"><span data-stu-id="081ad-277">Use ADD SECONDARY ON SERVER argument toocreate a secondary database for an existing database and starts data replication</span></span> |
| [<span data-ttu-id="081ad-278">ALTER DATABASE (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="081ad-278">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="081ad-279">使用容錯移轉或 FORCE_FAILOVER_ALLOW_DATA_LOSS tooswitch 次要資料庫 toobe 主要 tooinitiate 容錯移轉</span><span class="sxs-lookup"><span data-stu-id="081ad-279">Use FAILOVER or FORCE_FAILOVER_ALLOW_DATA_LOSS tooswitch a secondary database toobe primary tooinitiate failover</span></span> |
| [<span data-ttu-id="081ad-280">ALTER DATABASE (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="081ad-280">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="081ad-281">使用移除次要 ON SERVER tooterminate SQL Database 與 hello 指定的次要資料庫之間的資料複寫。</span><span class="sxs-lookup"><span data-stu-id="081ad-281">Use REMOVE SECONDARY ON SERVER tooterminate a data replication between a SQL Database and hello specified secondary database.</span></span> |
| [<span data-ttu-id="081ad-282">sys.geo_replication_links (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="081ad-282">sys.geo_replication_links (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt575501.aspx) |<span data-ttu-id="081ad-283">傳回 hello Azure SQL Database 邏輯伺服器上的每個資料庫的所有現有複寫連結的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="081ad-283">Returns information about all existing replication links for each database on hello Azure SQL Database logical server.</span></span> |
| [<span data-ttu-id="081ad-284">sys.dm_geo_replication_link_status (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="081ad-284">sys.dm_geo_replication_link_status (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt575504.aspx) |<span data-ttu-id="081ad-285">取得 hello 上次複寫的時間、 上次複寫延遲，以及其他相關資訊 hello 複寫連結指定的 SQL 資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-285">Gets hello last replication time, last replication lag, and other information about hello replication link for a given SQL database.</span></span> |
| [<span data-ttu-id="081ad-286">sys.dm_operation_status (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="081ad-286">sys.dm_operation_status (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/dn270022.aspx) |<span data-ttu-id="081ad-287">會顯示 hello 包括 hello hello 複寫連結狀態的所有資料庫作業的狀態。</span><span class="sxs-lookup"><span data-stu-id="081ad-287">Shows hello status for all database operations including hello status of hello replication links.</span></span> |
| [<span data-ttu-id="081ad-288">sp_wait_for_database_copy_sync (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="081ad-288">sp_wait_for_database_copy_sync (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/dn467644.aspx) |<span data-ttu-id="081ad-289">會導致 hello 應用程式 toowait，直到所有已認可的交易都複寫及認可 hello 作用中次要資料庫為止。</span><span class="sxs-lookup"><span data-stu-id="081ad-289">causes hello application toowait until all committed transactions are replicated and acknowledged by hello active secondary database.</span></span> |
|  | |

## <a name="manage-sql-database-failover-using-using-powershell"></a><span data-ttu-id="081ad-290">SQL 資料庫容錯移轉使用使用 PowerShell 管理</span><span class="sxs-lookup"><span data-stu-id="081ad-290">Manage SQL database failover using using PowerShell</span></span>

| <span data-ttu-id="081ad-291">Cmdlet</span><span class="sxs-lookup"><span data-stu-id="081ad-291">Cmdlet</span></span> | <span data-ttu-id="081ad-292">說明</span><span class="sxs-lookup"><span data-stu-id="081ad-292">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="081ad-293">Get-AzureRmSqlDatabase</span><span class="sxs-lookup"><span data-stu-id="081ad-293">Get-AzureRmSqlDatabase</span></span>](/powershell/module/azurerm.sql/get-azurermsqldatabase) |<span data-ttu-id="081ad-294">取得一或多個資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-294">Gets one or more databases.</span></span> |
| [<span data-ttu-id="081ad-295">New-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="081ad-295">New-AzureRmSqlDatabaseSecondary</span></span>](/powershell/module/azurerm.sql/new-azurermsqldatabasesecondary) |<span data-ttu-id="081ad-296">針對現有資料庫建立次要資料庫並開始資料複寫。</span><span class="sxs-lookup"><span data-stu-id="081ad-296">Creates a secondary database for an existing database and starts data replication.</span></span> |
| [<span data-ttu-id="081ad-297">Set-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="081ad-297">Set-AzureRmSqlDatabaseSecondary</span></span>](/powershell/module/azurerm.sql/set-azurermsqldatabasesecondary) |<span data-ttu-id="081ad-298">切換次要資料庫 toobe 主要 tooinitiate 容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-298">Switches a secondary database toobe primary tooinitiate failover.</span></span> |
| [<span data-ttu-id="081ad-299">Remove-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="081ad-299">Remove-AzureRmSqlDatabaseSecondary</span></span>](/powershell/module/azurerm.sql/remove-azurermsqldatabasesecondary) |<span data-ttu-id="081ad-300">終止 SQL Database 與 hello 指定的次要資料庫之間的資料複寫。</span><span class="sxs-lookup"><span data-stu-id="081ad-300">Terminates data replication between a SQL Database and hello specified secondary database.</span></span> |
| [<span data-ttu-id="081ad-301">Get-AzureRmSqlDatabaseReplicationLink</span><span class="sxs-lookup"><span data-stu-id="081ad-301">Get-AzureRmSqlDatabaseReplicationLink</span></span>](/powershell/module/azurerm.sql/get-azurermsqldatabasereplicationlink) |<span data-ttu-id="081ad-302">取得 Azure SQL Database 與資源群組或 SQL Server 之間的 hello 異地複寫連結。</span><span class="sxs-lookup"><span data-stu-id="081ad-302">Gets hello geo-replication links between an Azure SQL Database and a resource group or SQL Server.</span></span> |
| [<span data-ttu-id="081ad-303">New-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="081ad-303">New-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/set-azurermsqldatabasefailovergroup) |   <span data-ttu-id="081ad-304">此命令會建立容錯移轉群組，並同時在主要和次要伺服器上註冊</span><span class="sxs-lookup"><span data-stu-id="081ad-304">This command creates a failover group and registers it on both primary and secondary servers</span></span>|
| [<span data-ttu-id="081ad-305">Remove-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="081ad-305">Remove-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/remove-azurermsqldatabasefailovergroup) | <span data-ttu-id="081ad-306">移除 hello 伺服器 hello 容錯移轉群組，並刪除所有包含的次要資料庫 hello 群組</span><span class="sxs-lookup"><span data-stu-id="081ad-306">Removes hello failover group from hello server and deletes all secondary databases included hello group</span></span> |
| [<span data-ttu-id="081ad-307">Get-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="081ad-307">Get-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/get-azurermsqldatabasefailovergroup) | <span data-ttu-id="081ad-308">擷取 hello 容錯移轉群組組態</span><span class="sxs-lookup"><span data-stu-id="081ad-308">Retrieves hello failover group configuration</span></span> |
| [<span data-ttu-id="081ad-309">Set-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="081ad-309">Set-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/set-azurermsqldatabasefailovergroup) |   <span data-ttu-id="081ad-310">修改 hello hello 容錯移轉群組組態</span><span class="sxs-lookup"><span data-stu-id="081ad-310">Modifies hello configuration of hello failover group</span></span> |
| [<span data-ttu-id="081ad-311">Switch-AzureRMSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="081ad-311">Switch-AzureRMSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/switch-azurermsqldatabasefailovergroup) | <span data-ttu-id="081ad-312">觸發程序的 hello 容錯移轉群組 toohello 次要伺服器的容錯移轉</span><span class="sxs-lookup"><span data-stu-id="081ad-312">Triggers failover of hello failover group toohello secondary server</span></span> |
|  | |

> [!IMPORTANT]
> <span data-ttu-id="081ad-313">如需範例指令碼，請參閱[使用作用中異地複寫設定單一資料庫並進行容錯移轉](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)、[使用作用中異地複寫設定集區資料庫並進行容錯移轉](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md)和[設定單一資料庫的容錯移轉群組並進行容錯移轉] \(預覽\) (scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md。</span><span class="sxs-lookup"><span data-stu-id="081ad-313">For sample scripts, see [Configure and failover a single database using active geo-replication](scripts/sql-database-setup-geodr-and-failover-database-powershell.md), [Configure and failover a pooled database using active geo-replication](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md), and  [Configure and failover a failover group for a single database (preview)](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md.</span></span>
>

## <a name="manage-sql-database-failover-using-hello-rest-api"></a><span data-ttu-id="081ad-314">管理 SQL database 容錯移轉使用 hello REST API</span><span class="sxs-lookup"><span data-stu-id="081ad-314">Manage SQL database failover using hello REST API</span></span>
| <span data-ttu-id="081ad-315">API</span><span class="sxs-lookup"><span data-stu-id="081ad-315">API</span></span> | <span data-ttu-id="081ad-316">說明</span><span class="sxs-lookup"><span data-stu-id="081ad-316">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="081ad-317">Create or Update Database (createMode=Restore)</span><span class="sxs-lookup"><span data-stu-id="081ad-317">Create or Update Database (createMode=Restore)</span></span>](/rest/api/sql/Databases/CreateOrUpdate) |<span data-ttu-id="081ad-318">建立、更新或還原主要或次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="081ad-318">Creates, updates, or restores a primary or a secondary database.</span></span> |
| [<span data-ttu-id="081ad-319">取得建立或更新資料庫狀態</span><span class="sxs-lookup"><span data-stu-id="081ad-319">Get Create or Update Database Status</span></span>](/rest/api/sql/Databases/CreateOrUpdate) |<span data-ttu-id="081ad-320">建立作業期間傳回 hello 狀態。</span><span class="sxs-lookup"><span data-stu-id="081ad-320">Returns hello status during a create operation.</span></span> |
| [<span data-ttu-id="081ad-321">將次要資料庫設定為主要資料庫 (計劃性容錯移轉)</span><span class="sxs-lookup"><span data-stu-id="081ad-321">Set Secondary Database as Primary (Planned Failover)</span></span>](https://docs.microsoft.com/rest/api/sql/replicationlinkss#ReplicationLinks_Failover) |<span data-ttu-id="081ad-322">設定哪些複本資料庫是主要由從目前主要複本資料庫 hello 容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-322">Sets which replica database is primary by failing over from hello current primary replica database.</span></span> |
| [<span data-ttu-id="081ad-323">將次要資料庫設定為主要資料庫 (非計劃的容錯移轉)</span><span class="sxs-lookup"><span data-stu-id="081ad-323">Set Secondary Database as Primary (Unplanned Failover)</span></span>](https://docs.microsoft.com/rest/api/sql/replicationlinks#ReplicationLinks_FailoverAllowDataLoss) |<span data-ttu-id="081ad-324">設定哪些複本資料庫是主要由從目前主要複本資料庫 hello 容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-324">Sets which replica database is primary by failing over from hello current primary replica database.</span></span> <span data-ttu-id="081ad-325">這項作業可能會導致資料遺失。</span><span class="sxs-lookup"><span data-stu-id="081ad-325">This operation might result in data loss.</span></span> |
| [<span data-ttu-id="081ad-326">取得複寫連結</span><span class="sxs-lookup"><span data-stu-id="081ad-326">Get Replication Link</span></span>](/rest/api/sql/replicationlinks/get) |<span data-ttu-id="081ad-327">取得異地複寫關聯性中指定 SQL Database 的特定複寫連結。</span><span class="sxs-lookup"><span data-stu-id="081ad-327">Gets a specific replication link for a given SQL database in a geo-replication partnership.</span></span> <span data-ttu-id="081ad-328">它會擷取 hello hello sys.geo_replication_links 目錄檢視中顯示的資訊。</span><span class="sxs-lookup"><span data-stu-id="081ad-328">It retrieves hello information visible in hello sys.geo_replication_links catalog view.</span></span> |
| [<span data-ttu-id="081ad-329">複寫連結 - 依資料庫列示</span><span class="sxs-lookup"><span data-stu-id="081ad-329">Replication Links - List By Database</span></span>](/rest/api/sql/replicationlinks/listbydatabase) | <span data-ttu-id="081ad-330">取得異地複寫關聯性中指定 SQL Database 的所有複寫連結。</span><span class="sxs-lookup"><span data-stu-id="081ad-330">Gets all replication links for a given SQL database in a geo-replication partnership.</span></span> <span data-ttu-id="081ad-331">它會擷取 hello hello sys.geo_replication_links 目錄檢視中顯示的資訊。</span><span class="sxs-lookup"><span data-stu-id="081ad-331">It retrieves hello information visible in hello sys.geo_replication_links catalog view.</span></span> |
| [<span data-ttu-id="081ad-332">刪除複寫連結</span><span class="sxs-lookup"><span data-stu-id="081ad-332">Delete Replication Link</span></span>](/rest/api/sql/databases/delete) | <span data-ttu-id="081ad-333">刪除資料庫複寫連結。</span><span class="sxs-lookup"><span data-stu-id="081ad-333">Deletes a database replication link.</span></span> <span data-ttu-id="081ad-334">無法在容錯移轉期間進行。</span><span class="sxs-lookup"><span data-stu-id="081ad-334">Cannot be done during failover.</span></span> |
| <span data-ttu-id="081ad-335">[建立或更新容錯移轉群組]/rest/api/sql/failovergroups/createorupdate)</span><span class="sxs-lookup"><span data-stu-id="081ad-335">[Create or Update Failover Group]/rest/api/sql/failovergroups/createorupdate)</span></span> | <span data-ttu-id="081ad-336">建立或更新容錯移轉群組</span><span class="sxs-lookup"><span data-stu-id="081ad-336">Creates or updates a failover group</span></span> |
| [<span data-ttu-id="081ad-337">刪除容錯移轉群組</span><span class="sxs-lookup"><span data-stu-id="081ad-337">Delete Failover Group</span></span>](/rest/api/sql/failovergroups/delete) | <span data-ttu-id="081ad-338">Hello 容錯移轉群組移除伺服器 hello</span><span class="sxs-lookup"><span data-stu-id="081ad-338">Removes hello failover group from hello server</span></span> |
| [<span data-ttu-id="081ad-339">容錯移轉 (計劃性)</span><span class="sxs-lookup"><span data-stu-id="081ad-339">Failover (Planned)</span></span>](/rest/api/sql/failovergroups/failover) | <span data-ttu-id="081ad-340">從目前的主要伺服器 toothis 伺服器 hello 容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="081ad-340">Fails over from hello current primary server toothis server.</span></span> |
| [<span data-ttu-id="081ad-341">強制容錯移轉允許資料遺失</span><span class="sxs-lookup"><span data-stu-id="081ad-341">Force Failover Allow Data Loss</span></span>](/rest/api/sql/failovergroups/forcefailoverallowdataloss) |<span data-ttu-id="081ad-342">從目前的主要伺服器 toothis 伺服器 hello ails 透過。</span><span class="sxs-lookup"><span data-stu-id="081ad-342">ails over from hello current primary server toothis server.</span></span> <span data-ttu-id="081ad-343">這項作業可能會導致資料遺失。</span><span class="sxs-lookup"><span data-stu-id="081ad-343">This operation might result in data loss.</span></span> |
| [<span data-ttu-id="081ad-344">取得容錯移轉群組</span><span class="sxs-lookup"><span data-stu-id="081ad-344">Get Failover Group</span></span>](/rest/api/sql/failovergroups/get) | <span data-ttu-id="081ad-345">取得容錯移轉群組。</span><span class="sxs-lookup"><span data-stu-id="081ad-345">Gets a failover group.</span></span> |
| [<span data-ttu-id="081ad-346">依伺服器列出容錯移轉群組</span><span class="sxs-lookup"><span data-stu-id="081ad-346">List Failover Groups By Server</span></span>](/rest/api/sql/failovergroups/listbyserver) | <span data-ttu-id="081ad-347">列出在伺服器中的 hello 容錯移轉群組。</span><span class="sxs-lookup"><span data-stu-id="081ad-347">Lists hello failover groups in a server.</span></span> |
| [<span data-ttu-id="081ad-348">更新容錯移轉群組</span><span class="sxs-lookup"><span data-stu-id="081ad-348">Update Failover Group</span></span>](/rest/api/sql/failovergroups/update) | <span data-ttu-id="081ad-349">更新容錯移轉群組。</span><span class="sxs-lookup"><span data-stu-id="081ad-349">Updates a failover group.</span></span> |
|  | |

## <a name="next-steps"></a><span data-ttu-id="081ad-350">後續步驟</span><span class="sxs-lookup"><span data-stu-id="081ad-350">Next steps</span></span>
* <span data-ttu-id="081ad-351">如需範例指令碼，請參閱：</span><span class="sxs-lookup"><span data-stu-id="081ad-351">For sample scripts, see:</span></span>
   - [<span data-ttu-id="081ad-352">使用作用中異地複寫設定單一資料庫並進行容錯移轉</span><span class="sxs-lookup"><span data-stu-id="081ad-352">Configure and failover a single database using active geo-replication</span></span>](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
   - [<span data-ttu-id="081ad-353">使用作用中異地複寫設定集區資料庫並進行容錯移轉</span><span class="sxs-lookup"><span data-stu-id="081ad-353">Configure and failover a pooled database using active geo-replication</span></span>](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md)
   - [<span data-ttu-id="081ad-354">設定單一資料庫的容錯移轉群組並進行容錯移轉 (預覽)</span><span class="sxs-lookup"><span data-stu-id="081ad-354">Configure and failover a failover group for a single database (preview)</span></span>](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md)
* <span data-ttu-id="081ad-355">如需商務持續性概觀和案例，請參閱 [商務持續性概觀](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="081ad-355">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="081ad-356">toolearn 有關自動化 Azure SQL Database 備份，請參閱[SQL 資料庫自動備份](sql-database-automated-backups.md)。</span><span class="sxs-lookup"><span data-stu-id="081ad-356">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="081ad-357">toolearn 有關使用自動的備份進行復原，請參閱[hello 服務起始的備份還原的資料庫](sql-database-recovery-using-backups.md)。</span><span class="sxs-lookup"><span data-stu-id="081ad-357">toolearn about using automated backups for recovery, see [Restore a database from hello service-initiated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="081ad-358">toolearn 有關驗證需求，針對新的主要伺服器和資料庫，請參閱[後嚴重損壞修復的 SQL Database 安全性](sql-database-geo-replication-security-config.md)。</span><span class="sxs-lookup"><span data-stu-id="081ad-358">toolearn about authentication requirements for a new primary server and database, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>

