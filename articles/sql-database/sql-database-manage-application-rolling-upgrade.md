---
title: "aaaRolling 應用程式升級 Azure SQL Database |Microsoft 文件"
description: "深入了解如何 toouse Azure SQL Database 的地理複寫 toosupport 線上升級您的雲端應用程式。"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 58f42859-1e37-463c-a3d8-a3ca2e867148
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/16/2016
ms.author: sashan
ms.openlocfilehash: 18c56300916d129bff141624cc5c416b500408d4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="managing-rolling-upgrades-of-cloud-applications-using-sql-database-active-geo-replication"></a><span data-ttu-id="aeca0-103">使用 SQL Database 主動式異地複寫管理雲端應用程式的輪流升級</span><span class="sxs-lookup"><span data-stu-id="aeca0-103">Managing rolling upgrades of cloud applications using SQL Database active geo-replication</span></span>
> [!NOTE]
> <span data-ttu-id="aeca0-104">[作用中異地複寫](sql-database-geo-replication-overview.md)現在可供所有層中的所有資料庫使用。</span><span class="sxs-lookup"><span data-stu-id="aeca0-104">[Active geo-replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span></span>
> 

<span data-ttu-id="aeca0-105">深入了解如何 toouse[地理複寫](sql-database-geo-replication-overview.md)中 SQL Database tooenable 輪流升級的雲端應用程式。</span><span class="sxs-lookup"><span data-stu-id="aeca0-105">Learn how toouse [geo-replication](sql-database-geo-replication-overview.md) in SQL Database tooenable rolling upgrades of your cloud application.</span></span> <span data-ttu-id="aeca0-106">因為升級是干擾性作業，它應該是您商務持續性規劃與設計的一部分。</span><span class="sxs-lookup"><span data-stu-id="aeca0-106">Because upgrade is a disruptive operation, it should be part of your business continuity planning and design.</span></span> <span data-ttu-id="aeca0-107">在本文探討兩個不同的方法，來協調 hello 的升級程序，並討論 hello 優點和缺點的每個選項。</span><span class="sxs-lookup"><span data-stu-id="aeca0-107">In this article we look at two different methods of orchestrating hello upgrade process, and discuss hello benefits and trade-offs of each option.</span></span> <span data-ttu-id="aeca0-108">基於本文章的 hello 我們會使用當做其資料層的 web 站台連線的 tooa 單一資料庫所組成的簡單應用程式。</span><span class="sxs-lookup"><span data-stu-id="aeca0-108">For hello purposes of this article we will use a simple application that consists of a web site connected tooa single database as its data tier.</span></span> <span data-ttu-id="aeca0-109">我們的目標是 tooupgrade 1 上的版本而不會大幅影響 hello 應用程式 tooversion 2 hello 使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="aeca0-109">Our goal is tooupgrade version 1 of hello application tooversion 2 without any significant impact on hello end-user experience.</span></span> 

<span data-ttu-id="aeca0-110">評估 hello 升級選項時，您應該考慮下列因素的 hello:</span><span class="sxs-lookup"><span data-stu-id="aeca0-110">When evaluating hello upgrade options you should consider hello following factors:</span></span>

* <span data-ttu-id="aeca0-111">升級期間對應用程式可用性的影響。</span><span class="sxs-lookup"><span data-stu-id="aeca0-111">Impact on application availability during upgrades.</span></span> <span data-ttu-id="aeca0-112">多久 hello 應用程式函式可能會限制或降級。</span><span class="sxs-lookup"><span data-stu-id="aeca0-112">How long hello application function may be limited or degraded.</span></span>
* <span data-ttu-id="aeca0-113">能力 tooroll 備份，以防升級失敗。</span><span class="sxs-lookup"><span data-stu-id="aeca0-113">Ability tooroll back in case of an upgrade failure.</span></span>
* <span data-ttu-id="aeca0-114">Hello 應用程式不相關的重大錯誤 hello 升級期間發生的弱點。</span><span class="sxs-lookup"><span data-stu-id="aeca0-114">Vulnerability of hello application if an unrelated catastrophic failure occurs during hello upgrade.</span></span>
* <span data-ttu-id="aeca0-115">總金額成本。</span><span class="sxs-lookup"><span data-stu-id="aeca0-115">Total dollar cost.</span></span>  <span data-ttu-id="aeca0-116">這包括額外的備援性和 hello hello 升級程序所用的暫存元件的遞增成本。</span><span class="sxs-lookup"><span data-stu-id="aeca0-116">This includes additional redundancy and incremental costs of hello temporary components  used by hello upgrade process.</span></span> 

## <a name="upgrading-applications-that-rely-on-database-backups-for-disaster-recovery"></a><span data-ttu-id="aeca0-117">升級依賴資料庫備份以進行災害復原的應用程式</span><span class="sxs-lookup"><span data-stu-id="aeca0-117">Upgrading applications that rely on database backups for disaster recovery</span></span>
<span data-ttu-id="aeca0-118">如果您的應用程式依賴自動資料庫備份，並針對嚴重損壞修復使用異地還原，則通常是部署的 tooa 單一 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="aeca0-118">If your application relies on automatic database backups and uses geo-restore for disaster recovery, it is usually deployed tooa single Azure region.</span></span> <span data-ttu-id="aeca0-119">在此情況下 hello 升級程序牽涉到建立備份的所有應用程式元件部署參與 hello 升級。</span><span class="sxs-lookup"><span data-stu-id="aeca0-119">In this case hello upgrade process involves creating a backup deployment of all application components involved in hello upgrade.</span></span> <span data-ttu-id="aeca0-120">您會利用 Azure Traffic Manager (WATM) 與 hello 容錯移轉設定檔 toominimize hello 使用者中斷。</span><span class="sxs-lookup"><span data-stu-id="aeca0-120">toominimize hello end-user disruption you will leverage Azure Traffic Manager (WATM) with hello failover profile.</span></span>  <span data-ttu-id="aeca0-121">hello 下列圖表說明 hello 操作環境之前 toohello 升級程序。</span><span class="sxs-lookup"><span data-stu-id="aeca0-121">hello following diagram illustrates hello operational environment prior toohello upgrade process.</span></span> <span data-ttu-id="aeca0-122">hello 端點<i>contoso 1.azurewebsites.net</i>表示需要升級 toobe hello 應用程式的生產環境位置。</span><span class="sxs-lookup"><span data-stu-id="aeca0-122">hello endpoint <i>contoso-1.azurewebsites.net</i> represents a production slot of hello application that needs toobe upgraded.</span></span> <span data-ttu-id="aeca0-123">tooenable hello 能力 tooroll 回 hello 升級，您需要建立階段插槽 hello 應用程式的完整同步處理複本。</span><span class="sxs-lookup"><span data-stu-id="aeca0-123">tooenable hello ability tooroll back hello upgrade, you need create a stage slot with a fully synchronized copy of hello application.</span></span> <span data-ttu-id="aeca0-124">hello 下列步驟是必要的 tooprepare hello hello 升級應用程式：</span><span class="sxs-lookup"><span data-stu-id="aeca0-124">hello following steps are required tooprepare hello application for hello upgrade:</span></span>

1. <span data-ttu-id="aeca0-125">建立 hello 升級階段位置。</span><span class="sxs-lookup"><span data-stu-id="aeca0-125">Create a stage slot for hello upgrade.</span></span> <span data-ttu-id="aeca0-126">建立次要資料庫 (1)，並部署相同網站中 hello toodo 相同 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="aeca0-126">toodo that create a secondary database (1) and deploy an identical web site in hello same Azure region.</span></span> <span data-ttu-id="aeca0-127">如果在完成植入處理程序的 hello，監視 hello 次要 toosee。</span><span class="sxs-lookup"><span data-stu-id="aeca0-127">Monitor hello secondary toosee if hello seeding process is completed.</span></span>
2. <span data-ttu-id="aeca0-128">在 WATM 中建立容錯移轉設定檔，<i>contoso-1.azurewebsites.net</i> 作為線上端點，<i>contoso-2.azurewebsites.net</i> 作為離線端點。</span><span class="sxs-lookup"><span data-stu-id="aeca0-128">Create a failover profile in WATM with <i>contoso-1.azurewebsites.net</i> as online endpoint and <i>contoso-2.azurewebsites.net</i> as offline.</span></span> 

> [!NOTE]
> <span data-ttu-id="aeca0-129">請注意 hello 準備步驟並不會影響 hello hello 生產位置中的應用程式，它可以在完整存取權限模式下運作。</span><span class="sxs-lookup"><span data-stu-id="aeca0-129">Note hello preparation steps will not impact hello application in hello production slot and it can function in full access mode.</span></span>
>  

![SQL Database「異地複寫」組態。](media/sql-database-manage-application-rolling-upgrade/Option1-1.png)

<span data-ttu-id="aeca0-132">Hello 準備步驟完成 hello 應用程式已準備好 hello 實際升級。</span><span class="sxs-lookup"><span data-stu-id="aeca0-132">Once hello preparation steps are completed hello application is ready for hello actual upgrade.</span></span> <span data-ttu-id="aeca0-133">hello 下列圖表說明 hello 升級程序中所包含的 hello 步驟。</span><span class="sxs-lookup"><span data-stu-id="aeca0-133">hello following diagram illustrates hello steps involved in hello upgrade process.</span></span> 

1. <span data-ttu-id="aeca0-134">Hello 主要資料庫設定 hello 生產位置 tooread-僅限模式中 (3)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-134">Set hello primary database in hello production slot tooread-only mode (3).</span></span> <span data-ttu-id="aeca0-135">這樣會保證該 hello hello 應用程式 (V1) 的實際執行個體將因此防止 hello hello V1 與 V2 資料庫執行個體之間的資料不一致的 hello 升級期間維持唯讀狀態。</span><span class="sxs-lookup"><span data-stu-id="aeca0-135">This will guarantee that hello production instance of hello application (V1) will remain read-only during hello upgrade thus preventing hello data divergence between hello V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="aeca0-136">中斷連線 hello 次要資料庫使用 hello 計劃的終止模式 (4)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-136">Disconnect hello secondary database using hello planned termination mode (4).</span></span> <span data-ttu-id="aeca0-137">它會建立 hello 主要資料庫完全同步處理獨立複本。</span><span class="sxs-lookup"><span data-stu-id="aeca0-137">It will create a fully synchronized independent copy of hello primary database.</span></span> <span data-ttu-id="aeca0-138">此資料庫將會升級。</span><span class="sxs-lookup"><span data-stu-id="aeca0-138">This database will be upgraded.</span></span>
3. <span data-ttu-id="aeca0-139">開啟 hello tooread 寫模式，主要資料庫，並執行 hello 階段插槽 (5) 中的 hello 升級指令碼。</span><span class="sxs-lookup"><span data-stu-id="aeca0-139">Turn hello primary database tooread-write mode and run hello upgrade script in hello stage slot  (5).</span></span>     

![SQL Database 異地複寫組態。](media/sql-database-manage-application-rolling-upgrade/Option1-2.png)

<span data-ttu-id="aeca0-142">如果已成功完成 hello 升級現在您已經準備就緒 tooswitch hello 終端使用者接移 toohello 複製 hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="aeca0-142">If hello upgrade completed successfully you are now ready tooswitch hello end users toohello staged copy hello application.</span></span> <span data-ttu-id="aeca0-143">它現在會變成 hello hello 應用程式的生產環境位置。</span><span class="sxs-lookup"><span data-stu-id="aeca0-143">It will now become hello production slot of hello application.</span></span>  <span data-ttu-id="aeca0-144">這牽涉到在 hello 下列圖表所示的幾個步驟。</span><span class="sxs-lookup"><span data-stu-id="aeca0-144">This involves a few more steps as illustrated on hello following diagram.</span></span>

1. <span data-ttu-id="aeca0-145">太切換 hello WATM 設定檔中的 hello 線上端點<i>contoso 2.azurewebsites.net</i>，hello 網站 (6) 的點 toohello V2 版本。</span><span class="sxs-lookup"><span data-stu-id="aeca0-145">Switch hello online endpoint in hello WATM profile too<i>contoso-2.azurewebsites.net</i>, which points toohello V2 version of hello web site (6).</span></span> <span data-ttu-id="aeca0-146">現在已成為 hello 生產位置以 hello V2 應用程式，且 hello 使用者流量導向的 tooit。</span><span class="sxs-lookup"><span data-stu-id="aeca0-146">It now becomes hello production slot with hello V2 application and hello end-user traffic is directed tooit.</span></span>  
2. <span data-ttu-id="aeca0-147">如果您不再需要 hello V1 應用程式元件，因此您可以安全地移除 (7)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-147">If you no longer need hello V1 application components so you can safely remove them (7).</span></span>   

![SQL Database 異地複寫組態。](media/sql-database-manage-application-rolling-upgrade/Option1-3.png)

<span data-ttu-id="aeca0-150">是否 hello 升級程序不成功，例如因為 tooan hello 升級指令碼中的錯誤 hello 階段位置應視為入侵。</span><span class="sxs-lookup"><span data-stu-id="aeca0-150">If hello upgrade process is unsuccessful, for example due tooan error in hello upgrade script, hello stage slot should be considered compromised.</span></span> <span data-ttu-id="aeca0-151">tooroll 回 hello 應用程式 toohello 升級前狀態您只需還原 hello hello 生產位置 toofull access 中的應用程式。</span><span class="sxs-lookup"><span data-stu-id="aeca0-151">tooroll back hello application toohello pre-upgrade state you simply revert hello application in hello production slot toofull access.</span></span> <span data-ttu-id="aeca0-152">hello 下圖會顯示 hello 所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="aeca0-152">hello steps involved are shown on hello next diagram.</span></span>    

1. <span data-ttu-id="aeca0-153">設定 hello 資料庫複製 tooread 寫入模式 (8)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-153">Set hello database copy tooread-write mode (8).</span></span> <span data-ttu-id="aeca0-154">這將會還原 hello 完整 V1 hello 生產位置中的功能。</span><span class="sxs-lookup"><span data-stu-id="aeca0-154">This will restore hello full V1 functionally in hello production slot.</span></span>
2. <span data-ttu-id="aeca0-155">執行 hello 根本原因分析，並移除 hello 階段插槽 (9) 中的 hello 危害元件。</span><span class="sxs-lookup"><span data-stu-id="aeca0-155">Perform hello root cause analysis and remove hello compromised components in hello stage slot (9).</span></span> 

<span data-ttu-id="aeca0-156">此時 hello 應用程式可完整運作，並可以重複 hello 升級步驟。</span><span class="sxs-lookup"><span data-stu-id="aeca0-156">At this point hello application is fully functional and hello upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="aeca0-157">hello 復原則不需要變更 WATM 設定檔中的因為它已經點太<i>contoso 1.azurewebsites.net</i>為 hello 主動端點。</span><span class="sxs-lookup"><span data-stu-id="aeca0-157">hello rollback does not require changes in WATM profile as it already points too<i>contoso-1.azurewebsites.net</i> as hello active endpoint.</span></span>
> 
> 

![SQL Database 異地複寫組態。](media/sql-database-manage-application-rolling-upgrade/Option1-4.png)

<span data-ttu-id="aeca0-160">hello 金鑰**利用**這個選項是您可以升級的應用程式在單一區域，使用一組簡單的步驟。</span><span class="sxs-lookup"><span data-stu-id="aeca0-160">hello key **advantage** of this option is that you can upgrade an application in a single region using a set of simple steps.</span></span> <span data-ttu-id="aeca0-161">hello 貨幣成本 hello 升級為較低。</span><span class="sxs-lookup"><span data-stu-id="aeca0-161">hello dollar cost of hello upgrade is relatively low.</span></span> <span data-ttu-id="aeca0-162">主要的 hello**權衡取捨**是，如果 hello 升級 hello 復原 toohello 升級前狀態期間發生嚴重失敗將會包含不同的區域和還原 hello 資料庫中的 hello 應用程式重新部署使用地理還原的備份。</span><span class="sxs-lookup"><span data-stu-id="aeca0-162">hello main **tradeoff** is that if a catastrophic failure occurs during hello upgrade hello recovery toohello pre-upgrade state will involve re-deployment of hello application in a different region and restoring hello database from backup using geo-restore.</span></span> <span data-ttu-id="aeca0-163">此程序將產生顯著的停機時間。</span><span class="sxs-lookup"><span data-stu-id="aeca0-163">This process will result in significant downtime.</span></span>   

## <a name="upgrading-applications-that-rely-on-database-geo-replication-for-disaster-recovery"></a><span data-ttu-id="aeca0-164">升級依賴資料庫異地複寫來進行災害復原的應用程式</span><span class="sxs-lookup"><span data-stu-id="aeca0-164">Upgrading applications that rely on database geo-replication for disaster recovery</span></span>
<span data-ttu-id="aeca0-165">如果您的應用程式會利用業務續航力的地理複寫，則部署的 tooat 至少兩個不同的區域與主要區域中作用中的部署和備份區域中的待命部署。</span><span class="sxs-lookup"><span data-stu-id="aeca0-165">If your application leverages geo-replication for business continuity, it is deployed  tooat least two different regions with an active deployment in Primary region and a standby deployment in Backup region.</span></span> <span data-ttu-id="aeca0-166">此外 toohello 因素先前所述，hello 升級程序必須保證：</span><span class="sxs-lookup"><span data-stu-id="aeca0-166">In addition toohello factors mentioned earlier, hello upgrade process must guarantee that:</span></span>

* <span data-ttu-id="aeca0-167">hello 應用程式隨時 hello 升級程序期間保持受保護的嚴重失敗</span><span class="sxs-lookup"><span data-stu-id="aeca0-167">hello application remains protected from catastrophic failures at all times during hello upgrade process</span></span>
* <span data-ttu-id="aeca0-168">hello hello 應用程式的地理備援元件會升級以平行方式與 hello 作用中的元件</span><span class="sxs-lookup"><span data-stu-id="aeca0-168">hello geo-redundant components of hello application are upgraded in parallel with hello active components</span></span>

<span data-ttu-id="aeca0-169">tooachieve 這些目標，您會利用 Azure Traffic Manager (WATM) 使用 hello 容錯移轉設定檔與一個使用中，三個的備份端點。</span><span class="sxs-lookup"><span data-stu-id="aeca0-169">tooachieve these goals you will leverage Azure Traffic Manager (WATM) using hello failover profile with one active and three backup endpoints.</span></span>  <span data-ttu-id="aeca0-170">hello 下列圖表說明 hello 操作環境之前 toohello 升級程序。</span><span class="sxs-lookup"><span data-stu-id="aeca0-170">hello following diagram illustrates hello operational environment prior toohello upgrade process.</span></span> <span data-ttu-id="aeca0-171">hello 網站<i>contoso 1.azurewebsites.net</i>和<i>contoso dr.azurewebsites.net</i>完整地理備援代表 hello 應用程式的生產環境位置。</span><span class="sxs-lookup"><span data-stu-id="aeca0-171">hello web sites <i>contoso-1.azurewebsites.net</i> and <i>contoso-dr.azurewebsites.net</i> represent a production slot of hello application with full geographic redundancy.</span></span> <span data-ttu-id="aeca0-172">tooenable hello 能力 tooroll 回 hello 升級，您需要建立階段插槽 hello 應用程式的完整同步處理複本。</span><span class="sxs-lookup"><span data-stu-id="aeca0-172">tooenable hello ability tooroll back hello upgrade, you need create a stage slot with a fully synchronized copy of hello application.</span></span> <span data-ttu-id="aeca0-173">您需要 tooensure hello 應用程式可以快速地復原以防 hello 升級程序期間發生嚴重失敗，因為 hello 階段位置需要 toobe 異地備援以及。</span><span class="sxs-lookup"><span data-stu-id="aeca0-173">Because you need tooensure that hello application can quickly recover in case a catastrophic failure occurs during hello upgrade process, hello stage slot needs toobe geo-redundant as well.</span></span> <span data-ttu-id="aeca0-174">hello 下列步驟是必要的 tooprepare hello hello 升級應用程式：</span><span class="sxs-lookup"><span data-stu-id="aeca0-174">hello following steps are required tooprepare hello application for hello upgrade:</span></span>

1. <span data-ttu-id="aeca0-175">建立 hello 升級階段位置。</span><span class="sxs-lookup"><span data-stu-id="aeca0-175">Create a stage slot for hello upgrade.</span></span> <span data-ttu-id="aeca0-176">建立次要資料庫 (1) 和部署的 hello hello 網站的相同複本的 toodo 相同 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="aeca0-176">toodo that create a secondary database (1) and deploy an identical copy of hello web site in hello same Azure region.</span></span> <span data-ttu-id="aeca0-177">如果在完成植入處理程序的 hello，監視 hello 次要 toosee。</span><span class="sxs-lookup"><span data-stu-id="aeca0-177">Monitor hello secondary toosee if hello seeding process is completed.</span></span>
2. <span data-ttu-id="aeca0-178">建立 hello 階段插槽中的異地備援的次要資料庫，藉由地理複寫 hello 次要資料庫 toohello 備份區域 （稱為 「 串連地理複寫 」）。</span><span class="sxs-lookup"><span data-stu-id="aeca0-178">Create a geo-redundant secondary database in hello stage slot by geo-replicating hello secondary database toohello backup region (this is called "chained geo-replication").</span></span> <span data-ttu-id="aeca0-179">請監視 hello 備份次要 toosee hello 植入處理程序是否已完成 (3)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-179">Monitor hello backup secondary toosee if hello seeding process is completed (3).</span></span>
3. <span data-ttu-id="aeca0-180">建立 hello 備份區域中的 hello 網站上的待命副本，並連結到 toohello 地理備援次要資料庫 (4)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-180">Create a standby copy of hello web site in hello backup region and link it toohello geo-redundant secondary (4).</span></span>  
4. <span data-ttu-id="aeca0-181">新增 hello 其他端點<i>contoso 2.azurewebsites.net</i>和<i>contoso 3.azurewebsites.net</i> toohello 容錯移轉設定檔中 WATM 為離線的端點 (5)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-181">Add hello additional endpoints <i>contoso-2.azurewebsites.net</i> and <i>contoso-3.azurewebsites.net</i> toohello failover profile in WATM as offline endpoints (5).</span></span> 

> [!NOTE]
> <span data-ttu-id="aeca0-182">請注意 hello 準備步驟並不會影響 hello hello 生產位置中的應用程式，它可以在完整存取權限模式下運作。</span><span class="sxs-lookup"><span data-stu-id="aeca0-182">Note hello preparation steps will not impact hello application in hello production slot and it can function in full access mode.</span></span>
> 
> 

![SQL Database 異地複寫組態。](media/sql-database-manage-application-rolling-upgrade/Option2-1.png)

<span data-ttu-id="aeca0-185">一旦 hello 準備步驟完成時，就有一個 hello 階段位置可供 hello 升級。</span><span class="sxs-lookup"><span data-stu-id="aeca0-185">Once hello preparation steps are completed, hello stage slot is ready for hello upgrade.</span></span> <span data-ttu-id="aeca0-186">hello 下列圖表說明 hello 升級步驟。</span><span class="sxs-lookup"><span data-stu-id="aeca0-186">hello following diagram illustrates hello upgrade steps.</span></span>

1. <span data-ttu-id="aeca0-187">Hello 主要資料庫設定 hello 生產位置 tooread-僅限模式中 (6)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-187">Set hello primary database in hello production slot tooread-only mode (6).</span></span> <span data-ttu-id="aeca0-188">這樣會保證該 hello hello 應用程式 (V1) 的實際執行個體將因此防止 hello hello V1 與 V2 資料庫執行個體之間的資料不一致的 hello 升級期間維持唯讀狀態。</span><span class="sxs-lookup"><span data-stu-id="aeca0-188">This will guarantee that hello production instance of hello application (V1) will remain read-only during hello upgrade thus preventing hello data divergence between hello V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="aeca0-189">中斷連接次要資料庫的 hello hello 中相同的區域使用 hello 計劃的終止模式 (7)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-189">Disconnect hello secondary database in hello same region using hello planned termination mode (7).</span></span> <span data-ttu-id="aeca0-190">它會建立完全同步處理的獨立 hello 主要資料庫，就會自動變成 hello 終止後的主要副本。</span><span class="sxs-lookup"><span data-stu-id="aeca0-190">It will create a fully synchronized independent copy of hello primary database, which will automatically become a primary after hello termination.</span></span> <span data-ttu-id="aeca0-191">此資料庫將會升級。</span><span class="sxs-lookup"><span data-stu-id="aeca0-191">This database will be upgraded.</span></span>
3. <span data-ttu-id="aeca0-192">在 hello 階段插槽 tooread 寫入模式下開啟 hello 主要資料庫，並執行 hello 升級指令碼 (8)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-192">Turn hello primary database in hello stage slot tooread-write mode and run hello upgrade script (8).</span></span>    

![SQL Database 異地複寫組態。](media/sql-database-manage-application-rolling-upgrade/Option2-2.png)

<span data-ttu-id="aeca0-195">如果已成功完成 hello 升級現在您已經準備就緒 tooswitch hello 使用者 toohello V2 hello 應用程式版本。</span><span class="sxs-lookup"><span data-stu-id="aeca0-195">If hello upgrade completed successfully you are now ready tooswitch hello end users toohello V2 version of hello application.</span></span> <span data-ttu-id="aeca0-196">hello 下列圖表說明 hello 所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="aeca0-196">hello following diagram illustrates hello steps involved.</span></span>

1. <span data-ttu-id="aeca0-197">太切換 hello WATM 設定檔中的 hello 作用中端點<i>contoso 2.azurewebsites.net</i>，現在點 toohello V2 hello 網站 (9) 版本。</span><span class="sxs-lookup"><span data-stu-id="aeca0-197">Switch hello active endpoint in hello WATM profile too<i>contoso-2.azurewebsites.net</i>, which now points toohello V2 version of hello web site (9).</span></span> <span data-ttu-id="aeca0-198">它現在成為生產位置以 hello V2 應用程式，且使用者流量導向的 tooit。</span><span class="sxs-lookup"><span data-stu-id="aeca0-198">It now becomes a production slot with hello V2 application and end-user traffic is directed tooit.</span></span> 
2. <span data-ttu-id="aeca0-199">如果您不再需要 hello V1 應用程式，這樣您就可以安全地移除它 （10 和 11）。</span><span class="sxs-lookup"><span data-stu-id="aeca0-199">If you no longer need hello V1 application so you can safely remove it (10 and 11).</span></span>  

![SQL Database 異地複寫組態。](media/sql-database-manage-application-rolling-upgrade/Option2-3.png)

<span data-ttu-id="aeca0-202">是否 hello 升級程序不成功，例如因為 tooan hello 升級指令碼中的錯誤 hello 階段位置應視為入侵。</span><span class="sxs-lookup"><span data-stu-id="aeca0-202">If hello upgrade process is unsuccessful, for example due tooan error in hello upgrade script, hello stage slot should be considered compromised.</span></span> <span data-ttu-id="aeca0-203">tooroll 回 hello 應用程式 toohello 升級前狀態您只需還原 toousing hello 應用程式具有完整存取權的 hello 生產位置中。</span><span class="sxs-lookup"><span data-stu-id="aeca0-203">tooroll back hello application toohello pre-upgrade state you simply revert toousing hello application in hello production slot with full access.</span></span> <span data-ttu-id="aeca0-204">hello 下圖會顯示 hello 所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="aeca0-204">hello steps involved are shown on hello next diagram.</span></span>    

1. <span data-ttu-id="aeca0-205">設定 hello hello 生產位置 tooread 寫入模式 (12) 的主要資料庫複本。</span><span class="sxs-lookup"><span data-stu-id="aeca0-205">Set hello primary database copy in hello production slot tooread-write mode (12).</span></span> <span data-ttu-id="aeca0-206">這將會還原 hello 完整 V1 hello 生產位置中的功能。</span><span class="sxs-lookup"><span data-stu-id="aeca0-206">This will restore hello full V1 functionally in hello production slot.</span></span>
2. <span data-ttu-id="aeca0-207">執行 hello 根本原因分析，並移除 hello 階段插槽 （13 與 14） 中的 hello 危害元件。</span><span class="sxs-lookup"><span data-stu-id="aeca0-207">Perform hello root cause analysis and remove hello compromised components in hello stage slot (13 and 14).</span></span> 

<span data-ttu-id="aeca0-208">此時 hello 應用程式可完整運作，並可以重複 hello 升級步驟。</span><span class="sxs-lookup"><span data-stu-id="aeca0-208">At this point hello application is fully functional and hello upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="aeca0-209">hello 復原則不需要變更 WATM 設定檔中的因為它已經點太<i>contoso 1.azurewebsites.net</i>為 hello 主動端點。</span><span class="sxs-lookup"><span data-stu-id="aeca0-209">hello rollback does not require changes in WATM profile as it already points too <i>contoso-1.azurewebsites.net</i> as hello active endpoint.</span></span>
> 
> 

![SQL Database 異地複寫組態。](media/sql-database-manage-application-rolling-upgrade/Option2-4.png)

<span data-ttu-id="aeca0-212">hello 金鑰**利用**這個選項時，您可以升級 hello 應用程式和其異地備援複本，以平行方式而不會危害您的業務續航力 hello 升級期間。</span><span class="sxs-lookup"><span data-stu-id="aeca0-212">hello key **advantage** of this option is that you can upgrade both hello application and its geo-redundant copy in parallel without compromising your business continuity during hello upgrade.</span></span> <span data-ttu-id="aeca0-213">主要的 hello**權衡取捨**是它需要的每個應用程式元件的雙重備援性，因此造成 貨幣成本較高。</span><span class="sxs-lookup"><span data-stu-id="aeca0-213">hello main **tradeoff** is that it requires double redundancy of each application component and therefore incurs higher dollar cost.</span></span> <span data-ttu-id="aeca0-214">它也涉及更複雜的工作流程。</span><span class="sxs-lookup"><span data-stu-id="aeca0-214">It also involves a more complicated workflow.</span></span> 

## <a name="summary"></a><span data-ttu-id="aeca0-215">摘要</span><span class="sxs-lookup"><span data-stu-id="aeca0-215">Summary</span></span>
<span data-ttu-id="aeca0-216">hello 兩個升級方法 hello 文章所述的相同複雜性和 hello 貨幣成本，但它們都著重於最小化 hello 時間 hello 終端使用者限制為只能在 tooread 上執行的操作。</span><span class="sxs-lookup"><span data-stu-id="aeca0-216">hello two upgrade methods described in hello article differ in complexity and hello dollar cost but they both focus on minimizing hello time when hello end user is limited tooread-only operations.</span></span> <span data-ttu-id="aeca0-217">直接由 hello hello 升級指令碼期間定義該時間。</span><span class="sxs-lookup"><span data-stu-id="aeca0-217">That time is directly defined by hello duration of hello upgrade script.</span></span> <span data-ttu-id="aeca0-218">它不依賴 hello 資料庫大小、 hello 服務層您選擇 hello 網站組態，您無法輕鬆地控制其他因素。</span><span class="sxs-lookup"><span data-stu-id="aeca0-218">It does not depend on hello database size, hello service tier you chose, hello web site configuration and other factors that you cannot easily control.</span></span> <span data-ttu-id="aeca0-219">這是因為所有的 hello 準備步驟彼此分離時 hello 升級步驟可以完成而不會影響 hello 實際執行應用程式。</span><span class="sxs-lookup"><span data-stu-id="aeca0-219">This is because all hello preparation steps are decoupled from hello upgrade steps and can be done without impacting hello production application.</span></span> <span data-ttu-id="aeca0-220">hello 效率 hello 升級指令碼是 hello 決定在升級期間的 hello 使用者體驗的關鍵因素。</span><span class="sxs-lookup"><span data-stu-id="aeca0-220">hello efficiency of hello upgrade script is hello key factor that determines hello end-user experience during upgrades.</span></span> <span data-ttu-id="aeca0-221">因此可以改善 hello 最佳方式是集中建立盡可能有效率 hello 升級指令碼工作。</span><span class="sxs-lookup"><span data-stu-id="aeca0-221">So hello best way you can improve it is by focusing your efforts on making hello upgrade script as efficient as possible.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="aeca0-222">後續步驟</span><span class="sxs-lookup"><span data-stu-id="aeca0-222">Next steps</span></span>
* <span data-ttu-id="aeca0-223">如需商務持續性概觀和案例，請參閱 [商務持續性概觀](sql-database-business-continuity.md)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-223">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md).</span></span>
* <span data-ttu-id="aeca0-224">toolearn 有關自動化 Azure SQL Database 備份，請參閱[SQL 資料庫自動備份](sql-database-automated-backups.md)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-224">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="aeca0-225">toolearn 有關使用自動的備份進行復原，請參閱[從自動備份中還原資料庫](sql-database-recovery-using-backups.md)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-225">toolearn about using automated backups for recovery, see [restore a database from automated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="aeca0-226">toolearn 有關更快速的復原選項，請參閱[作用中地理複寫](sql-database-geo-replication-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="aeca0-226">toolearn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md).</span></span>


