---
title: "授予存取 Azure SQL Database 之權利 | Microsoft Docs"
description: "了解授予存取 Microsoft Azure SQL Database 之權利。"
services: sql-database
documentationcenter: 
author: BYHAM
manager: jhubbard
editor: 
tags: 
ms.assetid: 8e71b04c-bc38-4153-8f83-f2b14faa31d9
ms.service: sql-database
ms.custom: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 02/06/2017
ms.author: rickbyh
ms.openlocfilehash: 0ca1ccd273317d67537d31724d566625a4eb2c85
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="azure-sql-database-access-control"></a><span data-ttu-id="bee61-103">Azure SQL Database 存取控制</span><span class="sxs-lookup"><span data-stu-id="bee61-103">Azure SQL Database access control</span></span>
<span data-ttu-id="bee61-104">為了提供安全性，SQL Database 會透過以下機制來控制存取：依 IP 位址限制連線的防火牆規則、要求使用者證明其身分識別的驗證機制，以及將使用者限制在特定動作和資料的授權機制。</span><span class="sxs-lookup"><span data-stu-id="bee61-104">To provide security, SQL Database controls access with firewall rules limiting connectivity by IP address, authentication mechanisms requiring users to prove their identity, and authorization mechanisms limiting users to specific actions and data.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="bee61-105">如需 SQL Database 安全性功能的概觀，請參閱 [SQL 安全性概觀](sql-database-security-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="bee61-105">For an overview of the SQL Database security features, see [SQL security overview](sql-database-security-overview.md).</span></span> <span data-ttu-id="bee61-106">如需教學課程，請參閱[保護 Azure SQL Database](sql-database-security-tutorial.md)。</span><span class="sxs-lookup"><span data-stu-id="bee61-106">For a tutorial, see [Secure your Azure SQL Database](sql-database-security-tutorial.md).</span></span>

## <a name="firewall-and-firewall-rules"></a><span data-ttu-id="bee61-107">防火牆與防火牆規則</span><span class="sxs-lookup"><span data-stu-id="bee61-107">Firewall and firewall rules</span></span>
<span data-ttu-id="bee61-108">Microsoft Azure SQL Database 為 Azure 和其他網際網路式應用程式提供關聯式資料庫服務。</span><span class="sxs-lookup"><span data-stu-id="bee61-108">Microsoft Azure SQL Database provides a relational database service for Azure and other Internet-based applications.</span></span> <span data-ttu-id="bee61-109">為了協助保護您的資料，防火牆會防止對您的資料庫伺服器的所有存取，直到您指定哪些電腦擁有權限。</span><span class="sxs-lookup"><span data-stu-id="bee61-109">To help protect your data, firewalls prevent all access to your database server until you specify which computers have permission.</span></span> <span data-ttu-id="bee61-110">此防火牆會根據每一個要求的來源 IP 位址來授與資料庫存取權。</span><span class="sxs-lookup"><span data-stu-id="bee61-110">The firewall grants access to databases based on the originating IP address of each request.</span></span> <span data-ttu-id="bee61-111">如需詳細資訊，請參閱 [Azure SQL Database 防火牆規則概觀](sql-database-firewall-configure.md)</span><span class="sxs-lookup"><span data-stu-id="bee61-111">For more information, see [Overview of Azure SQL Database firewall rules](sql-database-firewall-configure.md)</span></span>

<span data-ttu-id="bee61-112">Azure SQL Database 服務唯有透過 TCP 通訊埠 1433 才能使用。</span><span class="sxs-lookup"><span data-stu-id="bee61-112">The Azure SQL Database service is only available through TCP port 1433.</span></span> <span data-ttu-id="bee61-113">若要從您的電腦存取 SQL Database，請務必確認您的用戶端電腦防火牆允許 TCP 連接埠 1433 上的傳出 TCP 通訊。</span><span class="sxs-lookup"><span data-stu-id="bee61-113">To access a SQL Database from your computer, ensure that your client computer firewall allows outgoing TCP communication on TCP port 1433.</span></span> <span data-ttu-id="bee61-114">如果其他應用程式不需要，請封鎖 TCP 通訊埠 1433 的傳入連線。</span><span class="sxs-lookup"><span data-stu-id="bee61-114">If not needed for other applications, block inbound connections on TCP port 1433.</span></span> 

<span data-ttu-id="bee61-115">連接程序當中，從 Azure 虛擬機器的連接會被重新導向到不同的 IP 位址和連接埠，針對每個背景工作角色都是唯一。</span><span class="sxs-lookup"><span data-stu-id="bee61-115">As part of the connection process, connections from Azure virtual machines are redirected to a different IP address and port, unique for each worker role.</span></span> <span data-ttu-id="bee61-116">連接埠號碼的範圍從 11000 到 11999。</span><span class="sxs-lookup"><span data-stu-id="bee61-116">The port number is in the range from 11000 to 11999.</span></span> <span data-ttu-id="bee61-117">如需 TCP 連接埠的詳細資訊，請參閱[適用於 ADO.NET 4.5 及 SQL Database 的 1433 以外的連接埠](sql-database-develop-direct-route-ports-adonet-v12.md)。</span><span class="sxs-lookup"><span data-stu-id="bee61-117">For more information about TCP ports, see [Ports beyond 1433 for ADO.NET 4.5 and SQL Database2](sql-database-develop-direct-route-ports-adonet-v12.md).</span></span>

## <a name="authentication"></a><span data-ttu-id="bee61-118">驗證</span><span class="sxs-lookup"><span data-stu-id="bee61-118">Authentication</span></span>

<span data-ttu-id="bee61-119">SQL Database 支援兩種驗證類型：</span><span class="sxs-lookup"><span data-stu-id="bee61-119">SQL Database supports two types of authentication:</span></span>

* <span data-ttu-id="bee61-120">**SQL 驗證**，其需要使用者名稱和密碼。</span><span class="sxs-lookup"><span data-stu-id="bee61-120">**SQL Authentication**, which uses a username and password.</span></span> <span data-ttu-id="bee61-121">當您為資料庫建立邏輯伺服器時，採取使用者名稱和密碼指定了「伺服器管理員」登入。</span><span class="sxs-lookup"><span data-stu-id="bee61-121">When you created the logical server for your database, you specified a "server admin" login with a username and password.</span></span> <span data-ttu-id="bee61-122">使用這些認證，您就可以使用資料庫擁有者或 "dbo" 的身分驗證該伺服器上的任何資料庫。</span><span class="sxs-lookup"><span data-stu-id="bee61-122">Using these credentials, you can authenticate to any database on that server as the database owner, or "dbo."</span></span> 
* <span data-ttu-id="bee61-123">**Azure Active Directory 驗證**，它會使用由 Azure Active Directory 管理的身分識別，並支援受管理和整合的網域。</span><span class="sxs-lookup"><span data-stu-id="bee61-123">**Azure Active Directory Authentication**, which uses identities managed by Azure Active Directory and is supported for managed and integrated domains.</span></span> <span data-ttu-id="bee61-124">[盡可能](https://docs.microsoft.com/sql/relational-databases/security/choose-an-authentication-mode)使用 Active Directory 驗證 (整合式安全性)。</span><span class="sxs-lookup"><span data-stu-id="bee61-124">Use Active Directory authentication (integrated security) [whenever possible](https://docs.microsoft.com/sql/relational-databases/security/choose-an-authentication-mode).</span></span> <span data-ttu-id="bee61-125">如果您想要使用 Azure Active Directory 驗證，就必須建立另一個名為「Azure AD 管理員」的伺服器管理員，其能夠管理 Azure AD 使用者和群組。</span><span class="sxs-lookup"><span data-stu-id="bee61-125">If you want to use Azure Active Directory Authentication, you must create another server admin called the "Azure AD admin," which is allowed to administer Azure AD users and groups.</span></span> <span data-ttu-id="bee61-126">此管理員也可以執行一般伺服器管理員可執行的所有作業。</span><span class="sxs-lookup"><span data-stu-id="bee61-126">This admin can also perform all operations that a regular server admin can.</span></span> <span data-ttu-id="bee61-127">如需如何建立 Azure AD 管理員以啟用 Azure Active Directory 驗證的逐步解說，請參閱 [使用 Azure Active Directory 驗證連線到 SQL Database](sql-database-aad-authentication.md) 。</span><span class="sxs-lookup"><span data-stu-id="bee61-127">See [Connecting to SQL Database By Using Azure Active Directory Authentication](sql-database-aad-authentication.md) for a walkthrough of how to create an Azure AD admin to enable Azure Active Directory Authentication.</span></span>

<span data-ttu-id="bee61-128">資料庫引擎會關閉保持閒置超過 30 分鐘的連接。</span><span class="sxs-lookup"><span data-stu-id="bee61-128">The Database Engine closes connections that remain idle for more than 30 minutes.</span></span> <span data-ttu-id="bee61-129">必須重新登入才能使用連接。</span><span class="sxs-lookup"><span data-stu-id="bee61-129">The connection must login again before it can be used.</span></span> <span data-ttu-id="bee61-130">持續作用中的 SQL Database 連接，需要至少每 10 個小時重新授權一次 (由資料庫引擎執行)。</span><span class="sxs-lookup"><span data-stu-id="bee61-130">Continuously active connections to SQL Database require reauthorization (performed by the database engine) at least every 10 hours.</span></span> <span data-ttu-id="bee61-131">資料庫引擎嘗試重新授權時，會使用原本送出的密碼，但不需要使用者輸入。</span><span class="sxs-lookup"><span data-stu-id="bee61-131">The database engine attempts reauthorization using the originally submitted password and no user input is required.</span></span> <span data-ttu-id="bee61-132">基於效能考量，當在 SQL Database 中重設密碼時，並不會重新驗證連線，即使因連線共用而重設連線時也一樣。</span><span class="sxs-lookup"><span data-stu-id="bee61-132">For performance reasons, when a password is reset in SQL Database, the connection is not be reauthenticated, even if the connection is reset due to connection pooling.</span></span> <span data-ttu-id="bee61-133">這點與內部部署 SQL Server 的行為不同。</span><span class="sxs-lookup"><span data-stu-id="bee61-133">This is different from the behavior of on-premises SQL Server.</span></span> <span data-ttu-id="bee61-134">如果連接經過初始授權後，密碼已經變更，則必須終止連接並使用新密碼建立新的連接。</span><span class="sxs-lookup"><span data-stu-id="bee61-134">If the password has been changed since the connection was initially authorized, the connection must be terminated and a new connection made using the new password.</span></span> <span data-ttu-id="bee61-135">具有 `KILL DATABASE CONNECTION` 權限的使用者可以使用 [KILL](https://docs.microsoft.com/sql/t-sql/language-elements/kill-transact-sql) 命令，明確地終止 SQL Database 的連線。</span><span class="sxs-lookup"><span data-stu-id="bee61-135">A user with the `KILL DATABASE CONNECTION` permission can explicitly terminate a connection to SQL Database by using the [KILL](https://docs.microsoft.com/sql/t-sql/language-elements/kill-transact-sql) command.</span></span>

<span data-ttu-id="bee61-136">使用者帳戶可以建立在主要資料庫中，並獲得伺服器上所有資料庫的權限，或者，可將帳戶建立在資料庫自身當中 (稱為自主使用者)。</span><span class="sxs-lookup"><span data-stu-id="bee61-136">User accounts can be created in the master database and can be granted permissions in all databases on the server, or they can be created in the database itself (called contained users).</span></span> <span data-ttu-id="bee61-137">如需建立和管理登入的資訊，請參閱[管理登入](sql-database-manage-logins.md)。</span><span class="sxs-lookup"><span data-stu-id="bee61-137">For information on creating and managing logins, see [Manage logins](sql-database-manage-logins.md).</span></span> <span data-ttu-id="bee61-138">若要提升可攜性和延展性，請使用自主資料庫使用者來增強延展性。</span><span class="sxs-lookup"><span data-stu-id="bee61-138">To enhance portability and scalabilty, use contained database users to enhance scalability.</span></span> <span data-ttu-id="bee61-139">如需自主使用者的詳細資訊，請參閱[自主的資料庫使用者 - 使資料庫可攜](https://docs.microsoft.com/sql/relational-databases/security/contained-database-users-making-your-database-portable)、[CREATE USER (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/statements/create-user-transact-sql) 及[自主資料庫](https://docs.microsoft.com/sql/relational-databases/databases/contained-databases)。</span><span class="sxs-lookup"><span data-stu-id="bee61-139">For more information on contained users, see [Contained Database Users - Making Your Database Portable](https://docs.microsoft.com/sql/relational-databases/security/contained-database-users-making-your-database-portable), [CREATE USER (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/statements/create-user-transact-sql), and [Contained Databases](https://docs.microsoft.com/sql/relational-databases/databases/contained-databases).</span></span>

<span data-ttu-id="bee61-140">最佳作法是，您的應用程式應該使用專用帳戶進行驗證，因為萬一應用程式的程式碼容易受到 SQL 插入式攻擊，您就可以限制授與應用程式的權限，並降低惡意活動的風險。</span><span class="sxs-lookup"><span data-stu-id="bee61-140">As a best practice your application should use a dedicated account to authenticate -- this way you can limit the permissions granted to the application and reduce the risks of malicious activity in case your application code is vulnerable to a SQL injection attack.</span></span> <span data-ttu-id="bee61-141">建議的方法是建立[自主資料庫使用者](https://docs.microsoft.com/sql/relational-databases/security/contained-database-users-making-your-database-portable)，讓您的應用程式直接與資料庫進行驗證。</span><span class="sxs-lookup"><span data-stu-id="bee61-141">The recommended approach is to create a [contained database user](https://docs.microsoft.com/sql/relational-databases/security/contained-database-users-making-your-database-portable), which allows your app to authenticate directly to the database.</span></span> 

## <a name="authorization"></a><span data-ttu-id="bee61-142">Authorization</span><span class="sxs-lookup"><span data-stu-id="bee61-142">Authorization</span></span>

<span data-ttu-id="bee61-143">授權是指使用者可以在 Azure SQL Database 內執行的動作，這是由使用者帳戶的資料庫[角色成員資格](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/database-level-roles)和[物件層級權限](https://docs.microsoft.com/sql/relational-databases/security/permissions-database-engine)所控制。</span><span class="sxs-lookup"><span data-stu-id="bee61-143">Authorization refers to what a user can do within an Azure SQL Database, and this is controlled by your user account's database [role memberships](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/database-level-roles) and [object-level permissions](https://docs.microsoft.com/sql/relational-databases/security/permissions-database-engine).</span></span> <span data-ttu-id="bee61-144">最好的作法是，您應該授與使用者所需的最低權限。</span><span class="sxs-lookup"><span data-stu-id="bee61-144">As a best practice, you should grant users the least privileges necessary.</span></span> <span data-ttu-id="bee61-145">您所連線的伺服器管理員帳戶是 db_owner 的成員，有權限在資料庫中執行任何動作。</span><span class="sxs-lookup"><span data-stu-id="bee61-145">The server admin account you are connecting with is a member of db_owner, which has authority to do anything within the database.</span></span> <span data-ttu-id="bee61-146">請儲存此帳戶，以便部署結構描述升級及其他管理作業。</span><span class="sxs-lookup"><span data-stu-id="bee61-146">Save this account for deploying schema upgrades and other management operations.</span></span> <span data-ttu-id="bee61-147">請使用具更多有限權限的 "ApplicationUser" 帳戶，從應用程式連線到具應用程式所需之最低權限的資料庫。</span><span class="sxs-lookup"><span data-stu-id="bee61-147">Use the "ApplicationUser" account with more limited permissions to connect from your application to the database with the least privileges needed by your application.</span></span> <span data-ttu-id="bee61-148">如需詳細資訊，請參閱[管理登入](sql-database-manage-logins.md)。</span><span class="sxs-lookup"><span data-stu-id="bee61-148">For more information, see [Manage logins](sql-database-manage-logins.md).</span></span>

<span data-ttu-id="bee61-149">通常，只有系統管理員需要存取 `master` 資料庫。</span><span class="sxs-lookup"><span data-stu-id="bee61-149">Typically, only administrators need access to the `master` database.</span></span> <span data-ttu-id="bee61-150">對每個使用者資料庫的例行存取，應該透過每個資料庫中建立的非系統管理員的自主資料庫使用者來存取。</span><span class="sxs-lookup"><span data-stu-id="bee61-150">Routine access to each user database should be through non-administrator contained database users created in each database.</span></span> <span data-ttu-id="bee61-151">當您使用自主資料庫使用者時，您不需要在 `master` 資料庫中建立登入。</span><span class="sxs-lookup"><span data-stu-id="bee61-151">When you use contained database users, you do not need to create logins in the `master` database.</span></span> <span data-ttu-id="bee61-152">如需詳細資訊，請參閱 [自主資料庫使用者 - 讓資料庫具有可攜性](https://docs.microsoft.com/sql/relational-databases/security/contained-database-users-making-your-database-portable)。</span><span class="sxs-lookup"><span data-stu-id="bee61-152">For more information, see [Contained Database Users - Making Your Database Portable](https://docs.microsoft.com/sql/relational-databases/security/contained-database-users-making-your-database-portable).</span></span>

<span data-ttu-id="bee61-153">您應該熟悉下列功能，這些功能可用來限制或提高權限︰</span><span class="sxs-lookup"><span data-stu-id="bee61-153">You should familiarize yourself with the following features that can be used to limit or elevate permissions:</span></span>   
* <span data-ttu-id="bee61-154">[模擬](https://docs.microsoft.com/dotnet/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server)和[模組簽署](https://docs.microsoft.com/dotnet/framework/data/adonet/sql/signing-stored-procedures-in-sql-server)可用來安全地暫時提升權限。</span><span class="sxs-lookup"><span data-stu-id="bee61-154">[Impersonation](https://docs.microsoft.com/dotnet/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server) and [module-signing](https://docs.microsoft.com/dotnet/framework/data/adonet/sql/signing-stored-procedures-in-sql-server) can be used to securely elevate permissions temporarily.</span></span>
* <span data-ttu-id="bee61-155">[資料列層級安全性](https://docs.microsoft.com/sql/relational-databases/security/row-level-security) 可用於使用者可存取資料列的限制。</span><span class="sxs-lookup"><span data-stu-id="bee61-155">[Row-Level Security](https://docs.microsoft.com/sql/relational-databases/security/row-level-security) can be used limit which rows a user can access.</span></span>
* <span data-ttu-id="bee61-156">[資料遮罩](sql-database-dynamic-data-masking-get-started.md) 可用來限制公開機密資料。</span><span class="sxs-lookup"><span data-stu-id="bee61-156">[Data Masking](sql-database-dynamic-data-masking-get-started.md) can be used to limit exposure of sensitive data.</span></span>
* <span data-ttu-id="bee61-157">[預存程序](https://docs.microsoft.com/sql/relational-databases/stored-procedures/stored-procedures-database-engine) 可用來限制對資料庫可採取的動作。</span><span class="sxs-lookup"><span data-stu-id="bee61-157">[Stored procedures](https://docs.microsoft.com/sql/relational-databases/stored-procedures/stored-procedures-database-engine) can be used to limit the actions that can be taken on the database.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bee61-158">後續步驟</span><span class="sxs-lookup"><span data-stu-id="bee61-158">Next steps</span></span>

- <span data-ttu-id="bee61-159">如需 SQL Database 安全性功能的概觀，請參閱 [SQL 安全性概觀](sql-database-security-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="bee61-159">For an overview of the SQL Database security features, see [SQL security overview](sql-database-security-overview.md).</span></span>
- <span data-ttu-id="bee61-160">若要深入了解防火牆規則，請參閱[防火牆規則](sql-database-firewall-configure.md)。</span><span class="sxs-lookup"><span data-stu-id="bee61-160">To learn more about firewall rules, see [Firewall rules](sql-database-firewall-configure.md).</span></span>
- <span data-ttu-id="bee61-161">若要了解使用者和登入，請參閱[管理登入](sql-database-manage-logins.md)。</span><span class="sxs-lookup"><span data-stu-id="bee61-161">To learn about users and logins, see [Manage logins](sql-database-manage-logins.md).</span></span> 
- <span data-ttu-id="bee61-162">關於主動式監視的討論，請參閱[資料庫稽核](sql-database-auditing.md)和 [SQL Database 威脅偵測](sql-database-threat-detection.md)。</span><span class="sxs-lookup"><span data-stu-id="bee61-162">For a discussion of proactive monitoring, see [Database Auditing](sql-database-auditing.md) and [SQL Database Threat Detection](sql-database-threat-detection.md).</span></span>
- <span data-ttu-id="bee61-163">如需教學課程，請參閱[保護 Azure SQL Database](sql-database-security-tutorial.md)。</span><span class="sxs-lookup"><span data-stu-id="bee61-163">For a tutorial, see [Secure your Azure SQL Database](sql-database-security-tutorial.md).</span></span>
