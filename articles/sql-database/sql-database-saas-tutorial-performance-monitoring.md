---
title: "在多租用戶 SaaS 應用程式中的許多 Azure SQL 資料庫的 aaaMonitor 效能 |Microsoft 文件"
description: "監視和管理的資料庫和 hello Azure SQL Database Wingtip SaaS 應用程式集區效能"
keywords: SQL Database Azure
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/26/2017
ms.author: sstein
ms.openlocfilehash: f0d7ba456c485b7de249a56abac3cf4be3857285
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="monitor-performance-of-hello-wingtip-saas-application"></a><span data-ttu-id="5058e-104">監視效能的 hello Wingtip SaaS 應用程式</span><span class="sxs-lookup"><span data-stu-id="5058e-104">Monitor performance of hello Wingtip SaaS application</span></span>

<span data-ttu-id="5058e-105">本教學課程會探索 SaaS 應用程式中使用的數個關鍵效能管理案例。</span><span class="sxs-lookup"><span data-stu-id="5058e-105">In this tutorial, several key performance management scenarios used in SaaS applications are explored.</span></span> <span data-ttu-id="5058e-106">使用負載產生器 toosimulate 活動跨越多個租用戶的所有資料庫，hello 內建的監視和警示功能的 SQL Database 和彈性集區會示範。</span><span class="sxs-lookup"><span data-stu-id="5058e-106">Using a load generator toosimulate activity across all tenant databases, hello built-in monitoring and alerting features of SQL Database and elastic pools are demonstrated.</span></span>

<span data-ttu-id="5058e-107">hello Wingtip SaaS 應用程式會使用單一租用戶資料模型，其中每個地點 （租用戶） 都有各自的資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-107">hello Wingtip SaaS app uses a single-tenant data model, where each venue (tenant) has their own database.</span></span> <span data-ttu-id="5058e-108">許多 SaaS 應用程式，例如 hello 預期租用戶工作負載模式是無法預期且斷斷續續。</span><span class="sxs-lookup"><span data-stu-id="5058e-108">Like many SaaS applications, hello anticipated tenant workload pattern is unpredictable and sporadic.</span></span> <span data-ttu-id="5058e-109">換句話說，票證銷售可能會在任何時間發生。</span><span class="sxs-lookup"><span data-stu-id="5058e-109">In other words, ticket sales may occur at any time.</span></span> <span data-ttu-id="5058e-110">這個一般資料庫使用模式，租用戶資料庫部署至彈性資料庫集區的 tootake 優點。</span><span class="sxs-lookup"><span data-stu-id="5058e-110">tootake advantage of this typical database usage pattern, tenant databases are deployed into elastic database pools.</span></span> <span data-ttu-id="5058e-111">彈性集區最佳化解決方案的 hello 成本跨多個資料庫共用資源。</span><span class="sxs-lookup"><span data-stu-id="5058e-111">Elastic pools optimize hello cost of a solution by sharing resources across many databases.</span></span> <span data-ttu-id="5058e-112">這種模式，它為重要 toomonitor 資料庫，而載入的集區資源使用量 tooensure 合理的平衡跨集區。</span><span class="sxs-lookup"><span data-stu-id="5058e-112">With this type of pattern, it's important toomonitor database and pool resource usage tooensure that loads are reasonably balanced across pools.</span></span> <span data-ttu-id="5058e-113">您也需要 tooensure，個別的資料庫擁有足夠的資源和集區不會叫用其[eDTU](sql-database-what-is-a-dtu.md)限制。</span><span class="sxs-lookup"><span data-stu-id="5058e-113">You also need tooensure that individual databases have adequate resources, and that pools are not hitting their [eDTU](sql-database-what-is-a-dtu.md) limits.</span></span> <span data-ttu-id="5058e-114">本教學課程瀏覽方式 toomonitor 和管理資料庫和集區，以及如何在工作負載中的回應 toovariations tootake 矯正措施。</span><span class="sxs-lookup"><span data-stu-id="5058e-114">This tutorial explores ways toomonitor and manage databases and pools, and how tootake corrective action in response toovariations in workload.</span></span>

<span data-ttu-id="5058e-115">在本教學課程中，您了解如何：</span><span class="sxs-lookup"><span data-stu-id="5058e-115">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="5058e-116">Hello 租用戶資料庫上的使用量，以模擬的執行提供的負載產生器</span><span class="sxs-lookup"><span data-stu-id="5058e-116">Simulate usage on hello tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="5058e-117">監視 hello 租用戶資料庫，如同這些回應 toohello 增加負載</span><span class="sxs-lookup"><span data-stu-id="5058e-117">Monitor hello tenant databases as they respond toohello increase in load</span></span>
> * <span data-ttu-id="5058e-118">向上擴充 hello 回應 toohello 增加的資料庫負載中的彈性集區</span><span class="sxs-lookup"><span data-stu-id="5058e-118">Scale up hello Elastic pool in response toohello increased database load</span></span>
> * <span data-ttu-id="5058e-119">佈建第二個的彈性集區 tooload 平衡資料庫活動</span><span class="sxs-lookup"><span data-stu-id="5058e-119">Provision a second Elastic pool tooload balance database activity</span></span>


<span data-ttu-id="5058e-120">toocomplete 完成本教學課程，請確定 hello 下列必要條件：</span><span class="sxs-lookup"><span data-stu-id="5058e-120">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="5058e-121">hello Wingtip SaaS 應用程式部署。</span><span class="sxs-lookup"><span data-stu-id="5058e-121">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="5058e-122">toodeploy 在五分鐘內，請參閱[部署及瀏覽 hello Wingtip SaaS 應用程式](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="5058e-122">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="5058e-123">已安裝 Azure PowerShell。</span><span class="sxs-lookup"><span data-stu-id="5058e-123">Azure PowerShell is installed.</span></span> <span data-ttu-id="5058e-124">如需詳細資料，請參閱[開始使用 Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="5058e-124">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-toosaas-performance-management-patterns"></a><span data-ttu-id="5058e-125">簡介 tooSaaS 效能管理模式</span><span class="sxs-lookup"><span data-stu-id="5058e-125">Introduction tooSaaS performance management patterns</span></span>

<span data-ttu-id="5058e-126">資料庫效能管理包含編譯和分析效能資料，然後對回應 toothis 資料，藉由調整參數 toomaintain 應用程式接受的回應時間。</span><span class="sxs-lookup"><span data-stu-id="5058e-126">Managing database performance consists of compiling and analyzing performance data, and then reacting toothis data by adjusting parameters toomaintain an acceptable response time for your application.</span></span> <span data-ttu-id="5058e-127">當裝載多個租用戶，彈性資料庫集區會符合成本效益的方式 tooprovide 和管理群組的資料庫無法預期的工作負載的資源。</span><span class="sxs-lookup"><span data-stu-id="5058e-127">When hosting multiple tenants, Elastic database pools are a cost-effective way tooprovide and manage resources for a group of databases with unpredictable workloads.</span></span> <span data-ttu-id="5058e-128">使用特定工作負載模式，最少為兩個 S3 資料庫可以受惠於在集區中管理。</span><span class="sxs-lookup"><span data-stu-id="5058e-128">With certain workload patterns, as few as two S3 databases can benefit from being managed in a pool.</span></span>

![媒體](./media/sql-database-saas-tutorial-performance-monitoring/app-diagram.png)

<span data-ttu-id="5058e-130">集區和集區中的 hello 資料庫應受監視的 tooensure 就會維持在可接受的效能範圍內。</span><span class="sxs-lookup"><span data-stu-id="5058e-130">Pools, and hello databases in pools, should be monitored tooensure they stay within acceptable ranges of performance.</span></span> <span data-ttu-id="5058e-131">微調 hello 集區組態 toomeet hello hello 彙總工作負載的需求 hello 的集區 edtu 數目皆適用於 hello 的所有資料庫的整體工作負載。</span><span class="sxs-lookup"><span data-stu-id="5058e-131">Tune hello pool configuration toomeet hello needs of hello aggregate workload of all databases, ensuring that hello pool eDTUs are appropriate for hello overall workload.</span></span> <span data-ttu-id="5058e-132">調整 hello 每個資料庫最小值和每個資料庫最大的 eDTU 值 tooappropriate 值的特定應用程式的需求。</span><span class="sxs-lookup"><span data-stu-id="5058e-132">Adjust hello per-database min and per-database max eDTU values tooappropriate values for your specific application requirements.</span></span>

### <a name="performance-management-strategies"></a><span data-ttu-id="5058e-133">效能管理策略</span><span class="sxs-lookup"><span data-stu-id="5058e-133">Performance management strategies</span></span>

* <span data-ttu-id="5058e-134">tooavoid 具有 toomanually 監視效能，是最有效率的太**設定警示，在資料庫或集區偏離超出正常範圍時觸發**。</span><span class="sxs-lookup"><span data-stu-id="5058e-134">tooavoid having toomanually monitor performance, it’s most effective too**set alerts that trigger when databases or pools stray out of normal ranges**.</span></span>
* <span data-ttu-id="5058e-135">集區，hello 彙總效能層級的 toorespond tooshort 詞彙波動 hello**集區 eDTU 層級可以向上或向下調整**。</span><span class="sxs-lookup"><span data-stu-id="5058e-135">toorespond tooshort-term fluctuations in hello aggregate performance level of a pool, hello **pool eDTU level can be scaled up or down**.</span></span> <span data-ttu-id="5058e-136">如果此波動發生於定期或依照可預測的基礎，**調整 hello 集區可以是排程的 toooccur 自動**。</span><span class="sxs-lookup"><span data-stu-id="5058e-136">If this fluctuation occurs on a regular or predictable basis, **scaling hello pool can be scheduled toooccur automatically**.</span></span> <span data-ttu-id="5058e-137">例如，當您知道夜間或者週末期間工作負載較輕時，就可以相應減少。</span><span class="sxs-lookup"><span data-stu-id="5058e-137">For example, scale down when you know your workload is light, maybe overnight, or during weekends.</span></span>
* <span data-ttu-id="5058e-138">toorespond toolonger 詞彙波動或變更 hello 的資料庫，數目**個別資料庫可能會移至其他集區**。</span><span class="sxs-lookup"><span data-stu-id="5058e-138">toorespond toolonger-term fluctuations, or changes in hello number of databases, **individual databases can be moved into other pools**.</span></span>
* <span data-ttu-id="5058e-139">toorespond tooshort 詞彙會增加在*個別*資料庫載入**可以超出集區和個別的效能等級指派給個別資料庫**。</span><span class="sxs-lookup"><span data-stu-id="5058e-139">toorespond tooshort term increases in *individual* database load **individual databases can be taken out of a pool and assigned an individual performance level**.</span></span> <span data-ttu-id="5058e-140">一旦 hello 負載降低，hello 資料庫可以則傳回 toohello 集區。</span><span class="sxs-lookup"><span data-stu-id="5058e-140">Once hello load is reduced, hello database can then be returned toohello pool.</span></span> <span data-ttu-id="5058e-141">當這事先已知道時，資料庫可以移動聯合國 tooensure hello 資料庫永遠都有其所需的 hello 資源和 tooavoid 影響 hello 集區中的其他資料庫上。</span><span class="sxs-lookup"><span data-stu-id="5058e-141">When this is known in advance, databases can be moved pre-emptively tooensure hello database always has hello resources it needs, and tooavoid impact on other databases in hello pool.</span></span> <span data-ttu-id="5058e-142">如果可預測，例如遇到的常見事件的票證銷售晚法院這項需求，此管理行為可以整合到 hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="5058e-142">If this requirement is predictable, such as a venue experiencing a rush of ticket sales for a popular event, then this management behavior can be integrated into hello application.</span></span>

<span data-ttu-id="5058e-143">hello [Azure 入口網站](https://portal.azure.com)提供內建的監視和警示最多資源。</span><span class="sxs-lookup"><span data-stu-id="5058e-143">hello [Azure portal](https://portal.azure.com) provides built-in monitoring and alerting on most resources.</span></span> <span data-ttu-id="5058e-144">針對 SQL Database，可使用資料庫和集區監視與警示功能。</span><span class="sxs-lookup"><span data-stu-id="5058e-144">For SQL Database, monitoring and alerting is available on databases and pools.</span></span> <span data-ttu-id="5058e-145">此內建監視和警示是特定資源，因此它是方便 toouse 小的數字的資源，但不是很方便使用許多資源時。</span><span class="sxs-lookup"><span data-stu-id="5058e-145">This built-in monitoring and alerting is resource-specific, so it's convenient toouse for small numbers of resources, but is not very convenient when working with many resources.</span></span>

<span data-ttu-id="5058e-146">在您處理許多資源的大量案例中，可以使用 [Log Analytics (OMS)](sql-database-saas-tutorial-log-analytics.md)。</span><span class="sxs-lookup"><span data-stu-id="5058e-146">For high-volume scenarios where you're working with many reources, [Log Analytics (OMS)](sql-database-saas-tutorial-log-analytics.md) can be used.</span></span> <span data-ttu-id="5058e-147">這是個別的 Azure 服務，可針對發出的診斷記錄和記錄分析工作區中收集的遙測提供分析。</span><span class="sxs-lookup"><span data-stu-id="5058e-147">This is a separate Azure service that provides analytics over emitted diagnostic logs and telemetry gathered in a log analytics workspace.</span></span> <span data-ttu-id="5058e-148">記錄分析可以從許多服務收集遙測和是使用的 tooquery，而且設定警示。</span><span class="sxs-lookup"><span data-stu-id="5058e-148">Log Analytics can collect telemetry from many services and be used tooquery and set alerts.</span></span>

## <a name="get-hello-wingtip-application-source-code-and-scripts"></a><span data-ttu-id="5058e-149">取得 hello Wingtip 應用程式原始碼和指令碼</span><span class="sxs-lookup"><span data-stu-id="5058e-149">Get hello Wingtip application source code and scripts</span></span>

<span data-ttu-id="5058e-150">hello Wingtip SaaS 指令碼和應用程式的原始程式碼中可用 hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github 儲存機制。</span><span class="sxs-lookup"><span data-stu-id="5058e-150">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="5058e-151">[步驟 toodownload hello Wingtip SaaS 指令碼](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts)。</span><span class="sxs-lookup"><span data-stu-id="5058e-151">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="provision-additional-tenants"></a><span data-ttu-id="5058e-152">佈建其他租用戶</span><span class="sxs-lookup"><span data-stu-id="5058e-152">Provision additional tenants</span></span>

<span data-ttu-id="5058e-153">雖然可以符合成本效益與兩個 S3 資料庫集區，而 hello 位於 hello 平均效果變得更符合成本效益的 hello 集區 hello 的多個資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-153">While pools can be cost-effective with just two S3 databases, hello more databases that are in hello pool hello more cost-effective hello averaging effect becomes.</span></span> <span data-ttu-id="5058e-154">為了深入了解效能監視與管理大規模運作的方式，本教學課程要求您至少部署 20 個資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-154">For a good understanding of how performance monitoring and management works at scale, this tutorial requires you have at least 20 databases deployed.</span></span>

<span data-ttu-id="5058e-155">如果在先前的教學課程已佈建了租用戶的批次，請略過 toohello[所有租用戶資料庫上的模擬使用量](#simulate-usage-on-all-tenant-databases)> 一節。</span><span class="sxs-lookup"><span data-stu-id="5058e-155">If you already provisioned a batch of tenants in a prior tutorial, skip toohello [Simulate usage on all tenant databases](#simulate-usage-on-all-tenant-databases) section.</span></span>

1. <span data-ttu-id="5058e-156">開啟...\\學習模組\\效能監視與管理\\*示範 PerformanceMonitoringAndManagement.ps1*在 hello *PowerShell ISE*。</span><span class="sxs-lookup"><span data-stu-id="5058e-156">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in hello *PowerShell ISE*.</span></span> <span data-ttu-id="5058e-157">保持此指令碼開啟，因為您將在本教學課程期間執行數個案例。</span><span class="sxs-lookup"><span data-stu-id="5058e-157">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="5058e-158">設定 **$DemoScenario** = **1**，**佈建批次的租用戶**</span><span class="sxs-lookup"><span data-stu-id="5058e-158">Set **$DemoScenario** = **1**, **Provision a batch of tenants**</span></span>
1. <span data-ttu-id="5058e-159">按**F5** toorun hello 指令碼。</span><span class="sxs-lookup"><span data-stu-id="5058e-159">Press **F5** toorun hello script.</span></span>

<span data-ttu-id="5058e-160">hello 指令碼將在五分鐘內部署 17 的租用戶。</span><span class="sxs-lookup"><span data-stu-id="5058e-160">hello script will deploy 17 tenants in less than five minutes.</span></span>

<span data-ttu-id="5058e-161">hello*新增 TenantBatch*指令碼會使用巢狀或連結一[資源管理員](../azure-resource-manager/index.md)範本，建立批次的租用戶，其預設值會複製 hello 資料庫**basetenantdb** hello 類別目錄伺服器 toocreate hello 新租用戶的資料庫上，然後註冊這些 hello 類別目錄中，最後將其初始化 hello 租用戶名稱和地點類型。</span><span class="sxs-lookup"><span data-stu-id="5058e-161">hello *New-TenantBatch* script uses a nested or linked set of [Resource Manager](../azure-resource-manager/index.md) templates that create a batch of tenants, which by default copies hello database **basetenantdb** on hello catalog server toocreate hello new tenant databases, then registers these in hello catalog, and finally initializes them with hello tenant name and venue type.</span></span> <span data-ttu-id="5058e-162">這是與 hello 應用程式會提供給新的租用戶的 hello 方式一致。</span><span class="sxs-lookup"><span data-stu-id="5058e-162">This is consistent with hello way hello app provisions a new tenant.</span></span> <span data-ttu-id="5058e-163">所做過任何變更*basetenantdb*是套用的 tooany 佈建之後的新租用戶。</span><span class="sxs-lookup"><span data-stu-id="5058e-163">Any changes made too*basetenantdb* are applied tooany new tenants provisioned thereafter.</span></span> <span data-ttu-id="5058e-164">請參閱 hello[結構描述管理教學課程](sql-database-saas-tutorial-schema-management.md)toosee toomake 結構描述如何變更太*現有*租用戶資料庫 (包括 hello *basetenantdb*資料庫)。</span><span class="sxs-lookup"><span data-stu-id="5058e-164">See hello [Schema Management tutorial](sql-database-saas-tutorial-schema-management.md) toosee how toomake schema changes too*existing* tenant databases (including hello *basetenantdb* database).</span></span>

## <a name="simulate-usage-on-all-tenant-databases"></a><span data-ttu-id="5058e-165">模擬所有租用戶資料庫的使用情形</span><span class="sxs-lookup"><span data-stu-id="5058e-165">Simulate usage on all tenant databases</span></span>

<span data-ttu-id="5058e-166">hello*示範 PerformanceMonitoringAndManagement.ps1*指令碼所提供的模擬所有租用戶資料庫上執行的工作負載。</span><span class="sxs-lookup"><span data-stu-id="5058e-166">hello *Demo-PerformanceMonitoringAndManagement.ps1* script is provided that simulates a workload running against all tenant databases.</span></span> <span data-ttu-id="5058e-167">hello 負載會產生使用其中一種 hello 可用的負載案例：</span><span class="sxs-lookup"><span data-stu-id="5058e-167">hello load is generated using one of hello available load scenarios:</span></span>

| <span data-ttu-id="5058e-168">示範</span><span class="sxs-lookup"><span data-stu-id="5058e-168">Demo</span></span> | <span data-ttu-id="5058e-169">案例</span><span class="sxs-lookup"><span data-stu-id="5058e-169">Scenario</span></span> |
|:--|:--|
| <span data-ttu-id="5058e-170">2</span><span class="sxs-lookup"><span data-stu-id="5058e-170">2</span></span> | <span data-ttu-id="5058e-171">產生一般強度負載 (大約 40 個 DTU)</span><span class="sxs-lookup"><span data-stu-id="5058e-171">Generate normal intensity load (approx. 40 DTU)</span></span> |
| <span data-ttu-id="5058e-172">3</span><span class="sxs-lookup"><span data-stu-id="5058e-172">3</span></span> | <span data-ttu-id="5058e-173">每個資料庫產生時間更長、更頻繁高載的負載</span><span class="sxs-lookup"><span data-stu-id="5058e-173">Generate load with longer and more frequent bursts per database</span></span>|
| <span data-ttu-id="5058e-174">4</span><span class="sxs-lookup"><span data-stu-id="5058e-174">4</span></span> | <span data-ttu-id="5058e-175">每個資料庫產生具有更高 DTU 高載的負載 (大約 80 個 DTU)</span><span class="sxs-lookup"><span data-stu-id="5058e-175">Generate load with higher DTU bursts per database (approx. 80 DTU)</span></span>|
| <span data-ttu-id="5058e-176">5</span><span class="sxs-lookup"><span data-stu-id="5058e-176">5</span></span> | <span data-ttu-id="5058e-177">在單一租用戶上產生一般負載加上高負載 (大約 95 個 DTU)</span><span class="sxs-lookup"><span data-stu-id="5058e-177">Generate a normal load plus a high load on a single tenant (approx. 95 DTU)</span></span>|
| <span data-ttu-id="5058e-178">6</span><span class="sxs-lookup"><span data-stu-id="5058e-178">6</span></span> | <span data-ttu-id="5058e-179">產生跨多個集區的不對稱負載</span><span class="sxs-lookup"><span data-stu-id="5058e-179">Generate unbalanced load across multiple pools</span></span>|

<span data-ttu-id="5058e-180">hello 負載產生器適用於*綜合*僅 CPU 負載 tooevery 租用戶資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-180">hello load generator applies a *synthetic* CPU-only load tooevery tenant database.</span></span> <span data-ttu-id="5058e-181">hello 產生器啟動每一個呼叫的預存程序會定期產生 hello 負載的租用戶資料庫工作。</span><span class="sxs-lookup"><span data-stu-id="5058e-181">hello generator starts a job for each tenant database, which calls a stored procedure periodically that generates hello load.</span></span> <span data-ttu-id="5058e-182">hello 負載層級 （Edtu)、 持續時間和間隔會改變所有資料庫，模擬預期租用戶活動。</span><span class="sxs-lookup"><span data-stu-id="5058e-182">hello load levels (in eDTUs), duration, and intervals are varied across all databases, simulating unpredictable tenant activity.</span></span>

1. <span data-ttu-id="5058e-183">開啟...\\學習模組\\效能監視與管理\\*示範 PerformanceMonitoringAndManagement.ps1*在 hello *PowerShell ISE*。</span><span class="sxs-lookup"><span data-stu-id="5058e-183">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in hello *PowerShell ISE*.</span></span> <span data-ttu-id="5058e-184">保持此指令碼開啟，因為您將在本教學課程期間執行數個案例。</span><span class="sxs-lookup"><span data-stu-id="5058e-184">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="5058e-185">設定 **$DemoScenario** = **2**，*產生一般強度負載*。</span><span class="sxs-lookup"><span data-stu-id="5058e-185">Set **$DemoScenario** = **2**, *Generate normal intensity load*.</span></span>
1. <span data-ttu-id="5058e-186">按**F5** tooapply 負載 tooall 租用戶資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-186">Press **F5** tooapply a load tooall your tenant databases.</span></span>

<span data-ttu-id="5058e-187">Wingtip 是 SaaS 應用程式，並 hello 真實世界負載 SaaS 應用程式通常是偶發和無法預期。</span><span class="sxs-lookup"><span data-stu-id="5058e-187">Wingtip is a SaaS app, and hello real-world load on a SaaS app is typically sporadic and unpredictable.</span></span> <span data-ttu-id="5058e-188">toosimulate 這 hello 負載產生器會產生隨機的負載分散到所有租用戶。</span><span class="sxs-lookup"><span data-stu-id="5058e-188">toosimulate this, hello load generator produces a randomized load distributed across all tenants.</span></span> <span data-ttu-id="5058e-189">Hello 負載模式 tooemerge，因此執行 hello 負載產生器 3-5 分鐘，再嘗試 toomonitor hello 下列各節中的 hello 負載被需要幾分鐘的時間。</span><span class="sxs-lookup"><span data-stu-id="5058e-189">Several minutes are needed for hello load pattern tooemerge, so run hello load generator for 3-5 minutes before attempting toomonitor hello load in hello following sections.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5058e-190">hello 負載產生器以一系列的工作執行，本機 PowerShell 工作階段中。</span><span class="sxs-lookup"><span data-stu-id="5058e-190">hello load generator is running as a series of jobs in your local PowerShell session.</span></span> <span data-ttu-id="5058e-191">保留 hello*示範 PerformanceMonitoringAndManagement.ps1*  索引標籤開啟 ！</span><span class="sxs-lookup"><span data-stu-id="5058e-191">Keep hello *Demo-PerformanceMonitoringAndManagement.ps1* tab open!</span></span> <span data-ttu-id="5058e-192">如果您關閉 [hello] 索引標籤，或暫止您的電腦時，就會停止 hello 負載產生器。</span><span class="sxs-lookup"><span data-stu-id="5058e-192">If you close hello tab, or suspend your machine, hello load generator stops.</span></span> <span data-ttu-id="5058e-193">hello 負載產生器會保留在*作業叫用*狀態就會產生新的租用戶 hello 產生器啟動之後，會佈建的負載。</span><span class="sxs-lookup"><span data-stu-id="5058e-193">hello load generator remains in a *job-invoking* state where it generates load on any new tenants that are provisioned after hello generator is started.</span></span> <span data-ttu-id="5058e-194">使用*CTRL-C* toostop 叫用新工作，並結束 hello 指令碼。</span><span class="sxs-lookup"><span data-stu-id="5058e-194">Use *Ctrl-C* toostop invoking new jobs and exit hello script.</span></span> <span data-ttu-id="5058e-195">hello 負載產生器會繼續 toorun，但只能在現有的租用戶。</span><span class="sxs-lookup"><span data-stu-id="5058e-195">hello load generator will continue toorun, but only on existing tenants.</span></span>

## <a name="monitor-resource-usage-using-hello-azure-portal"></a><span data-ttu-id="5058e-196">使用 hello Azure 入口網站監視資源使用狀況</span><span class="sxs-lookup"><span data-stu-id="5058e-196">Monitor resource usage using hello Azure portal</span></span>

<span data-ttu-id="5058e-197">toomonitor hello 分派 hello 結果載入套用，開啟包含 hello 租用戶資料庫 hello 入口 toohello 集區：</span><span class="sxs-lookup"><span data-stu-id="5058e-197">toomonitor hello resource usage that results from hello load being applied, open hello portal toohello pool containing hello tenant databases:</span></span>

1. <span data-ttu-id="5058e-198">開啟 hello [Azure 入口網站](https://portal.azure.com)並瀏覽 toohello *tenants1-&lt;使用者&gt;*伺服器。</span><span class="sxs-lookup"><span data-stu-id="5058e-198">Open hello [Azure portal](https://portal.azure.com) and browse toohello *tenants1-&lt;USER&gt;* server.</span></span>
1. <span data-ttu-id="5058e-199">向下捲動並找出彈性集區，然後按一下 [Pool1]。</span><span class="sxs-lookup"><span data-stu-id="5058e-199">Scroll down and locate elastic pools and click **Pool1**.</span></span> <span data-ttu-id="5058e-200">此集區包含所有 hello 租用戶資料庫建立為止。</span><span class="sxs-lookup"><span data-stu-id="5058e-200">This pool contains all hello tenant databases created so far.</span></span>

<span data-ttu-id="5058e-201">觀察 hello**彈性集區監視**和**彈性資料庫監視**圖表。</span><span class="sxs-lookup"><span data-stu-id="5058e-201">Observe hello **Elastic pool monitoring** and **Elastic database monitoring** charts.</span></span>

<span data-ttu-id="5058e-202">hello 集區的資源使用率是 hello hello 集區中所有資料庫的彙總資料庫使用量。</span><span class="sxs-lookup"><span data-stu-id="5058e-202">hello pool's resource utilization is hello aggregate database utilization for all databases in hello pool.</span></span> <span data-ttu-id="5058e-203">hello 資料庫圖表可顯示 hello 五個最熱的資料庫：</span><span class="sxs-lookup"><span data-stu-id="5058e-203">hello database chart shows hello five hottest databases:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/pool1.png)

<span data-ttu-id="5058e-204">由於超過 hello 集區中沒有其他資料庫 hello 前五個，hello 集區使用量會顯示不會反映在 hello 前五個資料庫圖表中的活動。</span><span class="sxs-lookup"><span data-stu-id="5058e-204">Because there are additional databases in hello pool beyond hello top five, hello pool utilization shows activity that is not reflected in hello top five databases chart.</span></span> <span data-ttu-id="5058e-205">如需其他詳細資料，請按一下 [資料庫資源使用量]：</span><span class="sxs-lookup"><span data-stu-id="5058e-205">For additional details, click **Database Resource Utilization**:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/database-utilization.png)


## <a name="set-performance-alerts-on-hello-pool"></a><span data-ttu-id="5058e-206">在 hello 集區上設定效能警示</span><span class="sxs-lookup"><span data-stu-id="5058e-206">Set performance alerts on hello pool</span></span>

<span data-ttu-id="5058e-207">在觸發程序的 hello 集區上設定警示\>75%使用率，如下所示：</span><span class="sxs-lookup"><span data-stu-id="5058e-207">Set an alert on hello pool that triggers on \>75% utilization as follows:</span></span>

1. <span data-ttu-id="5058e-208">開啟*Pool1* (hello 上*tenants1-\<使用者\>*伺服器) 中 hello [Azure 入口網站](https://portal.azure.com)。</span><span class="sxs-lookup"><span data-stu-id="5058e-208">Open *Pool1* (on hello *tenants1-\<user\>* server) in hello [Azure portal](https://portal.azure.com).</span></span>
1. <span data-ttu-id="5058e-209">按一下 警示規則，然後按一下+ 加入警示：</span><span class="sxs-lookup"><span data-stu-id="5058e-209">Click **Alert Rules**, and then click **+ Add alert**:</span></span>

   ![加入警示](media/sql-database-saas-tutorial-performance-monitoring/add-alert.png)

1. <span data-ttu-id="5058e-211">提供名稱，例如「高 DTU」，</span><span class="sxs-lookup"><span data-stu-id="5058e-211">Provide a name, such as **High DTU**,</span></span>
1. <span data-ttu-id="5058e-212">設定下列值的 hello:</span><span class="sxs-lookup"><span data-stu-id="5058e-212">Set hello following values:</span></span>
   * <span data-ttu-id="5058e-213">**度量 = eDTU 百分比**</span><span class="sxs-lookup"><span data-stu-id="5058e-213">**Metric = eDTU percentage**</span></span>
   * <span data-ttu-id="5058e-214">**條件 = 大於**。</span><span class="sxs-lookup"><span data-stu-id="5058e-214">**Condition = greater than**.</span></span>
   * <span data-ttu-id="5058e-215">**閾值 = 75**。</span><span class="sxs-lookup"><span data-stu-id="5058e-215">**Threshold = 75**.</span></span>
   * <span data-ttu-id="5058e-216">**週期 = hello 透過過去 30 分鐘內**。</span><span class="sxs-lookup"><span data-stu-id="5058e-216">**Period = Over hello last 30 minutes**.</span></span>
1. <span data-ttu-id="5058e-217">新增電子郵件地址 toohello*其他的系統管理員 email(s)*方塊，然後按一下**確定**。</span><span class="sxs-lookup"><span data-stu-id="5058e-217">Add an email address toohello *Additional administrator email(s)* box and click **OK**.</span></span>

   ![設定警示](media/sql-database-saas-tutorial-performance-monitoring/alert-rule.png)


## <a name="scale-up-a-busy-pool"></a><span data-ttu-id="5058e-219">相應增加忙碌的集區</span><span class="sxs-lookup"><span data-stu-id="5058e-219">Scale up a busy pool</span></span>

<span data-ttu-id="5058e-220">如果 hello 彙總負載層級增加集區 toohello 點，它 maxes 出 hello 集區，而且達到 100%的 eDTU 使用量，然後個別的資料庫效能受到影響，可能會拖慢 hello 集區中的所有資料庫的查詢回應時間。</span><span class="sxs-lookup"><span data-stu-id="5058e-220">If hello aggregate load level increases on a pool toohello point that it maxes out hello pool and reaches 100% eDTU usage, then individual database performance is affected, potentially slowing query response times for all databases in hello pool.</span></span>

<span data-ttu-id="5058e-221">**簡短詞彙**，請考慮向上擴充 hello 集區 tooprovide 其他資源，或從 hello 集區中移除資料庫 (將其移 tooother 集區，或移出 hello 集區 tooa 獨立服務層)。</span><span class="sxs-lookup"><span data-stu-id="5058e-221">**Short term**, consider scaling up hello pool tooprovide additional resources, or removing databases from hello pool (moving them tooother pools, or out of hello pool tooa stand-alone service tier).</span></span>

<span data-ttu-id="5058e-222">**長期**，請考慮最佳化查詢或索引的使用方式 tooimprove 資料庫效能。</span><span class="sxs-lookup"><span data-stu-id="5058e-222">**Longer term**, consider optimizing queries or index usage tooimprove database performance.</span></span> <span data-ttu-id="5058e-223">根據 hello 應用程式的敏感度 tooperformance 之前會發出其最佳作法 tooscale 向上的集區達到 100%的 eDTU 使用量。</span><span class="sxs-lookup"><span data-stu-id="5058e-223">Depending on hello application's sensitivity tooperformance issues its best practice tooscale a pool up before it reaches 100% eDTU usage.</span></span> <span data-ttu-id="5058e-224">使用警示的 toowarn 您事先。</span><span class="sxs-lookup"><span data-stu-id="5058e-224">Use an alert toowarn you in advance.</span></span>

<span data-ttu-id="5058e-225">您可以增加 hello 產生器所產生的 hello 負載模擬忙碌的集區。</span><span class="sxs-lookup"><span data-stu-id="5058e-225">You can simulate a busy pool by increasing hello load produced by hello generator.</span></span> <span data-ttu-id="5058e-226">造成 hello 資料庫 tooburst 更頻繁，以及較長，增加 hello 彙總負載 hello 集區上而不需要變更 hello 個別資料庫的 hello 需求。</span><span class="sxs-lookup"><span data-stu-id="5058e-226">Causing hello databases tooburst more frequently, and for longer, increasing hello aggregate load on hello pool without changing hello requirements of hello individual databases.</span></span> <span data-ttu-id="5058e-227">輕鬆地進行向上擴充 hello 集區，在 hello 入口網站或從 PowerShell。</span><span class="sxs-lookup"><span data-stu-id="5058e-227">Scaling up hello pool is easily done in hello portal or from PowerShell.</span></span> <span data-ttu-id="5058e-228">此練習使用 hello 入口網站。</span><span class="sxs-lookup"><span data-stu-id="5058e-228">This exercise uses hello portal.</span></span>

1. <span data-ttu-id="5058e-229">設定*$DemoScenario* = **3**，_產生負載，每個資料庫的長、 更頻繁暴增_hello 彙總負載 tooincrease hello 強度hello 集區，而不會變更每個資料庫所需的 hello 尖峰負載。</span><span class="sxs-lookup"><span data-stu-id="5058e-229">Set *$DemoScenario* = **3**, _Generate load with longer and more frequent bursts per database_ tooincrease hello intensity of hello aggregate load on hello pool without changing hello peak load required by each database.</span></span>
1. <span data-ttu-id="5058e-230">按**F5** tooapply 負載 tooall 租用戶資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-230">Press **F5** tooapply a load tooall your tenant databases.</span></span>

1. <span data-ttu-id="5058e-231">跳過**Pool1** hello Azure 入口網站中。</span><span class="sxs-lookup"><span data-stu-id="5058e-231">Go too**Pool1** in hello Azure portal.</span></span>

<span data-ttu-id="5058e-232">監視 hello 增加集區 eDTU 使用量 hello 上方圖表上。</span><span class="sxs-lookup"><span data-stu-id="5058e-232">Monitor hello increased pool eDTU usage on hello upper chart.</span></span> <span data-ttu-id="5058e-233">花幾分鐘，讓 hello 新高負載 tookick 中，您應該會快速看到 hello 集區啟動 toohit 最大使用量，但 hello 負載 steadies 變成 hello 新模式，因為它快速多載 hello 集區。</span><span class="sxs-lookup"><span data-stu-id="5058e-233">It takes a few minutes for hello new higher load tookick in, but you should quickly see hello pool start toohit max utilization, and as hello load steadies into hello new pattern, it rapidly overloads hello pool.</span></span>

1. <span data-ttu-id="5058e-234">tooscale 向上 hello 集區中，按一下**設定集區**頂端的 hello hello **Pool1**頁面。</span><span class="sxs-lookup"><span data-stu-id="5058e-234">tooscale up hello pool, click **Configure pool** at hello top of hello **Pool1** page.</span></span>
1. <span data-ttu-id="5058e-235">調整 hello**集區 eDTU**太設定**100**。</span><span class="sxs-lookup"><span data-stu-id="5058e-235">Adjust hello **Pool eDTU** setting too**100**.</span></span> <span data-ttu-id="5058e-236">變更 hello 集區 eDTU 不會變更 hello 每個資料庫設定 （這仍然是 50 eDTU 每個資料庫最大）。</span><span class="sxs-lookup"><span data-stu-id="5058e-236">Changing hello pool eDTU does not change hello per-database settings (which is still 50 eDTU max per database).</span></span> <span data-ttu-id="5058e-237">您可以看到 hello 每個資料庫設定右側 hello hello**設定集區**頁面。</span><span class="sxs-lookup"><span data-stu-id="5058e-237">You can see hello per-database settings on hello right side of hello **Configure pool** page.</span></span>
1. <span data-ttu-id="5058e-238">按一下**儲存**toosubmit hello 要求 tooscale hello 集區。</span><span class="sxs-lookup"><span data-stu-id="5058e-238">Click **Save** toosubmit hello request tooscale hello pool.</span></span>

<span data-ttu-id="5058e-239">請返回太**Pool1** > **概觀**tooview hello 監控圖表。</span><span class="sxs-lookup"><span data-stu-id="5058e-239">Go back too**Pool1** > **Overview** tooview hello monitoring charts.</span></span> <span data-ttu-id="5058e-240">監視 hello 效果提供更多資源 hello 集區 （雖然幾個資料庫以及隨機的負載它不一定是簡單 toosee 做出段時間執行之前）。</span><span class="sxs-lookup"><span data-stu-id="5058e-240">Monitor hello effect of providing hello pool with more resources (although with few databases and a randomized load it’s not always easy toosee conclusively until you run for some time).</span></span> <span data-ttu-id="5058e-241">時想要在 hello 圖表都帶有記住 100%上 hello 上方圖表現在代表 100 Edtu 時 hello 上較低的圖表 100%仍 50 Edtu hello 為每個資料庫最大值, 仍然是 50 的 Edtu。</span><span class="sxs-lookup"><span data-stu-id="5058e-241">While you are looking at hello charts bear in mind that 100% on hello upper chart now represents 100 eDTUs, while on hello lower chart 100% is still 50 eDTUs as hello per-database max is still 50 eDTUs.</span></span>

<span data-ttu-id="5058e-242">資料庫會保持 online 和 hello 程序中完全可供使用。</span><span class="sxs-lookup"><span data-stu-id="5058e-242">Databases remain online and fully available throughout hello process.</span></span> <span data-ttu-id="5058e-243">Hello 在最後一刻才為每個資料庫都準備好 toobe hello 新集區 eDTU，以啟用任何使用中連接都會中斷。</span><span class="sxs-lookup"><span data-stu-id="5058e-243">At hello last moment as each database is ready toobe enabled with hello new pool eDTU, any active connections are broken.</span></span> <span data-ttu-id="5058e-244">應用程式程式碼應該一律寫入卸除 tooretry 連線，因此會重新 toohello hello 向上調整集區中的資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-244">Application code should always be written tooretry dropped connections, and so will reconnect toohello database in hello scaled-up pool.</span></span>

## <a name="load-balance-between-pools"></a><span data-ttu-id="5058e-245">平衡集區之間的負載</span><span class="sxs-lookup"><span data-stu-id="5058e-245">Load balance between pools</span></span>

<span data-ttu-id="5058e-246">因為替代 tooscaling 向上 hello 集區，建立第二個集區，並將資料庫移到其中 toobalance hello 載入 hello 之間兩個集區。</span><span class="sxs-lookup"><span data-stu-id="5058e-246">As an alternative tooscaling up hello pool, create a second pool and move databases into it toobalance hello load between hello two pools.</span></span> <span data-ttu-id="5058e-247">這個 hello 新集區必須在建立的 toodo 先 hello hello 與相同的伺服器。</span><span class="sxs-lookup"><span data-stu-id="5058e-247">toodo this hello new pool must be created on hello same server as hello first.</span></span>

1. <span data-ttu-id="5058e-248">在 hello [Azure 入口網站](https://portal.azure.com)，開啟 hello **tenants1-&lt;使用者&gt;**伺服器。</span><span class="sxs-lookup"><span data-stu-id="5058e-248">In hello [Azure portal](https://portal.azure.com), open hello **tenants1-&lt;USER&gt;** server.</span></span>
1. <span data-ttu-id="5058e-249">按一下**+ 新集區**toocreate hello 目前伺服器上的集區。</span><span class="sxs-lookup"><span data-stu-id="5058e-249">Click **+ New pool** toocreate a pool on hello current server.</span></span>
1. <span data-ttu-id="5058e-250">在 hello**彈性資料庫集區**範本：</span><span class="sxs-lookup"><span data-stu-id="5058e-250">On hello **Elastic database pool** template:</span></span>

    1. <span data-ttu-id="5058e-251">設定**名稱**太*Pool2*。</span><span class="sxs-lookup"><span data-stu-id="5058e-251">Set **Name** too*Pool2*.</span></span>
    1. <span data-ttu-id="5058e-252">保留 hello 定價層為**標準的集區**。</span><span class="sxs-lookup"><span data-stu-id="5058e-252">Leave hello pricing tier as **Standard Pool**.</span></span>
    1. <span data-ttu-id="5058e-253">按一下 [設定集區]，</span><span class="sxs-lookup"><span data-stu-id="5058e-253">Click **Configure pool**,</span></span>
    1. <span data-ttu-id="5058e-254">設定**集區 eDTU**太*50 eDTU*。</span><span class="sxs-lookup"><span data-stu-id="5058e-254">Set **Pool eDTU** too*50 eDTU*.</span></span>
    1. <span data-ttu-id="5058e-255">按一下**新增資料庫**toosee 太可加入 hello 伺服器上的資料庫清單*Pool2*。</span><span class="sxs-lookup"><span data-stu-id="5058e-255">Click **Add databases** toosee a list of databases on hello server that can be added too*Pool2*.</span></span>
    1. <span data-ttu-id="5058e-256">選取所有 10 個資料庫 toomove 這些 toohello 新的集區，然後再按一下**選取**。</span><span class="sxs-lookup"><span data-stu-id="5058e-256">Select any 10 databases toomove these toohello new pool, and then click **Select**.</span></span> <span data-ttu-id="5058e-257">如果您已經執行 hello 負載產生器，hello 服務已經知道您的效能設定檔需要比 hello 預設 50 eDTU 大小較大的集區，並建議開頭為 100 的 eDTU 設定。</span><span class="sxs-lookup"><span data-stu-id="5058e-257">If you've been running hello load generator, hello service already knows that your performance profile requires a larger pool than hello default 50 eDTU size and recommends starting with a 100 eDTU setting.</span></span>

    ![建議](media/sql-database-saas-tutorial-performance-monitoring/configure-pool.png)

    1. <span data-ttu-id="5058e-259">本教學課程，讓 hello 預設在 edtu 數 （50），然後按一下**選取**一次。</span><span class="sxs-lookup"><span data-stu-id="5058e-259">For this tutorial, leave hello default at 50 eDTUs, and click **Select** again.</span></span>
    1. <span data-ttu-id="5058e-260">選取**確定**toocreate hello 新集區和 toomove hello 選取到其中的資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-260">Select **OK** toocreate hello new pool and toomove hello selected databases into it.</span></span>

<span data-ttu-id="5058e-261">建立 hello 集區，而且移動 hello 資料庫需要幾分鐘。</span><span class="sxs-lookup"><span data-stu-id="5058e-261">Creating hello pool and moving hello databases takes a few minutes.</span></span> <span data-ttu-id="5058e-262">移動它們之前 hello 非常最後一刻保持線上，而且完全可存取資料庫，因為此時任何開啟連接會關閉。</span><span class="sxs-lookup"><span data-stu-id="5058e-262">As databases are moved they remain online and fully accessible until hello very last moment, at which point any open connections are closed.</span></span> <span data-ttu-id="5058e-263">只要您有一些重試邏輯，用戶端會接著連接 toohello hello 新集區中的資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-263">As long as you have some retry logic, clients will then connect toohello database in hello new pool.</span></span>

<span data-ttu-id="5058e-264">瀏覽過**Pool2** (hello 上*tenants1*伺服器) tooopen hello 集區，並監視其效能。</span><span class="sxs-lookup"><span data-stu-id="5058e-264">Browse too**Pool2** (on hello *tenants1* server) tooopen hello pool and monitor its performance.</span></span> <span data-ttu-id="5058e-265">如果您沒有看到它，請等候佈建的新集區 toocomplete hello。</span><span class="sxs-lookup"><span data-stu-id="5058e-265">If you don't see it, wait for provisioning of hello new pool toocomplete.</span></span>

<span data-ttu-id="5058e-266">您現在可看到 Pool1 上的資源使用量已下降，而 Pool2 目前維持同樣的負載。</span><span class="sxs-lookup"><span data-stu-id="5058e-266">You now see that resource usage on *Pool1* has dropped and that *Pool2* is now similarly loaded.</span></span>

## <a name="manage-performance-of-a-single-database"></a><span data-ttu-id="5058e-267">管理單一資料庫的效能</span><span class="sxs-lookup"><span data-stu-id="5058e-267">Manage performance of a single database</span></span>

<span data-ttu-id="5058e-268">如果集區中的單一資料庫遇到持續高負載，則根據 hello 集區設定，它可能傾向 toodominate hello 集區中的 hello 資源，並會影響其他資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-268">If a single database in a pool experiences a sustained high load, depending on hello pool configuration, it may tend toodominate hello resources in hello pool and impact other databases.</span></span> <span data-ttu-id="5058e-269">若是 hello 活動可能 toocontinue 段時間，hello 資料庫可以暫時移出 hello 集區。</span><span class="sxs-lookup"><span data-stu-id="5058e-269">If hello activity is likely toocontinue for some time, hello database can be temporarily moved out of hello pool.</span></span> <span data-ttu-id="5058e-270">這可讓 hello 資料庫 toohave hello 額外的資源，需要此項目，並隔離 hello 從其他資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-270">This allows hello database toohave hello extra resources it needs, and isolates it from hello other databases.</span></span>

<span data-ttu-id="5058e-271">這個練習會模擬 Contoso 搭配 Hall 當票證上銷售額熱門搭配遭遇高負載的 hello 的效果。</span><span class="sxs-lookup"><span data-stu-id="5058e-271">This exercise simulates hello effect of Contoso Concert Hall experiencing a high load when tickets go on sale for a popular concert.</span></span>

1. <span data-ttu-id="5058e-272">開啟 hello...\\*示範 PerformanceMonitoringAndManagement.ps1*指令碼。</span><span class="sxs-lookup"><span data-stu-id="5058e-272">Open hello …\\*Demo-PerformanceMonitoringAndManagement.ps1* script.</span></span>
1. <span data-ttu-id="5058e-273">設定 **$DemoScenario = 5，在單一租用戶上產生一般負載加上高負載 (大約 95 個 DTU)**。</span><span class="sxs-lookup"><span data-stu-id="5058e-273">Set **$DemoScenario = 5, Generate a normal load plus a high load on a single tenant (approx. 95 DTU).**</span></span>
1. <span data-ttu-id="5058e-274">設定 **$SingleTenantDatabaseName = contosoconcerthall**</span><span class="sxs-lookup"><span data-stu-id="5058e-274">Set **$SingleTenantDatabaseName = contosoconcerthall**</span></span>
1. <span data-ttu-id="5058e-275">執行指令碼 hello **F5**。</span><span class="sxs-lookup"><span data-stu-id="5058e-275">Execute hello script using **F5**.</span></span>


1. <span data-ttu-id="5058e-276">在 hello [Azure 入口網站](https://portal.azure.com)開啟**Pool1**。</span><span class="sxs-lookup"><span data-stu-id="5058e-276">In hello [Azure portal](https://portal.azure.com) open **Pool1**.</span></span>
1. <span data-ttu-id="5058e-277">檢查 hello**彈性集區監視**圖表，並尋找 hello 增加集區 eDTU 使用量。</span><span class="sxs-lookup"><span data-stu-id="5058e-277">Inspect hello **Elastic pool monitoring** chart and look for hello increased pool eDTU usage.</span></span> <span data-ttu-id="5058e-278">一兩分鐘之後, hello 更高的負載應該啟動，tookick，而且您應該很快會看見 hello 集區達到 100%的使用率。</span><span class="sxs-lookup"><span data-stu-id="5058e-278">After a minute or two, hello higher load should start tookick in, and you should quickly see that hello pool hits 100% utilization.</span></span>
1. <span data-ttu-id="5058e-279">檢查 hello**彈性資料庫監視**顯示過去一小時 hello 顯示 hello 最熱的資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-279">Inspect hello **Elastic database monitoring** display which shows hello hottest databases in hello past hour.</span></span> <span data-ttu-id="5058e-280">hello *contosoconcerthall*資料庫應該很快就會顯示為其中一個 hello 五個最熱的資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-280">hello *contosoconcerthall* database should soon appear as one of hello five hottest databases.</span></span>
1. <span data-ttu-id="5058e-281">**按一下 hello 彈性資料庫監視****圖表**開幕 hello 和**資料庫資源使用量**其中您可以監視任何 hello 資料庫頁面。</span><span class="sxs-lookup"><span data-stu-id="5058e-281">**Click on hello Elastic database monitoring** **chart** and it opens hello **Database Resource Utilization** page where you can monitor any of hello databases.</span></span> <span data-ttu-id="5058e-282">這可讓您找出 hello 顯示 hello *contosoconcerthall*資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-282">This lets you isolate hello display for hello *contosoconcerthall* database.</span></span>
1. <span data-ttu-id="5058e-283">從資料庫 hello 清單，按一下  **contosoconcerthall**。</span><span class="sxs-lookup"><span data-stu-id="5058e-283">From hello list of databases, click **contosoconcerthall**.</span></span>
1. <span data-ttu-id="5058e-284">按一下**定價層 （小數位數的 Dtu）** tooopen hello**設定效能**頁面，您可以設定 hello 資料庫獨立的效能層級。</span><span class="sxs-lookup"><span data-stu-id="5058e-284">Click **Pricing Tier (scale DTUs)** tooopen hello **Configure performance** page where you can set a stand-alone performance level for hello database.</span></span>
1. <span data-ttu-id="5058e-285">按一下 hello**標準**hello 標準層中的 tooopen hello 調整選項索引標籤上。</span><span class="sxs-lookup"><span data-stu-id="5058e-285">Click on hello **Standard** tab tooopen hello scale options in hello Standard tier.</span></span>
1. <span data-ttu-id="5058e-286">投影片 hello **DTU 滑桿**tooright tooselect **100** Dtu。</span><span class="sxs-lookup"><span data-stu-id="5058e-286">Slide hello **DTU slider** tooright tooselect **100** DTUs.</span></span> <span data-ttu-id="5058e-287">請注意，這會對應 toohello 服務目標， **S3**。</span><span class="sxs-lookup"><span data-stu-id="5058e-287">Note this corresponds toohello service objective, **S3**.</span></span>
1. <span data-ttu-id="5058e-288">按一下**套用**toomove hello hello 集區之外的資料庫，並將其*標準 S3*資料庫。</span><span class="sxs-lookup"><span data-stu-id="5058e-288">Click **Apply** toomove hello database out of hello pool and make it a *Standard S3* database.</span></span>
1. <span data-ttu-id="5058e-289">調整一旦完成，hello contosoconcerthall 資料庫上的監視 hello 生效且 Pool1 在 hello 彈性集區和資料庫刀鋒視窗上。</span><span class="sxs-lookup"><span data-stu-id="5058e-289">Once scaling is complete, monitor hello effect on hello contosoconcerthall database and Pool1 on hello elastic pool and database blades.</span></span>

<span data-ttu-id="5058e-290">一旦 hello hello contosoconcerthall 資料庫上的高負載 subsides 您應該立即將其傳回 toohello 集區 tooreduce 它的成本。</span><span class="sxs-lookup"><span data-stu-id="5058e-290">Once hello high load on hello contosoconcerthall database subsides you should promptly return it toohello pool tooreduce its cost.</span></span> <span data-ttu-id="5058e-291">如果不清楚時，會發生您可以設定警示 hello 資料庫上，將會觸發其 DTU 使用量低於 hello 每個資料庫時，max hello 集區上。</span><span class="sxs-lookup"><span data-stu-id="5058e-291">If it’s unclear when that will happen you could set an alert on hello database that will trigger when its DTU usage drops below hello per-database max on hello pool.</span></span> <span data-ttu-id="5058e-292">練習 5 中說明如何將資料庫移入集區。</span><span class="sxs-lookup"><span data-stu-id="5058e-292">Moving a database into a pool is described in exercise 5.</span></span>

## <a name="other-performance-management-patterns"></a><span data-ttu-id="5058e-293">其他效能管理模式</span><span class="sxs-lookup"><span data-stu-id="5058e-293">Other Performance Management Patterns</span></span>

<span data-ttu-id="5058e-294">**先佔式調整**在 hello 練習上述您探索如何 tooscale 隔離的資料庫，您就知道哪些資料庫 toolook，如。</span><span class="sxs-lookup"><span data-stu-id="5058e-294">**Pre-emptive scaling** In hello exercise above where you explored how tooscale an isolated database, you knew which database toolook for.</span></span> <span data-ttu-id="5058e-295">如果 Contoso 搭配 Hall hello 管理具有通知的 hello 即將發生的票證銷售量 Wingtips，hello 資料庫可能已移出 hello 集區預先。</span><span class="sxs-lookup"><span data-stu-id="5058e-295">If hello management of Contoso Concert Hall had informed Wingtips of hello impending ticket sale, hello database could have been moved out of hello pool pre-emptively.</span></span> <span data-ttu-id="5058e-296">否則，它可能必須在 hello 集區或 hello 資料庫 toospot 警示發生什麼。</span><span class="sxs-lookup"><span data-stu-id="5058e-296">Otherwise, it would likely have required an alert on hello pool or hello database toospot what was happening.</span></span> <span data-ttu-id="5058e-297">您不希望從 hello 有關此 toolearn hello 抱怨的效能降低的集區中的其他租用戶。</span><span class="sxs-lookup"><span data-stu-id="5058e-297">You wouldn’t want toolearn about this from hello other tenants in hello pool complaining of degraded performance.</span></span> <span data-ttu-id="5058e-298">而且，如果 hello 租用戶可以預測需要額外的資源，您可以設定 hello 集區之外的 Azure 自動化 runbook toomove hello 資料庫並再重新上定義的排程時間長度。</span><span class="sxs-lookup"><span data-stu-id="5058e-298">And if hello tenant can predict how long they will need additional resources you can set up an Azure Automation runbook toomove hello database out of hello pool and then back in again on a defined schedule.</span></span>

<span data-ttu-id="5058e-299">**調整租用戶自助**因為調整是輕鬆地透過 hello 管理 API 呼叫的工作，輕鬆地建置 hello 能力 tooscale 租用戶資料庫到您的租用戶面向應用程式，並提供做為 SaaS 服務的功能。</span><span class="sxs-lookup"><span data-stu-id="5058e-299">**Tenant self-service scaling** Because scaling is a task easily called via hello management API, you can easily build hello ability tooscale tenant databases into your tenant-facing application, and offer it as a feature of your SaaS service.</span></span> <span data-ttu-id="5058e-300">例如，讓租用戶 self-administer 可能是直接連結向上和向下調整 tootheir 計費 ！</span><span class="sxs-lookup"><span data-stu-id="5058e-300">For example, let tenants self-administer scaling up and down, perhaps linked directly tootheir billing!</span></span>

<span data-ttu-id="5058e-301">**排程 toomatch 習慣上向上及向下調整集區**</span><span class="sxs-lookup"><span data-stu-id="5058e-301">**Scaling a pool up and down on a schedule toomatch usage patterns**</span></span>

<span data-ttu-id="5058e-302">其中彙總租用戶的使用方式會遵循可預測的使用模式，您可以依排程向上和向下使用 Azure 自動化 tooscale 集區。</span><span class="sxs-lookup"><span data-stu-id="5058e-302">Where aggregate tenant usage follows predictable usage patterns, you can use Azure Automation tooscale a pool up and down on a schedule.</span></span> <span data-ttu-id="5058e-303">例如，當您知道資源需求會下降時，在工作日下午 6 點後相應減少集區，而在上午 6 點之前重新相應增加。</span><span class="sxs-lookup"><span data-stu-id="5058e-303">For example, scale a pool down after 6pm and up again before 6am on weekdays when you know there is a drop in resource requirements.</span></span>



## <a name="next-steps"></a><span data-ttu-id="5058e-304">後續步驟</span><span class="sxs-lookup"><span data-stu-id="5058e-304">Next steps</span></span>

<span data-ttu-id="5058e-305">在本教學課程中，您了解如何：</span><span class="sxs-lookup"><span data-stu-id="5058e-305">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="5058e-306">Hello 租用戶資料庫上的使用量，以模擬的執行提供的負載產生器</span><span class="sxs-lookup"><span data-stu-id="5058e-306">Simulate usage on hello tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="5058e-307">監視 hello 租用戶資料庫，如同這些回應 toohello 增加負載</span><span class="sxs-lookup"><span data-stu-id="5058e-307">Monitor hello tenant databases as they respond toohello increase in load</span></span>
> * <span data-ttu-id="5058e-308">向上擴充 hello 回應 toohello 增加的資料庫負載中的彈性集區</span><span class="sxs-lookup"><span data-stu-id="5058e-308">Scale up hello Elastic pool in response toohello increased database load</span></span>
> * <span data-ttu-id="5058e-309">佈建第二個彈性集區 tooload 平衡 hello 資料庫活動</span><span class="sxs-lookup"><span data-stu-id="5058e-309">Provision a second Elastic pool tooload balance hello database activity</span></span>

[<span data-ttu-id="5058e-310">還原單一租用戶教學課程</span><span class="sxs-lookup"><span data-stu-id="5058e-310">Restore a single tenant tutorial</span></span>](sql-database-saas-tutorial-restore-single-tenant.md)


## <a name="additional-resources"></a><span data-ttu-id="5058e-311">其他資源</span><span class="sxs-lookup"><span data-stu-id="5058e-311">Additional resources</span></span>

* <span data-ttu-id="5058e-312">其他[hello Wingtip SaaS 應用程式部署為基礎的教學課程](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="5058e-312">Additional [tutorials that build upon hello Wingtip SaaS application deployment](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="5058e-313">SQL 彈性集區</span><span class="sxs-lookup"><span data-stu-id="5058e-313">SQL Elastic pools</span></span>](sql-database-elastic-pool.md)
* [<span data-ttu-id="5058e-314">Azure 自動化</span><span class="sxs-lookup"><span data-stu-id="5058e-314">Azure automation</span></span>](../automation/automation-intro.md)
* <span data-ttu-id="5058e-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) - 設定及使用 Log Analytics 教學課程</span><span class="sxs-lookup"><span data-stu-id="5058e-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) - Setting up and using Log Analytics tutorial</span></span>
