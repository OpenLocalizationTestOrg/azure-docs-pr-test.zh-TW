---
title: "SQL Database - 自動調整 | Microsoft Docs"
description: "SQL Database 會分析 SQL 查詢，並自動調整使用者的工作負載。"
services: sql-database
documentationcenter: 
author: jovanpop-msft
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/05/2017
ms.author: jovanpop
ms.openlocfilehash: f5552793db2d89542782b7d9e8f996314f62e429
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="automatic-tuning"></a><span data-ttu-id="3e98a-103">自動微調</span><span class="sxs-lookup"><span data-stu-id="3e98a-103">Automatic tuning</span></span>

<span data-ttu-id="3e98a-104">Azure SQL Database 是完全受管理的資料服務，可監視在資料庫上執行的查詢，並可自動提升工作負載效能。</span><span class="sxs-lookup"><span data-stu-id="3e98a-104">Azure SQL Database is a fully managed data service that monitors the queries that are executed on the database and can automatically improve performance of the workload.</span></span> <span data-ttu-id="3e98a-105">Azure SQL Database 具備的內建智慧機制可自動調整，並可透過動態調整工作負載的資料庫來提升查詢效能。</span><span class="sxs-lookup"><span data-stu-id="3e98a-105">Azure SQL Database has a built-in intelligence mechanism that can automatically tune and improve performance of your queries by dynamically adapting the database to your workload.</span></span> <span data-ttu-id="3e98a-106">您能在 Azure SQL Database 上啟用以最佳化查詢效能的最重要功能之一，可能是 Azure SQL Database 中的自動調整功能。</span><span class="sxs-lookup"><span data-stu-id="3e98a-106">Automatic tuning in Azure SQL Database might be one of the most important features that you can enable on Azure SQL Database to optimize performance of your queries.</span></span>

<span data-ttu-id="3e98a-107">如需使用 Azure 入口網站以[啟用自動調整](sql-database-automatic-tuning-enable.md)的步驟，請參閱本文章。</span><span class="sxs-lookup"><span data-stu-id="3e98a-107">See this article for the steps to [enable automatic tuning](sql-database-automatic-tuning-enable.md) using the Azure portal.</span></span>

## <a name="why-automatic-tuning"></a><span data-ttu-id="3e98a-108">為何需要自動調整？</span><span class="sxs-lookup"><span data-stu-id="3e98a-108">Why automatic tuning?</span></span>

<span data-ttu-id="3e98a-109">傳統資料庫系統管理的主要工作之一，就是監視工作負載、識別應新增以提升效能的重要 SQL 查詢、索引，以及識別很少使用的索引。</span><span class="sxs-lookup"><span data-stu-id="3e98a-109">One of the main tasks in classic database administration is monitoring the workload, identifying critical SQL queries, indexes that should be added to improve performance, and rarely used indexes.</span></span> <span data-ttu-id="3e98a-110">Azure SQL Database 會提供您需要監視之查詢和索引的詳細解析。</span><span class="sxs-lookup"><span data-stu-id="3e98a-110">Azure SQL Database provides detailed insight into the queries and indexes that you need to monitor.</span></span> <span data-ttu-id="3e98a-111">不過，持續監視資料庫是冗長乏味的艱辛工作，尤其是在處理許多資料庫時。</span><span class="sxs-lookup"><span data-stu-id="3e98a-111">However, constantly monitoring database is a hard and tedious task, especially when dealing with many databases.</span></span> <span data-ttu-id="3e98a-112">即使使用 Azure SQL Database 和 Azure 入口網站提供的所有可用工具和報告，都可能無法有效率地管理大量資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e98a-112">Managing a huge number of databases might be impossible to do efficiently even with all available tools and reports that Azure SQL Database and Azure portal provide.</span></span> <span data-ttu-id="3e98a-113">您可以考慮使用自動調整功能將一些監視和微調動作委派給 Azure SQL Database，而不是監視和手動調整您的資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e98a-113">Instead of monitoring and tuning your database manually, you might consider delegating some of the monitoring and tuning actions to Azure SQL Database using automatic tuning feature.</span></span> 


> [!VIDEO https://channel9.msdn.com/Blogs/Azure-in-the-Enterprise/Enabling-Azure-SQL-Database-Auto-Tuning-at-Scale-for-Microsoft-IT/player]
>

## <a name="how-does-automatic-tuning-work"></a><span data-ttu-id="3e98a-114">自動調整的運作方式為何？</span><span class="sxs-lookup"><span data-stu-id="3e98a-114">How does automatic tuning work?</span></span>

<span data-ttu-id="3e98a-115">Azure SQL Database 會持續不斷地監視和分析效能，藉以了解您的工作負載特性，並找出潛在的問題和改進方式。</span><span class="sxs-lookup"><span data-stu-id="3e98a-115">Azure SQL Database has a continuous performance monitoring and analysis process that constantly learns about the characteristic of your workload and identify potential issues and improvements.</span></span>

![自動調整程序](./media/sql-database-automatic-tuning/tuning-process.png)

<span data-ttu-id="3e98a-117">此程序可讓 Azure SQL Database 藉由找出可能改善工作負載效能的索引和計劃，以及找出會影響工作負載的索引，動態調整您的工作負載。</span><span class="sxs-lookup"><span data-stu-id="3e98a-117">This process enables Azure SQL Database to dynamically adapt to your workload by finding what indexes and plans might improve performance of your workloads and what indexes affect your workloads.</span></span> <span data-ttu-id="3e98a-118">根據這些調查結果，自動調整會套用可改善工作負載效能的調整動作。</span><span class="sxs-lookup"><span data-stu-id="3e98a-118">Based on these findings, automatic tuning applies tuning actions that improve performance of your workload.</span></span> <span data-ttu-id="3e98a-119">此外，Azure SQL Database 會在自動調整做出任何變更之後持續監視效能，確定所做的該變更可改善工作負載的效能。</span><span class="sxs-lookup"><span data-stu-id="3e98a-119">In addition, Azure SQL Database continuously monitors performance after any change made by automatic tuning to ensure that it improves performance of your workload.</span></span> <span data-ttu-id="3e98a-120">未能改善效能的任何動作都會自動還原。</span><span class="sxs-lookup"><span data-stu-id="3e98a-120">Any action that didn’t improve performance is automatically reverted.</span></span> <span data-ttu-id="3e98a-121">此驗證程序是一項重要功能，可確保自動調整所做的任何變更不會降低工作負載的效能。</span><span class="sxs-lookup"><span data-stu-id="3e98a-121">This verification process is a key feature that ensures that any change made by automatic tuning does not decrease the performance of your workload.</span></span>

<span data-ttu-id="3e98a-122">Azure SQL Database 中有兩個可用的自動調整層面：</span><span class="sxs-lookup"><span data-stu-id="3e98a-122">There are two automatic tuning aspects that are available in Azure SQL Database:</span></span>

 -  <span data-ttu-id="3e98a-123">**自動索引管理**：識別您的資料庫中應該新增的索引，以及應該移除的索引。</span><span class="sxs-lookup"><span data-stu-id="3e98a-123">**Automatic index management** that identifies indexes that should be added in your database, and indexes that should be removed.</span></span>
 -  <span data-ttu-id="3e98a-124">**自動計劃更正** (即將推出，已可用於 SQL Server 2017)：識別有問題的計劃並修正 SQL 計劃效能問題。</span><span class="sxs-lookup"><span data-stu-id="3e98a-124">**Automatic plan correction** (coming soon, already available in SQL Server 2017) that identifies problematic plans and fixes SQL plan performance problems.</span></span>

## <a name="automatic-index-management"></a><span data-ttu-id="3e98a-125">自動索引管理</span><span class="sxs-lookup"><span data-stu-id="3e98a-125">Automatic index management</span></span>

<span data-ttu-id="3e98a-126">在 Azure SQL 資料庫中，因為 Azure SQL Database 會了解您的工作負載，並確保永遠以最佳方式為資料編製索引，所以索引管理很簡單。</span><span class="sxs-lookup"><span data-stu-id="3e98a-126">In Azure SQL Database, index management is easy because Azure SQL Database learns about your workload and ensures that your data is always optimally indexed.</span></span> <span data-ttu-id="3e98a-127">您的工作負載要達到最佳效能，有適當的索引設計非常重要，而且自動索引管理可以協助您將索引最佳化。</span><span class="sxs-lookup"><span data-stu-id="3e98a-127">Proper index design is crucial for optimal performance of your workload, and automatic index management can help you optimize your indexes.</span></span> <span data-ttu-id="3e98a-128">自動索引管理可以修正資料庫中索引編製不正確所造成的效能問題，或維護和改善現有資料庫結構描述的索引。</span><span class="sxs-lookup"><span data-stu-id="3e98a-128">Automatic index management can either fix performance issues in incorrectly indexed databases, or maintain and improve indexes on the existing database schema.</span></span> 

### <a name="why-do-you-need-index-management"></a><span data-ttu-id="3e98a-129">為什麼需要索引管理？</span><span class="sxs-lookup"><span data-stu-id="3e98a-129">Why do you need index management?</span></span>

<span data-ttu-id="3e98a-130">索引可加速某些從資料表讀取資料的查詢，但會使更新資料的查詢變慢。</span><span class="sxs-lookup"><span data-stu-id="3e98a-130">Indexes speed up some of your queries that read data from the tables; however, they can slow down the queries that update data.</span></span> <span data-ttu-id="3e98a-131">您需要仔細分析建立索引的時機，以及要將哪些資料行包含在索引中。</span><span class="sxs-lookup"><span data-stu-id="3e98a-131">You need to carefully analyze when to create an index and what columns you need to include in the index.</span></span> <span data-ttu-id="3e98a-132">某些索引在一段時間後可能不再需要。</span><span class="sxs-lookup"><span data-stu-id="3e98a-132">Some indexes might not be needed after some time.</span></span> <span data-ttu-id="3e98a-133">因此，您必須定期找出已無用處的索引，並加以卸除。</span><span class="sxs-lookup"><span data-stu-id="3e98a-133">Therefore, you would need to periodically identify and drop the indexes that do not bring any benefits.</span></span> <span data-ttu-id="3e98a-134">如果您對未使用的索引置之不理，會使更新資料的查詢效能降低，對讀取資料的查詢也毫無益處。</span><span class="sxs-lookup"><span data-stu-id="3e98a-134">If you ignore the unused indexes, performance of the queries that update data would be decreased without any benefit on the queries that read data.</span></span> <span data-ttu-id="3e98a-135">未使用的索引也會影響整體系統效能，因為其他的更新需要不必要的記錄。</span><span class="sxs-lookup"><span data-stu-id="3e98a-135">Unused indexes also affect overall performance of the system because additional updates require unnecessary logging.</span></span>

<span data-ttu-id="3e98a-136">找出一組最佳的索引，能改善查詢從資料表讀取資料時的效能，並對需要持續進行複雜分析的更新之影響降到最低。</span><span class="sxs-lookup"><span data-stu-id="3e98a-136">Finding the optimal set of indexes that improve performance of the queries that read data from your tables and have minimal impact on updates might require continuous and complex analysis.</span></span>

<span data-ttu-id="3e98a-137">Azure SQL Database 會使用內建智慧和進階規則分析您的查詢，識別出對目前工作負載而言最佳的索引以及可能要移除的索引。</span><span class="sxs-lookup"><span data-stu-id="3e98a-137">Azure SQL Database uses built-in intelligence and advanced rules that analyze your queries, identify indexes that would be optimal for your current workloads, and the indexes might be removed.</span></span> <span data-ttu-id="3e98a-138">Azure SQL Database 可確保最佳化讀取資料的查詢所需的索引保持在最少，對其他查詢的影響降到最低。</span><span class="sxs-lookup"><span data-stu-id="3e98a-138">Azure SQL Database ensures that you have a minimal necessary set of indexes that optimize the queries that read data, with the minimized impact on the other queries.</span></span>

### <a name="how-to-identify-indexes-that-need-to-be-changed-in-your-database"></a><span data-ttu-id="3e98a-139">如何識別資料庫中需要變更的索引？</span><span class="sxs-lookup"><span data-stu-id="3e98a-139">How to identify indexes that need to be changed in your database?</span></span>

<span data-ttu-id="3e98a-140">Azure SQL Database 讓索引管理程序變得容易。</span><span class="sxs-lookup"><span data-stu-id="3e98a-140">Azure SQL Database makes index management process easy.</span></span> <span data-ttu-id="3e98a-141">Azure SQL Database 不是手動工作負載分析和索引監視的冗長程序，而是分析工作負載、找出使用新索引會更快速的查詢，以及找出未使用或重複的索引。</span><span class="sxs-lookup"><span data-stu-id="3e98a-141">Instead of the tedious process of manual workload analysis and index monitoring, Azure SQL Database analyzes your workload, identifies the queries that could be executed faster with a new index, and identifies unused or duplicated indexes.</span></span> <span data-ttu-id="3e98a-142">如需找出應變更的索引詳細資訊，可在 [Azure 入口網站中的尋找索引建議](sql-database-advisor-portal.md)中找到。</span><span class="sxs-lookup"><span data-stu-id="3e98a-142">Find more information about identification of indexes that should be changed at [Find index recommendations in Azure portal](sql-database-advisor-portal.md).</span></span>

### <a name="automatic-index-management-considerations"></a><span data-ttu-id="3e98a-143">自動索引管理考量</span><span class="sxs-lookup"><span data-stu-id="3e98a-143">Automatic index management considerations</span></span>

<span data-ttu-id="3e98a-144">如果您發現內建規則可改善資料庫效能，您可以讓 Azure SQL Database 自動管理索引。</span><span class="sxs-lookup"><span data-stu-id="3e98a-144">If you find that the built-in rules improve the performance of your database, you might let Azure SQL database automatically manage your indexes.</span></span>

<span data-ttu-id="3e98a-145">在 Azure SQL Database 中建立必要索引所需的動作可能會耗用資源，並暫時影響工作負載效能。</span><span class="sxs-lookup"><span data-stu-id="3e98a-145">Actions required to create necessary indexes in Azure SQL Databases might consume resources and temporally affect workload performance.</span></span> <span data-ttu-id="3e98a-146">若要讓建立索引對工作負載效能的影響降到最低，Azure SQL Database，可為任何索引管理作業找到適當的時間範圍進行。</span><span class="sxs-lookup"><span data-stu-id="3e98a-146">To minimize the impact of index creation on workload performance, Azure SQL Database finds the appropriate time window for any index management operation.</span></span> <span data-ttu-id="3e98a-147">如果資料庫需要的資源來執行工作負載，就會將調整動作延後，並在資料庫有足夠的資源可用於維護工作時啟動。</span><span class="sxs-lookup"><span data-stu-id="3e98a-147">Tuning action is postponed if the database needs resources to execute your workload, and started when the database has enough unused resources that can be used for the maintenance task.</span></span> <span data-ttu-id="3e98a-148">自動索引管理的其中一項重要功能是驗證動作成效。</span><span class="sxs-lookup"><span data-stu-id="3e98a-148">One important feature in automatic index management is a verification of the actions.</span></span> <span data-ttu-id="3e98a-149">當 Azure SQL Database 建立或卸除索引時，監視程序會分析您的工作負載以確認該動作可以改善效能。</span><span class="sxs-lookup"><span data-stu-id="3e98a-149">When Azure SQL Database creates or drops index, a monitoring process analyzes performance of your workload to verify that the action improved the performance.</span></span> <span data-ttu-id="3e98a-150">如果沒有顯著改善 - 就會立即還原動作。</span><span class="sxs-lookup"><span data-stu-id="3e98a-150">If it didn’t bring significant improvement – the action is immediately reverted.</span></span> <span data-ttu-id="3e98a-151">如此一來，Azure SQL Database 可確保自動採取的動作不會影響工作負載的效能。</span><span class="sxs-lookup"><span data-stu-id="3e98a-151">This way, Azure SQL Database ensures that automatic actions do not negatively impact performance of your workload.</span></span> <span data-ttu-id="3e98a-152">基礎結構描述的維護作業清楚了解自動調整所建立的索引。</span><span class="sxs-lookup"><span data-stu-id="3e98a-152">Indexes created by automatic tuning are transparent for the maintenance operation on the underlying schema.</span></span> <span data-ttu-id="3e98a-153">自動建立索引的存在並不會封鎖卸除或重新命名資料行這類的結構描述變更。</span><span class="sxs-lookup"><span data-stu-id="3e98a-153">Schema changes such as dropping or renaming columns are not blocked by the presence of automatically created indexes.</span></span> <span data-ttu-id="3e98a-154">Azure SQL Database 自動建立的索引會在與之相關的資料表或資料行遭到卸除時立即卸除。</span><span class="sxs-lookup"><span data-stu-id="3e98a-154">Indexes that are automatically created by Azure SQL Database are immediately dropped when related table or columns is dropped.</span></span>

## <a name="automatic-plan-choice-correction"></a><span data-ttu-id="3e98a-155">自動計劃選擇更正</span><span class="sxs-lookup"><span data-stu-id="3e98a-155">Automatic plan choice correction</span></span>

<span data-ttu-id="3e98a-156">自動計劃更正為 SQL Server 2017 CTP2.0 中新增的自動調整功能，可識別行為異常的 SQL 計劃。</span><span class="sxs-lookup"><span data-stu-id="3e98a-156">Automatic plan correction is a new automatic tuning feature added in SQL Server 2017 CTP2.0 that identifies SQL plans that misbehave.</span></span> <span data-ttu-id="3e98a-157">這個自動調整選項即將在 Azure SQL Database 推出。</span><span class="sxs-lookup"><span data-stu-id="3e98a-157">This automatic tuning option is coming soon on Azure SQL Database.</span></span> <span data-ttu-id="3e98a-158">如需詳細資訊，可在[自動調整 SQL Server 2017](https://docs.microsoft.com/sql/relational-databases/automatic-tuning/automatic-tuning) 中找到。</span><span class="sxs-lookup"><span data-stu-id="3e98a-158">Find more information at [Automatic tuning in SQL Server 2017](https://docs.microsoft.com/sql/relational-databases/automatic-tuning/automatic-tuning).</span></span>

## <a name="next-steps"></a><span data-ttu-id="3e98a-159">後續步驟</span><span class="sxs-lookup"><span data-stu-id="3e98a-159">Next steps</span></span>

- <span data-ttu-id="3e98a-160">若要在 Azure SQL Database 中啟用自動調整，並讓自動調整功能完全管理您的工作負載，請參閱[啟用自動調整](sql-database-automatic-tuning-enable.md)。</span><span class="sxs-lookup"><span data-stu-id="3e98a-160">To enable automatic tuning in Azure SQL Database and let automatic tuning feature fully manage your workload, see [Enable automatic tuning](sql-database-automatic-tuning-enable.md).</span></span>
- <span data-ttu-id="3e98a-161">若要使用手動調整，您可以檢閱 [Azure 入口網站中的調整建議](sql-database-advisor-portal.md)並手動套用可改善查詢效能的建議。</span><span class="sxs-lookup"><span data-stu-id="3e98a-161">To use manual tuning, you can review [Tuning recommendations in Azure portal](sql-database-advisor-portal.md) and manually apply the ones that improve performance of your queries.</span></span>
