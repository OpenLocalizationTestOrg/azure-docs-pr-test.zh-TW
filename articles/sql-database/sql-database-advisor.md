---
title: "Azure SQL Database aaaPerformance 建議 |Microsoft 文件"
description: "hello Azure SQL Database 提供您 SQL 資料庫，可改善目前的查詢效能的建議。"
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: monicar
ms.assetid: 1db441ff-58f5-45da-8d38-b54dc2aa6145
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 07/05/2017
ms.author: sstein
ms.openlocfilehash: 77db338a0a395aec78c9e02849ae5ba4f2d01680
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="performance-recommendations"></a><span data-ttu-id="db2c6-103">效能建議</span><span class="sxs-lookup"><span data-stu-id="db2c6-103">Performance recommendations</span></span>

<span data-ttu-id="db2c6-104">Azure SQL Database 會學習和會與您的應用程式，並提供您的 SQL database toomaximize hello 效能讓您自訂的建議。</span><span class="sxs-lookup"><span data-stu-id="db2c6-104">Azure SQL Database learns and adapts with your application and provides customized recommendations enabling you toomaximize hello performance of your SQL databases.</span></span> <span data-ttu-id="db2c6-105">同時藉由分析 SQL Database 的使用記錄來持續評估效能。</span><span class="sxs-lookup"><span data-stu-id="db2c6-105">Your performance is continuously assessed by analyzing your SQL Database usage history.</span></span> <span data-ttu-id="db2c6-106">hello 建議提供資料庫唯一的工作負載模式為基礎，並協助改善其效能。</span><span class="sxs-lookup"><span data-stu-id="db2c6-106">hello recommendations that are provided are based on a database unique workload pattern and help improve its performance.</span></span>

> [!NOTE]
> <span data-ttu-id="db2c6-107">建議在您的資料庫上啟用 [自動調整] 來使用建議。</span><span class="sxs-lookup"><span data-stu-id="db2c6-107">Recommended way of using recommendations is by enabling ‘Automatic tuning’ on your database.</span></span> <span data-ttu-id="db2c6-108">如需詳細資訊，請參閱[自動調整](sql-database-automatic-tuning.md)。</span><span class="sxs-lookup"><span data-stu-id="db2c6-108">For details, see [Automatic tuning](sql-database-automatic-tuning.md).</span></span>
>

## <a name="create-index-recommendations"></a><span data-ttu-id="db2c6-109">建立索引建議</span><span class="sxs-lookup"><span data-stu-id="db2c6-109">Create index recommendations</span></span>
<span data-ttu-id="db2c6-110">Azure SQL Database 連續監視正在執行的 hello 查詢並找出 hello 索引無法改善 hello 效能。</span><span class="sxs-lookup"><span data-stu-id="db2c6-110">Azure SQL Database continuously monitors hello queries being executed and identifies hello indexes that could improve hello performance.</span></span> <span data-ttu-id="db2c6-111">一旦確信遺漏特定索引，將會建立新的 [建立索引] 建議。</span><span class="sxs-lookup"><span data-stu-id="db2c6-111">Once enough confidence is built that a certain index is missing, a new **Create index** recommendation will be created.</span></span> <span data-ttu-id="db2c6-112">Azure SQL Database 建置信賴估計效能改善 hello 索引將會把透過時間。</span><span class="sxs-lookup"><span data-stu-id="db2c6-112">Azure SQL Database builds confidence by estimating performance gain hello index would bring through time.</span></span> <span data-ttu-id="db2c6-113">根據 hello 估計效能改善，建議會分類為高、 中或低。</span><span class="sxs-lookup"><span data-stu-id="db2c6-113">Depending on hello estimated performance gain, recommendations are categorized as High, Medium,  or Low.</span></span> 

<span data-ttu-id="db2c6-114">使用建議建立的索引永遠都會標記為 auto_created 索引。</span><span class="sxs-lookup"><span data-stu-id="db2c6-114">Indexes created using recommendations are always flagged as auto_created indexes.</span></span> <span data-ttu-id="db2c6-115">查看 sys.indexes 檢視，可以得知哪些索引為 auto_created。</span><span class="sxs-lookup"><span data-stu-id="db2c6-115">You can see which indexes are auto_created by looking at sys.indexes view.</span></span> <span data-ttu-id="db2c6-116">自動建立的索引不會封鎖 ALTER/RENAME 命令。</span><span class="sxs-lookup"><span data-stu-id="db2c6-116">Auto created indexes don’t block ALTER/RENAME commands.</span></span> <span data-ttu-id="db2c6-117">如果您嘗試 toodrop hello 資料行上建立索引的自動，hello 命令會將 $ 並 hello 自動建立索引與 hello 命令以及捨棄訊息。</span><span class="sxs-lookup"><span data-stu-id="db2c6-117">If you try toodrop hello column that has an auto created index over it, hello command passes and hello auto created index is dropped with hello command as well.</span></span> <span data-ttu-id="db2c6-118">一般索引會封鎖 hello ALTER/重新命名 命令會編製索引的資料行上。</span><span class="sxs-lookup"><span data-stu-id="db2c6-118">Regular indexes would block hello ALTER/RENAME command on columns that are indexed.</span></span>

<span data-ttu-id="db2c6-119">一旦建立 hello 索引建議套用時，Azure SQL Database 將會比較的 hello 查詢的效能與 hello 基準效能。</span><span class="sxs-lookup"><span data-stu-id="db2c6-119">Once hello create index recommendation is applied, Azure SQL Database will compare performance of hello queries with hello baseline performance.</span></span> <span data-ttu-id="db2c6-120">如果新的索引所引進 hello 效能增強功能，建議會標示為成功並影響報告可使用。</span><span class="sxs-lookup"><span data-stu-id="db2c6-120">If new index brought improvements in hello performance, recommendation will be flagged as successful and impact report will be available.</span></span> <span data-ttu-id="db2c6-121">萬一 hello 索引未帶來 hello 好處，即會自動回復。</span><span class="sxs-lookup"><span data-stu-id="db2c6-121">In case hello index didn’t bring hello benefits, it will be automatically reverted.</span></span> <span data-ttu-id="db2c6-122">如此一來 Azure SQL Database 可確保使用的建議將只會提升 hello 資料庫效能。</span><span class="sxs-lookup"><span data-stu-id="db2c6-122">This way Azure SQL Database ensures that using recommendations will only improve hello database performance.</span></span>

<span data-ttu-id="db2c6-123">任何**建立索引**建議的撤退原則的套用 hello 建議，如果 hello 資料庫或集區 DTU 使用量 80%以上最後 20 分鐘或如果 hello 儲存體高於 90%的使用方式中不允許。</span><span class="sxs-lookup"><span data-stu-id="db2c6-123">Any **Create index** recommendation has a back off policy that won’t allow applying hello recommendation if hello database or pool DTU usage was above 80% in last 20 minutes or if hello storage is above 90% of usage.</span></span> <span data-ttu-id="db2c6-124">在此情況下，將會延遲 hello 建議。</span><span class="sxs-lookup"><span data-stu-id="db2c6-124">In this case, hello recommendation will be postponed.</span></span>

## <a name="drop-index-recommendations"></a><span data-ttu-id="db2c6-125">卸除索引建議</span><span class="sxs-lookup"><span data-stu-id="db2c6-125">Drop index recommendations</span></span>
<span data-ttu-id="db2c6-126">此外 toodetecting 遺漏的索引時，Azure SQL Database 連續會分析現有的索引的 hello 效能。</span><span class="sxs-lookup"><span data-stu-id="db2c6-126">In addition toodetecting a missing index, Azure SQL Database continuously analyzes hello performance of existing indexes.</span></span> <span data-ttu-id="db2c6-127">如果未使用索引，Azure SQL Database 會建議卸除它。</span><span class="sxs-lookup"><span data-stu-id="db2c6-127">If index is not used, Azure SQL Database will recommend dropping it.</span></span> <span data-ttu-id="db2c6-128">在兩種情況下會建議使用卸除索引：</span><span class="sxs-lookup"><span data-stu-id="db2c6-128">Dropping an index is recommended in two cases:</span></span>
* <span data-ttu-id="db2c6-129">索引是另一個索引的複本 (編製和內含索引的資料行、分割、結構描述及篩選器相同)</span><span class="sxs-lookup"><span data-stu-id="db2c6-129">Index is a duplicate of another index (same indexed and included column, partition schema, and filters)</span></span>
* <span data-ttu-id="db2c6-130">索引長時間都未使用 (93 天)</span><span class="sxs-lookup"><span data-stu-id="db2c6-130">Index is unused for a prolonged period (93 days)</span></span>

<span data-ttu-id="db2c6-131">卸除索引建議也經過實作後的 hello 驗證。</span><span class="sxs-lookup"><span data-stu-id="db2c6-131">Drop index recommendations also go through hello verification after implementation.</span></span> <span data-ttu-id="db2c6-132">如果 hello 效能已獲得改善 hello 影響報表會提供。</span><span class="sxs-lookup"><span data-stu-id="db2c6-132">If hello performance is improved hello impact report will be available.</span></span> <span data-ttu-id="db2c6-133">偵測到效能降低時，將會還原建議。</span><span class="sxs-lookup"><span data-stu-id="db2c6-133">In case performance degradation is detected, recommendation will be reverted.</span></span>


## <a name="parameterize-queries-recommendations"></a><span data-ttu-id="db2c6-134">參數化查詢建議</span><span class="sxs-lookup"><span data-stu-id="db2c6-134">Parameterize queries recommendations</span></span>
<span data-ttu-id="db2c6-135">**將查詢參數化**建議會有一個或更多查詢不斷重新編譯過，但得到 hello 相同的查詢執行計劃時出現。</span><span class="sxs-lookup"><span data-stu-id="db2c6-135">**Parameterize queries** recommendations appear when you have one or more queries that are constantly being recompiled but end up with hello same query execution plan.</span></span> <span data-ttu-id="db2c6-136">這種狀況會強制參數化，可讓 toobe 快取，並在未來改善效能並減少資源使用狀況 hello 中重複使用的查詢計劃機會 tooapply 開啟。</span><span class="sxs-lookup"><span data-stu-id="db2c6-136">This condition opens up an opportunity tooapply forced parameterization, which will allow query plans toobe cached and reused in hello future improving performance and reducing resource usage.</span></span> 

<span data-ttu-id="db2c6-137">每一個查詢中一開始發行對 SQL Server 需要編譯 toobe toogenerate 執行計畫。</span><span class="sxs-lookup"><span data-stu-id="db2c6-137">Every query issued against SQL Server initially needs toobe compiled toogenerate an execution plan.</span></span> <span data-ttu-id="db2c6-138">每個產生的計劃會新增 toohello 計畫快取，以及後續執行作業的 hello 相同的查詢可以重複使用此計劃的 hello 快取中，排除 hello 需要其他的編譯。</span><span class="sxs-lookup"><span data-stu-id="db2c6-138">Each generated plan is added toohello plan cache and subsequent executions of hello same query can reuse this plan from hello cache, eliminating hello need for additional compilation.</span></span> 

<span data-ttu-id="db2c6-139">傳送查詢，包含非參數化的值，應用程式可能會導致 tooa 的效能負擔，其中針對每個這類查詢使用不同參數值 hello 執行計畫會編譯一次。</span><span class="sxs-lookup"><span data-stu-id="db2c6-139">Applications that send queries, which include non-parameterized values, can lead tooa performance overhead, where for every such query with different parameter values hello execution plan is compiled again.</span></span> <span data-ttu-id="db2c6-140">在許多情況下 hello 與不同的參數值產生相同的查詢 hello 相同的執行計畫，但這些計劃仍然會個別加入 toohello 計畫快取。</span><span class="sxs-lookup"><span data-stu-id="db2c6-140">In many cases hello same queries with different parameter values generate hello same execution plans, but these plans are still separately added toohello plan cache.</span></span> <span data-ttu-id="db2c6-141">重新編譯執行計畫使用的資料庫資源，增加 hello 查詢持續時間的時間和溢位 hello 計劃導致快取計劃 toobe hello 快取中收回。</span><span class="sxs-lookup"><span data-stu-id="db2c6-141">Recompiling execution plans use database resources, increase hello query duration time and overflow hello plan cache causing plans toobe evicted from hello cache.</span></span> <span data-ttu-id="db2c6-142">SQL Server 的這個行為可以藉由設定強制參數化選項 hello 資料庫上的 hello 改變。</span><span class="sxs-lookup"><span data-stu-id="db2c6-142">This behavior of SQL Server can be altered by setting hello forced parameterization option on hello database.</span></span> 

<span data-ttu-id="db2c6-143">toohelp 估計 hello 的這項建議的影響，您會提供與比較 hello 實際 CPU 使用量和 hello 投影 CPU 使用量 （就像已套用 hello 建議）。</span><span class="sxs-lookup"><span data-stu-id="db2c6-143">toohelp you estimate hello impact of this recommendation, you are provided with a comparison between hello actual CPU usage and hello projected CPU usage (as if hello recommendation was applied).</span></span> <span data-ttu-id="db2c6-144">此外 tooCPU 節省您查詢持續時間會減少 hello 編譯中所花費的時間。</span><span class="sxs-lookup"><span data-stu-id="db2c6-144">In addition tooCPU savings, your query duration decreases for hello time spent in compilation.</span></span> <span data-ttu-id="db2c6-145">也會有額外負荷更不在計畫快取，讓大部分的 hello 計劃快取中的 toostay 及重複使用。</span><span class="sxs-lookup"><span data-stu-id="db2c6-145">There will also be much less overhead on plan cache, allowing majority of hello plans toostay in cache and be reused.</span></span> <span data-ttu-id="db2c6-146">您可以按一下 hello 套用此建議快速且輕鬆地**套用**命令。</span><span class="sxs-lookup"><span data-stu-id="db2c6-146">You can apply this recommendation quickly and easily by clicking on hello **Apply** command.</span></span> 

<span data-ttu-id="db2c6-147">一旦您套用這項建議，它可讓您在資料庫上的分鐘內的強制參數化，並開始監視處理序可在大約 24 小時延續 hello。</span><span class="sxs-lookup"><span data-stu-id="db2c6-147">Once you apply this recommendation, it will enable forced parameterization within minutes on your database and it starts hello monitoring process which approximately lasts for 24 hours.</span></span> <span data-ttu-id="db2c6-148">在這段期間之後, 您將會是能 toosee hello 驗證報表會顯示資料庫的 CPU 使用量之前的 24 小時，而且在套用 hello 建議之後。</span><span class="sxs-lookup"><span data-stu-id="db2c6-148">After this period, you will be able toosee hello validation report that shows CPU usage of your database 24 hours before and after hello recommendation has been applied.</span></span> <span data-ttu-id="db2c6-149">SQL Database Advisor 還具有會自動回復 hello 套用建議，如果已偵測到的效能低下的安全性機制。</span><span class="sxs-lookup"><span data-stu-id="db2c6-149">SQL Database Advisor has a safety mechanism that automatically reverts hello applied recommendation in case a performance regression has been detected.</span></span>

## <a name="fix-schema-issues-recommendations"></a><span data-ttu-id="db2c6-150">修正結構描述問題建議</span><span class="sxs-lookup"><span data-stu-id="db2c6-150">Fix schema issues recommendations</span></span>
<span data-ttu-id="db2c6-151">**請修正結構描述問題**建議時，會出現 hello SQL Database 服務通知中的結構描述相關的 SQL 錯誤發生在您的 Azure SQL Database 上的 hello 數目異常狀況。</span><span class="sxs-lookup"><span data-stu-id="db2c6-151">**Fix schema issues** recommendations appear when hello SQL Database service notices an anomaly in hello number of schema-related SQL errors happening on your Azure SQL Database.</span></span> <span data-ttu-id="db2c6-152">您的資料庫在一小時內遇到多個結構描述相關的錯誤時 (無效的資料行名稱、無效的物件名稱等)，通常會出現此建議。</span><span class="sxs-lookup"><span data-stu-id="db2c6-152">This recommendation typically appears when your database encounters multiple schema-related errors (invalid column name, invalid object name, etc.) within an hour.</span></span>

<span data-ttu-id="db2c6-153">「 結構描述問題 」 是一種在 SQL Server 未對齊的 hello SQL 查詢的 hello 定義與 hello 資料庫結構描述的 hello 定義時，就可能發生的語法錯誤類別。</span><span class="sxs-lookup"><span data-stu-id="db2c6-153">“Schema issues” are a class of syntax errors in SQL Server that happen when hello definition of hello SQL query and hello definition of hello database schema are not aligned.</span></span> <span data-ttu-id="db2c6-154">例如，其中一個 hello hello 查詢所預期的資料行可能會遺漏在 hello 目標資料表中，反之亦然。</span><span class="sxs-lookup"><span data-stu-id="db2c6-154">For example, one of hello columns expected by hello query may be missing in hello target table, or vice versa.</span></span> 

<span data-ttu-id="db2c6-155">Azure SQL Database 服務通知中的結構描述相關的 SQL 錯誤發生在您的 Azure SQL Database 上的 hello 數目異常狀況時，就會出現 「 修正結構描述問題 」 的建議。</span><span class="sxs-lookup"><span data-stu-id="db2c6-155">“Fix schema issue” recommendation appears when Azure SQL Database service notices an anomaly in hello number of schema-related SQL errors happening on your Azure SQL Database.</span></span> <span data-ttu-id="db2c6-156">下列表格顯示 hello 錯誤 tooschema 相關的問題的 hello:</span><span class="sxs-lookup"><span data-stu-id="db2c6-156">hello following table shows hello errors that are related tooschema issues:</span></span>

| <span data-ttu-id="db2c6-157">SQL 錯誤碼</span><span class="sxs-lookup"><span data-stu-id="db2c6-157">SQL Error Code</span></span> | <span data-ttu-id="db2c6-158">訊息</span><span class="sxs-lookup"><span data-stu-id="db2c6-158">Message</span></span> |
| --- | --- |
| <span data-ttu-id="db2c6-159">201</span><span class="sxs-lookup"><span data-stu-id="db2c6-159">201</span></span> |<span data-ttu-id="db2c6-160">程序或函數 '' 必須有參數 ''，但未提供。</span><span class="sxs-lookup"><span data-stu-id="db2c6-160">Procedure or function '*' expects parameter '*', which was not supplied.</span></span> |
| <span data-ttu-id="db2c6-161">207</span><span class="sxs-lookup"><span data-stu-id="db2c6-161">207</span></span> |<span data-ttu-id="db2c6-162">無效的資料行名稱 '*'。</span><span class="sxs-lookup"><span data-stu-id="db2c6-162">Invalid column name '*'.</span></span> |
| <span data-ttu-id="db2c6-163">208</span><span class="sxs-lookup"><span data-stu-id="db2c6-163">208</span></span> |<span data-ttu-id="db2c6-164">無效的物件名稱 '*'。</span><span class="sxs-lookup"><span data-stu-id="db2c6-164">Invalid object name '*'.</span></span> |
| <span data-ttu-id="db2c6-165">213</span><span class="sxs-lookup"><span data-stu-id="db2c6-165">213</span></span> |<span data-ttu-id="db2c6-166">資料行名稱或提供的數值數量與資料表定義不相符。</span><span class="sxs-lookup"><span data-stu-id="db2c6-166">Column name or number of supplied values does not match table definition.</span></span> |
| <span data-ttu-id="db2c6-167">2812</span><span class="sxs-lookup"><span data-stu-id="db2c6-167">2812</span></span> |<span data-ttu-id="db2c6-168">找不到預存程序 ' *'。</span><span class="sxs-lookup"><span data-stu-id="db2c6-168">Could not find stored procedure '*'.</span></span> |
| <span data-ttu-id="db2c6-169">8144</span><span class="sxs-lookup"><span data-stu-id="db2c6-169">8144</span></span> |<span data-ttu-id="db2c6-170">程序或函數 * 指定了太多的引數。</span><span class="sxs-lookup"><span data-stu-id="db2c6-170">Procedure or function * has too many arguments specified.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="db2c6-171">後續步驟</span><span class="sxs-lookup"><span data-stu-id="db2c6-171">Next steps</span></span>
<span data-ttu-id="db2c6-172">監視您的建議，並繼續 tooapply 它們 toorefine 效能。</span><span class="sxs-lookup"><span data-stu-id="db2c6-172">Monitor your recommendations and continue tooapply them toorefine performance.</span></span> <span data-ttu-id="db2c6-173">資料庫工作負載會動態地持續變更。</span><span class="sxs-lookup"><span data-stu-id="db2c6-173">Database workloads are dynamic and change continuously.</span></span> <span data-ttu-id="db2c6-174">SQL Database advisor 會繼續 toomonitor，並提供可以改善您的資料庫效能的建議。</span><span class="sxs-lookup"><span data-stu-id="db2c6-174">SQL Database advisor continues toomonitor and provide recommendations that can potentially improve your database's performance.</span></span> 

* <span data-ttu-id="db2c6-175">請參閱[hello Azure 入口網站的效能建議](sql-database-advisor-portal.md)toouse 效能建議如何 hello Azure 入口網站的步驟。</span><span class="sxs-lookup"><span data-stu-id="db2c6-175">See [Performance recommendations in hello Azure portal](sql-database-advisor-portal.md) for steps on how toouse performance recommendations in hello Azure portal.</span></span>
* <span data-ttu-id="db2c6-176">請參閱[查詢效能深入資訊](sql-database-query-performance.md)有關 toolearn 和檢視 hello top 查詢的效能影響。</span><span class="sxs-lookup"><span data-stu-id="db2c6-176">See [Query Performance Insights](sql-database-query-performance.md) toolearn about and view hello performance impact of your top queries.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="db2c6-177">其他資源</span><span class="sxs-lookup"><span data-stu-id="db2c6-177">Additional resources</span></span>
* [<span data-ttu-id="db2c6-178">查詢存放區</span><span class="sxs-lookup"><span data-stu-id="db2c6-178">Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx)
* [<span data-ttu-id="db2c6-179">CREATE INDEX</span><span class="sxs-lookup"><span data-stu-id="db2c6-179">CREATE INDEX</span></span>](https://msdn.microsoft.com/library/ms188783.aspx)
* [<span data-ttu-id="db2c6-180">角色型存取控制</span><span class="sxs-lookup"><span data-stu-id="db2c6-180">Role-based access control</span></span>](../active-directory/role-based-access-control-what-is.md)

