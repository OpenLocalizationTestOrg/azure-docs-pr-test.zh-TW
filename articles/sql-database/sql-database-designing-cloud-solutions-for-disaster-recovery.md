---
title: "使用 Azure SQL Database 的 aaaDesign 高可用性服務 |Microsoft 文件"
description: "了解使用 Azure SQL Database 對高可用性服務的應用程式設計。"
keywords: "cloud disaster recovery,disaster recovery solutions,app data backup,geo-replication,business continuity planning,雲端災害復原,災害復原方案,應用程式資料備份,異地複寫,商務持續性計劃"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: e8a346ac-dd08-41e7-9685-46cebca04582
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 04/21/2017
ms.author: sashan
ms.openlocfilehash: 815f754ba7014cd8a1108a2d84c2a8f71d7030a5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="designing-highly-available-services-using-azure-sql-database"></a><span data-ttu-id="123a4-104">使用 Azure SQL Database 設計高可用性服務</span><span class="sxs-lookup"><span data-stu-id="123a4-104">Designing highly available services using Azure SQL Database</span></span>

<span data-ttu-id="123a4-105">建置和部署 Azure SQL Database 上的高可用性服務，當您使用[容錯移轉群組和作用中地理複寫](sql-database-geo-replication-overview.md)tooprovide 恢復 tooregional 失敗及嚴重的中斷，並啟用快速復原toohello 次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="123a4-105">When building and deploying highly available services on Azure SQL Database, you use [failover groups and active geo-replication](sql-database-geo-replication-overview.md) tooprovide resilience tooregional failures and catastrophic outages and enable fast recovery toohello secondary databases.</span></span> <span data-ttu-id="123a4-106">本文著重於常見的應用程式模式，並討論 hello 優點和缺點 hello 應用程式部署需求，您的目標，hello 服務等級協定根據每個選項的流量延遲和成本。</span><span class="sxs-lookup"><span data-stu-id="123a4-106">This article focuses on common application patterns and discusses hello benefits and trade-offs of each option depending on hello application deployment requirements, hello service level agreement you are targeting, traffic latency, and costs.</span></span> <span data-ttu-id="123a4-107">如需主動式異地複寫與彈性集區的相關資訊，請參閱[彈性集區災害復原策略](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md)。</span><span class="sxs-lookup"><span data-stu-id="123a4-107">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

## <a name="design-pattern-1-active-passive-deployment-for-cloud-disaster-recovery-with-a-co-located-database"></a><span data-ttu-id="123a4-108">設計模式 1：雲端災害復原的主動-被動部署，使用共置資料庫</span><span class="sxs-lookup"><span data-stu-id="123a4-108">Design pattern 1: Active-passive deployment for cloud disaster recovery with a co-located database</span></span>
<span data-ttu-id="123a4-109">這個選項最適合用於應用程式具有下列特性的 hello:</span><span class="sxs-lookup"><span data-stu-id="123a4-109">This option is best suited for applications with hello following characteristics:</span></span>

* <span data-ttu-id="123a4-110">單一 Azure 區域中的作用中執行個體</span><span class="sxs-lookup"><span data-stu-id="123a4-110">Active instance in a single Azure region</span></span>
* <span data-ttu-id="123a4-111">讀寫 (RW) 存取 toodata 強式相依性</span><span class="sxs-lookup"><span data-stu-id="123a4-111">Strong dependency on read-write (RW) access toodata</span></span>
* <span data-ttu-id="123a4-112">跨地區 hello web 應用程式與資料庫之間連線 hello 不接受到期 toolatency 和流量成本</span><span class="sxs-lookup"><span data-stu-id="123a4-112">Cross-region connectivity between hello web application and hello database is not acceptable due toolatency and traffic cost</span></span>    

<span data-ttu-id="123a4-113">在此情況下，hello 應用程式的部署拓撲最適合處理地區的災害，當所有應用程式元件會受到影響，因此需要 toofailover 做為一個單位。</span><span class="sxs-lookup"><span data-stu-id="123a4-113">In this case, hello application deployment topology is optimized for handling regional disasters when all application components are impacted and need toofailover as a unit.</span></span> <span data-ttu-id="123a4-114">如需地理備援，hello 應用程式邏輯和 hello 資料庫複寫的 tooanother 區域但不是用於 hello 在 hello 正常情況下的應用程式工作負載。</span><span class="sxs-lookup"><span data-stu-id="123a4-114">For geographic redundancy, hello application logic and hello database are replicated tooanother region but they are not used for hello application workload under hello normal conditions.</span></span> <span data-ttu-id="123a4-115">hello 次要區域中的 hello 應用程式應該設定的 toouse SQL 連接字串 toohello 次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="123a4-115">hello application in hello secondary region should be configured toouse a SQL connection string toohello secondary database.</span></span> <span data-ttu-id="123a4-116">流量管理員設定 toouse[容錯移轉路由方法](../traffic-manager/traffic-manager-configure-failover-routing-method.md)。</span><span class="sxs-lookup"><span data-stu-id="123a4-116">Traffic manager is set up toouse [failover routing method](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span></span>  

> [!NOTE]
> <span data-ttu-id="123a4-117">這整篇文章使用 [Azure 流量管理員](../traffic-manager/traffic-manager-overview.md)僅供說明用途。</span><span class="sxs-lookup"><span data-stu-id="123a4-117">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) is used throughout this article for illustration purposes only.</span></span> <span data-ttu-id="123a4-118">您可以使用任何支援容錯移轉路由方法的負載平衡方案。</span><span class="sxs-lookup"><span data-stu-id="123a4-118">You can use any load-balancing solution that supports failover routing method.</span></span>    
>

<span data-ttu-id="123a4-119">hello 下列圖表顯示前中斷此設定。</span><span class="sxs-lookup"><span data-stu-id="123a4-119">hello following diagram shows this configuration before an outage.</span></span>

![SQL Database 異地複寫組態。](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-1.png)

<span data-ttu-id="123a4-122">發生中斷後 hello 主要區域中，hello SQL Database 服務會偵測該 hello 主要資料庫無法存取，因此觸發根據的 hello 自動容錯移轉原則 hello 參數是容錯移轉的 toohello 次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="123a4-122">After an outage in hello primary region, hello SQL Database service detects that hello primary database is not accessible and trigger a failover toohello secondary database based on hello parameters of hello automatic failover policy.</span></span> <span data-ttu-id="123a4-123">根據您應用程式的 SLA，您可以決定 tooconfigure 的寬限期內之間 hello 偵測 hello 中斷與本身 hello 容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="123a4-123">Depending on your application SLA, you can decide tooconfigure a grace period between hello detection of hello outage and hello failover itself.</span></span> <span data-ttu-id="123a4-124">設定寬限期內，可降低資料遺失 toohello 案例其中 hello 中斷是重大，而無法快速還原 hello 區域中的可用性 hello 風險。</span><span class="sxs-lookup"><span data-stu-id="123a4-124">Configuring a grace period reduces hello risk of data loss toohello cases where hello outage is catastrophic and availability in hello region cannot be quickly restored.</span></span> <span data-ttu-id="123a4-125">如果 hello 端點容錯移轉會起始 hello 流量管理員 hello 容錯移轉群組觸發程序 hello hello 資料庫的容錯移轉之前，將 hello web 應用程式就不能 tooreconnect toohello 資料庫。</span><span class="sxs-lookup"><span data-stu-id="123a4-125">If hello endpoint failover is initiated by hello traffic manager before hello failover group triggers hello failover of hello database, hello web application is not able tooreconnect toohello database.</span></span> <span data-ttu-id="123a4-126">hello 資料庫容錯移轉完成時，會自動成功 hello 應用程式嘗試 tooreconnect。</span><span class="sxs-lookup"><span data-stu-id="123a4-126">hello application’s attempt tooreconnect automatically succeeds as soon as hello database failover completes.</span></span> 

> [!NOTE]
> <span data-ttu-id="123a4-127">tooachieve 完全協調 hello 應用程式和 hello 資料庫的容錯移轉，您應該設計您自己的監視方法，並使用 hello web 應用程式端點和 hello 資料庫手動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="123a4-127">tooachieve fully coordinated failover of hello application and hello databases, you should devise your own monitoring method and use manual failover of hello web application endpoints and hello databases.</span></span>
>

<span data-ttu-id="123a4-128">Hello hello 應用程式端點和 hello 資料庫的容錯移轉完成之後，hello 應用程式會重新開始處理 hello hello 區域 B 中的使用者要求，並就會維持與 hello 資料庫位於相同位置，因為 hello 主要資料庫目前處於區域 b。此案例中是以 hello 下列圖表所示。</span><span class="sxs-lookup"><span data-stu-id="123a4-128">After hello failover of both hello application’s endpoints and hello database completes, hello application will re-start processing hello user requests in hello region B and will remain co-located with hello database because hello primary database is now in region B. This scenario is illustrated in hello following diagram.</span></span> <span data-ttu-id="123a4-129">在所有圖表中，實線表示作用中連線，虛線表示暫止的連線，停止標誌表示動作觸發。</span><span class="sxs-lookup"><span data-stu-id="123a4-129">In all diagrams, solid lines indicate active connections, dotted lines indicate suspended connections, and stop signs indicate action triggers.</span></span>

![Toosecondary 地理複寫： 容錯移轉的資料庫。](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-2.png)

<span data-ttu-id="123a4-132">如果發生中斷情況發生 hello 次要區域中，hello hello 主要與 hello 次要資料庫之間的複寫連結會暫停，不過因為 hello 主要資料庫不受影響，不會觸發 hello 容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="123a4-132">If an outage happens in hello secondary region, hello replication link between hello primary and hello secondary database is suspended but hello failover is not triggered because hello primary database is not impacted.</span></span> <span data-ttu-id="123a4-133">hello 應用程式的可用性不會變更在此情況下，但 hello 應用程式運作的公開，因此具有較高的風險，以防在兩個區域失敗連續。</span><span class="sxs-lookup"><span data-stu-id="123a4-133">hello application's availability is not changed in this case, but hello application operates exposed and therefore at higher risk in case both regions fail in succession.</span></span>

> [!NOTE]
> <span data-ttu-id="123a4-134">嚴重損壞修復建議 hello 組態與應用程式部署限制 tootwo 區域。</span><span class="sxs-lookup"><span data-stu-id="123a4-134">For disaster recovery we recommend hello configuration with application deployment limited tootwo regions.</span></span> <span data-ttu-id="123a4-135">這是因為大部分的 hello Azure 地理位置具有只有兩個區域。</span><span class="sxs-lookup"><span data-stu-id="123a4-135">This is because most of hello Azure geographies have only two regions.</span></span> <span data-ttu-id="123a4-136">這些設定不會保護應用程式免於遭受兩個區域同時發生的重大失敗。</span><span class="sxs-lookup"><span data-stu-id="123a4-136">This configuration will not protect your application from a simultaneous catastrophic failure of both regions.</span></span>  <span data-ttu-id="123a4-137">在這種罕見的失敗情況下，您可以使用[異地復原作業](sql-database-disaster-recovery.md#recover-using-geo-restore)，在第三個區域復原資料庫。</span><span class="sxs-lookup"><span data-stu-id="123a4-137">In an unlikely event of such a failure, you can recover your databases in a third region using [geo-restore operation](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span>
>

<span data-ttu-id="123a4-138">一旦降低 hello 中斷，hello 次要資料庫會自動重新同步處理以 hello 主要。</span><span class="sxs-lookup"><span data-stu-id="123a4-138">Once hello outage is mitigated, hello secondary database will automatically re-synchronize with hello primary.</span></span> <span data-ttu-id="123a4-139">同步處理期間，主要 hello 的效能可能稍微影響視 hello 需要 toobe 同步處理的資料數量而定。</span><span class="sxs-lookup"><span data-stu-id="123a4-139">During synchronization, performance of hello primary could be slightly impacted depending on hello amount of data that needs toobe synchronized.</span></span> <span data-ttu-id="123a4-140">hello 下列圖表說明 hello 次要區域中的發生中斷。</span><span class="sxs-lookup"><span data-stu-id="123a4-140">hello following diagram illustrates an outage in hello secondary region.</span></span>

![次要資料庫會與主要資料庫進行同步處理。](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-3.png)

<span data-ttu-id="123a4-143">hello 金鑰**優點**此設計模式是：</span><span class="sxs-lookup"><span data-stu-id="123a4-143">hello key **advantages** of this design pattern are:</span></span>

* <span data-ttu-id="123a4-144">hello 相同 web 應用程式是部署的 tooboth 區域，而不需要任何特定地區設定和任何其他邏輯 tooreact toohello 容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="123a4-144">hello same web application is deployed tooboth regions without any region-specific configuration and no additional logic tooreact toohello failover.</span></span> 
* <span data-ttu-id="123a4-145">hello 應用程式的效能不會受到為 hello web 應用程式的容錯移轉，而且 hello 資料庫永遠位於相同位置。</span><span class="sxs-lookup"><span data-stu-id="123a4-145">hello application's performance is not impacted by failover as hello web application and hello database are always co-located.</span></span>

<span data-ttu-id="123a4-146">主要的 hello**權衡取捨**hello 多餘的應用程式是 hello 次要區域中的執行個體只用於災害復原。</span><span class="sxs-lookup"><span data-stu-id="123a4-146">hello main **tradeoff** is that hello redundant application instance in hello secondary region is only used for disaster recovery.</span></span>

## <a name="design-pattern-2-active-active-deployment-for-application-load-balancing"></a><span data-ttu-id="123a4-147">設計模式 2：應用程式負載平衡的主動-主動部署</span><span class="sxs-lookup"><span data-stu-id="123a4-147">Design pattern 2: Active-active deployment for application load balancing</span></span>
<span data-ttu-id="123a4-148">此雲端的災害復原選項最適合用於應用程式具有下列特性的 hello:</span><span class="sxs-lookup"><span data-stu-id="123a4-148">This cloud disaster recovery option is best suited for applications with hello following characteristics:</span></span>

* <span data-ttu-id="123a4-149">資料庫的比例過高讀取 toowrites</span><span class="sxs-lookup"><span data-stu-id="123a4-149">High ratio of database reads toowrites</span></span>
* <span data-ttu-id="123a4-150">資料庫讀取延遲高於 hello 使用者體驗的 hello 寫入延遲</span><span class="sxs-lookup"><span data-stu-id="123a4-150">Database read latency is more critical for hello end-user experience than hello write latency</span></span> 
* <span data-ttu-id="123a4-151">使用不同的連接字串可以隔開唯讀邏輯和讀寫邏輯</span><span class="sxs-lookup"><span data-stu-id="123a4-151">Read-only logic can be separated from read-write logic by using a different connection string</span></span>
* <span data-ttu-id="123a4-152">唯讀邏輯並非取決於 hello 最新的更新與進行完整同步處理的資料</span><span class="sxs-lookup"><span data-stu-id="123a4-152">Read-only logic does not depend on data being fully synchronized with hello latest updates</span></span>  

<span data-ttu-id="123a4-153">如果您的應用程式具有下列特性，可大幅改善負載平衡不同區域中的多個應用程式執行個體中的 hello 使用者連線 hello 整體的使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="123a4-153">If your applications have these characteristics, load balancing hello end-user connections across multiple application instances in different regions can substantially improve hello overall end-user experience.</span></span> <span data-ttu-id="123a4-154">Hello 區域的兩個應該當做 hello DR 配對和 hello 容錯移轉群組應該包含在這些區域中的 hello 資料庫。</span><span class="sxs-lookup"><span data-stu-id="123a4-154">Two of hello regions should be selected as hello DR pair and hello failover group should include hello databases in these regions.</span></span> <span data-ttu-id="123a4-155">tooimplement 負載平衡每個區域應該與 hello 讀寫 (RW) 連線的邏輯 toohello 讀取寫入接聽程式端點 hello 容錯移轉群組的作用中的 hello 應用程式執行個體。</span><span class="sxs-lookup"><span data-stu-id="123a4-155">tooimplement load-balancing, each region should have an active instance of hello application with hello read-write (RW) logic connected toohello read-write listener endpoint of hello failover group.</span></span> <span data-ttu-id="123a4-156">它將會保證如果 hello 主要資料庫會受中斷影響自動起始 hello 容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="123a4-156">It will guarantee that hello failover will be automatically initiated if hello primary database is impacted by an outage.</span></span> <span data-ttu-id="123a4-157">hello 唯讀 (RO) 中邏輯 hello web 應用程式應該直接連接 toohello 資料庫在該區域中。</span><span class="sxs-lookup"><span data-stu-id="123a4-157">hello read-only logic (RO) in hello web application should connect directly toohello database in that region.</span></span> <span data-ttu-id="123a4-158">流量管理員應該設定 toouse[效能路由](../traffic-manager/traffic-manager-configure-performance-routing-method.md)與[端點監視](../traffic-manager/traffic-manager-monitoring.md)啟用每個應用程式執行個體。</span><span class="sxs-lookup"><span data-stu-id="123a4-158">Traffic manager should be set up toouse [performance routing](../traffic-manager/traffic-manager-configure-performance-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for each application instance.</span></span>

<span data-ttu-id="123a4-159">如同模式 #1，您應該考慮部署類似的監視應用程式。</span><span class="sxs-lookup"><span data-stu-id="123a4-159">As in pattern #1, you should consider deploying a similar monitoring application.</span></span> <span data-ttu-id="123a4-160">但是，有別於模式 #1，hello 監視應用程式不會負責觸發 hello 端點容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="123a4-160">But unlike pattern #1, hello monitoring application will not be responsible for triggering hello end-point failover.</span></span>

> [!NOTE]
> <span data-ttu-id="123a4-161">此模式會使用多個次要資料庫，而只 hello 次要區域 B 中用於容錯移轉，而且應該 hello 容錯移轉群組的一部分。</span><span class="sxs-lookup"><span data-stu-id="123a4-161">While this pattern uses more than one secondary database, only hello secondary in Region B  would be used for failover and should be part of hello failover group.</span></span>
>

<span data-ttu-id="123a4-162">流量管理員應該設定為效能路由 toodirect hello 使用者連線 toohello 應用程式執行個體最接近 toohello 使用者的地理位置。</span><span class="sxs-lookup"><span data-stu-id="123a4-162">Traffic manager should be configured for performance routing toodirect hello user connections toohello application instance closest toohello user's geographic location.</span></span> <span data-ttu-id="123a4-163">hello 下列圖表說明前中斷此組態。</span><span class="sxs-lookup"><span data-stu-id="123a4-163">hello following diagram illustrates this configuration before an outage.</span></span>

![沒有中斷： 路由 toonearest 應用程式的效能。](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-1.png)

<span data-ttu-id="123a4-166">Hello 容錯移轉群組 hello 區域 A 中偵測到資料庫中斷時，會自動起始次要區域 b 中的區域 A toohello hello 主要資料庫的容錯移轉它也會自動將更新 hello 讀取寫入接聽程式端點 tooregion B 使 hello web 應用程式中的讀寫連接將不會受到影響。</span><span class="sxs-lookup"><span data-stu-id="123a4-166">If a database outage is detected in hello region A, hello failover group will automatically initiate failover of hello primary database in region A toohello secondary in region B. It will also automatically update hello read-write listener endpoint tooregion B so read-write connections in hello web application will not be impacted.</span></span> <span data-ttu-id="123a4-167">hello traffic manager 會將排除 hello 路由表 hello 離線的端點，但仍會繼續路由 hello 使用者流量 toohello 剩餘線上的執行個體。</span><span class="sxs-lookup"><span data-stu-id="123a4-167">hello traffic manager will exclude hello offline end-point from hello routing table but will continue routing hello end-user traffic toohello remaining online instances.</span></span> <span data-ttu-id="123a4-168">hello 唯讀 SQL 連接字串將不會影響，因為它們一律指向 hello toohello 資料庫相同的區域。</span><span class="sxs-lookup"><span data-stu-id="123a4-168">hello read-only SQL connection strings will not be impacted as they always point toohello database in hello same region.</span></span> 

<span data-ttu-id="123a4-169">hello 下列圖表說明 hello hello 容錯移轉之後的新組態。</span><span class="sxs-lookup"><span data-stu-id="123a4-169">hello following diagram illustrates hello new configuration after hello failover.</span></span>

![容錯移轉之後的組態。](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-2.png)

<span data-ttu-id="123a4-172">發生在其中一個 hello 次要區域發生中斷，hello traffic manager 會自動移除 hello 離線的端點在該區域 hello 路由表。</span><span class="sxs-lookup"><span data-stu-id="123a4-172">In case of an outage in one of hello secondary regions, hello traffic manager will automatically remove hello offline end-point in that region from hello routing table.</span></span> <span data-ttu-id="123a4-173">將擱置 hello 複寫通道 toohello 次要資料庫在該區域中。</span><span class="sxs-lookup"><span data-stu-id="123a4-173">hello replication channel toohello secondary database in that region will be suspended.</span></span> <span data-ttu-id="123a4-174">Hello 剩餘區域在此案例中取得額外的使用者流量，因為 hello 應用程式的效能會受到影響 hello 中斷期間。</span><span class="sxs-lookup"><span data-stu-id="123a4-174">Because hello remaining regions get additional user traffic in this scenario, hello application's performance will be impacted during hello outage.</span></span> <span data-ttu-id="123a4-175">一旦降低 hello 中斷，hello hello 受影響區域中的次要資料庫會立即同步處理以 hello 主要。</span><span class="sxs-lookup"><span data-stu-id="123a4-175">Once hello outage is mitigated, hello secondary database in hello impacted region will be immediately synchronized with hello primary.</span></span> <span data-ttu-id="123a4-176">Hello 期間同步處理效能的主要 hello 可能稍微影響視 hello 需要 toobe 同步處理的資料數量而定。</span><span class="sxs-lookup"><span data-stu-id="123a4-176">During hello synchronization performance of hello primary could be slightly impacted depending on hello amount of data that needs toobe synchronized.</span></span> <span data-ttu-id="123a4-177">hello 下列圖表說明區域 b 中斷</span><span class="sxs-lookup"><span data-stu-id="123a4-177">hello following diagram illustrates an outage in region B.</span></span>

![次要地區中斷。](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-3.png)

<span data-ttu-id="123a4-180">hello 金鑰**利用**這種設計模式是您可以跨多個次要資料庫 tooachieve hello 最佳的使用者效能調整 hello 應用程式工作負載。</span><span class="sxs-lookup"><span data-stu-id="123a4-180">hello key **advantage** of this design pattern is that you can scale hello application workload across multiple secondaries tooachieve hello optimal end-user performance.</span></span> <span data-ttu-id="123a4-181">hello**的權衡取捨完全**這個選項是：</span><span class="sxs-lookup"><span data-stu-id="123a4-181">hello **tradeoffs** of this option are:</span></span>

* <span data-ttu-id="123a4-182">Hello 應用程式執行個體與資料庫之間的讀寫連接具有不同的延遲和成本</span><span class="sxs-lookup"><span data-stu-id="123a4-182">Read-write connections between hello application instances and database have varying latency and cost</span></span>
* <span data-ttu-id="123a4-183">Hello 中斷期間，會影響應用程式效能</span><span class="sxs-lookup"><span data-stu-id="123a4-183">Application performance is impacted during hello outage</span></span>

> [!NOTE]
> <span data-ttu-id="123a4-184">可以使用類似的方法 toooffload 特製化工作負載，例如報告作業、 商業智慧工具或備份。</span><span class="sxs-lookup"><span data-stu-id="123a4-184">A similar approach can be used toooffload specialized workloads such as reporting jobs, business intelligence tools, or backups.</span></span> <span data-ttu-id="123a4-185">一般而言，這些工作負載會耗用大量的資料庫資源因此建議您將指定 hello 的其中一個次要資料庫，與 hello 效能層級相符的 toohello 預期工作負載。</span><span class="sxs-lookup"><span data-stu-id="123a4-185">Typically, these workloads consume significant database resources therefore it is recommended that you designate one of hello secondary databases for them with hello performance level matched toohello anticipated workload.</span></span>
>

## <a name="design-pattern-3-active-passive-deployment-for-data-preservation"></a><span data-ttu-id="123a4-186">設計模式 3：資料保留的主動-被動部署</span><span class="sxs-lookup"><span data-stu-id="123a4-186">Design pattern 3: Active-passive deployment for data preservation</span></span>
<span data-ttu-id="123a4-187">這個選項最適合用於應用程式具有下列特性的 hello:</span><span class="sxs-lookup"><span data-stu-id="123a4-187">This option is best suited for applications with hello following characteristics:</span></span>

* <span data-ttu-id="123a4-188">任何資料遺失都會帶來極高的商業風險。</span><span class="sxs-lookup"><span data-stu-id="123a4-188">Any data loss is high business risk.</span></span> <span data-ttu-id="123a4-189">hello 資料庫容錯移轉只能作為最後的方法如果 hello 中斷為重大。</span><span class="sxs-lookup"><span data-stu-id="123a4-189">hello database failover can only be used as a last resort if hello outage is catastrophic.</span></span>
* <span data-ttu-id="123a4-190">hello 應用程式支援唯讀和讀寫模式的作業，並可以在 「 唯讀模式 」 中運作的一段時間。</span><span class="sxs-lookup"><span data-stu-id="123a4-190">hello application supports read-only and read-write modes of operations and can operate in "read-only mode" for a period of time.</span></span>

<span data-ttu-id="123a4-191">在這種模式 hello 應用程式時 hello 讀寫連接開始取得逾時錯誤切換 tooread 僅限模式。</span><span class="sxs-lookup"><span data-stu-id="123a4-191">In this pattern, hello application switches tooread-only mode when hello read-write connections start getting time-out errors.</span></span> <span data-ttu-id="123a4-192">hello Web 應用程式是部署的 tooboth 區域，包含連接 toohello 讀取寫入接聽程式端點和不同連線 toohello 唯讀接聽程式端點。</span><span class="sxs-lookup"><span data-stu-id="123a4-192">hello Web Application is deployed tooboth regions and include a connection toohello read-write listener endpoint and different connection toohello read-only listener endpoint.</span></span> <span data-ttu-id="123a4-193">hello 流量管理員應該設定 toouse[容錯移轉路由](../traffic-manager/traffic-manager-configure-failover-routing-method.md)與[端點監視](../traffic-manager/traffic-manager-monitoring.md)hello 應用程式端點，每個區域中啟用。</span><span class="sxs-lookup"><span data-stu-id="123a4-193">hello Traffic manager should be set up toouse [failover routing](../traffic-manager/traffic-manager-configure-failover-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for hello application endpoint in each region.</span></span>

<span data-ttu-id="123a4-194">hello 下列圖表說明前中斷此組態。</span><span class="sxs-lookup"><span data-stu-id="123a4-194">hello following diagram illustrates this configuration before an outage.</span></span>

![容錯移轉之前的主動/被動部署。](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-1.png)

<span data-ttu-id="123a4-197">當 hello traffic manager 偵測到的連線失敗 tooregion A 時，它會自動切換使用者流量 toohello 應用程式執行個體在區域 b。此模式中，很重要，您設定 hello 寬限期內使用的資料遺失 tooa 夠高的值，例如 24 小時。</span><span class="sxs-lookup"><span data-stu-id="123a4-197">When hello traffic manager detects a connectivity failure tooregion A, it automatically switches user traffic toohello application instance in region B. With this pattern, it is important that you set hello grace period with data loss tooa sufficiently high value, e.g. 24 hours.</span></span> <span data-ttu-id="123a4-198">它可確保，如果 hello 中斷降低該段時間內，避免資料遺失。</span><span class="sxs-lookup"><span data-stu-id="123a4-198">It will ensure that data loss is prevented if hello outage is mitigated within that time.</span></span> <span data-ttu-id="123a4-199">Hello hello 區域 B 中的 Web 應用程式啟動時 hello 讀取-寫入作業就會開始失敗。</span><span class="sxs-lookup"><span data-stu-id="123a4-199">When hello Web application in hello region B is activated hello read-write operations will start failing.</span></span> <span data-ttu-id="123a4-200">此時，它應該切換 toohello 唯讀模式。</span><span class="sxs-lookup"><span data-stu-id="123a4-200">At that point, it should switch toohello read-only mode.</span></span> <span data-ttu-id="123a4-201">在此模式 hello 要求將會自動路由的 toohello 次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="123a4-201">In this mode hello requests will be automatically routed toohello secondary database.</span></span> <span data-ttu-id="123a4-202">在 hello 案例中的重大錯誤 hello 中斷將不降低 hello 寬限期內，而且 hello 容錯移轉群組將會觸發 hello 容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="123a4-202">In hello case of a catastrophic failure hello outage will not be mitigated within hello grace period and hello failover group will trigger hello failover.</span></span> <span data-ttu-id="123a4-203">該 hello 之後讀取寫入接聽程式會變成可用，而且 hello 呼叫 tooit 將會停止失敗。</span><span class="sxs-lookup"><span data-stu-id="123a4-203">After that hello read-write listener will become available and hello calls tooit will stop failing.</span></span> <span data-ttu-id="123a4-204">Hello 下列圖表說明此用法。</span><span class="sxs-lookup"><span data-stu-id="123a4-204">This is illustrated by hello following diagram.</span></span>

![中斷：處於唯讀模式的應用程式。](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-2.png)

<span data-ttu-id="123a4-207">如果 hello 主要區域中的 hello 中斷降低 hello 寬限期內，traffic manager 會連線 hello 還原偵測 hello 主要區域中，並切換使用者流量後 toohello 應用程式執行個體在區域 a會繼續該應用程式執行個體，並且在區域 a 使用 hello 主要資料庫的讀寫模式中運作</span><span class="sxs-lookup"><span data-stu-id="123a4-207">If hello outage in hello primary region is mitigated within hello grace period, traffic manager detects hello restoration of connectivity in hello primary region and switches user traffic back toohello application instance in region A. That application instance resumes and operates in read-write mode using hello primary database in region A.</span></span>

<span data-ttu-id="123a4-208">發生在 hello 區域 B 發生中斷，hello traffic manager 偵測 hello 失敗 hello 應用程式端點到區域 B 和 hello 容錯移轉群組交換器 hello 唯讀接聽程式 tooregion a。此中斷不會影響 hello 使用者體驗，但 hello 主要資料庫會公開在 hello 中斷期間。</span><span class="sxs-lookup"><span data-stu-id="123a4-208">In case of an outage in hello region B, hello traffic manager detects hello failure of hello application end-point in region B and hello failover group switches hello read-only listener tooregion A. This outage does not impact hello end-user experience but hello primary database will be exposed during hello outage.</span></span> <span data-ttu-id="123a4-209">Hello 下列圖表說明此用法。</span><span class="sxs-lookup"><span data-stu-id="123a4-209">This is illustrated by hello following diagram.</span></span>

![中斷：次要資料庫。](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-3.png)

<span data-ttu-id="123a4-212">一旦降低 hello 中斷，hello 次要資料庫會立即同步處理主要 hello 和 hello 唯讀接聽程式是交換後 toohello 區域 b 中的次要資料庫同步處理期間 hello 主要的效能可能稍微影響視 hello 需要 toobe 同步處理的資料數量而定。</span><span class="sxs-lookup"><span data-stu-id="123a4-212">Once hello outage is mitigated, hello secondary database is immediately synchronized with hello primary and hello read-only listener is switched back toohello secondary database in region B. During synchronization performance of hello primary could be slightly impacted depending on hello amount of data that needs toobe synchronized.</span></span>

<span data-ttu-id="123a4-213">此設計模式有幾個 **優點**：</span><span class="sxs-lookup"><span data-stu-id="123a4-213">This design pattern has several **advantages**:</span></span>

* <span data-ttu-id="123a4-214">它可在 hello 暫時中斷期間避免資料遺失。</span><span class="sxs-lookup"><span data-stu-id="123a4-214">It avoids data loss during hello temporary outages.</span></span>
* <span data-ttu-id="123a4-215">停機時間僅取決於流量管理員偵測 hello 連線失敗，您可設定的速度。</span><span class="sxs-lookup"><span data-stu-id="123a4-215">Downtime depends only on how quickly traffic manager detects hello connectivity failure, which is configurable.</span></span>

<span data-ttu-id="123a4-216">hello**權衡取捨**是：</span><span class="sxs-lookup"><span data-stu-id="123a4-216">hello **tradeoff** is:</span></span>

* <span data-ttu-id="123a4-217">應用程式必須能夠 toooperate 為唯讀模式。</span><span class="sxs-lookup"><span data-stu-id="123a4-217">Application must be able toooperate in read-only mode.</span></span>

> [!NOTE]
> <span data-ttu-id="123a4-218">Hello 區域中的永久性服務中斷，如果您手動啟動資料庫容錯移轉，並接受 hello 資料遺失。</span><span class="sxs-lookup"><span data-stu-id="123a4-218">In case of a permanent service outage in hello region, you manually activate database failover and accept hello data loss.</span></span> <span data-ttu-id="123a4-219">hello 應用程式將能 hello 與讀寫存取 toohello 資料庫的次要區域中作用。</span><span class="sxs-lookup"><span data-stu-id="123a4-219">hello application will be functional in hello secondary region with read-write access toohello database.</span></span>
>

## <a name="business-continuity-planning-choose-an-application-design-for-cloud-disaster-recovery"></a><span data-ttu-id="123a4-220">商務持續性計劃：針對雲端災害復原選擇應用程式設計</span><span class="sxs-lookup"><span data-stu-id="123a4-220">Business continuity planning: Choose an application design for cloud disaster recovery</span></span>
<span data-ttu-id="123a4-221">特定雲端災害復原策略可以合併或 toobest 符合 hello 需求的應用程式擴充這些設計模式。</span><span class="sxs-lookup"><span data-stu-id="123a4-221">Your specific cloud disaster recovery strategy can combine or extend these design patterns toobest meet hello needs of your application.</span></span>  <span data-ttu-id="123a4-222">如先前所述，您所選擇的 hello 策略根據 hello SLA toooffer tooyour 客戶並 hello 應用程式的部署拓撲。</span><span class="sxs-lookup"><span data-stu-id="123a4-222">As mentioned earlier, hello strategy you choose is based on hello SLA you want toooffer tooyour customers and hello application deployment topology.</span></span> <span data-ttu-id="123a4-223">toohelp 引導您決定，hello 下表比較 hello 選擇根據 hello 估計的資料遺失或復原點目標 (RPO) 和預估的復原時間 (ERT)。</span><span class="sxs-lookup"><span data-stu-id="123a4-223">toohelp guide your decision, hello following table compares hello choices based on hello estimated data loss or recovery point objective (RPO) and estimated recovery time (ERT).</span></span>

| <span data-ttu-id="123a4-224">模式</span><span class="sxs-lookup"><span data-stu-id="123a4-224">Pattern</span></span> | <span data-ttu-id="123a4-225">RPO</span><span class="sxs-lookup"><span data-stu-id="123a4-225">RPO</span></span> | <span data-ttu-id="123a4-226">ERT</span><span class="sxs-lookup"><span data-stu-id="123a4-226">ERT</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="123a4-227">災害復原的主動-被動部署，使用共置資料庫存取</span><span class="sxs-lookup"><span data-stu-id="123a4-227">Active-passive deployment for disaster recovery with co-located database access</span></span> |<span data-ttu-id="123a4-228">讀寫存取 < 5 秒</span><span class="sxs-lookup"><span data-stu-id="123a4-228">Read-write access < 5 sec</span></span> |<span data-ttu-id="123a4-229">失敗偵測時間 + DNS TTL</span><span class="sxs-lookup"><span data-stu-id="123a4-229">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="123a4-230">應用程式負載平衡的主動-主動部署</span><span class="sxs-lookup"><span data-stu-id="123a4-230">Active-active deployment for application load balancing</span></span> |<span data-ttu-id="123a4-231">讀寫存取 < 5 秒</span><span class="sxs-lookup"><span data-stu-id="123a4-231">Read-write access < 5 sec</span></span> |<span data-ttu-id="123a4-232">失敗偵測時間 + DNS TTL</span><span class="sxs-lookup"><span data-stu-id="123a4-232">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="123a4-233">資料保留的主動-被動部署</span><span class="sxs-lookup"><span data-stu-id="123a4-233">Active-passive deployment for data preservation</span></span> |<span data-ttu-id="123a4-234">唯讀存取 < 5 秒</span><span class="sxs-lookup"><span data-stu-id="123a4-234">Read-only access < 5 sec</span></span> | <span data-ttu-id="123a4-235">唯讀存取 = 0</span><span class="sxs-lookup"><span data-stu-id="123a4-235">Read-only access = 0</span></span> |
||<span data-ttu-id="123a4-236">讀寫存取 = 0</span><span class="sxs-lookup"><span data-stu-id="123a4-236">Read-write access = zero</span></span> | <span data-ttu-id="123a4-237">讀寫存取 = 失敗偵測時間 + 遺失資料的寬限期</span><span class="sxs-lookup"><span data-stu-id="123a4-237">Read-write access = Failure detection time + grace period with data loss</span></span> |
|||

## <a name="next-steps"></a><span data-ttu-id="123a4-238">後續步驟</span><span class="sxs-lookup"><span data-stu-id="123a4-238">Next steps</span></span>
* <span data-ttu-id="123a4-239">toolearn 有關自動化 Azure SQL Database 備份，請參閱[SQL 資料庫自動備份](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="123a4-239">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="123a4-240">如需商務持續性概觀和案例，請參閱 [商務持續性概觀](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="123a4-240">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="123a4-241">toolearn 有關使用自動的備份進行復原，請參閱[hello 服務起始的備份還原的資料庫](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="123a4-241">toolearn about using automated backups for recovery, see [restore a database from hello service-initiated backups](sql-database-recovery-using-backups.md)</span></span>
* <span data-ttu-id="123a4-242">toolearn 有關更快速的復原選項，請參閱[作用中地理複寫](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="123a4-242">toolearn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md)</span></span>  
* <span data-ttu-id="123a4-243">toolearn 有關用於自動的備份封存，請參閱[資料庫複製](sql-database-copy.md)</span><span class="sxs-lookup"><span data-stu-id="123a4-243">toolearn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span></span>
* <span data-ttu-id="123a4-244">如需主動式異地複寫與彈性集區的相關資訊，請參閱[彈性集區災害復原策略](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md)。</span><span class="sxs-lookup"><span data-stu-id="123a4-244">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
