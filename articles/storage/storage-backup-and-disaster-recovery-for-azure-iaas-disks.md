---
title: "Azure IaaS 磁碟 aaaBackup 和災害復原 |Microsoft 文件"
description: "在本文中，我們將說明如何備份和災害復原 (DR) 的 IaaS 虛擬機器 (Vm) 的 tooplan 和 Azure 中的磁碟。 本文件涵蓋受控磁碟和非受控磁碟"
services: storage
cloud: Azure
documentationcenter: na
author: luywang
manager: kavithag
ms.assetid: 
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: luywang
ms.openlocfilehash: 17c697bc411fb47c4b7483b59829af1c40732ac1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="backup-and-disaster-recovery-for-azure-iaas-disks"></a><span data-ttu-id="4ac2d-104">Azure IaaS 磁碟的備份和災害復原</span><span class="sxs-lookup"><span data-stu-id="4ac2d-104">Backup and disaster recovery for Azure IaaS disks</span></span>

<span data-ttu-id="4ac2d-105">在本文中，我們將說明如何備份和災害復原 (DR) 的 IaaS 虛擬機器 (Vm) 的 tooplan 和 Azure 中的磁碟。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-105">In this article, we will explain how tooplan for Backup and Disaster Recovery (DR) of IaaS virtual machines (VMs) and Disks in Azure.</span></span> <span data-ttu-id="4ac2d-106">本文件涵蓋受控磁碟和非受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-106">This document covers both Managed and Unmanaged Disks.</span></span>

<span data-ttu-id="4ac2d-107">我們會先討論 hello 內建容錯功能在 hello Azure 平台，協助防範本機失敗。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-107">We’ll first talk about hello built-in fault tolerance capabilities in hello Azure platform which help guard against local failures.</span></span> <span data-ttu-id="4ac2d-108">然後，我們將討論未完全涵蓋 hello 內建功能，這是此文件所定址的 hello 主要主題 hello 災害案例。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-108">We’ll then discuss hello disaster scenarios not fully covered by hello built-in capabilities, which is hello main topic addressed by this document.</span></span> <span data-ttu-id="4ac2d-109">我們也將示範幾個工作負載案例範例，其中可能會有不同的備份和 DR 考量。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-109">We’ll also show several examples of workload scenarios where different Backup and DR considerations may apply.</span></span> <span data-ttu-id="4ac2d-110">接著會檢閱 IaaS 磁碟的可能 DR 解決方案。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-110">We’ll then review possible solutions for DR of IaaS Disks.</span></span> 

## <a name="introduction"></a><span data-ttu-id="4ac2d-111">簡介</span><span class="sxs-lookup"><span data-stu-id="4ac2d-111">Introduction</span></span>

<span data-ttu-id="4ac2d-112">hello Azure 平台會使用各種方法以獲得備援與錯誤容錯 toohelp 保護客戶從硬體失敗，可能會發生。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-112">hello Azure platform uses various methods for redundancy and fault tolerance toohelp protect customers from localized hardware failures that can occur.</span></span> <span data-ttu-id="4ac2d-113">本機失敗可能包括將虛擬磁碟的 hello 資料的一部分或失敗的 SSD 或 HDD 儲存在該伺服器的 Azure 儲存體伺服器電腦的問題。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-113">Local failures may include problems with an Azure storage server machine that stores part of hello data for a virtual disk or failures of an SSD or HDD on that server.</span></span> <span data-ttu-id="4ac2d-114">這種隔離的硬體元件故障可能發生在正常作業期間，並且 hello 平台是設計的 toobe 彈性 toothese 失敗。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-114">Such isolated hardware component failures can happen during normal operations and hello platform is designed toobe resilient toothese failures.</span></span> <span data-ttu-id="4ac2d-115">重大災害可能會導致大量儲存體伺服器或整個資料中心失敗或無法存取。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-115">Major disasters can result in failures or inaccessibility of a large numbers of storage servers or a whole datacenter.</span></span> <span data-ttu-id="4ac2d-116">當您的 Vm 和磁碟，正常保護從當地語系化失敗時，額外的步驟是必要的 tooprotect 區域全災難性失敗 （例如重大的災害） 可能會影響您的 VM 和磁碟從您的工作負載。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-116">While your VMs and disks are normally protected from localized failures, additional steps are necessary tooprotect your workload from region-wide catastrophic failures (such as a major disaster) that can affect your VM and disks.</span></span>

<span data-ttu-id="4ac2d-117">此外 toohello 的平台失敗的可能性，與 hello 客戶應用程式或資料發生問題。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-117">In addition toohello possibility of platform failures, problems with hello customer application or data can occur.</span></span> <span data-ttu-id="4ac2d-118">比方說，您的應用程式的新版本可能會不小心讓中斷變更 toohello 資料。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-118">For example, a new version of your application may inadvertently make a breaking change toohello data.</span></span> <span data-ttu-id="4ac2d-119">在此情況下，您可能想 toorevert hello 應用程式和 hello 資料 tooa 先前的版本包含 hello 最後一個已知的良好狀態。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-119">In that case, you may want toorevert hello application and hello data tooa prior version containing hello last known good state.</span></span> <span data-ttu-id="4ac2d-120">這需要維護定期備份。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-120">This requires maintaining regular backups.</span></span>

<span data-ttu-id="4ac2d-121">地區的災害復原，您必須備份您 IaaS VM 磁碟 tooa 不同的區域。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-121">For regional disaster recovery, you must backup your IaaS VM disks tooa different region.</span></span> 

<span data-ttu-id="4ac2d-122">讓我們先回顧可用來處理當地語系化失敗的一些方法，再檢視備份和 DR 選項。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-122">Before we look at Backup and DR options, let’s recap a few methods available for handling localized failures.</span></span>

### <a name="azure-iaas-resiliency"></a><span data-ttu-id="4ac2d-123">Azure IaaS 復原</span><span class="sxs-lookup"><span data-stu-id="4ac2d-123">Azure IaaS Resiliency</span></span>

<span data-ttu-id="4ac2d-124">*恢復功能*參考 toohello 容錯硬體元件中發生一般失敗。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-124">*Resiliency* refers toohello tolerance for normal failures that occur in hardware components.</span></span> <span data-ttu-id="4ac2d-125">恢復功能是從失敗的 hello 能力 toorecover 和繼續 toofunction。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-125">Resiliency is hello ability toorecover from failures and continue toofunction.</span></span> <span data-ttu-id="4ac2d-126">它不是如何避免失敗，但回應 toofailures 可避免停機時間或資料遺失的方式。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-126">It's not about avoiding failures, but responding toofailures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="4ac2d-127">hello 的恢復功能的目標是 tooreturn hello 應用程式 tooa 完全正常運作狀態發生失敗。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-127">hello goal of resiliency is tooreturn hello application tooa fully functioning state following a failure.</span></span> <span data-ttu-id="4ac2d-128">Azure 虛擬機器和磁碟屬於設計的 toobe 彈性 toocommon 硬體錯誤。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-128">Azure Virtual Machines and Disks are designed toobe resilient toocommon hardware faults.</span></span> <span data-ttu-id="4ac2d-129">讓我們看看如何 hello Azure IaaS 平台提供此恢復功能。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-129">Let us look at how hello Azure IaaS platform provides this resiliency.</span></span>

<span data-ttu-id="4ac2d-130">虛擬機器主要在於兩個部分: （1） 的計算伺服器，以及 （2) hello 永續性磁碟。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-130">A virtual machine consists mainly of two parts: (1) A compute server, and (2) hello persistent disks.</span></span> <span data-ttu-id="4ac2d-131">同時會影響虛擬機器的 hello 容錯功能。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-131">Both affect hello fault tolerance of a virtual machine.</span></span>

<span data-ttu-id="4ac2d-132">如果裝載 VM 的 hello Azure 計算主機伺服器遇到硬體失敗 （此為罕見），Azure 會是另一部伺服器上的設計的 tooautomatically 還原 hello VM。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-132">If hello Azure compute host server that houses your VM experiences a hardware failure (which is rare), Azure is designed tooautomatically restore hello VM on another server.</span></span> <span data-ttu-id="4ac2d-133">如果發生這種情況，就會發生重新開機，並 hello VM 一段時間後，將會備份。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-133">If this happens, you will experience a reboot, and hello VM will be back up after some time.</span></span> <span data-ttu-id="4ac2d-134">Azure 會自動偵測這種硬體故障並執行復原 toohelp 確保 hello 客戶 VM 儘速將可以使用。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-134">Azure automatically detects such hardware failures and executes recoveries toohelp ensure hello customer VM will be available as soon as possible.</span></span>

<span data-ttu-id="4ac2d-135">之 IaaS 磁碟的相關資料持續性相當重要 hello 永續性儲存體的平台。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-135">Regarding IaaS disks, durability of data is critical for hello persistent storage platform.</span></span> <span data-ttu-id="4ac2d-136">Azure 客戶有 IaaS 上執行的重要的商務應用程式，而且它們相依於 hello hello 資料持續性。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-136">Azure customers have important business applications running on IaaS and they depend on hello persistence of hello data.</span></span> <span data-ttu-id="4ac2d-137">Azure 設計這些 IaaS 磁碟保護的方式是在本機儲存三份資料的備援複本，並提供高持久性以防範本機失敗。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-137">Azure designs protection for these IaaS disks with three redundant copies of data stored locally, providing high durability against local failures.</span></span> <span data-ttu-id="4ac2d-138">如果其中一個 hello 保存您的磁碟的硬體元件失敗，因為有兩個額外複本 toosupport 磁碟要求，就不受影響您的 VM。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-138">If one of hello hardware components that holds your disk fails, your VM is not impacted because there are two additional copies toosupport disk requests.</span></span> <span data-ttu-id="4ac2d-139">即使兩個不同的硬體元件支援的磁碟在失敗 hello 相同可以正常運作 （這會是非常罕見） 的時間。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-139">It works fine even if two different hardware components supporting a disk fail at hello same time (which would be very rare).</span></span> <span data-ttu-id="4ac2d-140">toohelp 確保我們永遠維護三份複本，hello Azure 儲存體服務會自動產生 hello 背景中資料的新副本，如果其中一個 hello 三個複本變成無法使用。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-140">toohelp ensure we always maintain three replicas, hello Azure Storage service automatically spawns a new copy of data in hello background if one of hello three copies becomes unavailable.</span></span> <span data-ttu-id="4ac2d-141">因此，它不能與 Azure 磁碟的容錯功能的必要 toouse RAID。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-141">Therefore, it should not be necessary toouse RAID with Azure disks for fault tolerance.</span></span> <span data-ttu-id="4ac2d-142">簡單的 RAID 0 設定應該足以應付如果等量磁碟 hello 必要 toocreate 較大的磁碟區。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-142">A simple RAID 0 configuration should be sufficient for striping hello disks if necessary toocreate larger volumes.</span></span>

<span data-ttu-id="4ac2d-143">由於此結構，**Azure 為 IaaS 磁碟一致地提供企業級持久性，其[年度失敗率](https://en.wikipedia.org/wiki/Annualized_failure_rate)為零，領先業界。**</span><span class="sxs-lookup"><span data-stu-id="4ac2d-143">Because of this architecture, **Azure has consistently delivered enterprise-grade durability for IaaS disks, with an industry-leading ZERO % [Annualized Failure Rate](https://en.wikipedia.org/wiki/Annualized_failure_rate).**</span></span>

<span data-ttu-id="4ac2d-144">硬體故障 hello 上的計算裝載或 hello 儲存體中的平台有時可能會導致暫時無法使用的 vm hello 所涵蓋的 hello [Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) VM 可用性。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-144">Localized hardware faults on hello compute host or in hello storage platform can sometimes result in temporary unavailability for hello VM which is covered by hello [Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) for VM Availability.</span></span> <span data-ttu-id="4ac2d-145">Azure 也提供領先業界的 SLA，適用於使用進階儲存體磁碟的單一 VM 執行個體。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-145">Azure also provides an industry-leading SLA for single VM instances that use Premium Storage disks.</span></span>

<span data-ttu-id="4ac2d-146">toosafeguard 停機 toohello 暫時無法使用磁碟或 VM 的應用程式工作負載，客戶可以利用[可用性設定組](../virtual-machines/windows/manage-availability.md)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-146">toosafeguard application workloads from downtime due toohello temporary unavailability of a disk or VM, customers can leverage [Availability Sets](../virtual-machines/windows/manage-availability.md).</span></span> <span data-ttu-id="4ac2d-147">可用性設定組中的兩個或多個虛擬機器提供 hello 應用程式的備援性。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-147">Two or more virtual machines in an availability set provides redundancy for hello application.</span></span> <span data-ttu-id="4ac2d-148">Azure 會接著在具有不同電源、網路和伺服器元件的個別容錯網域中，建立這些 VM 和磁碟。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-148">Azure then creates these VMs and disks in separate fault domains with different power, network, and server components.</span></span> <span data-ttu-id="4ac2d-149">因此，當地語系化的硬體失敗通常不會影響在 hello hello 在設定中的多個 Vm 同時，為您的應用程式提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-149">Thus, localized hardware failures typically do not affect multiple VMs in hello set at hello same time, providing high availability for your application.</span></span> <span data-ttu-id="4ac2d-150">它會被視為好的作法 toouse 可用性設定組需要高可用性時。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-150">It is considered a good practice toouse availability sets when high availability is required.</span></span> <span data-ttu-id="4ac2d-151">如需詳細資訊，請參閱詳述如下的 hello 嚴重損壞修復層面。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-151">For more information, see hello Disaster Recovery aspects detailed below.</span></span>

### <a name="backup-and-disaster-recovery"></a><span data-ttu-id="4ac2d-152">備份和災害復原</span><span class="sxs-lookup"><span data-stu-id="4ac2d-152">Backup and Disaster Recovery</span></span>

<span data-ttu-id="4ac2d-153">災害復原 (DR) 是從少見，但主要事件的 hello 能力 toorecover： 非暫時性、 寬位小數位數的失敗，例如會影響整個地區的服務中斷。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-153">Disaster recovery (DR) is hello ability toorecover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="4ac2d-154">災害復原包括資料備份和封存，而且可能包括手動操作，例如從備份中還原資料庫。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-154">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="4ac2d-155">hello Azure 平台的內建保護當地語系化故障可能無法完全保護 hello Vm/磁碟在 hello 的重大的災害而造成大型中斷的情況下。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-155">hello Azure platform’s built-in protection against localized failures may not fully protect hello VMs/disks in hello case of major disasters which can cause large-scale outages.</span></span> <span data-ttu-id="4ac2d-156">這包括資料中心遇到颶風、地震、火災，或大規模硬體裝置失敗等重大事件。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-156">This includes catastrophic events such as a data center being hit by a hurricane, earthquake, fire, or large scale hardware unit failures.</span></span> <span data-ttu-id="4ac2d-157">此外，您可能會失敗，因為 tooapplication 或資料的問題。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-157">In addition, you may encounter failures due tooapplication or data issues.</span></span>

<span data-ttu-id="4ac2d-158">toohelp 保護您的 IaaS 工作負載從中斷，您應該規劃備援性和備份 tooenable 復原。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-158">toohelp protect your IaaS workloads from outages, you should plan for redundancy and backups tooenable recovery.</span></span> <span data-ttu-id="4ac2d-159">災害復原，您應該規劃備援及在遠離 hello 主要站台不同的地理位置的備份。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-159">For disaster recovery, you should plan redundancy and backup in a different geographic location away from hello primary site.</span></span> <span data-ttu-id="4ac2d-160">這有助於確保您的備份不會受到 hello 原本影響 hello VM 或磁碟的相同事件。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-160">This helps ensure your backup is not affected by hello same event that originally impacted hello VM or disks.</span></span> <span data-ttu-id="4ac2d-161">如需詳細資訊，請參閱 [Disaster recovery for Azure applications](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications) (Azure 應用程式的災害復原)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-161">For more information, see [Disaster Recovery for Applications built on Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span></span>

<span data-ttu-id="4ac2d-162">您的 DR 考量可能包括下列方面的 hello:</span><span class="sxs-lookup"><span data-stu-id="4ac2d-162">Your DR considerations may include hello following aspects:</span></span>

1. <span data-ttu-id="4ac2d-163">高可用性 (HA) 是執行不需顯著停機的狀況良好的 hello 應用程式 toocontinue hello 能力。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-163">High Availability (HA) is hello ability of hello application toocontinue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="4ac2d-164">「 狀況良好的狀態 」 是指 hello 應用程式有回應，，和使用者可以連接 toohello 應用程式，並與其互動。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-164">By "healthy state," we mean hello application is responsive, and users can connect toohello application and interact with it.</span></span> <span data-ttu-id="4ac2d-165">特定的關鍵任務應用程式和資料庫可能需要的 toobe 可用一律，即使在 hello 平台也會失敗。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-165">Certain mission-critical applications and databases may be required toobe available always, even when there are failures in hello platform.</span></span> <span data-ttu-id="4ac2d-166">這些工作負載，您可能需要 tooplan hello 應用程式，以及 hello 資料的複本。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-166">For these workloads, you may need tooplan redundancy for hello application as well as hello data.</span></span>

2. <span data-ttu-id="4ac2d-167">資料持久性： 在某些情況下，hello 主要考量確定 hello 資料會保留在嚴重損壞的 hello 案例。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-167">Data Durability: In some cases, hello main consideration is ensuring hello data is preserved in hello case of a disaster.</span></span> <span data-ttu-id="4ac2d-168">因此，您可能需要在不同的網站上有資料備份。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-168">Therefore, you may need a backup of your data in a different site.</span></span> <span data-ttu-id="4ac2d-169">針對這類工作負載，您可能不需要完整的備援性 hello 應用程式，但 hello 磁碟的定期備份。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-169">For such workloads, you may not need full redundancy for hello application, but a regular backup of hello disks.</span></span>

## <a name="backup-and-dr-scenarios"></a><span data-ttu-id="4ac2d-170">備份和 DR 案例</span><span class="sxs-lookup"><span data-stu-id="4ac2d-170">Backup and DR Scenarios</span></span>

<span data-ttu-id="4ac2d-171">讓我們看看應用程式工作負載案例和規劃災害復原的 hello 考量的一些典型的例子。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-171">Let’s look at a few typical examples of application workload scenarios and hello considerations for planning Disaster Recovery.</span></span>

### <a name="scenario-1-major-database-solutions"></a><span data-ttu-id="4ac2d-172">案例 1：主要資料庫解決方案</span><span class="sxs-lookup"><span data-stu-id="4ac2d-172">Scenario 1: Major Database Solutions</span></span>

<span data-ttu-id="4ac2d-173">假設有一個可支援高可用性的生產環境資料庫伺服器，例如 SQL Server 或 Oracle。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-173">Consider a production database server like SQL Server or Oracle that can support High Availability.</span></span> <span data-ttu-id="4ac2d-174">重要的生產環境應用程式和使用者都相依於此資料庫。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-174">Critical production applications and users depend on this database.</span></span> <span data-ttu-id="4ac2d-175">此系統的 hello 災害復原計劃可能會需要 toosupport hello 下列需求：</span><span class="sxs-lookup"><span data-stu-id="4ac2d-175">hello Disaster Recovery plan for this system may need toosupport hello following requirements:</span></span>

1. <span data-ttu-id="4ac2d-176">資料必須是受保護且可復原的。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-176">Data must be protected and recoverable.</span></span>
2.  <span data-ttu-id="4ac2d-177">伺服器必須可供使用。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-177">Server must be available for use.</span></span>

<span data-ttu-id="4ac2d-178">這可能需要維護不同的區域，以當作備份中的 hello 資料庫的複本。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-178">This may require maintaining a replica of hello database in a different region as a backup.</span></span> <span data-ttu-id="4ac2d-179">根據伺服器的可用性和資料修復的 hello 需求，hello 方案可能涉及主動-主動或主動-被動複本網站 tooperiodic 的離線備份 hello 資料。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-179">Depending on hello requirements for server availability and data recovery, hello solution could range from an Active-Active or Active-Passive replica site tooperiodic offline backups of hello data.</span></span> <span data-ttu-id="4ac2d-180">SQL Server 和 Oracle 等關聯式資料庫提供各種複寫選項。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-180">Relational databases such as SQL Server and Oracle provide various options for replication.</span></span> <span data-ttu-id="4ac2d-181">若是 SQL Server，可使用 [SQL Server Always On 可用性群組](https://msdn.microsoft.com/library/hh510230.aspx)來取得高可用性。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-181">For SQL Server, [SQL Server Always On Availability Groups](https://msdn.microsoft.com/library/hh510230.aspx) can be used for high availability.</span></span>

<span data-ttu-id="4ac2d-182">MongoDB 之類的 NoSQL 資料庫也支援以[複本](https://docs.mongodb.com/manual/replication/)進行備援。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-182">NoSQL databases like MongoDB also support [replicas](https://docs.mongodb.com/manual/replication/) for redundancy.</span></span> <span data-ttu-id="4ac2d-183">可以使用 hello 複本以提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-183">hello replicas for high availability can be used.</span></span>

### <a name="scenario-2-a-cluster-of-redundant-vms"></a><span data-ttu-id="4ac2d-184">案例 2：備援 VM 的叢集</span><span class="sxs-lookup"><span data-stu-id="4ac2d-184">Scenario 2: A cluster of redundant VMs</span></span>

<span data-ttu-id="4ac2d-185">假設有一個由 VM 的叢集所處理的工作負載提供備援和負載平衡。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-185">Consider a workload handled by a cluster of VMs that provide redundancy and load balancing.</span></span> <span data-ttu-id="4ac2d-186">其中一個範例是區域中所部署的 Cassandra 叢集。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-186">One example would be a Cassandra cluster deployed in a region.</span></span> <span data-ttu-id="4ac2d-187">此架構類型已在該區域內提供高層級的備援。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-187">This type of architecture already provides a high level of redundancy within that region.</span></span> <span data-ttu-id="4ac2d-188">不過，從區域的層級失敗 tooprotect hello 工作負載，您應該考慮分配 hello 叢集跨兩個區域或進行定期備份 tooanother 區域。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-188">However, tooprotect hello workload from a regional level failure, you should consider spreading hello cluster across two regions or making periodic backups tooanother region.</span></span>

### <a name="scenario-3-iaas-application-workload"></a><span data-ttu-id="4ac2d-189">案例 3：IaaS 應用程式工作負載</span><span class="sxs-lookup"><span data-stu-id="4ac2d-189">Scenario 3: IaaS Application Workload</span></span>

<span data-ttu-id="4ac2d-190">這可能是在 Azure VM 上執行的一般生產環境工作負載。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-190">This could be a typical production workload running on an Azure VM.</span></span> <span data-ttu-id="4ac2d-191">例如，它可能是 web 伺服器或檔案伺服器 hello 內容與站台的其他資源。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-191">For example, it could be a web server or file server holding hello content and other resources of a site.</span></span> <span data-ttu-id="4ac2d-192">它也可能是 hello VM 磁碟儲存其資料、 資源和應用程式狀態在 VM 上執行自訂商務應用程式。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-192">It could also be a custom-built business application running on a VM that stored its data, resources, and application state on hello VM disks.</span></span> <span data-ttu-id="4ac2d-193">在此情況下，很重要 toomake 確定您定期進行備份。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-193">In this case, it is important toomake sure you take backups on a regular basis.</span></span> <span data-ttu-id="4ac2d-194">備份頻率應根據 hello hello VM 工作負載的本質。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-194">Backup frequency should be based on hello nature of hello VM workload.</span></span> <span data-ttu-id="4ac2d-195">比方說，如果 hello 應用程式每天執行，而且會修改的資料，然後 hello 應該進行備份的每個小時。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-195">For example, if hello application runs every day and modifies data, then hello backup should be taken every hour.</span></span>

<span data-ttu-id="4ac2d-196">另一個範例是，報表伺服器從其他來源提取資料並產生彙總報表。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-196">Another example is a reporting server that pull data from other sources and generates aggregated reports.</span></span> <span data-ttu-id="4ac2d-197">此 VM 或磁碟遺失的問題會導致 toohello 遺失 hello 報表。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-197">Loss of this VM or disks will lead toohello loss of hello reports.</span></span> <span data-ttu-id="4ac2d-198">不過，它可能會報告處理程序，並重新產生 hello 輸出可能 toorerun hello。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-198">However, it may be possible toorerun hello reporting process and regenerate hello output.</span></span> <span data-ttu-id="4ac2d-199">在此情況下，您實際上不需要資料遺失，即使 hello 報表伺服器叫用時與損毀，因此您可能會有較高等級的容許的遺失 hello hello 報表伺服器上的資料的一部分。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-199">In that case, you don’t really have a loss of data even if hello reporting server is hit with a disaster, so you could have a higher level of tolerance for losing part of hello data on hello reporting server.</span></span> <span data-ttu-id="4ac2d-200">在此情況下，較不頻繁的備份是選項 tooreduce hello 成本。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-200">In that case, less frequent backups is an option tooreduce hello cost.</span></span>

### <a name="scenario-4-iaas-application-data-issues"></a><span data-ttu-id="4ac2d-201">案例 4：IaaS 應用程式資料問題</span><span class="sxs-lookup"><span data-stu-id="4ac2d-201">Scenario 4: IaaS Application data issues</span></span>

<span data-ttu-id="4ac2d-202">您有一個應用程式，可計算、維護及提供重要商用資料，例如價格資訊。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-202">You have an application that computes, maintains, and serves critical commercial data such as pricing information.</span></span> <span data-ttu-id="4ac2d-203">您的應用程式的新版本有軟體錯誤，錯誤地計算 hello 定價，而損毀的 hello hello 平台所提供現有商務資料。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-203">A new version of your application had a software bug which incorrectly computed hello pricing and corrupted hello existing commerce data served by hello platform.</span></span> <span data-ttu-id="4ac2d-204">在這裡，hello 最好的做法就是 toorevert toohello 舊版 hello 應用程式和 hello 資料第一次。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-204">Here, hello best course of action would be toorevert toohello earlier version of hello application and hello data first.</span></span> <span data-ttu-id="4ac2d-205">tooenable，採取定期備份您的系統。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-205">tooenable this, take periodic backups of your system.</span></span>

## <a name="disaster-recovery-solution-azure-backup-service"></a><span data-ttu-id="4ac2d-206">災害復原解決方案：Azure 備份服務</span><span class="sxs-lookup"><span data-stu-id="4ac2d-206">Disaster Recovery Solution: Azure Backup Service</span></span>

<span data-ttu-id="4ac2d-207">[Azure 備份服務](https://azure.microsoft.com/services/backup/)可用來進行備份和 DR，並適用於[受控磁碟](storage-managed-disks-overview.md)和[非受控磁碟](storage-about-disks-and-vhds-windows.md#unmanaged-disks)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-207">[Azure Backup Service](https://azure.microsoft.com/services/backup/) is can be used for Backup and DR, and it works with [Managed Disks](storage-managed-disks-overview.md) as well as [Unmanaged Disks](storage-about-disks-and-vhds-windows.md#unmanaged-disks).</span></span> <span data-ttu-id="4ac2d-208">您可以建立具有以時間為基礎的備份、簡易 VM 還原，以及備份保留原則的備份工作。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-208">You can create a backup job with time-based backups, easy VM restoration and backup retention policies.</span></span> 

<span data-ttu-id="4ac2d-209">如果您使用[Premium 儲存體磁碟](storage-premium-storage.md)，[管理磁碟](storage-managed-disks-overview.md)，或其他磁碟類型，以 hello[本機備援儲存體 (LRS)](storage-redundancy.md#locally-redundant-storage)選項時，它是特別重要 tooleverage定期的 DR 備份。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-209">If you use [Premium Storage disks](storage-premium-storage.md), [Managed Disks](storage-managed-disks-overview.md), or other disk types with hello [locally redundant storage (LRS)](storage-redundancy.md#locally-redundant-storage) option, it is especially important tooleverage periodic DR backups.</span></span> <span data-ttu-id="4ac2d-210">Azure 備份以供長期保存您復原服務保存庫儲存 hello 資料。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-210">Azure Backup stores hello data in your Recovery Services vault for long term retention.</span></span> <span data-ttu-id="4ac2d-211">選擇 hello[地理備援儲存體 (GRS)](storage-redundancy.md#geo-redundant-storage)選項 hello 備份復原服務保存庫。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-211">Choose hello [Geo-redundant storage (GRS)](storage-redundancy.md#geo-redundant-storage) option for hello Backup Recovery Services vault.</span></span> <span data-ttu-id="4ac2d-212">如此可確保備份是避免複寫的 tooa 不同 Azure 區域從地區的災害防護。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-212">That will ensure backups are replicated tooa different Azure region for safeguarding from regional disasters.</span></span>

<span data-ttu-id="4ac2d-213">如[Unmanaged 磁碟](storage-about-disks-and-vhds-windows.md#unmanaged-disks)，您可以使用 IaaS 磁碟 hello LRS 儲存體類型，但確定已啟用 Azure Backup 以 hello GRS hello 復原服務保存庫的選項。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-213">For [Unmanaged Disks](storage-about-disks-and-vhds-windows.md#unmanaged-disks), you can use hello LRS storage type for IaaS disks, but ensure that Azure Backup is enabled with hello GRS option for hello Recovery Services Vault.</span></span>

<span data-ttu-id="4ac2d-214">**如果您使用 hello [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage)選項為未受管理磁碟，您仍需要一致的快照集備份和 DR 能力。**</span><span class="sxs-lookup"><span data-stu-id="4ac2d-214">**If you use hello [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) option for your Unmanaged Disks, you still need consistent snapshots for Backup and DR.**</span></span> <span data-ttu-id="4ac2d-215">您必須使用 [Azure 備份服務](https://azure.microsoft.com/services/backup/)或[一致性快照](#alternative-solution-consistent-snapshots)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-215">You must use either [Azure Backup Service](https://azure.microsoft.com/services/backup/) or [consistent snapshots](#alternative-solution-consistent-snapshots).</span></span>

<span data-ttu-id="4ac2d-216">hello 以下是 dr 解決方案的摘要。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-216">hello following is a summary of solutions for DR.</span></span>

| <span data-ttu-id="4ac2d-217">案例</span><span class="sxs-lookup"><span data-stu-id="4ac2d-217">Scenario</span></span> | <span data-ttu-id="4ac2d-218">自動複寫</span><span class="sxs-lookup"><span data-stu-id="4ac2d-218">Automatic Replication</span></span> | <span data-ttu-id="4ac2d-219">DR 解決方案</span><span class="sxs-lookup"><span data-stu-id="4ac2d-219">DR Solution</span></span> |
| --- | --- | --- |
| <span data-ttu-id="4ac2d-220">進階儲存體磁碟</span><span class="sxs-lookup"><span data-stu-id="4ac2d-220">*Premium Storage Disks*</span></span> | <span data-ttu-id="4ac2d-221">本地 ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="4ac2d-221">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="4ac2d-222">Azure 備份</span><span class="sxs-lookup"><span data-stu-id="4ac2d-222">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="4ac2d-223">*受控磁碟*</span><span class="sxs-lookup"><span data-stu-id="4ac2d-223">*Managed Disks*</span></span> | <span data-ttu-id="4ac2d-224">本地 ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="4ac2d-224">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="4ac2d-225">Azure 備份</span><span class="sxs-lookup"><span data-stu-id="4ac2d-225">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="4ac2d-226">非受控 LRS 磁碟</span><span class="sxs-lookup"><span data-stu-id="4ac2d-226">*Unmanaged LRS Disks*</span></span> | <span data-ttu-id="4ac2d-227">本地 ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="4ac2d-227">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="4ac2d-228">Azure 備份</span><span class="sxs-lookup"><span data-stu-id="4ac2d-228">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="4ac2d-229">非受控 GRS 磁碟</span><span class="sxs-lookup"><span data-stu-id="4ac2d-229">*Unmanaged GRS Disks*</span></span> | <span data-ttu-id="4ac2d-230">跨區域 ([GRS](storage-redundancy.md#geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="4ac2d-230">Cross region ([GRS](storage-redundancy.md#geo-redundant-storage))</span></span> | [<span data-ttu-id="4ac2d-231">Azure 備份</span><span class="sxs-lookup"><span data-stu-id="4ac2d-231">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="4ac2d-232">一致性快照</span><span class="sxs-lookup"><span data-stu-id="4ac2d-232">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |
| <span data-ttu-id="4ac2d-233">非受控 RA-GRS 磁碟</span><span class="sxs-lookup"><span data-stu-id="4ac2d-233">*Unmanaged RA-GRS Disks*</span></span> | <span data-ttu-id="4ac2d-234">跨區域 ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="4ac2d-234">Cross region ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span></span> | [<span data-ttu-id="4ac2d-235">Azure 備份</span><span class="sxs-lookup"><span data-stu-id="4ac2d-235">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="4ac2d-236">一致性快照</span><span class="sxs-lookup"><span data-stu-id="4ac2d-236">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |

<span data-ttu-id="4ac2d-237">最高可用性可以藉由符合透過 hello 使用受管理磁碟及 Azure Backup 可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-237">High availability can best by met through hello use of Managed Disks in an Availability Set along with Azure Backup.</span></span> <span data-ttu-id="4ac2d-238">如果您使用非受控磁碟，您仍然可以使用 Azure 備份進行 DR。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-238">If you are using Unmanaged Disks, you can still  use Azure Backup for DR.</span></span> <span data-ttu-id="4ac2d-239">如果您無法 toouse Azure 備份，然後採取[一致的快照集](#alternative-solution-consistent-snapshots)後面的章節中所述是備份和 DR 的替代方案。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-239">If you are unable toouse Azure Backup, then taking [consistent snapshots](#alternative-solution-consistent-snapshots) as described in a later section is an alternative solution for Backup and DR.</span></span>

<span data-ttu-id="4ac2d-240">應用程式或基礎結構層級的高可用性、備份和 DR 選項如下所示：</span><span class="sxs-lookup"><span data-stu-id="4ac2d-240">Your choices for high availability, backup and DR at Application or Infrastructure levels can be represented as below:</span></span>

| <span data-ttu-id="4ac2d-241">*Level*</span><span class="sxs-lookup"><span data-stu-id="4ac2d-241">*Level*</span></span> | <span data-ttu-id="4ac2d-242">高可用性</span><span class="sxs-lookup"><span data-stu-id="4ac2d-242">High Availability</span></span>   | <span data-ttu-id="4ac2d-243">備份/DR</span><span class="sxs-lookup"><span data-stu-id="4ac2d-243">Backup / DR</span></span> |
| --- | --- | --- |
| <span data-ttu-id="4ac2d-244">*應用程式*</span><span class="sxs-lookup"><span data-stu-id="4ac2d-244">*Application*</span></span> | <span data-ttu-id="4ac2d-245">SQL Always On</span><span class="sxs-lookup"><span data-stu-id="4ac2d-245">SQL Always On</span></span> | <span data-ttu-id="4ac2d-246">Azure 備份</span><span class="sxs-lookup"><span data-stu-id="4ac2d-246">Azure Backup</span></span> |
| <span data-ttu-id="4ac2d-247">基礎結構</span><span class="sxs-lookup"><span data-stu-id="4ac2d-247">*Infrastructure*</span></span>  | <span data-ttu-id="4ac2d-248">可用性設定組</span><span class="sxs-lookup"><span data-stu-id="4ac2d-248">Availability Set</span></span>  | <span data-ttu-id="4ac2d-249">使用一致性快照的 GRS</span><span class="sxs-lookup"><span data-stu-id="4ac2d-249">GRS with consistent snapshots</span></span> |

### <a name="using-hello-azure-backup-service"></a><span data-ttu-id="4ac2d-250">使用 hello Azure 備份服務</span><span class="sxs-lookup"><span data-stu-id="4ac2d-250">Using hello Azure Backup Service</span></span>

<span data-ttu-id="4ac2d-251">[Azure 備份](../backup/backup-azure-vms-introduction.md)可以備份您的 Vm 執行 Windows 或 Linux toohello Azure 復原服務保存庫。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-251">[Azure Backup](../backup/backup-azure-vms-introduction.md) can backup your VMs running Windows or Linux toohello Azure Recovery Services Vault.</span></span> <span data-ttu-id="4ac2d-252">備份和還原業務關鍵資料更為複雜業務關鍵資料必須備份時產生的 hello 執行資料的 hello 應用程式的 hello 事實。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-252">Backing up and restoring business-critical data is complicated by hello fact that business-critical data must be backed up while hello applications that produce hello data are running.</span></span> <span data-ttu-id="4ac2d-253">tooaddress，Azure 備份提供的 Microsoft 工作負載所使用的資料已正確寫入 toostorage hello 磁碟區陰影服務 (VSS) tooensure 應用程式一致的備份。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-253">tooaddress this, Azure Backup provides application-consistent backups for Microsoft workloads by using hello Volume Shadow Service (VSS) tooensure that data is written correctly toostorage.</span></span> <span data-ttu-id="4ac2d-254">適用於 Linux Vm 檔案一致的備份是可行的因為 Linux 沒有功能相等 tooVSS。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-254">For Linux VMs, only file-consistent backups are possible, since Linux does not have functionality equivalent tooVSS.</span></span>

![][1]

<span data-ttu-id="4ac2d-255">當 Azure Backup 在 hello 排定時間起始備份工作時，它就會觸發 hello 備份延伸模組安裝在 hello VM tootake 時間點快照集。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-255">When Azure Backup initiates a backup job at hello scheduled time, it triggers hello backup extension installed in hello VM tootake a point-in-time snapshot.</span></span> <span data-ttu-id="4ac2d-256">在擷取快照當時搭配 hello 虛擬機器中的 hello 磁碟 VSS tooget 一致的快照集而不需要 tooshut 它關閉。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-256">A snapshot is taken in coordination with VSS tooget a consistent snapshot of hello disks in hello virtual machine without having tooshut it down.</span></span> <span data-ttu-id="4ac2d-257">hello VM 中的 hello 備份擴充功能排清所有寫入之前取得的所有 hello 磁碟 hello 一致的快照集。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-257">hello backup extension in hello VM flushes all writes before taking hello consistent snapshot of all hello disks.</span></span> <span data-ttu-id="4ac2d-258">Hello 快照之後，Azure Backup toohello 備份保存庫會傳送 hello 資料。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-258">After hello snapshot is taken, hello data is transferred by Azure Backup toohello backup vault.</span></span> <span data-ttu-id="4ac2d-259">toomake hello 備份程序更有效率，hello 服務識別，以及傳輸只有 hello 區塊的 hello 上次備份之後已變更的資料。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-259">toomake hello backup process more efficient, hello service identifies and transfers only hello blocks of data that have changed since hello last backup.</span></span>


<span data-ttu-id="4ac2d-260">toorestore，您可以檢視 hello 透過 Azure 備份的可用備份，並再啟動還原。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-260">toorestore, you can view hello available backups through Azure Backup and then initiate a restore.</span></span> <span data-ttu-id="4ac2d-261">您可以建立和還原 hello 透過 Azure 備份[Azure 入口網站](https://portal.azure.com/)，[使用 PowerShell](../backup/backup-azure-vms-automation.md )，或使用 hello [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-261">You can create and restore Azure backups through hello [Azure portal](https://portal.azure.com/), [using PowerShell](../backup/backup-azure-vms-automation.md ), or using hello [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install).</span></span> <span data-ttu-id="4ac2d-262">如需詳細資訊，請參閱＜Azure 備份＞。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-262">For more information, see Azure Backup.</span></span>

### <a name="steps-tooenable-backup"></a><span data-ttu-id="4ac2d-263">步驟 tooEnable 備份</span><span class="sxs-lookup"><span data-stu-id="4ac2d-263">Steps tooEnable Backup</span></span>

<span data-ttu-id="4ac2d-264">hello 下列步驟會使用 hello Vm 的常用的 tooenable 備份[Azure 入口網站](https://portal.azure.com/)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-264">hello following steps are typically used tooenable backups of your VMs using hello [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="4ac2d-265">視您實際情況而定，會有一些變化。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-265">There will be some variations depending on your exact scenario.</span></span> <span data-ttu-id="4ac2d-266">請參閱 toohello [Azure Backup](../backup/backup-azure-vms-introduction.md)文件的完整詳細資料。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-266">Refer toohello [Azure Backup](../backup/backup-azure-vms-introduction.md) documentation for full details.</span></span> <span data-ttu-id="4ac2d-267">Azure 備份也[支援 VM 與受控磁碟](https://azure.microsoft.com/blog/azure-managed-disk-backup/)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-267">Azure Backup also [supports VMs with Managed Disks](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span></span>

1.  <span data-ttu-id="4ac2d-268">復原服務保存庫建立 VM，使用下列步驟的 hello:</span><span class="sxs-lookup"><span data-stu-id="4ac2d-268">Create a recovery services vault for a VM using hello following steps:</span></span>

    <span data-ttu-id="4ac2d-269">a.</span><span class="sxs-lookup"><span data-stu-id="4ac2d-269">a.</span></span>  <span data-ttu-id="4ac2d-270">使用 hello [Azure 入口網站](https://portal.azure.com/)，瀏覽的所有資源，並尋找 「 復原服務保存庫 」。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-270">Using hello [Azure portal](https://portal.azure.com/), browse all resources and find “Recovery Services vaults”.</span></span>

    <span data-ttu-id="4ac2d-271">b.</span><span class="sxs-lookup"><span data-stu-id="4ac2d-271">b.</span></span>  <span data-ttu-id="4ac2d-272">Hello 上復原服務保存庫 功能表中，按一下 新增 並遵循 hello 步驟 toocreate hello 中新的保存庫與 hello VM 相同的區域。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-272">On hello Recovery Services vaults menu, click Add and follow hello steps toocreate a new vault in hello same region as hello VM.</span></span> <span data-ttu-id="4ac2d-273">比方說，如果您的 VM 位於美國西部地區，選擇美國西部 hello 保存庫。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-273">For example, if your VM is in West US region, pick West US for hello vault.</span></span>

2.  <span data-ttu-id="4ac2d-274">確認新建立的保存庫的 hello 的 hello 儲存體複寫。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-274">Verify hello Storage replication for hello newly created vault.</span></span> <span data-ttu-id="4ac2d-275">toodo 從 hello 復原服務保存庫刀鋒視窗，然後移至 toohello 設定/備份設定，存取 hello 保存庫。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-275">toodo this, access hello vault from hello Recovery Services vaults blade and go toohello settings/Backup Configuration.</span></span> <span data-ttu-id="4ac2d-276">確定預設會選取 hello GRS 選項。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-276">Ensure hello GRS option is selected by default.</span></span> <span data-ttu-id="4ac2d-277">這可確保您的保存庫會自動複寫的 tooa 次要資料中心。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-277">This will ensure that your vault is automatically replicated tooa secondary data center.</span></span> <span data-ttu-id="4ac2d-278">例如，您在美國西部的保存庫會自動複寫的 tooEast 美國。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-278">For example, your vault in West US will be automatically replicated tooEast US.</span></span>

3.  <span data-ttu-id="4ac2d-279">設定 hello 備份原則，並選取從 hello hello VM 相同的 UI。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-279">Configure hello backup policy and select hello VM from hello same UI.</span></span>

4.  <span data-ttu-id="4ac2d-280">請確定 hello hello VM 安裝備份代理程式。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-280">Make sure hello Backup Agent is installed on hello VM.</span></span> <span data-ttu-id="4ac2d-281">使用 Azure 資源庫映像建立 VM 時，如果是已安裝 hello 備份代理程式。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-281">If your VM is created using an Azure gallery image, then hello Backup agent is already installed.</span></span> <span data-ttu-id="4ac2d-282">否則 （也就是如果您正在使用的自訂映像），也使用指示[hello 虛擬機器上的安裝 hello VM 代理程式](../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-282">Otherwise (that is, if you are using a custom image), use instructions too[Install hello VM Agent on hello virtual machine](../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span></span>

5.  <span data-ttu-id="4ac2d-283">請確定該 hello VM 允許 hello 備份服務 toofunction 的網路連線。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-283">Make sure that hello VM allows network connectivity for hello backup service toofunction.</span></span> <span data-ttu-id="4ac2d-284">請遵循[網路連線](../backup/backup-azure-arm-vms-prepare.md#network-connectivity)的這些指示。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-284">Follow these instructions for [Network connectivity](../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span></span>

6.  <span data-ttu-id="4ac2d-285">一旦完成上述步驟 hello，hello 備份將會執行定期 hello 備份原則中所指定。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-285">Once hello above steps are completed, hello backup will run at regular intervals as specified in hello backup policy.</span></span> <span data-ttu-id="4ac2d-286">如有必要，您可以觸發 hello 第一次備份，以手動方式從 hello hello Azure 入口網站上的保存庫儀表板。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-286">If necessary, you can trigger hello first backup manually from hello vault dashboard on hello Azure portal.</span></span>

<span data-ttu-id="4ac2d-287">如需自動化 Azure Backup 使用指令碼，請參閱太[VM 備份的 PowerShell 指令程式](../backup/backup-azure-vms-automation.md)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-287">For automating Azure Backup using scripts, please refer too[PowerShell cmdlets for VM backup](../backup/backup-azure-vms-automation.md).</span></span>

### <a name="steps-for-recovery"></a><span data-ttu-id="4ac2d-288">復原步驟</span><span class="sxs-lookup"><span data-stu-id="4ac2d-288">Steps for Recovery</span></span>

<span data-ttu-id="4ac2d-289">如果您需要 toorepair 或重新建立 VM 時，您可以從任何 hello hello 保存庫中的備份復原點還原 hello VM。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-289">If you need toorepair or rebuild a VM, you can restore hello VM from any of hello backup recovery points in hello vault.</span></span> <span data-ttu-id="4ac2d-290">有幾個不同的選項執行 hello 復原：</span><span class="sxs-lookup"><span data-stu-id="4ac2d-290">There are a couple of different options for performing hello recovery:</span></span>

1.  <span data-ttu-id="4ac2d-291">您可以建立新的 VM 作為已備份 VM 的時間點表示。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-291">You can create a new VM as a point-in-time representation of your backed-up VM.</span></span>

2.  <span data-ttu-id="4ac2d-292">您可以還原 hello 磁碟，然後使用 hello VM toocustomize hello 範本並重建 hello 還原 VM。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-292">You can restore hello disks and then use hello template for hello VM toocustomize and rebuild hello restored VM.</span></span> 

<span data-ttu-id="4ac2d-293">請參閱指示太[使用 Azure 入口網站 toorestore 虛擬機器](../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-293">See instructions too[Use Azure portal toorestore virtual machines](../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span></span> <span data-ttu-id="4ac2d-294">hello 文件也會說明 hello 還原備份 Vm toohello 成對的資料中心使用異地備援的備份保存庫在 hello 的 hello 主要資料中心的災害案例中的特定步驟。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-294">hello document also explains hello specific steps for restoring backed-up VMs toohello paired data center using your geo-redundant backup vault in hello case of a disaster at hello primary data center.</span></span> <span data-ttu-id="4ac2d-295">在此情況下，Azure Backup 會使用從 hello 次要區域 toocreate hello 還原虛擬機器的 hello 計算服務。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-295">In that case, Azure Backup uses hello Compute service from hello secondary region toocreate hello restored virtual machine.</span></span>

<span data-ttu-id="4ac2d-296">您也可以使用 PowerShell 來[還原 VM](../backup/backup-azure-vms-automation.md#restore-an-azure-vm)，或[從還原的磁碟建立新的 VM](../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-296">You can also use PowerShell for [restoring a VM](../backup/backup-azure-vms-automation.md#restore-an-azure-vm) or for [creating a new VM from restored disks](../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span></span>

## <a name="alternative-solution-consistent-snapshots"></a><span data-ttu-id="4ac2d-297">替代解決方案：一致性快照</span><span class="sxs-lookup"><span data-stu-id="4ac2d-297">Alternative Solution: Consistent Snapshots</span></span>

<span data-ttu-id="4ac2d-298">如果您無法 toouse hello Azure Backup 服務，您可以實作自己的備份機制使用快照集。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-298">If you are unable toouse hello Azure Backup Service, you can implement your own backup mechanism using snapshots.</span></span> <span data-ttu-id="4ac2d-299">它是複雜的 toocreate 一致的快照集由 VM 使用的所有磁碟，然後再複寫這些快照集 tooanother 區域。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-299">It is complicated toocreate consistent snapshots for all disks used by a VM and then replicate those snapshots tooanother region.</span></span> <span data-ttu-id="4ac2d-300">基於這個理由，Azure 會考慮更好的選項，比建置自訂解決方案運用 hello 備份服務。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-300">For this reason, Azure considers leveraging hello Backup Service a better option than building a custom solution.</span></span> <span data-ttu-id="4ac2d-301">如果您使用 GRS/RA-GRS 儲存體的磁碟，快照集將會自動複寫的 tooa 次要資料中心。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-301">If you use RA-GRS/GRS storage for disks, snapshots are automatically replicated tooa secondary data center.</span></span> <span data-ttu-id="4ac2d-302">如果您使用 LRS 儲存體的磁碟，您將自己需要 tooreplicate hello 資料。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-302">If you use LRS storage for disks, you will need tooreplicate hello data yourself.</span></span> <span data-ttu-id="4ac2d-303">如需詳細資訊，請參閱[以增量快照備份 Azure 非受控 VM 磁碟](storage-incremental-snapshots.md)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-303">For more information, see [Back up Azure unmanaged VM disks with incremental snapshots](storage-incremental-snapshots.md).</span></span>

<span data-ttu-id="4ac2d-304">快照集是物件在特定時間點的表示。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-304">A snapshot is a representation of an object at a specific point in time.</span></span> <span data-ttu-id="4ac2d-305">快照集將會產生計費的 hello 增量資料大小的 hello 它保存。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-305">A snapshot will incur billing for hello incremental size of hello data it holds.</span></span> <span data-ttu-id="4ac2d-306">如需詳細資訊，請參閱[建立 Blob 快照集](storage-blob-snapshots.md)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-306">For more information, see [Create a blob snapshot](storage-blob-snapshots.md).</span></span>

### <a name="creating-snapshots-while-hello-vm-is-running"></a><span data-ttu-id="4ac2d-307">建立快照集時 hello VM 正在執行</span><span class="sxs-lookup"><span data-stu-id="4ac2d-307">Creating snapshots while hello VM is running</span></span>

<span data-ttu-id="4ac2d-308">時，您可以採取快照集隨時 hello VM 正在執行，如果仍有正在串流處理 toohello 磁碟的資料，而且 hello 快照集可能包含部分中的作業。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-308">While you can take a snapshot at any time, if hello VM is running, there is still data being streamed toohello disks, and hello snapshots may contain partial operations that were in flight.</span></span> <span data-ttu-id="4ac2d-309">此外，如果涉及多個磁碟，hello 的不同磁碟的快照集可能會發生在不同的時間，這表示這些快照集可能不一致。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-309">Also, if there are several disks involved, hello snapshots of different disks may have occurred at different times, which means these snapshots may not be coordinated.</span></span> <span data-ttu-id="4ac2d-310">等量磁碟區特別會有此問題，如果在備份期間發生變更，其中所包含的檔案可能會損毀。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-310">This is especially problematic for striped volumes whose files can be corrupted if changes were being made during backup.</span></span>

<span data-ttu-id="4ac2d-311">tooavoid 這種情況下，hello 備份程序必須實作 hello 下列步驟：</span><span class="sxs-lookup"><span data-stu-id="4ac2d-311">tooavoid this situation, hello backup process must implement hello following steps:</span></span>

1.  <span data-ttu-id="4ac2d-312">凍結所有 hello 磁碟</span><span class="sxs-lookup"><span data-stu-id="4ac2d-312">Freeze all hello disks</span></span>

2.  <span data-ttu-id="4ac2d-313">排清所有暫止的寫入 hello</span><span class="sxs-lookup"><span data-stu-id="4ac2d-313">Flush all hello pending writes</span></span>

3.  <span data-ttu-id="4ac2d-314">然後，[建立 blob 的快照集](storage-blob-snapshots.md)針對所有 hello 磁碟</span><span class="sxs-lookup"><span data-stu-id="4ac2d-314">Then, [create a blob snapshot](storage-blob-snapshots.md) for all hello disks</span></span>

<span data-ttu-id="4ac2d-315">某些 Windows 應用程式，例如 SQL Server 提供的協調備份機制，透過 VSS toocreate 應用程式一致備份。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-315">Some Windows applications like SQL Server provide a coordinated backup mechanism via VSS toocreate application-consistent backups.</span></span> <span data-ttu-id="4ac2d-316">On Linux，您可以使用 fsfreeze 這類工具來協調 hello 磁碟，將會提供檔案一致的備份，但是應用程式不一致的快照集。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-316">On Linux, you can use a tool like fsfreeze for coordinating hello disks, which will provide file-consistent backups, but not application-consistent snapshots.</span></span> <span data-ttu-id="4ac2d-317">此程序很複雜，因此您應該考慮使用 [Azure 備份](../backup/backup-azure-vms-introduction.md)，或是已實作此作業的協力廠商備份解決方案。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-317">This process is complicated, so and you should consider using [Azure Backup](../backup/backup-azure-vms-introduction.md) or a third-party backup solution which already implement this.</span></span>

<span data-ttu-id="4ac2d-318">hello 上述程序將會導致協調所有 hello VM 磁碟，代表特定時間點檢視 hello VM 的快照集的集合。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-318">hello above process will result in a collection of coordinated snapshots for all hello VM disks, representing a specific point-in-time view of hello VM.</span></span> <span data-ttu-id="4ac2d-319">這是備份的還原點的 hello VM。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-319">This is a backup restore point for hello VM.</span></span> <span data-ttu-id="4ac2d-320">您可以重複 hello 程序，在排定的時間間隔 toocreate 定期備份。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-320">You can repeat hello process at scheduled intervals toocreate periodic backups.</span></span> <span data-ttu-id="4ac2d-321">請參閱以下的 hello 步驟太[複製 hello 備份 tooanother 區域](#copy-the-snapshots-to-another-region)dr。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-321">See below for hello steps too[copy hello backups tooanother region](#copy-the-snapshots-to-another-region) for DR.</span></span>

### <a name="creating-snapshots-while-hello-vm-is-offline"></a><span data-ttu-id="4ac2d-322">建立快照集時 hello VM 處於離線狀態</span><span class="sxs-lookup"><span data-stu-id="4ac2d-322">Creating snapshots while hello VM is offline</span></span>

<span data-ttu-id="4ac2d-323">另一個選項 toocreate 一致的備份正在關機而關閉 hello VM 和擷取 blob 的每個磁碟的快照集。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-323">Another option toocreate consistent backups is shutting down hello VM and taking blob snapshots of each disk.</span></span> <span data-ttu-id="4ac2d-324">這比協調執行中 VM 的快照集更容易，但需要停機幾分鐘。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-324">This is easier than coordinating snapshots of a running VM, but it requires a few minutes of downtime.</span></span> <span data-ttu-id="4ac2d-325">若要進行此程序，請遵循下列步驟：</span><span class="sxs-lookup"><span data-stu-id="4ac2d-325">For this process, follow these steps:</span></span>

1. <span data-ttu-id="4ac2d-326">關閉 hello VM。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-326">Shut down hello VM.</span></span>

2. <span data-ttu-id="4ac2d-327">建立每個 VHD Blob 的快照集，只需幾秒鐘的時間。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-327">Create a snapshot of each VHD blob, which only takes a few seconds.</span></span>

    <span data-ttu-id="4ac2d-328">toocreate 快照集，您可以使用[PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots)，hello [Azure 儲存體的 Rest API](https://msdn.microsoft.com/library/azure/ee691971.aspx)， [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install)，或其中一個 hello Azure 儲存體用戶端程式庫例如[hello.NET 的儲存體用戶端程式庫](https://msdn.microsoft.com/library/azure/hh488361.aspx)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-328">toocreate a snapshot, you can use [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), hello [Azure Storage Rest API](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install), or one of hello Azure Storage Client Libraries such as [hello Storage client library for .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

3. <span data-ttu-id="4ac2d-329">啟動 hello VM，結束 hello 停機時間。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-329">Start hello VM, which ends hello downtime.</span></span> <span data-ttu-id="4ac2d-330">通常在幾分鐘內完成 hello 整個程序。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-330">Typically hello entire process completes within a few minutes.</span></span>

<span data-ttu-id="4ac2d-331">此程序會產生所有 hello 磁碟，提供 hello VM 備份的還原點的一致快照的集合。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-331">This process yields a collection of consistent snapshots for all hello disks, providing a backup restore point for hello VM.</span></span> <span data-ttu-id="4ac2d-332">請參閱下面的 hello 步驟 toocopy hello 快照 tooanother 區域 dr。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-332">See below for hello steps toocopy hello snapshots tooanother region for DR.</span></span>

### <a name="copy-hello-snapshots-tooanother-region"></a><span data-ttu-id="4ac2d-333">複製 hello 快照 tooanother 區域</span><span class="sxs-lookup"><span data-stu-id="4ac2d-333">Copy hello snapshots tooanother region</span></span>

<span data-ttu-id="4ac2d-334">建立單獨的 hello 快照集可能無法完全 dr。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-334">Creation of hello snapshots alone may not be sufficient for DR.</span></span> <span data-ttu-id="4ac2d-335">您也必須將複寫 hello 快照集備份 tooanother 區域。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-335">You must also replicate hello snapshot backups tooanother region.</span></span>

<span data-ttu-id="4ac2d-336">如果您使用 GRS 或 RA-GRS 的磁碟，然後 hello 快照集都會複寫的 toohello 次要區域自動。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-336">If you are using GRS or RA-GRS for your disks, then hello snapshots are replicated toohello secondary region automatically.</span></span> <span data-ttu-id="4ac2d-337">可能有幾分鐘的延遲 hello 複寫之前，如果 hello 主要資料中心停機 hello 快照集完成複寫之前，您將無法從 hello 次要資料中心可以 tooaccess hello 快照集。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-337">There can be a few minutes of lag before hello replication, and if hello primary data center goes down before hello snapshots finish replicating, you will not be able tooaccess hello snapshots from hello secondary data center.</span></span> <span data-ttu-id="4ac2d-338">這個 hello 可能性很小。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-338">hello likelihood of this is small.</span></span>

> [!Note] 
> <span data-ttu-id="4ac2d-339">只需 GRS 或 RA-GRS 帳戶中的 hello 磁碟不會保護 hello VM 從損毀。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-339">Only having hello disks in a GRS or RA-GRS account does not protect hello VM from disasters.</span></span> <span data-ttu-id="4ac2d-340">您還必須建立一致性快照或使用 Azure 備份。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-340">You must also create coordinated snapshots or use Azure Backup.</span></span> <span data-ttu-id="4ac2d-341">這是必要的 toorecover VM tooa 一致的狀態。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-341">This is required toorecover a VM tooa consistent state.</span></span>

<span data-ttu-id="4ac2d-342">如果您使用 LRS，則必須建立 hello 快照集之後，立即複製 hello 快照 tooa 不同儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-342">If you are using LRS, you must copy hello snapshots tooa different storage account immediately after creating hello snapshot.</span></span> <span data-ttu-id="4ac2d-343">hello 複製目標可能是 LRS 儲存體帳戶在不同區域中，導致遠端的區域中的 hello 複製。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-343">hello copy target could be an LRS storage account in a different region, resulting in hello copy being in a remote region.</span></span> <span data-ttu-id="4ac2d-344">您也可以在 hello 複製 hello 快照 tooan RA-GRS 儲存體帳戶相同的區域。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-344">You can also copy hello snapshot tooan RA-GRS storage account in hello same region.</span></span> <span data-ttu-id="4ac2d-345">在此情況下，hello 快照集將會延遲複寫的 toohello 遠端次要區域。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-345">In this case, hello snapshot will be lazily replicated toohello remote secondary region.</span></span> <span data-ttu-id="4ac2d-346">您的備份會 hello 複製和複寫完成之後，受保護從 hello 主要站台的損毀。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-346">Your backup is protected from disasters at hello primary site once hello copying and replication is complete.</span></span>

<span data-ttu-id="4ac2d-347">toocopy dr 您增量快照有效率地檢閱中的 hello 指示[備份 Azure 增量快照集的未受管理的 VM 磁碟](storage-incremental-snapshots.md)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-347">toocopy your incremental snapshots for DR efficiently, review hello instructions in [Back up Azure unmanaged VM disks with incremental snapshots](storage-incremental-snapshots.md).</span></span>

![][2]

### <a name="recovery-from-snapshots"></a><span data-ttu-id="4ac2d-348">從快照集復原</span><span class="sxs-lookup"><span data-stu-id="4ac2d-348">Recovery from Snapshots</span></span>

<span data-ttu-id="4ac2d-349">tooretrieve 快照集，將它複製 toomake 新的 blob。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-349">tooretrieve a snapshot, copy it toomake a new blob.</span></span> <span data-ttu-id="4ac2d-350">如果您從 hello 主要帳戶複製 hello 快照集，您可以複製 hello hello 快照集，因此還原 hello 磁碟 toohello 快照集; toohello 基底 blob 之上快照集這稱為升級 hello 快照集。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-350">If you are copying hello snapshot from hello primary account, you can copy hello snapshot over toohello base blob of hello snapshot, thus reverting hello disk toohello snapshot; this is known as promoting hello snapshot.</span></span> <span data-ttu-id="4ac2d-351">如果您從次要帳戶 （在 hello 的 RA-GRS） 複製 hello 快照集備份，則必須複製 tooa 主要帳戶。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-351">If you are copying hello snapshot backup from a secondary account (in hello case of RA-GRS), it must be copied tooa primary account.</span></span> <span data-ttu-id="4ac2d-352">您可以將快照集複製[使用 PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob)或使用 hello AzCopy 公用程式。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-352">You can copy a snapshot [using PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) or using hello AzCopy utility.</span></span> <span data-ttu-id="4ac2d-353">如需詳細資訊，請參閱[hello AzCopy 命令列公用程式使用傳輸資料](storage-use-azcopy.md)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-353">For more information, see [Transfer data with hello AzCopy Command-Line Utility](storage-use-azcopy.md).</span></span>

<span data-ttu-id="4ac2d-354">在 hello 案例的 Vm 中有多個磁碟，您必須複製所有屬於相同協調的 hello hello 快照集還原點。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-354">In hello case of VMs with multiple disks, you must copy all hello snapshots that are part of hello same coordinated restore point.</span></span> <span data-ttu-id="4ac2d-355">一旦您複製 hello 快照 toowritable VHD blob，您可以使用 hello blob toorecreate 使用 hello 範本 hello VM 的 VM。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-355">Once you copy hello snapshots toowritable VHD blobs, you can use hello blobs toorecreate your VM using hello template for hello VM.</span></span>

## <a name="other-options"></a><span data-ttu-id="4ac2d-356">其他選項</span><span class="sxs-lookup"><span data-stu-id="4ac2d-356">Other options</span></span>

### <a name="sql-server"></a><span data-ttu-id="4ac2d-357">SQL Server</span><span class="sxs-lookup"><span data-stu-id="4ac2d-357">SQL Server</span></span>

<span data-ttu-id="4ac2d-358">在 VM 中執行的 SQL Server 有它自己的內建功能 toobackup 您 SQL Server 資料庫 tooAzure Blob 儲存體或檔案共用。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-358">SQL Server running in a VM has its own built-in capabilities toobackup your SQL Server database tooAzure Blob storage or a file share.</span></span> <span data-ttu-id="4ac2d-359">如果 GRS 或 RA-GRS hello 儲存體帳戶，您可以使用存取 hello 儲存體帳戶的次要資料中心的災害，hello 事件中的這些備份 hello 相同的限制，如先前所討論。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-359">If hello storage account is GRS or RA-GRS, you can access those backups in hello storage account’s secondary data center in hello event of a disaster, with hello same restrictions as discussed previously.</span></span> <span data-ttu-id="4ac2d-360">如需詳細資訊，請參閱 [Azure 虛擬機器中 SQL Server 的備份與還原](../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-360">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span></span> <span data-ttu-id="4ac2d-361">在加法 toobackup 與還原、 [SQL Server Alwayson 可用性群組](../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md)可以維護次要複本的資料庫 toogreatly 減少 hello 災害復原時間。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-361">In addition toobackup and restore, [SQL Server Always On Availability Groups](../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) can maintain secondary replicas of databases toogreatly reduce hello disaster recovery time.</span></span>

## <a name="other-considerations"></a><span data-ttu-id="4ac2d-362">其他考量</span><span class="sxs-lookup"><span data-stu-id="4ac2d-362">Other considerations</span></span>

<span data-ttu-id="4ac2d-363">這篇文章討論如何 toobackup 或採取快照集的 Vm 和其磁碟 toosupport 災害復原，以及如何 toouse 這些 toorecover。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-363">This article has discussed how toobackup or take snapshots of your VMs and their disks toosupport disaster recovery, and how toouse those toorecover.</span></span> <span data-ttu-id="4ac2d-364">使用 hello Azure Resource Manager 模型時，許多人範本 toocreate 其 Vm 和其他基礎結構在 Azure 中使用。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-364">With hello Azure Resource Manager model, many people use templates toocreate their VMs and other infrastructure in Azure.</span></span> <span data-ttu-id="4ac2d-365">您可以使用範本 toocreate 具有 hello VM 相同的設定每一次。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-365">You can use a template toocreate a VM that has hello same configuration every time.</span></span> <span data-ttu-id="4ac2d-366">如果您使用自訂映像建立 Vm 時，您也必須確定您的映像受到使用 RA-GRS 帳戶 toostore 它們。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-366">If you use custom images for creating your VMs, you must also make sure your images are protected by using an RA-GRS account toostore them.</span></span>

<span data-ttu-id="4ac2d-367">因此，備份程序可能包含下列兩項：</span><span class="sxs-lookup"><span data-stu-id="4ac2d-367">Consequently, your backup process may be a combination of two things:</span></span>

1. <span data-ttu-id="4ac2d-368">備份 hello 資料 （磁碟）</span><span class="sxs-lookup"><span data-stu-id="4ac2d-368">Backup hello data (disks)</span></span>
2. <span data-ttu-id="4ac2d-369">備份 hello 組態 （範本、 自訂映像）</span><span class="sxs-lookup"><span data-stu-id="4ac2d-369">Backup hello configuration (templates, custom images)</span></span>

<span data-ttu-id="4ac2d-370">視您選擇 hello 備份選項，您可能必須 hello 資料和 hello 組態 toohandle hello 備份或 hello 備份服務可能會為您處理所有作業。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-370">Depending on hello backup option you choose, you may have toohandle hello backup of both hello data and hello configuration, or hello backup service may handle all of that for you.</span></span>

## <a name="appendix---understanding-hello-impact-of-lrs-grs-and-ra-grs"></a><span data-ttu-id="4ac2d-371">附錄-了解的 LRS、 GRS 與 RA-GRS hello 影響</span><span class="sxs-lookup"><span data-stu-id="4ac2d-371">Appendix - Understanding hello impact of LRS, GRS, and RA-GRS</span></span>

<span data-ttu-id="4ac2d-372">對於 Azure 中的儲存體帳戶而言，有三種資料備援類型可視為與災害復原相關，那就是本地備援 (LRS)、異地備援 (GRS) 或具有讀取權限的異地備援 (RA-GRS)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-372">For storage accounts in Azure, there are three types of data redundancy that you should consider regarding disaster recovery – locally redundant (LRS), geo-redundant (GRS), or geo-redundant with read access (RA-GRS).</span></span> 

<span data-ttu-id="4ac2d-373">本機備援儲存體 (LRS) 會保留三份 hello hello 中的資料相同的資料中心。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-373">Locally Redundant Storage (LRS) retains three copies of hello data in hello same data center.</span></span> <span data-ttu-id="4ac2d-374">在撰寫 hello 資料時，傳回成功之前 toohello 呼叫端，因此您知道它們完全相同，會更新所有三個複本。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-374">When writing hello data, all three copies are updated before success is returned toohello caller, so you know they are identical.</span></span> <span data-ttu-id="4ac2d-375">您的磁碟不受本機失敗，因為它是非常不可能，會在 hello 影響所有的三個複本相同的時間。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-375">Your disk is protected from local failures, since it is extremely unlikely that all three copies would be impacted at hello same time.</span></span> <span data-ttu-id="4ac2d-376">LRS 的 hello 案例中，在沒有任何的地理備援性，因此 hello 磁碟無法防止可能會影響整個資料中心或儲存體單位的嚴重失敗。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-376">In hello case of LRS, there is no geo-redundancy, so hello disk is not protected from catastrophic failures that can impact an entire data center or storage unit.</span></span>

<span data-ttu-id="4ac2d-377">GRS 和 RA-GRS，三份資料會保留在 hello 主要區域中 （由您已選取），而對應的次要區域 （設定 azure） 中保留三份詳細資料。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-377">With GRS and RA-GRS, three copies of your data are retained in hello primary region (selected by you), and three more copies of your data are retained in a corresponding secondary region (set by Azure).</span></span> <span data-ttu-id="4ac2d-378">例如，如果您將資料儲存在美國西部、 hello 資料會複寫的 tooEast 美國。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-378">For example, if you store data in West US, hello data will be replicated tooEast US.</span></span> <span data-ttu-id="4ac2d-379">這是以非同步的方式，且更新 toohello 主要與次要之間有一些延遲。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-379">This is done asynchronously, and there is a small delay between updates toohello primary and secondary.</span></span> <span data-ttu-id="4ac2d-380">Hello 磁碟 hello 次要站台上的複本都符合每個磁碟為基礎 （hello 延遲），但可能不同步的多個作用中磁碟的複本**彼此**。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-380">Replicas of hello disks on hello secondary site are consistent on a per-disk basis (with hello delay), but replicas of multiple active disks may not be in sync **with each other**.</span></span> <span data-ttu-id="4ac2d-381">需要 toohave 跨多個磁碟、 一致的快照集一致的複本。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-381">toohave consistent replicas across multiple disks, consistent snapshots are needed.</span></span>

<span data-ttu-id="4ac2d-382">hello GRS 和 RA-GRS 之間的主要差異在於含 RA-GRS，您可以閱讀 hello 次要複本在任何時間。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-382">hello main difference between GRS and RA-GRS is that with RA-GRS, you can read hello secondary copy at any time.</span></span> <span data-ttu-id="4ac2d-383">如果沒有將 hello 主要區域中的 hello 資料呈現為無法存取的問題，hello Azure 團隊會讓每個投入時間 toorestore 存取。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-383">If there is a problem that renders hello data in hello primary region inaccessible, hello Azure team will make every effort toorestore access.</span></span> <span data-ttu-id="4ac2d-384">雖然主要 hello 已關閉，如果您有啟用 RA-GRS，您可以存取 hello hello 次要資料中心中的資料。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-384">While hello primary is down, if you have RA-GRS enabled, you can access hello data in hello secondary data center.</span></span> <span data-ttu-id="4ac2d-385">因此，如果您計劃從 hello 複本 tooread hello 主要時無法存取，然後 RA-GRS 應該考量。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-385">Therefore, if you plan tooread from hello replica while hello primary is inaccessible, then RA-GRS should be considered.</span></span>

<span data-ttu-id="4ac2d-386">如果證明 toobe 顯著的中斷，hello Azure 團隊可能會觸發地理容錯移轉，然後變更 hello 主要 DNS 項目 toopoint toosecondary 儲存體。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-386">If it turns out toobe a significant outage, hello Azure team may trigger a geo-failover and change hello primary DNS entries toopoint toosecondary storage.</span></span> <span data-ttu-id="4ac2d-387">此時，如果您有任一個 GRS 或 RA-GRS 啟用，您可以存取使用 toobe hello 次要的 hello 區域中的 hello 資料。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-387">At this point, if you have either GRS or RA-GRS enabled, you can access hello data in hello region that used toobe hello secondary.</span></span> <span data-ttu-id="4ac2d-388">換句話說，如果您的儲存體帳戶是 GRS 和有問題，您可以存取 hello 次要儲存體地理容錯移轉時。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-388">In other words, if your storage account is GRS and there is a problem, you can access hello secondary storage only if there is a geo-failover.</span></span>

<span data-ttu-id="4ac2d-389">如需詳細資訊，請參閱[如果 Azure 儲存體中斷，就會發生何種 toodo](storage-disaster-recovery-guidance.md)。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-389">For more information, see [What toodo if an Azure Storage outage occurs](storage-disaster-recovery-guidance.md).</span></span> 

<span data-ttu-id="4ac2d-390">請注意，Microsoft 會控制是否發生容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-390">Note that Microsoft controls whether a failover occurs.</span></span> <span data-ttu-id="4ac2d-391">容錯移轉不是針對每個儲存體帳戶所控制，因此不會由個別客戶來決定。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-391">Failover is not controlled per storage account, therefore it is not decided by individual customers.</span></span> <span data-ttu-id="4ac2d-392">tooimplement 災害復原的特定儲存體帳戶或虛擬機器的磁碟，您必須使用先前所述，本文章中的 hello 技巧。</span><span class="sxs-lookup"><span data-stu-id="4ac2d-392">tooimplement Disaster Recovery for specific storage accounts or virtual machine disks, you must use hello techniques described previously in this article.</span></span>



[1]: ./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-1.png
[2]: ./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-2.png