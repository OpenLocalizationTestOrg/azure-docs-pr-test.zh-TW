---
title: "Azure IaaS 磁碟的備份和災害復原 | Microsoft Docs"
description: "在本文中，我們將說明如何規劃 IaaS 虛擬機器 (VM) 和 Azure 中磁碟的備份和災害復原 (DR)。 本文件涵蓋受控磁碟和非受控磁碟"
services: storage
cloud: Azure
documentationcenter: na
author: luywang
manager: kavithag
ms.assetid: 
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: luywang
ms.openlocfilehash: 0de675e46dbd527148ac5fedcd35d81962adfb7e
ms.sourcegitcommit: 422efcbac5b6b68295064bd545132fcc98349d01
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/29/2017
---
# <a name="backup-and-disaster-recovery-for-azure-iaas-disks"></a><span data-ttu-id="4a0d5-104">Azure IaaS 磁碟的備份和災害復原</span><span class="sxs-lookup"><span data-stu-id="4a0d5-104">Backup and disaster recovery for Azure IaaS disks</span></span>

<span data-ttu-id="4a0d5-105">在本文中，我們將說明如何規劃 IaaS 虛擬機器 (VM) 和 Azure 中磁碟的備份和災害復原 (DR)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-105">In this article, we will explain how to plan for Backup and Disaster Recovery (DR) of IaaS virtual machines (VMs) and Disks in Azure.</span></span> <span data-ttu-id="4a0d5-106">本文件涵蓋受控磁碟和非受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-106">This document covers both Managed and Unmanaged Disks.</span></span>

<span data-ttu-id="4a0d5-107">我們會先討論 Azure 平台中內建的容錯功能，該功能可協助防範本機失敗。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-107">We’ll first talk about the built-in fault tolerance capabilities in the Azure platform which help guard against local failures.</span></span> <span data-ttu-id="4a0d5-108">接著會討論內建功能未能完全保護的災害案例，這也是本文件所要探討的主題。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-108">We’ll then discuss the disaster scenarios not fully covered by the built-in capabilities, which is the main topic addressed by this document.</span></span> <span data-ttu-id="4a0d5-109">我們也將示範幾個工作負載案例範例，其中可能會有不同的備份和 DR 考量。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-109">We’ll also show several examples of workload scenarios where different Backup and DR considerations may apply.</span></span> <span data-ttu-id="4a0d5-110">接著會檢閱 IaaS 磁碟的可能 DR 解決方案。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-110">We’ll then review possible solutions for DR of IaaS Disks.</span></span> 

## <a name="introduction"></a><span data-ttu-id="4a0d5-111">簡介</span><span class="sxs-lookup"><span data-stu-id="4a0d5-111">Introduction</span></span>

<span data-ttu-id="4a0d5-112">Azure 平台使用各種備援和容錯方法，來協助保護客戶防範可能發生的當地語系化硬體失敗。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-112">The Azure platform uses various methods for redundancy and fault tolerance to help protect customers from localized hardware failures that can occur.</span></span> <span data-ttu-id="4a0d5-113">本機失敗可能是指儲存部分虛擬磁碟資料的 Azure 儲存體伺服器電腦發生問題，或是該伺服器上的 SSD 或 HDD 失敗。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-113">Local failures may include problems with an Azure storage server machine that stores part of the data for a virtual disk or failures of an SSD or HDD on that server.</span></span> <span data-ttu-id="4a0d5-114">這類個別硬體元件失敗可能發生在正常作業期間，而此平台的設計可從這些失敗中復原。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-114">Such isolated hardware component failures can happen during normal operations and the platform is designed to be resilient to these failures.</span></span> <span data-ttu-id="4a0d5-115">重大災害可能會導致大量儲存體伺服器或整個資料中心失敗或無法存取。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-115">Major disasters can result in failures or inaccessibility of a large numbers of storage servers or a whole datacenter.</span></span> <span data-ttu-id="4a0d5-116">雖然您的 VM 和磁碟通常可防範當地語系化失敗，但若要保護工作負載防範可能影響 VM 和磁碟的區域全面重大失敗 (例如重大災害)，則需要採取額外步驟。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-116">While your VMs and disks are normally protected from localized failures, additional steps are necessary to protect your workload from region-wide catastrophic failures (such as a major disaster) that can affect your VM and disks.</span></span>

<span data-ttu-id="4a0d5-117">除了可能發生平台失敗之外，也可能發生客戶應用程式或資料問題。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-117">In addition to the possibility of platform failures, problems with the customer application or data can occur.</span></span> <span data-ttu-id="4a0d5-118">例如，您的新版應用程式可能會不小心中斷資料的變更。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-118">For example, a new version of your application may inadvertently make a breaking change to the data.</span></span> <span data-ttu-id="4a0d5-119">在此情況下，您可能想要將應用程式和資料還原為含有已知良好狀態的舊版。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-119">In that case, you may want to revert the application and the data to a prior version containing the last known good state.</span></span> <span data-ttu-id="4a0d5-120">這需要維護定期備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-120">This requires maintaining regular backups.</span></span>

<span data-ttu-id="4a0d5-121">針對區域性災害復原，您必須將 IaaS VM 磁碟備份至不同區域。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-121">For regional disaster recovery, you must backup your IaaS VM disks to a different region.</span></span> 

<span data-ttu-id="4a0d5-122">讓我們先回顧可用來處理當地語系化失敗的一些方法，再檢視備份和 DR 選項。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-122">Before we look at Backup and DR options, let’s recap a few methods available for handling localized failures.</span></span>

### <a name="azure-iaas-resiliency"></a><span data-ttu-id="4a0d5-123">Azure IaaS 復原</span><span class="sxs-lookup"><span data-stu-id="4a0d5-123">Azure IaaS Resiliency</span></span>

<span data-ttu-id="4a0d5-124">「復原」是指硬體元件中所發生之一般失敗的容錯。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-124">*Resiliency* refers to the tolerance for normal failures that occur in hardware components.</span></span> <span data-ttu-id="4a0d5-125">復原是從失敗中復原並繼續運作的能力。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-125">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="4a0d5-126">它不是避免失敗，而是以避免停機或資料遺失的方式來回應失敗。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-126">It's not about avoiding failures, but responding to failures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="4a0d5-127">復原的目標是讓應用程式在失敗後完全回到正常運作的狀態。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-127">The goal of resiliency is to return the application to a fully functioning state following a failure.</span></span> <span data-ttu-id="4a0d5-128">Azure 虛擬機器和磁碟設計成可從常見的硬體故障中復原。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-128">Azure Virtual Machines and Disks are designed to be resilient to common hardware faults.</span></span> <span data-ttu-id="4a0d5-129">讓我們看看 Azure IaaS 平台如何提供這項復原功能。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-129">Let us look at how the Azure IaaS platform provides this resiliency.</span></span>

<span data-ttu-id="4a0d5-130">虛擬機器主要包含兩部分：(1) 計算伺服器，以及 (2) 永續性磁碟。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-130">A virtual machine consists mainly of two parts: (1) A compute server, and (2) the persistent disks.</span></span> <span data-ttu-id="4a0d5-131">這兩者都會影響虛擬機器的容錯。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-131">Both affect the fault tolerance of a virtual machine.</span></span>

<span data-ttu-id="4a0d5-132">如果裝載 VM 的 Azure 計算主機伺服器發生硬體失敗 (這很罕見)，Azure 的設計可自動在另一部伺服器上還原 VM。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-132">If the Azure compute host server that houses your VM experiences a hardware failure (which is rare), Azure is designed to automatically restore the VM on another server.</span></span> <span data-ttu-id="4a0d5-133">如果發生這種情況，就會重新開機，而且 VM 將會在一段時間後進行備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-133">If this happens, you will experience a reboot, and the VM will be back up after some time.</span></span> <span data-ttu-id="4a0d5-134">Azure 會自動偵測這類硬體失敗並執行復原，以協助確保客戶的 VM 盡快恢復可用。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-134">Azure automatically detects such hardware failures and executes recoveries to help ensure the customer VM will be available as soon as possible.</span></span>

<span data-ttu-id="4a0d5-135">至於 IaaS 磁碟，資料持久性是永續性儲存體平台的關鍵。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-135">Regarding IaaS disks, durability of data is critical for the persistent storage platform.</span></span> <span data-ttu-id="4a0d5-136">Azure 客戶在 IaaS 上執行重要的商務應用程式，而且需要持續提供資料。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-136">Azure customers have important business applications running on IaaS and they depend on the persistence of the data.</span></span> <span data-ttu-id="4a0d5-137">Azure 設計這些 IaaS 磁碟保護的方式是在本機儲存三份資料的備援複本，並提供高持久性以防範本機失敗。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-137">Azure designs protection for these IaaS disks with three redundant copies of data stored locally, providing high durability against local failures.</span></span> <span data-ttu-id="4a0d5-138">如果其中一個保留磁碟的硬體元件失敗，由於還有兩個額外的複本支援磁碟要求，因此您的 VM 不會受到影響。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-138">If one of the hardware components that holds your disk fails, your VM is not impacted because there are two additional copies to support disk requests.</span></span> <span data-ttu-id="4a0d5-139">即使兩個支援磁碟的不同硬體元件同時失敗 (非常罕見)，也沒問題。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-139">It works fine even if two different hardware components supporting a disk fail at the same time (which would be very rare).</span></span> <span data-ttu-id="4a0d5-140">為協助確保我們永遠都有三份複本，如果三份複本中有一份無法使用，Azure 儲存體服務會在背景自動繁衍新的資料複本。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-140">To help ensure we always maintain three replicas, the Azure Storage service automatically spawns a new copy of data in the background if one of the three copies becomes unavailable.</span></span> <span data-ttu-id="4a0d5-141">因此，您不需要對 Azure 磁碟使用 RAID 以取得容錯功能。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-141">Therefore, it should not be necessary to use RAID with Azure disks for fault tolerance.</span></span> <span data-ttu-id="4a0d5-142">如果需要建立更大的磁碟區，簡單的 RAID 0 設定應該就足以分割磁碟。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-142">A simple RAID 0 configuration should be sufficient for striping the disks if necessary to create larger volumes.</span></span>

<span data-ttu-id="4a0d5-143">由於此結構，**Azure 為 IaaS 磁碟一致地提供企業級持久性，其[年度失敗率](https://en.wikipedia.org/wiki/Annualized_failure_rate)為零，領先業界。**</span><span class="sxs-lookup"><span data-stu-id="4a0d5-143">Because of this architecture, **Azure has consistently delivered enterprise-grade durability for IaaS disks, with an industry-leading ZERO % [Annualized Failure Rate](https://en.wikipedia.org/wiki/Annualized_failure_rate).**</span></span>

<span data-ttu-id="4a0d5-144">計算主機或儲存體平台的當地語系化硬體故障有時會導致 VM 暫時無法使用，如 VM 可用性的 [Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) 中所述。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-144">Localized hardware faults on the compute host or in the storage platform can sometimes result in temporary unavailability for the VM which is covered by the [Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) for VM Availability.</span></span> <span data-ttu-id="4a0d5-145">Azure 也提供領先業界的 SLA，適用於使用進階儲存體磁碟的單一 VM 執行個體。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-145">Azure also provides an industry-leading SLA for single VM instances that use Premium Storage disks.</span></span>

<span data-ttu-id="4a0d5-146">若要防止應用程式工作負載由於磁碟或 VM 暫時無法使用而停機，客戶可以利用[可用性設定組](../virtual-machines/windows/manage-availability.md)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-146">To safeguard application workloads from downtime due to the temporary unavailability of a disk or VM, customers can leverage [Availability Sets](../virtual-machines/windows/manage-availability.md).</span></span> <span data-ttu-id="4a0d5-147">可用性設定組中的兩個或多個虛擬機器提供應用程式的備援。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-147">Two or more virtual machines in an availability set provides redundancy for the application.</span></span> <span data-ttu-id="4a0d5-148">Azure 會接著在具有不同電源、網路和伺服器元件的個別容錯網域中，建立這些 VM 和磁碟。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-148">Azure then creates these VMs and disks in separate fault domains with different power, network, and server components.</span></span> <span data-ttu-id="4a0d5-149">因此，當地語系化的硬體失敗通常不會同時影響組合中的多個 VM，因此可提高您應用程式的可用性。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-149">Thus, localized hardware failures typically do not affect multiple VMs in the set at the same time, providing high availability for your application.</span></span> <span data-ttu-id="4a0d5-150">使用可用性設定組是在需要高可用性時的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-150">It is considered a good practice to use availability sets when high availability is required.</span></span> <span data-ttu-id="4a0d5-151">如需詳細資訊，請參閱以下詳細說明的災害復原部分。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-151">For more information, see the Disaster Recovery aspects detailed below.</span></span>

### <a name="backup-and-disaster-recovery"></a><span data-ttu-id="4a0d5-152">備份和災害復原</span><span class="sxs-lookup"><span data-stu-id="4a0d5-152">Backup and Disaster Recovery</span></span>

<span data-ttu-id="4a0d5-153">災害復原 (DR) 是從罕見但重大的事件中復原的能力，這些事件是非暫時性且規模廣泛的失敗，例如影響整個區域的服務中斷。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-153">Disaster recovery (DR) is the ability to recover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="4a0d5-154">災害復原包括資料備份和封存，而且可能包括手動操作，例如從備份中還原資料庫。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-154">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="4a0d5-155">Azure 平台對當地語系化失敗的內建保護，在發生可能導致大規模中斷的重大災害時，可能無法完全保護 VM/磁碟。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-155">The Azure platform’s built-in protection against localized failures may not fully protect the VMs/disks in the case of major disasters which can cause large-scale outages.</span></span> <span data-ttu-id="4a0d5-156">這包括資料中心遇到颶風、地震、火災，或大規模硬體裝置失敗等重大事件。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-156">This includes catastrophic events such as a data center being hit by a hurricane, earthquake, fire, or large scale hardware unit failures.</span></span> <span data-ttu-id="4a0d5-157">此外，您可能會由於應用程式或資料問題而發生失敗。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-157">In addition, you may encounter failures due to application or data issues.</span></span>

<span data-ttu-id="4a0d5-158">為協助防止您的 IaaS 工作負載中斷，您應該規劃備援和備份以允許進行復原。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-158">To help protect your IaaS workloads from outages, you should plan for redundancy and backups to enable recovery.</span></span> <span data-ttu-id="4a0d5-159">若要進行災害復原，您應該在與主要站台不同的地理位置規劃備援和備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-159">For disaster recovery, you should plan redundancy and backup in a different geographic location away from the primary site.</span></span> <span data-ttu-id="4a0d5-160">這有助於確保您的備份不會受到 VM 或磁碟原本會影響之相同事件的影響。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-160">This helps ensure your backup is not affected by the same event that originally impacted the VM or disks.</span></span> <span data-ttu-id="4a0d5-161">如需詳細資訊，請參閱 [Disaster recovery for Azure applications](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications) (Azure 應用程式的災害復原)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-161">For more information, see [Disaster Recovery for Applications built on Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span></span>

<span data-ttu-id="4a0d5-162">您的 DR 考量可能包括下列層面：</span><span class="sxs-lookup"><span data-stu-id="4a0d5-162">Your DR considerations may include the following aspects:</span></span>

1. <span data-ttu-id="4a0d5-163">高可用性 (HA)：可讓應用程式繼續在狀況良好狀態下執行，而不需要長期停機。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-163">High Availability (HA) is the ability of the application to continue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="4a0d5-164">「狀況良好狀態」是指應用程式有回應，而且使用者可以連線到應用程式並與其互動。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-164">By "healthy state," we mean the application is responsive, and users can connect to the application and interact with it.</span></span> <span data-ttu-id="4a0d5-165">某些任務關鍵性應用程式和資料庫可能必須永遠可供使用，即使平台發生失敗也一樣。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-165">Certain mission-critical applications and databases may be required to be available always, even when there are failures in the platform.</span></span> <span data-ttu-id="4a0d5-166">針對這些工作負載，您可能需要規劃應用程式及資料的備援。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-166">For these workloads, you may need to plan redundancy for the application as well as the data.</span></span>

2. <span data-ttu-id="4a0d5-167">資料持久性：在某些情況下，主要考量是確保發生災害時會保留資料。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-167">Data Durability: In some cases, the main consideration is ensuring the data is preserved in the case of a disaster.</span></span> <span data-ttu-id="4a0d5-168">因此，您可能需要在不同的網站上有資料備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-168">Therefore, you may need a backup of your data in a different site.</span></span> <span data-ttu-id="4a0d5-169">針對這類工作負載，您可能不需要對應用程式進行完整備援，而只要定期備份磁碟。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-169">For such workloads, you may not need full redundancy for the application, but a regular backup of the disks.</span></span>

## <a name="backup-and-dr-scenarios"></a><span data-ttu-id="4a0d5-170">備份和 DR 案例</span><span class="sxs-lookup"><span data-stu-id="4a0d5-170">Backup and DR Scenarios</span></span>

<span data-ttu-id="4a0d5-171">讓我們看看應用程式工作負載案例的一些典型範例，以及規劃災害復原的考量。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-171">Let’s look at a few typical examples of application workload scenarios and the considerations for planning Disaster Recovery.</span></span>

### <a name="scenario-1-major-database-solutions"></a><span data-ttu-id="4a0d5-172">案例 1：主要資料庫解決方案</span><span class="sxs-lookup"><span data-stu-id="4a0d5-172">Scenario 1: Major Database Solutions</span></span>

<span data-ttu-id="4a0d5-173">假設有一個可支援高可用性的生產環境資料庫伺服器，例如 SQL Server 或 Oracle。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-173">Consider a production database server like SQL Server or Oracle that can support High Availability.</span></span> <span data-ttu-id="4a0d5-174">重要的生產環境應用程式和使用者都相依於此資料庫。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-174">Critical production applications and users depend on this database.</span></span> <span data-ttu-id="4a0d5-175">此系統的災害復原方案可能需要支援下列需求：</span><span class="sxs-lookup"><span data-stu-id="4a0d5-175">The Disaster Recovery plan for this system may need to support the following requirements:</span></span>

1. <span data-ttu-id="4a0d5-176">資料必須是受保護且可復原的。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-176">Data must be protected and recoverable.</span></span>
2.  <span data-ttu-id="4a0d5-177">伺服器必須可供使用。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-177">Server must be available for use.</span></span>

<span data-ttu-id="4a0d5-178">這可能需要在與備份不同的區域中維護資料庫複本。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-178">This may require maintaining a replica of the database in a different region as a backup.</span></span> <span data-ttu-id="4a0d5-179">根據伺服器可用性和資料復原的需求，此解決方案的涵蓋範圍從「主動對主動」或「主動對被動」複本網站，到定期離線備份資料。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-179">Depending on the requirements for server availability and data recovery, the solution could range from an Active-Active or Active-Passive replica site to periodic offline backups of the data.</span></span> <span data-ttu-id="4a0d5-180">SQL Server 和 Oracle 等關聯式資料庫提供各種複寫選項。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-180">Relational databases such as SQL Server and Oracle provide various options for replication.</span></span> <span data-ttu-id="4a0d5-181">若是 SQL Server，可使用 [SQL Server Always On 可用性群組](https://msdn.microsoft.com/library/hh510230.aspx)來取得高可用性。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-181">For SQL Server, [SQL Server Always On Availability Groups](https://msdn.microsoft.com/library/hh510230.aspx) can be used for high availability.</span></span>

<span data-ttu-id="4a0d5-182">MongoDB 之類的 NoSQL 資料庫也支援以[複本](https://docs.mongodb.com/manual/replication/)進行備援。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-182">NoSQL databases like MongoDB also support [replicas](https://docs.mongodb.com/manual/replication/) for redundancy.</span></span> <span data-ttu-id="4a0d5-183">可使用高可用性複本。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-183">The replicas for high availability can be used.</span></span>

### <a name="scenario-2-a-cluster-of-redundant-vms"></a><span data-ttu-id="4a0d5-184">案例 2：備援 VM 的叢集</span><span class="sxs-lookup"><span data-stu-id="4a0d5-184">Scenario 2: A cluster of redundant VMs</span></span>

<span data-ttu-id="4a0d5-185">假設有一個由 VM 的叢集所處理的工作負載提供備援和負載平衡。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-185">Consider a workload handled by a cluster of VMs that provide redundancy and load balancing.</span></span> <span data-ttu-id="4a0d5-186">其中一個範例是區域中所部署的 Cassandra 叢集。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-186">One example would be a Cassandra cluster deployed in a region.</span></span> <span data-ttu-id="4a0d5-187">此架構類型已在該區域內提供高層級的備援。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-187">This type of architecture already provides a high level of redundancy within that region.</span></span> <span data-ttu-id="4a0d5-188">不過，為保護工作負載防範區域層級失敗，您應該考慮將叢集分散到兩個區域，或定期備份至另一個區域。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-188">However, to protect the workload from a regional level failure, you should consider spreading the cluster across two regions or making periodic backups to another region.</span></span>

### <a name="scenario-3-iaas-application-workload"></a><span data-ttu-id="4a0d5-189">案例 3：IaaS 應用程式工作負載</span><span class="sxs-lookup"><span data-stu-id="4a0d5-189">Scenario 3: IaaS Application Workload</span></span>

<span data-ttu-id="4a0d5-190">這可能是在 Azure VM 上執行的一般生產環境工作負載。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-190">This could be a typical production workload running on an Azure VM.</span></span> <span data-ttu-id="4a0d5-191">例如，它可能是保留網站內容和其他資源的 Web 伺服器或檔案伺服器。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-191">For example, it could be a web server or file server holding the content and other resources of a site.</span></span> <span data-ttu-id="4a0d5-192">它也可能是量身打造的商務應用程式，該應用程式會在 VM 上執行，並將其資料、資源和應用程式狀態儲存在 VM 磁碟上。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-192">It could also be a custom-built business application running on a VM that stored its data, resources, and application state on the VM disks.</span></span> <span data-ttu-id="4a0d5-193">在此情況下，請務必定期備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-193">In this case, it is important to make sure you take backups on a regular basis.</span></span> <span data-ttu-id="4a0d5-194">備份頻率應該根據 VM 工作負載的本質。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-194">Backup frequency should be based on the nature of the VM workload.</span></span> <span data-ttu-id="4a0d5-195">例如，如果應用程式每天執行並修改資料，則應該每小時進行備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-195">For example, if the application runs every day and modifies data, then the backup should be taken every hour.</span></span>

<span data-ttu-id="4a0d5-196">另一個範例是，報表伺服器從其他來源提取資料並產生彙總報表。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-196">Another example is a reporting server that pull data from other sources and generates aggregated reports.</span></span> <span data-ttu-id="4a0d5-197">遺失此 VM 或磁碟會導致遺失報表。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-197">Loss of this VM or disks will lead to the loss of the reports.</span></span> <span data-ttu-id="4a0d5-198">不過，您可以重新執行報告程序並重新產生輸出。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-198">However, it may be possible to rerun the reporting process and regenerate the output.</span></span> <span data-ttu-id="4a0d5-199">在此情況下，即使報表伺服器遇到災害，您實際上也不會遺失資料，由於遺失的是報表伺服器上的部分資料，因此您可能會有更高層級的容錯。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-199">In that case, you don’t really have a loss of data even if the reporting server is hit with a disaster, so you could have a higher level of tolerance for losing part of the data on the reporting server.</span></span> <span data-ttu-id="4a0d5-200">在此情況下，為降低成本，可選擇較不頻繁的備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-200">In that case, less frequent backups is an option to reduce the cost.</span></span>

### <a name="scenario-4-iaas-application-data-issues"></a><span data-ttu-id="4a0d5-201">案例 4：IaaS 應用程式資料問題</span><span class="sxs-lookup"><span data-stu-id="4a0d5-201">Scenario 4: IaaS Application data issues</span></span>

<span data-ttu-id="4a0d5-202">您有一個應用程式，可計算、維護及提供重要商用資料，例如價格資訊。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-202">You have an application that computes, maintains, and serves critical commercial data such as pricing information.</span></span> <span data-ttu-id="4a0d5-203">您的新版應用程式有軟體錯誤，未能正確地計算價格，而且平台所提供的現有商用資料已損毀。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-203">A new version of your application had a software bug which incorrectly computed the pricing and corrupted the existing commerce data served by the platform.</span></span> <span data-ttu-id="4a0d5-204">此時的最佳做法是先還原至舊版應用程式和資料。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-204">Here, the best course of action would be to revert to the earlier version of the application and the data first.</span></span> <span data-ttu-id="4a0d5-205">若要這麼做，請定期備份您的系統。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-205">To enable this, take periodic backups of your system.</span></span>

## <a name="disaster-recovery-solution-azure-backup-service"></a><span data-ttu-id="4a0d5-206">災害復原解決方案：Azure 備份服務</span><span class="sxs-lookup"><span data-stu-id="4a0d5-206">Disaster Recovery Solution: Azure Backup Service</span></span>

<span data-ttu-id="4a0d5-207">[Azure 備份服務](https://azure.microsoft.com/services/backup/)可用來進行備份和 DR，並適用於[受控磁碟](storage-managed-disks-overview.md)和[非受控磁碟](storage-about-disks-and-vhds-windows.md#unmanaged-disks)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-207">[Azure Backup Service](https://azure.microsoft.com/services/backup/) is can be used for Backup and DR, and it works with [Managed Disks](storage-managed-disks-overview.md) as well as [Unmanaged Disks](storage-about-disks-and-vhds-windows.md#unmanaged-disks).</span></span> <span data-ttu-id="4a0d5-208">您可以建立具有以時間為基礎的備份、簡易 VM 還原，以及備份保留原則的備份工作。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-208">You can create a backup job with time-based backups, easy VM restoration and backup retention policies.</span></span> 

<span data-ttu-id="4a0d5-209">如果您使用[進階儲存體磁碟](storage-premium-storage.md)、[受控磁碟](storage-managed-disks-overview.md)或啟用 [[本地備援儲存體 (LRS)]](storage-redundancy.md#locally-redundant-storage) 選項的其他磁碟類型，利用定期 DR 備份尤其重要。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-209">If you use [Premium Storage disks](storage-premium-storage.md), [Managed Disks](storage-managed-disks-overview.md), or other disk types with the [locally redundant storage (LRS)](storage-redundancy.md#locally-redundant-storage) option, it is especially important to leverage periodic DR backups.</span></span> <span data-ttu-id="4a0d5-210">Azure 備份會將資料儲存在復原服務保存庫中，以長期保留。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-210">Azure Backup stores the data in your Recovery Services vault for long term retention.</span></span> <span data-ttu-id="4a0d5-211">針對備份復原服務保存庫，選擇 [[異地備援儲存體 (GRS)]](storage-redundancy.md#geo-redundant-storage) 選項。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-211">Choose the [Geo-redundant storage (GRS)](storage-redundancy.md#geo-redundant-storage) option for the Backup Recovery Services vault.</span></span> <span data-ttu-id="4a0d5-212">如此可確保備份會複寫至不同的 Azure 區域，以防範區域性災害。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-212">That will ensure backups are replicated to a different Azure region for safeguarding from regional disasters.</span></span>

<span data-ttu-id="4a0d5-213">若是[非受控磁碟](storage-about-disks-and-vhds-windows.md#unmanaged-disks)，您可以針對 IaaS 磁碟使用 LRS 儲存體類型，但請確定 Azure 備份已啟用復原服務保存庫的 GRS 選項。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-213">For [Unmanaged Disks](storage-about-disks-and-vhds-windows.md#unmanaged-disks), you can use the LRS storage type for IaaS disks, but ensure that Azure Backup is enabled with the GRS option for the Recovery Services Vault.</span></span>

<span data-ttu-id="4a0d5-214">**如果您針對非受控磁碟使用 [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) 選項，您仍然需要一致性快照才能進行備份和 DR。**</span><span class="sxs-lookup"><span data-stu-id="4a0d5-214">**If you use the [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) option for your Unmanaged Disks, you still need consistent snapshots for Backup and DR.**</span></span> <span data-ttu-id="4a0d5-215">您必須使用 [Azure 備份服務](https://azure.microsoft.com/services/backup/)或[一致性快照](#alternative-solution-consistent-snapshots)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-215">You must use either [Azure Backup Service](https://azure.microsoft.com/services/backup/) or [consistent snapshots](#alternative-solution-consistent-snapshots).</span></span>

<span data-ttu-id="4a0d5-216">以下是 DR 解決方案的摘要。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-216">The following is a summary of solutions for DR.</span></span>

| <span data-ttu-id="4a0d5-217">案例</span><span class="sxs-lookup"><span data-stu-id="4a0d5-217">Scenario</span></span> | <span data-ttu-id="4a0d5-218">自動複寫</span><span class="sxs-lookup"><span data-stu-id="4a0d5-218">Automatic Replication</span></span> | <span data-ttu-id="4a0d5-219">DR 解決方案</span><span class="sxs-lookup"><span data-stu-id="4a0d5-219">DR Solution</span></span> |
| --- | --- | --- |
| <span data-ttu-id="4a0d5-220">進階儲存體磁碟</span><span class="sxs-lookup"><span data-stu-id="4a0d5-220">*Premium Storage Disks*</span></span> | <span data-ttu-id="4a0d5-221">本地 ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="4a0d5-221">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="4a0d5-222">Azure 備份</span><span class="sxs-lookup"><span data-stu-id="4a0d5-222">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="4a0d5-223">*受控磁碟*</span><span class="sxs-lookup"><span data-stu-id="4a0d5-223">*Managed Disks*</span></span> | <span data-ttu-id="4a0d5-224">本地 ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="4a0d5-224">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="4a0d5-225">Azure 備份</span><span class="sxs-lookup"><span data-stu-id="4a0d5-225">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="4a0d5-226">非受控 LRS 磁碟</span><span class="sxs-lookup"><span data-stu-id="4a0d5-226">*Unmanaged LRS Disks*</span></span> | <span data-ttu-id="4a0d5-227">本地 ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="4a0d5-227">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="4a0d5-228">Azure 備份</span><span class="sxs-lookup"><span data-stu-id="4a0d5-228">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="4a0d5-229">非受控 GRS 磁碟</span><span class="sxs-lookup"><span data-stu-id="4a0d5-229">*Unmanaged GRS Disks*</span></span> | <span data-ttu-id="4a0d5-230">跨區域 ([GRS](storage-redundancy.md#geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="4a0d5-230">Cross region ([GRS](storage-redundancy.md#geo-redundant-storage))</span></span> | [<span data-ttu-id="4a0d5-231">Azure 備份</span><span class="sxs-lookup"><span data-stu-id="4a0d5-231">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="4a0d5-232">一致性快照</span><span class="sxs-lookup"><span data-stu-id="4a0d5-232">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |
| <span data-ttu-id="4a0d5-233">非受控 RA-GRS 磁碟</span><span class="sxs-lookup"><span data-stu-id="4a0d5-233">*Unmanaged RA-GRS Disks*</span></span> | <span data-ttu-id="4a0d5-234">跨區域 ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="4a0d5-234">Cross region ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span></span> | [<span data-ttu-id="4a0d5-235">Azure 備份</span><span class="sxs-lookup"><span data-stu-id="4a0d5-235">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="4a0d5-236">一致性快照</span><span class="sxs-lookup"><span data-stu-id="4a0d5-236">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |

<span data-ttu-id="4a0d5-237">透過使用可用性設定組中的受控磁碟及 Azure 備份，即可達到最佳的高可用性。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-237">High availability can best by met through the use of Managed Disks in an Availability Set along with Azure Backup.</span></span> <span data-ttu-id="4a0d5-238">如果您使用非受控磁碟，您仍然可以使用 Azure 備份進行 DR。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-238">If you are using Unmanaged Disks, you can still  use Azure Backup for DR.</span></span> <span data-ttu-id="4a0d5-239">如果您無法使用 Azure 備份，替代的備份和 DR 解決方案是擷取[一致性快照](#alternative-solution-consistent-snapshots) (如稍後章節所述)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-239">If you are unable to use Azure Backup, then taking [consistent snapshots](#alternative-solution-consistent-snapshots) as described in a later section is an alternative solution for Backup and DR.</span></span>

<span data-ttu-id="4a0d5-240">應用程式或基礎結構層級的高可用性、備份和 DR 選項如下所示：</span><span class="sxs-lookup"><span data-stu-id="4a0d5-240">Your choices for high availability, backup and DR at Application or Infrastructure levels can be represented as below:</span></span>

| <span data-ttu-id="4a0d5-241">*Level*</span><span class="sxs-lookup"><span data-stu-id="4a0d5-241">*Level*</span></span> | <span data-ttu-id="4a0d5-242">高可用性</span><span class="sxs-lookup"><span data-stu-id="4a0d5-242">High Availability</span></span>   | <span data-ttu-id="4a0d5-243">備份/DR</span><span class="sxs-lookup"><span data-stu-id="4a0d5-243">Backup / DR</span></span> |
| --- | --- | --- |
| <span data-ttu-id="4a0d5-244">*應用程式*</span><span class="sxs-lookup"><span data-stu-id="4a0d5-244">*Application*</span></span> | <span data-ttu-id="4a0d5-245">SQL Always On</span><span class="sxs-lookup"><span data-stu-id="4a0d5-245">SQL Always On</span></span> | <span data-ttu-id="4a0d5-246">Azure 備份</span><span class="sxs-lookup"><span data-stu-id="4a0d5-246">Azure Backup</span></span> |
| <span data-ttu-id="4a0d5-247">基礎結構</span><span class="sxs-lookup"><span data-stu-id="4a0d5-247">*Infrastructure*</span></span>  | <span data-ttu-id="4a0d5-248">可用性設定組</span><span class="sxs-lookup"><span data-stu-id="4a0d5-248">Availability Set</span></span>  | <span data-ttu-id="4a0d5-249">使用一致性快照的 GRS</span><span class="sxs-lookup"><span data-stu-id="4a0d5-249">GRS with consistent snapshots</span></span> |

### <a name="using-the-azure-backup-service"></a><span data-ttu-id="4a0d5-250">使用 Azure 備份服務</span><span class="sxs-lookup"><span data-stu-id="4a0d5-250">Using the Azure Backup Service</span></span>

<span data-ttu-id="4a0d5-251">[Azure 備份](../backup/backup-azure-vms-introduction.md)可將執行 Windows 或 Linux 的 VM 備份至 Azure 復原服務保存庫。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-251">[Azure Backup](../backup/backup-azure-vms-introduction.md) can backup your VMs running Windows or Linux to the Azure Recovery Services Vault.</span></span> <span data-ttu-id="4a0d5-252">備份與還原業務重要資料之所以複雜，原因在於資料必須在產生資料的應用程式執行時進行備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-252">Backing up and restoring business-critical data is complicated by the fact that business-critical data must be backed up while the applications that produce the data are running.</span></span> <span data-ttu-id="4a0d5-253">為因應這種情形，Azure 備份使用磁碟區陰影服務 (VSS) 提供 Microsoft 工作負載的應用程式一致備份，以確保資料正確地寫入儲存體。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-253">To address this, Azure Backup provides application-consistent backups for Microsoft workloads by using the Volume Shadow Service (VSS) to ensure that data is written correctly to storage.</span></span> <span data-ttu-id="4a0d5-254">Linux VM 則只能進行檔案一致備份，因為 Linux 沒有相當於 VSS 的功能。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-254">For Linux VMs, only file-consistent backups are possible, since Linux does not have functionality equivalent to VSS.</span></span>

![][1]

<span data-ttu-id="4a0d5-255">Azure 備份在排定的時間起始備份工作時，會觸發 VM 中所安裝的備份延伸模組擷取時間點快照集。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-255">When Azure Backup initiates a backup job at the scheduled time, it triggers the backup extension installed in the VM to take a point-in-time snapshot.</span></span> <span data-ttu-id="4a0d5-256">快照集是與 VSS 搭配擷取的，可在不需將虛擬機器中磁碟關閉的狀況下，取得所有磁碟的一致性快照。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-256">A snapshot is taken in coordination with VSS to get a consistent snapshot of the disks in the virtual machine without having to shut it down.</span></span> <span data-ttu-id="4a0d5-257">VM 中的備份延伸模組會排清所有寫入，再擷取所有磁碟的一致性快照。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-257">The backup extension in the VM flushes all writes before taking the consistent snapshot of all the disks.</span></span> <span data-ttu-id="4a0d5-258">擷取快照集之後，Azure 備份會將資料傳輸至備份保存庫。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-258">After the snapshot is taken, the data is transferred by Azure Backup to the backup vault.</span></span> <span data-ttu-id="4a0d5-259">為了讓備份程序更有效率，服務會識別上次備份之後變更的資料區塊，並只傳輸這些區塊。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-259">To make the backup process more efficient, the service identifies and transfers only the blocks of data that have changed since the last backup.</span></span>


<span data-ttu-id="4a0d5-260">若要還原，您可以透過 Azure 備份檢視可用的備份，再起始還原。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-260">To restore, you can view the available backups through Azure Backup and then initiate a restore.</span></span> <span data-ttu-id="4a0d5-261">您可以透過 [Azure 入口網站](https://portal.azure.com/)、[使用 PowerShell](../backup/backup-azure-vms-automation.md ) 或使用 [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install)，建立並還原 Azure 備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-261">You can create and restore Azure backups through the [Azure portal](https://portal.azure.com/), [using PowerShell](../backup/backup-azure-vms-automation.md ), or using the [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install).</span></span> <span data-ttu-id="4a0d5-262">如需詳細資訊，請參閱＜Azure 備份＞。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-262">For more information, see Azure Backup.</span></span>

### <a name="steps-to-enable-backup"></a><span data-ttu-id="4a0d5-263">啟用備份的步驟</span><span class="sxs-lookup"><span data-stu-id="4a0d5-263">Steps to Enable Backup</span></span>

<span data-ttu-id="4a0d5-264">下列步驟通常可用來透過 [Azure 入口網站](https://portal.azure.com/)啟用 VM 的備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-264">The following steps are typically used to enable backups of your VMs using the [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="4a0d5-265">視您實際情況而定，會有一些變化。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-265">There will be some variations depending on your exact scenario.</span></span> <span data-ttu-id="4a0d5-266">請參閱 [Azure 備份](../backup/backup-azure-vms-introduction.md)文件以取得完整詳細資料。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-266">Refer to the [Azure Backup](../backup/backup-azure-vms-introduction.md) documentation for full details.</span></span> <span data-ttu-id="4a0d5-267">Azure 備份也[支援 VM 與受控磁碟](https://azure.microsoft.com/blog/azure-managed-disk-backup/)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-267">Azure Backup also [supports VMs with Managed Disks](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span></span>

1.  <span data-ttu-id="4a0d5-268">使用下列步驟建立 VM 的復原服務保存庫：</span><span class="sxs-lookup"><span data-stu-id="4a0d5-268">Create a recovery services vault for a VM using the following steps:</span></span>

    <span data-ttu-id="4a0d5-269">a.</span><span class="sxs-lookup"><span data-stu-id="4a0d5-269">a.</span></span>  <span data-ttu-id="4a0d5-270">使用 [Azure 入口網站](https://portal.azure.com/)，瀏覽所有資源並尋找「復原服務保存庫」。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-270">Using the [Azure portal](https://portal.azure.com/), browse all resources and find “Recovery Services vaults”.</span></span>

    <span data-ttu-id="4a0d5-271">b.這是另一個 C# 主控台應用程式。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-271">b.</span></span>  <span data-ttu-id="4a0d5-272">在 [復原服務保存庫] 功能表上，按一下 [新增]，然後遵循步驟以在與 VM 相同的區域中建立新的保存庫。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-272">On the Recovery Services vaults menu, click Add and follow the steps to create a new vault in the same region as the VM.</span></span> <span data-ttu-id="4a0d5-273">例如，如果您的 VM 位於美國西部地區，請選取美國西部作為保存庫。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-273">For example, if your VM is in West US region, pick West US for the vault.</span></span>

2.  <span data-ttu-id="4a0d5-274">確認新建立保存庫的儲存體複寫。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-274">Verify the Storage replication for the newly created vault.</span></span> <span data-ttu-id="4a0d5-275">若要執行這項操作，請從 [復原服務保存庫] 刀鋒視窗存取保存庫，然後移至設定/[備份設定]。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-275">To do this, access the vault from the Recovery Services vaults blade and go to the settings/Backup Configuration.</span></span> <span data-ttu-id="4a0d5-276">確定預設已選取 GRS 選項。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-276">Ensure the GRS option is selected by default.</span></span> <span data-ttu-id="4a0d5-277">如此可確保您的保存庫會自動複寫至次要資料中心。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-277">This will ensure that your vault is automatically replicated to a secondary data center.</span></span> <span data-ttu-id="4a0d5-278">例如，您在美國西部的保存庫會自動複寫至美國東部。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-278">For example, your vault in West US will be automatically replicated to East US.</span></span>

3.  <span data-ttu-id="4a0d5-279">設定備份原則，然後從相同的 UI 中選取 VM。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-279">Configure the backup policy and select the VM from the same UI.</span></span>

4.  <span data-ttu-id="4a0d5-280">確認已在 VM 上安裝備份代理程式。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-280">Make sure the Backup Agent is installed on the VM.</span></span> <span data-ttu-id="4a0d5-281">如果使用 Azure 資源庫映像建立 VM，則已安裝備份代理程式。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-281">If your VM is created using an Azure gallery image, then the Backup agent is already installed.</span></span> <span data-ttu-id="4a0d5-282">否則 (也就是如果您使用自訂映像)，請使用指示[在虛擬機器中安裝 VM 代理程式](../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-282">Otherwise (that is, if you are using a custom image), use instructions to [Install the VM Agent on the virtual machine](../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span></span>

5.  <span data-ttu-id="4a0d5-283">確定 VM 允許網路連線，備份服務才能運作正常。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-283">Make sure that the VM allows network connectivity for the backup service to function.</span></span> <span data-ttu-id="4a0d5-284">請遵循[網路連線](../backup/backup-azure-arm-vms-prepare.md#network-connectivity)的這些指示。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-284">Follow these instructions for [Network connectivity](../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span></span>

6.  <span data-ttu-id="4a0d5-285">一旦完成上述步驟，備份將會依照備份原則中指定的間隔定期執行。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-285">Once the above steps are completed, the backup will run at regular intervals as specified in the backup policy.</span></span> <span data-ttu-id="4a0d5-286">如有必要，您可以從 Azure 入口網站上的保存庫儀表板，以手動方式觸發第一個備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-286">If necessary, you can trigger the first backup manually from the vault dashboard on the Azure portal.</span></span>

<span data-ttu-id="4a0d5-287">如需使用指令碼將 Azure 備份自動化，請參閱 [VM 備份的 PowerShell Cmdlet](../backup/backup-azure-vms-automation.md)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-287">For automating Azure Backup using scripts, please refer to [PowerShell cmdlets for VM backup](../backup/backup-azure-vms-automation.md).</span></span>

### <a name="steps-for-recovery"></a><span data-ttu-id="4a0d5-288">復原步驟</span><span class="sxs-lookup"><span data-stu-id="4a0d5-288">Steps for Recovery</span></span>

<span data-ttu-id="4a0d5-289">如果您需要修復或重建 VM，您可以從保存庫中的任何備份復原點還原 VM。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-289">If you need to repair or rebuild a VM, you can restore the VM from any of the backup recovery points in the vault.</span></span> <span data-ttu-id="4a0d5-290">有幾個不同的選項可執行復原：</span><span class="sxs-lookup"><span data-stu-id="4a0d5-290">There are a couple of different options for performing the recovery:</span></span>

1.  <span data-ttu-id="4a0d5-291">您可以建立新的 VM 作為已備份 VM 的時間點表示。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-291">You can create a new VM as a point-in-time representation of your backed-up VM.</span></span>

2.  <span data-ttu-id="4a0d5-292">您可以還原磁碟，然後使用 VM 的範本來自訂及重建還原的 VM。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-292">You can restore the disks and then use the template for the VM to customize and rebuild the restored VM.</span></span> 

<span data-ttu-id="4a0d5-293">請參閱指示以[使用 Azure 入口網站來還原虛擬機器](../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-293">See instructions to [Use Azure portal to restore virtual machines](../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span></span> <span data-ttu-id="4a0d5-294">本文件也說明在主要資料中心發生災害時，使用您的異地備援備份保存庫將備份的 VM 還原至成對資料中心的特定步驟。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-294">The document also explains the specific steps for restoring backed-up VMs to the paired data center using your geo-redundant backup vault in the case of a disaster at the primary data center.</span></span> <span data-ttu-id="4a0d5-295">在此情況下，Azure 備份會使用次要區域的計算服務來建立還原的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-295">In that case, Azure Backup uses the Compute service from the secondary region to create the restored virtual machine.</span></span>

<span data-ttu-id="4a0d5-296">您也可以使用 PowerShell 來[還原 VM](../backup/backup-azure-vms-automation.md#restore-an-azure-vm)，或[從還原的磁碟建立新的 VM](../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-296">You can also use PowerShell for [restoring a VM](../backup/backup-azure-vms-automation.md#restore-an-azure-vm) or for [creating a new VM from restored disks](../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span></span>

## <a name="alternative-solution-consistent-snapshots"></a><span data-ttu-id="4a0d5-297">替代解決方案：一致性快照</span><span class="sxs-lookup"><span data-stu-id="4a0d5-297">Alternative Solution: Consistent Snapshots</span></span>

<span data-ttu-id="4a0d5-298">如果您無法使用 Azure 備份服務，您可以使用快照集實作自己的備份機制。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-298">If you are unable to use the Azure Backup Service, you can implement your own backup mechanism using snapshots.</span></span> <span data-ttu-id="4a0d5-299">為 VM 使用的所有磁碟建立一致性快照，然後將這些快照集複寫至另一個區域很複雜。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-299">It is complicated to create consistent snapshots for all disks used by a VM and then replicate those snapshots to another region.</span></span> <span data-ttu-id="4a0d5-300">因此，Azure 認為利用備份服務，會是比建置自訂解決方案更好的選擇。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-300">For this reason, Azure considers leveraging the Backup Service a better option than building a custom solution.</span></span> <span data-ttu-id="4a0d5-301">如果針對磁碟使用 GRS/RA-GRS 儲存體，則會自動將快照集複寫至次要資料中心。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-301">If you use RA-GRS/GRS storage for disks, snapshots are automatically replicated to a secondary data center.</span></span> <span data-ttu-id="4a0d5-302">如果針對磁碟使用 LRS 儲存體，則必須自行複寫資料。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-302">If you use LRS storage for disks, you will need to replicate the data yourself.</span></span> <span data-ttu-id="4a0d5-303">如需詳細資訊，請參閱[以增量快照備份 Azure 非受控 VM 磁碟](storage-incremental-snapshots.md)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-303">For more information, see [Back up Azure unmanaged VM disks with incremental snapshots](storage-incremental-snapshots.md).</span></span>

<span data-ttu-id="4a0d5-304">快照集是物件在特定時間點的表示。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-304">A snapshot is a representation of an object at a specific point in time.</span></span> <span data-ttu-id="4a0d5-305">快照集會針對其保留的資料大小增量予以收費。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-305">A snapshot will incur billing for the incremental size of the data it holds.</span></span> <span data-ttu-id="4a0d5-306">如需詳細資訊，請參閱[建立 Blob 快照集](storage-blob-snapshots.md)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-306">For more information, see [Create a blob snapshot](storage-blob-snapshots.md).</span></span>

### <a name="creating-snapshots-while-the-vm-is-running"></a><span data-ttu-id="4a0d5-307">在 VM 執行時建立快照集</span><span class="sxs-lookup"><span data-stu-id="4a0d5-307">Creating snapshots while the VM is running</span></span>

<span data-ttu-id="4a0d5-308">雖然您可以隨時擷取快照集，但如果 VM 正在執行，仍然會有資料串流處理到磁碟，而且快照集可能包含進行中的部分作業。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-308">While you can take a snapshot at any time, if the VM is running, there is still data being streamed to the disks, and the snapshots may contain partial operations that were in flight.</span></span> <span data-ttu-id="4a0d5-309">此外，如果涉及多個磁碟，則可能在不同時間發生不同磁碟的快照集，這表示這些快照集可能不一致。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-309">Also, if there are several disks involved, the snapshots of different disks may have occurred at different times, which means these snapshots may not be coordinated.</span></span> <span data-ttu-id="4a0d5-310">等量磁碟區特別會有此問題，如果在備份期間發生變更，其中所包含的檔案可能會損毀。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-310">This is especially problematic for striped volumes whose files can be corrupted if changes were being made during backup.</span></span>

<span data-ttu-id="4a0d5-311">為避免這種情況，備份程序必須實作下列步驟：</span><span class="sxs-lookup"><span data-stu-id="4a0d5-311">To avoid this situation, the backup process must implement the following steps:</span></span>

1.  <span data-ttu-id="4a0d5-312">凍結所有磁碟</span><span class="sxs-lookup"><span data-stu-id="4a0d5-312">Freeze all the disks</span></span>

2.  <span data-ttu-id="4a0d5-313">排清所有擱置中寫入</span><span class="sxs-lookup"><span data-stu-id="4a0d5-313">Flush all the pending writes</span></span>

3.  <span data-ttu-id="4a0d5-314">然後，為所有磁碟[建立 Blob 快照集](storage-blob-snapshots.md)</span><span class="sxs-lookup"><span data-stu-id="4a0d5-314">Then, [create a blob snapshot](storage-blob-snapshots.md) for all the disks</span></span>

<span data-ttu-id="4a0d5-315">某些 Windows 應用程式 (例如 SQL Server) 提供一致備份機制，透過 VSS 建立應用程式一致備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-315">Some Windows applications like SQL Server provide a coordinated backup mechanism via VSS to create application-consistent backups.</span></span> <span data-ttu-id="4a0d5-316">在 Linux 上，您可以使用 fsfreeze 等工具來協調磁碟，這會提供檔案一致備份，而不是應用程式一致性快照。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-316">On Linux, you can use a tool like fsfreeze for coordinating the disks, which will provide file-consistent backups, but not application-consistent snapshots.</span></span> <span data-ttu-id="4a0d5-317">此程序很複雜，因此您應該考慮使用 [Azure 備份](../backup/backup-azure-vms-introduction.md)，或是已實作此作業的協力廠商備份解決方案。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-317">This process is complicated, so and you should consider using [Azure Backup](../backup/backup-azure-vms-introduction.md) or a third-party backup solution which already implement this.</span></span>

<span data-ttu-id="4a0d5-318">上述程序將會產生所有 VM 磁碟的一致性快照集合，代表 VM 的特定時間點檢視。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-318">The above process will result in a collection of coordinated snapshots for all the VM disks, representing a specific point-in-time view of the VM.</span></span> <span data-ttu-id="4a0d5-319">這是 VM 的備份還原點。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-319">This is a backup restore point for the VM.</span></span> <span data-ttu-id="4a0d5-320">您可以在排程的間隔重複此程序，以建立定期備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-320">You can repeat the process at scheduled intervals to create periodic backups.</span></span> <span data-ttu-id="4a0d5-321">請參閱下列步驟[將備份複製到另一個區域](#copy-the-snapshots-to-another-region)以進行 DR。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-321">See below for the steps to [copy the backups to another region](#copy-the-snapshots-to-another-region) for DR.</span></span>

### <a name="creating-snapshots-while-the-vm-is-offline"></a><span data-ttu-id="4a0d5-322">在 VM 離線時建立快照集</span><span class="sxs-lookup"><span data-stu-id="4a0d5-322">Creating snapshots while the VM is offline</span></span>

<span data-ttu-id="4a0d5-323">建立一致備份的另一個選擇是關閉 VM 並擷取每個磁碟的 Blob 快照集。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-323">Another option to create consistent backups is shutting down the VM and taking blob snapshots of each disk.</span></span> <span data-ttu-id="4a0d5-324">這比協調執行中 VM 的快照集更容易，但需要停機幾分鐘。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-324">This is easier than coordinating snapshots of a running VM, but it requires a few minutes of downtime.</span></span> <span data-ttu-id="4a0d5-325">若要進行此程序，請遵循下列步驟：</span><span class="sxs-lookup"><span data-stu-id="4a0d5-325">For this process, follow these steps:</span></span>

1. <span data-ttu-id="4a0d5-326">關閉 VM。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-326">Shut down the VM.</span></span>

2. <span data-ttu-id="4a0d5-327">建立每個 VHD Blob 的快照集，只需幾秒鐘的時間。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-327">Create a snapshot of each VHD blob, which only takes a few seconds.</span></span>

    <span data-ttu-id="4a0d5-328">若要建立快照集，您可以使用 [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots)、[Azure 儲存體 Rest API](https://msdn.microsoft.com/library/azure/ee691971.aspx)、[Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install)，或其中一個 Azure 儲存體用戶端程式庫，例如[適用於 .NET 的儲存體用戶端程式庫](https://msdn.microsoft.com/library/azure/hh488361.aspx)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-328">To create a snapshot, you can use [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), the [Azure Storage Rest API](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install), or one of the Azure Storage Client Libraries such as [the Storage client library for .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

3. <span data-ttu-id="4a0d5-329">啟動 VM，這會結束停機時間。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-329">Start the VM, which ends the downtime.</span></span> <span data-ttu-id="4a0d5-330">整個程序通常會在幾分鐘內完成。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-330">Typically the entire process completes within a few minutes.</span></span>

<span data-ttu-id="4a0d5-331">此程序會產生所有磁碟的一致性快照集合，為 VM 提供備份還原點。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-331">This process yields a collection of consistent snapshots for all the disks, providing a backup restore point for the VM.</span></span> <span data-ttu-id="4a0d5-332">請參閱下列步驟將快照集複製到另一個區域以進行 DR。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-332">See below for the steps to copy the snapshots to another region for DR.</span></span>

### <a name="copy-the-snapshots-to-another-region"></a><span data-ttu-id="4a0d5-333">將快照集複製到另一個區域</span><span class="sxs-lookup"><span data-stu-id="4a0d5-333">Copy the snapshots to another region</span></span>

<span data-ttu-id="4a0d5-334">光是建立快照集可能不足以進行 DR。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-334">Creation of the snapshots alone may not be sufficient for DR.</span></span> <span data-ttu-id="4a0d5-335">您也必須將快照集備份複寫至另一個區域。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-335">You must also replicate the snapshot backups to another region.</span></span>

<span data-ttu-id="4a0d5-336">如果針對磁碟使用 GRS 或 RA-GRS，則會自動將快照集複寫至次要區域。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-336">If you are using GRS or RA-GRS for your disks, then the snapshots are replicated to the secondary region automatically.</span></span> <span data-ttu-id="4a0d5-337">複寫前可能有幾分鐘的延遲，而且如果主要資料中心在快照集完成複寫前關閉，您將無法從次要資料中心存取快照集。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-337">There can be a few minutes of lag before the replication, and if the primary data center goes down before the snapshots finish replicating, you will not be able to access the snapshots from the secondary data center.</span></span> <span data-ttu-id="4a0d5-338">這個可能性很小。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-338">The likelihood of this is small.</span></span>

> [!Note] 
> <span data-ttu-id="4a0d5-339">只在 GRS 或 RA-GRS 帳戶中保留磁碟，並無法保護 VM 防範災害。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-339">Only having the disks in a GRS or RA-GRS account does not protect the VM from disasters.</span></span> <span data-ttu-id="4a0d5-340">您還必須建立一致性快照或使用 Azure 備份。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-340">You must also create coordinated snapshots or use Azure Backup.</span></span> <span data-ttu-id="4a0d5-341">若要將 VM 復原至一致的狀態，則需要這樣做。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-341">This is required to recover a VM to a consistent state.</span></span>

<span data-ttu-id="4a0d5-342">如果您使用 LRS，則必須在建立快照集之後，立即將快照集複製到不同的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-342">If you are using LRS, you must copy the snapshots to a different storage account immediately after creating the snapshot.</span></span> <span data-ttu-id="4a0d5-343">複製目標可能是不同區域中的 LRS 儲存體帳戶，而導致複本位於遠端區域。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-343">The copy target could be an LRS storage account in a different region, resulting in the copy being in a remote region.</span></span> <span data-ttu-id="4a0d5-344">您也可以將快照集複製到相同區域中的 RA-GRS 儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-344">You can also copy the snapshot to an RA-GRS storage account in the same region.</span></span> <span data-ttu-id="4a0d5-345">在此情況下，快照集會延遲複寫至遠端次要區域。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-345">In this case, the snapshot will be lazily replicated to the remote secondary region.</span></span> <span data-ttu-id="4a0d5-346">一旦複製和複寫完成，您的備份就可在主要站台發生災害時受到保護。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-346">Your backup is protected from disasters at the primary site once the copying and replication is complete.</span></span>

<span data-ttu-id="4a0d5-347">若要有效率地複製增量快照以進行 DR，請檢閱[以增量快照備份 Azure 非受控 VM 磁碟](storage-incremental-snapshots.md)中的指示。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-347">To copy your incremental snapshots for DR efficiently, review the instructions in [Back up Azure unmanaged VM disks with incremental snapshots](storage-incremental-snapshots.md).</span></span>

![][2]

### <a name="recovery-from-snapshots"></a><span data-ttu-id="4a0d5-348">從快照集復原</span><span class="sxs-lookup"><span data-stu-id="4a0d5-348">Recovery from Snapshots</span></span>

<span data-ttu-id="4a0d5-349">若要擷取快照集，請加以複製以建立新的 Blob。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-349">To retrieve a snapshot, copy it to make a new blob.</span></span> <span data-ttu-id="4a0d5-350">如果您要從主要帳戶複製快照集，您可以將快照集複製到快照集的基底 Blob，進而將磁碟還原至快照集；這稱為升級快照集。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-350">If you are copying the snapshot from the primary account, you can copy the snapshot over to the base blob of the snapshot, thus reverting the disk to the snapshot; this is known as promoting the snapshot.</span></span> <span data-ttu-id="4a0d5-351">如果您要從次要帳戶 (在本例中為 RA-GRS) 複製快照集備份，則必須複製到主要帳戶。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-351">If you are copying the snapshot backup from a secondary account (in the case of RA-GRS), it must be copied to a primary account.</span></span> <span data-ttu-id="4a0d5-352">您可以[使用 PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) 或使用 AzCopy 公用程式來複製快照集。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-352">You can copy a snapshot [using PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) or using the AzCopy utility.</span></span> <span data-ttu-id="4a0d5-353">如需詳細資訊，請參閱[使用 AzCopy 命令列公用程式傳輸資料](storage-use-azcopy.md)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-353">For more information, see [Transfer data with the AzCopy Command-Line Utility](storage-use-azcopy.md).</span></span>

<span data-ttu-id="4a0d5-354">如果 VM 有多個磁碟，您必須複製屬於同一個一致還原點的所有快照集。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-354">In the case of VMs with multiple disks, you must copy all the snapshots that are part of the same coordinated restore point.</span></span> <span data-ttu-id="4a0d5-355">一旦您將快照集複製到可寫入的 VHD Blob，就可以使用 Blob 透過 VM 的範本重新建立 VM。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-355">Once you copy the snapshots to writable VHD blobs, you can use the blobs to recreate your VM using the template for the VM.</span></span>

## <a name="other-options"></a><span data-ttu-id="4a0d5-356">其他選項</span><span class="sxs-lookup"><span data-stu-id="4a0d5-356">Other options</span></span>

### <a name="sql-server"></a><span data-ttu-id="4a0d5-357">SQL Server</span><span class="sxs-lookup"><span data-stu-id="4a0d5-357">SQL Server</span></span>

<span data-ttu-id="4a0d5-358">在 VM 中執行的 SQL Server 有其本身內建的功能，可將您的 SQL Server 資料庫備份至 Azure Blob 儲存體或檔案共用。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-358">SQL Server running in a VM has its own built-in capabilities to backup your SQL Server database to Azure Blob storage or a file share.</span></span> <span data-ttu-id="4a0d5-359">如果儲存體帳戶是 GRS 或 RA-GRS，您可以在發生災害時，存取儲存體帳戶之次要資料中心內的備份，其限制如上所述。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-359">If the storage account is GRS or RA-GRS, you can access those backups in the storage account’s secondary data center in the event of a disaster, with the same restrictions as discussed previously.</span></span> <span data-ttu-id="4a0d5-360">如需詳細資訊，請參閱 [Azure 虛擬機器中 SQL Server 的備份與還原](../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-360">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span></span> <span data-ttu-id="4a0d5-361">除了備份和還原之外，[SQL Server Always On 可用性群組](../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md)可以維護資料庫的次要複本，以大幅縮短災害復原時間。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-361">In addition to backup and restore, [SQL Server Always On Availability Groups](../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) can maintain secondary replicas of databases to greatly reduce the disaster recovery time.</span></span>

## <a name="other-considerations"></a><span data-ttu-id="4a0d5-362">其他考量</span><span class="sxs-lookup"><span data-stu-id="4a0d5-362">Other considerations</span></span>

<span data-ttu-id="4a0d5-363">本文已說明如何備份您的 VM 及其磁碟或擷取快照集以支援災害復原，以及如何使用這些備份或快照集進行復原。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-363">This article has discussed how to backup or take snapshots of your VMs and their disks to support disaster recovery, and how to use those to recover.</span></span> <span data-ttu-id="4a0d5-364">在 Azure Resource Manager 模型中，許多人使用範本在 Azure 中建立其 VM 和其他基礎結構。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-364">With the Azure Resource Manager model, many people use templates to create their VMs and other infrastructure in Azure.</span></span> <span data-ttu-id="4a0d5-365">您可以使用範本來建立 VM，以便每次都有相同的設定。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-365">You can use a template to create a VM that has the same configuration every time.</span></span> <span data-ttu-id="4a0d5-366">如果您使用自訂映像來建立 VM，您還必須使用 RA-GRS 帳戶儲存映像，以確保映像受到保護。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-366">If you use custom images for creating your VMs, you must also make sure your images are protected by using an RA-GRS account to store them.</span></span>

<span data-ttu-id="4a0d5-367">因此，備份程序可能包含下列兩項：</span><span class="sxs-lookup"><span data-stu-id="4a0d5-367">Consequently, your backup process may be a combination of two things:</span></span>

1. <span data-ttu-id="4a0d5-368">備份資料 (磁碟)</span><span class="sxs-lookup"><span data-stu-id="4a0d5-368">Backup the data (disks)</span></span>
2. <span data-ttu-id="4a0d5-369">備份設定 (範本、自訂映像)</span><span class="sxs-lookup"><span data-stu-id="4a0d5-369">Backup the configuration (templates, custom images)</span></span>

<span data-ttu-id="4a0d5-370">視您選擇的備份選項而定，您可能必須處理資料和設定的備份，或備份服務可能會為您處理所有作業。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-370">Depending on the backup option you choose, you may have to handle the backup of both the data and the configuration, or the backup service may handle all of that for you.</span></span>

## <a name="appendix---understanding-the-impact-of-lrs-grs-and-ra-grs"></a><span data-ttu-id="4a0d5-371">附錄 - 了解 LRS、GRS 和 RA-GRS 的影響</span><span class="sxs-lookup"><span data-stu-id="4a0d5-371">Appendix - Understanding the impact of LRS, GRS, and RA-GRS</span></span>

<span data-ttu-id="4a0d5-372">對於 Azure 中的儲存體帳戶而言，有三種資料備援類型可視為與災害復原相關，那就是本地備援 (LRS)、異地備援 (GRS) 或具有讀取權限的異地備援 (RA-GRS)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-372">For storage accounts in Azure, there are three types of data redundancy that you should consider regarding disaster recovery – locally redundant (LRS), geo-redundant (GRS), or geo-redundant with read access (RA-GRS).</span></span> 

<span data-ttu-id="4a0d5-373">本地備援儲存體 (LRS) 會在同一個資料中心保留三份資料複本。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-373">Locally Redundant Storage (LRS) retains three copies of the data in the same data center.</span></span> <span data-ttu-id="4a0d5-374">寫入資料時，會更新所有三個複本再將成功傳回呼叫者，因此您知道這些複本完全相同。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-374">When writing the data, all three copies are updated before success is returned to the caller, so you know they are identical.</span></span> <span data-ttu-id="4a0d5-375">您的磁碟可防範本機失敗，因為不太可能同時影響所有三個複本。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-375">Your disk is protected from local failures, since it is extremely unlikely that all three copies would be impacted at the same time.</span></span> <span data-ttu-id="4a0d5-376">在 LRS 的案例中，沒有異地備援，因此磁碟無法防範可能影響整個資料中心或儲存單位的重大失敗。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-376">In the case of LRS, there is no geo-redundancy, so the disk is not protected from catastrophic failures that can impact an entire data center or storage unit.</span></span>

<span data-ttu-id="4a0d5-377">使用 GRS 和 RA-GRS，會在主要區域 (由您選取) 中保留三份資料複本，並在對應的次要區域 (由 Azure 設定) 中保留更多資料複本。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-377">With GRS and RA-GRS, three copies of your data are retained in the primary region (selected by you), and three more copies of your data are retained in a corresponding secondary region (set by Azure).</span></span> <span data-ttu-id="4a0d5-378">例如，如果您在美國西部儲存資料，資料將會複寫至美國東部。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-378">For example, if you store data in West US, the data will be replicated to East US.</span></span> <span data-ttu-id="4a0d5-379">這會以非同步方式完成，而且主要更新與次要更新之間有些延遲。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-379">This is done asynchronously, and there is a small delay between updates to the primary and secondary.</span></span> <span data-ttu-id="4a0d5-380">次要站台上的磁碟複本在每個磁碟上都是一致的 (具有延遲)，但多個作用中磁碟的複本可能不會**彼此**同步。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-380">Replicas of the disks on the secondary site are consistent on a per-disk basis (with the delay), but replicas of multiple active disks may not be in sync **with each other**.</span></span> <span data-ttu-id="4a0d5-381">若要讓多個磁碟之間有一致複本，則需要一致性快照。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-381">To have consistent replicas across multiple disks, consistent snapshots are needed.</span></span>

<span data-ttu-id="4a0d5-382">GRS 和 RA-GRS 之間的主要差異是，使用 RA-GRS，您可以隨時讀取次要複本。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-382">The main difference between GRS and RA-GRS is that with RA-GRS, you can read the secondary copy at any time.</span></span> <span data-ttu-id="4a0d5-383">如果發生問題導致無法存取主要區域中的資料，Azure 團隊會盡全力還原存取。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-383">If there is a problem that renders the data in the primary region inaccessible, the Azure team will make every effort to restore access.</span></span> <span data-ttu-id="4a0d5-384">雖然主要已關閉，但如果您啟用 RA-GRS，您可以存取次要資料中心內的資料。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-384">While the primary is down, if you have RA-GRS enabled, you can access the data in the secondary data center.</span></span> <span data-ttu-id="4a0d5-385">因此，如果您打算在無法存取主要時從複本讀取，則應該考慮使用 RA-GRS。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-385">Therefore, if you plan to read from the replica while the primary is inaccessible, then RA-GRS should be considered.</span></span>

<span data-ttu-id="4a0d5-386">如果結果是嚴重的中斷，Azure 團隊可能會觸發異地容錯移轉，然後變更主要 DNS 項目以指向次要儲存體。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-386">If it turns out to be a significant outage, the Azure team may trigger a geo-failover and change the primary DNS entries to point to secondary storage.</span></span> <span data-ttu-id="4a0d5-387">此時，如果您啟用 GRS 或 RA-GRS，您可以存取之前為次要區域中的資料。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-387">At this point, if you have either GRS or RA-GRS enabled, you can access the data in the region that used to be the secondary.</span></span> <span data-ttu-id="4a0d5-388">換句話說，如果您的儲存體帳戶是 GRS 並發生問題，只有在具異地容錯移轉時才能存取次要儲存體。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-388">In other words, if your storage account is GRS and there is a problem, you can access the secondary storage only if there is a geo-failover.</span></span>

<span data-ttu-id="4a0d5-389">如需詳細資訊，請參閱[如果 Azure 儲存體發生中斷怎麼辦](storage-disaster-recovery-guidance.md)。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-389">For more information, see [What to do if an Azure Storage outage occurs](storage-disaster-recovery-guidance.md).</span></span> 

<span data-ttu-id="4a0d5-390">請注意，Microsoft 會控制是否發生容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-390">Note that Microsoft controls whether a failover occurs.</span></span> <span data-ttu-id="4a0d5-391">容錯移轉不是針對每個儲存體帳戶所控制，因此不會由個別客戶來決定。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-391">Failover is not controlled per storage account, therefore it is not decided by individual customers.</span></span> <span data-ttu-id="4a0d5-392">若要實作特定儲存體帳戶或虛擬機器磁碟的災害復原，您必須使用本文稍早所述的技術。</span><span class="sxs-lookup"><span data-stu-id="4a0d5-392">To implement Disaster Recovery for specific storage accounts or virtual machine disks, you must use the techniques described previously in this article.</span></span>



[1]: ./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-1.png
[2]: ./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-2.png