---
title: "Azure 儲存體安全性指南 | Microsoft Docs"
description: "詳述許多保護 Azure 儲存體的方法，包括但不限於 RBAC、儲存體服務加密、用戶端加密、SMB 3.0 及 Azure 磁碟加密。"
services: storage
documentationcenter: .net
author: robinsh
manager: timlt
editor: tysonn
ms.assetid: 6f931d94-ef5a-44c6-b1d9-8a3c9c327fb2
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 12/08/2016
ms.author: robinsh
ms.openlocfilehash: e71d9baf36ea7acb8dc8fa1daf9ddde3a2856f85
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="azure-storage-security-guide"></a><span data-ttu-id="b42aa-103">Azure 儲存體安全性指南</span><span class="sxs-lookup"><span data-stu-id="b42aa-103">Azure Storage security guide</span></span>
## <a name="overview"></a><span data-ttu-id="b42aa-104">概觀</span><span class="sxs-lookup"><span data-stu-id="b42aa-104">Overview</span></span>
<span data-ttu-id="b42aa-105">Azure 儲存體提供一組完整的安全性功能，讓開發人員能夠共同建置安全應用程式。</span><span class="sxs-lookup"><span data-stu-id="b42aa-105">Azure Storage provides a comprehensive set of security capabilities which together enable developers to build secure applications.</span></span> <span data-ttu-id="b42aa-106">您可以使用角色型存取控制與 Azure Active Directory 來保護儲存體帳戶本身。</span><span class="sxs-lookup"><span data-stu-id="b42aa-106">The storage account itself can be secured using Role-Based Access Control and Azure Active Directory.</span></span> <span data-ttu-id="b42aa-107">您可以使用[用戶端加密](../storage-client-side-encryption.md)、HTTPS 或 SMB 3.0，在應用程式和 Azure 之間進行傳輸時保護資料的安全。</span><span class="sxs-lookup"><span data-stu-id="b42aa-107">Data can be secured in transit between an application and Azure by using [Client-Side Encryption](../storage-client-side-encryption.md), HTTPS, or SMB 3.0.</span></span> <span data-ttu-id="b42aa-108">使用 [儲存體服務加密 (SSE)](storage-service-encryption.md)寫入 Azure 儲存體時，可將資料設定為自動加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-108">Data can be set to be automatically encrypted when written to Azure Storage using [Storage Service Encryption (SSE)](storage-service-encryption.md).</span></span> <span data-ttu-id="b42aa-109">您可以使用 [Azure 磁碟加密](../../security/azure-security-disk-encryption.md)，將虛擬機器所使用的作業系統和資料磁碟設定為加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-109">OS and Data disks used by virtual machines can be set to be encrypted using [Azure Disk Encryption](../../security/azure-security-disk-encryption.md).</span></span> <span data-ttu-id="b42aa-110">Azure 儲存體中資料物件的委派存取權可以使用 [共用存取簽章](../storage-dotnet-shared-access-signature-part-1.md)來授與。</span><span class="sxs-lookup"><span data-stu-id="b42aa-110">Delegated access to the data objects in Azure Storage can be granted using [Shared Access Signatures](../storage-dotnet-shared-access-signature-part-1.md).</span></span>

<span data-ttu-id="b42aa-111">本文將提供這其中每個可搭配 Azure 儲存體使用的安全性功能概觀。</span><span class="sxs-lookup"><span data-stu-id="b42aa-111">This article will provide an overview of each of these security features that can be used with Azure Storage.</span></span> <span data-ttu-id="b42aa-112">所提供的文章連結將提供每個功能的詳細資料，讓您能夠輕鬆地進一步調查每個主題。</span><span class="sxs-lookup"><span data-stu-id="b42aa-112">Links are provided to articles that will give details of each feature so you can easily do further investigation on each topic.</span></span>

<span data-ttu-id="b42aa-113">以下是本文所涵蓋的主題：</span><span class="sxs-lookup"><span data-stu-id="b42aa-113">Here are the topics to be covered in this article:</span></span>

* <span data-ttu-id="b42aa-114">[管理平面安全性](#management-plane-security) – 保護儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="b42aa-114">[Management Plane Security](#management-plane-security) – Securing your Storage Account</span></span>

  <span data-ttu-id="b42aa-115">管理平面包含用來管理儲存體帳戶的資源。</span><span class="sxs-lookup"><span data-stu-id="b42aa-115">The management plane consists of the resources used to manage your storage account.</span></span> <span data-ttu-id="b42aa-116">本節將討論 Azure Resource Manager 部署模型，以及如何使用角色型存取控制 (RBAC) 來控制存取儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-116">In this section, we'll talk about the Azure Resource Manager deployment model and how to use Role-Based Access Control (RBAC) to control access to your storage accounts.</span></span> <span data-ttu-id="b42aa-117">我們也會討論如何管理儲存體帳戶金鑰，以及重新產生這類金鑰的方法。</span><span class="sxs-lookup"><span data-stu-id="b42aa-117">We will also talk about managing your storage account keys and how to regenerate them.</span></span>
* <span data-ttu-id="b42aa-118">[資料平面安全性](#data-plane-security) – 保護資料的存取</span><span class="sxs-lookup"><span data-stu-id="b42aa-118">[Data Plane Security](#data-plane-security) – Securing Access to Your Data</span></span>

  <span data-ttu-id="b42aa-119">本節將探討如何在儲存體帳戶 (例如 Blob、檔案、查詢及表格) 中，允許使用共用存取簽章和預存存取原則來存取實際的資料物件。</span><span class="sxs-lookup"><span data-stu-id="b42aa-119">In this section, we'll look at allowing access to the actual data objects in your Storage account, such as blobs, files, queues, and tables, using Shared Access Signatures and Stored Access Policies.</span></span> <span data-ttu-id="b42aa-120">我們將涵蓋服務層級的 SAS 和帳戶層級的 SAS。</span><span class="sxs-lookup"><span data-stu-id="b42aa-120">We will cover both service-level SAS and account-level SAS.</span></span> <span data-ttu-id="b42aa-121">我們也會看到如何限制存取特定的 IP 位址 (或 IP 位址範圍)、如何限制用於 HTTPS 的通訊協定，以及如何撤銷共用存取簽章，而不需等到它過期。</span><span class="sxs-lookup"><span data-stu-id="b42aa-121">We'll also see how to limit access to a specific IP address (or range of IP addresses), how to limit the protocol used to HTTPS, and how to revoke a Shared Access Signature without waiting for it to expire.</span></span>
* [<span data-ttu-id="b42aa-122">傳輸中加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-122">Encryption in Transit</span></span>](#encryption-in-transit)

  <span data-ttu-id="b42aa-123">本節討論如何在將資料傳輸至 Azure 儲存體或從中傳出時提供保護。</span><span class="sxs-lookup"><span data-stu-id="b42aa-123">This section discusses how to secure data when you transfer it into or out of Azure Storage.</span></span> <span data-ttu-id="b42aa-124">我們將討論 HTTPS 的建議用法，以及 SMB 3.0 針對 Azure 檔案共用所使用的加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-124">We'll talk about the recommended use of HTTPS and the encryption used by SMB 3.0 for Azure File shares.</span></span> <span data-ttu-id="b42aa-125">同時也會探討用戶端加密，可讓您在將資料傳輸至用戶端應用程式中的儲存體之前加密資料，以及自儲存體傳出後解密資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-125">We will also take a look at Client-side Encryption, which enables you to encrypt the data before it is transferred into Storage in a client application, and to decrypt the data after it is transferred out of Storage.</span></span>
* [<span data-ttu-id="b42aa-126">待用加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-126">Encryption at Rest</span></span>](#encryption-at-rest)

  <span data-ttu-id="b42aa-127">我們將討論儲存體服務加密 (SSE)，以及如何為儲存體帳戶啟用此功能，讓您的區塊 Blob、分頁 Blob 和附加 Blob 可以在寫入 Azure 儲存體時自動加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-127">We will talk about Storage Service Encryption (SSE), and how you can enable it for a storage account, resulting in your block blobs, page blobs, and append blobs being automatically encrypted when written to Azure Storage.</span></span> <span data-ttu-id="b42aa-128">同時也將探討如何使用 Azure 磁碟加密，並探索磁碟加密與 SSE 與用戶端加密之間的基本差異和案例。</span><span class="sxs-lookup"><span data-stu-id="b42aa-128">We will also look at how you can use Azure Disk Encryption and explore the basic differences and cases of Disk Encryption versus SSE versus Client-Side Encryption.</span></span> <span data-ttu-id="b42aa-129">我們將簡短探討美國政府電腦適用的 FIPS 相符性。</span><span class="sxs-lookup"><span data-stu-id="b42aa-129">We will briefly look at FIPS compliance for U.S. Government computers.</span></span>
* <span data-ttu-id="b42aa-130">使用 [儲存體分析](#storage-analytics) 稽核 Azure 儲存體的存取</span><span class="sxs-lookup"><span data-stu-id="b42aa-130">Using [Storage Analytics](#storage-analytics) to audit access of Azure Storage</span></span>

  <span data-ttu-id="b42aa-131">本節討論如何在儲存體分析記錄中尋找某個要求的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="b42aa-131">This section discusses how to find information in the storage analytics logs for a request.</span></span> <span data-ttu-id="b42aa-132">我們將查看實際的分析記錄資料，並了解如何分辨出要求是否是利用儲存體帳戶金鑰、共用存取簽章或匿名方式所提出，以及該要求是否成功或失敗。</span><span class="sxs-lookup"><span data-stu-id="b42aa-132">We'll take a look at real storage analytics log data and see how to discern whether a request is made with the Storage account key, with a Shared Access signature, or anonymously, and whether it succeeded or failed.</span></span>
* [<span data-ttu-id="b42aa-133">使用 CORS 啟用以瀏覽器為基礎的用戶端</span><span class="sxs-lookup"><span data-stu-id="b42aa-133">Enabling Browser-Based Clients using CORS</span></span>](#Cross-Origin-Resource-Sharing-CORS)

  <span data-ttu-id="b42aa-134">本節討論如何允許跨原始來源資源共用 (CORS)。</span><span class="sxs-lookup"><span data-stu-id="b42aa-134">This section talks about how to allow cross-origin resource sharing (CORS).</span></span> <span data-ttu-id="b42aa-135">我們將討論跨網域存取，以及如何使用 Azure 儲存體內建的 CORS 功能來處理它。</span><span class="sxs-lookup"><span data-stu-id="b42aa-135">We'll talk about cross-domain access, and how to handle it with the CORS capabilities built into Azure Storage.</span></span>

## <a name="management-plane-security"></a><span data-ttu-id="b42aa-136">管理平面安全性</span><span class="sxs-lookup"><span data-stu-id="b42aa-136">Management Plane Security</span></span>
<span data-ttu-id="b42aa-137">管理平面包含會影響儲存體帳戶本身的作業。</span><span class="sxs-lookup"><span data-stu-id="b42aa-137">The management plane consists of operations that affect the storage account itself.</span></span> <span data-ttu-id="b42aa-138">例如，您可以建立或刪除儲存體帳戶、取得訂用帳戶中的儲存體帳戶清單、擷取儲存體帳戶金鑰，或重新產生儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-138">For example, you can create or delete a storage account, get a list of storage accounts in a subscription, retrieve the storage account keys, or regenerate the storage account keys.</span></span>

<span data-ttu-id="b42aa-139">當您建立新的儲存體帳戶時，可以選取傳統或資源管理員的部署模型。</span><span class="sxs-lookup"><span data-stu-id="b42aa-139">When you create a new storage account, you select a deployment model of Classic or Resource Manager.</span></span> <span data-ttu-id="b42aa-140">在 Azure 中建立資源的傳統模型只允許以孤注一擲的方式存取訂用帳戶，接著存取儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-140">The Classic model of creating resources in Azure only allows all-or-nothing access to the subscription, and in turn, the storage account.</span></span>

<span data-ttu-id="b42aa-141">本指南著重在資源管理員模型，也就是建立儲存體帳戶的建議方法。</span><span class="sxs-lookup"><span data-stu-id="b42aa-141">This guide focuses on the Resource Manager model which is the recommended means for creating storage accounts.</span></span> <span data-ttu-id="b42aa-142">使用 Resource Manager 儲存體帳戶，而不是提供整個訂用帳戶的存取權，您可以使用角色型存取控制 (RBAC)，來控制更限定層級上對管理平面的存取。</span><span class="sxs-lookup"><span data-stu-id="b42aa-142">With the Resource Manager storage accounts, rather than giving access to the entire subscription, you can control access on a more finite level to the management plane using Role-Based Access Control (RBAC).</span></span>

### <a name="how-to-secure-your-storage-account-with-role-based-access-control-rbac"></a><span data-ttu-id="b42aa-143">如何使用角色型存取控制 (RBAC) 保護儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="b42aa-143">How to secure your storage account with Role-Based Access Control (RBAC)</span></span>
<span data-ttu-id="b42aa-144">讓我們討論何謂 RBAC 及使用方式。</span><span class="sxs-lookup"><span data-stu-id="b42aa-144">Let's talk about what RBAC is, and how you can use it.</span></span> <span data-ttu-id="b42aa-145">每一個 Azure 訂用帳戶都具有 Azure Active Directory。</span><span class="sxs-lookup"><span data-stu-id="b42aa-145">Each Azure subscription has an Azure Active Directory.</span></span> <span data-ttu-id="b42aa-146">您可以為來自該目錄的使用者、群組和應用程式授與存取權，以便在使用資源管理員部署模型的 Azure 訂用帳戶中管理資源。</span><span class="sxs-lookup"><span data-stu-id="b42aa-146">Users, groups, and applications from that directory can be granted access to manage resources in the Azure subscription that use the Resource Manager deployment model.</span></span> <span data-ttu-id="b42aa-147">這稱為角色型存取控制 (RBAC)。</span><span class="sxs-lookup"><span data-stu-id="b42aa-147">This is referred to as Role-Based Access Control (RBAC).</span></span> <span data-ttu-id="b42aa-148">若要管理此存取權，您可以使用 [Azure 入口網站](https://portal.azure.com/)、[Azure CLI 工具](../../cli-install-nodejs.md)、[PowerShell](/powershell/azureps-cmdlets-docs) 或 [Azure 儲存體資源提供者 REST API](https://msdn.microsoft.com/library/azure/mt163683.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b42aa-148">To manage this access, you can use the [Azure portal](https://portal.azure.com/), the [Azure CLI tools](../../cli-install-nodejs.md), [PowerShell](/powershell/azureps-cmdlets-docs), or the [Azure Storage Resource Provider REST APIs](https://msdn.microsoft.com/library/azure/mt163683.aspx).</span></span>

<span data-ttu-id="b42aa-149">使用資源管理員模型，您可以將儲存體帳戶放置於資源群組中，並使用 Azure Active Directory 來控制該特定儲存體帳戶之管理平面的存取。</span><span class="sxs-lookup"><span data-stu-id="b42aa-149">With the Resource Manager model, you put the storage account in a resource group and control access to the management plane of that specific storage account using Azure Active Directory.</span></span> <span data-ttu-id="b42aa-150">例如，您可以為特定使用者提供存取儲存體帳戶金鑰的能力，而其他使用者可以檢視儲存體帳戶的相關資訊，但是無法存取儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-150">For example, you can give specific users the ability to access the storage account keys, while other users can view information about the storage account, but cannot access the storage account keys.</span></span>

#### <a name="granting-access"></a><span data-ttu-id="b42aa-151">授與存取權</span><span class="sxs-lookup"><span data-stu-id="b42aa-151">Granting Access</span></span>
<span data-ttu-id="b42aa-152">在正確範圍將適當的 RBAC 角色指派給使用者、群組和應用程式，即可授與存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-152">Access is granted by assigning the appropriate RBAC role to users, groups, and applications, at the right scope.</span></span> <span data-ttu-id="b42aa-153">若要授與整個訂用帳戶的存取權，請指派訂用帳戶層級的角色。</span><span class="sxs-lookup"><span data-stu-id="b42aa-153">To grant access to the entire subscription, you assign a role at the subscription level.</span></span> <span data-ttu-id="b42aa-154">您可以將權限授與資源群組本身，藉以授與資源群組中所有資源的存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-154">You can grant access to all of the resources in a resource group by granting permissions to the resource group itself.</span></span> <span data-ttu-id="b42aa-155">您也可以將特定角色指派給特定資源，例如儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-155">You can also assign specific roles to specific resources, such as storage accounts.</span></span>

<span data-ttu-id="b42aa-156">以下是您需要知道有關使用 RBAC 存取 Azure 儲存體帳戶之管理作業的重點︰</span><span class="sxs-lookup"><span data-stu-id="b42aa-156">Here are the main points that you need to know about using RBAC to access the management operations of an Azure Storage account:</span></span>

* <span data-ttu-id="b42aa-157">當您指派存取權時，基本上會將角色指派給您希望擁有存取權的帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-157">When you assign access, you basically assign a role to the account that you want to have access.</span></span> <span data-ttu-id="b42aa-158">您可以控制用來管理該儲存體帳戶之作業的存取權，而不是對於帳戶中資料物件的存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-158">You can control access to the operations used to manage that storage account, but not to the data objects in the account.</span></span> <span data-ttu-id="b42aa-159">例如，您可以授與權限來擷取儲存體帳戶的屬性 (例如備援)，而不是授與 Blob 儲存體內的容器或容器中的資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-159">For example, you can grant permission to retrieve the properties of the storage account (such as redundancy), but not to a container or data within a container inside Blob Storage.</span></span>
* <span data-ttu-id="b42aa-160">針對有權存取儲存體帳戶中資料物件的使用者，您可以為他們提供權限來讀取儲存體帳戶金鑰，而該使用者接著可以使用這些金鑰來存取 Blob、查詢、格表及檔案。</span><span class="sxs-lookup"><span data-stu-id="b42aa-160">For someone to have permission to access the data objects in the storage account, you can give them permission to read the storage account keys, and that user can then use those keys to access the blobs, queues, tables, and files.</span></span>
* <span data-ttu-id="b42aa-161">角色可以指派給特定的使用者帳戶、使用者群組或特定的應用程式。</span><span class="sxs-lookup"><span data-stu-id="b42aa-161">Roles can be assigned to a specific user account, a group of users, or to a specific application.</span></span>
* <span data-ttu-id="b42aa-162">每個角色都有「動作」與「沒有動作」清單。</span><span class="sxs-lookup"><span data-stu-id="b42aa-162">Each role has a list of Actions and Not Actions.</span></span> <span data-ttu-id="b42aa-163">例如，「虛擬機器參與者」角色具有 “listKeys” 的動作，可允許讀取儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-163">For example, the Virtual Machine Contributor role has an Action of "listKeys" that allows the storage account keys to be read.</span></span> <span data-ttu-id="b42aa-164">「參與者」含有「沒有動作」，例如在 Active Directory 中更新使用者的存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-164">The Contributor has "Not Actions" such as updating the access for users in the Active Directory.</span></span>
* <span data-ttu-id="b42aa-165">儲存體的角色包括 (但不限於) 下列項目︰</span><span class="sxs-lookup"><span data-stu-id="b42aa-165">Roles for storage include (but are not limited to) the following:</span></span>

  * <span data-ttu-id="b42aa-166">擁有者 – 他們可以管理一切，包括存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-166">Owner – They can manage everything, including access.</span></span>
  * <span data-ttu-id="b42aa-167">參與者 – 他們可以執行擁有者可執行的所有動作，但指派存取權除外。</span><span class="sxs-lookup"><span data-stu-id="b42aa-167">Contributor – They can do anything the owner can do except assign access.</span></span> <span data-ttu-id="b42aa-168">擁有此角色的使用者可以檢視和重新產生儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-168">Someone with this role can view and regenerate the storage account keys.</span></span> <span data-ttu-id="b42aa-169">他們可以使用儲存體帳戶金鑰來存取資料物件。</span><span class="sxs-lookup"><span data-stu-id="b42aa-169">With the storage account keys, they can access the data objects.</span></span>
  * <span data-ttu-id="b42aa-170">讀者 – 他們可以檢視儲存體帳戶 (密碼除外) 的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="b42aa-170">Reader – They can view information about the storage account, except secrets.</span></span> <span data-ttu-id="b42aa-171">例如，如果您將儲存體帳戶中具有讀者權限的角色指派給某人，他們就能檢視儲存體帳戶的屬性，但無法對屬性進行任何變更或檢視儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-171">For example, if you assign a role with reader permissions on the storage account to someone, they can view the properties of the storage account, but they can't make any changes to the properties or view the storage account keys.</span></span>
  * <span data-ttu-id="b42aa-172">儲存體帳戶參與者 – 他們可以管理儲存體帳戶 – 他們可以讀取訂用帳戶的資源群組和資源，以及建立和管理訂用帳戶資源群組部署。</span><span class="sxs-lookup"><span data-stu-id="b42aa-172">Storage Account Contributor – They can manage the storage account – they can read the subscription's resource groups and resources, and create and manage subscription resource group deployments.</span></span> <span data-ttu-id="b42aa-173">他們也可以存取儲存體帳戶金鑰，這表示他們可以存取資料平面。</span><span class="sxs-lookup"><span data-stu-id="b42aa-173">They can also access the storage account keys, which in turn means they can access the data plane.</span></span>
  * <span data-ttu-id="b42aa-174">使用者存取系統管理員 – 他們可以管理儲存體帳戶的使用者存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-174">User Access Administrator – They can manage user access to the storage account.</span></span> <span data-ttu-id="b42aa-175">例如，他們可將「讀者」權限授與特定的使用者。</span><span class="sxs-lookup"><span data-stu-id="b42aa-175">For example, they can grant Reader access to a specific user.</span></span>
  * <span data-ttu-id="b42aa-176">虛擬機器參與者 – 他們可以管理虛擬機器，但是無法管理他們連接的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-176">Virtual Machine Contributor – They can manage virtual machines but not the storage account to which they are connected.</span></span> <span data-ttu-id="b42aa-177">這個角色可以列出儲存體帳戶金鑰，這表示您指派此角色的使用者可以更新資料平面。</span><span class="sxs-lookup"><span data-stu-id="b42aa-177">This role can list the storage account keys, which means that the user to whom you assign this role can update the data plane.</span></span>

    <span data-ttu-id="b42aa-178">為了讓使用者能夠建立虛擬機器，他們必須能夠在儲存體帳戶中建立對應的 VHD 檔案。</span><span class="sxs-lookup"><span data-stu-id="b42aa-178">In order for a user to create a virtual machine, they have to be able to create the corresponding VHD file in a storage account.</span></span> <span data-ttu-id="b42aa-179">若要這麼做，他們需要能夠擷取儲存體帳戶金鑰，並將它傳遞給建立 VM 的 API。</span><span class="sxs-lookup"><span data-stu-id="b42aa-179">To do that, they need to be able to retrieve the storage account key and pass it to the API creating the VM.</span></span> <span data-ttu-id="b42aa-180">因此，他們必須具備此權限，如此就能列出儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-180">Therefore, they must have this permission so they can list the storage account keys.</span></span>
* <span data-ttu-id="b42aa-181">定義自訂角色的能力是一項功能，允許您從可在 Azure 資源上執行的可用動作清單中撰寫一系列動作。</span><span class="sxs-lookup"><span data-stu-id="b42aa-181">The ability to define custom roles is a feature that allows you to compose a set of actions from a list of available actions that can be performed on Azure resources.</span></span>
* <span data-ttu-id="b42aa-182">您必須先在 Azure Active Directory 中設定使用者，才能為他們指派角色。</span><span class="sxs-lookup"><span data-stu-id="b42aa-182">The user has to be set up in your Azure Active Directory before you can assign a role to them.</span></span>
* <span data-ttu-id="b42aa-183">您可以建立一份報告，其中包含哪一位人員已使用 PowerShell 或 Azure CLI，在哪個範圍中，為哪些對象授與/撤銷何種類型的存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-183">You can create a report of who granted/revoked what kind of access to/from whom and on what scope using PowerShell or the Azure CLI.</span></span>

#### <a name="resources"></a><span data-ttu-id="b42aa-184">資源</span><span class="sxs-lookup"><span data-stu-id="b42aa-184">Resources</span></span>
* [<span data-ttu-id="b42aa-185">Azure Active Directory 角色型存取控制</span><span class="sxs-lookup"><span data-stu-id="b42aa-185">Azure Active Directory Role-based Access Control</span></span>](../../active-directory/role-based-access-control-configure.md)

  <span data-ttu-id="b42aa-186">本文說明 Azure Active Directory 角色型存取控制及其運作方式。</span><span class="sxs-lookup"><span data-stu-id="b42aa-186">This article explains the Azure Active Directory Role-based Access Control and how it works.</span></span>
* [<span data-ttu-id="b42aa-187">RBAC：內建角色</span><span class="sxs-lookup"><span data-stu-id="b42aa-187">RBAC: Built in Roles</span></span>](../../active-directory/role-based-access-built-in-roles.md)

  <span data-ttu-id="b42aa-188">本文將詳細說明 RBAC 中所有可用的內建角色。</span><span class="sxs-lookup"><span data-stu-id="b42aa-188">This article details all of the built-in roles available in RBAC.</span></span>
* [<span data-ttu-id="b42aa-189">了解資源管理員部署和傳統部署</span><span class="sxs-lookup"><span data-stu-id="b42aa-189">Understanding Resource Manager deployment and classic deployment</span></span>](../../azure-resource-manager/resource-manager-deployment-model.md)

  <span data-ttu-id="b42aa-190">本文說明資源管理員部署和傳統部署模型，並說明使用資源管理員和資源群組的優點。</span><span class="sxs-lookup"><span data-stu-id="b42aa-190">This article explains the Resource Manager deployment and classic deployment models, and explains the benefits of using the Resource Manager and resource groups.</span></span> <span data-ttu-id="b42aa-191">內容中會說明 Azure 計算、網路及儲存體提供者在 Resource Manager 模型下的運作方式。</span><span class="sxs-lookup"><span data-stu-id="b42aa-191">It explains how the Azure Compute, Network, and Storage Providers work under the Resource Manager model.</span></span>
* [<span data-ttu-id="b42aa-192">使用 REST API 管理角色型存取控制</span><span class="sxs-lookup"><span data-stu-id="b42aa-192">Managing Role-Based Access Control with the REST API</span></span>](../../active-directory/role-based-access-control-manage-access-rest.md)

  <span data-ttu-id="b42aa-193">本文說明如何使用 REST API 來管理 RBAC。</span><span class="sxs-lookup"><span data-stu-id="b42aa-193">This article shows how to use the REST API to manage RBAC.</span></span>
* [<span data-ttu-id="b42aa-194">Azure 儲存體資源提供者 REST API 參考</span><span class="sxs-lookup"><span data-stu-id="b42aa-194">Azure Storage Resource Provider REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/mt163683.aspx)

  <span data-ttu-id="b42aa-195">這是您可以利用程式設計方式，用來管理儲存體帳戶的 API 參考。</span><span class="sxs-lookup"><span data-stu-id="b42aa-195">This is the reference for the APIs you can use to manage your storage account programmatically.</span></span>
* [<span data-ttu-id="b42aa-196">Developer’s guide to auth with Azure Resource Manager API (利用 Azure Resource Manager 進行驗證的開發人員指南)</span><span class="sxs-lookup"><span data-stu-id="b42aa-196">Developer's guide to auth with Azure Resource Manager API</span></span>](http://www.dushyantgill.com/blog/2015/05/23/developers-guide-to-auth-with-azure-resource-manager-api/)

  <span data-ttu-id="b42aa-197">本文示範如何使用 Resource Manager API 進行驗證。</span><span class="sxs-lookup"><span data-stu-id="b42aa-197">This article shows how to authenticate using the Resource Manager APIs.</span></span>
* [<span data-ttu-id="b42aa-198">來自Ignite 且適用於 Microsoft Azure 的角色型存取控制</span><span class="sxs-lookup"><span data-stu-id="b42aa-198">Role-Based Access Control for Microsoft Azure from Ignite</span></span>](https://channel9.msdn.com/events/Ignite/2015/BRK2707)

  <span data-ttu-id="b42aa-199">這個連結會連到 2015 MS Ignite 會議的 Channel 9 上的視訊。</span><span class="sxs-lookup"><span data-stu-id="b42aa-199">This is a link to a video on Channel 9 from the 2015 MS Ignite conference.</span></span> <span data-ttu-id="b42aa-200">在這個研討會中，他們討論 Azure 中的存取管理和報告功能，並探索使用 Azure Active Directory 安全存取 Azure 訂用帳戶的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="b42aa-200">In this session, they talk about access management and reporting capabilities in Azure, and explore best practices around securing access to Azure subscriptions using Azure Active Directory.</span></span>

### <a name="managing-your-storage-account-keys"></a><span data-ttu-id="b42aa-201">管理儲存體帳戶金鑰</span><span class="sxs-lookup"><span data-stu-id="b42aa-201">Managing Your Storage Account Keys</span></span>
<span data-ttu-id="b42aa-202">儲存體帳戶金鑰是由 Azure 所建立的 512 位元字串，搭配儲存體帳戶名稱就能用來存取儲存於儲存體帳戶中的資料物件，例如，Blob、表格內的實體、佇列訊息，以及 Azure 檔案共用中的檔案。</span><span class="sxs-lookup"><span data-stu-id="b42aa-202">Storage account keys are 512-bit strings created by Azure that, along with the storage account name, can be used to access the data objects stored in the storage account, e.g. blobs, entities within a table, queue messages, and files on an Azure File share.</span></span> <span data-ttu-id="b42aa-203">控制儲存體帳戶金鑰的存取，就能控制該儲存體帳戶之資料平面的存取。</span><span class="sxs-lookup"><span data-stu-id="b42aa-203">Controlling access to the storage account keys controls access to the data plane for that storage account.</span></span>

<span data-ttu-id="b42aa-204">每個儲存體帳戶在 [Azure 入口網站](http://portal.azure.com/) 和 PowerShell Cmdlet 中都有兩個稱為「金鑰 1」和「金鑰 2」的金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-204">Each storage account has two keys referred to as "Key 1" and "Key 2" in the [Azure portal](http://portal.azure.com/) and in the PowerShell cmdlets.</span></span> <span data-ttu-id="b42aa-205">您可以使用下列其中一種方法手動重新產生它們，包括 (但不限於) 使用 [Azure 入口網站](https://portal.azure.com/)、PowerShell、Azure CLI，或以程式設計方式使用 .NET 儲存體用戶端程式庫或 Azure 儲存體服務 REST API。</span><span class="sxs-lookup"><span data-stu-id="b42aa-205">These can be regenerated manually using one of several methods, including, but not limited to using the [Azure portal](https://portal.azure.com/), PowerShell, the Azure CLI, or programmatically using the .NET Storage Client Library or the Azure Storage Services REST API.</span></span>

<span data-ttu-id="b42aa-206">有許多原因會導致要重新產生儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-206">There are any number of reasons to regenerate your storage account keys.</span></span>

* <span data-ttu-id="b42aa-207">您可能會基於安全性理由定期重新產生它們。</span><span class="sxs-lookup"><span data-stu-id="b42aa-207">You might regenerate them on a regular basis for security reasons.</span></span>
* <span data-ttu-id="b42aa-208">如果某人設法駭入應用程式並擷取硬式編碼或儲存於組態檔案中的金鑰，來為他們提供您儲存體帳戶的完整存取權，則您必須重新產生儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-208">You would regenerate your storage account keys if someone managed to hack into an application and retrieve the key that was hardcoded or saved in a configuration file, giving them full access to your storage account.</span></span>
* <span data-ttu-id="b42aa-209">重新產生金鑰的另一種情況是，如果您的小組使用儲存體總管應用程式，其中會保留儲存體帳戶金鑰，而其中一位小組成員離開時。</span><span class="sxs-lookup"><span data-stu-id="b42aa-209">Another case for key regeneration is if your team is using a Storage Explorer application that retains the storage account key, and one of the team members leaves.</span></span> <span data-ttu-id="b42aa-210">在他們離開之後，應用程式還會繼續運作，讓他們能夠存取您的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-210">The application would continue to work, giving them access to your storage account after they're gone.</span></span> <span data-ttu-id="b42aa-211">這實際上是他們建立帳戶層級共用存取簽章的主要原因 – 您可以改用帳戶層級的 SAS，而不是將存取金鑰儲存於組態檔案中。</span><span class="sxs-lookup"><span data-stu-id="b42aa-211">This is actually the primary reason they created account-level Shared Access Signatures – you can use an account-level SAS instead of storing the access keys in a configuration file.</span></span>

#### <a name="key-regeneration-plan"></a><span data-ttu-id="b42aa-212">金鑰重新產生計畫</span><span class="sxs-lookup"><span data-stu-id="b42aa-212">Key regeneration plan</span></span>
<span data-ttu-id="b42aa-213">您不想在沒有任何規劃的情況下，只是重新產生所使用的金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-213">You don't want to just regenerate the key you are using without some planning.</span></span> <span data-ttu-id="b42aa-214">如果您這麼做時，可能會切斷對該儲存體帳戶的所有存取權，而這會造成嚴重中斷。</span><span class="sxs-lookup"><span data-stu-id="b42aa-214">If you do that, you could cut off all access to that storage account, which can cause major disruption.</span></span> <span data-ttu-id="b42aa-215">這就是為什麼要有兩個金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-215">This is why there are two keys.</span></span> <span data-ttu-id="b42aa-216">您一次應該重新產生一個金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-216">You should regenerate one key at a time.</span></span>

<span data-ttu-id="b42aa-217">重新產生金鑰之前，先確定您擁有相依於儲存體帳戶的所有應用程式清單，以及您在 Azure 中使用的所有其他服務。</span><span class="sxs-lookup"><span data-stu-id="b42aa-217">Before you regenerate your keys, be sure you have a list of all of your applications that are dependent on the storage account, as well as any other services you are using in Azure.</span></span> <span data-ttu-id="b42aa-218">例如，如果您使用相依於儲存體帳戶的 Azure 媒體服務，就必須在重新產生金鑰之後，將存取金鑰與媒體服務重新同步。</span><span class="sxs-lookup"><span data-stu-id="b42aa-218">For example, if you are using Azure Media Services that are dependent on your storage account, you must re-sync the access keys with your media service after you regenerate the key.</span></span> <span data-ttu-id="b42aa-219">如果您使用儲存體總管之類的任何應用程式，也必須為這些應用程式提供新的金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-219">If you are using any applications such as a storage explorer, you will need to provide the new keys to those applications as well.</span></span> <span data-ttu-id="b42aa-220">請注意，如果 VM 的 VHD 檔案是儲存於儲存體帳戶中，它們將不會受到重新產生儲存體帳戶金鑰所影響。</span><span class="sxs-lookup"><span data-stu-id="b42aa-220">Note that if you have VMs whose VHD files are stored in the storage account, they will not be affected by regenerating the storage account keys.</span></span>

<span data-ttu-id="b42aa-221">您可以在 Azure 入口網站中重新產生金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-221">You can regenerate your keys in the Azure portal.</span></span> <span data-ttu-id="b42aa-222">重新產生金鑰之後，它們最多可能需要 10 分鐘的時間跨儲存體服務進行同步處理。</span><span class="sxs-lookup"><span data-stu-id="b42aa-222">Once keys are regenerated they can take up to 10 minutes to be synchronized across Storage Services.</span></span>

<span data-ttu-id="b42aa-223">當您準備好時，以下是一般程序，可詳細說明您應該如何變更金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-223">When you're ready, here's the general process detailing how you should change your key.</span></span> <span data-ttu-id="b42aa-224">在此案例中，假設您目前使用的是金鑰 1，而您想要變更所有項目以改用金鑰 2。</span><span class="sxs-lookup"><span data-stu-id="b42aa-224">In this case, the assumption is that you are currently using Key 1 and you are going to change everything to use Key 2 instead.</span></span>

1. <span data-ttu-id="b42aa-225">重新產生金鑰 2，以確保該金鑰是安全的。</span><span class="sxs-lookup"><span data-stu-id="b42aa-225">Regenerate Key 2 to ensure that it is secure.</span></span> <span data-ttu-id="b42aa-226">您可以在 Azure 入口網站中執行此動作。</span><span class="sxs-lookup"><span data-stu-id="b42aa-226">You can do this in the Azure portal.</span></span>
2. <span data-ttu-id="b42aa-227">在儲存體金鑰儲存所在的所有應用程式中，變更儲存體金鑰以使用金鑰 2 的新值。</span><span class="sxs-lookup"><span data-stu-id="b42aa-227">In all of the applications where the storage key is stored, change the storage key to use Key 2's new value.</span></span> <span data-ttu-id="b42aa-228">測試並發佈應用程式。</span><span class="sxs-lookup"><span data-stu-id="b42aa-228">Test and publish the application.</span></span>
3. <span data-ttu-id="b42aa-229">在所有應用程式和服務已啟動並執行成功之後，重新產生金鑰 1。</span><span class="sxs-lookup"><span data-stu-id="b42aa-229">After all of the applications and services are up and running successfully, regenerate Key 1.</span></span> <span data-ttu-id="b42aa-230">這確保您未明確提供新金鑰的任何人都將不再擁有儲存體帳戶的存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-230">This ensures that anybody to whom you have not expressly given the new key will no longer have access to the storage account.</span></span>

<span data-ttu-id="b42aa-231">如果您目前使用金鑰 2，就可以使用相同的程序，但反轉金鑰名稱。</span><span class="sxs-lookup"><span data-stu-id="b42aa-231">If you are currently using Key 2, you can use the same process, but reverse the key names.</span></span>

<span data-ttu-id="b42aa-232">您可以過幾天後移轉，變更每個應用程式來使用新的金鑰並進行發佈。</span><span class="sxs-lookup"><span data-stu-id="b42aa-232">You can migrate over a couple of days, changing each application to use the new key and publishing it.</span></span> <span data-ttu-id="b42aa-233">全部完成之後，您接著應該返回並重新產生舊的金鑰，使其無法運作。</span><span class="sxs-lookup"><span data-stu-id="b42aa-233">After all of them are done, you should then go back and regenerate the old key so it no longer works.</span></span>

<span data-ttu-id="b42aa-234">另一個選項是將儲存體帳戶金鑰放在 [Azure 金鑰保存庫](https://azure.microsoft.com/services/key-vault/) 中做為密碼，並讓您的應用程式可從中擷取該金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-234">Another option is to put the storage account key in an [Azure Key Vault](https://azure.microsoft.com/services/key-vault/) as a secret and have your applications retrieve the key from there.</span></span> <span data-ttu-id="b42aa-235">接著，當您重新產生金鑰並更新 Azure 金鑰保存庫時，將不需重新部署應用程式，因為它們會自動從 Azure 金鑰保存庫中挑選新的金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-235">Then when you regenerate the key and update the Azure Key Vault, the applications will not need to be redeployed because they will pick up the new key from the Azure Key Vault automatically.</span></span> <span data-ttu-id="b42aa-236">請注意，您可以讓應用程式每次在您需要金鑰時讀取它，或者，您可以將它快取於記憶體中，如果使用金鑰時失敗，就再次從 Azure 金鑰保存庫中擷取該金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-236">Note that you can have the application read the key each time you need it, or you can cache it in memory and if it fails when using it, retrieve the key again from the Azure Key Vault.</span></span>

<span data-ttu-id="b42aa-237">使用 Azure 金鑰保存庫，也會增加儲存體金鑰的安全性層級。</span><span class="sxs-lookup"><span data-stu-id="b42aa-237">Using Azure Key Vault also adds another level of security for your storage keys.</span></span> <span data-ttu-id="b42aa-238">如果您使用這個方法，永遠都不需要將儲存體金鑰硬式編碼於組態檔中，這樣會移除某人不需特定權限即可存取金鑰的途徑。</span><span class="sxs-lookup"><span data-stu-id="b42aa-238">If you use this method, you will never have the storage key hardcoded in a configuration file, which removes that avenue of somebody getting access to the keys without specific permission.</span></span>

<span data-ttu-id="b42aa-239">使用 Azure 金鑰保存庫的另一個優點是，您也可以使用 Azure Active Directory 來控制金鑰的存取。</span><span class="sxs-lookup"><span data-stu-id="b42aa-239">Another advantage of using Azure Key Vault is you can also control access to your keys using Azure Active Directory.</span></span> <span data-ttu-id="b42aa-240">這表示您可以將存取權授與少數必須從 Azure 金鑰保存庫擷取金鑰的應用程式，並了解其他應用程式在未特別授與它們權限的情況下無法存取金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-240">This means you can grant access to the handful of applications that need to retrieve the keys from Azure Key Vault, and know that other applications will not be able to access the keys without granting them permission specifically.</span></span>

<span data-ttu-id="b42aa-241">注意︰建議同一時間在您的所有應用程式中只會使用一個金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-241">Note: it is recommended to use only one of the keys in all of your applications at the same time.</span></span> <span data-ttu-id="b42aa-242">如果您在某些地方使用金鑰 1 並在其他地方使用金鑰 2，您就無法在沒有部分應用程式遺失存取的情況下輪換您的金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-242">If you use Key 1 in some places and Key 2 in others, you will not be able to rotate your keys without some application losing access.</span></span>

#### <a name="resources"></a><span data-ttu-id="b42aa-243">資源</span><span class="sxs-lookup"><span data-stu-id="b42aa-243">Resources</span></span>
* [<span data-ttu-id="b42aa-244">關於 Azure 儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="b42aa-244">About Azure Storage Accounts</span></span>](storage-create-storage-account.md#regenerate-storage-access-keys)

  <span data-ttu-id="b42aa-245">本文提供儲存體帳戶的概觀，並討論如何檢視、複製和重新產生儲存體存取金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-245">This article gives an overview of storage accounts and discusses viewing, copying, and regenerating storage access keys.</span></span>
* [<span data-ttu-id="b42aa-246">Azure 儲存體資源提供者 REST API 參考</span><span class="sxs-lookup"><span data-stu-id="b42aa-246">Azure Storage Resource Provider REST API Reference</span></span>](https://msdn.microsoft.com/library/mt163683.aspx)

  <span data-ttu-id="b42aa-247">本文包含有關擷取儲存體帳戶金鑰，以及使用 REST API 為 Azure 帳戶重新產生儲存體帳戶金鑰的特定文章連結。</span><span class="sxs-lookup"><span data-stu-id="b42aa-247">This article contains links to specific articles about retrieving the storage account keys and regenerating the storage account keys for an Azure Account using the REST API.</span></span> <span data-ttu-id="b42aa-248">注意︰這適用於 Resource Manager 儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-248">Note: This is for  Resource Manager storage accounts.</span></span>
* [<span data-ttu-id="b42aa-249">儲存體帳戶的相關作業</span><span class="sxs-lookup"><span data-stu-id="b42aa-249">Operations on storage accounts</span></span>](https://msdn.microsoft.com/library/ee460790.aspx)

  <span data-ttu-id="b42aa-250">這篇位於儲存體服務管理員 REST API 參考中的文章，包含有關使用 REST API 來擷取和重新產生儲存體帳戶金鑰的特定文章連結。</span><span class="sxs-lookup"><span data-stu-id="b42aa-250">This article in the Storage Service Manager REST API Reference contains links to specific articles on retrieving and regenerating the storage account keys using the REST API.</span></span> <span data-ttu-id="b42aa-251">注意︰這適用於傳統儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-251">Note: This is for the Classic storage accounts.</span></span>
* [<span data-ttu-id="b42aa-252">Say goodbye to key management – manage access to Azure Storage data using Azure AD (告別金鑰管理 – 使用 Azure AD 管理 Azure 儲存體資料的存取)</span><span class="sxs-lookup"><span data-stu-id="b42aa-252">Say goodbye to key management – manage access to Azure Storage data using Azure AD</span></span>](http://www.dushyantgill.com/blog/2015/04/26/say-goodbye-to-key-management-manage-access-to-azure-storage-data-using-azure-ad/)

  <span data-ttu-id="b42aa-253">本文說明如何使用 Active Directory 來控制 Azure 金鑰保存庫中 Azure 儲存體金鑰的存取。</span><span class="sxs-lookup"><span data-stu-id="b42aa-253">This article shows how to use Active Directory to control access to your Azure Storage keys in Azure Key Vault.</span></span> <span data-ttu-id="b42aa-254">它也會示範如何使用 Azure 自動化工作，每小時重新產生金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-254">It also shows how to use an Azure Automation job to regenerate the keys on an hourly basis.</span></span>

## <a name="data-plane-security"></a><span data-ttu-id="b42aa-255">資料平面安全性</span><span class="sxs-lookup"><span data-stu-id="b42aa-255">Data Plane Security</span></span>
<span data-ttu-id="b42aa-256">資料平面安全性是指用來保護儲存在 Azure 儲存體的資料物件 (Blob、佇列、表格和檔案) 的方法。</span><span class="sxs-lookup"><span data-stu-id="b42aa-256">Data Plane Security refers to the methods used to secure the data objects stored in Azure Storage – the blobs, queues, tables, and files.</span></span> <span data-ttu-id="b42aa-257">我們已了解在傳輸資料期間加密資料和安全性的方法，但您該從何處著手來允許存取物件？</span><span class="sxs-lookup"><span data-stu-id="b42aa-257">We've seen methods to encrypt the data and security during transit of the data, but how do you go about allowing access to the objects?</span></span>

<span data-ttu-id="b42aa-258">基本上有兩個方法可用來控制對資料物件本身的存取。</span><span class="sxs-lookup"><span data-stu-id="b42aa-258">There are basically two methods for controlling access to the data objects themselves.</span></span> <span data-ttu-id="b42aa-259">第一個是控制對儲存體帳戶金鑰的存取，第二個則是使用共用存取簽章，來授與一段特定時間對特定資料物件的存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-259">The first is by controlling access to the storage account keys, and the second is using Shared Access Signatures to grant access to specific data objects for a specific amount of time.</span></span>

<span data-ttu-id="b42aa-260">要注意的一個例外狀況是，您可以藉由設定要據以保存 Blob 之容器的存取層級，來允許對您的 Blob 進行公用存取。</span><span class="sxs-lookup"><span data-stu-id="b42aa-260">One exception to note is that you can allow public access to your blobs by setting the access level for the container that holds the blobs accordingly.</span></span> <span data-ttu-id="b42aa-261">如果您將容器的存取權設定為「Blob」或「容器」，將允許該容器中 Blob 的公用讀取存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-261">If you set access for a container to Blob or Container, it will allow public read access for the blobs in that container.</span></span> <span data-ttu-id="b42aa-262">這表示 URL 指向該容器中 Blob 的任何人都可以在瀏覽器中開啟它，而不需使用共用存取簽章或擁有儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-262">This means anyone with a URL pointing to a blob in that container can open it in a browser without using a Shared Access Signature or having the storage account keys.</span></span>

### <a name="storage-account-keys"></a><span data-ttu-id="b42aa-263">儲存體帳戶金鑰</span><span class="sxs-lookup"><span data-stu-id="b42aa-263">Storage Account Keys</span></span>
<span data-ttu-id="b42aa-264">儲存體帳戶金鑰是由 Azure 所建立的 512 位元字串，搭配儲存體帳戶名稱就能用來存取儲存於儲存體帳戶中的資料物件。</span><span class="sxs-lookup"><span data-stu-id="b42aa-264">Storage account keys are 512-bit strings created by Azure that, along with the storage account name, can be used to access the data objects stored in the storage account.</span></span>

<span data-ttu-id="b42aa-265">例如，您可以讀取 Blob、寫入佇列、建立表格，以及修改檔案。</span><span class="sxs-lookup"><span data-stu-id="b42aa-265">For example, you can read blobs, write to queues, create tables, and modify files.</span></span> <span data-ttu-id="b42aa-266">這其中許多動作都可透過 Azure 入口網站，或使用許多儲存體總管應用程式之一來執行。</span><span class="sxs-lookup"><span data-stu-id="b42aa-266">Many of these actions can be performed through the Azure portal, or using one of many Storage Explorer applications.</span></span> <span data-ttu-id="b42aa-267">您也可以撰寫程式碼來使用 REST API 或其中一個儲存體用戶端程式庫來執行這些作業。</span><span class="sxs-lookup"><span data-stu-id="b42aa-267">You can also write code to use the REST API or one of the Storage Client Libraries to perform these operations.</span></span>

<span data-ttu-id="b42aa-268">如同 [管理平面安全性](#management-plane-security)一節中所討論，對傳統儲存體帳戶的儲存體金鑰的存取權，可以藉由為 Azure 訂用帳戶提供完整存取權來授與。</span><span class="sxs-lookup"><span data-stu-id="b42aa-268">As discussed in the section on the [Management Plane Security](#management-plane-security), access to the storage keys for a Classic storage account can be granted by giving full access to the Azure subscription.</span></span> <span data-ttu-id="b42aa-269">使用 Azure Resource Manager 模型來存取儲存體帳戶的儲存體金鑰，可以透過角色型存取控制 (RBAC) 來控制。</span><span class="sxs-lookup"><span data-stu-id="b42aa-269">Access to the storage keys for a storage account using the Azure Resource Manager model can be controlled through Role-Based Access Control (RBAC).</span></span>

### <a name="how-to-delegate-access-to-objects-in-your-account-using-shared-access-signatures-and-stored-access-policies"></a><span data-ttu-id="b42aa-270">如何使用共用存取簽章和預存存取原則委派帳戶中物件的存取權</span><span class="sxs-lookup"><span data-stu-id="b42aa-270">How to delegate access to objects in your account using Shared Access Signatures and Stored Access Policies</span></span>
<span data-ttu-id="b42aa-271">共用存取簽章是一個字串，包含可附加至 URI 的安全性權杖，可讓您委派儲存體物件的存取權，以及指定存取的權限和日期/時間範圍之類的限制。</span><span class="sxs-lookup"><span data-stu-id="b42aa-271">A Shared Access Signature is a string containing a security token that can be attached to a URI that allows you to delegate access to storage objects and specify constraints such as the permissions and the date/time range of access.</span></span>

<span data-ttu-id="b42aa-272">您可以授與對 Blob、容器、佇列、檔案和表格的存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-272">You can grant access to blobs, containers, queue messages, files, and tables.</span></span> <span data-ttu-id="b42aa-273">使用表格時，您可以實際授與權限來存取表格中某個範圍的實體，方法是指定您想要讓使用者有權存取的分割區和資料列索引鍵範圍。</span><span class="sxs-lookup"><span data-stu-id="b42aa-273">With tables, you can actually grant permission to access a range of entities in the table by specifying the partition and row key ranges to which you want the user to have access.</span></span> <span data-ttu-id="b42aa-274">例如，如果您已使用具備地理狀態的分割區索引鍵儲存資料，您可以為某人提供只能存取加州相關資料的存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-274">For example, if you have data stored with a partition key of geographical state, you could give someone access to just the data for California.</span></span>

<span data-ttu-id="b42aa-275">在另一個範例中，您可能會為 Web 應用程式提供 SAS 權杖，讓它能夠將項目寫入佇列，並為背景工作角色應用程式提供 SAS 權杖，從佇列中取得訊息並加以處理。</span><span class="sxs-lookup"><span data-stu-id="b42aa-275">In another example, you might give a web application a SAS token that enables it to write entries to a queue, and give a worker role application a SAS token to get messages from the queue and process them.</span></span> <span data-ttu-id="b42aa-276">或者，您可以為某一位客戶提供 SAS 權杖，讓他們可以用來將圖片上傳至 Blob 儲存體中的容器，並為 Web 應用程式提供權限來讀取這些圖片。</span><span class="sxs-lookup"><span data-stu-id="b42aa-276">Or you could give one customer a SAS token they can use to upload pictures to a container in Blob Storage, and give a web application permission to read those pictures.</span></span> <span data-ttu-id="b42aa-277">在這兩種情況下，產生了關注點分離情況 – 每個應用程式只能取得執行其工作所需的存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-277">In both cases, there is a separation of concerns – each application can be given just the access that they require in order to perform their task.</span></span> <span data-ttu-id="b42aa-278">這可能是因為使用了共用存取簽章。</span><span class="sxs-lookup"><span data-stu-id="b42aa-278">This is possible through the use of Shared Access Signatures.</span></span>

#### <a name="why-you-want-to-use-shared-access-signatures"></a><span data-ttu-id="b42aa-279">您想要使用共用存取簽章的原因</span><span class="sxs-lookup"><span data-stu-id="b42aa-279">Why you want to use Shared Access Signatures</span></span>
<span data-ttu-id="b42aa-280">為什麼您想要使用 SAS，而不只是散發您的儲存體帳戶金鑰，哪一個方法更容易使用？</span><span class="sxs-lookup"><span data-stu-id="b42aa-280">Why would you want to use an SAS instead of just giving out your storage account key, which is so much easier?</span></span> <span data-ttu-id="b42aa-281">散發您的儲存體帳戶金鑰，就像是在您的儲存體王國內共用金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-281">Giving out your storage account key is like sharing the keys of your storage kingdom.</span></span> <span data-ttu-id="b42aa-282">它會授與完整存取權限。</span><span class="sxs-lookup"><span data-stu-id="b42aa-282">It grants complete access.</span></span> <span data-ttu-id="b42aa-283">其他人可以使用您的金鑰，並將其整個音樂媒體櫃上傳至您的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-283">Someone could use your keys and upload their entire music library to your storage account.</span></span> <span data-ttu-id="b42aa-284">他們可能也會使用受病毒感染的版本來取代您的檔案或竊取您的資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-284">They could also replace your files with virus-infected versions, or steal your data.</span></span> <span data-ttu-id="b42aa-285">無限制散發您儲存體帳戶的存取權不應草率行事。</span><span class="sxs-lookup"><span data-stu-id="b42aa-285">Giving away unlimited access to your storage account is something that should not be taken lightly.</span></span>

<span data-ttu-id="b42aa-286">使用共用存取簽章，您可以只為用戶端提供有限時間內所需的權限。</span><span class="sxs-lookup"><span data-stu-id="b42aa-286">With Shared Access Signatures, you can give a client just the permissions required for a limited amount of time.</span></span> <span data-ttu-id="b42aa-287">例如，如果有人將 Blob 上傳至您的帳戶，您可以授與他們剛好足夠時間的寫入權限來上傳 Blob (當然，這取決於 Blob 的大小)。</span><span class="sxs-lookup"><span data-stu-id="b42aa-287">For example, if someone is uploading a blob to your account, you can grant them write access for just enough time to upload the blob (depending on the size of the blob, of course).</span></span> <span data-ttu-id="b42aa-288">如果您改變心意，您可以撤銷該存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-288">And if you change your mind, you can revoke that access.</span></span>

<span data-ttu-id="b42aa-289">此外，您可以指定將使用 SAS 所提出的要求限制為特定的 IP 位址或 Azure 外部的 IP 位址範圍。</span><span class="sxs-lookup"><span data-stu-id="b42aa-289">Additionally, you can specify that requests made using a SAS are restricted to a certain IP address or IP address range external to Azure.</span></span> <span data-ttu-id="b42aa-290">您也可以要求使用特定通訊協定 (HTTPS 或 HTTP/HTTPS) 來提出要求。</span><span class="sxs-lookup"><span data-stu-id="b42aa-290">You can also require that requests are made using a specific protocol (HTTPS or HTTP/HTTPS).</span></span> <span data-ttu-id="b42aa-291">這表示，如果您只想要允許 HTTPS 流量，您可以將必要的通訊協定設定為僅限 HTTPS，而且將會封鎖 HTTP 流量。</span><span class="sxs-lookup"><span data-stu-id="b42aa-291">This means if you only want to allow HTTPS traffic, you can set the required protocol to HTTPS only, and HTTP traffic will be blocked.</span></span>

#### <a name="definition-of-a-shared-access-signature"></a><span data-ttu-id="b42aa-292">定義共用存取簽章</span><span class="sxs-lookup"><span data-stu-id="b42aa-292">Definition of a Shared Access Signature</span></span>
<span data-ttu-id="b42aa-293">共用存取簽章是一組附加至指向資源之 URL 的查詢參數</span><span class="sxs-lookup"><span data-stu-id="b42aa-293">A Shared Access Signature is a set of query parameters appended to the URL pointing at the resource</span></span>

<span data-ttu-id="b42aa-294">其中提供所允許存取權的相關資訊，以及准許該存取權的時間長度。</span><span class="sxs-lookup"><span data-stu-id="b42aa-294">that provides information about the access allowed and the length of time for which the access is permitted.</span></span> <span data-ttu-id="b42aa-295">以下提供一個範例：這個 URI 會提供五分鐘對 Blob 的讀取權限。</span><span class="sxs-lookup"><span data-stu-id="b42aa-295">Here is an example; this URI provides read access to a blob for five minutes.</span></span> <span data-ttu-id="b42aa-296">請注意，SAS 查詢參數必須以 URL 編碼，例如 %3A 用於冒號 (:) 或 %20 用於空格。</span><span class="sxs-lookup"><span data-stu-id="b42aa-296">Note that SAS query parameters must be URL Encoded, such as %3A for colon (:) or %20 for a space.</span></span>

```
http://mystorage.blob.core.windows.net/mycontainer/myblob.txt (URL to the blob)
?sv=2015-04-05 (storage service version)
&st=2015-12-10T22%3A18%3A26Z (start time, in UTC time and URL encoded)
&se=2015-12-10T22%3A23%3A26Z (end time, in UTC time and URL encoded)
&sr=b (resource is a blob)
&sp=r (read access)
&sip=168.1.5.60-168.1.5.70 (requests can only come from this range of IP addresses)
&spr=https (only allow HTTPS requests)
&sig=Z%2FRHIX5Xcg0Mq2rqI3OlWTjEg2tYkboXr1P9ZUXDtkk%3D (signature used for the authentication of the SAS)
```

#### <a name="how-the-shared-access-signature-is-authenticated-by-the-azure-storage-service"></a><span data-ttu-id="b42aa-297">Azure 儲存體服務驗證共用存取簽章的方式</span><span class="sxs-lookup"><span data-stu-id="b42aa-297">How the Shared Access Signature is authenticated by the Azure Storage Service</span></span>
<span data-ttu-id="b42aa-298">當儲存體服務收到要求時，它會取得輸入查詢參數，並使用與呼叫程式相同的方法來建立簽章。</span><span class="sxs-lookup"><span data-stu-id="b42aa-298">When the storage service receives the request, it takes the input query parameters and creates a signature using the same method as the calling program.</span></span> <span data-ttu-id="b42aa-299">然後比較這兩個簽章。</span><span class="sxs-lookup"><span data-stu-id="b42aa-299">It then compares the two signatures.</span></span> <span data-ttu-id="b42aa-300">如果它們同意，儲存體服務接著可以檢查儲存體服務版本，以確定它是有效的、檢查目前的日期和時間是在指定時段內、確定所要求的存取權會對應至所提出的要求，依此類推。</span><span class="sxs-lookup"><span data-stu-id="b42aa-300">If they agree, then the storage service can check the storage service version to make sure it's valid, verify that the current date and time are within the specified window, make sure the access requested corresponds to the request made, etc.</span></span>

<span data-ttu-id="b42aa-301">例如，利用上述的 URL，如果 URL 指向檔案而不是 Blob，此要求便會失敗，因為它指定共用存取簽章適用於 Blob。</span><span class="sxs-lookup"><span data-stu-id="b42aa-301">For example, with our URL above, if the URL was pointing to a file instead of a blob, this request would fail because it specifies that the Shared Access Signature is for a blob.</span></span> <span data-ttu-id="b42aa-302">如果呼叫的 REST 命令會更新 Blob，則該命令會失敗，因為共用存取簽章指定只准許讀取權限。</span><span class="sxs-lookup"><span data-stu-id="b42aa-302">If the REST command being called was to update a blob, it would fail because the Shared Access Signature specifies that only read access is permitted.</span></span>

#### <a name="types-of-shared-access-signatures"></a><span data-ttu-id="b42aa-303">共用存取簽章的類型</span><span class="sxs-lookup"><span data-stu-id="b42aa-303">Types of Shared Access Signatures</span></span>
* <span data-ttu-id="b42aa-304">服務層級的 SAS 可用來存取儲存體帳戶中的特定資源。</span><span class="sxs-lookup"><span data-stu-id="b42aa-304">A service-level SAS can be used to access specific resources in a storage account.</span></span> <span data-ttu-id="b42aa-305">這其中的一些範例會擷取容器中的 Blob 清單、下載 Blob、更新表格中的實體、將訊息新增至佇列，或將檔案上傳至檔案共用。</span><span class="sxs-lookup"><span data-stu-id="b42aa-305">Some examples of this are retrieving a list of blobs in a container, downloading a blob, updating an entity in a table, adding messages to a queue or uploading a file to a file share.</span></span>
* <span data-ttu-id="b42aa-306">帳戶層級的 SAS 可用來存取可使用服務層級 SAS 的任何項目。</span><span class="sxs-lookup"><span data-stu-id="b42aa-306">An account-level SAS can be used to access anything that a service-level SAS can be used for.</span></span> <span data-ttu-id="b42aa-307">此外，它可以為服務層級 SAS 不准許的資源提供選項，例如，能夠建立容器、表格、佇列及檔案共用。</span><span class="sxs-lookup"><span data-stu-id="b42aa-307">Additionally, it can give options to resources that are not permitted with a service-level SAS, such as the ability to create containers, tables, queues, and file shares.</span></span> <span data-ttu-id="b42aa-308">您也可以同時指定多個服務的存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-308">You can also specify access to multiple services at once.</span></span> <span data-ttu-id="b42aa-309">例如，您可能會為其他人提供您儲存體帳戶中 Blob 和檔案的存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-309">For example, you might give someone access to both blobs and files in your storage account.</span></span>

#### <a name="creating-an-sas-uri"></a><span data-ttu-id="b42aa-310">建立 SAS URI</span><span class="sxs-lookup"><span data-stu-id="b42aa-310">Creating an SAS URI</span></span>
1. <span data-ttu-id="b42aa-311">您可以視需要建立臨機操作的 URI，每次定義所有查詢參數。</span><span class="sxs-lookup"><span data-stu-id="b42aa-311">You can create an ad hoc URI on demand, defining all of the query parameters each time.</span></span>

   <span data-ttu-id="b42aa-312">這真的很有彈性，但如果您每次都有一組類似的邏輯參數，使用預存存取原則會是個不錯的做法。</span><span class="sxs-lookup"><span data-stu-id="b42aa-312">This is really flexible, but if you have a logical set of parameters that are similar each time, using a Stored Access Policy is a better idea.</span></span>
2. <span data-ttu-id="b42aa-313">您可以針對整個容器、檔案共用、表格或佇列建立預存存取原則。</span><span class="sxs-lookup"><span data-stu-id="b42aa-313">You can create a Stored Access Policy for an entire container, file share, table, or queue.</span></span> <span data-ttu-id="b42aa-314">然後使用這個原則做為您所建立的 SAS URI 基礎。</span><span class="sxs-lookup"><span data-stu-id="b42aa-314">Then you can use this as the basis for the SAS URIs you create.</span></span> <span data-ttu-id="b42aa-315">您可以輕鬆地撤銷以預存存取原則為基礎的權限。</span><span class="sxs-lookup"><span data-stu-id="b42aa-315">Permissions based on Stored Access Policies can be easily revoked.</span></span> <span data-ttu-id="b42aa-316">您可以在每個容器、佇列、表格或檔案共用上最多定義 5 個原則。</span><span class="sxs-lookup"><span data-stu-id="b42aa-316">You can have up to 5 policies defined on each container, queue, table, or file share.</span></span>

   <span data-ttu-id="b42aa-317">例如，如果您要讓許多人讀取特定容器中的 Blob，您可以建立預存存取原則，表示會「提供讀取權」以及每次都一樣的任何其他設定。</span><span class="sxs-lookup"><span data-stu-id="b42aa-317">For example, if you were going to have many people read the blobs in a specific container, you could create a Stored Access Policy that says "give read access" and any other settings that will be the same each time.</span></span> <span data-ttu-id="b42aa-318">接著您可以使用預存存取原則的設定，並指定到期日期/時間，來建立 SAS URI。</span><span class="sxs-lookup"><span data-stu-id="b42aa-318">Then you can create an SAS URI using the settings of the Stored Access Policy and specifying the expiration date/time.</span></span> <span data-ttu-id="b42aa-319">這樣做的優點是您不需每次指定所有查詢參數。</span><span class="sxs-lookup"><span data-stu-id="b42aa-319">The advantage of this is that you don't have to specify all of the query parameters every time.</span></span>

#### <a name="revocation"></a><span data-ttu-id="b42aa-320">撤銷</span><span class="sxs-lookup"><span data-stu-id="b42aa-320">Revocation</span></span>
<span data-ttu-id="b42aa-321">假設您的 SAS 已遭洩露，或您想要基於公司安全性或法規遵循需求加以變更。</span><span class="sxs-lookup"><span data-stu-id="b42aa-321">Suppose your SAS has been compromised, or you want to change it because of corporate security or regulatory compliance requirements.</span></span> <span data-ttu-id="b42aa-322">您如何使用該 SAS 撤銷資源的存取權？</span><span class="sxs-lookup"><span data-stu-id="b42aa-322">How do you revoke access to a resource using that SAS?</span></span> <span data-ttu-id="b42aa-323">這取決於您建立 SAS URI 的方式。</span><span class="sxs-lookup"><span data-stu-id="b42aa-323">It depends on how you created the SAS URI.</span></span>

<span data-ttu-id="b42aa-324">如果您使用臨機操作的 URI，會有三個選項。</span><span class="sxs-lookup"><span data-stu-id="b42aa-324">If you are using ad hoc URI's, you have three options.</span></span> <span data-ttu-id="b42aa-325">您可以發出具備短期到期原則的 SAS 權杖，然後只需等待 SA 到期。</span><span class="sxs-lookup"><span data-stu-id="b42aa-325">You can issue SAS tokens with short expiration policies and simply wait for the SAS to expire.</span></span> <span data-ttu-id="b42aa-326">您可以重新命名或刪除資源 (假設權杖範圍只限於單一物件)。</span><span class="sxs-lookup"><span data-stu-id="b42aa-326">You can rename or delete the resource (assuming the token was scoped to a single object).</span></span> <span data-ttu-id="b42aa-327">您可以變更儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-327">You can change the storage account keys.</span></span> <span data-ttu-id="b42aa-328">根據使用該儲存體帳戶的服務數目而定，這最後一個選項可能會產生很大的影響，而且可能不是您在沒有任何規劃的情況下想要達到的結果。</span><span class="sxs-lookup"><span data-stu-id="b42aa-328">This last option can have a big impact, depending on how many services are using that storage account, and probably isn't something you want to do without some planning.</span></span>

<span data-ttu-id="b42aa-329">如果您使用衍生自預存存取原則的 SAS，就可以藉由撤銷預存存取原則來移除存取權 – 您只能在它已經完全過期時加以變更，或完全移除它。</span><span class="sxs-lookup"><span data-stu-id="b42aa-329">If you are using a SAS derived from a Stored Access Policy, you can remove access by revoking the Stored Access Policy – you can just change it so it has already expired, or you can remove it altogether.</span></span> <span data-ttu-id="b42aa-330">這會立即生效，並使每個使用該預存存取原則建立的 SAS 失效。</span><span class="sxs-lookup"><span data-stu-id="b42aa-330">This takes effect immediately, and invalidates every SAS created using that Stored Access Policy.</span></span> <span data-ttu-id="b42aa-331">更新或移除預存存取原則可能會影響透過 SAS 存取該特定容器、檔案共用、表格或佇列的使用者，但如果會寫入用戶端，使得他們可在舊的 SAS 變成無效時要求一個新的 SAS，則這將可正常運作。</span><span class="sxs-lookup"><span data-stu-id="b42aa-331">Updating or removing the Stored Access Policy may impact people accessing that specific container, file share, table, or queue via SAS, but if the clients are written so they request a new SAS when the old one becomes invalid, this will work fine.</span></span>

<span data-ttu-id="b42aa-332">因為使用衍生自預存存取原則的 SAS 讓您能夠立即撤銷該 SAS，所以建議的最佳做法是一律儲存預存存取原則 (如果可能)。</span><span class="sxs-lookup"><span data-stu-id="b42aa-332">Because using a SAS derived from a Stored Access Policy gives you the ability to revoke that SAS immediately, it is the recommended best practice to always use Stored Access Policies when possible.</span></span>

#### <a name="resources"></a><span data-ttu-id="b42aa-333">資源</span><span class="sxs-lookup"><span data-stu-id="b42aa-333">Resources</span></span>
<span data-ttu-id="b42aa-334">如需使用共用存取簽章和預存存取原則的詳細資訊，並完成範例，請參閱下列文章︰</span><span class="sxs-lookup"><span data-stu-id="b42aa-334">For more detailed information on using Shared Access Signatures and Stored Access Policies, complete with examples, please refer to the following articles:</span></span>

* <span data-ttu-id="b42aa-335">以下是參考文章。</span><span class="sxs-lookup"><span data-stu-id="b42aa-335">These are the reference articles.</span></span>

  * [<span data-ttu-id="b42aa-336">服務 SAS</span><span class="sxs-lookup"><span data-stu-id="b42aa-336">Service SAS</span></span>](https://msdn.microsoft.com/library/dn140256.aspx)

    <span data-ttu-id="b42aa-337">本文提供使用服務層級 SAS 搭配 Blob、佇列、表格範圍及檔案的範例。</span><span class="sxs-lookup"><span data-stu-id="b42aa-337">This article provides examples of using a service-level SAS with blobs, queue messages, table ranges, and files.</span></span>
  * [<span data-ttu-id="b42aa-338">建構服務 SAS</span><span class="sxs-lookup"><span data-stu-id="b42aa-338">Constructing a service SAS</span></span>](https://msdn.microsoft.com/library/dn140255.aspx)
  * [<span data-ttu-id="b42aa-339">建構帳戶 SAS</span><span class="sxs-lookup"><span data-stu-id="b42aa-339">Constructing an account SAS</span></span>](https://msdn.microsoft.com/library/mt584140.aspx)
* <span data-ttu-id="b42aa-340">這些是使用 .NET 用戶端程式庫，來建立共用存取簽章和預存存取原則的教學課程。</span><span class="sxs-lookup"><span data-stu-id="b42aa-340">These are tutorials for using the .NET client library to create Shared Access Signatures and Stored Access Policies.</span></span>

  * [<span data-ttu-id="b42aa-341">使用共用存取簽章 (SAS)</span><span class="sxs-lookup"><span data-stu-id="b42aa-341">Using Shared Access Signatures (SAS)</span></span>](../storage-dotnet-shared-access-signature-part-1.md)
  * [<span data-ttu-id="b42aa-342">共用存取簽章，第 2 部分：透過 Blob 服務來建立與使用 SAS</span><span class="sxs-lookup"><span data-stu-id="b42aa-342">Shared Access Signatures, Part 2: Create and Use a SAS with the Blob Service</span></span>](../blobs/storage-dotnet-shared-access-signature-part-2.md)

    <span data-ttu-id="b42aa-343">本文包含 SAS 模型的說明、共用存取簽章的範例，以及使用 SAS 最佳做法的建議。</span><span class="sxs-lookup"><span data-stu-id="b42aa-343">This article includes an explanation of the SAS model, examples of Shared Access Signatures, and recommendations for the best practice use of SAS.</span></span> <span data-ttu-id="b42aa-344">同時也會討論撤銷授與的權限。</span><span class="sxs-lookup"><span data-stu-id="b42aa-344">Also discussed is the revocation of the permission granted.</span></span>
* <span data-ttu-id="b42aa-345">依 IP 位址 (IP ACL) 限制存取</span><span class="sxs-lookup"><span data-stu-id="b42aa-345">Limiting access by IP Address (IP ACLs)</span></span>

  * [<span data-ttu-id="b42aa-346">什麼是端點存取控制清單 (ACL)？</span><span class="sxs-lookup"><span data-stu-id="b42aa-346">What is an endpoint Access Control List (ACLs)?</span></span>](../../virtual-network/virtual-networks-acl.md)
  * [<span data-ttu-id="b42aa-347">建構服務 SAS</span><span class="sxs-lookup"><span data-stu-id="b42aa-347">Constructing a Service SAS</span></span>](https://msdn.microsoft.com/library/azure/dn140255.aspx)

    <span data-ttu-id="b42aa-348">這是適用於服務層級 SAS 的參考文章，其中包括執行 IP ACL 的範例。</span><span class="sxs-lookup"><span data-stu-id="b42aa-348">This is the reference article for service-level SAS; it includes an example of IP ACLing.</span></span>
  * [<span data-ttu-id="b42aa-349">建構帳戶 SAS</span><span class="sxs-lookup"><span data-stu-id="b42aa-349">Constructing an Account SAS</span></span>](https://msdn.microsoft.com/library/azure/mt584140.aspx)

    <span data-ttu-id="b42aa-350">這是適用於帳戶層級 SAS 的參考文章，其中包括執行 IP ACL 的範例。</span><span class="sxs-lookup"><span data-stu-id="b42aa-350">This is the reference article for account-level SAS; it includes an example of IP ACLing.</span></span>
* <span data-ttu-id="b42aa-351">驗證</span><span class="sxs-lookup"><span data-stu-id="b42aa-351">Authentication</span></span>

  * [<span data-ttu-id="b42aa-352">Azure 儲存體服務的驗證</span><span class="sxs-lookup"><span data-stu-id="b42aa-352">Authentication for the Azure Storage Services</span></span>](https://msdn.microsoft.com/library/azure/dd179428.aspx)
* <span data-ttu-id="b42aa-353">共用存取簽章入門教學課程</span><span class="sxs-lookup"><span data-stu-id="b42aa-353">Shared Access Signatures Getting Started Tutorial</span></span>

  * [<span data-ttu-id="b42aa-354">SAS 入門教學課程</span><span class="sxs-lookup"><span data-stu-id="b42aa-354">SAS Getting Started Tutorial</span></span>](https://github.com/Azure-Samples/storage-dotnet-sas-getting-started)

## <a name="encryption-in-transit"></a><span data-ttu-id="b42aa-355">傳輸中加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-355">Encryption in Transit</span></span>
### <a name="transport-level-encryption--using-https"></a><span data-ttu-id="b42aa-356">Transport-Level Encryption – Using HTTPS</span><span class="sxs-lookup"><span data-stu-id="b42aa-356">Transport-Level Encryption – Using HTTPS</span></span>
<span data-ttu-id="b42aa-357">您應該採取以確保 Azure 儲存體資料安全性的另一個步驟是在用戶端和 Azure 儲存體之間加密資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-357">Another step you should take to ensure the security of your Azure Storage data is to encrypt the data between the client and Azure Storage.</span></span> <span data-ttu-id="b42aa-358">第一個建議是一律使用 [HTTPS](https://en.wikipedia.org/wiki/HTTPS) 通訊協定，可確保透過公用網際網路的安全通訊。</span><span class="sxs-lookup"><span data-stu-id="b42aa-358">The first recommendation is to always use the [HTTPS](https://en.wikipedia.org/wiki/HTTPS) protocol, which ensures secure communication over the public Internet.</span></span>

<span data-ttu-id="b42aa-359">如果要有安全的通訊通道，呼叫 REST API 或存取儲存體中的物件時，您應該一律使用 HTTPS。</span><span class="sxs-lookup"><span data-stu-id="b42aa-359">To have a secure communication channel, you should always use HTTPS when calling the REST APIs or accessing objects in storage.</span></span> <span data-ttu-id="b42aa-360">此外， **共用存取簽章** (可用來委派 Azure 儲存體物件的存取權) 包含一個選項，可指定在使用共用存取簽章時只能使用 HTTPS 通訊協定，以確保任何使用 SAS 權杖送出連結的人都將使用正確的通訊協定。</span><span class="sxs-lookup"><span data-stu-id="b42aa-360">Also, **Shared Access Signatures**, which can be used to delegate access to Azure Storage objects, include an option to specify that only the HTTPS protocol can be used when using Shared Access Signatures, ensuring that anybody sending out links with SAS tokens will use the proper protocol.</span></span>

<span data-ttu-id="b42aa-361">透過啟用儲存體帳戶[所需的安全傳輸](../storage-require-secure-transfer.md)，您可於呼叫 REST API 來存取儲存體帳戶中的物件時強制使用 HTTPS。</span><span class="sxs-lookup"><span data-stu-id="b42aa-361">You can enforce the use of HTTPS when calling the REST APIs to access objects in storage accounts by enabling [Secure transfer required](../storage-require-secure-transfer.md) for the storage account.</span></span> <span data-ttu-id="b42aa-362">啟用此選項後，使用 HTTP 的連線將被拒絕。</span><span class="sxs-lookup"><span data-stu-id="b42aa-362">Connections using HTTP will be refused once this is enabled.</span></span>

### <a name="using-encryption-during-transit-with-azure-file-shares"></a><span data-ttu-id="b42aa-363">傳輸期間透過 Azure 檔案共用使用加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-363">Using encryption during transit with Azure File shares</span></span>
<span data-ttu-id="b42aa-364">使用 REST API 時，Azure 檔案儲存體支援 HTTPS，但較常用來做為連接到 VM 的 SMB 檔案共用。</span><span class="sxs-lookup"><span data-stu-id="b42aa-364">Azure File storage supports HTTPS when using the REST API, but is more commonly used as an SMB file share attached to a VM.</span></span> <span data-ttu-id="b42aa-365">SMB 2.1 不支援加密，因此只允許在 Azure 中的相同區域內連接。</span><span class="sxs-lookup"><span data-stu-id="b42aa-365">SMB 2.1 does not support encryption, so connections are only allowed within the same region in Azure.</span></span> <span data-ttu-id="b42aa-366">不過，SMB 3.0 支援加密，而且可在 Windows Server 2012 R2、Windows 8、Windows 8.1 和 Windows 10 中使用，允許跨區域存取，甚至是電腦上的存取。</span><span class="sxs-lookup"><span data-stu-id="b42aa-366">However, SMB 3.0 supports encryption, and it's available in Windows Server 2012 R2, Windows 8, Windows 8.1, and Windows 10, allowing cross-region access and even access on the desktop.</span></span>

<span data-ttu-id="b42aa-367">請注意，雖然 Azure 檔案共用可以與 Unix 搭配使用，但 Linux SMB 用戶端尚未支援加密，因此只允許在 Azure 區域內存取。</span><span class="sxs-lookup"><span data-stu-id="b42aa-367">Note that while Azure File shares can be used with Unix, the Linux SMB client does not yet support encryption, so access is only allowed within an Azure region.</span></span> <span data-ttu-id="b42aa-368">適用於 Linux 的加密支援已列入開發藍圖中，負責 SMB 功能的 Linux 開發人員將著手開發。</span><span class="sxs-lookup"><span data-stu-id="b42aa-368">Encryption support for Linux is on the roadmap of Linux developers responsible for SMB functionality.</span></span> <span data-ttu-id="b42aa-369">當他們新增加密功能時，您在 Linux 系統中存取 Azure 檔案共用的能力將與在 Windows 系統中相同。</span><span class="sxs-lookup"><span data-stu-id="b42aa-369">When they add encryption, you will have the same ability for accessing an Azure File share on Linux as you do for Windows.</span></span>

<span data-ttu-id="b42aa-370">透過啟用儲存體帳戶[所需的安全傳輸](../storage-require-secure-transfer.md)，您可以強制為 Azure 檔案服務使用加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-370">You can enforce the use of encryption with the Azure Files service by enabling [Secure transfer required](../storage-require-secure-transfer.md) for the storage account.</span></span> <span data-ttu-id="b42aa-371">如果使用 REST API，則需要 HTTPs。</span><span class="sxs-lookup"><span data-stu-id="b42aa-371">If using the REST APIs, HTTPs is required.</span></span> <span data-ttu-id="b42aa-372">針對 SMB，只有支援加密的 SMB 連線可以成功連線。</span><span class="sxs-lookup"><span data-stu-id="b42aa-372">For SMB, only SMB connections that support encryption will connect successfully.</span></span>

#### <a name="resources"></a><span data-ttu-id="b42aa-373">資源</span><span class="sxs-lookup"><span data-stu-id="b42aa-373">Resources</span></span>
* [<span data-ttu-id="b42aa-374">如何搭配使用 Azure 檔案儲存體與 Linux</span><span class="sxs-lookup"><span data-stu-id="b42aa-374">How to use Azure File storage with Linux</span></span>](../storage-how-to-use-files-linux.md)

  <span data-ttu-id="b42aa-375">本文說明如何在 Linux 系統上掛接 Azure 檔案共用，以及上傳/下載檔案。</span><span class="sxs-lookup"><span data-stu-id="b42aa-375">This article shows how to mount an Azure File share on a Linux system and upload/download files.</span></span>
* [<span data-ttu-id="b42aa-376">在 Windows 上開始使用 Azure 檔案儲存體</span><span class="sxs-lookup"><span data-stu-id="b42aa-376">Get started with Azure File storage on Windows</span></span>](../storage-dotnet-how-to-use-files.md)

  <span data-ttu-id="b42aa-377">本文概述 Azure 檔案共用，以及如何使用 PowerShell 與 .NET 來掛接和使用它們。</span><span class="sxs-lookup"><span data-stu-id="b42aa-377">This article gives an overview of Azure File shares and how to mount and use them using PowerShell and .NET.</span></span>
* [<span data-ttu-id="b42aa-378">Azure 檔案儲存體內部</span><span class="sxs-lookup"><span data-stu-id="b42aa-378">Inside Azure File storage</span></span>](https://azure.microsoft.com/blog/inside-azure-file-storage/)

  <span data-ttu-id="b42aa-379">本文發表了 Azure 檔案儲存體的一般可用性，並提供關於 SMB 3.0 加密技術的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-379">This article announces the general availability of Azure File storage and provides technical details about the SMB 3.0 encryption.</span></span>

### <a name="using-client-side-encryption-to-secure-data-that-you-send-to-storage"></a><span data-ttu-id="b42aa-380">使用用戶端加密來保護傳送到儲存體的資料</span><span class="sxs-lookup"><span data-stu-id="b42aa-380">Using Client-side encryption to secure data that you send to storage</span></span>
<span data-ttu-id="b42aa-381">另一個可協助您確保在用戶端應用程式和儲存體之間傳輸時資料安全性的選項是用戶端加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-381">Another option that helps you ensure that your data is secure while being transferred between a client application and Storage is Client-side Encryption.</span></span> <span data-ttu-id="b42aa-382">資料會先加密，然後才傳輸到 Azure 儲存體。</span><span class="sxs-lookup"><span data-stu-id="b42aa-382">The data is encrypted before being transferred into Azure Storage.</span></span> <span data-ttu-id="b42aa-383">從 Azure 儲存體擷取資料時，在用戶端上收到資料之後要將之解密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-383">When retrieving the data from Azure Storage, the data is decrypted after it is received on the client side.</span></span> <span data-ttu-id="b42aa-384">即使資料在通過連線時已加密，但還是建議您使用 HTTPS，因為其內建資料完整性檢查，有助於降低影響資料完整性的網路錯誤。</span><span class="sxs-lookup"><span data-stu-id="b42aa-384">Even though the data is encrypted going across the wire, we recommend that you also use HTTPS, as it has data integrity checks built in which help mitigate network errors affecting the integrity of the data.</span></span>

<span data-ttu-id="b42aa-385">用戶端加密也是一個可用來加密待用資料的方法，因為資料是以加密形式所儲存。</span><span class="sxs-lookup"><span data-stu-id="b42aa-385">Client-side encryption is also a method for encrypting your data at rest, as the data is stored in its encrypted form.</span></span> <span data-ttu-id="b42aa-386">我們將在 [待用加密](#encryption-at-rest)一節中詳細討論這一點。</span><span class="sxs-lookup"><span data-stu-id="b42aa-386">We'll talk about this in more detail in the section on [Encryption at Rest](#encryption-at-rest).</span></span>

## <a name="encryption-at-rest"></a><span data-ttu-id="b42aa-387">待用加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-387">Encryption at Rest</span></span>
<span data-ttu-id="b42aa-388">有三個 Azure 功能可提供待用加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-388">There are three Azure features that provide encryption at rest.</span></span> <span data-ttu-id="b42aa-389">Azure 磁碟加密可用來加密 IaaS 虛擬機器中的作業系統和資料磁碟。</span><span class="sxs-lookup"><span data-stu-id="b42aa-389">Azure Disk Encryption is used to encrypt the OS and data disks in IaaS Virtual Machines.</span></span> <span data-ttu-id="b42aa-390">其他兩個 (用戶端加密和 SSE) 都是用來加密 Azure 儲存體中的資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-390">The other two – Client-side Encryption and SSE – are both used to encrypt data in Azure Storage.</span></span> <span data-ttu-id="b42aa-391">讓我們看看每一個，然後進行比較，並查看每一個的使用時機。</span><span class="sxs-lookup"><span data-stu-id="b42aa-391">Let's look at each of these, and then do a comparison and see when each one can be used.</span></span>

<span data-ttu-id="b42aa-392">儘管您可以使用用戶端加密來加密傳輸中的資料 (也會以其加密形式儲存於儲存體中)，您可能習慣在傳輸期間只使用 HTTPS，而且有一些方式可讓資料在儲存時自動加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-392">While you can use Client-side Encryption to encrypt the data in transit (which is also stored in its encrypted form in Storage), you may prefer to simply use HTTPS during the transfer, and have some way for the data to be automatically encrypted when it is stored.</span></span> <span data-ttu-id="b42aa-393">有兩種做法可以執行此動作 -- Azure 磁碟加密和 SSE。</span><span class="sxs-lookup"><span data-stu-id="b42aa-393">There are two ways to do this -- Azure Disk Encryption and SSE.</span></span> <span data-ttu-id="b42aa-394">其中一種是用來直接加密 VM 所使用的作業系統和資料磁碟上的資料，另一種則是用來加密寫入 Azure Blob 儲存體的資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-394">One is used to directly encrypt the data on OS and data disks used by VMs, and the other is used to encrypt data written to Azure Blob Storage.</span></span>

### <a name="storage-service-encryption-sse"></a><span data-ttu-id="b42aa-395">儲存體服務加密 (SSE)</span><span class="sxs-lookup"><span data-stu-id="b42aa-395">Storage Service Encryption (SSE)</span></span>
<span data-ttu-id="b42aa-396">SSE 可讓您要求儲存體服務在將資料寫入 Azure 儲存體時自動加密資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-396">SSE allows you to request that the storage service automatically encrypt the data when writing it to Azure Storage.</span></span> <span data-ttu-id="b42aa-397">當您從 Azure 儲存體讀取資料時，儲存體服務會在傳回資料之前將之解密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-397">When you read the data from Azure Storage, it will be decrypted by the storage service before being returned.</span></span> <span data-ttu-id="b42aa-398">這讓能夠您保護資料，而不需修改程式碼或將程式碼加入任何應用程式。</span><span class="sxs-lookup"><span data-stu-id="b42aa-398">This enables you to secure your data without having to modify code or add code to any applications.</span></span>

<span data-ttu-id="b42aa-399">這是套用至整個儲存體帳戶的設定。</span><span class="sxs-lookup"><span data-stu-id="b42aa-399">This is a setting that applies to the whole storage account.</span></span> <span data-ttu-id="b42aa-400">您可以藉由變更設定的值來啟用和停用此功能。</span><span class="sxs-lookup"><span data-stu-id="b42aa-400">You can enable and disable this feature by changing the value of the setting.</span></span> <span data-ttu-id="b42aa-401">若要這樣做，您可以使用 Azure 入口網站、PowerShell、Azure CLI、儲存體資源提供者 REST API 或 .NET 儲存體用戶端程式庫。</span><span class="sxs-lookup"><span data-stu-id="b42aa-401">To do this, you can use the Azure portal, PowerShell, the Azure CLI, the Storage Resource Provider REST API, or the .NET Storage Client Library.</span></span> <span data-ttu-id="b42aa-402">根據預設，SSE 已關閉。</span><span class="sxs-lookup"><span data-stu-id="b42aa-402">By default, SSE is turned off.</span></span>

<span data-ttu-id="b42aa-403">在此階段中，用來加密的金鑰是由 Microsoft 所管理。</span><span class="sxs-lookup"><span data-stu-id="b42aa-403">At this time, the keys used for the encryption are managed by Microsoft.</span></span> <span data-ttu-id="b42aa-404">我們一開始會產生金鑰，並管理金鑰的安全儲存體，以及如同內部 Microsoft 原則所定義的定期輪換。</span><span class="sxs-lookup"><span data-stu-id="b42aa-404">We generate the keys originally, and manage the secure storage of the keys as well as the regular rotation as defined by internal Microsoft policy.</span></span> <span data-ttu-id="b42aa-405">您未來將會獲得管理您自己加密金鑰的功能，並提供從 Microsoft 管理的金鑰到客戶管理的金鑰的移轉路徑。</span><span class="sxs-lookup"><span data-stu-id="b42aa-405">In the future, you will get the ability to manage your own encryption keys, and provide a migration path from Microsoft-managed keys to customer-managed keys.</span></span>

<span data-ttu-id="b42aa-406">此功能適用於使用 Resource Manager 部署模型建立的標準和進階儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-406">This feature is available for Standard and Premium Storage accounts created using the Resource Manager deployment model.</span></span> <span data-ttu-id="b42aa-407">SSE 只適用於區塊 Blob、分頁 Blob 及附加 Blob。</span><span class="sxs-lookup"><span data-stu-id="b42aa-407">SSE applies only to block blobs, page blobs, and append blobs.</span></span> <span data-ttu-id="b42aa-408">其他類型的資料 (包括表格、佇列和檔案) 將不會加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-408">The other types of data, including tables, queues, and files, will not be encrypted.</span></span>

<span data-ttu-id="b42aa-409">資料只有在啟用 SSE 並將資料寫入 Blob 儲存體時才會加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-409">Data is only encrypted when SSE is enabled and the data is written to Blob Storage.</span></span> <span data-ttu-id="b42aa-410">啟用或停用 SSE 並不會影響現有的資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-410">Enabling or disabling SSE does not impact existing data.</span></span> <span data-ttu-id="b42aa-411">換句話說，當您啟用此加密時，它將不會返回並加密已經存在的資料；也不會解密當您停用 SSE 時已經存在的資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-411">In other words, when you enable this encryption, it will not go back and encrypt data that already exists; nor will it decrypt the data that already exists when you disable SSE.</span></span>

<span data-ttu-id="b42aa-412">如果您想要搭配傳統儲存體帳戶使用此功能，您可以建立新的 Resource Manager 儲存體帳戶，並使用 AzCopy 來將資料複製到新帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-412">If you want to use this feature with a Classic storage account, you can create a new Resource Manager storage account and use AzCopy to copy the data to the new account.</span></span>

### <a name="client-side-encryption"></a><span data-ttu-id="b42aa-413">用戶端加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-413">Client-side Encryption</span></span>
<span data-ttu-id="b42aa-414">在討論傳輸中的資料加密時，我們曾提及用戶端加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-414">We mentioned client-side encryption when discussing the encryption of the data in transit.</span></span> <span data-ttu-id="b42aa-415">此功能可讓您以程式設計方式加密用戶端應用程式中的資料，然後透過連線傳送資料以寫入 Azure 儲存體，並在從 Azure 儲存體擷取資料之後以程式設計方式解密資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-415">This feature allows you to programmatically encrypt your data in a client application before sending it across the wire to be written to Azure Storage, and to programmatically decrypt your data after retrieving it from Azure Storage.</span></span>

<span data-ttu-id="b42aa-416">這會提供在傳輸中加密，但也會提供待用加密的功能。</span><span class="sxs-lookup"><span data-stu-id="b42aa-416">This does provide encryption in transit, but it also provides the feature of Encryption at Rest.</span></span> <span data-ttu-id="b42aa-417">請注意，雖然會在傳輸過程中加密資料，仍建議使用 HTTPS 來充分利用內建的資料完整性檢查，協助降低影響資料完整性的網路錯誤。</span><span class="sxs-lookup"><span data-stu-id="b42aa-417">Note that although the data is encrypted in transit, we still recommend using HTTPS to take advantage of the built-in data integrity checks which help mitigate network errors affecting the integrity of the data.</span></span>

<span data-ttu-id="b42aa-418">如果 Web 應用程式會儲存 Blob 和擷取 Blob，而您想要讓應用程式和資料儘可能保持安全，則可使用此範例。</span><span class="sxs-lookup"><span data-stu-id="b42aa-418">An example of where you might use this is if you have a web application that stores blobs and retrieves blobs, and you want the application and data to be as secure as possible.</span></span> <span data-ttu-id="b42aa-419">在此情況下，您會使用用戶端加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-419">In that case, you would use client-side encryption.</span></span> <span data-ttu-id="b42aa-420">用戶端和 Azure Blob 服務之間的流量包含加密的資源，而且沒有人能夠解譯傳輸中的資料並將它重組到您的私人 Blob。</span><span class="sxs-lookup"><span data-stu-id="b42aa-420">The traffic between the client and the Azure Blob Service contains the encrypted resource, and nobody can interpret the data in transit and reconstitute it into your private blobs.</span></span>

<span data-ttu-id="b42aa-421">用戶端加密內建於 Java 和 .NET 儲存體用戶端程式庫，接著會使用 Azure 金鑰保存庫 API，讓您實作變得很簡單。</span><span class="sxs-lookup"><span data-stu-id="b42aa-421">Client-side encryption is built into the Java and the .NET storage client libraries, which in turn use the Azure Key Vault APIs, making it pretty easy for you to implement.</span></span> <span data-ttu-id="b42aa-422">加密和解密資料的程序會使用信封技術，並在每個儲存體物件中儲存加密所使用的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-422">The process of encrypting and decrypting the data uses the envelope technique, and stores metadata used by the encryption in each storage object.</span></span> <span data-ttu-id="b42aa-423">例如，如果是 Blob，會將它儲存於 Blob 中繼資料中，如果是佇列，則會將它新增至每個佇列訊息。</span><span class="sxs-lookup"><span data-stu-id="b42aa-423">For example, for blobs, it stores it in the blob metadata, while for queues, it adds it to each queue message.</span></span>

<span data-ttu-id="b42aa-424">至於加密本身，您可以產生和管理自己的加密金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-424">For the encryption itself, you can generate and manage your own encryption keys.</span></span> <span data-ttu-id="b42aa-425">您也可以使用 Azure 儲存體用戶端程式庫所產生的金鑰，或者可以讓 Azure 金鑰保存庫產生金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-425">You can also use keys generated by the Azure Storage Client Library, or you can have the Azure Key Vault generate the keys.</span></span> <span data-ttu-id="b42aa-426">您可以將加密金鑰儲存於內部部署金鑰儲存體中，或將它們儲存在 Azure 金鑰保存庫中。</span><span class="sxs-lookup"><span data-stu-id="b42aa-426">You can store your encryption keys in your on-premises key storage, or you can store them in an Azure Key Vault.</span></span> <span data-ttu-id="b42aa-427">Azure 金鑰保存庫可讓您使用 Azure Active Directory，為特定的使用者授與 Azure 金鑰保存庫中密碼的存取權。</span><span class="sxs-lookup"><span data-stu-id="b42aa-427">Azure Key Vault allows you to grant access to the secrets in Azure Key Vault to specific users using Azure Active Directory.</span></span> <span data-ttu-id="b42aa-428">這表示並非人人都能讀取 Azure Key Vault，以及擷取您用來進行用戶端加密的金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-428">This means that not just anybody can read the Azure Key Vault and retrieve the keys you're using for client-side encryption.</span></span>

#### <a name="resources"></a><span data-ttu-id="b42aa-429">資源</span><span class="sxs-lookup"><span data-stu-id="b42aa-429">Resources</span></span>
* [<span data-ttu-id="b42aa-430">在 Microsoft Azure 儲存體中使用 Azure 金鑰保存庫加密和解密 blob</span><span class="sxs-lookup"><span data-stu-id="b42aa-430">Encrypt and decrypt blobs in Microsoft Azure Storage using Azure Key Vault</span></span>](../blobs/storage-encrypt-decrypt-blobs-key-vault.md)

  <span data-ttu-id="b42aa-431">本文說明如何搭配 Azure 金鑰保存庫使用用戶端加密，包括如何使用 PowerShell 來建立 KEK 並將它儲存在保存庫中。</span><span class="sxs-lookup"><span data-stu-id="b42aa-431">This article shows how to use client-side encryption with Azure Key Vault, including how to create the KEK and store it in the vault using PowerShell.</span></span>
* [<span data-ttu-id="b42aa-432">Microsoft Azure 儲存體的用戶端加密和 Azure Key Vault 金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="b42aa-432">Client-Side Encryption and Azure Key Vault for Microsoft Azure Storage</span></span>](../storage-client-side-encryption.md)

  <span data-ttu-id="b42aa-433">本文說明用戶端加密，並提供使用儲存體用戶端程式庫，從四個儲存體服務加密和解密資源的範例。</span><span class="sxs-lookup"><span data-stu-id="b42aa-433">This article gives an explanation of client-side encryption, and provides examples of using the storage client library to encrypt and decrypt resources from the four storage services.</span></span> <span data-ttu-id="b42aa-434">它也會討論 Azure 金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="b42aa-434">It also talks about Azure Key Vault.</span></span>

### <a name="using-azure-disk-encryption-to-encrypt-disks-used-by-your-virtual-machines"></a><span data-ttu-id="b42aa-435">使用 Azure 磁碟加密來加密虛擬機器所使用的磁碟</span><span class="sxs-lookup"><span data-stu-id="b42aa-435">Using Azure Disk Encryption to encrypt disks used by your virtual machines</span></span>
<span data-ttu-id="b42aa-436">「Azure 磁碟加密」是一個新功能。</span><span class="sxs-lookup"><span data-stu-id="b42aa-436">Azure Disk Encryption is a new feature.</span></span> <span data-ttu-id="b42aa-437">此功能允許您加密 IaaS 虛擬機器所使用的作業系統磁碟和資料磁碟。</span><span class="sxs-lookup"><span data-stu-id="b42aa-437">This feature allows you to encrypt the OS disks and Data disks used by an IaaS Virtual Machine.</span></span> <span data-ttu-id="b42aa-438">對於 Windows，磁碟機是使用業界標準的 BitLocker 加密技術來加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-438">For Windows, the drives are encrypted using industry-standard BitLocker encryption technology.</span></span> <span data-ttu-id="b42aa-439">對於 Linux，磁碟是使用 DM-Crypt 技術來加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-439">For Linux, the disks are encrypted using the DM-Crypt technology.</span></span> <span data-ttu-id="b42aa-440">這會與 Azure 金鑰保存庫整合，可讓您控制和管理磁碟加密金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42aa-440">This is integrated with Azure Key Vault to allow you to control and manage the disk encryption keys.</span></span>

<span data-ttu-id="b42aa-441">在 Microsoft Azure 中啟用時，解決方案會對 IaaS VM 支援下列案例：</span><span class="sxs-lookup"><span data-stu-id="b42aa-441">The solution supports the following scenarios for IaaS VMs when they are enabled in Microsoft Azure:</span></span>

* <span data-ttu-id="b42aa-442">與 Azure 金鑰保存庫整合</span><span class="sxs-lookup"><span data-stu-id="b42aa-442">Integration with Azure Key Vault</span></span>
* <span data-ttu-id="b42aa-443">標準層 VM：[A、D、DS、G、GS 等系列 IaaS VM](https://azure.microsoft.com/pricing/details/virtual-machines/)</span><span class="sxs-lookup"><span data-stu-id="b42aa-443">Standard tier VMs: [A, D, DS, G, GS, and so forth series IaaS VMs](https://azure.microsoft.com/pricing/details/virtual-machines/)</span></span>
* <span data-ttu-id="b42aa-444">在 Windows 和 Linux IaaS VM 上啟用加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-444">Enabling encryption on Windows and Linux IaaS VMs</span></span>
* <span data-ttu-id="b42aa-445">為 Windows IaaS VM 的 OS 和資料磁碟機停用加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-445">Disabling encryption on OS and data drives for Windows IaaS VMs</span></span>
* <span data-ttu-id="b42aa-446">為 Linux IaaS VM 的資料磁碟機停用加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-446">Disabling encryption on data drives for Linux IaaS VMs</span></span>
* <span data-ttu-id="b42aa-447">在執行 Windows 用戶端 OS 的 IaaS VM 上啟用加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-447">Enabling encryption on IaaS VMs that are running Windows client OS</span></span>
* <span data-ttu-id="b42aa-448">在具有掛接路徑的磁碟區上啟用加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-448">Enabling encryption on volumes with mount paths</span></span>
* <span data-ttu-id="b42aa-449">在使用 mdadm 設定了等量磁碟 (RAID) 的 Linux VM 上啟用加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-449">Enabling encryption on Linux VMs that are configured with disk striping (RAID) by using mdadm</span></span>
* <span data-ttu-id="b42aa-450">在使用資料磁碟適用之 LVM 的 Linux VM 上啟用加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-450">Enabling encryption on Linux VMs by using LVM for data disks</span></span>
* <span data-ttu-id="b42aa-451">在使用儲存空間設定的 Windows VM 上啟用加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-451">Enabling encryption on Windows VMs that are configured by using storage spaces</span></span>
* <span data-ttu-id="b42aa-452">所有 Azure 公用區域皆受到支援</span><span class="sxs-lookup"><span data-stu-id="b42aa-452">All Azure public regions are supported</span></span>

<span data-ttu-id="b42aa-453">解決方案不支援此版本中的下列案例、功能和技術：</span><span class="sxs-lookup"><span data-stu-id="b42aa-453">The solution does not support the following scenarios, features, and technology in the release:</span></span>

* <span data-ttu-id="b42aa-454">基本層 IaaS VM</span><span class="sxs-lookup"><span data-stu-id="b42aa-454">Basic tier IaaS VMs</span></span>
* <span data-ttu-id="b42aa-455">在 Linux IaaS VM 的 OS 磁碟機上停用加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-455">Disabling encryption on an OS drive for Linux IaaS VMs</span></span>
* <span data-ttu-id="b42aa-456">使用傳統 VM 建立方法所建立的 IaaS VM</span><span class="sxs-lookup"><span data-stu-id="b42aa-456">IaaS VMs that are created by using the classic VM creation method</span></span>
* <span data-ttu-id="b42aa-457">與您的內部部署金鑰管理服務整合</span><span class="sxs-lookup"><span data-stu-id="b42aa-457">Integration with your on-premises Key Management Service</span></span>
* <span data-ttu-id="b42aa-458">Azure 檔案儲存體 (共用檔案系統)、網路檔案系統 (NFS)、動態磁碟區，以及使用軟體型 RAID 系統設定的 Windows VM</span><span class="sxs-lookup"><span data-stu-id="b42aa-458">Azure File storage (shared file system), Network File System (NFS), dynamic volumes, and Windows VMs that are configured with software-based RAID systems</span></span>


> [!NOTE]
> <span data-ttu-id="b42aa-459">下列 Linux 散發套件目前支援 Linux OS 磁碟加密：RHEL 7.2、CentOS 7.2n 和 Ubuntu 16.04。</span><span class="sxs-lookup"><span data-stu-id="b42aa-459">Linux OS disk encryption is currently supported on the following Linux distributions: RHEL 7.2, CentOS 7.2n, and Ubuntu 16.04.</span></span>
>
>

<span data-ttu-id="b42aa-460">此功能可確保虛擬機器磁碟上的所有待用資料都會在 Azure 儲存體中加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-460">This feature ensures that all data on your virtual machine disks is encrypted at rest in Azure Storage.</span></span>

#### <a name="resources"></a><span data-ttu-id="b42aa-461">資源</span><span class="sxs-lookup"><span data-stu-id="b42aa-461">Resources</span></span>
* [<span data-ttu-id="b42aa-462">Windows 和 Linux IaaS VM 適用的 Azure 磁碟加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-462">Azure Disk Encryption for Windows and Linux IaaS VMs</span></span>](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption)

### <a name="comparison-of-azure-disk-encryption-sse-and-client-side-encryption"></a><span data-ttu-id="b42aa-463">Azure 磁碟加密、SSE 和用戶端加密的比較</span><span class="sxs-lookup"><span data-stu-id="b42aa-463">Comparison of Azure Disk Encryption, SSE, and Client-Side Encryption</span></span>
#### <a name="iaas-vms-and-their-vhd-files"></a><span data-ttu-id="b42aa-464">IaaS VM 及其 VHD 檔案</span><span class="sxs-lookup"><span data-stu-id="b42aa-464">IaaS VMs and their VHD files</span></span>
<span data-ttu-id="b42aa-465">對於 IaaS VM 所使用的磁碟，建議使用 Azure 磁碟加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-465">For disks used by IaaS VMs, we recommend using Azure Disk Encryption.</span></span> <span data-ttu-id="b42aa-466">您可以開啟 SSE，來加密在 Azure 儲存體中用來備份這些磁碟的 VHD 檔案，但它只會加密新寫入的資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-466">You can turn on SSE to encrypt the VHD files that are used to back those disks in Azure Storage, but it only encrypts newly written data.</span></span> <span data-ttu-id="b42aa-467">這表示，如果您建立 VM，然後在保留 VHD 檔案的儲存體帳戶上啟用 SSE，則只會加密變更，而不會加密原始的 VHD 檔案。</span><span class="sxs-lookup"><span data-stu-id="b42aa-467">This means if you create a VM and then enable SSE on the storage account that holds the VHD file, only the changes will be encrypted, not the original VHD file.</span></span>

<span data-ttu-id="b42aa-468">如果您使用來自 Azure Marketplace 的映像建立 VM，Azure 就會在 Azure 儲存體中對您的儲存體帳戶執行該映像的 [淺層複製](https://en.wikipedia.org/wiki/Object_copying) ，而且即使您已啟用 SSE，也不會將之加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-468">If you create a VM using an image from the Azure Marketplace, Azure performs a [shallow copy](https://en.wikipedia.org/wiki/Object_copying) of the image to your storage account in Azure Storage, and it is not encrypted even if you have SSE enabled.</span></span> <span data-ttu-id="b42aa-469">當它建立 VM 並開始更新映像之後，SSE 將開始加密資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-469">After it creates the VM and starts updating the image, SSE will start encrypting the data.</span></span> <span data-ttu-id="b42aa-470">基於這個理由，如果您想要將它們完整加密，最好是在透過 Azure Marketplace 中的映像建立的 VM 上使用 Azure 磁碟加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-470">For this reason, it's best to use Azure Disk Encryption on VMs created from images in the Azure Marketplace if you want them fully encrypted.</span></span>

<span data-ttu-id="b42aa-471">如果透過內部部署將預先加密的 VM 帶入 Azure 中，您就能將加密金鑰上傳至 Azure 金鑰保存庫，並繼續針對使用內部部署的 VM 使用加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-471">If you bring a pre-encrypted VM into Azure from on-premises, you will be able to upload the encryption keys to Azure Key Vault, and continue using the encryption for that VM that you were using on-premises.</span></span> <span data-ttu-id="b42aa-472">啟用 Azure 磁碟加密即可處理此案例。</span><span class="sxs-lookup"><span data-stu-id="b42aa-472">Azure Disk Encryption is enabled to handle this scenario.</span></span>

<span data-ttu-id="b42aa-473">如果您有來自內部部署的未加密 VHD，就可以將它上傳到資源庫做為自訂映像並從中佈建 VM。</span><span class="sxs-lookup"><span data-stu-id="b42aa-473">If you have non-encrypted VHD from on-premises, you can upload it into the gallery as a custom image and provision a VM from it.</span></span> <span data-ttu-id="b42aa-474">如果您使用 Resource Manager 範本來執行此動作，就可以要求它在啟動 VM 時開啟 Azure 磁碟加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-474">If you do this using the Resource Manager templates, you can ask it to turn on Azure Disk Encryption when it boots up the VM.</span></span>

<span data-ttu-id="b42aa-475">當您新增資料磁碟並掛接於 VM 時，您可以在該資料磁碟上開啟 Azure 磁碟加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-475">When you add a data disk and mount it on the VM, you can turn on Azure Disk Encryption on that data disk.</span></span> <span data-ttu-id="b42aa-476">它將會先在本機加密該資料磁碟，然後服務管理層將會對儲存體進行延遲寫入，如此便可加密儲存體內容。</span><span class="sxs-lookup"><span data-stu-id="b42aa-476">It will encrypt that data disk locally first, and then the service management layer will do a lazy write against storage so the storage content is encrypted.</span></span>

#### <a name="client-side-encryption"></a><span data-ttu-id="b42aa-477">用戶端加密</span><span class="sxs-lookup"><span data-stu-id="b42aa-477">Client-side encryption</span></span>
<span data-ttu-id="b42aa-478">用戶端加密是加密資料的最安全方法，因為它會在傳輸前加密資料，並加密待用資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-478">Client-side encryption is the most secure method of encrypting your data, because it encrypts it before transit, and encrypts the data at rest.</span></span> <span data-ttu-id="b42aa-479">不過，它需要您使用儲存體將程式碼加入應用程式，而您可能不想這樣做。</span><span class="sxs-lookup"><span data-stu-id="b42aa-479">However, it does require that you add code to your applications using storage, which you may not want to do.</span></span> <span data-ttu-id="b42aa-480">在這些情況下，您可以針對傳輸中的資料使用 HTTPS，以及使用 SSE 來加密待用資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-480">In those cases, you can use HTTPs for your data in transit, and SSE to encrypt the data at rest.</span></span>

<span data-ttu-id="b42aa-481">透過用戶端加密，您可以加密表格實體、訊息佇列和 Blob。</span><span class="sxs-lookup"><span data-stu-id="b42aa-481">With client-side encryption, you can encrypt table entities, queue messages, and blobs.</span></span> <span data-ttu-id="b42aa-482">使用 SSE，您只能加密 Blob。</span><span class="sxs-lookup"><span data-stu-id="b42aa-482">With SSE, you can only encrypt blobs.</span></span> <span data-ttu-id="b42aa-483">如果您需要將表格和佇列資料加密，就應該使用用戶端加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-483">If you need table and queue data to be encrypted, you should use client-side encryption.</span></span>

<span data-ttu-id="b42aa-484">用戶端加密完全是透過應用程式來管理。</span><span class="sxs-lookup"><span data-stu-id="b42aa-484">Client-side encryption is managed entirely by the application.</span></span> <span data-ttu-id="b42aa-485">這是最安全的方式，但會要求您透過程式設計方式變更應用程式，並將金鑰管理程序放在正確的位置上。</span><span class="sxs-lookup"><span data-stu-id="b42aa-485">This is the most secure approach, but does require you to make programmatic changes to your application and put key management processes in place.</span></span> <span data-ttu-id="b42aa-486">如果您在傳輸期間想要額外的安全性，而且想要將儲存的資料加密，就可以使用這個方式。</span><span class="sxs-lookup"><span data-stu-id="b42aa-486">You would use this when you want the extra security during transit, and you want your stored data to be encrypted.</span></span>

<span data-ttu-id="b42aa-487">用戶端加密會在用戶端上產生更多負載，而您必須在延展性計畫中考慮到這一點，特別是如果您要加密並傳輸許多資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-487">Client-side encryption is more load on the client, and you have to account for this in your scalability plans, especially if you are encrypting and transferring a lot of data.</span></span>

#### <a name="storage-service-encryption-sse"></a><span data-ttu-id="b42aa-488">儲存體服務加密 (SSE)</span><span class="sxs-lookup"><span data-stu-id="b42aa-488">Storage Service Encryption (SSE)</span></span>
<span data-ttu-id="b42aa-489">SSE 是由 Azure 儲存體所管理。</span><span class="sxs-lookup"><span data-stu-id="b42aa-489">SSE is managed by Azure Storage.</span></span> <span data-ttu-id="b42aa-490">使用 SSE 不會針對傳輸中資料提供安全性，但它會在資料寫入 Azure 儲存體時進行加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-490">Using SSE does not provide for the security of the data in transit, but it does encrypt the data as it is written to Azure Storage.</span></span> <span data-ttu-id="b42aa-491">使用此功能時不會對效能產生任何影響。</span><span class="sxs-lookup"><span data-stu-id="b42aa-491">There is no impact on the performance when using this feature.</span></span>

<span data-ttu-id="b42aa-492">您只能使用 SSE 來加密區塊 Blob、附加 Blob 及分頁 Blob。</span><span class="sxs-lookup"><span data-stu-id="b42aa-492">You can only encrypt block blobs, append blobs, and page blobs using SSE.</span></span> <span data-ttu-id="b42aa-493">如果您需要加密表格資料或佇列資料，就應該考慮使用用戶端加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-493">If you need to encrypt table data or queue data, you should consider using client-side encryption.</span></span>

<span data-ttu-id="b42aa-494">如果您使用 VHD 檔案的封存或程式庫做為建立新虛擬機器的基礎，您可以建立新的儲存體帳戶、啟用 SSE，然後將 VHD 檔案上傳到該帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-494">If you have an archive or library of VHD files that you use as a basis for creating new virtual machines, you can create a new storage account, enable SSE, and then upload the VHD files to that account.</span></span> <span data-ttu-id="b42aa-495">這些 VHD 檔案將會由 Azure 儲存體加密。</span><span class="sxs-lookup"><span data-stu-id="b42aa-495">Those VHD files will be encrypted by Azure Storage.</span></span>

<span data-ttu-id="b42aa-496">如果您已針對 VM 中的磁碟啟用 Azure 磁碟加密，並在保留 VHD 檔案的儲存體帳戶上啟用 SSE，則它將會正常運作；它將導致任何新寫入的資料加密兩次。</span><span class="sxs-lookup"><span data-stu-id="b42aa-496">If you have Azure Disk Encryption enabled for the disks in a VM and SSE enabled on the storage account holding the VHD files, it will work fine; it will result in any newly-written data being encrypted twice.</span></span>

## <a name="storage-analytics"></a><span data-ttu-id="b42aa-497">儲存體分析</span><span class="sxs-lookup"><span data-stu-id="b42aa-497">Storage Analytics</span></span>
### <a name="using-storage-analytics-to-monitor-authorization-type"></a><span data-ttu-id="b42aa-498">使用儲存體分析來監視授權類型</span><span class="sxs-lookup"><span data-stu-id="b42aa-498">Using Storage Analytics to monitor authorization type</span></span>
<span data-ttu-id="b42aa-499">對於每個儲存體帳戶，您可以啟用 Azure 儲存體分析，來執行記錄和儲存計量資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-499">For each storage account, you can enable Azure Storage Analytics to perform logging and store metrics data.</span></span> <span data-ttu-id="b42aa-500">當您想要檢查儲存體帳戶的效能計量，或是因為發生效能問題而需要疑難排解儲存體帳戶時，這是一個絕佳的工具。</span><span class="sxs-lookup"><span data-stu-id="b42aa-500">This is a great tool to use when you want to check the performance metrics of a storage account, or need to troubleshoot a storage account because you are having performance problems.</span></span>

<span data-ttu-id="b42aa-501">您可以在儲存體分析記錄中看見的另一部分資料是其他人存取儲存體時所使用的驗證方法。</span><span class="sxs-lookup"><span data-stu-id="b42aa-501">Another piece of data you can see in the storage analytics logs is the authentication method used by someone when they access storage.</span></span> <span data-ttu-id="b42aa-502">例如，使用 Blob 儲存體，您可以看見他們使用的是否為共用存取簽章或儲存體帳戶金鑰，或者存取的 Blob 是否為公用的。</span><span class="sxs-lookup"><span data-stu-id="b42aa-502">For example, with Blob Storage, you can see if they used a Shared Access Signature or the storage account keys, or if the blob accessed was public.</span></span>

<span data-ttu-id="b42aa-503">如果您要嚴密監視儲存體的存取，這真的很實用。</span><span class="sxs-lookup"><span data-stu-id="b42aa-503">This can be really helpful if you are tightly guarding access to storage.</span></span> <span data-ttu-id="b42aa-504">例如，在 Blob 儲存體中，您可以將所有容器設定為私人，並透過您的應用程式實作 SAS 服務的用法。</span><span class="sxs-lookup"><span data-stu-id="b42aa-504">For example, in Blob Storage you can set all of the containers to private and implement the use of an SAS service throughout your applications.</span></span> <span data-ttu-id="b42aa-505">然後您可以定期檢查記錄，以查看是否會使用儲存體帳戶金鑰存取您的 Blob (這可能表示安全性缺口)，或者 Blob 是公用的但它們不應該是公用的。</span><span class="sxs-lookup"><span data-stu-id="b42aa-505">Then you can check the logs regularly to see if your blobs are accessed using the storage account keys, which may indicate a breach of security, or if the blobs are public but they shouldn't be.</span></span>

#### <a name="what-do-the-logs-look-like"></a><span data-ttu-id="b42aa-506">記錄的外觀</span><span class="sxs-lookup"><span data-stu-id="b42aa-506">What do the logs look like?</span></span>
<span data-ttu-id="b42aa-507">當您透過 Azure 入口網站啟用儲存體帳戶計量和記錄之後，分析資料將開始快速累積。</span><span class="sxs-lookup"><span data-stu-id="b42aa-507">After you enable the storage account metrics and logging through the Azure portal, analytics data will start to accumulate quickly.</span></span> <span data-ttu-id="b42aa-508">每個服務的記錄與計量是分開的；只有在該儲存體帳戶中有活動時才會寫入記錄，而根據您設定計量的方式，將會每分鐘、每小時或每天記錄計量。</span><span class="sxs-lookup"><span data-stu-id="b42aa-508">The logging and metrics for each service is separate; the logging is only written when there is activity in that storage account, while the metrics will be logged every minute, every hour, or every day, depending on how you configure it.</span></span>

<span data-ttu-id="b42aa-509">記錄會儲存於儲存體帳戶中名為 $logs 之容器的區塊 Blob 中。</span><span class="sxs-lookup"><span data-stu-id="b42aa-509">The logs are stored in block blobs in a container named $logs in the storage account.</span></span> <span data-ttu-id="b42aa-510">啟用儲存體分析時，會自動建立此容器。</span><span class="sxs-lookup"><span data-stu-id="b42aa-510">This container is automatically created when Storage Analytics is enabled.</span></span> <span data-ttu-id="b42aa-511">一旦建立此容器之後，就無法予以刪除，但您可以刪除其內容。</span><span class="sxs-lookup"><span data-stu-id="b42aa-511">Once this container is created, you can't delete it, although you can delete its contents.</span></span>

<span data-ttu-id="b42aa-512">在 $logs 容器下方，每個服務都有一個資料夾，另外還有適用於年/月/日/小時的子資料夾。</span><span class="sxs-lookup"><span data-stu-id="b42aa-512">Under the $logs container, there is a folder for each service, and then there are subfolders for the year/month/day/hour.</span></span> <span data-ttu-id="b42aa-513">在小時下方，只會將記錄編號。</span><span class="sxs-lookup"><span data-stu-id="b42aa-513">Under hour, the logs are simply numbered.</span></span> <span data-ttu-id="b42aa-514">以下是目錄結構的外觀︰</span><span class="sxs-lookup"><span data-stu-id="b42aa-514">This is what the directory structure will look like:</span></span>

![記錄檔的檢視](./media/storage-security-guide/image1.png)

<span data-ttu-id="b42aa-516">對於 Azure 儲存體的每個要求都會記錄。</span><span class="sxs-lookup"><span data-stu-id="b42aa-516">Every request to Azure Storage is logged.</span></span> <span data-ttu-id="b42aa-517">以下是記錄的快照，會顯示前幾個欄位。</span><span class="sxs-lookup"><span data-stu-id="b42aa-517">Here's a snapshot of a log file, showing the first few fields.</span></span>

![記錄檔的快照](./media/storage-security-guide/image2.png)

<span data-ttu-id="b42aa-519">如您所見，您可以使用記錄來追蹤各種對儲存體帳戶的呼叫。</span><span class="sxs-lookup"><span data-stu-id="b42aa-519">You can see that you can use the logs to track any kind of calls to a storage account.</span></span>

#### <a name="what-are-all-of-those-fields-for"></a><span data-ttu-id="b42aa-520">這些所有欄位的用途為何？</span><span class="sxs-lookup"><span data-stu-id="b42aa-520">What are all of those fields for?</span></span>
<span data-ttu-id="b42aa-521">有一篇文章會列出下列所有資源，提供記錄中許多欄位的清單及其用途。</span><span class="sxs-lookup"><span data-stu-id="b42aa-521">There is an article listed in the resources below that provides the list of the many fields in the logs and what they are used for.</span></span> <span data-ttu-id="b42aa-522">以下是依序列出的欄位清單︰</span><span class="sxs-lookup"><span data-stu-id="b42aa-522">Here is the list of fields in order:</span></span>

![記錄檔中欄位的快照](./media/storage-security-guide/image3.png)

<span data-ttu-id="b42aa-524">我們對於 GetBlob 的項目及其驗證方法很感興趣，所以必須尋找作業類型 "Get-Blob" 的項目，並檢查要求狀態 (第 4<sup></sup> 欄) 和授權類型 (第 8<sup></sup> 欄)。</span><span class="sxs-lookup"><span data-stu-id="b42aa-524">We're interested in the entries for GetBlob, and how they are authenticated, so we need to look for entries with operation-type "Get-Blob", and check the request-status (4<sup>th</sup> column) and the authorization-type (8<sup>th</sup> column).</span></span>

<span data-ttu-id="b42aa-525">例如，在上述清單的前幾個列中，要求狀態為 "Success" 且驗證類型為 "authenticated"。</span><span class="sxs-lookup"><span data-stu-id="b42aa-525">For example, in the first few rows in the listing above, the request-status is "Success" and the authorization-type is "authenticated".</span></span> <span data-ttu-id="b42aa-526">這表示已使用儲存體帳戶金鑰驗證要求。</span><span class="sxs-lookup"><span data-stu-id="b42aa-526">This means the request was validated using the storage account key.</span></span>

#### <a name="how-are-my-blobs-being-authenticated"></a><span data-ttu-id="b42aa-527">如何驗證我的 Blob？</span><span class="sxs-lookup"><span data-stu-id="b42aa-527">How are my blobs being authenticated?</span></span>
<span data-ttu-id="b42aa-528">以下提供三個我們感興趣的案例。</span><span class="sxs-lookup"><span data-stu-id="b42aa-528">We have three cases that we are interested in.</span></span>

1. <span data-ttu-id="b42aa-529">Blob 是公用的且可使用 URL (而不需共用存取簽章) 來存取。</span><span class="sxs-lookup"><span data-stu-id="b42aa-529">The blob is public and it is accessed using a URL without a Shared Access Signature.</span></span> <span data-ttu-id="b42aa-530">在此案例中，要求狀態為 "AnonymousSuccess" 且驗證類型為 "anonymous"。</span><span class="sxs-lookup"><span data-stu-id="b42aa-530">In this case, the request-status is "AnonymousSuccess" and the authorization-type is "anonymous".</span></span>

   <span data-ttu-id="b42aa-531">1.0;2015-11-17T02:01:29.0488963Z;GetBlob;**AnonymousSuccess**;200;124;37;**anonymous**;;mystorage…</span><span class="sxs-lookup"><span data-stu-id="b42aa-531">1.0;2015-11-17T02:01:29.0488963Z;GetBlob;**AnonymousSuccess**;200;124;37;**anonymous**;;mystorage…</span></span>
2. <span data-ttu-id="b42aa-532">Blob 是私人的且與共用存取簽章搭配使用。</span><span class="sxs-lookup"><span data-stu-id="b42aa-532">The blob is private and was used with a Shared Access Signature.</span></span> <span data-ttu-id="b42aa-533">在此案例中，要求狀態為 "SASSuccess" 且驗證類型為 "sas"。</span><span class="sxs-lookup"><span data-stu-id="b42aa-533">In this case, the request-status is "SASSuccess" and the authorization-type is "sas".</span></span>

   <span data-ttu-id="b42aa-534">1.0;2015-11-16T18:30:05.6556115Z;GetBlob;**SASSuccess**;200;416;64;**sas**;;mystorage…</span><span class="sxs-lookup"><span data-stu-id="b42aa-534">1.0;2015-11-16T18:30:05.6556115Z;GetBlob;**SASSuccess**;200;416;64;**sas**;;mystorage…</span></span>
3. <span data-ttu-id="b42aa-535">Blob 是私人且使用儲存體金鑰來存取它。</span><span class="sxs-lookup"><span data-stu-id="b42aa-535">The blob is private and the storage key was used to access it.</span></span> <span data-ttu-id="b42aa-536">在此案例中，request-status 為 "**Success**" 且 authorization-type 為 “**authenticated**”。</span><span class="sxs-lookup"><span data-stu-id="b42aa-536">In this case, the request-status is "**Success**" and the authorization-type is "**authenticated**".</span></span>

   <span data-ttu-id="b42aa-537">1.0;2015-11-16T18:32:24.3174537Z;GetBlob;**Success**;206;59;22;**authenticated**;mystorage…</span><span class="sxs-lookup"><span data-stu-id="b42aa-537">1.0;2015-11-16T18:32:24.3174537Z;GetBlob;**Success**;206;59;22;**authenticated**;mystorage…</span></span>

<span data-ttu-id="b42aa-538">您可以使用 Microsoft Message Analyzer 來檢視和分析這些記錄。</span><span class="sxs-lookup"><span data-stu-id="b42aa-538">You can use the Microsoft Message Analyzer to view and analyze these logs.</span></span> <span data-ttu-id="b42aa-539">它包含搜尋和篩選功能。</span><span class="sxs-lookup"><span data-stu-id="b42aa-539">It includes search and filter capabilities.</span></span> <span data-ttu-id="b42aa-540">例如，您可能想要搜尋 GetBlob 的執行個體，以查看其使用方式是否如預期般，也就是要確定其他人不會以不適當的方式存取您的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-540">For example, you might want to search for instances of GetBlob to see if the usage is what you expect, i.e. to make sure someone is not accessing your storage account inappropriately.</span></span>

#### <a name="resources"></a><span data-ttu-id="b42aa-541">資源</span><span class="sxs-lookup"><span data-stu-id="b42aa-541">Resources</span></span>
* [<span data-ttu-id="b42aa-542">Storage Analytics</span><span class="sxs-lookup"><span data-stu-id="b42aa-542">Storage Analytics</span></span>](../storage-analytics.md)

  <span data-ttu-id="b42aa-543">本文是儲存體分析及如何啟用它們的概觀。</span><span class="sxs-lookup"><span data-stu-id="b42aa-543">This article is an overview of storage analytics and how to enable them.</span></span>
* [<span data-ttu-id="b42aa-544">儲存體分析記錄檔格式</span><span class="sxs-lookup"><span data-stu-id="b42aa-544">Storage Analytics Log Format</span></span>](https://msdn.microsoft.com/library/azure/hh343259.aspx)

  <span data-ttu-id="b42aa-545">本文說明儲存體分析記錄格式，並詳細說明其中的可用欄位，包括驗證類型，其會指出要求所使用的驗證類型。</span><span class="sxs-lookup"><span data-stu-id="b42aa-545">This article illustrates the Storage Analytics Log Format, and details the fields available therein, including authentication-type, which indicates the type of authentication used for the request.</span></span>
* [<span data-ttu-id="b42aa-546">在 Azure 入口網站中監視儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="b42aa-546">Monitor a Storage Account in the Azure portal</span></span>](../storage-monitor-storage-account.md)

  <span data-ttu-id="b42aa-547">本文說明如何設定和監視儲存體帳戶的計量與記錄。</span><span class="sxs-lookup"><span data-stu-id="b42aa-547">This article shows how to configure monitoring of metrics and logging for a storage account.</span></span>
* [<span data-ttu-id="b42aa-548">使用 Azure 儲存體度量和記錄、AzCopy 和 Message Analyzer 進行端對端疑難排解</span><span class="sxs-lookup"><span data-stu-id="b42aa-548">End-to-End Troubleshooting using Azure Storage Metrics and Logging, AzCopy, and Message Analyzer</span></span>](../storage-e2e-troubleshooting.md)

  <span data-ttu-id="b42aa-549">本文討論如何使用儲存體分析進行疑難排解，並示範如何使用 Microsoft Message Analyzer。</span><span class="sxs-lookup"><span data-stu-id="b42aa-549">This article talks about troubleshooting using the Storage Analytics and shows how to use the Microsoft Message Analyzer.</span></span>
* [<span data-ttu-id="b42aa-550">Microsoft Message Analyzer 操作指南</span><span class="sxs-lookup"><span data-stu-id="b42aa-550">Microsoft Message Analyzer Operating Guide</span></span>](https://technet.microsoft.com/library/jj649776.aspx)

  <span data-ttu-id="b42aa-551">本文是 Microsoft Message Analyzer 的參考，並包含教學課程、快速入門及功能摘要的連結。</span><span class="sxs-lookup"><span data-stu-id="b42aa-551">This article is the reference for the Microsoft Message Analyzer and includes links to a tutorial, quick start, and feature summary.</span></span>

## <a name="cross-origin-resource-sharing-cors"></a><span data-ttu-id="b42aa-552">跨原始來源資源分享 (CORS)</span><span class="sxs-lookup"><span data-stu-id="b42aa-552">Cross-Origin Resource Sharing (CORS)</span></span>
### <a name="cross-domain-access-of-resources"></a><span data-ttu-id="b42aa-553">跨網域存取資源</span><span class="sxs-lookup"><span data-stu-id="b42aa-553">Cross-domain access of resources</span></span>
<span data-ttu-id="b42aa-554">在某一個網域中執行的 Web 瀏覽器對來自不同網域的資源提出 HTTP 要求時，這稱為跨原始來源的 HTTP 要求。</span><span class="sxs-lookup"><span data-stu-id="b42aa-554">When a web browser running in one domain makes an HTTP request for a resource from a different domain, this is called a cross-origin HTTP request.</span></span> <span data-ttu-id="b42aa-555">例如，來自 contoso.com 的 HTML 網頁會對裝載於 fabrikam.blob.core.windows.net 上的 jpeg 提出要求。</span><span class="sxs-lookup"><span data-stu-id="b42aa-555">For example, an HTML page served from contoso.com makes a request for a jpeg hosted on fabrikam.blob.core.windows.net.</span></span> <span data-ttu-id="b42aa-556">基於安全性理由，瀏覽器會限制從指令碼 (例如 JavaScript) 內初始化的跨原始來源 HTTP 要求。</span><span class="sxs-lookup"><span data-stu-id="b42aa-556">For security reasons, browsers restrict cross-origin HTTP requests initiated from within scripts, such as JavaScript.</span></span> <span data-ttu-id="b42aa-557">這表示當 contoso.com 的網頁上有一些 JavaScript 程式碼要求 fabrikam.blob.core.windows.net 上的該 jpeg 時，瀏覽器將不允許該要求。</span><span class="sxs-lookup"><span data-stu-id="b42aa-557">This means that when some JavaScript code on a web page on contoso.com requests that jpeg on fabrikam.blob.core.windows.net, the browser will not allow the request.</span></span>

<span data-ttu-id="b42aa-558">這必須利用 Azure 儲存體來執行哪些動作？</span><span class="sxs-lookup"><span data-stu-id="b42aa-558">What does this have to do with Azure Storage?</span></span> <span data-ttu-id="b42aa-559">嗯，如果您正使用名為 Fabrikam 的儲存體帳戶在 Blob 儲存體中儲存 JSON 或 XML 資料檔案之類的靜態資產，則資產的網域將會是 fabrikam.blob.core.windows.net，而 contoso.com web 應用程式將無法使用 JavaScript 來存取它們，因為網域不一樣。</span><span class="sxs-lookup"><span data-stu-id="b42aa-559">Well, if you are storing static assets such as JSON or XML data files in Blob Storage using a storage account called Fabrikam, the domain for the assets will be fabrikam.blob.core.windows.net, and the contoso.com web application will not be able to access them using JavaScript because the domains are different.</span></span> <span data-ttu-id="b42aa-560">如果您嘗試呼叫其中一個 Azure 儲存體服務 (例如表格儲存體)，以傳回要透過 JavaScript 用戶端處理的 JSON 資料，則這同樣適用。</span><span class="sxs-lookup"><span data-stu-id="b42aa-560">This is also true if you're trying to call one of the Azure Storage Services – such as Table Storage – that return JSON data to be processed by the JavaScript client.</span></span>

#### <a name="possible-solutions"></a><span data-ttu-id="b42aa-561">可能的解決方案</span><span class="sxs-lookup"><span data-stu-id="b42aa-561">Possible solutions</span></span>
<span data-ttu-id="b42aa-562">解決此問題的方法之一是將像是 "storage.contoso.com" 的自訂網域指派給 fabrikam.blob.core.windows.net。</span><span class="sxs-lookup"><span data-stu-id="b42aa-562">One way to resolve this is to assign a custom domain like "storage.contoso.com" to fabrikam.blob.core.windows.net.</span></span> <span data-ttu-id="b42aa-563">問題在於，您只能將該自訂網域指派給一個儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="b42aa-563">The problem is that you can only assign that custom domain to one storage account.</span></span> <span data-ttu-id="b42aa-564">如果資產儲存於多個儲存體帳戶中該怎麼辦？</span><span class="sxs-lookup"><span data-stu-id="b42aa-564">What if the assets are stored in multiple storage accounts?</span></span>

<span data-ttu-id="b42aa-565">解決此問題的另一個方法是讓 Web 應用程式做為儲存體呼叫所使用的 Proxy。</span><span class="sxs-lookup"><span data-stu-id="b42aa-565">Another way to resolve this is to have the web application act as a proxy for the storage calls.</span></span> <span data-ttu-id="b42aa-566">這表示，如果您要將檔案上傳至 Blob 儲存體，Web 應用程式可以在本機寫入它，然後將它複製到 Blob 儲存體，或者將它全部讀入記憶體，然後將它寫入 Blob 儲存體。</span><span class="sxs-lookup"><span data-stu-id="b42aa-566">This means if you are uploading a file to Blob Storage, the web application would either write it locally and then copy it to Blob Storage, or it would read all of it into memory and then write it to Blob Storage.</span></span> <span data-ttu-id="b42aa-567">或者，您可以撰寫專屬的 Web 應用程式 (例如 Web API)，本機上傳檔案並將它們寫入 Blob 儲存體。</span><span class="sxs-lookup"><span data-stu-id="b42aa-567">Alternately, you could write a dedicated web application (such as a Web API) that uploads the files locally and writes them to Blob Storage.</span></span> <span data-ttu-id="b42aa-568">無論如何，您都必須在判定延展性的需求時負責該功能。</span><span class="sxs-lookup"><span data-stu-id="b42aa-568">Either way, you have to account for that function when determining the scalability needs.</span></span>

#### <a name="how-can-cors-help"></a><span data-ttu-id="b42aa-569">CORS 如何提供協助？</span><span class="sxs-lookup"><span data-stu-id="b42aa-569">How can CORS help?</span></span>
<span data-ttu-id="b42aa-570">Azure 儲存體可讓您啟用 CORS – 跨原始來源資源共用。</span><span class="sxs-lookup"><span data-stu-id="b42aa-570">Azure Storage allows you to enable CORS – Cross Origin Resource Sharing.</span></span> <span data-ttu-id="b42aa-571">對於每個儲存體帳戶，您可以指定可存取該儲存體帳戶中之資源的網域。</span><span class="sxs-lookup"><span data-stu-id="b42aa-571">For each storage account, you can specify domains that can access the resources in that storage account.</span></span> <span data-ttu-id="b42aa-572">例如，在上述案例中，我們可以在 fabrikam.blob.core.windows.net 儲存體帳戶上啟用 CORS，然後將它設定為允許存取 contoso.com。然後 Web 應用程式 contoso.com 就能直接存取 fabrikam.blob.core.windows.net 中的資源。</span><span class="sxs-lookup"><span data-stu-id="b42aa-572">For example, in our case outlined above, we can enable CORS on the fabrikam.blob.core.windows.net storage account and configure it to allow access to contoso.com. Then the web application contoso.com can directly access the resources in fabrikam.blob.core.windows.net.</span></span>

<span data-ttu-id="b42aa-573">要注意的一點是，CORS 允許存取，但不提供所有對儲存體資源之非公用存取所需的驗證。</span><span class="sxs-lookup"><span data-stu-id="b42aa-573">One thing to note is that CORS allows access, but it does not provide authentication, which is required for all non-public access of storage resources.</span></span> <span data-ttu-id="b42aa-574">這表示，如果它們是公用的，您就只能存取 Blob，或者您可以包含共用存取簽章來為您提供適當的權限。</span><span class="sxs-lookup"><span data-stu-id="b42aa-574">This means you can only access blobs if they are public or you include a Shared Access Signature giving you the appropriate permission.</span></span> <span data-ttu-id="b42aa-575">表格、佇列和檔案沒有公用存取權且需要 SAS。</span><span class="sxs-lookup"><span data-stu-id="b42aa-575">Tables, queues, and files have no public access, and require a SAS.</span></span>

<span data-ttu-id="b42aa-576">根據預設，所有服務上都會停用 CORS。</span><span class="sxs-lookup"><span data-stu-id="b42aa-576">By default, CORS is disabled on all services.</span></span> <span data-ttu-id="b42aa-577">您可以使用 REST API 或儲存體用戶端程式庫，呼叫其中一個方法來設定服務原則，藉以啟用 CORS。</span><span class="sxs-lookup"><span data-stu-id="b42aa-577">You can enable CORS by using the REST API or the storage client library to call one of the methods to set the service policies.</span></span> <span data-ttu-id="b42aa-578">當您這樣做時，就會在 XML 中包含 CORS 規則。</span><span class="sxs-lookup"><span data-stu-id="b42aa-578">When you do that, you include a CORS rule, which is in XML.</span></span> <span data-ttu-id="b42aa-579">以下範例會針對儲存體帳戶的 Blob 服務，使用「設定服務屬性」作業來設定 CORS 規則。</span><span class="sxs-lookup"><span data-stu-id="b42aa-579">Here's an example of a CORS rule that has been set using the Set Service Properties operation for the Blob Service for a storage account.</span></span> <span data-ttu-id="b42aa-580">您可以使用 Azure 儲存體的儲存體用戶端程式庫或 REST API 來執行該作業。</span><span class="sxs-lookup"><span data-stu-id="b42aa-580">You can perform that operation using the storage client library or the REST APIs for Azure Storage.</span></span>

```xml
<Cors>    
    <CorsRule>
        <AllowedOrigins>http://www.contoso.com, http://www.fabrikam.com</AllowedOrigins>
        <AllowedMethods>PUT,GET</AllowedMethods>
        <AllowedHeaders>x-ms-meta-data*,x-ms-meta-target*,x-ms-meta-abc</AllowedHeaders>
        <ExposedHeaders>x-ms-meta-*</ExposedHeaders>
        <MaxAgeInSeconds>200</MaxAgeInSeconds>
    </CorsRule>
<Cors>
```

<span data-ttu-id="b42aa-581">以下是每一列的意義︰</span><span class="sxs-lookup"><span data-stu-id="b42aa-581">Here's what each row means:</span></span>

* <span data-ttu-id="b42aa-582">**AllowedOrigins** 這會指出哪些不相符的網域可以向儲存體服務提出要求並從中接收資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-582">**AllowedOrigins** This tells which non-matching domains can request and receive data from the storage service.</span></span> <span data-ttu-id="b42aa-583">這表示，contoso.com 和 fabrikam.com 可以針對特定的儲存體帳戶向 Blob 儲存體要求資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-583">This says that both contoso.com and fabrikam.com can request data from Blob Storage for a specific storage account.</span></span> <span data-ttu-id="b42aa-584">您也可以將此設定為萬用字元 (\*)，以允許所有網域存取要求。</span><span class="sxs-lookup"><span data-stu-id="b42aa-584">You can also set this to a wildcard (\*) to allow all domains to access requests.</span></span>
* <span data-ttu-id="b42aa-585">**AllowedMethods** 這是提出要求時可以使用的方法 (HTTP 要求動詞命令) 清單。</span><span class="sxs-lookup"><span data-stu-id="b42aa-585">**AllowedMethods** This is the list of methods (HTTP request verbs) that can be used when making the request.</span></span> <span data-ttu-id="b42aa-586">在此範例中，只允許 PUT 和 GET。</span><span class="sxs-lookup"><span data-stu-id="b42aa-586">In this example, only PUT and GET are allowed.</span></span> <span data-ttu-id="b42aa-587">您可以將此設定為萬用字元 (\*)，以允許使用所有方法。</span><span class="sxs-lookup"><span data-stu-id="b42aa-587">You can set this to a wildcard (\*) to allow all methods to be used.</span></span>
* <span data-ttu-id="b42aa-588">**AllowedHeaders** 這是在提出要求時原始網域可以指定的要求標頭。</span><span class="sxs-lookup"><span data-stu-id="b42aa-588">**AllowedHeaders** This is the request headers that the origin domain can specify when making the request.</span></span> <span data-ttu-id="b42aa-589">在此範例中，允許以 x-ms-meta-data、x-ms-meta-target 及 x-ms-meta-abc 開頭的所有中繼資料標頭。</span><span class="sxs-lookup"><span data-stu-id="b42aa-589">In this example, all metadata headers starting with x-ms-meta-data, x-ms-meta-target, and x-ms-meta-abc are permitted.</span></span> <span data-ttu-id="b42aa-590">萬用字元 (\*) 表示允許任何以指定前置詞開頭的標頭。</span><span class="sxs-lookup"><span data-stu-id="b42aa-590">The wildcard character (\*) indicates that any header beginning with the specified prefix is allowed.</span></span>
* <span data-ttu-id="b42aa-591">**ExposedHeaders** 這表示瀏覽器應向要求簽發者公開的回應標頭。</span><span class="sxs-lookup"><span data-stu-id="b42aa-591">**ExposedHeaders** This tells which response headers should be exposed by the browser to the request issuer.</span></span> <span data-ttu-id="b42aa-592">在此範例中，將公開任何以 "x-ms-meta-" 開頭的標頭。</span><span class="sxs-lookup"><span data-stu-id="b42aa-592">In this example, any header starting with "x-ms-meta-" will be exposed.</span></span>
* <span data-ttu-id="b42aa-593">**MaxAgeInSeconds** 這是瀏覽器將快取預檢 OPTIONS 要求的時間量上限。</span><span class="sxs-lookup"><span data-stu-id="b42aa-593">**MaxAgeInSeconds** This is the maximum amount of time that a browser will cache the preflight OPTIONS request.</span></span> <span data-ttu-id="b42aa-594">(如需預檢要求的詳細資訊，請檢查下列第一篇文章)。</span><span class="sxs-lookup"><span data-stu-id="b42aa-594">(For more information about the preflight request, check the first article below.)</span></span>

#### <a name="resources"></a><span data-ttu-id="b42aa-595">資源</span><span class="sxs-lookup"><span data-stu-id="b42aa-595">Resources</span></span>
<span data-ttu-id="b42aa-596">如需 CORS 以及如何啟用的詳細資訊，請參閱下列資源。</span><span class="sxs-lookup"><span data-stu-id="b42aa-596">For more information about CORS and how to enable it, please check out these resources.</span></span>

* [<span data-ttu-id="b42aa-597">在 Azure.com 上 Azure 儲存體服務的跨原始資源共用 (CORS) 支援</span><span class="sxs-lookup"><span data-stu-id="b42aa-597">Cross-Origin Resource Sharing (CORS) Support for the Azure Storage Services on Azure.com</span></span>](../storage-cors-support.md)

  <span data-ttu-id="b42aa-598">本文概述 CORS，以及如何設定不同儲存體服務的規則。</span><span class="sxs-lookup"><span data-stu-id="b42aa-598">This article provides an overview of CORS and how to set the rules for the different storage services.</span></span>
* [<span data-ttu-id="b42aa-599">在 MSDN 上 Azure 儲存體服務的跨原始資源共用 (CORS) 支援</span><span class="sxs-lookup"><span data-stu-id="b42aa-599">Cross-Origin Resource Sharing (CORS) Support for the Azure Storage Services on MSDN</span></span>](https://msdn.microsoft.com/library/azure/dn535601.aspx)

  <span data-ttu-id="b42aa-600">這是適用於 Azure 儲存體服務的 CORS 支援的參考文件。</span><span class="sxs-lookup"><span data-stu-id="b42aa-600">This is the reference documentation for CORS support for the Azure Storage Services.</span></span> <span data-ttu-id="b42aa-601">其中提供適用於每個儲存體服務的文章連結，並示範範例且說明 CORS 檔案中的每個元素。</span><span class="sxs-lookup"><span data-stu-id="b42aa-601">This has links to articles applying to each storage service, and shows an example and explains each element in the CORS file.</span></span>
* [<span data-ttu-id="b42aa-602">Microsoft Azure 儲存體︰CORS 簡介</span><span class="sxs-lookup"><span data-stu-id="b42aa-602">Microsoft Azure Storage: Introducing CORS</span></span>](http://blogs.msdn.com/b/windowsazurestorage/archive/2014/02/03/windows-azure-storage-introducing-cors.aspx)

  <span data-ttu-id="b42aa-603">此為最初發表 CORS 並示範如何使用之部落格文章的連結。</span><span class="sxs-lookup"><span data-stu-id="b42aa-603">This is a link to the initial blog article announcing CORS and showing how to use it.</span></span>

## <a name="frequently-asked-questions-about-azure-storage-security"></a><span data-ttu-id="b42aa-604">關於 Azure 儲存體安全性的常見問題集</span><span class="sxs-lookup"><span data-stu-id="b42aa-604">Frequently asked questions about Azure Storage security</span></span>
1. <span data-ttu-id="b42aa-605">**如果我無法使用 HTTPS 通訊協定，該如何驗證我傳輸至 Azure 儲存體或從中傳出之 Blob 的完整性？**</span><span class="sxs-lookup"><span data-stu-id="b42aa-605">**How can I verify the integrity of the blobs I'm transferring into or out of Azure Storage if I can't use the HTTPS protocol?**</span></span>

   <span data-ttu-id="b42aa-606">如果基於任何原因，您必須使用 HTTP 而不是 HTTPS，且您要使用區塊 Blob，您可以使用 MD5 檢查，協助確認要傳輸的 Blob 完整性。</span><span class="sxs-lookup"><span data-stu-id="b42aa-606">If for any reason you need to use HTTP instead of HTTPS and you are working with block blobs, you can use MD5 checking to help verify the integrity of the blobs being transferred.</span></span> <span data-ttu-id="b42aa-607">這有助於提供保護以防止發生網路/傳輸層錯誤，但不一定是媒介攻擊。</span><span class="sxs-lookup"><span data-stu-id="b42aa-607">This will help with protection from network/transport layer errors, but not necessarily with intermediary attacks.</span></span>

   <span data-ttu-id="b42aa-608">如果您可以使用 HTTPS 來提供傳輸層安全性，則使用 MD5 檢查是多餘且不必要的。</span><span class="sxs-lookup"><span data-stu-id="b42aa-608">If you can use HTTPS, which provides transport level security, then using MD5 checking is redundant and unnecessary.</span></span>

   <span data-ttu-id="b42aa-609">如需詳細資訊，請查看 [Azure Blob MD5 概觀](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/02/18/windows-azure-blob-md5-overview.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b42aa-609">For more information, please check out the [Azure Blob MD5 Overview](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/02/18/windows-azure-blob-md5-overview.aspx).</span></span>
2. <span data-ttu-id="b42aa-610">**美國政府的 FIPS 相符性為何？**</span><span class="sxs-lookup"><span data-stu-id="b42aa-610">**What about FIPS-Compliance for the U.S. Government?**</span></span>

   <span data-ttu-id="b42aa-611">美國聯邦資訊處理標準 (FIPS) 會定義由美國聯邦政府電腦系統核准使用的密碼編譯演算法，以便保護機密資料。</span><span class="sxs-lookup"><span data-stu-id="b42aa-611">The United States Federal Information Processing Standard (FIPS) defines cryptographic algorithms approved for use by U.S. Federal government computer systems for the protection of sensitive data.</span></span> <span data-ttu-id="b42aa-612">在 Windows 伺服器或桌面上啟用 FIPS 模式，會告知作業系統僅應使用 FIPS 驗證的密碼編譯演算法。</span><span class="sxs-lookup"><span data-stu-id="b42aa-612">Enabling FIPS mode on a Windows server or desktop tells the OS that only FIPS-validated cryptographic algorithms should be used.</span></span> <span data-ttu-id="b42aa-613">如果應用程式使用不相容的演算法，該應用程式將會中斷。</span><span class="sxs-lookup"><span data-stu-id="b42aa-613">If an application uses non-compliant algorithms, the applications will break.</span></span> <span data-ttu-id="b42aa-614">利用 .NET Framework 4.5.2 或更新版本，應用程式會在電腦處於 FIPS 模式時，自動切換密碼編譯演算法來使用 FIPS 相容的演算法。</span><span class="sxs-lookup"><span data-stu-id="b42aa-614">With.NET Framework versions 4.5.2 or higher, the application automatically switches the cryptography algorithms to use FIPS-compliant algorithms when the computer is in FIPS mode.</span></span>

   <span data-ttu-id="b42aa-615">Microsoft 可讓每位客戶決定是否要啟用 FIPS 模式。</span><span class="sxs-lookup"><span data-stu-id="b42aa-615">Microsoft leaves it up to each customer to decide whether to enable FIPS mode.</span></span> <span data-ttu-id="b42aa-616">我們認為沒有充分的理由來對不受政府法規限制的客戶預設啟用 FIPS 模式。</span><span class="sxs-lookup"><span data-stu-id="b42aa-616">We believe there is no compelling reason for customers who are not subject to government regulations to enable FIPS mode by default.</span></span>

   <span data-ttu-id="b42aa-617">**資源**</span><span class="sxs-lookup"><span data-stu-id="b42aa-617">**Resources**</span></span>

* [<span data-ttu-id="b42aa-618">Why We’re Not Recommending "FIPS Mode" Anymore (為什麼我們不再建議「FIPS 模式」)</span><span class="sxs-lookup"><span data-stu-id="b42aa-618">Why We're Not Recommending "FIPS Mode" Anymore</span></span>](http://blogs.technet.com/b/secguide/archive/2014/04/07/why-we-re-not-recommending-fips-mode-anymore.aspx)

  <span data-ttu-id="b42aa-619">此部落格文章提供 FIPS 概觀，並說明他們為什麼預設不啟用 FIPS 模式。</span><span class="sxs-lookup"><span data-stu-id="b42aa-619">This blog article gives an overview of FIPS and explains why they don't enable FIPS mode by default.</span></span>
* [<span data-ttu-id="b42aa-620">FIPS 140 Validation (FIPS 140 驗證)</span><span class="sxs-lookup"><span data-stu-id="b42aa-620">FIPS 140 Validation</span></span>](https://technet.microsoft.com/library/cc750357.aspx)

  <span data-ttu-id="b42aa-621">本文提供 Microsoft 產品和密碼編譯模組如何符合美國美國聯邦政府的 FIPS 標準的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="b42aa-621">This article provides information on how Microsoft products and cryptographic modules comply with the FIPS standard for the U.S. Federal government.</span></span>
* [<span data-ttu-id="b42aa-622">Windows XP 和 Windows 的更新版本中「系統密碼編譯︰使用符合 FIPS 規範的演算法進行加密，雜湊，以及簽章」安全性設定的效果</span><span class="sxs-lookup"><span data-stu-id="b42aa-622">"System cryptography: Use FIPS compliant algorithms for encryption, hashing, and signing" security settings effects in Windows XP and in later versions of Windows</span></span>](https://support.microsoft.com/kb/811833)

  <span data-ttu-id="b42aa-623">本文討論如何在較舊的 Windows 電腦中使用 FIPS 模式。</span><span class="sxs-lookup"><span data-stu-id="b42aa-623">This article talks about the use of FIPS mode in older Windows computers.</span></span>
