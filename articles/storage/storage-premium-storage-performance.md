---
title: "Azure 進階儲存體：專為效能而設計 | Microsoft Docs"
description: "使用 Azure 進階儲存體設計高效能應用程式。 「進階儲存體」可針對在「Azure 虛擬機器」上執行且需要大量 I/O 的工作負載，提供高效能、低延遲的磁碟支援。"
services: storage
documentationcenter: na
author: aungoo-msft
manager: tadb
editor: tysonn
ms.assetid: e6a409c3-d31a-4704-a93c-0a04fdc95960
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: aungoo
ms.openlocfilehash: 7bd38be9f8e1160ebf0d7c5ed51fd31d89481881
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="azure-premium-storage-design-for-high-performance"></a><span data-ttu-id="2ab3a-104">Azure 進階儲存體：專為高效能而設計</span><span class="sxs-lookup"><span data-stu-id="2ab3a-104">Azure Premium Storage: Design for High Performance</span></span>
## <a name="overview"></a><span data-ttu-id="2ab3a-105">Overview</span><span class="sxs-lookup"><span data-stu-id="2ab3a-105">Overview</span></span>
<span data-ttu-id="2ab3a-106">這篇文章提供使用 Azure 進階儲存體來建置高效能應用程式的指導方針。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-106">This article provides guidelines for building high performance applications using Azure Premium Storage.</span></span> <span data-ttu-id="2ab3a-107">您可以使用這份文件所提供的指示，並根據您的應用程式所採用的技術，結合適合的效能最佳作法。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-107">You can use the instructions provided in this document combined with performance best practices applicable to technologies used by your application.</span></span> <span data-ttu-id="2ab3a-108">為了說明指導方針，在這整份文件中，我們以進階儲存體上執行的 SQL Server 為範例。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-108">To illustrate the guidelines, we have used SQL Server running on Premium Storage as an example throughout this document.</span></span>

<span data-ttu-id="2ab3a-109">雖然我們在本文中說明儲存體層的效能案例，但您必須將應用程式層最佳化。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-109">While we address performance scenarios for the Storage layer in this article, you will need to optimize the application layer.</span></span> <span data-ttu-id="2ab3a-110">例如，如果您在 Azure 進階儲存體上裝載 SharePoint 伺服器陣列，您可以使用本文件的 SQL Server 範例將資料庫伺服器最佳化。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-110">For example, if you are hosting a SharePoint Farm on Azure Premium Storage, you can use the SQL Server examples from this article to optimize the database server.</span></span> <span data-ttu-id="2ab3a-111">此外，也要將 SharePoint 伺服器陣列的 Web 伺服器和應用程式伺服器最佳化，才能發揮最高效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-111">Additionally, optimize the SharePoint Farm's Web server and Application server to get the most performance.</span></span>

<span data-ttu-id="2ab3a-112">關於在 Azure 進階儲存體上將應用程式效能最佳化方面，本文有助於回答以下常見的問題。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-112">This article will help answer following common questions about optimizing application performance on Azure Premium Storage,</span></span>

* <span data-ttu-id="2ab3a-113">如何衡量應用程式效能？</span><span class="sxs-lookup"><span data-stu-id="2ab3a-113">How to measure your application performance?</span></span>  
* <span data-ttu-id="2ab3a-114">為什麼看不到預期的高效能？</span><span class="sxs-lookup"><span data-stu-id="2ab3a-114">Why are you not seeing expected high performance?</span></span>  
* <span data-ttu-id="2ab3a-115">哪些因素會影響進階儲存體上的應用程式效能？</span><span class="sxs-lookup"><span data-stu-id="2ab3a-115">Which factors influence your application performance on Premium Storage?</span></span>  
* <span data-ttu-id="2ab3a-116">這些因素如何影響進階儲存體上的應用程式效能？</span><span class="sxs-lookup"><span data-stu-id="2ab3a-116">How do these factors influence performance of your application on Premium Storage?</span></span>  
* <span data-ttu-id="2ab3a-117">如何最佳化 IOPS、頻寬和延遲？</span><span class="sxs-lookup"><span data-stu-id="2ab3a-117">How can you optimize for IOPS, Bandwidth and Latency?</span></span>  

<span data-ttu-id="2ab3a-118">我們特別針對進階儲存體提供這些指導方針，因為進階儲存體上執行的工作負載非常重視效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-118">We have provided these guidelines specifically for Premium Storage because workloads running on Premium Storage are highly performance sensitive.</span></span> <span data-ttu-id="2ab3a-119">我們在適當的地方都提供範例。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-119">We have provided examples where appropriate.</span></span> <span data-ttu-id="2ab3a-120">針對在具有標準儲存體磁碟的 IaaS VM 上執行的應用程式，您也可以運用這些指導方針。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-120">You can also apply some of these guidelines to applications running on IaaS VMs with Standard Storage disks.</span></span>

<span data-ttu-id="2ab3a-121">開始之前，如果您不熟悉進階儲存體，請先閱讀[進階儲存體：Azure 虛擬機器工作負載適用的高效能儲存體](storage-premium-storage.md)和 [Azure 儲存體延展性和效能目標](storage-scalability-targets.md)文章。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-121">Before you begin, if you are new to Premium Storage, first read the [Premium Storage: High-Performance Storage for Azure Virtual Machine Workloads](storage-premium-storage.md) and [Azure Storage Scalability and Performance Targets](storage-scalability-targets.md) articles.</span></span>

## <a name="application-performance-indicators"></a><span data-ttu-id="2ab3a-122">應用程式效能指標</span><span class="sxs-lookup"><span data-stu-id="2ab3a-122">Application Performance Indicators</span></span>
<span data-ttu-id="2ab3a-123">我們使用效能指標來評估應用程式執行是否順暢，例如，應用程式多快處理使用者要求、應用程式在每個要求中處理多少資料、應用程式在一段特定時間內處理多少要求、使用者提交要求之後必須等候少久才獲得回應。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-123">We assess whether an application is performing well or not using performance indicators like, how fast an application is processing a user request, how much data an application is processing per request, how many requests is an application processing in a specific period of time, how long a user has to wait to get a response after submitting their request.</span></span> <span data-ttu-id="2ab3a-124">這些效能指標的技術性術語包括 IOPS、輸送量或頻寬及延遲。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-124">The technical terms for these performance indicators are, IOPS, Throughput or Bandwidth, and Latency.</span></span>

<span data-ttu-id="2ab3a-125">在本節中，我們將討論進階儲存體的一般效能指標。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-125">In this section, we will discuss the common performance indicators in the context of Premium Storage.</span></span> <span data-ttu-id="2ab3a-126">在下一節「收集應用程式需求」中，您將學習如何對您的應用程式測量這些效能指標。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-126">In the following section, Gathering Application Requirements, you will learn how to measure these performance indicators for your application.</span></span> <span data-ttu-id="2ab3a-127">稍後在「最佳化應用程式效能」中，您將了解影響這些效能指標的因素，以及最佳化建議。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-127">Later in Optimizing Application Performance, you will learn about the factors affecting these performance indicators and recommendations to optimize them.</span></span>

## <a name="iops"></a><span data-ttu-id="2ab3a-128">IOPS</span><span class="sxs-lookup"><span data-stu-id="2ab3a-128">IOPS</span></span>
<span data-ttu-id="2ab3a-129">IOPS 是指應用程式在一秒內傳送到儲存體磁碟的要求數。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-129">IOPS is number of requests that your application is sending to the storage disks in one second.</span></span> <span data-ttu-id="2ab3a-130">輸入/輸出作業可能是讀取或寫入、循序或隨機。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-130">An input/output operation could be read or write, sequential or random.</span></span> <span data-ttu-id="2ab3a-131">線上零售網站之類的 OLTP 應用程式需要立即處理許多並行使用者要求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-131">OLTP applications like an online retail website need to process many concurrent user requests immediately.</span></span> <span data-ttu-id="2ab3a-132">使用者要求是頻繁插入和更新的資料庫交易，應用程式必須快速處理。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-132">The user requests are insert and update intensive database transactions, which the application must process quickly.</span></span> <span data-ttu-id="2ab3a-133">因此，OLTP 應用程式需要極高的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-133">Therefore, OLTP applications require very high IOPS.</span></span> <span data-ttu-id="2ab3a-134">這類應用程式處理數百萬個小型和隨機的 IO 要求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-134">Such applications handle millions of small and random IO requests.</span></span> <span data-ttu-id="2ab3a-135">如果您有這類應用程式，您必須以 IOPS 最佳化為重點，設計應用程式基礎結構。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-135">If you have such an application, you must design the application infrastructure to optimize for IOPS.</span></span> <span data-ttu-id="2ab3a-136">在稍後的 *最佳化應用程式效能*一節中，我們將詳細討論產生較高 IOPS 所必須考慮的一切因素。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-136">In the later section, *Optimizing Application Performance*, we discuss in detail all the factors that you must consider to get high IOPS.</span></span>

<span data-ttu-id="2ab3a-137">當您將進階儲存體磁碟連接至高延展性 VM 時，Azure 會根據磁碟規格，保證佈建一定數量的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-137">When you attach a premium storage disk to your high scale VM, Azure provisions for you a guaranteed number of IOPS as per the disk specification.</span></span> <span data-ttu-id="2ab3a-138">例如，P50 磁碟會佈建 7500 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-138">For example, a P50 disk provisions 7500 IOPS.</span></span> <span data-ttu-id="2ab3a-139">每個高延展性 VM 大小也有它可承受的特定 IOPS 限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-139">Each high scale VM size also has a specific IOPS limit that it can sustain.</span></span> <span data-ttu-id="2ab3a-140">例如，標準 GS5 VM 以 80,000 IOPS 為限。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-140">For example, a Standard GS5 VM has 80,000 IOPS limit.</span></span>

## <a name="throughput"></a><span data-ttu-id="2ab3a-141">輸送量</span><span class="sxs-lookup"><span data-stu-id="2ab3a-141">Throughput</span></span>
<span data-ttu-id="2ab3a-142">輸送量或頻寬是指應用程式在指定的間隔內傳送到儲存體磁碟的資料量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-142">Throughput or Bandwidth is the amount of data that your application is sending to the storage disks in a specified interval.</span></span> <span data-ttu-id="2ab3a-143">如果應用程式以較大 IO 單位大小執行輸入/輸出作業，則需要較高輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-143">If your application is performing input/output operations with large IO unit sizes, it requires high Throughput.</span></span> <span data-ttu-id="2ab3a-144">資料倉儲應用程式通常會發出一次存取大量資料的頻繁掃描作業，而且經常執行大量作業。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-144">Data warehouse applications tend to issue scan intensive operations that access large portions of data at a time and commonly perform bulk operations.</span></span> <span data-ttu-id="2ab3a-145">換句話說，這類應用程式需要較高的輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-145">In other words, such applications require higher Throughput.</span></span> <span data-ttu-id="2ab3a-146">如果您有這類應用程式，您必須以輸送量最佳化為重點來設計基礎結構。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-146">If you have such an application, you must design its infrastructure to optimize for Throughput.</span></span> <span data-ttu-id="2ab3a-147">下一節，我們將詳細討論必須調整哪些因素，才能達到此目的。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-147">In the next section, we discuss in detail the factors you must tune to achieve this.</span></span>

<span data-ttu-id="2ab3a-148">當您將進階儲存體磁碟連接至高延展性 VM 時，Azure 會根據該磁碟規格來佈建輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-148">When you attach a premium storage disk to a high scale VM, Azure provisions Throughput as per that disk specification.</span></span> <span data-ttu-id="2ab3a-149">例如，P50 磁碟會佈建每秒 250 MB 的磁碟輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-149">For example, a P50 disk provisions 250 MB per second disk Throughput.</span></span> <span data-ttu-id="2ab3a-150">每個高延展性 VM 大小也有它可承受的特定輸送量限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-150">Each high scale VM size also has as specific Throughput limit that it can sustain.</span></span> <span data-ttu-id="2ab3a-151">例如，標準 GS5 VM 的輸送量上限為每秒 2,000 MB。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-151">For example, Standard GS5 VM has a maximum throughput of 2,000 MB per second.</span></span> 

<span data-ttu-id="2ab3a-152">輸送量和 IOPS 之間存在某種關聯，如下列公式所示。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-152">There is a relation between Throughput and IOPS as shown in the formula below.</span></span>

![](media/storage-premium-storage-performance/image1.png)

<span data-ttu-id="2ab3a-153">因此，務必判斷應用程式所需的最佳輸送量和 IOPS 值。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-153">Therefore, it is important to determine the optimal Throughput and IOPS values that your application requires.</span></span> <span data-ttu-id="2ab3a-154">嘗試最佳化其中一個時，另一個也會受影響。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-154">As you try to optimize one, the other also gets affected.</span></span> <span data-ttu-id="2ab3a-155">在稍後的 *最佳化應用程式效能*一節中，我們將更詳細討論最佳化 IOPS 和輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-155">In a later section, *Optimizing Application Performance*, we will discuss in more details about optimizing IOPS and Throughput.</span></span>

## <a name="latency"></a><span data-ttu-id="2ab3a-156">延遲</span><span class="sxs-lookup"><span data-stu-id="2ab3a-156">Latency</span></span>
<span data-ttu-id="2ab3a-157">延遲是指應用程式收到單一要求、將它傳送至儲存體磁碟，然後將回應傳送給用戶端所花費的時間。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-157">Latency is the time it takes an application to receive a single request, send it to the storage disks and send the response to the client.</span></span> <span data-ttu-id="2ab3a-158">除了 IOPS 和輸送量，這也是應用程式效能的一個重要量值。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-158">This is a critical measure of an application's performance in addition to IOPS and Throughput.</span></span> <span data-ttu-id="2ab3a-159">進階儲存體磁碟的延遲是指擷取要求的資訊並傳回給應用程式所花費的時間。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-159">The Latency of a premium storage disk is the time it takes to retrieve the information for a request and communicate it back to your application.</span></span> <span data-ttu-id="2ab3a-160">進階儲存體提供一致的低延遲。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-160">Premium Storage provides consistent low latencies.</span></span> <span data-ttu-id="2ab3a-161">如果在進階儲存體磁碟上啟用 ReadOnly 主機快取，讀取延遲會非常低。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-161">If you enable ReadOnly host caching on premium storage disks, you can get much lower read latency.</span></span> <span data-ttu-id="2ab3a-162">在稍後的 *最佳化應用程式效能*一節中，我們將更詳細討論磁碟快取。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-162">We will discuss Disk Caching in more detail in later section on *Optimizing Application Performance*.</span></span>

<span data-ttu-id="2ab3a-163">當您將應用程式最佳化以產生較高的 IOPS 和輸送量時，也會影響應用程式的延遲。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-163">When you are optimizing your application to get higher IOPS and Throughput, it will affect the Latency of your application.</span></span> <span data-ttu-id="2ab3a-164">調整應用程式效能之後，務必評估應用程式的延遲，以避免發生非預期的高延遲現象。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-164">After tuning the application performance, always evaluate the Latency of the application to avoid unexpected high latency behavior.</span></span>

## <a name="gather-application-performance-requirements"></a><span data-ttu-id="2ab3a-165">收集應用程式效能需求</span><span class="sxs-lookup"><span data-stu-id="2ab3a-165">Gather Application Performance Requirements</span></span>
<span data-ttu-id="2ab3a-166">設計 Azure 進階儲存體上執行的高效能應用程式時，第一步是了解應用程式的效能需求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-166">The first step in designing high performance applications running on Azure Premium Storage is, to understand the performance requirements of your application.</span></span> <span data-ttu-id="2ab3a-167">收集效能需求之後，您就可以將應用程式最佳化，以達到最佳效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-167">After you gather performance requirements, you can optimize your application to achieve the most optimal performance.</span></span>

<span data-ttu-id="2ab3a-168">在上一節，我們已說明一般效能指標：IOPS、輸送量和延遲。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-168">In the previous section, we explained the common performance indicators, IOPS, Throughput and Latency.</span></span> <span data-ttu-id="2ab3a-169">為了讓應用程式提供理想的使用者體驗，您必須識別哪些是重要的效能指標。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-169">You must identify which of these performance indicators are critical to your application to deliver the desired user experience.</span></span> <span data-ttu-id="2ab3a-170">例如，就每秒處理數百萬個交易的 OLTP 應用程式而言，高 IOPS 最重要。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-170">For example, high IOPS matters most to OLTP applications processing millions of transactions in a second.</span></span> <span data-ttu-id="2ab3a-171">然而，就每秒處理大量資料的資料倉儲應用程式而言，高輸送量很重要。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-171">Whereas, high Throughput is critical for Data Warehouse applications processing large amounts of data in a second.</span></span> <span data-ttu-id="2ab3a-172">就即時視訊串流處理網站之類的即時應用程式而言，極低的延遲非常重要。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-172">Extremely low Latency is crucial for real-time applications like live video streaming websites.</span></span>

<span data-ttu-id="2ab3a-173">接下來，測量應用程式在整個存留期的最高效能需求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-173">Next, measure the maximum performance requirements of your application throughout its lifetime.</span></span> <span data-ttu-id="2ab3a-174">使用下列檢查清單範例作為起點。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-174">Use the sample checklist below as a start.</span></span> <span data-ttu-id="2ab3a-175">記錄正常、尖峰和離峰工作負載期間的最高效能需求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-175">Record the maximum performance requirements during normal, peak and off-hours workload periods.</span></span> <span data-ttu-id="2ab3a-176">只要識別所有工作負載層級的需求，您就可以判斷應用程式的整體效能需求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-176">By identifying requirements for all workloads levels, you will be able to determine the overall performance requirement of your application.</span></span> <span data-ttu-id="2ab3a-177">例如，電子商務網站的正常工作負載是它的一年中大部分日子處理的交易。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-177">For example, the normal workload of an e-commerce website will be the transactions it serves during most days in a year.</span></span> <span data-ttu-id="2ab3a-178">網站的尖峰工作負載是它在節慶季節或特殊銷售活動期間所處理的交易。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-178">The peak workload of the website will be the transactions it serves during holiday season or special sale events.</span></span> <span data-ttu-id="2ab3a-179">尖峰工作負載的期間通常很短，但應用程式可能需要調升為正常作業的兩倍以上。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-179">The peak workload is typically experienced for a limited period, but can require your application to scale two or more times its normal operation.</span></span> <span data-ttu-id="2ab3a-180">請找出 50 百分位數、90 百分位數和 99 百分位數的需求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-180">Find out the 50 percentile, 90 percentile and 99 percentile requirements.</span></span> <span data-ttu-id="2ab3a-181">這有助於篩選掉效能需求的任何極端值，讓您專注於最佳化正確的值。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-181">This helps filter out any outliers in the performance requirements and you can focus your efforts on optimizing for the right values.</span></span>

<span data-ttu-id="2ab3a-182">**應用程式效能需求檢查清單**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-182">**Application Performance Requirements Checklist**</span></span>

| <span data-ttu-id="2ab3a-183">**效能需求**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-183">**Performance requirements**</span></span> | <span data-ttu-id="2ab3a-184">**50 百分位數**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-184">**50 Percentile**</span></span> | <span data-ttu-id="2ab3a-185">**90 百分位數**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-185">**90 Percentile**</span></span> | <span data-ttu-id="2ab3a-186">**99 百分位數**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-186">**99  Percentile**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="2ab3a-187">最大</span><span class="sxs-lookup"><span data-stu-id="2ab3a-187">Max.</span></span> <span data-ttu-id="2ab3a-188">每秒交易</span><span class="sxs-lookup"><span data-stu-id="2ab3a-188">Transactions per second</span></span> | | | |
| <span data-ttu-id="2ab3a-189">% 讀取作業</span><span class="sxs-lookup"><span data-stu-id="2ab3a-189">% Read operations</span></span> | | | |
| <span data-ttu-id="2ab3a-190">% 寫入作業</span><span class="sxs-lookup"><span data-stu-id="2ab3a-190">% Write operations</span></span> | | | |
| <span data-ttu-id="2ab3a-191">% 隨機作業</span><span class="sxs-lookup"><span data-stu-id="2ab3a-191">% Random operations</span></span> | | | |
| <span data-ttu-id="2ab3a-192">% 循序作業</span><span class="sxs-lookup"><span data-stu-id="2ab3a-192">% Sequential operations</span></span> | | | |
| <span data-ttu-id="2ab3a-193">IO 要求大小</span><span class="sxs-lookup"><span data-stu-id="2ab3a-193">IO request size</span></span> | | | |
| <span data-ttu-id="2ab3a-194">平均輸送量</span><span class="sxs-lookup"><span data-stu-id="2ab3a-194">Average Throughput</span></span> | | | |
| <span data-ttu-id="2ab3a-195">最大</span><span class="sxs-lookup"><span data-stu-id="2ab3a-195">Max.</span></span> <span data-ttu-id="2ab3a-196">輸送量</span><span class="sxs-lookup"><span data-stu-id="2ab3a-196">Throughput</span></span> | | | |
| <span data-ttu-id="2ab3a-197">最小</span><span class="sxs-lookup"><span data-stu-id="2ab3a-197">Min.</span></span> <span data-ttu-id="2ab3a-198">延遲</span><span class="sxs-lookup"><span data-stu-id="2ab3a-198">Latency</span></span> | | | |
| <span data-ttu-id="2ab3a-199">平均延遲</span><span class="sxs-lookup"><span data-stu-id="2ab3a-199">Average Latency</span></span> | | | |
| <span data-ttu-id="2ab3a-200">最大</span><span class="sxs-lookup"><span data-stu-id="2ab3a-200">Max.</span></span> <span data-ttu-id="2ab3a-201">CPU</span><span class="sxs-lookup"><span data-stu-id="2ab3a-201">CPU</span></span> | | | |
| <span data-ttu-id="2ab3a-202">平均 CPU</span><span class="sxs-lookup"><span data-stu-id="2ab3a-202">Average CPU</span></span> | | | |
| <span data-ttu-id="2ab3a-203">最大</span><span class="sxs-lookup"><span data-stu-id="2ab3a-203">Max.</span></span> <span data-ttu-id="2ab3a-204">記憶體</span><span class="sxs-lookup"><span data-stu-id="2ab3a-204">Memory</span></span> | | | |
| <span data-ttu-id="2ab3a-205">平均記憶體</span><span class="sxs-lookup"><span data-stu-id="2ab3a-205">Average Memory</span></span> | | | |
| <span data-ttu-id="2ab3a-206">佇列深度</span><span class="sxs-lookup"><span data-stu-id="2ab3a-206">Queue Depth</span></span> | | | |

> [!NOTE]
> <span data-ttu-id="2ab3a-207">您應該預期應用程式未來的成長，據以調整這些數字。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-207">You should consider scaling these numbers based on expected future growth of your application.</span></span> <span data-ttu-id="2ab3a-208">最好事先為成長預做規劃，因為以後再變更基礎結構來改善效能會較困難。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-208">It is a good idea to plan for growth ahead of time, because it could be harder to change the infrastructure for improving performance later.</span></span>
>
>

<span data-ttu-id="2ab3a-209">如果您有現有的應用程式，而且想要移到進階儲存體，請先為現有的應用程式建立上述檢查清單。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-209">If you have an existing application and want to move to Premium Storage, first build the checklist above for the existing application.</span></span> <span data-ttu-id="2ab3a-210">然後，在進階儲存體上建置應用程式的原型，並根據本文件稍後的 *最佳化應用程式效能* 一節所述的指導方針來設計應用程式。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-210">Then, build a prototype of your application on Premium Storage and design the application based on guidelines described in *Optimizing Application Performance* in a later section of this document.</span></span> <span data-ttu-id="2ab3a-211">下一節說明可用來收集效能度量單位的工具。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-211">The next section describes the tools you can use to gather the performance measurements.</span></span>

<span data-ttu-id="2ab3a-212">為原型建立一份類似於現有應用程式的檢查清單。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-212">Create a checklist similar to your existing application for the prototype.</span></span> <span data-ttu-id="2ab3a-213">您可以使用效能評定工具，在原型應用程式上模擬工作負載並測量效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-213">Using Benchmarking tools you can simulate the workloads and measure performance on the prototype application.</span></span> <span data-ttu-id="2ab3a-214">如需深入了解，請參閱 [效能評定](#benchmarking) 一節。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-214">See the section on [Benchmarking](#benchmarking) to learn more.</span></span> <span data-ttu-id="2ab3a-215">這樣做可讓您判斷進階儲存體是否符合或超越應用程式效能需求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-215">By doing so you can determine whether Premium Storage can match or surpass your application performance requirements.</span></span> <span data-ttu-id="2ab3a-216">然後，您可以對實際執行的應用程式運用相同的指導方針。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-216">Then you can implement the same guidelines for your production application.</span></span>

### <a name="counters-to-measure-application-performance-requirements"></a><span data-ttu-id="2ab3a-217">測量應用程式效能需求的計數器</span><span class="sxs-lookup"><span data-stu-id="2ab3a-217">Counters to measure application performance requirements</span></span>
<span data-ttu-id="2ab3a-218">如果要測量應用程式的效能需求，最佳方式就是使用伺服器的作業系統所提供的效能監視工具。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-218">The best way to measure performance requirements of your application, is to use performance-monitoring tools provided by the operating system of the server.</span></span> <span data-ttu-id="2ab3a-219">您可以使用 Windows 的 PerfMon 和 Linux 的 iostat。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-219">You can use PerfMon for Windows and iostat for Linux.</span></span> <span data-ttu-id="2ab3a-220">這些工具可擷取與上一節所述的每個量值相對應的計數器。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-220">These tools capture counters corresponding to each measure explained in the above section.</span></span> <span data-ttu-id="2ab3a-221">當應用程式執行正常、尖峰和離峰工作負載時，您必須在擷取這些計數器的值。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-221">You must capture the values of these counters when your application is running its normal, peak and off-hours workloads.</span></span>

<span data-ttu-id="2ab3a-222">伺服器的處理器、記憶體及每個邏輯磁碟和實體磁碟，都有可用的 PerfMon 計數器。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-222">The PerfMon counters are available for processor, memory and, each logical disk and physical disk of your server.</span></span> <span data-ttu-id="2ab3a-223">當您使用進階儲存體磁碟和 VM 時，實體磁碟計數器適用於每個進階儲存體磁碟，邏輯磁碟計數器適用於進階儲存體上建立的每個磁碟區。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-223">When you use premium storage disks with a VM, the physical disk counters are for each premium storage disk, and logical disk counters are for each volume created on the premium storage disks.</span></span> <span data-ttu-id="2ab3a-224">您必須為裝載應用程式工作負載的磁碟擷取這些值。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-224">You must capture the values for the disks that host your application workload.</span></span> <span data-ttu-id="2ab3a-225">如果邏輯與實體磁碟之間有一對一對應，您可以參考實體磁碟計數器，否則請參考邏輯磁碟計數器。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-225">If there is a one to one mapping between logical and physical disks, you can refer to physical disk counters; otherwise refer to the logical disk counters.</span></span> <span data-ttu-id="2ab3a-226">在 Linux 上，iostat 命令會產生 CPU 和磁碟使用率報告。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-226">On Linux, the iostat command generates a CPU and disk utilization report.</span></span> <span data-ttu-id="2ab3a-227">磁碟使用率報告提供每個實體裝置或分割區的統計資料。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-227">The disk utilization report provides statistics per physical device or partition.</span></span> <span data-ttu-id="2ab3a-228">如果資料庫伺服器的資料和記錄位於不同磁碟上，請同時從這兩個磁碟中收集這項資料。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-228">If you have a database server with its data and log on separate disks, collect this data for both disks.</span></span> <span data-ttu-id="2ab3a-229">下表說明磁碟、處理器和記憶體的計數器：</span><span class="sxs-lookup"><span data-stu-id="2ab3a-229">Below table describes counters for disks, processor and memory:</span></span>

| <span data-ttu-id="2ab3a-230">計數器</span><span class="sxs-lookup"><span data-stu-id="2ab3a-230">Counter</span></span> | <span data-ttu-id="2ab3a-231">說明</span><span class="sxs-lookup"><span data-stu-id="2ab3a-231">Description</span></span> | <span data-ttu-id="2ab3a-232">PerfMon</span><span class="sxs-lookup"><span data-stu-id="2ab3a-232">PerfMon</span></span> | <span data-ttu-id="2ab3a-233">Iostat</span><span class="sxs-lookup"><span data-stu-id="2ab3a-233">Iostat</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="2ab3a-234">**IOPS 或每秒交易數**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-234">**IOPS or Transactions per second**</span></span> |<span data-ttu-id="2ab3a-235">每秒發出給儲存體磁碟的 I/O 要求數。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-235">Number of I/O requests issued to the storage disk per second.</span></span> |<span data-ttu-id="2ab3a-236">Disk Reads/sec </span><span class="sxs-lookup"><span data-stu-id="2ab3a-236">Disk Reads/sec</span></span> <br> <span data-ttu-id="2ab3a-237">Disk Writes/sec</span><span class="sxs-lookup"><span data-stu-id="2ab3a-237">Disk Writes/sec</span></span> |<span data-ttu-id="2ab3a-238">tps </span><span class="sxs-lookup"><span data-stu-id="2ab3a-238">tps</span></span> <br> <span data-ttu-id="2ab3a-239">r/s </span><span class="sxs-lookup"><span data-stu-id="2ab3a-239">r/s</span></span> <br> <span data-ttu-id="2ab3a-240">w/s</span><span class="sxs-lookup"><span data-stu-id="2ab3a-240">w/s</span></span> |
| <span data-ttu-id="2ab3a-241">**磁碟讀取和寫入**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-241">**Disk Reads and Writes**</span></span> |<span data-ttu-id="2ab3a-242">磁碟上執行的讀取和寫入作業 %。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-242">% of Reads and Write operations performed on the disk.</span></span> |<span data-ttu-id="2ab3a-243">% Disk Read Time </span><span class="sxs-lookup"><span data-stu-id="2ab3a-243">% Disk Read Time</span></span> <br> <span data-ttu-id="2ab3a-244">% Disk Write Time</span><span class="sxs-lookup"><span data-stu-id="2ab3a-244">% Disk Write Time</span></span> |<span data-ttu-id="2ab3a-245">r/s </span><span class="sxs-lookup"><span data-stu-id="2ab3a-245">r/s</span></span> <br> <span data-ttu-id="2ab3a-246">w/s</span><span class="sxs-lookup"><span data-stu-id="2ab3a-246">w/s</span></span> |
| <span data-ttu-id="2ab3a-247">**輸送量**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-247">**Throughput**</span></span> |<span data-ttu-id="2ab3a-248">每秒讀取或寫入磁碟的資料量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-248">Amount of data read from or written to the disk per second.</span></span> |<span data-ttu-id="2ab3a-249">Disk Read Bytes/sec </span><span class="sxs-lookup"><span data-stu-id="2ab3a-249">Disk Read Bytes/sec</span></span> <br> <span data-ttu-id="2ab3a-250">Disk Write Bytes/sec</span><span class="sxs-lookup"><span data-stu-id="2ab3a-250">Disk Write Bytes/sec</span></span> |<span data-ttu-id="2ab3a-251">kB_read/s</span><span class="sxs-lookup"><span data-stu-id="2ab3a-251">kB_read/s</span></span> <br> <span data-ttu-id="2ab3a-252">kB_wrtn/s</span><span class="sxs-lookup"><span data-stu-id="2ab3a-252">kB_wrtn/s</span></span> |
| <span data-ttu-id="2ab3a-253">**延遲**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-253">**Latency**</span></span> |<span data-ttu-id="2ab3a-254">完成磁碟 IO 要求的總時間。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-254">Total time to complete a disk IO request.</span></span> |<span data-ttu-id="2ab3a-255">Average Disk sec/Read </span><span class="sxs-lookup"><span data-stu-id="2ab3a-255">Average Disk sec/Read</span></span> <br> <span data-ttu-id="2ab3a-256">Average disk sec/Write</span><span class="sxs-lookup"><span data-stu-id="2ab3a-256">Average disk sec/Write</span></span> |<span data-ttu-id="2ab3a-257">await </span><span class="sxs-lookup"><span data-stu-id="2ab3a-257">await</span></span> <br> <span data-ttu-id="2ab3a-258">svctm</span><span class="sxs-lookup"><span data-stu-id="2ab3a-258">svctm</span></span> |
| <span data-ttu-id="2ab3a-259">**IO 大小**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-259">**IO size**</span></span> |<span data-ttu-id="2ab3a-260">發出給儲存體磁碟的 I/O 要求大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-260">The size of I/O requests issues to the storage disks.</span></span> |<span data-ttu-id="2ab3a-261">Average Disk Bytes/Read </span><span class="sxs-lookup"><span data-stu-id="2ab3a-261">Average Disk Bytes/Read</span></span> <br> <span data-ttu-id="2ab3a-262">Average Disk Bytes/Write</span><span class="sxs-lookup"><span data-stu-id="2ab3a-262">Average Disk Bytes/Write</span></span> |<span data-ttu-id="2ab3a-263">avgrq-sz</span><span class="sxs-lookup"><span data-stu-id="2ab3a-263">avgrq-sz</span></span> |
| <span data-ttu-id="2ab3a-264">**佇列深度**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-264">**Queue Depth**</span></span> |<span data-ttu-id="2ab3a-265">等候讀取或寫入儲存體磁碟的未完成 I/O 要求數。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-265">Number of outstanding I/O requests waiting to be read form or written to the storage disk.</span></span> |<span data-ttu-id="2ab3a-266">目前磁碟佇列長度</span><span class="sxs-lookup"><span data-stu-id="2ab3a-266">Current Disk Queue Length</span></span> |<span data-ttu-id="2ab3a-267">avgqu-sz</span><span class="sxs-lookup"><span data-stu-id="2ab3a-267">avgqu-sz</span></span> |
| <span data-ttu-id="2ab3a-268">**最大記憶體**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-268">**Max. Memory**</span></span> |<span data-ttu-id="2ab3a-269">順暢執行應用程式所需的記憶體數量</span><span class="sxs-lookup"><span data-stu-id="2ab3a-269">Amount of memory required to run application smoothly</span></span> |<span data-ttu-id="2ab3a-270">% Committed Bytes in Use</span><span class="sxs-lookup"><span data-stu-id="2ab3a-270">% Committed Bytes in Use</span></span> |<span data-ttu-id="2ab3a-271">Use vmstat</span><span class="sxs-lookup"><span data-stu-id="2ab3a-271">Use vmstat</span></span> |
| <span data-ttu-id="2ab3a-272">**最大CPU**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-272">**Max. CPU**</span></span> |<span data-ttu-id="2ab3a-273">順暢執行應用程式所需的 CPU 數量</span><span class="sxs-lookup"><span data-stu-id="2ab3a-273">Amount CPU required to run application smoothly</span></span> |<span data-ttu-id="2ab3a-274">% Processor time</span><span class="sxs-lookup"><span data-stu-id="2ab3a-274">% Processor time</span></span> |<span data-ttu-id="2ab3a-275">%util</span><span class="sxs-lookup"><span data-stu-id="2ab3a-275">%util</span></span> |

<span data-ttu-id="2ab3a-276">深入了解 [iostat](http://linuxcommand.org/man_pages/iostat1.html) 和 [PerfMon](https://msdn.microsoft.com/library/aa645516.aspx)。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-276">Learn more about [iostat](http://linuxcommand.org/man_pages/iostat1.html) and [PerfMon](https://msdn.microsoft.com/library/aa645516.aspx).</span></span>

## <a name="optimizing-application-performance"></a><span data-ttu-id="2ab3a-277">最佳化應用程式效能</span><span class="sxs-lookup"><span data-stu-id="2ab3a-277">Optimizing Application Performance</span></span>
<span data-ttu-id="2ab3a-278">對進階儲存體上執行的應用程式，影響效能的主要因素包括 IO 要求的本質、VM 大小、磁碟大小、磁碟數目、磁碟快取、多執行緒處理和佇列深度。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-278">The main factors that influence performance of an application running on Premium Storage are Nature of IO Requests, VM size, Disk size, Number of disks, Disk Caching, Multithreading and Queue Depth.</span></span> <span data-ttu-id="2ab3a-279">您可以使用系統提供的參數來控制這些因素。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-279">You can control some of these factors with knobs provided by the system.</span></span> <span data-ttu-id="2ab3a-280">大部分應用程式可能沒有選項讓您直接改變 IO 大小和佇列深度。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-280">Most applications may not give you an option to alter the IO size and Queue Depth directly.</span></span> <span data-ttu-id="2ab3a-281">例如，如果您使用 SQL Server，您無法選擇 IO 大小和佇列深度。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-281">For example, if you are using SQL Server, you cannot choose the IO size and queue depth.</span></span> <span data-ttu-id="2ab3a-282">SQL Server 會選擇最佳 IO 大小和佇列深度值，以獲得最高效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-282">SQL Server chooses the optimal IO size and queue depth values to get the most performance.</span></span> <span data-ttu-id="2ab3a-283">務必了解這兩種因素對應用程式效能的影響，才能佈建適當的資源來滿足效能需求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-283">It is important to understand the effects of both types of factors on your application performance, so that you can provision appropriate resources to meet performance needs.</span></span>

<span data-ttu-id="2ab3a-284">在本節中，請參閱您建立的應用程式需求檢查清單，以識別您需要將應用程式效能最佳化到何種程度。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-284">Throughout this section, refer to the application requirements checklist that you created, to identify how much you need to optimize your application performance.</span></span> <span data-ttu-id="2ab3a-285">據此，您將能夠判斷需要調整本節中的哪些因素。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-285">Based on that, you will be able to determine which factors from this section you will need to tune.</span></span> <span data-ttu-id="2ab3a-286">若要證明每個因素對應用程式效能的影響，請在應用程式安裝上執行效能評定工具。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-286">To witness the effects of each factor on your application performance, run benchmarking tools on your application setup.</span></span> <span data-ttu-id="2ab3a-287">有關在 Windows 和 Linux VM 上執行一般效能評定工具的步驟，請參閱本文最後的 [效能評定](#Benchmarking) 一節。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-287">Refer to the [Benchmarking](#Benchmarking) section at the end of this article for steps to run common benchmarking tools on Windows and Linux VMs.</span></span>

### <a name="optimizing-iops-throughput-and-latency-at-a-glance"></a><span data-ttu-id="2ab3a-288">最佳化 IOPS、輸送量和延遲的速覽</span><span class="sxs-lookup"><span data-stu-id="2ab3a-288">Optimizing IOPS, Throughput and Latency at a glance</span></span>
<span data-ttu-id="2ab3a-289">下表摘要說明所有效能因素和最佳化 IOPS、輸送量和延遲的步驟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-289">The table below summarizes all the performance factors and the steps to optimize IOPS, Throughput and Latency.</span></span> <span data-ttu-id="2ab3a-290">這份摘要之後的幾節更深入說明每一個因素。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-290">The sections following this summary will describe each factor is much more depth.</span></span>

| &nbsp; | <span data-ttu-id="2ab3a-291">**IOPS**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-291">**IOPS**</span></span> | <span data-ttu-id="2ab3a-292">**輸送量**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-292">**Throughput**</span></span> | <span data-ttu-id="2ab3a-293">**延遲**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-293">**Latency**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="2ab3a-294">**範例案例**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-294">**Example Scenario**</span></span> |<span data-ttu-id="2ab3a-295">需要極高每秒交易速率的企業 OLTP 應用程式。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-295">Enterprise OLTP application requiring very high transactions per second rate.</span></span> |<span data-ttu-id="2ab3a-296">處理大量資料的企業資料倉儲應用程式。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-296">Enterprise Data warehousing application processing large amounts of data.</span></span> |<span data-ttu-id="2ab3a-297">需要立即回應使用者要求的近乎即時的應用程式，例如線上遊戲。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-297">Near real-time applications requiring instant responses to user requests, like online gaming.</span></span> |
| <span data-ttu-id="2ab3a-298">效能因素</span><span class="sxs-lookup"><span data-stu-id="2ab3a-298">Performance factors</span></span> | &nbsp; | &nbsp; | &nbsp; |
| <span data-ttu-id="2ab3a-299">**IO 大小**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-299">**IO size**</span></span> |<span data-ttu-id="2ab3a-300">較小 IO 大小會產生較高的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-300">Smaller IO size yields higher IOPS.</span></span> |<span data-ttu-id="2ab3a-301">較大 IO 大小會產生較高的輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-301">Larger IO size to yields higher Throughput.</span></span> | &nbsp;|
| <span data-ttu-id="2ab3a-302">**VM 大小**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-302">**VM size**</span></span> |<span data-ttu-id="2ab3a-303">使用 IOPS 大於應用程式需求的 VM 大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-303">Use a VM size that offers IOPS greater than your application requirement.</span></span> <span data-ttu-id="2ab3a-304">請參閱這裡的 VM 大小及其 IOPS 限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-304">See VM sizes and their IOPS limits here.</span></span> |<span data-ttu-id="2ab3a-305">使用輸送量限制大於應用程式需求的 VM 大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-305">Use a VM size with Throughput limit greater than your application requirement.</span></span> <span data-ttu-id="2ab3a-306">請參閱這裡的 VM 大小及其輸送量限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-306">See VM sizes and their Throughput limits here.</span></span> |<span data-ttu-id="2ab3a-307">使用調整限制大於應用程式需求的 VM 大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-307">Use a VM size that offers scale limits greater than your application requirement.</span></span> <span data-ttu-id="2ab3a-308">請參閱這裡的 VM 大小及其限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-308">See VM sizes and their limits here.</span></span> |
| <span data-ttu-id="2ab3a-309">**磁碟大小**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-309">**Disk size**</span></span> |<span data-ttu-id="2ab3a-310">使用 IOPS 大於應用程式需求的磁碟大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-310">Use a disk size that offers IOPS greater than your application requirement.</span></span> <span data-ttu-id="2ab3a-311">請參閱這裡的磁碟大小及其 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-311">See disk sizes and their IOPS limits here.</span></span> |<span data-ttu-id="2ab3a-312">使用輸送量限制大於應用程式需求的磁碟大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-312">Use a disk size with Throughput limit greater than your application requirement.</span></span> <span data-ttu-id="2ab3a-313">請參閱這裡的磁碟大小及其輸送量限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-313">See disk sizes and their Throughput limits here.</span></span> |<span data-ttu-id="2ab3a-314">使用調整限制大於應用程式需求的磁碟大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-314">Use a disk size that offers scale limits greater than your application requirement.</span></span> <span data-ttu-id="2ab3a-315">請參閱這裡的磁碟大小及其限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-315">See disk sizes and their limits here.</span></span> |
| <span data-ttu-id="2ab3a-316">**VM 和磁碟調整限制**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-316">**VM and Disk Scale Limits**</span></span> |<span data-ttu-id="2ab3a-317">選擇的 VM 大小的 IOPS 限制，應該大於它連接的進階儲存體磁碟所推動的 IOPS 總數。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-317">IOPS limit of the VM size chosen should be greater than total IOPS driven by premium storage disks attached to it.</span></span> |<span data-ttu-id="2ab3a-318">選擇的 VM 大小的輸送量限制，應該大於它連接的進階儲存體磁碟所推動的輸送量總數。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-318">Throughput limit of the VM size chosen should be greater than total Throughput driven by premium storage disks attached to it.</span></span> |<span data-ttu-id="2ab3a-319">選擇的 VM 大小的調整限制，必須大於連接的進階儲存體磁碟的調整限制總數。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-319">Scale limits of the VM size chosen must be greater than total scale limits of attached premium storage disks.</span></span> |
| <span data-ttu-id="2ab3a-320">**磁碟快取**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-320">**Disk Caching**</span></span> |<span data-ttu-id="2ab3a-321">在讀取作業繁重的進階儲存體磁碟上，啟用唯讀快取可產生較高的讀取 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-321">Enable ReadOnly Cache on premium storage disks with Read heavy operations to get higher Read IOPS.</span></span> | &nbsp; |<span data-ttu-id="2ab3a-322">在讀取作業繁重的進階儲存體磁碟上，啟用唯讀快取可產生極低的讀取延遲。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-322">Enable ReadOnly Cache on premium storage disks with Ready heavy operations to get very low Read latencies.</span></span> |
| <span data-ttu-id="2ab3a-323">**磁碟串接**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-323">**Disk Striping**</span></span> |<span data-ttu-id="2ab3a-324">使用多個磁碟並串接在一起，可結合產生較高的 IOPS 和輸送量限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-324">Use multiple disks and stripe them together to get a combined higher IOPS and Throughput limit.</span></span> <span data-ttu-id="2ab3a-325">請注意，每個 VM 的結合限制應該高於連接的高階磁碟的結合限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-325">Note that the combined limit per VM should be higher than the combined limits of attached premium disks.</span></span> | &nbsp; | &nbsp; |
| <span data-ttu-id="2ab3a-326">**等量大小**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-326">**Stripe Size**</span></span> |<span data-ttu-id="2ab3a-327">在 OLTP 應用程式中，隨機小型 IO 模式使用較小的等量大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-327">Smaller stripe size for random small IO pattern seen in OLTP applications.</span></span> <span data-ttu-id="2ab3a-328">例如，SQL Server OLTP 應用程式使用等量大小 64KB。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-328">E.g., use stripe size of 64KB for SQL Server OLTP application.</span></span> |<span data-ttu-id="2ab3a-329">在資料倉儲應用程式中，循序大型 IO 模式使用較大的等量大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-329">Larger stripe size for sequential large IO pattern seen in Data Warehouse applications.</span></span> <span data-ttu-id="2ab3a-330">例如，SQL Server 資料倉儲應用程式使用 256KB 等量大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-330">E.g., use 256KB stripe size for SQL Server Data warehouse application.</span></span> | &nbsp; |
| <span data-ttu-id="2ab3a-331">**多執行緒處理**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-331">**Multithreading**</span></span> |<span data-ttu-id="2ab3a-332">使用多執行緒處理將較多要求推送至進階儲存體，將會產生較高的 IOPS 和輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-332">Use multithreading to push higher number of requests to Premium Storage that will lead to higher IOPS and Throughput.</span></span> <span data-ttu-id="2ab3a-333">例如，在 SQL Server 上設定較高的 MAXDOP 值，可配置更多 CPU 給 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-333">For example, on SQL Server set a high MAXDOP value to allocate more CPUs to SQL Server.</span></span> | &nbsp; | &nbsp; |
| <span data-ttu-id="2ab3a-334">**佇列深度**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-334">**Queue Depth**</span></span> |<span data-ttu-id="2ab3a-335">較大佇列深度會產生較高的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-335">Larger Queue Depth yields higher IOPS.</span></span> |<span data-ttu-id="2ab3a-336">較大佇列深度會產生較高的輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-336">Larger Queue Depth yields higher Throughput.</span></span> |<span data-ttu-id="2ab3a-337">較小佇列深度會產生較低的延遲。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-337">Smaller Queue Depth yields lower latencies.</span></span> |

## <a name="nature-of-io-requests"></a><span data-ttu-id="2ab3a-338">IO 要求的本質</span><span class="sxs-lookup"><span data-stu-id="2ab3a-338">Nature of IO Requests</span></span>
<span data-ttu-id="2ab3a-339">IO 要求是指應用程式執行的輸入/輸出作業單位。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-339">An IO request is a unit of input/output operation that your application will be performing.</span></span> <span data-ttu-id="2ab3a-340">識別 IO 要求的本質、隨機或循序、讀取或寫入、小型或大型，可協助您判斷應用程式的效能需求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-340">Identifying the nature of IO requests, random or sequential, read or write, small or large, will help you determine the performance requirements of your application.</span></span> <span data-ttu-id="2ab3a-341">設計應用程式基礎結構時，務必了解 IO 要求的本質，才能做出正確的決策。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-341">It is very important to understand the nature of IO requests, to make the right decisions when designing your application infrastructure.</span></span>

<span data-ttu-id="2ab3a-342">IO 大小是其中一個很重要的因素。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-342">IO size is one of the more important factors.</span></span> <span data-ttu-id="2ab3a-343">IO 大小是指應用程式所產生的輸入/輸出作業要求的大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-343">The IO size is the size of the input/output operation request generated by your application.</span></span> <span data-ttu-id="2ab3a-344">IO 大小對效能有很重大的影響，特別是應用程式可達到的 IOPS 和頻寬。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-344">The IO size has a significant impact on performance especially on the IOPS and Bandwidth that the application is able to achieve.</span></span> <span data-ttu-id="2ab3a-345">下列公式顯示 IOPS、IO 大小和頻寬/輸送量之間的關聯性。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-345">The following formula shows the relationship between IOPS, IO size and Bandwidth/Throughput.</span></span>  
    ![](media/storage-premium-storage-performance/image1.png)

<span data-ttu-id="2ab3a-346">有些應用程式可讓您改變 IO 大小，而有些應用程式則不能改變。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-346">Some applications allow you to alter their IO size, while some applications do not.</span></span> <span data-ttu-id="2ab3a-347">例如，SQL Server 會自行決定最佳的 IO 大小，不提供任何參數讓使用者變更 IO 大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-347">For example, SQL Server determines the optimal IO size itself, and does not provide users with any knobs to change it.</span></span> <span data-ttu-id="2ab3a-348">相反地，Oracle 提供 [DB\_BLOCK\_SIZE](https://docs.oracle.com/cd/B19306_01/server.102/b14211/iodesign.htm#i28815) 參數，可用來設定資料庫的 I/O 要求大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-348">On the other hand, Oracle provides a parameter called [DB\_BLOCK\_SIZE](https://docs.oracle.com/cd/B19306_01/server.102/b14211/iodesign.htm#i28815) using which you can configure the I/O request size of the database.</span></span>

<span data-ttu-id="2ab3a-349">如果您使用的應用程式不允許變更 IO 大小，請根據本文中的指導方針，將應用程式最相關的效能 KPI 最佳化。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-349">If you are using an application, which does not allow you to change the IO size, use the guidelines in this article to optimize the performance KPI that is most relevant to your application.</span></span> <span data-ttu-id="2ab3a-350">例如，</span><span class="sxs-lookup"><span data-stu-id="2ab3a-350">For example,</span></span>

* <span data-ttu-id="2ab3a-351">OLTP 應用程式會產生數百萬個小型和隨機的 IO 要求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-351">An OLTP application generates millions of small and random IO requests.</span></span> <span data-ttu-id="2ab3a-352">若要處理這種 IO 要求，您必須以提高 IOPS 為重點，設計應用程式基礎結構。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-352">To handle these type of IO requests, you must design your application infrastructure to get higher IOPS.</span></span>  
* <span data-ttu-id="2ab3a-353">資料倉儲應用程式會產生大型和循序的 IO 要求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-353">A data warehousing application generates large and sequential IO requests.</span></span> <span data-ttu-id="2ab3a-354">若要處理這種 IO 要求，您必須以提高頻寬和輸送量為重點，設計應用程式基礎結構。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-354">To handle these type of IO requests, you must design your application infrastructure to get higher Bandwidth or Throughput.</span></span>

<span data-ttu-id="2ab3a-355">如果您使用的應用程式可讓您變更 IO 大小，除了參考其他效能指導方針，請利用此基本原則來決定 IO 大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-355">If you are using an application, which allows you to change the IO size, use this rule of thumb for the IO size in addition to other performance guidelines,</span></span>

* <span data-ttu-id="2ab3a-356">較小 IO 大小會產生較高的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-356">Smaller IO size to get higher IOPS.</span></span> <span data-ttu-id="2ab3a-357">例如，OLTP 應用程式使用 8 KB。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-357">For example, 8 KB for an OLTP application.</span></span>  
* <span data-ttu-id="2ab3a-358">較大 IO 大小會產生較高的頻寬/輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-358">Larger IO size to get higher Bandwidth/Throughput.</span></span> <span data-ttu-id="2ab3a-359">例如，資料倉儲應用程式使用 1024 KB。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-359">For example, 1024 KB for a data warehouse application.</span></span>

<span data-ttu-id="2ab3a-360">以下是如何計算應用程式的 IOPS 和輸送量/頻寬的範例。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-360">Here is an example on how you can calculate the IOPS and Throughput/Bandwidth for your application.</span></span> <span data-ttu-id="2ab3a-361">假設應用程式使用 P30 磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-361">Consider an application using a P30 disk.</span></span> <span data-ttu-id="2ab3a-362">P30 磁碟可以達到的最大 IOPS 和輸送量/頻寬，分別為 5000 IOPS 和每秒 200 MB。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-362">The maximum IOPS and Throughput/Bandwidth a P30 disk can achieve is 5000 IOPS and 200 MB per second respectively.</span></span> <span data-ttu-id="2ab3a-363">現在，如果應用程式需要 P30 磁碟的最大 IOPS，但您使用較小的 IO 大小，例如 8 KB，則能夠達到的頻寬為每秒 40 MB。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-363">Now, if your application requires the maximum IOPS from the P30 disk and you use a smaller IO size like 8 KB, the resulting Bandwidth you will be able to get is 40 MB per second.</span></span> <span data-ttu-id="2ab3a-364">不過，如果應用程式需要 P30 磁碟的最大輪送量/頻寬，而且您使用較大的 IO 大小，例如 1024 KB，則產生的 IOPS 較小，只有 200 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-364">However, if your application requires the maximum Throughput/Bandwidth from P30 disk, and you use a larger IO size like 1024 KB, the resulting IOPS will be less, 200 IOPS.</span></span> <span data-ttu-id="2ab3a-365">因此，請將 IO 大小調整為同時滿足應用程式的 IOPS 和輸送量/頻寬需求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-365">Therefore, tune the IO size such that it meets both your application's IOPS and Throughput/Bandwidth requirement.</span></span> <span data-ttu-id="2ab3a-366">下表摘要說明 P30 磁碟的不同 IO 大小及其對應的 IOPS 和輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-366">Table below summarizes the different IO sizes and their corresponding IOPS and Throughput for a P30 disk.</span></span>

| <span data-ttu-id="2ab3a-367">應用程式需求</span><span class="sxs-lookup"><span data-stu-id="2ab3a-367">Application Requirement</span></span> | <span data-ttu-id="2ab3a-368">I/O 大小</span><span class="sxs-lookup"><span data-stu-id="2ab3a-368">I/O size</span></span> | <span data-ttu-id="2ab3a-369">IOPS</span><span class="sxs-lookup"><span data-stu-id="2ab3a-369">IOPS</span></span> | <span data-ttu-id="2ab3a-370">輸送量/頻寬</span><span class="sxs-lookup"><span data-stu-id="2ab3a-370">Throughput/Bandwidth</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="2ab3a-371">最大 IOPS</span><span class="sxs-lookup"><span data-stu-id="2ab3a-371">Max IOPS</span></span> |<span data-ttu-id="2ab3a-372">8 KB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-372">8 KB</span></span> |<span data-ttu-id="2ab3a-373">5,000</span><span class="sxs-lookup"><span data-stu-id="2ab3a-373">5,000</span></span> |<span data-ttu-id="2ab3a-374">每秒 40 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-374">40 MB per second</span></span> |
| <span data-ttu-id="2ab3a-375">最大輸送量</span><span class="sxs-lookup"><span data-stu-id="2ab3a-375">Max Throughput</span></span> |<span data-ttu-id="2ab3a-376">1024 KB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-376">1024 KB</span></span> |<span data-ttu-id="2ab3a-377">200</span><span class="sxs-lookup"><span data-stu-id="2ab3a-377">200</span></span> |<span data-ttu-id="2ab3a-378">每秒 200 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-378">200 MB per second</span></span> |
| <span data-ttu-id="2ab3a-379">最大輸送量 + 高 IOPS</span><span class="sxs-lookup"><span data-stu-id="2ab3a-379">Max Throughput + high IOPS</span></span> |<span data-ttu-id="2ab3a-380">64 KB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-380">64 KB</span></span> |<span data-ttu-id="2ab3a-381">3,200</span><span class="sxs-lookup"><span data-stu-id="2ab3a-381">3,200</span></span> |<span data-ttu-id="2ab3a-382">每秒 200 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-382">200 MB per second</span></span> |
| <span data-ttu-id="2ab3a-383">最大 IOPS + 高輸送量</span><span class="sxs-lookup"><span data-stu-id="2ab3a-383">Max IOPS + high Throughput</span></span> |<span data-ttu-id="2ab3a-384">32 KB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-384">32 KB</span></span> |<span data-ttu-id="2ab3a-385">5,000</span><span class="sxs-lookup"><span data-stu-id="2ab3a-385">5,000</span></span> |<span data-ttu-id="2ab3a-386">每秒 160 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-386">160 MB per second</span></span> |

<span data-ttu-id="2ab3a-387">若要讓 IOPS 和頻寬高於單一進階儲存體磁碟的最大值，請使用多個串接在一起的進階磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-387">To get IOPS and Bandwidth higher than the maximum value of a single premium storage disk, use multiple premium disks striped together.</span></span> <span data-ttu-id="2ab3a-388">例如，串接兩個 P30 磁碟可產生 10,000 IOPS 的結合 IOPS，或每秒 400 MB 的結合輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-388">For example, stripe two P30 disks to get a combined IOPS of 10,000 IOPS or a combined Throughput of 400 MB per second.</span></span> <span data-ttu-id="2ab3a-389">如下一節所述，您使用的 VM 大小必須支援結合的磁碟 IOPS 和輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-389">As explained in the next section, you must use a VM size that supports the combined disk IOPS and Throughput.</span></span>

> [!NOTE]
> <span data-ttu-id="2ab3a-390">因為提高 IOPS 或輸送量時，也會提高另一個因素，在提高任何一個因素時，請確保不會達到磁碟或 VM 的輸送量或 IOPS 限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-390">As you increase either IOPS or Throughput the other also increases, make sure you do not hit throughput or IOPS limits of the disk or VM when increasing either one.</span></span>
>
>

<span data-ttu-id="2ab3a-391">若要證明 IO 大小對應用程式效能的影響，您可以在 VM 和磁碟上執行效能評定工具。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-391">To witness the effects of IO size on application performance, you can run benchmarking tools on your VM and disks.</span></span> <span data-ttu-id="2ab3a-392">請建立多個測試回合，而且每個回合使用不同的 IO 大小，以查看影響。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-392">Create multiple test runs and use different IO size for each run to see the impact.</span></span> <span data-ttu-id="2ab3a-393">如需詳細資料，請參閱本文最後的 [效能評定](#Benchmarking) 一節。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-393">Refer to the [Benchmarking](#Benchmarking) section at the end of this article for more details.</span></span>

## <a name="high-scale-vm-sizes"></a><span data-ttu-id="2ab3a-394">高延展性 VM 大小</span><span class="sxs-lookup"><span data-stu-id="2ab3a-394">High Scale VM Sizes</span></span>
<span data-ttu-id="2ab3a-395">開始設計應用程式時，首要工作之一是選擇 VM 來裝載應用程式。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-395">When you start designing an application, one of the first things to do is, choose a VM to host your application.</span></span> <span data-ttu-id="2ab3a-396">進階儲存體提供高延展性 VM 大小，可以執行需要更高計算能力和較高本機磁碟 I/O 效能的應用程式。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-396">Premium Storage comes with High Scale VM sizes that can run applications requiring higher compute power and a high local disk I/O performance.</span></span> <span data-ttu-id="2ab3a-397">這些 VM 為本機磁碟提供更快的處理器、較高的記憶體與核心比率，以及固態硬碟 (SSD)。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-397">These VMs provide faster processors, a higher memory-to-core ratio, and a Solid-State Drive (SSD) for the local disk.</span></span> <span data-ttu-id="2ab3a-398">舉例來說，DS、DSv2 和 GS 系列 VM 就是支援進階儲存體的高延展性 VM。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-398">Examples of High Scale VMs supporting Premium Storage are the DS, DSv2 and GS series VMs.</span></span>

<span data-ttu-id="2ab3a-399">高延展性 VM 有各種不同大小，以及不同數目的 CPU 核心、記憶體、作業系統和暫存磁碟大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-399">High Scale VMs are available in different sizes with a different number of CPU cores, memory, OS and temporary disk size.</span></span> <span data-ttu-id="2ab3a-400">每個 VM 大小也規定您可連接至 VM 的資料磁碟數目上限。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-400">Each VM size also has maximum number of data disks that you can attach to the VM.</span></span> <span data-ttu-id="2ab3a-401">因此，選擇的 VM 大小會影響應用程式可用的處理、記憶體和儲存體容量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-401">Therefore, the chosen VM size will affect how much processing, memory, and storage capacity is available for your application.</span></span> <span data-ttu-id="2ab3a-402">也會影響計算和儲存體成本。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-402">It also affects the Compute and Storage cost.</span></span> <span data-ttu-id="2ab3a-403">例如，以下為 DS 系列、DSv2 系列和 GS 系列中最大 VM 大小的規格：</span><span class="sxs-lookup"><span data-stu-id="2ab3a-403">For example, below are the specifications of the largest VM size in a DS series, DSv2 series and a GS series:</span></span>

| <span data-ttu-id="2ab3a-404">VM 大小</span><span class="sxs-lookup"><span data-stu-id="2ab3a-404">VM size</span></span> | <span data-ttu-id="2ab3a-405">CPU 核心</span><span class="sxs-lookup"><span data-stu-id="2ab3a-405">CPU cores</span></span> | <span data-ttu-id="2ab3a-406">記憶體</span><span class="sxs-lookup"><span data-stu-id="2ab3a-406">Memory</span></span> | <span data-ttu-id="2ab3a-407">VM 磁碟大小</span><span class="sxs-lookup"><span data-stu-id="2ab3a-407">VM disk sizes</span></span> | <span data-ttu-id="2ab3a-408">最大</span><span class="sxs-lookup"><span data-stu-id="2ab3a-408">Max.</span></span> <span data-ttu-id="2ab3a-409">資料磁碟</span><span class="sxs-lookup"><span data-stu-id="2ab3a-409">data disks</span></span> | <span data-ttu-id="2ab3a-410">快取大小</span><span class="sxs-lookup"><span data-stu-id="2ab3a-410">Cache size</span></span> | <span data-ttu-id="2ab3a-411">IOPS</span><span class="sxs-lookup"><span data-stu-id="2ab3a-411">IOPS</span></span> | <span data-ttu-id="2ab3a-412">頻寬快取 IO 限制</span><span class="sxs-lookup"><span data-stu-id="2ab3a-412">Bandwidth Cache IO limits</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="2ab3a-413">Standard_DS14</span><span class="sxs-lookup"><span data-stu-id="2ab3a-413">Standard_DS14</span></span> |<span data-ttu-id="2ab3a-414">16</span><span class="sxs-lookup"><span data-stu-id="2ab3a-414">16</span></span> |<span data-ttu-id="2ab3a-415">112 GB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-415">112 GB</span></span> |<span data-ttu-id="2ab3a-416">作業系統 = 1023 GB </span><span class="sxs-lookup"><span data-stu-id="2ab3a-416">OS = 1023 GB</span></span> <br> <span data-ttu-id="2ab3a-417">本機 SSD = 224 GB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-417">Local SSD = 224 GB</span></span> |<span data-ttu-id="2ab3a-418">32</span><span class="sxs-lookup"><span data-stu-id="2ab3a-418">32</span></span> |<span data-ttu-id="2ab3a-419">576 GB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-419">576 GB</span></span> |<span data-ttu-id="2ab3a-420">50,000 IOPS </span><span class="sxs-lookup"><span data-stu-id="2ab3a-420">50,000 IOPS</span></span> <br> <span data-ttu-id="2ab3a-421">每秒 512 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-421">512 MB per second</span></span> |<span data-ttu-id="2ab3a-422">4,000 IOPS 和每秒 33 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-422">4,000 IOPS and 33 MB per second</span></span> |
| <span data-ttu-id="2ab3a-423">Standard_GS5</span><span class="sxs-lookup"><span data-stu-id="2ab3a-423">Standard_GS5</span></span> |<span data-ttu-id="2ab3a-424">32</span><span class="sxs-lookup"><span data-stu-id="2ab3a-424">32</span></span> |<span data-ttu-id="2ab3a-425">448 GB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-425">448 GB</span></span> |<span data-ttu-id="2ab3a-426">作業系統 = 1023 GB </span><span class="sxs-lookup"><span data-stu-id="2ab3a-426">OS = 1023 GB</span></span> <br> <span data-ttu-id="2ab3a-427">本機 SSD = 896 GB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-427">Local SSD = 896 GB</span></span> |<span data-ttu-id="2ab3a-428">64</span><span class="sxs-lookup"><span data-stu-id="2ab3a-428">64</span></span> |<span data-ttu-id="2ab3a-429">4224 GB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-429">4224 GB</span></span> |<span data-ttu-id="2ab3a-430">80,000 IOPS </span><span class="sxs-lookup"><span data-stu-id="2ab3a-430">80,000 IOPS</span></span> <br> <span data-ttu-id="2ab3a-431">每秒 2,000 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-431">2,000 MB per second</span></span> |<span data-ttu-id="2ab3a-432">5,000 IOPS 和每秒 50 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-432">5,000 IOPS and 50 MB per second</span></span> |

<span data-ttu-id="2ab3a-433">若要檢視所有可用的 Azure VM 大小的完整清單，請參閱 [Windows VM 大小](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)或 [Linux VM 大小](../virtual-machines/linux/sizes.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-433">To view a complete list of all available Azure VM sizes, refer to [Windows VM sizes](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Linux VM sizes](../virtual-machines/linux/sizes.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span> <span data-ttu-id="2ab3a-434">選擇可以符合並調整為期望的應用程式效能需求的 VM 大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-434">Choose a VM size that can meet and scale to your desired application performance requirements.</span></span> <span data-ttu-id="2ab3a-435">此外，選擇 VM 大小時，請將下列重要因素納入考量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-435">In addition to this, take into account following important considerations when choosing VM sizes.</span></span>

<span data-ttu-id="2ab3a-436">*調整限制*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-436">*Scale Limits*</span></span>  
<span data-ttu-id="2ab3a-437">每個 VM 和每個磁碟的最大 IOPS 限制都不同且各自獨立。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-437">The maximum IOPS limits per VM and per disk are different and independent of each other.</span></span> <span data-ttu-id="2ab3a-438">請確定應用程式在 VM 及它連接的高階磁碟的限制內推動 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-438">Make sure that the application is driving IOPS within the limits of the VM as well as the premium disks attached to it.</span></span> <span data-ttu-id="2ab3a-439">否則，應用程式效能會發生節流現象。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-439">Otherwise, application performance will experience throttling.</span></span>

<span data-ttu-id="2ab3a-440">例如，假設應用程式需求是最高 4,000 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-440">As an example, suppose an application requirement is a maximum of 4,000 IOPS.</span></span> <span data-ttu-id="2ab3a-441">為了達到此目的，您在 DS1 VM 上佈建 P30 磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-441">To achieve this, you provision a P30 disk on a DS1 VM.</span></span> <span data-ttu-id="2ab3a-442">P30 磁碟最高可以達到 5,000 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-442">The P30 disk can deliver up to 5,000 IOPS.</span></span> <span data-ttu-id="2ab3a-443">但是，DS1 VM 受限於 3,200 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-443">However, the DS1 VM is limited to 3,200 IOPS.</span></span> <span data-ttu-id="2ab3a-444">因此，應用程式效能會受到 VM 限制而降到 3,200 IOPS，效能將會降低。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-444">Consequently, the application performance will be constrained by the VM limit at 3,200 IOPS and there will be degraded performance.</span></span> <span data-ttu-id="2ab3a-445">為了避免這種情況，請選擇可同時滿足應用程式需求的 VM 和磁碟大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-445">To prevent this situation, choose a VM and disk size that will both meet application requirements.</span></span>

<span data-ttu-id="2ab3a-446">*作業成本*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-446">*Cost of Operation*</span></span>  
<span data-ttu-id="2ab3a-447">在許多情況下，使用進階儲存體的整體作業成本，可能會低於使用標準儲存體。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-447">In many cases, it is possible that your overall cost of operation using Premium Storage is lower than using Standard Storage.</span></span>

<span data-ttu-id="2ab3a-448">例如，假設應用程式需要 16,000 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-448">For example, consider an application requiring 16,000 IOPS.</span></span> <span data-ttu-id="2ab3a-449">為了達到這樣的效能，您需要使用 Standard\_D14 Azure IaaS VM，它在使用 32 個標準儲存體 1TB 磁碟時，最高可達到 16,000 的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-449">To achieve this performance, you will need a Standard\_D14 Azure IaaS VM, which can give a maximum IOPS of 16,000 using 32 standard storage 1TB disks.</span></span> <span data-ttu-id="2ab3a-450">每個 1TB 標準儲存體磁碟最高可達到 500 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-450">Each 1TB standard storage disk can achieve a maximum of 500 IOPS.</span></span> <span data-ttu-id="2ab3a-451">此 VM 的每月預估成本為 $1,570。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-451">The estimated cost of this VM per month will be $1,570.</span></span> <span data-ttu-id="2ab3a-452">32 個標準儲存體磁碟的每月成本為 $1,638。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-452">The monthly cost of 32 standard storage disks will be $1,638.</span></span> <span data-ttu-id="2ab3a-453">預估每月總成本為 $3,208。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-453">The estimated total monthly cost will be $3,208.</span></span>

<span data-ttu-id="2ab3a-454">不過，如果將相同的應用程式裝載於進階儲存體，則只需要較小的 VM 大小和較少的進階儲存體磁碟，因此可降低整體成本。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-454">However, if you hosted the same application on Premium Storage, you will need a smaller VM size and fewer premium storage disks, thus reducing the overall cost.</span></span> <span data-ttu-id="2ab3a-455">Standard\_DS13 VM 可以使用四個 P30 磁碟來滿足 16,000 IOPS 需求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-455">A Standard\_DS13 VM can meet the 16,000 IOPS requirement using four P30 disks.</span></span> <span data-ttu-id="2ab3a-456">DS13 VM 的最大 IOPS 為 25,600，每個 P30 磁碟的最高 IOPS 為 5,000。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-456">The DS13 VM has a maximum IOPS of 25,600 and each P30 disk has a maximum IOPS of 5,000.</span></span> <span data-ttu-id="2ab3a-457">整體來說，這項設定可以達到 5,000 x 4 = 20,000 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-457">Overall, this configuration can achieve 5,000 x 4 = 20,000 IOPS.</span></span> <span data-ttu-id="2ab3a-458">此 VM 的每月預估成本為 $1,003。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-458">The estimated cost of this VM per month will be $1,003.</span></span> <span data-ttu-id="2ab3a-459">四個 P30 進階儲存體磁碟的每月成本為 $544.34。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-459">The monthly cost of four P30 premium storage disks will be $544.34.</span></span> <span data-ttu-id="2ab3a-460">預估每月總成本為 $1,544。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-460">The estimated total monthly cost will be $1,544.</span></span>

<span data-ttu-id="2ab3a-461">下表以標準和進階儲存體來摘要說明此案例的成本明細。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-461">Table below summarizes the cost breakdown of this scenario for Standard and Premium Storage.</span></span>

| &nbsp; | <span data-ttu-id="2ab3a-462">**標準**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-462">**Standard**</span></span> | <span data-ttu-id="2ab3a-463">**高級**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-463">**Premium**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="2ab3a-464">**每月的 VM 成本**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-464">**Cost of VM per month**</span></span> |<span data-ttu-id="2ab3a-465">$1,570.58 (Standard\_D14)</span><span class="sxs-lookup"><span data-stu-id="2ab3a-465">$1,570.58 (Standard\_D14)</span></span> |<span data-ttu-id="2ab3a-466">$1,003.66 (Standard\_DS13)</span><span class="sxs-lookup"><span data-stu-id="2ab3a-466">$1,003.66 (Standard\_DS13)</span></span> |
| <span data-ttu-id="2ab3a-467">**每月的磁碟成本**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-467">**Cost of Disks per month**</span></span> |<span data-ttu-id="2ab3a-468">$1,638.40 (32 x 1 TB 磁碟)</span><span class="sxs-lookup"><span data-stu-id="2ab3a-468">$1,638.40 (32 x 1 TB disks)</span></span> |<span data-ttu-id="2ab3a-469">$544.34 (4 x P30 磁碟)</span><span class="sxs-lookup"><span data-stu-id="2ab3a-469">$544.34 (4 x P30 disks)</span></span> |
| <span data-ttu-id="2ab3a-470">**每月的整體成本**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-470">**Overall Cost per month**</span></span> |<span data-ttu-id="2ab3a-471">$3,208.98</span><span class="sxs-lookup"><span data-stu-id="2ab3a-471">$3,208.98</span></span> |<span data-ttu-id="2ab3a-472">$1,544.34</span><span class="sxs-lookup"><span data-stu-id="2ab3a-472">$1,544.34</span></span> |

<span data-ttu-id="2ab3a-473">*Linux 散發版本*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-473">*Linux Distros*</span></span>  

<span data-ttu-id="2ab3a-474">Azure 進階儲存體可讓執行 Windows 和 Linux 的 VM 達到相同層級的效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-474">With Azure Premium Storage, you get the same level of Performance for VMs running Windows and Linux.</span></span> <span data-ttu-id="2ab3a-475">我們支援許多種 Linux 散發版本，您可以在 [這裡](../virtual-machines/linux/endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)看到完整清單。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-475">We support many flavors of Linux distros, and you can see the complete list [here](../virtual-machines/linux/endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span> <span data-ttu-id="2ab3a-476">務必注意，針對不同類型的工作負載，不同的散發版本會更適合。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-476">It is important to note that different distros are better suited for different types of workloads.</span></span> <span data-ttu-id="2ab3a-477">根據執行工作負載的散發版本而定，您會看到不同層級的效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-477">You will see different levels of performance depending on the distro your workload is running on.</span></span> <span data-ttu-id="2ab3a-478">請以您的應用程式來測試 Linux 散發版本，選擇最適合的散發版本。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-478">Test the Linux distros with your application and choose the one that works best.</span></span>

<span data-ttu-id="2ab3a-479">搭配進階儲存體執行 Linux 時，請檢查所需驅動程式的最新更新，以確保達到較高效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-479">When running Linux with Premium Storage, check the latest updates about required drivers to ensure high performance.</span></span>

## <a name="premium-storage-disk-sizes"></a><span data-ttu-id="2ab3a-480">進階儲存體磁碟大小</span><span class="sxs-lookup"><span data-stu-id="2ab3a-480">Premium Storage Disk Sizes</span></span>
<span data-ttu-id="2ab3a-481">Azure 進階儲存體目前提供七種磁碟大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-481">Azure Premium Storage offers seven disk sizes currently.</span></span> <span data-ttu-id="2ab3a-482">對於 IOPS、頻寬和儲存體，每個磁碟大小各有不同的調整限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-482">Each disk size has a different scale limit for IOPS, Bandwidth and Storage.</span></span> <span data-ttu-id="2ab3a-483">請根據應用程式需求和高延展性 VM 大小，選擇正確的進階儲存體磁碟大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-483">Choose the right Premium Storage Disk size depending on the application requirements and the high scale VM size.</span></span> <span data-ttu-id="2ab3a-484">下表顯示七種磁碟大小及其功能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-484">The table below shows the seven disks sizes and their capabilities.</span></span> <span data-ttu-id="2ab3a-485">受控磁碟目前僅支援 P4 和 P6 大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-485">P4 and P6 sizes are currently only supported for Managed Disks.</span></span>

| <span data-ttu-id="2ab3a-486">進階磁碟類型</span><span class="sxs-lookup"><span data-stu-id="2ab3a-486">Premium Disks Type</span></span>  | <span data-ttu-id="2ab3a-487">P4</span><span class="sxs-lookup"><span data-stu-id="2ab3a-487">P4</span></span>    | <span data-ttu-id="2ab3a-488">P6</span><span class="sxs-lookup"><span data-stu-id="2ab3a-488">P6</span></span>    | <span data-ttu-id="2ab3a-489">P10</span><span class="sxs-lookup"><span data-stu-id="2ab3a-489">P10</span></span>   | <span data-ttu-id="2ab3a-490">P20</span><span class="sxs-lookup"><span data-stu-id="2ab3a-490">P20</span></span>   | <span data-ttu-id="2ab3a-491">P30</span><span class="sxs-lookup"><span data-stu-id="2ab3a-491">P30</span></span>   | <span data-ttu-id="2ab3a-492">P40</span><span class="sxs-lookup"><span data-stu-id="2ab3a-492">P40</span></span>   | <span data-ttu-id="2ab3a-493">P50</span><span class="sxs-lookup"><span data-stu-id="2ab3a-493">P50</span></span>   | 
|---------------------|-------|-------|-------|-------|-------|-------|-------|
| <span data-ttu-id="2ab3a-494">磁碟大小</span><span class="sxs-lookup"><span data-stu-id="2ab3a-494">Disk size</span></span>           | <span data-ttu-id="2ab3a-495">32 GB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-495">32 GB</span></span> | <span data-ttu-id="2ab3a-496">64 GB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-496">64 GB</span></span> | <span data-ttu-id="2ab3a-497">128 GB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-497">128 GB</span></span>| <span data-ttu-id="2ab3a-498">512 GB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-498">512 GB</span></span>            | <span data-ttu-id="2ab3a-499">1024 GB (1 TB)</span><span class="sxs-lookup"><span data-stu-id="2ab3a-499">1024 GB (1 TB)</span></span>    | <span data-ttu-id="2ab3a-500">2048 GB (2 TB)</span><span class="sxs-lookup"><span data-stu-id="2ab3a-500">2048 GB (2 TB)</span></span>    | <span data-ttu-id="2ab3a-501">4095 GB (4 TB)</span><span class="sxs-lookup"><span data-stu-id="2ab3a-501">4095 GB (4 TB)</span></span>    | 
| <span data-ttu-id="2ab3a-502">每一磁碟的 IOPS</span><span class="sxs-lookup"><span data-stu-id="2ab3a-502">IOPS per disk</span></span>       | <span data-ttu-id="2ab3a-503">120</span><span class="sxs-lookup"><span data-stu-id="2ab3a-503">120</span></span>   | <span data-ttu-id="2ab3a-504">240</span><span class="sxs-lookup"><span data-stu-id="2ab3a-504">240</span></span>   | <span data-ttu-id="2ab3a-505">500</span><span class="sxs-lookup"><span data-stu-id="2ab3a-505">500</span></span>   | <span data-ttu-id="2ab3a-506">2300</span><span class="sxs-lookup"><span data-stu-id="2ab3a-506">2300</span></span>              | <span data-ttu-id="2ab3a-507">5000</span><span class="sxs-lookup"><span data-stu-id="2ab3a-507">5000</span></span>              | <span data-ttu-id="2ab3a-508">7500</span><span class="sxs-lookup"><span data-stu-id="2ab3a-508">7500</span></span>              | <span data-ttu-id="2ab3a-509">7500</span><span class="sxs-lookup"><span data-stu-id="2ab3a-509">7500</span></span>              | 
| <span data-ttu-id="2ab3a-510">每一磁碟的輸送量</span><span class="sxs-lookup"><span data-stu-id="2ab3a-510">Throughput per disk</span></span> | <span data-ttu-id="2ab3a-511">每秒 25 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-511">25 MB per second</span></span>  | <span data-ttu-id="2ab3a-512">每秒 50 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-512">50 MB per second</span></span>  | <span data-ttu-id="2ab3a-513">每秒 100 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-513">100 MB per second</span></span> | <span data-ttu-id="2ab3a-514">每秒 150 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-514">150 MB per second</span></span> | <span data-ttu-id="2ab3a-515">每秒 200 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-515">200 MB per second</span></span> | <span data-ttu-id="2ab3a-516">每秒 250 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-516">250 MB per second</span></span> | <span data-ttu-id="2ab3a-517">每秒 250 MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-517">250 MB per second</span></span> | 


<span data-ttu-id="2ab3a-518">您選擇的磁碟數量取決於已選擇的磁碟大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-518">How many disks you choose depends on the disk size chosen.</span></span> <span data-ttu-id="2ab3a-519">您可以使用單一 P50 磁碟或多個 P10 磁碟來滿足應用程式需求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-519">You could use a single P50 disk or multiple P10 disks to meet your application requirement.</span></span> <span data-ttu-id="2ab3a-520">做決定時，請將下列因素納入考量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-520">Take into account considerations listed below when making the choice.</span></span>

<span data-ttu-id="2ab3a-521">*調整限制 (IOPS 和輸送量)*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-521">*Scale Limits (IOPS and Throughput)*</span></span>  
<span data-ttu-id="2ab3a-522">每個高階磁碟大小的 IOPS 和輸送量限制不同，且無關於 VM 調整限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-522">The IOPS and Throughput limits of each Premium disk size is different and independent from the VM scale limits.</span></span> <span data-ttu-id="2ab3a-523">請確定磁碟的 IOPS 和輸送量合計，不超過所選擇的 VM 大小的調整限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-523">Make sure that the total IOPS and Throughput from the disks are within scale limits of the chosen VM size.</span></span>

<span data-ttu-id="2ab3a-524">例如，如果應用程式需求是輸送量上限 250 MB/秒，而且您使用 DS4 VM 搭配單一 P30 磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-524">For example, if an application requirement is a maximum of 250 MB/sec Throughput and you are using a DS4 VM with a single P30 disk.</span></span> <span data-ttu-id="2ab3a-525">DS4 VM 最高可以達到 256 MB/秒的輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-525">The DS4 VM can give up to 256 MB/sec Throughput.</span></span> <span data-ttu-id="2ab3a-526">不過，單一 P30 磁碟的輸送量限制為 200 MB/秒。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-526">However, a single P30 disk has Throughput limit of 200 MB/sec.</span></span> <span data-ttu-id="2ab3a-527">因此，由於磁碟的限制，應用程式會受限於 200 MB/秒。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-527">Consequently, the application will be constrained at 200 MB/sec due to the disk limit.</span></span> <span data-ttu-id="2ab3a-528">為了克服這項限制，請將一個以上的資料磁碟佈建到 VM，或將您的磁碟大小調整為 P40 或 P50。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-528">To overcome this limit, provision more than one data disks to the VM or resize your disks to P40 or P50.</span></span>

> [!NOTE]
> <span data-ttu-id="2ab3a-529">由快取所服務的讀取不計入磁碟 IOPS 和輸送量內，因此不受磁碟限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-529">Reads served by the cache are not included in the disk IOPS and Throughput, hence not subject to disk limits.</span></span> <span data-ttu-id="2ab3a-530">對於每個 VM，快取有其個別的 IOPS 和輸送量限制。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-530">Cache has its separate IOPS and Throughput limit per VM.</span></span>
>
> <span data-ttu-id="2ab3a-531">例如，剛開始時，讀取和寫入分別為 60 MB/秒和 40 MB/秒。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-531">For example, initially your reads and writes are 60MB/sec and 40MB/sec respectively.</span></span> <span data-ttu-id="2ab3a-532">經過一段時間，快取已活絡，可服務越來越多的讀取。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-532">Over time, the cache warms up and serves more and more of the reads from the cache.</span></span> <span data-ttu-id="2ab3a-533">於是，來自磁碟的寫入輸送量就更高。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-533">Then, you can get higher write Throughput from the disk.</span></span>
>
>

<span data-ttu-id="2ab3a-534">*磁碟數量*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-534">*Number of Disks*</span></span>  
<span data-ttu-id="2ab3a-535">評估應用程式需求，判斷您需要的磁碟數目。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-535">Determine the number of disks you will need by assessing application requirements.</span></span> <span data-ttu-id="2ab3a-536">每個 VM 大小也會限制您可連接至 VM 的磁碟數目。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-536">Each VM size also has a limit on the number of disks that you can attach to the VM.</span></span> <span data-ttu-id="2ab3a-537">這通常是核心數目的兩倍。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-537">Typically, this is twice the number of cores.</span></span> <span data-ttu-id="2ab3a-538">請確定您選擇的 VM 大小可以支援所需的磁碟數目。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-538">Ensure that the VM size you choose can support the number of disks needed.</span></span>

<span data-ttu-id="2ab3a-539">請記住，相較於標準儲存體磁碟，進階儲存體磁碟有較高效能的功能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-539">Remember, the Premium Storage disks have higher performance capabilities compared to Standard Storage disks.</span></span> <span data-ttu-id="2ab3a-540">因此，如果您將應用程式從使用標準儲存體的 Azure IaaS VM 移轉至進階儲存體，可能只需要較少的高階磁碟，應用程式就能達到相同或更高的效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-540">Therefore, if you are migrating your application from Azure IaaS VM using Standard Storage to Premium Storage, you will likely need fewer premium disks to achieve the same or higher performance for your application.</span></span>

## <a name="disk-caching"></a><span data-ttu-id="2ab3a-541">磁碟快取</span><span class="sxs-lookup"><span data-stu-id="2ab3a-541">Disk Caching</span></span>
<span data-ttu-id="2ab3a-542">採用 Azure 進階儲存體的高延展性 VM 有一項稱為 BlobCache 的多層快取技術。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-542">High Scale VMs that leverage Azure Premium Storage have a multi-tier caching technology called BlobCache.</span></span> <span data-ttu-id="2ab3a-543">BlobCache 結合虛擬機器 RAM 和本機 SSD 進行快取。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-543">BlobCache uses a combination of the Virtual Machine RAM and local SSD for caching.</span></span> <span data-ttu-id="2ab3a-544">此快取適用於進階儲存體永續性磁碟和 VM 本機磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-544">This cache is available for the Premium Storage persistent disks and the VM local disks.</span></span> <span data-ttu-id="2ab3a-545">根據預設，針對作業系統磁碟，此快取設定會設為讀取/寫入，而針對裝載於進階儲存體的資料磁碟，則設為唯讀。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-545">By default, this cache setting is set to Read/Write for OS disks and ReadOnly for data disks hosted on Premium Storage.</span></span> <span data-ttu-id="2ab3a-546">在進階儲存體上啟用磁碟快取時，高延展性 VM 可以達到極高的效能層級，超過基礎磁碟效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-546">With disk caching enabled on the Premium Storage disks, the high scale VMs can achieve extremely high levels of performance that exceed the underlying disk performance.</span></span>

> [!WARNING]
> <span data-ttu-id="2ab3a-547">變更 Azure 磁碟的快取設定會將目標磁碟中斷連接再重新連接。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-547">Changing the cache setting of an Azure disk detaches and re-attaches the target disk.</span></span> <span data-ttu-id="2ab3a-548">如果它是作業系統磁碟，則會重新啟動 VM。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-548">If it is the operating system disk, the VM is restarted.</span></span> <span data-ttu-id="2ab3a-549">在變更磁碟快取設定之前，請先將可能受此中斷情況影響的所有應用程式/服務停止。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-549">Stop all applications/services that might be affected by this disruption before changing the disk cache setting.</span></span>
>
>

<span data-ttu-id="2ab3a-550">若要深入了解 BlobCache 的運作方式，請參閱 [深入 Azure 進階儲存體](https://azure.microsoft.com/blog/azure-premium-storage-now-generally-available-2/) 部落格文章。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-550">To learn more about how BlobCache works, refer to the Inside [Azure Premium Storage](https://azure.microsoft.com/blog/azure-premium-storage-now-generally-available-2/) blog post.</span></span>

<span data-ttu-id="2ab3a-551">務必在正確的一組磁碟上啟用快取。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-551">It is important to enable cache on the right set of disks.</span></span> <span data-ttu-id="2ab3a-552">高階磁碟上是否應該啟用磁碟快取，取決於磁碟將處理的工作負載模式。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-552">Whether you should enable disk caching on a premium disk or not will depend on the workload pattern that disk will be handling.</span></span> <span data-ttu-id="2ab3a-553">下表顯示作業系統磁碟和資料磁碟的預設快取設定。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-553">Table below shows the default cache settings for OS and Data disks.</span></span>

| <span data-ttu-id="2ab3a-554">**磁碟類型**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-554">**Disk Type**</span></span> | <span data-ttu-id="2ab3a-555">**預設快取設定**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-555">**Default Cache Setting**</span></span> |
| --- | --- |
| <span data-ttu-id="2ab3a-556">作業系統磁碟</span><span class="sxs-lookup"><span data-stu-id="2ab3a-556">OS disk</span></span> |<span data-ttu-id="2ab3a-557">讀寫</span><span class="sxs-lookup"><span data-stu-id="2ab3a-557">ReadWrite</span></span> |
| <span data-ttu-id="2ab3a-558">資料磁碟</span><span class="sxs-lookup"><span data-stu-id="2ab3a-558">Data disk</span></span> |<span data-ttu-id="2ab3a-559">None</span><span class="sxs-lookup"><span data-stu-id="2ab3a-559">None</span></span> |

<span data-ttu-id="2ab3a-560">以下是針對資料磁碟建議的磁碟快取設定，</span><span class="sxs-lookup"><span data-stu-id="2ab3a-560">Following are the recommended disk cache settings for data disks,</span></span>

| <span data-ttu-id="2ab3a-561">**磁碟快取設定**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-561">**Disk Caching Setting**</span></span> | <span data-ttu-id="2ab3a-562">**使用這項設定的建議時機**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-562">**Recommendation on when to use this setting**</span></span> |
| --- | --- |
| <span data-ttu-id="2ab3a-563">None</span><span class="sxs-lookup"><span data-stu-id="2ab3a-563">None</span></span> |<span data-ttu-id="2ab3a-564">針對唯寫和大量寫入的磁碟，將主機快取設定為「無」。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-564">Configure host-cache as None for write-only and write-heavy disks.</span></span> |
| <span data-ttu-id="2ab3a-565">唯讀</span><span class="sxs-lookup"><span data-stu-id="2ab3a-565">ReadOnly</span></span> |<span data-ttu-id="2ab3a-566">針對唯讀和讀寫的磁碟，將主機快取設定為「唯讀」。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-566">Configure host-cache as ReadOnly for read-only and read-write disks.</span></span> |
| <span data-ttu-id="2ab3a-567">讀寫</span><span class="sxs-lookup"><span data-stu-id="2ab3a-567">ReadWrite</span></span> |<span data-ttu-id="2ab3a-568">只有當應用程式在必要時可適當地將快取的資料寫入永續性磁碟時，才將主機快取設定為「讀寫」。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-568">Configure host-cache as ReadWrite only if your application properly  handles writing cached data to persistent disks when needed.</span></span> |

<span data-ttu-id="2ab3a-569">*唯讀*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-569">*ReadOnly*</span></span>  
<span data-ttu-id="2ab3a-570">您可以在進階儲存體資料磁碟上設定「唯讀」快取，讓應用程式達到較低的讀取延遲，以及非常高的讀取 IOPS 和輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-570">By configuring ReadOnly caching on Premium Storage data disks, you can achieve low Read latency and get very high Read IOPS and Throughput for your application.</span></span> <span data-ttu-id="2ab3a-571">這是基於兩個理由，</span><span class="sxs-lookup"><span data-stu-id="2ab3a-571">This is due two reasons,</span></span>

1. <span data-ttu-id="2ab3a-572">從快取執行的讀取 (在 VM 記憶體和本機 SSD 上)，速度遠快於從資料磁碟讀取 (在 Azure Blob 儲存體上)。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-572">Reads performed from cache, which is on the VM memory and local SSD, are much faster than reads from the data disk, which is on the Azure blob storage.</span></span>  
2. <span data-ttu-id="2ab3a-573">進階儲存體不會將快取所服務的讀取計入磁碟 IOPS 和輸送量之內。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-573">Premium Storage does not count the Reads served from cache, towards the disk IOPS and Throughput.</span></span> <span data-ttu-id="2ab3a-574">因此，應用程式能夠達到較高的 IOPS 和輸送量總計。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-574">Therefore, your application is able to achieve higher total IOPS and Throughput.</span></span>

<span data-ttu-id="2ab3a-575">*讀寫*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-575">*ReadWrite*</span></span>  
<span data-ttu-id="2ab3a-576">根據預設，作業系統磁碟會啟用「讀寫」快取。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-576">By default, the OS disks have ReadWrite caching enabled.</span></span> <span data-ttu-id="2ab3a-577">我們最近也已在資料磁碟上增加支援「讀寫」快取。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-577">We have recently added support for ReadWrite caching on data disks as well.</span></span> <span data-ttu-id="2ab3a-578">如果您使用「讀寫」快取，您必須有適當的方法將快取中的資料寫入永續性磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-578">If you are using ReadWrite caching, you must have a proper way to write the data from cache to persistent disks.</span></span> <span data-ttu-id="2ab3a-579">例如，SQL Server 會自行負責將快取的資料寫入永續性儲存體磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-579">For example, SQL Server handles writing cached data to the persistent storage disks on its own.</span></span> <span data-ttu-id="2ab3a-580">對於不負責保存必要資料的應用程式，如果使用「讀寫」快取，一旦 VM 損毀，可能會導致資料遺失。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-580">Using ReadWrite cache with an application that does not handle persisting the required data can lead to data loss, if the VM crashes.</span></span>

<span data-ttu-id="2ab3a-581">舉例來說，您可以執行下列動作，將這些指導方針運用在進階儲存體上執行的 SQL Server，</span><span class="sxs-lookup"><span data-stu-id="2ab3a-581">As an example, you can apply these guidelines to SQL Server running on Premium Storage by doing the following,</span></span>

1. <span data-ttu-id="2ab3a-582">在裝載資料檔的進階儲存體磁碟上設定「唯讀」快取。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-582">Configure "ReadOnly" cache on premium storage disks hosting data files.</span></span>  
   <span data-ttu-id="2ab3a-583">a.</span><span class="sxs-lookup"><span data-stu-id="2ab3a-583">a.</span></span>  <span data-ttu-id="2ab3a-584">從快取中快速讀取可縮短 SQL Server 查詢時間，因為從快取擷取資料頁，速度遠快於直接從資料磁碟擷取。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-584">The fast reads from cache lower the SQL Server query time since data pages are retrieved much faster from the cache compared to directly from the data disks.</span></span>  
   <span data-ttu-id="2ab3a-585">b.</span><span class="sxs-lookup"><span data-stu-id="2ab3a-585">b.</span></span>  <span data-ttu-id="2ab3a-586">由快取來服務讀取，表示高階資料磁碟會有額外的輸送量可用。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-586">Serving reads from cache, means there is additional Throughput available from premium data disks.</span></span> <span data-ttu-id="2ab3a-587">SQL Server 可以使用這個額外的輸送量來擷取更多資料頁和執行其他作業，例如備份/還原、批次載入和索引重建。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-587">SQL Server can use this additional Throughput towards retrieving more data pages and other operations like backup/restore, batch loads, and index rebuilds.</span></span>  
2. <span data-ttu-id="2ab3a-588">在裝載記錄檔的進階儲存體磁碟上設定「無」快取。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-588">Configure "None" cache on premium storage disks hosting the log files.</span></span>  
   <span data-ttu-id="2ab3a-589">a.</span><span class="sxs-lookup"><span data-stu-id="2ab3a-589">a.</span></span>  <span data-ttu-id="2ab3a-590">記錄檔以大量寫入的作業為主。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-590">Log files have primarily write-heavy operations.</span></span> <span data-ttu-id="2ab3a-591">因此，無法從「唯讀」快取中受惠。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-591">Therefore, they do not benefit from the ReadOnly cache.</span></span>

## <a name="disk-striping"></a><span data-ttu-id="2ab3a-592">磁碟串接</span><span class="sxs-lookup"><span data-stu-id="2ab3a-592">Disk Striping</span></span>
<span data-ttu-id="2ab3a-593">當高延展性 VM 連接數個進階儲存體永續性磁碟時，磁碟可以串接在一起，以彙總其 IOPS、頻寬和儲存體容量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-593">When a high scale VM is attached with several premium storage persistent disks, the disks can be striped together to aggregate their IOPs, bandwidth, and storage capacity.</span></span>

<span data-ttu-id="2ab3a-594">在 Windows 中，您可以使用「儲存空間」將磁碟串接在一起。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-594">On Windows, you can use Storage Spaces to stripe disks together.</span></span> <span data-ttu-id="2ab3a-595">您必須為集區中的每個磁碟設定一欄。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-595">You must configure one column for each disk in a pool.</span></span> <span data-ttu-id="2ab3a-596">否則，由於磁碟之間的流量分配不平均，等量磁碟區的整體效能可能會低於預期。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-596">Otherwise, the overall performance of striped volume can be lower than expected, due to uneven distribution of traffic across the disks.</span></span>

<span data-ttu-id="2ab3a-597">重要事項：您可以使用伺服器管理員 UI，將一個等量磁碟區的總欄數最多設定為 8 個。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-597">Important: Using Server Manager UI, you can set the total number of columns up to 8 for a striped volume.</span></span> <span data-ttu-id="2ab3a-598">當連接 8 個以上的磁碟時，請使用 PowerShell 來建立磁碟區。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-598">When attaching more than 8 disks, use PowerShell to create the volume.</span></span> <span data-ttu-id="2ab3a-599">您可以使用 PowerShell 將欄數設定為等於磁碟數量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-599">Using PowerShell, you can set the number of columns equal to the number of disks.</span></span> <span data-ttu-id="2ab3a-600">例如，如果單一等量磁碟區中有 16 個磁碟，請在 *New-VirtualDisk* PowerShell Cmdlet 的 *NumberOfColumns* 參數中指定 16 欄。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-600">For example, if there are 16 disks in a single stripe set; specify 16 columns in the *NumberOfColumns* parameter of the *New-VirtualDisk* PowerShell cmdlet.</span></span>

<span data-ttu-id="2ab3a-601">在 Linux 上，請使用 MDADM 公用程式將磁碟串接在一起。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-601">On Linux, use the MDADM utility to stripe disks together.</span></span> <span data-ttu-id="2ab3a-602">如需有關在 Linux 上等量分割磁碟的詳細步驟，請參閱 [在 Linux 上設定軟體 RAID](../virtual-machines/linux/configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-602">For detailed steps on striping disks on Linux refer to [Configure Software RAID on Linux](../virtual-machines/linux/configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>

<span data-ttu-id="2ab3a-603">*等量大小*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-603">*Stripe Size*</span></span>  
<span data-ttu-id="2ab3a-604">磁碟串接時一項重要設定是等量大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-604">An important configuration in disk striping is the stripe size.</span></span> <span data-ttu-id="2ab3a-605">等量大小或區塊大小是指應用程式在等量磁碟區上可定址的最小資料區塊。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-605">The stripe size or block size is the smallest chunk of data that application can address on a striped volume.</span></span> <span data-ttu-id="2ab3a-606">您設定的等量大小取決於應用程式的類型及其要求模式。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-606">The stripe size you configure depends on the type of application and its request pattern.</span></span> <span data-ttu-id="2ab3a-607">如果您選擇錯誤的等量大小，可能會導致 IO 對齊錯錯，進而導致應用程式的效能降低。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-607">If you choose the wrong stripe size, it could lead to IO misalignment, which leads to degraded performance of your application.</span></span>

<span data-ttu-id="2ab3a-608">比方說，如果應用程式所產生的 IO 要求大於磁碟等量大小，儲存體系統會跨越等量單位界限，將此要求寫入多個磁碟上。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-608">For example, if an IO request generated by your application is bigger than the disk stripe size, the storage system writes it across stripe unit boundaries on more than one disk.</span></span> <span data-ttu-id="2ab3a-609">在需要存取該資料時，必須跨越一個以上的等量單位來搜尋，才能完成要求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-609">When it is time to access that data, it will have to seek across more than one stripe units to complete the request.</span></span> <span data-ttu-id="2ab3a-610">這種行為的累積效果可能會導致效能大幅降低。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-610">The cumulative effect of such behavior can lead to substantial performance degradation.</span></span> <span data-ttu-id="2ab3a-611">相反地，如果 IO 要求大小比等量大小更小，而且是隨機性質，IO 要求可能聚集在相同的磁碟上而造成瓶頸，最終導致 IO 效能降低。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-611">On the other hand, if the IO request size is smaller than stripe size, and if it is random in nature, the IO requests may add up on the same disk causing a bottleneck and ultimately degrading the IO performance.</span></span>

<span data-ttu-id="2ab3a-612">請根據應用程式執行的工作負載類型，選擇適當的等量大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-612">Depending on the type of workload your application is running, choose an appropriate stripe size.</span></span> <span data-ttu-id="2ab3a-613">對於隨機小型 IO 要求，請使用較小的等量大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-613">For random small IO requests, use a smaller stripe size.</span></span> <span data-ttu-id="2ab3a-614">對於大型循序 IO 要求，請使用較大的等量大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-614">Whereas, for large sequential IO requests use a larger stripe size.</span></span> <span data-ttu-id="2ab3a-615">針對您要在進階儲存體上執行的應用程式，請參考等量大小建議。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-615">Find out the stripe size recommendations for the application you will be running on Premium Storage.</span></span> <span data-ttu-id="2ab3a-616">對於 SQL Server 而言，請將 OLTP 工作負載的等量大小設定為 64KB，而資料倉儲工作負載則設定為 256KB。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-616">For SQL Server, configure stripe size of 64KB for OLTP workloads and 256KB for data warehousing workloads.</span></span> <span data-ttu-id="2ab3a-617">若要深入了解，請參閱 [Azure 虛擬機器中的 SQL Server 效能最佳作法](../virtual-machines/windows/sql/virtual-machines-windows-sql-performance.md#disks-guidance) 。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-617">See [Performance best practices for SQL Server on Azure VMs](../virtual-machines/windows/sql/virtual-machines-windows-sql-performance.md#disks-guidance) to learn more.</span></span>

> [!NOTE]
> <span data-ttu-id="2ab3a-618">在 DS 系列 VM 上，最多可以串接 32 個進階儲存體磁碟，而在 GS 系列 VM 上，最多可以串接 64 個進階儲存體磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-618">You can stripe together a maximum of 32 premium storage disks on a DS series VM and 64 premium storage disks on a GS series VM.</span></span>
>
>

## <a name="multi-threading"></a><span data-ttu-id="2ab3a-619">多執行緒處理</span><span class="sxs-lookup"><span data-stu-id="2ab3a-619">Multi-threading</span></span>
<span data-ttu-id="2ab3a-620">Azure 已將進階儲存體平台設計為大規模平行。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-620">Azure has designed Premium Storage platform to be massively parallel.</span></span> <span data-ttu-id="2ab3a-621">因此，多執行緒應用程式可達到的效能遠高於單一執行緒應用程式。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-621">Therefore, a multi-threaded application achieves much higher performance than a single-threaded application.</span></span> <span data-ttu-id="2ab3a-622">多執行緒應用程式會將工作分割成多個執行緒，並竭盡所能利用 VM 和磁碟資源，以提高執行效率。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-622">A multi-threaded application splits up its tasks across multiple threads and increases efficiency of its execution by utilizing the VM and disk resources to the maximum.</span></span>

<span data-ttu-id="2ab3a-623">例如，如果應用程式在單一核心 VM 上使用兩個執行緒執行，CPU 可以在兩個執行緒之間切換以提高效率。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-623">For example, if your application is running on a single core VM using two threads, the CPU can switch between the two threads to achieve efficiency.</span></span> <span data-ttu-id="2ab3a-624">當一個執行緒正在等候磁碟 IO 完成時，CPU 可以切換到另一個執行緒。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-624">While one thread is waiting on a disk IO to complete, the CPU can switch to the other thread.</span></span> <span data-ttu-id="2ab3a-625">如此一來，兩個執行緒可以完成比單一執行緒更多的工作。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-625">In this way, two threads can accomplish more than a single thread would.</span></span> <span data-ttu-id="2ab3a-626">如果 VM 有一個以上的核心，則可進一步縮短執行時間，因為每個核心可以平行地執行工作。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-626">If the VM has more than one core, it further decreases running time since each core can execute tasks in parallel.</span></span>

<span data-ttu-id="2ab3a-627">您可能無法變更現成應用程式實作單一執行緒或多執行緒的方式。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-627">You may not be able to change the way an off-the-shelf application implements single threading or multi-threading.</span></span> <span data-ttu-id="2ab3a-628">例如，SQL Server 能夠處理多 CPU 與多核心。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-628">For example, SQL Server is capable of handling multi-CPU and multi-core.</span></span> <span data-ttu-id="2ab3a-629">不過，SQL Server 會決定在哪些情況下利用一或多個執行緒來處理查詢。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-629">However, SQL Server decides under what conditions it will leverage one or more threads to process a query.</span></span> <span data-ttu-id="2ab3a-630">它可以使用多執行緒來執行查詢和建立索引。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-630">It can run queries and build indexes using multi-threading.</span></span> <span data-ttu-id="2ab3a-631">如果查詢需要聯結大型資料表，而且將資料傳回給使用者之前需要排序資料，SQL Server 可能會使用多個執行緒。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-631">For a query that involves joining large tables and sorting data before returning to the user, SQL Server will likely use multiple threads.</span></span> <span data-ttu-id="2ab3a-632">但是，使用者無法控制 SQL Server 使用單一執行緒或多個執行緒來執行查詢。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-632">However, a user cannot control whether SQL Server executes a query using a single thread or multiple threads.</span></span>

<span data-ttu-id="2ab3a-633">您可以變更組態設定，以影響應用程式的這種多執行緒或平行處理方式。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-633">There are configuration settings that you can alter to influence this multi-threading or parallel processing of an application.</span></span> <span data-ttu-id="2ab3a-634">例如，以 SQL Server 而言，這就是「平行處理原則的最大程度」組態。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-634">For example, in case of SQL Server it is the maximum Degree of Parallelism configuration.</span></span> <span data-ttu-id="2ab3a-635">這項設定稱為 MAXDOP，可讓您設定 SQL Server 在平行處理時可使用的處理器數目上限。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-635">This setting called MAXDOP, allows you to configure the maximum number of processors SQL Server can use when parallel processing.</span></span> <span data-ttu-id="2ab3a-636">您可以為個別的查詢或索引作業設定 MAXDOP。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-636">You can configure MAXDOP for individual queries or index operations.</span></span> <span data-ttu-id="2ab3a-637">針對重視效能的應用程式，這有益於平衡系統的資源。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-637">This is beneficial when you want to balance resources of your system for a performance critical application.</span></span>

<span data-ttu-id="2ab3a-638">例如，假設使用 SQL Server 的應用程式正在同時執行大型查詢和索引作業。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-638">For example, say your application using SQL Server is executing a large query and an index operation at the same time.</span></span> <span data-ttu-id="2ab3a-639">假設您希望索引作業的效能高於大型查詢。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-639">Let us assume that you wanted the index operation to be more performant compared to the large query.</span></span> <span data-ttu-id="2ab3a-640">在這種情況下，您可以將索引作業的 MAXDOP 值設為高於查詢的 MAXDOP 值。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-640">In such a case, you can set MAXDOP value of the index operation to be higher than the MAXDOP value for the query.</span></span> <span data-ttu-id="2ab3a-641">如此一來，可供 SQL Server 利用來執行索引作業的處理器數目，就比專用於大型查詢的處理器數目更多。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-641">This way, SQL Server has more number of processors that it can leverage for the index operation compared to the number of processors it can dedicate to the large query.</span></span> <span data-ttu-id="2ab3a-642">請記住，您不能控制 SQL Server 用於每個作業的執行緒數目。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-642">Remember, you do not control the number of threads SQL Server will use for each operation.</span></span> <span data-ttu-id="2ab3a-643">您可以控制專用於多執行緒處理的處理器數目上限。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-643">You can control the maximum number of processors being dedicated for multi-threading.</span></span>

<span data-ttu-id="2ab3a-644">深入了解 SQL Server 中的 [平行處理原則的程度](https://technet.microsoft.com/library/ms188611.aspx) 。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-644">Learn more about [Degrees of Parallelism](https://technet.microsoft.com/library/ms188611.aspx) in SQL Server.</span></span> <span data-ttu-id="2ab3a-645">在應用程式及其組態中找出會影響多執行緒處理的設定，以最佳化效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-645">Find out such settings that influence multi-threading in your application and their configurations to optimize performance.</span></span>

## <a name="queue-depth"></a><span data-ttu-id="2ab3a-646">佇列深度</span><span class="sxs-lookup"><span data-stu-id="2ab3a-646">Queue Depth</span></span>
<span data-ttu-id="2ab3a-647">「佇列深度」或「佇列長度」或「佇列大小」是指系統中暫止的 IO 要求數目。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-647">The Queue Depth or Queue Length or Queue Size is the number of pending IO requests in the system.</span></span> <span data-ttu-id="2ab3a-648">佇列深度的值決定應用程式可以排隊的 IO 作業數目，將由儲存體磁碟來處理。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-648">The value of Queue Depth determines how many IO operations your application can line up, which the storage disks will be processing.</span></span> <span data-ttu-id="2ab3a-649">它會影響我們在本文已討論過的所有三個應用程式效能指標，也就是 IOPS、輸送量和延遲。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-649">It affects all the three application performance indicators that we discussed in this article viz., IOPS, Throughput and Latency.</span></span>

<span data-ttu-id="2ab3a-650">佇列深度與多執行緒處理密切相關。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-650">Queue Depth and multi-threading are closely related.</span></span> <span data-ttu-id="2ab3a-651">佇列深度值指出應用程式可以達到多高的多執行緒處理程度。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-651">The Queue Depth value indicates how much multi-threading can be achieved by the application.</span></span> <span data-ttu-id="2ab3a-652">如果佇列深度較大，應用程式可以同時執行較多作業，也就是多執行緒處理程度較高。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-652">If the Queue Depth is large, application can execute more operations concurrently, in other words, more multi-threading.</span></span> <span data-ttu-id="2ab3a-653">如果佇列深度較小，即使是多執行緒應用程式，也不會有足夠的要求排隊來同時執行。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-653">If the Queue Depth is small, even though application is multi-threaded, it will not have enough requests lined up for concurrent execution.</span></span>

<span data-ttu-id="2ab3a-654">通常，現成應用程式不允許您變更佇列深度，因為如果設定不正確，將會弊多於利。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-654">Typically, off the shelf applications do not allow you to change the queue depth, because if set incorrectly it will do more harm than good.</span></span> <span data-ttu-id="2ab3a-655">應用程式會設定正確的佇列深度值，以獲得最佳效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-655">Applications will set the right value of queue depth to get the optimal performance.</span></span> <span data-ttu-id="2ab3a-656">但是，務必了解此概念，才能對應用程式的效能問題進行疑難排解。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-656">However, it is important to understand this concept so that you can troubleshoot performance issues with your application.</span></span> <span data-ttu-id="2ab3a-657">您也可以在系統上執行效能評定工具，以觀察佇列深度的效果。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-657">You can also observe the effects of queue depth by running benchmarking tools on your system.</span></span>

<span data-ttu-id="2ab3a-658">某些應用程式提供設定來影響佇列深度。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-658">Some applications provide settings to influence the Queue Depth.</span></span> <span data-ttu-id="2ab3a-659">例如，上一節所述 SQL Server 中的 MAXDOP (平行處理原則的最大程度) 設定。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-659">For example, the MAXDOP (maximum degree of parallelism) setting in SQL Server explained in previous section.</span></span> <span data-ttu-id="2ab3a-660">MAXDOP 並不直接變更 SQL Server 的佇列深度值，但卻是影響佇列深度和多執行緒處理的一種方法。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-660">MAXDOP is a way to influence Queue Depth and multi-threading, although it does not directly change the Queue Depth value of SQL Server.</span></span>

<span data-ttu-id="2ab3a-661">*高佇列深度*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-661">*High Queue Depth*</span></span>  
<span data-ttu-id="2ab3a-662">高佇列深度可讓較多作業在磁碟上排隊。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-662">A high queue depth lines up more operations on the disk.</span></span> <span data-ttu-id="2ab3a-663">磁碟會事先知道其佇列中的下一個要求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-663">The disk knows the next request in its queue ahead of time.</span></span> <span data-ttu-id="2ab3a-664">因此，磁碟可以事先排定這些作業，並以最佳順序來處理作業。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-664">Consequently, the disk can schedule operations ahead of time and process them in an optimal sequence.</span></span> <span data-ttu-id="2ab3a-665">因為應用程式將更多要求傳送到磁碟，磁碟可以處理更多平行 IO。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-665">Since the application is sending more requests to the disk, the disk can process more parallel IOs.</span></span> <span data-ttu-id="2ab3a-666">最後，應用程式將能夠達到更高的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-666">Ultimately, the application will be able to achieve higher IOPS.</span></span> <span data-ttu-id="2ab3a-667">因為應用程式處理更多的要求，所以應用程式的總輸送量也會提高。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-667">Since application is processing more requests, the total Throughput of the application also increases.</span></span>

<span data-ttu-id="2ab3a-668">通常，當每個連接的磁碟上有 8-16+ 個未完成的 IO 時，應用程式可以達到最大輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-668">Typically, an application can achieve maximum Throughput with 8-16+ outstanding IOs per attached disk.</span></span> <span data-ttu-id="2ab3a-669">如果佇列深度是一，則應用程式不會將足夠的 IO 推送至系統，因此在指定期間內處理的數量會較少。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-669">If a Queue Depth is one, application is not pushing enough IOs to the system, and it will process less amount of in a given period.</span></span> <span data-ttu-id="2ab3a-670">換句話說，輸送量較少。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-670">In other words, less Throughput.</span></span>

<span data-ttu-id="2ab3a-671">例如，在 SQL Server 中，將查詢的 MAXDOP 值設為 "4"，會向 SQL Server 表示它最多可以使用四個核心來執行查詢。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-671">For example, in SQL Server, setting the MAXDOP value for a query to "4" informs SQL Server that it can use up to four cores to execute the query.</span></span> <span data-ttu-id="2ab3a-672">SQL Server 會決定查詢執行的最佳佇列深度值和核心數目。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-672">SQL Server will determine what is best queue depth value and the number of cores for the query execution.</span></span>

<span data-ttu-id="2ab3a-673">*最佳佇列深度*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-673">*Optimal Queue Depth*</span></span>  
<span data-ttu-id="2ab3a-674">佇列深度值太高也有其缺點。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-674">Very high queue depth value also has its drawbacks.</span></span> <span data-ttu-id="2ab3a-675">如果佇列深度值太高，應用程式會嘗試推動非常高的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-675">If queue depth value is too high, the application will try to drive very high IOPS.</span></span> <span data-ttu-id="2ab3a-676">除非應用程式的永續性磁碟已佈建足夠的 IOPS，否則這可能對應用程式延遲造成負面影響。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-676">Unless application has persistent disks with sufficient provisioned IOPS, this can negatively affect application latencies.</span></span> <span data-ttu-id="2ab3a-677">下列公式顯示 IOPS、延遲和佇列深度之間的關聯性。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-677">Following formula shows the relationship between IOPS, Latency and Queue Depth.</span></span>  
    ![](media/storage-premium-storage-performance/image6.png)

<span data-ttu-id="2ab3a-678">不應該只想將佇列深度設定為較高的值，而是應該設定為最佳值，以提供足夠的 IOPS 給應用程式，但又不影響延遲。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-678">You should not configure Queue Depth to any high value, but to an optimal value, which can deliver enough IOPS for the application without affecting latencies.</span></span> <span data-ttu-id="2ab3a-679">例如，如果應用程式延遲必須是 1 毫秒，則達成 5,000 IOPS 所需的佇列深度為 QD = 5000 x 0.001 = 5。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-679">For example, if the application latency needs to be 1 millisecond, the Queue Depth required to achieve 5,000 IOPS is, QD = 5000 x 0.001 = 5.</span></span>

<span data-ttu-id="2ab3a-680">*等量磁碟區的佇列深度*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-680">*Queue Depth for Striped Volume*</span></span>  
<span data-ttu-id="2ab3a-681">對於等量磁碟區，應該維持夠高的佇列深度，讓每個磁碟有各自的尖峰佇列深度。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-681">For a striped volume, maintain a high enough queue depth such that, every disk has a peak queue depth individually.</span></span> <span data-ttu-id="2ab3a-682">例如，假設應用程式推送的佇列深度為 2，而等量磁碟區中有 4 個磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-682">For example, consider an application that pushes a queue depth of 2 and there are 4 disks in the stripe.</span></span> <span data-ttu-id="2ab3a-683">兩個 IO 要求會流向兩個磁碟，而剩餘的兩個磁碟會處於閒置狀態。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-683">The two IO requests will go to two disks and remaining two disks will be idle.</span></span> <span data-ttu-id="2ab3a-684">因此，請將佇列深度設定為讓所有磁碟都有工作執行。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-684">Therefore, configure the queue depth such that all the disks can be busy.</span></span> <span data-ttu-id="2ab3a-685">下列公式顯示如何決定等量磁碟區的佇列深度。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-685">Formula below shows how to determine the queue depth of striped volumes.</span></span>  
    ![](media/storage-premium-storage-performance/image7.png)

## <a name="throttling"></a><span data-ttu-id="2ab3a-686">節流</span><span class="sxs-lookup"><span data-stu-id="2ab3a-686">Throttling</span></span>
<span data-ttu-id="2ab3a-687">Azure 進階儲存體會根據您選擇的 VM 大小和磁碟大小，佈建指定數目的 IOPS 和輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-687">Azure Premium Storage provisions specified number of IOPS and Throughput depending on the VM sizes and disk sizes you choose.</span></span> <span data-ttu-id="2ab3a-688">每當應用程式嘗試推動的 IOPS 或輸送量超過 VM 或磁碟可處理的這些限制時，進階儲存體便會進行節流。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-688">Anytime your application tries to drive IOPS or Throughput above these limits of what the VM or disk can handle, Premium Storage will throttle it.</span></span> <span data-ttu-id="2ab3a-689">這會造成應用程式的效能降低。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-689">This manifests in the form of degraded performance in your application.</span></span> <span data-ttu-id="2ab3a-690">這可能表示延遲較高、輸送量較低或 IOPS 較低。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-690">This can mean higher latency, lower Throughput or lower IOPS.</span></span> <span data-ttu-id="2ab3a-691">如果進階儲存體不會節流，應用程式可能會超出其資源的能力負荷而完全失敗。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-691">If Premium Storage does not throttle, your application could completely fail by exceeding what its resources are capable of achieving.</span></span> <span data-ttu-id="2ab3a-692">因此，為了避免因為節流而造成效能問題，一定要為應用程式佈建足夠的資源。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-692">So, to avoid performance issues due to throttling, always provision sufficient resources for your application.</span></span> <span data-ttu-id="2ab3a-693">請考量先前在 VM 大小和磁碟大小各節已討論過的因素。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-693">Take into consideration what we discussed in the VM sizes and Disk sizes sections above.</span></span> <span data-ttu-id="2ab3a-694">為了駕馭應用程式，效能評定是找出所需資源的最佳方式。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-694">Benchmarking is the best way to figure out what resources you will need to host your application.</span></span>

## <a name="benchmarking"></a><span data-ttu-id="2ab3a-695">效能評定</span><span class="sxs-lookup"><span data-stu-id="2ab3a-695">Benchmarking</span></span>
<span data-ttu-id="2ab3a-696">效能評定的過程中會在應用程式上模擬不同工作負載，並測量應用程式在每個工作負載上達到的效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-696">Benchmarking is the process of simulating different workloads on your application and measuring the application performance for each workload.</span></span> <span data-ttu-id="2ab3a-697">您已根據稍早一節所述的步驟來收集應用程式效能需求。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-697">Using the steps described in an earlier section, you have gathered the application performance requirements.</span></span> <span data-ttu-id="2ab3a-698">您可以在裝載應用程式的 VM 上執行效能評定工具，以判斷應用程式利用進階儲存體可達成的效能層級。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-698">By running benchmarking tools on the VMs hosting the application, you can determine the performance levels that your application can achieve with Premium Storage.</span></span> <span data-ttu-id="2ab3a-699">在本節中，我們針對以 Azure 進階儲存體佈建的標準 DS14 VM，提供效能評定範例。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-699">In this section, we provide you examples of benchmarking a Standard DS14 VM provisioned with Azure Premium Storage disks.</span></span>

<span data-ttu-id="2ab3a-700">我們分別在 Windows 和 Linux 上使用一般效能評定工具 Iometer 和 FIO。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-700">We have used common benchmarking tools Iometer and FIO, for Windows and Linux respectively.</span></span> <span data-ttu-id="2ab3a-701">這些工具會繁衍多個執行緒來模擬類似實際執行的工作負載，並測量系統效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-701">These tools spawn multiple threads simulating a production like workload, and measure the system performance.</span></span> <span data-ttu-id="2ab3a-702">您也可以使用這些工具來設定參數，例如區塊大小和佇列深度，您通常無法在應用程式中變更這些參數。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-702">Using the tools you can also configure parameters like block size and queue depth, which you normally cannot change for an application.</span></span> <span data-ttu-id="2ab3a-703">針對不同類型的應用程式工作負載，這可讓您在以高階磁碟佈建的高延展性 VM 上，更靈活地發揮最大效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-703">This gives you more flexibility to drive the maximum performance on a high scale VM provisioned with premium disks for different types of application workloads.</span></span> <span data-ttu-id="2ab3a-704">若要深入了解每個效能評定工具，請參閱 [Iometer](http://www.iometer.org/) 和 [FIO](http://freecode.com/projects/fio)。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-704">To learn more about each benchmarking tool visit [Iometer](http://www.iometer.org/) and [FIO](http://freecode.com/projects/fio).</span></span>

<span data-ttu-id="2ab3a-705">若要執行下列範例，請建立標準 DS14 VM，並將 11 個進階儲存體磁碟連接至 VM。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-705">To follow the examples below, create a Standard DS14 VM and attach 11 Premium Storage disks to the VM.</span></span> <span data-ttu-id="2ab3a-706">在 11 個磁碟中，將 10 個磁碟的主機快取設定為「無」，並將它們串接成一個稱為 NoCacheWrites 的磁碟區。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-706">Of the 11 disks, configure 10 disks with host caching as "None" and stripe them into a volume called NoCacheWrites.</span></span> <span data-ttu-id="2ab3a-707">在剩下的磁碟上，將主機快取設定為「唯讀」，並使用此磁碟建立一個稱為 CacheReads 的磁碟區。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-707">Configure host caching as "ReadOnly" on the remaining disk and create a volume called CacheReads with this disk.</span></span> <span data-ttu-id="2ab3a-708">根據此設定，您可以看到標準 DS14 VM 發揮最大的讀取和寫入效能。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-708">Using this setup, you will be able to see the maximum Read and Write performance from a Standard DS14 VM.</span></span> <span data-ttu-id="2ab3a-709">如需有關以進階磁碟建立 DS14 VM 的詳細步驟，請移至[為虛擬機器資料磁碟建立和使用進階儲存體帳戶](storage-premium-storage.md)。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-709">For detailed steps about creating a DS14 VM with premium disks, go to [Create and use a Premium Storage account for a virtual machine data disk](storage-premium-storage.md).</span></span>

<span data-ttu-id="2ab3a-710">*準備快取*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-710">*Warming up the Cache*</span></span>  
<span data-ttu-id="2ab3a-711">設有「唯讀」主機快取的磁碟能夠提供高於磁碟限制的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-711">The disk with ReadOnly host caching will be able to give higher IOPS than the disk limit.</span></span> <span data-ttu-id="2ab3a-712">若要從主機快取獲得這種最高的讀取效能，您必須先準備此磁碟的快取。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-712">To get this maximum read performance from the host cache, first you must warm up the cache of this disk.</span></span> <span data-ttu-id="2ab3a-713">如此可確保效能評定工具在 CacheReads 磁碟區上推動的讀取 IO 實際上是命中快取，而非直接觸及磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-713">This ensures that the Read IOs which benchmarking tool will drive on CacheReads volume actually hits the cache and not the disk directly.</span></span> <span data-ttu-id="2ab3a-714">快取命中會讓已啟用快取的單一磁碟產生更多 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-714">The cache hits result in additional IOPS from the single cache enabled disk.</span></span>

> <span data-ttu-id="2ab3a-715">**重要事項：**</span><span class="sxs-lookup"><span data-stu-id="2ab3a-715">**Important:**</span></span>  
> <span data-ttu-id="2ab3a-716">每次重新啟動 VM 時，您必須在執行效能評定之前將快取準備好。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-716">You must warm up the cache before running benchmarking, every time VM is rebooted.</span></span>
>
>

#### <a name="iometer"></a><span data-ttu-id="2ab3a-717">Iometer</span><span class="sxs-lookup"><span data-stu-id="2ab3a-717">Iometer</span></span>
<span data-ttu-id="2ab3a-718">[下載 Iometer 工具](http://sourceforge.net/projects/iometer/files/iometer-stable/2006-07-27/iometer-2006.07.27.win32.i386-setup.exe/download) 。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-718">[Download the Iometer tool](http://sourceforge.net/projects/iometer/files/iometer-stable/2006-07-27/iometer-2006.07.27.win32.i386-setup.exe/download) on the VM.</span></span>

<span data-ttu-id="2ab3a-719">*測試檔案*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-719">*Test file*</span></span>  
<span data-ttu-id="2ab3a-720">在您執行效能評定測試的磁碟區上，Iometer 會使用此磁碟區上儲存的一個測試檔案。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-720">Iometer uses a test file that is stored on the volume on which you will run the benchmarking test.</span></span> <span data-ttu-id="2ab3a-721">它會對此測試檔案推動讀取和寫入，以測量磁碟 IOPS 和輸送量。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-721">It drives Reads and Writes on this test file to measure the disk IOPS and Throughput.</span></span> <span data-ttu-id="2ab3a-722">如果您沒有提供此測試檔案，Iometer 會建立測試檔案。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-722">Iometer creates this test file if you have not provided one.</span></span> <span data-ttu-id="2ab3a-723">在 CacheReads 和 NoCacheWrites 磁碟區上，建立一個稱為 iobw.tst 的 200GB 測試檔案。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-723">Create a 200GB test file called iobw.tst on the CacheReads and NoCacheWrites volumes.</span></span>

<span data-ttu-id="2ab3a-724">*存取規格*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-724">*Access Specifications*</span></span>  
<span data-ttu-id="2ab3a-725">規格 (要求 IO 大小、% 讀取/寫入、% 隨機/循序) 是在 Iometer 中可使用 [存取規格] 索引標籤設定。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-725">The specifications, request IO size, % read/write, % random/sequential are configured using the "Access Specifications" tab in Iometer.</span></span> <span data-ttu-id="2ab3a-726">為以下說明的每個案例建立存取規格。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-726">Create an access specification for each of the scenarios described below.</span></span> <span data-ttu-id="2ab3a-727">建立存取規格並「儲存」為適當的名稱，例如 RandomWrites\_8K、RandomReads\_8K。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-727">Create the access specifications and "Save" with an appropriate name like – RandomWrites\_8K, RandomReads\_8K.</span></span> <span data-ttu-id="2ab3a-728">執行測試案例時選取對應的規格。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-728">Select the corresponding specification when running the test scenario.</span></span>

<span data-ttu-id="2ab3a-729">以下顯示最大寫入 IOPS 案例的存取規格範例，</span><span class="sxs-lookup"><span data-stu-id="2ab3a-729">An example of access specifications for maximum Write IOPS scenario is shown below,</span></span>  
    ![](media/storage-premium-storage-performance/image8.png)

<span data-ttu-id="2ab3a-730">*最大 IOPS 測試規格*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-730">*Maximum IOPS Test Specifications*</span></span>  
<span data-ttu-id="2ab3a-731">為了示範最大 IOPS，請使用較小的要求大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-731">To demonstrate maximum IOPs, use smaller request size.</span></span> <span data-ttu-id="2ab3a-732">使用 8K 要求大小，並建立隨機寫入和讀取的規格。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-732">Use 8K request size and create specifications for Random Writes and Reads.</span></span>

| <span data-ttu-id="2ab3a-733">存取規格</span><span class="sxs-lookup"><span data-stu-id="2ab3a-733">Access Specification</span></span> | <span data-ttu-id="2ab3a-734">要求大小</span><span class="sxs-lookup"><span data-stu-id="2ab3a-734">Request size</span></span> | <span data-ttu-id="2ab3a-735">隨機 %</span><span class="sxs-lookup"><span data-stu-id="2ab3a-735">Random %</span></span> | <span data-ttu-id="2ab3a-736">讀取 %</span><span class="sxs-lookup"><span data-stu-id="2ab3a-736">Read %</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="2ab3a-737">RandomWrites\_8K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-737">RandomWrites\_8K</span></span> |<span data-ttu-id="2ab3a-738">8K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-738">8K</span></span> |<span data-ttu-id="2ab3a-739">100</span><span class="sxs-lookup"><span data-stu-id="2ab3a-739">100</span></span> |<span data-ttu-id="2ab3a-740">0</span><span class="sxs-lookup"><span data-stu-id="2ab3a-740">0</span></span> |
| <span data-ttu-id="2ab3a-741">RandomReads\_8K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-741">RandomReads\_8K</span></span> |<span data-ttu-id="2ab3a-742">8K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-742">8K</span></span> |<span data-ttu-id="2ab3a-743">100</span><span class="sxs-lookup"><span data-stu-id="2ab3a-743">100</span></span> |<span data-ttu-id="2ab3a-744">100</span><span class="sxs-lookup"><span data-stu-id="2ab3a-744">100</span></span> |

<span data-ttu-id="2ab3a-745">*最大輸送量測試規格*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-745">*Maximum Throughput Test Specifications*</span></span>  
<span data-ttu-id="2ab3a-746">為了示範最大輸送量，請使用較大的要求大小。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-746">To demonstrate maximum Throughput, use larger request size.</span></span> <span data-ttu-id="2ab3a-747">使用 64K 要求大小，並建立隨機寫入和讀取的規格。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-747">Use 64K request size and create specifications for Random Writes and Reads.</span></span>

| <span data-ttu-id="2ab3a-748">存取規格</span><span class="sxs-lookup"><span data-stu-id="2ab3a-748">Access Specification</span></span> | <span data-ttu-id="2ab3a-749">要求大小</span><span class="sxs-lookup"><span data-stu-id="2ab3a-749">Request size</span></span> | <span data-ttu-id="2ab3a-750">隨機 %</span><span class="sxs-lookup"><span data-stu-id="2ab3a-750">Random %</span></span> | <span data-ttu-id="2ab3a-751">讀取 %</span><span class="sxs-lookup"><span data-stu-id="2ab3a-751">Read %</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="2ab3a-752">RandomWrites\_64K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-752">RandomWrites\_64K</span></span> |<span data-ttu-id="2ab3a-753">64K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-753">64K</span></span> |<span data-ttu-id="2ab3a-754">100</span><span class="sxs-lookup"><span data-stu-id="2ab3a-754">100</span></span> |<span data-ttu-id="2ab3a-755">0</span><span class="sxs-lookup"><span data-stu-id="2ab3a-755">0</span></span> |
| <span data-ttu-id="2ab3a-756">RandomReads\_64K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-756">RandomReads\_64K</span></span> |<span data-ttu-id="2ab3a-757">64K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-757">64K</span></span> |<span data-ttu-id="2ab3a-758">100</span><span class="sxs-lookup"><span data-stu-id="2ab3a-758">100</span></span> |<span data-ttu-id="2ab3a-759">100</span><span class="sxs-lookup"><span data-stu-id="2ab3a-759">100</span></span> |

<span data-ttu-id="2ab3a-760">*執行 Iometer 測試*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-760">*Running the Iometer Test*</span></span>  
<span data-ttu-id="2ab3a-761">執行下列步驟將準備快取</span><span class="sxs-lookup"><span data-stu-id="2ab3a-761">Perform the steps below to warm up cache</span></span>

1. <span data-ttu-id="2ab3a-762">使用如下所示的值建立兩個存取規格</span><span class="sxs-lookup"><span data-stu-id="2ab3a-762">Create two access specifications with values shown below,</span></span>

   | <span data-ttu-id="2ab3a-763">名稱</span><span class="sxs-lookup"><span data-stu-id="2ab3a-763">Name</span></span> | <span data-ttu-id="2ab3a-764">要求大小</span><span class="sxs-lookup"><span data-stu-id="2ab3a-764">Request size</span></span> | <span data-ttu-id="2ab3a-765">隨機 %</span><span class="sxs-lookup"><span data-stu-id="2ab3a-765">Random %</span></span> | <span data-ttu-id="2ab3a-766">讀取 %</span><span class="sxs-lookup"><span data-stu-id="2ab3a-766">Read %</span></span> |
   | --- | --- | --- | --- |
   | <span data-ttu-id="2ab3a-767">RandomWrites\_1MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-767">RandomWrites\_1MB</span></span> |<span data-ttu-id="2ab3a-768">1MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-768">1MB</span></span> |<span data-ttu-id="2ab3a-769">100</span><span class="sxs-lookup"><span data-stu-id="2ab3a-769">100</span></span> |<span data-ttu-id="2ab3a-770">0</span><span class="sxs-lookup"><span data-stu-id="2ab3a-770">0</span></span> |
   | <span data-ttu-id="2ab3a-771">RandomReads\_1MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-771">RandomReads\_1MB</span></span> |<span data-ttu-id="2ab3a-772">1MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-772">1MB</span></span> |<span data-ttu-id="2ab3a-773">100</span><span class="sxs-lookup"><span data-stu-id="2ab3a-773">100</span></span> |<span data-ttu-id="2ab3a-774">100</span><span class="sxs-lookup"><span data-stu-id="2ab3a-774">100</span></span> |
2. <span data-ttu-id="2ab3a-775">執行 Iometer 測試，使用下列參數初始化快取磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-775">Run the Iometer test for initializing cache disk with following parameters.</span></span> <span data-ttu-id="2ab3a-776">對目標磁碟區使用三個背景工作執行緒，佇列深度為 128。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-776">Use three worker threads for the target volume and a queue depth of 128.</span></span> <span data-ttu-id="2ab3a-777">在 [測試安裝程式] 索引標籤上，將測試的「執行階段」期間設為 2 小時。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-777">Set the "Run time" duration of the test to 2hrs on the "Test Setup" tab.</span></span>

   | <span data-ttu-id="2ab3a-778">案例</span><span class="sxs-lookup"><span data-stu-id="2ab3a-778">Scenario</span></span> | <span data-ttu-id="2ab3a-779">目標磁碟區</span><span class="sxs-lookup"><span data-stu-id="2ab3a-779">Target Volume</span></span> | <span data-ttu-id="2ab3a-780">名稱</span><span class="sxs-lookup"><span data-stu-id="2ab3a-780">Name</span></span> | <span data-ttu-id="2ab3a-781">持續時間</span><span class="sxs-lookup"><span data-stu-id="2ab3a-781">Duration</span></span> |
   | --- | --- | --- | --- |
   | <span data-ttu-id="2ab3a-782">初始化快取磁碟</span><span class="sxs-lookup"><span data-stu-id="2ab3a-782">Initialize Cache Disk</span></span> |<span data-ttu-id="2ab3a-783">CacheReads</span><span class="sxs-lookup"><span data-stu-id="2ab3a-783">CacheReads</span></span> |<span data-ttu-id="2ab3a-784">RandomWrites\_1MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-784">RandomWrites\_1MB</span></span> |<span data-ttu-id="2ab3a-785">2 小時</span><span class="sxs-lookup"><span data-stu-id="2ab3a-785">2hrs</span></span> |
3. <span data-ttu-id="2ab3a-786">執行 Iometer 測試，使用下列參數來準備快取。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-786">Run the Iometer test for warming up cache disk with following parameters.</span></span> <span data-ttu-id="2ab3a-787">對目標磁碟區使用三個背景工作執行緒，佇列深度為 128。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-787">Use three worker threads for the target volume and a queue depth of 128.</span></span> <span data-ttu-id="2ab3a-788">在 [測試安裝程式] 索引標籤上，將測試的「執行階段」期間設為 2 小時。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-788">Set the "Run time" duration of the test to 2hrs on the "Test Setup" tab.</span></span>

   | <span data-ttu-id="2ab3a-789">案例</span><span class="sxs-lookup"><span data-stu-id="2ab3a-789">Scenario</span></span> | <span data-ttu-id="2ab3a-790">目標磁碟區</span><span class="sxs-lookup"><span data-stu-id="2ab3a-790">Target Volume</span></span> | <span data-ttu-id="2ab3a-791">名稱</span><span class="sxs-lookup"><span data-stu-id="2ab3a-791">Name</span></span> | <span data-ttu-id="2ab3a-792">持續時間</span><span class="sxs-lookup"><span data-stu-id="2ab3a-792">Duration</span></span> |
   | --- | --- | --- | --- |
   | <span data-ttu-id="2ab3a-793">準備快取磁碟</span><span class="sxs-lookup"><span data-stu-id="2ab3a-793">Warm up Cache Disk</span></span> |<span data-ttu-id="2ab3a-794">CacheReads</span><span class="sxs-lookup"><span data-stu-id="2ab3a-794">CacheReads</span></span> |<span data-ttu-id="2ab3a-795">RandomReads\_1MB</span><span class="sxs-lookup"><span data-stu-id="2ab3a-795">RandomReads\_1MB</span></span> |<span data-ttu-id="2ab3a-796">2 小時</span><span class="sxs-lookup"><span data-stu-id="2ab3a-796">2hrs</span></span> |

<span data-ttu-id="2ab3a-797">準備快取磁碟之後，繼續執行下列的測試案例。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-797">After cache disk is warmed up, proceed with the test scenarios listed below.</span></span> <span data-ttu-id="2ab3a-798">若要執行 Iometer 測試，請對 **每個** 目標磁碟區使用至少三個背景工作角色執行緒。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-798">To run the Iometer test, use at least three worker threads for **each** target volume.</span></span> <span data-ttu-id="2ab3a-799">針對每個背景工作執行緒，請選取目標磁碟區，設定佇列深度，然後選取其中一個已儲存的測試規格，如下表所示，以執行對應的測試案例。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-799">For each worker thread, select the target volume, set queue depth and select one of the saved test specifications, as shown in the table below, to run the corresponding test scenario.</span></span> <span data-ttu-id="2ab3a-800">表格也顯示執行這些測試時，預期的 IOPS 和輸送量結果。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-800">The table also shows expected results for IOPS and Throughput when running these tests.</span></span> <span data-ttu-id="2ab3a-801">在所有案例中，都使用較小的 IO 大小 8 KB 和較高的佇列深度 128。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-801">For all scenarios, a small IO size of 8KB and a high queue depth of 128 is used.</span></span>

| <span data-ttu-id="2ab3a-802">測試案例</span><span class="sxs-lookup"><span data-stu-id="2ab3a-802">Test Scenario</span></span> | <span data-ttu-id="2ab3a-803">目標磁碟區</span><span class="sxs-lookup"><span data-stu-id="2ab3a-803">Target Volume</span></span> | <span data-ttu-id="2ab3a-804">名稱</span><span class="sxs-lookup"><span data-stu-id="2ab3a-804">Name</span></span> | <span data-ttu-id="2ab3a-805">結果</span><span class="sxs-lookup"><span data-stu-id="2ab3a-805">Result</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="2ab3a-806">最大</span><span class="sxs-lookup"><span data-stu-id="2ab3a-806">Max.</span></span> <span data-ttu-id="2ab3a-807">讀取 IOPS</span><span class="sxs-lookup"><span data-stu-id="2ab3a-807">Read IOPS</span></span> |<span data-ttu-id="2ab3a-808">CacheReads</span><span class="sxs-lookup"><span data-stu-id="2ab3a-808">CacheReads</span></span> |<span data-ttu-id="2ab3a-809">RandomWrites\_8K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-809">RandomWrites\_8K</span></span> |<span data-ttu-id="2ab3a-810">50,000 IOPS </span><span class="sxs-lookup"><span data-stu-id="2ab3a-810">50,000 IOPS</span></span> |
| <span data-ttu-id="2ab3a-811">最大</span><span class="sxs-lookup"><span data-stu-id="2ab3a-811">Max.</span></span> <span data-ttu-id="2ab3a-812">寫入 IOPS</span><span class="sxs-lookup"><span data-stu-id="2ab3a-812">Write IOPS</span></span> |<span data-ttu-id="2ab3a-813">NoCacheWrites</span><span class="sxs-lookup"><span data-stu-id="2ab3a-813">NoCacheWrites</span></span> |<span data-ttu-id="2ab3a-814">RandomReads\_8K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-814">RandomReads\_8K</span></span> |<span data-ttu-id="2ab3a-815">64,000 IOPS</span><span class="sxs-lookup"><span data-stu-id="2ab3a-815">64,000 IOPS</span></span> |
| <span data-ttu-id="2ab3a-816">最大</span><span class="sxs-lookup"><span data-stu-id="2ab3a-816">Max.</span></span> <span data-ttu-id="2ab3a-817">結合的 IOPS</span><span class="sxs-lookup"><span data-stu-id="2ab3a-817">Combined IOPS</span></span> |<span data-ttu-id="2ab3a-818">CacheReads</span><span class="sxs-lookup"><span data-stu-id="2ab3a-818">CacheReads</span></span> |<span data-ttu-id="2ab3a-819">RandomWrites\_8K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-819">RandomWrites\_8K</span></span> |<span data-ttu-id="2ab3a-820">100,000 IOPS</span><span class="sxs-lookup"><span data-stu-id="2ab3a-820">100,000 IOPS</span></span> |
| <span data-ttu-id="2ab3a-821">NoCacheWrites</span><span class="sxs-lookup"><span data-stu-id="2ab3a-821">NoCacheWrites</span></span> |<span data-ttu-id="2ab3a-822">RandomReads\_8K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-822">RandomReads\_8K</span></span> | &nbsp; | &nbsp; |
| <span data-ttu-id="2ab3a-823">最大</span><span class="sxs-lookup"><span data-stu-id="2ab3a-823">Max.</span></span> <span data-ttu-id="2ab3a-824">讀取 MB/秒</span><span class="sxs-lookup"><span data-stu-id="2ab3a-824">Read MB/sec</span></span> |<span data-ttu-id="2ab3a-825">CacheReads</span><span class="sxs-lookup"><span data-stu-id="2ab3a-825">CacheReads</span></span> |<span data-ttu-id="2ab3a-826">RandomWrites\_64K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-826">RandomWrites\_64K</span></span> |<span data-ttu-id="2ab3a-827">524 MB/秒</span><span class="sxs-lookup"><span data-stu-id="2ab3a-827">524 MB/sec</span></span> |
| <span data-ttu-id="2ab3a-828">最大</span><span class="sxs-lookup"><span data-stu-id="2ab3a-828">Max.</span></span> <span data-ttu-id="2ab3a-829">寫入 MB/秒</span><span class="sxs-lookup"><span data-stu-id="2ab3a-829">Write MB/sec</span></span> |<span data-ttu-id="2ab3a-830">NoCacheWrites</span><span class="sxs-lookup"><span data-stu-id="2ab3a-830">NoCacheWrites</span></span> |<span data-ttu-id="2ab3a-831">RandomReads\_64K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-831">RandomReads\_64K</span></span> |<span data-ttu-id="2ab3a-832">524 MB/秒</span><span class="sxs-lookup"><span data-stu-id="2ab3a-832">524 MB/sec</span></span> |
| <span data-ttu-id="2ab3a-833">結合的 MB/秒</span><span class="sxs-lookup"><span data-stu-id="2ab3a-833">Combined MB/sec</span></span> |<span data-ttu-id="2ab3a-834">CacheReads</span><span class="sxs-lookup"><span data-stu-id="2ab3a-834">CacheReads</span></span> |<span data-ttu-id="2ab3a-835">RandomWrites\_64K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-835">RandomWrites\_64K</span></span> |<span data-ttu-id="2ab3a-836">1000 MB/秒</span><span class="sxs-lookup"><span data-stu-id="2ab3a-836">1000 MB/sec</span></span> |
| <span data-ttu-id="2ab3a-837">NoCacheWrites</span><span class="sxs-lookup"><span data-stu-id="2ab3a-837">NoCacheWrites</span></span> |<span data-ttu-id="2ab3a-838">RandomReads\_64K</span><span class="sxs-lookup"><span data-stu-id="2ab3a-838">RandomReads\_64K</span></span> | &nbsp; | &nbsp; |

<span data-ttu-id="2ab3a-839">針對結合的 IOPS 和輸送量案例，以下是 Iometer 測試結果的螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-839">Below are screenshots of the Iometer test results for combined IOPS and Throughput scenarios.</span></span>

<span data-ttu-id="2ab3a-840">*結合的讀取和寫入最大 IOPS*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-840">*Combined Reads and Writes Maximum IOPS*</span></span>  
![](media/storage-premium-storage-performance/image9.png)

<span data-ttu-id="2ab3a-841">*結合的讀取和寫入最大輸送量*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-841">*Combined Reads and Writes Maximum Throughput*</span></span>  
![](media/storage-premium-storage-performance/image10.png)

### <a name="fio"></a><span data-ttu-id="2ab3a-842">FIO</span><span class="sxs-lookup"><span data-stu-id="2ab3a-842">FIO</span></span>
<span data-ttu-id="2ab3a-843">FIO 是 Linux VM 上用於儲存體效能評定的一項常用工具。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-843">FIO is a popular tool to benchmark storage on the Linux VMs.</span></span> <span data-ttu-id="2ab3a-844">它可以靈活地選取不同的 IO 大小、循序或隨機讀取和寫入。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-844">It has the flexibility to select different IO sizes, sequential or random reads and writes.</span></span> <span data-ttu-id="2ab3a-845">它會繁衍背景工作執行緒或處理程序來執行指定的 I/O 作業。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-845">It spawns worker threads or processes to perform the specified I/O operations.</span></span> <span data-ttu-id="2ab3a-846">您可以使用工作檔案，指定每個背景工作執行緒必須執行的 I/O 作業類型。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-846">You can specify the type of I/O operations each worker thread must perform using job files.</span></span> <span data-ttu-id="2ab3a-847">我們已經為下面範例所示的每個案例建立一個工作檔案。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-847">We created one job file per scenario illustrated in the examples below.</span></span> <span data-ttu-id="2ab3a-848">您可以變更這些工作檔案中的規格，對進階儲存體上執行的不同工作負載進行效能評定。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-848">You can change the specifications in these job files to benchmark different workloads running on Premium Storage.</span></span> <span data-ttu-id="2ab3a-849">在範例中，我們使用執行 **Ubuntu**的標準 DS 14 VM。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-849">In the examples, we are using a Standard DS 14 VM running **Ubuntu**.</span></span> <span data-ttu-id="2ab3a-850">請使用 [效能評定](#Benchmarking) 一節的開頭所述的相同設定，並於執行效能評定測試之前先備妥快取。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-850">Use the same setup described in the beginning of the [Benchmarking section](#Benchmarking) and warm up the cache before running the benchmarking tests.</span></span>

<span data-ttu-id="2ab3a-851">開始進行之前，請先在虛擬機器上 [下載 FIO](https://github.com/axboe/fio) 並安裝。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-851">Before you begin, [download FIO](https://github.com/axboe/fio) and install it on your virtual machine.</span></span>

<span data-ttu-id="2ab3a-852">對 Ubuntu 執行下列命令，</span><span class="sxs-lookup"><span data-stu-id="2ab3a-852">Run the following command for Ubuntu,</span></span>

```
apt-get install fio
```

<span data-ttu-id="2ab3a-853">我們將在磁碟上使用四個背景工作執行緒來推動讀取作業，並使用四個背景工作執行緒來推動讀取作業。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-853">We will use four worker threads for driving Write operations and four worker threads for driving Read operations on the disks.</span></span> <span data-ttu-id="2ab3a-854">「寫入」背景工作角色會在 "nocache" 磁碟區上推動流量，此磁碟區有 10 個將快取設為「無」的磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-854">The Write workers will be driving traffic on the "nocache" volume, which has 10 disks with cache set to "None".</span></span> <span data-ttu-id="2ab3a-855">「讀取」背景工作角色會在 "readcache" 磁碟區上推動流量，此磁碟區有 1 個將快取設為「唯讀」的磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-855">The Read workers will be driving traffic on the "readcache" volume, which has 1 disk with cache set to "ReadOnly".</span></span>

<span data-ttu-id="2ab3a-856">*最大寫入 IOPS*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-856">*Maximum Write IOPS*</span></span>  
<span data-ttu-id="2ab3a-857">使用下列規格建立作業檔案，以產生最大寫入 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-857">Create the job file with following specifications to get maximum Write IOPS.</span></span> <span data-ttu-id="2ab3a-858">將它命名為 "fiowrite.ini"。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-858">Name it "fiowrite.ini".</span></span>

```
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=8k

[writer1]
rw=randwrite
directory=/mnt/nocache
[writer2]
rw=randwrite
directory=/mnt/nocache
[writer3]
rw=randwrite
directory=/mnt/nocache
[writer4]
rw=randwrite
directory=/mnt/nocache
```

<span data-ttu-id="2ab3a-859">請注意以下與先前幾節所述的設計指導方針一致的重要事項。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-859">Note the follow key things that are in line with the design guidelines discussed in previous sections.</span></span> <span data-ttu-id="2ab3a-860">這些規格對於達到最大 IOPS 很重要，</span><span class="sxs-lookup"><span data-stu-id="2ab3a-860">These specifications are essential to drive maximum IOPS,</span></span>  

* <span data-ttu-id="2ab3a-861">較高的佇列深度 256。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-861">A high queue depth of 256.</span></span>  
* <span data-ttu-id="2ab3a-862">較小的區塊大小 8KB。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-862">A small block size of 8KB.</span></span>  
* <span data-ttu-id="2ab3a-863">執行隨機寫入的多個執行緒。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-863">Multiple threads performing random writes.</span></span>

<span data-ttu-id="2ab3a-864">執行下列命令，開始執行 FIO 測試 30 秒，</span><span class="sxs-lookup"><span data-stu-id="2ab3a-864">Run the following command to kick off the FIO test for 30 seconds,</span></span>  

```
sudo fio --runtime 30 fiowrite.ini
```

<span data-ttu-id="2ab3a-865">當測試執行時，您將能夠看到 VM 和高階磁碟產生的寫入 IOPS 數目。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-865">While the test runs, you will be able to see the number of write IOPS the VM and Premium disks are delivering.</span></span> <span data-ttu-id="2ab3a-866">如下列範例所示，DS14 VM 產生最大寫入 IOPS 限制 50,000 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-866">As shown in the sample below, the DS14 VM is delivering its maximum write IOPS limit of 50,000 IOPS.</span></span>  
    ![](media/storage-premium-storage-performance/image11.png)

<span data-ttu-id="2ab3a-867">*最大讀取 IOPS*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-867">*Maximum Read IOPS*</span></span>  
<span data-ttu-id="2ab3a-868">使用下列規格建立作業檔案，以產生最大讀取 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-868">Create the job file with following specifications to get maximum Read IOPS.</span></span> <span data-ttu-id="2ab3a-869">將它命名為 "fioread.ini"。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-869">Name it "fioread.ini".</span></span>

```
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=8k

[reader1]
rw=randread
directory=/mnt/readcache
[reader2]
rw=randread
directory=/mnt/readcache
[reader3]
rw=randread
directory=/mnt/readcache
[reader4]
rw=randread
directory=/mnt/readcache
```

<span data-ttu-id="2ab3a-870">請注意以下與先前幾節所述的設計指導方針一致的重要事項。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-870">Note the follow key things that are in line with the design guidelines discussed in previous sections.</span></span> <span data-ttu-id="2ab3a-871">這些規格對於達到最大 IOPS 很重要，</span><span class="sxs-lookup"><span data-stu-id="2ab3a-871">These specifications are essential to drive maximum IOPS,</span></span>

* <span data-ttu-id="2ab3a-872">較高的佇列深度 256。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-872">A high queue depth of 256.</span></span>  
* <span data-ttu-id="2ab3a-873">較小的區塊大小 8KB。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-873">A small block size of 8KB.</span></span>  
* <span data-ttu-id="2ab3a-874">執行隨機寫入的多個執行緒。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-874">Multiple threads performing random writes.</span></span>

<span data-ttu-id="2ab3a-875">執行下列命令，開始執行 FIO 測試 30 秒，</span><span class="sxs-lookup"><span data-stu-id="2ab3a-875">Run the following command to kick off the FIO test for 30 seconds,</span></span>

```
sudo fio --runtime 30 fioread.ini
```

<span data-ttu-id="2ab3a-876">當測試執行時，您將能夠看到 VM 和高階磁碟產生的讀取 IOPS 數目。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-876">While the test runs, you will be able to see the number of read IOPS the VM and Premium disks are delivering.</span></span> <span data-ttu-id="2ab3a-877">如下列範例所示，DS14 VM 產生超過 64,000 的讀取 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-877">As shown in the sample below, the DS14 VM is delivering more than 64,000 Read IOPS.</span></span> <span data-ttu-id="2ab3a-878">這是磁碟和快取效能的組合。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-878">This is a combination of the disk and the cache performance.</span></span>  
    ![](media/storage-premium-storage-performance/image12.png)

<span data-ttu-id="2ab3a-879">*最大讀取和寫入 IOPS*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-879">*Maximum Read and Write IOPS*</span></span>  
<span data-ttu-id="2ab3a-880">使用下列規格建立作業檔案，以產生最大讀取和寫入 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-880">Create the job file with following specifications to get maximum combined Read and Write IOPS.</span></span> <span data-ttu-id="2ab3a-881">將它命名為 "fioreadwrite.ini"。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-881">Name it "fioreadwrite.ini".</span></span>

```
[global]
size=30g
direct=1
iodepth=128
ioengine=libaio
bs=4k

[reader1]
rw=randread
directory=/mnt/readcache
[reader2]
rw=randread
directory=/mnt/readcache
[reader3]
rw=randread
directory=/mnt/readcache
[reader4]
rw=randread
directory=/mnt/readcache

[writer1]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer2]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer3]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer4]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
```

<span data-ttu-id="2ab3a-882">請注意以下與先前幾節所述的設計指導方針一致的重要事項。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-882">Note the follow key things that are in line with the design guidelines discussed in previous sections.</span></span> <span data-ttu-id="2ab3a-883">這些規格對於達到最大 IOPS 很重要，</span><span class="sxs-lookup"><span data-stu-id="2ab3a-883">These specifications are essential to drive maximum IOPS,</span></span>

* <span data-ttu-id="2ab3a-884">較高的佇列深度 128。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-884">A high queue depth of 128.</span></span>  
* <span data-ttu-id="2ab3a-885">較小的區塊大小 4KB。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-885">A small block size of 4KB.</span></span>  
* <span data-ttu-id="2ab3a-886">執行隨機讀取和寫入的多個執行緒。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-886">Multiple threads performing random reads and writes.</span></span>

<span data-ttu-id="2ab3a-887">執行下列命令，開始執行 FIO 測試 30 秒，</span><span class="sxs-lookup"><span data-stu-id="2ab3a-887">Run the following command to kick off the FIO test for 30 seconds,</span></span>

```
sudo fio --runtime 30 fioreadwrite.ini
```

<span data-ttu-id="2ab3a-888">當測試執行時，您將能夠看到 VM 和高階磁碟產生的結合讀取和寫入 IOPS 數目。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-888">While the test runs, you will be able to see the number of combined read and write IOPS the VM and Premium disks are delivering.</span></span> <span data-ttu-id="2ab3a-889">如下列範例所示，DS14 VM 產生超過 100,000 的結合讀取和寫入 IOPS。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-889">As shown in the sample below, the DS14 VM is delivering more than 100,000 combined Read and Write IOPS.</span></span> <span data-ttu-id="2ab3a-890">這是磁碟和快取效能的組合。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-890">This is a combination of the disk and the cache performance.</span></span>  
    ![](media/storage-premium-storage-performance/image13.png)

<span data-ttu-id="2ab3a-891">*結合的最大輸送量*</span><span class="sxs-lookup"><span data-stu-id="2ab3a-891">*Maximum Combined Throughput*</span></span>  
<span data-ttu-id="2ab3a-892">若要獲得最大的結合讀取和寫入輸送量，請使用較大的區塊大小和較大佇列深度，並搭配執行讀取和寫入的多個執行緒。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-892">To get the maximum combined Read and Write Throughput, use a larger block size and large queue depth with multiple threads performing reads and writes.</span></span> <span data-ttu-id="2ab3a-893">您可以使用 64KB 的區塊大小和 128 的佇列深度。</span><span class="sxs-lookup"><span data-stu-id="2ab3a-893">You can use a block size of 64KB and queue depth of 128.</span></span>

## <a name="next-steps"></a><span data-ttu-id="2ab3a-894">後續步驟</span><span class="sxs-lookup"><span data-stu-id="2ab3a-894">Next Steps</span></span>
<span data-ttu-id="2ab3a-895">深入了解 Azure 進階儲存體：</span><span class="sxs-lookup"><span data-stu-id="2ab3a-895">Learn more about Azure Premium Storage:</span></span>

* [<span data-ttu-id="2ab3a-896">Premium 儲存體：Azure 虛擬機器工作負載適用的高效能儲存體</span><span class="sxs-lookup"><span data-stu-id="2ab3a-896">Premium Storage: High-Performance Storage for Azure Virtual Machine Workloads</span></span>](storage-premium-storage.md)  

<span data-ttu-id="2ab3a-897">若為 SQL Server 使用者，請參閱「SQL Server 的效能最佳作法」文章：</span><span class="sxs-lookup"><span data-stu-id="2ab3a-897">For SQL Server users, read articles on Performance Best Practices for SQL Server:</span></span>

* [<span data-ttu-id="2ab3a-898">Azure 虛擬機器中的 SQL Server 效能最佳作法</span><span class="sxs-lookup"><span data-stu-id="2ab3a-898">Performance Best Practices for SQL Server in Azure Virtual Machines</span></span>](../virtual-machines/windows/sql/virtual-machines-windows-sql-performance.md)
* [<span data-ttu-id="2ab3a-899">Azure 進階儲存體為 Azure VM 中的 SQL Server 提供最高效能</span><span class="sxs-lookup"><span data-stu-id="2ab3a-899">Azure Premium Storage provides highest performance for SQL Server in Azure VM</span></span>](http://blogs.technet.com/b/dataplatforminsider/archive/2015/04/23/azure-premium-storage-provides-highest-performance-for-sql-server-in-azure-vm.aspx)
