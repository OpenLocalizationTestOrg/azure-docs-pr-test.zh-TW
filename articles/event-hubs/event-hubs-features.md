---
title: "Azure 事件中樞功能概觀 | Microsoft Docs"
description: "Azure 事件中樞功能的概觀和詳細資料"
services: event-hubs
documentationcenter: .net
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 
ms.service: event-hubs
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/17/2017
ms.author: sethm
ms.openlocfilehash: a74d767d57eb5ce2b3a716f9ba908a451f25f538
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="event-hubs-features-overview"></a><span data-ttu-id="0e89c-103">事件中樞功能概觀</span><span class="sxs-lookup"><span data-stu-id="0e89c-103">Event Hubs features overview</span></span>

<span data-ttu-id="0e89c-104">事件中樞是可調整的事件處理服務，它會擷取和處理大量的事件和資料，具有低延遲和高可靠性。</span><span class="sxs-lookup"><span data-stu-id="0e89c-104">Azure Event Hubs is a scalable event processing service that ingests and processes large volumes of events and data, with low latency and high reliability.</span></span> <span data-ttu-id="0e89c-105">如需服務的高階概觀，請參閱[何謂事件中樞？](event-hubs-what-is-event-hubs.md)。</span><span class="sxs-lookup"><span data-stu-id="0e89c-105">See [What is Event Hubs?](event-hubs-what-is-event-hubs.md) for a high-level overview of the service.</span></span>

<span data-ttu-id="0e89c-106">這篇文章是根據[概觀](event-hubs-what-is-event-hubs.md)中的資訊建置，並且提供有關事件中樞元件和功能的技術和實作詳細資料。</span><span class="sxs-lookup"><span data-stu-id="0e89c-106">This article builds on the information in the [overview](event-hubs-what-is-event-hubs.md), and provides technical and implementation details about Event Hubs components and features.</span></span>

## <a name="event-publishers"></a><span data-ttu-id="0e89c-107">事件發佈者</span><span class="sxs-lookup"><span data-stu-id="0e89c-107">Event publishers</span></span>

<span data-ttu-id="0e89c-108">任何將資料傳送至事件中樞的實體就稱為「事件產生者」或「事件發佈者」。</span><span class="sxs-lookup"><span data-stu-id="0e89c-108">Any entity that sends data to an event hub is an event producer, or *event publisher*.</span></span> <span data-ttu-id="0e89c-109">事件發佈者可以使用 HTTPS 或 AMQP 1.0 發佈事件。</span><span class="sxs-lookup"><span data-stu-id="0e89c-109">Event publishers can publish events using HTTPS or AMQP 1.0.</span></span> <span data-ttu-id="0e89c-110">事件發佈者使用共用存取簽章 (SAS) 權杖向事件中樞辨識自己的身分，而且可以擁有唯一的身分識別，或使用一般 SAS 權杖。</span><span class="sxs-lookup"><span data-stu-id="0e89c-110">Event publishers use a Shared Access Signature (SAS) token to identify themselves to an event hub, and can have a unique identity, or use a common SAS token.</span></span>

### <a name="publishing-an-event"></a><span data-ttu-id="0e89c-111">發佈事件</span><span class="sxs-lookup"><span data-stu-id="0e89c-111">Publishing an event</span></span>

<span data-ttu-id="0e89c-112">您可以透過 AMQP 1.0 或 HTTPS 來發佈事件。</span><span class="sxs-lookup"><span data-stu-id="0e89c-112">You can publish an event via AMQP 1.0 or HTTPS.</span></span> <span data-ttu-id="0e89c-113">事件中樞提供[用戶端程式庫和類別](event-hubs-dotnet-framework-api-overview.md)，以供您從 .NET 用戶端將事件發佈到事件中樞。</span><span class="sxs-lookup"><span data-stu-id="0e89c-113">Event Hubs provides [client libraries and classes](event-hubs-dotnet-framework-api-overview.md) for publishing events to an event hub from .NET clients.</span></span> <span data-ttu-id="0e89c-114">對於其他執行階段和平台，您可以使用任何 AMQP 1.0 用戶端 (如 [Apache Qpid](http://qpid.apache.org/))。</span><span class="sxs-lookup"><span data-stu-id="0e89c-114">For other runtimes and platforms, you can use any AMQP 1.0 client, such as [Apache Qpid](http://qpid.apache.org/).</span></span> <span data-ttu-id="0e89c-115">您可以單獨發佈事件，或以批次方式進行。</span><span class="sxs-lookup"><span data-stu-id="0e89c-115">You can publish events individually, or batched.</span></span> <span data-ttu-id="0e89c-116">不論是單一事件或批次，單次發行 (事件資料執行個體) 的上限為 256KB。</span><span class="sxs-lookup"><span data-stu-id="0e89c-116">A single publication (event data instance) has a limit of 256 KB, regardless of whether it is a single event or a batch.</span></span> <span data-ttu-id="0e89c-117">發佈大於此臨界值的事件會導致錯誤。</span><span class="sxs-lookup"><span data-stu-id="0e89c-117">Publishing events larger than this threshold results in an error.</span></span> <span data-ttu-id="0e89c-118">發佈者最好別顧慮事件中樞內的資料分割，他們只需要指定 *資料分割索引鍵* (下一節將加以介紹)，或透過其 SAS 權杖指定身分識別即可。</span><span class="sxs-lookup"><span data-stu-id="0e89c-118">It is a best practice for publishers to be unaware of partitions within the event hub and to only specify a *partition key* (introduced in the next section), or their identity via their SAS token.</span></span>

<span data-ttu-id="0e89c-119">使用 AMQP 或 HTTPS 的選擇因使用案例而異。</span><span class="sxs-lookup"><span data-stu-id="0e89c-119">The choice to use AMQP or HTTPS is specific to the usage scenario.</span></span> <span data-ttu-id="0e89c-120">除了傳輸層級安全性 (TLS) 或 SSL/TLS 之外，AMQP 還需要建立持續性的雙向通訊端。</span><span class="sxs-lookup"><span data-stu-id="0e89c-120">AMQP requires the establishment of a persistent bidirectional socket in addition to transport level security (TLS) or SSL/TLS.</span></span> <span data-ttu-id="0e89c-121">AMQP 初始化工作階段時的網路成本較高，但 HTTPS 需要額外的 SSL 工作負荷來處理每個要求。</span><span class="sxs-lookup"><span data-stu-id="0e89c-121">AMQP has higher network costs when initializing the session, however HTTPS requires additional SSL overhead for every request.</span></span> <span data-ttu-id="0e89c-122">對於頻繁的發行者，AMQP 的效能較高。</span><span class="sxs-lookup"><span data-stu-id="0e89c-122">AMQP has higher performance for frequent publishers.</span></span>

![事件中樞](./media/event-hubs-features/partition_keys.png)

<span data-ttu-id="0e89c-124">事件中樞能確保所有共用資料分割索引鍵值的事件依序傳遞至同一個資料分割。</span><span class="sxs-lookup"><span data-stu-id="0e89c-124">Event Hubs ensures that all events sharing a partition key value are delivered in order, and to the same partition.</span></span> <span data-ttu-id="0e89c-125">如果資料分割索引鍵與發佈者原則搭配使用，發佈者的身分識別與資料分割索引鍵的值必須相符，</span><span class="sxs-lookup"><span data-stu-id="0e89c-125">If partition keys are used with publisher policies, then the identity of the publisher and the value of the partition key must match.</span></span> <span data-ttu-id="0e89c-126">否則便會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="0e89c-126">Otherwise, an error occurs.</span></span>

### <a name="publisher-policy"></a><span data-ttu-id="0e89c-127">發佈者原則</span><span class="sxs-lookup"><span data-stu-id="0e89c-127">Publisher policy</span></span>

<span data-ttu-id="0e89c-128">事件中樞可讓您透過發佈者 原則更精確地控制事件發佈者。</span><span class="sxs-lookup"><span data-stu-id="0e89c-128">Event Hubs enables granular control over event publishers through *publisher policies*.</span></span> <span data-ttu-id="0e89c-129">發佈者原則是為了協助大量獨立事件發佈者而設計的執行階段功能。</span><span class="sxs-lookup"><span data-stu-id="0e89c-129">Publisher policies are run-time features designed to facilitate large numbers of independent event publishers.</span></span> <span data-ttu-id="0e89c-130">有了發佈者原則，當每位發佈者使用下列機制將事件發佈到事件中樞時，都能使用自己的唯一識別碼：</span><span class="sxs-lookup"><span data-stu-id="0e89c-130">With publisher policies, each publisher uses its own unique identifier when publishing events to an event hub, using the following mechanism:</span></span>

```
//[my namespace].servicebus.windows.net/[event hub name]/publishers/[my publisher name]
```

<span data-ttu-id="0e89c-131">您不需要事先建立發佈者名稱，不過這些名稱必須符合發佈事件時使用的 SAS 權杖，以確保發佈者身分識別是獨立的。</span><span class="sxs-lookup"><span data-stu-id="0e89c-131">You don't have to create publisher names ahead of time, but they must match the SAS token used when publishing an event, in order to ensure independent publisher identities.</span></span> <span data-ttu-id="0e89c-132">在使用發佈者原則時，系統會將 **PartitionKey** 值設定為發佈者名稱。</span><span class="sxs-lookup"><span data-stu-id="0e89c-132">When using publisher policies, the **PartitionKey** value is set to the publisher name.</span></span> <span data-ttu-id="0e89c-133">為了正常運作，這些值必須相符。</span><span class="sxs-lookup"><span data-stu-id="0e89c-133">To work properly, these values must match.</span></span>

## <a name="capture"></a><span data-ttu-id="0e89c-134">擷取</span><span class="sxs-lookup"><span data-stu-id="0e89c-134">Capture</span></span>

<span data-ttu-id="0e89c-135">[事件中樞擷取](event-hubs-capture-overview.md)可讓您自動擷取「事件中樞」中的串流資料，然後將它儲存到您選擇的 Blob 儲存體帳戶，或是 Azure Data Lake 服務帳戶。</span><span class="sxs-lookup"><span data-stu-id="0e89c-135">[Event Hubs Capture](event-hubs-capture-overview.md) enables you to automatically capture the streaming data in Event Hubs and save it to your choice of either a Blob storage account, or an Azure Data Lake Service account.</span></span> <span data-ttu-id="0e89c-136">您可以從 Azure 入口網站啟用「擷取」，然後指定執行擷取的大小下限和時間範圍。</span><span class="sxs-lookup"><span data-stu-id="0e89c-136">You can enable Capture from the Azure portal, and specify a minimum size and time window to perform the capture.</span></span> <span data-ttu-id="0e89c-137">使用事件中樞擷取，您就可以指定自己的 Azure Blob 儲存體帳戶和容器，或是 Azure Data Lake 服務帳戶，可用來儲存擷取的資料。</span><span class="sxs-lookup"><span data-stu-id="0e89c-137">Using Event Hubs Capture, you specify your own Azure Blob Storage account and container, or Azure Data Lake Service account, which is used to store the captured data.</span></span> <span data-ttu-id="0e89c-138">擷取的資料會以 Apache Avro 格式撰寫。</span><span class="sxs-lookup"><span data-stu-id="0e89c-138">Captured data is written in the Apache Avro format.</span></span>

## <a name="partitions"></a><span data-ttu-id="0e89c-139">分割數</span><span class="sxs-lookup"><span data-stu-id="0e89c-139">Partitions</span></span>

<span data-ttu-id="0e89c-140">事件中樞透過分割取用者模式來提供訊息串流，每位取用者只會讀取訊息串流的特定子集 (即資料分割)。</span><span class="sxs-lookup"><span data-stu-id="0e89c-140">Event Hubs provides message streaming through a partitioned consumer pattern in which each consumer only reads a specific subset, or partition, of the message stream.</span></span> <span data-ttu-id="0e89c-141">此模式能水平擴充事件處理規模，並提供佇列和主題缺少的其他串流導向功能。</span><span class="sxs-lookup"><span data-stu-id="0e89c-141">This pattern enables horizontal scale for event processing and provides other stream-focused features that are unavailable in queues and topics.</span></span>

<span data-ttu-id="0e89c-142">資料分割是經過排序且保存在事件中樞內的事件序列。</span><span class="sxs-lookup"><span data-stu-id="0e89c-142">A partition is an ordered sequence of events that is held in an event hub.</span></span> <span data-ttu-id="0e89c-143">當較新的事件送達時，系統會將它們加入序列的結尾。</span><span class="sxs-lookup"><span data-stu-id="0e89c-143">As newer events arrive, they are added to the end of this sequence.</span></span> <span data-ttu-id="0e89c-144">您可以將資料分割視為一種「認可記錄」。</span><span class="sxs-lookup"><span data-stu-id="0e89c-144">A partition can be thought of as a "commit log."</span></span>

![事件中樞](./media/event-hubs-features/partition.png)

<span data-ttu-id="0e89c-146">事件中樞會將資料保留一段設定的保留時間，這段時間在事件中樞的所有資料分割上都一樣。</span><span class="sxs-lookup"><span data-stu-id="0e89c-146">Event Hubs retains data for a configured retention time that applies across all partitions in the event hub.</span></span> <span data-ttu-id="0e89c-147">事件會隨著時間經過而到期，因此您無法明確地予以刪除。</span><span class="sxs-lookup"><span data-stu-id="0e89c-147">Events expire on a time basis; you cannot explicitly delete them.</span></span> <span data-ttu-id="0e89c-148">資料分割各自獨立，只包含其本身的資料序列，通常會以不同的速度成長。</span><span class="sxs-lookup"><span data-stu-id="0e89c-148">Because partitions are independent and contain their own sequence of data, they often grow at different rates.</span></span>

![事件中樞](./media/event-hubs-features/multiple_partitions.png)

<span data-ttu-id="0e89c-150">資料分割數目是在建立時指定，值必須介於 2 到 32 之間。</span><span class="sxs-lookup"><span data-stu-id="0e89c-150">The number of partitions is specified at creation and must be between 2 and 32.</span></span> <span data-ttu-id="0e89c-151">資料分割計數不可變更，您在設定資料分割計數時，應該考慮長期的規模。</span><span class="sxs-lookup"><span data-stu-id="0e89c-151">The partition count is not changeable, so you should consider long-term scale when setting partition count.</span></span> <span data-ttu-id="0e89c-152">資料分割是一種資料組織機制，與取用端應用程式所需的下游平行處理原則有關。</span><span class="sxs-lookup"><span data-stu-id="0e89c-152">Partitions are a data organization mechanism that relates to the downstream parallelism required in consuming applications.</span></span> <span data-ttu-id="0e89c-153">事件中樞內的資料分割數目，與您預期有的並行讀取器數目直接相關。</span><span class="sxs-lookup"><span data-stu-id="0e89c-153">The number of partitions in an event hub directly relates to the number of concurrent readers you expect to have.</span></span> <span data-ttu-id="0e89c-154">您可以連絡事件中樞小組，將資料分割數目提高到 32 個以上。</span><span class="sxs-lookup"><span data-stu-id="0e89c-154">You can increase the number of partitions beyond 32 by contacting the Event Hubs team.</span></span>

<span data-ttu-id="0e89c-155">雖然可以識別並直接傳送至資料分割，但是不建議直接傳送至資料分割。</span><span class="sxs-lookup"><span data-stu-id="0e89c-155">While partitions are identifiable and can be sent to directly, sending directly to a partition is not recommended.</span></span> <span data-ttu-id="0e89c-156">相反地，您可以使用[事件發佈者](#event-publishers)和[容量](#capacity)章節中介紹的較高階建構。</span><span class="sxs-lookup"><span data-stu-id="0e89c-156">Instead, you can use higher level constructs introduced in the [Event publisher](#event-publishers) and [Capacity](#capacity) sections.</span></span> 

<span data-ttu-id="0e89c-157">資料分割中會填入一連串事件資料，內含事件本文、使用者定義屬性包，以及中繼資料，例如在資料分割中的位移和串流序列中的編號。</span><span class="sxs-lookup"><span data-stu-id="0e89c-157">Partitions are filled with a sequence of event data which contains the body of the event, a user-defined property bag, and metadata such as its offset in the partition and its number in the stream sequence.</span></span>

<span data-ttu-id="0e89c-158">如需資料分割和取捨可用性和可靠性的詳細資訊，請參閱[事件中樞程式設計指南](event-hubs-programming-guide.md#partition-key)和[事件中樞的可用性和一致性](event-hubs-availability-and-consistency.md)文章。</span><span class="sxs-lookup"><span data-stu-id="0e89c-158">For more information about partitions and the trade-off between availability and reliability, see the [Event Hubs programming guide](event-hubs-programming-guide.md#partition-key) and the [Availability and consistency in Event Hubs](event-hubs-availability-and-consistency.md) article.</span></span>

### <a name="partition-key"></a><span data-ttu-id="0e89c-159">資料分割索引鍵</span><span class="sxs-lookup"><span data-stu-id="0e89c-159">Partition key</span></span>

<span data-ttu-id="0e89c-160">您可以使用[資料分割索引鍵](event-hubs-programming-guide.md#partition-key)，將連入事件資料對應至特定的資料分割來組織資料。</span><span class="sxs-lookup"><span data-stu-id="0e89c-160">You can use a [partition key](event-hubs-programming-guide.md#partition-key) to map incoming event data into specific partitions for the purpose of data organization.</span></span> <span data-ttu-id="0e89c-161">資料分割索引鍵是由傳送者提供的值。系統會將它傳遞到事件中樞，</span><span class="sxs-lookup"><span data-stu-id="0e89c-161">The partition key is a sender-supplied value passed into an event hub.</span></span> <span data-ttu-id="0e89c-162">然後透過靜態雜湊函式加以處理，而建立資料分割指派。</span><span class="sxs-lookup"><span data-stu-id="0e89c-162">It is processed through a static hashing function, which creates the partition assignment.</span></span> <span data-ttu-id="0e89c-163">如果您在發佈事件時未指定資料分割索引鍵，系統會使用循環配置資源指派。</span><span class="sxs-lookup"><span data-stu-id="0e89c-163">If you don't specify a partition key when publishing an event, a round-robin assignment is used.</span></span>

<span data-ttu-id="0e89c-164">事件發佈行者只會知道資料分割索引鍵，不會知道事件發佈的目的地資料分割。</span><span class="sxs-lookup"><span data-stu-id="0e89c-164">The event publisher is only aware of its partition key, not the partition to which the events are published.</span></span> <span data-ttu-id="0e89c-165">索引鍵和資料分割脫鉤的這種機制，讓傳送者不需要知道太多有關下游處理的細節。</span><span class="sxs-lookup"><span data-stu-id="0e89c-165">This decoupling of key and partition insulates the sender from needing to know too much about the downstream processing.</span></span> <span data-ttu-id="0e89c-166">每部裝置或每位使用者的唯一身分識別能成為有效的資料分割索引鍵，不過像地理位置之類的其他屬性也能用來將相關事件歸納成一個資料分割。</span><span class="sxs-lookup"><span data-stu-id="0e89c-166">A per-device or user unique identity makes a good partition key, but other attributes such as geography can also be used to group related events into a single partition.</span></span>

## <a name="sas-tokens"></a><span data-ttu-id="0e89c-167">SAS 權杖</span><span class="sxs-lookup"><span data-stu-id="0e89c-167">SAS tokens</span></span>

<span data-ttu-id="0e89c-168">事件中樞使用命名空間和事件中樞層級可用的「共用存取簽章」。</span><span class="sxs-lookup"><span data-stu-id="0e89c-168">Event Hubs uses *Shared Access Signatures*, which are available at the namespace and event hub level.</span></span> <span data-ttu-id="0e89c-169">SAS 權杖可自 SAS 金鑰產生，它是經過特定格式編碼的 URL SHA 雜湊。</span><span class="sxs-lookup"><span data-stu-id="0e89c-169">A SAS token is generated from a SAS key and is an SHA hash of a URL, encoded in a specific format.</span></span> <span data-ttu-id="0e89c-170">事件中樞可以使用金鑰 (原則) 的名稱和權杖來重新產生雜湊，藉此驗證傳送者。</span><span class="sxs-lookup"><span data-stu-id="0e89c-170">Using the name of the key (policy) and the token, Event Hubs can regenerate the hash and thus authenticate the sender.</span></span> <span data-ttu-id="0e89c-171">一般而言，建立的事件發佈者 SAS 權杖只具備特定事件中樞的**傳送**權限。</span><span class="sxs-lookup"><span data-stu-id="0e89c-171">Normally, SAS tokens for event publishers are created with only **send** privileges on a specific event hub.</span></span> <span data-ttu-id="0e89c-172">此 SAS 權杖 URL 機制是導入發佈者原則之發佈者識別的基礎。</span><span class="sxs-lookup"><span data-stu-id="0e89c-172">This SAS token URL mechanism is the basis for publisher identification introduced in the publisher policy.</span></span> <span data-ttu-id="0e89c-173">如需使用 SAS 的詳細資訊，請參閱[使用服務匯流排的共用存取簽章驗證](../service-bus-messaging/service-bus-sas.md)。</span><span class="sxs-lookup"><span data-stu-id="0e89c-173">For more information about working with SAS, see [Shared Access Signature Authentication with Service Bus](../service-bus-messaging/service-bus-sas.md).</span></span>

## <a name="event-consumers"></a><span data-ttu-id="0e89c-174">事件取用者</span><span class="sxs-lookup"><span data-stu-id="0e89c-174">Event consumers</span></span>

<span data-ttu-id="0e89c-175">任何從事件中樞讀取事件資料的實體就稱為「事件取用者」。</span><span class="sxs-lookup"><span data-stu-id="0e89c-175">Any entity that reads event data from an event hub is an *event consumer*.</span></span> <span data-ttu-id="0e89c-176">所有事件中樞取用者都透過 AMQP 1.0 工作階段連接，而可供取用的事件都透過工作階段傳遞。</span><span class="sxs-lookup"><span data-stu-id="0e89c-176">All Event Hubs consumers connect via the AMQP 1.0 session and events are delivered through the session as they become available.</span></span> <span data-ttu-id="0e89c-177">用戶端不需要輪詢資料可用性。</span><span class="sxs-lookup"><span data-stu-id="0e89c-177">The client does not need to poll for data availability.</span></span>

### <a name="consumer-groups"></a><span data-ttu-id="0e89c-178">用戶群組</span><span class="sxs-lookup"><span data-stu-id="0e89c-178">Consumer groups</span></span>

<span data-ttu-id="0e89c-179">事件中樞的發佈/訂閱機制可透過「取用者群組」啟用。</span><span class="sxs-lookup"><span data-stu-id="0e89c-179">The publish/subscribe mechanism of Event Hubs is enabled through *consumer groups*.</span></span> <span data-ttu-id="0e89c-180">取用者群組是檢視整個事件中樞 (狀態、位置或位移) 的窗口。</span><span class="sxs-lookup"><span data-stu-id="0e89c-180">A consumer group is a view (state, position, or offset) of an entire event hub.</span></span> <span data-ttu-id="0e89c-181">取用者群組能讓多個取用應用程式擁有自己的事件串流檢視，以及按照自己的步調及運用自己的位移自行讀取串流。</span><span class="sxs-lookup"><span data-stu-id="0e89c-181">Consumer groups enable multiple consuming applications to each have a separate view of the event stream, and to read the stream independently at their own pace and with their own offsets.</span></span>

<span data-ttu-id="0e89c-182">在串流處理架構中，每個下游應用程式等同於一個取用者群組。</span><span class="sxs-lookup"><span data-stu-id="0e89c-182">In a stream processing architecture, each downstream application equates to a consumer group.</span></span> <span data-ttu-id="0e89c-183">如果您想要將事件資料寫入長期存放區，該存放裝置寫入器應用程式即是取用者群組。</span><span class="sxs-lookup"><span data-stu-id="0e89c-183">If you want to write event data to long-term storage, then that storage writer application is a consumer group.</span></span> <span data-ttu-id="0e89c-184">複雜的事件處理可以由另一個獨立的取用者群組來執行。</span><span class="sxs-lookup"><span data-stu-id="0e89c-184">Complex event processing can then be performed by another, separate consumer group.</span></span> <span data-ttu-id="0e89c-185">您只能透過取用者群組來存取資料分割。</span><span class="sxs-lookup"><span data-stu-id="0e89c-185">You can only access partitions through a consumer group.</span></span> <span data-ttu-id="0e89c-186">每一取用者群組的一個分割區上最多可以有 5 個並行讀取器；不過，**建議在每一取用者群組的一個分割區上只有一個作用中的接收器**。</span><span class="sxs-lookup"><span data-stu-id="0e89c-186">There can be at most 5 concurrent readers on a partition per consumer group; however **it is recommended that there is only one active receiver on a partition per consumer group**.</span></span> <span data-ttu-id="0e89c-187">每個事件中樞永遠有一個預設的取用者群組，而您可以為標準層事件中樞建立最多 20 個取用者群組。</span><span class="sxs-lookup"><span data-stu-id="0e89c-187">There is always a default consumer group in an event hub, and you can create up to 20 consumer groups for a Standard tier event hub.</span></span>

<span data-ttu-id="0e89c-188">以下是取用者群組 URI 慣例的範例：</span><span class="sxs-lookup"><span data-stu-id="0e89c-188">The following are examples of the consumer group URI convention:</span></span>

```http
//[my namespace].servicebus.windows.net/[event hub name]/[Consumer Group #1]
//[my namespace].servicebus.windows.net/[event hub name]/[Consumer Group #2]
```

<span data-ttu-id="0e89c-189">下圖顯示事件中樞串流處理架構︰</span><span class="sxs-lookup"><span data-stu-id="0e89c-189">The following figure shows the Event Hubs stream processing architecture:</span></span>

![事件中樞](./media/event-hubs-features/event_hubs_architecture.png)

### <a name="stream-offsets"></a><span data-ttu-id="0e89c-191">串流位移</span><span class="sxs-lookup"><span data-stu-id="0e89c-191">Stream offsets</span></span>

<span data-ttu-id="0e89c-192">「位移」是事件在資料分割內的位置。</span><span class="sxs-lookup"><span data-stu-id="0e89c-192">An *offset* is the position of an event within a partition.</span></span> <span data-ttu-id="0e89c-193">您可以將位移視為用戶端指標。</span><span class="sxs-lookup"><span data-stu-id="0e89c-193">You can think of an offset as a client-side cursor.</span></span> <span data-ttu-id="0e89c-194">位移是事件的位元組編號。</span><span class="sxs-lookup"><span data-stu-id="0e89c-194">The offset is a byte numbering of the event.</span></span> <span data-ttu-id="0e89c-195">此位移可讓事件取用者 (讀取器) 在事件串流中指定某個點，以便從該點開始讀取事件。</span><span class="sxs-lookup"><span data-stu-id="0e89c-195">This offset enables an event consumer (reader) to specify a point in the event stream from which they want to begin reading events.</span></span> <span data-ttu-id="0e89c-196">您可以指定時間戳記或位移值等形式的位移。</span><span class="sxs-lookup"><span data-stu-id="0e89c-196">You can specify the offset as a timestamp or as an offset value.</span></span> <span data-ttu-id="0e89c-197">取用者需負責將自己的位移值儲存在事件中樞服務之外。</span><span class="sxs-lookup"><span data-stu-id="0e89c-197">Consumers are responsible for storing their own offset values outside of the Event Hubs service.</span></span> <span data-ttu-id="0e89c-198">在資料分割內，每個事件都含有一個位移。</span><span class="sxs-lookup"><span data-stu-id="0e89c-198">Within a partition, each event includes an offset.</span></span>

![事件中樞](./media/event-hubs-features/partition_offset.png)

### <a name="checkpointing"></a><span data-ttu-id="0e89c-200">檢查點</span><span class="sxs-lookup"><span data-stu-id="0e89c-200">Checkpointing</span></span>

<span data-ttu-id="0e89c-201">*設立檢查點* 是讀取器在資料分割事件序列中標記或認可其位置的程序。</span><span class="sxs-lookup"><span data-stu-id="0e89c-201">*Checkpointing* is a process by which readers mark or commit their position within a partition event sequence.</span></span> <span data-ttu-id="0e89c-202">設立檢查點是取用者的責任，這項作業會在取用者群組內依照資料分割來進行。</span><span class="sxs-lookup"><span data-stu-id="0e89c-202">Checkpointing is the responsibility of the consumer and occurs on a per-partition basis within a consumer group.</span></span> <span data-ttu-id="0e89c-203">此責任表示在每個取用者群組內，每個資料分割讀取器必須追蹤自己目前在事件串流中的位置，而當它們認為資料串流完成時，可以通知服務。</span><span class="sxs-lookup"><span data-stu-id="0e89c-203">This responsibility means that for each consumer group, each partition reader must keep track of its current position in the event stream, and can inform the service when it considers the data stream complete.</span></span>

<span data-ttu-id="0e89c-204">如果讀取器與資料分割中斷連線，當它重新連線時，會從該取用者群組中該資料分割最後一個讀取器先前提交的檢查點開始讀取。</span><span class="sxs-lookup"><span data-stu-id="0e89c-204">If a reader disconnects from a partition, when it reconnects it begins reading at the checkpoint that was previously submitted by the last reader of that partition in that consumer group.</span></span> <span data-ttu-id="0e89c-205">當讀取器連線時，它會將此位移傳遞給事件中樞，以指定要開始讀取的位置。</span><span class="sxs-lookup"><span data-stu-id="0e89c-205">When the reader connects, it passes this offset to the event hub to specify the location at which to start reading.</span></span> <span data-ttu-id="0e89c-206">如此一來，檢查點能成為下游應用程式標記事件「完成」的方法，也能針對在不同機器上執行的讀取器提供容錯移轉發生時的恢復功能。</span><span class="sxs-lookup"><span data-stu-id="0e89c-206">In this way, you can use checkpointing to both mark events as "complete" by downstream applications, and to provide resiliency if a failover between readers running on different machines occurs.</span></span> <span data-ttu-id="0e89c-207">從這個檢查點處理程序中指定較低的位移，即可回到較舊的資料。</span><span class="sxs-lookup"><span data-stu-id="0e89c-207">It is possible to return to older data by specifying a lower offset from this checkpointing process.</span></span> <span data-ttu-id="0e89c-208">透過這項機制，檢查點可提供容錯移轉彈性，並支援事件串流重播。</span><span class="sxs-lookup"><span data-stu-id="0e89c-208">Through this mechanism, checkpointing enables both failover resiliency and event stream replay.</span></span>

### <a name="common-consumer-tasks"></a><span data-ttu-id="0e89c-209">常見的取用者工作</span><span class="sxs-lookup"><span data-stu-id="0e89c-209">Common consumer tasks</span></span>

<span data-ttu-id="0e89c-210">所有事件中樞取用者都會透過 AMQP 1.0 工作階段 (狀態感知的雙向通訊通道) 來連線。</span><span class="sxs-lookup"><span data-stu-id="0e89c-210">All Event Hubs consumers connect via an AMQP 1.0 session, a state-aware bidirectional communication channel.</span></span> <span data-ttu-id="0e89c-211">每個資料分割都有 AMQP 1.0 工作階段，有助於傳輸資料分割所隔離的事件。</span><span class="sxs-lookup"><span data-stu-id="0e89c-211">Each partition has an AMQP 1.0 session that facilitates the transport of events segregated by partition.</span></span>

#### <a name="connect-to-a-partition"></a><span data-ttu-id="0e89c-212">連接資料分割</span><span class="sxs-lookup"><span data-stu-id="0e89c-212">Connect to a partition</span></span>

<span data-ttu-id="0e89c-213">連線至資料分割時，常見的做法是使用租用機制來協調讀取器至特定資料分割的連線。</span><span class="sxs-lookup"><span data-stu-id="0e89c-213">When connecting to partitions, it is common practice to use a leasing mechanism to coordinate reader connections to specific partitions.</span></span> <span data-ttu-id="0e89c-214">如此一來，取用者群組中的每個資料分割便可能只會有一個作用中的讀取器。</span><span class="sxs-lookup"><span data-stu-id="0e89c-214">This way, it is possible for every partition in a consumer group to have only one active reader.</span></span> <span data-ttu-id="0e89c-215">使用 .NET 用戶端的 [EventProcessorHost](/dotnet/api/microsoft.servicebus.messaging.eventprocessorhost) 類別可以簡化檢查點檢查、租用和管理讀取器。</span><span class="sxs-lookup"><span data-stu-id="0e89c-215">Checkpointing, leasing, and managing readers are simplified by using the [EventProcessorHost](/dotnet/api/microsoft.servicebus.messaging.eventprocessorhost) class for .NET clients.</span></span> <span data-ttu-id="0e89c-216">事件處理器主機是智慧型取用者代理程式。</span><span class="sxs-lookup"><span data-stu-id="0e89c-216">The Event Processor Host is an intelligent consumer agent.</span></span>

#### <a name="read-events"></a><span data-ttu-id="0e89c-217">讀取事件</span><span class="sxs-lookup"><span data-stu-id="0e89c-217">Read events</span></span>

<span data-ttu-id="0e89c-218">在開啟特定資料分割的 AMQP 1.0 工作階段和連結後，事件中樞服務會將事件傳遞至 AMQP 1.0 用戶端。</span><span class="sxs-lookup"><span data-stu-id="0e89c-218">After an AMQP 1.0 session and link is opened for a specific partition, events are delivered to the AMQP 1.0 client by the Event Hubs service.</span></span> <span data-ttu-id="0e89c-219">相較於以提取為基礎的機制 (如 HTTP GET)，這個傳遞機制能產生更高的輸送量和較低的延遲。</span><span class="sxs-lookup"><span data-stu-id="0e89c-219">This delivery mechanism enables higher throughput and lower latency than pull-based mechanisms such as HTTP GET.</span></span> <span data-ttu-id="0e89c-220">將事件傳送到用戶端時，每個事件資料執行個體都包含如位移和序號等有助於在事件序列上設立檢查點的重要中繼資料。</span><span class="sxs-lookup"><span data-stu-id="0e89c-220">As events are sent to the client, each event data instance contains important metadata such as the offset and sequence number that are used to facilitate checkpointing on the event sequence.</span></span>

<span data-ttu-id="0e89c-221">事件資料︰</span><span class="sxs-lookup"><span data-stu-id="0e89c-221">Event data:</span></span>
* <span data-ttu-id="0e89c-222">Offset</span><span class="sxs-lookup"><span data-stu-id="0e89c-222">Offset</span></span>
* <span data-ttu-id="0e89c-223">序號</span><span class="sxs-lookup"><span data-stu-id="0e89c-223">Sequence number</span></span>
* <span data-ttu-id="0e89c-224">內文</span><span class="sxs-lookup"><span data-stu-id="0e89c-224">Body</span></span>
* <span data-ttu-id="0e89c-225">使用者屬性</span><span class="sxs-lookup"><span data-stu-id="0e89c-225">User properties</span></span>
* <span data-ttu-id="0e89c-226">系統屬性</span><span class="sxs-lookup"><span data-stu-id="0e89c-226">System properties</span></span>

<span data-ttu-id="0e89c-227">您必須負責管理位移。</span><span class="sxs-lookup"><span data-stu-id="0e89c-227">It is your responsibility to manage the offset.</span></span>

## <a name="capacity"></a><span data-ttu-id="0e89c-228">容量</span><span class="sxs-lookup"><span data-stu-id="0e89c-228">Capacity</span></span>

<span data-ttu-id="0e89c-229">事件中樞具有可高度調整的平行架構，在調整和縮放規模時需要考慮許多重要因素。</span><span class="sxs-lookup"><span data-stu-id="0e89c-229">Event Hubs has a highly scalable parallel architecture and there are several key factors to consider when sizing and scaling.</span></span>

### <a name="throughput-units"></a><span data-ttu-id="0e89c-230">輸送量單位</span><span class="sxs-lookup"><span data-stu-id="0e89c-230">Throughput units</span></span>

<span data-ttu-id="0e89c-231">事件中樞的輸送量容量受「輸送量單位」所控制。</span><span class="sxs-lookup"><span data-stu-id="0e89c-231">The throughput capacity of Event Hubs is controlled by *throughput units*.</span></span> <span data-ttu-id="0e89c-232">輸送量單位是預先購買的容量單位。</span><span class="sxs-lookup"><span data-stu-id="0e89c-232">Throughput units are pre-purchased units of capacity.</span></span> <span data-ttu-id="0e89c-233">單一輸送量單位包括下列容量：</span><span class="sxs-lookup"><span data-stu-id="0e89c-233">A single throughput unit includes the following capacity:</span></span>

* <span data-ttu-id="0e89c-234">輸入：每秒最多 1 MB 或 1000 個事件 (以先達到者為準)</span><span class="sxs-lookup"><span data-stu-id="0e89c-234">Ingress: Up to 1 MB per second or 1000 events per second (whichever comes first)</span></span>
* <span data-ttu-id="0e89c-235">輸出：每秒最多 2 MB。</span><span class="sxs-lookup"><span data-stu-id="0e89c-235">Egress: Up to 2 MB per second</span></span>

<span data-ttu-id="0e89c-236">超出所購買輸送量單位的容量時，輸入就開始節流，並傳回 [ServerBusyException](/dotnet/api/microsoft.servicebus.messaging.serverbusyexception)。</span><span class="sxs-lookup"><span data-stu-id="0e89c-236">Beyond the capacity of the purchased throughput units, ingress is throttled and a [ServerBusyException](/dotnet/api/microsoft.servicebus.messaging.serverbusyexception) is returned.</span></span> <span data-ttu-id="0e89c-237">輸出不會產生節流例外狀況，但仍受限於所購買輸送量單位的容量。</span><span class="sxs-lookup"><span data-stu-id="0e89c-237">Egress does not produce throttling exceptions, but is still limited to the capacity of the purchased throughput units.</span></span> <span data-ttu-id="0e89c-238">如果您收到發佈速率例外狀況，或輸出速率低於預期，請務必檢查您為命名空間所購買的輸送量單位數目。</span><span class="sxs-lookup"><span data-stu-id="0e89c-238">If you receive publishing rate exceptions or are expecting to see higher egress, be sure to check how many throughput units you have purchased for the namespace.</span></span> <span data-ttu-id="0e89c-239">在 [Azure 入口網站](https://portal.azure.com)中，您可以在命名空間的 [調整規模] 刀鋒視窗管理輸送量單位。</span><span class="sxs-lookup"><span data-stu-id="0e89c-239">You can manage throughput units on the **Scale** blade of the namespaces in the [Azure portal](https://portal.azure.com).</span></span> <span data-ttu-id="0e89c-240">您也可以使用[事件中樞 API](event-hubs-api-overview.md) 以程式設計方式管理輸送量單位。</span><span class="sxs-lookup"><span data-stu-id="0e89c-240">You can also manage throughput units programmatically using the [Event Hubs APIs](event-hubs-api-overview.md).</span></span>

<span data-ttu-id="0e89c-241">輸送量單位是以每小時計費，採預先購買制。</span><span class="sxs-lookup"><span data-stu-id="0e89c-241">Throughput units are billed per hour and are pre-purchased.</span></span> <span data-ttu-id="0e89c-242">一經購買，您至少必須支付一個小時的輸送量單位費用。</span><span class="sxs-lookup"><span data-stu-id="0e89c-242">Once purchased, throughput units are billed for a minimum of one hour.</span></span> <span data-ttu-id="0e89c-243">最多可以為一個事件中樞命名空間購買 20 個輸送量單位，讓命名空間中的所有事件中樞共用。</span><span class="sxs-lookup"><span data-stu-id="0e89c-243">Up to 20 throughput units can be purchased for an Event Hubs namespace and are shared across all Event Hubs in the namespace.</span></span>

<span data-ttu-id="0e89c-244">您可以連絡 Azure 支援中心，以 20 個為一組購買更多輸送量單位，最多 100 個輸送量單位。</span><span class="sxs-lookup"><span data-stu-id="0e89c-244">More throughput units can be purchased in blocks of 20, up to 100 throughput units, by contacting Azure support.</span></span> <span data-ttu-id="0e89c-245">之後，您還可以購買以 100 個輸送量為單位的區塊。</span><span class="sxs-lookup"><span data-stu-id="0e89c-245">Beyond that, you can also purchase blocks of 100 throughput units.</span></span>

<span data-ttu-id="0e89c-246">建議您保持輸送量單位和資料分割之間的平衡，以達到最佳規模。</span><span class="sxs-lookup"><span data-stu-id="0e89c-246">We recommend that you balance throughput units and partitions to achieve optimal scale.</span></span> <span data-ttu-id="0e89c-247">每個資料分割有一個輸送量單位的規模上限。</span><span class="sxs-lookup"><span data-stu-id="0e89c-247">A single partition has a maximum scale of one throughput unit.</span></span> <span data-ttu-id="0e89c-248">輸送量單位的數目應該要小於或等於事件中樞內的資料分割數目。</span><span class="sxs-lookup"><span data-stu-id="0e89c-248">The number of throughput units should be less than or equal to the number of partitions in an event hub.</span></span>

<span data-ttu-id="0e89c-249">如需詳細的事件中樞價格資訊，請參閱[事件中樞價格](https://azure.microsoft.com/pricing/details/event-hubs/)。</span><span class="sxs-lookup"><span data-stu-id="0e89c-249">For detailed Event Hubs pricing information, see [Event Hubs pricing](https://azure.microsoft.com/pricing/details/event-hubs/).</span></span>

## <a name="next-steps"></a><span data-ttu-id="0e89c-250">後續步驟</span><span class="sxs-lookup"><span data-stu-id="0e89c-250">Next steps</span></span>

<span data-ttu-id="0e89c-251">如需事件中樞的詳細資訊，請造訪下列連結：</span><span class="sxs-lookup"><span data-stu-id="0e89c-251">For more information about Event Hubs, visit the following links:</span></span>

* <span data-ttu-id="0e89c-252">開始使用[事件中樞教學課程][Event Hubs tutorial]</span><span class="sxs-lookup"><span data-stu-id="0e89c-252">Get started with an [Event Hubs tutorial][Event Hubs tutorial]</span></span>
* [<span data-ttu-id="0e89c-253">事件中樞程式設計指南</span><span class="sxs-lookup"><span data-stu-id="0e89c-253">Event Hubs programming guide</span></span>](event-hubs-programming-guide.md)
* [<span data-ttu-id="0e89c-254">事件中樞的可用性和一致性</span><span class="sxs-lookup"><span data-stu-id="0e89c-254">Availability and consistency in Event Hubs</span></span>](event-hubs-availability-and-consistency.md)
* [<span data-ttu-id="0e89c-255">事件中樞常見問題集</span><span class="sxs-lookup"><span data-stu-id="0e89c-255">Event Hubs FAQ</span></span>](event-hubs-faq.md)
* <span data-ttu-id="0e89c-256">[事件中樞範例][]</span><span class="sxs-lookup"><span data-stu-id="0e89c-256">[Event Hubs samples][]</span></span>

[Event Hubs tutorial]: event-hubs-dotnet-standard-getstarted-send.md
[事件中樞範例]: https://github.com/Azure/azure-event-hubs/tree/master/samples
