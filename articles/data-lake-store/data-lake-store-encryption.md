---
title: "在 Azure Data Lake Store aaaEncryption |Microsoft 文件"
description: "了解 Azure Data Lake Store 中的加密和金鑰輪替方式"
services: data-lake-store
documentationcenter: 
author: yagupta
manager: 
editor: 
ms.assetid: 
ms.service: data-lake-store
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 4/14/2017
ms.author: yagupta
ms.openlocfilehash: a9f3a2dce8232deba93005594d1e6a21e9c0cbee
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="encryption-of-data-in-azure-data-lake-store"></a><span data-ttu-id="c73e5-103">Azure Data Lake Store 中的資料加密</span><span class="sxs-lookup"><span data-stu-id="c73e5-103">Encryption of data in Azure Data Lake Store</span></span>

<span data-ttu-id="c73e5-104">Azure Data Lake Store 中的加密可協助您保護資料，實作企業安全性原則，並符合合規性需求。</span><span class="sxs-lookup"><span data-stu-id="c73e5-104">Encryption in Azure Data Lake Store helps you protect your data, implement enterprise security policies, and meet regulatory compliance requirements.</span></span> <span data-ttu-id="c73e5-105">本文章提供 hello 設計的概觀，並討論一些 hello 技術層面的實作。</span><span class="sxs-lookup"><span data-stu-id="c73e5-105">This article provides an overview of hello design, and discusses some of hello technical aspects of implementation.</span></span>

<span data-ttu-id="c73e5-106">Data Lake Store 同時支援待用資料和傳輸中資料的加密。</span><span class="sxs-lookup"><span data-stu-id="c73e5-106">Data Lake Store supports encryption of data both at rest and in transit.</span></span> <span data-ttu-id="c73e5-107">對於待用資料，Data Lake Store 支援「預設開啟」、透明加密。</span><span class="sxs-lookup"><span data-stu-id="c73e5-107">For data at rest, Data Lake Store supports "on by default," transparent encryption.</span></span> <span data-ttu-id="c73e5-108">以下是這些詞彙的更詳細說明︰</span><span class="sxs-lookup"><span data-stu-id="c73e5-108">Here is what these terms mean in a bit more detail:</span></span>

* <span data-ttu-id="c73e5-109">**上預設**: hello 預設設定當您建立新的 Data Lake Store 帳戶時，啟用加密。</span><span class="sxs-lookup"><span data-stu-id="c73e5-109">**On by default**: When you create a new Data Lake Store account, hello default setting enables encryption.</span></span> <span data-ttu-id="c73e5-110">之後，會儲存在資料湖存放區的資料會一直持續性的媒體上的加密之前 toostoring。</span><span class="sxs-lookup"><span data-stu-id="c73e5-110">Thereafter, data that is stored in Data Lake Store is always encrypted prior toostoring on persistent media.</span></span> <span data-ttu-id="c73e5-111">這是 hello 行為的所有資料，並無法在建立帳戶之後變更。</span><span class="sxs-lookup"><span data-stu-id="c73e5-111">This is hello behavior for all data, and it cannot be changed after an account is created.</span></span>
* <span data-ttu-id="c73e5-112">**透明**： 加密資料的先前 toopersisting，和解密資料的先前 tooretrieval 自動的資料湖存放區。</span><span class="sxs-lookup"><span data-stu-id="c73e5-112">**Transparent**: Data Lake Store automatically encrypts data prior toopersisting, and decrypts data prior tooretrieval.</span></span> <span data-ttu-id="c73e5-113">hello 加密 」 設定，並由系統管理員在 hello 資料湖存放區層級管理。</span><span class="sxs-lookup"><span data-stu-id="c73e5-113">hello encryption is configured and managed at hello Data Lake Store level by an administrator.</span></span> <span data-ttu-id="c73e5-114">不會變更 toohello 資料存取 Api。</span><span class="sxs-lookup"><span data-stu-id="c73e5-114">No changes are made toohello data access APIs.</span></span> <span data-ttu-id="c73e5-115">因此，因為加密而與 Data Lake Store 互動的應用程式和服務也不需要變更。</span><span class="sxs-lookup"><span data-stu-id="c73e5-115">Thus, no changes are required in applications and services that interact with Data Lake Store because of encryption.</span></span>

<span data-ttu-id="c73e5-116">傳輸中的資料 (也稱為移動中的資料) 也一律會在 Data Lake Store 中加密。</span><span class="sxs-lookup"><span data-stu-id="c73e5-116">Data in transit (also known as data in motion) is also always encrypted in Data Lake Store.</span></span> <span data-ttu-id="c73e5-117">此外 tooencrypting 資料先前 toostoring toopersistent 媒體 hello 資料也都受到保護傳輸中使用 HTTPS。</span><span class="sxs-lookup"><span data-stu-id="c73e5-117">In addition tooencrypting data prior toostoring toopersistent media, hello data is also always secured in transit by using HTTPS.</span></span> <span data-ttu-id="c73e5-118">HTTPS 是 hello 唯一的通訊協定支援的資料湖存放區 REST 介面的 hello。</span><span class="sxs-lookup"><span data-stu-id="c73e5-118">HTTPS is hello only protocol that is supported for hello Data Lake Store REST interfaces.</span></span> <span data-ttu-id="c73e5-119">hello 下圖顯示資料湖存放區中加密資料會變成：</span><span class="sxs-lookup"><span data-stu-id="c73e5-119">hello following diagram shows how data becomes encrypted in Data Lake Store:</span></span>

![Data Lake Store 中的資料加密圖表](./media/data-lake-store-encryption/fig1.png)


## <a name="set-up-encryption-with-data-lake-store"></a><span data-ttu-id="c73e5-121">使用 Data Lake Store 設定加密</span><span class="sxs-lookup"><span data-stu-id="c73e5-121">Set up encryption with Data Lake Store</span></span>

<span data-ttu-id="c73e5-122">在帳戶建立期間會設定 Data Lake Store 的加密，且預設永遠啟用。</span><span class="sxs-lookup"><span data-stu-id="c73e5-122">Encryption for Data Lake Store is set up during account creation, and it is always enabled by default.</span></span> <span data-ttu-id="c73e5-123">您可以管理您自己的 hello 金鑰，或允許 Data Lake Store toomanage 加以 （這是 hello 預設值）。</span><span class="sxs-lookup"><span data-stu-id="c73e5-123">You can either manage hello keys yourself, or allow Data Lake Store toomanage them for you (this is hello default).</span></span>

<span data-ttu-id="c73e5-124">如需詳細資訊，請參閱[開始使用](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal)。</span><span class="sxs-lookup"><span data-stu-id="c73e5-124">For more information, see [Getting started](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span></span>

## <a name="how-encryption-works-in-data-lake-store"></a><span data-ttu-id="c73e5-125">Data Lake Store 中的加密運作方式</span><span class="sxs-lookup"><span data-stu-id="c73e5-125">How encryption works in Data Lake Store</span></span>

<span data-ttu-id="c73e5-126">hello 下列資訊涵蓋 toomanage 主要加密金鑰，以及它如何解釋 hello 三種不同的類型可用於資料加密的資料湖存放區索引鍵。</span><span class="sxs-lookup"><span data-stu-id="c73e5-126">hello following information covers how toomanage master encryption keys, and it explains hello three different types of keys you can use in data encryption for Data Lake Store.</span></span>

### <a name="master-encryption-keys"></a><span data-ttu-id="c73e5-127">主要加密金鑰</span><span class="sxs-lookup"><span data-stu-id="c73e5-127">Master encryption keys</span></span>

<span data-ttu-id="c73e5-128">Data Lake Store 提供兩種管理主要加密金鑰 (MEK) 的模式。</span><span class="sxs-lookup"><span data-stu-id="c73e5-128">Data Lake Store provides two modes for management of master encryption keys (MEKs).</span></span> <span data-ttu-id="c73e5-129">現在，假設該 hello 主要加密金鑰是 hello 最上層機碼。</span><span class="sxs-lookup"><span data-stu-id="c73e5-129">For now, assume that hello master encryption key is hello top-level key.</span></span> <span data-ttu-id="c73e5-130">任何資料儲存在資料湖存放區中的必要的 toodecrypt 存取 toohello 主要加密金鑰。</span><span class="sxs-lookup"><span data-stu-id="c73e5-130">Access toohello master encryption key is required toodecrypt any data stored in Data Lake Store.</span></span>

<span data-ttu-id="c73e5-131">如下所示為 hello 兩個模式，來管理 hello 主要加密金鑰：</span><span class="sxs-lookup"><span data-stu-id="c73e5-131">hello two modes for managing hello master encryption key are as follows:</span></span>

*   <span data-ttu-id="c73e5-132">服務管理的金鑰</span><span class="sxs-lookup"><span data-stu-id="c73e5-132">Service managed keys</span></span>
*   <span data-ttu-id="c73e5-133">客戶管理的金鑰</span><span class="sxs-lookup"><span data-stu-id="c73e5-133">Customer managed keys</span></span>

<span data-ttu-id="c73e5-134">在這兩種模式中，以將其儲存在 Azure 金鑰保存庫保護 hello 主要加密金鑰。</span><span class="sxs-lookup"><span data-stu-id="c73e5-134">In both modes, hello master encryption key is secured by storing it in Azure Key Vault.</span></span> <span data-ttu-id="c73e5-135">金鑰保存庫是完全受管理高度安全服務可以使用的 toosafeguard 密碼編譯金鑰的 Azure 上。</span><span class="sxs-lookup"><span data-stu-id="c73e5-135">Key Vault is a fully managed, highly secure service on Azure that can be used toosafeguard cryptographic keys.</span></span> <span data-ttu-id="c73e5-136">如需詳細資訊，請參閱 [Key Vault](https://azure.microsoft.com/services/key-vault)。</span><span class="sxs-lookup"><span data-stu-id="c73e5-136">For more information, see [Key Vault](https://azure.microsoft.com/services/key-vault).</span></span>

<span data-ttu-id="c73e5-137">以下是簡短的 hello 兩種管理 hello MEKs 模式所提供的功能比較。</span><span class="sxs-lookup"><span data-stu-id="c73e5-137">Here is a brief comparison of capabilities provided by hello two modes of managing hello MEKs.</span></span>

|  | <span data-ttu-id="c73e5-138">服務管理的金鑰</span><span class="sxs-lookup"><span data-stu-id="c73e5-138">Service managed keys</span></span> | <span data-ttu-id="c73e5-139">客戶管理的金鑰</span><span class="sxs-lookup"><span data-stu-id="c73e5-139">Customer managed keys</span></span> |
| --- | --- | --- |
|<span data-ttu-id="c73e5-140">儲存資料的方式</span><span class="sxs-lookup"><span data-stu-id="c73e5-140">How is data stored?</span></span>|<span data-ttu-id="c73e5-141">儲存的先前 toobeing 永遠加密。</span><span class="sxs-lookup"><span data-stu-id="c73e5-141">Always encrypted prior toobeing stored.</span></span>|<span data-ttu-id="c73e5-142">儲存的先前 toobeing 永遠加密。</span><span class="sxs-lookup"><span data-stu-id="c73e5-142">Always encrypted prior toobeing stored.</span></span>|
|<span data-ttu-id="c73e5-143">Hello 主要加密金鑰儲存在哪裡？</span><span class="sxs-lookup"><span data-stu-id="c73e5-143">Where is hello Master Encryption Key stored?</span></span>|<span data-ttu-id="c73e5-144">金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="c73e5-144">Key Vault</span></span>|<span data-ttu-id="c73e5-145">金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="c73e5-145">Key Vault</span></span>|
|<span data-ttu-id="c73e5-146">是任何加密金鑰儲存在 hello 清除外部金鑰保存庫？</span><span class="sxs-lookup"><span data-stu-id="c73e5-146">Are any encryption keys stored in hello clear outside of Key Vault?</span></span> |<span data-ttu-id="c73e5-147">否</span><span class="sxs-lookup"><span data-stu-id="c73e5-147">No</span></span>|<span data-ttu-id="c73e5-148">否</span><span class="sxs-lookup"><span data-stu-id="c73e5-148">No</span></span>|
|<span data-ttu-id="c73e5-149">可以 hello MEK 擷取金鑰保存庫？</span><span class="sxs-lookup"><span data-stu-id="c73e5-149">Can hello MEK be retrieved by Key Vault?</span></span>|<span data-ttu-id="c73e5-150">否。</span><span class="sxs-lookup"><span data-stu-id="c73e5-150">No.</span></span> <span data-ttu-id="c73e5-151">之後 hello MEK 會儲存在金鑰保存庫，它只能用於加密和解密。</span><span class="sxs-lookup"><span data-stu-id="c73e5-151">After hello MEK is stored in Key Vault, it can only be used for encryption and decryption.</span></span>|<span data-ttu-id="c73e5-152">否。</span><span class="sxs-lookup"><span data-stu-id="c73e5-152">No.</span></span> <span data-ttu-id="c73e5-153">之後 hello MEK 會儲存在金鑰保存庫，它只能用於加密和解密。</span><span class="sxs-lookup"><span data-stu-id="c73e5-153">After hello MEK is stored in Key Vault, it can only be used for encryption and decryption.</span></span>|
|<span data-ttu-id="c73e5-154">Hello 金鑰保存庫執行個體和 hello MEK 擁有者是誰？</span><span class="sxs-lookup"><span data-stu-id="c73e5-154">Who owns hello Key Vault instance and hello MEK?</span></span>|<span data-ttu-id="c73e5-155">hello Data Lake Store 服務</span><span class="sxs-lookup"><span data-stu-id="c73e5-155">hello Data Lake Store service</span></span>|<span data-ttu-id="c73e5-156">您擁有 hello 金鑰保存庫執行個體，這屬於自己的 Azure 訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="c73e5-156">You own hello Key Vault instance, which belongs in your own Azure subscription.</span></span> <span data-ttu-id="c73e5-157">hello MEK 金鑰保存庫中可受軟體或硬體。</span><span class="sxs-lookup"><span data-stu-id="c73e5-157">hello MEK in Key Vault can be managed by software or hardware.</span></span>|
|<span data-ttu-id="c73e5-158">您可以撤銷存取 toohello MEK hello Data Lake Store 服務嗎？</span><span class="sxs-lookup"><span data-stu-id="c73e5-158">Can you revoke access toohello MEK for hello Data Lake Store service?</span></span>|<span data-ttu-id="c73e5-159">否</span><span class="sxs-lookup"><span data-stu-id="c73e5-159">No</span></span>|<span data-ttu-id="c73e5-160">是。</span><span class="sxs-lookup"><span data-stu-id="c73e5-160">Yes.</span></span> <span data-ttu-id="c73e5-161">您可以管理在金鑰保存庫的存取控制清單，並移除存取控制的項目 toohello 服務識別 hello Data Lake Store 服務。</span><span class="sxs-lookup"><span data-stu-id="c73e5-161">You can manage access control lists in Key Vault, and remove access control entries toohello service identity for hello Data Lake Store service.</span></span>|
|<span data-ttu-id="c73e5-162">您可以永久刪除 hello MEK 嗎？</span><span class="sxs-lookup"><span data-stu-id="c73e5-162">Can you permanently delete hello MEK?</span></span>|<span data-ttu-id="c73e5-163">否</span><span class="sxs-lookup"><span data-stu-id="c73e5-163">No</span></span>|<span data-ttu-id="c73e5-164">是。</span><span class="sxs-lookup"><span data-stu-id="c73e5-164">Yes.</span></span> <span data-ttu-id="c73e5-165">如果您刪除 hello MEK 從金鑰保存庫時，無法解密 hello Data Lake Store 帳戶中的 hello 資料的任何人，包括 hello Data Lake Store 服務。</span><span class="sxs-lookup"><span data-stu-id="c73e5-165">If you delete hello MEK from Key Vault, hello data in hello Data Lake Store account cannot be decrypted by anyone, including hello Data Lake Store service.</span></span> <br><br> <span data-ttu-id="c73e5-166">如果您已經明確備份 hello MEK 先前 toodeleting 它從金鑰保存庫，可以還原 hello MEK，和 hello 然後可復原的資料。</span><span class="sxs-lookup"><span data-stu-id="c73e5-166">If you have explicitly backed up hello MEK prior toodeleting it from Key Vault, hello MEK can be restored, and hello data can then be recovered.</span></span> <span data-ttu-id="c73e5-167">不過，如果您未備份 hello MEK 先前 toodeleting 它從金鑰保存庫，hello Data Lake Store 帳戶中的 hello 資料永遠不會解密之後。</span><span class="sxs-lookup"><span data-stu-id="c73e5-167">However, if you have not backed up hello MEK prior toodeleting it from Key Vault, hello data in hello Data Lake Store account can never be decrypted thereafter.</span></span>|


<span data-ttu-id="c73e5-168">除了這項差異的人員管理 hello MEK 和 hello 金鑰保存庫執行個體所在，hello rest hello 設計的這兩種模式是 hello 相同。</span><span class="sxs-lookup"><span data-stu-id="c73e5-168">Aside from this difference of who manages hello MEK and hello Key Vault instance in which it resides, hello rest of hello design is hello same for both modes.</span></span>

<span data-ttu-id="c73e5-169">當您選擇 hello hello 模式主要加密金鑰時，很重要的 tooremember hello 下列：</span><span class="sxs-lookup"><span data-stu-id="c73e5-169">It's important tooremember hello following when you choose hello mode for hello master encryption keys:</span></span>

*   <span data-ttu-id="c73e5-170">您可以選擇 toouse 客戶管理金鑰管理服務，當您佈建 Data Lake Store 帳戶。</span><span class="sxs-lookup"><span data-stu-id="c73e5-170">You can choose whether toouse customer managed keys or service managed keys when you provision a Data Lake Store account.</span></span>
*   <span data-ttu-id="c73e5-171">Data Lake Store 帳戶佈建之後，就無法變更 hello 模式。</span><span class="sxs-lookup"><span data-stu-id="c73e5-171">After a Data Lake Store account is provisioned, hello mode cannot be changed.</span></span>

### <a name="encryption-and-decryption-of-data"></a><span data-ttu-id="c73e5-172">資料的加密和解密</span><span class="sxs-lookup"><span data-stu-id="c73e5-172">Encryption and decryption of data</span></span>

<span data-ttu-id="c73e5-173">有三種類型的資料加密的 hello 設計中使用的索引鍵。</span><span class="sxs-lookup"><span data-stu-id="c73e5-173">There are three types of keys that are used in hello design of data encryption.</span></span> <span data-ttu-id="c73e5-174">hello 下表提供摘要：</span><span class="sxs-lookup"><span data-stu-id="c73e5-174">hello following table provides a summary:</span></span>

| <span data-ttu-id="c73e5-175">Key</span><span class="sxs-lookup"><span data-stu-id="c73e5-175">Key</span></span>                   | <span data-ttu-id="c73e5-176">縮寫</span><span class="sxs-lookup"><span data-stu-id="c73e5-176">Abbreviation</span></span> | <span data-ttu-id="c73e5-177">相關聯的項目</span><span class="sxs-lookup"><span data-stu-id="c73e5-177">Associated with</span></span> | <span data-ttu-id="c73e5-178">儲存位置</span><span class="sxs-lookup"><span data-stu-id="c73e5-178">Storage location</span></span>                             | <span data-ttu-id="c73e5-179">類型</span><span class="sxs-lookup"><span data-stu-id="c73e5-179">Type</span></span>       | <span data-ttu-id="c73e5-180">注意事項</span><span class="sxs-lookup"><span data-stu-id="c73e5-180">Notes</span></span>                                                                                                   |
|-----------------------|--------------|-----------------|----------------------------------------------|------------|---------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="c73e5-181">主要加密金鑰</span><span class="sxs-lookup"><span data-stu-id="c73e5-181">Master Encryption Key</span></span> | <span data-ttu-id="c73e5-182">MEK</span><span class="sxs-lookup"><span data-stu-id="c73e5-182">MEK</span></span>          | <span data-ttu-id="c73e5-183">Data Lake Store 帳戶</span><span class="sxs-lookup"><span data-stu-id="c73e5-183">A Data Lake Store account</span></span> | <span data-ttu-id="c73e5-184">金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="c73e5-184">Key Vault</span></span>                              | <span data-ttu-id="c73e5-185">非對稱</span><span class="sxs-lookup"><span data-stu-id="c73e5-185">Asymmetric</span></span> | <span data-ttu-id="c73e5-186">它可由 Data Lake Store 或您管理。</span><span class="sxs-lookup"><span data-stu-id="c73e5-186">It can be managed by Data Lake Store or you.</span></span>                                                              |
| <span data-ttu-id="c73e5-187">資料加密金鑰</span><span class="sxs-lookup"><span data-stu-id="c73e5-187">Data Encryption Key</span></span>   | <span data-ttu-id="c73e5-188">DEK</span><span class="sxs-lookup"><span data-stu-id="c73e5-188">DEK</span></span>          | <span data-ttu-id="c73e5-189">Data Lake Store 帳戶</span><span class="sxs-lookup"><span data-stu-id="c73e5-189">A Data Lake Store account</span></span> | <span data-ttu-id="c73e5-190">永續性儲存體，由 Data Lake Store 服務管理</span><span class="sxs-lookup"><span data-stu-id="c73e5-190">Persistent storage, managed by Data Lake Store service</span></span> | <span data-ttu-id="c73e5-191">對稱</span><span class="sxs-lookup"><span data-stu-id="c73e5-191">Symmetric</span></span>  | <span data-ttu-id="c73e5-192">hello MEK 加密 hello DEK。</span><span class="sxs-lookup"><span data-stu-id="c73e5-192">hello DEK is encrypted by hello MEK.</span></span> <span data-ttu-id="c73e5-193">hello 加密的 DEK 是永續性的媒體上儲存的內容。</span><span class="sxs-lookup"><span data-stu-id="c73e5-193">hello encrypted DEK is what is stored on persistent media.</span></span> |
| <span data-ttu-id="c73e5-194">區塊加密金鑰</span><span class="sxs-lookup"><span data-stu-id="c73e5-194">Block Encryption Key</span></span>  | <span data-ttu-id="c73e5-195">BEK</span><span class="sxs-lookup"><span data-stu-id="c73e5-195">BEK</span></span>          | <span data-ttu-id="c73e5-196">資料區塊</span><span class="sxs-lookup"><span data-stu-id="c73e5-196">A block of data</span></span> | <span data-ttu-id="c73e5-197">None</span><span class="sxs-lookup"><span data-stu-id="c73e5-197">None</span></span>                                         | <span data-ttu-id="c73e5-198">對稱</span><span class="sxs-lookup"><span data-stu-id="c73e5-198">Symmetric</span></span>  | <span data-ttu-id="c73e5-199">hello BEK 被衍生自 hello DEK 和 hello 資料區塊。</span><span class="sxs-lookup"><span data-stu-id="c73e5-199">hello BEK is derived from hello DEK and hello data block.</span></span>                                                      |

<span data-ttu-id="c73e5-200">hello 下列圖表將說明這些概念：</span><span class="sxs-lookup"><span data-stu-id="c73e5-200">hello following diagram illustrates these concepts:</span></span>

![資料加密中的加密](./media/data-lake-store-encryption/fig2.png)

#### <a name="pseudo-algorithm-when-a-file-is-toobe-decrypted"></a><span data-ttu-id="c73e5-202">虛擬演算法 toobe 解密檔案時：</span><span class="sxs-lookup"><span data-stu-id="c73e5-202">Pseudo algorithm when a file is toobe decrypted:</span></span>
1.  <span data-ttu-id="c73e5-203">檢查 hello DEK hello Data Lake Store 帳戶是否為快取，並且可供使用。</span><span class="sxs-lookup"><span data-stu-id="c73e5-203">Check if hello DEK for hello Data Lake Store account is cached and ready for use.</span></span>
    - <span data-ttu-id="c73e5-204">如果沒有，然後閱讀 hello 從永續性儲存體，加密 DEK，並將它送出 tooKey 保存庫 toobe 解密。</span><span class="sxs-lookup"><span data-stu-id="c73e5-204">If not, then read hello encrypted DEK from persistent storage, and send it tooKey Vault toobe decrypted.</span></span> <span data-ttu-id="c73e5-205">快取 hello 解密 DEK 在記憶體中。</span><span class="sxs-lookup"><span data-stu-id="c73e5-205">Cache hello decrypted DEK in memory.</span></span> <span data-ttu-id="c73e5-206">已經準備好 toouse。</span><span class="sxs-lookup"><span data-stu-id="c73e5-206">It is now ready toouse.</span></span>
2.  <span data-ttu-id="c73e5-207">針對每個區塊 hello 檔案中的資料：</span><span class="sxs-lookup"><span data-stu-id="c73e5-207">For every block of data in hello file:</span></span>
    - <span data-ttu-id="c73e5-208">讀取永續性儲存體中的 hello 加密的資料區塊。</span><span class="sxs-lookup"><span data-stu-id="c73e5-208">Read hello encrypted block of data from persistent storage.</span></span>
    - <span data-ttu-id="c73e5-209">產生從 hello DEK hello BEK 和 hello 加密的資料區塊。</span><span class="sxs-lookup"><span data-stu-id="c73e5-209">Generate hello BEK from hello DEK and hello encrypted block of data.</span></span>
    - <span data-ttu-id="c73e5-210">使用 hello BEK toodecrypt 資料。</span><span class="sxs-lookup"><span data-stu-id="c73e5-210">Use hello BEK toodecrypt data.</span></span>


#### <a name="pseudo-algorithm-when-a-block-of-data-is-toobe-encrypted"></a><span data-ttu-id="c73e5-211">虛擬演算法 toobe 加密的資料區塊時：</span><span class="sxs-lookup"><span data-stu-id="c73e5-211">Pseudo algorithm when a block of data is toobe encrypted:</span></span>
1.  <span data-ttu-id="c73e5-212">檢查 hello DEK hello Data Lake Store 帳戶是否為快取，並且可供使用。</span><span class="sxs-lookup"><span data-stu-id="c73e5-212">Check if hello DEK for hello Data Lake Store account is cached and ready for use.</span></span>
    - <span data-ttu-id="c73e5-213">如果沒有，然後閱讀 hello 從永續性儲存體，加密 DEK，並將它送出 tooKey 保存庫 toobe 解密。</span><span class="sxs-lookup"><span data-stu-id="c73e5-213">If not, then read hello encrypted DEK from persistent storage, and send it tooKey Vault toobe decrypted.</span></span> <span data-ttu-id="c73e5-214">快取 hello 解密 DEK 在記憶體中。</span><span class="sxs-lookup"><span data-stu-id="c73e5-214">Cache hello decrypted DEK in memory.</span></span> <span data-ttu-id="c73e5-215">已經準備好 toouse。</span><span class="sxs-lookup"><span data-stu-id="c73e5-215">It is now ready toouse.</span></span>
2.  <span data-ttu-id="c73e5-216">從 hello DEK 產生唯一 BEK hello 區塊的資料。</span><span class="sxs-lookup"><span data-stu-id="c73e5-216">Generate a unique BEK for hello block of data from hello DEK.</span></span>
3.  <span data-ttu-id="c73e5-217">使用 aes-256 加密來加密與 hello BEK，hello 資料區塊。</span><span class="sxs-lookup"><span data-stu-id="c73e5-217">Encrypt hello data block with hello BEK, by using AES-256 encryption.</span></span>
4.  <span data-ttu-id="c73e5-218">永續性儲存體上的資料存放區 hello 加密的資料區塊。</span><span class="sxs-lookup"><span data-stu-id="c73e5-218">Store hello encrypted data block of data on persistent storage.</span></span>

> [!NOTE] 
> <span data-ttu-id="c73e5-219">基於效能考量，hello DEK hello 中的清除快取在記憶體中的一段時間，並會立即被清除之後。</span><span class="sxs-lookup"><span data-stu-id="c73e5-219">For performance reasons, hello DEK in hello clear is cached in memory for a short time, and is immediately erased afterward.</span></span> <span data-ttu-id="c73e5-220">持續在媒體上，它會一律加密儲存 hello MEK。</span><span class="sxs-lookup"><span data-stu-id="c73e5-220">On persistent media, it is always stored encrypted by hello MEK.</span></span>

## <a name="key-rotation"></a><span data-ttu-id="c73e5-221">金鑰輪替</span><span class="sxs-lookup"><span data-stu-id="c73e5-221">Key rotation</span></span>

<span data-ttu-id="c73e5-222">當您使用客戶管理的金鑰時，您可以旋轉 hello MEK。</span><span class="sxs-lookup"><span data-stu-id="c73e5-222">When you are using customer-managed keys, you can rotate hello MEK.</span></span> <span data-ttu-id="c73e5-223">如何查看客戶管理的金鑰，以建立 Data Lake Store 帳戶 tooset toolearn[入門](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal)。</span><span class="sxs-lookup"><span data-stu-id="c73e5-223">toolearn how tooset up a Data Lake Store account with customer-managed keys, see [Getting started](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span></span>

### <a name="prerequisites"></a><span data-ttu-id="c73e5-224">必要條件</span><span class="sxs-lookup"><span data-stu-id="c73e5-224">Prerequisites</span></span>

<span data-ttu-id="c73e5-225">當您設定 hello Data Lake Store 帳戶時，您已選擇 toouse 您自己的金鑰。</span><span class="sxs-lookup"><span data-stu-id="c73e5-225">When you set up hello Data Lake Store account, you have chosen toouse your own keys.</span></span> <span data-ttu-id="c73e5-226">建立 hello 帳戶之後，就無法變更此選項。</span><span class="sxs-lookup"><span data-stu-id="c73e5-226">This option cannot be changed after hello account has been created.</span></span> <span data-ttu-id="c73e5-227">hello 下列步驟假設您使用客戶管理的金鑰 （也就是您已選擇您自己的金鑰從金鑰保存庫）。</span><span class="sxs-lookup"><span data-stu-id="c73e5-227">hello following steps assume that you are using customer-managed keys (that is, you have chosen your own keys from Key Vault).</span></span>

<span data-ttu-id="c73e5-228">請注意，是否您使用加密 hello 預設選項，您的資料永遠加密使用金鑰管理的資料湖存放區。</span><span class="sxs-lookup"><span data-stu-id="c73e5-228">Note that if you use hello default options for encryption, your data is always encrypted by using keys managed by Data Lake Store.</span></span> <span data-ttu-id="c73e5-229">在本選項中，您不需要 hello 能力 toorotate 索引鍵，因為由資料湖存放區。</span><span class="sxs-lookup"><span data-stu-id="c73e5-229">In this option, you don't have hello ability toorotate keys, as they are managed by Data Lake Store.</span></span>

### <a name="how-toorotate-hello-mek-in-data-lake-store"></a><span data-ttu-id="c73e5-230">Toorotate hello MEK 資料湖存放區中的方式</span><span class="sxs-lookup"><span data-stu-id="c73e5-230">How toorotate hello MEK in Data Lake Store</span></span>

1. <span data-ttu-id="c73e5-231">登入 toohello [Azure 入口網站](https://portal.azure.com/)。</span><span class="sxs-lookup"><span data-stu-id="c73e5-231">Sign in toohello [Azure portal](https://portal.azure.com/).</span></span>
2. <span data-ttu-id="c73e5-232">瀏覽 toohello 金鑰保存庫執行個體來儲存您 Data Lake Store 帳戶相關聯的金鑰。</span><span class="sxs-lookup"><span data-stu-id="c73e5-232">Browse toohello Key Vault instance that stores your keys associated with your Data Lake Store account.</span></span> <span data-ttu-id="c73e5-233">選取 [金鑰]。</span><span class="sxs-lookup"><span data-stu-id="c73e5-233">Select **Keys**.</span></span>

    ![Key Vault 的螢幕擷取畫面](./media/data-lake-store-encryption/keyvault.png)

3.  <span data-ttu-id="c73e5-235">選取與您的 Data Lake Store 帳戶相關聯的 hello 金鑰並建立新的版本，此機碼。</span><span class="sxs-lookup"><span data-stu-id="c73e5-235">Select hello key associated with your Data Lake Store account, and create a new version of this key.</span></span> <span data-ttu-id="c73e5-236">請注意，資料湖存放區目前僅支援金鑰輪替 tooa 新版本的金鑰。</span><span class="sxs-lookup"><span data-stu-id="c73e5-236">Note that Data Lake Store currently only supports key rotation tooa new version of a key.</span></span> <span data-ttu-id="c73e5-237">它不支援繞 tooa 不同的索引鍵。</span><span class="sxs-lookup"><span data-stu-id="c73e5-237">It doesn't support rotating tooa different key.</span></span>

   ![[金鑰] 視窗的螢幕擷取畫面 (醒目提示 [新增版本])](./media/data-lake-store-encryption/keynewversion.png)

4.  <span data-ttu-id="c73e5-239">瀏覽 toohello 資料湖存放區儲存體帳戶，並選取**加密**。</span><span class="sxs-lookup"><span data-stu-id="c73e5-239">Browse toohello Data Lake Store storage account, and select **Encryption**.</span></span>

    ![Data Lake Store 儲存體帳戶視窗的螢幕擷取畫面 (醒目提示 [加密])](./media/data-lake-store-encryption/select-encryption.png)

5.  <span data-ttu-id="c73e5-241">訊息會告知您金鑰新版 hello 索引鍵可供使用。</span><span class="sxs-lookup"><span data-stu-id="c73e5-241">A message notifies you that a new key version of hello key is available.</span></span> <span data-ttu-id="c73e5-242">按一下**旋轉金鑰**tooupdate hello 金鑰 toohello 新版本。</span><span class="sxs-lookup"><span data-stu-id="c73e5-242">Click **Rotate Key** tooupdate hello key toohello new version.</span></span>

    ![Data Lake Store 視窗的螢幕擷取畫面 (含有訊息並醒目提示 [輪替金鑰])](./media/data-lake-store-encryption/rotatekey.png)

<span data-ttu-id="c73e5-244">這項作業花費時間不超過 2 分鐘，而且沒有預期的停機時間，因為 tookey 旋轉。</span><span class="sxs-lookup"><span data-stu-id="c73e5-244">This operation should take less than two minutes, and there is no expected downtime due tookey rotation.</span></span> <span data-ttu-id="c73e5-245">Hello 作業已完成之後，新版 hello 金鑰 hello 正在使用中。</span><span class="sxs-lookup"><span data-stu-id="c73e5-245">After hello operation is complete, hello new version of hello key is in use.</span></span>
