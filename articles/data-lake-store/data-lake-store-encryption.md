---
title: "Azure Data Lake Store 中的加密 | Microsoft Docs"
description: "了解 Azure Data Lake Store 中的加密和金鑰輪替方式"
services: data-lake-store
documentationcenter: 
author: yagupta
manager: 
editor: 
ms.assetid: 
ms.service: data-lake-store
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 4/14/2017
ms.author: yagupta
ms.openlocfilehash: 20444d368c568ee716ff242e33323b91ffd198eb
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="encryption-of-data-in-azure-data-lake-store"></a><span data-ttu-id="6245e-103">Azure Data Lake Store 中的資料加密</span><span class="sxs-lookup"><span data-stu-id="6245e-103">Encryption of data in Azure Data Lake Store</span></span>

<span data-ttu-id="6245e-104">Azure Data Lake Store 中的加密可協助您保護資料，實作企業安全性原則，並符合合規性需求。</span><span class="sxs-lookup"><span data-stu-id="6245e-104">Encryption in Azure Data Lake Store helps you protect your data, implement enterprise security policies, and meet regulatory compliance requirements.</span></span> <span data-ttu-id="6245e-105">本文提供設計概觀，並討論實作的一些技術層面。</span><span class="sxs-lookup"><span data-stu-id="6245e-105">This article provides an overview of the design, and discusses some of the technical aspects of implementation.</span></span>

<span data-ttu-id="6245e-106">Data Lake Store 同時支援待用資料和傳輸中資料的加密。</span><span class="sxs-lookup"><span data-stu-id="6245e-106">Data Lake Store supports encryption of data both at rest and in transit.</span></span> <span data-ttu-id="6245e-107">對於待用資料，Data Lake Store 支援「預設開啟」、透明加密。</span><span class="sxs-lookup"><span data-stu-id="6245e-107">For data at rest, Data Lake Store supports "on by default," transparent encryption.</span></span> <span data-ttu-id="6245e-108">以下是這些詞彙的更詳細說明︰</span><span class="sxs-lookup"><span data-stu-id="6245e-108">Here is what these terms mean in a bit more detail:</span></span>

* <span data-ttu-id="6245e-109">**預設開啟**︰建立新的 Data Lake Store 帳戶時，預設設定會啟用加密。</span><span class="sxs-lookup"><span data-stu-id="6245e-109">**On by default**: When you create a new Data Lake Store account, the default setting enables encryption.</span></span> <span data-ttu-id="6245e-110">因此，Data Lake Store 中儲存的資料一律會在儲存於持續性媒體之前進行加密。</span><span class="sxs-lookup"><span data-stu-id="6245e-110">Thereafter, data that is stored in Data Lake Store is always encrypted prior to storing on persistent media.</span></span> <span data-ttu-id="6245e-111">這是所有資料的行為，建立帳戶之後便無法變更。</span><span class="sxs-lookup"><span data-stu-id="6245e-111">This is the behavior for all data, and it cannot be changed after an account is created.</span></span>
* <span data-ttu-id="6245e-112">**透明**：Data Lake Store 會在保存資料前自動加密，以及在擷取之前將資料解密。</span><span class="sxs-lookup"><span data-stu-id="6245e-112">**Transparent**: Data Lake Store automatically encrypts data prior to persisting, and decrypts data prior to retrieval.</span></span> <span data-ttu-id="6245e-113">系統管理員會在 Data Lake Store 層級設定和管理加密。</span><span class="sxs-lookup"><span data-stu-id="6245e-113">The encryption is configured and managed at the Data Lake Store level by an administrator.</span></span> <span data-ttu-id="6245e-114">資料存取 API 不會變更。</span><span class="sxs-lookup"><span data-stu-id="6245e-114">No changes are made to the data access APIs.</span></span> <span data-ttu-id="6245e-115">因此，因為加密而與 Data Lake Store 互動的應用程式和服務也不需要變更。</span><span class="sxs-lookup"><span data-stu-id="6245e-115">Thus, no changes are required in applications and services that interact with Data Lake Store because of encryption.</span></span>

<span data-ttu-id="6245e-116">傳輸中的資料 (也稱為移動中的資料) 也一律會在 Data Lake Store 中加密。</span><span class="sxs-lookup"><span data-stu-id="6245e-116">Data in transit (also known as data in motion) is also always encrypted in Data Lake Store.</span></span> <span data-ttu-id="6245e-117">除了在儲存至持續性媒體之前加密資料，也一律會使用 HTTPS 保護傳輸中的資料。</span><span class="sxs-lookup"><span data-stu-id="6245e-117">In addition to encrypting data prior to storing to persistent media, the data is also always secured in transit by using HTTPS.</span></span> <span data-ttu-id="6245e-118">HTTPS 是 Data Lake Store REST 介面支援的唯一通訊協定。</span><span class="sxs-lookup"><span data-stu-id="6245e-118">HTTPS is the only protocol that is supported for the Data Lake Store REST interfaces.</span></span> <span data-ttu-id="6245e-119">下圖顯示如何在 Data Lake Store 中將資料加密︰</span><span class="sxs-lookup"><span data-stu-id="6245e-119">The following diagram shows how data becomes encrypted in Data Lake Store:</span></span>

![Data Lake Store 中的資料加密圖表](./media/data-lake-store-encryption/fig1.png)


## <a name="set-up-encryption-with-data-lake-store"></a><span data-ttu-id="6245e-121">使用 Data Lake Store 設定加密</span><span class="sxs-lookup"><span data-stu-id="6245e-121">Set up encryption with Data Lake Store</span></span>

<span data-ttu-id="6245e-122">在帳戶建立期間會設定 Data Lake Store 的加密，且預設永遠啟用。</span><span class="sxs-lookup"><span data-stu-id="6245e-122">Encryption for Data Lake Store is set up during account creation, and it is always enabled by default.</span></span> <span data-ttu-id="6245e-123">您可以自行管理金鑰，或允許 Data Lake Store 為您管理 (這是預設值)。</span><span class="sxs-lookup"><span data-stu-id="6245e-123">You can either manage the keys yourself, or allow Data Lake Store to manage them for you (this is the default).</span></span>

<span data-ttu-id="6245e-124">如需詳細資訊，請參閱[開始使用](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal)。</span><span class="sxs-lookup"><span data-stu-id="6245e-124">For more information, see [Getting started](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span></span>

## <a name="how-encryption-works-in-data-lake-store"></a><span data-ttu-id="6245e-125">Data Lake Store 中的加密運作方式</span><span class="sxs-lookup"><span data-stu-id="6245e-125">How encryption works in Data Lake Store</span></span>

<span data-ttu-id="6245e-126">下列資訊涵蓋如何管理主要加密金鑰，並說明您可以使用於 Data Lake Store 資料加密的三種金鑰類型。</span><span class="sxs-lookup"><span data-stu-id="6245e-126">The following information covers how to manage master encryption keys, and it explains the three different types of keys you can use in data encryption for Data Lake Store.</span></span>

### <a name="master-encryption-keys"></a><span data-ttu-id="6245e-127">主要加密金鑰</span><span class="sxs-lookup"><span data-stu-id="6245e-127">Master encryption keys</span></span>

<span data-ttu-id="6245e-128">Data Lake Store 提供兩種管理主要加密金鑰 (MEK) 的模式。</span><span class="sxs-lookup"><span data-stu-id="6245e-128">Data Lake Store provides two modes for management of master encryption keys (MEKs).</span></span> <span data-ttu-id="6245e-129">現在，假設主要加密金鑰是最上層金鑰。</span><span class="sxs-lookup"><span data-stu-id="6245e-129">For now, assume that the master encryption key is the top-level key.</span></span> <span data-ttu-id="6245e-130">需要有主要加密金鑰的存取權，才能將任何儲存在 Data Lake Store 中的資料解密。</span><span class="sxs-lookup"><span data-stu-id="6245e-130">Access to the master encryption key is required to decrypt any data stored in Data Lake Store.</span></span>

<span data-ttu-id="6245e-131">管理主要加密金鑰的兩種模式如下︰</span><span class="sxs-lookup"><span data-stu-id="6245e-131">The two modes for managing the master encryption key are as follows:</span></span>

*   <span data-ttu-id="6245e-132">服務管理的金鑰</span><span class="sxs-lookup"><span data-stu-id="6245e-132">Service managed keys</span></span>
*   <span data-ttu-id="6245e-133">客戶管理的金鑰</span><span class="sxs-lookup"><span data-stu-id="6245e-133">Customer managed keys</span></span>

<span data-ttu-id="6245e-134">這兩種模式都會將主要加密金鑰儲存在 Azure Key Vault 中進行保護。</span><span class="sxs-lookup"><span data-stu-id="6245e-134">In both modes, the master encryption key is secured by storing it in Azure Key Vault.</span></span> <span data-ttu-id="6245e-135">Key Vault 是 Azure 上受到完整管理、高度安全的服務，可用來保護加密金鑰。</span><span class="sxs-lookup"><span data-stu-id="6245e-135">Key Vault is a fully managed, highly secure service on Azure that can be used to safeguard cryptographic keys.</span></span> <span data-ttu-id="6245e-136">如需詳細資訊，請參閱 [Key Vault](https://azure.microsoft.com/services/key-vault)。</span><span class="sxs-lookup"><span data-stu-id="6245e-136">For more information, see [Key Vault](https://azure.microsoft.com/services/key-vault).</span></span>

<span data-ttu-id="6245e-137">以下是兩種管理 MEK 模式所提供的簡潔功能比較。</span><span class="sxs-lookup"><span data-stu-id="6245e-137">Here is a brief comparison of capabilities provided by the two modes of managing the MEKs.</span></span>

|  | <span data-ttu-id="6245e-138">服務管理的金鑰</span><span class="sxs-lookup"><span data-stu-id="6245e-138">Service managed keys</span></span> | <span data-ttu-id="6245e-139">客戶管理的金鑰</span><span class="sxs-lookup"><span data-stu-id="6245e-139">Customer managed keys</span></span> |
| --- | --- | --- |
|<span data-ttu-id="6245e-140">儲存資料的方式</span><span class="sxs-lookup"><span data-stu-id="6245e-140">How is data stored?</span></span>|<span data-ttu-id="6245e-141">一律在儲存之前加密。</span><span class="sxs-lookup"><span data-stu-id="6245e-141">Always encrypted prior to being stored.</span></span>|<span data-ttu-id="6245e-142">一律在儲存之前加密。</span><span class="sxs-lookup"><span data-stu-id="6245e-142">Always encrypted prior to being stored.</span></span>|
|<span data-ttu-id="6245e-143">主要加密金鑰的儲存位置</span><span class="sxs-lookup"><span data-stu-id="6245e-143">Where is the Master Encryption Key stored?</span></span>|<span data-ttu-id="6245e-144">金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="6245e-144">Key Vault</span></span>|<span data-ttu-id="6245e-145">金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="6245e-145">Key Vault</span></span>|
|<span data-ttu-id="6245e-146">任何加密金鑰是否會完全儲存在 Key Vault 外部？</span><span class="sxs-lookup"><span data-stu-id="6245e-146">Are any encryption keys stored in the clear outside of Key Vault?</span></span> |<span data-ttu-id="6245e-147">否</span><span class="sxs-lookup"><span data-stu-id="6245e-147">No</span></span>|<span data-ttu-id="6245e-148">否</span><span class="sxs-lookup"><span data-stu-id="6245e-148">No</span></span>|
|<span data-ttu-id="6245e-149">Key Vault 是否可以擷取 MEK？</span><span class="sxs-lookup"><span data-stu-id="6245e-149">Can the MEK be retrieved by Key Vault?</span></span>|<span data-ttu-id="6245e-150">否。</span><span class="sxs-lookup"><span data-stu-id="6245e-150">No.</span></span> <span data-ttu-id="6245e-151">MEK 儲存於 Key Vault 之後，就只能用來加密和解密。</span><span class="sxs-lookup"><span data-stu-id="6245e-151">After the MEK is stored in Key Vault, it can only be used for encryption and decryption.</span></span>|<span data-ttu-id="6245e-152">否。</span><span class="sxs-lookup"><span data-stu-id="6245e-152">No.</span></span> <span data-ttu-id="6245e-153">MEK 儲存於 Key Vault 之後，就只能用來加密和解密。</span><span class="sxs-lookup"><span data-stu-id="6245e-153">After the MEK is stored in Key Vault, it can only be used for encryption and decryption.</span></span>|
|<span data-ttu-id="6245e-154">誰擁有 Key Vault 執行個體和 MEK？</span><span class="sxs-lookup"><span data-stu-id="6245e-154">Who owns the Key Vault instance and the MEK?</span></span>|<span data-ttu-id="6245e-155">Data Lake Store 服務</span><span class="sxs-lookup"><span data-stu-id="6245e-155">The Data Lake Store service</span></span>|<span data-ttu-id="6245e-156">您擁有 Key Vault 執行個體，其屬於您自己的 Azure 訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="6245e-156">You own the Key Vault instance, which belongs in your own Azure subscription.</span></span> <span data-ttu-id="6245e-157">Key Vault 中的 MEK 可以由軟體或硬體管理。</span><span class="sxs-lookup"><span data-stu-id="6245e-157">The MEK in Key Vault can be managed by software or hardware.</span></span>|
|<span data-ttu-id="6245e-158">您是否可以撤銷 Data Lake Store 服務對於 MEK 的存取權？</span><span class="sxs-lookup"><span data-stu-id="6245e-158">Can you revoke access to the MEK for the Data Lake Store service?</span></span>|<span data-ttu-id="6245e-159">否</span><span class="sxs-lookup"><span data-stu-id="6245e-159">No</span></span>|<span data-ttu-id="6245e-160">是。</span><span class="sxs-lookup"><span data-stu-id="6245e-160">Yes.</span></span> <span data-ttu-id="6245e-161">您可以管理 Key Vault 中的存取控制清單，並移除 Data Lake Store 服務之服務識別的存取控制項目。</span><span class="sxs-lookup"><span data-stu-id="6245e-161">You can manage access control lists in Key Vault, and remove access control entries to the service identity for the Data Lake Store service.</span></span>|
|<span data-ttu-id="6245e-162">您是否可以永久刪除 MEK？</span><span class="sxs-lookup"><span data-stu-id="6245e-162">Can you permanently delete the MEK?</span></span>|<span data-ttu-id="6245e-163">否</span><span class="sxs-lookup"><span data-stu-id="6245e-163">No</span></span>|<span data-ttu-id="6245e-164">是。</span><span class="sxs-lookup"><span data-stu-id="6245e-164">Yes.</span></span> <span data-ttu-id="6245e-165">如果您從 Key Vault 中刪除 MEK，任何人 (包括 Data Lake Store 服務) 都無法將 Data Lake Store 帳戶中的資料解密。</span><span class="sxs-lookup"><span data-stu-id="6245e-165">If you delete the MEK from Key Vault, the data in the Data Lake Store account cannot be decrypted by anyone, including the Data Lake Store service.</span></span> <br><br> <span data-ttu-id="6245e-166">如果從 Key Vault 中刪除 MEK 之前，您已明確進行備份，即可還原 MEK，進而復原資料。</span><span class="sxs-lookup"><span data-stu-id="6245e-166">If you have explicitly backed up the MEK prior to deleting it from Key Vault, the MEK can be restored, and the data can then be recovered.</span></span> <span data-ttu-id="6245e-167">不過，如果從 Key Vault 中刪除 MEK 之前，您尚未進行備份，則 Data Lake Store 帳戶中的資料之後就永遠無法解密。</span><span class="sxs-lookup"><span data-stu-id="6245e-167">However, if you have not backed up the MEK prior to deleting it from Key Vault, the data in the Data Lake Store account can never be decrypted thereafter.</span></span>|


<span data-ttu-id="6245e-168">除了誰負責管理 MEK 及其所在 Key Vault 執行個體的這項差異，這兩種模式的其餘設計都相同。</span><span class="sxs-lookup"><span data-stu-id="6245e-168">Aside from this difference of who manages the MEK and the Key Vault instance in which it resides, the rest of the design is the same for both modes.</span></span>

<span data-ttu-id="6245e-169">選擇主要加密金鑰的模式時，請務必記住下列幾點：</span><span class="sxs-lookup"><span data-stu-id="6245e-169">It's important to remember the following when you choose the mode for the master encryption keys:</span></span>

*   <span data-ttu-id="6245e-170">您可以在佈建 Data Lake Store 帳戶時，選擇使用客戶管理的金鑰或服務管理的金鑰。</span><span class="sxs-lookup"><span data-stu-id="6245e-170">You can choose whether to use customer managed keys or service managed keys when you provision a Data Lake Store account.</span></span>
*   <span data-ttu-id="6245e-171">佈建 Data Lake Store 帳戶之後，就無法變更模式。</span><span class="sxs-lookup"><span data-stu-id="6245e-171">After a Data Lake Store account is provisioned, the mode cannot be changed.</span></span>

### <a name="encryption-and-decryption-of-data"></a><span data-ttu-id="6245e-172">資料的加密和解密</span><span class="sxs-lookup"><span data-stu-id="6245e-172">Encryption and decryption of data</span></span>

<span data-ttu-id="6245e-173">資料加密設計使用三種金鑰類型。</span><span class="sxs-lookup"><span data-stu-id="6245e-173">There are three types of keys that are used in the design of data encryption.</span></span> <span data-ttu-id="6245e-174">下表提供摘要：</span><span class="sxs-lookup"><span data-stu-id="6245e-174">The following table provides a summary:</span></span>

| <span data-ttu-id="6245e-175">索引鍵</span><span class="sxs-lookup"><span data-stu-id="6245e-175">Key</span></span>                   | <span data-ttu-id="6245e-176">縮寫</span><span class="sxs-lookup"><span data-stu-id="6245e-176">Abbreviation</span></span> | <span data-ttu-id="6245e-177">相關聯的項目</span><span class="sxs-lookup"><span data-stu-id="6245e-177">Associated with</span></span> | <span data-ttu-id="6245e-178">儲存位置</span><span class="sxs-lookup"><span data-stu-id="6245e-178">Storage location</span></span>                             | <span data-ttu-id="6245e-179">類型</span><span class="sxs-lookup"><span data-stu-id="6245e-179">Type</span></span>       | <span data-ttu-id="6245e-180">注意事項</span><span class="sxs-lookup"><span data-stu-id="6245e-180">Notes</span></span>                                                                                                   |
|-----------------------|--------------|-----------------|----------------------------------------------|------------|---------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="6245e-181">主要加密金鑰</span><span class="sxs-lookup"><span data-stu-id="6245e-181">Master Encryption Key</span></span> | <span data-ttu-id="6245e-182">MEK</span><span class="sxs-lookup"><span data-stu-id="6245e-182">MEK</span></span>          | <span data-ttu-id="6245e-183">Data Lake Store 帳戶</span><span class="sxs-lookup"><span data-stu-id="6245e-183">A Data Lake Store account</span></span> | <span data-ttu-id="6245e-184">金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="6245e-184">Key Vault</span></span>                              | <span data-ttu-id="6245e-185">非對稱</span><span class="sxs-lookup"><span data-stu-id="6245e-185">Asymmetric</span></span> | <span data-ttu-id="6245e-186">它可由 Data Lake Store 或您管理。</span><span class="sxs-lookup"><span data-stu-id="6245e-186">It can be managed by Data Lake Store or you.</span></span>                                                              |
| <span data-ttu-id="6245e-187">資料加密金鑰</span><span class="sxs-lookup"><span data-stu-id="6245e-187">Data Encryption Key</span></span>   | <span data-ttu-id="6245e-188">DEK</span><span class="sxs-lookup"><span data-stu-id="6245e-188">DEK</span></span>          | <span data-ttu-id="6245e-189">Data Lake Store 帳戶</span><span class="sxs-lookup"><span data-stu-id="6245e-189">A Data Lake Store account</span></span> | <span data-ttu-id="6245e-190">永續性儲存體，由 Data Lake Store 服務管理</span><span class="sxs-lookup"><span data-stu-id="6245e-190">Persistent storage, managed by Data Lake Store service</span></span> | <span data-ttu-id="6245e-191">對稱</span><span class="sxs-lookup"><span data-stu-id="6245e-191">Symmetric</span></span>  | <span data-ttu-id="6245e-192">DEK 是由 MEK 加密。</span><span class="sxs-lookup"><span data-stu-id="6245e-192">The DEK is encrypted by the MEK.</span></span> <span data-ttu-id="6245e-193">已加密的 DEK 會儲存在持續性媒體上。</span><span class="sxs-lookup"><span data-stu-id="6245e-193">The encrypted DEK is what is stored on persistent media.</span></span> |
| <span data-ttu-id="6245e-194">區塊加密金鑰</span><span class="sxs-lookup"><span data-stu-id="6245e-194">Block Encryption Key</span></span>  | <span data-ttu-id="6245e-195">BEK</span><span class="sxs-lookup"><span data-stu-id="6245e-195">BEK</span></span>          | <span data-ttu-id="6245e-196">資料區塊</span><span class="sxs-lookup"><span data-stu-id="6245e-196">A block of data</span></span> | <span data-ttu-id="6245e-197">None</span><span class="sxs-lookup"><span data-stu-id="6245e-197">None</span></span>                                         | <span data-ttu-id="6245e-198">對稱</span><span class="sxs-lookup"><span data-stu-id="6245e-198">Symmetric</span></span>  | <span data-ttu-id="6245e-199">BEK 衍生自 DEK 和資料區塊。</span><span class="sxs-lookup"><span data-stu-id="6245e-199">The BEK is derived from the DEK and the data block.</span></span>                                                      |

<span data-ttu-id="6245e-200">下圖說明這些概念：</span><span class="sxs-lookup"><span data-stu-id="6245e-200">The following diagram illustrates these concepts:</span></span>

![資料加密中的加密](./media/data-lake-store-encryption/fig2.png)

#### <a name="pseudo-algorithm-when-a-file-is-to-be-decrypted"></a><span data-ttu-id="6245e-202">將檔案解密時的虛擬演算法︰</span><span class="sxs-lookup"><span data-stu-id="6245e-202">Pseudo algorithm when a file is to be decrypted:</span></span>
1.  <span data-ttu-id="6245e-203">檢查 Data Lake Store 帳戶的 DEK 是否已快取並可供使用。</span><span class="sxs-lookup"><span data-stu-id="6245e-203">Check if the DEK for the Data Lake Store account is cached and ready for use.</span></span>
    - <span data-ttu-id="6245e-204">若非如此，則從永續性儲存體讀取加密的 DEK，並將它傳送至 Key Vault 進行解密。</span><span class="sxs-lookup"><span data-stu-id="6245e-204">If not, then read the encrypted DEK from persistent storage, and send it to Key Vault to be decrypted.</span></span> <span data-ttu-id="6245e-205">快取記憶體中已解密的 DEK。</span><span class="sxs-lookup"><span data-stu-id="6245e-205">Cache the decrypted DEK in memory.</span></span> <span data-ttu-id="6245e-206">其現在已可供使用。</span><span class="sxs-lookup"><span data-stu-id="6245e-206">It is now ready to use.</span></span>
2.  <span data-ttu-id="6245e-207">對於檔案中的每個資料區塊。</span><span class="sxs-lookup"><span data-stu-id="6245e-207">For every block of data in the file:</span></span>
    - <span data-ttu-id="6245e-208">從永續性儲存體讀取已加密的資料區塊。</span><span class="sxs-lookup"><span data-stu-id="6245e-208">Read the encrypted block of data from persistent storage.</span></span>
    - <span data-ttu-id="6245e-209">從 DEK 和已加密的資料區塊產生 BEK。</span><span class="sxs-lookup"><span data-stu-id="6245e-209">Generate the BEK from the DEK and the encrypted block of data.</span></span>
    - <span data-ttu-id="6245e-210">使用 BEK 將資料解密。</span><span class="sxs-lookup"><span data-stu-id="6245e-210">Use the BEK to decrypt data.</span></span>


#### <a name="pseudo-algorithm-when-a-block-of-data-is-to-be-encrypted"></a><span data-ttu-id="6245e-211">將資料區塊加密時的虛擬演算法︰</span><span class="sxs-lookup"><span data-stu-id="6245e-211">Pseudo algorithm when a block of data is to be encrypted:</span></span>
1.  <span data-ttu-id="6245e-212">檢查 Data Lake Store 帳戶的 DEK 是否已快取並可供使用。</span><span class="sxs-lookup"><span data-stu-id="6245e-212">Check if the DEK for the Data Lake Store account is cached and ready for use.</span></span>
    - <span data-ttu-id="6245e-213">若非如此，則從永續性儲存體讀取加密的 DEK，並將它傳送至 Key Vault 進行解密。</span><span class="sxs-lookup"><span data-stu-id="6245e-213">If not, then read the encrypted DEK from persistent storage, and send it to Key Vault to be decrypted.</span></span> <span data-ttu-id="6245e-214">快取記憶體中已解密的 DEK。</span><span class="sxs-lookup"><span data-stu-id="6245e-214">Cache the decrypted DEK in memory.</span></span> <span data-ttu-id="6245e-215">其現在已可供使用。</span><span class="sxs-lookup"><span data-stu-id="6245e-215">It is now ready to use.</span></span>
2.  <span data-ttu-id="6245e-216">從 DEK 產生資料區塊的唯一 BEK。</span><span class="sxs-lookup"><span data-stu-id="6245e-216">Generate a unique BEK for the block of data from the DEK.</span></span>
3.  <span data-ttu-id="6245e-217">經由使用 AES-256 加密的 BEK，將資料區塊加密。</span><span class="sxs-lookup"><span data-stu-id="6245e-217">Encrypt the data block with the BEK, by using AES-256 encryption.</span></span>
4.  <span data-ttu-id="6245e-218">在永續性儲存體上儲存已加密的資料區塊。</span><span class="sxs-lookup"><span data-stu-id="6245e-218">Store the encrypted data block of data on persistent storage.</span></span>

> [!NOTE] 
> <span data-ttu-id="6245e-219">基於效能考量，DEK 會在記憶體中快取一小段時間，而之後立即遭到清除。</span><span class="sxs-lookup"><span data-stu-id="6245e-219">For performance reasons, the DEK in the clear is cached in memory for a short time, and is immediately erased afterward.</span></span> <span data-ttu-id="6245e-220">儲存於持續性媒體時，一律會由 MEK 加密。</span><span class="sxs-lookup"><span data-stu-id="6245e-220">On persistent media, it is always stored encrypted by the MEK.</span></span>

## <a name="key-rotation"></a><span data-ttu-id="6245e-221">金鑰輪替</span><span class="sxs-lookup"><span data-stu-id="6245e-221">Key rotation</span></span>

<span data-ttu-id="6245e-222">當您使用客戶管理的金鑰時，您可以輪替 MEK。</span><span class="sxs-lookup"><span data-stu-id="6245e-222">When you are using customer-managed keys, you can rotate the MEK.</span></span> <span data-ttu-id="6245e-223">若要了解如何使用客戶管理的金鑰來設定 Data Lake Store 帳戶，請參閱[開始使用](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal)。</span><span class="sxs-lookup"><span data-stu-id="6245e-223">To learn how to set up a Data Lake Store account with customer-managed keys, see [Getting started](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span></span>

### <a name="prerequisites"></a><span data-ttu-id="6245e-224">必要條件</span><span class="sxs-lookup"><span data-stu-id="6245e-224">Prerequisites</span></span>

<span data-ttu-id="6245e-225">當您設定 Data Lake Store 帳戶時，您已選擇使用自己的金鑰。</span><span class="sxs-lookup"><span data-stu-id="6245e-225">When you set up the Data Lake Store account, you have chosen to use your own keys.</span></span> <span data-ttu-id="6245e-226">建立帳戶之後，就無法變更此選項。</span><span class="sxs-lookup"><span data-stu-id="6245e-226">This option cannot be changed after the account has been created.</span></span> <span data-ttu-id="6245e-227">下列步驟假設您使用客戶管理的金鑰 (也就是，您已從 Key Vault 中選擇自己的金鑰)。</span><span class="sxs-lookup"><span data-stu-id="6245e-227">The following steps assume that you are using customer-managed keys (that is, you have chosen your own keys from Key Vault).</span></span>

<span data-ttu-id="6245e-228">請注意，如果您使用預設選項進行加密，一律會使用 Data Lake Store 所管理的金鑰將您的資料加密。</span><span class="sxs-lookup"><span data-stu-id="6245e-228">Note that if you use the default options for encryption, your data is always encrypted by using keys managed by Data Lake Store.</span></span> <span data-ttu-id="6245e-229">使用此選項時，您無法輪替金鑰，因為金鑰是由 Data Lake Store 管理。</span><span class="sxs-lookup"><span data-stu-id="6245e-229">In this option, you don't have the ability to rotate keys, as they are managed by Data Lake Store.</span></span>

### <a name="how-to-rotate-the-mek-in-data-lake-store"></a><span data-ttu-id="6245e-230">如何在 Data Lake Store 中輪替 MEK</span><span class="sxs-lookup"><span data-stu-id="6245e-230">How to rotate the MEK in Data Lake Store</span></span>

1. <span data-ttu-id="6245e-231">登入 [Azure 入口網站](https://portal.azure.com/)。</span><span class="sxs-lookup"><span data-stu-id="6245e-231">Sign in to the [Azure portal](https://portal.azure.com/).</span></span>
2. <span data-ttu-id="6245e-232">瀏覽至儲存與您的 Data Lake Store 帳戶相關聯之金鑰的 Key Vault 執行個體。</span><span class="sxs-lookup"><span data-stu-id="6245e-232">Browse to the Key Vault instance that stores your keys associated with your Data Lake Store account.</span></span> <span data-ttu-id="6245e-233">選取 [金鑰]。</span><span class="sxs-lookup"><span data-stu-id="6245e-233">Select **Keys**.</span></span>

    ![Key Vault 的螢幕擷取畫面](./media/data-lake-store-encryption/keyvault.png)

3.  <span data-ttu-id="6245e-235">選取與您的 Data Lake Store 帳戶相關聯的金鑰，並建立此金鑰的新版本。</span><span class="sxs-lookup"><span data-stu-id="6245e-235">Select the key associated with your Data Lake Store account, and create a new version of this key.</span></span> <span data-ttu-id="6245e-236">請注意，Data Lake Store 目前只支援新版金鑰的金鑰輪替。</span><span class="sxs-lookup"><span data-stu-id="6245e-236">Note that Data Lake Store currently only supports key rotation to a new version of a key.</span></span> <span data-ttu-id="6245e-237">它不支援不同金鑰的輪替。</span><span class="sxs-lookup"><span data-stu-id="6245e-237">It doesn't support rotating to a different key.</span></span>

   ![[金鑰] 視窗的螢幕擷取畫面 (醒目提示 [新增版本])](./media/data-lake-store-encryption/keynewversion.png)

4.  <span data-ttu-id="6245e-239">瀏覽至 Data Lake Store 儲存體帳戶，然後選取 [加密]。</span><span class="sxs-lookup"><span data-stu-id="6245e-239">Browse to the Data Lake Store storage account, and select **Encryption**.</span></span>

    ![Data Lake Store 儲存體帳戶視窗的螢幕擷取畫面 (醒目提示 [加密])](./media/data-lake-store-encryption/select-encryption.png)

5.  <span data-ttu-id="6245e-241">有一則訊息會通知您，新本的金鑰已可使用。</span><span class="sxs-lookup"><span data-stu-id="6245e-241">A message notifies you that a new key version of the key is available.</span></span> <span data-ttu-id="6245e-242">按一下 [輪替金鑰]，將金鑰更新為新的版本。</span><span class="sxs-lookup"><span data-stu-id="6245e-242">Click **Rotate Key** to update the key to the new version.</span></span>

    ![Data Lake Store 視窗的螢幕擷取畫面 (含有訊息並醒目提示 [輪替金鑰])](./media/data-lake-store-encryption/rotatekey.png)

<span data-ttu-id="6245e-244">這項作業應在 2 分鐘內完成，且預計不會因為金鑰輪替而停機。</span><span class="sxs-lookup"><span data-stu-id="6245e-244">This operation should take less than two minutes, and there is no expected downtime due to key rotation.</span></span> <span data-ttu-id="6245e-245">在作業完成後，就會使用新版的金鑰。</span><span class="sxs-lookup"><span data-stu-id="6245e-245">After the operation is complete, the new version of the key is in use.</span></span>
