---
title: "aaaAzure Traffic Manager 端點監視 |Microsoft 文件"
description: "這篇文章可協助您了解 Traffic Manager 會使用端點監視和自動端點容錯移轉 toohelp Azure 客戶部署高可用性應用程式"
services: traffic-manager
documentationcenter: 
author: kumudd
manager: timlt
editor: 
ms.assetid: fff25ac3-d13a-4af9-8916-7c72e3d64bc7
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/22/2017
ms.author: kumud
ms.openlocfilehash: b4862499c88bdb1951833d06199b034a07ac7576
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="traffic-manager-endpoint-monitoring"></a><span data-ttu-id="3183e-103">流量管理員端點監視</span><span class="sxs-lookup"><span data-stu-id="3183e-103">Traffic Manager endpoint monitoring</span></span>

<span data-ttu-id="3183e-104">Azure 流量管理員包含內建的端點監視和自動端點容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3183e-104">Azure Traffic Manager includes built-in endpoint monitoring and automatic endpoint failover.</span></span> <span data-ttu-id="3183e-105">這項功能可協助您提供彈性 tooendpoint 失敗，包括 Azure 區域失敗的高可用性應用程式。</span><span class="sxs-lookup"><span data-stu-id="3183e-105">This feature helps you deliver high-availability applications that are resilient tooendpoint failure, including Azure region failures.</span></span>

## <a name="configure-endpoint-monitoring"></a><span data-ttu-id="3183e-106">設定端點監視</span><span class="sxs-lookup"><span data-stu-id="3183e-106">Configure endpoint monitoring</span></span>

<span data-ttu-id="3183e-107">tooconfigure 端點監視，您必須指定下列設定，在您的 Traffic Manager 設定檔的 hello:</span><span class="sxs-lookup"><span data-stu-id="3183e-107">tooconfigure endpoint monitoring, you must specify hello following settings on your Traffic Manager profile:</span></span>

* <span data-ttu-id="3183e-108">**通訊協定**。</span><span class="sxs-lookup"><span data-stu-id="3183e-108">**Protocol**.</span></span> <span data-ttu-id="3183e-109">選擇 HTTP、 HTTPS 或 TCP 做為 Traffic Manager 會使用探查端點 toocheck 時的 hello 通訊協定其健全狀況。</span><span class="sxs-lookup"><span data-stu-id="3183e-109">Choose HTTP, HTTPS, or TCP as hello protocol that Traffic Manager uses when probing your endpoint toocheck its health.</span></span> <span data-ttu-id="3183e-110">HTTPS 監視不會驗證您的 SSL 憑證是否有效-它只會檢查該 hello 的憑證。</span><span class="sxs-lookup"><span data-stu-id="3183e-110">HTTPS monitoring does not verify whether your SSL certificate is valid--it only checks that hello certificate is present.</span></span>
* <span data-ttu-id="3183e-111">**連接埠**。</span><span class="sxs-lookup"><span data-stu-id="3183e-111">**Port**.</span></span> <span data-ttu-id="3183e-112">選擇 hello hello 要求使用的連接埠。</span><span class="sxs-lookup"><span data-stu-id="3183e-112">Choose hello port used for hello request.</span></span>
* <span data-ttu-id="3183e-113">**路徑**。</span><span class="sxs-lookup"><span data-stu-id="3183e-113">**Path**.</span></span> <span data-ttu-id="3183e-114">此組態設定是僅適用於 hello HTTP 和 HTTPS 通訊協定，其指定 hello 路徑設定為必要項目。</span><span class="sxs-lookup"><span data-stu-id="3183e-114">This configuration setting is valid only for hello HTTP and HTTPS protocols, for which specifying hello path setting is required.</span></span> <span data-ttu-id="3183e-115">提供這項設定 hello TCP 監視通訊協定將導致錯誤。</span><span class="sxs-lookup"><span data-stu-id="3183e-115">Providing this setting for hello TCP monitoring protocol results in an error.</span></span> <span data-ttu-id="3183e-116">TCP 通訊協定，可讓 hello 相對路徑和 hello hello 網頁或檔案的名稱 hello 監視存取該 hello。</span><span class="sxs-lookup"><span data-stu-id="3183e-116">For TCP protocol, give hello relative path and hello name of hello webpage or hello file that hello monitoring accesses.</span></span> <span data-ttu-id="3183e-117">正斜線 （/） 是 hello 相對路徑的有效項目。</span><span class="sxs-lookup"><span data-stu-id="3183e-117">A forward slash (/) is a valid entry for hello relative path.</span></span> <span data-ttu-id="3183e-118">這個值表示該 hello 檔案是在 hello 根目錄 （預設值）。</span><span class="sxs-lookup"><span data-stu-id="3183e-118">This value implies that hello file is in hello root directory (default).</span></span>
* <span data-ttu-id="3183e-119">**探查間隔**。</span><span class="sxs-lookup"><span data-stu-id="3183e-119">**Probing Interval**.</span></span> <span data-ttu-id="3183e-120">這個值會指定流量管理員探查代理程式檢查端點健康情況的頻率。</span><span class="sxs-lookup"><span data-stu-id="3183e-120">This value specifies how often an endpoint is checked for its health from a Traffic Manager probing agent.</span></span> <span data-ttu-id="3183e-121">您可以指定以下兩個值：30 秒 (一般探查) 和 10 秒 (快速探查)。</span><span class="sxs-lookup"><span data-stu-id="3183e-121">You can specify two values here: 30 seconds (normal probing) and 10 seconds (fast probing).</span></span> <span data-ttu-id="3183e-122">如果未不提供任何值，則 hello 設定檔設定 tooa 預設值為 30 秒。</span><span class="sxs-lookup"><span data-stu-id="3183e-122">If no values are provided, hello profile sets tooa default value of 30 seconds.</span></span> <span data-ttu-id="3183e-123">請瀏覽 hello [Traffic Manager 定價](https://azure.microsoft.com/pricing/details/traffic-manager)頁面 toolearn 更多關於快速探查定價。</span><span class="sxs-lookup"><span data-stu-id="3183e-123">Visit hello [Traffic Manager Pricing](https://azure.microsoft.com/pricing/details/traffic-manager) page toolearn more about fast probing pricing.</span></span>
* <span data-ttu-id="3183e-124">**容許的失敗次數**。</span><span class="sxs-lookup"><span data-stu-id="3183e-124">**Tolerated Number of Failures**.</span></span> <span data-ttu-id="3183e-125">這個值會指定在將該端點標示為狀況不良之前，流量管理員探查代理程式可以容許多少次失敗。</span><span class="sxs-lookup"><span data-stu-id="3183e-125">This value specifies how many failures a Traffic Manager probing agent tolerates before marking that endpoint as unhealthy.</span></span> <span data-ttu-id="3183e-126">此值必須介於 0 到 9 的範圍內。</span><span class="sxs-lookup"><span data-stu-id="3183e-126">Its value can range between 0 and 9.</span></span> <span data-ttu-id="3183e-127">值為 0，表示單一的監視失敗可能會導致該端點 toobe，標示為狀況不良。</span><span class="sxs-lookup"><span data-stu-id="3183e-127">A value of 0 means a single monitoring failure can cause that endpoint toobe marked as unhealthy.</span></span> <span data-ttu-id="3183e-128">如果未不指定任何值，它會使用 hello 預設值為 3。</span><span class="sxs-lookup"><span data-stu-id="3183e-128">If no value is specified, it uses hello default value of 3.</span></span>
* <span data-ttu-id="3183e-129">**監視逾時**。</span><span class="sxs-lookup"><span data-stu-id="3183e-129">**Monitoring Timeout**.</span></span> <span data-ttu-id="3183e-130">此屬性指定時間 hello 探查代理程式應該考慮之前，先等候健全狀況檢查探查傳送 toohello 端點時，請檢查失敗，Traffic Manager 的 hello 的數量。</span><span class="sxs-lookup"><span data-stu-id="3183e-130">This property specifies hello amount of time hello Traffic Manager probing agent should wait before considering that check a failure when a health check probe is sent toohello endpoint.</span></span> <span data-ttu-id="3183e-131">如果 hello 探查間隔設 too30 秒，則您可以設定介於 5 到 10 秒的 hello 逾時值。</span><span class="sxs-lookup"><span data-stu-id="3183e-131">If hello Probing Interval is set too30 seconds, then you can set hello Timeout value between 5 and 10 seconds.</span></span> <span data-ttu-id="3183e-132">如果未指定任何值，它會使用預設值 10 秒。</span><span class="sxs-lookup"><span data-stu-id="3183e-132">If no value is specified, it uses a default value of 10 seconds.</span></span> <span data-ttu-id="3183e-133">如果 hello 探查間隔設 too10 秒，則您可以設定介於 5 到 9 秒 hello 逾時值。</span><span class="sxs-lookup"><span data-stu-id="3183e-133">If hello Probing Interval is set too10 seconds, then you can set hello Timeout value between 5 and 9 seconds.</span></span> <span data-ttu-id="3183e-134">如果未指定任何逾時值，它會使用預設值 9 秒。</span><span class="sxs-lookup"><span data-stu-id="3183e-134">If no Timeout value is specified, it uses a default value of 9 seconds.</span></span>

![流量管理員端點監視](./media/traffic-manager-monitoring/endpoint-monitoring-settings.png)

<span data-ttu-id="3183e-136">**圖 1：流量管理員端點監視**</span><span class="sxs-lookup"><span data-stu-id="3183e-136">**Figure 1:  Traffic Manager endpoint monitoring**</span></span>

## <a name="how-endpoint-monitoring-works"></a><span data-ttu-id="3183e-137">端點監視的運作方式</span><span class="sxs-lookup"><span data-stu-id="3183e-137">How endpoint monitoring works</span></span>

<span data-ttu-id="3183e-138">如果 hello 監視通訊協定設定為 HTTP 或 HTTPS，hello Traffic Manager 探查代理程式就會建立使用 hello 通訊協定、 連接埠和相對路徑指定之 GET 要求 toohello 端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-138">If hello monitoring protocol is set as HTTP or HTTPS, hello Traffic Manager probing agent makes a GET request toohello endpoint using hello protocol, port, and relative path given.</span></span> <span data-ttu-id="3183e-139">如果它獲得 200-OK 回應，則該端點視為狀況良好。</span><span class="sxs-lookup"><span data-stu-id="3183e-139">If it gets back a 200-OK response, then that endpoint is considered healthy.</span></span> <span data-ttu-id="3183e-140">如果 hello 回應不同的值，或指定的 hello 逾時期限內收到任何回應，然後 hello Traffic Manager 探查代理程式重試根據 toohello 所容許之失敗的數目設定 （沒有重試完成若此設定為 0）.</span><span class="sxs-lookup"><span data-stu-id="3183e-140">If hello response is a different value, or, if no response is received within hello timeout period specified, then hello Traffic Manager probing agent re-attempts according toohello Tolerated Number of Failures setting (no re-attempts are done if this setting is 0).</span></span> <span data-ttu-id="3183e-141">如果 hello 連續失敗次數大於 hello 所容許之失敗的數目設定值，該端點會標示為狀況不良。</span><span class="sxs-lookup"><span data-stu-id="3183e-141">If hello number of consecutive failures is higher than hello Tolerated Number of Failures setting, then that endpoint is marked as unhealthy.</span></span> 

<span data-ttu-id="3183e-142">如果 hello 監視通訊協定是 TCP，hello Traffic Manager 探查代理程式會初始化使用指定的 hello 連接埠 TCP 連線要求。</span><span class="sxs-lookup"><span data-stu-id="3183e-142">If hello monitoring protocol is TCP, hello Traffic Manager probing agent initiates a TCP connection request using hello port specified.</span></span> <span data-ttu-id="3183e-143">如果 hello 端點回應 toohello 要求回應 tooestablish hello，透過連線，健全狀況檢查會標示為成功，並且 hello Traffic Manager 探查代理程式會重設 hello TCP 連線。</span><span class="sxs-lookup"><span data-stu-id="3183e-143">If hello endpoint responds toohello request with a response tooestablish hello connection, that health check is marked as a success and hello Traffic Manager probing agent resets hello TCP connection.</span></span> <span data-ttu-id="3183e-144">如果 hello 回應不同的值，或者內沒有收到任何回應 hello 逾時期間指定，hello Traffic Manager 探查代理程式重試根據 toohello 所容許之失敗的數字 （沒有重試所做的設定如果這項設定為 0）。</span><span class="sxs-lookup"><span data-stu-id="3183e-144">If hello response is a different value, or if no response is received within hello timeout period specified, hello Traffic Manager probing agent re-attempts according toohello Tolerated Number of Failures setting (no re-attempts are made if this setting is 0).</span></span> <span data-ttu-id="3183e-145">如果 hello 連續失敗次數大於 hello 所容許之失敗的數目設定值，然後該端點會標示為狀況不良。</span><span class="sxs-lookup"><span data-stu-id="3183e-145">If hello number of consecutive failures is higher than hello Tolerated Number of Failures setting, then that endpoint is marked unhealthy.</span></span>

<span data-ttu-id="3183e-146">在所有情況下，Traffic Manager 探查從多個位置以及 hello 連續失敗判斷發生在每個區域。</span><span class="sxs-lookup"><span data-stu-id="3183e-146">In all cases, Traffic Manager probes from multiple locations and hello consecutive failure determination happens within each region.</span></span> <span data-ttu-id="3183e-147">這也表示端點會收到健全狀況探查從 Traffic Manager 以更高的頻率比 hello 設定用於探查間隔。</span><span class="sxs-lookup"><span data-stu-id="3183e-147">This also means that endpoints are receiving health probes from Traffic Manager with a higher frequency than hello setting used for Probing Interval.</span></span>

>[!NOTE]
><span data-ttu-id="3183e-148">HTTP 或 HTTPS 通訊協定的監視，hello 端點端上常見的作法是 tooimplement 應用程式中-例如，/health.aspx 的自訂頁面。</span><span class="sxs-lookup"><span data-stu-id="3183e-148">For HTTP or HTTPS monitoring protocol, a common practice on hello endpoint side is tooimplement a custom page within your application - for example, /health.aspx.</span></span> <span data-ttu-id="3183e-149">使用此路徑進行監視，您可以執行應用程式特定的檢查，例如檢查效能計數器或驗證資料庫可用性。</span><span class="sxs-lookup"><span data-stu-id="3183e-149">Using this path for monitoring, you can perform application-specific checks, such as checking performance counters or verifying database availability.</span></span> <span data-ttu-id="3183e-150">根據這些自訂的檢查，hello 頁面傳回適當的 HTTP 狀態碼。</span><span class="sxs-lookup"><span data-stu-id="3183e-150">Based on these custom checks, hello page returns an appropriate HTTP status code.</span></span>

<span data-ttu-id="3183e-151">流量管理員設定檔中的所有端點都共用監視設定。</span><span class="sxs-lookup"><span data-stu-id="3183e-151">All endpoints in a Traffic Manager profile share monitoring settings.</span></span> <span data-ttu-id="3183e-152">如果您需要 toouse 不同的不同端點監視設定，您可以建立[巢狀 流量管理員設定檔](traffic-manager-nested-profiles.md#example-5-per-endpoint-monitoring-settings)。</span><span class="sxs-lookup"><span data-stu-id="3183e-152">If you need toouse different monitoring settings for different endpoints, you can create [nested Traffic Manager profiles](traffic-manager-nested-profiles.md#example-5-per-endpoint-monitoring-settings).</span></span>

## <a name="endpoint-and-profile-status"></a><span data-ttu-id="3183e-153">端點和設定檔狀態</span><span class="sxs-lookup"><span data-stu-id="3183e-153">Endpoint and profile status</span></span>

<span data-ttu-id="3183e-154">您可以啟用和停用流量管理員設定檔和端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-154">You can enable and disable Traffic Manager profiles and endpoints.</span></span> <span data-ttu-id="3183e-155">不過，端點狀態中的變更也可能是因為流量管理員自動設定和程序的結果所導致。</span><span class="sxs-lookup"><span data-stu-id="3183e-155">However, a change in endpoint status also might occur as a result of Traffic Manager automated settings and processes.</span></span>

### <a name="endpoint-status"></a><span data-ttu-id="3183e-156">端點狀態</span><span class="sxs-lookup"><span data-stu-id="3183e-156">Endpoint status</span></span>

<span data-ttu-id="3183e-157">您可以啟用或停用特定端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-157">You can enable or disable a specific endpoint.</span></span> <span data-ttu-id="3183e-158">hello 基礎服務，可能仍會處於狀況良好，不會影響。</span><span class="sxs-lookup"><span data-stu-id="3183e-158">hello underlying service, which might still be healthy, is unaffected.</span></span> <span data-ttu-id="3183e-159">變更 hello 端點狀態控制項 hello hello Traffic Manager 設定檔中的 hello 端點的可用性。</span><span class="sxs-lookup"><span data-stu-id="3183e-159">Changing hello endpoint status controls hello availability of hello endpoint in hello Traffic Manager profile.</span></span> <span data-ttu-id="3183e-160">停用端點狀態時，Traffic Manager 不會檢查其健全狀況和 hello 端點並未包含在 DNS 回應。</span><span class="sxs-lookup"><span data-stu-id="3183e-160">When an endpoint status is disabled, Traffic Manager does not check its health and hello endpoint is not included in a DNS response.</span></span>

### <a name="profile-status"></a><span data-ttu-id="3183e-161">設定檔狀態</span><span class="sxs-lookup"><span data-stu-id="3183e-161">Profile status</span></span>

<span data-ttu-id="3183e-162">使用 hello 設定檔的狀態設定，您可以啟用或停用特定的設定檔。</span><span class="sxs-lookup"><span data-stu-id="3183e-162">Using hello profile status setting, you can enable or disable a specific profile.</span></span> <span data-ttu-id="3183e-163">端點狀態會影響單一端點，而設定檔狀態會影響 hello 整個設定檔，包括所有端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-163">While endpoint status affects a single endpoint, profile status affects hello entire profile, including all endpoints.</span></span> <span data-ttu-id="3183e-164">當您停用設定檔時，hello 端點不會檢查健全狀況，而且沒有端點會包含在 DNS 回應。</span><span class="sxs-lookup"><span data-stu-id="3183e-164">When you disable a profile, hello endpoints are not checked for health and no endpoints are included in a DNS response.</span></span> <span data-ttu-id="3183e-165">[NXDOMAIN](https://tools.ietf.org/html/rfc2308) hello DNS 查詢會傳回回應碼。</span><span class="sxs-lookup"><span data-stu-id="3183e-165">An [NXDOMAIN](https://tools.ietf.org/html/rfc2308) response code is returned for hello DNS query.</span></span>

### <a name="endpoint-monitor-status"></a><span data-ttu-id="3183e-166">端點監視狀態</span><span class="sxs-lookup"><span data-stu-id="3183e-166">Endpoint monitor status</span></span>

<span data-ttu-id="3183e-167">端點監視狀態會顯示 hello hello 端點狀態的 Traffic Manager 產生的值。</span><span class="sxs-lookup"><span data-stu-id="3183e-167">Endpoint monitor status is a Traffic Manager-generated value that shows hello status of hello endpoint.</span></span> <span data-ttu-id="3183e-168">您無法手動變更此設定。</span><span class="sxs-lookup"><span data-stu-id="3183e-168">You cannot change this setting manually.</span></span> <span data-ttu-id="3183e-169">hello 端點監視狀態是 hello 結果的端點監視的組合，hello 設定的端點狀態。</span><span class="sxs-lookup"><span data-stu-id="3183e-169">hello endpoint monitor status is a combination of hello results of endpoint monitoring and hello configured endpoint status.</span></span> <span data-ttu-id="3183e-170">下表中的 hello 顯示 hello 的端點監視狀態的可能值：</span><span class="sxs-lookup"><span data-stu-id="3183e-170">hello possible values of endpoint monitor status are shown in hello following table:</span></span>

| <span data-ttu-id="3183e-171">設定檔狀態</span><span class="sxs-lookup"><span data-stu-id="3183e-171">Profile status</span></span> | <span data-ttu-id="3183e-172">端點狀態</span><span class="sxs-lookup"><span data-stu-id="3183e-172">Endpoint status</span></span> | <span data-ttu-id="3183e-173">端點監視狀態</span><span class="sxs-lookup"><span data-stu-id="3183e-173">Endpoint monitor status</span></span> | <span data-ttu-id="3183e-174">注意事項</span><span class="sxs-lookup"><span data-stu-id="3183e-174">Notes</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="3183e-175">已停用</span><span class="sxs-lookup"><span data-stu-id="3183e-175">Disabled</span></span> |<span data-ttu-id="3183e-176">已啟用</span><span class="sxs-lookup"><span data-stu-id="3183e-176">Enabled</span></span> |<span data-ttu-id="3183e-177">非使用中</span><span class="sxs-lookup"><span data-stu-id="3183e-177">Inactive</span></span> |<span data-ttu-id="3183e-178">hello 設定檔已停用。</span><span class="sxs-lookup"><span data-stu-id="3183e-178">hello profile has been disabled.</span></span> <span data-ttu-id="3183e-179">雖然 hello 端點狀態為啟用，但是 hello 設定檔狀態 （已停用） 的優先順序較高。</span><span class="sxs-lookup"><span data-stu-id="3183e-179">Although hello endpoint status is Enabled, hello profile status (Disabled) takes precedence.</span></span> <span data-ttu-id="3183e-180">不會監視「已停用」設定檔中的端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-180">Endpoints in disabled profiles are not monitored.</span></span> <span data-ttu-id="3183e-181">Hello DNS 查詢會傳回 NXDOMAIN 回應碼。</span><span class="sxs-lookup"><span data-stu-id="3183e-181">An NXDOMAIN response code is returned for hello DNS query.</span></span> |
| <span data-ttu-id="3183e-182">&lt;any&gt;</span><span class="sxs-lookup"><span data-stu-id="3183e-182">&lt;any&gt;</span></span> |<span data-ttu-id="3183e-183">已停用</span><span class="sxs-lookup"><span data-stu-id="3183e-183">Disabled</span></span> |<span data-ttu-id="3183e-184">已停用</span><span class="sxs-lookup"><span data-stu-id="3183e-184">Disabled</span></span> |<span data-ttu-id="3183e-185">hello 端點已停用。</span><span class="sxs-lookup"><span data-stu-id="3183e-185">hello endpoint has been disabled.</span></span> <span data-ttu-id="3183e-186">不會監視「已停用」的端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-186">Disabled endpoints are not monitored.</span></span> <span data-ttu-id="3183e-187">hello 端點並未包含在 DNS 回應中，因此，不會接收流量。</span><span class="sxs-lookup"><span data-stu-id="3183e-187">hello endpoint is not included in DNS responses, therefore, it does not receive traffic.</span></span> |
| <span data-ttu-id="3183e-188">已啟用</span><span class="sxs-lookup"><span data-stu-id="3183e-188">Enabled</span></span> |<span data-ttu-id="3183e-189">已啟用</span><span class="sxs-lookup"><span data-stu-id="3183e-189">Enabled</span></span> |<span data-ttu-id="3183e-190">線上</span><span class="sxs-lookup"><span data-stu-id="3183e-190">Online</span></span> |<span data-ttu-id="3183e-191">hello 端點受到監視且狀況良好。</span><span class="sxs-lookup"><span data-stu-id="3183e-191">hello endpoint is monitored and is healthy.</span></span> <span data-ttu-id="3183e-192">端點包含於 DNS 回應中，因此可接收流量。</span><span class="sxs-lookup"><span data-stu-id="3183e-192">It is included in DNS responses and can receive traffic.</span></span> |
| <span data-ttu-id="3183e-193">已啟用</span><span class="sxs-lookup"><span data-stu-id="3183e-193">Enabled</span></span> |<span data-ttu-id="3183e-194">已啟用</span><span class="sxs-lookup"><span data-stu-id="3183e-194">Enabled</span></span> |<span data-ttu-id="3183e-195">已降級</span><span class="sxs-lookup"><span data-stu-id="3183e-195">Degraded</span></span> |<span data-ttu-id="3183e-196">端點監視健全狀況檢查失敗。</span><span class="sxs-lookup"><span data-stu-id="3183e-196">Endpoint monitoring health checks are failing.</span></span> <span data-ttu-id="3183e-197">hello 端點不包含在 DNS 回應中，而且不會接收流量。</span><span class="sxs-lookup"><span data-stu-id="3183e-197">hello endpoint is not included in DNS responses and does not receive traffic.</span></span> <br><span data-ttu-id="3183e-198">例外狀況 toothis 是所有端點會都降級，如果在此情況下所有這些皆視為 toobe hello 查詢回應中傳回）。</span><span class="sxs-lookup"><span data-stu-id="3183e-198">An exception toothis is if all endpoints are degraded, in which case all of them are considered toobe returned in hello query response).</span></span></br>|
| <span data-ttu-id="3183e-199">已啟用</span><span class="sxs-lookup"><span data-stu-id="3183e-199">Enabled</span></span> |<span data-ttu-id="3183e-200">已啟用</span><span class="sxs-lookup"><span data-stu-id="3183e-200">Enabled</span></span> |<span data-ttu-id="3183e-201">正在檢查端點</span><span class="sxs-lookup"><span data-stu-id="3183e-201">CheckingEndpoint</span></span> |<span data-ttu-id="3183e-202">hello 端點受到監視，但尚未尚未收到 hello hello 第一次探查的結果。</span><span class="sxs-lookup"><span data-stu-id="3183e-202">hello endpoint is monitored, but hello results of hello first probe have not been received yet.</span></span> <span data-ttu-id="3183e-203">CheckingEndpoint 是新增或啟用 hello 設定檔中的端點之後，通常會發生的暫時狀態。</span><span class="sxs-lookup"><span data-stu-id="3183e-203">CheckingEndpoint is a temporary state that usually occurs immediately after adding or enabling an endpoint in hello profile.</span></span> <span data-ttu-id="3183e-204">處於此狀態的端點會包含於 DNS 回應中，因此可接收流量。</span><span class="sxs-lookup"><span data-stu-id="3183e-204">An endpoint in this state is included in DNS responses and can receive traffic.</span></span> |
| <span data-ttu-id="3183e-205">已啟用</span><span class="sxs-lookup"><span data-stu-id="3183e-205">Enabled</span></span> |<span data-ttu-id="3183e-206">已啟用</span><span class="sxs-lookup"><span data-stu-id="3183e-206">Enabled</span></span> |<span data-ttu-id="3183e-207">已停止</span><span class="sxs-lookup"><span data-stu-id="3183e-207">Stopped</span></span> |<span data-ttu-id="3183e-208">hello 雲端服務或 web 應用程式 hello 端點點 toois 未執行。</span><span class="sxs-lookup"><span data-stu-id="3183e-208">hello cloud service or web app that hello endpoint points toois not running.</span></span> <span data-ttu-id="3183e-209">請檢查 hello 雲端服務或 web 應用程式設定。</span><span class="sxs-lookup"><span data-stu-id="3183e-209">Check hello cloud service or web app settings.</span></span> <span data-ttu-id="3183e-210">此情形也如果 hello 端點的類型巢狀的端點和 hello 子系的設定檔已停用或非使用中。</span><span class="sxs-lookup"><span data-stu-id="3183e-210">This can also happen if hello endpoint is of type nested endpoint and hello child profile is disabled or is inactive.</span></span> <br><span data-ttu-id="3183e-211">「已停止」狀態的端點不會受到監視。</span><span class="sxs-lookup"><span data-stu-id="3183e-211">An endpoint with a Stopped status is not monitored.</span></span> <span data-ttu-id="3183e-212">它未包含於 DNS 回應中，因此不會接收流量。</span><span class="sxs-lookup"><span data-stu-id="3183e-212">It is not included in DNS responses and does not receive traffic.</span></span> <span data-ttu-id="3183e-213">例外狀況 toothis 是如果會降級的所有端點，在此情況下全部都將會被視為 toobe hello 查詢回應中傳回。</span><span class="sxs-lookup"><span data-stu-id="3183e-213">An exception toothis is if all endpoints are degraded, in which case all of them will be considered toobe returned in hello query response.</span></span></br>|

<span data-ttu-id="3183e-214">如需如何計算巢狀端點的端點監視狀態詳細資訊，請參閱[巢狀流量管理員設定檔](traffic-manager-nested-profiles.md)。</span><span class="sxs-lookup"><span data-stu-id="3183e-214">For details about how endpoint monitor status is calculated for nested endpoints, see [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>

### <a name="profile-monitor-status"></a><span data-ttu-id="3183e-215">設定檔監視狀態</span><span class="sxs-lookup"><span data-stu-id="3183e-215">Profile monitor status</span></span>

<span data-ttu-id="3183e-216">hello 設定檔監視狀態是設定 hello 設定檔狀態和 hello 所有端點的端點監視狀態值的組合。</span><span class="sxs-lookup"><span data-stu-id="3183e-216">hello profile monitor status is a combination of hello configured profile status and hello endpoint monitor status values for all endpoints.</span></span> <span data-ttu-id="3183e-217">hello 下表將描述 hello 可能的值：</span><span class="sxs-lookup"><span data-stu-id="3183e-217">hello possible values are described in hello following table:</span></span>

| <span data-ttu-id="3183e-218">設定檔狀態 (依設定)</span><span class="sxs-lookup"><span data-stu-id="3183e-218">Profile status (as configured)</span></span> | <span data-ttu-id="3183e-219">端點監視狀態</span><span class="sxs-lookup"><span data-stu-id="3183e-219">Endpoint monitor status</span></span> | <span data-ttu-id="3183e-220">設定檔監視狀態</span><span class="sxs-lookup"><span data-stu-id="3183e-220">Profile monitor status</span></span> | <span data-ttu-id="3183e-221">注意事項</span><span class="sxs-lookup"><span data-stu-id="3183e-221">Notes</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="3183e-222">已停用</span><span class="sxs-lookup"><span data-stu-id="3183e-222">Disabled</span></span> |<span data-ttu-id="3183e-223">&lt;任何&gt;或未定義端點的設定檔。</span><span class="sxs-lookup"><span data-stu-id="3183e-223">&lt;any&gt; or a profile with no defined endpoints.</span></span> |<span data-ttu-id="3183e-224">已停用</span><span class="sxs-lookup"><span data-stu-id="3183e-224">Disabled</span></span> |<span data-ttu-id="3183e-225">hello 設定檔已停用。</span><span class="sxs-lookup"><span data-stu-id="3183e-225">hello profile has been disabled.</span></span> |
| <span data-ttu-id="3183e-226">已啟用</span><span class="sxs-lookup"><span data-stu-id="3183e-226">Enabled</span></span> |<span data-ttu-id="3183e-227">至少一個端點的 hello 狀態會降低。</span><span class="sxs-lookup"><span data-stu-id="3183e-227">hello status of at least one endpoint is Degraded.</span></span> |<span data-ttu-id="3183e-228">已降級</span><span class="sxs-lookup"><span data-stu-id="3183e-228">Degraded</span></span> |<span data-ttu-id="3183e-229">檢閱 hello 個別的端點狀態值 toodetermine 哪些端點需要進一步注意。</span><span class="sxs-lookup"><span data-stu-id="3183e-229">Review hello individual endpoint status values toodetermine which endpoints require further attention.</span></span> |
| <span data-ttu-id="3183e-230">已啟用</span><span class="sxs-lookup"><span data-stu-id="3183e-230">Enabled</span></span> |<span data-ttu-id="3183e-231">至少一個端點的 hello 狀態為 Online。</span><span class="sxs-lookup"><span data-stu-id="3183e-231">hello status of at least one endpoint is Online.</span></span> <span data-ttu-id="3183e-232">沒有狀態為「已降級」的端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-232">No endpoints have a Degraded status.</span></span> |<span data-ttu-id="3183e-233">線上</span><span class="sxs-lookup"><span data-stu-id="3183e-233">Online</span></span> |<span data-ttu-id="3183e-234">hello 服務正在接收流量。</span><span class="sxs-lookup"><span data-stu-id="3183e-234">hello service is accepting traffic.</span></span> <span data-ttu-id="3183e-235">不需要採取任何動作。</span><span class="sxs-lookup"><span data-stu-id="3183e-235">No further action is required.</span></span> |
| <span data-ttu-id="3183e-236">已啟用</span><span class="sxs-lookup"><span data-stu-id="3183e-236">Enabled</span></span> |<span data-ttu-id="3183e-237">至少一個端點的 hello 狀態為 CheckingEndpoint。</span><span class="sxs-lookup"><span data-stu-id="3183e-237">hello status of at least one endpoint is CheckingEndpoint.</span></span> <span data-ttu-id="3183e-238">沒有狀態為「線上」或「已降級」的端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-238">No endpoints are in Online or Degraded status.</span></span> |<span data-ttu-id="3183e-239">正在檢查端點</span><span class="sxs-lookup"><span data-stu-id="3183e-239">CheckingEndpoints</span></span> |<span data-ttu-id="3183e-240">建立或啟用設定檔時，就會發生此轉換狀態。</span><span class="sxs-lookup"><span data-stu-id="3183e-240">This transition state occurs when a profile if created or enabled.</span></span> <span data-ttu-id="3183e-241">hello 端點健全狀況正在檢查的 hello 第一次。</span><span class="sxs-lookup"><span data-stu-id="3183e-241">hello endpoint health is being checked for hello first time.</span></span> |
| <span data-ttu-id="3183e-242">已啟用</span><span class="sxs-lookup"><span data-stu-id="3183e-242">Enabled</span></span> |<span data-ttu-id="3183e-243">hello 狀態的 hello 設定檔中的所有端點已停用或已停止，或 hello 設定檔沒有任何已定義的端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-243">hello statuses of all endpoints in hello profile are either Disabled or Stopped, or hello profile has no defined endpoints.</span></span> |<span data-ttu-id="3183e-244">非使用中</span><span class="sxs-lookup"><span data-stu-id="3183e-244">Inactive</span></span> |<span data-ttu-id="3183e-245">沒有端點是作用中，但仍處於啟用狀態 hello 設定檔。</span><span class="sxs-lookup"><span data-stu-id="3183e-245">No endpoints are active, but hello profile is still Enabled.</span></span> |

## <a name="endpoint-failover-and-recovery"></a><span data-ttu-id="3183e-246">端點容錯移轉和復原</span><span class="sxs-lookup"><span data-stu-id="3183e-246">Endpoint failover and recovery</span></span>

<span data-ttu-id="3183e-247">Traffic Manager 會定期檢查 hello 健全狀況的每個端點，包括狀況不良的端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-247">Traffic Manager periodically checks hello health of every endpoint, including unhealthy endpoints.</span></span> <span data-ttu-id="3183e-248">當端點變成狀況良好時，流量管理員會偵測到此狀況，並且將它恢復至輪替。</span><span class="sxs-lookup"><span data-stu-id="3183e-248">Traffic Manager detects when an endpoint becomes healthy and brings it back into rotation.</span></span>

<span data-ttu-id="3183e-249">端點是狀況不良，出現任何 hello 下列事件：</span><span class="sxs-lookup"><span data-stu-id="3183e-249">An endpoint is unhealthy when any of hello following events occur:</span></span>
- <span data-ttu-id="3183e-250">如果 hello 監視通訊協定是 HTTP 或 HTTPS:</span><span class="sxs-lookup"><span data-stu-id="3183e-250">If hello monitoring protocol is HTTP or HTTPS:</span></span>
    - <span data-ttu-id="3183e-251">收到非 200 回應 (包括不同的 2xx 碼或 301/302 重新導向)。</span><span class="sxs-lookup"><span data-stu-id="3183e-251">A non-200 response is received (including a different 2xx code, or a 301/302 redirect).</span></span>
- <span data-ttu-id="3183e-252">如果 hello 監視通訊協定是 TCP:</span><span class="sxs-lookup"><span data-stu-id="3183e-252">If hello monitoring protocol is TCP:</span></span> 
    - <span data-ttu-id="3183e-253">除了 ACK 或 SYN ACK 收到回應 toohello 同步處理要求中傳送回應 Traffic Manager tooattempt 由連線建立。</span><span class="sxs-lookup"><span data-stu-id="3183e-253">A response other than ACK or SYN-ACK is received in response toohello SYNC request sent by Traffic Manager tooattempt a connection establishment.</span></span>
- <span data-ttu-id="3183e-254">逾時。</span><span class="sxs-lookup"><span data-stu-id="3183e-254">Timeout.</span></span> 
- <span data-ttu-id="3183e-255">任何其他連線問題導致無法連線到 hello 端點中。</span><span class="sxs-lookup"><span data-stu-id="3183e-255">Any other connection issue resulting in hello endpoint being not reachable.</span></span>

<span data-ttu-id="3183e-256">如需疑難排解失敗檢查的詳細資訊，請參閱 [疑難排解 Azure 流量管理員上的已降級狀態](traffic-manager-troubleshooting-degraded.md)。</span><span class="sxs-lookup"><span data-stu-id="3183e-256">For more information about troubleshooting failed checks, see [Troubleshooting Degraded status on Azure Traffic Manager](traffic-manager-troubleshooting-degraded.md).</span></span> 

<span data-ttu-id="3183e-257">hello 下列時間表在圖 2 是 hello 監視具有下列設定的 hello 的流量管理員端點的程序的詳細的說明： 監視通訊協定為 HTTP、 探查間隔為 30 秒，容許的失敗次數為 3，逾時值10 秒，而且 DNS TTL 為 30 秒。</span><span class="sxs-lookup"><span data-stu-id="3183e-257">hello following timeline in Figure 2 is a detailed description of hello monitoring process of Traffic Manager endpoint that has hello following settings: monitoring protocol is HTTP, probing interval is 30 seconds, number of tolerated failures is 3, timeout value is 10 seconds, and DNS TTL is 30 seconds.</span></span>

![流量管理員端點容錯移轉和容錯回復順序](./media/traffic-manager-monitoring/timeline.png)

<span data-ttu-id="3183e-259">**圖 2：流量管理員端點容錯移轉和復原順序**</span><span class="sxs-lookup"><span data-stu-id="3183e-259">**Figure 2:  Traffic manager endpoint failover and recovery sequence**</span></span>

1. <span data-ttu-id="3183e-260">**GET**。</span><span class="sxs-lookup"><span data-stu-id="3183e-260">**GET**.</span></span> <span data-ttu-id="3183e-261">針對每個端點，hello Traffic Manager 監視系統會 hello hello 監視設定中指定的路徑上，執行 GET 要求。</span><span class="sxs-lookup"><span data-stu-id="3183e-261">For each endpoint, hello Traffic Manager monitoring system performs a GET request on hello path specified in hello monitoring settings.</span></span>
2. <span data-ttu-id="3183e-262">**200 OK**。</span><span class="sxs-lookup"><span data-stu-id="3183e-262">**200 OK**.</span></span> <span data-ttu-id="3183e-263">hello 監視系統必須要有 10 秒內傳回 HTTP 200 OK 訊息 toobe。</span><span class="sxs-lookup"><span data-stu-id="3183e-263">hello monitoring system expects an HTTP 200 OK message toobe returned within 10 seconds.</span></span> <span data-ttu-id="3183e-264">當它收到此回應時，會辨識 hello 服務可供使用。</span><span class="sxs-lookup"><span data-stu-id="3183e-264">When it receives this response, it recognizes that hello service is available.</span></span>
3. <span data-ttu-id="3183e-265">**每次檢查之間間隔 30 秒**。</span><span class="sxs-lookup"><span data-stu-id="3183e-265">**30 seconds between checks**.</span></span> <span data-ttu-id="3183e-266">hello 端點健全狀況檢查重複每隔 30 秒。</span><span class="sxs-lookup"><span data-stu-id="3183e-266">hello endpoint health check is repeated every 30 seconds.</span></span>
4. <span data-ttu-id="3183e-267">**服務無法使用**。</span><span class="sxs-lookup"><span data-stu-id="3183e-267">**Service unavailable**.</span></span> <span data-ttu-id="3183e-268">hello 服務變為無法使用。</span><span class="sxs-lookup"><span data-stu-id="3183e-268">hello service becomes unavailable.</span></span> <span data-ttu-id="3183e-269">Traffic Manager 將不會知道直到 hello 下一步的健全狀況檢查。</span><span class="sxs-lookup"><span data-stu-id="3183e-269">Traffic Manager will not know until hello next health check.</span></span>
5. <span data-ttu-id="3183e-270">**監視路徑嘗試 tooaccess hello**。</span><span class="sxs-lookup"><span data-stu-id="3183e-270">**Attempts tooaccess hello monitoring path**.</span></span> <span data-ttu-id="3183e-271">hello 監視系統執行 GET 要求，但未收到 hello 10 秒逾時期限之內回應 （或者，-200 回應可能會收到）。</span><span class="sxs-lookup"><span data-stu-id="3183e-271">hello monitoring system performs a GET request, but does not receive a response within hello timeout period of 10 seconds (alternatively, a non-200 response may be received).</span></span> <span data-ttu-id="3183e-272">接著每隔 30 秒執行一次，再嘗試三次。</span><span class="sxs-lookup"><span data-stu-id="3183e-272">It then tries three more times, at 30-second intervals.</span></span> <span data-ttu-id="3183e-273">如果其中一個 hello 嘗試成功，會重設 hello 嘗試次數。</span><span class="sxs-lookup"><span data-stu-id="3183e-273">If one of hello tries is successful, then hello number of tries is reset.</span></span>
6. <span data-ttu-id="3183e-274">**狀態設定 tooDegraded**。</span><span class="sxs-lookup"><span data-stu-id="3183e-274">**Status set tooDegraded**.</span></span> <span data-ttu-id="3183e-275">在第四個連續失敗之後，監視系統的 hello 會標示為 「 降級 hello 無法使用的端點狀態。</span><span class="sxs-lookup"><span data-stu-id="3183e-275">After a fourth consecutive failure, hello monitoring system marks hello unavailable endpoint status as Degraded.</span></span>
7. <span data-ttu-id="3183e-276">**流量是轉接的 tooother 端點**。</span><span class="sxs-lookup"><span data-stu-id="3183e-276">**Traffic is diverted tooother endpoints**.</span></span> <span data-ttu-id="3183e-277">hello Traffic Manager DNS 名稱伺服器更新，Traffic Manager 不會再傳回 hello 端點回應 tooDNS 查詢中。</span><span class="sxs-lookup"><span data-stu-id="3183e-277">hello Traffic Manager DNS name servers are updated and Traffic Manager no longer returns hello endpoint in response tooDNS queries.</span></span> <span data-ttu-id="3183e-278">新的連接會導向的 tooother，可用的端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-278">New connections are directed tooother, available endpoints.</span></span> <span data-ttu-id="3183e-279">不過，先前包含此端點的 DNS 回應仍可能由遞迴 DNS 伺服器和 DNS 用戶端所快取。</span><span class="sxs-lookup"><span data-stu-id="3183e-279">However, previous DNS responses that include this endpoint may still be cached by recursive DNS servers and DNS clients.</span></span> <span data-ttu-id="3183e-280">用戶端繼續 toouse hello 端點，直到 hello DNS 快取到期為止。</span><span class="sxs-lookup"><span data-stu-id="3183e-280">Clients continue toouse hello endpoint until hello DNS cache expires.</span></span> <span data-ttu-id="3183e-281">Hello DNS 快取過期，因為用戶端提出新的 DNS 查詢，並會導向的 toodifferent 端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-281">As hello DNS cache expires, clients make new DNS queries and are directed toodifferent endpoints.</span></span> <span data-ttu-id="3183e-282">hello 快取持續時間是由在 hello Traffic Manager 設定檔，例如，30 秒的 hello TTL 設定所控制。</span><span class="sxs-lookup"><span data-stu-id="3183e-282">hello cache duration is controlled by hello TTL setting in hello Traffic Manager profile, for example, 30 seconds.</span></span>
8. <span data-ttu-id="3183e-283">**健全狀況檢查繼續**。</span><span class="sxs-lookup"><span data-stu-id="3183e-283">**Health checks continue**.</span></span> <span data-ttu-id="3183e-284">Traffic Manager 降級狀態時，會繼續 toocheck hello hello 端點健全狀況。</span><span class="sxs-lookup"><span data-stu-id="3183e-284">Traffic Manager continues toocheck hello health of hello endpoint while it has a Degraded status.</span></span> <span data-ttu-id="3183e-285">Traffic Manager 偵測到 hello 端點傳回 toohealth 時。</span><span class="sxs-lookup"><span data-stu-id="3183e-285">Traffic Manager detects when hello endpoint returns toohealth.</span></span>
9. <span data-ttu-id="3183e-286">**服務重新上線**。</span><span class="sxs-lookup"><span data-stu-id="3183e-286">**Service comes back online**.</span></span> <span data-ttu-id="3183e-287">hello 服務變為無法使用。</span><span class="sxs-lookup"><span data-stu-id="3183e-287">hello service becomes available.</span></span> <span data-ttu-id="3183e-288">hello 端點會保留在 Traffic Manager 降級狀態，直到 hello 監視系統執行其下一步的健全狀況檢查。</span><span class="sxs-lookup"><span data-stu-id="3183e-288">hello endpoint retains its Degraded status in Traffic Manager until hello monitoring system performs its next health check.</span></span>
10. <span data-ttu-id="3183e-289">**流量 tooservice 繼續**。</span><span class="sxs-lookup"><span data-stu-id="3183e-289">**Traffic tooservice resumes**.</span></span> <span data-ttu-id="3183e-290">流量管理員傳送 GET 要求，並收到 200 OK 狀態回應。</span><span class="sxs-lookup"><span data-stu-id="3183e-290">Traffic Manager sends a GET request and receives a 200 OK status response.</span></span> <span data-ttu-id="3183e-291">hello 服務傳回 tooa 狀況良好狀態。</span><span class="sxs-lookup"><span data-stu-id="3183e-291">hello service has returned tooa healthy state.</span></span> <span data-ttu-id="3183e-292">hello Traffic Manager 名稱伺服器會更新，而開始 toohand 出 hello 服務的 DNS 回應中的 DNS 名稱。</span><span class="sxs-lookup"><span data-stu-id="3183e-292">hello Traffic Manager name servers are updated, and they begin toohand out hello service's DNS name in DNS responses.</span></span> <span data-ttu-id="3183e-293">過期的快取的 DNS 回應傳回其他端點，以及與現有的連接已終止 tooother 端點，流量會傳回 toohello 端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-293">Traffic returns toohello endpoint as cached DNS responses that return other endpoints expire, and as existing connections tooother endpoints are terminated.</span></span>

    > [!NOTE]
    > <span data-ttu-id="3183e-294">Traffic Manager 會在 hello DNS 層級運作，因為它無法影響現有連線 tooany 端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-294">Because Traffic Manager works at hello DNS level, it cannot influence existing connections tooany endpoint.</span></span> <span data-ttu-id="3183e-295">它會導向端點 （無論是已變更的設定檔設定，或是在容錯移轉或容錯回復期間） 之間的流量，Traffic Manager 會指示新的連線 tooavailable 端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-295">When it directs traffic between endpoints (either by changed profile settings, or during failover or failback), Traffic Manager directs new connections tooavailable endpoints.</span></span> <span data-ttu-id="3183e-296">不過，其他端點可能會繼續 tooreceive 流量透過現有的連線，直到這些工作階段已終止。</span><span class="sxs-lookup"><span data-stu-id="3183e-296">However, other endpoints might continue tooreceive traffic via existing connections until those sessions are terminated.</span></span> <span data-ttu-id="3183e-297">tooenable 流量 toodrain 從現有的連接，應用程式應該限制 hello 與每個端點使用的工作階段持續時間。</span><span class="sxs-lookup"><span data-stu-id="3183e-297">tooenable traffic toodrain from existing connections, applications should limit hello session duration used with each endpoint.</span></span>

## <a name="traffic-routing-methods"></a><span data-ttu-id="3183e-298">流量路由方法</span><span class="sxs-lookup"><span data-stu-id="3183e-298">Traffic-routing methods</span></span>

<span data-ttu-id="3183e-299">當端點已降級狀態時，它不會再傳回回應 tooDNS 查詢中。</span><span class="sxs-lookup"><span data-stu-id="3183e-299">When an endpoint has a Degraded status, it is no longer returned in response tooDNS queries.</span></span> <span data-ttu-id="3183e-300">而是選擇並傳回替代端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-300">Instead, an alternative endpoint is chosen and returned.</span></span> <span data-ttu-id="3183e-301">設定 hello 設定檔中的 hello 流量路由方法會判斷如何選擇 hello 替代端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-301">hello traffic-routing method configured in hello profile determines how hello alternative endpoint is chosen.</span></span>

* <span data-ttu-id="3183e-302">**優先順序**。</span><span class="sxs-lookup"><span data-stu-id="3183e-302">**Priority**.</span></span> <span data-ttu-id="3183e-303">端點會形成優先順序清單。</span><span class="sxs-lookup"><span data-stu-id="3183e-303">Endpoints form a prioritized list.</span></span> <span data-ttu-id="3183e-304">一律傳回 hello 第一個可用的端點上 hello 清單。</span><span class="sxs-lookup"><span data-stu-id="3183e-304">hello first available endpoint on hello list is always returned.</span></span> <span data-ttu-id="3183e-305">如果端點狀態的效能降低，則會傳回 hello 下一個可用的端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-305">If an endpoint status is Degraded, then hello next available endpoint is returned.</span></span>
* <span data-ttu-id="3183e-306">**加權**。</span><span class="sxs-lookup"><span data-stu-id="3183e-306">**Weighted**.</span></span> <span data-ttu-id="3183e-307">任何可用的端點會選擇隨機根據其指派加權和其他可用端點 hello hello 加權。</span><span class="sxs-lookup"><span data-stu-id="3183e-307">Any available endpoint is chosen at random based on their assigned weights and hello weights of hello other available endpoints.</span></span>
* <span data-ttu-id="3183e-308">**效能**。</span><span class="sxs-lookup"><span data-stu-id="3183e-308">**Performance**.</span></span> <span data-ttu-id="3183e-309">hello 端點最接近 toohello 終端使用者就會傳回。</span><span class="sxs-lookup"><span data-stu-id="3183e-309">hello endpoint closest toohello end user is returned.</span></span> <span data-ttu-id="3183e-310">如果無法使用該端點，端點會隨機選擇從所有 hello 其他可用端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-310">If that endpoint is unavailable, an endpoint is randomly chosen from all hello other available endpoints.</span></span> <span data-ttu-id="3183e-311">選擇隨機的端點，可避免 hello 下一步 最靠近的端點變得負載過重時可能發生的階層式失敗。</span><span class="sxs-lookup"><span data-stu-id="3183e-311">Choosing a random endpoint avoids a cascading failure that can occur when hello next-closest endpoint becomes overloaded.</span></span> <span data-ttu-id="3183e-312">您可以使用[巢狀流量管理員設定檔](traffic-manager-nested-profiles.md#example-4-controlling-performance-traffic-routing-between-multiple-endpoints-in-the-same-region)來設定效能流量路由的替代容錯移轉計劃。</span><span class="sxs-lookup"><span data-stu-id="3183e-312">You can configure alternative failover plans for performance traffic-routing by using [nested Traffic Manager profiles](traffic-manager-nested-profiles.md#example-4-controlling-performance-traffic-routing-between-multiple-endpoints-in-the-same-region).</span></span>
* <span data-ttu-id="3183e-313">**地理**。</span><span class="sxs-lookup"><span data-stu-id="3183e-313">**Geographic**.</span></span> <span data-ttu-id="3183e-314">hello 端點對應 tooserve hello 地理位置根據 hello 查詢要求會傳回的 IP。</span><span class="sxs-lookup"><span data-stu-id="3183e-314">hello endpoint mapped tooserve hello geographic location based on hello query request IP’s is returned.</span></span> <span data-ttu-id="3183e-315">如果無法使用該端點，另一個端點不會選取的 toofailover，因為地理位置可以是對應的唯一 tooone 端點，在設定檔 (更多詳細資料位於 hello[常見問題集](traffic-manager-FAQs.md#traffic-manager-geographic-traffic-routing-method))。</span><span class="sxs-lookup"><span data-stu-id="3183e-315">If that endpoint is unavailable, another endpoint will not be selected toofailover to, since a geographic location can be mapped only tooone endpoint in a profile (more details are in hello [FAQ](traffic-manager-FAQs.md#traffic-manager-geographic-traffic-routing-method)).</span></span> <span data-ttu-id="3183e-316">最佳作法是，使用地理路由時，我們建議客戶 toouse 巢狀 Traffic Manager 設定檔與一個以上的端點為 hello hello 設定檔的端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-316">As a best practice, when using geographic routing, we recommend customers toouse nested Traffic Manager profiles with more than one endpoint as hello endpoints of hello profile.</span></span>

<span data-ttu-id="3183e-317">如需詳細資訊，請參閱 [流量管理員流量路由方法](traffic-manager-routing-methods.md)。</span><span class="sxs-lookup"><span data-stu-id="3183e-317">For more information, see [Traffic Manager traffic-routing methods](traffic-manager-routing-methods.md).</span></span>

> [!NOTE]
> <span data-ttu-id="3183e-318">符合資格的所有端點都有降級會發生一個例外狀況 toonormal 流量路由行為。</span><span class="sxs-lookup"><span data-stu-id="3183e-318">One exception toonormal traffic-routing behavior occurs when all eligible endpoints have a degraded status.</span></span> <span data-ttu-id="3183e-319">Traffic Manager 可讓 「 盡力 」 嘗試和*回應所有 hello 降級狀態端點實際上都會處於線上狀態*。</span><span class="sxs-lookup"><span data-stu-id="3183e-319">Traffic Manager makes a "best effort" attempt and *responds as if all hello Degraded status endpoints actually are in an online state*.</span></span> <span data-ttu-id="3183e-320">這是偏好的 toohello 替代方式，就是 toonot hello DNS 回應中傳回任何端點。</span><span class="sxs-lookup"><span data-stu-id="3183e-320">This behavior is preferable toohello alternative, which would be toonot return any endpoint in hello DNS response.</span></span> <span data-ttu-id="3183e-321">「已停用」或「已停止」端點不會受到監視，因此，不會將它們視為符合流量資格。</span><span class="sxs-lookup"><span data-stu-id="3183e-321">Disabled or Stopped endpoints are not monitored, therefore, they are not considered eligible for traffic.</span></span>
>
> <span data-ttu-id="3183e-322">這種狀況，通常被因為 hello 服務的設定不正確例如：</span><span class="sxs-lookup"><span data-stu-id="3183e-322">This condition is commonly caused by improper configuration of hello service, such as:</span></span>
>
> * <span data-ttu-id="3183e-323">存取控制清單 [ACL] 封鎖 hello Traffic Manager 的健康情況檢查。</span><span class="sxs-lookup"><span data-stu-id="3183e-323">An access control list [ACL] blocking hello Traffic Manager health checks.</span></span>
> * <span data-ttu-id="3183e-324">監視連接埠或通訊協定 hello 流量管理員設定檔中的 hello 的不適當的設定。</span><span class="sxs-lookup"><span data-stu-id="3183e-324">An improper configuration of hello monitoring port or protocol in hello Traffic manager profile.</span></span>
>
> <span data-ttu-id="3183e-325">hello 的後果這種行為是，如果未正確設定 Traffic Manager 的健康情況檢查，它可能會顯示與 hello 流量路由一樣 Traffic Manager*是*正常運作。</span><span class="sxs-lookup"><span data-stu-id="3183e-325">hello consequence of this behavior is that if Traffic Manager health checks are not configured correctly, it might appear from hello traffic routing as though Traffic Manager *is* working properly.</span></span> <span data-ttu-id="3183e-326">不過，在此情況下，不會發生影響整體應用程式可用性的端點容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3183e-326">However, in this case, endpoint failover cannot happen which affects overall application availability.</span></span> <span data-ttu-id="3183e-327">很重要的 toocheck hello 設定檔，顯示線上狀態，無法降級狀態。</span><span class="sxs-lookup"><span data-stu-id="3183e-327">It is important toocheck that hello profile shows an Online status, not a Degraded status.</span></span> <span data-ttu-id="3183e-328">線上的狀態，表示該 hello 健康情況檢查依照預期方式運作的 Traffic Manager。</span><span class="sxs-lookup"><span data-stu-id="3183e-328">An Online status indicates that hello Traffic Manager health checks are working as expected.</span></span>

<span data-ttu-id="3183e-329">如需疑難排解無法進行健康狀態檢查的詳細資訊，請參閱[疑難排解 Azure 流量管理員上的已降級狀態](traffic-manager-troubleshooting-degraded.md)。</span><span class="sxs-lookup"><span data-stu-id="3183e-329">For more information about troubleshooting failed health checks, see [Troubleshooting Degraded status on Azure Traffic Manager](traffic-manager-troubleshooting-degraded.md).</span></span>



## <a name="next-steps"></a><span data-ttu-id="3183e-330">後續步驟</span><span class="sxs-lookup"><span data-stu-id="3183e-330">Next steps</span></span>

<span data-ttu-id="3183e-331">了解 [流量管理員的運作方式](traffic-manager-how-traffic-manager-works.md)</span><span class="sxs-lookup"><span data-stu-id="3183e-331">Learn [how Traffic Manager works](traffic-manager-how-traffic-manager-works.md)</span></span>

<span data-ttu-id="3183e-332">深入了解 hello[流量路由方法](traffic-manager-routing-methods.md)流量管理員支援</span><span class="sxs-lookup"><span data-stu-id="3183e-332">Learn more about hello [traffic-routing methods](traffic-manager-routing-methods.md) supported by Traffic Manager</span></span>

<span data-ttu-id="3183e-333">了解如何太[建立 Traffic Manager 設定檔](traffic-manager-manage-profiles.md)</span><span class="sxs-lookup"><span data-stu-id="3183e-333">Learn how too[create a Traffic Manager profile](traffic-manager-manage-profiles.md)</span></span>

<span data-ttu-id="3183e-334">[疑難排解流量管理員端點上的已降級狀態](traffic-manager-troubleshooting-degraded.md)</span><span class="sxs-lookup"><span data-stu-id="3183e-334">[Troubleshoot Degraded status](traffic-manager-troubleshooting-degraded.md) on a Traffic Manager endpoint</span></span>
