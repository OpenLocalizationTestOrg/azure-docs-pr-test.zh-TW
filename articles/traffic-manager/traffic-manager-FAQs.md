---
title: "Azure 流量管理員 - 常見問題集 | Microsoft Docs"
description: "本文提供 Azure 流量管理員常見問題集的解答。"
services: traffic-manager
documentationcenter: 
author: kumudd
manager: timlt
editor: 
ms.assetid: 75d5ff9a-f4b9-4b05-af32-700e7bdfea5a
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/15/2017
ms.author: kumud
ms.openlocfilehash: 44762864e0a5adf568fcd4928b48661196f05b9e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="traffic-manager-frequently-asked-questions-faq"></a><span data-ttu-id="76a79-103">流量管理員常見問題集 (FAQ)</span><span class="sxs-lookup"><span data-stu-id="76a79-103">Traffic Manager Frequently Asked Questions (FAQ)</span></span>

## <a name="traffic-manager-basics"></a><span data-ttu-id="76a79-104">流量管理員基本概念</span><span class="sxs-lookup"><span data-stu-id="76a79-104">Traffic Manager basics</span></span>

### <a name="what-ip-address-does-traffic-manager-use"></a><span data-ttu-id="76a79-105">「流量管理員」使用什麼 IP 位址？</span><span class="sxs-lookup"><span data-stu-id="76a79-105">What IP address does Traffic Manager use?</span></span>

<span data-ttu-id="76a79-106">如[流量管理員的運作方式](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works)所述，流量管理員是在 DNS 層級運作。</span><span class="sxs-lookup"><span data-stu-id="76a79-106">As explained in [How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager works at the DNS level.</span></span> <span data-ttu-id="76a79-107">它會傳送 DNS 回應，將用戶端導向適當的服務端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-107">It sends DNS responses to direct clients to the appropriate service endpoint.</span></span> <span data-ttu-id="76a79-108">用戶端會接著直接連線到服務端點，而不會透過「流量管理員」。</span><span class="sxs-lookup"><span data-stu-id="76a79-108">Clients then connect to the service endpoint directly, not through Traffic Manager.</span></span>

<span data-ttu-id="76a79-109">因此，「流量管理員」並不提供端點或 IP 位址來供用戶端連線。</span><span class="sxs-lookup"><span data-stu-id="76a79-109">Therefore, Traffic Manager does not provide an endpoint or IP address for clients to connect to.</span></span> <span data-ttu-id="76a79-110">因此，如果您的服務需要靜態 IP 位址，則必須在服務上設定，而不是在流量管理員中設定。</span><span class="sxs-lookup"><span data-stu-id="76a79-110">Therefore, if you want static IP address for your service, that must be configured at the service, not in Traffic Manager.</span></span>

### <a name="does-traffic-manager-support-sticky-sessions"></a><span data-ttu-id="76a79-111">流量管理員是否支援「黏性」工作階段？</span><span class="sxs-lookup"><span data-stu-id="76a79-111">Does Traffic Manager support 'sticky' sessions?</span></span>

<span data-ttu-id="76a79-112">如[流量管理員的運作方式](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works)所述，流量管理員是在 DNS 層級運作。</span><span class="sxs-lookup"><span data-stu-id="76a79-112">As explained in [How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager works at the DNS level.</span></span> <span data-ttu-id="76a79-113">它會使用 DNS 回應將用戶端導向到適當的服務端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-113">It uses DNS responses to direct clients to the appropriate service endpoint.</span></span> <span data-ttu-id="76a79-114">用戶端會直接連接至服務端點，而不會透過流量管理員。</span><span class="sxs-lookup"><span data-stu-id="76a79-114">Clients connect to the service endpoint directly, not through Traffic Manager.</span></span> <span data-ttu-id="76a79-115">因此，流量管理員看不到用戶端與伺服器之間的 HTTP 流量。</span><span class="sxs-lookup"><span data-stu-id="76a79-115">Therefore, Traffic Manager does not see the HTTP traffic between the client and the server.</span></span>

<span data-ttu-id="76a79-116">此外，流量管理員收到之 DNS 查詢的來源 IP 位址屬於遞迴 DNS 服務，而不是用戶端。</span><span class="sxs-lookup"><span data-stu-id="76a79-116">Additionally, the source IP address of the DNS query received by Traffic Manager belongs to the recursive DNS service, not the client.</span></span> <span data-ttu-id="76a79-117">因此，流量管理員無法追蹤個別的用戶端，也就無法實作「黏性」工作階段。</span><span class="sxs-lookup"><span data-stu-id="76a79-117">Therefore, Traffic Manager has no way to track individual clients and cannot implement 'sticky' sessions.</span></span> <span data-ttu-id="76a79-118">不是只有流量管理員才受此限制，所有 DNS 型流量管理系統都是如此。</span><span class="sxs-lookup"><span data-stu-id="76a79-118">This limitation is common to all DNS-based traffic management systems and is not specific to Traffic Manager.</span></span>

### <a name="why-am-i-seeing-an-http-error-when-using-traffic-manager"></a><span data-ttu-id="76a79-119">我在使用流量管理員時為何看到 HTTP 錯誤？</span><span class="sxs-lookup"><span data-stu-id="76a79-119">Why am I seeing an HTTP error when using Traffic Manager?</span></span>

<span data-ttu-id="76a79-120">如[流量管理員的運作方式](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works)所述，流量管理員是在 DNS 層級運作。</span><span class="sxs-lookup"><span data-stu-id="76a79-120">As explained in [How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager works at the DNS level.</span></span> <span data-ttu-id="76a79-121">它會使用 DNS 回應將用戶端導向到適當的服務端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-121">It uses DNS responses to direct clients to the appropriate service endpoint.</span></span> <span data-ttu-id="76a79-122">用戶端會接著直接連線到服務端點，而不會透過「流量管理員」。</span><span class="sxs-lookup"><span data-stu-id="76a79-122">Clients then connect to the service endpoint directly, not through Traffic Manager.</span></span> <span data-ttu-id="76a79-123">流量管理員看不到用戶端與伺服器之間的 HTTP 流量。</span><span class="sxs-lookup"><span data-stu-id="76a79-123">Traffic Manager does not see HTTP traffic between client and server.</span></span> <span data-ttu-id="76a79-124">因此，您看到的任何 HTTP 錯誤必定來自您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="76a79-124">Therefore, any HTTP error you see must be coming from your application.</span></span> <span data-ttu-id="76a79-125">為了讓用戶端連接至應用程式，所有 DNS 解析步驟都已完成。</span><span class="sxs-lookup"><span data-stu-id="76a79-125">For the client to connect to the application, all DNS resolution steps are complete.</span></span> <span data-ttu-id="76a79-126">這包括流量管理員在應用程式流量流程上的任何互動。</span><span class="sxs-lookup"><span data-stu-id="76a79-126">That includes any interaction that Traffic Manager has on the application traffic flow.</span></span>

<span data-ttu-id="76a79-127">因此，進一步的調查應該將焦點放在應用程式上。</span><span class="sxs-lookup"><span data-stu-id="76a79-127">Further investigation should therefore focus on the application.</span></span>

<span data-ttu-id="76a79-128">從用戶端的瀏覽器傳送的 HTTP 主機標頭是最常見的問題來源。</span><span class="sxs-lookup"><span data-stu-id="76a79-128">The HTTP host header sent from the client's browser is the most common source of problems.</span></span> <span data-ttu-id="76a79-129">請確定應用程式已設定為接受您使用之網域名稱的正確主機標頭。</span><span class="sxs-lookup"><span data-stu-id="76a79-129">Make sure that the application is configured to accept the correct host header for the domain name you are using.</span></span> <span data-ttu-id="76a79-130">關於使用 Azure App Service 的端點，請參閱[在使用流量管理員的 Azure App Service 中設定 Web 應用程式的自訂網域名稱](../app-service-web/web-sites-traffic-manager-custom-domain-name.md)。</span><span class="sxs-lookup"><span data-stu-id="76a79-130">For endpoints using the Azure App Service, see [configuring a custom domain name for a web app in Azure App Service using Traffic Manager](../app-service-web/web-sites-traffic-manager-custom-domain-name.md).</span></span>

### <a name="what-is-the-performance-impact-of-using-traffic-manager"></a><span data-ttu-id="76a79-131">使用「流量管理員」對效能有什麼影響？</span><span class="sxs-lookup"><span data-stu-id="76a79-131">What is the performance impact of using Traffic Manager?</span></span>

<span data-ttu-id="76a79-132">如[流量管理員的運作方式](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works)所述，流量管理員是在 DNS 層級運作。</span><span class="sxs-lookup"><span data-stu-id="76a79-132">As explained in [How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager works at the DNS level.</span></span> <span data-ttu-id="76a79-133">由於用戶端會直接連線到服務端點，因此在連線建立之後，使用「流量管理員」時並不會造成任何效能影響。</span><span class="sxs-lookup"><span data-stu-id="76a79-133">Since clients connect to your service endpoints directly, there is no performance impact incurred when using Traffic Manager once the connection is established.</span></span>

<span data-ttu-id="76a79-134">因為流量管理員會在 DNS 層級與應用程式整合，所以它確實需要在 DNS 解析鏈結中插入額外的 DNS 查閱。</span><span class="sxs-lookup"><span data-stu-id="76a79-134">Since Traffic Manager integrates with applications at the DNS level, it does require an additional DNS lookup to be inserted into the DNS resolution chain.</span></span> <span data-ttu-id="76a79-135">「流量管理員」對 DNS 解析時間的影響極小。</span><span class="sxs-lookup"><span data-stu-id="76a79-135">The impact of Traffic Manager on DNS resolution time is minimal.</span></span> <span data-ttu-id="76a79-136">流量管理員使用全球網路上的名稱伺服器，並使用[任一傳播](https://en.wikipedia.org/wiki/Anycast)網路功能，以確保一律將 DNS 查詢路由傳送至最靠近的可用名稱伺服器。</span><span class="sxs-lookup"><span data-stu-id="76a79-136">Traffic Manager uses a global network of name servers, and uses [anycast](https://en.wikipedia.org/wiki/Anycast) networking to ensure DNS queries are always routed to the closest available name server.</span></span> <span data-ttu-id="76a79-137">此外，快取 DNS 回應意謂著因使用「流量管理員」而造成的額外 DNS 延遲僅適用於一小部分工作階段。</span><span class="sxs-lookup"><span data-stu-id="76a79-137">In addition, caching of DNS responses means that the additional DNS latency incurred by using Traffic Manager applies only to a fraction of sessions.</span></span>

<span data-ttu-id="76a79-138">「效能」方法會將流量路由傳送至最靠近的可用端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-138">The Performance method routes traffic to the closest available endpoint.</span></span> <span data-ttu-id="76a79-139">最後結果就是這個方法引起的整體效能影響會降到最低。</span><span class="sxs-lookup"><span data-stu-id="76a79-139">The net result is that the overall performance impact associated with this method should be minimal.</span></span> <span data-ttu-id="76a79-140">增加的任何 DNS 延遲都被端點更短的網路延遲所抵銷。</span><span class="sxs-lookup"><span data-stu-id="76a79-140">Any increase in DNS latency should be offset by lower network latency to the endpoint.</span></span>

### <a name="what-application-protocols-can-i-use-with-traffic-manager"></a><span data-ttu-id="76a79-141">我可以搭配「流量管理員」使用哪些應用程式通訊協定？</span><span class="sxs-lookup"><span data-stu-id="76a79-141">What application protocols can I use with Traffic Manager?</span></span>

<span data-ttu-id="76a79-142">如[流量管理員的運作方式](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works)所述，流量管理員是在 DNS 層級運作。</span><span class="sxs-lookup"><span data-stu-id="76a79-142">As explained in [How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager works at the DNS level.</span></span> <span data-ttu-id="76a79-143">完成 DNS 查閱之後，用戶端就會直接連線到應用程式端點，而不會透過「流量管理員」。</span><span class="sxs-lookup"><span data-stu-id="76a79-143">Once the DNS lookup is complete, clients connect to the application endpoint directly, not through Traffic Manager.</span></span> <span data-ttu-id="76a79-144">因此，連線可以使用任何應用程式通訊協定。</span><span class="sxs-lookup"><span data-stu-id="76a79-144">Therefore, the connection can use any application protocol.</span></span> <span data-ttu-id="76a79-145">如果您選取 TCP 作為監視通訊協定，流量管理員的端點健康情況監視可以在不使用任何應用程式通訊協定的情況下完成。</span><span class="sxs-lookup"><span data-stu-id="76a79-145">If you select TCP as the monitoring protocol, Traffic Manager's endpoint health monitoring can be done without using any application protocols.</span></span> <span data-ttu-id="76a79-146">如果您選擇使用應用程式通訊協定來驗證健康情況，端點必須能夠回應 HTTP 或 HTTPS GET 要求。</span><span class="sxs-lookup"><span data-stu-id="76a79-146">If you choose to have the health verified using an application protocol, the endpoint needs to be able to respond to either HTTP or HTTPS GET requests.</span></span>

### <a name="can-i-use-traffic-manager-with-a-naked-domain-name"></a><span data-ttu-id="76a79-147">我是否可以在流量管理員中使用「裸」網域名稱？</span><span class="sxs-lookup"><span data-stu-id="76a79-147">Can I use Traffic Manager with a 'naked' domain name?</span></span>

<span data-ttu-id="76a79-148">沒有。</span><span class="sxs-lookup"><span data-stu-id="76a79-148">No.</span></span> <span data-ttu-id="76a79-149">DNS 標準不允許 CNAME 與同名的其他 DNS 記錄並存。</span><span class="sxs-lookup"><span data-stu-id="76a79-149">The DNS standards do not permit CNAMEs to co-exist with other DNS records of the same name.</span></span> <span data-ttu-id="76a79-150">DNS 區域的頂點 (或根) 永遠包含兩筆預先存在的 DNS 記錄：SOA 和授權 NS 記錄。</span><span class="sxs-lookup"><span data-stu-id="76a79-150">The apex (or root) of a DNS zone always contains two pre-existing DNS records; the SOA and the authoritative NS records.</span></span> <span data-ttu-id="76a79-151">這表示在區域頂點建立 CNAME 記錄就違反 DNS 標準。</span><span class="sxs-lookup"><span data-stu-id="76a79-151">This means a CNAME record cannot be created at the zone apex without violating the DNS standards.</span></span>

<span data-ttu-id="76a79-152">流量管理員需要 DNS CNAME 記錄來對應虛名 DNS 名稱。</span><span class="sxs-lookup"><span data-stu-id="76a79-152">Traffic Manager requires a DNS CNAME record to map the vanity DNS name.</span></span> <span data-ttu-id="76a79-153">例如，您將 www.contoso.com 對應至流量管理員設定檔的 DNS 名稱 contoso.trafficmanager.net。</span><span class="sxs-lookup"><span data-stu-id="76a79-153">For example, you map www.contoso.com to the Traffic Manager profile DNS name contoso.trafficmanager.net.</span></span> <span data-ttu-id="76a79-154">此外，流量管理員設定檔會傳回第二筆 DNS CNAME，以指出用戶端應該連接至哪一個端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-154">Additionally, the Traffic Manager profile returns a second DNS CNAME to indicate which endpoint the client should connect to.</span></span>

<span data-ttu-id="76a79-155">為了解決此問題，我們建議使用 HTTP 重新導向，將流量從裸網域名稱導向不同的 URL，這樣就可以使用流量管理員。</span><span class="sxs-lookup"><span data-stu-id="76a79-155">To work around this issue, we recommend using an HTTP redirect to direct traffic from the naked domain name to a different URL, which can then use Traffic Manager.</span></span> <span data-ttu-id="76a79-156">例如，裸網域 'contoso.com' 可以將使用者重新導向 CNAME 'www.contoso.com'，後者指向流量管理員 DNS 名稱。</span><span class="sxs-lookup"><span data-stu-id="76a79-156">For example, the naked domain 'contoso.com' can redirect users to the CNAME 'www.contoso.com' that points to the Traffic Manager DNS name.</span></span>

<span data-ttu-id="76a79-157">我們的功能待處理項目中追蹤了對「流量管理員」中裸網域的完整支援。</span><span class="sxs-lookup"><span data-stu-id="76a79-157">Full support for naked domains in Traffic Manager is tracked in our feature backlog.</span></span> <span data-ttu-id="76a79-158">您可以[在我們的社群意見反應站投票](https://feedback.azure.com/forums/217313-networking/suggestions/5485350-support-apex-naked-domains-more-seamlessly)，以表達您支持這項功能要求。</span><span class="sxs-lookup"><span data-stu-id="76a79-158">You can register your support for this feature request by [voting for it on our community feedback site](https://feedback.azure.com/forums/217313-networking/suggestions/5485350-support-apex-naked-domains-more-seamlessly).</span></span>

### <a name="does-traffic-manager-consider-the-client-subnet-address-when-handling-dns-queries"></a><span data-ttu-id="76a79-159">處理 DNS 查詢時，流量管理員會考量用戶端子網路位址嗎？</span><span class="sxs-lookup"><span data-stu-id="76a79-159">Does Traffic Manager consider the client subnet address when handling DNS queries?</span></span> 
<span data-ttu-id="76a79-160">否，目前流量管理員在執行地理和效能路由方法的查閱時，只會考量它所接收到的 DNS 查詢的來源 IP 位址，通常是 DNS 解析程式的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="76a79-160">No, currently Traffic Manager considers only the source IP address of the DNS query it receives, which usually is the IP address of the DNS resolver, when performing lookups for Geographic and Performance routing methods.</span></span>  
<span data-ttu-id="76a79-161">具體來說，流量管理員中目前不支援 [RFC 7871 – DNS 查詢中的用戶端子網路 (英文)](https://tools.ietf.org/html/rfc7871)，這提供 [DNS (EDNS0) 的延伸模組機制 (英文)](https://tools.ietf.org/html/rfc2671)，其可將用戶端子網路位址從支援它的解析程式傳遞到 DNS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="76a79-161">Specifically, [RFC 7871 – Client Subnet in DNS Queries](https://tools.ietf.org/html/rfc7871) that provides an [Extension Mechanism for DNS (EDNS0)](https://tools.ietf.org/html/rfc2671) which can pass on the client subnet address from resolvers that support it to DNS servers is currently not supported in Traffic Manager.</span></span> <span data-ttu-id="76a79-162">您可以透過我們的[社群意見反應站 (英文)](https://feedback.azure.com/forums/217313-networking) 來表達您支持這項功能要求。</span><span class="sxs-lookup"><span data-stu-id="76a79-162">You can register your support for this feature request through our [community feedback site](https://feedback.azure.com/forums/217313-networking).</span></span>


### <a name="what-is-dns-ttl-and-how-does-it-impact-my-users"></a><span data-ttu-id="76a79-163">什麼是 DNS TTL，以及它如何影響我的使用者？</span><span class="sxs-lookup"><span data-stu-id="76a79-163">What is DNS TTL and how does it impact my users?</span></span>

<span data-ttu-id="76a79-164">DNS 查詢進入流量管理員時，它會在稱為存留時間 (TTL) 的回應中設定值。</span><span class="sxs-lookup"><span data-stu-id="76a79-164">When a DNS query lands on Traffic Manager, it sets a value in the response called time-to-live (TTL).</span></span> <span data-ttu-id="76a79-165">此值 (單位為秒) 會向 DNS 解析程式下游表示快取此回應要多久時間。</span><span class="sxs-lookup"><span data-stu-id="76a79-165">This value, whose unit is in seconds, indicates to DNS resolvers downstream on how long to cache this response.</span></span> <span data-ttu-id="76a79-166">雖然 DNS 解析程式不保證會快取此結果，但是快取它可讓它們回應對於快取的任何後續查詢，而不是移至流量管理員 DNS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="76a79-166">While DNS resolvers are not guaranteed to cache this result, caching it enables them to respond to any subsequent queries off the cache instead of going to Traffic Manager DNS servers.</span></span> <span data-ttu-id="76a79-167">這會影響回應，如下所示：</span><span class="sxs-lookup"><span data-stu-id="76a79-167">This impacts the responses as follows:</span></span>
- <span data-ttu-id="76a79-168">較高的 TTL 會減少進入流量管理員 DNS 伺服器的查詢數目，因為提供服務的查詢數目是可計費的使用量，所以可減少客戶的成本。</span><span class="sxs-lookup"><span data-stu-id="76a79-168">a higher TTL reduces the number of queries that land on the Traffic Manager DNS servers, which can reduce the cost for a customer since number of queries served is a billable usage.</span></span>
- <span data-ttu-id="76a79-169">較高的 TTL 可能會減少執行 DNS 查閱所花費的時間。</span><span class="sxs-lookup"><span data-stu-id="76a79-169">a higher TTL can potentially reduce the time it takes to do a DNS lookup.</span></span>
- <span data-ttu-id="76a79-170">較高的 TTL 也表示您的資料不會反映流量管理員透過其探查代理程式取得的最新健康情況資訊。</span><span class="sxs-lookup"><span data-stu-id="76a79-170">a higher TTL also means that your data does not reflect the latest health information that Traffic Manager has obtained through its probing agents.</span></span>

### <a name="how-high-or-low-can-i-set-the-ttl-for-traffic-manager-responses"></a><span data-ttu-id="76a79-171">我可以將流量管理員回應的 TTL 設為多高或多低？</span><span class="sxs-lookup"><span data-stu-id="76a79-171">How high or low can I set the TTL for Traffic Manager responses?</span></span>

<span data-ttu-id="76a79-172">您可以在每個設定檔層級將 DNS TTL 設定為最低 0 秒、最高 2,147,483,647 秒 (符合 [RFC-1035](https://www.ietf.org/rfc/rfc1035.txt ) 的最大範圍)。</span><span class="sxs-lookup"><span data-stu-id="76a79-172">You can set, at a per profile level, the DNS TTL to be as low as 0 seconds and as high as 2,147,483,647 seconds (the maximum range compliant with [RFC-1035](https://www.ietf.org/rfc/rfc1035.txt )).</span></span> <span data-ttu-id="76a79-173">當 TTL 為 0 時，表示下游 DNS 解析程式不會快取查詢回應，且所有查詢都預期觸達流量管理員 DNS 伺服器來進行解析。</span><span class="sxs-lookup"><span data-stu-id="76a79-173">A TTL of 0 means that downstream DNS resolvers do not cache query responses and all queries are expected to reach the Traffic Manager DNS servers for resolution.</span></span>

## <a name="traffic-manager-geographic-traffic-routing-method"></a><span data-ttu-id="76a79-174">流量管理員地理流量路由方法</span><span class="sxs-lookup"><span data-stu-id="76a79-174">Traffic Manager Geographic traffic routing method</span></span>

### <a name="what-are-some-use-cases-where-geographic-routing-is-useful"></a><span data-ttu-id="76a79-175">地理路由派上用場的使用案例有哪些？</span><span class="sxs-lookup"><span data-stu-id="76a79-175">What are some use cases where geographic routing is useful?</span></span> 
<span data-ttu-id="76a79-176">每當 Azure 客戶需要依據地理區域來區別他們的使用者位置時，就可以使用地理路由類型。</span><span class="sxs-lookup"><span data-stu-id="76a79-176">Geographic routing type can be used in any scenario where an Azure customer needs to distinguish their users based on geographic regions.</span></span> <span data-ttu-id="76a79-177">例如，使用地理流量路由方法，您可以為特定區域的使用者提供不同於其他區域的使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="76a79-177">For example, using the Geographic traffic routing method, you can give users from specific regions a different user experience than those from other regions.</span></span> <span data-ttu-id="76a79-178">另一個例子是符合本機資料主權規定，要求特定區域的使用者只能由該區域中的端點提供服務。</span><span class="sxs-lookup"><span data-stu-id="76a79-178">Another example is complying with local data sovereignty mandates that require that users from a specific region be served only by endpoints in that region.</span></span>

### <a name="what-are-the-regions-that-are-supported-by-traffic-manager-for-geographic-routing"></a><span data-ttu-id="76a79-179">流量管理員的地理路由支援哪些區域？</span><span class="sxs-lookup"><span data-stu-id="76a79-179">What are the regions that are supported by Traffic Manager for geographic routing?</span></span> 
<span data-ttu-id="76a79-180">[這裡](traffic-manager-geographic-regions.md)可以找到流量管理員所使用的國家/區域階層。</span><span class="sxs-lookup"><span data-stu-id="76a79-180">The country/region hierarchy that is used by Traffic Manager can be found [here](traffic-manager-geographic-regions.md).</span></span> <span data-ttu-id="76a79-181">雖然此頁面一有變動就會隨時更新，但您也可以透過程式設計方式，利用 [Azure 流量管理員 REST API](https://docs.microsoft.com/rest/api/trafficmanager/) 擷取相同的資訊。</span><span class="sxs-lookup"><span data-stu-id="76a79-181">While this page is kept up-to-date with any changes, you can also programmatically retrieve the same information by using the [Azure Traffic Manager REST API](https://docs.microsoft.com/rest/api/trafficmanager/).</span></span> 

### <a name="how-does-traffic-manager-determine-where-a-user-is-querying-from"></a><span data-ttu-id="76a79-182">流量管理員如何判斷使用者從何處執行查詢？</span><span class="sxs-lookup"><span data-stu-id="76a79-182">How does traffic manager determine where a user is querying from?</span></span> 
<span data-ttu-id="76a79-183">流量管理員會查看查詢的來源 IP (這很可能是代表使用者執行查詢的本機 DNS 解析程式)，並使用內部 IP 至區域的對應來判斷位置。</span><span class="sxs-lookup"><span data-stu-id="76a79-183">Traffic Manager looks at the source IP of the query (this most likely is a local DNS resolver doing the querying on behalf of the user) and uses an internal IP to region map to determine the location.</span></span> <span data-ttu-id="76a79-184">此對應會融合網際網路上的變動而不斷更新。</span><span class="sxs-lookup"><span data-stu-id="76a79-184">This map is updated on an ongoing basis to account for changes in the internet.</span></span> 

### <a name="is-it-guaranteed-that-traffic-manager-can-correctly-determine-the-exact-geographic-location-of-the-user-in-every-case"></a><span data-ttu-id="76a79-185">它保證流量管理員可以在每個案例中正確判斷使用者確切的地理位置嗎？</span><span class="sxs-lookup"><span data-stu-id="76a79-185">Is it guaranteed that Traffic Manager can correctly determine the exact geographic location of the user in every case?</span></span>
<span data-ttu-id="76a79-186">否，基於下列因素，流量管理員不能保證我們從 DNS 查詢的來源 IP 位址推斷的地理區域將會一律對應到使用者的位置：</span><span class="sxs-lookup"><span data-stu-id="76a79-186">No, Traffic Manager cannot guarantee that the geographic region we infer from the source IP address of a DNS query will always correspond to the user’s location due to the following reasons:</span></span> 

- <span data-ttu-id="76a79-187">首先，如先前的常見問題集所述，我們看到的來源 IP 位址是代表使用者執行查閱的 DNS 解析程式的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="76a79-187">First, as described in the previous FAQ, the source IP address we see is that of a DNS resolver doing the lookup on behalf of the user.</span></span> <span data-ttu-id="76a79-188">儘管 DNS 解析程式的地理位置是使用者地理位置的良好 Proxy，但是，根據 DNS 解析程式服務的使用量和客戶選擇使用的特定 DNS 解析程式服務而定，它也可以不一樣。</span><span class="sxs-lookup"><span data-stu-id="76a79-188">While the geographic location of the DNS resolver is a good proxy for the geographic location of the user, it can also be different depending upon the footprint of the DNS resolver service and the specific DNS resolver service a customer has chosen to use.</span></span> <span data-ttu-id="76a79-189">例如，位於馬來西亞的客戶可以在他們裝置的設定中指定使用 DNS 解析程式服務，此服務可能會挑選其位於新加坡的 DNS 伺服器來處理該使用者/裝置的查詢解析。</span><span class="sxs-lookup"><span data-stu-id="76a79-189">As an example, a customer located in Malaysia could specify in their device’s settings use a DNS resolver service whose DNS server in Singapore might get picked to handle the query resolutions for that user/device.</span></span> <span data-ttu-id="76a79-190">在此情況下，流量管理員只會看到解析程式對應到新加坡位置的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="76a79-190">In that case, Traffic Manager can only see the resolver’s IP address that corresponds to the Singapore location.</span></span> <span data-ttu-id="76a79-191">此外，請參閱此頁面上先前有關用戶端子網路位址支援的常見問題集。</span><span class="sxs-lookup"><span data-stu-id="76a79-191">Also, see the earlier FAQ regarding client subnet address support on this page.</span></span>

- <span data-ttu-id="76a79-192">其次，流量管理員會使用內部對應來進行 IP 位址到地理區域的轉譯。</span><span class="sxs-lookup"><span data-stu-id="76a79-192">Second, Traffic Manager uses an internal map to do the IP address to geographic region translation.</span></span> <span data-ttu-id="76a79-193">雖然此對應已通過驗證並持續更新以提供其精確度並負責網際網路的進化本質，但仍會產生我們的資料無法確切代表所有 IP 位址之地理位址的可能性。</span><span class="sxs-lookup"><span data-stu-id="76a79-193">While this map is validated and updated on an ongoing basis to increase its accuracy and account for the evolving nature of the internet, there is still the possibility that our information is not an exact representation of the geographic location of all the IP addresses.</span></span>


###  <a name="does-an-endpoint-need-to-be-physically-located-in-the-same-region-as-the-one-it-is-configured-with-for-geographic-routing"></a><span data-ttu-id="76a79-194">端點必須實際位於地理路由設定的相同區域嗎？</span><span class="sxs-lookup"><span data-stu-id="76a79-194">Does an endpoint need to be physically located in the same region as the one it is configured with for geographic routing?</span></span> 
<span data-ttu-id="76a79-195">否，端點的位置不限制哪些區域可以對應它。</span><span class="sxs-lookup"><span data-stu-id="76a79-195">No, the location of the endpoint imposes no restrictions on which regions can be mapped to it.</span></span> <span data-ttu-id="76a79-196">例如，美國中部 Azure 區域的端點可以接納所有來自印度的使用者。</span><span class="sxs-lookup"><span data-stu-id="76a79-196">For example, an endpoint in US-Central Azure region can have all users from India directed to it.</span></span>

### <a name="can-i-assign-geographic-regions-to-endpoints-in-a-profile-that-is-not-configured-to-do-geographic-routing"></a><span data-ttu-id="76a79-197">您可以在未設定為執行地理路由的設定檔中指派地理區域給端點嗎？</span><span class="sxs-lookup"><span data-stu-id="76a79-197">Can I assign geographic regions to endpoints in a profile that is not configured to do geographic routing?</span></span> 

<span data-ttu-id="76a79-198">是，如果設定檔的路由方法不是地理，您可以使用 [Azure 流量管理員 REST API](https://docs.microsoft.com/rest/api/trafficmanager/)，將地理區域指派給該設定檔中的端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-198">Yes, if the routing method of a profile is not geographic, you can use the [Azure Traffic Manager REST API](https://docs.microsoft.com/rest/api/trafficmanager/) to assign geographic regions to endpoints in that profile.</span></span> <span data-ttu-id="76a79-199">在非地理路由類型的設定檔中，將忽略此設定。</span><span class="sxs-lookup"><span data-stu-id="76a79-199">In the case of non-geographic routing type profiles, this configuration is ignored.</span></span> <span data-ttu-id="76a79-200">如果您稍後將此設定檔變更為地理路由類型，流量管理員可以使用這些對應。</span><span class="sxs-lookup"><span data-stu-id="76a79-200">If you change such a profile to geographic routing type at a later time, Traffic Manager can use those mappings.</span></span>


### <a name="why-am-i-getting-an-error-when-i-try-to-change-the-routing-method-of-an-existing-profile-to-geographic"></a><span data-ttu-id="76a79-201">當我嘗試將現有設定檔的路由方法變更為地理時為何會發生錯誤？</span><span class="sxs-lookup"><span data-stu-id="76a79-201">Why am I getting an error when I try to change the routing method of an existing profile to Geographic?</span></span>

<span data-ttu-id="76a79-202">設為地理路由的設定檔下的所有端點，必須至少有一個區域對應到它。</span><span class="sxs-lookup"><span data-stu-id="76a79-202">All the endpoints under a profile with geographic routing need to have at least one region mapped to it.</span></span> <span data-ttu-id="76a79-203">若要將現有的設定檔轉換成地理路由類型，您需要先使用 [Azure 流量管理員 REST API](https://docs.microsoft.com/rest/api/trafficmanager/)，將地理區域和其所有端點相關聯，才能將路由類型變更為地理。</span><span class="sxs-lookup"><span data-stu-id="76a79-203">To convert an existing profile to geographic routing type, you first need to associate geographic regions to all its endpoints using the [Azure Traffic Manager REST API](https://docs.microsoft.com/rest/api/trafficmanager/) before changing the routing type to geographic.</span></span> <span data-ttu-id="76a79-204">如果使用入口網站，先刪除端點，將設定檔的路由方法變更為地理，然後新增端點及其地理區域對應。</span><span class="sxs-lookup"><span data-stu-id="76a79-204">If using portal, first delete the endpoints, change the routing method of the profile to geographic and then add the endpoints along with their geographic region mapping.</span></span> 


###  <a name="why-is-it-strongly-recommended-that-customers-create-nested-profiles-instead-of-endpoints-under-a-profile-with-geographic-routing-enabled"></a><span data-ttu-id="76a79-205">為什麼強烈建議客戶建立巢狀設定檔，而不是在啟用地理路由的設定檔下新增端點？</span><span class="sxs-lookup"><span data-stu-id="76a79-205">Why is it strongly recommended that customers create nested profiles instead of endpoints under a profile with geographic routing enabled?</span></span> 

<span data-ttu-id="76a79-206">在使用地理路由類型的設定檔內，一個區域只能指派給一個端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-206">A region can be assigned to only one endpoint within a profile if its using geographic routing type.</span></span> <span data-ttu-id="76a79-207">如果該端點不是已連結子設定檔的巢狀類型，萬一該端點變成狀況不良，流量管理員會繼續將流量傳送給它，因為選擇不傳送任何流量也沒有比較好。</span><span class="sxs-lookup"><span data-stu-id="76a79-207">If that endpoint is not a nested type with a child profile attached to it, if that endpoint going unhealthy, Traffic Manager continues to send traffic to it since the alternative of not sending any traffic isn’t any better.</span></span> <span data-ttu-id="76a79-208">即使指派的區域位於指派給狀況不良端點的區域「上層」，流量管理員也不會容錯移轉至另一個端點 (例如，如果端點的西班牙區域狀況不良，我們不會容錯移轉至另一個已被指派歐洲地區的端點)。</span><span class="sxs-lookup"><span data-stu-id="76a79-208">Traffic Manager does not failover to another endpoint, even when the region assigned is a “parent” of the region assigned to the endpoint that went unhealthy (for example, if an endpoint that has region Spain goes unhealthy, we will not failover to another endpoint that has the region Europe assigned to it).</span></span> <span data-ttu-id="76a79-209">這是為了確保流量管理員會顧及客戶在其設定檔中已設定的地理界限。</span><span class="sxs-lookup"><span data-stu-id="76a79-209">This is done to ensure that Traffic Manager respects the geographic boundaries that a customer has setup in their profile.</span></span> <span data-ttu-id="76a79-210">若要在端點變成狀況不良時能夠容錯移轉至另一個端點，建議將地理區域指派給內有多個端點的巢狀設定檔，而不是指派給個別的端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-210">To get the benefit of failing over to another endpoint when an endpoint goes unhealthy, it is recommended that geographic regions be assigned to nested profiles with multiple endpoints within it instead of individual endpoints.</span></span> <span data-ttu-id="76a79-211">如此一來，如果巢狀子設定檔中的端點失敗，流量就可以容錯移轉至相同巢狀子設定檔內的另一個端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-211">In this way, if an endpoint in the nested child profile fails, traffic can failover to another endpoint inside the same nested child profile.</span></span>

### <a name="are-there-any-restrictions-on-the-api-version-that-supports-this-routing-type"></a><span data-ttu-id="76a79-212">支援此路由類型的 API 版本有任何限制嗎？</span><span class="sxs-lookup"><span data-stu-id="76a79-212">Are there any restrictions on the API version that supports this routing type?</span></span>

<span data-ttu-id="76a79-213">是，只有 2017 年 3 月 1 日的 API 版本和更新版本支援地理路由類型。</span><span class="sxs-lookup"><span data-stu-id="76a79-213">Yes, only API version 2017-03-01 and newer supports the Geographic routing type.</span></span> <span data-ttu-id="76a79-214">任何舊版 API 都無法用來建立地理路由類型的設定檔，或將地理區域指派給端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-214">Any older API versions cannot be used to created profiles of Geographic routing type or assign geographic regions to endpoints.</span></span> <span data-ttu-id="76a79-215">如果使用舊版 API 從 Azure 訂用帳戶擷取設定檔，將不會傳回地理路由類型的任何設定檔。</span><span class="sxs-lookup"><span data-stu-id="76a79-215">If an older API version is used to retrieve profiles from an Azure subscription, any profile of Geographic routing type is not returned.</span></span> <span data-ttu-id="76a79-216">此外，使用舊版 API 時，傳回的任何設定檔如果有已指派地理區域的端點，則不會顯示其地理區域指派。</span><span class="sxs-lookup"><span data-stu-id="76a79-216">In addition, when using older API versions, any profile returned that has endpoints with a geographic region assignment, does not have its geographic region assignment shown.</span></span>



## <a name="traffic-manager-endpoints"></a><span data-ttu-id="76a79-217">流量管理員端點</span><span class="sxs-lookup"><span data-stu-id="76a79-217">Traffic Manager endpoints</span></span>

### <a name="can-i-use-traffic-manager-with-endpoints-from-multiple-subscriptions"></a><span data-ttu-id="76a79-218">可以將流量管理員用於來自多個訂用帳戶的端點嗎？</span><span class="sxs-lookup"><span data-stu-id="76a79-218">Can I use Traffic Manager with endpoints from multiple subscriptions?</span></span>

<span data-ttu-id="76a79-219">來自多個訂用帳戶的端點不能與 Azure Web 應用程式搭配使用。</span><span class="sxs-lookup"><span data-stu-id="76a79-219">Using endpoints from multiple subscriptions is not possible with Azure Web Apps.</span></span> <span data-ttu-id="76a79-220">Azure Web Apps 規定 Web Apps 使用的任何自訂網域名稱只能在單一訂用帳戶內使用。</span><span class="sxs-lookup"><span data-stu-id="76a79-220">Azure Web Apps requires that any custom domain name used with Web Apps is only used within a single subscription.</span></span> <span data-ttu-id="76a79-221">無法使用具有相同網域名稱的多個訂用帳戶中的 Web Apps。</span><span class="sxs-lookup"><span data-stu-id="76a79-221">It is not possible to use Web Apps from multiple subscriptions with the same domain name.</span></span>

<span data-ttu-id="76a79-222">針對其他端點類型，則可以將「流量管理員」與來自多個訂用帳戶的端點搭配使用。</span><span class="sxs-lookup"><span data-stu-id="76a79-222">For other endpoint types, it is possible to use Traffic Manager with endpoints from more than one subscription.</span></span> <span data-ttu-id="76a79-223">在 Resource Manager 中，來自任何訂用帳戶的端點都可以新增至流量管理員，只要設定流量管理員設定檔的人員具有端點的讀取權限即可。</span><span class="sxs-lookup"><span data-stu-id="76a79-223">In Resource Manager, endpoints from any subscription can be added to Traffic Manager, as long as the person configuring the Traffic Manager profile has read access to the endpoint.</span></span> <span data-ttu-id="76a79-224">使用 [Azure Resource Manager 角色型存取控制 (RBAC)](../active-directory/role-based-access-control-configure.md)可以授與這些權限。</span><span class="sxs-lookup"><span data-stu-id="76a79-224">These permissions can be granted using [Azure Resource Manager role-based access control (RBAC)](../active-directory/role-based-access-control-configure.md).</span></span>


### <a name="can-i-use-traffic-manager-with-cloud-service-staging-slots"></a><span data-ttu-id="76a79-225">我可以使用流量管理員來設定雲端服務「預備」位置嗎？</span><span class="sxs-lookup"><span data-stu-id="76a79-225">Can I use Traffic Manager with Cloud Service 'Staging' slots?</span></span>

<span data-ttu-id="76a79-226">是。</span><span class="sxs-lookup"><span data-stu-id="76a79-226">Yes.</span></span> <span data-ttu-id="76a79-227">雲端服務「預備」位置可在流量管理員中設定為外部端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-227">Cloud Service 'staging' slots can be configured in Traffic Manager as External endpoints.</span></span> <span data-ttu-id="76a79-228">健康情況檢查仍然以 Azure 端點費率計費。</span><span class="sxs-lookup"><span data-stu-id="76a79-228">Health checks are still be charged at the Azure Endpoints rate.</span></span> <span data-ttu-id="76a79-229">因為外部端點類型正在使用中，所以不會自動挑選基礎服務的變更。</span><span class="sxs-lookup"><span data-stu-id="76a79-229">Because the External endpoint type is in use, changes to the underlying service are not picked up automatically.</span></span> <span data-ttu-id="76a79-230">使用外部端點時，流量管理員無法偵測雲端服務何時停止或刪除。</span><span class="sxs-lookup"><span data-stu-id="76a79-230">With external endpoints, Traffic Manager cannot detect when the Cloud Service is stopped or deleted.</span></span> <span data-ttu-id="76a79-231">因此，流量管理員會持續計費健康情況檢查，直到停用或刪除端點為止。</span><span class="sxs-lookup"><span data-stu-id="76a79-231">Therefore, the Traffic Manager continues billing for health checks until the endpoint is disabled or deleted.</span></span>

### <a name="does-traffic-manager-support-ipv6-endpoints"></a><span data-ttu-id="76a79-232">流量管理員是否支援 IPv6 端點？</span><span class="sxs-lookup"><span data-stu-id="76a79-232">Does Traffic Manager support IPv6 endpoints?</span></span>

<span data-ttu-id="76a79-233">流量管理員目前不提供 IPv6 定址的名稱伺服器。</span><span class="sxs-lookup"><span data-stu-id="76a79-233">Traffic Manager does not currently provide IPv6-addressible name servers.</span></span> <span data-ttu-id="76a79-234">不過，連接到 IPv6 端點的 IPv6 用戶端仍然可以使用流量管理員。</span><span class="sxs-lookup"><span data-stu-id="76a79-234">However, Traffic Manager can still be used by IPv6 clients connecting to IPv6 endpoints.</span></span> <span data-ttu-id="76a79-235">用戶端不會直接向流量管理員提出 DNS 要求。</span><span class="sxs-lookup"><span data-stu-id="76a79-235">A client does not make DNS requests directly to Traffic Manager.</span></span> <span data-ttu-id="76a79-236">相反地，用戶端會使用遞迴 DNS 服務。</span><span class="sxs-lookup"><span data-stu-id="76a79-236">Instead, the client uses a recursive DNS service.</span></span> <span data-ttu-id="76a79-237">僅支援 IPv6 的用戶端會透過 IPv6 將要求傳送至遞迴 DNS 服務。</span><span class="sxs-lookup"><span data-stu-id="76a79-237">An IPv6-only client sends requests to the recursive DNS service via IPv6.</span></span> <span data-ttu-id="76a79-238">然後，遞迴服務應該就能夠使用 IPv4 來連絡流量管理員名稱伺服器。</span><span class="sxs-lookup"><span data-stu-id="76a79-238">Then the recursive service should be able to contact the Traffic Manager name servers using IPv4.</span></span>

<span data-ttu-id="76a79-239">流量管理員會以端點的 DNS 名稱來回應。</span><span class="sxs-lookup"><span data-stu-id="76a79-239">Traffic Manager responds with the DNS name of the endpoint.</span></span> <span data-ttu-id="76a79-240">為了支援 IPv6 端點，必須有一筆 DNS AAAA 記錄將端點 DNS 名稱指向 IPv6 位址。</span><span class="sxs-lookup"><span data-stu-id="76a79-240">To support an IPv6 endpoint, a DNS AAAA record pointing the endpoint DNS name to the IPv6 address must exist.</span></span> <span data-ttu-id="76a79-241">流量管理員健康情況檢查僅支援 IPv4 位址。</span><span class="sxs-lookup"><span data-stu-id="76a79-241">Traffic Manager health checks only support IPv4 addresses.</span></span> <span data-ttu-id="76a79-242">此服務必須在相同 DNS 名稱上公開 IPv4 端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-242">The service needs to expose an IPv4 endpoint on the same DNS name.</span></span>

### <a name="can-i-use-traffic-manager-with-more-than-one-web-app-in-the-same-region"></a><span data-ttu-id="76a79-243">可以使用流量管理員搭配相同區域中的多個 Web 應用程式嗎？</span><span class="sxs-lookup"><span data-stu-id="76a79-243">Can I use Traffic Manager with more than one Web App in the same region?</span></span>

<span data-ttu-id="76a79-244">通常，流量管理員用於將流量導向不同區域中部署的應用程式。</span><span class="sxs-lookup"><span data-stu-id="76a79-244">Typically, Traffic Manager is used to direct traffic to applications deployed in different regions.</span></span> <span data-ttu-id="76a79-245">不過，也可用於應用程式在相同區域中有多個部署時。</span><span class="sxs-lookup"><span data-stu-id="76a79-245">However, it can also be used where an application has more than one deployment in the same region.</span></span> <span data-ttu-id="76a79-246">流量管理員 Azure 端點不允許將相同 Azure 區域中的多個 Web 應用程式端點新增至相同的流量管理員設定檔。</span><span class="sxs-lookup"><span data-stu-id="76a79-246">The Traffic Manager Azure endpoints do not permit more than one Web App endpoint from the same Azure region to be added to the same Traffic Manager profile.</span></span>

##  <a name="traffic-manager-endpoint-monitoring"></a><span data-ttu-id="76a79-247">流量管理員端點監視</span><span class="sxs-lookup"><span data-stu-id="76a79-247">Traffic Manager endpoint monitoring</span></span>

### <a name="is-traffic-manager-resilient-to-azure-region-failures"></a><span data-ttu-id="76a79-248">流量管理員有能力從 Azure 區域失敗中恢復嗎？</span><span class="sxs-lookup"><span data-stu-id="76a79-248">Is Traffic Manager resilient to Azure region failures?</span></span>

<span data-ttu-id="76a79-249">流量管理員在 Azure 中是提供高可用性應用程式的一個重要元件。</span><span class="sxs-lookup"><span data-stu-id="76a79-249">Traffic Manager is a key component of the delivery of highly available applications in Azure.</span></span>
<span data-ttu-id="76a79-250">若要提供高可用性，流量管理員必須擁有極高的可用性，並且可從區域失敗中恢復。</span><span class="sxs-lookup"><span data-stu-id="76a79-250">To deliver high availability, Traffic Manager must have an exceptionally high level of availability and be resilient to regional failure.</span></span>

<span data-ttu-id="76a79-251">根據設計，流量管理員元件可從任何 Azure 區域的全面失敗中恢復。</span><span class="sxs-lookup"><span data-stu-id="76a79-251">By design, Traffic Manager components are resilient to a complete failure of any Azure region.</span></span> <span data-ttu-id="76a79-252">此恢復功能適用於所有流量管理員元件︰DNS 名稱伺服器、API、儲存層及端點監視服務。</span><span class="sxs-lookup"><span data-stu-id="76a79-252">This resilience applies to all Traffic Manager components: the DNS name servers, the API, the storage layer, and the endpoint monitoring service.</span></span>

<span data-ttu-id="76a79-253">萬一整個 Azure 區域停機，也能預期流量管理員會持續正常運作。</span><span class="sxs-lookup"><span data-stu-id="76a79-253">In the unlikely event of an outage of an entire Azure region, Traffic Manager is expected to continue to function normally.</span></span> <span data-ttu-id="76a79-254">在多個 Azure 區域中部署的應用程式可依賴流量管理員，將流量導向其應用程式的可用執行個體。</span><span class="sxs-lookup"><span data-stu-id="76a79-254">Applications deployed in multiple Azure regions can rely on Traffic Manager to direct traffic to an available instance of their application.</span></span>

### <a name="how-does-the-choice-of-resource-group-location-affect-traffic-manager"></a><span data-ttu-id="76a79-255">資源群組位置的選擇如何影響流量管理員？</span><span class="sxs-lookup"><span data-stu-id="76a79-255">How does the choice of resource group location affect Traffic Manager?</span></span>

<span data-ttu-id="76a79-256">流量管理員是單一全域服務。</span><span class="sxs-lookup"><span data-stu-id="76a79-256">Traffic Manager is a single, global service.</span></span> <span data-ttu-id="76a79-257">不是區域性。</span><span class="sxs-lookup"><span data-stu-id="76a79-257">It is not regional.</span></span> <span data-ttu-id="76a79-258">如何選擇資源群組位置，對於部署在該資源群組中的流量管理員設定檔而言，並沒有差別。</span><span class="sxs-lookup"><span data-stu-id="76a79-258">The choice of resource group location makes no difference to Traffic Manager profiles deployed in that resource group.</span></span>

<span data-ttu-id="76a79-259">Azure Resource Manager 需要所有資源群組指定位置，這會決定部署在該資源群組中資源的預設位置。</span><span class="sxs-lookup"><span data-stu-id="76a79-259">Azure Resource Manager requires all resource groups to specify a location, which determines the default location for resources deployed in that resource group.</span></span> <span data-ttu-id="76a79-260">當您建立流量管理員設定檔時，它會建立在資源群組中。</span><span class="sxs-lookup"><span data-stu-id="76a79-260">When you create a Traffic Manager profile, it is created in a resource group.</span></span> <span data-ttu-id="76a79-261">所有流量管理員設定檔都使用**全域**當作位置，覆寫資源群組預設值。</span><span class="sxs-lookup"><span data-stu-id="76a79-261">All Traffic Manager profiles use **global** as their location, overriding the resource group default.</span></span>

### <a name="how-do-i-determine-the-current-health-of-each-endpoint"></a><span data-ttu-id="76a79-262">如何判斷每個端點目前的健全狀況？</span><span class="sxs-lookup"><span data-stu-id="76a79-262">How do I determine the current health of each endpoint?</span></span>

<span data-ttu-id="76a79-263">每個端點的目前監視狀態以及整體設定檔都會顯示於 Azure 入口網站中。</span><span class="sxs-lookup"><span data-stu-id="76a79-263">The current monitoring status of each endpoint, in addition to the overall profile, is displayed in the Azure portal.</span></span> <span data-ttu-id="76a79-264">您也可以透過流量監視 [REST API](https://msdn.microsoft.com/library/azure/mt163667.aspx)、[PowerShell cmdlets](https://msdn.microsoft.com/library/mt125941.aspx) 和[跨平台 Azure CLI](../cli-install-nodejs.md) 取得此資訊。</span><span class="sxs-lookup"><span data-stu-id="76a79-264">This information also is available via the Traffic Monitor [REST API](https://msdn.microsoft.com/library/azure/mt163667.aspx), [PowerShell cmdlets](https://msdn.microsoft.com/library/mt125941.aspx), and [cross-platform Azure CLI](../cli-install-nodejs.md).</span></span>

<span data-ttu-id="76a79-265">Azure 未提供關於過去端點健全狀況的歷程記錄資訊，或針對端點健全狀況的變更來提出警示的能力。</span><span class="sxs-lookup"><span data-stu-id="76a79-265">Azure does not provide historical information about past endpoint health or the ability to raise alerts about changes to endpoint health.</span></span>

### <a name="can-i-monitor-https-endpoints"></a><span data-ttu-id="76a79-266">我可以監視 HTTPS 端點嗎？</span><span class="sxs-lookup"><span data-stu-id="76a79-266">Can I monitor HTTPS endpoints?</span></span>

<span data-ttu-id="76a79-267">是。</span><span class="sxs-lookup"><span data-stu-id="76a79-267">Yes.</span></span> <span data-ttu-id="76a79-268">流量管理員支援透過 HTTPS 探查。</span><span class="sxs-lookup"><span data-stu-id="76a79-268">Traffic Manager supports probing over HTTPS.</span></span> <span data-ttu-id="76a79-269">在監視組態中將 **HTTPS** 設定為通訊協定。</span><span class="sxs-lookup"><span data-stu-id="76a79-269">Configure **HTTPS** as the protocol in the monitoring configuration.</span></span>

<span data-ttu-id="76a79-270">流量管理員無法提供任何憑證驗證，包括：</span><span class="sxs-lookup"><span data-stu-id="76a79-270">Traffic manager cannot provide any certificate validation, including:</span></span>

* <span data-ttu-id="76a79-271">不會驗證伺服器端憑證</span><span class="sxs-lookup"><span data-stu-id="76a79-271">Server-side certificates are not validated</span></span>
* <span data-ttu-id="76a79-272">不支援 SNI 伺服器端憑證</span><span class="sxs-lookup"><span data-stu-id="76a79-272">SNI server-side certificates are not supported</span></span>
* <span data-ttu-id="76a79-273">不支援用戶端憑證</span><span class="sxs-lookup"><span data-stu-id="76a79-273">Client certificates are not supported</span></span>

### <a name="can-i-use-traffic-manager-even-if-my-application-does-not-have-support-for-http-or-https"></a><span data-ttu-id="76a79-274">即使我的應用程式不支援 HTTP 或 HTTPS 也可以使用流量管理員嗎？</span><span class="sxs-lookup"><span data-stu-id="76a79-274">Can I use Traffic Manager even if my application does not have support for HTTP or HTTPS?</span></span>

<span data-ttu-id="76a79-275">是。</span><span class="sxs-lookup"><span data-stu-id="76a79-275">Yes.</span></span> <span data-ttu-id="76a79-276">您可以指定 TCP 作為監視通訊協定，流量管理員可以起始 TCP 連線，並且等待端點的回應。</span><span class="sxs-lookup"><span data-stu-id="76a79-276">You can specify TCP as the monitoring protocol and Traffic Manager can initiate a TCP connection and wait for a response from the endpoint.</span></span> <span data-ttu-id="76a79-277">如果端點在逾時期間內以建立連線的回應來回覆連線要求，則該端點會標示為狀況良好。</span><span class="sxs-lookup"><span data-stu-id="76a79-277">If the endpoint replies to the connection request with a response to establish the connection, within the timeout period, then that endpoint is marked as healthy.</span></span>

### <a name="what-specific-responses-are-required-from-the-endpoint-when-using-tcp-monitoring"></a><span data-ttu-id="76a79-278">使用 TCP 監視時需要端點的哪些特定回應？</span><span class="sxs-lookup"><span data-stu-id="76a79-278">What specific responses are required from the endpoint when using TCP monitoring?</span></span>

<span data-ttu-id="76a79-279">使用 TCP 監視時，流量管理員會啟動三向 TCP 交握，方法是將 SYN 要求傳送至端點的指定連接埠。</span><span class="sxs-lookup"><span data-stu-id="76a79-279">When TCP monitoring is used, Traffic Manager starts a three-way TCP handshake by sending a SYN request to endpoint at the specified port.</span></span> <span data-ttu-id="76a79-280">接著會等待一段時間 (在逾時設定中指定) 讓端點回應。</span><span class="sxs-lookup"><span data-stu-id="76a79-280">It then waits for a period of time (as specified in the timeout settings) for a response from the endpoint.</span></span> <span data-ttu-id="76a79-281">如果端點在監視設定指定的逾時期間內以 SYN-ACK 回應 SYN 要求，則該端點視為狀況良好。</span><span class="sxs-lookup"><span data-stu-id="76a79-281">If the endpoint responds to the SYN request with a SYN-ACK response within the timeout period specified in the monitoring settings, then that endpoint is considered healthy.</span></span> <span data-ttu-id="76a79-282">如果收到 SYN-ACK 回應，流量管理員會藉由再回應 RST 以重設連線。</span><span class="sxs-lookup"><span data-stu-id="76a79-282">If the SYN-ACK response is received, the Traffic Manager resets the connection by responding back with a RST.</span></span>

### <a name="how-fast-does-traffic-manager-move-my-users-away-from-an-unhealthy-endpoint"></a><span data-ttu-id="76a79-283">流量管理員將我的使用者從狀況不良的端點移開時間有多快？</span><span class="sxs-lookup"><span data-stu-id="76a79-283">How fast does Traffic Manager move my users away from an unhealthy endpoint?</span></span>

<span data-ttu-id="76a79-284">流量管理員提供多項設定，可協助您控制流量管理員設定檔的容錯移轉行為，如下所示：</span><span class="sxs-lookup"><span data-stu-id="76a79-284">Traffic Manager provides multiple settings that can help you to control the failover behavior of your Traffic Manager profile as follows:</span></span>
- <span data-ttu-id="76a79-285">您可以將探查間隔設定為 10 秒，指定流量管理員更頻繁地探查端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-285">you can specify that the Traffic Manager probes the endpoints more frequently by setting the Probing Interval at 10 seconds.</span></span> <span data-ttu-id="76a79-286">這可確保能夠立即偵測到狀況不良的任何端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-286">This ensures that any endpoint going unhealthy can be detected as soon as possible.</span></span> 
- <span data-ttu-id="76a79-287">您可以指定在健康情況檢查要求逾時之前要等候多久時間 (最小逾時值是 5 秒)。</span><span class="sxs-lookup"><span data-stu-id="76a79-287">you can specify how long to wait before a health check request times out (minimum time out value is 5 sec).</span></span>
- <span data-ttu-id="76a79-288">您可以指定在端點標示為狀況不良之前，可以發生多少次失敗。</span><span class="sxs-lookup"><span data-stu-id="76a79-288">you can specify how many failures can occur before the endpoint is marked as unhealthy.</span></span> <span data-ttu-id="76a79-289">這個值最低可以為 0，只要端點的第一次健康情況檢查失敗，就會標示為狀況不良。</span><span class="sxs-lookup"><span data-stu-id="76a79-289">This value can be low as 0, in which case the endpoint is marked unhealthy as soon as it fails the first health check.</span></span> <span data-ttu-id="76a79-290">不過，對於容許失敗次數使用最小值 0，可能會導致因為在探查時可能發生的任何暫時性問題，讓端點離開輪替。</span><span class="sxs-lookup"><span data-stu-id="76a79-290">However, using the minimum value of 0 for the tolerated number of failures can lead to endpoints being taken out of rotation due to any transient issues that may occur at the time of probing.</span></span>
- <span data-ttu-id="76a79-291">您可以將 DNS 回應的存留時間 (TTL) 指定為最低的 0。</span><span class="sxs-lookup"><span data-stu-id="76a79-291">you can specify the time-to-live (TTL) for the DNS response to be as low as 0.</span></span> <span data-ttu-id="76a79-292">這麼做表示 DNS 解析程式無法快取回應，每個新的查詢會取得回應，其中包含流量管理員具有的最新健康情況資訊。</span><span class="sxs-lookup"><span data-stu-id="76a79-292">Doing so means that DNS resolvers cannot cache the response and each new query gets a response that incorporates the most up-to-date health information that the Traffic Manager has.</span></span>

<span data-ttu-id="76a79-293">藉由使用這些設定，流量管理員可以提供在端點變成狀況不良之後 10 秒內的容錯移轉，以及針對對應設定檔進行 DNS 查詢。</span><span class="sxs-lookup"><span data-stu-id="76a79-293">By using these settings, Traffic Manager can provide failovers under 10 seconds after an endpoint goes unhealthy and a DNS query is made against the corresponding profile.</span></span>

### <a name="how-can-i-specify-different-monitoring-settings-for-different-endpoints-in-a-profile"></a><span data-ttu-id="76a79-294">如何為設定檔中不同的端點指定不同監視設定？</span><span class="sxs-lookup"><span data-stu-id="76a79-294">How can I specify different monitoring settings for different endpoints in a profile?</span></span>

<span data-ttu-id="76a79-295">流量管理員監視設定是在各個設定檔層級。</span><span class="sxs-lookup"><span data-stu-id="76a79-295">Traffic Manager monitoring settings are at a per profile level.</span></span> <span data-ttu-id="76a79-296">如果您只需要為一個端點使用不同的監視設定，可以藉由讓該端點成為[巢狀設定檔](traffic-manager-nested-profiles.md)來完成，其監視設定與父代設定檔不同。</span><span class="sxs-lookup"><span data-stu-id="76a79-296">If you need to use a different monitoring setting for only one endpoint, it can be done by having that endpoint as a [nested profile](traffic-manager-nested-profiles.md) whose monitoring settings are different from the parent profile.</span></span>

### <a name="what-host-header-do-endpoint-health-checks-use"></a><span data-ttu-id="76a79-297">端點健全狀況檢查使用哪一個主機標頭？</span><span class="sxs-lookup"><span data-stu-id="76a79-297">What host header do endpoint health checks use?</span></span>

<span data-ttu-id="76a79-298">流量管理員在 HTTP 和 HTTPS 的健康狀態檢查中使用主機標頭。</span><span class="sxs-lookup"><span data-stu-id="76a79-298">Traffic Manager uses host headers in HTTP and HTTPS health checks.</span></span> <span data-ttu-id="76a79-299">流量管理員所使用的主機標頭是設定檔中設定的端點目標名稱。</span><span class="sxs-lookup"><span data-stu-id="76a79-299">The host header used by Traffic Manager is the name of the endpoint target configured in the profile.</span></span> <span data-ttu-id="76a79-300">主機標頭中使用的值不能與目標屬性分開指定。</span><span class="sxs-lookup"><span data-stu-id="76a79-300">The value used in the host header cannot be specified separately from the target property.</span></span>

### <a name="what-are-the-ip-addresses-from-which-the-health-checks-originate"></a><span data-ttu-id="76a79-301">健康情況檢查是從哪些 IP 位址產生？</span><span class="sxs-lookup"><span data-stu-id="76a79-301">What are the IP addresses from which the health checks originate?</span></span>

<span data-ttu-id="76a79-302">下列清單包含從流量管理員健康狀態檢查可產生的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="76a79-302">The following list contains the IP addresses from which Traffic Manager health checks can originate.</span></span> <span data-ttu-id="76a79-303">您可以使用此清單來確保端點會允許來自這些 IP 位址的連入連線，以檢查其健康情況狀態。</span><span class="sxs-lookup"><span data-stu-id="76a79-303">You may use this list to ensure that incoming connections from these IP addresses are allowed at the endpoints to check its health status.</span></span>

* <span data-ttu-id="76a79-304">40.68.30.66</span><span class="sxs-lookup"><span data-stu-id="76a79-304">40.68.30.66</span></span>
* <span data-ttu-id="76a79-305">40.68.31.178</span><span class="sxs-lookup"><span data-stu-id="76a79-305">40.68.31.178</span></span>
* <span data-ttu-id="76a79-306">137.135.80.149</span><span class="sxs-lookup"><span data-stu-id="76a79-306">137.135.80.149</span></span>
* <span data-ttu-id="76a79-307">137.135.82.249</span><span class="sxs-lookup"><span data-stu-id="76a79-307">137.135.82.249</span></span>
* <span data-ttu-id="76a79-308">23.96.236.252</span><span class="sxs-lookup"><span data-stu-id="76a79-308">23.96.236.252</span></span>
* <span data-ttu-id="76a79-309">65.52.217.19</span><span class="sxs-lookup"><span data-stu-id="76a79-309">65.52.217.19</span></span>
* <span data-ttu-id="76a79-310">40.87.147.10</span><span class="sxs-lookup"><span data-stu-id="76a79-310">40.87.147.10</span></span>
* <span data-ttu-id="76a79-311">40.87.151.34</span><span class="sxs-lookup"><span data-stu-id="76a79-311">40.87.151.34</span></span>
* <span data-ttu-id="76a79-312">13.75.124.254</span><span class="sxs-lookup"><span data-stu-id="76a79-312">13.75.124.254</span></span>
* <span data-ttu-id="76a79-313">13.75.127.63</span><span class="sxs-lookup"><span data-stu-id="76a79-313">13.75.127.63</span></span>
* <span data-ttu-id="76a79-314">52.172.155.168</span><span class="sxs-lookup"><span data-stu-id="76a79-314">52.172.155.168</span></span>
* <span data-ttu-id="76a79-315">52.172.158.37</span><span class="sxs-lookup"><span data-stu-id="76a79-315">52.172.158.37</span></span>
* <span data-ttu-id="76a79-316">104.215.91.84</span><span class="sxs-lookup"><span data-stu-id="76a79-316">104.215.91.84</span></span>
* <span data-ttu-id="76a79-317">13.75.153.124</span><span class="sxs-lookup"><span data-stu-id="76a79-317">13.75.153.124</span></span>
* <span data-ttu-id="76a79-318">13.84.222.37</span><span class="sxs-lookup"><span data-stu-id="76a79-318">13.84.222.37</span></span>
* <span data-ttu-id="76a79-319">23.101.191.199</span><span class="sxs-lookup"><span data-stu-id="76a79-319">23.101.191.199</span></span>
* <span data-ttu-id="76a79-320">23.96.213.12</span><span class="sxs-lookup"><span data-stu-id="76a79-320">23.96.213.12</span></span>
* <span data-ttu-id="76a79-321">137.135.46.163</span><span class="sxs-lookup"><span data-stu-id="76a79-321">137.135.46.163</span></span>
* <span data-ttu-id="76a79-322">137.135.47.215</span><span class="sxs-lookup"><span data-stu-id="76a79-322">137.135.47.215</span></span>
* <span data-ttu-id="76a79-323">191.232.208.52</span><span class="sxs-lookup"><span data-stu-id="76a79-323">191.232.208.52</span></span>
* <span data-ttu-id="76a79-324">191.232.214.62</span><span class="sxs-lookup"><span data-stu-id="76a79-324">191.232.214.62</span></span>
* <span data-ttu-id="76a79-325">13.75.152.253</span><span class="sxs-lookup"><span data-stu-id="76a79-325">13.75.152.253</span></span>
* <span data-ttu-id="76a79-326">104.41.187.209</span><span class="sxs-lookup"><span data-stu-id="76a79-326">104.41.187.209</span></span>
* <span data-ttu-id="76a79-327">104.41.190.203</span><span class="sxs-lookup"><span data-stu-id="76a79-327">104.41.190.203</span></span>

### <a name="how-many-health-checks-to-my-endpoint-can-i-expect-from-traffic-manager"></a><span data-ttu-id="76a79-328">流量管理員會對端點進行多少健康情況檢查？</span><span class="sxs-lookup"><span data-stu-id="76a79-328">How many health checks to my endpoint can I expect from Traffic Manager?</span></span>

<span data-ttu-id="76a79-329">流量管理員對於您端點的健康情況檢查數目取決於下列項目：</span><span class="sxs-lookup"><span data-stu-id="76a79-329">The number of Traffic Manager health checks reaching your endpoint depends on the following:</span></span>
- <span data-ttu-id="76a79-330">您為監視間隔所設定的值 (較小間隔表示在任何指定時間期間內有更多要求進入端點)。</span><span class="sxs-lookup"><span data-stu-id="76a79-330">the value that you have set for the monitoring interval (smaller interval means more requests landing on your endpoint in any given time period).</span></span>
- <span data-ttu-id="76a79-331">產生健康情況檢查的位置數目 (您可以預期這些檢查列在上述常見問題集的 IP 位址)。</span><span class="sxs-lookup"><span data-stu-id="76a79-331">the number of locations from where the health checks originate (the IP addresses from where you can expect these checks is listed in the preceding FAQ).</span></span>

## <a name="traffic-manager-nested-profiles"></a><span data-ttu-id="76a79-332">流量管理員巢狀設定檔</span><span class="sxs-lookup"><span data-stu-id="76a79-332">Traffic Manager nested profiles</span></span>

### <a name="how-do-i-configure-nested-profiles"></a><span data-ttu-id="76a79-333">如何設定巢狀設定檔？</span><span class="sxs-lookup"><span data-stu-id="76a79-333">How do I configure nested profiles?</span></span>

<span data-ttu-id="76a79-334">您可以使用 Azure Resource Manager 和傳統 Azure REST API、Azure PowerShell Cmdlet 及跨平台 Azure CLI 命令來設定巢狀流量管理員設定檔。</span><span class="sxs-lookup"><span data-stu-id="76a79-334">Nested Traffic Manager profiles can be configured using both the Azure Resource Manager and the classic Azure REST APIs, Azure PowerShell cmdlets and cross-platform Azure CLI commands.</span></span> <span data-ttu-id="76a79-335">透過新的 Azure 入口網站也支援它們。</span><span class="sxs-lookup"><span data-stu-id="76a79-335">They are also supported via the new Azure portal.</span></span> <span data-ttu-id="76a79-336">傳統入口網站不支援它們。</span><span class="sxs-lookup"><span data-stu-id="76a79-336">They are not supported in the classic portal.</span></span>

### <a name="how-many-layers-of-nesting-does-traffic-manger-support"></a><span data-ttu-id="76a79-337">流量管理員支援幾層巢狀結構？</span><span class="sxs-lookup"><span data-stu-id="76a79-337">How many layers of nesting does Traffic Manger support?</span></span>

<span data-ttu-id="76a79-338">設定檔的巢狀結構深度最多可達 10 層。</span><span class="sxs-lookup"><span data-stu-id="76a79-338">You can nest profiles up to 10 levels deep.</span></span> <span data-ttu-id="76a79-339">不允許使用「迴圈」。</span><span class="sxs-lookup"><span data-stu-id="76a79-339">'Loops' are not permitted.</span></span>

### <a name="can-i-mix-other-endpoint-types-with-nested-child-profiles-in-the-same-traffic-manager-profile"></a><span data-ttu-id="76a79-340">在同一個「流量管理員」設定檔中，是否可以將其他端點類型與巢狀子設定檔混合使用？</span><span class="sxs-lookup"><span data-stu-id="76a79-340">Can I mix other endpoint types with nested child profiles, in the same Traffic Manager profile?</span></span>

<span data-ttu-id="76a79-341">是。</span><span class="sxs-lookup"><span data-stu-id="76a79-341">Yes.</span></span> <span data-ttu-id="76a79-342">對於在設定檔內如何結合不同類型的端點，並沒有任何限制。</span><span class="sxs-lookup"><span data-stu-id="76a79-342">There are no restrictions on how you combine endpoints of different types within a profile.</span></span>

### <a name="how-does-the-billing-model-apply-for-nested-profiles"></a><span data-ttu-id="76a79-343">巢狀設定檔如何套用計費模型？</span><span class="sxs-lookup"><span data-stu-id="76a79-343">How does the billing model apply for Nested profiles?</span></span>

<span data-ttu-id="76a79-344">使用巢狀設定檔並沒有計價上的負面影響。</span><span class="sxs-lookup"><span data-stu-id="76a79-344">There is no negative pricing impact of using nested profiles.</span></span>

<span data-ttu-id="76a79-345">流量管理員計費有兩個要素︰端點健康狀態檢查和數百萬個 DNS 查詢</span><span class="sxs-lookup"><span data-stu-id="76a79-345">Traffic Manager billing has two components: endpoint health checks and millions of DNS queries</span></span>

* <span data-ttu-id="76a79-346">端點健康情況檢查︰當子設定檔被設定為父設定檔中的端點時，並不會針對該子設定檔收費。</span><span class="sxs-lookup"><span data-stu-id="76a79-346">Endpoint health checks: There is no charge for a child profile when configured as an endpoint in a parent profile.</span></span> <span data-ttu-id="76a79-347">監視子設定檔中的端點將以一般方式計費。</span><span class="sxs-lookup"><span data-stu-id="76a79-347">Monitoring of the endpoints in the child profile is billed in the usual way.</span></span>
* <span data-ttu-id="76a79-348">DNS 查詢：每個查詢只計算一次。</span><span class="sxs-lookup"><span data-stu-id="76a79-348">DNS queries: Each query is only counted once.</span></span> <span data-ttu-id="76a79-349">查詢父設定檔而從子設定檔傳回端點時，只計入父設定檔內。</span><span class="sxs-lookup"><span data-stu-id="76a79-349">A query against a parent profile that returns an endpoint from a child profile is counted against the parent profile only.</span></span>

<span data-ttu-id="76a79-350">如需完整的詳細資料，請參閱[流量管理員定價頁面](https://azure.microsoft.com/pricing/details/traffic-manager/)。</span><span class="sxs-lookup"><span data-stu-id="76a79-350">For full details, see the [Traffic Manager pricing page](https://azure.microsoft.com/pricing/details/traffic-manager/).</span></span>

### <a name="is-there-a-performance-impact-for-nested-profiles"></a><span data-ttu-id="76a79-351">巢狀設定檔是否會對效能造成影響？</span><span class="sxs-lookup"><span data-stu-id="76a79-351">Is there a performance impact for nested profiles?</span></span>

<span data-ttu-id="76a79-352">沒有。</span><span class="sxs-lookup"><span data-stu-id="76a79-352">No.</span></span> <span data-ttu-id="76a79-353">使用巢狀設定檔不會影響效能。</span><span class="sxs-lookup"><span data-stu-id="76a79-353">There is no performance impact incurred when using nested profiles.</span></span>

<span data-ttu-id="76a79-354">在處理每個 DNS 查詢時，流量管理員名稱伺服器會周遊設定檔階層內部。</span><span class="sxs-lookup"><span data-stu-id="76a79-354">The Traffic Manager name servers traverse the profile hierarchy internally when processing each DNS query.</span></span> <span data-ttu-id="76a79-355">父設定檔的 DNS 查詢可能會收到從子設定檔傳回端點的 DNS 回應。</span><span class="sxs-lookup"><span data-stu-id="76a79-355">A DNS query to a parent profile can receive a DNS response with an endpoint from a child profile.</span></span> <span data-ttu-id="76a79-356">不論您使用單一設定檔或巢狀設定檔，都只會使用單一 CNAME 記錄。</span><span class="sxs-lookup"><span data-stu-id="76a79-356">A single CNAME record is used whether you are using a single profile or nested profiles.</span></span> <span data-ttu-id="76a79-357">不需要為階層中的每個設定檔建立 CNAME 記錄。</span><span class="sxs-lookup"><span data-stu-id="76a79-357">There is no need to create a CNAME record for each profile in the hierarchy.</span></span>

### <a name="how-does-traffic-manager-compute-the-health-of-a-nested-endpoint-in-a-parent-profile"></a><span data-ttu-id="76a79-358">流量管理員如何計算父設定檔中的巢狀端點健康狀態？</span><span class="sxs-lookup"><span data-stu-id="76a79-358">How does Traffic Manager compute the health of a nested endpoint in a parent profile?</span></span>

<span data-ttu-id="76a79-359">父設定檔不會直接對子系執行健康狀態檢查，</span><span class="sxs-lookup"><span data-stu-id="76a79-359">The parent profile doesn't perform health checks on the child directly.</span></span> <span data-ttu-id="76a79-360">子設定檔端點的健康狀態會用來計算子設定檔的整體健康狀態。</span><span class="sxs-lookup"><span data-stu-id="76a79-360">Instead, the health of the child profile's endpoints are used to calculate the overall health of the child profile.</span></span> <span data-ttu-id="76a79-361">這項資訊會在巢狀設定檔階層中往上傳播，以判斷巢狀端點的健康狀態。</span><span class="sxs-lookup"><span data-stu-id="76a79-361">This information is propagated up the nested profile hierarchy to determine the health of the nested endpoint.</span></span> <span data-ttu-id="76a79-362">父設定檔會使用此彙總健康狀態，以決定是否可以將流量導向子設定檔。</span><span class="sxs-lookup"><span data-stu-id="76a79-362">The parent profile uses this aggregated health to determine whether the traffic can be directed to the child.</span></span>

<span data-ttu-id="76a79-363">下表描述流量管理員檢查巢狀端點健康狀態時的行為。</span><span class="sxs-lookup"><span data-stu-id="76a79-363">The following table describes the behavior of Traffic Manager health checks for a nested endpoint.</span></span>

| <span data-ttu-id="76a79-364">子設定檔監視狀態</span><span class="sxs-lookup"><span data-stu-id="76a79-364">Child Profile Monitor status</span></span> | <span data-ttu-id="76a79-365">父端點監視狀態</span><span class="sxs-lookup"><span data-stu-id="76a79-365">Parent Endpoint Monitor status</span></span> | <span data-ttu-id="76a79-366">注意事項</span><span class="sxs-lookup"><span data-stu-id="76a79-366">Notes</span></span> |
| --- | --- | --- |
| <span data-ttu-id="76a79-367">已停用。</span><span class="sxs-lookup"><span data-stu-id="76a79-367">Disabled.</span></span> <span data-ttu-id="76a79-368">已停用子設定檔。</span><span class="sxs-lookup"><span data-stu-id="76a79-368">The child profile has been disabled.</span></span> |<span data-ttu-id="76a79-369">已停止</span><span class="sxs-lookup"><span data-stu-id="76a79-369">Stopped</span></span> |<span data-ttu-id="76a79-370">父端點狀態為「已停止」，不是「已停用」。</span><span class="sxs-lookup"><span data-stu-id="76a79-370">The parent endpoint state is Stopped, not Disabled.</span></span> <span data-ttu-id="76a79-371">「已停用」狀態會保留，表示您已停用父設定檔中的端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-371">The Disabled state is reserved for indicating that you have disabled the endpoint in the parent profile.</span></span> |
| <span data-ttu-id="76a79-372">已降級。</span><span class="sxs-lookup"><span data-stu-id="76a79-372">Degraded.</span></span> <span data-ttu-id="76a79-373">至少有一個子設定檔端點的狀態為「已降級」。</span><span class="sxs-lookup"><span data-stu-id="76a79-373">At least one child profile endpoint is in a Degraded state.</span></span> |<span data-ttu-id="76a79-374">線上︰子設定檔中「線上」端點的數目至少等於 MinChildEndpoints 的值。</span><span class="sxs-lookup"><span data-stu-id="76a79-374">Online: the number of Online endpoints in the child profile is at least the value of MinChildEndpoints.</span></span><BR><span data-ttu-id="76a79-375">CheckingEndpoint︰子設定檔中「線上」加 CheckingEndpoint 端點的數目至少等於 MinChildEndpoints 的值。</span><span class="sxs-lookup"><span data-stu-id="76a79-375">CheckingEndpoint: the number of Online plus CheckingEndpoint endpoints in the child profile is at least the value of MinChildEndpoints.</span></span><BR><span data-ttu-id="76a79-376">已降級︰其他情況。</span><span class="sxs-lookup"><span data-stu-id="76a79-376">Degraded: otherwise.</span></span> |<span data-ttu-id="76a79-377">系統會將流量傳遞給狀態為 CheckingEndpoint 的端點。</span><span class="sxs-lookup"><span data-stu-id="76a79-377">Traffic is routed to an endpoint of status CheckingEndpoint.</span></span> <span data-ttu-id="76a79-378">如果 MinChildEndpoints 設定太高，則端點一律會降級。</span><span class="sxs-lookup"><span data-stu-id="76a79-378">If MinChildEndpoints is set too high, the endpoint is always degraded.</span></span> |
| <span data-ttu-id="76a79-379">線上。</span><span class="sxs-lookup"><span data-stu-id="76a79-379">Online.</span></span> <span data-ttu-id="76a79-380">至少有一個子設定檔端點處於「線上」狀態。</span><span class="sxs-lookup"><span data-stu-id="76a79-380">At least one child profile endpoint is an Online state.</span></span> <span data-ttu-id="76a79-381">沒有端點處於「已降級」狀態。</span><span class="sxs-lookup"><span data-stu-id="76a79-381">No endpoint is in the Degraded state.</span></span> |<span data-ttu-id="76a79-382">請參閱上方。</span><span class="sxs-lookup"><span data-stu-id="76a79-382">See above.</span></span> | |
| <span data-ttu-id="76a79-383">CheckingEndpoints。</span><span class="sxs-lookup"><span data-stu-id="76a79-383">CheckingEndpoints.</span></span> <span data-ttu-id="76a79-384">至少有一個子設定檔端點是 'CheckingEndpoint'。</span><span class="sxs-lookup"><span data-stu-id="76a79-384">At least one child profile endpoint is 'CheckingEndpoint'.</span></span> <span data-ttu-id="76a79-385">沒有端點是「線上」或「已降級」。</span><span class="sxs-lookup"><span data-stu-id="76a79-385">No endpoints are 'Online' or 'Degraded'</span></span> |<span data-ttu-id="76a79-386">同上。</span><span class="sxs-lookup"><span data-stu-id="76a79-386">Same as above.</span></span> | |
| <span data-ttu-id="76a79-387">非使用中。</span><span class="sxs-lookup"><span data-stu-id="76a79-387">Inactive.</span></span> <span data-ttu-id="76a79-388">所有子設定檔端點不是「已停用」就是「已停止」，或者此設定檔沒有任何端點</span><span class="sxs-lookup"><span data-stu-id="76a79-388">All child profile endpoints are either Disabled or Stopped, or this profile has no endpoints.</span></span> |<span data-ttu-id="76a79-389">已停止</span><span class="sxs-lookup"><span data-stu-id="76a79-389">Stopped</span></span> | |

## <a name="next-steps"></a><span data-ttu-id="76a79-390">後續步驟：</span><span class="sxs-lookup"><span data-stu-id="76a79-390">Next steps:</span></span>
- <span data-ttu-id="76a79-391">深入了解「流量管理員」的 [端點監視和自動容錯移轉](../traffic-manager/traffic-manager-monitoring.md)。</span><span class="sxs-lookup"><span data-stu-id="76a79-391">Learn more about Traffic Manager [endpoint monitoring and automatic failover](../traffic-manager/traffic-manager-monitoring.md).</span></span>
- <span data-ttu-id="76a79-392">深入了解「流量管理員」的 [流量路由方法](../traffic-manager/traffic-manager-routing-methods.md)。</span><span class="sxs-lookup"><span data-stu-id="76a79-392">Learn more about Traffic Manager [traffic routing methods](../traffic-manager/traffic-manager-routing-methods.md).</span></span>