---
title: "流量管理員-aaaAzure 流量路由方式 |Microsoft 文件"
description: "此文章可協助您了解流量管理員使用 hello 不同的流量路由方法"
services: traffic-manager
documentationcenter: 
author: KumudD
manager: timlt
editor: 
ms.assetid: db1efbf6-6762-4c7a-ac99-675d4eeb54d0
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/13/2017
ms.author: kumud
ms.openlocfilehash: b3eeca63ab5f2b9cd4a3a6b6a8fd3e40059e32b5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="traffic-manager-routing-methods"></a><span data-ttu-id="66d91-103">流量管理員路由方法</span><span class="sxs-lookup"><span data-stu-id="66d91-103">Traffic Manager routing methods</span></span>

<span data-ttu-id="66d91-104">Azure Traffic Manager 支援四個流量路由方法 toodetermine 如何 tooroute 的網路流量 toohello 各種服務端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-104">Azure Traffic Manager supports four traffic-routing methods toodetermine how tooroute network traffic toohello various service endpoints.</span></span> <span data-ttu-id="66d91-105">Traffic Manager hello 流量路由方法 tooeach DNS 查詢套用它所接收。</span><span class="sxs-lookup"><span data-stu-id="66d91-105">Traffic Manager applies hello traffic-routing method tooeach DNS query it receives.</span></span> <span data-ttu-id="66d91-106">hello 流量路由方法會判斷哪一個端點傳回 hello DNS 回應中。</span><span class="sxs-lookup"><span data-stu-id="66d91-106">hello traffic-routing method determines which endpoint returned in hello DNS response.</span></span>

<span data-ttu-id="66d91-107">流量管理員中提供四種流量路由方法：</span><span class="sxs-lookup"><span data-stu-id="66d91-107">There are four traffic routing methods available in Traffic Manager:</span></span>

* <span data-ttu-id="66d91-108">**[優先順序](#priority):**選取**優先順序**當您想讓所有流量，toouse 主要服務端點，並提供備份以防主要 hello 備份端點都無法使用。</span><span class="sxs-lookup"><span data-stu-id="66d91-108">**[Priority](#priority):** Select **Priority** when you want toouse a primary service endpoint for all traffic, and provide backups in case hello primary or hello backup endpoints are unavailable.</span></span>
* <span data-ttu-id="66d91-109">**[加權](#weighted):**選取**加權**當您想 toodistribute 流量分配一組的端點，可能是平均或相應 tooweights，您所定義。</span><span class="sxs-lookup"><span data-stu-id="66d91-109">**[Weighted](#weighted):** Select **Weighted** when you want toodistribute traffic across a set of endpoints, either evenly or according tooweights, which you define.</span></span>
* <span data-ttu-id="66d91-110">**[效能](#performance):**選取**效能**當您在不同地理位置擁有端點，且您想要依據 hello 最低的網路延遲的終端使用者 toouse hello 「 最靠近 」 端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-110">**[Performance](#performance):** Select **Performance** when you have endpoints in different geographic locations and you want end users toouse hello "closest" endpoint in terms of hello lowest network latency.</span></span>
* <span data-ttu-id="66d91-111">**[地理](#geographic):**選取**地理**其 DNS 查詢，讓使用者導向的 toospecific 端點 （Azure、 外部、 或巢狀） 的地理位置為基礎所發出。</span><span class="sxs-lookup"><span data-stu-id="66d91-111">**[Geographic](#geographic):** Select **Geographic** so that users are directed toospecific endpoints (Azure, External, or Nested) based on which geographic location their DNS query originates from.</span></span> <span data-ttu-id="66d91-112">這讓 Traffic Manager 的客戶 tooenable 的情況下知道使用者的地理區域，和路由，根據重要。</span><span class="sxs-lookup"><span data-stu-id="66d91-112">This empowers Traffic Manager customers tooenable scenarios where knowing a user’s geographic region and routing them based on that is important.</span></span> <span data-ttu-id="66d91-113">例如，遵守資料主權規定、內容和使用者經驗的當地語系化，以及測量來自不同區域的流量。</span><span class="sxs-lookup"><span data-stu-id="66d91-113">Examples include complying with data sovereignty mandates, localization of content & user experience and measuring traffic from different regions.</span></span>

<span data-ttu-id="66d91-114">所有流量管理員設定檔都支援監視端點健康狀態和自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="66d91-114">All Traffic Manager profiles include monitoring of endpoint health and automatic endpoint failover.</span></span> <span data-ttu-id="66d91-115">如需詳細資訊，請參閱 [流量管理員端點監視](traffic-manager-monitoring.md)。</span><span class="sxs-lookup"><span data-stu-id="66d91-115">For more information, see [Traffic Manager Endpoint Monitoring](traffic-manager-monitoring.md).</span></span> <span data-ttu-id="66d91-116">單一「流量管理員」設定檔只能使用一個流量路由方法。</span><span class="sxs-lookup"><span data-stu-id="66d91-116">A single Traffic Manager profile can use only one traffic routing method.</span></span> <span data-ttu-id="66d91-117">您可以隨時為您的設定檔選取不同的流量路由方法。</span><span class="sxs-lookup"><span data-stu-id="66d91-117">You can select a different traffic routing method for your profile at any time.</span></span> <span data-ttu-id="66d91-118">變更會在 1 分鐘內套用，不會造成任何停機時間。</span><span class="sxs-lookup"><span data-stu-id="66d91-118">Changes are applied within one minute, and no downtime is incurred.</span></span> <span data-ttu-id="66d91-119">透過使用巢狀「流量管理員」設定檔可以將流量路由方法加以結合。</span><span class="sxs-lookup"><span data-stu-id="66d91-119">Traffic-routing methods can be combined by using nested Traffic Manager profiles.</span></span> <span data-ttu-id="66d91-120">巢狀結構啟用精密且更有彈性流量路由設定符合 hello 較大且複雜的應用程式的需求。</span><span class="sxs-lookup"><span data-stu-id="66d91-120">Nesting enables sophisticated and flexible traffic-routing configurations that meet hello needs of larger, complex applications.</span></span> <span data-ttu-id="66d91-121">如需詳細資訊，請參閱 [巢狀流量管理員設定檔](traffic-manager-nested-profiles.md)。</span><span class="sxs-lookup"><span data-stu-id="66d91-121">For more information, see [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>

## <span data-ttu-id="66d91-122"><a name = "priority"></a>優先順序流量路由方法</span><span class="sxs-lookup"><span data-stu-id="66d91-122"><a name = "priority"></a>Priority traffic-routing method</span></span>

<span data-ttu-id="66d91-123">組織經常希望 tooprovide 可靠性的服務部署一或多個備份的服務，萬一主要服務效能降低。</span><span class="sxs-lookup"><span data-stu-id="66d91-123">Often an organization wants tooprovide reliability for its services by deploying one or more backup services in case their primary service goes down.</span></span> <span data-ttu-id="66d91-124">hello 'Priority' 流量路由方法，可讓 Azure 客戶 tooeasily 實作此容錯移轉模式。</span><span class="sxs-lookup"><span data-stu-id="66d91-124">hello 'Priority' traffic-routing method allows Azure customers tooeasily implement this failover pattern.</span></span>

![Azure 流量管理員「優先順序」流量路由方法][1]

<span data-ttu-id="66d91-126">hello Traffic Manager 設定檔包含服務端點的優先順序的清單。</span><span class="sxs-lookup"><span data-stu-id="66d91-126">hello Traffic Manager profile contains a prioritized list of service endpoints.</span></span> <span data-ttu-id="66d91-127">根據預設，Traffic Manager 會傳送所有流量 toohello 主要 （最高優先權） 端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-127">By default, Traffic Manager sends all traffic toohello primary (highest-priority) endpoint.</span></span> <span data-ttu-id="66d91-128">如果 hello 主要端點無法使用，Traffic Manager 路由 hello 流量 toohello 第二個端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-128">If hello primary endpoint is not available, Traffic Manager routes hello traffic toohello second endpoint.</span></span> <span data-ttu-id="66d91-129">如果無法使用這兩個 hello 主要和次要端點，則 hello 流量會傳送 toohello，第三個，依此類推。</span><span class="sxs-lookup"><span data-stu-id="66d91-129">If both hello primary and secondary endpoints are not available, hello traffic goes toohello third, and so on.</span></span> <span data-ttu-id="66d91-130">Hello 端點的可用性會根據設定 hello 狀態 （啟用或停用） 和 hello 持續的端點監視。</span><span class="sxs-lookup"><span data-stu-id="66d91-130">Availability of hello endpoint is based on hello configured status (enabled or disabled) and hello ongoing endpoint monitoring.</span></span>

### <a name="configuring-endpoints"></a><span data-ttu-id="66d91-131">設定端點</span><span class="sxs-lookup"><span data-stu-id="66d91-131">Configuring endpoints</span></span>

<span data-ttu-id="66d91-132">使用 Azure 資源管理員中，您可以設定每個端點使用 hello 'priority' 屬性的 hello 端點優先順序。</span><span class="sxs-lookup"><span data-stu-id="66d91-132">With Azure Resource Manager, you configure hello endpoint priority explicitly using hello 'priority' property for each endpoint.</span></span> <span data-ttu-id="66d91-133">這個屬性的值介於 1 到 1000 之間。</span><span class="sxs-lookup"><span data-stu-id="66d91-133">This property is a value between 1 and 1000.</span></span> <span data-ttu-id="66d91-134">值越低代表優先順序越高。</span><span class="sxs-lookup"><span data-stu-id="66d91-134">Lower values represent a higher priority.</span></span> <span data-ttu-id="66d91-135">端點無法共用優先順序值。</span><span class="sxs-lookup"><span data-stu-id="66d91-135">Endpoints cannot share priority values.</span></span> <span data-ttu-id="66d91-136">設定 hello 屬性是選擇性的。</span><span class="sxs-lookup"><span data-stu-id="66d91-136">Setting hello property is optional.</span></span> <span data-ttu-id="66d91-137">當省略，則會使用 hello 端點順序為基礎的預設優先權。</span><span class="sxs-lookup"><span data-stu-id="66d91-137">When omitted, a default priority based on hello endpoint order is used.</span></span>

##<span data-ttu-id="66d91-138"><a name = "weighted"></a>加權流量路由方法</span><span class="sxs-lookup"><span data-stu-id="66d91-138"><a name = "weighted"></a>Weighted traffic-routing method</span></span>
<span data-ttu-id="66d91-139">hello '加權' 流量路由方法可讓您 toodistribute 流量平均或 toouse 預先定義的加權。</span><span class="sxs-lookup"><span data-stu-id="66d91-139">hello 'Weighted' traffic-routing method allows you toodistribute traffic evenly or toouse a pre-defined weighting.</span></span>

![Azure 流量管理員「加權」流量路由方法][2]

<span data-ttu-id="66d91-141">在 hello 加權流量路由方法中，您可以指派 hello Traffic Manager 設定檔設定中的加權 tooeach 端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-141">In hello Weighted traffic-routing method, you assign a weight tooeach endpoint in hello Traffic Manager profile configuration.</span></span> <span data-ttu-id="66d91-142">hello 加權值是從 1 too1000 的整數。</span><span class="sxs-lookup"><span data-stu-id="66d91-142">hello weight is an integer from 1 too1000.</span></span> <span data-ttu-id="66d91-143">這是選擇性參數。</span><span class="sxs-lookup"><span data-stu-id="66d91-143">This parameter is optional.</span></span> <span data-ttu-id="66d91-144">如果省略，流量管理員會使用預設權數 '1'。</span><span class="sxs-lookup"><span data-stu-id="66d91-144">If omitted, Traffic Managers uses a default weight of '1'.</span></span>

<span data-ttu-id="66d91-145">針對每個收到的 DNS 查詢，流量管理員會隨機選擇可用的端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-145">For each DNS query received, Traffic Manager randomly chooses an available endpoint.</span></span> <span data-ttu-id="66d91-146">選擇端點的 hello 機率根據 hello 權重 tooall 可用的端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-146">hello probability of choosing an endpoint is based on hello weights assigned tooall available endpoints.</span></span> <span data-ttu-id="66d91-147">相同加權跨甚至流量發佈中的所有端點結果使用 hello。</span><span class="sxs-lookup"><span data-stu-id="66d91-147">Using hello same weight across all endpoints results in an even traffic distribution.</span></span> <span data-ttu-id="66d91-148">在特定端點上使用高或較低的加權值會導致傳回頻率 hello DNS 回應中的這些端點 toobe。</span><span class="sxs-lookup"><span data-stu-id="66d91-148">Using higher or lower weights on specific endpoints causes those endpoints toobe returned more or less frequently in hello DNS responses.</span></span>

<span data-ttu-id="66d91-149">加權的 hello 方法可讓某些案例中很有用：</span><span class="sxs-lookup"><span data-stu-id="66d91-149">hello weighted method enables some useful scenarios:</span></span>

* <span data-ttu-id="66d91-150">漸進應用程式升級： 配置某百分比的流量 tooroute tooa 新端點，並逐漸增加時間 too100%中的 hello 流量。</span><span class="sxs-lookup"><span data-stu-id="66d91-150">Gradual application upgrade: Allocate a percentage of traffic tooroute tooa new endpoint, and gradually increase hello traffic over time too100%.</span></span>
* <span data-ttu-id="66d91-151">應用程式移轉 tooAzure： 建立 Azure 和外部端點的設定檔。</span><span class="sxs-lookup"><span data-stu-id="66d91-151">Application migration tooAzure: Create a profile with both Azure and external endpoints.</span></span> <span data-ttu-id="66d91-152">調整 hello 端點 tooprefer hello 新端點的 hello 的權數。</span><span class="sxs-lookup"><span data-stu-id="66d91-152">Adjust hello weight of hello endpoints tooprefer hello new endpoints.</span></span>
* <span data-ttu-id="66d91-153">雲端高載以取得額外的容量： 快速展開 hello 雲端至內部部署，將它放入 Traffic Manager 設定檔的後面。</span><span class="sxs-lookup"><span data-stu-id="66d91-153">Cloud-bursting for additional capacity: Quickly expand an on-premises deployment into hello cloud by putting it behind a Traffic Manager profile.</span></span> <span data-ttu-id="66d91-154">當您需要額外容量 hello 雲端中的時，您可以加入或啟用更多端點並指定哪個流量部分會 tooeach 端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-154">When you need extra capacity in hello cloud, you can add or enable more endpoints and specify what portion of traffic goes tooeach endpoint.</span></span>

<span data-ttu-id="66d91-155">hello 資源管理員的 Azure 入口網站支援 hello 設定加權的流量路由。</span><span class="sxs-lookup"><span data-stu-id="66d91-155">hello Resource Manager Azure portal supports hello configuration of weighted traffic routing.</span></span>  <span data-ttu-id="66d91-156">您可以設定使用 hello 資源管理員版本的 Azure PowerShell、 CLI，然而 hello REST Api 的加權。</span><span class="sxs-lookup"><span data-stu-id="66d91-156">You can configure weights using hello Resource Manager versions of Azure PowerShell, CLI, and hello REST APIs.</span></span>

<span data-ttu-id="66d91-157">它是重要 toounderstand DNS 回應所快取的用戶端，並根據 hello 用戶端 hello 遞迴 DNS 伺服器會使用 tooresolve DNS 名稱。</span><span class="sxs-lookup"><span data-stu-id="66d91-157">It is important toounderstand that DNS responses are cached by clients and by hello recursive DNS servers that hello clients use tooresolve DNS names.</span></span> <span data-ttu-id="66d91-158">此快取可能會影響加權的流量分配。</span><span class="sxs-lookup"><span data-stu-id="66d91-158">This caching can have an impact on weighted traffic distributions.</span></span> <span data-ttu-id="66d91-159">用戶端與遞迴 DNS 伺服器的 hello 數目較為大量時，流量發佈如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="66d91-159">When hello number of clients and recursive DNS servers is large, traffic distribution works as expected.</span></span> <span data-ttu-id="66d91-160">不過，當用戶端或遞迴 DNS 伺服器的 hello 數目很小，快取可能會大幅扭曲 hello 流量分配。</span><span class="sxs-lookup"><span data-stu-id="66d91-160">However, when hello number of clients or recursive DNS servers is small, caching can significantly skew hello traffic distribution.</span></span>

<span data-ttu-id="66d91-161">常見使用案例包括：</span><span class="sxs-lookup"><span data-stu-id="66d91-161">Common use cases include:</span></span>

* <span data-ttu-id="66d91-162">開發與測試環境</span><span class="sxs-lookup"><span data-stu-id="66d91-162">Development and testing environments</span></span>
* <span data-ttu-id="66d91-163">應用程式間通訊</span><span class="sxs-lookup"><span data-stu-id="66d91-163">Application-to-application communications</span></span>
* <span data-ttu-id="66d91-164">以較小的使用者群為對象的應用程式，有共同的遞迴 DNS 基礎結構 (例如，透過 Proxy 連接的公司員工)</span><span class="sxs-lookup"><span data-stu-id="66d91-164">Applications aimed at a narrow user-base that share a common recursive DNS infrastructure (for example, employees of company connecting through a proxy)</span></span>

<span data-ttu-id="66d91-165">這些 DNS 快取效果是常見 tooall DNS 為基礎的流量路由系統，不只是 Azure Traffic Manager。</span><span class="sxs-lookup"><span data-stu-id="66d91-165">These DNS caching effects are common tooall DNS-based traffic routing systems, not just Azure Traffic Manager.</span></span> <span data-ttu-id="66d91-166">在某些情況下，明確地清除 hello DNS 快取可能會提供因應措施。</span><span class="sxs-lookup"><span data-stu-id="66d91-166">In some cases, explicitly clearing hello DNS cache may provide a workaround.</span></span> <span data-ttu-id="66d91-167">在其他情況下，使用替代的流量路由方法可能更為合適。</span><span class="sxs-lookup"><span data-stu-id="66d91-167">In other cases, an alternative traffic-routing method may be more appropriate.</span></span>

## <span data-ttu-id="66d91-168"><a name = "performance"></a>效能流量路由方法</span><span class="sxs-lookup"><span data-stu-id="66d91-168"><a name = "performance"></a>Performance traffic-routing method</span></span>

<span data-ttu-id="66d91-169">Hello 地球跨部署在兩個或多個位置的端點，可以增進 hello 路由流量 toohello 位置 '最接近' tooyou 許多應用程式回應能力。</span><span class="sxs-lookup"><span data-stu-id="66d91-169">Deploying endpoints in two or more locations across hello globe can improve hello responsiveness of many applications by routing traffic toohello location that is 'closest' tooyou.</span></span> <span data-ttu-id="66d91-170">hello 「 效能 」 流量路由方法提供這項功能。</span><span class="sxs-lookup"><span data-stu-id="66d91-170">hello 'Performance' traffic-routing method provides this capability.</span></span>

![Azure 流量管理員「效能」流量路由方法][3]

<span data-ttu-id="66d91-172">hello '靠近' 的端點不一定是最接近地理距離的測量。</span><span class="sxs-lookup"><span data-stu-id="66d91-172">hello 'closest' endpoint is not necessarily closest as measured by geographic distance.</span></span> <span data-ttu-id="66d91-173">相反地，hello 「 效能 」 流量路由方法會判斷 hello 最靠近的端點，藉由測量網路延遲。</span><span class="sxs-lookup"><span data-stu-id="66d91-173">Instead, hello 'Performance' traffic-routing method determines hello closest endpoint by measuring network latency.</span></span> <span data-ttu-id="66d91-174">Traffic Manager 會維護網際網路延遲表格 tootrack hello 來回時間 IP 位址範圍與每個 Azure 資料中心之間。</span><span class="sxs-lookup"><span data-stu-id="66d91-174">Traffic Manager maintains an Internet Latency Table tootrack hello round-trip time between IP address ranges and each Azure datacenter.</span></span>

<span data-ttu-id="66d91-175">Traffic Manager 會查閱 hello 連入 DNS 要求 hello 網際網路延遲表格中的 hello 來源 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="66d91-175">Traffic Manager looks up hello source IP address of hello incoming DNS request in hello Internet Latency Table.</span></span> <span data-ttu-id="66d91-176">Traffic Manager 會在 hello hello 延遲最低的 IP 位址範圍，則在 hello DNS 回應中傳回該端點的 Azure 資料中心中選擇的可用端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-176">Traffic Manager chooses an available endpoint in hello Azure datacenter that has hello lowest latency for that IP address range, then returns that endpoint in hello DNS response.</span></span>

<span data-ttu-id="66d91-177">如[流量管理員的運作方式](traffic-manager-overview.md#how-traffic-manager-works)中所述，流量管理員不會直接從用戶端接收 DNS 查詢。</span><span class="sxs-lookup"><span data-stu-id="66d91-177">As explained in [How Traffic Manager Works](traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager does not receive DNS queries directly from clients.</span></span> <span data-ttu-id="66d91-178">相反地，DNS 查詢來自 hello 用戶端會設定的 toouse hello 遞迴 DNS 服務。</span><span class="sxs-lookup"><span data-stu-id="66d91-178">Rather, DNS queries come from hello recursive DNS service that hello clients are configured toouse.</span></span> <span data-ttu-id="66d91-179">因此，hello IP 位址使用 toodetermine hello '最接近' 端點不是 hello 用戶端的 IP 位址，但它是 hello hello 遞迴 DNS 服務 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="66d91-179">Therefore, hello IP address used toodetermine hello 'closest' endpoint is not hello client's IP address, but it is hello IP address of hello recursive DNS service.</span></span> <span data-ttu-id="66d91-180">在實務上，此 IP 位址是好 hello 用戶端 proxy。</span><span class="sxs-lookup"><span data-stu-id="66d91-180">In practice, this IP address is a good proxy for hello client.</span></span>


<span data-ttu-id="66d91-181">Traffic Manager 定期更新 hello 中變更的網際網路延遲表格 tooaccount hello 全域網際網路和新的 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="66d91-181">Traffic Manager regularly updates hello Internet Latency Table tooaccount for changes in hello global Internet and new Azure regions.</span></span> <span data-ttu-id="66d91-182">不過，應用程式的效能而異根據負載的即時變化 hello 網際網路。</span><span class="sxs-lookup"><span data-stu-id="66d91-182">However, application performance varies based on real-time variations in load across hello Internet.</span></span> <span data-ttu-id="66d91-183">效能流量路由不會監視特定服務端點上的負載。</span><span class="sxs-lookup"><span data-stu-id="66d91-183">Performance traffic-routing does not monitor load on a given service endpoint.</span></span> <span data-ttu-id="66d91-184">不過，如果端點變得無法使用，流量管理員就不會將它加入 DNS 查詢回應中。</span><span class="sxs-lookup"><span data-stu-id="66d91-184">However, if an endpoint becomes unavailable, Traffic Manager does not include it in DNS query responses.</span></span>


<span data-ttu-id="66d91-185">點 toonote:</span><span class="sxs-lookup"><span data-stu-id="66d91-185">Points toonote:</span></span>

* <span data-ttu-id="66d91-186">如果您的設定檔包含多個端點 hello 相同的 Azure 區域，然後 Traffic Manager 分散流量平均分散在該區域中的 hello 可用端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-186">If your profile contains multiple endpoints in hello same Azure region, then Traffic Manager distributes traffic evenly across hello available endpoints in that region.</span></span> <span data-ttu-id="66d91-187">如果您在某個區域內偏好採用不同的流量分配，您可以使用[巢狀流量管理員設定檔](traffic-manager-nested-profiles.md)。</span><span class="sxs-lookup"><span data-stu-id="66d91-187">If you prefer a different traffic distribution within a region, you can use [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>
* <span data-ttu-id="66d91-188">如果啟用中最接近的 hello 端點的所有 Azure 地區降級，Traffic Manager 會將流量 toohello 端點移 hello 下一個最接近 Azure 區域中。</span><span class="sxs-lookup"><span data-stu-id="66d91-188">If all enabled endpoints in hello closest Azure region are degraded, Traffic Manager moves traffic toohello endpoints in hello next closest Azure region.</span></span> <span data-ttu-id="66d91-189">如果您想 toodefine 慣用的容錯移轉順序，請使用[巢狀 流量管理員設定檔](traffic-manager-nested-profiles.md)。</span><span class="sxs-lookup"><span data-stu-id="66d91-189">If you want toodefine a preferred failover sequence, use [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>
* <span data-ttu-id="66d91-190">當使用外部端點或巢狀的端點 hello 效能流量路由方式，您會需要 toospecify hello 位置，這些端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-190">When using hello Performance traffic routing method with external endpoints or nested endpoints, you need toospecify hello location of those endpoints.</span></span> <span data-ttu-id="66d91-191">選擇 hello Azure 地區最接近 tooyour 部署。</span><span class="sxs-lookup"><span data-stu-id="66d91-191">Choose hello Azure region closest tooyour deployment.</span></span> <span data-ttu-id="66d91-192">這些位置是 hello hello 網際網路延遲表格所支援的值。</span><span class="sxs-lookup"><span data-stu-id="66d91-192">Those locations are hello values supported by hello Internet Latency Table.</span></span>
* <span data-ttu-id="66d91-193">選擇 hello 端點的 hello 演算法是具決定性的。</span><span class="sxs-lookup"><span data-stu-id="66d91-193">hello algorithm that chooses hello endpoint is deterministic.</span></span> <span data-ttu-id="66d91-194">重複相同的用戶端會從 hello 的 DNS 查詢導向 toohello 相同的端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-194">Repeated DNS queries from hello same client are directed toohello same endpoint.</span></span> <span data-ttu-id="66d91-195">一般而言，用戶端在漫遊時會使用不同的遞迴 DNS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="66d91-195">Typically, clients use different recursive DNS servers when traveling.</span></span> <span data-ttu-id="66d91-196">hello 用戶端可能是路由的 tooa 不同端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-196">hello client may be routed tooa different endpoint.</span></span> <span data-ttu-id="66d91-197">路由可能也會受到更新 toohello 網際網路延遲表格。</span><span class="sxs-lookup"><span data-stu-id="66d91-197">Routing can also be affected by updates toohello Internet Latency Table.</span></span> <span data-ttu-id="66d91-198">因此，hello 效能流量路由方法不保證會在用戶端一律會路由傳送 toohello 相同的端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-198">Therefore, hello Performance traffic-routing method does not guarantee that a client is always routed toohello same endpoint.</span></span>
* <span data-ttu-id="66d91-199">當 hello 網際網路延遲表格變更時，您可能會注意到某些用戶端會導向的 tooa 不同端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-199">When hello Internet Latency Table changes, you may notice that some clients are directed tooa different endpoint.</span></span> <span data-ttu-id="66d91-200">只要取得最新的延遲資料，此路由變更會更精確。</span><span class="sxs-lookup"><span data-stu-id="66d91-200">This routing change is more accurate based on current latency data.</span></span> <span data-ttu-id="66d91-201">這些更新是不可或缺的 toomaintain hello 精確度效能流量路由為 hello 持續發展，網際網路。</span><span class="sxs-lookup"><span data-stu-id="66d91-201">These updates are essential toomaintain hello accuracy of Performance traffic-routing as hello Internet continually evolves.</span></span>

## <span data-ttu-id="66d91-202"><a name = "geographic"></a>地理流量路由方法</span><span class="sxs-lookup"><span data-stu-id="66d91-202"><a name = "geographic"></a>Geographic traffic-routing method</span></span>

<span data-ttu-id="66d91-203">Traffic Manager 設定檔可以是地理路由方法，因此使用者會被導向 toospecific 端點 （Azure、 外部或巢狀） 為基礎的地理位置的 DNS 查詢來自設定的 toouse hello。</span><span class="sxs-lookup"><span data-stu-id="66d91-203">Traffic Manager profiles can be configured toouse hello Geographic routing method so that users are directed toospecific endpoints (Azure, External or Nested) based on which geographic location their DNS query originates from.</span></span> <span data-ttu-id="66d91-204">這讓 Traffic Manager 的客戶 tooenable 的情況下知道使用者的地理區域，和路由，根據重要。</span><span class="sxs-lookup"><span data-stu-id="66d91-204">This empowers Traffic Manager customers tooenable scenarios where knowing a user’s geographic region and routing them based on that is important.</span></span> <span data-ttu-id="66d91-205">例如，遵守資料主權規定、內容和使用者經驗的當地語系化，以及測量來自不同區域的流量。</span><span class="sxs-lookup"><span data-stu-id="66d91-205">Examples include complying with data sovereignty mandates, localization of content & user experience and measuring traffic from different regions.</span></span>
<span data-ttu-id="66d91-206">地理路由設定檔時，每個端點相關聯的設定檔需要 toohave 指派的地理區域 tooit 一組。</span><span class="sxs-lookup"><span data-stu-id="66d91-206">When a profile is configured for geographic routing, each endpoint associated with that profile needs toohave a set of geographic regions assigned tooit.</span></span> <span data-ttu-id="66d91-207">地理區域可以達到下列細微層級</span><span class="sxs-lookup"><span data-stu-id="66d91-207">A geographic region can be at following levels of granularity</span></span> 
- <span data-ttu-id="66d91-208">世界 – 任何區域</span><span class="sxs-lookup"><span data-stu-id="66d91-208">World– any region</span></span>
- <span data-ttu-id="66d91-209">地區分組 – 例如非洲、中東、澳大利亞/太平洋等</span><span class="sxs-lookup"><span data-stu-id="66d91-209">Regional Grouping – for example, Africa, Middle East, Australia/Pacific etc.</span></span> 
- <span data-ttu-id="66d91-210">國家/地區 – 例如愛爾蘭、秘魯、香港特別行政區等</span><span class="sxs-lookup"><span data-stu-id="66d91-210">Country/Region – for example, Ireland, Peru, Hong Kong SAR etc.</span></span> 
- <span data-ttu-id="66d91-211">州/省 – 例如美國加州、澳大利亞昆士蘭、加拿大亞伯達省等 (請注意︰僅澳大利亞、加拿大、英國和美國的州/省才支援此細微層級)。</span><span class="sxs-lookup"><span data-stu-id="66d91-211">State/Province – for example, USA-California, Australia-Queensland, Canada-Alberta etc. (note: this granularity level is supported only for states / provinces in Australia, Canada, UK, and USA).</span></span>

<span data-ttu-id="66d91-212">當區域的一組指派 tooan 端點時，從這些區域的任何要求會取得路由唯一 toothat 端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-212">When a region or a set of regions is assigned tooan endpoint, any requests from those regions gets routed only toothat endpoint.</span></span> <span data-ttu-id="66d91-213">Traffic Manager 會使用 hello DNS 查詢 toodetermine hello 區域的使用者從查詢 – 這通常是 hello IP 位址進行 hello 查詢代表 hello 使用者 hello 本機 DNS 解析程式的 hello 來源 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="66d91-213">Traffic Manager uses hello source IP address of hello DNS query toodetermine hello region from which a user is querying from – usually this is hello IP address of hello local DNS resolver doing hello query on behalf of hello user.</span></span>  

![Azure 流量管理員「地理」流量路由方法](./media/traffic-manager-routing-methods/geographic.png)

<span data-ttu-id="66d91-215">Traffic Manager 會讀取 hello DNS 查詢 hello 來源 IP 位址，並決定來自哪一個地理區域。</span><span class="sxs-lookup"><span data-stu-id="66d91-215">Traffic Manager reads hello source IP address of hello DNS query and decides which geographic region it is originating from.</span></span> <span data-ttu-id="66d91-216">如果沒有這個對應的地理區域 tooit 的端點，它接著會尋找 toosee。</span><span class="sxs-lookup"><span data-stu-id="66d91-216">It then looks toosee if there is an endpoint that has this geographic region mapped tooit.</span></span> <span data-ttu-id="66d91-217">執行此查詢會從最低資料粒度層級 hello （縣/市有支援，否則在 hello 國家 （地區） 層級），並且停止 toohello 最高層級，也就是所有 hello 向上**世界**。</span><span class="sxs-lookup"><span data-stu-id="66d91-217">This lookup starts at hello lowest granularity level (State/Province where it is supported, else at hello Country/Region level) and goes all hello way up toohello highest level, which is **World**.</span></span> <span data-ttu-id="66d91-218">hello 第一個相符項目找到使用這個周遊被指定為 hello 端點 tooreturn hello 查詢回應中。</span><span class="sxs-lookup"><span data-stu-id="66d91-218">hello first match found using this traversal is designated as hello endpoint tooreturn in hello query response.</span></span> <span data-ttu-id="66d91-219">符合「巢狀」類型端點時，則會根據路由方法，傳回該子設定檔中的端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-219">When matching with a Nested type endpoint, an endpoint within that child profile is returned, based on its routing method.</span></span> <span data-ttu-id="66d91-220">下列點 hello 是適用的 toothis 行為：</span><span class="sxs-lookup"><span data-stu-id="66d91-220">hello following points are applicable toothis behavior:</span></span>

- <span data-ttu-id="66d91-221">地理區域地理路由 hello 路由類型時，可以是對應的 Traffic Manager 設定檔中的唯一 tooone 端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-221">A geographic region can be mapped only tooone endpoint in a Traffic Manager profile when hello routing type is Geographic Routing.</span></span> <span data-ttu-id="66d91-222">這可確保使用者路由是具決定性，讓客戶在地理界限必須明確的情況下應付自如。</span><span class="sxs-lookup"><span data-stu-id="66d91-222">This ensures that routing of users is deterministic, and customers can enable scenarios that require unambiguous geographic boundaries.</span></span>
- <span data-ttu-id="66d91-223">如果在兩個不同的端點的地理對應使用者的地區，Traffic Manager hello 最低的資料粒度選取 hello 端點，並不會考慮從該區域 toohello 要求路由傳送另一個端點。</span><span class="sxs-lookup"><span data-stu-id="66d91-223">If a user’s region comes under two different endpoints’ geographic mapping, Traffic Manager selects hello endpoint with hello lowest granularity and does not consider routing requests from that region toohello other endpoint.</span></span> <span data-ttu-id="66d91-224">例如，假設「地理路由」類型設定檔有兩個端點 - 端點 1 和端點 2。</span><span class="sxs-lookup"><span data-stu-id="66d91-224">For example, consider a Geographic Routing type profile with two endpoints - Endpoint1 and Endpoint2.</span></span> <span data-ttu-id="66d91-225">Endpoint1 設定已從愛爾蘭和 Endpoint2 tooreceive 流量從歐洲 tooreceive 流量。</span><span class="sxs-lookup"><span data-stu-id="66d91-225">Endpoint1 is configured tooreceive traffic from Ireland and Endpoint2 is configured tooreceive traffic from Europe.</span></span> <span data-ttu-id="66d91-226">如果要求來自愛爾蘭，永遠是路由的 tooEndpoint1。</span><span class="sxs-lookup"><span data-stu-id="66d91-226">If a request originates from Ireland, it is always routed tooEndpoint1.</span></span>
- <span data-ttu-id="66d91-227">由於區可以是對應的唯一 tooone 端點，Traffic Manager 會傳回它不論 hello 端點是否為狀況良好。</span><span class="sxs-lookup"><span data-stu-id="66d91-227">Since a region can be mapped only tooone endpoint, Traffic Manager returns it regardless of whether hello endpoint is healthy or not.</span></span>

    >[!IMPORTANT]
    ><span data-ttu-id="66d91-228">強烈建議，客戶使用 hello 地理路由方法就會將它將已包含至少兩個在每個端點的子項設定檔的 hello 巢狀型別端點關聯。</span><span class="sxs-lookup"><span data-stu-id="66d91-228">It is strongly recommended that customers using hello geographic routing method associate it with hello Nested type endpoints that has child profiles containing at least two endpoints within each.</span></span>
- <span data-ttu-id="66d91-229">如果找到端點相符，且該端點處於 hello**已停止**狀態時，Traffic Manager 會傳回為 NODATA 回應。</span><span class="sxs-lookup"><span data-stu-id="66d91-229">If an endpoint match is found and that endpoint is in hello **Stopped** state, Traffic Manager returns a NODATA response.</span></span> <span data-ttu-id="66d91-230">在此情況下，沒有進一步的查閱高的層級中建立 hello 地理區域的階層。</span><span class="sxs-lookup"><span data-stu-id="66d91-230">In this case, no further lookups is made higher up in hello geographic region hierarchy.</span></span> <span data-ttu-id="66d91-231">這個行為也會適用於巢狀的端點類型 hello hello 子系的設定檔時**已停止**或**已停用**狀態。</span><span class="sxs-lookup"><span data-stu-id="66d91-231">This behavior is also applicable for nested endpoint types when hello child profile is in hello **Stopped** or **Disabled** state.</span></span>
- <span data-ttu-id="66d91-232">如果端點顯示**已停用**狀態，將不會包含在比對程序的 hello 區域中。</span><span class="sxs-lookup"><span data-stu-id="66d91-232">If an endpoint displays a **Disabled** status, it won’t be included in hello region matching process.</span></span> <span data-ttu-id="66d91-233">這種行為時，也適用於巢狀的端點類型 hello 端點處於 hello**已停用**狀態。</span><span class="sxs-lookup"><span data-stu-id="66d91-233">This behavior is also applicable for nested endpoint types when hello endpoint is in hello **Disabled** state.</span></span>
- <span data-ttu-id="66d91-234">如果查詢的來源地理區域在該設定檔中沒有對應，流量管理員會傳回 NODATA 回應。</span><span class="sxs-lookup"><span data-stu-id="66d91-234">If a query is coming from a geographic region that has no mapping in that profile, Traffic Manager returns a NODATA response.</span></span> <span data-ttu-id="66d91-235">因此，強烈建議客戶使用地理路由與一個端點，在理想情況下型別中的巢狀 hello 子項設定檔，與 hello 區域中的至少兩個端點**世界**指派 tooit。</span><span class="sxs-lookup"><span data-stu-id="66d91-235">Therefore, it is strongly recommended that customers use geographic routing with one endpoint, ideally of type Nested with at least two endpoints within hello child profile, with hello region **World** assigned tooit.</span></span> <span data-ttu-id="66d91-236">這也可確保會處理任何未對應 tooa 區域的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="66d91-236">This also ensures that any IP addresses that do not map tooa region are handled.</span></span>

<span data-ttu-id="66d91-237">如[流量管理員的運作方式](traffic-manager-how-traffic-manager-works.md)中所述，流量管理員不會直接從用戶端接收 DNS 查詢。</span><span class="sxs-lookup"><span data-stu-id="66d91-237">As explained in [How Traffic Manager Works](traffic-manager-how-traffic-manager-works.md), Traffic Manager does not receive DNS queries directly from clients.</span></span> <span data-ttu-id="66d91-238">相反地，DNS 查詢來自 hello 用戶端會設定的 toouse hello 遞迴 DNS 服務。</span><span class="sxs-lookup"><span data-stu-id="66d91-238">Rather, DNS queries come from hello recursive DNS service that hello clients are configured toouse.</span></span> <span data-ttu-id="66d91-239">因此，hello IP 位址使用 toodetermine hello 區域不是 hello 用戶端的 IP 位址，但它是 hello hello 遞迴 DNS 服務 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="66d91-239">Therefore, hello IP address used toodetermine hello region is not hello client's IP address, but it is hello IP address of hello recursive DNS service.</span></span> <span data-ttu-id="66d91-240">在實務上，此 IP 位址是好 hello 用戶端 proxy。</span><span class="sxs-lookup"><span data-stu-id="66d91-240">In practice, this IP address is a good proxy for hello client.</span></span>


## <a name="next-steps"></a><span data-ttu-id="66d91-241">後續步驟</span><span class="sxs-lookup"><span data-stu-id="66d91-241">Next steps</span></span>

<span data-ttu-id="66d91-242">深入了解如何使用 toodevelop 高可用性應用程式[Traffic Manager 端點監視](traffic-manager-monitoring.md)</span><span class="sxs-lookup"><span data-stu-id="66d91-242">Learn how toodevelop high-availability applications using [Traffic Manager endpoint monitoring](traffic-manager-monitoring.md)</span></span>

<span data-ttu-id="66d91-243">了解如何太[建立 Traffic Manager 設定檔](traffic-manager-create-profile.md)</span><span class="sxs-lookup"><span data-stu-id="66d91-243">Learn how too[create a Traffic Manager profile](traffic-manager-create-profile.md)</span></span>

<!--Image references-->
[1]: ./media/traffic-manager-routing-methods/priority.png
[2]: ./media/traffic-manager-routing-methods/weighted.png
[3]: ./media/traffic-manager-routing-methods/performance.png



