---
title: "使用 Azure Site Recovery 自動化 StorSimple 檔案共用災害復原 | Microsoft Docs"
description: "說明針對 Microsoft Azure StorSimple 儲存體上裝載的檔案共用建立災害復原解決方案的步驟與最佳做法。"
services: storsimple
documentationcenter: NA
author: vidarmsft
manager: syadav
editor: 
ms.assetid: 23049a2c-055e-4d0e-b8f5-af2a87ecf53f
ms.service: storsimple
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/09/2017
ms.author: vidarmsft
ms.openlocfilehash: b4d575587eec1bcf43c33c7faeb8360ec67b5214
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/03/2017
---
# <a name="automated-disaster-recovery-solution-using-azure-site-recovery-for-file-shares-hosted-on-storsimple"></a><span data-ttu-id="ea94a-103">針對 StorSimple 上裝載的檔案共用使用 Azure Site Recovery 的自動化災害復原解決方案</span><span class="sxs-lookup"><span data-stu-id="ea94a-103">Automated Disaster Recovery solution using Azure Site Recovery for file shares hosted on StorSimple</span></span>
## <a name="overview"></a><span data-ttu-id="ea94a-104">概觀</span><span class="sxs-lookup"><span data-stu-id="ea94a-104">Overview</span></span>
<span data-ttu-id="ea94a-105">Microsoft Azure StorSimple 是一個混合式雲端儲存體解決方案，可解決通常與檔案共用關聯之非結構化資料的複雜性問題。</span><span class="sxs-lookup"><span data-stu-id="ea94a-105">Microsoft Azure StorSimple is a hybrid cloud storage solution that addresses the complexities of unstructured data commonly associated with file shares.</span></span> <span data-ttu-id="ea94a-106">StorSimple 使用雲端儲存體做為內部部署解決方案的擴充功能，以及跨內部部署儲存體和雲端儲存體自動將資料分層。</span><span class="sxs-lookup"><span data-stu-id="ea94a-106">StorSimple uses cloud storage as an extension of the on-premises solution and automatically tiers data across on-premises storage and cloud storage.</span></span> <span data-ttu-id="ea94a-107">整合式資料保護 (使用本機和雲端快照集) 不需要擴張的儲存體結構。</span><span class="sxs-lookup"><span data-stu-id="ea94a-107">Integrated data protection, with local and cloud snapshots, eliminates the need for a sprawling storage infrastructure.</span></span>

<span data-ttu-id="ea94a-108">[Azure Site Recovery](../site-recovery/site-recovery-overview.md) 是以 Azure 為基礎的服務，藉由協調虛擬機器的複寫、容錯移轉及復原，提供災害復原 (DR) 功能。</span><span class="sxs-lookup"><span data-stu-id="ea94a-108">[Azure Site Recovery](../site-recovery/site-recovery-overview.md) is an Azure-based service that provides disaster recovery (DR) capabilities by orchestrating replication, failover, and recovery of virtual machines.</span></span> <span data-ttu-id="ea94a-109">Azure Site Recovery 支援多種複寫技術來持續複寫、保護及順暢地容錯移轉虛擬機器和應用程式至私密/公用或主機服務提供者的雲端。</span><span class="sxs-lookup"><span data-stu-id="ea94a-109">Azure Site Recovery supports a number of replication technologies to consistently replicate, protect, and seamlessly fail over virtual machines and applications to private/public or hosted clouds.</span></span>

<span data-ttu-id="ea94a-110">您可以使用 Azure Site Recovery、虛擬機器複寫及 StorSimple 雲端快照集功能，來保護完整的檔案伺服器環境。</span><span class="sxs-lookup"><span data-stu-id="ea94a-110">Using Azure Site Recovery, virtual machine replication, and StorSimple cloud snapshot capabilities, you can protect the complete file server environment.</span></span> <span data-ttu-id="ea94a-111">發生中斷時，您可以在 Azure 中使用單鍵復原功能讓您的檔案系統在數分鐘內重新上線。</span><span class="sxs-lookup"><span data-stu-id="ea94a-111">In the event of a disruption, you can use a single click to bring your file shares online in Azure in just a few minutes.</span></span>

<span data-ttu-id="ea94a-112">本文件詳細說明如何為您 StorSimple 儲存體上裝載的檔案共用建立災害復原解決方案，以及使用單鍵復原計劃執行已計劃、未計劃及測試容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ea94a-112">This document explains in detail how you can create a disaster recovery solution for your file shares hosted on StorSimple storage, and perform planned, unplanned, and test failovers using a one-click recovery plan.</span></span> <span data-ttu-id="ea94a-113">基本上，它會說明您能夠如何修改 Azure Site Recovery 保存庫中的復原計劃，以在發生災害的情況下啟用 StorSimple 容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ea94a-113">In essence, it shows how you can modify the Recovery Plan in your Azure Site Recovery vault to enable StorSimple failovers during disaster scenarios.</span></span> <span data-ttu-id="ea94a-114">此外，它也會說明支援的組態與先決條件。</span><span class="sxs-lookup"><span data-stu-id="ea94a-114">In addition, it describes supported configurations and prerequisites.</span></span> <span data-ttu-id="ea94a-115">本文件假設您已經熟悉 Azure Site Recovery 和 StorSimple 結構的基本知識。</span><span class="sxs-lookup"><span data-stu-id="ea94a-115">This document assumes that you are familiar with the basics of Azure Site Recovery and StorSimple architectures.</span></span>

## <a name="supported-azure-site-recovery-deployment-options"></a><span data-ttu-id="ea94a-116">支援的 Azure Site Recovery 部署選項</span><span class="sxs-lookup"><span data-stu-id="ea94a-116">Supported Azure Site Recovery deployment options</span></span>
<span data-ttu-id="ea94a-117">客戶可以將檔案伺服器部署為在 Hyper-V 或 VMware 上執行的實體服務或虛擬機器 (VM)，然後從由 StorSimple 儲存體劃分出來的磁碟區建立檔案共用。</span><span class="sxs-lookup"><span data-stu-id="ea94a-117">Customers can deploy file servers as physical servers or virtual machines (VMs) running on Hyper-V or VMware, and then create file shares from volumes carved out of StorSimple storage.</span></span> <span data-ttu-id="ea94a-118">Azure Site Recovery 可以保護次要站台或 Azure 的實體與虛擬部署。</span><span class="sxs-lookup"><span data-stu-id="ea94a-118">Azure Site Recovery can protect both physical and virtual deployments to either a secondary site or to Azure.</span></span> <span data-ttu-id="ea94a-119">本文件涵蓋 DR 解決方案的詳細資料，該解決方案使用 Azure 做為 Hyper-V 上裝載之檔案伺服器 VM 的復原網站，並且在 StorSimple 儲存體上使用檔案共用。</span><span class="sxs-lookup"><span data-stu-id="ea94a-119">This document covers details of a DR solution with Azure as the recovery site for a file server VM hosted on Hyper-V and with file shares on StorSimple storage.</span></span> <span data-ttu-id="ea94a-120">檔案伺服器 VM 位於 VMware VM 或實體電腦上的其他案例也可以透過類似方式實作。</span><span class="sxs-lookup"><span data-stu-id="ea94a-120">Other scenarios in which the file server VM is on a VMware VM or a physical machine can be implemented similarly.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="ea94a-121">必要條件</span><span class="sxs-lookup"><span data-stu-id="ea94a-121">Prerequisites</span></span>
<span data-ttu-id="ea94a-122">實作單鍵災害復原解決方案 (針對 StorSimple 儲存體上裝載的檔案共用使用 Azure Site Recovery) 時，有下列先決條件：</span><span class="sxs-lookup"><span data-stu-id="ea94a-122">Implementing a one-click disaster recovery solution that uses Azure Site Recovery for file shares hosted on StorSimple storage has the following prerequisites:</span></span>

* <span data-ttu-id="ea94a-123">Hyper-V 或 VMware 或實體電腦上裝載的內部部署 Windows Server 2012 R2 檔案伺服器 VM</span><span class="sxs-lookup"><span data-stu-id="ea94a-123">On-premises Windows Server 2012 R2 File server VM hosted on Hyper-V or VMware or a physical machine</span></span>
* <span data-ttu-id="ea94a-124">在 Azure StorSimple Manager 註冊之 StorSimple 儲存體裝置內部部署</span><span class="sxs-lookup"><span data-stu-id="ea94a-124">StorSimple storage device on-premises registered with Azure StorSimple manager</span></span>
* <span data-ttu-id="ea94a-125">在 Azure StorSimple Manager (這可以保持在關機狀態) 中建立的 StorSimple Cloud Appliance</span><span class="sxs-lookup"><span data-stu-id="ea94a-125">StorSimple Cloud Appliance created in the Azure StorSimple manager (this can be kept in shut down state)</span></span>
* <span data-ttu-id="ea94a-126">裝載在 StorSimple 儲存體裝置上設定之磁碟區中的檔案共用</span><span class="sxs-lookup"><span data-stu-id="ea94a-126">File shares hosted on the volumes configured on the StorSimple storage device</span></span>
* <span data-ttu-id="ea94a-127">[Azure Site Recovery 服務保存庫](../site-recovery/site-recovery-vmm-to-vmm.md) </span><span class="sxs-lookup"><span data-stu-id="ea94a-127">[Azure Site Recovery services vault](../site-recovery/site-recovery-vmm-to-vmm.md) created in a Microsoft Azure subscription</span></span>

<span data-ttu-id="ea94a-128">此外，如果 Azure 是您的復原網站，請在 VM 上執行 [Azure 虛擬機器整備評估工具](http://azure.microsoft.com/downloads/vm-readiness-assessment/) ，以確保相容於 Azure VM 與 Azure Site Recovery 服務。</span><span class="sxs-lookup"><span data-stu-id="ea94a-128">In addition, if Azure is your recovery site, run the [Azure Virtual Machine Readiness Assessment tool](http://azure.microsoft.com/downloads/vm-readiness-assessment/) on VMs to ensure that they are compatible with Azure VMs and Azure Site Recovery services.</span></span>

<span data-ttu-id="ea94a-129">為避免延遲問題 (可能導致較高成本)，請確定您是在相同區域中建立 StorSimple Cloud Appliance、自動化帳戶及儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="ea94a-129">To avoid latency issues (which might result in higher costs), make sure that you create your StorSimple Cloud Appliance, automation account, and storage account(s) in the same region.</span></span>

## <a name="enable-dr-for-storsimple-file-shares"></a><span data-ttu-id="ea94a-130">針對 StorSimple 檔案共用啟用 DR</span><span class="sxs-lookup"><span data-stu-id="ea94a-130">Enable DR for StorSimple file shares</span></span>
<span data-ttu-id="ea94a-131">內部部署環境的每個元件都需要受到保護，才能做到完整的複寫與復原。</span><span class="sxs-lookup"><span data-stu-id="ea94a-131">Each component of the on-premises environment needs to be protected to enable complete replication and recovery.</span></span> <span data-ttu-id="ea94a-132">本節說明如何：</span><span class="sxs-lookup"><span data-stu-id="ea94a-132">This section describes how to:</span></span>

* <span data-ttu-id="ea94a-133">設定 Active Directory 和 DNS 複寫 (選擇性)</span><span class="sxs-lookup"><span data-stu-id="ea94a-133">Set up Active Directory and DNS replication (optional)</span></span>
* <span data-ttu-id="ea94a-134">使用 Azure Site Recovery 來保護檔案伺服器 VM</span><span class="sxs-lookup"><span data-stu-id="ea94a-134">Use Azure Site Recovery to enable protection of the file server VM</span></span>
* <span data-ttu-id="ea94a-135">保護 StorSimple 磁碟區</span><span class="sxs-lookup"><span data-stu-id="ea94a-135">Enable protection of StorSimple volumes</span></span>
* <span data-ttu-id="ea94a-136">設定網路</span><span class="sxs-lookup"><span data-stu-id="ea94a-136">Configure the network</span></span>

### <a name="set-up-active-directory-and-dns-replication-optional"></a><span data-ttu-id="ea94a-137">設定 Active Directory 和 DNS 複寫 (選擇性)</span><span class="sxs-lookup"><span data-stu-id="ea94a-137">Set up Active Directory and DNS replication (optional)</span></span>
<span data-ttu-id="ea94a-138">如果您想要保護執行 Active Directory 和 DNS 的電腦，讓它們能夠在 DR 網站上提供使用，您需要明確地保護它們 (檔案伺服器就能在容錯移轉之後使用驗證來存取)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-138">If you want to protect the machines running Active Directory and DNS so that they are available on the DR site, you need to explicitly protect them (so that the file servers are accessible after fail over with authentication).</span></span> <span data-ttu-id="ea94a-139">根據客戶內部部署環境的複雜度而定，有兩個建議的選項。</span><span class="sxs-lookup"><span data-stu-id="ea94a-139">There are two recommended options based on the complexity of the customer’s on-premises environment.</span></span>

#### <a name="option-1"></a><span data-ttu-id="ea94a-140">選項 1</span><span class="sxs-lookup"><span data-stu-id="ea94a-140">Option 1</span></span>
<span data-ttu-id="ea94a-141">如果客戶的整個內部部署網站中只有少數的應用程式和單一網域控制站，且將容錯移轉整個網站，我們建議使用 Azure Site Recovery 複寫將網域控制站電腦複寫至次要網站 (適用於網站對網站和網站對 Azure)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-141">If the customer has a small number of applications, a single domain controller for the entire on-premises site, and will be failing over the entire site, then we recommend using Azure Site Recovery replication to replicate the domain controller machine to a secondary site (this is applicable for both site-to-site and site-to-Azure).</span></span>

#### <a name="option-2"></a><span data-ttu-id="ea94a-142">選項 2</span><span class="sxs-lookup"><span data-stu-id="ea94a-142">Option 2</span></span>
<span data-ttu-id="ea94a-143">如果客戶有大量應用程式、正在執行 Active Directory 樹系，且一次將只容錯移轉少數應用程式，我們建議在 DR 網站 (次要網站或 Azure 中) 另外設定一個網域控制站。</span><span class="sxs-lookup"><span data-stu-id="ea94a-143">If the customer has a large number of applications, is running an Active Directory forest, and will be failing over a few applications at a time, then we recommend setting up an additional domain controller on the DR site (either a secondary site or in Azure).</span></span>

<span data-ttu-id="ea94a-144">請參閱 [使用 Azure Site Recovery 自動化 Active Directory 與 DNS 的 DR 解決方案](../site-recovery/site-recovery-active-directory.md) ，以取得在 DR 網站上提供網域控制站的指示。</span><span class="sxs-lookup"><span data-stu-id="ea94a-144">Please refer to [Automated DR solution for Active Directory and DNS using Azure Site Recovery](../site-recovery/site-recovery-active-directory.md) for instructions when making a domain controller available on the DR site.</span></span> <span data-ttu-id="ea94a-145">對於本文件的其餘部分，我們將假設 DR 網站上有網域控制站可用。</span><span class="sxs-lookup"><span data-stu-id="ea94a-145">For the remainder of this document, we will assume a domain controller is available on the DR site.</span></span>

### <a name="use-azure-site-recovery-to-enable-protection-of-the-file-server-vm"></a><span data-ttu-id="ea94a-146">使用 Azure Site Recovery 來保護檔案伺服器 VM</span><span class="sxs-lookup"><span data-stu-id="ea94a-146">Use Azure Site Recovery to enable protection of the file server VM</span></span>
<span data-ttu-id="ea94a-147">此網站需要您準備內部部署伺服器環境、建立及準備 Azure Site Recovery 保存庫，以及啟用 VM 的檔案保護。</span><span class="sxs-lookup"><span data-stu-id="ea94a-147">This step requires that you prepare the on-premises file server environment, create and prepare an Azure Site Recovery vault, and enable file protection of the VM.</span></span>

#### <a name="to-prepare-the-on-premises-file-server-environment"></a><span data-ttu-id="ea94a-148">保護內部部署檔案伺服器環境</span><span class="sxs-lookup"><span data-stu-id="ea94a-148">To prepare the on-premises file server environment</span></span>
1. <span data-ttu-id="ea94a-149">將 [使用者帳戶控制] 設為 [一律不通知]。</span><span class="sxs-lookup"><span data-stu-id="ea94a-149">Set the **User Account Control** to **Never Notify**.</span></span> <span data-ttu-id="ea94a-150">這是必要的，以便您可以在透過 Azure Site Recovery 容錯移轉之後使用 Azure 自動化指令碼連線 iSCSI。</span><span class="sxs-lookup"><span data-stu-id="ea94a-150">This is required so that you can use Azure automation scripts to connect the iSCSI targets after fail over by Azure Site Recovery.</span></span>

   1. <span data-ttu-id="ea94a-151">按 Windows 鍵 +Q 並搜尋 **UAC**。</span><span class="sxs-lookup"><span data-stu-id="ea94a-151">Press the Windows key +Q and search for **UAC**.</span></span>
   2. <span data-ttu-id="ea94a-152">選取 [變更使用者帳戶控制設定] 。</span><span class="sxs-lookup"><span data-stu-id="ea94a-152">Select **Change User Account Control settings**.</span></span>
   3. <span data-ttu-id="ea94a-153">將橫條向底部的 [一律不通知] 方向拖曳。</span><span class="sxs-lookup"><span data-stu-id="ea94a-153">Drag the bar to the bottom towards **Never Notify**.</span></span>
   4. <span data-ttu-id="ea94a-154">按一下 [確定] 然後在提示時選取 [是]。</span><span class="sxs-lookup"><span data-stu-id="ea94a-154">Click **OK** and then select **Yes** when prompted.</span></span>

      ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image1.png)
2. <span data-ttu-id="ea94a-155">在每部檔案伺服器 VM 上安裝 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="ea94a-155">Install the VM Agent on each of the file server VMs.</span></span> <span data-ttu-id="ea94a-156">這是必要的，以便您可以在已容錯移轉的 VM 上執行 Azure 自動化指令碼。</span><span class="sxs-lookup"><span data-stu-id="ea94a-156">This is required so that you can run Azure automation scripts on the failed over VMs.</span></span>

   1. <span data-ttu-id="ea94a-157">[下載代理程式](http://aka.ms/vmagentwin)至`C:\\Users\\<username>\\Downloads`</span><span class="sxs-lookup"><span data-stu-id="ea94a-157">[Download the agent](http://aka.ms/vmagentwin) to `C:\\Users\\<username>\\Downloads`.</span></span>
   2. <span data-ttu-id="ea94a-158">以系統管理員模式 (以系統管理員身分執行) 開啟 Windows PowerShell，然後輸入下列命令以瀏覽至下載位置：</span><span class="sxs-lookup"><span data-stu-id="ea94a-158">Open Windows PowerShell in Administrator mode (Run as Administrator), and then enter the following command to navigate to the download location:</span></span>

      `cd C:\\Users\\<username>\\Downloads\\WindowsAzureVmAgent.2.6.1198.718.rd\_art\_stable.150415-1739.fre.msi`

      > [!NOTE]
      > <span data-ttu-id="ea94a-159">視版本不同，檔案名稱可能會改變。</span><span class="sxs-lookup"><span data-stu-id="ea94a-159">The file name may change depending on the version.</span></span>
      >
      >
3. <span data-ttu-id="ea94a-160">按一下 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="ea94a-160">Click **Next**.</span></span>
4. <span data-ttu-id="ea94a-161">接受 [合約條款] 然後按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="ea94a-161">Accept the **Terms of Agreement** and then click **Next**.</span></span>
5. <span data-ttu-id="ea94a-162">按一下 [完成]。</span><span class="sxs-lookup"><span data-stu-id="ea94a-162">Click **Finish**.</span></span>
6. <span data-ttu-id="ea94a-163">使用從 StorSimple 儲存體劃分出來的磁碟區建立檔案共用。</span><span class="sxs-lookup"><span data-stu-id="ea94a-163">Create file shares using volumes carved out of StorSimple storage.</span></span> <span data-ttu-id="ea94a-164">如需詳細資訊，請參閱 [使用 StorSimple Manager 服務管理磁碟區](storsimple-manage-volumes.md)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-164">For more information, see [Use the StorSimple Manager service to manage volumes](storsimple-manage-volumes.md).</span></span>

   1. <span data-ttu-id="ea94a-165">在您的內部部署 VM 上，按 Windows 鍵 +Q 並搜尋 **iSCSI**。</span><span class="sxs-lookup"><span data-stu-id="ea94a-165">On your on-premises VMs, press the Windows key +Q and search for **iSCSI**.</span></span>
   2. <span data-ttu-id="ea94a-166">選取 [iSCSI 啟動器]。</span><span class="sxs-lookup"><span data-stu-id="ea94a-166">Select **iSCSI initiator**.</span></span>
   3. <span data-ttu-id="ea94a-167">選取 [組態]  索引標籤並複製啟動器名稱。</span><span class="sxs-lookup"><span data-stu-id="ea94a-167">Select the **Configuration** tab and copy the initiator name.</span></span>
   4. <span data-ttu-id="ea94a-168">登入 [Azure 入口網站](https://portal.azure.com/)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-168">Log in to the [Azure portal](https://portal.azure.com/).</span></span>
   5. <span data-ttu-id="ea94a-169">選取 [StorSimple]  索引標籤，然後選取包含實體裝置的 StorSimple Manager 服務。</span><span class="sxs-lookup"><span data-stu-id="ea94a-169">Select the **StorSimple** tab and then select the StorSimple Manager Service that contains the physical device.</span></span>
   6. <span data-ttu-id="ea94a-170">建立磁碟區容器，然後建立磁碟區。</span><span class="sxs-lookup"><span data-stu-id="ea94a-170">Create volume container(s) and then create volume(s).</span></span> <span data-ttu-id="ea94a-171">(這些磁碟區是供檔案伺服器 VM 上的檔案共用使用)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-171">(These volumes are for the file share(s) on the file server VMs).</span></span> <span data-ttu-id="ea94a-172">在您建立磁碟區時，請複製啟動器名稱並為「存取控制記錄」提供適當名稱。</span><span class="sxs-lookup"><span data-stu-id="ea94a-172">Copy the initiator name and give an appropriate name for the Access Control Records when you create the volumes.</span></span>
   7. <span data-ttu-id="ea94a-173">選取 [組態]  索引標籤並記下裝置的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="ea94a-173">Select the **Configure** tab and note down the IP address of the device.</span></span>
   8. <span data-ttu-id="ea94a-174">在您的內部部署 VM 上，再度移到 [iSCSI 啟動器]  ，並在 [快速連線] 區段中輸入 IP。</span><span class="sxs-lookup"><span data-stu-id="ea94a-174">On your on-premises VMs, go to the **iSCSI initiator** again and enter the IP in the Quick Connect section.</span></span> <span data-ttu-id="ea94a-175">按一下 [快速連線]  \(裝置現在應該就會連線)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-175">Click **Quick Connect** (the device should now be connected).</span></span>
   9. <span data-ttu-id="ea94a-176">開啟 Azure 入口網站，然後選取 [磁碟區和裝置]  索引標籤。</span><span class="sxs-lookup"><span data-stu-id="ea94a-176">Open the Azure portal and select the **Volumes and Devices** tab.</span></span> <span data-ttu-id="ea94a-177">按一下 [自動設定] 。</span><span class="sxs-lookup"><span data-stu-id="ea94a-177">Click **Auto Configure**.</span></span> <span data-ttu-id="ea94a-178">您剛剛建立的磁碟區應該就會出現。</span><span class="sxs-lookup"><span data-stu-id="ea94a-178">The volume that you just created should appear.</span></span>
   10. <span data-ttu-id="ea94a-179">在入口網站中，選取 [裝置] 索引標籤，然後選取 [建立新的虛擬裝置]。</span><span class="sxs-lookup"><span data-stu-id="ea94a-179">In the portal, select the **Devices** tab and then select **Create a New Virtual Device.**</span></span> <span data-ttu-id="ea94a-180">(此虛擬裝置將會在發生容錯移轉時使用)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-180">(This virtual device will be used if a failover occurs).</span></span> <span data-ttu-id="ea94a-181">這個新的虛擬裝置可以維持在離線狀態以避免產生額外成本。</span><span class="sxs-lookup"><span data-stu-id="ea94a-181">This new virtual device can be kept in an offline state to avoid extra costs.</span></span> <span data-ttu-id="ea94a-182">若要讓虛擬機器離線，請移至入口網站的 [虛擬機器] 區段並將它關閉。</span><span class="sxs-lookup"><span data-stu-id="ea94a-182">To take the virtual device offline, go to the **Virtual Machines** section on the Portal and shut it down.</span></span>
   11. <span data-ttu-id="ea94a-183">回到內部部署 VM並開啟磁碟管理 (按 Windows 鍵 + X 並選取 [磁碟管理] )。</span><span class="sxs-lookup"><span data-stu-id="ea94a-183">Go back to the on-premises VMs and open Disk Management (press the Windows key + X and select **Disk Management**).</span></span>
   12. <span data-ttu-id="ea94a-184">您將會發現一些額外的磁碟 (視您已經建立的磁碟區數目而定)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-184">You will notice some extra disks (depending on the number of volumes you have created).</span></span> <span data-ttu-id="ea94a-185">在第一個磁碟上按一下滑鼠右鍵，選取 [初始化磁碟]，然後選取 [確定]。</span><span class="sxs-lookup"><span data-stu-id="ea94a-185">Right-click the first one, select **Initialize Disk**, and select **OK**.</span></span> <span data-ttu-id="ea94a-186">在 [未配置] 區段中按一下滑鼠右鍵，選取 [新增簡單磁碟區]，指派一個磁碟機代號給它，然後結束精靈。</span><span class="sxs-lookup"><span data-stu-id="ea94a-186">Right-click the **Unallocated** section, select **New Simple Volume**, assign it a drive letter, and finish the wizard.</span></span>
   13. <span data-ttu-id="ea94a-187">為所有磁碟重複步驟 I。</span><span class="sxs-lookup"><span data-stu-id="ea94a-187">Repeat step l for all the disks.</span></span> <span data-ttu-id="ea94a-188">您現在可以在 Windows 檔案總管中的 [這部電腦]  上看到所有磁碟。</span><span class="sxs-lookup"><span data-stu-id="ea94a-188">You can now see all the disks on **This PC** in the Windows Explorer.</span></span>
   14. <span data-ttu-id="ea94a-189">請使用檔案和存放服務角色在這些磁碟區上建立檔案共用。</span><span class="sxs-lookup"><span data-stu-id="ea94a-189">Use the File and Storage Services role to create file shares on these volumes.</span></span>

#### <a name="to-create-and-prepare-an-azure-site-recovery-vault"></a><span data-ttu-id="ea94a-190">建立及準備 Azure Site Recovery 保存庫</span><span class="sxs-lookup"><span data-stu-id="ea94a-190">To create and prepare an Azure Site Recovery vault</span></span>
<span data-ttu-id="ea94a-191">請參閱 [Azure Site Recovery 文件](../site-recovery/site-recovery-hyper-v-site-to-azure.md) 來於保護檔案伺服器 VM 之前開始使用 Azure Site Recovery。</span><span class="sxs-lookup"><span data-stu-id="ea94a-191">Refer to the [Azure Site Recovery documentation](../site-recovery/site-recovery-hyper-v-site-to-azure.md) to get started with Azure Site Recovery before protecting the file server VM.</span></span>

#### <a name="to-enable-protection"></a><span data-ttu-id="ea94a-192">啟用保護</span><span class="sxs-lookup"><span data-stu-id="ea94a-192">To enable protection</span></span>
1. <span data-ttu-id="ea94a-193">透過 Azure Site Recovery 將 iSCSI 目標與您想要保護的內部部署 VM 中斷連線：</span><span class="sxs-lookup"><span data-stu-id="ea94a-193">Disconnect the iSCSI target(s) from the on-premises VMs that you want to protect through Azure Site Recovery:</span></span>

   1. <span data-ttu-id="ea94a-194">按 Windows 鍵 +Q 並搜尋 **iSCSI**。</span><span class="sxs-lookup"><span data-stu-id="ea94a-194">Press Windows key + Q and search for **iSCSI**.</span></span>
   2. <span data-ttu-id="ea94a-195">選取 [設定 iSCSI 啟動器] 。</span><span class="sxs-lookup"><span data-stu-id="ea94a-195">Select **Set up iSCSI initiator**.</span></span>
   3. <span data-ttu-id="ea94a-196">中斷連線您之前連線的 StorSimple 裝置。</span><span class="sxs-lookup"><span data-stu-id="ea94a-196">Disconnect the StorSimple device that you connected previously.</span></span> <span data-ttu-id="ea94a-197">或者，您可以在啟用保護時將檔案伺服器關閉幾分鐘。</span><span class="sxs-lookup"><span data-stu-id="ea94a-197">Alternatively, you can switch off the file server for a few minutes when enabling protection.</span></span>

   > [!NOTE]
   > <span data-ttu-id="ea94a-198">這將會導致檔案共用暫時無法使用。</span><span class="sxs-lookup"><span data-stu-id="ea94a-198">This will cause the file shares to be temporarily unavailable.</span></span>
   >
   >
2. <span data-ttu-id="ea94a-199">從 Azure Site Recovery 入口網站為檔案伺服器 VM [啟用虛擬機器保護](../site-recovery/site-recovery-hyper-v-site-to-azure.md)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-199">[Enable virtual machine protection](../site-recovery/site-recovery-hyper-v-site-to-azure.md) of the file server VM from the Azure Site Recovery portal.</span></span>
3. <span data-ttu-id="ea94a-200">當起始同步處理開始時，您可以再次重新連線目標。</span><span class="sxs-lookup"><span data-stu-id="ea94a-200">When the initial synchronization begins, you can reconnect the target again.</span></span> <span data-ttu-id="ea94a-201">移至 iSCSI 啟動器，選取 StorSimple 裝置，然後按一下 [連線] 。</span><span class="sxs-lookup"><span data-stu-id="ea94a-201">Go to the iSCSI initiator, select the StorSimple device, and click **Connect**.</span></span>
4. <span data-ttu-id="ea94a-202">當同步完成且 VM 的狀態為 [受保護] 時，請選取 VM，選取 [設定] 索引標籤，然後據以更新 VM 的網路 (這是已容錯移轉的 VM 所屬的網路)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-202">When the synchronization is complete and the status of the VM is **Protected**, select the VM, select the **Configure** tab, and update the network of the VM accordingly (this is the network that the failed over VM(s) will be a part of).</span></span> <span data-ttu-id="ea94a-203">如果網路沒有顯示，表示同步仍在進行中。</span><span class="sxs-lookup"><span data-stu-id="ea94a-203">If the network doesn’t show up, it means that the sync is still going on.</span></span>

### <a name="enable-protection-of-storsimple-volumes"></a><span data-ttu-id="ea94a-204">保護 StorSimple 磁碟區</span><span class="sxs-lookup"><span data-stu-id="ea94a-204">Enable protection of StorSimple volumes</span></span>
<span data-ttu-id="ea94a-205">如果您尚未選取 StorSimple 磁碟區的 [啟用此磁碟區的預設備份] 選項，請移至 StorSimple Manager 服務中的 [備份原則]，然後為所有磁碟區建立適當的備份原則。</span><span class="sxs-lookup"><span data-stu-id="ea94a-205">If you have not selected the **Enable a default backup for this volume** option for the StorSimple volumes, go to **Backup Policies** in the StorSimple Manager service, and create a suitable backup policy for all the volumes.</span></span> <span data-ttu-id="ea94a-206">我們建議您將備份頻率設定為您要查看應用程式的復原點目標 (RPO)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-206">We recommend that you set the frequency of backups to the recovery point objective (RPO) that you would like to see for the application.</span></span>

### <a name="configure-the-network"></a><span data-ttu-id="ea94a-207">設定網路</span><span class="sxs-lookup"><span data-stu-id="ea94a-207">Configure the network</span></span>
<span data-ttu-id="ea94a-208">對於檔案伺服器 VM，請設定 Azure Site Recovery 中的網路設定，讓 VM 網路能夠在容錯移轉之後連結到正確的 DR 網路。</span><span class="sxs-lookup"><span data-stu-id="ea94a-208">For the file server VM, configure network settings in Azure Site Recovery so that the VM networks are attached to the correct DR network after failover.</span></span>

<span data-ttu-id="ea94a-209">您可以在 [複寫的項目] 索引標籤中選取 VM 以設定網路設定，如以下圖例所示。</span><span class="sxs-lookup"><span data-stu-id="ea94a-209">You can select the VM in the **Replicated items** tab to configure the network settings, as shown in the following illustration.</span></span>

![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image2.png)

## <a name="create-a-recovery-plan"></a><span data-ttu-id="ea94a-210">建立復原計畫</span><span class="sxs-lookup"><span data-stu-id="ea94a-210">Create a recovery plan</span></span>
<span data-ttu-id="ea94a-211">您可以在 ASR 中建立復原計劃來將檔案共用的容錯移轉程序自動化。</span><span class="sxs-lookup"><span data-stu-id="ea94a-211">You can create a recovery plan in ASR to automate the failover process of the file shares.</span></span> <span data-ttu-id="ea94a-212">如果發生中斷，您只要按一下就可以在幾分鐘內讓檔案共用重新上線。</span><span class="sxs-lookup"><span data-stu-id="ea94a-212">If a disruption occurs, you can bring the file shares up in a few minutes with just a single click.</span></span> <span data-ttu-id="ea94a-213">若要啟用此自動化功能，您需要 Azure 自動化帳戶。</span><span class="sxs-lookup"><span data-stu-id="ea94a-213">To enable this automation, you will need an Azure automation account.</span></span>

#### <a name="to-create-an-automation-account"></a><span data-ttu-id="ea94a-214">建立自動化帳戶</span><span class="sxs-lookup"><span data-stu-id="ea94a-214">To create an Automation account</span></span>
1. <span data-ttu-id="ea94a-215">前往 Azure 入口網站 [自動化] &gt;區段。</span><span class="sxs-lookup"><span data-stu-id="ea94a-215">Go to the Azure portal &gt; **Automation** section.</span></span>
2. <span data-ttu-id="ea94a-216">按一下 [+ 加] 按鈕，開啟下方的刀鋒視窗。</span><span class="sxs-lookup"><span data-stu-id="ea94a-216">Click **+ Add** button, opens below blade.</span></span>

   ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image11.png)

   * <span data-ttu-id="ea94a-217">[名稱] - 輸入一個新的自動化帳戶</span><span class="sxs-lookup"><span data-stu-id="ea94a-217">Name - Enter a new automation account</span></span>
   * <span data-ttu-id="ea94a-218">[訂用帳戶] - 選擇訂用帳戶</span><span class="sxs-lookup"><span data-stu-id="ea94a-218">Subscription - Choose subscription</span></span>
   * <span data-ttu-id="ea94a-219">[資源群組] - 建立新的或選擇現有的資源群組</span><span class="sxs-lookup"><span data-stu-id="ea94a-219">Resource group - Create new/choose existing resource group</span></span>
   * <span data-ttu-id="ea94a-220">[位置] - 選擇位置，請將它維持在 StorSimple 雲端設備和儲存體帳戶建立所在的相同地理區域中。</span><span class="sxs-lookup"><span data-stu-id="ea94a-220">Location - Choose location, keep it in the same geo/region in which the StorSimple Cloud Appliance and Storage Accounts were created.</span></span>
   * <span data-ttu-id="ea94a-221">建立 Azure 執行身分帳戶 - 選取 [是] 選項。</span><span class="sxs-lookup"><span data-stu-id="ea94a-221">Create Azure Run As account - Select **Yes** option.</span></span>

3. <span data-ttu-id="ea94a-222">前往自動化帳戶，按一下 [Runbooks]  &gt; [瀏覽資源庫] ，來將所有必要的 Runbooks 匯入自動化帳戶。</span><span class="sxs-lookup"><span data-stu-id="ea94a-222">Go to the Automation account, click **Runbooks** &gt; **Browse Gallery** to import all the required runbooks into the automation account.</span></span>
4. <span data-ttu-id="ea94a-223">尋找資源庫中的 [災害復原]  標籤，以新增下列 Runbook：</span><span class="sxs-lookup"><span data-stu-id="ea94a-223">Add the following runbooks by finding **Disaster Recovery** tag in the gallery:</span></span>

   * <span data-ttu-id="ea94a-224">在測試容錯移轉 (TFO) 之後清除 StorSimple 磁碟區</span><span class="sxs-lookup"><span data-stu-id="ea94a-224">Clean up of StorSimple volumes after Test Failover (TFO)</span></span>
   * <span data-ttu-id="ea94a-225">容錯移轉 StorSimple 磁碟區容器</span><span class="sxs-lookup"><span data-stu-id="ea94a-225">Failover StorSimple volume containers</span></span>
   * <span data-ttu-id="ea94a-226">在容錯移轉之後於 StorSimple 裝置上掛接磁碟區</span><span class="sxs-lookup"><span data-stu-id="ea94a-226">Mount volumes on StorSimple device after failover</span></span>
   * <span data-ttu-id="ea94a-227">在 Azure VM 中解除安裝自訂指令碼擴充功能</span><span class="sxs-lookup"><span data-stu-id="ea94a-227">Uninstall custom script extension in Azure VM</span></span>
   * <span data-ttu-id="ea94a-228">啟動 StorSimple 虛擬設備</span><span class="sxs-lookup"><span data-stu-id="ea94a-228">Start StorSimple Virtual Appliance</span></span>

     ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image3.png)

5. <span data-ttu-id="ea94a-229">選取自動化帳戶中的 Runbook，以發行所有指令碼，並按一下 [編輯]  &gt; [發行] ，然後按一下 [是]  顯示驗證訊息。</span><span class="sxs-lookup"><span data-stu-id="ea94a-229">Publish all the scripts by selecting the runbook in the automation account and click **Edit** &gt; **Publish** and then **Yes** to the verification message.</span></span> <span data-ttu-id="ea94a-230">在這個步驟之後，[Runbook]  索引標籤看起來會像下面這樣：</span><span class="sxs-lookup"><span data-stu-id="ea94a-230">After this step, the **Runbooks** tab will appear as follows:</span></span>

    ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image4.png)

6. <span data-ttu-id="ea94a-231">在自動化帳戶中，選取 [資產] 索引標籤 &gt; 按一下 [變數]  &gt; [加入變數] ，然後加入下列變數。</span><span class="sxs-lookup"><span data-stu-id="ea94a-231">In the automation account, select the **Assets** tab &gt; click **Variables** &gt; **Add a variable** and add the following variables.</span></span> <span data-ttu-id="ea94a-232">您可以選擇將這些資產加密。</span><span class="sxs-lookup"><span data-stu-id="ea94a-232">You can choose to encrypt these assets.</span></span> <span data-ttu-id="ea94a-233">這些變數都是復原計劃特定變數。</span><span class="sxs-lookup"><span data-stu-id="ea94a-233">These variables are recovery plan–specific.</span></span> <span data-ttu-id="ea94a-234">如果您的復原計劃 (您將會在下一個步驟中建立) 名稱為 TestPlan，您的變數就應該是 TestPlan-StorSimRegKey、TestPlan-AzureSubscriptionName 等等。</span><span class="sxs-lookup"><span data-stu-id="ea94a-234">If your recovery plan (which you will create in the next step) name is TestPlan, then your variables should be TestPlan-StorSimRegKey, TestPlan-AzureSubscriptionName, and so on.</span></span>

   * <span data-ttu-id="ea94a-235">RecoveryPlanName**-StorSimRegKey**：StorSimple Manager 服務的註冊金鑰。</span><span class="sxs-lookup"><span data-stu-id="ea94a-235">*RecoveryPlanName***-StorSimRegKey**: The registration key for the StorSimple Manager service.</span></span>
   * <span data-ttu-id="ea94a-236">RecoveryPlanName**-AzureSubscriptionName**：Azure 訂用帳戶的名稱。</span><span class="sxs-lookup"><span data-stu-id="ea94a-236">*RecoveryPlanName***-AzureSubscriptionName**: The name of the Azure subscription.</span></span>
   * <span data-ttu-id="ea94a-237">RecoveryPlanName**-ResourceName**：擁有 StorSimple 裝置的 StorSimple 資源的名稱。</span><span class="sxs-lookup"><span data-stu-id="ea94a-237">*RecoveryPlanName***-ResourceName**: The name of the StorSimple resource that has the StorSimple device.</span></span>
   * <span data-ttu-id="ea94a-238">RecoveryPlanName**-DeviceName**：必須容錯移轉的裝置。</span><span class="sxs-lookup"><span data-stu-id="ea94a-238">*RecoveryPlanName***-DeviceName**: The device that has to be failed over.</span></span>
   * <span data-ttu-id="ea94a-239">RecoveryPlanName**-VolumeContainers**：需容錯移轉之裝置上顯示的磁碟區容器字串 (以逗號區隔)；例如 volcon1、volcon2、volcon3。</span><span class="sxs-lookup"><span data-stu-id="ea94a-239">*RecoveryPlanName***-VolumeContainers**: A comma-separated string of volume containers present on the device that need to be failed over; for example, volcon1,volcon2, volcon3.</span></span>
   * <span data-ttu-id="ea94a-240">RecoveryPlanName**-TargetDeviceName**：容器容錯移轉之後所在的 StorSimple Cloud Appliance。</span><span class="sxs-lookup"><span data-stu-id="ea94a-240">*RecoveryPlanName***-TargetDeviceName**: The StorSimple Cloud Appliance on which the containers are to be failed over.</span></span>
   * <span data-ttu-id="ea94a-241">*RecoveryPlanName***-TargetDeviceDnsName**：目標裝置的服務名稱 (此名稱可在 [虛擬機器]  區段中找到：服務名稱與 DNS 名稱相同)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-241">*RecoveryPlanName***-TargetDeviceDnsName**: The service name of the target device (this can be found in the **Virtual Machine** section: the service name is the same as the DNS name).</span></span>
   * <span data-ttu-id="ea94a-242">RecoveryPlanName**-StorageAccountName**：儲存體帳戶名稱，指令碼 (必須在已容錯移轉的 VM 上執行) 將使用此名稱來儲存。</span><span class="sxs-lookup"><span data-stu-id="ea94a-242">*RecoveryPlanName***-StorageAccountName**: The storage account name in which the script (which has to run on the failed over VM) will be stored.</span></span> <span data-ttu-id="ea94a-243">這可以是任何擁有一些空間可暫時儲存指令碼的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="ea94a-243">This can be any storage account that has some space to store the script temporarily.</span></span>
   * <span data-ttu-id="ea94a-244">RecoveryPlanName**-StorageAccountKey**：上述儲存體帳戶的存取金鑰。</span><span class="sxs-lookup"><span data-stu-id="ea94a-244">*RecoveryPlanName***-StorageAccountKey**: The access key for the above storage account.</span></span>
   * <span data-ttu-id="ea94a-245">RecoveryPlanName**-ScriptContainer**：將儲存指令碼之雲端容器的名稱。</span><span class="sxs-lookup"><span data-stu-id="ea94a-245">*RecoveryPlanName***-ScriptContainer**: The name of the container in which the script will be stored in the cloud.</span></span> <span data-ttu-id="ea94a-246">如果容器不存在，就會建立容器。</span><span class="sxs-lookup"><span data-stu-id="ea94a-246">If the container doesn’t exist, it will be created.</span></span>
   * <span data-ttu-id="ea94a-247">RecoveryPlanName**-VMGUIDS**：在保護 VM 時，Azure Site Recovery 會為每個 VM指派一個唯一識別碼，該識別碼可提供已容錯移轉之 VM 的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="ea94a-247">*RecoveryPlanName***-VMGUIDS**: Upon protecting a VM, Azure Site Recovery assigns every VM a unique ID that gives the details of the failed over VM.</span></span> <span data-ttu-id="ea94a-248">若要取得 VMGUID，請選取 [復原服務]  索引標籤，然後按一下 [受保護的項目]  &gt; [保護群組]  &gt; [機器]  &gt; [屬性] 。</span><span class="sxs-lookup"><span data-stu-id="ea94a-248">To obtain the VMGUID, select the **Recovery Services** tab and click **Protected Item** &gt; **Protection Groups** &gt; **Machines** &gt; **Properties**.</span></span> <span data-ttu-id="ea94a-249">如果您有多個 VM，請透過以逗號區隔的字串方式新增 GUID。</span><span class="sxs-lookup"><span data-stu-id="ea94a-249">If you have multiple VMs, then add the GUIDs as a comma-separated string.</span></span>
   * <span data-ttu-id="ea94a-250">RecoveryPlanName**-AutomationAccountName** – 您已在其中新增 Runbook 和資產的自動化帳戶的名稱。</span><span class="sxs-lookup"><span data-stu-id="ea94a-250">*RecoveryPlanName***-AutomationAccountName** – The name of the automation account in which you have added the runbooks and the assets.</span></span>

  <span data-ttu-id="ea94a-251">例如，如果復原計劃的名稱是 fileServerpredayRP，您的 [認證]  &  [變數] 索引標籤就應在您新增所有資產之後顯示如下。</span><span class="sxs-lookup"><span data-stu-id="ea94a-251">For example, if the name of the recovery plan is fileServerpredayRP, then your **Credentials** & **Variables** tabs should appear as follows after you add all the assets.</span></span>

   ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image5.png)

7. <span data-ttu-id="ea94a-252">移至 [復原服務]  區段並選取您之前建立的 Azure Site Recovery 保存庫。</span><span class="sxs-lookup"><span data-stu-id="ea94a-252">Go to the **Recovery Services** section and select the Azure Site Recovery vault that you created earlier.</span></span>
8. <span data-ttu-id="ea94a-253">從 [管理] 群組選取 [復原計劃 (站台復原)] 群組，然後如下所述建立新的復原計劃：</span><span class="sxs-lookup"><span data-stu-id="ea94a-253">Select the **Recovery Plans (Site Recovery)** option from **Manage** group and create a new recovery plan as follows:</span></span>

   <span data-ttu-id="ea94a-254">a.</span><span class="sxs-lookup"><span data-stu-id="ea94a-254">a.</span></span>  <span data-ttu-id="ea94a-255">按一下 [+ 復原計劃] 按鈕，開啟如下的刀鋒視窗。</span><span class="sxs-lookup"><span data-stu-id="ea94a-255">Click **+ Recover plan** button, opens below blade.</span></span>

      ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image6.png)

   <span data-ttu-id="ea94a-256">b.</span><span class="sxs-lookup"><span data-stu-id="ea94a-256">b.</span></span>  <span data-ttu-id="ea94a-257">輸入復原計劃名稱，選擇來源、目標及部署模型值。</span><span class="sxs-lookup"><span data-stu-id="ea94a-257">Enter a recovery plan name, choose Source, Target & Deployment model values.</span></span>

   <span data-ttu-id="ea94a-258">c.</span><span class="sxs-lookup"><span data-stu-id="ea94a-258">c.</span></span>  <span data-ttu-id="ea94a-259">從保護群組中選取您要在復原計劃中包含的 VM，然後按一下 [確定] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="ea94a-259">Select the VMs from the protection group that you want to include in the recovery plan and click **OK** button.</span></span>

   <span data-ttu-id="ea94a-260">d.</span><span class="sxs-lookup"><span data-stu-id="ea94a-260">d.</span></span>  <span data-ttu-id="ea94a-261">選取您稍早建立的復原計劃，按一下 [自訂] 按鈕開啟 [復原計劃] 自訂檢視。</span><span class="sxs-lookup"><span data-stu-id="ea94a-261">Select Recovery plan that you created earlier, click **Customize** button to open the Recovery plan customization view.</span></span>

   <span data-ttu-id="ea94a-262">e.</span><span class="sxs-lookup"><span data-stu-id="ea94a-262">e.</span></span>  <span data-ttu-id="ea94a-263">以滑鼠右鍵按一下 [所有關閉的群組] ，然後按一下 [新增前置動作] 。</span><span class="sxs-lookup"><span data-stu-id="ea94a-263">Right click on **All groups shutdown** and click **Add pre action**.</span></span>

   <span data-ttu-id="ea94a-264">f.</span><span class="sxs-lookup"><span data-stu-id="ea94a-264">f.</span></span>  <span data-ttu-id="ea94a-265">開啟 [插入動作] 刀鋒視窗、輸入名稱、在 [到哪裡執行] 選項中選取 [主要端] 選項、選取自動化帳戶 (您加入 Runbook 的帳戶)，然後選取 **Failover-StorSimple-Volume-Containers** Runbook。</span><span class="sxs-lookup"><span data-stu-id="ea94a-265">Opens Insert action blade, enter a name, select **Primary side** option in Where to run option, select Automation account (in which you added the runbooks) and then select the **Failover-StorSimple-Volume-Containers** runbook.</span></span>

   <span data-ttu-id="ea94a-266">g.</span><span class="sxs-lookup"><span data-stu-id="ea94a-266">g.</span></span>  <span data-ttu-id="ea94a-267">以滑鼠右鍵按一下 [群組 1: 開始] 、按一下 [新增受保護的項目]  選項，然後選取將在復原計劃中受到保護的 VM 並按一下 [確定] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="ea94a-267">Right click on **Group 1: Start** and click **Add protected items** option then select the VMs that are to be protected in the recovery plan and Click **Ok** button.</span></span> <span data-ttu-id="ea94a-268">(選用項目)。如果是已選取 VM。</span><span class="sxs-lookup"><span data-stu-id="ea94a-268">Optional, if it's already selected VMs.</span></span>

   <span data-ttu-id="ea94a-269">h.</span><span class="sxs-lookup"><span data-stu-id="ea94a-269">h.</span></span>  <span data-ttu-id="ea94a-270">以滑鼠右鍵按一下 [群組 1: 開始]  並按一下 [張貼動作]  選項，然後新增下列所有指令碼：</span><span class="sxs-lookup"><span data-stu-id="ea94a-270">Right click on **Group 1: Start** and click **Post action** option then add all the following scripts:</span></span>

   * <span data-ttu-id="ea94a-271">Start-StorSimple-Virtual-Appliance runbook</span><span class="sxs-lookup"><span data-stu-id="ea94a-271">Start-StorSimple-Virtual-Appliance runbook</span></span>
   * <span data-ttu-id="ea94a-272">Fail over-StorSimple-volume-containers runbook</span><span class="sxs-lookup"><span data-stu-id="ea94a-272">Fail over-StorSimple-volume-containers runbook</span></span>
   * <span data-ttu-id="ea94a-273">Mount-volumes-after-failover runbook</span><span class="sxs-lookup"><span data-stu-id="ea94a-273">Mount-volumes-after-failover runbook</span></span>
   * <span data-ttu-id="ea94a-274">Uninstall-custom-script-extension runbook</span><span class="sxs-lookup"><span data-stu-id="ea94a-274">Uninstall-custom-script-extension runbook</span></span>

   <span data-ttu-id="ea94a-275">i.</span><span class="sxs-lookup"><span data-stu-id="ea94a-275">i.</span></span>  <span data-ttu-id="ea94a-276">在相同的 [群組 1：後續步驟]  區段中，於上面 4 個指令碼之後，加入一個手動動作。</span><span class="sxs-lookup"><span data-stu-id="ea94a-276">Add a manual action after the above 4 scripts in the same **Group 1: Post-steps** section.</span></span> <span data-ttu-id="ea94a-277">這個動作是您可以確認所有項目都正確運作的點。</span><span class="sxs-lookup"><span data-stu-id="ea94a-277">This action is the point at which you can verify that everything is working correctly.</span></span> <span data-ttu-id="ea94a-278">只有在做為測試容錯移轉的一部份時，才需要新增這個動作 (所以只選取 [測試容錯移轉]  核取方塊)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-278">This action needs to be added only as a part of Test failover (so only select the **Test Failover** checkbox).</span></span>

   <span data-ttu-id="ea94a-279">j.</span><span class="sxs-lookup"><span data-stu-id="ea94a-279">j.</span></span>  <span data-ttu-id="ea94a-280">在執行手動動作之後，請使用您為其他 Runbook 使用的相同程序新增 **Cleanup** 指令碼。</span><span class="sxs-lookup"><span data-stu-id="ea94a-280">After the manual action, add the **Cleanup** script using the same procedure that you used for the other runbooks.</span></span> <span data-ttu-id="ea94a-281">儲存復原計劃。</span><span class="sxs-lookup"><span data-stu-id="ea94a-281">**Save** the recovery plan.</span></span>

    > [!NOTE]
    > <span data-ttu-id="ea94a-282">執行測試容錯移轉時，您應該在手動動作步驟中確認所有項目，因為已在目標裝置上複製的 StorSimple 磁碟區，將在手動動作完成之後於清除作業中一併刪除。</span><span class="sxs-lookup"><span data-stu-id="ea94a-282">When running a test failover, you should verify everything at the manual action step because the StorSimple volumes that had been cloned on the target device will be deleted as a part of the cleanup after the manual action is completed.</span></span>
    >

    ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image7.png)

## <a name="perform-a-test-failover"></a><span data-ttu-id="ea94a-283">執行測試容錯移轉</span><span class="sxs-lookup"><span data-stu-id="ea94a-283">Perform a test failover</span></span>
<span data-ttu-id="ea94a-284">請參閱 [Active Directory DR 解決方案](../site-recovery/site-recovery-active-directory.md) 附屬指南，以了解測試容錯移轉期間 Active Directory 的特定考量。</span><span class="sxs-lookup"><span data-stu-id="ea94a-284">Refer to the [Active Directory DR Solution](../site-recovery/site-recovery-active-directory.md) companion guide for considerations specific to Active Directory during the test failover.</span></span> <span data-ttu-id="ea94a-285">執行測試容錯移轉時，並不會干擾內部部署設定。</span><span class="sxs-lookup"><span data-stu-id="ea94a-285">The on-premises setup is not disturbed at all when the test failover occurs.</span></span> <span data-ttu-id="ea94a-286">已連結至內部部署 VM 的 StorSimple 磁碟區會複製到 Azure 上的 StorSimple Cloud Appliance。</span><span class="sxs-lookup"><span data-stu-id="ea94a-286">The StorSimple volumes that were attached to the on-premises VM are cloned to the StorSimple Cloud Appliance on Azure.</span></span> <span data-ttu-id="ea94a-287">Azure 中用於測試用途的 VM 會啟動，且雲端磁碟區也會連結至 VM。</span><span class="sxs-lookup"><span data-stu-id="ea94a-287">A VM for test purposes is brought up in Azure and the cloned volumes are attached to the VM.</span></span>

#### <a name="to-perform-the-test-failover"></a><span data-ttu-id="ea94a-288">執行測試容錯移轉</span><span class="sxs-lookup"><span data-stu-id="ea94a-288">To perform the test failover</span></span>
1. <span data-ttu-id="ea94a-289">在 Azure 入口網站中，選取您的站台復原保存庫。</span><span class="sxs-lookup"><span data-stu-id="ea94a-289">In the Azure portal, select your site recovery vault.</span></span>
2. <span data-ttu-id="ea94a-290">按一下為檔案伺服器 VM 建立的復原計劃。</span><span class="sxs-lookup"><span data-stu-id="ea94a-290">Click the recovery plan created for the file server VM.</span></span>
3. <span data-ttu-id="ea94a-291">按一下 [測試容錯移轉] 。</span><span class="sxs-lookup"><span data-stu-id="ea94a-291">Click **Test Failover**.</span></span>
4. <span data-ttu-id="ea94a-292">選取 Azure VM 在容錯移轉之後要連接的 Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="ea94a-292">Select the Azure virtual network to which Azure VMs will be connected after failover occurs.</span></span>

   ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image8.png)
5. <span data-ttu-id="ea94a-293">按一下 [確定]  即可開始容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ea94a-293">Click **OK** to begin the failover.</span></span> <span data-ttu-id="ea94a-294">您可以按一下 VM 以開啟其屬性，或在保存庫名稱 [作業]  [Site Recovery 作業] &gt;  &gt; 中的 [測試容錯移轉作業] 上按一下，來追蹤進度。</span><span class="sxs-lookup"><span data-stu-id="ea94a-294">You can track progress by clicking on the VM to open its properties, or on the **Test failover job** in vault name &gt; **Jobs** &gt; **Site Recovery jobs**.</span></span>
6. <span data-ttu-id="ea94a-295">容錯移轉完成之後，您應該也會看到複本 Azure 機器出現在 Azure 入口網站 > [虛擬機器] &gt;**中**。</span><span class="sxs-lookup"><span data-stu-id="ea94a-295">After the failover completes, you should also be able to see the replica Azure machine appear in the Azure portal &gt; **Virtual Machines**.</span></span> <span data-ttu-id="ea94a-296">您可以執行您的驗證。</span><span class="sxs-lookup"><span data-stu-id="ea94a-296">You can perform your validations.</span></span>
7. <span data-ttu-id="ea94a-297">驗證完成之後，按一下 [驗證完成] 。</span><span class="sxs-lookup"><span data-stu-id="ea94a-297">After the validations are done, click **Validations Complete**.</span></span> <span data-ttu-id="ea94a-298">此將清理 StorSimple Volumes 並將 StorSimple 雲端設備關機。</span><span class="sxs-lookup"><span data-stu-id="ea94a-298">This will cleanup the StorSimple Volumes and shutdown the StorSimple Cloud Appliance.</span></span>
8. <span data-ttu-id="ea94a-299">完成後，在復原方案上按一下 [清除測試容錯移轉]。</span><span class="sxs-lookup"><span data-stu-id="ea94a-299">Once you're done, click **Cleanup test failover** on the recovery plan.</span></span> <span data-ttu-id="ea94a-300">在 [記事] 中，記錄並儲存關於測試容錯移轉的任何觀察。</span><span class="sxs-lookup"><span data-stu-id="ea94a-300">In Notes record and save any observations associated with the test failover.</span></span> <span data-ttu-id="ea94a-301">此將刪除於測試容錯移轉中建立的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="ea94a-301">This will delete the virtual machine that were created during test failover.</span></span>

## <a name="perform-a-planned-failover"></a><span data-ttu-id="ea94a-302">執行計劃性容錯移轉</span><span class="sxs-lookup"><span data-stu-id="ea94a-302">Perform a planned failover</span></span>
   <span data-ttu-id="ea94a-303">在計劃性容錯移轉期間，內部部署檔案伺服器 VM 會正常關機，且會使用 StorSimple 裝置上磁碟區的雲端備份快照集。</span><span class="sxs-lookup"><span data-stu-id="ea94a-303">During a planned failover, the on-premises file server VM is shut down gracefully and a cloud backup snapshot of the volumes on StorSimple device is taken.</span></span> <span data-ttu-id="ea94a-304">StorSimple 磁碟區會容錯移轉至虛擬裝置，複本 VM 會在 Azure 上啟動，且磁碟區會連結至 VM。</span><span class="sxs-lookup"><span data-stu-id="ea94a-304">The StorSimple volumes are failed over to the virtual device, a replica VM is brought up on Azure, and the volumes are attached to the VM.</span></span>

#### <a name="to-perform-a-planned-failover"></a><span data-ttu-id="ea94a-305">執行計劃性容錯移轉</span><span class="sxs-lookup"><span data-stu-id="ea94a-305">To perform a planned failover</span></span>
1. <span data-ttu-id="ea94a-306">在 Azure 入口網站中，選取 [復原服務] 保存庫 &gt; [復原計劃 (站台復原)] &gt; [recoveryplan_name] ，以建立檔案伺服器 VM。</span><span class="sxs-lookup"><span data-stu-id="ea94a-306">In the Azure portal, select **Recovery services** vault &gt; **Recovery plans (Site recovery)** &gt; **recoveryplan_name** created for the file server VM.</span></span>
2. <span data-ttu-id="ea94a-307">在 [復原計劃] 刀鋒視窗上，按一下 [更多]  &gt; [計劃性容錯移轉] 。</span><span class="sxs-lookup"><span data-stu-id="ea94a-307">On the Recovery plan blade, Click **More** &gt;  **Planned failover**.</span></span>

   ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image9.png)
3. <span data-ttu-id="ea94a-308">在 [確認計劃性容錯移轉] 刀鋒視窗上，選擇來源位置和目標位置，然後選取目標網路並按一下核取圖示 ✓ 來啟動容錯移轉程序。</span><span class="sxs-lookup"><span data-stu-id="ea94a-308">On the **Confirm Planned Failover** blade, choose the source and target locations and select target network and click the check icon ✓ to start the failover process.</span></span>
4. <span data-ttu-id="ea94a-309">建立複本虛擬機器之後，它們即會處於認可擱置中的狀態。</span><span class="sxs-lookup"><span data-stu-id="ea94a-309">After replica virtual machines are created they're in a commit pending state.</span></span> <span data-ttu-id="ea94a-310">按一下 [認可]  以認可容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ea94a-310">Click **Commit** to commit the failover.</span></span>
5. <span data-ttu-id="ea94a-311">完成複寫之後，即會在次要位置上啟動虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="ea94a-311">After replication is complete, the virtual machines start up at the secondary location.</span></span>

## <a name="perform-a-failover"></a><span data-ttu-id="ea94a-312">執行容錯移轉</span><span class="sxs-lookup"><span data-stu-id="ea94a-312">Perform a failover</span></span>
<span data-ttu-id="ea94a-313">在非計劃性容錯移轉期間，StorSimple 磁碟區會容錯移轉至虛擬裝置，複本 VM 將在 Azure 上啟動，且磁碟區會連結至 VM。</span><span class="sxs-lookup"><span data-stu-id="ea94a-313">During an unplanned failover, the StorSimple volumes are failed over to the virtual device, a replica VM will be brought up on Azure, and the volumes are attached to the VM.</span></span>

#### <a name="to-perform-a-failover"></a><span data-ttu-id="ea94a-314">執行容錯移轉</span><span class="sxs-lookup"><span data-stu-id="ea94a-314">To perform a failover</span></span>
1. <span data-ttu-id="ea94a-315">在 Azure 入口網站中，選取 [復原服務] 保存庫 &gt; [復原計劃 (站台復原)] &gt; [recoveryplan_name] ，以建立檔案伺服器 VM。</span><span class="sxs-lookup"><span data-stu-id="ea94a-315">In the Azure portal, select **Recovery services** vault &gt; **Recovery plans (Site recovery)** &gt; **recoveryplan_name** created for the file server VM.</span></span>
2. <span data-ttu-id="ea94a-316">在 [復原計劃] 刀鋒視窗上，按一下 [更多]  &gt; [容錯移轉] 。</span><span class="sxs-lookup"><span data-stu-id="ea94a-316">On the Recovery plan blade, Click **More** &gt;  **Failover**.</span></span>
3. <span data-ttu-id="ea94a-317">在 [確認計劃性容錯移轉]  刀鋒視窗上，選擇來源與目標位置。</span><span class="sxs-lookup"><span data-stu-id="ea94a-317">On the **Confirm Failover** blade, choose the source and target locations.</span></span>
4. <span data-ttu-id="ea94a-318">選取 [關閉虛擬機器並同步處理最新資料]  ，來指定 Site Recovery 應嘗試關閉受保護的虛擬機器並同步處理資料，以便為最新的資料版本進行容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ea94a-318">Select **Shut down virtual machines and synchronize the latest data** to specify that Site Recovery should try to shut down the protected virtual machine and synchronize the data so that the latest version of the data will be failed over.</span></span>
5. <span data-ttu-id="ea94a-319">容錯移轉之後，虛擬機器就會處於 認可擱置中狀態。</span><span class="sxs-lookup"><span data-stu-id="ea94a-319">After the failover, the virtual machines are in a commit pending state.</span></span> <span data-ttu-id="ea94a-320">按一下 [認可]  以認可容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ea94a-320">Click **Commit** to commit the failover.</span></span>


## <a name="perform-a-failback"></a><span data-ttu-id="ea94a-321">執行容錯移轉</span><span class="sxs-lookup"><span data-stu-id="ea94a-321">Perform a failback</span></span>
<span data-ttu-id="ea94a-322">在容錯移轉期間，StorSimple 磁碟區容器會在使用備份之後容錯移轉回實體裝置。</span><span class="sxs-lookup"><span data-stu-id="ea94a-322">During a failback, StorSimple volume containers are failed over back to the physical device after a backup is taken.</span></span>

#### <a name="to-perform-a-failback"></a><span data-ttu-id="ea94a-323">執行容錯移轉</span><span class="sxs-lookup"><span data-stu-id="ea94a-323">To perform a failback</span></span>
1. <span data-ttu-id="ea94a-324">在 Azure 入口網站中，選取 [復原服務] 保存庫 &gt; [復原計劃 (站台復原)]  &gt; [recoveryplan_name] ，以建立檔案伺服器 VM。</span><span class="sxs-lookup"><span data-stu-id="ea94a-324">In the Azure portal, select **Recovery services** vault &gt; **Recovery plans (Site Recovery)** &gt; **recoveryplan_name** created for the file server VM.</span></span>
2. <span data-ttu-id="ea94a-325">在 [復原計劃] 刀鋒視窗上，按一下 [更多]  &gt; [計劃性容錯移轉] 。</span><span class="sxs-lookup"><span data-stu-id="ea94a-325">On the Recovery plan blade, Click **More** &gt;  **Planned Failover**.</span></span>
3. <span data-ttu-id="ea94a-326">選擇來源與目標位置，選取適當的資料同步處理和 VM 建立選項。</span><span class="sxs-lookup"><span data-stu-id="ea94a-326">Choose the source and target locations, select the appropriate Data synchronization and VM creation options.</span></span>
4. <span data-ttu-id="ea94a-327">按一下 [確定] 按鈕啟動容錯回復程序。</span><span class="sxs-lookup"><span data-stu-id="ea94a-327">Click **OK** button to start the failback process.</span></span>

   ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image10.png)

## <a name="best-practices"></a><span data-ttu-id="ea94a-328">最佳做法</span><span class="sxs-lookup"><span data-stu-id="ea94a-328">Best Practices</span></span>
### <a name="capacity-planning-and-readiness-assessment"></a><span data-ttu-id="ea94a-329">容量規劃和整備性評估</span><span class="sxs-lookup"><span data-stu-id="ea94a-329">Capacity planning and readiness assessment</span></span>
#### <a name="hyper-v-site"></a><span data-ttu-id="ea94a-330">Hyper-V 站台</span><span class="sxs-lookup"><span data-stu-id="ea94a-330">Hyper-V site</span></span>
<span data-ttu-id="ea94a-331">使用 [使用者容量規劃工具](http://www.microsoft.com/download/details.aspx?id=39057) 來為您的 Hyper-V 複本環境設計伺服器、儲存體及網路基礎結構。</span><span class="sxs-lookup"><span data-stu-id="ea94a-331">Use the [User Capacity planner tool](http://www.microsoft.com/download/details.aspx?id=39057) to design the server, storage, and network infrastructure for your Hyper-V replica environment.</span></span>

#### <a name="azure"></a><span data-ttu-id="ea94a-332">Azure</span><span class="sxs-lookup"><span data-stu-id="ea94a-332">Azure</span></span>
<span data-ttu-id="ea94a-333">您可以在 VM 上執行 [Azure 虛擬機器整備評估工具](http://azure.microsoft.com/downloads/vm-readiness-assessment/)，以確保它們相容於 Azure VM 與 Azure Site Recovery 服務。</span><span class="sxs-lookup"><span data-stu-id="ea94a-333">You can run the [Azure Virtual Machine Readiness Assessment tool](http://azure.microsoft.com/downloads/vm-readiness-assessment/) on VMs to ensure that they are compatible with Azure VMs and Azure Site Recovery Services.</span></span> <span data-ttu-id="ea94a-334">整備評估工具會檢查 VM 組態，並在組態與 Azure 不相容時提出警告。</span><span class="sxs-lookup"><span data-stu-id="ea94a-334">The Readiness Assessment Tool checks VM configurations and warns when configurations are incompatible with Azure.</span></span> <span data-ttu-id="ea94a-335">例如，如果 C: 磁碟大小超過 127 GB，它就會提出警告。</span><span class="sxs-lookup"><span data-stu-id="ea94a-335">For example, it issues a warning if a C: drive is larger than 127 GB.</span></span>

<span data-ttu-id="ea94a-336">容量規劃至少包含兩個重要程序：</span><span class="sxs-lookup"><span data-stu-id="ea94a-336">Capacity planning is made up of at least two important processes:</span></span>

* <span data-ttu-id="ea94a-337">將內部部署 Hyper-V VM 對應至 Azure VM 大小 (例如 A6、A7、A8 及 A9)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-337">Mapping on-premises Hyper-V VMs to Azure VM sizes (such as A6, A7, A8, and A9).</span></span>
* <span data-ttu-id="ea94a-338">判斷所需的網際網路頻寬。</span><span class="sxs-lookup"><span data-stu-id="ea94a-338">Determining the required Internet bandwidth.</span></span>

## <a name="limitations"></a><span data-ttu-id="ea94a-339">限制</span><span class="sxs-lookup"><span data-stu-id="ea94a-339">Limitations</span></span>
* <span data-ttu-id="ea94a-340">目前只有 1 部 StorSimple 裝置可以容錯移轉 (至單一 StorSimple Cloud Appliance)。</span><span class="sxs-lookup"><span data-stu-id="ea94a-340">Currently, only 1 StorSimple device can be failed over (to a single StorSimple Cloud Appliance).</span></span> <span data-ttu-id="ea94a-341">尚不支援跨越數部 StorSimple 裝置的檔案伺服器案例。</span><span class="sxs-lookup"><span data-stu-id="ea94a-341">The scenario of a file server that spans several StorSimple devices is not yet supported.</span></span>
* <span data-ttu-id="ea94a-342">如果您在啟用 VM 的保護時發生錯誤，請確定您已經中斷連線 iSCSI 目標。</span><span class="sxs-lookup"><span data-stu-id="ea94a-342">If you get an error while enabling protection for a VM, make sure that you have disconnected the iSCSI targets.</span></span>
* <span data-ttu-id="ea94a-343">已經因為備份原則跨越不同磁碟區容器而一起組成群組的所有磁碟區容器都會一起容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ea94a-343">All the volume containers that have been grouped together because of backup policies spanning across volume containers will be failed over together.</span></span>
* <span data-ttu-id="ea94a-344">磁碟區容器中您已經選擇的所有磁碟區都會容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="ea94a-344">All the volumes in the volume containers you have chosen will be failed over.</span></span>
* <span data-ttu-id="ea94a-345">加總後超過 64 TB 的磁碟區無法容錯移轉，因為單一 StorSimple Cloud Appliance 的容量上限為 64 TB。</span><span class="sxs-lookup"><span data-stu-id="ea94a-345">Volumes that add up to more than 64 TB can’t be failed over because the maximum capacity of a single StorSimple Cloud Appliance is 64 TB.</span></span>
* <span data-ttu-id="ea94a-346">如果計劃性/非計劃性容錯移轉失敗，且 Azure 中已經建立 VM，此時請勿清除 VM。</span><span class="sxs-lookup"><span data-stu-id="ea94a-346">If the planned/unplanned failover fails and the VMs are created in Azure, then do not clean up the VMs.</span></span> <span data-ttu-id="ea94a-347">請改為執行容錯回復。</span><span class="sxs-lookup"><span data-stu-id="ea94a-347">Instead, do a failback.</span></span> <span data-ttu-id="ea94a-348">如果您刪除 VM，就會無法再次開啟內部部署 VM。</span><span class="sxs-lookup"><span data-stu-id="ea94a-348">If you delete the VMs then the on-premises VMs cannot be turned on again.</span></span>
* <span data-ttu-id="ea94a-349">在容錯移轉之後，如果您看不到磁碟區，請移至 VM，開啟「磁碟管理」，重新掃描磁碟，然後讓磁碟上線。</span><span class="sxs-lookup"><span data-stu-id="ea94a-349">After a failover, if you are not able to see the volumes, go to the VMs, open Disk Management, rescan the disks, and then bring them online.</span></span>
* <span data-ttu-id="ea94a-350">在某些情況下，DR 網站中的磁碟機代號可能和內部部署的代號不同。</span><span class="sxs-lookup"><span data-stu-id="ea94a-350">In some instances, the drive letters in the DR site might be different than the letters on-premises.</span></span> <span data-ttu-id="ea94a-351">如果發生此情況，您必須在容錯移轉完成之後手動修正問題。</span><span class="sxs-lookup"><span data-stu-id="ea94a-351">If this occurs, you will need to manually correct the problem after the failover is finished.</span></span>
* <span data-ttu-id="ea94a-352">應針對在自動化帳戶中輸入做為資產的 Azure 認證停用多重要素驗證。</span><span class="sxs-lookup"><span data-stu-id="ea94a-352">Multi-factor authentication should be disabled for the Azure credential that is entered in the automation account as an asset.</span></span> <span data-ttu-id="ea94a-353">如果沒有停用此驗證，指令碼將無法自動執行，且復原計劃將會失敗。</span><span class="sxs-lookup"><span data-stu-id="ea94a-353">If this authentication is not disabled, scripts will not be allowed to run automatically and the recovery plan will fail.</span></span>
* <span data-ttu-id="ea94a-354">容錯移轉工作逾時：如果容錯移轉磁碟區容器時花費的時間超出每個指令碼的 Azure Site Recovery 限制 (目前為 120 分鐘)，StorSimple 指令碼將會逾時。</span><span class="sxs-lookup"><span data-stu-id="ea94a-354">Failover job timeout: The StorSimple script will time out if the failover of volume containers takes more time than the Azure Site Recovery limit per script (currently 120 minutes).</span></span>
* <span data-ttu-id="ea94a-355">備份工作逾時：如果備份磁碟區時花費的時間超出每個指令碼的 Azure Site Recovery 限制 (目前為 120 分鐘)，StorSimple 指令碼就會逾時。</span><span class="sxs-lookup"><span data-stu-id="ea94a-355">Backup job timeout: The StorSimple script times out if the backup of volumes takes more time than the Azure Site Recovery limit per script (currently 120 minutes).</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="ea94a-356">請從 Azure 入口網站手動執行備份，然後再執行一次復原計劃。</span><span class="sxs-lookup"><span data-stu-id="ea94a-356">Run the backup manually from the Azure portal and then run the recovery plan again.</span></span>

* <span data-ttu-id="ea94a-357">複製工作逾時：如果複製磁碟區時花費的時間超出每個指令碼的 Azure Site Recovery 限制 (目前為 120 分鐘)，StorSimple 指令碼就會逾時。</span><span class="sxs-lookup"><span data-stu-id="ea94a-357">Clone job timeout: The StorSimple script times out if the cloning of volumes takes more time than the Azure Site Recovery limit per script (currently 120 minutes).</span></span>
* <span data-ttu-id="ea94a-358">時間同步處理錯誤：StorSimple 指令碼發生錯誤並指出備份失敗，即使在入口網站中備份成功。</span><span class="sxs-lookup"><span data-stu-id="ea94a-358">Time synchronization error: The StorSimple scripts errors out saying that the backups were unsuccessful even though the backup is successful in the portal.</span></span> <span data-ttu-id="ea94a-359">發生此問題的可能原因或許是因為 StorSimple 設備的時間可能沒有和時區中目前的時間同步。</span><span class="sxs-lookup"><span data-stu-id="ea94a-359">A possible cause for this might be that the StorSimple appliance’s time might be out of sync with the current time in the time zone.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="ea94a-360">請將設備時間與時區中目前的時間同步。</span><span class="sxs-lookup"><span data-stu-id="ea94a-360">Sync the appliance time with the current time in the time zone.</span></span>

* <span data-ttu-id="ea94a-361">設備容錯移轉錯誤：如果復原計劃執行時有進行設備容錯移轉，StorSimple 指令碼可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="ea94a-361">Appliance failover error: The StorSimple script might fail if there is an appliance failover when the recovery plan is running.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="ea94a-362">請在設備容錯移轉完成後重新執行復原計劃。</span><span class="sxs-lookup"><span data-stu-id="ea94a-362">Rerun the recovery plan after the appliance failover is complete.</span></span>


## <a name="summary"></a><span data-ttu-id="ea94a-363">摘要</span><span class="sxs-lookup"><span data-stu-id="ea94a-363">Summary</span></span>
<span data-ttu-id="ea94a-364">使用 Azure Site Recovery 時，您可以為有檔案共用裝載於 StorSimple 儲存體上的檔案伺服器 VM 建立完整自動化的災害復原計劃。</span><span class="sxs-lookup"><span data-stu-id="ea94a-364">Using Azure Site Recovery, you can create a complete automated disaster recovery plan for a file server VM having file shares hosted on StorSimple storage.</span></span> <span data-ttu-id="ea94a-365">當發生中斷時，您可以在幾秒鐘內從任何地方起始容錯移轉，並且在數分鐘內啟動並執行應用程式。</span><span class="sxs-lookup"><span data-stu-id="ea94a-365">You can initiate the failover within seconds from anywhere in the event of a disruption and get the application up and running in a few minutes.</span></span>
