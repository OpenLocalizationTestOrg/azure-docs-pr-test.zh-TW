---
title: "Azure 自動化中的 Runbook 執行 | Microsoft Docs"
description: "描述如何處理 Azure 自動化中的 Runbook 的詳細資料。"
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: tysonn
ms.assetid: d10c8ce2-2c0b-4ea7-ba3c-d20e09b2c9ca
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/17/2017
ms.author: bwren
ms.openlocfilehash: 14f923e3f08dd3b286218ae56012ce14edcc4058
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="runbook-execution-in-azure-automation"></a><span data-ttu-id="eed2a-103">Azure 自動化中的 Runbook 執行</span><span class="sxs-lookup"><span data-stu-id="eed2a-103">Runbook execution in Azure Automation</span></span>
<span data-ttu-id="eed2a-104">當您在 Azure 自動化中啟動 Runbook 時即會建立一個工作。</span><span class="sxs-lookup"><span data-stu-id="eed2a-104">When you start a runbook in Azure Automation, a job is created.</span></span> <span data-ttu-id="eed2a-105">工作是 Runbook 的單一執行個體。</span><span class="sxs-lookup"><span data-stu-id="eed2a-105">A job is a single execution instance of a runbook.</span></span> <span data-ttu-id="eed2a-106">會指派 Azure 自動化背景工作，以執行每項工作。</span><span class="sxs-lookup"><span data-stu-id="eed2a-106">An Azure Automation worker is assigned to run each job.</span></span> <span data-ttu-id="eed2a-107">雖然背景工作是由多個 Azure 帳戶共用，來自不同自動化帳戶的工作會彼此隔離。</span><span class="sxs-lookup"><span data-stu-id="eed2a-107">While workers are shared by multiple Azure accounts, jobs from different Automation accounts are isolated from one another.</span></span> <span data-ttu-id="eed2a-108">您無法控制哪個背景工作要為您的作業要求提供服務。</span><span class="sxs-lookup"><span data-stu-id="eed2a-108">You do not have control over which worker services the request for your job.</span></span>  <span data-ttu-id="eed2a-109">單一 Runbook 一次可以執行多個工作。</span><span class="sxs-lookup"><span data-stu-id="eed2a-109">A single runbook can have multiple jobs running at one time.</span></span> <span data-ttu-id="eed2a-110">當您在 Azure 入口網站中檢視 Runbook 清單時，它會列出已針對每個 Runbook 啟動之所有作業的狀態。</span><span class="sxs-lookup"><span data-stu-id="eed2a-110">When you view the list of runbooks in the Azure portal, it lists the status of all jobs that were started for each runbook.</span></span> <span data-ttu-id="eed2a-111">您可以檢視每一個 Runbook工作的清單，以追蹤每個 Runbook 的狀態。</span><span class="sxs-lookup"><span data-stu-id="eed2a-111">You can view the list of jobs for each runbook in order to track the status of each.</span></span> <span data-ttu-id="eed2a-112">如需不同的工作狀態的描述，請參閱 [工作狀態](#job-statuses)。</span><span class="sxs-lookup"><span data-stu-id="eed2a-112">For a description of the different job statuses, see [Job Statuses](#job-statuses).</span></span>

<span data-ttu-id="eed2a-113">下圖顯示[圖形化 Runbook](automation-runbook-types.md#graphical-runbooks) 和 [PowerShell 工作流程 Runbook](automation-runbook-types.md#powershell-workflow-runbooks) 之 Runbook 作業的生命週期。</span><span class="sxs-lookup"><span data-stu-id="eed2a-113">The following diagram shows the lifecycle of a runbook job for [Graphical runbooks](automation-runbook-types.md#graphical-runbooks) and [PowerShell Workflow runbooks](automation-runbook-types.md#powershell-workflow-runbooks).</span></span>

![工作狀態 -PowerShell 工作流程](./media/automation-runbook-execution/job-statuses.png)

<span data-ttu-id="eed2a-115">下圖顯示 [PowerShell Runbook](automation-runbook-types.md#powershell-runbooks)之 Runbook 工作的生命週期。</span><span class="sxs-lookup"><span data-stu-id="eed2a-115">The following diagram shows the lifecycle of a runbook job for [PowerShell runbooks](automation-runbook-types.md#powershell-runbooks).</span></span>

![工作狀態 - PowerShell 指令碼](./media/automation-runbook-execution/job-statuses-script.png)

<span data-ttu-id="eed2a-117">藉由連線至您的 Azure 訂用帳戶，您的作業即可存取您的 Azure 資源。</span><span class="sxs-lookup"><span data-stu-id="eed2a-117">Your jobs have access to your Azure resources by making a connection to your Azure subscription.</span></span> <span data-ttu-id="eed2a-118">如果可從公用雲端存取這些資源，他們將只可以存取您的資料中心中的資源。</span><span class="sxs-lookup"><span data-stu-id="eed2a-118">They only have access to resources in your data center if those resources are accessible from the public cloud.</span></span>

## <a name="job-statuses"></a><span data-ttu-id="eed2a-119">工作狀態</span><span class="sxs-lookup"><span data-stu-id="eed2a-119">Job statuses</span></span>
<span data-ttu-id="eed2a-120">下表描述工作可能會有不同的狀態。</span><span class="sxs-lookup"><span data-stu-id="eed2a-120">The following table describes the different statuses that are possible for a job.</span></span>

| <span data-ttu-id="eed2a-121">Status</span><span class="sxs-lookup"><span data-stu-id="eed2a-121">Status</span></span> | <span data-ttu-id="eed2a-122">說明</span><span class="sxs-lookup"><span data-stu-id="eed2a-122">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="eed2a-123">Completed</span><span class="sxs-lookup"><span data-stu-id="eed2a-123">Completed</span></span> |<span data-ttu-id="eed2a-124">工作已成功完成。</span><span class="sxs-lookup"><span data-stu-id="eed2a-124">The job completed successfully.</span></span> |
| <span data-ttu-id="eed2a-125">Failed</span><span class="sxs-lookup"><span data-stu-id="eed2a-125">Failed</span></span> |<span data-ttu-id="eed2a-126">針對 [圖形化和 PowerShell 工作流程 Runbook](automation-runbook-types.md)，此 Runbook 無法編譯。</span><span class="sxs-lookup"><span data-stu-id="eed2a-126">For [Graphical and PowerShell Workflow runbooks](automation-runbook-types.md), the runbook failed to compile.</span></span>  <span data-ttu-id="eed2a-127">針對 [PowerShell 指令碼 Runbook](automation-runbook-types.md)，此 Runbook 無法啟動，或工作中發生例外狀況。</span><span class="sxs-lookup"><span data-stu-id="eed2a-127">For [PowerShell Script runbooks](automation-runbook-types.md), the runbook failed to start or the job encountered an exception.</span></span> |
| <span data-ttu-id="eed2a-128">處理失敗，正在等候資源</span><span class="sxs-lookup"><span data-stu-id="eed2a-128">Failed, waiting for resources</span></span> |<span data-ttu-id="eed2a-129">工作失敗，因為其達到 [公平共用](#fairshare) 的三次上限，且每次從相同的檢查點或啟動 Runbook 開始。</span><span class="sxs-lookup"><span data-stu-id="eed2a-129">The job failed because it reached the [fair share](#fairshare) limit three times and started from the same checkpoint or from the start of the runbook each time.</span></span> |
| <span data-ttu-id="eed2a-130">已排入佇列</span><span class="sxs-lookup"><span data-stu-id="eed2a-130">Queued</span></span> |<span data-ttu-id="eed2a-131">工作正在等候取得自動化背景工作中的資源，以便可啟動。</span><span class="sxs-lookup"><span data-stu-id="eed2a-131">The job is waiting for resources on an Automation worker to come available so that it can be started.</span></span> |
| <span data-ttu-id="eed2a-132">啟動中</span><span class="sxs-lookup"><span data-stu-id="eed2a-132">Starting</span></span> |<span data-ttu-id="eed2a-133">工作已指派給背景工作，並且系統正在進行啟動。</span><span class="sxs-lookup"><span data-stu-id="eed2a-133">The job has been assigned to a worker, and the system is in the process of starting it.</span></span> |
| <span data-ttu-id="eed2a-134">繼續中</span><span class="sxs-lookup"><span data-stu-id="eed2a-134">Resuming</span></span> |<span data-ttu-id="eed2a-135">工作暫停後，系統正在繼續工作。</span><span class="sxs-lookup"><span data-stu-id="eed2a-135">The system is in the process of resuming the job after it was suspended.</span></span> |
| <span data-ttu-id="eed2a-136">執行中</span><span class="sxs-lookup"><span data-stu-id="eed2a-136">Running</span></span> |<span data-ttu-id="eed2a-137">工作正在執行。</span><span class="sxs-lookup"><span data-stu-id="eed2a-137">The job is running.</span></span> |
| <span data-ttu-id="eed2a-138">執行中，正在等候資源</span><span class="sxs-lookup"><span data-stu-id="eed2a-138">Running, waiting for resources</span></span> |<span data-ttu-id="eed2a-139">工作已卸載，因為已達到 [公平共用](#fairshare) 上限。</span><span class="sxs-lookup"><span data-stu-id="eed2a-139">The job has been unloaded because it reached the [fair share](#fairshare) limit.</span></span> <span data-ttu-id="eed2a-140">作業很快會從其上一個檢查點繼續。</span><span class="sxs-lookup"><span data-stu-id="eed2a-140">It resumes shortly from its last checkpoint.</span></span> |
| <span data-ttu-id="eed2a-141">已停止</span><span class="sxs-lookup"><span data-stu-id="eed2a-141">Stopped</span></span> |<span data-ttu-id="eed2a-142">工作完成之前已由使用者停止。</span><span class="sxs-lookup"><span data-stu-id="eed2a-142">The job was stopped by the user before it was completed.</span></span> |
| <span data-ttu-id="eed2a-143">停止中</span><span class="sxs-lookup"><span data-stu-id="eed2a-143">Stopping</span></span> |<span data-ttu-id="eed2a-144">系統正在停止工作。</span><span class="sxs-lookup"><span data-stu-id="eed2a-144">The system is in the process of stopping the job.</span></span> |
| <span data-ttu-id="eed2a-145">暫止</span><span class="sxs-lookup"><span data-stu-id="eed2a-145">Suspended</span></span> |<span data-ttu-id="eed2a-146">工作已由使用者、系統或 Runbook 中的命令暫停。</span><span class="sxs-lookup"><span data-stu-id="eed2a-146">The job was suspended by the user, by the system, or by a command in the runbook.</span></span> <span data-ttu-id="eed2a-147">已暫停的作業可以再次啟動，並從其上一個檢查點，或從 Runbook 的開頭繼續 (若無檢查點)。</span><span class="sxs-lookup"><span data-stu-id="eed2a-147">A job that is suspended can be started again and resume from its last checkpoint or from the beginning of the runbook if it doesn't have checkpoints.</span></span> <span data-ttu-id="eed2a-148">只有在發生例外狀況時，系統才會暫停 Runbook。</span><span class="sxs-lookup"><span data-stu-id="eed2a-148">The runbook will only be suspended by the system when an exception occurs.</span></span> <span data-ttu-id="eed2a-149">根據預設，ErrorActionPreference 會設定為 [繼續]，代表作業會在發生錯誤時繼續執行。</span><span class="sxs-lookup"><span data-stu-id="eed2a-149">By default, ErrorActionPreference is set to **Continue**, meaning that the job keeps running on an error.</span></span> <span data-ttu-id="eed2a-150">如果此喜好設定變數設定為 [停止]，作業會在發生錯誤時暫停。</span><span class="sxs-lookup"><span data-stu-id="eed2a-150">If this preference variable is set to **Stop**, then the job suspends on an error.</span></span>  <span data-ttu-id="eed2a-151">只適用於 [圖形化和 PowerShell 工作流程 Runbook](automation-runbook-types.md) 。</span><span class="sxs-lookup"><span data-stu-id="eed2a-151">Applies to [Graphical and PowerShell Workflow runbooks](automation-runbook-types.md) only.</span></span> |
| <span data-ttu-id="eed2a-152">暫停中</span><span class="sxs-lookup"><span data-stu-id="eed2a-152">Suspending</span></span> |<span data-ttu-id="eed2a-153">因使用者要求，系統正在嘗試暫停工作。</span><span class="sxs-lookup"><span data-stu-id="eed2a-153">The system is attempting to suspend the job at the request of the user.</span></span> <span data-ttu-id="eed2a-154">Runbook 必須達到其下一個檢查點才能暫停。</span><span class="sxs-lookup"><span data-stu-id="eed2a-154">The runbook must reach its next checkpoint before it can be suspended.</span></span> <span data-ttu-id="eed2a-155">如果它已通過其最後一個檢查點，則可在暫停之前完成。</span><span class="sxs-lookup"><span data-stu-id="eed2a-155">If it already passed its last checkpoint, then it completes before it can be suspended.</span></span>  <span data-ttu-id="eed2a-156">只適用於 [圖形化和 PowerShell 工作流程 Runbook](automation-runbook-types.md) 。</span><span class="sxs-lookup"><span data-stu-id="eed2a-156">Applies to [Graphical and PowerShell Workflow runbooks](automation-runbook-types.md) only.</span></span> |

## <a name="viewing-job-status-from-the-azure-portal"></a><span data-ttu-id="eed2a-157">從 Azure 入口網站檢視作業狀態</span><span class="sxs-lookup"><span data-stu-id="eed2a-157">Viewing job status from the Azure portal</span></span>
<span data-ttu-id="eed2a-158">您可以檢視所有 Runbook 作業的摘要狀態，或在 Azure 入口網站中向下切入至特定 Runbook 作業的詳細資訊，或者藉由設定與您 Microsoft Operations Management Suite (OMS) Log Analytics 工作區的整合以轉送 Runbook 作業狀態和作業串流來加以檢視。</span><span class="sxs-lookup"><span data-stu-id="eed2a-158">You can view a summarized status of all runbook jobs or drill into details of a specific runbook job in the Azure portal or by configuring integration with your Microsoft Operations Management Suite (OMS) Log Analytics workspace to forward runbook job status and job streams.</span></span>  <span data-ttu-id="eed2a-159">如需與 OMS Log Analytics 整合的詳細資訊，請參閱[從自動化將作業狀態和作業串流轉送到 Log Analytics (OMS)](automation-manage-send-joblogs-log-analytics.md)。</span><span class="sxs-lookup"><span data-stu-id="eed2a-159">For more information about integrating with OMS Log Analytics, see [Forward job status and job streams from Automation to Log Analytics (OMS)](automation-manage-send-joblogs-log-analytics.md).</span></span>  

### <a name="automation-runbook-jobs-summary"></a><span data-ttu-id="eed2a-160">自動化 Runbook 作業摘要</span><span class="sxs-lookup"><span data-stu-id="eed2a-160">Automation runbook jobs summary</span></span>
<span data-ttu-id="eed2a-161">在所選自動化帳戶的右邊，您可以在 [作業統計資料] 圖格下方，看到所選自動化帳戶的所有 Runbook 作業摘要。</span><span class="sxs-lookup"><span data-stu-id="eed2a-161">On the right of your selected Automation account, you can see a summary of all of the runbook jobs for a selected Automation account under **Job Statistics** tile.</span></span><br><br> <span data-ttu-id="eed2a-162">![[作業統計資料] 圖格](./media/automation-runbook-execution/automation-account-job-status-summary.png)。</span><span class="sxs-lookup"><span data-stu-id="eed2a-162">![Job Statistics tile](./media/automation-runbook-execution/automation-account-job-status-summary.png).</span></span><br> <span data-ttu-id="eed2a-163">這個圖格會針對所有已執行的作業顯示作業狀態的計數和圖形表示。</span><span class="sxs-lookup"><span data-stu-id="eed2a-163">This tile displays a count and graphical representation of the job status for all jobs executed.</span></span>  

<span data-ttu-id="eed2a-164">按一下圖格，即會顯示 [作業] 刀鋒視窗，其中包含所有已執行作業的摘要清單，以及狀態、作業執行和開始與完成時間。</span><span class="sxs-lookup"><span data-stu-id="eed2a-164">Clicking on the tile presents the **Jobs** blade, which includes a summarized list of all jobs executed, with status, job execution, and start and completion times.</span></span><br><br> <span data-ttu-id="eed2a-165">![自動化帳戶的 [作業] 刀鋒視窗](./media/automation-runbook-execution/automation-account-jobs-status-blade.png)</span><span class="sxs-lookup"><span data-stu-id="eed2a-165">![Automation account Jobs blade](./media/automation-runbook-execution/automation-account-jobs-status-blade.png)</span></span><br><br>  <span data-ttu-id="eed2a-166">您可以篩選作業清單，方法是選取 [篩選作業]，然後篩選特定的 Runbook、作業狀態，或從下拉式清單中，選取要在其中進行搜尋的日期/時間範圍。</span><span class="sxs-lookup"><span data-stu-id="eed2a-166">You can filter the list of jobs by selecting **Filter jobs**  and filter on a specific runbook, job status, or from the drop-down list, the date/time range to search within.</span></span><br><br> <span data-ttu-id="eed2a-167">![篩選作業狀態](./media/automation-runbook-execution/automation-account-jobs-filter.png)</span><span class="sxs-lookup"><span data-stu-id="eed2a-167">![Filter Job status](./media/automation-runbook-execution/automation-account-jobs-filter.png)</span></span>

<span data-ttu-id="eed2a-168">或者，您可以檢視特定 Runbook 的作業摘要詳細資料，方法是在您的自動化帳戶中，從 [Runbook] 刀鋒視窗中選取該 Runbook，然後選取 [作業] 圖格。</span><span class="sxs-lookup"><span data-stu-id="eed2a-168">Alternatively, you can view job summary details for a specific runbook by selecting that runbook from the **Runbooks** blade in your Automation account, and then select the **Jobs** tile.</span></span>  <span data-ttu-id="eed2a-169">這會顯示 [作業] 刀鋒視窗，而您可以從此處按一下作業記錄，以檢視其詳細資料和輸出。</span><span class="sxs-lookup"><span data-stu-id="eed2a-169">This presents the **Jobs** blade, and from there you can click on the job record to view its detail and output.</span></span><br><br> <span data-ttu-id="eed2a-170">![自動化帳戶的 [作業] 刀鋒視窗](./media/automation-runbook-execution/automation-runbook-job-summary-blade.png)</span><span class="sxs-lookup"><span data-stu-id="eed2a-170">![Automation account Jobs blade](./media/automation-runbook-execution/automation-runbook-job-summary-blade.png)</span></span><br> 

### <a name="job-summary"></a><span data-ttu-id="eed2a-171">工作摘要</span><span class="sxs-lookup"><span data-stu-id="eed2a-171">Job Summary</span></span>
<span data-ttu-id="eed2a-172">您可以針對特定 Runbook 及其最新狀態，檢視所有已建立工作的清單。</span><span class="sxs-lookup"><span data-stu-id="eed2a-172">You can view a list of all of the jobs that have been created for a particular runbook and their most recent status.</span></span> <span data-ttu-id="eed2a-173">您可以依工作狀態和上次工作變更的日期範圍來篩選此清單。</span><span class="sxs-lookup"><span data-stu-id="eed2a-173">You can filter this list by job status and the range of dates for the last change to the job.</span></span> <span data-ttu-id="eed2a-174">若要檢視其詳細資訊和輸出，請按一下作業的名稱。</span><span class="sxs-lookup"><span data-stu-id="eed2a-174">To view its detailed information and output, click on the name of a job.</span></span> <span data-ttu-id="eed2a-175">工作的詳細檢視包含提供給該工作的 Runbook 參數值。</span><span class="sxs-lookup"><span data-stu-id="eed2a-175">The detailed view of the job includes the values for the runbook parameters that were provided to that job.</span></span>

<span data-ttu-id="eed2a-176">您可以使用下列步驟來檢視 Runbook 工作。</span><span class="sxs-lookup"><span data-stu-id="eed2a-176">You can use the following steps to view the jobs for a runbook.</span></span>

1. <span data-ttu-id="eed2a-177">在 Azure 入口網站中，選取 [自動化]，然後選取自動化帳戶的名稱。</span><span class="sxs-lookup"><span data-stu-id="eed2a-177">In the Azure portal, select **Automation** and then select the name of an Automation account.</span></span>
2. <span data-ttu-id="eed2a-178">從中樞選取 [Runbook]，然後在 [Runbook] 刀鋒視窗上選取清單中的 Runbook。</span><span class="sxs-lookup"><span data-stu-id="eed2a-178">From the hub, select **Runbooks** and then on the **Runbooks** blade select a runbook from the list.</span></span>
3. <span data-ttu-id="eed2a-179">在已選取 Runbook 的刀鋒視窗上，按一下 [作業] 圖格。</span><span class="sxs-lookup"><span data-stu-id="eed2a-179">On the blade for the selected runbook, click the **Jobs** tile.</span></span>
4. <span data-ttu-id="eed2a-180">按一下清單中的其中一個作業，然後在 [Runbook 作業詳細資料] 刀鋒視窗，您可以檢視其詳細資料與輸出。</span><span class="sxs-lookup"><span data-stu-id="eed2a-180">Click on one of the jobs in the list and on the runbook job details blade you can view its detail and output.</span></span>

## <a name="retrieving-job-status-using-windows-powershell"></a><span data-ttu-id="eed2a-181">使用 Windows PowerShell 擷取工作狀態</span><span class="sxs-lookup"><span data-stu-id="eed2a-181">Retrieving job status using Windows PowerShell</span></span>
<span data-ttu-id="eed2a-182">您可以使用 [Get-AzureRmAutomationJob](https://msdn.microsoft.com/library/mt619440.aspx)，來擷取針對 Runbook 建立的作業以及特定作業的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="eed2a-182">You can use the [Get-AzureRmAutomationJob](https://msdn.microsoft.com/library/mt619440.aspx) to retrieve the jobs created for a runbook and the details of a particular job.</span></span> <span data-ttu-id="eed2a-183">如果您使用 [Start-AzureRmAutomationRunbook](https://msdn.microsoft.com/library/mt603661.aspx)，透過 Windows PowerShell 來啟動 Runbook，則其會傳回產生的作業。</span><span class="sxs-lookup"><span data-stu-id="eed2a-183">If you start a runbook with Windows PowerShell using [Start-AzureRmAutomationRunbook](https://msdn.microsoft.com/library/mt603661.aspx), then it returns the resulting job.</span></span> <span data-ttu-id="eed2a-184">使用 [Get-AzureRmAutomationJob](https://msdn.microsoft.com/library/mt619440.aspx)Output 來取得作業的輸出。</span><span class="sxs-lookup"><span data-stu-id="eed2a-184">Use [Get-AzureRmAutomationJob](https://msdn.microsoft.com/library/mt619440.aspx)Output to get a job’s output.</span></span>

<span data-ttu-id="eed2a-185">下列範例命令會針對範例 Runbook 擷取上一個作業並顯示其狀態、提供給 Runbook 參數的值，以及來自作業的輸出。</span><span class="sxs-lookup"><span data-stu-id="eed2a-185">The following sample commands retrieve the last job for a sample runbook and displays its status, the values provided for the runbook parameters, and the output from the job.</span></span>

    $job = (Get-AzureRmAutomationJob –AutomationAccountName "MyAutomationAccount" `
    –RunbookName "Test-Runbook" -ResourceGroupName "ResourceGroup01" | sort LastModifiedDate –desc)[0]
    $job.Status
    $job.JobParameters
    Get-AzureRmAutomationJobOutput -ResourceGroupName "ResourceGroup01" `
    –AutomationAccountName "MyAutomationAcct" -Id $job.JobId –Stream Output

## <a name="fair-share"></a><span data-ttu-id="eed2a-186">公平共用</span><span class="sxs-lookup"><span data-stu-id="eed2a-186">Fair share</span></span>
<span data-ttu-id="eed2a-187">為了在雲端中的所有 Runbook 之間共用資源，「Azure 自動化」會在任何作業已執行 3 小時之後將其暫時卸載。</span><span class="sxs-lookup"><span data-stu-id="eed2a-187">In order to share resources among all runbooks in the cloud, Azure Automation will temporarily unload any job after it has been running for three hours.</span></span>  <span data-ttu-id="eed2a-188">在此期間，[以 PowerShell 為基礎的 Runbook](automation-runbook-types.md#powershell-runbooks) 的作業會停止，而且不會重新啟動。</span><span class="sxs-lookup"><span data-stu-id="eed2a-188">During this time, jobs for [PowerShell-based runbooks](automation-runbook-types.md#powershell-runbooks) are stopped and will not be restarted.</span></span>  <span data-ttu-id="eed2a-189">作業狀態顯示 [已停止]。</span><span class="sxs-lookup"><span data-stu-id="eed2a-189">The job status shows **Stopped**.</span></span>  <span data-ttu-id="eed2a-190">這類型的 Runbook 一律會從頭重新啟動，因為它們不支援檢查點。</span><span class="sxs-lookup"><span data-stu-id="eed2a-190">This type of runbook is always restarted from the beginning since they don't support checkpoints.</span></span>  

<span data-ttu-id="eed2a-191">[以 PowerShell 工作流程為基礎的 Runbook](automation-runbook-types.md#powershell-workflow-runbooks) 將會從其最後一個[檢查點](https://docs.microsoft.com/system-center/sma/overview-powershell-workflows#bk_Checkpoints)繼續。</span><span class="sxs-lookup"><span data-stu-id="eed2a-191">[PowerShell-Workflow-based runbooks](automation-runbook-types.md#powershell-workflow-runbooks) will be resumed from their last [checkpoint](https://docs.microsoft.com/system-center/sma/overview-powershell-workflows#bk_Checkpoints).</span></span>  <span data-ttu-id="eed2a-192">執行三個小時之後，服務將會暫停 Runbook 作業，而其狀態顯示 [執行中，等待資源]。</span><span class="sxs-lookup"><span data-stu-id="eed2a-192">After running three hours, the runbook job will be suspended by the service and its status shows **Running, waiting for resources**.</span></span>  <span data-ttu-id="eed2a-193">當沙箱可以使用時，自動化服務會自動重新啟動 Runbook 並從最後一個檢查點繼續。</span><span class="sxs-lookup"><span data-stu-id="eed2a-193">When a sandbox becomes available, the runbook will be automatically restarted by the Automation service and resumes from the last checkpoint.</span></span>  <span data-ttu-id="eed2a-194">這是 PowerShell 工作流程的正常暫停/重新啟動行為。</span><span class="sxs-lookup"><span data-stu-id="eed2a-194">This is normal PowerShell-Workflow behavior for suspend/restart.</span></span>  <span data-ttu-id="eed2a-195">如果 Runbook 再次超過三個小時的執行階段，此程序會重複 (最多三次)。</span><span class="sxs-lookup"><span data-stu-id="eed2a-195">If the runbook again exceeds three hours of runtime, the process repeats, up to three times.</span></span>  <span data-ttu-id="eed2a-196">在第三次重新啟動之後，如果 Runbook 仍未在三小時內完成，則 Runbook 作業會失敗，而作業狀態會顯示 [失敗，等待資源]。</span><span class="sxs-lookup"><span data-stu-id="eed2a-196">After the third restart, if the runbook still has not completed in three hours, then the runbook job is failed, and the job status shows **Failed, waiting for resources**.</span></span>  <span data-ttu-id="eed2a-197">在此情況下，您會收到下列失敗例外狀況。</span><span class="sxs-lookup"><span data-stu-id="eed2a-197">In this case, you receive the following exception with the failure.</span></span>

<span data-ttu-id="eed2a-198">*作業無法繼續執行，因為已從相同的檢查點重複收回該作業。請確定您的 Runbook 在未保存其狀態的情況下，不會長時間執行作業。*</span><span class="sxs-lookup"><span data-stu-id="eed2a-198">*The job cannot continue running because it was repeatedly evicted from the same checkpoint. Please make sure your Runbook does not perform lengthy operations without persisting its state.*</span></span>

<span data-ttu-id="eed2a-199">這是為了防止服務無限期地執行 Runbook 而不會完成，因為它們在未重新卸載的情況下，無法進入下一個檢查點。</span><span class="sxs-lookup"><span data-stu-id="eed2a-199">This is to protect the service from runbooks running indefinitely without completing, as they are not able to make it to the next checkpoint without being unloaded again.</span></span>

<span data-ttu-id="eed2a-200">如果 Runbook 沒有檢查點，或作業在卸載之前未到達第一個檢查點，則會從頭重新啟動。</span><span class="sxs-lookup"><span data-stu-id="eed2a-200">If the runbook has no checkpoints or the job had not reached the first checkpoint before being unloaded, then it restarts from the beginning.</span></span>  

<span data-ttu-id="eed2a-201">建立 Runbook 時，您應該確定在兩個檢查點之間執行的任何活動的時間不會超過 3 小時。</span><span class="sxs-lookup"><span data-stu-id="eed2a-201">When you create a runbook, you should ensure that the time to run any activities between two checkpoints does not exceed three hours.</span></span> <span data-ttu-id="eed2a-202">您可能需要在您的 Runbook 中新增檢查點，以確保它不會達到此 3 小時的限制或中斷長時間執行的作業。</span><span class="sxs-lookup"><span data-stu-id="eed2a-202">You may need to add checkpoints to your runbook to ensure that it does not reach this three hour limit or break up long running operations.</span></span> <span data-ttu-id="eed2a-203">例如，您的 Runbook 可能在大型 SQL 資料庫上執行重新索引。</span><span class="sxs-lookup"><span data-stu-id="eed2a-203">For example, your runbook might perform a reindex on a large SQL database.</span></span> <span data-ttu-id="eed2a-204">如果此單一作業未在公平共用的限制內完成，則會卸載作業並從頭開始重新啟動。</span><span class="sxs-lookup"><span data-stu-id="eed2a-204">If this single operation does not complete within the fair share limit, then the job are unloaded and restarted from the beginning.</span></span> <span data-ttu-id="eed2a-205">在此情況下，您應該將重新索引作業分成多個步驟，例如一次重新索引一個資料表，然後在每個作業之後插入檢查點，讓工作可以在最後一個作業完成後繼續。</span><span class="sxs-lookup"><span data-stu-id="eed2a-205">In this case, you should break up the reindex operation into multiple steps, such as reindexing one table at a time, and then insert a checkpoint after each operation so that the job could resume after the last operation to complete.</span></span>

## <a name="next-steps"></a><span data-ttu-id="eed2a-206">後續步驟</span><span class="sxs-lookup"><span data-stu-id="eed2a-206">Next steps</span></span>
* <span data-ttu-id="eed2a-207">若要深入了解可在 Azure 自動化中用來啟動 Runbook 的不同方法，請參閱[在 Azure 自動化中啟動 Runbook](automation-starting-a-runbook.md)</span><span class="sxs-lookup"><span data-stu-id="eed2a-207">To learn more about the different methods that can be used to start a runbook in Azure Automation, see [Starting a runbook in Azure Automation](automation-starting-a-runbook.md)</span></span>

