---
title: "aaaAzure 自動化 DSC 連續部署 Chocolatey |Microsoft 文件"
description: "使用 Azure 自動化 DSC 和 Chocolatey 封裝管理員執行 DevOps 持續部署。  具有完整 JSON ARM 範本與 PowerShell 原始檔的範例。"
services: automation
documentationcenter: 
author: eslesar
manager: carmonm
editor: tysonn
ms.assetid: c0baa411-eb76-4f91-8d14-68f68b4805b6
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: na
ms.date: 10/29/2016
ms.author: golive
ms.openlocfilehash: 60af52af5f834fd48e3a0dc4677919397b53f0f4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="usage-example-continuous-deployment-toovirtual-machines-using-automation-dsc-and-chocolatey"></a><span data-ttu-id="f362e-104">使用範例： 連續部署 tooVirtual 的電腦上使用 Automation DSC 和 Chocolatey</span><span class="sxs-lookup"><span data-stu-id="f362e-104">Usage Example: Continuous deployment tooVirtual Machines using Automation DSC and Chocolatey</span></span>
<span data-ttu-id="f362e-105">DevOps 世界中有許多工具 tooassist 與 hello 連續整合管線中的各種點。</span><span class="sxs-lookup"><span data-stu-id="f362e-105">In a DevOps world there are many tools tooassist with various points in hello Continuous Integration pipeline.</span></span>  <span data-ttu-id="f362e-106">Azure 自動化 Desired State Configuration (DSC) 是  褖畫惎新加法 toohello 選項可以採用 DevOps 小組。</span><span class="sxs-lookup"><span data-stu-id="f362e-106">Azure Automation Desired State Configuration (DSC) is a welcome new addition toohello options that DevOps teams can employ.</span></span>  <span data-ttu-id="f362e-107">本文示範如何為 Windows 電腦設定持續部署 (CD)。</span><span class="sxs-lookup"><span data-stu-id="f362e-107">This article demonstrates setting up Continuous Deployment (CD) for a Windows computer.</span></span>  <span data-ttu-id="f362e-108">您可以輕鬆地擴充 hello 技術 tooinclude 視 hello 角色 （該網站，例如），並從該處 tooadditional 一樣多的 Windows 電腦以及角色。</span><span class="sxs-lookup"><span data-stu-id="f362e-108">You can easily extend hello technique tooinclude as many Windows computers as necessary in hello role (a web site, for example), and from there tooadditional roles as well.</span></span>

![IaaS VM 的持續部署](./media/automation-dsc-cd-chocolatey/cdforiaasvm.png)

## <a name="at-a-high-level"></a><span data-ttu-id="f362e-110">概括而言</span><span class="sxs-lookup"><span data-stu-id="f362e-110">At a high level</span></span>
<span data-ttu-id="f362e-111">這裡要進行的事項很多，幸好，大致上可分成兩個主要程序：</span><span class="sxs-lookup"><span data-stu-id="f362e-111">There is quite a bit going on here, but fortunately it can be broken into two main processes:</span></span> 

* <span data-ttu-id="f362e-112">撰寫程式碼以及測試、 建立和發行 hello 系統的主要和次要版本的安裝套件。</span><span class="sxs-lookup"><span data-stu-id="f362e-112">Writing code and testing it, then creating and publishing installation packages for major and minor versions of hello system.</span></span> 
* <span data-ttu-id="f362e-113">建立和管理 Vm 將安裝及執行 hello 封裝中的 hello 程式碼。</span><span class="sxs-lookup"><span data-stu-id="f362e-113">Creating and managing VMs that will install and execute hello code in hello packages.</span></span>  

<span data-ttu-id="f362e-114">一旦這些核心程序都備妥，就會是簡短步驟 tooautomatically 更新 hello 封裝建立和部署新版本時，任何特定 VM 上執行。</span><span class="sxs-lookup"><span data-stu-id="f362e-114">Once both of these core processes are in place, it’s a short step tooautomatically update hello package running on any particular VM as new versions are created and deployed.</span></span>

## <a name="component-overview"></a><span data-ttu-id="f362e-115">元件概觀</span><span class="sxs-lookup"><span data-stu-id="f362e-115">Component overview</span></span>
<span data-ttu-id="f362e-116">例如，封裝管理員[apt get](https://en.wikipedia.org/wiki/Advanced_Packaging_Tool)位於相當已知 hello Linux 世界中，但卻未這麼 hello Windows 世界中。</span><span class="sxs-lookup"><span data-stu-id="f362e-116">Package managers such as [apt-get](https://en.wikipedia.org/wiki/Advanced_Packaging_Tool) are pretty well known in hello Linux world, but not so much in hello Windows world.</span></span>  <span data-ttu-id="f362e-117">[Chocolatey](https://chocolatey.org/)是這類的作業和 Scott Hanselman[部落格](http://www.hanselman.com/blog/IsTheWindowsUserReadyForAptget.aspx)hello 上主題是絕佳的簡介。</span><span class="sxs-lookup"><span data-stu-id="f362e-117">[Chocolatey](https://chocolatey.org/) is such a thing, and Scott Hanselman’s [blog](http://www.hanselman.com/blog/IsTheWindowsUserReadyForAptget.aspx) on hello topic is a great intro.</span></span>  <span data-ttu-id="f362e-118">簡而言之，Chocolatey 可讓您 tooinstall 套件從套件的中央儲存機制使用 hello 命令列的 Windows 系統。</span><span class="sxs-lookup"><span data-stu-id="f362e-118">In a nutshell, Chocolatey allows you tooinstall packages from a central repository of packages into a Windows system using hello command line.</span></span>  <span data-ttu-id="f362e-119">您可以建立和管理您自己的儲存機制，而 Chocolatey 可以從您指定的任何數量的儲存機制來安裝封裝。</span><span class="sxs-lookup"><span data-stu-id="f362e-119">You can create and manage your own repository, and Chocolatey can install packages from any number of repositories that you designate.</span></span>

<span data-ttu-id="f362e-120">預期狀態設定 (DSC) ([概觀](https://technet.microsoft.com/library/dn249912.aspx)) 是一種 PowerShell 工具，可讓您 toodeclare hello 組態所要的電腦。</span><span class="sxs-lookup"><span data-stu-id="f362e-120">Desired State Configuration (DSC) ([overview](https://technet.microsoft.com/library/dn249912.aspx)) is a PowerShell tool that allows you toodeclare hello configuration that you want for a machine.</span></span>  <span data-ttu-id="f362e-121">例如，您可以說「我想要安裝 Chocolatey、我想要安裝 IIS、我想要開啟連接埠 80、我想要安裝網站 1.0.0 版」。</span><span class="sxs-lookup"><span data-stu-id="f362e-121">For example, you can say, “I want Chocolatey installed, I want IIS installed, I want port 80 opened, I want version 1.0.0 of my website installed.”</span></span>  <span data-ttu-id="f362e-122">hello DSC 本機設定管理員 (LCM) 實作該組態。</span><span class="sxs-lookup"><span data-stu-id="f362e-122">hello DSC Local Configuration Manager (LCM) implements that configuration.</span></span> <span data-ttu-id="f362e-123">DSC 提取伺服器有一個儲存機制保存您電腦的組態。</span><span class="sxs-lookup"><span data-stu-id="f362e-123">A DSC Pull Server holds a repository of configurations for your machines.</span></span> <span data-ttu-id="f362e-124">如果其組態符合 hello 儲存的組態中定期 toosee 會檢查每部機器上的 LCM hello。</span><span class="sxs-lookup"><span data-stu-id="f362e-124">hello LCM on each machine checks in periodically toosee if its configuration matches hello stored configuration.</span></span> <span data-ttu-id="f362e-125">它可以報告的狀態，或嘗試 toobring hello 機器回負有 hello 儲存的組態。</span><span class="sxs-lookup"><span data-stu-id="f362e-125">It can either report status or attempt toobring hello machine back into alignment with hello stored configuration.</span></span> <span data-ttu-id="f362e-126">您可以編輯 hello 預存的組態在 hello 提取伺服器 toocause 機器或機器 toocome 一組負有 hello 變更組態。</span><span class="sxs-lookup"><span data-stu-id="f362e-126">You can edit hello stored configuration on hello pull server toocause a machine or set of machines toocome into alignment with hello changed configuration.</span></span>

<span data-ttu-id="f362e-127">Azure 自動化是 Microsoft azure 可讓您 tooautomate 各種工作，使用 runbook、 節點、 認證、 資源和資產，例如排程和全域變數中受管理的服務。</span><span class="sxs-lookup"><span data-stu-id="f362e-127">Azure Automation is a managed service in Microsoft Azure that allows you tooautomate various tasks using runbooks, nodes, credentials, resources and assets such as schedules and global variables.</span></span> <span data-ttu-id="f362e-128">Azure 自動化 DSC 擴充功能 tooinclude PowerShell DSC 工具的這項自動化。</span><span class="sxs-lookup"><span data-stu-id="f362e-128">Azure Automation DSC extends this automation capability tooinclude PowerShell DSC tools.</span></span>  <span data-ttu-id="f362e-129">以下提供清楚的 [概觀](automation-dsc-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="f362e-129">Here’s a great [overview](automation-dsc-overview.md).</span></span>

<span data-ttu-id="f362e-130">DSC 資源是具有特定功能的程式碼模組，例如管理網路、Active Directory 或 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="f362e-130">A DSC Resource is a module of code that has specific capabilities, such as managing networking, Active Directory, or SQL Server.</span></span>  <span data-ttu-id="f362e-131">hello Chocolatey DSC 資源知道如何 tooaccess NuGet 伺服器 （和其他項目），下載的封裝、 安裝封裝，等等。</span><span class="sxs-lookup"><span data-stu-id="f362e-131">hello Chocolatey DSC Resource knows how tooaccess a NuGet Server (among others), download packages, install packages, and so on.</span></span>  <span data-ttu-id="f362e-132">Hello 中有許多其他的 DSC 資源[PowerShell 資源庫](http://www.powershellgallery.com/packages?q=dsc+resources&prerelease=&sortOrder=package-title)。</span><span class="sxs-lookup"><span data-stu-id="f362e-132">There are many other DSC Resources in hello [PowerShell Gallery](http://www.powershellgallery.com/packages?q=dsc+resources&prerelease=&sortOrder=package-title).</span></span>  <span data-ttu-id="f362e-133">這些模組安裝到您的 Azure 自動化 DSC 提取伺服器 (由您安裝)，供您的組態使用。</span><span class="sxs-lookup"><span data-stu-id="f362e-133">These modules are installed into your Azure Automation DSC Pull Server (by you) so they can be used by your configurations.</span></span>

<span data-ttu-id="f362e-134">Resource Manager 範本以宣告方式產生基礎結構，例如網路、子網路、網路安全性和路由、負載平衡器、NIC、VM...等等。</span><span class="sxs-lookup"><span data-stu-id="f362e-134">Resource Manager templates provide a declarative way of generating your infrastructure - things like networks, subnets, network security and routing, load balancers, NICs, VMs, and so on.</span></span>  <span data-ttu-id="f362e-135">以下是[文章](../azure-resource-manager/resource-manager-deployment-model.md)比較 hello Resource Manager 部署模型 （宣告式），以 hello Azure 服務管理 （ASM 或傳統） 部署模型 （必要），並討論 hello 核心資源提供者、 計算，儲存體和網路。</span><span class="sxs-lookup"><span data-stu-id="f362e-135">Here’s an [article](../azure-resource-manager/resource-manager-deployment-model.md) that compares hello Resource Manager deployment model (declarative) with hello Azure Service Management (ASM, or classic) deployment model (imperative), and discusses hello core resource providers, compute, storage and network.</span></span>

<span data-ttu-id="f362e-136">資源管理員範本的一項重要功能已佈建為其能力 tooinstall 到 hello VM 的 VM 延伸模組。</span><span class="sxs-lookup"><span data-stu-id="f362e-136">One key feature of an Resource Manager template is its ability tooinstall a VM extension into hello VM as it’s provisioned.</span></span>  <span data-ttu-id="f362e-137">VM 延伸模組具有特定功能，例如執行自訂指令碼、安裝防毒軟體或執行 DSC 組態指令碼。</span><span class="sxs-lookup"><span data-stu-id="f362e-137">A VM extension has specific capabilities such as running a custom script, installing anti-virus software, or running a DSC configuration script.</span></span>  <span data-ttu-id="f362e-138">有許多其他類型的 VM 延伸模組。</span><span class="sxs-lookup"><span data-stu-id="f362e-138">There are many other types of VM extensions.</span></span>

## <a name="quick-trip-around-hello-diagram"></a><span data-ttu-id="f362e-139">快速路線 hello 圖表</span><span class="sxs-lookup"><span data-stu-id="f362e-139">Quick trip around hello diagram</span></span>
<span data-ttu-id="f362e-140">在 hello 最上方開始，撰寫程式碼、 建置及測試，然後建立安裝套件。</span><span class="sxs-lookup"><span data-stu-id="f362e-140">Starting at hello top, you write your code, build and test, then create an installation package.</span></span>  <span data-ttu-id="f362e-141">Chocolatey 可以處理各種類型的安裝封裝，例如 MSI、MSU、ZIP 等。</span><span class="sxs-lookup"><span data-stu-id="f362e-141">Chocolatey can handle various types of installation packages, such as MSI, MSU, ZIP.</span></span>  <span data-ttu-id="f362e-142">而且您擁有 hello 的 PowerShell toodo hello 實際安裝的完整功能，如果 Chocolatey 的原生功能相當不 tooit。</span><span class="sxs-lookup"><span data-stu-id="f362e-142">And you have hello full power of PowerShell toodo hello actual installation if Chocolatey’s native capabilities aren’t quite up tooit.</span></span>  <span data-ttu-id="f362e-143">將 hello 封裝放入某個位置連線 – 封裝儲存機制。</span><span class="sxs-lookup"><span data-stu-id="f362e-143">Put hello package into someplace reachable – a package repository.</span></span>  <span data-ttu-id="f362e-144">這個使用範例使用 Azure blob 儲存體帳戶中的公用資料夾，但可以是任何位置。</span><span class="sxs-lookup"><span data-stu-id="f362e-144">This usage example uses a public folder in an Azure blob storage account, but it can be anywhere.</span></span>  <span data-ttu-id="f362e-145">Chocolatey 可自然搭配 NuGet 伺服器和其他一些工具，一起管理封裝中繼資料。</span><span class="sxs-lookup"><span data-stu-id="f362e-145">Chocolatey works natively with NuGet servers and a few others for management of package metadata.</span></span>  <span data-ttu-id="f362e-146">[這篇文章](https://github.com/chocolatey/choco/wiki/How-To-Host-Feed)描述 hello 選項。</span><span class="sxs-lookup"><span data-stu-id="f362e-146">[This article](https://github.com/chocolatey/choco/wiki/How-To-Host-Feed) describes hello options.</span></span>  <span data-ttu-id="f362e-147">這個使用範例使用 NuGet。</span><span class="sxs-lookup"><span data-stu-id="f362e-147">This usage example uses NuGet.</span></span>  <span data-ttu-id="f362e-148">Nuspec 是封裝的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="f362e-148">A Nuspec is metadata about your packages.</span></span>  <span data-ttu-id="f362e-149">hello Nuspec"編譯 」 成 NuPkg 的而且儲存在 NuGet 伺服器。</span><span class="sxs-lookup"><span data-stu-id="f362e-149">hello Nuspec’s are “compiled” into NuPkg’s and stored in a NuGet server.</span></span>  <span data-ttu-id="f362e-150">當您的設定要求套件的名稱，參考的 NuGet 伺服器 hello Chocolatey DSC 資源 （現在在 hello VM) grabs 示範的 hello 封裝，並將它安裝為您。</span><span class="sxs-lookup"><span data-stu-id="f362e-150">When your configuration requests a package by name, and references a NuGet server, hello Chocolatey DSC Resource (now on hello VM) grabs hello package and installs it for you.</span></span>  <span data-ttu-id="f362e-151">您也可以要求特定版本的封裝。</span><span class="sxs-lookup"><span data-stu-id="f362e-151">You can also request a specific version of a package.</span></span>

<span data-ttu-id="f362e-152">Hello 左下方 hello 圖片，在沒有 Azure 資源管理員 (ARM) 範本。</span><span class="sxs-lookup"><span data-stu-id="f362e-152">In hello bottom left portion of hello picture, there is an Azure Resource Manager (ARM) template.</span></span>  <span data-ttu-id="f362e-153">在此使用方式範例中，hello VM 延伸模組會註冊 hello VM 以 hello Azure Automation DSC 提取伺服器 （也就是提取伺服器） 做為節點。</span><span class="sxs-lookup"><span data-stu-id="f362e-153">In this usage example, hello VM extension registers hello VM with hello Azure Automation DSC Pull Server (that is, a pull server) as a Node.</span></span>  <span data-ttu-id="f362e-154">hello 組態儲存在 hello 提取伺服器。</span><span class="sxs-lookup"><span data-stu-id="f362e-154">hello configuration is stored in hello pull server.</span></span>  <span data-ttu-id="f362e-155">實際上儲存兩次：一次儲存為純文字，另一次編譯成 MOF 檔案 (適用於對此有所瞭解的人。)在 hello 入口網站 hello MOF 為 「 節點設定 」 （相對於 toosimply 「 設定 」)。</span><span class="sxs-lookup"><span data-stu-id="f362e-155">Actually, it’s stored twice: once as plain text and once compiled as an MOF file (for those that know about such things.)  In hello portal, hello MOF is a “node configuration” (as opposed toosimply “configuration”).</span></span>  <span data-ttu-id="f362e-156">它的 hello 成品所知 hello 節點將其設定與節點相關聯。</span><span class="sxs-lookup"><span data-stu-id="f362e-156">It’s hello artifact that’s associated with a Node so hello node will know its configuration.</span></span>  <span data-ttu-id="f362e-157">下列詳細資料會顯示如何 tooassign hello 節點組態 toohello 節點。</span><span class="sxs-lookup"><span data-stu-id="f362e-157">Details below show how tooassign hello node configuration toohello node.</span></span>

<span data-ttu-id="f362e-158">假定您已進行 hello 元 hello 頂端或大部分。</span><span class="sxs-lookup"><span data-stu-id="f362e-158">Presumably you’re already doing hello bit at hello top, or most of it.</span></span>  <span data-ttu-id="f362e-159">小型的項目是建立 hello nuspec、 編譯，以及將其儲存至 NuGet 伺服器。</span><span class="sxs-lookup"><span data-stu-id="f362e-159">Creating hello nuspec, compiling and storing it in a NuGet server is a small thing.</span></span>  <span data-ttu-id="f362e-160">您已經在管理 VM。</span><span class="sxs-lookup"><span data-stu-id="f362e-160">And you’re already managing VMs.</span></span>  <span data-ttu-id="f362e-161">取得下一個步驟 toocontinuous 部署 hello 需要設定 hello 提取伺服器 （一次），註冊您的節點與其 （一次），並建立及儲存 hello 組態那里 （一開始）。</span><span class="sxs-lookup"><span data-stu-id="f362e-161">Taking hello next step toocontinuous deployment requires setting up hello pull server (once), registering your nodes with it (once), and creating and storing hello configuration there (initially).</span></span>  <span data-ttu-id="f362e-162">然後當升級封裝，而且部署 toohello 儲存機制上，重新整理 hello 組態和節點組態 hello 提取伺服器 （視需要重複）。</span><span class="sxs-lookup"><span data-stu-id="f362e-162">Then as packages are upgraded and deployed toohello repository, refresh hello Configuration and Node Configuration in hello pull server (repeat as needed).</span></span>

<span data-ttu-id="f362e-163">如果不是從 ARM 範本開始，也沒關係。</span><span class="sxs-lookup"><span data-stu-id="f362e-163">If you’re not starting with an ARM template, that’s also OK.</span></span>  <span data-ttu-id="f362e-164">有 PowerShell cmdlet 設計 toohelp hello 提取伺服器與所有 hello rest 中都註冊您的 Vm。</span><span class="sxs-lookup"><span data-stu-id="f362e-164">There are PowerShell cmdlets designed toohelp you register your VMs with hello pull server and all of hello rest.</span></span> <span data-ttu-id="f362e-165">如需祥氣資訊，請參閱下列文章： [上架由 Azure 自動化 DSC 管理的機器](automation-dsc-onboarding.md)</span><span class="sxs-lookup"><span data-stu-id="f362e-165">For more details, see this article: [Onboarding machines for management by Azure Automation DSC](automation-dsc-onboarding.md)</span></span>

## <a name="step-1-setting-up-hello-pull-server-and-automation-account"></a><span data-ttu-id="f362e-166">步驟 1： 設定 hello 提取伺服器與自動化帳戶</span><span class="sxs-lookup"><span data-stu-id="f362e-166">Step 1: Setting up hello pull server and automation account</span></span>
<span data-ttu-id="f362e-167">在已驗證的 (新增 AzureRmAccount) PowerShell 命令列: （可能需要幾分鐘的時間 hello 提取伺服器設定時）</span><span class="sxs-lookup"><span data-stu-id="f362e-167">At an authenticated (Add-AzureRmAccount) PowerShell command line:  (can take a few minutes while hello pull server is set up)</span></span>

    New-AzureRmResourceGroup –Name MY-AUTOMATION-RG –Location MY-RG-LOCATION-IN-QUOTES
    New-AzureRmAutomationAccount –ResourceGroupName MY-AUTOMATION-RG –Location MY-RG-LOCATION-IN-QUOTES –Name MY-AUTOMATION-ACCOUNT 

<span data-ttu-id="f362e-168">您可以將您的自動化帳戶的下列區域 （也稱為位置） 的 hello 任何： 美國東部 2、 美國中南部、 美國 Gov 維吉尼亞州、 西歐、 東南亞、 日本東部、 印度中部和澳洲東南部，加拿大的中央，北歐。</span><span class="sxs-lookup"><span data-stu-id="f362e-168">You can put your automation account into any of hello following regions (aka location):  East US 2, South Central US, US Gov Virginia, West Europe, Southeast Asia, Japan East, Central India and Australia Southeast, Canada Central, North Europe.</span></span>

## <a name="step-2-vm-extension-tweaks-toohello-arm-template"></a><span data-ttu-id="f362e-169">步驟 2: VM 延伸模組做調整 toohello ARM 範本</span><span class="sxs-lookup"><span data-stu-id="f362e-169">Step 2: VM extension tweaks toohello ARM template</span></span>
<span data-ttu-id="f362e-170">VM 註冊 （使用 hello PowerShell DSC VM 延伸模組） 在此提供詳細資料[Azure 快速入門範本](https://github.com/Azure/azure-quickstart-templates/tree/master/dsc-extension-azure-automation-pullserver)。</span><span class="sxs-lookup"><span data-stu-id="f362e-170">Details for VM registration (using hello PowerShell DSC VM extension) provided in this [Azure Quickstart Template](https://github.com/Azure/azure-quickstart-templates/tree/master/dsc-extension-azure-automation-pullserver).</span></span>  <span data-ttu-id="f362e-171">此步驟中使用 DSC 節點 hello 清單中的 hello 提取伺服器註冊新的 VM。</span><span class="sxs-lookup"><span data-stu-id="f362e-171">This step registers your new VM with hello pull server in hello list of DSC Nodes.</span></span>  <span data-ttu-id="f362e-172">此登錄的一部分指定 hello 節點組態套用的 toobe toohello 節點。</span><span class="sxs-lookup"><span data-stu-id="f362e-172">Part of this registration is specifying hello node configuration toobe applied toohello node.</span></span>  <span data-ttu-id="f362e-173">此節點設定 tooexist 尚未具有在 hello 提取伺服器，因此它的步驟 4，這基於 hello 第一次 [確定]。</span><span class="sxs-lookup"><span data-stu-id="f362e-173">This node configuration doesn't have tooexist yet in hello pull server, so it's OK that Step 4 is where this is done for hello first time.</span></span>  <span data-ttu-id="f362e-174">不過，這裡在步驟 2 中您需要 toohave 決定的 hello hello 節點名稱和 hello hello 組態名稱。</span><span class="sxs-lookup"><span data-stu-id="f362e-174">But here in Step 2 you do need toohave decided hello name of hello node and hello name of hello configuration.</span></span>  <span data-ttu-id="f362e-175">在此使用範例，hello 節點是 'isvbox' 而 hello 組態是 'ISVBoxConfig'。</span><span class="sxs-lookup"><span data-stu-id="f362e-175">In this usage example, hello node is 'isvbox' and hello configuration is 'ISVBoxConfig'.</span></span>  <span data-ttu-id="f362e-176">Hello 節點設定名稱 (toobe DeploymentTemplate.json 中指定) 是 'ISVBoxConfig.isvbox'。</span><span class="sxs-lookup"><span data-stu-id="f362e-176">So hello node configuration name (toobe specified in DeploymentTemplate.json) is 'ISVBoxConfig.isvbox'.</span></span>  

## <a name="step-3-adding-required-dsc-resources-toohello-pull-server"></a><span data-ttu-id="f362e-177">步驟 3： 加入必要的 DSC 資源 toohello 提取伺服器</span><span class="sxs-lookup"><span data-stu-id="f362e-177">Step 3: Adding required DSC resources toohello pull server</span></span>
<span data-ttu-id="f362e-178">hello PowerShell 資源庫是已經過檢測的 tooinstall DSC 資源到您的 Azure 自動化帳戶。</span><span class="sxs-lookup"><span data-stu-id="f362e-178">hello PowerShell Gallery is instrumented tooinstall DSC resources into your Azure Automation account.</span></span>  <span data-ttu-id="f362e-179">瀏覽 toohello 資源，然後按一下 hello 」 部署 tooAzure 自動化 」 按鈕。</span><span class="sxs-lookup"><span data-stu-id="f362e-179">Navigate toohello resource you want and click hello “Deploy tooAzure Automation” button.</span></span>

![PowerShell 資源庫範例](./media/automation-dsc-cd-chocolatey/xNetworking.PNG)

<span data-ttu-id="f362e-181">另一種技術最近才新增 toohello Azure 入口網站可讓您 toopull 新模組或更新現有模組中。</span><span class="sxs-lookup"><span data-stu-id="f362e-181">Another technique recently added toohello Azure Portal allows you toopull in new modules or update existing modules.</span></span> <span data-ttu-id="f362e-182">按一下瀏覽 hello 自動化帳戶資源、 hello 資產磚，以及最後 hello 模組磚。</span><span class="sxs-lookup"><span data-stu-id="f362e-182">Click through hello Automation Account resource, hello Assets tile, and finally hello Modules tile.</span></span>  <span data-ttu-id="f362e-183">hello 瀏覽圖庫圖示可讓您 toosee hello hello 圖庫中的模組清單、 向下鑽研到詳細資料和最終匯入您的自動化帳戶。</span><span class="sxs-lookup"><span data-stu-id="f362e-183">hello Browse Gallery icon allows you toosee hello list of modules in hello gallery, drill down into details and ultimately import into your Automation Account.</span></span> <span data-ttu-id="f362e-184">這是很好的方法 tookeep 總時間 tootime 從 toodate 模組。</span><span class="sxs-lookup"><span data-stu-id="f362e-184">This is a great way tookeep your modules up toodate from time tootime.</span></span> <span data-ttu-id="f362e-185">此外，hello 匯入功能會檢查以執行任何動作取得同步的其他模組 tooensure 的相依性。</span><span class="sxs-lookup"><span data-stu-id="f362e-185">And, hello import feature checks dependencies with other modules tooensure nothing gets out of sync.</span></span>

<span data-ttu-id="f362e-186">或者，如果沒有 hello 手動方法。</span><span class="sxs-lookup"><span data-stu-id="f362e-186">Or, there’s hello manual approach.</span></span>  <span data-ttu-id="f362e-187">適用於 Windows 電腦 PowerShell 整合模組 hello 資料夾結構與稍有不同 hello Azure 自動化所預期的 hello 資料夾結構。</span><span class="sxs-lookup"><span data-stu-id="f362e-187">hello folder structure of a PowerShell Integration Module for a Windows computer is a little different from hello folder structure expected by hello Azure Automation.</span></span>  <span data-ttu-id="f362e-188">您需要稍微調整一下。</span><span class="sxs-lookup"><span data-stu-id="f362e-188">This requires a little tweaking on your part.</span></span>  <span data-ttu-id="f362e-189">但是它並不難，而且每個資源一次處理完成 (除非您想 tooupgrade 它在未來。)如需關於撰寫 PowerShell 整合模組的詳細資訊，請參閱下列文章：[撰寫 Azure 自動化的整合模組](https://azure.microsoft.com/blog/authoring-integration-modules-for-azure-automation/)</span><span class="sxs-lookup"><span data-stu-id="f362e-189">But it’s not hard, and it’s done only once per resource (unless you want tooupgrade it in future.)  For more information on authoring PowerShell Integration Modules, see this article: [Authoring Integration Modules for Azure Automation](https://azure.microsoft.com/blog/authoring-integration-modules-for-azure-automation/)</span></span>

* <span data-ttu-id="f362e-190">安裝 hello 模組，您需要在您的工作站，如下所示：</span><span class="sxs-lookup"><span data-stu-id="f362e-190">Install hello module that you need on your workstation, as follows:</span></span>
  * <span data-ttu-id="f362e-191">安裝 [Windows Management Framework v5](http://aka.ms/wmf5latest) (Windows 10 不需安裝)</span><span class="sxs-lookup"><span data-stu-id="f362e-191">Install [Windows Management Framework, v5](http://aka.ms/wmf5latest) (not needed for Windows 10)</span></span>
  * <span data-ttu-id="f362e-192">`Install-Module –Name MODULE-NAME`<-grabs hello hello PowerShell 資源庫模組</span><span class="sxs-lookup"><span data-stu-id="f362e-192">`Install-Module –Name MODULE-NAME`    <—grabs hello module from hello PowerShell Gallery</span></span> 
* <span data-ttu-id="f362e-193">從複製 hello 模組資料夾`c:\Program Files\WindowsPowerShell\Modules\MODULE-NAME`tooa 暫存資料夾</span><span class="sxs-lookup"><span data-stu-id="f362e-193">Copy hello module folder from `c:\Program Files\WindowsPowerShell\Modules\MODULE-NAME` tooa temp folder</span></span> 
* <span data-ttu-id="f362e-194">範例與文件刪除 hello 的 main 資料夾</span><span class="sxs-lookup"><span data-stu-id="f362e-194">Delete samples and documentation from hello main folder</span></span> 
* <span data-ttu-id="f362e-195">Zip hello 主資料夾命名 hello ZIP 檔案完全相同 hello 與 hello 資料夾</span><span class="sxs-lookup"><span data-stu-id="f362e-195">Zip hello main folder, naming hello ZIP file exactly hello same as hello folder</span></span> 
* <span data-ttu-id="f362e-196">Hello ZIP 檔案放入連線到 HTTP 位置，例如 Azure 儲存體帳戶中的 blob 儲存體。</span><span class="sxs-lookup"><span data-stu-id="f362e-196">Put hello ZIP file into a reachable HTTP location, such as blob storage in an Azure Storage Account.</span></span>
* <span data-ttu-id="f362e-197">執行此 PowerShell：</span><span class="sxs-lookup"><span data-stu-id="f362e-197">Run this PowerShell:</span></span>
  
      New-AzureRmAutomationModule `
          -ResourceGroupName MY-AUTOMATION-RG -AutomationAccountName MY-AUTOMATION-ACCOUNT `
          -Name MODULE-NAME –ContentLink "https://STORAGE-URI/CONTAINERNAME/MODULE-NAME.zip"

<span data-ttu-id="f362e-198">包含 hello 範例 cChoco 和 xNetworking 執行這些步驟。</span><span class="sxs-lookup"><span data-stu-id="f362e-198">hello included example performs these steps for cChoco and xNetworking.</span></span> <span data-ttu-id="f362e-199">請參閱 hello[備忘稿](#notes)cChoco 的特殊處理。</span><span class="sxs-lookup"><span data-stu-id="f362e-199">See hello [Notes](#notes) for special handling for cChoco.</span></span>

## <a name="step-4-adding-hello-node-configuration-toohello-pull-server"></a><span data-ttu-id="f362e-200">步驟 4： 加入 hello 節點設定 toohello 提取伺服器</span><span class="sxs-lookup"><span data-stu-id="f362e-200">Step 4: Adding hello node configuration toohello pull server</span></span>
<span data-ttu-id="f362e-201">沒有任何特殊 hello 有關您匯入您的組態 hello 提取伺服器和編譯的第一次。</span><span class="sxs-lookup"><span data-stu-id="f362e-201">There’s nothing special about hello first time you import your configuration into hello pull server and compile.</span></span>  <span data-ttu-id="f362e-202">匯入編譯所有後續的 hello 相同的組態外觀完全 hello 相同。</span><span class="sxs-lookup"><span data-stu-id="f362e-202">All subsequent import/compiles of hello same configuration look exactly hello same.</span></span>  <span data-ttu-id="f362e-203">每次您更新您的封裝，並需要 toopush tooproduction 出您執行此步驟之後 hello 設定檔是封裝的正確 – 包括 hello 新版本，您。</span><span class="sxs-lookup"><span data-stu-id="f362e-203">Each time you update your package and need toopush it out tooproduction you do this step after ensuring hello configuration file is correct – including hello new version of your package.</span></span>  <span data-ttu-id="f362e-204">以下是 hello 設定檔與 PowerShell:</span><span class="sxs-lookup"><span data-stu-id="f362e-204">Here’s hello configuration file and PowerShell:</span></span>

<span data-ttu-id="f362e-205">ISVBoxConfig.ps1：</span><span class="sxs-lookup"><span data-stu-id="f362e-205">ISVBoxConfig.ps1:</span></span>

    Configuration ISVBoxConfig 
    { 
        Import-DscResource -ModuleName cChoco 
        Import-DscResource -ModuleName xNetworking

        Node "isvbox" {   

            cChocoInstaller installChoco 
            { 
                InstallDir = "C:\choco" 
            }

            WindowsFeature installIIS 
            { 
                Ensure="Present" 
                Name="Web-Server" 
            }

            xFirewall WebFirewallRule 
            { 
                Direction = "Inbound" 
                Name = "Web-Server-TCP-In" 
                DisplayName = "Web Server (TCP-In)" 
                Description = "IIS allow incoming web site traffic." 
                DisplayGroup = "IIS Incoming Traffic" 
                State = "Enabled" 
                Access = "Allow" 
                Protocol = "TCP" 
                LocalPort = "80" 
                Ensure = "Present" 
            }

            cChocoPackageInstaller trivialWeb 
            {            
                Name = "trivialweb" 
                Version = "1.0.0" 
                Source = “MY-NUGET-V2-SERVER-ADDRESS” 
                DependsOn = "[cChocoInstaller]installChoco", 
                "[WindowsFeature]installIIS" 
            } 
        }    
    }

<span data-ttu-id="f362e-206">New-ConfigurationScript.ps1：</span><span class="sxs-lookup"><span data-stu-id="f362e-206">New-ConfigurationScript.ps1:</span></span>

    Import-AzureRmAutomationDscConfiguration ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -SourcePath C:\temp\AzureAutomationDsc\ISVBoxConfig.ps1 ` 
        -Published –Force

    $jobData = Start-AzureRmAutomationDscCompilationJob ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -ConfigurationName ISVBoxConfig 

    $compilationJobId = $jobData.Id

    Get-AzureRmAutomationDscCompilationJob ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -Id $compilationJobId

<span data-ttu-id="f362e-207">這些步驟會導致新的節點設定名為"ISVBoxConfig.isvbox"hello 提取伺服器上要放置。</span><span class="sxs-lookup"><span data-stu-id="f362e-207">These steps result in a new node configuration named “ISVBoxConfig.isvbox” being placed on hello pull server.</span></span>  <span data-ttu-id="f362e-208">會建立 「 configurationName.nodeName"hello 節點設定名稱。</span><span class="sxs-lookup"><span data-stu-id="f362e-208">hello node configuration name is built as “configurationName.nodeName”.</span></span>

## <a name="step-5-creating-and-maintaining-package-metadata"></a><span data-ttu-id="f362e-209">步驟 5：建立和維護封裝中繼資料</span><span class="sxs-lookup"><span data-stu-id="f362e-209">Step 5: Creating and maintaining package metadata</span></span>
<span data-ttu-id="f362e-210">您放入 hello 封裝儲存機制的每一個封裝，您需要說明該 nuspec。</span><span class="sxs-lookup"><span data-stu-id="f362e-210">For each package that you put into hello package repository, you need a nuspec that describes it.</span></span>  <span data-ttu-id="f362e-211">該 nuspec 必須編譯並儲存在 NuGet 伺服器中。</span><span class="sxs-lookup"><span data-stu-id="f362e-211">That nuspec must be compiled and stored in your NuGet server.</span></span> <span data-ttu-id="f362e-212">此程序的說明請參閱 [這裡](http://docs.nuget.org/create/creating-and-publishing-a-package)。</span><span class="sxs-lookup"><span data-stu-id="f362e-212">This process is described [here](http://docs.nuget.org/create/creating-and-publishing-a-package).</span></span>  <span data-ttu-id="f362e-213">您可以使用 MyGet.org 做為 NuGet 伺服器。</span><span class="sxs-lookup"><span data-stu-id="f362e-213">You can use MyGet.org as a NuGet server.</span></span>  <span data-ttu-id="f362e-214">他們銷售這項服務，但有免費的入門 SKU。</span><span class="sxs-lookup"><span data-stu-id="f362e-214">They sell this service, but have a starter SKU that’s free.</span></span>  <span data-ttu-id="f362e-215">在 NuGet.org，您可以找到為私人封裝來安裝 NuGet 伺服器的指示。</span><span class="sxs-lookup"><span data-stu-id="f362e-215">At NuGet.org you’ll find instructions on installing your own NuGet server for your private packages.</span></span>

## <a name="step-6-tying-it-all-together"></a><span data-ttu-id="f362e-216">步驟 6：整合一切</span><span class="sxs-lookup"><span data-stu-id="f362e-216">Step 6: Tying it all together</span></span>
<span data-ttu-id="f362e-217">部署中，每次的版本會傳遞 QA 及核准建立 hello 封裝、 nuspec nupkg 更新和部署 toohello NuGet 伺服器。</span><span class="sxs-lookup"><span data-stu-id="f362e-217">Each time a version passes QA and is approved for deployment, hello package is created, nuspec and nupkg updated and deployed toohello NuGet server.</span></span>  <span data-ttu-id="f362e-218">此外，hello 組態 (上述步驟 4) 都必須更新的 tooagree hello 新的版本號碼。</span><span class="sxs-lookup"><span data-stu-id="f362e-218">In addition, hello configuration (Step 4 above) must be updated tooagree with hello new version number.</span></span>  <span data-ttu-id="f362e-219">它必須傳送 toohello 提取伺服器和編譯。</span><span class="sxs-lookup"><span data-stu-id="f362e-219">It must be sent toohello pull server and compiled.</span></span>  <span data-ttu-id="f362e-220">從該點上，是由 toohello Vm，取決於該組態 toopull hello 更新並安裝它。</span><span class="sxs-lookup"><span data-stu-id="f362e-220">From that point on, it's up toohello VMs that depend on that configuration toopull hello update and install it.</span></span>  <span data-ttu-id="f362e-221">這些更新內容很簡單 - 只有一兩行 PowerShell。</span><span class="sxs-lookup"><span data-stu-id="f362e-221">Each of these updates are simple - just a line or two of PowerShell.</span></span>  <span data-ttu-id="f362e-222">在 Visual Studio Team Services 的 hello 情況下，其中部分都會封裝在可鏈結在一起在組建中建置工作。</span><span class="sxs-lookup"><span data-stu-id="f362e-222">In hello case of Visual Studio Team Services, some of them are encapsulated in build tasks that can be chained together in a build.</span></span>  <span data-ttu-id="f362e-223">[本文](https://www.visualstudio.com/en-us/docs/alm-devops-feature-index#continuous-delivery)將詳加說明。</span><span class="sxs-lookup"><span data-stu-id="f362e-223">This [article](https://www.visualstudio.com/en-us/docs/alm-devops-feature-index#continuous-delivery) provides more details.</span></span>  <span data-ttu-id="f362e-224">這[GitHub 儲存機制](https://github.com/Microsoft/vso-agent-tasks)詳細資料 hello 各種可用的組建工作。</span><span class="sxs-lookup"><span data-stu-id="f362e-224">This [GitHub repo](https://github.com/Microsoft/vso-agent-tasks) details hello various available build tasks.</span></span>

## <a name="notes"></a><span data-ttu-id="f362e-225">注意事項</span><span class="sxs-lookup"><span data-stu-id="f362e-225">Notes</span></span>
<span data-ttu-id="f362e-226">此使用範例開頭將 VM 從 hello Azure 組件庫中的一般 Windows Server 2012 R2 映像。</span><span class="sxs-lookup"><span data-stu-id="f362e-226">This usage example starts with a VM from a generic Windows Server 2012 R2 image from hello Azure gallery.</span></span>  <span data-ttu-id="f362e-227">您可以開始從任何預存的映像，然後再從該處 hello DSC 設定的變更。</span><span class="sxs-lookup"><span data-stu-id="f362e-227">You can start from any stored image and then tweak from there with hello DSC configuration.</span></span>  <span data-ttu-id="f362e-228">不過，將映像變更為燒的組態是比動態更新使用 DSC 的 hello 組態困難得多。</span><span class="sxs-lookup"><span data-stu-id="f362e-228">However, changing configuration that is baked into an image is much harder than dynamically updating hello configuration using DSC.</span></span>

<span data-ttu-id="f362e-229">您沒有 toouse ARM 範本和 hello VM 延伸模組 toouse 這項技術與您的 Vm。</span><span class="sxs-lookup"><span data-stu-id="f362e-229">You don’t have toouse an ARM template and hello VM extension toouse this technique with your VMs.</span></span>  <span data-ttu-id="f362e-230">而且您的 Vm 沒有 toobe 上 Azure toobe CD 管理下。</span><span class="sxs-lookup"><span data-stu-id="f362e-230">And your VMs don’t have toobe on Azure toobe under CD management.</span></span>  <span data-ttu-id="f362e-231">所有的是該 Chocolatey 會安裝並 hello LCM 設定 hello VM 上，才會知道其中 hello 提取伺服器是必要的。</span><span class="sxs-lookup"><span data-stu-id="f362e-231">All that’s necessary is that Chocolatey be installed and hello LCM configured on hello VM so it knows where hello pull server is.</span></span>  

<span data-ttu-id="f362e-232">當然，當您更新處於生產環境的 VM 上的封裝，您需要 tootake 離輪替循環該 VM hello 更新安裝時。</span><span class="sxs-lookup"><span data-stu-id="f362e-232">Of course, when you update a package on a VM that’s in production, you need tootake that VM out of rotation while hello update is installed.</span></span>  <span data-ttu-id="f362e-233">視情況而定，作法會有很大的差異。</span><span class="sxs-lookup"><span data-stu-id="f362e-233">How you do this varies widely.</span></span>  <span data-ttu-id="f362e-234">例如，如果 VM 在 Azure 負載平衡器後方，您可以加入自訂探查。</span><span class="sxs-lookup"><span data-stu-id="f362e-234">For example, with a VM behind an Azure Load Balancer, you can add a Custom Probe.</span></span>  <span data-ttu-id="f362e-235">在更新 hello VM，具有 hello 探查端點傳回 400。</span><span class="sxs-lookup"><span data-stu-id="f362e-235">While updating hello VM, have hello probe endpoint return a 400.</span></span>  <span data-ttu-id="f362e-236">hello 調整必要 toocause 這項變更可以是在您的設定，可以 hello 調整 tooswitch 回 tooreturning 200 一旦 hello 更新已完成。</span><span class="sxs-lookup"><span data-stu-id="f362e-236">hello tweak necessary toocause this change can be inside your configuration, as can hello tweak tooswitch it back tooreturning a 200 once hello update is complete.</span></span>

<span data-ttu-id="f362e-237">此使用範例的完整原始檔位於 GitHub 上的 [Visual Studio 專案](https://github.com/sebastus/ARM/tree/master/CDIaaSVM) 。</span><span class="sxs-lookup"><span data-stu-id="f362e-237">Full source for this usage example is in [this Visual Studio project](https://github.com/sebastus/ARM/tree/master/CDIaaSVM) on GitHub.</span></span>

## <a name="related-articles"></a><span data-ttu-id="f362e-238">相關文章</span><span class="sxs-lookup"><span data-stu-id="f362e-238">Related Articles</span></span>
* [<span data-ttu-id="f362e-239">Azure 自動化 DSC 概觀</span><span class="sxs-lookup"><span data-stu-id="f362e-239">Azure Automation DSC Overview</span></span>](automation-dsc-overview.md)
* [<span data-ttu-id="f362e-240">Azure 自動化 DSC Cmdlet</span><span class="sxs-lookup"><span data-stu-id="f362e-240">Azure Automation DSC cmdlets</span></span>](https://msdn.microsoft.com/library/mt244122.aspx)
* [<span data-ttu-id="f362e-241">上架由 Azure 自動化 DSC 管理的機器</span><span class="sxs-lookup"><span data-stu-id="f362e-241">Onboarding machines for management by Azure Automation DSC</span></span>](automation-dsc-onboarding.md)

