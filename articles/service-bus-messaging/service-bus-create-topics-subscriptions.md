---
title: "aaaCreate 應用程式使用 Azure 服務匯流排主題和訂用帳戶 |Microsoft 文件"
description: "簡介 toohello 發行-訂閱所提供服務匯流排主題和訂閱的能力。"
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: a48fc9b0-b7b0-464e-8187-a517bf8b4eb4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/07/2017
ms.author: sethm
ms.openlocfilehash: f6d7de46ace7bd5b49de612db213ced789308d91
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="create-applications-that-use-service-bus-topics-and-subscriptions"></a><span data-ttu-id="293a8-103">建立使用服務匯流排主題和訂用帳戶的應用程式</span><span class="sxs-lookup"><span data-stu-id="293a8-103">Create applications that use Service Bus topics and subscriptions</span></span>
<span data-ttu-id="293a8-104">Azure 服務匯流排支援一套以雲端為基礎、訊息導向的中介軟體技術，包括可靠的訊息佇列和持久的發佈/訂閱訊息。</span><span class="sxs-lookup"><span data-stu-id="293a8-104">Azure Service Bus supports a set of cloud-based, message-oriented middleware technologies including reliable message queuing and durable publish/subscribe messaging.</span></span> <span data-ttu-id="293a8-105">這篇文章會根據所提供的 hello 資訊[建立使用服務匯流排佇列的應用程式](service-bus-create-queues.md)簡單介紹 toohello 發佈/訂閱功能所提供的服務匯流排主題。</span><span class="sxs-lookup"><span data-stu-id="293a8-105">This article builds on hello information provided in [Create applications that use Service Bus queues](service-bus-create-queues.md) and offers an introduction toohello publish/subscribe capabilities offered by Service Bus topics.</span></span>

## <a name="evolving-retail-scenario"></a><span data-ttu-id="293a8-106">不斷演變的零售案例</span><span class="sxs-lookup"><span data-stu-id="293a8-106">Evolving retail scenario</span></span>
<span data-ttu-id="293a8-107">本文會繼續使用中的 hello 零售案例[建立使用服務匯流排佇列的應用程式](service-bus-create-queues.md)。</span><span class="sxs-lookup"><span data-stu-id="293a8-107">This article continues hello retail scenario used in [Create applications that use Service Bus queues](service-bus-create-queues.md).</span></span> <span data-ttu-id="293a8-108">前文提過，將個別銷售點 (POS) 終端機的銷售資料必須路由的 tooan 庫存管理系統使用該資料 toodetermine toobe 補充存貨。</span><span class="sxs-lookup"><span data-stu-id="293a8-108">Recall that sales data from individual Point of Sale (POS) terminals must be routed tooan inventory management system which uses that data toodetermine when stock has toobe replenished.</span></span> <span data-ttu-id="293a8-109">每個 POS 終端機報告其銷售資料，藉由傳送訊息 toohello **DataCollectionQueue**佇列，其中一直等到收到 hello 庫存管理系統，如下所示：</span><span class="sxs-lookup"><span data-stu-id="293a8-109">Each POS terminal reports its sales data by sending messages toohello **DataCollectionQueue** queue, where they remain until they are received by hello inventory management system, as shown here:</span></span>

![服務匯流排 1](./media/service-bus-create-topics-subscriptions/IC657161.gif)

<span data-ttu-id="293a8-111">此案例中，新的需求已的 tooevolve 加入 toohello 系統： hello 店主想 toobe 無法 toomonitor hello 存放區執行即時的方式。</span><span class="sxs-lookup"><span data-stu-id="293a8-111">tooevolve this scenario, a new requirement has been added toohello system: hello store owner wants toobe able toomonitor how hello store is performing in real time.</span></span>

<span data-ttu-id="293a8-112">tooaddress 這項需求，hello 系統必須 「 竊聽 」 hello 銷售資料流。</span><span class="sxs-lookup"><span data-stu-id="293a8-112">tooaddress this requirement, hello system must "tap" off hello sales data stream.</span></span> <span data-ttu-id="293a8-113">我們仍然希望傳送嗨 POS 終端機 toobe 傳送 toohello 庫存管理系統做為前，每個訊息，但我們想要每則訊息，我們可以使用 toopresent hello 儀表板檢視 toohello 存放區擁有者的另一個複本。</span><span class="sxs-lookup"><span data-stu-id="293a8-113">We still want each message sent by hello POS terminals toobe sent toohello inventory management system as before, but we want another copy of each message that we can use toopresent hello dashboard view toohello store owner.</span></span>

<span data-ttu-id="293a8-114">在任何情況下，您需要由多個合作對象，每個訊息 toobe 中，您可以使用服務匯流排*主題*。</span><span class="sxs-lookup"><span data-stu-id="293a8-114">In any situation such as this, in which you require each message toobe consumed by multiple parties, you can use Service Bus *topics*.</span></span> <span data-ttu-id="293a8-115">主題提供發佈/訂閱的模式，其中每個發佈的訊息可提供 tooone 或多個訂閱註冊 hello 主題。</span><span class="sxs-lookup"><span data-stu-id="293a8-115">Topics provide a publish/subscribe pattern in which each published message is made available tooone or more subscriptions registered with hello topic.</span></span> <span data-ttu-id="293a8-116">相較之下，佇列是由單一取用者收到每則訊息。</span><span class="sxs-lookup"><span data-stu-id="293a8-116">In contrast, with queues each message is received by a single consumer.</span></span>

<span data-ttu-id="293a8-117">訊息會傳送 hello tooa 主題相同方式進行傳送 tooa 佇列。</span><span class="sxs-lookup"><span data-stu-id="293a8-117">Messages are sent tooa topic in hello same way as they are sent tooa queue.</span></span> <span data-ttu-id="293a8-118">不過，訊息不會從接收 hello 主題直接;它們會從訂閱接收。</span><span class="sxs-lookup"><span data-stu-id="293a8-118">However, messages are not received from hello topic directly; they are received from subscriptions.</span></span> <span data-ttu-id="293a8-119">您可以將訂用帳戶 tooa 主題視為虛擬佇列，可接收 toothat 主題傳送 hello 訊息複本。</span><span class="sxs-lookup"><span data-stu-id="293a8-119">You can think of a subscription tooa topic as a virtual queue that receives copies of hello messages that are sent toothat topic.</span></span> <span data-ttu-id="293a8-120">從訂閱接收訊息方式與從佇列收到 hello 相同。</span><span class="sxs-lookup"><span data-stu-id="293a8-120">Messages are received from a subscription hello same way as they are received from a queue.</span></span>

<span data-ttu-id="293a8-121">返回 toohello 零售案例，主題，會取代 hello 佇列，並加入訂用帳戶，可以使用哪些 hello 庫存管理系統元件。</span><span class="sxs-lookup"><span data-stu-id="293a8-121">Going back toohello retail scenario, hello queue is replaced by a topic, and a subscription is added, which hello inventory management system component can use.</span></span> <span data-ttu-id="293a8-122">hello 系統現在會顯示，如下所示：</span><span class="sxs-lookup"><span data-stu-id="293a8-122">hello system now appears as follows:</span></span>

![服務匯流排 2](./media/service-bus-create-topics-subscriptions/IC657165.gif)

<span data-ttu-id="293a8-124">這裡 hello 組態執行方式 toohello 先前佇列架構設計。</span><span class="sxs-lookup"><span data-stu-id="293a8-124">hello configuration here performs identically toohello previous queue-based design.</span></span> <span data-ttu-id="293a8-125">也就是說，傳送 toohello 主題的訊息會路由的 toohello**清查**訂用帳戶，從哪些 hello**庫存管理系統**會使用它們。</span><span class="sxs-lookup"><span data-stu-id="293a8-125">That is, messages sent toohello topic are routed toohello **Inventory** subscription, from which hello **Inventory Management System** consumes them.</span></span>

<span data-ttu-id="293a8-126">順序 toosupport hello 管理儀表板中，我們建立第二個訂閱 hello 主題如下所示：</span><span class="sxs-lookup"><span data-stu-id="293a8-126">In order toosupport hello management dashboard, we create a second subscription on hello topic, as shown here:</span></span>

![Service Bus 3](./media/service-bus-create-topics-subscriptions/IC657166.gif)

<span data-ttu-id="293a8-128">使用此設定時，所做每則訊息將 hello POS 終端機可用 tooboth hello**儀表板**和**清查**訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="293a8-128">With this configuration, each message from hello POS terminals is made available tooboth hello **Dashboard** and **Inventory** subscriptions.</span></span>

## <a name="show-me-hello-code"></a><span data-ttu-id="293a8-129">我想 hello 程式碼</span><span class="sxs-lookup"><span data-stu-id="293a8-129">Show me hello code</span></span>
<span data-ttu-id="293a8-130">hello 文章[建立使用服務匯流排佇列的應用程式](service-bus-create-queues.md)描述如何 toosign 的 Azure 帳戶，建立服務命名空間。</span><span class="sxs-lookup"><span data-stu-id="293a8-130">hello article [Create applications that use Service Bus queues](service-bus-create-queues.md) describes how toosign up for an Azure account and create a service namespace.</span></span> <span data-ttu-id="293a8-131">hello 最簡單方式 tooreference 服務匯流排相依性為 tooinstall hello Service Bus [Nuget 封裝](https://www.nuget.org/packages/WindowsAzure.ServiceBus/)。</span><span class="sxs-lookup"><span data-stu-id="293a8-131">hello easiest way tooreference Service Bus dependencies is tooinstall hello Service Bus [Nuget package](https://www.nuget.org/packages/WindowsAzure.ServiceBus/).</span></span> <span data-ttu-id="293a8-132">您也可以尋找 hello 服務匯流排程式庫做為 hello Azure SDK 的一部分。</span><span class="sxs-lookup"><span data-stu-id="293a8-132">You can also find hello Service Bus libraries as part of hello Azure SDK.</span></span> <span data-ttu-id="293a8-133">hello 下載將會位於 hello [Azure SDK 下載頁面](https://azure.microsoft.com/downloads/)。</span><span class="sxs-lookup"><span data-stu-id="293a8-133">hello download is available at hello [Azure SDK download page](https://azure.microsoft.com/downloads/).</span></span>

### <a name="create-hello-topic-and-subscriptions"></a><span data-ttu-id="293a8-134">建立 hello 主題和訂閱</span><span class="sxs-lookup"><span data-stu-id="293a8-134">Create hello topic and subscriptions</span></span>
<span data-ttu-id="293a8-135">管理 Service Bus 訊息實體 （佇列和發佈/訂閱主題） 都是透過 hello 作業[NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager)類別。</span><span class="sxs-lookup"><span data-stu-id="293a8-135">Management operations for Service Bus messaging entities (queues and publish/subscribe topics) are performed via hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class.</span></span> <span data-ttu-id="293a8-136">適當的認證所需的順序 toocreate **NamespaceManager**針對特定的命名空間的執行個體。</span><span class="sxs-lookup"><span data-stu-id="293a8-136">Appropriate credentials are required in order toocreate a **NamespaceManager** instance for a particular namespace.</span></span> <span data-ttu-id="293a8-137">服務匯流排會使用以[共用存取簽章 (SAS)](service-bus-sas.md) 為基礎的安全性模型。</span><span class="sxs-lookup"><span data-stu-id="293a8-137">Service Bus uses a [Shared Access Signature (SAS)](service-bus-sas.md) based security model.</span></span> <span data-ttu-id="293a8-138">hello [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider)類別代表與內建的 factory 方法傳回某些已知權杖提供者的安全性權杖提供者。</span><span class="sxs-lookup"><span data-stu-id="293a8-138">hello [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider) class represents a security token provider with built-in factory methods returning some well-known token providers.</span></span> <span data-ttu-id="293a8-139">我們將使用[CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_)方法 toohold hello SAS 認證。</span><span class="sxs-lookup"><span data-stu-id="293a8-139">We’ll use a [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) method toohold hello SAS credentials.</span></span> <span data-ttu-id="293a8-140">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) hello hello 服務匯流排命名空間和 hello 權杖提供者的基底地址，然後建構執行個體。</span><span class="sxs-lookup"><span data-stu-id="293a8-140">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) instance is then constructed with hello base address of hello Service Bus namespace and hello token provider.</span></span>

<span data-ttu-id="293a8-141">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager)類別會提供方法 toocreate、 列舉和刪除訊息實體。</span><span class="sxs-lookup"><span data-stu-id="293a8-141">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class provides methods toocreate, enumerate and delete messaging entities.</span></span> <span data-ttu-id="293a8-142">hello 程式碼，如下所示顯示如何 hello **NamespaceManager**執行個體是已建立並使用 toocreate hello **DataCollectionTopic**主題。</span><span class="sxs-lookup"><span data-stu-id="293a8-142">hello code that is shown here shows how hello **NamespaceManager** instance is created and used toocreate hello **DataCollectionTopic** topic.</span></span>

```csharp
Uri uri = ServiceBusEnvironment.CreateServiceUri("sb", "test-blog", string.Empty);
string name = "RootManageSharedAccessKey";
string key = "abcdefghijklmopqrstuvwxyz";

TokenProvider tokenProvider = TokenProvider.CreateSharedAccessSignatureTokenProvider(name, key);
NamespaceManager namespaceManager = new NamespaceManager(uri, tokenProvider);

namespaceManager.CreateTopic("DataCollectionTopic");
```

<span data-ttu-id="293a8-143">請注意，有多載的 hello [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) hello 主題的 tooset 屬性可讓您的方法。</span><span class="sxs-lookup"><span data-stu-id="293a8-143">Note that there are overloads of hello [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) method that enable you tooset properties of hello topic.</span></span> <span data-ttu-id="293a8-144">例如，您可以設定 hello 預設存留時間 (TTL) 值傳送 toohello 主題的訊息。</span><span class="sxs-lookup"><span data-stu-id="293a8-144">For example, you can set hello default time-to-live (TTL) value for messages sent toohello topic.</span></span> <span data-ttu-id="293a8-145">接下來，新增 hello**清查**和**儀表板**訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="293a8-145">Next, add hello **Inventory** and **Dashboard** subscriptions.</span></span>

```csharp
namespaceManager.CreateSubscription("DataCollectionTopic", "Inventory");
namespaceManager.CreateSubscription("DataCollectionTopic", "Dashboard");
```

### <a name="send-messages-toohello-topic"></a><span data-ttu-id="293a8-146">傳送訊息 toohello 主題</span><span class="sxs-lookup"><span data-stu-id="293a8-146">Send messages toohello topic</span></span>
<span data-ttu-id="293a8-147">對於服務匯流排實體上的執行階段作業 (例如，傳送和接收訊息)，應用程式必須先建立 [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#microsoft_servicebus_messaging_messagingfactory) 物件。</span><span class="sxs-lookup"><span data-stu-id="293a8-147">For run-time operations on Service Bus entities; for example, sending and receiving messages, an application must first create a [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#microsoft_servicebus_messaging_messagingfactory) object.</span></span> <span data-ttu-id="293a8-148">類似 toohello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager)類別，hello **MessagingFactory**從 hello hello 服務命名空間和 hello 權杖提供者的基底地址建立執行個體。</span><span class="sxs-lookup"><span data-stu-id="293a8-148">Similar toohello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class, hello **MessagingFactory** instance is created from hello base address of hello service namespace and hello token provider.</span></span>

```
MessagingFactory factory = MessagingFactory.Create(uri, tokenProvider);
```

<span data-ttu-id="293a8-149">傳送訊息 tooand 收到來自服務匯流排主題是 hello 的執行個體[BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage)類別。</span><span class="sxs-lookup"><span data-stu-id="293a8-149">Messages sent tooand received from Service Bus topics, are instances of hello [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) class.</span></span> <span data-ttu-id="293a8-150">這個類別所組成的一組標準屬性 (例如[標籤](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.label?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label)和[TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.timetolive?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)) 的字典，其中使用的 toohold 應用程式屬性，和任意應用程式資料的主體。</span><span class="sxs-lookup"><span data-stu-id="293a8-150">This class consists of a set of standard properties (such as [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.label?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) and [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.timetolive?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), a dictionary that is used toohold application properties, and a body of arbitrary application data.</span></span> <span data-ttu-id="293a8-151">應用程式可以藉由傳遞任何可序列化的物件設定 hello 主體 (hello 下列範例會傳入**SalesData**表示 hello POS 終端機 hello 銷售資料物件)，就會使用 hello [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) tooserialize hello 物件。</span><span class="sxs-lookup"><span data-stu-id="293a8-151">An application can set hello body by passing in any serializable object (hello following example passes in a **SalesData** object that represents hello sales data from hello POS terminal), which will use hello [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) tooserialize hello object.</span></span> <span data-ttu-id="293a8-152">或者，也可以提供 [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx) 物件。</span><span class="sxs-lookup"><span data-stu-id="293a8-152">Alternatively, a [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx) object can be provided.</span></span>

```csharp
BrokeredMessage bm = new BrokeredMessage(salesData);
bm.Label = "SalesReport";
bm.Properties["StoreName"] = "Redmond";
bm.Properties["MachineID"] = "POS_1";
```

<span data-ttu-id="293a8-153">hello 最簡單方式 toosend 訊息 toohello 主題是 toouse [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) toocreate [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender)物件直接從 hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory)執行個體：</span><span class="sxs-lookup"><span data-stu-id="293a8-153">hello easiest way toosend messages toohello topic is toouse [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) toocreate a [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) object directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance:</span></span>

```csharp
MessageSender sender = factory.CreateMessageSender("DataCollectionTopic");
sender.Send(bm);
```

### <a name="receive-messages-from-a-subscription"></a><span data-ttu-id="293a8-154">自訂用帳戶接收訊息</span><span class="sxs-lookup"><span data-stu-id="293a8-154">Receive messages from a subscription</span></span>
<span data-ttu-id="293a8-155">類似 toousing 佇列、 訂閱，您可以使用從 tooreceive 訊息[MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver)您直接從 hello 建立物件[MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory)使用[CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_)。</span><span class="sxs-lookup"><span data-stu-id="293a8-155">Similar toousing queues, tooreceive messages from a subscription you can use a [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) object which you create directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) using [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span></span> <span data-ttu-id="293a8-156">您可以使用其中一個 hello 的兩個不同接收模式 (**ReceiveAndDelete**和**PeekLock**)，如下所述[建立使用服務匯流排佇列的應用程式](service-bus-create-queues.md)。</span><span class="sxs-lookup"><span data-stu-id="293a8-156">You can use one of hello two different receive modes (**ReceiveAndDelete** and **PeekLock**), as discussed in [Create applications that use Service Bus queues](service-bus-create-queues.md).</span></span>

<span data-ttu-id="293a8-157">請注意，當您建立**MessageReceiver**訂用帳戶，hello *entityPath*參數屬於 hello 表單`topicPath/subscriptions/subscriptionName`。</span><span class="sxs-lookup"><span data-stu-id="293a8-157">Note that when you create a **MessageReceiver** for subscriptions, hello *entityPath* parameter is of hello form `topicPath/subscriptions/subscriptionName`.</span></span> <span data-ttu-id="293a8-158">因此，toocreate **MessageReceiver** hello**清查**訂用帳戶的 hello **DataCollectionTopic**主題*entityPath*必須設定得`DataCollectionTopic/subscriptions/Inventory`。</span><span class="sxs-lookup"><span data-stu-id="293a8-158">Therefore, toocreate a **MessageReceiver** for hello **Inventory** subscription of hello **DataCollectionTopic** topic, *entityPath* must be set too`DataCollectionTopic/subscriptions/Inventory`.</span></span> <span data-ttu-id="293a8-159">hello 程式碼如下所示：</span><span class="sxs-lookup"><span data-stu-id="293a8-159">hello code appears as follows:</span></span>

```csharp
MessageReceiver receiver = factory.CreateMessageReceiver("DataCollectionTopic/subscriptions/Inventory");
BrokeredMessage receivedMessage = receiver.Receive();
try
{
    ProcessMessage(receivedMessage);
    receivedMessage.Complete();
}
catch (Exception e)
{
    receivedMessage.Abandon();
}
```

## <a name="subscription-filters"></a><span data-ttu-id="293a8-160">訂用帳戶篩選</span><span class="sxs-lookup"><span data-stu-id="293a8-160">Subscription filters</span></span>
<span data-ttu-id="293a8-161">目前為止，在此案例中傳送 toohello 主題的所有訊息都進行可用 tooall 註冊訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="293a8-161">So far, in this scenario all messages sent toohello topic are made available tooall registered subscriptions.</span></span> <span data-ttu-id="293a8-162">這裡 hello 主要片語 」 可取得。 」</span><span class="sxs-lookup"><span data-stu-id="293a8-162">hello key phrase here is "made available."</span></span> <span data-ttu-id="293a8-163">服務匯流排訂閱可看見所有傳送 toohello 主題的訊息，而您可以複製這些訊息 toohello 虛擬訂閱佇列的子集。</span><span class="sxs-lookup"><span data-stu-id="293a8-163">While Service Bus subscriptions see all messages sent toohello topic, you can copy only a subset of those messages toohello virtual subscription queue.</span></span> <span data-ttu-id="293a8-164">這項工作可透過訂用帳戶「篩選」來進行。</span><span class="sxs-lookup"><span data-stu-id="293a8-164">This is performed using subscription *filters*.</span></span> <span data-ttu-id="293a8-165">當您建立訂閱時，您可以提供 hello 形式 hello hello 訊息屬性上運作的 SQL92 樣式述詞篩選條件運算式，兩者 hello 系統屬性 (例如，[標籤](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label)) 和 hello 應用程式屬性，例如**StoreName** hello 前一個範例中。</span><span class="sxs-lookup"><span data-stu-id="293a8-165">When you create a subscription, you can supply a filter expression in hello form of a SQL92 style predicate that operates over hello properties of hello message, both hello system properties (for example, [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label)) and hello application properties, such as **StoreName** in hello previous example.</span></span>

<span data-ttu-id="293a8-166">這發展 hello 案例 tooillustrate，第二個存放區是 toobe 加入的 tooour 零售案例。</span><span class="sxs-lookup"><span data-stu-id="293a8-166">Evolving hello scenario tooillustrate this, a second store is toobe added tooour retail scenario.</span></span> <span data-ttu-id="293a8-167">從兩個存放區的 hello POS 終端機的所有銷售資料仍有 toobe 路由 toohello 集中式庫存管理系統，但使用 hello 儀表板工具的店只有興趣 hello 該存放區的效能。</span><span class="sxs-lookup"><span data-stu-id="293a8-167">Sales data from all of hello POS terminals from both stores still have toobe routed toohello centralized inventory management system, but a store manager using hello dashboard tool is only interested in hello performance of that store.</span></span> <span data-ttu-id="293a8-168">您可以使用此篩選 tooachieve 訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="293a8-168">You can use subscription filtering tooachieve this.</span></span> <span data-ttu-id="293a8-169">請注意，當 hello POS 終端機發佈訊息時，它們將 hello **StoreName** hello 訊息上的應用程式屬性。</span><span class="sxs-lookup"><span data-stu-id="293a8-169">Note that when hello POS terminals publish messages, they set hello **StoreName** application property on hello message.</span></span> <span data-ttu-id="293a8-170">指定兩個存放區，例如**Redmond**和**西雅圖**，hello Redmond hello POS 終端機儲存他們的銷售資料訊息使用的戳記**StoreName**太等於**Redmond**，而 hello 西雅圖儲存 POS 終端機使用**StoreName**太等於**西雅圖**。</span><span class="sxs-lookup"><span data-stu-id="293a8-170">Given two stores, for example **Redmond** and **Seattle**, hello POS terminals in hello Redmond store stamp their sales data messages with a **StoreName** equal too**Redmond**, whereas hello Seattle store POS terminals use a **StoreName** equal too**Seattle**.</span></span> <span data-ttu-id="293a8-171">hello 存放區管理員的 hello Redmond 只儲存想 toosee 來自其 POS 終端機。</span><span class="sxs-lookup"><span data-stu-id="293a8-171">hello store manager of hello Redmond store only wants toosee data from its POS terminals.</span></span> <span data-ttu-id="293a8-172">hello 系統會顯示，如下所示：</span><span class="sxs-lookup"><span data-stu-id="293a8-172">hello system appears as follows:</span></span>

![Service-Bus4](./media/service-bus-create-topics-subscriptions/IC657167.gif)

<span data-ttu-id="293a8-174">設定此路由 tooset，建立 hello**儀表板**訂用帳戶，如下所示：</span><span class="sxs-lookup"><span data-stu-id="293a8-174">tooset up this routing, you create hello **Dashboard** subscription as follows:</span></span>

```csharp
SqlFilter dashboardFilter = new SqlFilter("StoreName = 'Redmond'");
namespaceManager.CreateSubscription("DataCollectionTopic", "Dashboard", dashboardFilter);
```

<span data-ttu-id="293a8-175">與這個[訂用帳戶篩選](/dotnet/api/microsoft.servicebus.messaging.sqlfilter)，訊息會 hello **StoreName**屬性設定太**Redmond**將會複製的 toohello hello虛擬佇列**儀表板**訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="293a8-175">With this [subscription filter](/dotnet/api/microsoft.servicebus.messaging.sqlfilter), only messages that have hello **StoreName** property set too**Redmond** will be copied toohello virtual queue for hello **Dashboard** subscription.</span></span> <span data-ttu-id="293a8-176">沒有篩選，不過更多 toosubscription。</span><span class="sxs-lookup"><span data-stu-id="293a8-176">There is much more toosubscription filtering, however.</span></span> <span data-ttu-id="293a8-177">傳遞 tooa 訂用帳戶的虛擬佇列，應用程式可以有多個篩選規則，每個訂閱中新增 toohello 能力 toomodify hello 訊息的屬性。</span><span class="sxs-lookup"><span data-stu-id="293a8-177">Applications can have multiple filter rules per subscription in addition toohello ability toomodify hello properties of a message as it passes tooa subscription's virtual queue.</span></span>

## <a name="summary"></a><span data-ttu-id="293a8-178">摘要</span><span class="sxs-lookup"><span data-stu-id="293a8-178">Summary</span></span>
<span data-ttu-id="293a8-179">描述所有 hello 原因 toouse 佇列[建立使用服務匯流排佇列的應用程式](service-bus-create-queues.md)也適用於 tootopics，特別是：</span><span class="sxs-lookup"><span data-stu-id="293a8-179">All of hello reasons toouse queuing described in [Create applications that use Service Bus queues](service-bus-create-queues.md) also apply tootopics, specifically:</span></span>

* <span data-ttu-id="293a8-180">時間解除結合 – 訊息產生者和消費者不需要線上 toobe hello 在相同的時間。</span><span class="sxs-lookup"><span data-stu-id="293a8-180">Temporal decoupling – message producers and consumers do not have toobe online at hello same time.</span></span>
* <span data-ttu-id="293a8-181">負載調節 – 尖峰負載平滑 hello 主題啟用取用應用程式 toobe 佈建針對平均負載而非高峰負載。</span><span class="sxs-lookup"><span data-stu-id="293a8-181">Load leveling – peaks in load are smoothed out by hello topic enabling consuming applications toobe provisioned for average load instead of peak load.</span></span>
* <span data-ttu-id="293a8-182">負載平衡 – 類似 tooa 佇列中，您可以有多個接聽單一訂閱，與遞交 hello 取用者，進而達到負載平衡的其中一個 tooonly 每個訊息的競爭取用者。</span><span class="sxs-lookup"><span data-stu-id="293a8-182">Load balancing – similar tooa queue, you can have multiple competing consumers listening on a single subscription, with each message handed off tooonly one of hello consumers, thereby balancing load.</span></span>
* <span data-ttu-id="293a8-183">鬆散結合 – 您可以持續改進 hello 訊息而不會影響現有端點; 的網路例如，新增訂閱或變更篩選 tooa 主題 tooallow 新的消費者。</span><span class="sxs-lookup"><span data-stu-id="293a8-183">Loose coupling – you can evolve hello messaging network without affecting existing endpoints; for example, adding subscriptions or changing filters tooa topic tooallow for new consumers.</span></span>

## <a name="next-steps"></a><span data-ttu-id="293a8-184">後續步驟</span><span class="sxs-lookup"><span data-stu-id="293a8-184">Next steps</span></span>

<span data-ttu-id="293a8-185">請參閱[建立使用服務匯流排佇列的應用程式](service-bus-create-queues.md)toouse 排入佇列中 hello POS 零售案例的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="293a8-185">See [Create applications that use Service Bus queues](service-bus-create-queues.md) for information about how toouse queues in hello POS retail scenario.</span></span>

