---
title: "將 Azure 服務匯流排應用程式與服務匯流排中斷和災害隔絕 | Microsoft Docs"
description: "說明您可用來保護應用程式，避免潛在服務匯流排中斷的技巧。"
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: tysonn
ms.assetid: fd9fa8ab-f4c4-43f7-974f-c876df1614d4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/12/2017
ms.author: sethm
ms.openlocfilehash: bc84dbe5c26a834b2cff5f71ba5f541e94ba0b38
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="best-practices-for-insulating-applications-against-service-bus-outages-and-disasters"></a><span data-ttu-id="1f9df-103">將應用程式與服務匯流排中斷和災難隔絕的最佳做法</span><span class="sxs-lookup"><span data-stu-id="1f9df-103">Best practices for insulating applications against Service Bus outages and disasters</span></span>
<span data-ttu-id="1f9df-104">關鍵任務應用程式必須持續作業，即使發生非預期的中斷或災害亦然。</span><span class="sxs-lookup"><span data-stu-id="1f9df-104">Mission-critical applications must operate continuously, even in the presence of unplanned outages or disasters.</span></span> <span data-ttu-id="1f9df-105">本主題說明您可用來保護服務匯流排應用程式，避免潛在的服務中斷或災害的技巧。</span><span class="sxs-lookup"><span data-stu-id="1f9df-105">This topic describes techniques you can use to protect Service Bus applications against a potential service outage or disaster.</span></span>

<span data-ttu-id="1f9df-106">中斷的定義是暫時無法使用 Azure 服務匯流排。</span><span class="sxs-lookup"><span data-stu-id="1f9df-106">An outage is defined as the temporary unavailability of Azure Service Bus.</span></span> <span data-ttu-id="1f9df-107">中斷可能會影響服務匯流排的否些元件，例如訊息存放區或甚至整個資料中心。</span><span class="sxs-lookup"><span data-stu-id="1f9df-107">The outage can affect some components of Service Bus, such as a messaging store, or even the entire datacenter.</span></span> <span data-ttu-id="1f9df-108">修正問題之後，服務匯流排可再次使用。</span><span class="sxs-lookup"><span data-stu-id="1f9df-108">After the problem has been fixed, Service Bus becomes available again.</span></span> <span data-ttu-id="1f9df-109">中斷通常不會導致訊息或其他資料遺失。</span><span class="sxs-lookup"><span data-stu-id="1f9df-109">Typically, an outage does not cause loss of messages or other data.</span></span> <span data-ttu-id="1f9df-110">元件失敗的範例是特定的訊息存放區無法使用。</span><span class="sxs-lookup"><span data-stu-id="1f9df-110">An example of a component failure is the unavailability of a particular messaging store.</span></span> <span data-ttu-id="1f9df-111">資料中心全面中斷的範例是資料中心電源中斷、或錯誤的資料中心網路交換器。</span><span class="sxs-lookup"><span data-stu-id="1f9df-111">An example of a datacenter-wide outage is a power failure of the datacenter, or a faulty datacenter network switch.</span></span> <span data-ttu-id="1f9df-112">中斷可能持續數分鐘到數天。</span><span class="sxs-lookup"><span data-stu-id="1f9df-112">An outage can last from a few minutes to a few days.</span></span>

<span data-ttu-id="1f9df-113">災害的定義是服務匯流排縮放單位或資料中心永久遺失。</span><span class="sxs-lookup"><span data-stu-id="1f9df-113">A disaster is defined as the permanent loss of a Service Bus scale unit or datacenter.</span></span> <span data-ttu-id="1f9df-114">資料中心不一定能再次使用。</span><span class="sxs-lookup"><span data-stu-id="1f9df-114">The datacenter may or may not become available again.</span></span> <span data-ttu-id="1f9df-115">災害通常會造成部分或所有訊息或其他資料遺失。</span><span class="sxs-lookup"><span data-stu-id="1f9df-115">Typically a disaster causes loss of some or all messages or other data.</span></span> <span data-ttu-id="1f9df-116">災害的範例包括火災、水災或地震。</span><span class="sxs-lookup"><span data-stu-id="1f9df-116">Examples of disasters are fire, flooding, or earthquake.</span></span>

## <a name="current-architecture"></a><span data-ttu-id="1f9df-117">目前架構</span><span class="sxs-lookup"><span data-stu-id="1f9df-117">Current architecture</span></span>
<span data-ttu-id="1f9df-118">服務匯流排使用多個訊息存放區來儲存傳送至佇列或主題的訊息。</span><span class="sxs-lookup"><span data-stu-id="1f9df-118">Service Bus uses multiple messaging stores to store messages that are sent to queues or topics.</span></span> <span data-ttu-id="1f9df-119">非分割的佇列或主題會指派給一個訊息存放區。</span><span class="sxs-lookup"><span data-stu-id="1f9df-119">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="1f9df-120">如果此訊息存放區無法使用，該佇列或主題上的所有作業都會失敗。</span><span class="sxs-lookup"><span data-stu-id="1f9df-120">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span>

<span data-ttu-id="1f9df-121">所有服務匯流排訊息實體 (佇列、主題、轉送) 都位於附屬於資料中心的服務命名空間中。</span><span class="sxs-lookup"><span data-stu-id="1f9df-121">All Service Bus messaging entities (queues, topics, relays) reside in a service namespace, which is affiliated with a datacenter.</span></span> <span data-ttu-id="1f9df-122">服務匯流排不會啟用自動資料異地複寫，也不會允許跨多個資料中心的命名空間。</span><span class="sxs-lookup"><span data-stu-id="1f9df-122">Service Bus does not enable automatic geo-replication of data, nor does it allow a namespace to span multiple datacenters.</span></span>

## <a name="protecting-against-acs-outages"></a><span data-ttu-id="1f9df-123">保護 ACS 免於中斷</span><span class="sxs-lookup"><span data-stu-id="1f9df-123">Protecting against ACS outages</span></span>
<span data-ttu-id="1f9df-124">如果您使用 ACS 認證，ACS 會無法使用，用戶端也無法再取得權杖。</span><span class="sxs-lookup"><span data-stu-id="1f9df-124">If you are using ACS credentials, and ACS becomes unavailable, clients can no longer obtain tokens.</span></span> <span data-ttu-id="1f9df-125">在 ACS 停機時擁有權杖的用戶端可以繼續使用服務匯流排直到權杖到期。</span><span class="sxs-lookup"><span data-stu-id="1f9df-125">Clients that have a token at the time ACS goes down can continue to use Service Bus until the tokens expire.</span></span> <span data-ttu-id="1f9df-126">預設權杖存留期為 3 小時。</span><span class="sxs-lookup"><span data-stu-id="1f9df-126">The default token lifetime is 3 hours.</span></span>

<span data-ttu-id="1f9df-127">若要保護 ACS 免於中斷，請使用共用存取簽章 (SAS) 權杖。</span><span class="sxs-lookup"><span data-stu-id="1f9df-127">To protect against ACS outages, use Shared Access Signature (SAS) tokens.</span></span> <span data-ttu-id="1f9df-128">在此情況下，用戶端會藉由使用秘密金鑰簽署自行決策權杖的方式，直接使用服務匯流排進行驗證。</span><span class="sxs-lookup"><span data-stu-id="1f9df-128">In this case, the client authenticates directly with Service Bus by signing a self-minted token with a secret key.</span></span> <span data-ttu-id="1f9df-129">不再需要呼叫 ACS。</span><span class="sxs-lookup"><span data-stu-id="1f9df-129">Calls to ACS are no longer required.</span></span> <span data-ttu-id="1f9df-130">如需有關 SAS 權杖的詳細資訊，請參閱[服務匯流排驗證][Service Bus authentication]。</span><span class="sxs-lookup"><span data-stu-id="1f9df-130">For more information about SAS tokens, see [Service Bus authentication][Service Bus authentication].</span></span>

## <a name="protecting-queues-and-topics-against-messaging-store-failures"></a><span data-ttu-id="1f9df-131">保護佇列和主題免於發生訊息存放區失敗</span><span class="sxs-lookup"><span data-stu-id="1f9df-131">Protecting queues and topics against messaging store failures</span></span>
<span data-ttu-id="1f9df-132">非分割的佇列或主題會指派給一個訊息存放區。</span><span class="sxs-lookup"><span data-stu-id="1f9df-132">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="1f9df-133">如果此訊息存放區無法使用，該佇列或主題上的所有作業都會失敗。</span><span class="sxs-lookup"><span data-stu-id="1f9df-133">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="1f9df-134">另一方面，分割佇列包含多個片段。</span><span class="sxs-lookup"><span data-stu-id="1f9df-134">A partitioned queue, on the other hand, consists of multiple fragments.</span></span> <span data-ttu-id="1f9df-135">每個片段都儲存在不同的訊息存放區。</span><span class="sxs-lookup"><span data-stu-id="1f9df-135">Each fragment is stored in a different messaging store.</span></span> <span data-ttu-id="1f9df-136">當訊息傳送至分割的佇列或主題時，服務匯流排會指派訊息到其中一個片段。</span><span class="sxs-lookup"><span data-stu-id="1f9df-136">When a message is sent to a partitioned queue or topic, Service Bus assigns the message to one of the fragments.</span></span> <span data-ttu-id="1f9df-137">如果對應的訊息存放區無法使用，服務匯流排會盡可能將訊息寫入至不同的片段。</span><span class="sxs-lookup"><span data-stu-id="1f9df-137">If the corresponding messaging store is unavailable, Service Bus writes the message to a different fragment, if possible.</span></span> <span data-ttu-id="1f9df-138">如需有關已分割實體的詳細資訊，請參閱[分割的傳訊實體][Partitioned messaging entities]。</span><span class="sxs-lookup"><span data-stu-id="1f9df-138">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

## <a name="protecting-against-datacenter-outages-or-disasters"></a><span data-ttu-id="1f9df-139">保護資料中心免於中斷或災害</span><span class="sxs-lookup"><span data-stu-id="1f9df-139">Protecting against datacenter outages or disasters</span></span>
<span data-ttu-id="1f9df-140">若要允許兩個資料中心之間的容錯移轉，您可以在每個資料中心建立服務匯流排服務命名空間。</span><span class="sxs-lookup"><span data-stu-id="1f9df-140">To allow for a failover between two datacenters, you can create a Service Bus service namespace in each datacenter.</span></span> <span data-ttu-id="1f9df-141">例如，服務匯流排服務命名空間 **contosoPrimary.servicebus.windows.net** 可能位於美國北部/中部區域，而 **contosoSecondary.servicebus.windows.net** 可能位於美國南部/中部區域。</span><span class="sxs-lookup"><span data-stu-id="1f9df-141">For example, the Service Bus service namespace **contosoPrimary.servicebus.windows.net** might be located in the United States North/Central region, and **contosoSecondary.servicebus.windows.net** might be located in the US South/Central region.</span></span> <span data-ttu-id="1f9df-142">如果服務匯流排訊息實體必須在資料中心發生中斷時保持可存取狀態，您可以在這兩個命名空間建立該實體。</span><span class="sxs-lookup"><span data-stu-id="1f9df-142">If a Service Bus messaging entity must remain accessible in the presence of a datacenter outage, you can create that entity in both namespaces.</span></span>

<span data-ttu-id="1f9df-143">如需詳細資訊，請參閱[非同步傳訊模式和高可用性][Asynchronous messaging patterns and high availability]中的＜Azure 資料中心內的服務匯流排失敗＞一節。</span><span class="sxs-lookup"><span data-stu-id="1f9df-143">For more information, see the "Failure of Service Bus within an Azure datacenter" section in [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability].</span></span>

## <a name="protecting-relay-endpoints-against-datacenter-outages-or-disasters"></a><span data-ttu-id="1f9df-144">保護轉送端點免於發生資料中心中斷或災害</span><span class="sxs-lookup"><span data-stu-id="1f9df-144">Protecting relay endpoints against datacenter outages or disasters</span></span>
<span data-ttu-id="1f9df-145">轉送端點的異地複寫會讓公開轉送端點的服務可在服務匯流排中斷時使用。</span><span class="sxs-lookup"><span data-stu-id="1f9df-145">Geo-replication of relay endpoints allows a service that exposes a relay endpoint to be reachable in the presence of Service Bus outages.</span></span> <span data-ttu-id="1f9df-146">若要達到異地複寫，服務必須在不同的命名空間中建立兩個轉送端點。</span><span class="sxs-lookup"><span data-stu-id="1f9df-146">To achieve geo-replication, the service must create two relay endpoints in different namespaces.</span></span> <span data-ttu-id="1f9df-147">命名空間必須位於不同的資料中心而兩個端點必須具有不同的名稱。</span><span class="sxs-lookup"><span data-stu-id="1f9df-147">The namespaces must reside in different datacenters and the two endpoints must have different names.</span></span> <span data-ttu-id="1f9df-148">比方說，主要端點在 **contosoPrimary.servicebus.windows.net/myPrimaryService** 之下達到，而其次要的對應項目可以在 **contosoSecondary.servicebus.windows.net/mySecondaryService** 之下達到。</span><span class="sxs-lookup"><span data-stu-id="1f9df-148">For example, a primary endpoint can be reached under **contosoPrimary.servicebus.windows.net/myPrimaryService**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span></span>

<span data-ttu-id="1f9df-149">然後服務會接聽這兩個端點，且用戶端可以透過任一端點叫用服務。</span><span class="sxs-lookup"><span data-stu-id="1f9df-149">The service then listens on both endpoints, and a client can invoke the service via either endpoint.</span></span> <span data-ttu-id="1f9df-150">用戶端應用程式會隨機挑選其中一個轉送做為主要端點，並將其要求傳送至作用中的端點。</span><span class="sxs-lookup"><span data-stu-id="1f9df-150">A client application randomly picks one of the relays as the primary endpoint, and sends its request to the active endpoint.</span></span> <span data-ttu-id="1f9df-151">如果作業失敗並出現錯誤代碼，此失敗代表轉送端點無法使用。</span><span class="sxs-lookup"><span data-stu-id="1f9df-151">If the operation fails with an error code, this failure indicates that the relay endpoint is not available.</span></span> <span data-ttu-id="1f9df-152">應用程式會開啟備份端點的通道並重新發出要求。</span><span class="sxs-lookup"><span data-stu-id="1f9df-152">The application opens a channel to the backup endpoint and reissues the request.</span></span> <span data-ttu-id="1f9df-153">作用中和備份端點會在這一點交換角色：用戶端應用程式會將舊的使用中端點視為新的備份端點，而將舊的備份端點視為新的作用中端點。</span><span class="sxs-lookup"><span data-stu-id="1f9df-153">At that point the active and the backup endpoints switch roles: the client application considers the old active endpoint to be the new backup endpoint, and the old backup endpoint to be the new active endpoint.</span></span> <span data-ttu-id="1f9df-154">如果這兩個傳送作業都失敗，兩個實體的角色會保持不變並傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="1f9df-154">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="1f9df-155">[搭配服務匯流排轉送訊息的異地複寫 (英文)][Geo-replication with Service Bus relayed Messages] 範例示範如何複寫轉送。</span><span class="sxs-lookup"><span data-stu-id="1f9df-155">The [Geo-replication with Service Bus relayed messages][Geo-replication with Service Bus relayed Messages] sample demonstrates how to replicate relays.</span></span>

## <a name="protecting-queues-and-topics-against-datacenter-outages-or-disasters"></a><span data-ttu-id="1f9df-156">保護佇列和主題免於發生資料中心中斷或災害</span><span class="sxs-lookup"><span data-stu-id="1f9df-156">Protecting queues and topics against datacenter outages or disasters</span></span>
<span data-ttu-id="1f9df-157">若要在使用代理傳訊時達成對資料中心中斷的恢復能力，服務匯流排支援兩種方法：*主動*和*被動*複寫。</span><span class="sxs-lookup"><span data-stu-id="1f9df-157">To achieve resilience against datacenter outages when using brokered messaging, Service Bus supports two approaches: *active* and *passive* replication.</span></span> <span data-ttu-id="1f9df-158">無論使用哪個方法，如果特定佇列或主題必須在資料中心發生中斷時保持可存取狀態，您可以在這兩個命名空間建立該佇列或主題。</span><span class="sxs-lookup"><span data-stu-id="1f9df-158">For each approach, if a given queue or topic must remain accessible in the presence of a datacenter outage, you can create it in both namespaces.</span></span> <span data-ttu-id="1f9df-159">這兩個實體可以具有相同的名稱。</span><span class="sxs-lookup"><span data-stu-id="1f9df-159">Both entities can have the same name.</span></span> <span data-ttu-id="1f9df-160">比方說，主要佇列在 **contosoPrimary.servicebus.windows.net/myQueue** 之下達到，而其次要的對應項目可以在 **contosoSecondary.servicebus.windows.net/myQueue** 之下達到。</span><span class="sxs-lookup"><span data-stu-id="1f9df-160">For example, a primary queue can be reached under **contosoPrimary.servicebus.windows.net/myQueue**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/myQueue**.</span></span>

<span data-ttu-id="1f9df-161">如果應用程式不需要永久的傳送者至接收者通訊，應用程式可以實作持續的用戶端佇列，以防止訊息遺失並避免傳送者發生任何暫時性服務匯流排錯誤。</span><span class="sxs-lookup"><span data-stu-id="1f9df-161">If the application does not require permanent sender-to-receiver communication, the application can implement a durable client-side queue to prevent message loss and to shield the sender from any transient Service Bus errors.</span></span>

## <a name="active-replication"></a><span data-ttu-id="1f9df-162">主動複寫</span><span class="sxs-lookup"><span data-stu-id="1f9df-162">Active replication</span></span>
<span data-ttu-id="1f9df-163">主動複寫會針對每個作業使用兩個命名空間中的實體。</span><span class="sxs-lookup"><span data-stu-id="1f9df-163">Active replication uses entities in both namespaces for every operation.</span></span> <span data-ttu-id="1f9df-164">傳送訊息的任何用戶端會傳送相同訊息的兩個複本。</span><span class="sxs-lookup"><span data-stu-id="1f9df-164">Any client that sends a message sends two copies of the same message.</span></span> <span data-ttu-id="1f9df-165">第一個複本傳送至主要實體 (例如 **contosoPrimary.servicebus.windows.net/sales**)，而訊息的第二個複本傳送至次要實體 (例如 **contosoSecondary.servicebus.windows.net/sales**)。</span><span class="sxs-lookup"><span data-stu-id="1f9df-165">The first copy is sent to the primary entity (for example, **contosoPrimary.servicebus.windows.net/sales**), and the second copy of the message is sent to the secondary entity (for example, **contosoSecondary.servicebus.windows.net/sales**).</span></span>

<span data-ttu-id="1f9df-166">用戶端會從這兩個佇列接收訊息。</span><span class="sxs-lookup"><span data-stu-id="1f9df-166">A client receives messages from both queues.</span></span> <span data-ttu-id="1f9df-167">接收者會處理訊息的第一個複本，並隱藏第二個複本。</span><span class="sxs-lookup"><span data-stu-id="1f9df-167">The receiver processes the first copy of a message, and the second copy is suppressed.</span></span> <span data-ttu-id="1f9df-168">若要隱藏重複的訊息，傳送者必須利用唯一的識別碼標記每個訊息。</span><span class="sxs-lookup"><span data-stu-id="1f9df-168">To suppress duplicate messages, the sender must tag each message with a unique identifier.</span></span> <span data-ttu-id="1f9df-169">訊息的兩個複本必須以相同的識別碼標記。</span><span class="sxs-lookup"><span data-stu-id="1f9df-169">Both copies of the message must be tagged with the same identifier.</span></span> <span data-ttu-id="1f9df-170">您可以使用 [BrokeredMessage.MessageId][BrokeredMessage.MessageId]、[BrokeredMessage.Label][BrokeredMessage.Label] 屬性或自訂屬性來標記訊息。</span><span class="sxs-lookup"><span data-stu-id="1f9df-170">You can use the [BrokeredMessage.MessageId][BrokeredMessage.MessageId] or [BrokeredMessage.Label][BrokeredMessage.Label] properties, or a custom property to tag the message.</span></span> <span data-ttu-id="1f9df-171">接收者必須維護其已收到的訊息清單。</span><span class="sxs-lookup"><span data-stu-id="1f9df-171">The receiver must maintain a list of messages that it has already received.</span></span>

<span data-ttu-id="1f9df-172">[搭配服務匯流排代理訊息的異地複寫 (英文)][Geo-replication with Service Bus Brokered Messages] 範例示範訊息實體的主動複寫。</span><span class="sxs-lookup"><span data-stu-id="1f9df-172">The [Geo-replication with Service Bus Brokered Messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates active replication of messaging entities.</span></span>

> [!NOTE]
> <span data-ttu-id="1f9df-173">主動複寫方法會讓作業數目加倍，因此這個方法會導致更高的成本。</span><span class="sxs-lookup"><span data-stu-id="1f9df-173">The active replication approach doubles the number of operations, therefore this approach can lead to higher cost.</span></span>
> 
> 

## <a name="passive-replication"></a><span data-ttu-id="1f9df-174">被動複寫</span><span class="sxs-lookup"><span data-stu-id="1f9df-174">Passive replication</span></span>
<span data-ttu-id="1f9df-175">在沒有錯誤的情況下，被動複寫只會使用兩個訊息實體的其中之一。</span><span class="sxs-lookup"><span data-stu-id="1f9df-175">In the fault-free case, passive replication uses only one of the two messaging entities.</span></span> <span data-ttu-id="1f9df-176">用戶端會傳送訊息至作用中的實體。</span><span class="sxs-lookup"><span data-stu-id="1f9df-176">A client sends the message to the active entity.</span></span> <span data-ttu-id="1f9df-177">如果作用中實體上的作業失敗，並出現錯誤碼指出裝載作用中實體的資料中心可能會無法使用，用戶端會傳送訊息的複本至備份實體。</span><span class="sxs-lookup"><span data-stu-id="1f9df-177">If the operation on the active entity fails with an error code that indicates the datacenter that hosts the active entity might be unavailable, the client sends a copy of the message to the backup entity.</span></span> <span data-ttu-id="1f9df-178">作用中和備份實體會在這一點交換角色：傳送用戶端會將舊的使用中實體視為新的備份實體，而將舊的備份實體視為新的作用中實體。</span><span class="sxs-lookup"><span data-stu-id="1f9df-178">At that point the active and the backup entities switch roles: the sending client considers the old active entity to be the new backup entity, and the old backup entity is the new active entity.</span></span> <span data-ttu-id="1f9df-179">如果這兩個傳送作業都失敗，兩個實體的角色會保持不變並傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="1f9df-179">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="1f9df-180">用戶端會從這兩個佇列接收訊息。</span><span class="sxs-lookup"><span data-stu-id="1f9df-180">A client receives messages from both queues.</span></span> <span data-ttu-id="1f9df-181">因為接收者可能會收到相同訊息的兩個複本，所以接收者必須隱藏重複的訊息。</span><span class="sxs-lookup"><span data-stu-id="1f9df-181">Because there is a chance that the receiver receives two copies of the same message, the receiver must suppress duplicate messages.</span></span> <span data-ttu-id="1f9df-182">您可以主動複寫所描述的相同方式隱藏重複訊息。</span><span class="sxs-lookup"><span data-stu-id="1f9df-182">You can suppress duplicates in the same way as described for active replication.</span></span>

<span data-ttu-id="1f9df-183">一般而言，被動複寫比主動複寫更具經濟效益，因為大部分的情形只會執行一項作業。</span><span class="sxs-lookup"><span data-stu-id="1f9df-183">In general, passive replication is more economical than active replication because in most cases only one operation is performed.</span></span> <span data-ttu-id="1f9df-184">延遲、輸送量和成本與非複寫案例相同。</span><span class="sxs-lookup"><span data-stu-id="1f9df-184">Latency, throughput, and monetary cost are identical to the non-replicated scenario.</span></span>

<span data-ttu-id="1f9df-185">使用被動複寫時，訊息可能會在下列案例中遺失或收到兩次：</span><span class="sxs-lookup"><span data-stu-id="1f9df-185">When using passive replication, in the following scenarios messages can be lost or received twice:</span></span>

* <span data-ttu-id="1f9df-186">**訊息延遲或遺失**：假設傳送者成功傳送訊息 m1 至主要佇列，佇列在接收者收到 m1 之前無法使用。</span><span class="sxs-lookup"><span data-stu-id="1f9df-186">**Message delay or loss**: Assume that the sender successfully sent a message m1 to the primary queue, and then the queue becomes unavailable before the receiver receives m1.</span></span> <span data-ttu-id="1f9df-187">傳送者會將後續的訊息 m2 傳送至次要佇列。</span><span class="sxs-lookup"><span data-stu-id="1f9df-187">The sender sends a subsequent message m2 to the secondary queue.</span></span> <span data-ttu-id="1f9df-188">如果主要佇列暫時無法使用，接收者會在佇列可再次使用之後收到 m1。</span><span class="sxs-lookup"><span data-stu-id="1f9df-188">If the primary queue is temporarily unavailable, the receiver receives m1 after the queue becomes available again.</span></span> <span data-ttu-id="1f9df-189">若發生災害，接收者可能永遠無法收到 m1。</span><span class="sxs-lookup"><span data-stu-id="1f9df-189">In case of a disaster, the receiver may never receive m1.</span></span>
* <span data-ttu-id="1f9df-190">**重複接收**：假設傳送者傳送訊息 m 到主要佇列。</span><span class="sxs-lookup"><span data-stu-id="1f9df-190">**Duplicate reception**: Assume that the sender sends a message m to the primary queue.</span></span> <span data-ttu-id="1f9df-191">服務匯流排已成功處理 m 但無法傳送回應。</span><span class="sxs-lookup"><span data-stu-id="1f9df-191">Service Bus successfully processes m but fails to send a response.</span></span> <span data-ttu-id="1f9df-192">傳送作業逾時之後，傳送者會將 m 的相同複本傳送至次要佇列。</span><span class="sxs-lookup"><span data-stu-id="1f9df-192">After the send operation times out, the sender sends an identical copy of m to the secondary queue.</span></span> <span data-ttu-id="1f9df-193">如果接收者可以在主要佇列無法使用之前收到 m 的第一個複本，接收者會幾乎同時接收 m 的兩個複本。</span><span class="sxs-lookup"><span data-stu-id="1f9df-193">If the receiver is able to receive the first copy of m before the primary queue becomes unavailable, the receiver receives both copies of m at approximately the same time.</span></span> <span data-ttu-id="1f9df-194">如果接收者無法在主要佇列無法使用之前收到 m 的第一個複本，接收者一開始只會收到 m 的第二個複本，但會接著在主要佇列可以使用時會收到 m 的第二個複本。</span><span class="sxs-lookup"><span data-stu-id="1f9df-194">If the receiver is not able to receive the first copy of m before the primary queue becomes unavailable, the receiver initially receives only the second copy of m, but then receives a second copy of m when the primary queue becomes available.</span></span>

<span data-ttu-id="1f9df-195">[搭配服務匯流排代理訊息的異地複寫 (英文)][Geo-replication with Service Bus Brokered Messages] 範例示範訊息實體的被動複寫。</span><span class="sxs-lookup"><span data-stu-id="1f9df-195">The [Geo-replication with Service Bus brokered messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates passive replication of messaging entities.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1f9df-196">後續步驟</span><span class="sxs-lookup"><span data-stu-id="1f9df-196">Next steps</span></span>
<span data-ttu-id="1f9df-197">若要深入了解災害復原，請參閱這些文章：</span><span class="sxs-lookup"><span data-stu-id="1f9df-197">To learn more about disaster recovery, see these articles:</span></span>

* <span data-ttu-id="1f9df-198">[Azure SQL Database 商務持續性][Azure SQL Database Business Continuity]</span><span class="sxs-lookup"><span data-stu-id="1f9df-198">[Azure SQL Database Business Continuity][Azure SQL Database Business Continuity]</span></span>
* <span data-ttu-id="1f9df-199">[為 Azure 設計有彈性的應用程式][Azure resiliency technical guidance]</span><span class="sxs-lookup"><span data-stu-id="1f9df-199">[Designing resilient applications for Azure][Azure resiliency technical guidance]</span></span>

[Service Bus Authentication]: service-bus-authentication-and-authorization.md
[Partitioned messaging entities]: service-bus-partitioning.md
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md#failure-of-service-bus-within-an-azure-datacenter
[Geo-replication with Service Bus Relayed Messages]: http://code.msdn.microsoft.com/Geo-replication-with-16dbfecd
[BrokeredMessage.MessageId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId
[BrokeredMessage.Label]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label
[Geo-replication with Service Bus Brokered Messages]: http://code.msdn.microsoft.com/Geo-replication-with-f5688664
[Azure SQL Database Business Continuity]: ../sql-database/sql-database-business-continuity.md
[Azure resiliency technical guidance]: /azure/architecture/resiliency
