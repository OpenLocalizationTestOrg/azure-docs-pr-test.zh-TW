---
title: "aaaInsulating Azure 服務匯流排應用程式，避免中斷和嚴重損壞 |Microsoft 文件"
description: "描述您可以使用 tooprotect 應用程式，避免潛在的服務匯流排中斷的技術。"
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: tysonn
ms.assetid: fd9fa8ab-f4c4-43f7-974f-c876df1614d4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/12/2017
ms.author: sethm
ms.openlocfilehash: 349b4968456c9f15375753d83495246f5a3ddfdb
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="best-practices-for-insulating-applications-against-service-bus-outages-and-disasters"></a><span data-ttu-id="3a110-103">將應用程式與服務匯流排中斷和災難隔絕的最佳做法</span><span class="sxs-lookup"><span data-stu-id="3a110-103">Best practices for insulating applications against Service Bus outages and disasters</span></span>
<span data-ttu-id="3a110-104">關鍵任務應用程式必須持續作業，即使在未計劃的中斷或災害 hello 存在。</span><span class="sxs-lookup"><span data-stu-id="3a110-104">Mission-critical applications must operate continuously, even in hello presence of unplanned outages or disasters.</span></span> <span data-ttu-id="3a110-105">本主題描述您可以使用 tooprotect 服務匯流排應用程式，避免造成服務中斷或災害的技術。</span><span class="sxs-lookup"><span data-stu-id="3a110-105">This topic describes techniques you can use tooprotect Service Bus applications against a potential service outage or disaster.</span></span>

<span data-ttu-id="3a110-106">中斷的定義是作為 Azure 服務匯流排 hello 暫時無法使用。</span><span class="sxs-lookup"><span data-stu-id="3a110-106">An outage is defined as hello temporary unavailability of Azure Service Bus.</span></span> <span data-ttu-id="3a110-107">hello 中斷可能會影響服務匯流排的某些元件，例如訊息存放區或甚至 hello 整個資料中心。</span><span class="sxs-lookup"><span data-stu-id="3a110-107">hello outage can affect some components of Service Bus, such as a messaging store, or even hello entire datacenter.</span></span> <span data-ttu-id="3a110-108">已修正 hello 問題之後，服務匯流排再次變為無法使用。</span><span class="sxs-lookup"><span data-stu-id="3a110-108">After hello problem has been fixed, Service Bus becomes available again.</span></span> <span data-ttu-id="3a110-109">中斷通常不會導致訊息或其他資料遺失。</span><span class="sxs-lookup"><span data-stu-id="3a110-109">Typically, an outage does not cause loss of messages or other data.</span></span> <span data-ttu-id="3a110-110">元件失敗的範例是 hello 無法使用特定的訊息存放區。</span><span class="sxs-lookup"><span data-stu-id="3a110-110">An example of a component failure is hello unavailability of a particular messaging store.</span></span> <span data-ttu-id="3a110-111">在全資料中心中斷的範例是停電 hello 資料中心，或錯誤的資料中心網路交換器。</span><span class="sxs-lookup"><span data-stu-id="3a110-111">An example of a datacenter-wide outage is a power failure of hello datacenter, or a faulty datacenter network switch.</span></span> <span data-ttu-id="3a110-112">中斷可能持續數分鐘 tooa 幾天。</span><span class="sxs-lookup"><span data-stu-id="3a110-112">An outage can last from a few minutes tooa few days.</span></span>

<span data-ttu-id="3a110-113">災害的定義是服務匯流排擴充單元或資料中心的 hello 永久遺失。</span><span class="sxs-lookup"><span data-stu-id="3a110-113">A disaster is defined as hello permanent loss of a Service Bus scale unit or datacenter.</span></span> <span data-ttu-id="3a110-114">hello 資料中心可能會或可能不會變成可用一次。</span><span class="sxs-lookup"><span data-stu-id="3a110-114">hello datacenter may or may not become available again.</span></span> <span data-ttu-id="3a110-115">災害通常會造成部分或所有訊息或其他資料遺失。</span><span class="sxs-lookup"><span data-stu-id="3a110-115">Typically a disaster causes loss of some or all messages or other data.</span></span> <span data-ttu-id="3a110-116">災害的範例包括火災、水災或地震。</span><span class="sxs-lookup"><span data-stu-id="3a110-116">Examples of disasters are fire, flooding, or earthquake.</span></span>

## <a name="current-architecture"></a><span data-ttu-id="3a110-117">目前架構</span><span class="sxs-lookup"><span data-stu-id="3a110-117">Current architecture</span></span>
<span data-ttu-id="3a110-118">服務匯流排也使用 tooqueues 或主題傳送的多個訊息存放區 toostore 訊息。</span><span class="sxs-lookup"><span data-stu-id="3a110-118">Service Bus uses multiple messaging stores toostore messages that are sent tooqueues or topics.</span></span> <span data-ttu-id="3a110-119">非資料分割的佇列或主題會指派 tooone 訊息存放區。</span><span class="sxs-lookup"><span data-stu-id="3a110-119">A non-partitioned queue or topic is assigned tooone messaging store.</span></span> <span data-ttu-id="3a110-120">如果此訊息存放區無法使用，該佇列或主題上的所有作業都會失敗。</span><span class="sxs-lookup"><span data-stu-id="3a110-120">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span>

<span data-ttu-id="3a110-121">所有服務匯流排訊息實體 (佇列、主題、轉送) 都位於附屬於資料中心的服務命名空間中。</span><span class="sxs-lookup"><span data-stu-id="3a110-121">All Service Bus messaging entities (queues, topics, relays) reside in a service namespace, which is affiliated with a datacenter.</span></span> <span data-ttu-id="3a110-122">Service Bus 不會啟用自動複寫地理資料，也不允許命名空間 toospan 多個資料中心。</span><span class="sxs-lookup"><span data-stu-id="3a110-122">Service Bus does not enable automatic geo-replication of data, nor does it allow a namespace toospan multiple datacenters.</span></span>

## <a name="protecting-against-acs-outages"></a><span data-ttu-id="3a110-123">保護 ACS 免於中斷</span><span class="sxs-lookup"><span data-stu-id="3a110-123">Protecting against ACS outages</span></span>
<span data-ttu-id="3a110-124">如果您使用 ACS 認證，ACS 會無法使用，用戶端也無法再取得權杖。</span><span class="sxs-lookup"><span data-stu-id="3a110-124">If you are using ACS credentials, and ACS becomes unavailable, clients can no longer obtain tokens.</span></span> <span data-ttu-id="3a110-125">在 ACS 中斷 hello 時擁有權杖的用戶端可以繼續 toouse 服務匯流排，直到 hello 權杖到期。</span><span class="sxs-lookup"><span data-stu-id="3a110-125">Clients that have a token at hello time ACS goes down can continue toouse Service Bus until hello tokens expire.</span></span> <span data-ttu-id="3a110-126">hello 權杖存留期為 3 小時。</span><span class="sxs-lookup"><span data-stu-id="3a110-126">hello default token lifetime is 3 hours.</span></span>

<span data-ttu-id="3a110-127">tooprotect ACS 免於中斷，請使用共用存取簽章 (SAS) 權杖。</span><span class="sxs-lookup"><span data-stu-id="3a110-127">tooprotect against ACS outages, use Shared Access Signature (SAS) tokens.</span></span> <span data-ttu-id="3a110-128">在此情況下，hello 用戶端直接與 Service Bus 驗證與秘密金鑰簽署自行產生的語彙基元。</span><span class="sxs-lookup"><span data-stu-id="3a110-128">In this case, hello client authenticates directly with Service Bus by signing a self-minted token with a secret key.</span></span> <span data-ttu-id="3a110-129">呼叫 tooACS 不再需要。</span><span class="sxs-lookup"><span data-stu-id="3a110-129">Calls tooACS are no longer required.</span></span> <span data-ttu-id="3a110-130">如需有關 SAS 權杖的詳細資訊，請參閱[服務匯流排驗證][Service Bus authentication]。</span><span class="sxs-lookup"><span data-stu-id="3a110-130">For more information about SAS tokens, see [Service Bus authentication][Service Bus authentication].</span></span>

## <a name="protecting-queues-and-topics-against-messaging-store-failures"></a><span data-ttu-id="3a110-131">保護佇列和主題免於發生訊息存放區失敗</span><span class="sxs-lookup"><span data-stu-id="3a110-131">Protecting queues and topics against messaging store failures</span></span>
<span data-ttu-id="3a110-132">非資料分割的佇列或主題會指派 tooone 訊息存放區。</span><span class="sxs-lookup"><span data-stu-id="3a110-132">A non-partitioned queue or topic is assigned tooone messaging store.</span></span> <span data-ttu-id="3a110-133">如果此訊息存放區無法使用，該佇列或主題上的所有作業都會失敗。</span><span class="sxs-lookup"><span data-stu-id="3a110-133">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="3a110-134">A 進行資料分割的佇列，請在 hello 另一方面，包含多個片段。</span><span class="sxs-lookup"><span data-stu-id="3a110-134">A partitioned queue, on hello other hand, consists of multiple fragments.</span></span> <span data-ttu-id="3a110-135">每個片段都儲存在不同的訊息存放區。</span><span class="sxs-lookup"><span data-stu-id="3a110-135">Each fragment is stored in a different messaging store.</span></span> <span data-ttu-id="3a110-136">當訊息傳送 tooa 分割的佇列或主題時，服務匯流排會指派 hello 訊息 tooone 的 hello 片段。</span><span class="sxs-lookup"><span data-stu-id="3a110-136">When a message is sent tooa partitioned queue or topic, Service Bus assigns hello message tooone of hello fragments.</span></span> <span data-ttu-id="3a110-137">Hello 對應的訊息存放區無法使用時，服務匯流排盡可能寫入 hello 訊息 tooa 不同的片段。</span><span class="sxs-lookup"><span data-stu-id="3a110-137">If hello corresponding messaging store is unavailable, Service Bus writes hello message tooa different fragment, if possible.</span></span> <span data-ttu-id="3a110-138">如需分割實體的詳細資訊，請參閱[分割的傳訊實體][Partitioned messaging entities]。</span><span class="sxs-lookup"><span data-stu-id="3a110-138">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

## <a name="protecting-against-datacenter-outages-or-disasters"></a><span data-ttu-id="3a110-139">保護資料中心免於中斷或災害</span><span class="sxs-lookup"><span data-stu-id="3a110-139">Protecting against datacenter outages or disasters</span></span>
<span data-ttu-id="3a110-140">tooallow 兩個資料中心之間的容錯移轉，您可以在每個資料中心內建立服務匯流排服務命名空間。</span><span class="sxs-lookup"><span data-stu-id="3a110-140">tooallow for a failover between two datacenters, you can create a Service Bus service namespace in each datacenter.</span></span> <span data-ttu-id="3a110-141">例如，hello 服務匯流排服務命名空間**contosoPrimary.servicebus.windows.net**可能位於 hello 美國北部/中部地區，以及**contosoSecondary.servicebus.windows.net**可能位於 hello 美國南部/中部地區。</span><span class="sxs-lookup"><span data-stu-id="3a110-141">For example, hello Service Bus service namespace **contosoPrimary.servicebus.windows.net** might be located in hello United States North/Central region, and **contosoSecondary.servicebus.windows.net** might be located in hello US South/Central region.</span></span> <span data-ttu-id="3a110-142">如果服務匯流排訊息實體必須保持在 hello 出現在資料中心中斷中存取，您可以在兩個命名空間中建立該實體。</span><span class="sxs-lookup"><span data-stu-id="3a110-142">If a Service Bus messaging entity must remain accessible in hello presence of a datacenter outage, you can create that entity in both namespaces.</span></span>

<span data-ttu-id="3a110-143">如需詳細資訊，請參閱 「 Azure 資料中心中的服務匯流排失敗 」 一節中的 hello[非同步訊息模式和高可用性][Asynchronous messaging patterns and high availability]。</span><span class="sxs-lookup"><span data-stu-id="3a110-143">For more information, see hello "Failure of Service Bus within an Azure datacenter" section in [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability].</span></span>

## <a name="protecting-relay-endpoints-against-datacenter-outages-or-disasters"></a><span data-ttu-id="3a110-144">保護轉送端點免於發生資料中心中斷或災害</span><span class="sxs-lookup"><span data-stu-id="3a110-144">Protecting relay endpoints against datacenter outages or disasters</span></span>
<span data-ttu-id="3a110-145">轉送端點的地理複寫可讓您公開轉送端點 toobe 在 hello 存在的服務匯流排中斷連線的服務。</span><span class="sxs-lookup"><span data-stu-id="3a110-145">Geo-replication of relay endpoints allows a service that exposes a relay endpoint toobe reachable in hello presence of Service Bus outages.</span></span> <span data-ttu-id="3a110-146">tooachieve 異地複寫，hello 服務必須在不同的命名空間中建立兩個轉送端點。</span><span class="sxs-lookup"><span data-stu-id="3a110-146">tooachieve geo-replication, hello service must create two relay endpoints in different namespaces.</span></span> <span data-ttu-id="3a110-147">hello 命名空間必須位於不同的資料中心和 hello 兩個端點必須具有不同的名稱。</span><span class="sxs-lookup"><span data-stu-id="3a110-147">hello namespaces must reside in different datacenters and hello two endpoints must have different names.</span></span> <span data-ttu-id="3a110-148">比方說，主要端點在 **contosoPrimary.servicebus.windows.net/myPrimaryService** 之下達到，而其次要的對應項目可以在 **contosoSecondary.servicebus.windows.net/mySecondaryService** 之下達到。</span><span class="sxs-lookup"><span data-stu-id="3a110-148">For example, a primary endpoint can be reached under **contosoPrimary.servicebus.windows.net/myPrimaryService**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span></span>

<span data-ttu-id="3a110-149">hello 服務接著會接聽這兩個端點，並且需要透過任一端點的 hello 服務叫用用戶端。</span><span class="sxs-lookup"><span data-stu-id="3a110-149">hello service then listens on both endpoints, and a client can invoke hello service via either endpoint.</span></span> <span data-ttu-id="3a110-150">用戶端應用程式隨機挑選其中一個 hello 轉送，因為 hello 主要端點，並傳送其要求 toohello 主動端點。</span><span class="sxs-lookup"><span data-stu-id="3a110-150">A client application randomly picks one of hello relays as hello primary endpoint, and sends its request toohello active endpoint.</span></span> <span data-ttu-id="3a110-151">如果 hello 作業失敗並出現錯誤代碼，此失敗表示該 hello 轉送端點無法使用。</span><span class="sxs-lookup"><span data-stu-id="3a110-151">If hello operation fails with an error code, this failure indicates that hello relay endpoint is not available.</span></span> <span data-ttu-id="3a110-152">hello 應用程式會開啟通道 toohello 備份端點，並重新發出 hello 要求。</span><span class="sxs-lookup"><span data-stu-id="3a110-152">hello application opens a channel toohello backup endpoint and reissues hello request.</span></span> <span data-ttu-id="3a110-153">在該點作用中的 hello 和 hello 備份端點會互換角色： hello 用戶端應用程式將視 hello 舊的主動端點 toobe hello 新的備份端點，而舊備份端點 toobe hello hello 新的主動端點。</span><span class="sxs-lookup"><span data-stu-id="3a110-153">At that point hello active and hello backup endpoints switch roles: hello client application considers hello old active endpoint toobe hello new backup endpoint, and hello old backup endpoint toobe hello new active endpoint.</span></span> <span data-ttu-id="3a110-154">如果兩個傳送作業失敗，hello 角色 hello 兩個實體都維持不變，則會傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="3a110-154">If both send operations fail, hello roles of hello two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="3a110-155">hello[地理複寫具有服務匯流排轉送訊息][ Geo-replication with Service Bus relayed Messages]範例會示範如何將 tooreplicate 轉送。</span><span class="sxs-lookup"><span data-stu-id="3a110-155">hello [Geo-replication with Service Bus relayed messages][Geo-replication with Service Bus relayed Messages] sample demonstrates how tooreplicate relays.</span></span>

## <a name="protecting-queues-and-topics-against-datacenter-outages-or-disasters"></a><span data-ttu-id="3a110-156">保護佇列和主題免於發生資料中心中斷或災害</span><span class="sxs-lookup"><span data-stu-id="3a110-156">Protecting queues and topics against datacenter outages or disasters</span></span>
<span data-ttu-id="3a110-157">針對資料中心中斷時使用代理傳訊 tooachieve 恢復功能，服務匯流排支援兩種方法： *active*和*被動*複寫。</span><span class="sxs-lookup"><span data-stu-id="3a110-157">tooachieve resilience against datacenter outages when using brokered messaging, Service Bus supports two approaches: *active* and *passive* replication.</span></span> <span data-ttu-id="3a110-158">每個方法，如果給定的佇列或主題必須保持可存取在 hello 出現在資料中心中斷，您可以建立它在這兩個命名空間中。</span><span class="sxs-lookup"><span data-stu-id="3a110-158">For each approach, if a given queue or topic must remain accessible in hello presence of a datacenter outage, you can create it in both namespaces.</span></span> <span data-ttu-id="3a110-159">這兩個實體可以具有 hello 相同的名稱。</span><span class="sxs-lookup"><span data-stu-id="3a110-159">Both entities can have hello same name.</span></span> <span data-ttu-id="3a110-160">比方說，主要佇列在 **contosoPrimary.servicebus.windows.net/myQueue** 之下達到，而其次要的對應項目可以在 **contosoSecondary.servicebus.windows.net/myQueue** 之下達到。</span><span class="sxs-lookup"><span data-stu-id="3a110-160">For example, a primary queue can be reached under **contosoPrimary.servicebus.windows.net/myQueue**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/myQueue**.</span></span>

<span data-ttu-id="3a110-161">如果 hello 應用程式不需要永久的傳送者與接收者通訊，hello 應用程式可以實作長期的用戶端佇列 tooprevent 訊息遺失和 tooshield hello 寄件者的任何暫時性的服務匯流排錯誤。</span><span class="sxs-lookup"><span data-stu-id="3a110-161">If hello application does not require permanent sender-to-receiver communication, hello application can implement a durable client-side queue tooprevent message loss and tooshield hello sender from any transient Service Bus errors.</span></span>

## <a name="active-replication"></a><span data-ttu-id="3a110-162">主動複寫</span><span class="sxs-lookup"><span data-stu-id="3a110-162">Active replication</span></span>
<span data-ttu-id="3a110-163">主動複寫會針對每個作業使用兩個命名空間中的實體。</span><span class="sxs-lookup"><span data-stu-id="3a110-163">Active replication uses entities in both namespaces for every operation.</span></span> <span data-ttu-id="3a110-164">將訊息傳送的任何用戶端會傳送 hello 的兩份相同的訊息。</span><span class="sxs-lookup"><span data-stu-id="3a110-164">Any client that sends a message sends two copies of hello same message.</span></span> <span data-ttu-id="3a110-165">hello 第一次複製傳送 toohello 主要實體 (例如， **contosoPrimary.servicebus.windows.net/sales**)，且 toohello 次要實體會傳送 hello 第二個副本 hello 訊息 (比方說， **contosoSecondary.servicebus.windows.net/sales**)。</span><span class="sxs-lookup"><span data-stu-id="3a110-165">hello first copy is sent toohello primary entity (for example, **contosoPrimary.servicebus.windows.net/sales**), and hello second copy of hello message is sent toohello secondary entity (for example, **contosoSecondary.servicebus.windows.net/sales**).</span></span>

<span data-ttu-id="3a110-166">用戶端會從這兩個佇列接收訊息。</span><span class="sxs-lookup"><span data-stu-id="3a110-166">A client receives messages from both queues.</span></span> <span data-ttu-id="3a110-167">hello 接收者處理程序 hello 第一個訊息的複本，並隱藏 hello 第二個副本。</span><span class="sxs-lookup"><span data-stu-id="3a110-167">hello receiver processes hello first copy of a message, and hello second copy is suppressed.</span></span> <span data-ttu-id="3a110-168">toosuppress 重複的訊息，hello 寄件者必須標記每個訊息具有唯一識別碼。</span><span class="sxs-lookup"><span data-stu-id="3a110-168">toosuppress duplicate messages, hello sender must tag each message with a unique identifier.</span></span> <span data-ttu-id="3a110-169">Hello hello 訊息的兩個複本必須標記相同的識別項。</span><span class="sxs-lookup"><span data-stu-id="3a110-169">Both copies of hello message must be tagged with hello same identifier.</span></span> <span data-ttu-id="3a110-170">您可以使用 hello [BrokeredMessage.MessageId] [ BrokeredMessage.MessageId]或[BrokeredMessage.Label] [ BrokeredMessage.Label]屬性或使用自訂屬性 tootag hello訊息。</span><span class="sxs-lookup"><span data-stu-id="3a110-170">You can use hello [BrokeredMessage.MessageId][BrokeredMessage.MessageId] or [BrokeredMessage.Label][BrokeredMessage.Label] properties, or a custom property tootag hello message.</span></span> <span data-ttu-id="3a110-171">hello 接收者必須維護它已經收到的訊息清單。</span><span class="sxs-lookup"><span data-stu-id="3a110-171">hello receiver must maintain a list of messages that it has already received.</span></span>

<span data-ttu-id="3a110-172">hello[地理複寫使用服務匯流排代理訊息][ Geo-replication with Service Bus Brokered Messages]範例將示範傳訊實體的作用中複寫。</span><span class="sxs-lookup"><span data-stu-id="3a110-172">hello [Geo-replication with Service Bus Brokered Messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates active replication of messaging entities.</span></span>

> [!NOTE]
> <span data-ttu-id="3a110-173">hello 主動複寫方法會讓 hello 作業數目加倍，因此這種方法可能會導致 toohigher 成本。</span><span class="sxs-lookup"><span data-stu-id="3a110-173">hello active replication approach doubles hello number of operations, therefore this approach can lead toohigher cost.</span></span>
> 
> 

## <a name="passive-replication"></a><span data-ttu-id="3a110-174">被動複寫</span><span class="sxs-lookup"><span data-stu-id="3a110-174">Passive replication</span></span>
<span data-ttu-id="3a110-175">在 hello 無錯誤的情況下，被動複寫會使用其中一個 hello 兩個訊息實體。</span><span class="sxs-lookup"><span data-stu-id="3a110-175">In hello fault-free case, passive replication uses only one of hello two messaging entities.</span></span> <span data-ttu-id="3a110-176">用戶端會傳送 hello 訊息 toohello 主動實體。</span><span class="sxs-lookup"><span data-stu-id="3a110-176">A client sends hello message toohello active entity.</span></span> <span data-ttu-id="3a110-177">如果 hello hello 主動實體作業失敗錯誤碼，指出 hello 主機 hello 主動實體可能會無法使用的資料中心，hello 用戶端會傳送 hello 訊息 toohello 備份實體的複本。</span><span class="sxs-lookup"><span data-stu-id="3a110-177">If hello operation on hello active entity fails with an error code that indicates hello datacenter that hosts hello active entity might be unavailable, hello client sends a copy of hello message toohello backup entity.</span></span> <span data-ttu-id="3a110-178">在該點作用中的 hello 和 hello 備份實體會互換角色： hello 傳送用戶端會考慮 hello 舊主動實體 toobe hello 新的備份實體，而且 hello 舊的備份實體 hello 新的主動實體。</span><span class="sxs-lookup"><span data-stu-id="3a110-178">At that point hello active and hello backup entities switch roles: hello sending client considers hello old active entity toobe hello new backup entity, and hello old backup entity is hello new active entity.</span></span> <span data-ttu-id="3a110-179">如果兩個傳送作業失敗，hello 角色 hello 兩個實體都維持不變，則會傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="3a110-179">If both send operations fail, hello roles of hello two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="3a110-180">用戶端會從這兩個佇列接收訊息。</span><span class="sxs-lookup"><span data-stu-id="3a110-180">A client receives messages from both queues.</span></span> <span data-ttu-id="3a110-181">因為沒有機會該 hello 接收者收到兩份相同訊息、 hello hello 接收者必須抑制重複的訊息。</span><span class="sxs-lookup"><span data-stu-id="3a110-181">Because there is a chance that hello receiver receives two copies of hello same message, hello receiver must suppress duplicate messages.</span></span> <span data-ttu-id="3a110-182">您可以隱藏重複項目在 hello 方式所述相同的作用中複寫。</span><span class="sxs-lookup"><span data-stu-id="3a110-182">You can suppress duplicates in hello same way as described for active replication.</span></span>

<span data-ttu-id="3a110-183">一般而言，被動複寫比主動複寫更具經濟效益，因為大部分的情形只會執行一項作業。</span><span class="sxs-lookup"><span data-stu-id="3a110-183">In general, passive replication is more economical than active replication because in most cases only one operation is performed.</span></span> <span data-ttu-id="3a110-184">延遲、 輸送量和貨幣成本會與相同 toohello 非複寫案例。</span><span class="sxs-lookup"><span data-stu-id="3a110-184">Latency, throughput, and monetary cost are identical toohello non-replicated scenario.</span></span>

<span data-ttu-id="3a110-185">使用被動複寫時，在 hello 下列案例訊息可能遺失或收到兩次：</span><span class="sxs-lookup"><span data-stu-id="3a110-185">When using passive replication, in hello following scenarios messages can be lost or received twice:</span></span>

* <span data-ttu-id="3a110-186">**訊息延遲或遺失**： 假設 hello 寄件者已成功傳送訊息 m1 toohello 主要佇列，並再 hello 佇列變得無法使用 hello 接收者接收 m1 之前。</span><span class="sxs-lookup"><span data-stu-id="3a110-186">**Message delay or loss**: Assume that hello sender successfully sent a message m1 toohello primary queue, and then hello queue becomes unavailable before hello receiver receives m1.</span></span> <span data-ttu-id="3a110-187">hello 寄件者會傳送後續訊息 m2 toohello 次要佇列。</span><span class="sxs-lookup"><span data-stu-id="3a110-187">hello sender sends a subsequent message m2 toohello secondary queue.</span></span> <span data-ttu-id="3a110-188">如果 hello 主要佇列暫時無法使用，hello 接收者 hello 佇列再次可用後，就會收到 m1。</span><span class="sxs-lookup"><span data-stu-id="3a110-188">If hello primary queue is temporarily unavailable, hello receiver receives m1 after hello queue becomes available again.</span></span> <span data-ttu-id="3a110-189">萬一發生災害，hello 接收者可能不會收到 m1。</span><span class="sxs-lookup"><span data-stu-id="3a110-189">In case of a disaster, hello receiver may never receive m1.</span></span>
* <span data-ttu-id="3a110-190">**重複接收**： 假設該 hello 寄件者傳送訊息 m toohello 主要佇列。</span><span class="sxs-lookup"><span data-stu-id="3a110-190">**Duplicate reception**: Assume that hello sender sends a message m toohello primary queue.</span></span> <span data-ttu-id="3a110-191">服務匯流排成功處理 m，但失敗 toosend 回應。</span><span class="sxs-lookup"><span data-stu-id="3a110-191">Service Bus successfully processes m but fails toosend a response.</span></span> <span data-ttu-id="3a110-192">Hello 傳送作業逾時之後，hello 寄件者會傳送一份完全相同 m toohello 次要佇列。</span><span class="sxs-lookup"><span data-stu-id="3a110-192">After hello send operation times out, hello sender sends an identical copy of m toohello secondary queue.</span></span> <span data-ttu-id="3a110-193">如果 hello 接收者可以 tooreceive hello 第一份 m hello 主要佇列變成無法使用之前，hello 接收者收到兩份 m 大約 hello 在相同的時間。</span><span class="sxs-lookup"><span data-stu-id="3a110-193">If hello receiver is able tooreceive hello first copy of m before hello primary queue becomes unavailable, hello receiver receives both copies of m at approximately hello same time.</span></span> <span data-ttu-id="3a110-194">如果 hello 接收者不能 tooreceive hello 第一份 m hello 主要佇列變成無法使用之前，hello 接收者一開始會收到僅 hello 第二個複本 m，但 hello 主要佇列再次可用時就會接收第二份 m。</span><span class="sxs-lookup"><span data-stu-id="3a110-194">If hello receiver is not able tooreceive hello first copy of m before hello primary queue becomes unavailable, hello receiver initially receives only hello second copy of m, but then receives a second copy of m when hello primary queue becomes available.</span></span>

<span data-ttu-id="3a110-195">hello[地理複寫具有服務匯流排代理訊息][ Geo-replication with Service Bus Brokered Messages]範例將示範傳訊實體的被動複寫。</span><span class="sxs-lookup"><span data-stu-id="3a110-195">hello [Geo-replication with Service Bus brokered messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates passive replication of messaging entities.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3a110-196">後續步驟</span><span class="sxs-lookup"><span data-stu-id="3a110-196">Next steps</span></span>
<span data-ttu-id="3a110-197">toolearn 進一步了解災害復原，請參閱下列文章：</span><span class="sxs-lookup"><span data-stu-id="3a110-197">toolearn more about disaster recovery, see these articles:</span></span>

* <span data-ttu-id="3a110-198">[Azure SQL Database 商務持續性][Azure SQL Database Business Continuity]</span><span class="sxs-lookup"><span data-stu-id="3a110-198">[Azure SQL Database Business Continuity][Azure SQL Database Business Continuity]</span></span>
* <span data-ttu-id="3a110-199">[為 Azure 設計有彈性的應用程式][Azure resiliency technical guidance]</span><span class="sxs-lookup"><span data-stu-id="3a110-199">[Designing resilient applications for Azure][Azure resiliency technical guidance]</span></span>

[Service Bus Authentication]: service-bus-authentication-and-authorization.md
[Partitioned messaging entities]: service-bus-partitioning.md
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md#failure-of-service-bus-within-an-azure-datacenter
[Geo-replication with Service Bus Relayed Messages]: http://code.msdn.microsoft.com/Geo-replication-with-16dbfecd
[BrokeredMessage.MessageId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId
[BrokeredMessage.Label]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label
[Geo-replication with Service Bus Brokered Messages]: http://code.msdn.microsoft.com/Geo-replication-with-f5688664
[Azure SQL Database Business Continuity]: ../sql-database/sql-database-business-continuity.md
[Azure resiliency technical guidance]: /azure/architecture/resiliency
