---
title: "最佳化 ExpressRoute 路由：Azure | Microsoft Docs"
description: "此頁面提供當您有一個以上的 ExpressRoute 線路連接 Microsoft 與您的公司網路時，如何最佳化路由的詳細資訊。"
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: c3a85b9445d69330c3f6c7d298169efddb6ecca0
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="1eece-103">最佳化 ExpressRoute 路由</span><span class="sxs-lookup"><span data-stu-id="1eece-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="1eece-104">當您有多個 ExpressRoute 線路時，會有一個以上的路徑來連線到 Microsoft。</span><span class="sxs-lookup"><span data-stu-id="1eece-104">When you have multiple ExpressRoute circuits, you have more than one path to connect to Microsoft.</span></span> <span data-ttu-id="1eece-105">因此，可能會產生次佳的路由 - 也就是，您的流量可能會經由較長的路徑連到 Microsoft，而 Microsoft 也可能會經由較長的路徑連到您的網路。</span><span class="sxs-lookup"><span data-stu-id="1eece-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path to reach Microsoft, and Microsoft to your network.</span></span> <span data-ttu-id="1eece-106">網路路徑愈常，延遲愈久。</span><span class="sxs-lookup"><span data-stu-id="1eece-106">The longer the network path, the higher the latency.</span></span> <span data-ttu-id="1eece-107">延遲對於應用程式效能和使用者體驗有直接的影響。</span><span class="sxs-lookup"><span data-stu-id="1eece-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="1eece-108">本文將說明這個問題，並說明如何使用標準路由技術來最佳化路由。</span><span class="sxs-lookup"><span data-stu-id="1eece-108">This article will illustrate this problem and explain how to optimize routing using the standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-to-microsoft"></a><span data-ttu-id="1eece-109">從客戶到 Microsoft 的次佳化路由</span><span class="sxs-lookup"><span data-stu-id="1eece-109">Suboptimal routing from customer to Microsoft</span></span>
<span data-ttu-id="1eece-110">讓我們依照範例仔細觀察路由問題。</span><span class="sxs-lookup"><span data-stu-id="1eece-110">Let's take a close look at the routing problem by an example.</span></span> <span data-ttu-id="1eece-111">假設您在美國有兩個辦公室，一個在洛杉磯，一個在紐約。</span><span class="sxs-lookup"><span data-stu-id="1eece-111">Imagine you have two offices in the US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="1eece-112">您的辦公室是在廣域網路 (WAN) 上連線，該網路可以是您自己的骨幹網路或服務提供者的 IP VPN。</span><span class="sxs-lookup"><span data-stu-id="1eece-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="1eece-113">您有兩個也是在 WAN 上連線的 ExpressRoute 線路，一個在美國西部，一個在美國東部。</span><span class="sxs-lookup"><span data-stu-id="1eece-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on the WAN.</span></span> <span data-ttu-id="1eece-114">很明顯地，您有兩個路徑可連線到 Microsoft 網路。</span><span class="sxs-lookup"><span data-stu-id="1eece-114">Obviously, you have two paths to connect to the Microsoft network.</span></span> <span data-ttu-id="1eece-115">現在假設您在美國西部和美國東部均有 Azure 部署 (例如 Azure App Service)。</span><span class="sxs-lookup"><span data-stu-id="1eece-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="1eece-116">您的用意是要將洛杉磯的使用者連接到 Azure 美國西部以及將紐約的使用者連接到 Azure 美國東部，因為您的服務系統管理員告知每個辦公室的使用者存取附近的 Azure 服務以獲得最佳的體驗。</span><span class="sxs-lookup"><span data-stu-id="1eece-116">Your intention is to connect your users in Los Angeles to Azure US West and your users in New York to Azure US East because your service admin advertises that users in each office access the nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="1eece-117">不幸的是，此計畫比較適合用於東岸的使用者，但不適用於西岸的使用者。</span><span class="sxs-lookup"><span data-stu-id="1eece-117">Unfortunately, the plan works out well for the east coast users but not for the west coast users.</span></span> <span data-ttu-id="1eece-118">此問題的原因如下所示。</span><span class="sxs-lookup"><span data-stu-id="1eece-118">The cause of the problem is the following.</span></span> <span data-ttu-id="1eece-119">在每個 ExpressRoute 線路上，我們會告知您 Azure 美國東部的前置詞 (23.100.0.0/16)和 Azure 美國西部的前置詞 (13.100.0.0/16)。</span><span class="sxs-lookup"><span data-stu-id="1eece-119">On each ExpressRoute circuit, we advertise to you both the prefix in Azure US East (23.100.0.0/16) and the prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="1eece-120">如果您不知道哪個前置詞來自哪個區域，您就無法將它視為不同。</span><span class="sxs-lookup"><span data-stu-id="1eece-120">If you don't know which prefix is from which region, you are not able to treat it differently.</span></span> <span data-ttu-id="1eece-121">您的 WAN 網路可能會認為這兩個前置詞比較接近美國東部 (相較於美國西部)，因此將兩個辦公室的使用者路由至美國東部的 ExpressRoute 線路。</span><span class="sxs-lookup"><span data-stu-id="1eece-121">Your WAN network may think both of the prefixes are closer to US East than US West and therefore route both office users to the ExpressRoute circuit in US East.</span></span> <span data-ttu-id="1eece-122">最後，洛杉磯辦公室會有許多使用者不太滿意。</span><span class="sxs-lookup"><span data-stu-id="1eece-122">In the end, you will have many unhappy users in the Los Angeles office.</span></span>

![ExpressRoute 案例 1 問題 - 從客戶到 Microsoft 的次佳化路由](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="1eece-124">解決方法︰使用 BGP 社群</span><span class="sxs-lookup"><span data-stu-id="1eece-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="1eece-125">若要為這兩個辦公室的使用者最佳化路由，您需要知道哪個前置詞來自 Azure 美國西部以及哪個前置詞來自 Azure 美國東部。</span><span class="sxs-lookup"><span data-stu-id="1eece-125">To optimize routing for both office users, you need to know which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="1eece-126">我們使用 [BGP 社群值](expressroute-routing.md)來編碼這項資訊。</span><span class="sxs-lookup"><span data-stu-id="1eece-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="1eece-127">我們已將唯一的 BGP 社群值指派給每個 Azure 區域，例如"12076:51004" 適用於美國東部，"12076:51006" 適用於美國西部。</span><span class="sxs-lookup"><span data-stu-id="1eece-127">We've assigned a unique BGP Community value to each Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="1eece-128">您現在知道哪個前置詞來自哪個 Azure 區域，即可設定應優先使用哪個 ExpressRoute 線路。</span><span class="sxs-lookup"><span data-stu-id="1eece-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="1eece-129">因為我們使用 BGP 來交換路由資訊，您可以使用 BGP 的本機喜好設定來影響路由。</span><span class="sxs-lookup"><span data-stu-id="1eece-129">Because we use the BGP to exchange routing info, you can use BGP's Local Preference to influence routing.</span></span> <span data-ttu-id="1eece-130">在我們的範例中，您可以指派比美國東部還要高的本機喜好設定值給美國西部的 13.100.0.0/16，同樣地，指派比美國西部還要高的本機喜好設定值給美國東部的 23.100.0.0/16。</span><span class="sxs-lookup"><span data-stu-id="1eece-130">In our example, you can assign a higher local preference value to 13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value to 23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="1eece-131">此組態可確保當Microsoft 的兩個路徑都可用時，洛杉磯的使用者將經由美國西部的 ExpressRoute 線路連接到 Azure 美國西部，而紐約的使用者會經由美國東部的 ExpressRoute 線路連接到 Azure 美國東部。</span><span class="sxs-lookup"><span data-stu-id="1eece-131">This configuration will make sure that, when both paths to Microsoft are available, your users in Los Angeles will take the ExpressRoute circuit in US West to connect to Azure US West whereas your users in New York take the ExpressRoute in US East to Azure US East.</span></span> <span data-ttu-id="1eece-132">這兩端的路由均已最佳化。</span><span class="sxs-lookup"><span data-stu-id="1eece-132">Routing is optimized on both sides.</span></span> 

![ExpressRoute 案例 1 解決方案 - 使用 BGP 社群](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="1eece-134">使用本機喜好設定的相同技巧，也可以套用至從客戶到 Azure 虛擬網路的路由。</span><span class="sxs-lookup"><span data-stu-id="1eece-134">The same technique, using Local Preference, can be applied to routing from customer to Azure Virtual Network.</span></span> <span data-ttu-id="1eece-135">我們不會將 BGP 社群值標記到從 Azure 公告到網路的前置詞。</span><span class="sxs-lookup"><span data-stu-id="1eece-135">We don't tag BGP Community value to the prefixes advertised from Azure to your network.</span></span> <span data-ttu-id="1eece-136">不過，由於您知道哪個虛擬網路部署較接近您的辦公室，因此您可以據以設定路由器，使其偏好某個 ExpressRoute 線路，而非另一個線路。</span><span class="sxs-lookup"><span data-stu-id="1eece-136">However, since you know which of your Virtual Network deployment is close to which of your office, you can configure your routers accordingly to prefer one ExpressRoute circuit to another.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-to-customer"></a><span data-ttu-id="1eece-137">從 Microsoft 到客戶的次佳化路由</span><span class="sxs-lookup"><span data-stu-id="1eece-137">Suboptimal routing from Microsoft to customer</span></span>
<span data-ttu-id="1eece-138">在下面的另一個範例中，來自 Microsoft 的連線經由較長的路徑連到您的網路。</span><span class="sxs-lookup"><span data-stu-id="1eece-138">Here is another example where connections from Microsoft take a longer path to reach your network.</span></span> <span data-ttu-id="1eece-139">在此情況下，您可在 [混合式環境](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx)中使用內部部署 Exchange 伺服器和 Exchange Online。</span><span class="sxs-lookup"><span data-stu-id="1eece-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="1eece-140">您的辦公室已連線到 WAN。</span><span class="sxs-lookup"><span data-stu-id="1eece-140">Your offices are connected to a WAN.</span></span> <span data-ttu-id="1eece-141">您告知兩個辦公室中內部部署伺服器的前置詞，以透過兩個 ExpressRoute 線路連到 Microsoft。</span><span class="sxs-lookup"><span data-stu-id="1eece-141">You advertise the prefixes of your on-premises servers in both of your offices to Microsoft through the two ExpressRoute circuits.</span></span> <span data-ttu-id="1eece-142">在信箱移轉的情況下，Exchange Online 會起始對內部部署伺服器的連線。</span><span class="sxs-lookup"><span data-stu-id="1eece-142">Exchange Online will initiate connections to the on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="1eece-143">不幸的是，在橫越整個大陸回到西岸之前，洛杉磯辦公室的連線會路由至美國東部的 ExpressRoute 線路。</span><span class="sxs-lookup"><span data-stu-id="1eece-143">Unfortunately, the connection to your Los Angeles office is routed to the ExpressRoute circuit in US East before traversing the entire continent back to the west coast.</span></span> <span data-ttu-id="1eece-144">此問題的原因類似第一個問題。</span><span class="sxs-lookup"><span data-stu-id="1eece-144">The cause of the problem is similar to the first one.</span></span> <span data-ttu-id="1eece-145">沒有任何提示，Microsoft 網路無法分辨哪個客戶前置詞接近美國東部，哪個接近美國西部。</span><span class="sxs-lookup"><span data-stu-id="1eece-145">Without any hint, the Microsoft network can't tell which customer prefix is close to US East and which one is close to US West.</span></span> <span data-ttu-id="1eece-146">有可能會對洛杉磯辦公室挑選錯誤的路徑。</span><span class="sxs-lookup"><span data-stu-id="1eece-146">It happens to pick the wrong path to your office in Los Angeles.</span></span>

![ExpressRoute 案例 2 - 從 Microsoft 到客戶的次佳化路由](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="1eece-148">解決方案︰使用 AS PATH 前置</span><span class="sxs-lookup"><span data-stu-id="1eece-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="1eece-149">這個問題有兩個解決方案。</span><span class="sxs-lookup"><span data-stu-id="1eece-149">There are two solutions to the problem.</span></span> <span data-ttu-id="1eece-150">第一個解決方案是您只需告知在美國西部 ExpressRoute 線路上洛杉磯辦公室的內部部署前置詞 (177.2.0.0/31)，以及美國東部 ExpressRoute 線路上紐約辦公室的內部部署前置詞 (177.2.0.2/31)。</span><span class="sxs-lookup"><span data-stu-id="1eece-150">The first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on the ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on the ExpressRoute circuit in US East.</span></span> <span data-ttu-id="1eece-151">如此一來，只有一個路徑可供 Microsoft 連接到每個辦公室。</span><span class="sxs-lookup"><span data-stu-id="1eece-151">As a result, there is only one path for Microsoft to connect to each of your offices.</span></span> <span data-ttu-id="1eece-152">沒有模稜兩可的狀況，而且路由已最佳化。</span><span class="sxs-lookup"><span data-stu-id="1eece-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="1eece-153">利用這個設計，您需要考慮您的容錯移轉策略。</span><span class="sxs-lookup"><span data-stu-id="1eece-153">With this design, you need to think about your failover strategy.</span></span> <span data-ttu-id="1eece-154">在經由 ExpressRoute 的 Microsoft 路徑已損毀的事件中，您需要確定 Exchange Online 仍可連線至內部部署伺服器。</span><span class="sxs-lookup"><span data-stu-id="1eece-154">In the event that the path to Microsoft via ExpressRoute is broken, you need to make sure that Exchange Online can still connect to your on-premises servers.</span></span> 

<span data-ttu-id="1eece-155">第二個解決方案是您繼續告知兩個 ExpressRoute 線路上的兩個前置詞，此外請提供哪個前置詞接近哪個辦公室的提示。</span><span class="sxs-lookup"><span data-stu-id="1eece-155">The second solution is that you continue to advertise both of the prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close to which one of your offices.</span></span> <span data-ttu-id="1eece-156">因為我們支援 BGP AS PATH 前置，所以您可以設定前置詞的 AS PATH 來影響路由。</span><span class="sxs-lookup"><span data-stu-id="1eece-156">Because we support BGP AS Path prepending, you can configure the AS Path for your prefix to influence routing.</span></span> <span data-ttu-id="1eece-157">在此範例中，您可以延長美國東部 172.2.0.0/31 的 AS PATH，以致我們偏好將美國西部的 ExpressRoute 線路用於以此前置詞為目的地的流量 (因為我們的網路會認為此前置詞的路徑在西部比較短)。</span><span class="sxs-lookup"><span data-stu-id="1eece-157">In this example, you can lengthen the AS PATH for 172.2.0.0/31 in US East so that we will prefer the ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think the path to this prefix is shorter in the west).</span></span> <span data-ttu-id="1eece-158">同樣地，您可以延長美國西部 172.2.0.2/31 的 AS PATH，以致我們偏好美國東部的 ExpressRoute 線路。</span><span class="sxs-lookup"><span data-stu-id="1eece-158">Similarly you can lengthen the AS PATH for 172.2.0.2/31 in US West so that we'll prefer the ExpressRoute circuit in US East.</span></span> <span data-ttu-id="1eece-159">這兩個辦公室的路由均已最佳化。</span><span class="sxs-lookup"><span data-stu-id="1eece-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="1eece-160">採用這個設計，如果一個 ExpressRoute 路線已中斷，Exchange Online 仍可透過另一個 ExpressRoute 線路和您的 WAN 來觸達您。</span><span class="sxs-lookup"><span data-stu-id="1eece-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="1eece-161">我們會針對在 Microsoft 對等上收到的前置詞，移除 AS PATH 中的私用 AS 編號。</span><span class="sxs-lookup"><span data-stu-id="1eece-161">We remove private AS numbers in the AS PATH for the prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="1eece-162">您必須在 AS PATH 中附加公用 AS 編號，才能影響 Microsoft 對等的路由。</span><span class="sxs-lookup"><span data-stu-id="1eece-162">You need to append public AS numbers in the AS PATH to influence routing for Microsoft Peering.</span></span>
> 
> 

![ExpressRoute 案例 2 解決方案 - 使用 AS PATH 前置](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="1eece-164">雖然此處提供的範例適用於 Microsoft 和公用對等互連，但我們仍支援私人對等互連的相同功能。</span><span class="sxs-lookup"><span data-stu-id="1eece-164">While the examples given here are for Microsoft and Public peerings, we do support the same capabilities for the Private peering.</span></span> <span data-ttu-id="1eece-165">此外，AS 路徑前置可在單一 ExpressRoute 路線內運作，以影響主要和次要路徑的選取範圍。</span><span class="sxs-lookup"><span data-stu-id="1eece-165">Also, the AS Path prepending works within one single ExpressRoute circuit, to influence the selection of the primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="1eece-166">虛擬網路之間的次佳化路由</span><span class="sxs-lookup"><span data-stu-id="1eece-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="1eece-167">透過 ExpressRoute，您可以啟用虛擬網路對虛擬網路 (也稱為「VNet」) 的通訊，方法是將它們連結至 ExpressRoute 線路。</span><span class="sxs-lookup"><span data-stu-id="1eece-167">With ExpressRoute, you can enable Virtual Network to Virtual Network (which is also known as "VNet") communication by linking them to an ExpressRoute circuit.</span></span> <span data-ttu-id="1eece-168">當您將它們連結至多個 ExpressRoute 線路時，VNet 之間就會發生次佳化路由。</span><span class="sxs-lookup"><span data-stu-id="1eece-168">When you link them to multiple ExpressRoute circuits, suboptimal routing can happen between the VNets.</span></span> <span data-ttu-id="1eece-169">我們來看一個範例。</span><span class="sxs-lookup"><span data-stu-id="1eece-169">Let's consider an example.</span></span> <span data-ttu-id="1eece-170">您有兩個 ExpressRoute 線路，一個在美國西部，一個在美國東部。</span><span class="sxs-lookup"><span data-stu-id="1eece-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="1eece-171">而在這兩個區域中，您各有兩個 VNet。</span><span class="sxs-lookup"><span data-stu-id="1eece-171">In each region, you have two VNets.</span></span> <span data-ttu-id="1eece-172">您的 Web 伺服器部署在其中一個 VNet 中，應用程式伺服器則部署在另一個 VNet 中。</span><span class="sxs-lookup"><span data-stu-id="1eece-172">Your web servers are deployed in one VNet and application servers in the other.</span></span> <span data-ttu-id="1eece-173">為了備援，您將每個區域中的兩個 VNet 同時連結至本機 ExpressRoute 線路和遠端 ExpressRoute 線路。</span><span class="sxs-lookup"><span data-stu-id="1eece-173">For redundancy, you link the two VNets in each region to both the local ExpressRoute circuit and the remote ExpressRoute circuit.</span></span> <span data-ttu-id="1eece-174">如下所示，每個 VNet 有兩條路徑可通往另一個 VNet。</span><span class="sxs-lookup"><span data-stu-id="1eece-174">As can be seen below, from each VNet there are two paths to the other VNet.</span></span> <span data-ttu-id="1eece-175">VNet 不知道哪一個是本機 ExpressRoute 線路，哪一個是遠端 ExpressRoute 線路。</span><span class="sxs-lookup"><span data-stu-id="1eece-175">The VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="1eece-176">因此，當它們進行等價多路徑 (Equal-Cost-Multi-Path, ECMP) 路由作業以將 VNet 間的流量負載平衡時，某些流量會經由較長的路徑，在遠端 ExpressRoute 線路進行路由。</span><span class="sxs-lookup"><span data-stu-id="1eece-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing to load-balance inter-VNet traffic, some traffic flows will take the longer path and get routed at the remote ExpressRoute circuit.</span></span>

![ExpressRoute 案例 3 - 虛擬網路之間的次佳化路由](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-to-local-connection"></a><span data-ttu-id="1eece-178">解決方案︰對本機連線指派高權數</span><span class="sxs-lookup"><span data-stu-id="1eece-178">Solution: assign a high weight to local connection</span></span>
<span data-ttu-id="1eece-179">解決方法很簡單。</span><span class="sxs-lookup"><span data-stu-id="1eece-179">The solution is simple.</span></span> <span data-ttu-id="1eece-180">既然您知道 VNet 與線路在哪，您可以告訴我們每個 VNet 應該偏好使用的路徑。</span><span class="sxs-lookup"><span data-stu-id="1eece-180">Since you know where the VNets and the circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="1eece-181">具體來說，在此範例中，您可以對本機連線指派比遠端連線更高的權數 (請參閱[這裡](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)的組態範例)。</span><span class="sxs-lookup"><span data-stu-id="1eece-181">Specifically for this example, you assign a higher weight to the local connection than to the remote connection (see the configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="1eece-182">當 VNet 在多個連線上收到另一個 VNet 的前置詞時，它會偏好使用權數最高的連線，來傳送以該前置詞為目的地的流量。</span><span class="sxs-lookup"><span data-stu-id="1eece-182">When a VNet receives the prefix of the other VNet on multiple connections it will prefer the connection with the highest weight to send traffic destined for that prefix.</span></span>

![ExpressRoute 案例 3 解決方案 - 對本機連線指派高權數](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="1eece-184">如果您有多個 ExpressRoute 線路，您也可以影響從 VNet 到內部部署網路的路由，方法是設定連線的權數而非套用 AS PATH 前置，後面這個技巧已在上面的第二個案例中做過說明。</span><span class="sxs-lookup"><span data-stu-id="1eece-184">You can also influence routing from VNet to your on-premises network, if you have multiple ExpressRoute circuits, by configuring the weight of a connection instead of applying AS PATH prepending, a technique described in the second scenario above.</span></span> <span data-ttu-id="1eece-185">對於每個前置詞，當我們在決定如何傳送流量時，一律會先查看連線權數再看 AS 路徑長度。</span><span class="sxs-lookup"><span data-stu-id="1eece-185">For each prefix, we will always look at the connection weight before the AS Path length when deciding how to send traffic.</span></span>
>
>
