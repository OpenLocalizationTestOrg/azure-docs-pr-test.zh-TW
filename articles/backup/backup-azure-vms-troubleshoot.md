---
title: "針對 Azure 虛擬機器的備份錯誤進行疑難排解 | Microsoft Docs"
description: "Azure 虛擬機器備份與還原的疑難排解"
services: backup
documentationcenter: 
author: trinadhk
manager: shreeshd
editor: 
ms.assetid: 73214212-57a4-4b57-a2e2-eaf9d7fde67f
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: trinadhk;markgal;jpallavi;
ms.openlocfilehash: dbd70bdbb17d99c5025018e76ea756b1b1528a3e
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="troubleshoot-azure-virtual-machine-backup"></a><span data-ttu-id="7d05b-103">Azure 虛擬機器備份的疑難排解</span><span class="sxs-lookup"><span data-stu-id="7d05b-103">Troubleshoot Azure virtual machine backup</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="7d05b-104">復原服務保存庫</span><span class="sxs-lookup"><span data-stu-id="7d05b-104">Recovery services vault</span></span>](backup-azure-vms-troubleshoot.md)
> * [<span data-ttu-id="7d05b-105">備份保存庫</span><span class="sxs-lookup"><span data-stu-id="7d05b-105">Backup vault</span></span>](backup-azure-vms-troubleshoot-classic.md)
>
>

<span data-ttu-id="7d05b-106">您可以疑難排解將 Azure 備份使用於下表所列資訊時發生的錯誤。</span><span class="sxs-lookup"><span data-stu-id="7d05b-106">You can troubleshoot errors encountered while using Azure Backup with information listed in the table below.</span></span>

## <a name="backup"></a><span data-ttu-id="7d05b-107">備份</span><span class="sxs-lookup"><span data-stu-id="7d05b-107">Backup</span></span>
| <span data-ttu-id="7d05b-108">錯誤詳細資料</span><span class="sxs-lookup"><span data-stu-id="7d05b-108">Error details</span></span> | <span data-ttu-id="7d05b-109">因應措施</span><span class="sxs-lookup"><span data-stu-id="7d05b-109">Workaround</span></span> |
| --- | --- |
| <span data-ttu-id="7d05b-110">無法執行作業，因為 VM 已不存在。</span><span class="sxs-lookup"><span data-stu-id="7d05b-110">Could not perform the operation as VM no longer exists.</span></span> <span data-ttu-id="7d05b-111">- 停止保護虛擬機器，但不刪除備份資料。</span><span class="sxs-lookup"><span data-stu-id="7d05b-111">- Stop protecting virtual machine without deleting backup data.</span></span> <span data-ttu-id="7d05b-112">http://go.microsoft.com/fwlink/?LinkId=808124 有更多詳細資料</span><span class="sxs-lookup"><span data-stu-id="7d05b-112">More details at http://go.microsoft.com/fwlink/?LinkId=808124</span></span> |<span data-ttu-id="7d05b-113">刪除主要 VM 後，但備份原則繼續尋找 VM 來備份時，就會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="7d05b-113">This happens when the primary VM is deleted, but the backup policy continues looking for a VM to back up.</span></span> <span data-ttu-id="7d05b-114">若要修正此錯誤：</span><span class="sxs-lookup"><span data-stu-id="7d05b-114">To fix this error:</span></span> <ol><li> <span data-ttu-id="7d05b-115">重新建立具有相同名稱和相同資源群組名稱 [雲端服務名稱] 的虛擬機器，</span><span class="sxs-lookup"><span data-stu-id="7d05b-115">Recreate the virtual machine with the same name and same resource group name [cloud service name],</span></span><br><span data-ttu-id="7d05b-116">(或)</span><span class="sxs-lookup"><span data-stu-id="7d05b-116">(OR)</span></span></li><li> <span data-ttu-id="7d05b-117">停止保護虛擬機器 (不論是否刪除備份資料)。</span><span class="sxs-lookup"><span data-stu-id="7d05b-117">Stop protecting virtual machine with or without deleting the backup data.</span></span> [<span data-ttu-id="7d05b-118">更多詳細資料</span><span class="sxs-lookup"><span data-stu-id="7d05b-118">More details</span></span>](http://go.microsoft.com/fwlink/?LinkId=808124)</li></ol> |
| <span data-ttu-id="7d05b-119">因為虛擬機器沒有網路連線，所以快照集作業失敗 - 請確定 VM 可存取網路。</span><span class="sxs-lookup"><span data-stu-id="7d05b-119">Snapshot operation failed due to no network connectivity on the virtual machine - Ensure that VM has network access.</span></span> <span data-ttu-id="7d05b-120">若要讓快照集成功，請將 Azure 資料中心 IP 範圍設為白名單，或設定網路存取的 Proxy 伺服器。</span><span class="sxs-lookup"><span data-stu-id="7d05b-120">For snapshot to succeed, either whitelist Azure datacenter IP ranges or set up a proxy server for network access.</span></span> <span data-ttu-id="7d05b-121">如需詳細資訊，請參閱 http://go.microsoft.com/fwlink/?LinkId=800034。</span><span class="sxs-lookup"><span data-stu-id="7d05b-121">For more details, refer to  http://go.microsoft.com/fwlink/?LinkId=800034.</span></span> <span data-ttu-id="7d05b-122">如果您已經使用 Proxy 伺服器，請確定已正確設定 Proxy 伺服器設定</span><span class="sxs-lookup"><span data-stu-id="7d05b-122">If you are already using proxy server, make sure that proxy server settings are configured correctly</span></span> | <span data-ttu-id="7d05b-123">當您拒絕虛擬機器上的輸出網際網路連線時，就會擲回這個錯誤。</span><span class="sxs-lookup"><span data-stu-id="7d05b-123">This error is thrown when you deny the outbound internet connectivity on the virtual machine.</span></span> <span data-ttu-id="7d05b-124">VM 快照集延伸模組需要網際網路連線，才能建立虛擬機器基礎磁碟的快照集。</span><span class="sxs-lookup"><span data-stu-id="7d05b-124">Internet connectivity is required for VM snapshot extension to take a snapshot of underlying disks of the virtual machine.</span></span> <span data-ttu-id="7d05b-125">[進一步了解](backup-azure-troubleshoot-vm-backup-fails-snapshot-timeout.md#snapshot-operation-failed-due-to-no-network-connectivity-on-the-virtual-machine)如何修正封鎖網路存取所造成的快照集失敗。</span><span class="sxs-lookup"><span data-stu-id="7d05b-125">[Learn more](backup-azure-troubleshoot-vm-backup-fails-snapshot-timeout.md#snapshot-operation-failed-due-to-no-network-connectivity-on-the-virtual-machine) on how to fix snapshot failures due to blocked network access.</span></span> |
| <span data-ttu-id="7d05b-126">VM 代理程式無法與 Azure 備份服務通訊。</span><span class="sxs-lookup"><span data-stu-id="7d05b-126">VM agent is unable to communicate with the Azure Backup Service.</span></span> <span data-ttu-id="7d05b-127">- 請確認 VM 具有網路連線，且 VM 代理程式是最新版且正在執行。</span><span class="sxs-lookup"><span data-stu-id="7d05b-127">- Ensure the VM has network connectivity and the VM agent is latest and running.</span></span> <span data-ttu-id="7d05b-128">如需詳細資訊，請參閱 http://go.microsoft.com/fwlink/?LinkId=800034</span><span class="sxs-lookup"><span data-stu-id="7d05b-128">For more information, please refer to  http://go.microsoft.com/fwlink/?LinkId=800034</span></span> |<span data-ttu-id="7d05b-129">如果 VM 代理程式發生問題，或以某種方式封鎖對 Azure 基礎結構的網路存取，則會擲回這個錯誤。</span><span class="sxs-lookup"><span data-stu-id="7d05b-129">This error is thrown if there is a problem with the VM Agent or network access to the Azure infrastructure is blocked in some way.</span></span> <span data-ttu-id="7d05b-130">[深入了解](backup-azure-troubleshoot-vm-backup-fails-snapshot-timeout.md#vm-agent-unable-to-communicate-with-azure-backup)如何進行 VM 快照集問題偵錯。</span><span class="sxs-lookup"><span data-stu-id="7d05b-130">[Learn more](backup-azure-troubleshoot-vm-backup-fails-snapshot-timeout.md#vm-agent-unable-to-communicate-with-azure-backup) about debugging up VM snapshot issues.</span></span><br> <span data-ttu-id="7d05b-131">如果 VM 代理程式並未造成任何問題，請重新啟動 VM。</span><span class="sxs-lookup"><span data-stu-id="7d05b-131">If the VM agent is not causing any issues, then restart the VM.</span></span> <span data-ttu-id="7d05b-132">有時，不正確的 VM 狀態可能會造成問題，重新啟動 VM 就可清除此「錯誤狀態」。</span><span class="sxs-lookup"><span data-stu-id="7d05b-132">At times an incorrect VM state can cause issues, and restarting the VM resets this "bad state".</span></span> |
| <span data-ttu-id="7d05b-133">VM 處於失敗佈建狀態 - 請將 VM 重新啟動，並確定 VM 為執行中，或關機狀態可進行備份</span><span class="sxs-lookup"><span data-stu-id="7d05b-133">VM is in Failed Provisioning State - Please restart the VM and make sure that the VM is in Running or Shut-down state for backup</span></span> | <span data-ttu-id="7d05b-134">當其中一個延伸模組失敗而導致 VM 狀態變成失敗的佈建狀態時，就會發生這個情況。</span><span class="sxs-lookup"><span data-stu-id="7d05b-134">This occurs when one of the extension failures leads VM state to be in failed provisioning state.</span></span> <span data-ttu-id="7d05b-135">請移至延伸模組清單，查看是否有失敗的延伸模組，將它移除並嘗試重新啟動虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="7d05b-135">Go to extensions list and see if there is a failed extension, remove it and try restarting the virtual machine.</span></span> <span data-ttu-id="7d05b-136">如果所有延伸模組都是處於執行狀態，請檢查 VM 代理程式服務是否正在執行。</span><span class="sxs-lookup"><span data-stu-id="7d05b-136">If all extensions are in running state, check if VM agent service is running.</span></span> <span data-ttu-id="7d05b-137">若否，請重新啟動 VM 代理程式服務。</span><span class="sxs-lookup"><span data-stu-id="7d05b-137">If not, restart the VM agent service.</span></span> | 
| <span data-ttu-id="7d05b-138">受管理磁碟的 VMSnapshot 延伸模組作業失敗 - 請重試備份作業。</span><span class="sxs-lookup"><span data-stu-id="7d05b-138">VMSnapshot extension operation failed for managed disks - Please retry the backup operation.</span></span> <span data-ttu-id="7d05b-139">如果問題重複出現，請遵循 'http://go.microsoft.com/fwlink/?LinkId=800034' 中的指示。</span><span class="sxs-lookup"><span data-stu-id="7d05b-139">If the issue repeats, follow the instructions at 'http://go.microsoft.com/fwlink/?LinkId=800034'.</span></span> <span data-ttu-id="7d05b-140">如果進一步失敗，請連絡 Microsoft 支援</span><span class="sxs-lookup"><span data-stu-id="7d05b-140">If it fails further, please contact Microsoft support</span></span> | <span data-ttu-id="7d05b-141">Azure 備份服務無法觸發快照集時，就會發生此錯誤。</span><span class="sxs-lookup"><span data-stu-id="7d05b-141">This error when Azure Backup service fails to trigger a snapshot.</span></span> <span data-ttu-id="7d05b-142">[深入了解](backup-azure-troubleshoot-vm-backup-fails-snapshot-timeout.md#vmsnapshot-extension-operation-failed)如何進行 VM 快照集問題偵錯。</span><span class="sxs-lookup"><span data-stu-id="7d05b-142">[Learn more](backup-azure-troubleshoot-vm-backup-fails-snapshot-timeout.md#vmsnapshot-extension-operation-failed) about debugging VM snapshot issues.</span></span> |
| <span data-ttu-id="7d05b-143">無法複製虛擬機器的快照集，因為儲存體帳戶中的可用空間不足 - 請確定儲存體帳戶中的可用空間等於連結至虛擬機器的進階儲存體磁碟上所呈現的資料</span><span class="sxs-lookup"><span data-stu-id="7d05b-143">Could not copy the snapshot of the virtual machine, due to insufficient free space in the storage account - Ensure that storage account has free space equivalent to the data present on the premium storage disks attached to the virtual machine</span></span> | <span data-ttu-id="7d05b-144">若為進階 VM，我們會將快照集複製到儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7d05b-144">In case of premium VMs, we copy the snapshot to storage account.</span></span> <span data-ttu-id="7d05b-145">這是為了確定快照集上運作的備份管理流量不會限制可供使用進階磁碟的應用程式使用的 IOPS 數目。</span><span class="sxs-lookup"><span data-stu-id="7d05b-145">This is to make sure that backup management traffic, which works on snapshot, doesn't limit the number of IOPS available to the application using premium disks.</span></span> <span data-ttu-id="7d05b-146">Microsoft 建議只配置 50% 的總儲存體帳戶空間，讓 Azure 備份服務可以將快照集複製到儲存體帳戶，並從儲存體帳戶中複製的這個位置，將資料傳送到到保存庫。</span><span class="sxs-lookup"><span data-stu-id="7d05b-146">Microsoft recommends you allocate only 50% of the total storage account space so the Azure Backup service can copy the snapshot to storage account and transfer data from this copied location in storage account to the vault.</span></span> | 
| <span data-ttu-id="7d05b-147">無法執行操作，因為 VM 代理程式沒有回應</span><span class="sxs-lookup"><span data-stu-id="7d05b-147">Unable to perform the operation as the VM agent is not responsive</span></span> |<span data-ttu-id="7d05b-148">如果 VM 代理程式發生問題，或以某種方式封鎖對 Azure 基礎結構的網路存取，則會擲回這個錯誤。</span><span class="sxs-lookup"><span data-stu-id="7d05b-148">This error is thrown if there is a problem with the VM Agent or network access to the Azure infrastructure is blocked in some way.</span></span> <span data-ttu-id="7d05b-149">針對 Windows VM，請檢查服務中的VM 代理程式服務狀態，以及代理程式是否出現在 [控制台] 的 [程式集] 中。</span><span class="sxs-lookup"><span data-stu-id="7d05b-149">For Windows VMs, check the VM agent service status in services and whether the agent appears in programs in control panel.</span></span> <span data-ttu-id="7d05b-150">請嘗試從 [控制台] 中刪除程式，然後以[下方](#vm-agent)所述的方式重新安裝代理程式。</span><span class="sxs-lookup"><span data-stu-id="7d05b-150">Try removing the program from control panel and re-installing the agent as mentioned [below](#vm-agent).</span></span> <span data-ttu-id="7d05b-151">重新安裝代理程式之後，請觸發臨機操作備份以確認。</span><span class="sxs-lookup"><span data-stu-id="7d05b-151">After re-installing the agent, trigger an adhoc backup to verify.</span></span> |
| <span data-ttu-id="7d05b-152">復原服務擴充作業失敗。</span><span class="sxs-lookup"><span data-stu-id="7d05b-152">Recovery services extension operation failed.</span></span> <span data-ttu-id="7d05b-153">- 請確定虛擬機器上有最新的虛擬機器代理程式，且代理程式服務正在執行中。</span><span class="sxs-lookup"><span data-stu-id="7d05b-153">- Please make sure that latest virtual machine agent is present on the virtual machine and agent service is running.</span></span> <span data-ttu-id="7d05b-154">請重試備份作業，如果失敗，請連絡 Microsoft 支援服務。</span><span class="sxs-lookup"><span data-stu-id="7d05b-154">Please retry backup operation and if it fails, contact Microsoft support.</span></span> |<span data-ttu-id="7d05b-155">VM 代理程式過期時會擲回這個錯誤。</span><span class="sxs-lookup"><span data-stu-id="7d05b-155">This error is thrown when VM agent is out of date.</span></span> <span data-ttu-id="7d05b-156">請參閱下面的「更新 VM 代理程式」一節以更新 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="7d05b-156">Refer “Updating the VM Agent” section below to update the VM agent.</span></span> |
| <span data-ttu-id="7d05b-157">虛擬機器不存在。</span><span class="sxs-lookup"><span data-stu-id="7d05b-157">Virtual machine doesn't exist.</span></span> <span data-ttu-id="7d05b-158">- 請確定該虛擬機器存在，或選取不同的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="7d05b-158">- Please make sure that virtual machine exists or select a different virtual machine.</span></span> |<span data-ttu-id="7d05b-159">當刪除主要 VM 但備份原則繼續尋找 VM 來執行備份時，就會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="7d05b-159">This happens when the primary VM is deleted but the backup policy continues to look for a VM to perform backup.</span></span> <span data-ttu-id="7d05b-160">若要修正此錯誤：</span><span class="sxs-lookup"><span data-stu-id="7d05b-160">To fix this error:</span></span> <ol><li> <span data-ttu-id="7d05b-161">重新建立具有相同名稱和相同資源群組名稱 [雲端服務名稱] 的虛擬機器，</span><span class="sxs-lookup"><span data-stu-id="7d05b-161">Recreate the virtual machine with the same name and same resource group name [cloud service name],</span></span><br><span data-ttu-id="7d05b-162">(或)</span><span class="sxs-lookup"><span data-stu-id="7d05b-162">(OR)</span></span><br></li><li><span data-ttu-id="7d05b-163">停止保護虛擬機器，但不刪除備份資料。</span><span class="sxs-lookup"><span data-stu-id="7d05b-163">Stop protecting the virtual machine without deleting the backup data.</span></span> [<span data-ttu-id="7d05b-164">更多詳細資料</span><span class="sxs-lookup"><span data-stu-id="7d05b-164">More details</span></span>](http://go.microsoft.com/fwlink/?LinkId=808124)</li></ol> |
| <span data-ttu-id="7d05b-165">命令執行失敗。</span><span class="sxs-lookup"><span data-stu-id="7d05b-165">Command execution failed.</span></span> <span data-ttu-id="7d05b-166">另一項作業目前正在此項目上進行。</span><span class="sxs-lookup"><span data-stu-id="7d05b-166">- Another operation is currently in progress on this item.</span></span> <span data-ttu-id="7d05b-167">請等到前一項作業完成，然後重試</span><span class="sxs-lookup"><span data-stu-id="7d05b-167">Please wait until the previous operation is completed, and then retry</span></span> |<span data-ttu-id="7d05b-168">VM 上的現有備份正在執行中，而當現有作業正在執行時，無法啟動新的作業。</span><span class="sxs-lookup"><span data-stu-id="7d05b-168">An existing backup on the VM is running, and a new job cannot be started while the existing job is running.</span></span> |
| <span data-ttu-id="7d05b-169">從備份保存庫複製 VHD 已逾時 - 請在幾分鐘內重試此作業。</span><span class="sxs-lookup"><span data-stu-id="7d05b-169">Copying VHDs from the backup vault timed out - Please retry the operation in a few minutes.</span></span> <span data-ttu-id="7d05b-170">如果問題持續發生，請連絡 Microsoft 支援服務。</span><span class="sxs-lookup"><span data-stu-id="7d05b-170">If the problem persists, contact Microsoft Support.</span></span> | <span data-ttu-id="7d05b-171">發生此問題的時機為儲存體端上產生暫時性錯誤，或者備份服務尚未從裝載 VM 的儲存體帳戶取得足夠的 IOPS，以便在逾時期限內將資料轉送到保存庫。</span><span class="sxs-lookup"><span data-stu-id="7d05b-171">This happens if there is a transient error on storage side or if backup service is not getting sufficient IOPS from storage account hosting the VM in order to transfer data within timeout period to vault.</span></span> <span data-ttu-id="7d05b-172">確定您在設定備份時已遵循[最佳作法](backup-azure-vms-introduction.md#best-practices)。</span><span class="sxs-lookup"><span data-stu-id="7d05b-172">Make sure that you followed [Best practices](backup-azure-vms-introduction.md#best-practices) while setting up backup.</span></span> <span data-ttu-id="7d05b-173">請嘗試將 VM 移至其他尚未載入的儲存體帳戶，然後重試備份。</span><span class="sxs-lookup"><span data-stu-id="7d05b-173">Try moving VM to a different storage account which is not loaded and retry backup.</span></span>|
| <span data-ttu-id="7d05b-174">備份因為內部錯誤而失敗 - 請在幾分鐘內重試此作業。</span><span class="sxs-lookup"><span data-stu-id="7d05b-174">Backup failed with an internal error - Please retry the operation in a few minutes.</span></span> <span data-ttu-id="7d05b-175">如果問題持續發生，請連絡 Microsoft 支援服務。</span><span class="sxs-lookup"><span data-stu-id="7d05b-175">If the problem persists, contact Microsoft Support</span></span> |<span data-ttu-id="7d05b-176">這個錯誤的發生原因有 2 個：</span><span class="sxs-lookup"><span data-stu-id="7d05b-176">You can get this error for 2 reasons:</span></span> <ol><li> <span data-ttu-id="7d05b-177">存取 VM 儲存體時發生暫時性問題。</span><span class="sxs-lookup"><span data-stu-id="7d05b-177">There is a transient issue in accessing the VM storage.</span></span> <span data-ttu-id="7d05b-178">請檢查 [Azure 狀態](https://azure.microsoft.com/en-us/status/)，以查看該區域中目前是否有任何與計算、儲存體或網路相關的問題。</span><span class="sxs-lookup"><span data-stu-id="7d05b-178">Please check [Azure Status](https://azure.microsoft.com/en-us/status/) to see if there is any on-going issue related to compute, storage, or networking in the region.</span></span> <span data-ttu-id="7d05b-179">然後在問題解決後，立即重試備份作業。</span><span class="sxs-lookup"><span data-stu-id="7d05b-179">Then retry the backup job once the issue is resolved.</span></span> <li><span data-ttu-id="7d05b-180">已刪除原始 VM，因此無法取得復原點。</span><span class="sxs-lookup"><span data-stu-id="7d05b-180">The original VM has been deleted and therefore, the recovery point cannot be taken.</span></span> <span data-ttu-id="7d05b-181">若要保留已刪除 VM 的備份資料，但移除備份錯誤：請取消保護 VM 並選擇保留資料。</span><span class="sxs-lookup"><span data-stu-id="7d05b-181">To keep the backup data for a deleted VM, but remove the backup errors: Unprotect the VM and choose the option to keep the data.</span></span> <span data-ttu-id="7d05b-182">這個動作會停止排定的備份作業和週期性錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="7d05b-182">This action stops the scheduled backup job and the recurring error messages.</span></span> |
| <span data-ttu-id="7d05b-183">無法在選取的項目上安裝 Azure 復原服務延伸模組 - VM 代理程式是 Azure 復原服務延伸模組的先決條件。</span><span class="sxs-lookup"><span data-stu-id="7d05b-183">Failed to install the Azure Recovery Services extension on the selected item - The VM agent is a prerequisite for the Azure Recovery Services Extension.</span></span> <span data-ttu-id="7d05b-184">安裝 Azure VM 代理程式並重新啟動註冊作業</span><span class="sxs-lookup"><span data-stu-id="7d05b-184">Install the Azure VM agent and restart the registration operation</span></span> |<ol> <li><span data-ttu-id="7d05b-185">檢查是否已正確安裝 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="7d05b-185">Check if the VM agent has been installed correctly.</span></span> <li><span data-ttu-id="7d05b-186">確定已正確設定 VM 組態中的旗標。</span><span class="sxs-lookup"><span data-stu-id="7d05b-186">Ensure the flag on the VM config is set correctly.</span></span></ol> <span data-ttu-id="7d05b-187">[深入了解](#validating-vm-agent-installation)如何安裝 VM 代理程式，以及如何驗證 VM 代理程式安裝。</span><span class="sxs-lookup"><span data-stu-id="7d05b-187">[Read more](#validating-vm-agent-installation) about installing the VM agent, and how to validate the VM agent installation.</span></span> |
| <span data-ttu-id="7d05b-188">擴充功能安裝失敗，發生錯誤「COM+ 無法與 Microsoft Distributed Transaction Coordinator 通話」</span><span class="sxs-lookup"><span data-stu-id="7d05b-188">Extension installation failed with the error "COM+ was unable to talk to the Microsoft Distributed Transaction Coordinator</span></span> |<span data-ttu-id="7d05b-189">這通常表示 COM+ 服務未執行。</span><span class="sxs-lookup"><span data-stu-id="7d05b-189">This usually means that the COM+ service is not running.</span></span> <span data-ttu-id="7d05b-190">請連絡 Microsoft 支援服務來協助解決此問題。</span><span class="sxs-lookup"><span data-stu-id="7d05b-190">Contact Microsoft support for help on fixing this issue.</span></span> |
| <span data-ttu-id="7d05b-191">快照集作業失敗，發生 VSS 作業錯誤「這個磁碟機已由 BitLocker 磁碟機加密鎖定」。</span><span class="sxs-lookup"><span data-stu-id="7d05b-191">Snapshot operation failed with the VSS operation error "This drive is locked by BitLocker Drive Encryption.</span></span> <span data-ttu-id="7d05b-192">您必須至 [控制台] 解除鎖定這個磁碟機。</span><span class="sxs-lookup"><span data-stu-id="7d05b-192">You must unlock this drive from the Control Panel.</span></span> |<span data-ttu-id="7d05b-193">對 VM 上的所有磁碟機關閉 BitLocker，並觀察是否已解決 VSS 問題</span><span class="sxs-lookup"><span data-stu-id="7d05b-193">Turn off BitLocker for all drives on the VM and observe if the VSS issue is resolved</span></span> |
| <span data-ttu-id="7d05b-194">VM 目前的狀態不允許備份。</span><span class="sxs-lookup"><span data-stu-id="7d05b-194">VM is not in a state that allows backups.</span></span> |<ul><li><span data-ttu-id="7d05b-195">檢查 VM 是否處於「執行中」與「關閉」之間的暫時性狀態。</span><span class="sxs-lookup"><span data-stu-id="7d05b-195">Check if VM is in a transient state between Running and Shut down.</span></span> <span data-ttu-id="7d05b-196">如果是，請等待 VM 狀態變成這其中一種狀態，然後再次觸發備份。</span><span class="sxs-lookup"><span data-stu-id="7d05b-196">If it is, wait for the VM state to be one of them and trigger backup again.</span></span> <li> <span data-ttu-id="7d05b-197">如果 VM 是 Linux VM 並使用 [安全性強化 Linux] 核心模組，您必須從安全性原則中排除 Linux 代理程式路徑 (_/var/lib/waagent_)，以確定會安裝備份擴充功能。</span><span class="sxs-lookup"><span data-stu-id="7d05b-197">If the VM is a Linux VM and uses [Security Enhanced Linux] kernel module, you need to exclude the Linux Agent path(_/var/lib/waagent_) from security policy to make sure backup extension gets installed.</span></span>  |
| <span data-ttu-id="7d05b-198">找不到 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="7d05b-198">Azure Virtual Machine Not Found.</span></span> |<span data-ttu-id="7d05b-199">當刪除主要 VM 但備份原則繼續尋找 VM 來執行備份時，就會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="7d05b-199">This happens when the primary VM is deleted but the backup policy continues to look for a VM to perform back up.</span></span> <span data-ttu-id="7d05b-200">若要修正此錯誤：</span><span class="sxs-lookup"><span data-stu-id="7d05b-200">To fix this error:</span></span> <ol><li><span data-ttu-id="7d05b-201">重新建立具有相同名稱和相同資源群組名稱 [雲端服務名稱] 的虛擬機器，</span><span class="sxs-lookup"><span data-stu-id="7d05b-201">Recreate the virtual machine with the same name and same resource group name [cloud service name],</span></span> <br><span data-ttu-id="7d05b-202">(或)</span><span class="sxs-lookup"><span data-stu-id="7d05b-202">(OR)</span></span> <li> <span data-ttu-id="7d05b-203">停用此 VM 的保護，因此不會建立備份作業。</span><span class="sxs-lookup"><span data-stu-id="7d05b-203">Disable protection for this VM so the backup jobs will not be created.</span></span> </ol> |
| <span data-ttu-id="7d05b-204">虛擬機器代理程式不存在於虛擬機器上：請安裝任何必要元件和 VM 代理程式，然後重新啟動作業。</span><span class="sxs-lookup"><span data-stu-id="7d05b-204">Virtual machine agent is not present on the virtual machine - Please install any prerequisite and the VM agent, and then restart the operation.</span></span> |<span data-ttu-id="7d05b-205">[深入了解](#vm-agent) VM 代理程式安裝，以及如何驗證 VM 代理程式安裝。</span><span class="sxs-lookup"><span data-stu-id="7d05b-205">[Read more](#vm-agent) about VM agent installation, and how to validate the VM agent installation.</span></span> |
| <span data-ttu-id="7d05b-206">快照集作業失敗，因為 VSS 寫入器處於不正常狀態</span><span class="sxs-lookup"><span data-stu-id="7d05b-206">Snapshot operation failed due to VSS Writers in bad state</span></span> |<span data-ttu-id="7d05b-207">您需要重新啟動 VSS (磁碟區陰影複製服務) 寫入器處於不正常的狀態。</span><span class="sxs-lookup"><span data-stu-id="7d05b-207">You need to restart VSS(Volume Shadow copy Service) writers that are in bad state.</span></span> <span data-ttu-id="7d05b-208">若要達到這個目的，從提高權限的命令提示字元，執行 _vssadmin list writers_。</span><span class="sxs-lookup"><span data-stu-id="7d05b-208">To achieve this, from an elevated command prompt, run _vssadmin list writers_.</span></span> <span data-ttu-id="7d05b-209">輸出會包含所有 VSS 寫入器和其狀態。</span><span class="sxs-lookup"><span data-stu-id="7d05b-209">Output contains all VSS writers and their state.</span></span> <span data-ttu-id="7d05b-210">對於每個狀態不是「[1] 穩定」的 VSS 寫入器，請從提升權限的命令提示字元執行下列命令，重新啟動 VSS 寫入器：</span><span class="sxs-lookup"><span data-stu-id="7d05b-210">For every VSS writer whose state is not "[1] Stable", restart VSS writer by running following commands from an elevated command prompt:</span></span><br> <span data-ttu-id="7d05b-211">_net stop serviceName_</span><span class="sxs-lookup"><span data-stu-id="7d05b-211">_net stop serviceName_</span></span> <br> <span data-ttu-id="7d05b-212">_net start serviceName_</span><span class="sxs-lookup"><span data-stu-id="7d05b-212">_net start serviceName_</span></span>|
| <span data-ttu-id="7d05b-213">快照集作業失敗，因為組態的剖析失敗</span><span class="sxs-lookup"><span data-stu-id="7d05b-213">Snapshot operation failed due to a parsing failure of the configuration</span></span> |<span data-ttu-id="7d05b-214">這是因為 MachineKeys 目錄中的權限已變更︰_%systemdrive%\programdata\microsoft\crypto\rsa\machinekeys_</span><span class="sxs-lookup"><span data-stu-id="7d05b-214">This happens due to changed permissions on the MachineKeys directory: _%systemdrive%\programdata\microsoft\crypto\rsa\machinekeys_</span></span> <br><span data-ttu-id="7d05b-215">請執行下列命令，並確認 MachineKeys 目錄的權限是預設的︰</span><span class="sxs-lookup"><span data-stu-id="7d05b-215">Please run below command and verify that permissions on MachineKeys directory are default-ones:</span></span><br><span data-ttu-id="7d05b-216">_icacls %systemdrive%\programdata\microsoft\crypto\rsa\machinekeys_</span><span class="sxs-lookup"><span data-stu-id="7d05b-216">_icacls %systemdrive%\programdata\microsoft\crypto\rsa\machinekeys_</span></span> <br><br> <span data-ttu-id="7d05b-217">預設權限是︰</span><span class="sxs-lookup"><span data-stu-id="7d05b-217">Default permissions are:</span></span><br><span data-ttu-id="7d05b-218">Everyone:(R,W)</span><span class="sxs-lookup"><span data-stu-id="7d05b-218">Everyone:(R,W)</span></span> <br><span data-ttu-id="7d05b-219">BUILTIN\Administrators:(F)</span><span class="sxs-lookup"><span data-stu-id="7d05b-219">BUILTIN\Administrators:(F)</span></span><br><br><span data-ttu-id="7d05b-220">如果您發現 MachineKeys 目錄的權限不同於預設權限，請依照下列步驟來修正權限、刪除憑證，並觸發備份。</span><span class="sxs-lookup"><span data-stu-id="7d05b-220">If you see permissions on MachineKeys directory different than default, please follow below steps to correct permissions, delete the certificate and trigger the backup.</span></span><ol><li><span data-ttu-id="7d05b-221">修正 MachineKeys 目錄上的權限。</span><span class="sxs-lookup"><span data-stu-id="7d05b-221">Fix permissions on MachineKeys directory.</span></span><br><span data-ttu-id="7d05b-222">在目錄上使用 Explorer 安全性屬性和進階安全性設定，將權限重設回預設值，從目錄移除任何額外 (預設值以外) 的使用者物件，然後確認「Everyone」權限有特殊存取權︰</span><span class="sxs-lookup"><span data-stu-id="7d05b-222">Using Explorer Security Properties and Advanced Security Settings on the directory, reset permissions back to the default values, remove any extra (than default) user object from the directory, and ensure that the ‘Everyone’ permissions had special access for:</span></span><br><span data-ttu-id="7d05b-223">-列出資料夾/讀取資料</span><span class="sxs-lookup"><span data-stu-id="7d05b-223">-List folder / read data</span></span> <br><span data-ttu-id="7d05b-224">-讀取屬性</span><span class="sxs-lookup"><span data-stu-id="7d05b-224">-Read attributes</span></span> <br><span data-ttu-id="7d05b-225">-讀取擴充屬性</span><span class="sxs-lookup"><span data-stu-id="7d05b-225">-Read extended attributes</span></span> <br><span data-ttu-id="7d05b-226">-建立檔案/寫入資料</span><span class="sxs-lookup"><span data-stu-id="7d05b-226">-Create files / write data</span></span> <br><span data-ttu-id="7d05b-227">-建立資料夾/附加資料</span><span class="sxs-lookup"><span data-stu-id="7d05b-227">-Create folders / append data</span></span><br><span data-ttu-id="7d05b-228">-寫入屬性</span><span class="sxs-lookup"><span data-stu-id="7d05b-228">-Write attributes</span></span><br><span data-ttu-id="7d05b-229">-寫入擴充屬性</span><span class="sxs-lookup"><span data-stu-id="7d05b-229">-Write extended attributes</span></span><br><span data-ttu-id="7d05b-230">-讀取權限</span><span class="sxs-lookup"><span data-stu-id="7d05b-230">-Read permissions</span></span><br><br><li><span data-ttu-id="7d05b-231">刪除 [發給] 欄位 = "Windows Azure Service Management for Extensions" 或 "Windows Azure CRP Certificate Generator" 的所有憑證。</span><span class="sxs-lookup"><span data-stu-id="7d05b-231">Delete all certificates with field ‘Issued To’ = "Windows Azure Service Management for Extensions" or "Windows Azure CRP Certificate Generator”.</span></span><ul><li><span data-ttu-id="7d05b-232">[開啟 [憑證 (本機電腦)] 主控台](https://msdn.microsoft.com/library/ms788967(v=vs.110).aspx)</span><span class="sxs-lookup"><span data-stu-id="7d05b-232">[Open Certificates(Local computer) console](https://msdn.microsoft.com/library/ms788967(v=vs.110).aspx)</span></span><li><span data-ttu-id="7d05b-233">刪除 [發給] 欄位 = "Windows Azure Service Management for Extensions" 或 "Windows Azure CRP Certificate Generator" 的所有憑證 (在 [個人] -> [憑證] 下)。</span><span class="sxs-lookup"><span data-stu-id="7d05b-233">Delete all certificates (under Personal -> Certificates) with field ‘Issued To’ = "Windows Azure Service Management for Extensions" or "Windows Azure CRP Certificate Generator”.</span></span></ul><li><span data-ttu-id="7d05b-234">觸發 VM 備份。</span><span class="sxs-lookup"><span data-stu-id="7d05b-234">Trigger VM backup.</span></span> </ol>|
| <span data-ttu-id="7d05b-235">驗證失敗，因為虛擬機器單獨以 BEK 進行加密。</span><span class="sxs-lookup"><span data-stu-id="7d05b-235">Validation failed as virtual machine is encrypted with BEK alone.</span></span> <span data-ttu-id="7d05b-236">只會對同時使用 BEK 和 KEK 加密的虛擬機器啟用備份。</span><span class="sxs-lookup"><span data-stu-id="7d05b-236">Backups can be enabled only for virtual machines encrypted with both BEK and KEK.</span></span> |<span data-ttu-id="7d05b-237">虛擬機器應該使用「BitLocker 加密金鑰」和「金鑰加密金鑰」進行加密。</span><span class="sxs-lookup"><span data-stu-id="7d05b-237">Virtual machine should be encrypted using both BitLocker Encryption Key and Key Encryption Key.</span></span> <span data-ttu-id="7d05b-238">之後，應該啟用備份。</span><span class="sxs-lookup"><span data-stu-id="7d05b-238">After that, backup should be enabled.</span></span> |
| <span data-ttu-id="7d05b-239">Azure 備份服務沒有足夠的 Key Vault權限可備份加密的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="7d05b-239">Azure Backup Service does not have sufficient permissions to Key Vault for Backup of Encrypted Virtual Machines.</span></span> |<span data-ttu-id="7d05b-240">應使用 [PowerShell 文件](backup-azure-vms-automation.md)的**啟用備份**區段中所述的步驟，在 PowerShell 中向備份服務提供這些權限。</span><span class="sxs-lookup"><span data-stu-id="7d05b-240">Backup service should be provided these permissions in PowerShell using steps mentioned in **Enable Backup** section of [PowerShell documentation](backup-azure-vms-automation.md).</span></span> |
|<span data-ttu-id="7d05b-241">快照集擴充安裝失敗，錯誤為 - COM+ 無法與 Microsoft Distributed Transaction Coordinator 通話</span><span class="sxs-lookup"><span data-stu-id="7d05b-241">Installation of snapshot extension failed with error - COM+ was unable to talk to the Microsoft Distributed Transaction Coordinator</span></span> | <span data-ttu-id="7d05b-242">請嘗試重新啟動 Windows 服務 "COM+ System Application" (從提高權限的命令提示字元 - _net start COMSysApp_)。</span><span class="sxs-lookup"><span data-stu-id="7d05b-242">Please try to start windows service "COM+ System Application" (from an elevated command prompt - _net start COMSysApp_).</span></span> <br><span data-ttu-id="7d05b-243">如果在啟動時失敗，請遵循下列步驟︰</span><span class="sxs-lookup"><span data-stu-id="7d05b-243">If it fails while starting, please follow below steps:</span></span><ol><li> <span data-ttu-id="7d05b-244">確認服務 "Distributed Transaction Coordinator" 的登入帳戶是 "Network Service"。</span><span class="sxs-lookup"><span data-stu-id="7d05b-244">Validate that the Logon account of service "Distributed Transaction Coordinator" is "Network Service".</span></span> <span data-ttu-id="7d05b-245">如果不是，請變更為 "Network Service"，重新啟動此服務，然後嘗試啟動服務 "COM+ System Application"。'</span><span class="sxs-lookup"><span data-stu-id="7d05b-245">If it is not, please change it to "Network Service", restart this service and then try to start service "COM+ System Application".'</span></span><li><span data-ttu-id="7d05b-246">如果仍然無法啟動，請依照下列步驟解除安裝/安裝服務 "Distributed Transaction Coordinator"：</span><span class="sxs-lookup"><span data-stu-id="7d05b-246">If it still fails to start, uninstall/install service "Distributed Transaction Coordinator" by following below steps:</span></span><br> <span data-ttu-id="7d05b-247">- 停止 MSDTC 服務</span><span class="sxs-lookup"><span data-stu-id="7d05b-247">- Stop the MSDTC service</span></span><br> <span data-ttu-id="7d05b-248">- 開啟命令提示字元 (cmd)</span><span class="sxs-lookup"><span data-stu-id="7d05b-248">- Open a command prompt (cmd)</span></span> <br> <span data-ttu-id="7d05b-249">- 執行命令 “msdtc -uninstall”</span><span class="sxs-lookup"><span data-stu-id="7d05b-249">- Run command “msdtc -uninstall”</span></span> <br> <span data-ttu-id="7d05b-250">- 執行命令 “msdtc -install”</span><span class="sxs-lookup"><span data-stu-id="7d05b-250">- Run command “msdtc -install”</span></span> <br> <span data-ttu-id="7d05b-251">- 啟動 MSDTC 服務</span><span class="sxs-lookup"><span data-stu-id="7d05b-251">- Start the MSDTC service</span></span><li><span data-ttu-id="7d05b-252">啟動 Windows 服務 "COM+ System Application"，啟動之後，從入口網站觸發備份。</span><span class="sxs-lookup"><span data-stu-id="7d05b-252">Start windows service "COM+ System Application" and after it is started, trigger backup from portal.</span></span></ol> |
|  <span data-ttu-id="7d05b-253">因 COM + 錯誤而導致快照集作業失敗</span><span class="sxs-lookup"><span data-stu-id="7d05b-253">Snapshot operation failed due to COM+ error</span></span> | <span data-ttu-id="7d05b-254">建議的動作是重新啟動 Windows 服務「COM + 系統應用程式」(從提升權限的命令提示字元 - _net start COMSysApp_)。</span><span class="sxs-lookup"><span data-stu-id="7d05b-254">The recommended action is to restart windows service "COM+ System Application" (from an elevated command prompt - _net start COMSysApp_).</span></span> <span data-ttu-id="7d05b-255">如果問題持續發生，請重新啟動 VM。</span><span class="sxs-lookup"><span data-stu-id="7d05b-255">If the issue persists, restart the VM.</span></span> <span data-ttu-id="7d05b-256">如果重新啟動 VM 沒有幫助，請嘗試[移除 VMSnapshot 延伸模組](https://docs.microsoft.com/en-us/azure/backup/backup-azure-troubleshoot-vm-backup-fails-snapshot-timeout#cause-3-the-backup-extension-fails-to-update-or-load)，並手動觸發備份。</span><span class="sxs-lookup"><span data-stu-id="7d05b-256">If restarting the VM doesn't help, try [removing the VMSnapshot Extension](https://docs.microsoft.com/en-us/azure/backup/backup-azure-troubleshoot-vm-backup-fails-snapshot-timeout#cause-3-the-backup-extension-fails-to-update-or-load) and trigger the backup manually.</span></span> |
| <span data-ttu-id="7d05b-257">無法凍結 VM 的一或多個掛接點以取得檔案系統一致快照集</span><span class="sxs-lookup"><span data-stu-id="7d05b-257">Failed to freeze one or more mount-points of the VM to take a file-system consistent snapshot</span></span> | <span data-ttu-id="7d05b-258">請使用下列步驟：</span><span class="sxs-lookup"><span data-stu-id="7d05b-258">Use the following steps:</span></span> <ol><li><span data-ttu-id="7d05b-259">使用 _'tune2fs'_ 命令檢查所有已裝載裝置的檔案系統狀態。</span><span class="sxs-lookup"><span data-stu-id="7d05b-259">Check the file-system state of all mounted devices using _'tune2fs'_ command.</span></span><br> <span data-ttu-id="7d05b-260">例如：tune2fs -l /dev/sdb1 \\</span><span class="sxs-lookup"><span data-stu-id="7d05b-260">Eg: tune2fs -l /dev/sdb1 \\</span></span>| <span data-ttu-id="7d05b-261">grep "Filesystem state"</span><span class="sxs-lookup"><span data-stu-id="7d05b-261">grep "Filesystem state"</span></span> <li><span data-ttu-id="7d05b-262">使用 _'umount'_ 命令卸載檔案系統狀態不是空白的裝置</span><span class="sxs-lookup"><span data-stu-id="7d05b-262">Unmount the devices for which filesystem state is not clean using _'umount'_ command</span></span> <li> <span data-ttu-id="7d05b-263">使用 _'fsck'_ 命令對這些裝置執行 FileSystemConsistency 檢查</span><span class="sxs-lookup"><span data-stu-id="7d05b-263">Run FileSystemConsistency Check on these devices using _'fsck'_ command</span></span> <li> <span data-ttu-id="7d05b-264">重新裝載裝置並嘗試備份。</span><span class="sxs-lookup"><span data-stu-id="7d05b-264">Mount the devices again and try backup.</span></span></ol> |
| <span data-ttu-id="7d05b-265">因為建立安全網路通訊通道時發生失敗，所以快照集作業失敗</span><span class="sxs-lookup"><span data-stu-id="7d05b-265">Snapshot operation failed due to failure in creating secure network communication channel</span></span> | <ol><Li> <span data-ttu-id="7d05b-266">在提高權限的模式中執行 regedit.exe，開啟登錄編輯程式。</span><span class="sxs-lookup"><span data-stu-id="7d05b-266">Open Registry Editor by running regedit.exe in an elevated mode.</span></span> <li> <span data-ttu-id="7d05b-267">識別系統中存在的所有 .NetFramework 版本。</span><span class="sxs-lookup"><span data-stu-id="7d05b-267">Identify all versions of .NetFramework present in system.</span></span> <span data-ttu-id="7d05b-268">它們位於登錄機碼 "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft" 的階層下</span><span class="sxs-lookup"><span data-stu-id="7d05b-268">They are present under the hierarchy of registry key "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft"</span></span> <li> <span data-ttu-id="7d05b-269">針對登錄機碼中的每個 .NetFramework，新增下列機碼︰</span><span class="sxs-lookup"><span data-stu-id="7d05b-269">For each .NetFramework present in registry key, add following key:</span></span> <br> <span data-ttu-id="7d05b-270">"SchUseStrongCrypto"=dword:00000001</span><span class="sxs-lookup"><span data-stu-id="7d05b-270">"SchUseStrongCrypto"=dword:00000001</span></span> </ol>|
| <span data-ttu-id="7d05b-271">因為安裝適用於 Visual Studio 2012 的 Visual C++ 可轉散發套件時發生失敗，所以快照集作業失敗</span><span class="sxs-lookup"><span data-stu-id="7d05b-271">Snapshot operation failed due to failure in installation of Visual C++ Redistributable for Visual Studio 2012</span></span> | <span data-ttu-id="7d05b-272">瀏覽至 C:\Packages\Plugins\Microsoft.Azure.RecoveryServices.VMSnapshot\agentVersion，並安裝 vcredist2012_x64。</span><span class="sxs-lookup"><span data-stu-id="7d05b-272">Navigate to C:\Packages\Plugins\Microsoft.Azure.RecoveryServices.VMSnapshot\agentVersion and install vcredist2012_x64.</span></span> <span data-ttu-id="7d05b-273">請確定允許這項服務安裝的登錄機碼值設為正確的值，也就是登錄機碼 _HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Msiserver_ 的值為 3，而不是 4。</span><span class="sxs-lookup"><span data-stu-id="7d05b-273">Make sure that registry key value for allowing this service installation is set to correct value i.e. value of registry key  _HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Msiserver_ is set to 3 and not 4.</span></span> <span data-ttu-id="7d05b-274">如果您仍遇到安裝問題，請從提高權限的命令提示字元執行 _MSIEXEC /UNREGISTER_，再執行 _MSIEXEC /REGISTER_，以重新啟動安裝服務。</span><span class="sxs-lookup"><span data-stu-id="7d05b-274">If you are still facing issues with installation, restart installation service by running _MSIEXEC /UNREGISTER_ followed by _MSIEXEC /REGISTER_ from an elevated command prompt.</span></span>  |


## <a name="jobs"></a><span data-ttu-id="7d05b-275">作業</span><span class="sxs-lookup"><span data-stu-id="7d05b-275">Jobs</span></span>
| <span data-ttu-id="7d05b-276">錯誤詳細資料</span><span class="sxs-lookup"><span data-stu-id="7d05b-276">Error details</span></span> | <span data-ttu-id="7d05b-277">因應措施</span><span class="sxs-lookup"><span data-stu-id="7d05b-277">Workaround</span></span> |
| --- | --- |
| <span data-ttu-id="7d05b-278">不支援取消這種工作類型：請等待工作完成。</span><span class="sxs-lookup"><span data-stu-id="7d05b-278">Cancellation is not supported for this job type - Please wait until the job completes.</span></span> |<span data-ttu-id="7d05b-279">None</span><span class="sxs-lookup"><span data-stu-id="7d05b-279">None</span></span> |
| <span data-ttu-id="7d05b-280">作業不是處於可取消的狀態：請等待作業完成。</span><span class="sxs-lookup"><span data-stu-id="7d05b-280">The job is not in a cancelable state - Please wait until the job completes.</span></span> <br><span data-ttu-id="7d05b-281">或</span><span class="sxs-lookup"><span data-stu-id="7d05b-281">OR</span></span><br> <span data-ttu-id="7d05b-282">所選取的作業不是處於可取消的狀態 - 請等待作業完成。</span><span class="sxs-lookup"><span data-stu-id="7d05b-282">The selected job is not in a cancelable state - Please wait for the job to complete.</span></span> |<span data-ttu-id="7d05b-283">對於所有可能性而言，作業幾乎已完成。</span><span class="sxs-lookup"><span data-stu-id="7d05b-283">In all likelihood, the job is almost completed.</span></span> <span data-ttu-id="7d05b-284">請等待作業完成。</span><span class="sxs-lookup"><span data-stu-id="7d05b-284">Please wait until the job is completed.</span></span>|
| <span data-ttu-id="7d05b-285">無法取消工作，因為它不在進行中：只支援取消進行中的工作。</span><span class="sxs-lookup"><span data-stu-id="7d05b-285">Cannot cancel the job because it is not in progress - Cancellation is only supported for jobs which are in progress.</span></span> <span data-ttu-id="7d05b-286">請嘗試取消進行中的工作。</span><span class="sxs-lookup"><span data-stu-id="7d05b-286">Please attempt cancel on an in progress job.</span></span> |<span data-ttu-id="7d05b-287">這起因於暫時性狀態。</span><span class="sxs-lookup"><span data-stu-id="7d05b-287">This happens due to a transitory state.</span></span> <span data-ttu-id="7d05b-288">請稍候再重試取消作業。</span><span class="sxs-lookup"><span data-stu-id="7d05b-288">Wait for a minute and retry the cancel operation.</span></span> |
| <span data-ttu-id="7d05b-289">無法取消工作：請等待工作完成。</span><span class="sxs-lookup"><span data-stu-id="7d05b-289">Failed to cancel the Job - Please wait till job finishes.</span></span> |<span data-ttu-id="7d05b-290">None</span><span class="sxs-lookup"><span data-stu-id="7d05b-290">None</span></span> |

## <a name="restore"></a><span data-ttu-id="7d05b-291">還原</span><span class="sxs-lookup"><span data-stu-id="7d05b-291">Restore</span></span>
| <span data-ttu-id="7d05b-292">錯誤詳細資料</span><span class="sxs-lookup"><span data-stu-id="7d05b-292">Error details</span></span> | <span data-ttu-id="7d05b-293">因應措施</span><span class="sxs-lookup"><span data-stu-id="7d05b-293">Workaround</span></span> |
| --- | --- |
| <span data-ttu-id="7d05b-294">還原失敗並發生雲端內部錯誤</span><span class="sxs-lookup"><span data-stu-id="7d05b-294">Restore failed with Cloud Internal error</span></span> |<ol><li><span data-ttu-id="7d05b-295">您嘗試還原的雲端服務是使用 DNS 設定所設定。</span><span class="sxs-lookup"><span data-stu-id="7d05b-295">Cloud service to which you are trying to restore is configured with DNS settings.</span></span> <span data-ttu-id="7d05b-296">您可以檢查</span><span class="sxs-lookup"><span data-stu-id="7d05b-296">You can check</span></span> <br><span data-ttu-id="7d05b-297">$deployment = Get-AzureDeployment -ServiceName "ServiceName" -Slot "Production"     Get-AzureDns -DnsSettings $deployment.DnsSettings</span><span class="sxs-lookup"><span data-stu-id="7d05b-297">$deployment = Get-AzureDeployment -ServiceName "ServiceName" -Slot "Production"     Get-AzureDns -DnsSettings $deployment.DnsSettings</span></span><br><span data-ttu-id="7d05b-298">如果設定了 Address，這表示已設定 DNS 設定。</span><span class="sxs-lookup"><span data-stu-id="7d05b-298">If there is Address configured, this means that DNS settings are configured.</span></span><br> <li><span data-ttu-id="7d05b-299">您嘗試還原到其中的雲端服務是使用 ReservedIP 所設定，而雲端服務中現有的 VM 目前處於停止狀態。</span><span class="sxs-lookup"><span data-stu-id="7d05b-299">Cloud service to which to you are trying to restore is configured with ReservedIP and existing VMs in cloud service are in stopped state.</span></span><br><span data-ttu-id="7d05b-300">您可以使用下列 powershell Cmdlet，來檢查雲端服務是否具有保留的 IP：</span><span class="sxs-lookup"><span data-stu-id="7d05b-300">You can check a cloud service has reserved IP by using following powershell cmdlets:</span></span><br><span data-ttu-id="7d05b-301">$deployment = Get-AzureDeployment -ServiceName "servicename" -Slot "Production" $dep.ReservedIPName</span><span class="sxs-lookup"><span data-stu-id="7d05b-301">$deployment = Get-AzureDeployment -ServiceName "servicename" -Slot "Production" $dep.ReservedIPName</span></span> <br><li><span data-ttu-id="7d05b-302">您嘗試將具有下列特殊網路組態的虛擬機器還原至相同的雲端服務。</span><span class="sxs-lookup"><span data-stu-id="7d05b-302">You are trying to restore a virtual machine with following special network configurations in to same cloud service.</span></span> <br><span data-ttu-id="7d05b-303">- 負載平衡器組態下的虛擬機器 (內部與外部)</span><span class="sxs-lookup"><span data-stu-id="7d05b-303">- Virtual machines under load balancer configuration (Internal and external)</span></span><br><span data-ttu-id="7d05b-304">- 具有多個保留 IP 的虛擬機器</span><span class="sxs-lookup"><span data-stu-id="7d05b-304">- Virtual machines with multiple Reserved IPs</span></span><br><span data-ttu-id="7d05b-305">- 具有多個 NIC 的虛擬機器</span><span class="sxs-lookup"><span data-stu-id="7d05b-305">- Virtual machines with multiple NICs</span></span><br><span data-ttu-id="7d05b-306">請在 UI 中選取新的雲端服務，或請參閱適用於具有特殊網路組態之 VM 的[還原考量](backup-azure-arm-restore-vms.md#restoring-vms-with-special-network-configurations)。</span><span class="sxs-lookup"><span data-stu-id="7d05b-306">Please select a new cloud service in the UI or please refer to [restore considerations](backup-azure-arm-restore-vms.md#restoring-vms-with-special-network-configurations) for VMs with special network configurations.</span></span></ol> |
| <span data-ttu-id="7d05b-307">所選取的 DNS 名稱已被使用：請指定不同的 DNS 名稱，然後再試一次。</span><span class="sxs-lookup"><span data-stu-id="7d05b-307">The selected DNS name is already taken - Please specify a different DNS name and try again.</span></span> |<span data-ttu-id="7d05b-308">此處的 DNS 名稱是指雲端服務名稱 (結尾通常是 .cloudapp.net)。</span><span class="sxs-lookup"><span data-stu-id="7d05b-308">The DNS name here refers to the cloud service name (usually ending with .cloudapp.net).</span></span> <span data-ttu-id="7d05b-309">這必須是唯一的。</span><span class="sxs-lookup"><span data-stu-id="7d05b-309">This needs to be unique.</span></span> <span data-ttu-id="7d05b-310">如果您遇到這個錯誤，您需要在還原期間選擇不同的 VM 名稱。</span><span class="sxs-lookup"><span data-stu-id="7d05b-310">If you encounter this error, you need to choose a different VM name during restore.</span></span> <br><br> <span data-ttu-id="7d05b-311">只有 Azure 入口網站的使用者才會看到這個錯誤。</span><span class="sxs-lookup"><span data-stu-id="7d05b-311">This error is shown only to users of the Azure portal.</span></span> <span data-ttu-id="7d05b-312">透過 PowerShell 執行還原作業將會成功，因為它只會還原磁碟，並不會建立 VM。</span><span class="sxs-lookup"><span data-stu-id="7d05b-312">The restore operation through PowerShell will succeed because it only restores the disks and doesn't create the VM.</span></span> <span data-ttu-id="7d05b-313">當您在磁碟還原作業之後明確建立 VM 時，將會遇到此錯誤。</span><span class="sxs-lookup"><span data-stu-id="7d05b-313">The error will be faced when the VM is explicitly created by you after the disk restore operation.</span></span> |
| <span data-ttu-id="7d05b-314">指定的虛擬網路組態不正確：請指定不同的虛擬網路組態，然後再試一次。</span><span class="sxs-lookup"><span data-stu-id="7d05b-314">The specified virtual network configuration is not correct - Please specify a different virtual network configuration and try again.</span></span> |<span data-ttu-id="7d05b-315">None</span><span class="sxs-lookup"><span data-stu-id="7d05b-315">None</span></span> |
| <span data-ttu-id="7d05b-316">指定的雲端服務使用保留的 IP，但不符合所要還原的虛擬機器組態：請指定另一個不使用保留 IP 的雲端服務，或選擇從另一個復原點還原。</span><span class="sxs-lookup"><span data-stu-id="7d05b-316">The specified cloud service is using a reserved IP, which doesn't match with the configuration of the virtual machine being restored - Please specify a different cloud service, which is not using reserved IP, or choose another recovery point to restore from.</span></span> |<span data-ttu-id="7d05b-317">None</span><span class="sxs-lookup"><span data-stu-id="7d05b-317">None</span></span> |
| <span data-ttu-id="7d05b-318">雲端服務已達到輸入端點數目限制：請指定不同的雲端服務或使用現有的端點來重試作業。</span><span class="sxs-lookup"><span data-stu-id="7d05b-318">Cloud service has reached limit on number of input end points - Retry the operation by specifying a different cloud service or by using an existing endpoint.</span></span> |<span data-ttu-id="7d05b-319">None</span><span class="sxs-lookup"><span data-stu-id="7d05b-319">None</span></span> |
| <span data-ttu-id="7d05b-320">備份保存庫和目標儲存體帳戶位於兩個不同區域：請確定還原作業中指定的儲存體帳戶，位於與備份保存庫相同的 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="7d05b-320">Backup vault and target storage account are in two different regions - Ensure that the storage account specified in restore operation is in the same Azure region as the backup vault.</span></span> |<span data-ttu-id="7d05b-321">None</span><span class="sxs-lookup"><span data-stu-id="7d05b-321">None</span></span> |
| <span data-ttu-id="7d05b-322">不支援還原作業所指定的儲存體帳戶：只支援具有本地備援或異地備援複寫設定的基本/標準儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7d05b-322">Storage Account specified for the restore operation is not supported - Only Basic/Standard storage accounts with locally redundant or geo redundant replication settings are supported.</span></span> <span data-ttu-id="7d05b-323">請選取支援的儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="7d05b-323">Please select a supported storage account</span></span> |<span data-ttu-id="7d05b-324">None</span><span class="sxs-lookup"><span data-stu-id="7d05b-324">None</span></span> |
| <span data-ttu-id="7d05b-325">還原作業所指定的儲存體帳戶類型不在線上：請確定還原作業中指定的儲存體帳戶在線上</span><span class="sxs-lookup"><span data-stu-id="7d05b-325">Type of Storage Account specified for restore operation is not online - Make sure that the storage account specified in restore operation is online</span></span> |<span data-ttu-id="7d05b-326">這可能是因為 Azure 儲存體的暫時性錯誤或運作中斷。</span><span class="sxs-lookup"><span data-stu-id="7d05b-326">This might happen because of a transient error in Azure Storage or due to an outage.</span></span> <span data-ttu-id="7d05b-327">請選擇另一個儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7d05b-327">Please choose another storage account.</span></span> |
| <span data-ttu-id="7d05b-328">已達到資源群組配額：請從 Azure 入口網站刪除一些資源群組，或連絡 Azure 支援以提高限制。</span><span class="sxs-lookup"><span data-stu-id="7d05b-328">Resource Group Quota has been reached - Please delete some resource groups from Azure portal or contact Azure support to increase the limits.</span></span> |<span data-ttu-id="7d05b-329">None</span><span class="sxs-lookup"><span data-stu-id="7d05b-329">None</span></span> |
| <span data-ttu-id="7d05b-330">選取的子網路不存在：請選取已存在的子網路</span><span class="sxs-lookup"><span data-stu-id="7d05b-330">Selected subnet does not exist - Please select a subnet which exists</span></span> |<span data-ttu-id="7d05b-331">None</span><span class="sxs-lookup"><span data-stu-id="7d05b-331">None</span></span> |
| <span data-ttu-id="7d05b-332">備份服務無權存取您訂用帳戶中的資源。</span><span class="sxs-lookup"><span data-stu-id="7d05b-332">Backup Service does not have authorization to access resources in your subscription.</span></span> |<span data-ttu-id="7d05b-333">若要解決此問題，請先使用[選擇 VM 還原組態](backup-azure-arm-restore-vms.md#choosing-a-vm-restore-configuration)的＜還原備份的磁碟＞一節中所述的步驟來還原磁碟。</span><span class="sxs-lookup"><span data-stu-id="7d05b-333">To resolve this, first Restore Disks using steps mentioned in section **Restore backed up disks** in [Choosing VM restore configuration](backup-azure-arm-restore-vms.md#choosing-a-vm-restore-configuration).</span></span> <span data-ttu-id="7d05b-334">之後，使用[從還原的磁碟建立 VM](backup-azure-vms-automation.md#create-a-vm-from-restored-disks) 中所述的 PowerShell 步驟，從還原的磁碟建立完整的 VM。</span><span class="sxs-lookup"><span data-stu-id="7d05b-334">After that, use PowerShell steps mentioned in [Create a VM from restored disks](backup-azure-vms-automation.md#create-a-vm-from-restored-disks) to create full VM from restored disks.</span></span> |

## <a name="backup-or-restore-taking-time"></a><span data-ttu-id="7d05b-335">備份或還原很花時間</span><span class="sxs-lookup"><span data-stu-id="7d05b-335">Backup or Restore taking time</span></span>
<span data-ttu-id="7d05b-336">如果您發現備份 (超過 12小時) 或還原 (超過 6小時) 很花時間：</span><span class="sxs-lookup"><span data-stu-id="7d05b-336">If you see your backup(>12 hours) or restore taking time(>6 hours):</span></span>
* <span data-ttu-id="7d05b-337">了解[增加備份時間的因素](backup-azure-vms-introduction.md#total-vm-backup-time)和[增加還原時間的因素](backup-azure-vms-introduction.md#total-restore-time)。</span><span class="sxs-lookup"><span data-stu-id="7d05b-337">Understand [factors contributing to backup time](backup-azure-vms-introduction.md#total-vm-backup-time) and [factors contributing to restore time](backup-azure-vms-introduction.md#total-restore-time).</span></span>
* <span data-ttu-id="7d05b-338">請務必遵循[備份最佳做法](backup-azure-vms-introduction.md#best-practices)。</span><span class="sxs-lookup"><span data-stu-id="7d05b-338">Make sure that you follow [Backup best practices](backup-azure-vms-introduction.md#best-practices).</span></span> 

## <a name="vm-agent"></a><span data-ttu-id="7d05b-339">VM 代理程式</span><span class="sxs-lookup"><span data-stu-id="7d05b-339">VM Agent</span></span>
### <a name="setting-up-the-vm-agent"></a><span data-ttu-id="7d05b-340">設定 VM 代理程式</span><span class="sxs-lookup"><span data-stu-id="7d05b-340">Setting up the VM Agent</span></span>
<span data-ttu-id="7d05b-341">一般而言，VM 代理程式已存在於從 Azure 資源庫建立的 VM 中。</span><span class="sxs-lookup"><span data-stu-id="7d05b-341">Typically, the VM Agent is already present in VMs that are created from the Azure gallery.</span></span> <span data-ttu-id="7d05b-342">不過，從內部部署資料中心移轉的虛擬機器不會安裝 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="7d05b-342">However, virtual machines that are migrated from on-premises datacenters would not have the VM Agent installed.</span></span> <span data-ttu-id="7d05b-343">對於這類 VM，必須明確安裝 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="7d05b-343">For such VMs, the VM Agent needs to be installed explicitly.</span></span>

<span data-ttu-id="7d05b-344">若為 Windows VM：</span><span class="sxs-lookup"><span data-stu-id="7d05b-344">For Windows VMs:</span></span>

* <span data-ttu-id="7d05b-345">下載並安裝 [代理程式 MSI](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409)。</span><span class="sxs-lookup"><span data-stu-id="7d05b-345">Download and install the [agent MSI](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409).</span></span> <span data-ttu-id="7d05b-346">您需要有系統管理員權限，才能完成安裝。</span><span class="sxs-lookup"><span data-stu-id="7d05b-346">You need Administrator privileges to complete the installation.</span></span>
* <span data-ttu-id="7d05b-347">若為傳統虛擬機器，請[更新 VM 屬性](http://blogs.msdn.com/b/mast/archive/2014/04/08/install-the-vm-agent-on-an-existing-azure-vm.aspx) \(英文\) 以指出代理程式已安裝。</span><span class="sxs-lookup"><span data-stu-id="7d05b-347">For Classic virtual machines, [Update the VM property](http://blogs.msdn.com/b/mast/archive/2014/04/08/install-the-vm-agent-on-an-existing-azure-vm.aspx) to indicate that the agent is installed.</span></span> <span data-ttu-id="7d05b-348">資源管理員虛擬機器不需要此步驟。</span><span class="sxs-lookup"><span data-stu-id="7d05b-348">This step is not required for Resource Manager virtual machines.</span></span>

<span data-ttu-id="7d05b-349">如為 Linux VM：</span><span class="sxs-lookup"><span data-stu-id="7d05b-349">For Linux VMs:</span></span>

* <span data-ttu-id="7d05b-350">從發佈存放庫安裝最新版。</span><span class="sxs-lookup"><span data-stu-id="7d05b-350">Install latest from distribution repository.</span></span> <span data-ttu-id="7d05b-351">我們「強烈建議」只透過發佈存放庫安裝代理程式。</span><span class="sxs-lookup"><span data-stu-id="7d05b-351">We **strongly recommend** installing agent only through distribution repository.</span></span> <span data-ttu-id="7d05b-352">如需封裝名稱的詳細資料，請參閱 [Linux 代理程式存放庫](https://github.com/Azure/WALinuxAgent)</span><span class="sxs-lookup"><span data-stu-id="7d05b-352">For details on package name, please refer to [Linux agent repository](https://github.com/Azure/WALinuxAgent)</span></span> 
* <span data-ttu-id="7d05b-353">若為傳統 VM，請[更新 VM 屬性](http://blogs.msdn.com/b/mast/archive/2014/04/08/install-the-vm-agent-on-an-existing-azure-vm.aspx) \(英文\) 以指出代理程式已安裝。</span><span class="sxs-lookup"><span data-stu-id="7d05b-353">For classic VMs, [Update the VM property](http://blogs.msdn.com/b/mast/archive/2014/04/08/install-the-vm-agent-on-an-existing-azure-vm.aspx) to indicate that the agent is installed.</span></span> <span data-ttu-id="7d05b-354">資源管理員虛擬機器不需要此步驟。</span><span class="sxs-lookup"><span data-stu-id="7d05b-354">This step is not required for Resource Manager virtual machines.</span></span>

### <a name="updating-the-vm-agent"></a><span data-ttu-id="7d05b-355">更新 VM 代理程式</span><span class="sxs-lookup"><span data-stu-id="7d05b-355">Updating the VM Agent</span></span>
<span data-ttu-id="7d05b-356">若為 Windows VM：</span><span class="sxs-lookup"><span data-stu-id="7d05b-356">For Windows VMs:</span></span>

* <span data-ttu-id="7d05b-357">更新 VM 代理程式與重新安裝 [VM 代理程式二進位檔](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409)一樣簡單。</span><span class="sxs-lookup"><span data-stu-id="7d05b-357">Updating the VM Agent is as simple as reinstalling the [VM Agent binaries](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409).</span></span> <span data-ttu-id="7d05b-358">不過，您需要確定在更新 VM 代理程式時，沒有任何執行中的備份作業。</span><span class="sxs-lookup"><span data-stu-id="7d05b-358">However, you need to ensure that no backup operation is running while the VM Agent is being updated.</span></span>

<span data-ttu-id="7d05b-359">如為 Linux VM：</span><span class="sxs-lookup"><span data-stu-id="7d05b-359">For Linux VMs:</span></span>

* <span data-ttu-id="7d05b-360">遵循[更新 Linux VM 代理程式](../virtual-machines/linux/update-agent.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)上的指示進行。</span><span class="sxs-lookup"><span data-stu-id="7d05b-360">Follow the instructions on [Updating Linux VM Agent](../virtual-machines/linux/update-agent.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>
<span data-ttu-id="7d05b-361">我們**強烈建議**只透過發佈存放庫更新代理程式。</span><span class="sxs-lookup"><span data-stu-id="7d05b-361">We **strongly recommend** updating agent only through distribution repository.</span></span> <span data-ttu-id="7d05b-362">我們不建議直接從 github 下載代理程式程式碼，並加以更新。</span><span class="sxs-lookup"><span data-stu-id="7d05b-362">We do not recommend downloading the agent code from directly github and updating it.</span></span> <span data-ttu-id="7d05b-363">如果最新的代理程式不適用於您的散發套件，請連絡散發套件支援以取得如何安裝最新代理程式的指示。</span><span class="sxs-lookup"><span data-stu-id="7d05b-363">If latest agent is not available for your distribution, please reach out to distribution support for instructions on how to install latest agent.</span></span> <span data-ttu-id="7d05b-364">您可以在 github 存放庫中檢查最新的 [Windows Azure Linux 代理程式](https://github.com/Azure/WALinuxAgent/releases)資訊。</span><span class="sxs-lookup"><span data-stu-id="7d05b-364">You can check latest [Windows Azure Linux agent](https://github.com/Azure/WALinuxAgent/releases) information in github repository.</span></span>

### <a name="validating-vm-agent-installation"></a><span data-ttu-id="7d05b-365">驗證 VM 代理程式安裝</span><span class="sxs-lookup"><span data-stu-id="7d05b-365">Validating VM Agent installation</span></span>
<span data-ttu-id="7d05b-366">如何檢查 Windows VM 上的 VM 代理程式版本：</span><span class="sxs-lookup"><span data-stu-id="7d05b-366">How to check for the VM Agent version on Windows VMs:</span></span>

1. <span data-ttu-id="7d05b-367">登入 Azure 虛擬機器，然後瀏覽至 *C:\WindowsAzure\Packages* 資料夾。</span><span class="sxs-lookup"><span data-stu-id="7d05b-367">Log on to the Azure virtual machine and navigate to the folder *C:\WindowsAzure\Packages*.</span></span> <span data-ttu-id="7d05b-368">您應該會發現 WaAppAgent.exe 檔案已存在。</span><span class="sxs-lookup"><span data-stu-id="7d05b-368">You should find the WaAppAgent.exe file present.</span></span>
2. <span data-ttu-id="7d05b-369">在該檔案上按一下滑鼠右鍵，前往 [屬性]，然後選取 [詳細資料] 索引標籤。[產品版本] 欄位應為 2.6.1198.718 或更高版本</span><span class="sxs-lookup"><span data-stu-id="7d05b-369">Right-click the file, go to **Properties**, and then select the **Details** tab. The Product Version field should be 2.6.1198.718 or higher</span></span>

## <a name="troubleshoot-vm-snapshot-issues"></a><span data-ttu-id="7d05b-370">疑難排解 VM 快照問題</span><span class="sxs-lookup"><span data-stu-id="7d05b-370">Troubleshoot VM Snapshot Issues</span></span>
<span data-ttu-id="7d05b-371">VM 備份仰賴發給底層儲存體的快照命令。</span><span class="sxs-lookup"><span data-stu-id="7d05b-371">VM backup relies on issuing snapshot commands to underlying storage.</span></span> <span data-ttu-id="7d05b-372">無法存取儲存體，或快照工作執行延遲可能會造成備份作業失敗。</span><span class="sxs-lookup"><span data-stu-id="7d05b-372">Not having access to storage, or delays in a snapshot task execution can cause the backup job to fail.</span></span> <span data-ttu-id="7d05b-373">下列可能導致快照工作失敗。</span><span class="sxs-lookup"><span data-stu-id="7d05b-373">The following can cause snapshot task failure.</span></span>

1. <span data-ttu-id="7d05b-374">使用 NSG 封鎖儲存體網路存取</span><span class="sxs-lookup"><span data-stu-id="7d05b-374">Network access to Storage is blocked using NSG</span></span><br>
    <span data-ttu-id="7d05b-375">深入了解如何使用 IP 允許清單或透過 Proxy 伺服器對儲存體[啟用網路存取](backup-azure-vms-prepare.md#network-connectivity)。</span><span class="sxs-lookup"><span data-stu-id="7d05b-375">Learn more on how to [enable network access](backup-azure-vms-prepare.md#network-connectivity) to Storage using either WhiteListing of IPs or through proxy server.</span></span>
2. <span data-ttu-id="7d05b-376">已設定 SQL Server 備份的 VM 會造成快照工作延遲 </span><span class="sxs-lookup"><span data-stu-id="7d05b-376">VMs with Sql Server backup configured can cause snapshot task delay</span></span> <br>
   <span data-ttu-id="7d05b-377">根據預設，VM 備份會核發 Windows VM 上的 VSS 完整備份。</span><span class="sxs-lookup"><span data-stu-id="7d05b-377">By default VM backup issues VSS Full backup on Windows VMs.</span></span> <span data-ttu-id="7d05b-378">在執行 SQL Server 且已設定 SQL Server 備份的 VM 上，這可能造成快照執行延遲。</span><span class="sxs-lookup"><span data-stu-id="7d05b-378">On VMs that are running Sql Servers and if Sql Server backup is configured, this might cause delay in snapshot execution.</span></span> <span data-ttu-id="7d05b-379">如果您因為快照的問題而遇到備份失敗，請設定下列登錄機碼。</span><span class="sxs-lookup"><span data-stu-id="7d05b-379">Please set following registry key if you are experiencing backup failures because of snapshot issues.</span></span>

   ```
   [HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT]
   "USEVSSCOPYBACKUP"="TRUE"
   ```
3. <span data-ttu-id="7d05b-380">VM 狀態報告不正確，因為 RDP 中的 VM 關機。</span><span class="sxs-lookup"><span data-stu-id="7d05b-380">VM status reported incorrectly because VM is shut down in RDP.</span></span>  <br>
   <span data-ttu-id="7d05b-381">如果您已將 RDP 中的虛擬機器關機，請回到入口網站中檢查 VM 的狀態是否已正確反映。</span><span class="sxs-lookup"><span data-stu-id="7d05b-381">If you have Shut down the virtual machine in RDP, please check back in the portal that VM status is reflected correctly.</span></span> <span data-ttu-id="7d05b-382">如果沒有，請在入口網站中使用 VM 儀表板中的 [關機] 選項將 VM 關機。</span><span class="sxs-lookup"><span data-stu-id="7d05b-382">If not, please shut down the VM in portal using 'Shutdown' option in VM dashboard.</span></span>
4. <span data-ttu-id="7d05b-383">如果有四部以上的 VM 共用相同雲端服務，請設定多個備份原則以錯開備份時間，避免超過四部 VM 同時啟動備份。</span><span class="sxs-lookup"><span data-stu-id="7d05b-383">If more than four VMs share the same cloud service, configure multiple backup policies to stage the backup times so no more than four VM backups are started at the same time.</span></span> <span data-ttu-id="7d05b-384">請試著讓各個原則之間的備份啟動時間相隔一小時。</span><span class="sxs-lookup"><span data-stu-id="7d05b-384">Try to spread the backup start times an hour apart between policies.</span></span>
5. <span data-ttu-id="7d05b-385">VM 正在以高 CPU/記憶體執行。</span><span class="sxs-lookup"><span data-stu-id="7d05b-385">VM is running at High CPU/Memory.</span></span><br>
   <span data-ttu-id="7d05b-386">若虛擬機器正在以高 CPU 使用量 (>90%) 或記憶體執行，快照工作會排入佇列、延遲且最終會逾時。在此情況下，請嘗試隨選備份。</span><span class="sxs-lookup"><span data-stu-id="7d05b-386">If the virtual machine is running at High CPU usage(>90%) or memory, snapshot task is queued, delayed and will eventually gets timed-out. Try on-demand backup in such situations.</span></span>

<br>

## <a name="networking"></a><span data-ttu-id="7d05b-387">網路</span><span class="sxs-lookup"><span data-stu-id="7d05b-387">Networking</span></span>
<span data-ttu-id="7d05b-388">如同所有的延伸模組，備份延伸模組需要存取公用網際網路才能運作。</span><span class="sxs-lookup"><span data-stu-id="7d05b-388">Like all extensions, Backup extension need access to the public internet to work.</span></span> <span data-ttu-id="7d05b-389">沒有公用網際網路的存取權，可能會以各種不同方式的資訊清單形式顯現：</span><span class="sxs-lookup"><span data-stu-id="7d05b-389">Not having access to the public internet can manifest itself in various ways:</span></span>

* <span data-ttu-id="7d05b-390">延伸模組安裝可能會失敗</span><span class="sxs-lookup"><span data-stu-id="7d05b-390">The extension installation can fail</span></span>
* <span data-ttu-id="7d05b-391">備份作業 (如磁碟快照) 可能會失敗</span><span class="sxs-lookup"><span data-stu-id="7d05b-391">The backup operations (like disk snapshot) can fail</span></span>
* <span data-ttu-id="7d05b-392">顯示備份作業狀態可能會失敗</span><span class="sxs-lookup"><span data-stu-id="7d05b-392">Displaying the status of the backup operation can fail</span></span>

<span data-ttu-id="7d05b-393">解析網際網路的公用位址的需求已在 [這裡](http://blogs.msdn.com/b/mast/archive/2014/06/18/azure-vm-provisioning-stuck-on-quot-installing-extensions-on-virtual-machine-quot.aspx)說明。</span><span class="sxs-lookup"><span data-stu-id="7d05b-393">The need for resolving public internet addresses has been articulated [here](http://blogs.msdn.com/b/mast/archive/2014/06/18/azure-vm-provisioning-stuck-on-quot-installing-extensions-on-virtual-machine-quot.aspx).</span></span> <span data-ttu-id="7d05b-394">您必須檢查 VNET 的 DNS 設定，並確定可以解析 Azure URI。</span><span class="sxs-lookup"><span data-stu-id="7d05b-394">You need to check the DNS configurations for the VNET and ensure that the Azure URIs can be resolved.</span></span>

<span data-ttu-id="7d05b-395">正確完成名稱解析後，也必須提供 Azure IP 的存取權。</span><span class="sxs-lookup"><span data-stu-id="7d05b-395">Once the name resolution is done correctly, access to the Azure IPs also needs to be provided.</span></span> <span data-ttu-id="7d05b-396">若要解除封鎖對 Azure 基礎結構的存取，請遵循下列步驟進行：</span><span class="sxs-lookup"><span data-stu-id="7d05b-396">To unblock access to the Azure infrastructure, follow one of these steps:</span></span>

1. <span data-ttu-id="7d05b-397">將 Azure 資料中心的 IP 範圍列入允許清單。</span><span class="sxs-lookup"><span data-stu-id="7d05b-397">WhiteList the Azure datacenter IP ranges.</span></span>
   * <span data-ttu-id="7d05b-398">取得要列入允許清單的 [Azure 資料中心 IP](https://www.microsoft.com/download/details.aspx?id=41653) 。</span><span class="sxs-lookup"><span data-stu-id="7d05b-398">Get the list of [Azure datacenter IPs](https://www.microsoft.com/download/details.aspx?id=41653) to be whitelisted.</span></span>
   * <span data-ttu-id="7d05b-399">使用 [New-NetRoute](https://technet.microsoft.com/library/hh826148.aspx) Cmdlet 解除封鎖該 IP。</span><span class="sxs-lookup"><span data-stu-id="7d05b-399">Unblock the IPs using the [New-NetRoute](https://technet.microsoft.com/library/hh826148.aspx) cmdlet.</span></span> <span data-ttu-id="7d05b-400">在提升權限的 PowerShell 視窗中 (以系統管理員身分執行)，於 Azure VM 內執行這個 Cmdlet。</span><span class="sxs-lookup"><span data-stu-id="7d05b-400">Run this cmdlet within the Azure VM, in an elevated PowerShell window (run as Administrator).</span></span>
   * <span data-ttu-id="7d05b-401">將規則加入 NSG (若已有規則)，以允許存取該 IP。</span><span class="sxs-lookup"><span data-stu-id="7d05b-401">Add rules to the NSG (if you have one in place) to allow access to the IPs.</span></span>
2. <span data-ttu-id="7d05b-402">建立 HTTP 流量的行經路徑</span><span class="sxs-lookup"><span data-stu-id="7d05b-402">Create a path for HTTP traffic to flow</span></span>
   * <span data-ttu-id="7d05b-403">如果已有一些網路限制 (例如，網路安全性群組)，請部署 HTTP Proxy 伺服器來路由傳送流量。</span><span class="sxs-lookup"><span data-stu-id="7d05b-403">If you have some network restriction in place (a Network Security Group, for example) deploy an HTTP proxy server to route the traffic.</span></span> <span data-ttu-id="7d05b-404">部署 HTTP Proxy 伺服器的步驟位於[這裡](backup-azure-vms-prepare.md#network-connectivity)。</span><span class="sxs-lookup"><span data-stu-id="7d05b-404">Steps to deploy an HTTP Proxy server can found [here](backup-azure-vms-prepare.md#network-connectivity).</span></span>
   * <span data-ttu-id="7d05b-405">將規則加入 NSG (若已有規則)，以允許從 HTTP Proxy 存取網際網路。</span><span class="sxs-lookup"><span data-stu-id="7d05b-405">Add rules to the NSG (if you have one in place) to allow access to the INTERNET from the HTTP Proxy.</span></span>

> [!NOTE]
> <span data-ttu-id="7d05b-406">必須在來賓內啟用 DHCP，IaaS VM 備份才能運作。</span><span class="sxs-lookup"><span data-stu-id="7d05b-406">DHCP must be enabled inside the guest for IaaS VM Backup to work.</span></span>  <span data-ttu-id="7d05b-407">如果您需要靜態私人 IP 位址，您應該透過平台來進行設定。</span><span class="sxs-lookup"><span data-stu-id="7d05b-407">If you need a static private IP, you should configure it through the platform.</span></span> <span data-ttu-id="7d05b-408">VM 內的 DHCP 選項應保持啟用。</span><span class="sxs-lookup"><span data-stu-id="7d05b-408">The DHCP option inside the VM should be left enabled.</span></span>
> <span data-ttu-id="7d05b-409">請參閱有關 [設定靜態內部私人 IP 位址](../virtual-network/virtual-networks-reserved-private-ip.md)的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="7d05b-409">View more information about [Setting a Static Internal Private IP](../virtual-network/virtual-networks-reserved-private-ip.md).</span></span>
>
>
