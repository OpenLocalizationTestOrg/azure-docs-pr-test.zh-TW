---
title: "在 Azure 中規劃 VM 備份基礎結構 | Microsoft Docs"
description: "在 Azure 中備份虛擬機器時的重要考量"
services: backup
documentationcenter: 
author: markgalioto
manager: carmonm
editor: 
keywords: "備份 VM, 備份虛擬機器"
ms.assetid: 19d2cf82-1f60-43e1-b089-9238042887a9
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 7/18/2017
ms.author: markgal;trinadhk
ms.openlocfilehash: 0c930c7413b24a811707c3a1ff3d7d70585bc528
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="plan-your-vm-backup-infrastructure-in-azure"></a><span data-ttu-id="7c5c9-104">在 Azure 中規劃 VM 備份基礎結構</span><span class="sxs-lookup"><span data-stu-id="7c5c9-104">Plan your VM backup infrastructure in Azure</span></span>
<span data-ttu-id="7c5c9-105">本文提供效能和資源方面的建議，以協助您規劃 VM 備份基礎結構。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-105">This article provides performance and resource suggestions to help you plan your VM backup infrastructure.</span></span> <span data-ttu-id="7c5c9-106">本文也會定義備份服務的重要層面；這些層面對於決定架構、容量規劃及排程來說相當重要。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-106">It also defines key aspects of the Backup service; these aspects can be critical in determining your architecture, capacity planning, and scheduling.</span></span> <span data-ttu-id="7c5c9-107">如果您已經[準備好環境](backup-azure-vms-prepare.md)，則規劃是您開始[備份 VM](backup-azure-vms.md) 之前的下一個步驟。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-107">If you've [prepared your environment](backup-azure-vms-prepare.md), planning is the next step before you begin [to back up VMs](backup-azure-vms.md).</span></span> <span data-ttu-id="7c5c9-108">如果您需要 Azure 虛擬機器的詳細資訊，請參閱 [虛擬機器文件](https://azure.microsoft.com/documentation/services/virtual-machines/)。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-108">If you need more information about Azure virtual machines, see the [Virtual Machines documentation](https://azure.microsoft.com/documentation/services/virtual-machines/).</span></span>

## <a name="how-does-azure-back-up-virtual-machines"></a><span data-ttu-id="7c5c9-109">Azure 如何備份虛擬機器？</span><span class="sxs-lookup"><span data-stu-id="7c5c9-109">How does Azure back up virtual machines?</span></span>
<span data-ttu-id="7c5c9-110">Azure 備份服務在排定的時間開始備份工作時，會觸發備份擴充功能以建立時間點快照集。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-110">When the Azure Backup service initiates a backup job at the scheduled time, it triggers the backup extension to take a point-in-time snapshot.</span></span> <span data-ttu-id="7c5c9-111">Azure 備份服務在 Windows 中使用 _VMSnapshot_ 延伸模組，在 Linux 中使用 _VMSnapshotLinux_ 延伸模組。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-111">The Azure Backup service uses the _VMSnapshot_ extension in Windows, and the _VMSnapshotLinux_ extension in Linux.</span></span> <span data-ttu-id="7c5c9-112">延伸模組會在進行第一個 VM 備份期間安裝。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-112">The extension is installed during the first VM backup.</span></span> <span data-ttu-id="7c5c9-113">若要安裝延伸模組，VM 必須正在執行中。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-113">To install the extension, the VM must be running.</span></span> <span data-ttu-id="7c5c9-114">如果 VM 未在執行中，則備份服務會擷取基礎儲存體的快照集 (因為 VM 停止時不會發生任何應用程式寫入)。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-114">If the VM is not running, the Backup service takes a snapshot of the underlying storage (since no application writes occur while the VM is stopped).</span></span>

<span data-ttu-id="7c5c9-115">當擷取 Windows VM 的快照集時，備份服務會與磁碟區陰影複製服務 (VSS) 協調，以取得虛擬機器磁碟一致的快照集。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-115">When taking a snapshot of Windows VMs, the Backup service coordinates with the Volume Shadow Copy Service (VSS) to get a consistent snapshot of the virtual machine's disks.</span></span> <span data-ttu-id="7c5c9-116">如果您正在備份 Linux VM，您可以撰寫自己的自訂指令碼，以確保擷取 VM 快照集時會有一致性。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-116">If you're backing up Linux VMs, you can write your own custom scripts to ensure consistency when taking a VM snapshot.</span></span> <span data-ttu-id="7c5c9-117">本文稍後會提供叫用這些指令碼的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-117">Details on invoking these scripts are provided later in this article.</span></span>

<span data-ttu-id="7c5c9-118">Azure 備份服務擷取快照集之後，資料會傳輸至保存庫。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-118">Once the Azure Backup service takes the snapshot, the data is transferred to the vault.</span></span> <span data-ttu-id="7c5c9-119">為了能更有效率，服務只會找出並傳輸自上次備份之後有變更的資料區塊。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-119">To maximize efficiency, the service identifies and transfers only the blocks of data that have changed since the previous backup.</span></span>

![Azure 虛擬機器備份架構](./media/backup-azure-vms-introduction/vmbackup-architecture.png)

<span data-ttu-id="7c5c9-121">資料傳輸完畢後，系統會移除快照集並建立復原點。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-121">When the data transfer is complete, the snapshot is removed and a recovery point is created.</span></span>

> [!NOTE]
> 1. <span data-ttu-id="7c5c9-122">在備份程序進行期間，Azure 備份不會包含連接至虛擬機器的暫存磁碟。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-122">During the backup process, Azure Backup doesn't include the temporary disk attached to the virtual machine.</span></span> <span data-ttu-id="7c5c9-123">如需詳細資訊，請參閱[暫存儲存空間](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/)部落格文章 (英文)。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-123">For more information, see the blog on [temporary storage](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/).</span></span>
> 2. <span data-ttu-id="7c5c9-124">由於 Azure 備份會擷取儲存體層級的快照集，並將快照集傳輸至保存庫，因此在備份作業完成前，請勿變更儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-124">Since Azure Backup takes a storage-level snapshot and transfers that snapshot to vault, do not change the storage account keys until the backup job finishes.</span></span>
> 3. <span data-ttu-id="7c5c9-125">對於進階 VM，我們會將快照集複製到儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-125">For premium VMs, we copy the snapshot to storage account.</span></span> <span data-ttu-id="7c5c9-126">這是為了確定 Azure 備份服務能取得足夠的 IOPS，將資料傳送至保存庫。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-126">This is to make sure that Azure Backup service gets sufficient IOPS for transferring data to vault.</span></span> <span data-ttu-id="7c5c9-127">額外的儲存體複本依 VM 配置大小收費。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-127">This additional copy of storage is charged as per the VM allocated size.</span></span> 
>

### <a name="data-consistency"></a><span data-ttu-id="7c5c9-128">資料一致性</span><span class="sxs-lookup"><span data-stu-id="7c5c9-128">Data consistency</span></span>
<span data-ttu-id="7c5c9-129">備份與還原業務重要資料之所以複雜，原因在於資料必須在產生資料的應用程式執行時進行備份。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-129">Backing up and restoring business critical data is complicated by the fact that business critical data must be backed up while the applications that produce the data are running.</span></span> <span data-ttu-id="7c5c9-130">為了解決此問題，Azure 備份同時針對 Windows 和 Linux VM 支援應用程式一致備份</span><span class="sxs-lookup"><span data-stu-id="7c5c9-130">To address this, Azure Backup supports application-consistent backups for both Windows and Linux VMs</span></span>
#### <a name="windows-vm"></a><span data-ttu-id="7c5c9-131">Windows VM</span><span class="sxs-lookup"><span data-stu-id="7c5c9-131">Windows VM</span></span>
<span data-ttu-id="7c5c9-132">Azure 備份會在 Windows VM 上執行 VSS 完整備份 (深入了解 [VSS 完整備份](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx))。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-132">Azure Backup takes VSS full backups on Windows VMs (read more about [VSS full backup](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx)).</span></span> <span data-ttu-id="7c5c9-133">若要啟用 VSS 複製備份，需要在 VM 上設定下列登錄機碼。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-133">To enable VSS copy backups, the following registry key needs to be set on the VM.</span></span>

```
[HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT]
"USEVSSCOPYBACKUP"="TRUE"
```

#### <a name="linux-vms"></a><span data-ttu-id="7c5c9-134">Linux VM</span><span class="sxs-lookup"><span data-stu-id="7c5c9-134">Linux VMs</span></span>
<span data-ttu-id="7c5c9-135">Azure 備份提供指令碼架構。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-135">Azure Backup provides a scripting framework.</span></span> <span data-ttu-id="7c5c9-136">為確保備份 Linux VM 時應用程式的一致性，請建立自訂的前指令碼與後指令碼來控制備份工作流程與環境。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-136">To ensure application consistency when backing up Linux VMs, create custom pre-scripts and post-scripts that control the backup workflow and environment.</span></span> <span data-ttu-id="7c5c9-137">Azure 備份會在擷取 VM 快照集之前先叫用前指令碼，並在 VM 快照集作業完成之後叫用後指令碼。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-137">Azure Backup invokes the pre-script before taking the VM snapshot and invokes the post-script once the VM snapshot job completes.</span></span> <span data-ttu-id="7c5c9-138">如需詳細資訊，請參閱 [Azure Linux VM 的應用程式一致備份 (預覽)](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent)。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-138">For more details, see [application consistent VM backups using pre-script and post-script](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span></span>
> [!NOTE]
> <span data-ttu-id="7c5c9-139">Azure 備份只會叫用客戶撰寫的前指令碼和後指令碼。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-139">Azure Backup only invokes the customer-written pre- and post-scripts.</span></span> <span data-ttu-id="7c5c9-140">如果前指令碼和後指令碼順利執行，Azure 備份會將復原點標記為應用程式一致。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-140">If the pre-script and post-scripts execute successfully, Azure Backup marks the recovery point as application consistent.</span></span> <span data-ttu-id="7c5c9-141">但是，客戶要對使用自訂指令碼時的應用一致性負最終責任。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-141">However, the customer is ultimately responsible for the application consistency when using custom scripts.</span></span>
>


<span data-ttu-id="7c5c9-142">此表說明一致性的類型，以及它們在 Azure VM 備份和還原程序期間發生的條件。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-142">This table explains the types of consistency and the conditions that they occur under during Azure VM backup and restore procedures.</span></span>

| <span data-ttu-id="7c5c9-143">一致性</span><span class="sxs-lookup"><span data-stu-id="7c5c9-143">Consistency</span></span> | <span data-ttu-id="7c5c9-144">以 VSS 基礎</span><span class="sxs-lookup"><span data-stu-id="7c5c9-144">VSS-based</span></span> | <span data-ttu-id="7c5c9-145">說明和詳細資料</span><span class="sxs-lookup"><span data-stu-id="7c5c9-145">Explanation and details</span></span> |
| --- | --- | --- |
| <span data-ttu-id="7c5c9-146">應用程式一致性</span><span class="sxs-lookup"><span data-stu-id="7c5c9-146">Application consistency</span></span> |<span data-ttu-id="7c5c9-147">是 - 適用於 Windows</span><span class="sxs-lookup"><span data-stu-id="7c5c9-147">Yes for Windows</span></span>|<span data-ttu-id="7c5c9-148">對於工作負載而言，最理想的情況是應用程式一致性，因為它確保：</span><span class="sxs-lookup"><span data-stu-id="7c5c9-148">Application consistency is ideal for workloads as it ensures that:</span></span><ol><li> <span data-ttu-id="7c5c9-149">VM 啟動。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-149">The VM *boots up*.</span></span> <li><span data-ttu-id="7c5c9-150">不會毀損。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-150">There is *no corruption*.</span></span> <li><span data-ttu-id="7c5c9-151">不會遺失資料。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-151">There is *no data loss*.</span></span><li> <span data-ttu-id="7c5c9-152">資料會與使用資料的應用程式保持一致，方法是在備份期間使用 VSS 或前/後指令碼將應用程式納入。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-152">The data is consistent to the application that uses the data, by involving the application at the time of backup--using VSS or pre/post script.</span></span></ol> <li><span data-ttu-id="7c5c9-153">*Windows VM*- 大部分 Microsoft 工作負載都有 VSS 寫入器，負責執行與資料一致性有關的工作負載特定動作。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-153">*Windows VMs*- Most Microsoft workloads have VSS writers that do workload-specific actions related to data consistency.</span></span> <span data-ttu-id="7c5c9-154">例如，Microsoft SQL Server 的 VSS 寫入器可確保正確寫入交易記錄檔和資料庫。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-154">For example, Microsoft SQL Server has a VSS writer that ensures that the writes to the transaction log file and the database are done correctly.</span></span> <span data-ttu-id="7c5c9-155">對於 Azure Windows VM 備份，若要建立應用程式一致的復原點，備份擴充功能必須叫用 VSS 工作流程，並在建立 VM 快照之前完成它。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-155">For Azure Windows VM backups, to create an application-consistent recovery point, the backup extension must invoke the VSS workflow and complete it before taking the VM snapshot.</span></span> <span data-ttu-id="7c5c9-156">若要取得精確的 Azure VM 快照集，也必須完成所有 Azure VM 應用程式的 VSS 寫入器。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-156">For the Azure VM snapshot to be accurate, the VSS writers of all Azure VM applications must complete as well.</span></span> <span data-ttu-id="7c5c9-157">(了解 [VSS 的基本知識](http://blogs.technet.com/b/josebda/archive/2007/10/10/the-basics-of-the-volume-shadow-copy-service-vss.aspx)及深入了解[其運作方式](https://technet.microsoft.com/library/cc785914%28v=ws.10%29.aspx)的詳細資料)。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-157">(Learn the [basics of VSS](http://blogs.technet.com/b/josebda/archive/2007/10/10/the-basics-of-the-volume-shadow-copy-service-vss.aspx) and dive deep into the details of [how it works](https://technet.microsoft.com/library/cc785914%28v=ws.10%29.aspx)).</span></span> </li> <li> <span data-ttu-id="7c5c9-158">*Linux VM*- 客戶可以執行[自訂前指令碼和後指令碼以確保應用程式一致性](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent)。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-158">*Linux VMs*- Customers can execute [custom pre-script and post-script to ensure application consistency](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span></span> </li> |
| <span data-ttu-id="7c5c9-159">檔案系統一致性</span><span class="sxs-lookup"><span data-stu-id="7c5c9-159">File-system consistency</span></span> |<span data-ttu-id="7c5c9-160">是 - 適用於 Windows 電腦</span><span class="sxs-lookup"><span data-stu-id="7c5c9-160">Yes - for Windows-based computers</span></span> |<span data-ttu-id="7c5c9-161">有兩種案例的復原點可以讓「檔案系統保持一致」：</span><span class="sxs-lookup"><span data-stu-id="7c5c9-161">There are two scenarios where the recovery point can be *file-system consistent*:</span></span><ul><li><span data-ttu-id="7c5c9-162">Azure 中 Linux VM 的備份，沒有前指令碼/後指令碼，或是前指令碼/後指令碼失敗。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-162">Backups of Linux VMs in Azure, without pre-script/post-script or if pre-script/post-script failed.</span></span> <li><span data-ttu-id="7c5c9-163">在 Azure 中備份 Windows VM 期間發生的 VSS 失敗。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-163">VSS failure during backup for Windows VMs in Azure.</span></span></li></ul> <span data-ttu-id="7c5c9-164">在這兩種情況中，可採取的最佳作法是確保：</span><span class="sxs-lookup"><span data-stu-id="7c5c9-164">In both these cases, the best that can be done is to ensure that:</span></span> <ol><li> <span data-ttu-id="7c5c9-165">VM 啟動。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-165">The VM *boots up*.</span></span> <li><span data-ttu-id="7c5c9-166">不會毀損。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-166">There is *no corruption*.</span></span><li><span data-ttu-id="7c5c9-167">不會遺失資料。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-167">There is *no data loss*.</span></span></ol> <span data-ttu-id="7c5c9-168">應用程式需要在還原的資料上實作自己的「修正」機制。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-168">Applications need to implement their own "fix-up" mechanism on the restored data.</span></span> |
| <span data-ttu-id="7c5c9-169">損毀一致性</span><span class="sxs-lookup"><span data-stu-id="7c5c9-169">Crash consistency</span></span> |<span data-ttu-id="7c5c9-170">否</span><span class="sxs-lookup"><span data-stu-id="7c5c9-170">No</span></span> |<span data-ttu-id="7c5c9-171">此狀況相當於虛擬機器「當機」(經由軟體重設或硬體重設)。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-171">This situation is equivalent to a virtual machine experiencing a "crash" (through either a soft or hard reset).</span></span> <span data-ttu-id="7c5c9-172">當機時保持一致性通常發生於 Azure 虛擬機器在備份期間關閉時。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-172">Crash consistency typically happens when the Azure virtual machine is shut down at the time of backup.</span></span> <span data-ttu-id="7c5c9-173">當機時保持一致的復原點不保證儲存媒體上資料的一致性 -- 無論從作業系統還是應用程式的觀點來說都一樣。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-173">A crash-consistent recovery point provides no guarantees around the consistency of the data on the storage medium--either from the perspective of the operating system or the application.</span></span> <span data-ttu-id="7c5c9-174">只會擷取備份時已存在磁碟上的資料，並加以備份。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-174">Only the data that already exists on the disk at the time of backup is captured and backed up.</span></span> <br/> <br/> <span data-ttu-id="7c5c9-175">儘管不提供保證，但作業系統通常會啟動，後面接著進行磁碟檢查程序 (例如 chkdsk)，以修正任何損毀錯誤。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-175">While there are no guarantees, usually, the operating system boots, followed by disk-checking procedure, like chkdsk, to fix any corruption errors.</span></span> <span data-ttu-id="7c5c9-176">任何未傳輸到磁碟的記憶體內部資料或寫入都會遺失。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-176">Any in-memory data or writes that have not been transferred to the disk are lost.</span></span> <span data-ttu-id="7c5c9-177">如果需要進行資料復原，應用程式通常會接著進行其本身的驗證機制。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-177">The application typically follows with its own verification mechanism in case data rollback needs to be done.</span></span> <br><br><span data-ttu-id="7c5c9-178">例如，如果交易記錄中有項目不存在資料庫中，則資料庫軟體會執行復原，直到資料變成一致為止。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-178">As an example, if the transaction log has entries that are not present in the database, then the database software does a rollback until the data is consistent.</span></span> <span data-ttu-id="7c5c9-179">當資料跨多個虛擬磁碟時 (例如跨距磁碟區)，損毀一致復原點不保證資料的正確性。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-179">When data is spread across multiple virtual disks (like spanned volumes), a crash-consistent recovery point provides no guarantees for the correctness of the data.</span></span> |

## <a name="performance-and-resource-utilization"></a><span data-ttu-id="7c5c9-180">效能與資源使用率</span><span class="sxs-lookup"><span data-stu-id="7c5c9-180">Performance and resource utilization</span></span>
<span data-ttu-id="7c5c9-181">和內部部署的備份軟體一樣，在 Azure 中備份 VM 時也應該規劃容量和資源使用率需求。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-181">Like backup software that is deployed on-premises, you should plan for capacity and resource utilization needs when backing up VMs in Azure.</span></span> <span data-ttu-id="7c5c9-182">[Azure 儲存體限制](../azure-subscription-service-limits.md#storage-limits) 會定義如何建構 VM 部署，以發揮最大效能並盡可能不影響執行中的工作負載。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-182">The [Azure Storage limits](../azure-subscription-service-limits.md#storage-limits) define how to structure VM deployments to get maximum performance with minimum impact to running workloads.</span></span>

<span data-ttu-id="7c5c9-183">在規劃備份效能時，請注意下列 Azure 儲存體限制︰</span><span class="sxs-lookup"><span data-stu-id="7c5c9-183">Pay attention to the following Azure Storage limits when planning backup performance:</span></span>

* <span data-ttu-id="7c5c9-184">每一儲存體帳戶的輸出上限</span><span class="sxs-lookup"><span data-stu-id="7c5c9-184">Max egress per storage account</span></span>
* <span data-ttu-id="7c5c9-185">每一儲存體帳戶的總要求率</span><span class="sxs-lookup"><span data-stu-id="7c5c9-185">Total request rate per storage account</span></span>

### <a name="storage-account-limits"></a><span data-ttu-id="7c5c9-186">儲存體帳戶限制</span><span class="sxs-lookup"><span data-stu-id="7c5c9-186">Storage account limits</span></span>
<span data-ttu-id="7c5c9-187">備份從儲存體帳戶複製的資料，並新增至儲存體帳戶的每秒輸入/輸出作業 (IOPS) 和輸出 (或輸送量) 計量。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-187">Backup data copied from a storage account, adds to the input/output operations per second (IOPS) and egress (or throughput) metrics of the storage account.</span></span> <span data-ttu-id="7c5c9-188">同時，虛擬機器也會耗用 IOPS 和輸送量。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-188">At the same time, virtual machines are also consuming IOPS and throughput.</span></span> <span data-ttu-id="7c5c9-189">目標是要確保備份與虛擬機器流量不會超過您儲存體帳戶限制。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-189">The goal is to ensure Backup and virtual machine traffic don't exceed your storage account limits.</span></span>

### <a name="number-of-disks"></a><span data-ttu-id="7c5c9-190">磁碟數量</span><span class="sxs-lookup"><span data-stu-id="7c5c9-190">Number of disks</span></span>
<span data-ttu-id="7c5c9-191">備份程序會嘗試盡快完成備份作業。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-191">The backup process tries to complete a backup job as quickly as possible.</span></span> <span data-ttu-id="7c5c9-192">過程中，它會竭盡所能地取用資源。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-192">In doing so, it consumes as many resources as it can.</span></span> <span data-ttu-id="7c5c9-193">不過，所有 I/O 作業都受限於 *單一 Blob 的目標輸送量*，上限為每秒 60MB。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-193">However, all I/O operations are limited by the *Target Throughput for Single Blob*, which has a limit of 60 MB per second.</span></span> <span data-ttu-id="7c5c9-194">為了達到最大速度，備份程序會嘗試「平行」 備份每個 VM 的磁碟。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-194">In an attempt to maximize its speed, the backup process tries to back up each of the VM's disks *in parallel*.</span></span> <span data-ttu-id="7c5c9-195">如果 VM 有四個磁碟，服務便會嘗試平行備份全部 4 個磁碟。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-195">If a VM has four disks, the service attempts to back up all four disks in parallel.</span></span> <span data-ttu-id="7c5c9-196">判斷儲存體帳戶備份流量時，要備份的**磁碟數量**是最重要的因素。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-196">The **number of disks** being backed up, is the most important factor in determining storage account backup traffic.</span></span>

### <a name="backup-schedule"></a><span data-ttu-id="7c5c9-197">備份排程</span><span class="sxs-lookup"><span data-stu-id="7c5c9-197">Backup schedule</span></span>
<span data-ttu-id="7c5c9-198">影響效能的另一因素是 **備份排程**。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-198">An additional factor that impacts performance is the **backup schedule**.</span></span> <span data-ttu-id="7c5c9-199">如果您設定原則，讓所有 VM 在同一時間進行備份，您便排定了一場流量壅塞災難。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-199">If you configure the policies so all VMs are backed up at the same time, you have scheduled a traffic jam.</span></span> <span data-ttu-id="7c5c9-200">備份程序會嘗試平行備份所有磁碟。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-200">The backup process attempts to back up all disks in parallel.</span></span> <span data-ttu-id="7c5c9-201">若要減少從儲存體帳戶輸出的備份流量，請在同一天的不同時段備份不同的 VM，時間不要重疊。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-201">To reduce the backup traffic from a storage account, back up different VMs at different time of the day, with no overlap.</span></span>

## <a name="capacity-planning"></a><span data-ttu-id="7c5c9-202">容量規劃</span><span class="sxs-lookup"><span data-stu-id="7c5c9-202">Capacity planning</span></span>
<span data-ttu-id="7c5c9-203">歸納上述因素，您需要規劃儲存體帳戶的使用量需求。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-203">Putting the previous factors together, you need to plan for the storage account usage needs.</span></span> <span data-ttu-id="7c5c9-204">下載 [VM 備份容量規劃 Excel 試算表](https://gallery.technet.microsoft.com/Azure-Backup-Storage-a46d7e33) ，以了解磁碟和備份排程選項所產生的影響。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-204">Download the [VM backup capacity planning Excel spreadsheet](https://gallery.technet.microsoft.com/Azure-Backup-Storage-a46d7e33) to see the impact of your disk and backup schedule choices.</span></span>

### <a name="backup-throughput"></a><span data-ttu-id="7c5c9-205">備份輸送量</span><span class="sxs-lookup"><span data-stu-id="7c5c9-205">Backup throughput</span></span>
<span data-ttu-id="7c5c9-206">針對每個要備份的磁碟，Azure 備份會讀取磁碟上的區塊，只儲存已變更的資料 (增量備份)。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-206">For each disk being backed up, Azure Backup reads the blocks on the disk and stores only the changed data (incremental backup).</span></span> <span data-ttu-id="7c5c9-207">下表顯示備份服務輸送量的平均值。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-207">The following table shows the average Backup service throughput values.</span></span> <span data-ttu-id="7c5c9-208">使用下列資料，您可以預估備份特定大小的磁碟需花費的時間量。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-208">Using the following data, you can estimate the amount of time needed to back up a disk of a given size.</span></span>

| <span data-ttu-id="7c5c9-209">備份作業</span><span class="sxs-lookup"><span data-stu-id="7c5c9-209">Backup operation</span></span> | <span data-ttu-id="7c5c9-210">最佳輸送量</span><span class="sxs-lookup"><span data-stu-id="7c5c9-210">Best-case throughput</span></span> |
| --- | --- |
| <span data-ttu-id="7c5c9-211">初始備份</span><span class="sxs-lookup"><span data-stu-id="7c5c9-211">Initial backup</span></span> |<span data-ttu-id="7c5c9-212">160 Mbps</span><span class="sxs-lookup"><span data-stu-id="7c5c9-212">160 Mbps</span></span> |
| <span data-ttu-id="7c5c9-213">增量備份 (DR)</span><span class="sxs-lookup"><span data-stu-id="7c5c9-213">Incremental backup (DR)</span></span> |<span data-ttu-id="7c5c9-214">640 Mbps </span><span class="sxs-lookup"><span data-stu-id="7c5c9-214">640 Mbps</span></span> <br><br> <span data-ttu-id="7c5c9-215">如果將變更的資料 (需要備份) 分散於磁碟上，則輸送量就會顯著降低。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-215">Throughput drops significantly if the changed data (that needs to be backed up) is dispersed across the disk.</span></span>|

## <a name="total-vm-backup-time"></a><span data-ttu-id="7c5c9-216">VM 備份時間總計</span><span class="sxs-lookup"><span data-stu-id="7c5c9-216">Total VM backup time</span></span>
<span data-ttu-id="7c5c9-217">雖然大部分的備份時間都花費在讀取和複製資料，但備份 VM 所需的全部時間還包含其他作業：</span><span class="sxs-lookup"><span data-stu-id="7c5c9-217">While most of the backup time is spent reading and copying data, other operations contribute to the total time needed to back up a VM:</span></span>

* <span data-ttu-id="7c5c9-218">[安裝或更新備份擴充功能](backup-azure-vms.md)所需要的時間。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-218">Time needed to [install or update the backup extension](backup-azure-vms.md).</span></span>
* <span data-ttu-id="7c5c9-219">快照時間，即觸發快照所需的時間。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-219">Snapshot time, which is the time taken to trigger a snapshot.</span></span> <span data-ttu-id="7c5c9-220">快照會在接近排定的備份時間觸發。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-220">Snapshots are triggered close to the scheduled backup time.</span></span>
* <span data-ttu-id="7c5c9-221">佇列等候時間。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-221">Queue wait time.</span></span> <span data-ttu-id="7c5c9-222">因為備份服務正在處理多個客戶的備份，所以從快照集複製備份資料到備份或復原服務保存庫可能不會立即啟動。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-222">Since the Backup service is processing backups from multiple customers, copying backup data from snapshot to the backup or Recovery Services vault might not start immediately.</span></span> <span data-ttu-id="7c5c9-223">在尖峰負載時，等候時間會因為正在處理的備份數目而長達八小時。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-223">In times of peak load, the wait can stretch up to eight hours due to the number of backups being processed.</span></span> <span data-ttu-id="7c5c9-224">不過，針對每日備份原則，VM 備份時間總計會小於 24 小時。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-224">However, the total VM backup time is less than 24 hours for daily backup policies.</span></span>
* <span data-ttu-id="7c5c9-225">資料傳輸時間，備份服務計算上次備份的增量變更，並將這些變更傳輸到保存庫儲存體所需的時間。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-225">Data transfer time, time needed for backup service to compute the incremental changes from previous backup and transfer those changes to vault storage.</span></span>

### <a name="why-am-i-observing-longer12-hours-backup-time"></a><span data-ttu-id="7c5c9-226">為何我看到的備份時間比較長 (大於 12 小時)？</span><span class="sxs-lookup"><span data-stu-id="7c5c9-226">Why am I observing longer(>12 hours) backup time?</span></span>
<span data-ttu-id="7c5c9-227">備份包含兩個階段：擷取快照集，以及將快照集傳輸到保存庫。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-227">Backup consists of two phases: taking snapshots and transferring the snapshots to the vault.</span></span> <span data-ttu-id="7c5c9-228">備份服務會針對儲存體進行最佳化。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-228">The Backup service optimizes for storage.</span></span> <span data-ttu-id="7c5c9-229">將快照集資料傳輸到保存庫時，服務只會傳輸自上一個快照集以來的累加變更。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-229">When transferring the snapshot data to a vault, the service only transfers incremental changes from the previous snapshot.</span></span>  <span data-ttu-id="7c5c9-230">為了判斷累加變更，服務會計算區塊的總和檢查碼。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-230">To determine the incremental changes, the service computes the checksum of the blocks.</span></span> <span data-ttu-id="7c5c9-231">如果區塊已變更，就會將該區塊識別為要傳送到保存庫的區塊。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-231">If a block is changed, the block is identified as a block to be sent to the vault.</span></span> <span data-ttu-id="7c5c9-232">接著，服務會深入探索每個已識別的區塊，尋找機會將要傳輸的資料降到最低。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-232">Then the service drills further into each of the identified blocks, looking for opportunities to minimize the data to transfer.</span></span> <span data-ttu-id="7c5c9-233">在評估所有已變更的區塊之後，服務會聯合所做的變更，然後將它們傳送到保存庫。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-233">After evaluating all changed blocks, the service coalesces the changes and sends them to the vault.</span></span> <span data-ttu-id="7c5c9-234">對部分舊版應用程式來說，小型的分散式寫入並非最適合用於儲存體。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-234">In some legacy applications, small, fragmented writes are not optimal for storage.</span></span> <span data-ttu-id="7c5c9-235">如果快照集包含許多小型分散式寫入，則服務會花更多時間來處理應用程式所寫入的資料。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-235">If the snapshot contains many small, fragmented writes, the service spends additional time processing the data written by the applications.</span></span> <span data-ttu-id="7c5c9-236">對於在 VM 內執行的應用程式，Azure 所建議的應用程式寫入區塊大小下限為 8 KB。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-236">The recommended application write block from Azure, for applications running inside the VM, is a minimum of 8 KB.</span></span> <span data-ttu-id="7c5c9-237">如果您的應用程式使用小於 8 KB 的區塊，則備份效能會受到影響。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-237">If your application uses a block of less than 8 KB, backup performance is effected.</span></span> <span data-ttu-id="7c5c9-238">如需調整您的應用程式以改善備份效能的說明，請參閱[使用 Azure 儲存體調整應用程式以取得最佳化效能](../storage/common/storage-premium-storage-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-238">For help with tuning your application to improve backup performance, see [Tuning applications for optimal performance with Azure storage](../storage/common/storage-premium-storage-performance.md).</span></span> <span data-ttu-id="7c5c9-239">雖然這篇關於備份效能的文章使用的是進階儲存體範例，但指引適用於標準儲存體磁碟。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-239">Though the article on backup performance uses Premium storage examples, the guidance is applicable for Standard storage disks.</span></span>

## <a name="total-restore-time"></a><span data-ttu-id="7c5c9-240">總計還原時間</span><span class="sxs-lookup"><span data-stu-id="7c5c9-240">Total restore time</span></span>
<span data-ttu-id="7c5c9-241">還原作業是由兩個主要子工作所組成︰將資料從保存庫複製回所選擇的客戶儲存體帳戶，以及建立虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-241">A restore operation consists of two main sub tasks: Copying data back from the vault to the chosen customer storage account, and creating the virtual machine.</span></span> <span data-ttu-id="7c5c9-242">將資料從保存庫複製回來，取決於備份儲存在 Azure 內部的哪個位置，以及客戶儲存體帳戶的儲存位置。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-242">Copying data back from the vault depends on where the backups are stored internally in Azure, and where the customer storage account is stored.</span></span> <span data-ttu-id="7c5c9-243">複製資料所花費的時間取決於︰</span><span class="sxs-lookup"><span data-stu-id="7c5c9-243">Time taken to copy data depends upon:</span></span>
* <span data-ttu-id="7c5c9-244">佇列等待時間 - 由於服務會同時處理來自多位客戶的還原作業，因此會將還原要求放入佇列中。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-244">Queue wait time - Since the service processes restore jobs from multiple customers at the same time, restore requests are put in a queue.</span></span>
* <span data-ttu-id="7c5c9-245">資料複製時間 - 資料會從保存庫複製到客戶儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-245">Data copy time - Data is copied from the vault to the customer storage account.</span></span> <span data-ttu-id="7c5c9-246">還原時間取決於 Azure 備份服務在所選客戶儲存體帳戶上取得的 IOPS 和輸送量。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-246">Restore time depends on IOPS and throughput Azure Backup service gets on the selected customer storage account.</span></span> <span data-ttu-id="7c5c9-247">若要減少還原程序期間的複製時間，請選取未使用其他應用程式寫入或讀取載入的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-247">To reduce the copying time during the restore process, select a storage account not loaded with other application writes and reads.</span></span>

## <a name="best-practices"></a><span data-ttu-id="7c5c9-248">最佳作法</span><span class="sxs-lookup"><span data-stu-id="7c5c9-248">Best practices</span></span>
<span data-ttu-id="7c5c9-249">在設定虛擬機器的備份時，建議您遵循下列做法：</span><span class="sxs-lookup"><span data-stu-id="7c5c9-249">We suggest following these practices while configuring backups for virtual machines:</span></span>

* <span data-ttu-id="7c5c9-250">避免將超過 10 個來自相同雲端服務的傳統 VM 排程在同一時間內進行備份。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-250">Don't schedule more than 10 classic VMs from the same cloud service to back up at the same time.</span></span> <span data-ttu-id="7c5c9-251">如果您想要備份多個來自相同雲端服務的 VM，建議您將備份開始時間錯開一小時。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-251">If you want to back up multiple VMs from same cloud service, stagger the backup start times by an hour.</span></span>
* <span data-ttu-id="7c5c9-252">避免將超過 40 VM 排程在同一時間進行備份。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-252">Do not schedule more than 40 VMs to back up at the same time.</span></span>
* <span data-ttu-id="7c5c9-253">安排 VM 備份在非尖峰時段進行。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-253">Schedule VM backups during non-peak hours.</span></span> <span data-ttu-id="7c5c9-254">如此一來，備份服務會使用 IOPS 將資料從客戶儲存體帳戶傳輸到保存庫。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-254">This way the Backup service uses IOPS for transferring data from the customer storage account to the vault.</span></span>
* <span data-ttu-id="7c5c9-255">確定有原則套用至橫跨不同儲存體帳戶的 VM。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-255">Make sure that a policy is applied on VMs spread across different storage accounts.</span></span> <span data-ttu-id="7c5c9-256">我們的建議是，相同備份排程只保護單一儲存體帳戶中總計不超過 20 個的磁碟。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-256">We suggest no more than 20 total disks from a single storage account be protected by the same backup schedule.</span></span> <span data-ttu-id="7c5c9-257">如果您的儲存體帳戶中有超過 20 個磁碟，請將這些 VM 分散到多個原則，以在備份程序的傳輸階段取得所需的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-257">If you have greater than 20 disks in a storage account, spread those VMs across multiple policies to get the required IOPS during the transfer phase of the backup process.</span></span>
* <span data-ttu-id="7c5c9-258">請勿將進階儲存體上執行的 VM 還原至相同的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-258">Do not restore a VM running on Premium storage to same storage account.</span></span> <span data-ttu-id="7c5c9-259">如果還原作業程序與備份作業一致，將會減少備份可用的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-259">If the restore operation process coincides with the backup operation, it reduces the available IOPS for backup.</span></span>
* <span data-ttu-id="7c5c9-260">若要進行進階 VM 備份，請確定裝載進階磁碟的儲存體帳戶至少有 50% 的可用空間可供暫存快照集，以便能順利完成備份。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-260">For Premium VM backup, ensure that storage account that hosts premium disks has atleast 50% free space for staging snapshot for a successful backup.</span></span> 
* <span data-ttu-id="7c5c9-261">請確定為了進行備份而在 Linux VM 上啟用的 python 版本為 2.7</span><span class="sxs-lookup"><span data-stu-id="7c5c9-261">Make sure that python version on Linux VMs enabled for backup is 2.7</span></span>

## <a name="data-encryption"></a><span data-ttu-id="7c5c9-262">資料加密</span><span class="sxs-lookup"><span data-stu-id="7c5c9-262">Data encryption</span></span>
<span data-ttu-id="7c5c9-263">Azure 備份不會在備份過程中加密資料。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-263">Azure Backup does not encrypt data as a part of the backup process.</span></span> <span data-ttu-id="7c5c9-264">不過，您可以在 VM 中加密資料，並順暢地備份受保護的資料 (深入了解 [加密資料的備份](backup-azure-vms-encryption.md))。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-264">However, you can encrypt data within the VM and back up the protected data seamlessly (read more about [backup of encrypted data](backup-azure-vms-encryption.md)).</span></span>

## <a name="calculating-the-cost-of-protected-instances"></a><span data-ttu-id="7c5c9-265">計算受保護執行個體的成本</span><span class="sxs-lookup"><span data-stu-id="7c5c9-265">Calculating the cost of protected instances</span></span>
<span data-ttu-id="7c5c9-266">透過 Azure 備份進行備份的 Azure 虛擬機器受限於 [Azure 備份價格](https://azure.microsoft.com/pricing/details/backup/)。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-266">Azure virtual machines that are backed up through Azure Backup are subject to [Azure Backup pricing](https://azure.microsoft.com/pricing/details/backup/).</span></span> <span data-ttu-id="7c5c9-267">受保護的執行個體是根據虛擬機器的*實際*大小來計算，也就是虛擬機器中不包含「資源磁碟」的所有資料總和。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-267">The Protected Instances calculation is based on the *actual* size of the virtual machine, which is the sum of all the data in the virtual machine--excluding the “resource disk.”</span></span>

<span data-ttu-id="7c5c9-268">備份 VM 的定價方式*不是*以連接到虛擬機器的每個資料磁碟其支援大小上限為基礎，</span><span class="sxs-lookup"><span data-stu-id="7c5c9-268">Pricing for backing up VMs is *not* based on the maximum supported size for each data disk attached to the virtual machine.</span></span> <span data-ttu-id="7c5c9-269">而是根據儲存在資料磁碟中的實際資料來定價。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-269">Pricing is based on the actual data stored in the data disk.</span></span> <span data-ttu-id="7c5c9-270">同樣地，備份儲存體帳單也是根據 Azure 備份所儲存的資料計費，也就是每個復原點所儲存的實際資料總和。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-270">Similarly, the backup storage bill is based on the amount of data that is stored in Azure Backup, which is the sum of the actual data in each recovery point.</span></span>

<span data-ttu-id="7c5c9-271">例如，A2 標準大小的虛擬機器擁有兩個額外資料磁碟，每個大小上限為 1 TB。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-271">For example, take an A2 Standard-sized virtual machine that has two additional data disks with a maximum size of 1 TB each.</span></span> <span data-ttu-id="7c5c9-272">下表提供上述每個磁碟實際儲存的資料：</span><span class="sxs-lookup"><span data-stu-id="7c5c9-272">The following table gives the actual data stored on each of these disks:</span></span>

| <span data-ttu-id="7c5c9-273">磁碟類型</span><span class="sxs-lookup"><span data-stu-id="7c5c9-273">Disk type</span></span> | <span data-ttu-id="7c5c9-274">大小上限</span><span class="sxs-lookup"><span data-stu-id="7c5c9-274">Max size</span></span> | <span data-ttu-id="7c5c9-275">實際儲存的資料</span><span class="sxs-lookup"><span data-stu-id="7c5c9-275">Actual data present</span></span> |
| --- | --- | --- |
| <span data-ttu-id="7c5c9-276">作業系統磁碟</span><span class="sxs-lookup"><span data-stu-id="7c5c9-276">Operating system disk</span></span> |<span data-ttu-id="7c5c9-277">1023 GB</span><span class="sxs-lookup"><span data-stu-id="7c5c9-277">1023 GB</span></span> |<span data-ttu-id="7c5c9-278">17 GB</span><span class="sxs-lookup"><span data-stu-id="7c5c9-278">17 GB</span></span> |
| <span data-ttu-id="7c5c9-279">本機磁碟/資源磁碟</span><span class="sxs-lookup"><span data-stu-id="7c5c9-279">Local disk / Resource disk</span></span> |<span data-ttu-id="7c5c9-280">135 GB</span><span class="sxs-lookup"><span data-stu-id="7c5c9-280">135 GB</span></span> |<span data-ttu-id="7c5c9-281">5 GB (未包含備份)</span><span class="sxs-lookup"><span data-stu-id="7c5c9-281">5 GB (not included for backup)</span></span> |
| <span data-ttu-id="7c5c9-282">資料磁碟 1</span><span class="sxs-lookup"><span data-stu-id="7c5c9-282">Data disk 1</span></span> |<span data-ttu-id="7c5c9-283">1023 GB</span><span class="sxs-lookup"><span data-stu-id="7c5c9-283">1023 GB</span></span> |<span data-ttu-id="7c5c9-284">30 GB</span><span class="sxs-lookup"><span data-stu-id="7c5c9-284">30 GB</span></span> |
| <span data-ttu-id="7c5c9-285">資料磁碟 2</span><span class="sxs-lookup"><span data-stu-id="7c5c9-285">Data disk 2</span></span> |<span data-ttu-id="7c5c9-286">1023 GB</span><span class="sxs-lookup"><span data-stu-id="7c5c9-286">1023 GB</span></span> |<span data-ttu-id="7c5c9-287">0 GB</span><span class="sxs-lookup"><span data-stu-id="7c5c9-287">0 GB</span></span> |

<span data-ttu-id="7c5c9-288">在此案例中，虛擬機器的 *實際* 容量為 17 GB + 30 GB + 0 GB = 47 GB。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-288">The *actual* size of the virtual machine in this case is 17 GB + 30 GB + 0 GB = 47 GB.</span></span> <span data-ttu-id="7c5c9-289">這個受保護的執行個體大小 (47 GB) 會成為每月計費的依據。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-289">This Protected Instance size (47 GB) becomes the basis for the monthly bill.</span></span> <span data-ttu-id="7c5c9-290">當虛擬機器的資料量增加時，用於計費之受保護的執行個體大小也會隨之變更。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-290">As the amount of data in the virtual machine grows, the Protected Instance size used for billing changes accordingly.</span></span>

<span data-ttu-id="7c5c9-291">第一次成功備份完成後才會開始計費。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-291">Billing does not start until the first successful backup completes.</span></span> <span data-ttu-id="7c5c9-292">儲存體和受保護的執行個體也會在此同時開始計費。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-292">At this point, the billing for both Storage and Protected Instances begins.</span></span> <span data-ttu-id="7c5c9-293">只要虛擬機器*有任何備份資料儲存在保存庫*，就會繼續計費。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-293">Billing continues as long as there is *any backup data stored in a vault* for the virtual machine.</span></span> <span data-ttu-id="7c5c9-294">如果您停止虛擬機器上的保護功能，但是虛擬機器備份資料仍在保存庫中，就會繼續計費。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-294">If you stop protection on the virtual machine, but virtual machine backup data exists in a vault, billing continues.</span></span>

<span data-ttu-id="7c5c9-295">只有在停止保護*且*刪除全部備份資料時，才會對指定的虛擬機器停止計費。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-295">Billing for a specified virtual machine stops only if the protection is stopped *and* all backup data is deleted.</span></span> <span data-ttu-id="7c5c9-296">當保護停止且沒有任何作用中的備份作業時，最後一個成功 VM 備份的大小會成為每月帳單所使用的受保護執行個體大小。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-296">When protection stops and there are no active backup jobs, the size of the last successful VM backup becomes the Protected Instance size used for the monthly bill.</span></span>

## <a name="questions"></a><span data-ttu-id="7c5c9-297">有疑問嗎？</span><span class="sxs-lookup"><span data-stu-id="7c5c9-297">Questions?</span></span>
<span data-ttu-id="7c5c9-298">如果您有問題，或希望我們加入任何功能，請 [傳送意見反應給我們](http://aka.ms/azurebackup_feedback)。</span><span class="sxs-lookup"><span data-stu-id="7c5c9-298">If you have questions, or if there is any feature that you would like to see included, [send us feedback](http://aka.ms/azurebackup_feedback).</span></span>

## <a name="next-steps"></a><span data-ttu-id="7c5c9-299">後續步驟</span><span class="sxs-lookup"><span data-stu-id="7c5c9-299">Next steps</span></span>
* [<span data-ttu-id="7c5c9-300">備份虛擬機器</span><span class="sxs-lookup"><span data-stu-id="7c5c9-300">Back up virtual machines</span></span>](backup-azure-vms.md)
* [<span data-ttu-id="7c5c9-301">管理虛擬機器備份</span><span class="sxs-lookup"><span data-stu-id="7c5c9-301">Manage virtual machine backup</span></span>](backup-azure-manage-vms.md)
* [<span data-ttu-id="7c5c9-302">還原虛擬機器</span><span class="sxs-lookup"><span data-stu-id="7c5c9-302">Restore virtual machines</span></span>](backup-azure-restore-vms.md)
* [<span data-ttu-id="7c5c9-303">疑難排解 VM 備份問題</span><span class="sxs-lookup"><span data-stu-id="7c5c9-303">Troubleshoot VM backup issues</span></span>](backup-azure-vms-troubleshoot.md)
