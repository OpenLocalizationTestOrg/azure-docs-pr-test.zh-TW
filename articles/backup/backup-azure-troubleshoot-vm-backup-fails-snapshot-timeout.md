---
title: "針對 Azure 備份失敗：無法使用客體代理程式狀態進行疑難排解 | Microsoft Docs"
description: "徵狀、 原因和解決方案的 Azure 備份失敗相關 tooerror： 無法與 hello VM 代理程式通訊"
services: backup
documentationcenter: 
author: genlin
manager: cshepard
editor: 
keywords: "Azure 備份; VM 代理程式; 網路連線;"
ms.assetid: 4b02ffa4-c48e-45f6-8363-73d536be4639
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: genli;markgal;
ms.openlocfilehash: 724c61ba80d0a9ef91a5f8543ae72bb86968881b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshoot-azure-backup-failure-issues-with-agent-andor-extension"></a><span data-ttu-id="e2f94-104">針對 Azure 備份失敗進行疑難排解：與代理程式和/或擴充功能相關的問題</span><span class="sxs-lookup"><span data-stu-id="e2f94-104">Troubleshoot Azure Backup failure: Issues with agent and/or extension</span></span>

<span data-ttu-id="e2f94-105">這篇文章會提供解決備份失敗的疑難排解步驟 toohelp 相關 tooproblems 在與 VM 代理程式和延伸模組的通訊。</span><span class="sxs-lookup"><span data-stu-id="e2f94-105">This article provides troubleshooting steps toohelp you resolve Backup failures related tooproblems in communication with VM agent and extension.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

## <a name="vm-agent-unable-toocommunicate-with-azure-backup"></a><span data-ttu-id="e2f94-106">VM 代理程式無法 toocommunicate 向 Azure 備份</span><span class="sxs-lookup"><span data-stu-id="e2f94-106">VM Agent unable toocommunicate with Azure Backup</span></span>
<span data-ttu-id="e2f94-107">您可以註冊及排程 hello Azure 備份服務的 VM 之後，備份會藉由通訊以 hello VM 代理程式 tootake 時間點快照集初始化 hello 工作。</span><span class="sxs-lookup"><span data-stu-id="e2f94-107">After you register and schedule a VM for hello Azure Backup service, Backup initiates hello job by communicating with hello VM agent tootake a point-in-time snapshot.</span></span> <span data-ttu-id="e2f94-108">任何 hello 下列條件可能會讓 hello 快照集從觸發，而這可能會接著 tooBackup 失敗。</span><span class="sxs-lookup"><span data-stu-id="e2f94-108">Any of hello following conditions might prevent hello snapshot from being triggered, which in turn can lead tooBackup failure.</span></span> <span data-ttu-id="e2f94-109">請遵循下列疑難排解 hello 指定順序中的步驟，然後重試您的作業。</span><span class="sxs-lookup"><span data-stu-id="e2f94-109">Follow below troubleshooting steps in hello given order and retry your operation.</span></span>
##### <a name="cause-1-hello-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="e2f94-110">原因 1: [hello VM 有沒有網際網路存取](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="e2f94-110">Cause 1: [hello VM has no Internet access](#the-vm-has-no-internet-access)</span></span>
##### <a name="cause-2-hello-agent-is-installed-in-hello-vm-but-is-unresponsive-for-windows-vmsthe-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="e2f94-111">原因 2: [hello 代理程式安裝在 hello VM，但沒有回應 （適用於 Windows Vm)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span><span class="sxs-lookup"><span data-stu-id="e2f94-111">Cause 2: [hello agent is installed in hello VM but is unresponsive (for Windows VMs)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span></span>
##### <a name="cause-3-hello-agent-installed-in-hello-vm-is-out-of-date-for-linux-vmsthe-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="e2f94-112">原因 3: [hello hello VM 中安裝的代理程式為最新 （適用於 Linux Vm)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span><span class="sxs-lookup"><span data-stu-id="e2f94-112">Cause 3: [hello agent installed in hello VM is out of date (for Linux VMs)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span></span>
##### <a name="cause-4-hello-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-takenthe-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="e2f94-113">原因 4: [hello 快照集的狀態無法擷取或無法取得快照](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span><span class="sxs-lookup"><span data-stu-id="e2f94-113">Cause 4: [hello snapshot status cannot be retrieved or a snapshot cannot be taken](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span></span>
##### <a name="cause-5-hello-backup-extension-fails-tooupdate-or-loadthe-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="e2f94-114">原因 5: [hello 備用分機號碼失敗 tooupdate 或載入](#the-backup-extension-fails-to-update-or-load)</span><span class="sxs-lookup"><span data-stu-id="e2f94-114">Cause 5: [hello backup extension fails tooupdate or load](#the-backup-extension-fails-to-update-or-load)</span></span>

## <a name="snapshot-operation-failed-due-toono-network-connectivity-on-hello-virtual-machine"></a><span data-ttu-id="e2f94-115">快照集作業失敗，因為 toono hello 虛擬機器上的網路連線</span><span class="sxs-lookup"><span data-stu-id="e2f94-115">Snapshot operation failed due toono network connectivity on hello virtual machine</span></span>
<span data-ttu-id="e2f94-116">您可以註冊及排程 hello Azure 備份服務的 VM 之後，備份會藉由通訊與 hello VM 備用分機號碼 tootake 的時間點快照集初始化 hello 工作。</span><span class="sxs-lookup"><span data-stu-id="e2f94-116">After you register and schedule a VM for hello Azure Backup service, Backup initiates hello job by communicating with hello VM backup extension tootake a point-in-time snapshot.</span></span> <span data-ttu-id="e2f94-117">任何 hello 下列條件可能會讓 hello 快照集從觸發，而這可能會接著 tooBackup 失敗。</span><span class="sxs-lookup"><span data-stu-id="e2f94-117">Any of hello following conditions might prevent hello snapshot from being triggered, which in turn can lead tooBackup failure.</span></span> <span data-ttu-id="e2f94-118">請遵循下列疑難排解 hello 指定順序中的步驟，然後重試您的作業。</span><span class="sxs-lookup"><span data-stu-id="e2f94-118">Follow below troubleshooting steps in hello given order and retry your operation.</span></span>
##### <a name="cause-1-hello-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="e2f94-119">原因 1: [hello VM 有沒有網際網路存取](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="e2f94-119">Cause 1: [hello VM has no Internet access](#the-vm-has-no-internet-access)</span></span>
##### <a name="cause-2-hello-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-takenthe-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="e2f94-120">原因 2: [hello 快照集的狀態無法擷取或無法取得快照](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span><span class="sxs-lookup"><span data-stu-id="e2f94-120">Cause 2: [hello snapshot status cannot be retrieved or a snapshot cannot be taken](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span></span>
##### <a name="cause-3-hello-backup-extension-fails-tooupdate-or-loadthe-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="e2f94-121">原因 3: [hello 備用分機號碼失敗 tooupdate 或載入](#the-backup-extension-fails-to-update-or-load)</span><span class="sxs-lookup"><span data-stu-id="e2f94-121">Cause 3: [hello backup extension fails tooupdate or load](#the-backup-extension-fails-to-update-or-load)</span></span>

## <a name="vmsnapshot-extension-operation-failed"></a><span data-ttu-id="e2f94-122">VMSnapshot 擴充作業失敗</span><span class="sxs-lookup"><span data-stu-id="e2f94-122">VMSnapshot extension operation failed</span></span>

<span data-ttu-id="e2f94-123">您可以註冊及排程 hello Azure 備份服務的 VM 之後，備份會藉由通訊與 hello VM 備用分機號碼 tootake 的時間點快照集初始化 hello 工作。</span><span class="sxs-lookup"><span data-stu-id="e2f94-123">After you register and schedule a VM for hello Azure Backup service, Backup initiates hello job by communicating with hello VM backup extension tootake a point-in-time snapshot.</span></span> <span data-ttu-id="e2f94-124">任何 hello 下列條件可能會讓 hello 快照集從觸發，而這可能會接著 tooBackup 失敗。</span><span class="sxs-lookup"><span data-stu-id="e2f94-124">Any of hello following conditions might prevent hello snapshot from being triggered, which in turn can lead tooBackup failure.</span></span> <span data-ttu-id="e2f94-125">請遵循下列疑難排解 hello 指定順序中的步驟，然後重試您的作業。</span><span class="sxs-lookup"><span data-stu-id="e2f94-125">Follow below troubleshooting steps in hello given order and retry your operation.</span></span>
##### <a name="cause-1-hello-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-takenthe-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="e2f94-126">原因 1: [hello 快照集的狀態無法擷取或無法取得快照](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span><span class="sxs-lookup"><span data-stu-id="e2f94-126">Cause 1: [hello snapshot status cannot be retrieved or a snapshot cannot be taken](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span></span>
##### <a name="cause-2-hello-backup-extension-fails-tooupdate-or-loadthe-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="e2f94-127">原因 2: [hello 備用分機號碼失敗 tooupdate 或載入](#the-backup-extension-fails-to-update-or-load)</span><span class="sxs-lookup"><span data-stu-id="e2f94-127">Cause 2: [hello backup extension fails tooupdate or load](#the-backup-extension-fails-to-update-or-load)</span></span>
##### <a name="cause-3-hello-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="e2f94-128">原因 3: [hello VM 有沒有網際網路存取](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="e2f94-128">Cause 3: [hello VM has no Internet access](#the-vm-has-no-internet-access)</span></span>
##### <a name="cause-4-hello-agent-is-installed-in-hello-vm-but-is-unresponsive-for-windows-vmsthe-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="e2f94-129">原因 4: [hello 代理程式安裝在 hello VM，但沒有回應 （適用於 Windows Vm)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span><span class="sxs-lookup"><span data-stu-id="e2f94-129">Cause 4: [hello agent is installed in hello VM but is unresponsive (for Windows VMs)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span></span>
##### <a name="cause-5-hello-agent-installed-in-hello-vm-is-out-of-date-for-linux-vmsthe-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="e2f94-130">原因 5: [hello hello VM 中安裝的代理程式為最新 （適用於 Linux Vm)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span><span class="sxs-lookup"><span data-stu-id="e2f94-130">Cause 5: [hello agent installed in hello VM is out of date (for Linux VMs)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span></span>

## <a name="unable-tooperform-hello-operation-as-hello-vm-agent-is-not-responsive"></a><span data-ttu-id="e2f94-131">無法 tooperform hello 操作，因為 hello VM 代理程式沒有回應</span><span class="sxs-lookup"><span data-stu-id="e2f94-131">Unable tooperform hello operation as hello VM Agent is not responsive</span></span>

<span data-ttu-id="e2f94-132">您可以註冊及排程 hello Azure 備份服務的 VM 之後，備份會藉由通訊與 hello VM 備用分機號碼 tootake 的時間點快照集初始化 hello 工作。</span><span class="sxs-lookup"><span data-stu-id="e2f94-132">After you register and schedule a VM for hello Azure Backup service, Backup initiates hello job by communicating with hello VM backup extension tootake a point-in-time snapshot.</span></span> <span data-ttu-id="e2f94-133">任何 hello 下列條件可能會讓 hello 快照集從觸發，而這可能會接著 tooBackup 失敗。</span><span class="sxs-lookup"><span data-stu-id="e2f94-133">Any of hello following conditions might prevent hello snapshot from being triggered, which in turn can lead tooBackup failure.</span></span> <span data-ttu-id="e2f94-134">請遵循下列疑難排解 hello 指定順序中的步驟，然後重試您的作業。</span><span class="sxs-lookup"><span data-stu-id="e2f94-134">Follow below troubleshooting steps in hello given order and retry your operation.</span></span>
##### <a name="cause-1-hello-agent-is-installed-in-hello-vm-but-is-unresponsive-for-windows-vmsthe-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="e2f94-135">原因 1: [hello 代理程式安裝在 hello VM，但沒有回應 （適用於 Windows Vm)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span><span class="sxs-lookup"><span data-stu-id="e2f94-135">Cause 1: [hello agent is installed in hello VM but is unresponsive (for Windows VMs)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span></span>
##### <a name="cause-2-hello-agent-installed-in-hello-vm-is-out-of-date-for-linux-vmsthe-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="e2f94-136">原因 2: [hello hello VM 中安裝的代理程式為最新 （適用於 Linux Vm)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span><span class="sxs-lookup"><span data-stu-id="e2f94-136">Cause 2: [hello agent installed in hello VM is out of date (for Linux VMs)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span></span>
##### <a name="cause-3-hello-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="e2f94-137">原因 3: [hello VM 有沒有網際網路存取](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="e2f94-137">Cause 3: [hello VM has no Internet access](#the-vm-has-no-internet-access)</span></span>

## <a name="backup-failed-with-an-internal-error---please-retry-hello-operation-in-a-few-minutes"></a><span data-ttu-id="e2f94-138">備份失敗，發生內部錯誤-請重試幾分鐘的時間中的 hello 作業</span><span class="sxs-lookup"><span data-stu-id="e2f94-138">Backup failed with an internal error - Please retry hello operation in a few minutes</span></span>

<span data-ttu-id="e2f94-139">您可以註冊及排程 hello Azure 備份服務的 VM 之後，備份會藉由通訊與 hello VM 備用分機號碼 tootake 的時間點快照集初始化 hello 工作。</span><span class="sxs-lookup"><span data-stu-id="e2f94-139">After you register and schedule a VM for hello Azure Backup service, Backup initiates hello job by communicating with hello VM backup extension tootake a point-in-time snapshot.</span></span> <span data-ttu-id="e2f94-140">任何 hello 下列條件可能會讓 hello 快照集從觸發，而這可能會接著 tooBackup 失敗。</span><span class="sxs-lookup"><span data-stu-id="e2f94-140">Any of hello following conditions might prevent hello snapshot from being triggered, which in turn can lead tooBackup failure.</span></span> <span data-ttu-id="e2f94-141">請遵循下列疑難排解 hello 指定順序中的步驟，然後重試您的作業。</span><span class="sxs-lookup"><span data-stu-id="e2f94-141">Follow below troubleshooting steps in hello given order and retry your operation.</span></span>
##### <a name="cause-1-hello-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="e2f94-142">原因 1: [hello VM 有沒有網際網路存取](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="e2f94-142">Cause 1: [hello VM has no Internet access](#the-vm-has-no-internet-access)</span></span>
##### <a name="cause-2-hello-agent-installed-in-hello-vm-but-unresponsive-for-windows-vmsthe-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="e2f94-143">原因 2: [hello （適用於 Windows Vm)，但沒有回應 hello VM 中安裝的代理程式](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span><span class="sxs-lookup"><span data-stu-id="e2f94-143">Cause 2: [hello agent installed in hello VM but unresponsive (for Windows VMs)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span></span>
##### <a name="cause-3-hello-agent-installed-in-hello-vm-is-out-of-date-for-linux-vmsthe-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="e2f94-144">原因 3: [hello hello VM 中安裝的代理程式為最新 （適用於 Linux Vm)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span><span class="sxs-lookup"><span data-stu-id="e2f94-144">Cause 3: [hello agent installed in hello VM is out of date (for Linux VMs)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span></span>
##### <a name="cause-4-hello-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-takenthe-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="e2f94-145">原因 4: [hello 快照集的狀態無法擷取或無法取得快照](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span><span class="sxs-lookup"><span data-stu-id="e2f94-145">Cause 4: [hello snapshot status cannot be retrieved or a snapshot cannot be taken](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span></span>
##### <a name="cause-5-hello-backup-extension-fails-tooupdate-or-loadthe-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="e2f94-146">原因 5: [hello 備用分機號碼失敗 tooupdate 或載入](#the-backup-extension-fails-to-update-or-load)</span><span class="sxs-lookup"><span data-stu-id="e2f94-146">Cause 5: [hello backup extension fails tooupdate or load](#the-backup-extension-fails-to-update-or-load)</span></span>


## <a name="causes-and-solutions"></a><span data-ttu-id="e2f94-147">原因和解決方案</span><span class="sxs-lookup"><span data-stu-id="e2f94-147">Causes and Solutions</span></span>

### <a name="hello-vm-has-no-internet-access"></a><span data-ttu-id="e2f94-148">hello VM 有沒有網際網路存取</span><span class="sxs-lookup"><span data-stu-id="e2f94-148">hello VM has no Internet access</span></span>
<span data-ttu-id="e2f94-149">每個 hello 部署需求，hello VM 已無法存取網際網路，或防止存取 toohello Azure 基礎結構中適當的限制。</span><span class="sxs-lookup"><span data-stu-id="e2f94-149">Per hello deployment requirement, hello VM has no Internet access, or it has restrictions in place that prevent access toohello Azure infrastructure.</span></span>

<span data-ttu-id="e2f94-150">toofunction hello 備份延伸模組，需要正確地連接 toohello Azure 公用 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="e2f94-150">toofunction correctly, hello backup extension requires connectivity toohello Azure public IP addresses.</span></span> <span data-ttu-id="e2f94-151">hello 延伸模組會將命令 tooan Azure 儲存體端點 (HTTP URL) toomanage hello 的快照集 hello VM。</span><span class="sxs-lookup"><span data-stu-id="e2f94-151">hello extension sends commands tooan Azure Storage endpoint (HTTP URL) toomanage hello snapshots of hello VM.</span></span> <span data-ttu-id="e2f94-152">如果公用網際網路，最後備份失敗的任何存取 toohello hello 延伸模組。</span><span class="sxs-lookup"><span data-stu-id="e2f94-152">If hello extension has no access toohello public Internet, Backup eventually fails.</span></span>

####  <a name="solution"></a><span data-ttu-id="e2f94-153">方案</span><span class="sxs-lookup"><span data-stu-id="e2f94-153">Solution</span></span>
<span data-ttu-id="e2f94-154">此處所列的 hello 方法的其中一個 try tooresolve hello 問題。</span><span class="sxs-lookup"><span data-stu-id="e2f94-154">tooresolve hello issue, try one of hello methods listed here.</span></span>
##### <a name="allow-access-toohello-azure-datacenter-ip-ranges"></a><span data-ttu-id="e2f94-155">允許存取 toohello Azure 資料中心 IP 範圍</span><span class="sxs-lookup"><span data-stu-id="e2f94-155">Allow access toohello Azure datacenter IP ranges</span></span>

1. <span data-ttu-id="e2f94-156">取得 hello[的 Azure 資料中心 Ip 清單](https://www.microsoft.com/download/details.aspx?id=41653)tooallow 的存取權。</span><span class="sxs-lookup"><span data-stu-id="e2f94-156">Obtain hello [list of Azure datacenter IPs](https://www.microsoft.com/download/details.aspx?id=41653) tooallow access to.</span></span>
2. <span data-ttu-id="e2f94-157">藉由執行 hello 解除封鎖 hello Ip**新增 NetRoute** hello 提升權限的 PowerShell 視窗中的 Azure VM 中的 cmdlet。</span><span class="sxs-lookup"><span data-stu-id="e2f94-157">Unblock hello IPs by running hello **New-NetRoute** cmdlet in hello Azure VM in an elevated PowerShell window.</span></span> <span data-ttu-id="e2f94-158">以系統管理員身分執行 hello 指令程式。</span><span class="sxs-lookup"><span data-stu-id="e2f94-158">Run hello cmdlet as an administrator.</span></span>
3. <span data-ttu-id="e2f94-159">tooallow 存取 toohello Ip 時，會將規則 toohello 網路安全性群組，如果有的話。</span><span class="sxs-lookup"><span data-stu-id="e2f94-159">tooallow access toohello IPs, add rules toohello network security group, if you have one.</span></span>

##### <a name="create-a-path-for-http-traffic-tooflow"></a><span data-ttu-id="e2f94-160">建立 HTTP 流量 tooflow 的路徑</span><span class="sxs-lookup"><span data-stu-id="e2f94-160">Create a path for HTTP traffic tooflow</span></span>

1. <span data-ttu-id="e2f94-161">如果您的網路限制已備妥 （例如，網路安全性群組），將部署 HTTP proxy 伺服器 tooroute hello 流量。</span><span class="sxs-lookup"><span data-stu-id="e2f94-161">If you have network restrictions in place (for example, a network security group), deploy an HTTP proxy server tooroute hello traffic.</span></span>
2. <span data-ttu-id="e2f94-162">hello HTTP proxy 伺服器，從 tooallow 存取 toohello 網際網路加入規則 toohello 網路安全性群組，如果有的話。</span><span class="sxs-lookup"><span data-stu-id="e2f94-162">tooallow access toohello Internet from hello HTTP proxy server, add rules toohello network security group, if you have one.</span></span>

<span data-ttu-id="e2f94-163">toolearn tooset VM 備份的 HTTP proxy 的請參閱[準備 Azure 虛擬機器註冊您的環境 tooback](backup-azure-vms-prepare.md#using-an-http-proxy-for-vm-backups)。</span><span class="sxs-lookup"><span data-stu-id="e2f94-163">toolearn how tooset up an HTTP proxy for VM backups, see [Prepare your environment tooback up Azure virtual machines](backup-azure-vms-prepare.md#using-an-http-proxy-for-vm-backups).</span></span>

<span data-ttu-id="e2f94-164">如果您使用受管理的磁碟，您可能需要其他通訊埠 (8443) 開啟 hello 防火牆上。</span><span class="sxs-lookup"><span data-stu-id="e2f94-164">In case you are using Managed Disks, you may need an additional port (8443) opening up on hello firewalls.</span></span>

### <a name="hello-agent-installed-in-hello-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="e2f94-165">hello （適用於 Windows Vm)，但沒有回應 hello VM 中安裝的代理程式</span><span class="sxs-lookup"><span data-stu-id="e2f94-165">hello agent installed in hello VM but unresponsive (for Windows VMs)</span></span>

#### <a name="solution"></a><span data-ttu-id="e2f94-166">方案</span><span class="sxs-lookup"><span data-stu-id="e2f94-166">Solution</span></span>
<span data-ttu-id="e2f94-167">hello VM 代理程式可能已損毀或 hello 服務可能已停止。</span><span class="sxs-lookup"><span data-stu-id="e2f94-167">hello VM Agent might have been corrupted or hello service might have been stopped.</span></span> <span data-ttu-id="e2f94-168">重新安裝 hello VM 代理程式可取得 hello 最新版本，然後重新啟動 hello 通訊。</span><span class="sxs-lookup"><span data-stu-id="e2f94-168">Re-installing hello VM agent would help get hello latest version and restart hello communication.</span></span>

1. <span data-ttu-id="e2f94-169">請確認服務 (services.msc) 中執行的 Windows 客體代理程式服務是否 hello 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="e2f94-169">Verify whether Windows Guest Agent service running in services (services.msc) of hello Virtual Machine.</span></span> <span data-ttu-id="e2f94-170">請嘗試重新啟動 hello Windows 客體代理程式服務，並起始 hello 備份</span><span class="sxs-lookup"><span data-stu-id="e2f94-170">Try restart hello Windows Guest Agent service and initiate hello Backup</span></span><br>
2. <span data-ttu-id="e2f94-171">如果在服務中看不到，請在 [程式和功能] 中確認您是否已安裝 Windows 客體代理程式服務。</span><span class="sxs-lookup"><span data-stu-id="e2f94-171">if it is not visible in services, verify in Programs and Features whether Windows Guest agent service is installed.</span></span>
4. <span data-ttu-id="e2f94-172">如果您是在 程式和功能解除安裝無法 tooview hello Windows 客體代理程式。</span><span class="sxs-lookup"><span data-stu-id="e2f94-172">If you are able tooview in programs and features uninstall hello Windows Guest Agent.</span></span>
5. <span data-ttu-id="e2f94-173">下載並安裝 hello[最新版本的代理程式 MSI](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409)。</span><span class="sxs-lookup"><span data-stu-id="e2f94-173">Download and install hello [latest version of agent MSI](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409).</span></span> <span data-ttu-id="e2f94-174">您需要系統管理員權限 toocomplete hello 安裝。</span><span class="sxs-lookup"><span data-stu-id="e2f94-174">You need Administrator privileges toocomplete hello installation.</span></span>
6. <span data-ttu-id="e2f94-175">您應該會無法 tooview 服務中的 Windows 客體代理程式服務</span><span class="sxs-lookup"><span data-stu-id="e2f94-175">Then you should be able tooview Windows Guest Agent services in services</span></span>
7. <span data-ttu-id="e2f94-176">嘗試執行上-要求/臨機操作備份 hello 入口網站中，按一下 [立即備份]。</span><span class="sxs-lookup"><span data-stu-id="e2f94-176">Try running an on-demand/adhoc backup by clicking "Backup Now" in hello portal.</span></span>

<span data-ttu-id="e2f94-177">另請確認您的虛擬機器具有 **[hello 系統中安裝.NET 4.5](https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed)**。</span><span class="sxs-lookup"><span data-stu-id="e2f94-177">Also verify your Virtual Machine has **[.NET 4.5 installed in hello system](https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed)**.</span></span> <span data-ttu-id="e2f94-178">它是 hello VM 代理程式 toocommunicate 與 hello 服務所需</span><span class="sxs-lookup"><span data-stu-id="e2f94-178">It is required for hello VM agent toocommunicate with hello service</span></span>

### <a name="hello-agent-installed-in-hello-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="e2f94-179">hello hello VM 中安裝的代理程式為最新 （適用於 Linux Vm)</span><span class="sxs-lookup"><span data-stu-id="e2f94-179">hello agent installed in hello VM is out of date (for Linux VMs)</span></span>

#### <a name="solution"></a><span data-ttu-id="e2f94-180">方案</span><span class="sxs-lookup"><span data-stu-id="e2f94-180">Solution</span></span>
<span data-ttu-id="e2f94-181">針對 Linux VM，與代理程式或擴充功能相關的多數失敗是由於會影響過時 VM 代理程式的問題所造成。</span><span class="sxs-lookup"><span data-stu-id="e2f94-181">Most agent-related or extension-related failures for Linux VMs are caused by issues that affect an outdated VM agent.</span></span> <span data-ttu-id="e2f94-182">tootroubleshoot 這個問題，請遵循下列一般指導方針：</span><span class="sxs-lookup"><span data-stu-id="e2f94-182">tootroubleshoot this issue, follow these general guidelines:</span></span>

1. <span data-ttu-id="e2f94-183">請依照指示 hello[更新 hello Linux VM 代理程式](../virtual-machines/linux/update-agent.md)。</span><span class="sxs-lookup"><span data-stu-id="e2f94-183">Follow hello instructions for [updating hello Linux VM agent](../virtual-machines/linux/update-agent.md).</span></span>

 >[!NOTE]
 ><span data-ttu-id="e2f94-184">我們*強烈建議*您更新 hello 代理程式只能透過發佈儲存機制。</span><span class="sxs-lookup"><span data-stu-id="e2f94-184">We *strongly recommend* that you update hello agent only through a distribution repository.</span></span> <span data-ttu-id="e2f94-185">我們不建議直接從 GitHub 下載 hello 代理程式程式碼，並更新它。</span><span class="sxs-lookup"><span data-stu-id="e2f94-185">We do not recommend downloading hello agent code directly from GitHub and updating it.</span></span> <span data-ttu-id="e2f94-186">如果 hello 最新的代理程式無法使用您的散發，請連絡散發支援的指示 tooinstall 它。</span><span class="sxs-lookup"><span data-stu-id="e2f94-186">If hello latest agent is unavailable for your distribution, contact distribution support for instructions on how tooinstall it.</span></span> <span data-ttu-id="e2f94-187">hello 最近代理程式，請移 toohello toocheck [Windows Azure Linux 代理程式](https://github.com/Azure/WALinuxAgent/releases)hello GitHub 儲存機制中的頁面。</span><span class="sxs-lookup"><span data-stu-id="e2f94-187">toocheck for hello most recent agent, go toohello [Windows Azure Linux agent](https://github.com/Azure/WALinuxAgent/releases) page in hello GitHub repository.</span></span>

2. <span data-ttu-id="e2f94-188">請確定該 hello Azure 代理程式正在執行 hello VM 上執行下列命令的 hello:`ps -e`</span><span class="sxs-lookup"><span data-stu-id="e2f94-188">Make sure that hello Azure agent is running on hello VM by running hello following command: `ps -e`</span></span>

 <span data-ttu-id="e2f94-189">如果未執行 hello 程序，使用它重新啟動 hello 下列命令：</span><span class="sxs-lookup"><span data-stu-id="e2f94-189">If hello process is not running, restart it by using hello following commands:</span></span>

 * <span data-ttu-id="e2f94-190">針對 Ubuntu：`service walinuxagent start`</span><span class="sxs-lookup"><span data-stu-id="e2f94-190">For Ubuntu: `service walinuxagent start`</span></span>
 * <span data-ttu-id="e2f94-191">針對其他散發套件︰`service waagent start`</span><span class="sxs-lookup"><span data-stu-id="e2f94-191">For other distributions: `service waagent start`</span></span>

3. <span data-ttu-id="e2f94-192">[Hello 自動重新啟動代理程式設定](https://github.com/Azure/WALinuxAgent/wiki/Known-Issues#mitigate_agent_crash)。</span><span class="sxs-lookup"><span data-stu-id="e2f94-192">[Configure hello auto restart agent](https://github.com/Azure/WALinuxAgent/wiki/Known-Issues#mitigate_agent_crash).</span></span>
4. <span data-ttu-id="e2f94-193">執行新的測試備份。</span><span class="sxs-lookup"><span data-stu-id="e2f94-193">Run a new test backup.</span></span> <span data-ttu-id="e2f94-194">如果 hello 失敗持續發生，請收集 hello hello 客戶的 VM 中的下列記錄檔：</span><span class="sxs-lookup"><span data-stu-id="e2f94-194">If hello failure persists, please collect hello following logs from hello customer’s VM:</span></span>

   * <span data-ttu-id="e2f94-195">/var/lib/waagent/*.xml</span><span class="sxs-lookup"><span data-stu-id="e2f94-195">/var/lib/waagent/*.xml</span></span>
   * <span data-ttu-id="e2f94-196">/var/log/waagent.log</span><span class="sxs-lookup"><span data-stu-id="e2f94-196">/var/log/waagent.log</span></span>
   * <span data-ttu-id="e2f94-197">/var/log/azure/*</span><span class="sxs-lookup"><span data-stu-id="e2f94-197">/var/log/azure/*</span></span>

<span data-ttu-id="e2f94-198">如果我們需要 waagent 的詳細資訊記錄，請遵循下列步驟：</span><span class="sxs-lookup"><span data-stu-id="e2f94-198">If we require verbose logging for waagent, follow these steps:</span></span>

1. <span data-ttu-id="e2f94-199">在 hello /etc/waagent.conf 檔案中，找出 hello 下列行：**啟用詳細資訊記錄 (y | n)**</span><span class="sxs-lookup"><span data-stu-id="e2f94-199">In hello /etc/waagent.conf file, locate hello following line: **Enable verbose logging (y|n)**</span></span>
2. <span data-ttu-id="e2f94-200">變更 hello **Logs.Verbose**值 *n* 太*y*。</span><span class="sxs-lookup"><span data-stu-id="e2f94-200">Change hello **Logs.Verbose** value from *n* too*y*.</span></span>
3. <span data-ttu-id="e2f94-201">儲存 hello 變更，然後遵循本節中的 hello 上一個步驟，以重新啟動 waagent。</span><span class="sxs-lookup"><span data-stu-id="e2f94-201">Save hello change, and then restart waagent by following hello previous steps in this section.</span></span>

### <a name="hello-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="e2f94-202">無法擷取 hello 快照集的狀態，或無法取得快照</span><span class="sxs-lookup"><span data-stu-id="e2f94-202">hello snapshot status cannot be retrieved or a snapshot cannot be taken</span></span>
<span data-ttu-id="e2f94-203">hello VM 備份依賴發行的快照集命令 toohello 基礎儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="e2f94-203">hello VM backup relies on issuing a snapshot command toohello underlying storage account.</span></span> <span data-ttu-id="e2f94-204">備份可能會失敗，因為它有沒有存取 toohello 儲存體帳戶或延遲 hello hello 快照集工作執行。</span><span class="sxs-lookup"><span data-stu-id="e2f94-204">Backup can fail either because it has no access toohello storage account or because hello execution of hello snapshot task is delayed.</span></span>

#### <a name="solution"></a><span data-ttu-id="e2f94-205">方案</span><span class="sxs-lookup"><span data-stu-id="e2f94-205">Solution</span></span>
<span data-ttu-id="e2f94-206">hello 下列條件可能會導致快照集工作失敗：</span><span class="sxs-lookup"><span data-stu-id="e2f94-206">hello following conditions can cause snapshot task failure:</span></span>

| <span data-ttu-id="e2f94-207">原因</span><span class="sxs-lookup"><span data-stu-id="e2f94-207">Cause</span></span> | <span data-ttu-id="e2f94-208">方案</span><span class="sxs-lookup"><span data-stu-id="e2f94-208">Solution</span></span> |
| --- | --- |
| <span data-ttu-id="e2f94-209">hello VM 已設定的 SQL Server 備份。</span><span class="sxs-lookup"><span data-stu-id="e2f94-209">hello VM has SQL Server backup configured.</span></span> | <span data-ttu-id="e2f94-210">根據預設，hello VM 備份會在 Windows Vm 上，執行 VSS 完整備份。</span><span class="sxs-lookup"><span data-stu-id="e2f94-210">By default, hello VM backup runs a VSS full backup on Windows VMs.</span></span> <span data-ttu-id="e2f94-211">在執行以 SQL Server 為基礎的伺服器並設定了 SQL Server 備份的 VM 上，可能會發生快照延遲執行。</span><span class="sxs-lookup"><span data-stu-id="e2f94-211">On VMs that are running SQL Server-based servers and on which SQL Server backup is configured, snapshot execution delays may occur.</span></span><br><br><span data-ttu-id="e2f94-212">如果您因為快照集問題發生備份失敗，設定下列登錄機碼的 hello:</span><span class="sxs-lookup"><span data-stu-id="e2f94-212">If you are experiencing a Backup failure because of a snapshot issue, set hello following registry key:</span></span><br><br><span data-ttu-id="e2f94-213">**[HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT] "USEVSSCOPYBACKUP"="TRUE"**</span><span class="sxs-lookup"><span data-stu-id="e2f94-213">**[HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT] "USEVSSCOPYBACKUP"="TRUE"**</span></span> |
| <span data-ttu-id="e2f94-214">因為 hello VM 關閉在 RDP，hello VM 狀態將無法正確地報告。</span><span class="sxs-lookup"><span data-stu-id="e2f94-214">hello VM status is reported incorrectly because hello VM is shut down in RDP.</span></span> | <span data-ttu-id="e2f94-215">如果您關閉 hello VM 中遠端桌面通訊協定 (RDP) 時，請檢查 hello 入口 toodetermine hello VM 狀態是否正確。</span><span class="sxs-lookup"><span data-stu-id="e2f94-215">If you shut down hello VM in Remote Desktop Protocol (RDP), check hello portal toodetermine whether hello VM status is correct.</span></span> <span data-ttu-id="e2f94-216">如果不正確，請關閉 hello 入口網站中的 hello VM 使用 hello**關機**hello VM 儀表板上的選項。</span><span class="sxs-lookup"><span data-stu-id="e2f94-216">If it’s not correct, shut down hello VM in hello portal by using hello **Shutdown** option on hello VM dashboard.</span></span> |
| <span data-ttu-id="e2f94-217">從相同的雲端服務的 hello 許多 Vm 在 hello 向上設定 tooback 相同的時間。</span><span class="sxs-lookup"><span data-stu-id="e2f94-217">Many VMs from hello same cloud service are configured tooback up at hello same time.</span></span> | <span data-ttu-id="e2f94-218">它是最佳的作法 toospread 出 hello 備份排程的 Vm 從 hello 相同雲端服務。</span><span class="sxs-lookup"><span data-stu-id="e2f94-218">It’s a best practice toospread out hello backup schedules for VMs from hello same cloud service.</span></span> |
| <span data-ttu-id="e2f94-219">hello VM 正在以高 CPU 或記憶體使用量。</span><span class="sxs-lookup"><span data-stu-id="e2f94-219">hello VM is running at high CPU or memory usage.</span></span> | <span data-ttu-id="e2f94-220">如果 hello VM 執行 CPU 使用量高 （超過 90%) 或高記憶體使用量，hello 快照集工作排入佇列，以及延遲，而且它最後會逾時。在此情況下，請嘗試隨選備份。</span><span class="sxs-lookup"><span data-stu-id="e2f94-220">If hello VM is running at high CPU usage (more than 90 percent) or high memory usage, hello snapshot task is queued and delayed, and it eventually times out. In this situation, try an on-demand backup.</span></span> |
| <span data-ttu-id="e2f94-221">hello VM 無法從 DHCP 取得 hello 網狀架構主機位址。</span><span class="sxs-lookup"><span data-stu-id="e2f94-221">hello VM cannot get hello host/fabric address from DHCP.</span></span> | <span data-ttu-id="e2f94-222">Hello IaaS VM 備份 toowork hello 客體內，就必須啟用 DHCP。</span><span class="sxs-lookup"><span data-stu-id="e2f94-222">DHCP must be enabled inside hello guest for hello IaaS VM backup toowork.</span></span>  <span data-ttu-id="e2f94-223">如果 hello VM 無法收到 hello 網狀架構主機位址 DHCP 回應 245，無法下載或執行任何擴充功能。</span><span class="sxs-lookup"><span data-stu-id="e2f94-223">If hello VM cannot get hello host/fabric address from DHCP response 245, it cannot download or run any extensions.</span></span> <span data-ttu-id="e2f94-224">如果您需要靜態私人 ip 位址，您應該透過 hello 平台來進行設定。</span><span class="sxs-lookup"><span data-stu-id="e2f94-224">If you need a static private IP, you should configure it through hello platform.</span></span> <span data-ttu-id="e2f94-225">hello 內啟用 VM 應該保持的 hello 的 DHCP 選項。</span><span class="sxs-lookup"><span data-stu-id="e2f94-225">hello DHCP option inside hello VM should be left enabled.</span></span> <span data-ttu-id="e2f94-226">如需詳細資訊，請參閱[設定靜態內部私人 IP 位址](../virtual-network/virtual-networks-reserved-private-ip.md)。</span><span class="sxs-lookup"><span data-stu-id="e2f94-226">For more information, see [Setting a Static Internal Private IP](../virtual-network/virtual-networks-reserved-private-ip.md).</span></span> |

### <a name="hello-backup-extension-fails-tooupdate-or-load"></a><span data-ttu-id="e2f94-227">hello 備用分機號碼失敗 tooupdate 或載入</span><span class="sxs-lookup"><span data-stu-id="e2f94-227">hello backup extension fails tooupdate or load</span></span>
<span data-ttu-id="e2f94-228">如果無法載入擴充功能，備份就會因為無法取得快照而失敗。</span><span class="sxs-lookup"><span data-stu-id="e2f94-228">If extensions cannot be loaded, Backup fails because a snapshot cannot be taken.</span></span>

#### <a name="solution"></a><span data-ttu-id="e2f94-229">方案</span><span class="sxs-lookup"><span data-stu-id="e2f94-229">Solution</span></span>

<span data-ttu-id="e2f94-230">**取得 Windows 客體：**確認 hello iaasvmprovider 服務已啟用並啟動類型為*自動*。</span><span class="sxs-lookup"><span data-stu-id="e2f94-230">**For Windows guests:** Verify that hello iaasvmprovider service is enabled and has a startup type of *automatic*.</span></span> <span data-ttu-id="e2f94-231">如果 hello 服務未以這種方式設定，啟用 toodetermine 是否 hello 下一個備份都會成功。</span><span class="sxs-lookup"><span data-stu-id="e2f94-231">If hello service is not configured in this way, enable it toodetermine whether hello next backup succeeds.</span></span>

<span data-ttu-id="e2f94-232">**Linux 客體的：**確認 hello 最新版本的 Linux （備份所使用的 hello 副檔名） 的 VMSnapshot 是 1.0.91.0。</span><span class="sxs-lookup"><span data-stu-id="e2f94-232">**For Linux guests:** Verify hello latest version of VMSnapshot for Linux (hello extension used by Backup) is 1.0.91.0.</span></span><br>


<span data-ttu-id="e2f94-233">如果 tooupdate 或負載，還是無法 hello 備用分機號碼，您可以強制 hello VMSnapshot 延伸 toobe 解除安裝 hello 延伸模組重新載入。</span><span class="sxs-lookup"><span data-stu-id="e2f94-233">If hello backup extension still fails tooupdate or load, you can force hello VMSnapshot extension toobe reloaded by uninstalling hello extension.</span></span> <span data-ttu-id="e2f94-234">hello 下一次備份的嘗試將重新載入 hello 延伸模組。</span><span class="sxs-lookup"><span data-stu-id="e2f94-234">hello next backup attempt will reload hello extension.</span></span>

<span data-ttu-id="e2f94-235">toouninstall hello 擴充功能，請勿遵循 hello:</span><span class="sxs-lookup"><span data-stu-id="e2f94-235">toouninstall hello extension, do hello following:</span></span>

1. <span data-ttu-id="e2f94-236">移 toohello [Azure 入口網站](https://portal.azure.com/)。</span><span class="sxs-lookup"><span data-stu-id="e2f94-236">Go toohello [Azure portal](https://portal.azure.com/).</span></span>
2. <span data-ttu-id="e2f94-237">找出 hello VM 時，備份的相關問題。</span><span class="sxs-lookup"><span data-stu-id="e2f94-237">Locate hello VM that has backup problems.</span></span>
3. <span data-ttu-id="e2f94-238">按一下 [設定] 。</span><span class="sxs-lookup"><span data-stu-id="e2f94-238">Click **Settings**.</span></span>
4. <span data-ttu-id="e2f94-239">按一下 [擴充功能]。</span><span class="sxs-lookup"><span data-stu-id="e2f94-239">Click **Extensions**.</span></span>
5. <span data-ttu-id="e2f94-240">按一下 [Vmsnapshot 擴充功能]。</span><span class="sxs-lookup"><span data-stu-id="e2f94-240">Click **Vmsnapshot Extension**.</span></span>
6. <span data-ttu-id="e2f94-241">按一下 [解除安裝]。</span><span class="sxs-lookup"><span data-stu-id="e2f94-241">Click **Uninstall**.</span></span>

<span data-ttu-id="e2f94-242">此程序會導致 hello 延伸 toobe hello 下一個備份期間重新安裝。</span><span class="sxs-lookup"><span data-stu-id="e2f94-242">This procedure causes hello extension toobe reinstalled during hello next backup.</span></span>

