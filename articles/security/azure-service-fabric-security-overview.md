---
title: "Azure Service Fabric 安全性概觀 | Microsoft Docs"
description: "本文提供 Azure Service Fabric 安全性概觀。"
services: security
documentationcenter: na
author: unifycloud
manager: swadhwa
editor: tomsh
ms.assetid: 
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/04/2017
ms.author: tomsh
ms.openlocfilehash: 4cbd2791649c6d2dd005521cedb44c17aa874073
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/18/2017
---
# <a name="azure-service-fabric-security-overview"></a><span data-ttu-id="1461a-103">Azure Service Fabric 安全性概觀</span><span class="sxs-lookup"><span data-stu-id="1461a-103">Azure Service Fabric security overview</span></span>
<span data-ttu-id="1461a-104">[Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview) 是分散式系統平台，可讓您輕鬆封裝、部署及管理可調整和可信賴的微服務。</span><span class="sxs-lookup"><span data-stu-id="1461a-104">[Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview) is a distributed systems platform that makes it easy to package, deploy, and manage scalable and reliable micro-services.</span></span> <span data-ttu-id="1461a-105">Service Fabric 可解決開發與管理雲端應用程式時遭遇的重大挑戰。</span><span class="sxs-lookup"><span data-stu-id="1461a-105">Service Fabric addresses the significant challenges in developing and managing cloud applications.</span></span> <span data-ttu-id="1461a-106">開發人員與管理員能夠避免複雜的基礎結構問題，專注於實作關鍵且嚴格要求之可調整、可信賴且可管理的工作負載。</span><span class="sxs-lookup"><span data-stu-id="1461a-106">Developers and administrators can avoid complex infrastructure problems and focus on implementing mission-critical, demanding workloads that are scalable, reliable, and manageable.</span></span>

<span data-ttu-id="1461a-107">本＜Azure Service Fabric 安全性概觀＞一文著重於下列領域：</span><span class="sxs-lookup"><span data-stu-id="1461a-107">This Azure Service Fabric Security Overview article focuses on the following areas:</span></span>

-   <span data-ttu-id="1461a-108">保護您的叢集</span><span class="sxs-lookup"><span data-stu-id="1461a-108">Securing your cluster</span></span>
-   <span data-ttu-id="1461a-109">監視和診斷</span><span class="sxs-lookup"><span data-stu-id="1461a-109">Monitoring and diagnostics</span></span>
-   <span data-ttu-id="1461a-110">使用憑證提供保護</span><span class="sxs-lookup"><span data-stu-id="1461a-110">Secure using Certificates</span></span>
-   <span data-ttu-id="1461a-111">角色型存取控制 (RBAC)</span><span class="sxs-lookup"><span data-stu-id="1461a-111">Role-based access control (RBAC)</span></span>
-   <span data-ttu-id="1461a-112">使用 Windows 安全性保護叢集</span><span class="sxs-lookup"><span data-stu-id="1461a-112">Secure cluster using Windows security</span></span>
-   <span data-ttu-id="1461a-113">在 Service Fabric 中設定應用程式安全性</span><span class="sxs-lookup"><span data-stu-id="1461a-113">Configure application security in Service Fabric</span></span>
-   <span data-ttu-id="1461a-114">保護 Azure Service Fabric 安全性中服務的通訊安全</span><span class="sxs-lookup"><span data-stu-id="1461a-114">Secure communication for services in Azure Service Fabric Security</span></span>

## <a name="securing-your-cluster"></a><span data-ttu-id="1461a-115">保護您的叢集</span><span class="sxs-lookup"><span data-stu-id="1461a-115">Securing your cluster</span></span>
<span data-ttu-id="1461a-116">Azure Service Fabric 是電腦叢集間服務的 Orchestrator，叢集必須受到安全保護，以防止未經授權使用者連線到您的叢集，特別是當叢集上有生產工作負載正在執行時。</span><span class="sxs-lookup"><span data-stu-id="1461a-116">Azure Service Fabric is an orchestrator of services across a cluster of machines, Clusters must be secured to prevent unauthorized users from connecting to your cluster, especially when it has production workloads running on it.</span></span> <span data-ttu-id="1461a-117">雖然可以建立不安全的叢集，但這樣做會在叢集向公用網際網路公開管理端點時，允許匿名使用者連線叢集。</span><span class="sxs-lookup"><span data-stu-id="1461a-117">Although it is possible to create an unsecured cluster, doing so allows anonymous users to connect to it, if it exposes management endpoints to the public Internet.</span></span>

<span data-ttu-id="1461a-118">本節針對 Azure 或獨立伺服器上執行之叢集的安全性案例，以及用來實作這些案例的各種技術，提供概觀。</span><span class="sxs-lookup"><span data-stu-id="1461a-118">This section provides an overview of the security scenarios for clusters running on Azure or standalone and the various technologies used to implement those scenarios.</span></span> <span data-ttu-id="1461a-119">叢集安全性案例包括：</span><span class="sxs-lookup"><span data-stu-id="1461a-119">The cluster security scenarios are:</span></span>

-   <span data-ttu-id="1461a-120">節點對節點安全性</span><span class="sxs-lookup"><span data-stu-id="1461a-120">Node-to-node security</span></span>
-   <span data-ttu-id="1461a-121">用戶端對節點安全性</span><span class="sxs-lookup"><span data-stu-id="1461a-121">Client-to-node security</span></span>

### <a name="node-to-node-security"></a><span data-ttu-id="1461a-122">節點對節點安全性</span><span class="sxs-lookup"><span data-stu-id="1461a-122">Node-to-node security</span></span>
<span data-ttu-id="1461a-123">保護叢集中 VM 與機器之間的通訊。</span><span class="sxs-lookup"><span data-stu-id="1461a-123">Secures communication between the VMs or machines in the cluster.</span></span> <span data-ttu-id="1461a-124">這可確保只有獲得授權加入叢集的電腦可以參與裝載應用程式和叢集中的服務。</span><span class="sxs-lookup"><span data-stu-id="1461a-124">This ensures that only computers that are authorized to join the cluster can participate in hosting applications and services in the cluster.</span></span>

<span data-ttu-id="1461a-125">在 Azure 上執行的叢集或在 Windows 上執行的獨立叢集可以使用[憑證安全性](https://msdn.microsoft.com/library/ff649801.aspx)或針對 Windows Server 機器使用 [Windows 安全性](https://msdn.microsoft.com/library/ff649396.aspx)。</span><span class="sxs-lookup"><span data-stu-id="1461a-125">Clusters running on Azure or standalone clusters running on Windows can use either [Certificate Security](https://msdn.microsoft.com/library/ff649801.aspx) or [Windows Security](https://msdn.microsoft.com/library/ff649396.aspx) for Windows Server machines.</span></span>

<span data-ttu-id="1461a-126">**節點對節點憑證安全性**</span><span class="sxs-lookup"><span data-stu-id="1461a-126">**Node-to-node certificate security**</span></span>

<span data-ttu-id="1461a-127">Service Fabric 會使用您建立叢集時在節點類型組態中指定的 X.509 伺服器憑證。</span><span class="sxs-lookup"><span data-stu-id="1461a-127">Service Fabric uses X.509 server certificates that you specify as a part of the node-type configurations when you create a cluster.</span></span> <span data-ttu-id="1461a-128">若要快速了解這些憑證是什麼，以及如何取得或建立這些憑證，請參閱[這篇文章](https://docs.microsoft.com/dotnet/framework/wcf/feature-details/working-with-certificates)。</span><span class="sxs-lookup"><span data-stu-id="1461a-128">A quick overview of what these certificates are and [how you can acquire or create them is provided in this article](https://docs.microsoft.com/dotnet/framework/wcf/feature-details/working-with-certificates).</span></span>

<span data-ttu-id="1461a-129">憑證安全性是在建立叢集時設定，透過 Azure 入口網站、Azure Resource Manager 範本或獨立 JSON 範本。</span><span class="sxs-lookup"><span data-stu-id="1461a-129">Certificate security is configured while creating the cluster either through the Azure portal, Azure Resource Manager templates, or a standalone JSON template.</span></span> <span data-ttu-id="1461a-130">您可以指定用於憑證變換的主要憑證和選用次要憑證。</span><span class="sxs-lookup"><span data-stu-id="1461a-130">You can specify a primary certificate and an optional secondary certificate that is used for certificate rollovers.</span></span> <span data-ttu-id="1461a-131">您指定的主要和次要憑證，應該不同於您為[用戶端對節點安全性](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-cluster-security)指定的系統管理用戶端憑證和唯讀用戶端憑證。</span><span class="sxs-lookup"><span data-stu-id="1461a-131">The primary and secondary certificates you specify should be different than the admin client and read-only client certificates you specify for  [Client-to-node security](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-cluster-security).</span></span>

### <a name="client-to-node-security"></a><span data-ttu-id="1461a-132">用戶端對節點安全性</span><span class="sxs-lookup"><span data-stu-id="1461a-132">Client-to-node security</span></span>
<span data-ttu-id="1461a-133">用戶端對節點安全性是使用 ClientIdentities 來設定的。</span><span class="sxs-lookup"><span data-stu-id="1461a-133">Client to node security is configured using Client Identities.</span></span> <span data-ttu-id="1461a-134">若要建立用戶端與叢集之間的信任，您必須設定叢集才能知道用戶端可以信任的身分識別。</span><span class="sxs-lookup"><span data-stu-id="1461a-134">To establish trust between a client and the cluster, you must configure the cluster to know which client identities that it can trust.</span></span> <span data-ttu-id="1461a-135">這有兩種不同的方式可以完成：</span><span class="sxs-lookup"><span data-stu-id="1461a-135">This can be done in two different ways:</span></span>

-   <span data-ttu-id="1461a-136">指定可以連線的網域群組使用者，或</span><span class="sxs-lookup"><span data-stu-id="1461a-136">Specify the domain group users that can connect or</span></span>
-   <span data-ttu-id="1461a-137">指定可以連線的網域節點使用者。</span><span class="sxs-lookup"><span data-stu-id="1461a-137">Specify the domain node users that can connect.</span></span>

<span data-ttu-id="1461a-138">Service Fabric 針對連線到 Service Fabric 叢集的用戶端，支援兩種不同的存取控制類型：</span><span class="sxs-lookup"><span data-stu-id="1461a-138">Service Fabric supports two different access control types for clients that are connected to a Service Fabric cluster:</span></span>

-   <span data-ttu-id="1461a-139">系統管理員</span><span class="sxs-lookup"><span data-stu-id="1461a-139">Administrator</span></span>
-   <span data-ttu-id="1461a-140">User</span><span class="sxs-lookup"><span data-stu-id="1461a-140">User</span></span>

<span data-ttu-id="1461a-141">存取控制可讓叢集系統管理員針對不同的使用者群組限制特定類型的叢集作業的存取權，讓叢集更加安全。</span><span class="sxs-lookup"><span data-stu-id="1461a-141">Access control provides the ability for the cluster administrator to limit access to certain types of cluster operations for different groups of users, making the cluster more secure.</span></span> <span data-ttu-id="1461a-142">系統管理員可以完整存取管理功能 (包括讀取/寫入功能)。</span><span class="sxs-lookup"><span data-stu-id="1461a-142">Administrators have full access to management capabilities (including read/write capabilities).</span></span> <span data-ttu-id="1461a-143">使用者預設只具有管理功能的讀取存取權 (例如查詢功能)，以及解析應用程式和服務的能力。</span><span class="sxs-lookup"><span data-stu-id="1461a-143">Users, by default, have only read access to management capabilities (for example, query capabilities), and the ability to resolve applications and services.</span></span>

<span data-ttu-id="1461a-144">**用戶端對節點憑證安全性**</span><span class="sxs-lookup"><span data-stu-id="1461a-144">**Client-to-node certificate security**</span></span>

<span data-ttu-id="1461a-145">用戶端對節點憑證安全性是在建立叢集 (透過 Azure 入口網站、Resource Manager 範本或獨立 JSON 範本) 時，藉由指定系統管理用戶端憑證和 (或) 使用者用戶端憑證來設定的。</span><span class="sxs-lookup"><span data-stu-id="1461a-145">Client-to-node certificate security is configured while creating the cluster either through the Azure portal, Resource Manager Templates or a standalone JSON template by specifying an admin client certificate and/or a user client certificate.</span></span> <span data-ttu-id="1461a-146">您指定的系統管理用戶端憑證和使用者用戶端憑證，應該不同於您為節點對節點安全性指定的主要和次要憑證。</span><span class="sxs-lookup"><span data-stu-id="1461a-146">The admin client and user client certificates you specify should be different than the primary and secondary certificates you specify for Node-to-node security.</span></span>

<span data-ttu-id="1461a-147">用戶端如果是使用系統管理憑證來連接到叢集，就會擁有管理功能的完整存取權。</span><span class="sxs-lookup"><span data-stu-id="1461a-147">Clients connecting to the cluster using the admin certificate have full access to management capabilities.</span></span> <span data-ttu-id="1461a-148">用戶端如果是使用唯讀使用者用戶端憑證來連接到叢集，則只會擁有管理功能的唯讀存取權。</span><span class="sxs-lookup"><span data-stu-id="1461a-148">Clients connecting to the cluster using the read-only user client certificate have only read access to management capabilities.</span></span> <span data-ttu-id="1461a-149">換句話說，這些憑證是用於角色型存取控制 (RBAC)。</span><span class="sxs-lookup"><span data-stu-id="1461a-149">In other word these certificates are used for the role bases access control (RBAC).</span></span>

<span data-ttu-id="1461a-150">對於 Azure，若要了解如何在叢集中設定憑證安全性，請參閱 [使用 Azure Resource Manager 範本來設定叢集](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm) 。</span><span class="sxs-lookup"><span data-stu-id="1461a-150">For Azure read [Set up a cluster by using an Azure Resource Manager template](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm) to learn how to configure certificate security in a cluster.</span></span>

<span data-ttu-id="1461a-151">**Azure 上的用戶端對節點 Azure Active Directory (AAD) 安全性**</span><span class="sxs-lookup"><span data-stu-id="1461a-151">**Client-to-node Azure Active Directory (AAD) security on Azure**</span></span>

<span data-ttu-id="1461a-152">在 Azure 上執行的叢集也可以使用 Azure Active Directory (AAD) 來保護對管理端點的存取。</span><span class="sxs-lookup"><span data-stu-id="1461a-152">Clusters running on Azure can also secure access to the management endpoints using Azure Active Directory (AAD).</span></span> <span data-ttu-id="1461a-153">若要了解如何建立必要的 AAD 構件、如何在建立叢集時填入這些構件，以及之後如何連接到這些叢集，請參閱 [使用 Azure Resource Manager 範本來設定叢集](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm) 。</span><span class="sxs-lookup"><span data-stu-id="1461a-153">See [Set up a cluster by using an Azure Resource Manager template](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm) for information on how to create the necessary AAD artifacts, how to populate them during cluster creation, and how to connect to those clusters afterwards.</span></span>

<span data-ttu-id="1461a-154">AAD 可讓組織 (稱為租用戶) 管理使用者對應用程式的存取，這分成具有 Web 型登入 UI 的應用程式以及具有原生用戶端體驗的應用程式。</span><span class="sxs-lookup"><span data-stu-id="1461a-154">AAD enables organizations (known as tenants) to manage user access to applications, which are divided into applications with a web-based login UI and applications with a native client experience.</span></span>

<span data-ttu-id="1461a-155">Service Fabric 叢集提供其管理功能的數個進入點，包括 Web 架構的 Service Fabric Explorer 和 Visual Studio。</span><span class="sxs-lookup"><span data-stu-id="1461a-155">A Service Fabric cluster offers several entry points to its management functionality, including the web-based Service Fabric Explorer and Visual Studio.</span></span> <span data-ttu-id="1461a-156">因此，您將建立兩個 AAD 應用程式來控制對叢集的存取：一個 Web 應用程式和一個原生應用程式。</span><span class="sxs-lookup"><span data-stu-id="1461a-156">As a result, you create two AAD applications to control access to the cluster, one web application and one native application.</span></span>
<span data-ttu-id="1461a-157">對於 Azure 叢集，建議您針對節點對節點安全性使用 AAD 安全性來驗證用戶端和憑證。</span><span class="sxs-lookup"><span data-stu-id="1461a-157">For Azure clusters, it is recommended that you use AAD security to authenticate clients and certificates for node-to-node security.</span></span>

<span data-ttu-id="1461a-158">對於獨立 Windows Server 叢集，如果您有 Windows Server 2012 R2 和 Active Directory，建議您使用 Windows 安全性與群組管理帳戶 (GMA)。</span><span class="sxs-lookup"><span data-stu-id="1461a-158">For standalone Windows Server clusters, it is recommended that you use Windows security with group managed accounts (GMA) if you have Windows Server 2012 R2 and Active Directory.</span></span> <span data-ttu-id="1461a-159">否則仍然使用 Windows 安全性與 Windows 帳戶。</span><span class="sxs-lookup"><span data-stu-id="1461a-159">Otherwise still use Windows security with Windows accounts.</span></span>

## <a name="monitoring-and-diagnostics-for-azure-service-fabric"></a><span data-ttu-id="1461a-160">對 Azure Service Fabric 進行監視和診斷</span><span class="sxs-lookup"><span data-stu-id="1461a-160">Monitoring and diagnostics for Azure Service Fabric</span></span>
<span data-ttu-id="1461a-161">不論任何環境，針對應用程式與服務的開發、測試及部署進行[監視和診斷](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-overview)，都極為重要。</span><span class="sxs-lookup"><span data-stu-id="1461a-161">[Monitoring and diagnostics](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-overview) are critical to developing, testing, and deploying applications and services in any environment.</span></span> <span data-ttu-id="1461a-162">如果您要規劃和實作監視和診斷功能，以協助確保應用程式和服務可在本機開發環境或生產環境中如預期般運作，Service Fabric 解決方案就是理想之選。</span><span class="sxs-lookup"><span data-stu-id="1461a-162">Service Fabric solutions work best when you plan and implement monitoring and diagnostics that help ensure applications and services are working as expected in a local development environment or in production.</span></span>

<span data-ttu-id="1461a-163">從安全性的觀點來看，監視和診斷的主要目標是：</span><span class="sxs-lookup"><span data-stu-id="1461a-163">From a security perspective, the main goals of monitoring and diagnostics are to:</span></span>

-   <span data-ttu-id="1461a-164">偵測及診斷安全性事件可能造成的硬體和基礎結構問題。</span><span class="sxs-lookup"><span data-stu-id="1461a-164">Detect and diagnose hardware and infrastructure issues that might be due to a security event.</span></span>
-   <span data-ttu-id="1461a-165">偵測可能提供入侵指標 (Indicator of Compromise，IoC) 的軟體和應用程式問題。</span><span class="sxs-lookup"><span data-stu-id="1461a-165">Detect software and app issues which could provide indicator of compromise (IoC).</span></span>
-   <span data-ttu-id="1461a-166">了解資源耗用量，以協助避免不小心發生阻斷服務。</span><span class="sxs-lookup"><span data-stu-id="1461a-166">Understand resource consumption to help prevent inadvertent denial of service.</span></span>

<span data-ttu-id="1461a-167">監視與診斷的整體工作流程包含三個步驟：</span><span class="sxs-lookup"><span data-stu-id="1461a-167">The overall workflow of monitoring and diagnostics consists of three steps:</span></span>

-   <span data-ttu-id="1461a-168">**事件產生**：這包含基礎結構 (叢集) 和應用程式/服務層級中的事件 (記錄、追蹤、自訂事件)。</span><span class="sxs-lookup"><span data-stu-id="1461a-168">**Event generation:** this includes events (logs, traces, custom events) at both the infrastructure (cluster) and application / service level.</span></span> <span data-ttu-id="1461a-169">深入了解[基礎結構層級事件](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-generation-infra)和[應用程式層級事件](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-generation-app)，以了解提供項目，以及如何新增其他的檢測。</span><span class="sxs-lookup"><span data-stu-id="1461a-169">Read more about [infrastructure level events](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-generation-infra) and [application level events](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-generation-app) to understand what is provided and how to add further instrumentation.</span></span>
-   <span data-ttu-id="1461a-170">**事件彙總**：產生的事件必須經過收集與彙總後，才能夠顯示。</span><span class="sxs-lookup"><span data-stu-id="1461a-170">**Event aggregation:** generated events need to be collected and aggregated before they can be displayed.</span></span> <span data-ttu-id="1461a-171">我們通常建議使用 [Azure 診斷](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-aggregation-wad) (比較類似代理程式型記錄收集) 或 [EventFlow](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow) (同處理序記錄收集)。</span><span class="sxs-lookup"><span data-stu-id="1461a-171">We typically recommend using [Azure Diagnostics](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-aggregation-wad) (more similar to agent-based log collection) or [EventFlow](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow) (in-process log collection).</span></span>
-   <span data-ttu-id="1461a-172">**分析**︰事件必須經過視覺化並可藉由某種格式來存取，才能視需要進行分析及顯示。</span><span class="sxs-lookup"><span data-stu-id="1461a-172">**Analysis:** events need to be visualized and accessible in some format, to allow for analysis and display as needed.</span></span> <span data-ttu-id="1461a-173">市面上有多個優異的平台，可進行監視和診斷資料的分析和視覺化作業。</span><span class="sxs-lookup"><span data-stu-id="1461a-173">There are several great platforms that exist in the market when it comes to the analysis and visualization of monitoring and diagnostics data.</span></span> <span data-ttu-id="1461a-174">我們建議的兩個平台是 [OMS](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-analysis-oms) 和 [Application Insights](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-analysis-appinsights)，因為它們更容易整合 Service Fabric。</span><span class="sxs-lookup"><span data-stu-id="1461a-174">The two that we recommend are [OMS](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-analysis-oms) and [Application Insights](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-analysis-appinsights) due to their better integration with Service Fabric.</span></span>

<span data-ttu-id="1461a-175">您也可以使用 [Azure 監視器](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview)，監視構成 Service Fabric 叢集的許多 Azure 資源。</span><span class="sxs-lookup"><span data-stu-id="1461a-175">You can also use [Azure Monitor](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview) to monitor many of the Azure resources on which a Service Fabric cluster is built.</span></span>

<span data-ttu-id="1461a-176">監視程式是個別的服務，可以觀察服務之間的健全狀況和負載，並報告健全狀況模型階層中任何項目的健全狀況。</span><span class="sxs-lookup"><span data-stu-id="1461a-176">A watchdog is a separate service that can watch health and load across services, and report health for anything in the health model hierarchy.</span></span> <span data-ttu-id="1461a-177">如此可避免在單一服務檢視中無法偵測到的錯誤。</span><span class="sxs-lookup"><span data-stu-id="1461a-177">This can help prevent errors that would not be detected based on the view of a single service.</span></span> <span data-ttu-id="1461a-178">監視程式也非常適合裝載能夠執行修復動作的程式碼，而無需使用者互動 (例如在特定時間間隔，清除儲存體中的記錄檔)。</span><span class="sxs-lookup"><span data-stu-id="1461a-178">Watchdogs are also a good place to host code that performs remedial actions without user interaction (for example, cleaning up log files in storage at certain time intervals).</span></span> <span data-ttu-id="1461a-179">您可以在[這裡](https://azure.microsoft.com/resources/samples/service-fabric-watchdog-service/)找到範例監視程式服務實作。</span><span class="sxs-lookup"><span data-stu-id="1461a-179">You can find a sample watchdog service implementation [here](https://azure.microsoft.com/resources/samples/service-fabric-watchdog-service/).</span></span>

## <a name="secure-using-certificates"></a><span data-ttu-id="1461a-180">使用憑證提供保護</span><span class="sxs-lookup"><span data-stu-id="1461a-180">Secure using Certificates</span></span>
<span data-ttu-id="1461a-181">使用憑證一文說明如何保護獨立 Windows 叢集的各個節點之間的通訊，以及如何使用 X.509 憑證來驗證連線到此叢集的用戶端。</span><span class="sxs-lookup"><span data-stu-id="1461a-181">Using certificates, it tells how to secure the communication between the various nodes of your standalone Windows cluster, as well as how to authenticate clients connecting to this cluster, using X.509 certificates.</span></span> <span data-ttu-id="1461a-182">這可確保只有已獲授權的使用者可以存取叢集和已部署的應用程式，以及執行管理工作。</span><span class="sxs-lookup"><span data-stu-id="1461a-182">This ensures that only authorized users can access the cluster, the deployed applications and perform management tasks.</span></span> <span data-ttu-id="1461a-183">憑證安全性應在叢集建立之時先在叢集上啟用。</span><span class="sxs-lookup"><span data-stu-id="1461a-183">Certificate security should be enabled on the cluster when the cluster is created.</span></span>

### <a name="x509-certificates-and-service-fabric"></a><span data-ttu-id="1461a-184">X.509 憑證和 Service Fabric</span><span class="sxs-lookup"><span data-stu-id="1461a-184">X.509 certificates and Service Fabric</span></span>
<span data-ttu-id="1461a-185">X509 數位憑證通常用來驗證用戶端與伺服器，以及加密及數位簽署訊息。</span><span class="sxs-lookup"><span data-stu-id="1461a-185">X.509 digital certificates are commonly used to authenticate clients and servers and to encrypt and digitally sign messages.</span></span>

<span data-ttu-id="1461a-186">下表列出您在設定叢集時所需的憑證：</span><span class="sxs-lookup"><span data-stu-id="1461a-186">The following table lists the certificates that you will need on your cluster setup:</span></span>

|<span data-ttu-id="1461a-187">憑證資訊設定</span><span class="sxs-lookup"><span data-stu-id="1461a-187">Certificate Information Setting</span></span> |<span data-ttu-id="1461a-188">說明</span><span class="sxs-lookup"><span data-stu-id="1461a-188">Description</span></span>|
|-------------------------------|-----------|
|<span data-ttu-id="1461a-189">ClusterCertificate</span><span class="sxs-lookup"><span data-stu-id="1461a-189">ClusterCertificate</span></span>|    <span data-ttu-id="1461a-190">需有此憑證，才能保護叢集上節點之間的通訊。</span><span class="sxs-lookup"><span data-stu-id="1461a-190">This certificate is required to secure the communication between the nodes on a cluster.</span></span> <span data-ttu-id="1461a-191">您可以使用兩個不同的憑證 (主要和次要) 進行更新。</span><span class="sxs-lookup"><span data-stu-id="1461a-191">You can use two different certificates, a primary and a secondary for upgrade.</span></span>|
|<span data-ttu-id="1461a-192">ServerCertificate</span><span class="sxs-lookup"><span data-stu-id="1461a-192">ServerCertificate</span></span>| <span data-ttu-id="1461a-193">用戶端嘗試連線到此叢集時，會向用戶端此憑證顯示此憑證。</span><span class="sxs-lookup"><span data-stu-id="1461a-193">This certificate is presented to the client when it tries to connect to this cluster.</span></span> <span data-ttu-id="1461a-194">您可以使用兩個不同的伺服器憑證 (主要和次要) 進行更新。</span><span class="sxs-lookup"><span data-stu-id="1461a-194">You can use two different server certificates, a primary and a secondary for upgrade.</span></span>|
|<span data-ttu-id="1461a-195">ClientCertificateThumbprints</span><span class="sxs-lookup"><span data-stu-id="1461a-195">ClientCertificateThumbprints</span></span>|  <span data-ttu-id="1461a-196">這是您想在經過驗證的用戶端上安裝的一組憑證。</span><span class="sxs-lookup"><span data-stu-id="1461a-196">This is a set of certificates that you want to install on the authenticated clients.</span></span>|
|<span data-ttu-id="1461a-197">ClientCertificateCommonNames</span><span class="sxs-lookup"><span data-stu-id="1461a-197">ClientCertificateCommonNames</span></span>|  <span data-ttu-id="1461a-198">針對 CertificateCommonName 設定第一個用戶端憑證的一般名稱。</span><span class="sxs-lookup"><span data-stu-id="1461a-198">Set the common name of the first client certificate for the CertificateCommonName.</span></span> <span data-ttu-id="1461a-199">CertificateIssuerThumbprint 是此憑證的簽發者指紋。</span><span class="sxs-lookup"><span data-stu-id="1461a-199">The CertificateIssuerThumbprint is the thumbprint for the issuer of this certificate.</span></span>|
|<span data-ttu-id="1461a-200">ReverseProxyCertificate</span><span class="sxs-lookup"><span data-stu-id="1461a-200">ReverseProxyCertificate</span></span>|   <span data-ttu-id="1461a-201">如果您想要保護[反向 Proxy](https://docs.microsoft.com/azure/service-fabric/service-fabric-reverseproxy)，可以指定此選擇性憑證。</span><span class="sxs-lookup"><span data-stu-id="1461a-201">This is an optional certificate that can be specified if you want to secure your [Reverse Proxy](https://docs.microsoft.com/azure/service-fabric/service-fabric-reverseproxy).</span></span>|

<span data-ttu-id="1461a-202">如需保護憑證的詳細資訊，[請按一下這裡](https://docs.microsoft.com/azure/service-fabric/service-fabric-windows-cluster-x509-security)。</span><span class="sxs-lookup"><span data-stu-id="1461a-202">For more information on securing certificates, [click here](https://docs.microsoft.com/azure/service-fabric/service-fabric-windows-cluster-x509-security).</span></span>

## <a name="role-based-access-control-rbac"></a><span data-ttu-id="1461a-203">角色型存取控制 (RBAC)</span><span class="sxs-lookup"><span data-stu-id="1461a-203">Role-based access control (RBAC)</span></span>
<span data-ttu-id="1461a-204">存取控制可讓叢集系統管理員針對不同的使用者群組限制特定叢集作業的存取權，讓叢集更加安全。</span><span class="sxs-lookup"><span data-stu-id="1461a-204">Access control allows the cluster administrator to limit access to certain cluster operations for different groups of users, making the cluster more secure.</span></span> <span data-ttu-id="1461a-205">針對連接到叢集的用戶端，支援兩種不同的存取控制類型：系統管理員角色和使用者角色。</span><span class="sxs-lookup"><span data-stu-id="1461a-205">Two different access control types are supported for clients connecting to a cluster: Administrator role and User role.</span></span>

<span data-ttu-id="1461a-206">系統管理員可以完整存取管理功能 (包括讀取/寫入功能)。</span><span class="sxs-lookup"><span data-stu-id="1461a-206">Administrators have full access to management capabilities (including read/write capabilities).</span></span> <span data-ttu-id="1461a-207">使用者預設只具有管理功能的讀取存取權 (例如查詢功能)，以及解析應用程式和服務的能力。</span><span class="sxs-lookup"><span data-stu-id="1461a-207">Users, by default, have only read access to management capabilities (for example, query capabilities), and the ability to resolve applications and services.</span></span>

<span data-ttu-id="1461a-208">您可以在建立叢集時，分別為系統管理員和使用者用戶端角色提供個別的身分識別 (憑證、AAD 等等)，來指定這兩個角色。</span><span class="sxs-lookup"><span data-stu-id="1461a-208">You specify the administrator and user client roles at the time of cluster creation by providing separate identities (certificates, AAD etc.) for each.</span></span> <span data-ttu-id="1461a-209">如需有關預設存取控制設定及如何變更預設設定的詳細資訊，請參閱[適用於 Service Fabric 用戶端的角色型存取控制](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security-roles)。</span><span class="sxs-lookup"><span data-stu-id="1461a-209">For more information on the default access control settings and how to change the default settings, see [Role based access control for Service Fabric clients](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security-roles).</span></span>

## <a name="secure-standalone-cluster-using-windows-security"></a><span data-ttu-id="1461a-210">使用 Windows 安全性保護獨立叢集</span><span class="sxs-lookup"><span data-stu-id="1461a-210">Secure standalone cluster using Windows security</span></span>
<span data-ttu-id="1461a-211">為避免有人未經授權存取 Service Fabric 叢集，您必須保護叢集。</span><span class="sxs-lookup"><span data-stu-id="1461a-211">To prevent unauthorized access to a Service Fabric cluster, you must secure the cluster.</span></span> <span data-ttu-id="1461a-212">當叢集執行生產工作負載時，安全性尤其重要。</span><span class="sxs-lookup"><span data-stu-id="1461a-212">Security is especially important when the cluster runs production workloads.</span></span> <span data-ttu-id="1461a-213">本文說明如何在 ClusterConfig.JSON 檔案中使用 Windows 安全性，設定節點對節點和用戶端對節點的安全性。</span><span class="sxs-lookup"><span data-stu-id="1461a-213">It describes how to configure node-to-node and client-to-node security by using Windows security in the ClusterConfig.JSON file.</span></span>

<span data-ttu-id="1461a-214">**使用 gMSA 設定 Windows 安全性**</span><span class="sxs-lookup"><span data-stu-id="1461a-214">**Configure Windows security using gMSA**</span></span>

<span data-ttu-id="1461a-215">需要在 gMSA 下執行 Service Fabric 時，可透過 [ClustergMSAIdentity](https://docs.microsoft.com/azure/service-fabric/service-fabric-windows-cluster-windows-security) 來設定節點對節點安全性。</span><span class="sxs-lookup"><span data-stu-id="1461a-215">Node to node security is configured by setting [ClustergMSAIdentity](https://docs.microsoft.com/azure/service-fabric/service-fabric-windows-cluster-windows-security) when service fabric needs to run under gMSA.</span></span> <span data-ttu-id="1461a-216">為了建置節點之間的信任關係，它們必須注意彼此。</span><span class="sxs-lookup"><span data-stu-id="1461a-216">In order to build trust relationships between nodes, they must be made aware of each other.</span></span>

<span data-ttu-id="1461a-217">用戶端對節點安全性是使用 ClientIdentities 來設定的。</span><span class="sxs-lookup"><span data-stu-id="1461a-217">Client to node security is configured using ClientIdentities.</span></span> <span data-ttu-id="1461a-218">若要建立用戶端與叢集之間的信任，您必須設定叢集才能知道用戶端可以信任的身分識別。</span><span class="sxs-lookup"><span data-stu-id="1461a-218">In order to establish trust between a client and the cluster, you must configure the cluster to know which client identities that it can trust.</span></span>

<span data-ttu-id="1461a-219">**使用電腦群組設定 Windows 安全性**</span><span class="sxs-lookup"><span data-stu-id="1461a-219">**Configure Windows security using a machine group**</span></span>

<span data-ttu-id="1461a-220">如果您想要使用 Active Directory 網域內的電腦群組，可使用 ClusterIdentity 來設定節點對節點安全性。</span><span class="sxs-lookup"><span data-stu-id="1461a-220">Node to node security is configured by setting using ClusterIdentity if you want to use a machine group within an Active Directory Domain.</span></span> <span data-ttu-id="1461a-221">如需詳細資訊，請參閱[在 Active Directory 中建立電腦群組 (Create a Machine Group in Active Directory)](https://msdn.microsoft.com/library/aa545347)。</span><span class="sxs-lookup"><span data-stu-id="1461a-221">For more information, see [Create a Machine Group in Active Directory](https://msdn.microsoft.com/library/aa545347).</span></span>

<span data-ttu-id="1461a-222">用戶端對節點安全性是使用 ClientIdentities 來設定的。</span><span class="sxs-lookup"><span data-stu-id="1461a-222">Client-to-node security is configured by using ClientIdentities.</span></span> <span data-ttu-id="1461a-223">若要在用戶端與叢集之間建立信任，您必須設定叢集，讓叢集知道它可以信任的用戶端身分識別。</span><span class="sxs-lookup"><span data-stu-id="1461a-223">To establish trust between a client and the cluster, you must configure the cluster to know the client identities that the cluster can trust.</span></span> <span data-ttu-id="1461a-224">您可以透過兩種不同方式建立信任︰</span><span class="sxs-lookup"><span data-stu-id="1461a-224">You can establish trust in two different ways:</span></span>

-   <span data-ttu-id="1461a-225">指定可以連線的網域群組使用者。</span><span class="sxs-lookup"><span data-stu-id="1461a-225">Specify the domain group users that can connect.</span></span>
-   <span data-ttu-id="1461a-226">指定可以連線的網域節點使用者。</span><span class="sxs-lookup"><span data-stu-id="1461a-226">Specify the domain node users that can connect.</span></span>

## <a name="configure-application-security-in-service-fabric"></a><span data-ttu-id="1461a-227">在 Service Fabric 中設定應用程式安全性</span><span class="sxs-lookup"><span data-stu-id="1461a-227">Configure application security in Service Fabric</span></span>
### <a name="managing-secrets-in-service-fabric-applications"></a><span data-ttu-id="1461a-228">管理 Service Fabric 應用程式中的密碼</span><span class="sxs-lookup"><span data-stu-id="1461a-228">Managing secrets in Service Fabric applications</span></span>
<span data-ttu-id="1461a-229">此方法可協助管理 Service Fabric 應用程式中的密碼。</span><span class="sxs-lookup"><span data-stu-id="1461a-229">This method helps in managing secrets in a Service Fabric application.</span></span> <span data-ttu-id="1461a-230">密碼可以是任何機密資訊，例如儲存體連接字串、密碼或其他不會以純文字處理的值。</span><span class="sxs-lookup"><span data-stu-id="1461a-230">Secrets can be any sensitive information, such as storage connection strings, passwords, or other values that should not be handled in plain text.</span></span>

<span data-ttu-id="1461a-231">此方法使用 [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-whatis) 來管理金鑰和密碼。</span><span class="sxs-lookup"><span data-stu-id="1461a-231">This approach uses [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-whatis) to manage keys and secrets.</span></span> <span data-ttu-id="1461a-232">不過，應用程式中的密碼使用是由平台驗證，讓應用程式可部署至裝載在任何位置的叢集。</span><span class="sxs-lookup"><span data-stu-id="1461a-232">However, using secrets in an application is cloud platform-agnostic to allow applications to be deployed to a cluster hosted anywhere.</span></span> <span data-ttu-id="1461a-233">此流程有四個主要步驟︰</span><span class="sxs-lookup"><span data-stu-id="1461a-233">There are four main steps in this flow:</span></span>

-   <span data-ttu-id="1461a-234">取得資料編密憑證。</span><span class="sxs-lookup"><span data-stu-id="1461a-234">Obtain a data encipherment certificate.</span></span>
-   <span data-ttu-id="1461a-235">在叢集中安裝憑證。</span><span class="sxs-lookup"><span data-stu-id="1461a-235">Install the certificate in your cluster.</span></span>
-   <span data-ttu-id="1461a-236">在部署應用程式時以憑證來加密密碼的值，並將其插入服務的 Settings.xml 組態檔。</span><span class="sxs-lookup"><span data-stu-id="1461a-236">Encrypt secret values when deploying an application with the certificate and inject them into a service's Settings.xml configuration file.</span></span>
-   <span data-ttu-id="1461a-237">藉由以相同的編密憑證進行解密，從 Settings.xml 讀取加密的值。</span><span class="sxs-lookup"><span data-stu-id="1461a-237">Read encrypted values out of Settings.xml by decrypting with the same encipherment certificate.</span></span>

>[!Note]
><span data-ttu-id="1461a-238">深入了解[管理 Service Fabric 應用程式中的密碼](https://docs.microsoft.com/azure/service-fabric/service-fabric-application-secret-management)。</span><span class="sxs-lookup"><span data-stu-id="1461a-238">Learn more about [Managing secrets in Service Fabric applications](https://docs.microsoft.com/azure/service-fabric/service-fabric-application-secret-management).</span></span>

### <a name="configure-security-policies-for-your-application"></a><span data-ttu-id="1461a-239">設定應用程式的安全性原則</span><span class="sxs-lookup"><span data-stu-id="1461a-239">Configure security policies for your application</span></span>
<span data-ttu-id="1461a-240">使用 Azure Service Fabric 安全性，您可以協助保護叢集中以不同使用者帳戶執行的應用程式。</span><span class="sxs-lookup"><span data-stu-id="1461a-240">By using Azure Service Fabric Security, you can help secure applications that are running in the cluster under different user accounts.</span></span> <span data-ttu-id="1461a-241">在以該使用者帳戶部署時，Service Fabric 安全性也會協助保護應用程式所使用的資源，例如檔案、目錄和憑證。</span><span class="sxs-lookup"><span data-stu-id="1461a-241">Service Fabric Security also helps secure the resources that are used by applications at the time of deployment under the user accounts--for example, files, directories, and certificates.</span></span> <span data-ttu-id="1461a-242">如此一來，即使在共用主控環境中，執行中的應用程式就不會彼此干擾。</span><span class="sxs-lookup"><span data-stu-id="1461a-242">This makes running applications, even in a shared hosted environment, more secure from one another.</span></span>
<span data-ttu-id="1461a-243">步驟包括：</span><span class="sxs-lookup"><span data-stu-id="1461a-243">The steps include:</span></span>

-   <span data-ttu-id="1461a-244">設定服務安裝程式進入點的原則。</span><span class="sxs-lookup"><span data-stu-id="1461a-244">Configure the policy for a service setup entry point.</span></span>
-   <span data-ttu-id="1461a-245">從安裝程式進入點啟動 PowerShell 命令。</span><span class="sxs-lookup"><span data-stu-id="1461a-245">Start PowerShell commands from a setup entry point.</span></span>
-   <span data-ttu-id="1461a-246">使用主控台重新導向進行本機偵錯。</span><span class="sxs-lookup"><span data-stu-id="1461a-246">Use console redirection for local debugging.</span></span>
-   <span data-ttu-id="1461a-247">設定服務程式碼封裝的原則。</span><span class="sxs-lookup"><span data-stu-id="1461a-247">Configure a policy for service code packages.</span></span>
-   <span data-ttu-id="1461a-248">為 HTTP 和 HTTPS 端點指派安全性存取原則。</span><span class="sxs-lookup"><span data-stu-id="1461a-248">Assign a security access policy for HTTP and HTTPS endpoints.</span></span>

## <a name="secure-communication-for-services-in-azure-service-fabric-security"></a><span data-ttu-id="1461a-249">保護 Azure Service Fabric 安全性中服務的通訊安全</span><span class="sxs-lookup"><span data-stu-id="1461a-249">Secure communication for services in Azure Service Fabric security</span></span>
<span data-ttu-id="1461a-250">安全性是通訊最為重視的其中一個部分。</span><span class="sxs-lookup"><span data-stu-id="1461a-250">Security is one of the most important aspects of communication.</span></span> <span data-ttu-id="1461a-251">Reliable Services 應用程式架構會提供可用來改善安全性的一些預先建置通訊堆疊和工具。</span><span class="sxs-lookup"><span data-stu-id="1461a-251">The Reliable Services application framework provides a few prebuilt communication stacks and tools that can be used to improve security.</span></span>

-   <span data-ttu-id="1461a-252">[協助保護使用服務遠端處理時的服務安全](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-secure-communication)。</span><span class="sxs-lookup"><span data-stu-id="1461a-252">[Help secure a service when you're using service remoting](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-secure-communication).</span></span>
-   <span data-ttu-id="1461a-253">[協助保護使用 WCF 通訊堆疊時的服務安全](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-secure-communication#help-secure-a-service-when-youre-using-a-wcf-based-communication-stack)。</span><span class="sxs-lookup"><span data-stu-id="1461a-253">[Help secure a service when you're using a WCF-based communication stack](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-secure-communication#help-secure-a-service-when-youre-using-a-wcf-based-communication-stack).</span></span>

## <a name="next-steps"></a><span data-ttu-id="1461a-254">後續步驟</span><span class="sxs-lookup"><span data-stu-id="1461a-254">Next steps</span></span>
- <span data-ttu-id="1461a-255">如需叢集安全性的概念資訊，請參閱[使用 Resource Manager 範本在 Azure 中建立叢集](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm)和 [Azure 入口網站](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-portal)。</span><span class="sxs-lookup"><span data-stu-id="1461a-255">For conceptual information about cluster security, see [create a cluster in Azure using a Resource Manager template](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm) and [Azure portal](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-portal).</span></span>
- <span data-ttu-id="1461a-256">如需詳細資訊，請參閱 [Service Fabric 叢集安全性](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security)。</span><span class="sxs-lookup"><span data-stu-id="1461a-256">Learn more about, see [Service Fabric cluster security](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security).</span></span>
