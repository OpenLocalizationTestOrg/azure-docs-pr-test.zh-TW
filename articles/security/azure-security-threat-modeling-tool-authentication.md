---
title: "驗證 - Microsoft Threat Modeling Tool - Azure | Microsoft Docs"
description: "降低威脅模型化工具所暴露的威脅"
services: security
documentationcenter: na
author: RodSan
manager: RodSan
editor: RodSan
ms.assetid: na
ms.service: security
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: rodsan
ms.openlocfilehash: e547469dc61eddd1d772571ab0919532ac91f128
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="security-frame-authentication--mitigations"></a><span data-ttu-id="a1c87-103">安全框架︰驗證 | 緩和措施</span><span class="sxs-lookup"><span data-stu-id="a1c87-103">Security Frame: Authentication | Mitigations</span></span> 
| <span data-ttu-id="a1c87-104">產品/服務</span><span class="sxs-lookup"><span data-stu-id="a1c87-104">Product/Service</span></span> | <span data-ttu-id="a1c87-105">文章</span><span class="sxs-lookup"><span data-stu-id="a1c87-105">Article</span></span> |
| --------------- | ------- |
| <span data-ttu-id="a1c87-106">**Web 應用程式**</span><span class="sxs-lookup"><span data-stu-id="a1c87-106">**Web Application**</span></span>    | <ul><li>[<span data-ttu-id="a1c87-107">考慮使用標準驗證機制來驗證 Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="a1c87-107">Consider using a standard authentication mechanism to authenticate to Web Application</span></span>](#standard-authn-web-app)</li><li>[<span data-ttu-id="a1c87-108">應用程式必須安全地處理失敗的驗證案例</span><span class="sxs-lookup"><span data-stu-id="a1c87-108">Applications must handle failed authentication scenarios securely</span></span>](#handle-failed-authn)</li><li>[<span data-ttu-id="a1c87-109">啟用升級或調適性驗證</span><span class="sxs-lookup"><span data-stu-id="a1c87-109">Enable step up or adaptive authentication</span></span>](#step-up-adaptive-authn)</li><li>[<span data-ttu-id="a1c87-110">確保已適當地鎖定系統管理介面</span><span class="sxs-lookup"><span data-stu-id="a1c87-110">Ensure that administrative interfaces are appropriately locked down</span></span>](#admin-interface-lockdown)</li><li>[<span data-ttu-id="a1c87-111">安全地實作忘記密碼功能</span><span class="sxs-lookup"><span data-stu-id="a1c87-111">Implement forgot password functionalities securely</span></span>](#forgot-pword-fxn)</li><li>[<span data-ttu-id="a1c87-112">確保已實作密碼和帳戶原則</span><span class="sxs-lookup"><span data-stu-id="a1c87-112">Ensure that password and account policy are implemented</span></span>](#pword-account-policy)</li><li>[<span data-ttu-id="a1c87-113">實作控制項以避免列舉使用者名稱</span><span class="sxs-lookup"><span data-stu-id="a1c87-113">Implement controls to prevent username enumeration</span></span>](#controls-username-enum)</li></ul> |
| <span data-ttu-id="a1c87-114">**資料庫**</span><span class="sxs-lookup"><span data-stu-id="a1c87-114">**Database**</span></span> | <ul><li>[<span data-ttu-id="a1c87-115">可能的話，使用 Windows 驗證連線到 SQL Server</span><span class="sxs-lookup"><span data-stu-id="a1c87-115">When possible, use Windows Authentication for connecting to SQL Server</span></span>](#win-authn-sql)</li><li>[<span data-ttu-id="a1c87-116">可能的話，使用 Azure Active Directory 驗證連線到 SQL Database</span><span class="sxs-lookup"><span data-stu-id="a1c87-116">When possible use Azure Active Directory Authentication for Connecting to SQL Database</span></span>](#aad-authn-sql)</li><li>[<span data-ttu-id="a1c87-117">使用 SQL 驗證模式時，確保在 SQL Server 上強制執行帳戶和密碼原則</span><span class="sxs-lookup"><span data-stu-id="a1c87-117">When SQL authentication mode is used, ensure that account and password policy are enforced on SQL server</span></span>](#authn-account-pword)</li><li>[<span data-ttu-id="a1c87-118">請勿在自主資料庫中使用 SQL 驗證</span><span class="sxs-lookup"><span data-stu-id="a1c87-118">Do not use SQL Authentication in contained databases</span></span>](#autn-contained-db)</li></ul> |
| <span data-ttu-id="a1c87-119">**Azure 事件中樞**</span><span class="sxs-lookup"><span data-stu-id="a1c87-119">**Azure Event Hub**</span></span> | <ul><li>[<span data-ttu-id="a1c87-120">使用採用 SaS 權杖的每一裝置驗證認證</span><span class="sxs-lookup"><span data-stu-id="a1c87-120">Use per device authentication credentials using SaS tokens</span></span>](#authn-sas-tokens)</li></ul> |
| <span data-ttu-id="a1c87-121">**Azure 信任邊界**</span><span class="sxs-lookup"><span data-stu-id="a1c87-121">**Azure Trust Boundary**</span></span> | <ul><li>[<span data-ttu-id="a1c87-122">啟用 Azure 系統管理員適用的 Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="a1c87-122">Enable Azure Multi-Factor Authentication for Azure Administrators</span></span>](#multi-factor-azure-admin)</li></ul> |
| <span data-ttu-id="a1c87-123">**Service Fabric 信任邊界**</span><span class="sxs-lookup"><span data-stu-id="a1c87-123">**Service Fabric Trust Boundary**</span></span> | <ul><li>[<span data-ttu-id="a1c87-124">限制 Service Fabric 叢集的匿名存取</span><span class="sxs-lookup"><span data-stu-id="a1c87-124">Restrict anonymous access to Service Fabric Cluster</span></span>](#anon-access-cluster)</li><li>[<span data-ttu-id="a1c87-125">確保 Service Fabric 的用戶端對節點憑證不同於節點對節點憑證</span><span class="sxs-lookup"><span data-stu-id="a1c87-125">Ensure that Service Fabric client-to-node certificate is different from node-to-node certificate</span></span>](#fabric-cn-nn)</li><li>[<span data-ttu-id="a1c87-126">使用 AAD 來向 Service Fabric 叢集驗證用戶端對</span><span class="sxs-lookup"><span data-stu-id="a1c87-126">Use AAD to authenticate clients to service fabric clusters</span></span>](#aad-client-fabric)</li><li>[<span data-ttu-id="a1c87-127">確保從經過核准的憑證授權單位 (CA) 取得 Service Fabric 憑證</span><span class="sxs-lookup"><span data-stu-id="a1c87-127">Ensure that service fabric certificates are obtained from an approved Certificate Authority (CA)</span></span>](#fabric-cert-ca)</li></ul> |
| <span data-ttu-id="a1c87-128">**Identity Server**</span><span class="sxs-lookup"><span data-stu-id="a1c87-128">**Identity Server**</span></span> | <ul><li>[<span data-ttu-id="a1c87-129">使用 Identity Server 所支援的標準驗證案例</span><span class="sxs-lookup"><span data-stu-id="a1c87-129">Use standard authentication scenarios supported by Identity Server</span></span>](#standard-authn-id)</li><li>[<span data-ttu-id="a1c87-130">以可調整的替代項目覆寫預設 Identity Server 權杖快取</span><span class="sxs-lookup"><span data-stu-id="a1c87-130">Override the default Identity Server token cache with a scalable alternative</span></span>](#override-token)</li></ul> |
| <span data-ttu-id="a1c87-131">**電腦信任邊界**</span><span class="sxs-lookup"><span data-stu-id="a1c87-131">**Machine Trust Boundary**</span></span> | <ul><li>[<span data-ttu-id="a1c87-132">確保已數位簽署所部署應用程式的二進位檔</span><span class="sxs-lookup"><span data-stu-id="a1c87-132">Ensure that deployed application's binaries are digitally signed</span></span>](#binaries-signed)</li></ul> |
| <span data-ttu-id="a1c87-133">**WCF**</span><span class="sxs-lookup"><span data-stu-id="a1c87-133">**WCF**</span></span> | <ul><li>[<span data-ttu-id="a1c87-134">在連線到 WCF 中的 MSMQ 佇列時啟用驗證</span><span class="sxs-lookup"><span data-stu-id="a1c87-134">Enable authentication when connecting to MSMQ queues in WCF</span></span>](#msmq-queues)</li><li>[<span data-ttu-id="a1c87-135">WCF - 請勿將訊息 clientCredentialType 設定為 none</span><span class="sxs-lookup"><span data-stu-id="a1c87-135">WCF-Do not set Message clientCredentialType to none</span></span>](#message-none)</li><li>[<span data-ttu-id="a1c87-136">WCF - 請勿將傳輸 clientCredentialType 設定為 none</span><span class="sxs-lookup"><span data-stu-id="a1c87-136">WCF-Do not set Transport clientCredentialType to none</span></span>](#transport-none)</li></ul> |
| <span data-ttu-id="a1c87-137">**Web API**</span><span class="sxs-lookup"><span data-stu-id="a1c87-137">**Web API**</span></span> | <ul><li>[<span data-ttu-id="a1c87-138">確保使用標準驗證技術來保護 Web API</span><span class="sxs-lookup"><span data-stu-id="a1c87-138">Ensure that standard authentication techniques are used to secure Web APIs</span></span>](#authn-secure-api)</li></ul> |
| <span data-ttu-id="a1c87-139">**Azure AD**</span><span class="sxs-lookup"><span data-stu-id="a1c87-139">**Azure AD**</span></span> | <ul><li>[<span data-ttu-id="a1c87-140">使用 Azure Active Directory 所支援的標準驗證案例</span><span class="sxs-lookup"><span data-stu-id="a1c87-140">Use standard authentication scenarios supported by Azure Active Directory</span></span>](#authn-aad)</li><li>[<span data-ttu-id="a1c87-141">以可調整的替代項目覆寫預設 ADAL 權杖快取</span><span class="sxs-lookup"><span data-stu-id="a1c87-141">Override the default ADAL token cache with a scalable alternative</span></span>](#adal-scalable)</li><li>[<span data-ttu-id="a1c87-142">確保使用 TokenReplayCache 來防止重新執行 ADAL 驗證權杖</span><span class="sxs-lookup"><span data-stu-id="a1c87-142">Ensure that TokenReplayCache is used to prevent the replay of ADAL authentication tokens</span></span>](#tokenreplaycache-adal)</li><li>[<span data-ttu-id="a1c87-143">使用 ADAL 程式庫來管理從 OAuth2 用戶端至 AAD (或內部部署 AD) 的權杖要求</span><span class="sxs-lookup"><span data-stu-id="a1c87-143">Use ADAL libraries to manage token requests from OAuth2 clients to AAD (or on-premises AD)</span></span>](#adal-oauth2)</li></ul> |
| <span data-ttu-id="a1c87-144">**IoT 現場閘道**</span><span class="sxs-lookup"><span data-stu-id="a1c87-144">**IoT Field Gateway**</span></span> | <ul><li>[<span data-ttu-id="a1c87-145">驗證連線到現場閘道的裝置</span><span class="sxs-lookup"><span data-stu-id="a1c87-145">Authenticate devices connecting to the Field Gateway</span></span>](#authn-devices-field)</li></ul> |
| <span data-ttu-id="a1c87-146">**IoT 雲端閘道**</span><span class="sxs-lookup"><span data-stu-id="a1c87-146">**IoT Cloud Gateway**</span></span> | <ul><li>[<span data-ttu-id="a1c87-147">確保會驗證連線到雲端閘道的裝置</span><span class="sxs-lookup"><span data-stu-id="a1c87-147">Ensure that devices connecting to Cloud gateway are authenticated</span></span>](#authn-devices-cloud)</li><li>[<span data-ttu-id="a1c87-148">使用每一裝置驗證認證</span><span class="sxs-lookup"><span data-stu-id="a1c87-148">Use per-device authentication credentials</span></span>](#authn-cred)</li></ul> |
| <span data-ttu-id="a1c87-149">**Azure 儲存體**</span><span class="sxs-lookup"><span data-stu-id="a1c87-149">**Azure Storage**</span></span> | <ul><li>[<span data-ttu-id="a1c87-150">確保只有必要的容器和 blob 會取得匿名讀取權限</span><span class="sxs-lookup"><span data-stu-id="a1c87-150">Ensure that only the required containers and blobs are given anonymous read access</span></span>](#req-containers-anon)</li><li>[<span data-ttu-id="a1c87-151">使用 SAS 或 SAP 對 Azure 儲存體中的物件授與有限的存取權</span><span class="sxs-lookup"><span data-stu-id="a1c87-151">Grant limited access to objects in Azure storage using SAS or SAP</span></span>](#limited-access-sas)</li></ul> |

## <span data-ttu-id="a1c87-152"><a id="standard-authn-web-app"></a>考慮使用標準驗證機制來驗證 Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="a1c87-152"><a id="standard-authn-web-app"></a>Consider using a standard authentication mechanism to authenticate to Web Application</span></span>

| <span data-ttu-id="a1c87-153">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-153">Title</span></span>                   | <span data-ttu-id="a1c87-154">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-154">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-155">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-155">**Component**</span></span>               | <span data-ttu-id="a1c87-156">Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="a1c87-156">Web Application</span></span> | 
| <span data-ttu-id="a1c87-157">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-157">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-158">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-158">Build</span></span> |  
| <span data-ttu-id="a1c87-159">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-159">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-160">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-160">Generic</span></span> |
| <span data-ttu-id="a1c87-161">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-161">**Attributes**</span></span>              | <span data-ttu-id="a1c87-162">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-162">N/A</span></span>  |
| <span data-ttu-id="a1c87-163">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-163">**References**</span></span>              | <span data-ttu-id="a1c87-164">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-164">N/A</span></span>  |
| <span data-ttu-id="a1c87-165">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-165">Details</span></span> | <p><span data-ttu-id="a1c87-166">驗證是實體證明其身分識別的程序 (通常透過使用者名稱和密碼等認證)。</span><span class="sxs-lookup"><span data-stu-id="a1c87-166">Authentication is the process where an entity proves its identity, typically through credentials, such as a user name and password.</span></span> <span data-ttu-id="a1c87-167">有多個驗證通訊協定可列入考量。</span><span class="sxs-lookup"><span data-stu-id="a1c87-167">There are multiple authentication protocols available which may be considered.</span></span> <span data-ttu-id="a1c87-168">下列是其中一些通訊協定︰</span><span class="sxs-lookup"><span data-stu-id="a1c87-168">Some of them are listed below:</span></span></p><ul><li><span data-ttu-id="a1c87-169">Client certificates</span><span class="sxs-lookup"><span data-stu-id="a1c87-169">Client certificates</span></span></li><li><span data-ttu-id="a1c87-170">Windows 架構</span><span class="sxs-lookup"><span data-stu-id="a1c87-170">Windows based</span></span></li><li><span data-ttu-id="a1c87-171">表單架構</span><span class="sxs-lookup"><span data-stu-id="a1c87-171">Forms based</span></span></li><li><span data-ttu-id="a1c87-172">同盟 - ADFS</span><span class="sxs-lookup"><span data-stu-id="a1c87-172">Federation - ADFS</span></span></li><li><span data-ttu-id="a1c87-173">同盟 - Azure AD</span><span class="sxs-lookup"><span data-stu-id="a1c87-173">Federation - Azure AD</span></span></li><li><span data-ttu-id="a1c87-174">同盟 - Identity Server</span><span class="sxs-lookup"><span data-stu-id="a1c87-174">Federation - Identity Server</span></span></li></ul><p><span data-ttu-id="a1c87-175">考慮使用標準驗證機制來識別來源程序</span><span class="sxs-lookup"><span data-stu-id="a1c87-175">Consider using a standard authentication mechanism to identify the source process</span></span></p>|

## <span data-ttu-id="a1c87-176"><a id="handle-failed-authn"></a>應用程式必須安全地處理失敗的驗證案例</span><span class="sxs-lookup"><span data-stu-id="a1c87-176"><a id="handle-failed-authn"></a>Applications must handle failed authentication scenarios securely</span></span>

| <span data-ttu-id="a1c87-177">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-177">Title</span></span>                   | <span data-ttu-id="a1c87-178">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-178">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-179">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-179">**Component**</span></span>               | <span data-ttu-id="a1c87-180">Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="a1c87-180">Web Application</span></span> | 
| <span data-ttu-id="a1c87-181">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-181">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-182">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-182">Build</span></span> |  
| <span data-ttu-id="a1c87-183">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-183">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-184">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-184">Generic</span></span> |
| <span data-ttu-id="a1c87-185">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-185">**Attributes**</span></span>              | <span data-ttu-id="a1c87-186">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-186">N/A</span></span>  |
| <span data-ttu-id="a1c87-187">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-187">**References**</span></span>              | <span data-ttu-id="a1c87-188">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-188">N/A</span></span>  |
| <span data-ttu-id="a1c87-189">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-189">Details</span></span> | <p><span data-ttu-id="a1c87-190">明確驗證使用者的應用程式必須安全地處理失敗的驗證案例。驗證機制必須︰</span><span class="sxs-lookup"><span data-stu-id="a1c87-190">Applications that explicitly authenticate users must handle failed authentication scenarios securely.The authentication mechanism must:</span></span></p><ul><li><span data-ttu-id="a1c87-191">驗證失敗時拒絕存取特殊權限的資源</span><span class="sxs-lookup"><span data-stu-id="a1c87-191">Deny access to privileged resources when authentication fails</span></span></li><li><span data-ttu-id="a1c87-192">驗證失敗後會顯示一般錯誤訊息，並發生存取遭拒</span><span class="sxs-lookup"><span data-stu-id="a1c87-192">Display a generic error message after failed authentication and access denied occurs</span></span></li></ul><p><span data-ttu-id="a1c87-193">測試：</span><span class="sxs-lookup"><span data-stu-id="a1c87-193">Test for:</span></span></p><ul><li><span data-ttu-id="a1c87-194">登入失敗後的特殊權限資源保護</span><span class="sxs-lookup"><span data-stu-id="a1c87-194">Protection of privileged resources after failed logins</span></span></li><li><span data-ttu-id="a1c87-195">一般錯誤訊息會顯示於驗證失敗和存取遭拒事件</span><span class="sxs-lookup"><span data-stu-id="a1c87-195">A generic error message is displayed on failed authentication and access denied event(s)</span></span></li><li><span data-ttu-id="a1c87-196">帳戶會在過多失敗嘗試後停用</span><span class="sxs-lookup"><span data-stu-id="a1c87-196">Accounts are disabled after an excessive number of failed attempts</span></span></li><ul>|

## <span data-ttu-id="a1c87-197"><a id="step-up-adaptive-authn"></a>啟用升級或調適性驗證</span><span class="sxs-lookup"><span data-stu-id="a1c87-197"><a id="step-up-adaptive-authn"></a>Enable step up or adaptive authentication</span></span>

| <span data-ttu-id="a1c87-198">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-198">Title</span></span>                   | <span data-ttu-id="a1c87-199">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-199">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-200">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-200">**Component**</span></span>               | <span data-ttu-id="a1c87-201">Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="a1c87-201">Web Application</span></span> | 
| <span data-ttu-id="a1c87-202">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-202">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-203">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-203">Build</span></span> |  
| <span data-ttu-id="a1c87-204">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-204">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-205">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-205">Generic</span></span> |
| <span data-ttu-id="a1c87-206">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-206">**Attributes**</span></span>              | <span data-ttu-id="a1c87-207">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-207">N/A</span></span>  |
| <span data-ttu-id="a1c87-208">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-208">**References**</span></span>              | <span data-ttu-id="a1c87-209">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-209">N/A</span></span>  |
| <span data-ttu-id="a1c87-210">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-210">Details</span></span> | <p><span data-ttu-id="a1c87-211">確認應用程式有額外的授權 (例如透過 Multi-Factor Authentication 的升級或調適性驗證，例如以簡訊、電子郵件等傳送 OTP 或提示重新驗證)，這麼一來，使用者便會在獲得敏感性資訊的存取權之前受到查問。</span><span class="sxs-lookup"><span data-stu-id="a1c87-211">Verify the application has additional authorization (such as step up or adaptive authentication, via multi-factor authentication such as sending OTP in SMS, email etc. or prompting for re-authentication) so the user is challenged before being granted access to sensitive information.</span></span> <span data-ttu-id="a1c87-212">此規則也適用於對帳戶或動作進行重大變更</span><span class="sxs-lookup"><span data-stu-id="a1c87-212">This rule also applies for making critical changes to an account or action</span></span></p><p><span data-ttu-id="a1c87-213">這也表示必須以應用程式正確地強制執行內容相關授權的方式來實作驗證調節，才不會允許藉由竄改參數等方法的未經授權操作</span><span class="sxs-lookup"><span data-stu-id="a1c87-213">This also means that the adaptation of authentication has to be implemented in such a manner that the application correctly enforces context-sensitive authorization so as to not allow unauthorized manipulation by means of in example, parameter tampering</span></span></p>|

## <span data-ttu-id="a1c87-214"><a id="admin-interface-lockdown"></a>確保已適當地鎖定系統管理介面</span><span class="sxs-lookup"><span data-stu-id="a1c87-214"><a id="admin-interface-lockdown"></a>Ensure that administrative interfaces are appropriately locked down</span></span>

| <span data-ttu-id="a1c87-215">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-215">Title</span></span>                   | <span data-ttu-id="a1c87-216">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-216">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-217">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-217">**Component**</span></span>               | <span data-ttu-id="a1c87-218">Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="a1c87-218">Web Application</span></span> | 
| <span data-ttu-id="a1c87-219">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-219">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-220">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-220">Build</span></span> |  
| <span data-ttu-id="a1c87-221">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-221">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-222">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-222">Generic</span></span> |
| <span data-ttu-id="a1c87-223">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-223">**Attributes**</span></span>              | <span data-ttu-id="a1c87-224">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-224">N/A</span></span>  |
| <span data-ttu-id="a1c87-225">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-225">**References**</span></span>              | <span data-ttu-id="a1c87-226">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-226">N/A</span></span>  |
| <span data-ttu-id="a1c87-227">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-227">Details</span></span> | <span data-ttu-id="a1c87-228">第一個解決方法是授與只從特定來源 IP 範圍到系統管理介面的存取權。</span><span class="sxs-lookup"><span data-stu-id="a1c87-228">The first solution is to grant access only from a certain source IP range to the administrative interface.</span></span> <span data-ttu-id="a1c87-229">如果相較於一貫的建議，該解決方案並不可行，則強制執行升級或調適性驗證以便登入系統管理介面</span><span class="sxs-lookup"><span data-stu-id="a1c87-229">If that solution would not be possible than it is always recommended to enforce a step-up or adaptive authentication for logging in into the administrative interface</span></span> |

## <span data-ttu-id="a1c87-230"><a id="forgot-pword-fxn"></a>安全地實作忘記密碼功能</span><span class="sxs-lookup"><span data-stu-id="a1c87-230"><a id="forgot-pword-fxn"></a>Implement forgot password functionalities securely</span></span>

| <span data-ttu-id="a1c87-231">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-231">Title</span></span>                   | <span data-ttu-id="a1c87-232">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-232">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-233">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-233">**Component**</span></span>               | <span data-ttu-id="a1c87-234">Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="a1c87-234">Web Application</span></span> | 
| <span data-ttu-id="a1c87-235">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-235">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-236">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-236">Build</span></span> |  
| <span data-ttu-id="a1c87-237">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-237">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-238">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-238">Generic</span></span> |
| <span data-ttu-id="a1c87-239">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-239">**Attributes**</span></span>              | <span data-ttu-id="a1c87-240">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-240">N/A</span></span>  |
| <span data-ttu-id="a1c87-241">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-241">**References**</span></span>              | <span data-ttu-id="a1c87-242">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-242">N/A</span></span>  |
| <span data-ttu-id="a1c87-243">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-243">Details</span></span> | <p><span data-ttu-id="a1c87-244">首先，確認忘記密碼和其他復原路徑會傳送包含限時啟用權杖 (而不是密碼本身) 的連結。</span><span class="sxs-lookup"><span data-stu-id="a1c87-244">The first thing is to verify that forgot password and other recovery paths send a link including a time-limited activation token rather than the password itself.</span></span> <span data-ttu-id="a1c87-245">在連結傳出之前，也可能需要以軟式權杖 (例如 SMS 權杖、原生行動應用程式等) 為基礎的其他驗證。</span><span class="sxs-lookup"><span data-stu-id="a1c87-245">Additional authentication based on soft-tokens (e.g. SMS token, native mobile applications, etc.) can be required as well before the link is sent over.</span></span> <span data-ttu-id="a1c87-246">第二，在取得新密碼的過程中，您不得鎖定使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="a1c87-246">Second, you should not lock out the users account whilst the process of getting a new password is in progress.</span></span></p><p><span data-ttu-id="a1c87-247">每當攻擊者決定透過自動化攻擊來刻意鎖定使用者時，這可能會導致拒絕服務攻擊。</span><span class="sxs-lookup"><span data-stu-id="a1c87-247">This could lead to a Denial of service attack whenever an attacker decides to intentionally lock out the users with an automated attack.</span></span> <span data-ttu-id="a1c87-248">第三，在設定新密碼要求的過程中，您顯示的訊息應該一般化，以避免列舉使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="a1c87-248">Third, whenever the new password request was set in progress, the message you display should be generalized in order to prevent username enumeration.</span></span> <span data-ttu-id="a1c87-249">第四，一律不允許使用舊密碼並實作強式密碼原則。</span><span class="sxs-lookup"><span data-stu-id="a1c87-249">Fourth, always disallow the use of old passwords and implement a strong password policy.</span></span></p> |

## <span data-ttu-id="a1c87-250"><a id="pword-account-policy"></a>確保已實作密碼和帳戶原則</span><span class="sxs-lookup"><span data-stu-id="a1c87-250"><a id="pword-account-policy"></a>Ensure that password and account policy are implemented</span></span>

| <span data-ttu-id="a1c87-251">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-251">Title</span></span>                   | <span data-ttu-id="a1c87-252">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-252">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-253">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-253">**Component**</span></span>               | <span data-ttu-id="a1c87-254">Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="a1c87-254">Web Application</span></span> | 
| <span data-ttu-id="a1c87-255">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-255">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-256">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-256">Build</span></span> |  
| <span data-ttu-id="a1c87-257">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-257">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-258">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-258">Generic</span></span> |
| <span data-ttu-id="a1c87-259">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-259">**Attributes**</span></span>              | <span data-ttu-id="a1c87-260">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-260">N/A</span></span>  |
| <span data-ttu-id="a1c87-261">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-261">**References**</span></span>              | <span data-ttu-id="a1c87-262">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-262">N/A</span></span>  |
| <span data-ttu-id="a1c87-263">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-263">Details</span></span> | <p><span data-ttu-id="a1c87-264">必須實作符合組織原則和最佳作法的密碼和帳戶原則。</span><span class="sxs-lookup"><span data-stu-id="a1c87-264">Password and account policy in compliance with organizational policy and best practices should be implemented.</span></span></p><p><span data-ttu-id="a1c87-265">若要防止暴力密碼破解及以字典為基礎的猜測︰必須實作強式密碼原則，以確保使用者建立複雜的密碼 (例如，長度最少 12 個字元、英數字元和特殊字元)。</span><span class="sxs-lookup"><span data-stu-id="a1c87-265">To defend against brute-force and dictionary based guessing: Strong password policy must be implemented to ensure that users create complex password (e.g., 12 characters minimum length, alphanumeric and special characters).</span></span></p><p><span data-ttu-id="a1c87-266">帳戶鎖定原則可能會以下列方式實作︰</span><span class="sxs-lookup"><span data-stu-id="a1c87-266">Account lockout policies may be implemented in the following manner:</span></span></p><ul><li><span data-ttu-id="a1c87-267">**軟式鎖定︰**這是保護使用者以對抗暴力密碼破解攻擊的理想選項。</span><span class="sxs-lookup"><span data-stu-id="a1c87-267">**Soft lock-out:** This can be a good option for protecting your users against brute force attacks.</span></span> <span data-ttu-id="a1c87-268">例如，當使用者輸入錯誤密碼三次時，應用程式會鎖定帳戶一分鐘，以減緩暴力破解其密碼的進度，讓攻擊者有機可趁的機會變少。</span><span class="sxs-lookup"><span data-stu-id="a1c87-268">For example, whenever the user enters a wrong password three times the application could lock down the account for a minute in order to slow down the process of brute forcing his password making it less profitable for the attacker to proceed.</span></span> <span data-ttu-id="a1c87-269">如果您對此範例執行硬式鎖定對策，您可藉由永久鎖定帳戶來達成 "Dos"。</span><span class="sxs-lookup"><span data-stu-id="a1c87-269">If u were to implement hard lock-out countermeasures for this example you would achieve a "Dos" by permanently locking out accounts.</span></span> <span data-ttu-id="a1c87-270">或者，應用程式可產生 OTP (一次性密碼) 並以頻外方式 (透過電子郵件、簡訊等) 將它傳送給使用者。</span><span class="sxs-lookup"><span data-stu-id="a1c87-270">Alternatively, application may generate an OTP (One Time Password) and send it out-of-band (through email, sms etc.) to the user.</span></span> <span data-ttu-id="a1c87-271">另一種方法則是在達到嘗試失敗次數閾值之後，實作 CAPTCHA。</span><span class="sxs-lookup"><span data-stu-id="a1c87-271">Another approach may be to implement CAPTCHA after a threshold number of failed attempts is reached.</span></span></li><li><span data-ttu-id="a1c87-272">**硬式鎖定︰**每當您偵測到攻擊應用程式的使用者時，應套用這類型的鎖定，並透過永久鎖定其帳戶來對抗他，直到因應小組有時間進行鑑識為止。</span><span class="sxs-lookup"><span data-stu-id="a1c87-272">**Hard lock-out:** This type of lockout should be applied whenever you detect a user attacking your application and counter him by means of permanently locking out his account until a response team had time to do their forensics.</span></span> <span data-ttu-id="a1c87-273">在此程序之後，您可以決定將帳戶還給使用者，或採取進一步的法律動作來對抗他。</span><span class="sxs-lookup"><span data-stu-id="a1c87-273">After this process you can decide to give the user back his account or take further legal actions against him.</span></span> <span data-ttu-id="a1c87-274">這種方法可防止攻擊者進一步入侵您的應用程式和基礎結構。</span><span class="sxs-lookup"><span data-stu-id="a1c87-274">This type of approach prevents the attacker from further penetrating your application and infrastructure.</span></span></li></ul><p><span data-ttu-id="a1c87-275">若要防禦對於預設和可預測帳戶的攻擊，請確認所有金鑰和密碼均可取代，而且會在安裝階段後產生或取代。</span><span class="sxs-lookup"><span data-stu-id="a1c87-275">To defend against attacks on default and predictable accounts, verify that all keys and passwords are replaceable, and are generated or replaced after installation time.</span></span></p><p><span data-ttu-id="a1c87-276">如果應用程式必須自動產生密碼，請確保所產生的密碼是隨機的且具有高熵。</span><span class="sxs-lookup"><span data-stu-id="a1c87-276">If the application has to auto-generate passwords, ensure that the generated passwords are random and have high entropy.</span></span></p>|

## <span data-ttu-id="a1c87-277"><a id="controls-username-enum"></a>實作控制項以避免列舉使用者名稱</span><span class="sxs-lookup"><span data-stu-id="a1c87-277"><a id="controls-username-enum"></a>Implement controls to prevent username enumeration</span></span>

| <span data-ttu-id="a1c87-278">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-278">Title</span></span>                   | <span data-ttu-id="a1c87-279">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-279">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-280">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-280">**Component**</span></span>               | <span data-ttu-id="a1c87-281">Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="a1c87-281">Web Application</span></span> | 
| <span data-ttu-id="a1c87-282">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-282">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-283">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-283">Build</span></span> |  
| <span data-ttu-id="a1c87-284">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-284">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-285">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-285">Generic</span></span> |
| <span data-ttu-id="a1c87-286">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-286">**Attributes**</span></span>              | <span data-ttu-id="a1c87-287">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-287">N/A</span></span>  |
| <span data-ttu-id="a1c87-288">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-288">**References**</span></span>              | <span data-ttu-id="a1c87-289">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-289">N/A</span></span>  |
| <span data-ttu-id="a1c87-290">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-290">**Steps**</span></span> | <span data-ttu-id="a1c87-291">應將所有的錯誤訊息一般化，以避免列舉使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="a1c87-291">All error messages should be generalized in order to prevent username enumeration.</span></span> <span data-ttu-id="a1c87-292">而且，您有時無法避免註冊頁面等功能的資訊洩漏。</span><span class="sxs-lookup"><span data-stu-id="a1c87-292">Also sometimes you cannot avoid information leaking in functionalities such as a registration page.</span></span> <span data-ttu-id="a1c87-293">您需要使用 CAPTCHA 之類的速率限制方法，防止攻擊者的自動化攻擊。</span><span class="sxs-lookup"><span data-stu-id="a1c87-293">Here you need to use rate-limiting methods like CAPTCHA to prevent an automated attack by an attacker.</span></span> |

## <span data-ttu-id="a1c87-294"><a id="win-authn-sql"></a>可能的話，使用 Windows 驗證連線到 SQL Server</span><span class="sxs-lookup"><span data-stu-id="a1c87-294"><a id="win-authn-sql"></a>When possible, use Windows Authentication for connecting to SQL Server</span></span>

| <span data-ttu-id="a1c87-295">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-295">Title</span></span>                   | <span data-ttu-id="a1c87-296">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-296">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-297">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-297">**Component**</span></span>               | <span data-ttu-id="a1c87-298">資料庫</span><span class="sxs-lookup"><span data-stu-id="a1c87-298">Database</span></span> | 
| <span data-ttu-id="a1c87-299">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-299">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-300">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-300">Build</span></span> |  
| <span data-ttu-id="a1c87-301">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-301">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-302">OnPrem</span><span class="sxs-lookup"><span data-stu-id="a1c87-302">OnPrem</span></span> |
| <span data-ttu-id="a1c87-303">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-303">**Attributes**</span></span>              | <span data-ttu-id="a1c87-304">SQL 版本 - 全部</span><span class="sxs-lookup"><span data-stu-id="a1c87-304">SQL Version - All</span></span> |
| <span data-ttu-id="a1c87-305">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-305">**References**</span></span>              | [<span data-ttu-id="a1c87-306">SQL Server - 選擇驗證模式</span><span class="sxs-lookup"><span data-stu-id="a1c87-306">SQL Server - Choose an Authentication Mode</span></span>](https://msdn.microsoft.com/library/ms144284.aspx) |
| <span data-ttu-id="a1c87-307">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-307">**Steps**</span></span> | <span data-ttu-id="a1c87-308">Windows 驗證會使用 Kerberos 安全性通訊協定、提供與強式密碼複雜性驗證相關的密碼原則強制執行、提供帳戶鎖定支援，以及支援密碼到期。</span><span class="sxs-lookup"><span data-stu-id="a1c87-308">Windows Authentication uses Kerberos security protocol, provides password policy enforcement with regard to complexity validation for strong passwords, provides support for account lockout, and supports password expiration.</span></span>|

## <span data-ttu-id="a1c87-309"><a id="aad-authn-sql"></a>可能的話，使用 Azure Active Directory 驗證連線到 SQL Database</span><span class="sxs-lookup"><span data-stu-id="a1c87-309"><a id="aad-authn-sql"></a>When possible use Azure Active Directory Authentication for Connecting to SQL Database</span></span>

| <span data-ttu-id="a1c87-310">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-310">Title</span></span>                   | <span data-ttu-id="a1c87-311">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-311">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-312">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-312">**Component**</span></span>               | <span data-ttu-id="a1c87-313">資料庫</span><span class="sxs-lookup"><span data-stu-id="a1c87-313">Database</span></span> | 
| <span data-ttu-id="a1c87-314">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-314">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-315">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-315">Build</span></span> |  
| <span data-ttu-id="a1c87-316">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-316">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-317">SQL Azure</span><span class="sxs-lookup"><span data-stu-id="a1c87-317">SQL Azure</span></span> |
| <span data-ttu-id="a1c87-318">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-318">**Attributes**</span></span>              | <span data-ttu-id="a1c87-319">SQL 版本 - V12</span><span class="sxs-lookup"><span data-stu-id="a1c87-319">SQL Version - V12</span></span> |
| <span data-ttu-id="a1c87-320">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-320">**References**</span></span>              | [<span data-ttu-id="a1c87-321">使用 Azure Active Directory 驗證連線到 SQL Database</span><span class="sxs-lookup"><span data-stu-id="a1c87-321">Connecting to SQL Database By Using Azure Active Directory Authentication</span></span>](https://azure.microsoft.com/documentation/articles/sql-database-aad-authentication/) |
| <span data-ttu-id="a1c87-322">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-322">**Steps**</span></span> | <span data-ttu-id="a1c87-323">**最小版本︰**允許 Azure SQL Database 對 Microsoft 目錄使用 AAD 驗證所需的 Azure SQL Database V12</span><span class="sxs-lookup"><span data-stu-id="a1c87-323">**Minimum version:** Azure SQL Database V12 required to allow Azure SQL Database to use AAD Authentication against the Microsoft Directory</span></span> |

## <span data-ttu-id="a1c87-324"><a id="authn-account-pword"></a>使用 SQL 驗證模式時，確保在 SQL Server 上強制執行帳戶和密碼原則</span><span class="sxs-lookup"><span data-stu-id="a1c87-324"><a id="authn-account-pword"></a>When SQL authentication mode is used, ensure that account and password policy are enforced on SQL server</span></span>

| <span data-ttu-id="a1c87-325">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-325">Title</span></span>                   | <span data-ttu-id="a1c87-326">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-326">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-327">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-327">**Component**</span></span>               | <span data-ttu-id="a1c87-328">資料庫</span><span class="sxs-lookup"><span data-stu-id="a1c87-328">Database</span></span> | 
| <span data-ttu-id="a1c87-329">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-329">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-330">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-330">Build</span></span> |  
| <span data-ttu-id="a1c87-331">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-331">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-332">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-332">Generic</span></span> |
| <span data-ttu-id="a1c87-333">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-333">**Attributes**</span></span>              | <span data-ttu-id="a1c87-334">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-334">N/A</span></span>  |
| <span data-ttu-id="a1c87-335">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-335">**References**</span></span>              | <span data-ttu-id="a1c87-336">[SQL Server 密碼原則](https://technet.microsoft.com/library/ms161959(v=sql.110).aspx)</span><span class="sxs-lookup"><span data-stu-id="a1c87-336">[SQL Server password policy](https://technet.microsoft.com/library/ms161959(v=sql.110).aspx)</span></span> |
| <span data-ttu-id="a1c87-337">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-337">**Steps**</span></span> | <span data-ttu-id="a1c87-338">使用 SQL Server 驗證時，系統會在 SQL Server 中建立不是以 Windows 使用者帳戶為基礎的登入。</span><span class="sxs-lookup"><span data-stu-id="a1c87-338">When using SQL Server Authentication, logins are created in SQL Server that are not based on Windows user accounts.</span></span> <span data-ttu-id="a1c87-339">使用 SQL Server 建立使用者名稱和密碼並儲存在 SQL Server 中。</span><span class="sxs-lookup"><span data-stu-id="a1c87-339">Both the user name and the password are created by using SQL Server and stored in SQL Server.</span></span> <span data-ttu-id="a1c87-340">SQL Server 可以使用 Windows 密碼原則機制。</span><span class="sxs-lookup"><span data-stu-id="a1c87-340">SQL Server can use Windows password policy mechanisms.</span></span> <span data-ttu-id="a1c87-341">它可以將 Windows 中使用的相同複雜性和到期原則套用於 SQL Server 內部使用的密碼。</span><span class="sxs-lookup"><span data-stu-id="a1c87-341">It can apply the same complexity and expiration policies used in Windows to passwords used inside SQL Server.</span></span> |

## <span data-ttu-id="a1c87-342"><a id="autn-contained-db"></a>請勿在自主資料庫中使用 SQL 驗證</span><span class="sxs-lookup"><span data-stu-id="a1c87-342"><a id="autn-contained-db"></a>Do not use SQL Authentication in contained databases</span></span>

| <span data-ttu-id="a1c87-343">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-343">Title</span></span>                   | <span data-ttu-id="a1c87-344">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-344">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-345">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-345">**Component**</span></span>               | <span data-ttu-id="a1c87-346">資料庫</span><span class="sxs-lookup"><span data-stu-id="a1c87-346">Database</span></span> | 
| <span data-ttu-id="a1c87-347">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-347">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-348">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-348">Build</span></span> |  
| <span data-ttu-id="a1c87-349">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-349">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-350">Sql Azure、OnPrem</span><span class="sxs-lookup"><span data-stu-id="a1c87-350">OnPrem, SQL Azure</span></span> |
| <span data-ttu-id="a1c87-351">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-351">**Attributes**</span></span>              | <span data-ttu-id="a1c87-352">SQL 版本 - MSSQL2012、SQL 版本 - V12</span><span class="sxs-lookup"><span data-stu-id="a1c87-352">SQL Version - MSSQL2012, SQL Version - V12</span></span> |
| <span data-ttu-id="a1c87-353">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-353">**References**</span></span>              | [<span data-ttu-id="a1c87-354">自主資料庫的安全性最佳作法</span><span class="sxs-lookup"><span data-stu-id="a1c87-354">Security Best Practices with Contained Databases</span></span>](http://msdn.microsoft.com/library/ff929055.aspx) |
| <span data-ttu-id="a1c87-355">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-355">**Steps**</span></span> | <span data-ttu-id="a1c87-356">缺少強制執行的密碼原則，可能會增加在自主資料庫中建立弱式認證的可能性。</span><span class="sxs-lookup"><span data-stu-id="a1c87-356">The absence of an enforced password policy may increase the likelihood of a weak credential being established in a contained database.</span></span> <span data-ttu-id="a1c87-357">利用 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="a1c87-357">Leverage Windows Authentication.</span></span> |

## <span data-ttu-id="a1c87-358"><a id="authn-sas-tokens"></a>使用採用 SaS 權杖的每一裝置驗證認證</span><span class="sxs-lookup"><span data-stu-id="a1c87-358"><a id="authn-sas-tokens"></a>Use per device authentication credentials using SaS tokens</span></span>

| <span data-ttu-id="a1c87-359">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-359">Title</span></span>                   | <span data-ttu-id="a1c87-360">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-360">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-361">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-361">**Component**</span></span>               | <span data-ttu-id="a1c87-362">Azure 事件中樞</span><span class="sxs-lookup"><span data-stu-id="a1c87-362">Azure Event Hub</span></span> | 
| <span data-ttu-id="a1c87-363">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-363">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-364">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-364">Build</span></span> |  
| <span data-ttu-id="a1c87-365">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-365">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-366">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-366">Generic</span></span> |
| <span data-ttu-id="a1c87-367">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-367">**Attributes**</span></span>              | <span data-ttu-id="a1c87-368">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-368">N/A</span></span>  |
| <span data-ttu-id="a1c87-369">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-369">**References**</span></span>              | [<span data-ttu-id="a1c87-370">事件中樞驗證和安全性模型概觀</span><span class="sxs-lookup"><span data-stu-id="a1c87-370">Event Hubs authentication and security model overview</span></span>](https://azure.microsoft.com/documentation/articles/event-hubs-authentication-and-security-model-overview/) |
| <span data-ttu-id="a1c87-371">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-371">**Steps**</span></span> | <p><span data-ttu-id="a1c87-372">事件中樞安全性模型是以共用存取簽章 (SAS) 權杖和事件發佈者的組合為基礎。</span><span class="sxs-lookup"><span data-stu-id="a1c87-372">The Event Hubs security model is based on a combination of Shared Access Signature (SAS) tokens and event publishers.</span></span> <span data-ttu-id="a1c87-373">發佈者代表可接收權杖的 DeviceID。</span><span class="sxs-lookup"><span data-stu-id="a1c87-373">The publisher name represents the DeviceID that receives the token.</span></span> <span data-ttu-id="a1c87-374">這有助於讓所產生的權杖與個別的裝置建立關聯。</span><span class="sxs-lookup"><span data-stu-id="a1c87-374">This would help associate the tokens generated with the respective devices.</span></span></p><p><span data-ttu-id="a1c87-375">在允許偵測承載內部原始來源詐騙嘗試的服務端上，所有訊息都會標示建立者。</span><span class="sxs-lookup"><span data-stu-id="a1c87-375">All messages are tagged with originator on service side allowing detection of in-payload origin spoofing attempts.</span></span> <span data-ttu-id="a1c87-376">驗證裝置時，產生範圍限於唯一發佈者的每個裝置 SaS 權杖。</span><span class="sxs-lookup"><span data-stu-id="a1c87-376">When authenticating devices, generate a per device SaS token scoped to a unique publisher.</span></span></p>|

## <span data-ttu-id="a1c87-377"><a id="multi-factor-azure-admin"></a>啟用 Azure 系統管理員適用的 Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="a1c87-377"><a id="multi-factor-azure-admin"></a>Enable Azure Multi-Factor Authentication for Azure Administrators</span></span>

| <span data-ttu-id="a1c87-378">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-378">Title</span></span>                   | <span data-ttu-id="a1c87-379">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-379">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-380">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-380">**Component**</span></span>               | <span data-ttu-id="a1c87-381">Azure 信任邊界</span><span class="sxs-lookup"><span data-stu-id="a1c87-381">Azure Trust Boundary</span></span> | 
| <span data-ttu-id="a1c87-382">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-382">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-383">部署</span><span class="sxs-lookup"><span data-stu-id="a1c87-383">Deployment</span></span> |  
| <span data-ttu-id="a1c87-384">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-384">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-385">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-385">Generic</span></span> |
| <span data-ttu-id="a1c87-386">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-386">**Attributes**</span></span>              | <span data-ttu-id="a1c87-387">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-387">N/A</span></span>  |
| <span data-ttu-id="a1c87-388">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-388">**References**</span></span>              | [<span data-ttu-id="a1c87-389">什麼是 Azure Multi-Factor Authentication？</span><span class="sxs-lookup"><span data-stu-id="a1c87-389">What is Azure Multi-Factor Authentication?</span></span>](https://azure.microsoft.com/documentation/articles/multi-factor-authentication/) |
| <span data-ttu-id="a1c87-390">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-390">**Steps**</span></span> | <p><span data-ttu-id="a1c87-391">多因素驗證 (MFA) 是需要多種驗證方法，並在使用者登入和交易中新增重要的第二層安全性的驗證方法。</span><span class="sxs-lookup"><span data-stu-id="a1c87-391">Multi-factor authentication (MFA) is a method of authentication that requires more than one verification method and adds a critical second layer of security to user sign-ins and transactions.</span></span> <span data-ttu-id="a1c87-392">其運作方式需要下列其中任何二或多個驗證方法：</span><span class="sxs-lookup"><span data-stu-id="a1c87-392">It works by requiring any two or more of the following verification methods:</span></span></p><ul><li><span data-ttu-id="a1c87-393">您知道的某些資訊 (通常是密碼)</span><span class="sxs-lookup"><span data-stu-id="a1c87-393">Something you know (typically a password)</span></span></li><li><span data-ttu-id="a1c87-394">您擁有的某些東西 (不容易輕易複製的信任裝置，例如電話)</span><span class="sxs-lookup"><span data-stu-id="a1c87-394">Something you have (a trusted device that is not easily duplicated, like a phone)</span></span></li><li><span data-ttu-id="a1c87-395">您身上的某些特徵 (生物識別技術)</span><span class="sxs-lookup"><span data-stu-id="a1c87-395">Something you are (biometrics)</span></span></li><ul>|

## <span data-ttu-id="a1c87-396"><a id="anon-access-cluster"></a>限制 Service Fabric 叢集的匿名存取</span><span class="sxs-lookup"><span data-stu-id="a1c87-396"><a id="anon-access-cluster"></a>Restrict anonymous access to Service Fabric Cluster</span></span>

| <span data-ttu-id="a1c87-397">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-397">Title</span></span>                   | <span data-ttu-id="a1c87-398">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-398">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-399">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-399">**Component**</span></span>               | <span data-ttu-id="a1c87-400">Service Fabric 信任邊界</span><span class="sxs-lookup"><span data-stu-id="a1c87-400">Service Fabric Trust Boundary</span></span> | 
| <span data-ttu-id="a1c87-401">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-401">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-402">部署</span><span class="sxs-lookup"><span data-stu-id="a1c87-402">Deployment</span></span> |  
| <span data-ttu-id="a1c87-403">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-403">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-404">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-404">Generic</span></span> |
| <span data-ttu-id="a1c87-405">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-405">**Attributes**</span></span>              | <span data-ttu-id="a1c87-406">環境 - Azure</span><span class="sxs-lookup"><span data-stu-id="a1c87-406">Environment - Azure</span></span>  |
| <span data-ttu-id="a1c87-407">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-407">**References**</span></span>              | [<span data-ttu-id="a1c87-408">Service Fabric 叢集安全性案例</span><span class="sxs-lookup"><span data-stu-id="a1c87-408">Service Fabric cluster security scenarios</span></span>](https://azure.microsoft.com/documentation/articles/service-fabric-cluster-security) |
| <span data-ttu-id="a1c87-409">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-409">**Steps**</span></span> | <p><span data-ttu-id="a1c87-410">叢集應一律受到安全保護，以防止未經授權使用者連線您的叢集，特別是當叢集上有生產工作負載正在執行時。</span><span class="sxs-lookup"><span data-stu-id="a1c87-410">Clusters should always be secured to prevent unauthorized users from connecting to your cluster, especially when it has production workloads running on it.</span></span></p><p><span data-ttu-id="a1c87-411">建立 Service Fabric 叢集時，確保安全性模式設定為「安全」並設定必要的 X.509 伺服器憑證。</span><span class="sxs-lookup"><span data-stu-id="a1c87-411">While creating a service fabric cluster, ensure that the security mode is set to "secure" and configure the required X.509 server certificate.</span></span> <span data-ttu-id="a1c87-412">建立「不安全的」叢集將會在叢集向公用網際網路公開管理端點時，允許任何匿名使用者連線到叢集。</span><span class="sxs-lookup"><span data-stu-id="a1c87-412">Creating an "insecure" cluster will allow any anonymous user to connect to it if it exposes management endpoints to the public Internet.</span></span></p>|

## <span data-ttu-id="a1c87-413"><a id="fabric-cn-nn"></a>確保 Service Fabric 的用戶端對節點憑證不同於節點對節點憑證</span><span class="sxs-lookup"><span data-stu-id="a1c87-413"><a id="fabric-cn-nn"></a>Ensure that Service Fabric client-to-node certificate is different from node-to-node certificate</span></span>

| <span data-ttu-id="a1c87-414">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-414">Title</span></span>                   | <span data-ttu-id="a1c87-415">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-415">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-416">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-416">**Component**</span></span>               | <span data-ttu-id="a1c87-417">Service Fabric 信任邊界</span><span class="sxs-lookup"><span data-stu-id="a1c87-417">Service Fabric Trust Boundary</span></span> | 
| <span data-ttu-id="a1c87-418">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-418">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-419">部署</span><span class="sxs-lookup"><span data-stu-id="a1c87-419">Deployment</span></span> |  
| <span data-ttu-id="a1c87-420">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-420">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-421">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-421">Generic</span></span> |
| <span data-ttu-id="a1c87-422">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-422">**Attributes**</span></span>              | <span data-ttu-id="a1c87-423">環境 - Azure、環境 - 獨立</span><span class="sxs-lookup"><span data-stu-id="a1c87-423">Environment - Azure, Environment - Stand alone</span></span> |
| <span data-ttu-id="a1c87-424">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-424">**References**</span></span>              | <span data-ttu-id="a1c87-425">[Service Fabric 用戶端對節點憑證安全性](https://azure.microsoft.com/documentation/articles/service-fabric-cluster-security/#_client-to-node-certificate-security)、[使用用戶端憑證連線到安全的叢集](https://azure.microsoft.com/documentation/articles/service-fabric-connect-to-secure-cluster/)</span><span class="sxs-lookup"><span data-stu-id="a1c87-425">[Service Fabric Client-to-node certificate security](https://azure.microsoft.com/documentation/articles/service-fabric-cluster-security/#_client-to-node-certificate-security), [Connect to a secure cluster using client certificate](https://azure.microsoft.com/documentation/articles/service-fabric-connect-to-secure-cluster/)</span></span> |
| <span data-ttu-id="a1c87-426">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-426">**Steps**</span></span> | <p><span data-ttu-id="a1c87-427">用戶端對節點憑證安全性是在建立叢集 (透過 Azure 入口網站、Resource Manager 範本或 JSON 範本) 時，藉由指定系統管理用戶端憑證和 (或) 使用者用戶端憑證來設定的。</span><span class="sxs-lookup"><span data-stu-id="a1c87-427">Client-to-node certificate security is configured while creating the cluster either through the Azure portal, Resource Manager templates or a standalone JSON template by specifying an admin client certificate and/or a user client certificate.</span></span></p><p><span data-ttu-id="a1c87-428">您指定的系統管理用戶端憑證和使用者用戶端憑證，應該不同於您為節點對節點安全性指定的主要和次要憑證。</span><span class="sxs-lookup"><span data-stu-id="a1c87-428">The admin client and user client certificates you specify should be different than the primary and secondary certificates you specify for Node-to-node security.</span></span></p>|

## <span data-ttu-id="a1c87-429"><a id="aad-client-fabric"></a>使用 AAD 來向 Service Fabric 叢集驗證用戶端對</span><span class="sxs-lookup"><span data-stu-id="a1c87-429"><a id="aad-client-fabric"></a>Use AAD to authenticate clients to service fabric clusters</span></span>

| <span data-ttu-id="a1c87-430">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-430">Title</span></span>                   | <span data-ttu-id="a1c87-431">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-431">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-432">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-432">**Component**</span></span>               | <span data-ttu-id="a1c87-433">Service Fabric 信任邊界</span><span class="sxs-lookup"><span data-stu-id="a1c87-433">Service Fabric Trust Boundary</span></span> | 
| <span data-ttu-id="a1c87-434">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-434">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-435">部署</span><span class="sxs-lookup"><span data-stu-id="a1c87-435">Deployment</span></span> |  
| <span data-ttu-id="a1c87-436">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-436">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-437">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-437">Generic</span></span> |
| <span data-ttu-id="a1c87-438">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-438">**Attributes**</span></span>              | <span data-ttu-id="a1c87-439">環境 - Azure</span><span class="sxs-lookup"><span data-stu-id="a1c87-439">Environment - Azure</span></span> |
| <span data-ttu-id="a1c87-440">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-440">**References**</span></span>              | [<span data-ttu-id="a1c87-441">叢集安全性案例 - 安全性建議</span><span class="sxs-lookup"><span data-stu-id="a1c87-441">Cluster security scenarios - Security Recommendations</span></span>](https://azure.microsoft.com/documentation/articles/service-fabric-cluster-security/#security-recommendations) |
| <span data-ttu-id="a1c87-442">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-442">**Steps**</span></span> | <span data-ttu-id="a1c87-443">除了用戶端憑證，在 Azure 上執行的叢集也可以使用 Azure Active Directory (AAD) 來保護對管理端點的存取。</span><span class="sxs-lookup"><span data-stu-id="a1c87-443">Clusters running on Azure can also secure access to the management endpoints using Azure Active Directory (AAD), apart from client certificates.</span></span> <span data-ttu-id="a1c87-444">對於 Azure 叢集，建議您針對節點對節點安全性使用 AAD 安全性來驗證用戶端和憑證。</span><span class="sxs-lookup"><span data-stu-id="a1c87-444">For Azure clusters, it is recommended that you use AAD security to authenticate clients and certificates for node-to-node security.</span></span>|

## <span data-ttu-id="a1c87-445"><a id="fabric-cert-ca"></a>確保從經過核准的憑證授權單位 (CA) 取得 Service Fabric 憑證</span><span class="sxs-lookup"><span data-stu-id="a1c87-445"><a id="fabric-cert-ca"></a>Ensure that service fabric certificates are obtained from an approved Certificate Authority (CA)</span></span>

| <span data-ttu-id="a1c87-446">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-446">Title</span></span>                   | <span data-ttu-id="a1c87-447">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-447">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-448">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-448">**Component**</span></span>               | <span data-ttu-id="a1c87-449">Service Fabric 信任邊界</span><span class="sxs-lookup"><span data-stu-id="a1c87-449">Service Fabric Trust Boundary</span></span> | 
| <span data-ttu-id="a1c87-450">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-450">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-451">部署</span><span class="sxs-lookup"><span data-stu-id="a1c87-451">Deployment</span></span> |  
| <span data-ttu-id="a1c87-452">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-452">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-453">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-453">Generic</span></span> |
| <span data-ttu-id="a1c87-454">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-454">**Attributes**</span></span>              | <span data-ttu-id="a1c87-455">環境 - Azure</span><span class="sxs-lookup"><span data-stu-id="a1c87-455">Environment - Azure</span></span> |
| <span data-ttu-id="a1c87-456">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-456">**References**</span></span>              | [<span data-ttu-id="a1c87-457">X.509 憑證和 Service Fabric</span><span class="sxs-lookup"><span data-stu-id="a1c87-457">X.509 certificates and Service Fabric</span></span>](https://azure.microsoft.com/documentation/articles/service-fabric-cluster-security/#x509-certificates-and-service-fabric) |
| <span data-ttu-id="a1c87-458">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-458">**Steps**</span></span> | <p><span data-ttu-id="a1c87-459">Service Fabric 會使用 X.509 伺服器憑證驗證節點和用戶端。</span><span class="sxs-lookup"><span data-stu-id="a1c87-459">Service Fabric uses X.509 server certificates for authenticating nodes and clients.</span></span></p><p><span data-ttu-id="a1c87-460">在 Service Fabric 中使用憑證時，所需可量的一些重要事項︰</span><span class="sxs-lookup"><span data-stu-id="a1c87-460">Some important things to consider while using certificates in service fabrics:</span></span></p><ul><li><span data-ttu-id="a1c87-461">執行生產環境工作負載之叢集中所使用的憑證應該是使用已正確設定的 Windows Server 憑證服務來建立，或是從已核准的憑證授權單位 (CA) 取得。</span><span class="sxs-lookup"><span data-stu-id="a1c87-461">Certificates used in clusters running production workloads should be created by using a correctly configured Windows Server certificate service or obtained from an approved Certificate Authority (CA).</span></span> <span data-ttu-id="a1c87-462">CA 可以是已核准的外部 CA 或妥善管理的內部公開金鑰基礎結構 (PKI)</span><span class="sxs-lookup"><span data-stu-id="a1c87-462">The CA can be an approved external CA or a properly managed internal Public Key Infrastructure (PKI)</span></span></li><li><span data-ttu-id="a1c87-463">絕對不要在生產環境中使用以 MakeCert.exe 這類工具建立的暫時或測試憑證</span><span class="sxs-lookup"><span data-stu-id="a1c87-463">Never use any temporary or test certificates in production that are created with tools such as MakeCert.exe</span></span></li><li><span data-ttu-id="a1c87-464">您可以使用自我簽署憑證，但應該只用於測試叢集，不應該在生產環境中使用</span><span class="sxs-lookup"><span data-stu-id="a1c87-464">You can use a self-signed certificate, but should only do so for test clusters and not in production</span></span></li></ul>|

## <span data-ttu-id="a1c87-465"><a id="standard-authn-id"></a>使用 Identity Server 所支援的標準驗證案例</span><span class="sxs-lookup"><span data-stu-id="a1c87-465"><a id="standard-authn-id"></a>Use standard authentication scenarios supported by Identity Server</span></span>

| <span data-ttu-id="a1c87-466">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-466">Title</span></span>                   | <span data-ttu-id="a1c87-467">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-467">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-468">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-468">**Component**</span></span>               | <span data-ttu-id="a1c87-469">Identity Server</span><span class="sxs-lookup"><span data-stu-id="a1c87-469">Identity Server</span></span> | 
| <span data-ttu-id="a1c87-470">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-470">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-471">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-471">Build</span></span> |  
| <span data-ttu-id="a1c87-472">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-472">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-473">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-473">Generic</span></span> |
| <span data-ttu-id="a1c87-474">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-474">**Attributes**</span></span>              | <span data-ttu-id="a1c87-475">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-475">N/A</span></span>  |
| <span data-ttu-id="a1c87-476">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-476">**References**</span></span>              | [<span data-ttu-id="a1c87-477">IdentityServer3 - 概觀</span><span class="sxs-lookup"><span data-stu-id="a1c87-477">IdentityServer3 - The Big Picture</span></span>](https://identityserver.github.io/Documentation/docsv2/overview/bigPicture.html) |
| <span data-ttu-id="a1c87-478">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-478">**Steps**</span></span> | <p><span data-ttu-id="a1c87-479">以下是 Identity Server 支援的典型互動︰</span><span class="sxs-lookup"><span data-stu-id="a1c87-479">Below are the typical interactions supported by Identity Server:</span></span></p><ul><li><span data-ttu-id="a1c87-480">瀏覽器與 Web 應用程式通訊</span><span class="sxs-lookup"><span data-stu-id="a1c87-480">Browsers communicate with web applications</span></span></li><li><span data-ttu-id="a1c87-481">Web 應用程式與 Web API 通訊 (有時靠自己，有時代表使用者)</span><span class="sxs-lookup"><span data-stu-id="a1c87-481">Web applications communicate with web APIs (sometimes on their own, sometimes on behalf of a user)</span></span></li><li><span data-ttu-id="a1c87-482">瀏覽器架構應用程式與 Web API 通訊</span><span class="sxs-lookup"><span data-stu-id="a1c87-482">Browser-based applications communicate with web APIs</span></span></li><li><span data-ttu-id="a1c87-483">原生應用程式與 Web API 通訊</span><span class="sxs-lookup"><span data-stu-id="a1c87-483">Native applications communicate with web APIs</span></span></li><li><span data-ttu-id="a1c87-484">伺服器架構應用程式與 Web API 通訊</span><span class="sxs-lookup"><span data-stu-id="a1c87-484">Server-based applications communicate with web APIs</span></span></li><li><span data-ttu-id="a1c87-485">Web API 與 Web API 通訊 (有時靠自己，有時代表使用者)</span><span class="sxs-lookup"><span data-stu-id="a1c87-485">Web APIs communicate with web APIs (sometimes on their own, sometimes on behalf of a user)</span></span></li></ul>|

## <span data-ttu-id="a1c87-486"><a id="override-token"></a>以可調整的替代項目覆寫預設 Identity Server 權杖快取</span><span class="sxs-lookup"><span data-stu-id="a1c87-486"><a id="override-token"></a>Override the default Identity Server token cache with a scalable alternative</span></span>

| <span data-ttu-id="a1c87-487">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-487">Title</span></span>                   | <span data-ttu-id="a1c87-488">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-488">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-489">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-489">**Component**</span></span>               | <span data-ttu-id="a1c87-490">Identity Server</span><span class="sxs-lookup"><span data-stu-id="a1c87-490">Identity Server</span></span> | 
| <span data-ttu-id="a1c87-491">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-491">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-492">部署</span><span class="sxs-lookup"><span data-stu-id="a1c87-492">Deployment</span></span> |  
| <span data-ttu-id="a1c87-493">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-493">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-494">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-494">Generic</span></span> |
| <span data-ttu-id="a1c87-495">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-495">**Attributes**</span></span>              | <span data-ttu-id="a1c87-496">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-496">N/A</span></span>  |
| <span data-ttu-id="a1c87-497">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-497">**References**</span></span>              | [<span data-ttu-id="a1c87-498">Identity Server 部署 - 快取</span><span class="sxs-lookup"><span data-stu-id="a1c87-498">Identity Server Deployment - Caching</span></span>](https://identityserver.github.io/Documentation/docsv2/advanced/deployment.html) |
| <span data-ttu-id="a1c87-499">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-499">**Steps**</span></span> | <p><span data-ttu-id="a1c87-500">IdentityServer 已內建簡單的記憶體內部快取。</span><span class="sxs-lookup"><span data-stu-id="a1c87-500">IdentityServer has a simple built-in in-memory cache.</span></span> <span data-ttu-id="a1c87-501">雖然這適用於小規模原生應用程式，但不會針對中間層和後端應用程式進行調整，原因如下︰</span><span class="sxs-lookup"><span data-stu-id="a1c87-501">While this is good for small scale native apps, it does not scale for mid tier and backend applications for the following reasons:</span></span></p><ul><li><span data-ttu-id="a1c87-502">這些應用程式是由許多使用者同時存取。</span><span class="sxs-lookup"><span data-stu-id="a1c87-502">These applications are accessed by many users at once.</span></span> <span data-ttu-id="a1c87-503">在相同存放區中儲存所有的存取權杖會在大規模運作時產生隔離問題並帶來挑戰︰許多使用者 (各自有許多權杖) 的數字和代價很高的查閱作業，可能表示許多使用者，每個都有最多的語彙基元為代表他們執行的應用程式存取的資源</span><span class="sxs-lookup"><span data-stu-id="a1c87-503">Saving all access tokens in the same store creates isolation issues and presents challenges when operating at scale: many users, each with as many tokens as the resources the app accesses on their behalf, can mean huge numbers and very expensive lookup operations</span></span></li><li><span data-ttu-id="a1c87-504">這些應用程式通常會部署在分散式拓撲上，其中多個節點必須存取相同的快取</span><span class="sxs-lookup"><span data-stu-id="a1c87-504">These applications are typically deployed on distributed topologies, where multiple nodes must have access to the same cache</span></span></li><li><span data-ttu-id="a1c87-505">快取的權杖必須在程序回收和停用後存留下來</span><span class="sxs-lookup"><span data-stu-id="a1c87-505">Cached tokens must survive process recycles and deactivations</span></span></li><li><span data-ttu-id="a1c87-506">基於上述原因，實作 Web 應用程式時，建議以可調整的替代項目 (例如 Azure Redis 快取) 覆寫預設 Identity Server 的權杖快取</span><span class="sxs-lookup"><span data-stu-id="a1c87-506">For all the above reasons, while implementing web apps, it is recommended to override the default Identity Server's token cache with a scalable alternative such as Azure Redis cache</span></span></li></ul>|

## <span data-ttu-id="a1c87-507"><a id="binaries-signed"></a>確保已數位簽署所部署應用程式的二進位檔</span><span class="sxs-lookup"><span data-stu-id="a1c87-507"><a id="binaries-signed"></a>Ensure that deployed application's binaries are digitally signed</span></span>

| <span data-ttu-id="a1c87-508">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-508">Title</span></span>                   | <span data-ttu-id="a1c87-509">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-509">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-510">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-510">**Component**</span></span>               | <span data-ttu-id="a1c87-511">電腦信任邊界</span><span class="sxs-lookup"><span data-stu-id="a1c87-511">Machine Trust Boundary</span></span> | 
| <span data-ttu-id="a1c87-512">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-512">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-513">部署</span><span class="sxs-lookup"><span data-stu-id="a1c87-513">Deployment</span></span> |  
| <span data-ttu-id="a1c87-514">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-514">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-515">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-515">Generic</span></span> |
| <span data-ttu-id="a1c87-516">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-516">**Attributes**</span></span>              | <span data-ttu-id="a1c87-517">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-517">N/A</span></span>  |
| <span data-ttu-id="a1c87-518">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-518">**References**</span></span>              | <span data-ttu-id="a1c87-519">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-519">N/A</span></span>  |
| <span data-ttu-id="a1c87-520">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-520">**Steps**</span></span> | <span data-ttu-id="a1c87-521">確保已數位簽署所部署應用程式的二進位檔，以便驗證二進位檔的完整性</span><span class="sxs-lookup"><span data-stu-id="a1c87-521">Ensure that deployed application's binaries are digitally signed so that the integrity of the binaries can be verified</span></span>|

## <span data-ttu-id="a1c87-522"><a id="msmq-queues"></a>在連線到 WCF 中的 MSMQ 佇列時啟用驗證</span><span class="sxs-lookup"><span data-stu-id="a1c87-522"><a id="msmq-queues"></a>Enable authentication when connecting to MSMQ queues in WCF</span></span>

| <span data-ttu-id="a1c87-523">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-523">Title</span></span>                   | <span data-ttu-id="a1c87-524">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-524">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-525">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-525">**Component**</span></span>               | <span data-ttu-id="a1c87-526">WCF</span><span class="sxs-lookup"><span data-stu-id="a1c87-526">WCF</span></span> | 
| <span data-ttu-id="a1c87-527">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-527">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-528">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-528">Build</span></span> |  
| <span data-ttu-id="a1c87-529">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-529">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-530">泛型、NET Framework 3</span><span class="sxs-lookup"><span data-stu-id="a1c87-530">Generic, NET Framework 3</span></span> |
| <span data-ttu-id="a1c87-531">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-531">**Attributes**</span></span>              | <span data-ttu-id="a1c87-532">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-532">N/A</span></span> |
| <span data-ttu-id="a1c87-533">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-533">**References**</span></span>              | [<span data-ttu-id="a1c87-534">MSDN</span><span class="sxs-lookup"><span data-stu-id="a1c87-534">MSDN</span></span>](https://msdn.microsoft.com/library/ff648500.aspx) |
| <span data-ttu-id="a1c87-535">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-535">**Steps**</span></span> | <span data-ttu-id="a1c87-536">程式無法在連線到 MSMQ 佇列時啟用驗證，攻擊者可能會以匿名方式將訊息提交至佇列進行處理。</span><span class="sxs-lookup"><span data-stu-id="a1c87-536">Program fails to enable authentication when connecting to MSMQ queues, an attacker can anonymously submit messages to the queue for processing.</span></span> <span data-ttu-id="a1c87-537">如果未使用驗證來連線到用來將訊息傳遞至另一個程式的 MSMQ 佇列，攻擊者可能會提交惡意的匿名訊息。</span><span class="sxs-lookup"><span data-stu-id="a1c87-537">If authentication is not used to connect to an MSMQ queue used to deliver a message to another program, an attacker could submit an anonymous message that is malicious.</span></span>|

### <a name="example"></a><span data-ttu-id="a1c87-538">範例</span><span class="sxs-lookup"><span data-stu-id="a1c87-538">Example</span></span>
<span data-ttu-id="a1c87-539">以下 WCF 組態檔的 `<netMsmqBinding/>` 元素會指示 WCF 在連線到 MSMQ 佇列進行訊息傳遞時停用驗證。</span><span class="sxs-lookup"><span data-stu-id="a1c87-539">The `<netMsmqBinding/>` element of the WCF configuration file below instructs WCF to disable authentication when connecting to an MSMQ queue for message delivery.</span></span>
```
<bindings>
    <netMsmqBinding>
        <binding>
            <security>
                <transport msmqAuthenticationMode=""None"" />
            </security>
        </binding>
    </netMsmqBinding>
</bindings>
```
<span data-ttu-id="a1c87-540">將 MSMQ 設定為隨時需要 Windows 網域或憑證驗證才能處理傳入或傳出訊息。</span><span class="sxs-lookup"><span data-stu-id="a1c87-540">Configure MSMQ to require Windows Domain or Certificate authentication at all times for any incoming or outgoing messages.</span></span>

### <a name="example"></a><span data-ttu-id="a1c87-541">範例</span><span class="sxs-lookup"><span data-stu-id="a1c87-541">Example</span></span>
<span data-ttu-id="a1c87-542">以下 WCF 組態檔的 `<netMsmqBinding/>` 元素會指示 WCF 在連線到 MSMQ 佇列時啟用憑證驗證。</span><span class="sxs-lookup"><span data-stu-id="a1c87-542">The `<netMsmqBinding/>` element of the WCF configuration file below instructs WCF to enable certificate authentication when connecting to an MSMQ queue.</span></span> <span data-ttu-id="a1c87-543">用戶端會使用 X.509 憑證進行驗證。</span><span class="sxs-lookup"><span data-stu-id="a1c87-543">The client is authenticated using X.509 certificates.</span></span> <span data-ttu-id="a1c87-544">用戶端憑證必須存在於伺服器的憑證存放區。</span><span class="sxs-lookup"><span data-stu-id="a1c87-544">The client certificate must be present in the certificate store of the server.</span></span>
```
<bindings>
    <netMsmqBinding>
        <binding>
            <security>
                <transport msmqAuthenticationMode=""Certificate"" />
            </security>
        </binding>
    </netMsmqBinding>
</bindings>
```

## <span data-ttu-id="a1c87-545"><a id="message-none"></a>WCF - 請勿將訊息 clientCredentialType 設定為 none</span><span class="sxs-lookup"><span data-stu-id="a1c87-545"><a id="message-none"></a>WCF-Do not set Message clientCredentialType to none</span></span>

| <span data-ttu-id="a1c87-546">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-546">Title</span></span>                   | <span data-ttu-id="a1c87-547">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-547">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-548">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-548">**Component**</span></span>               | <span data-ttu-id="a1c87-549">WCF</span><span class="sxs-lookup"><span data-stu-id="a1c87-549">WCF</span></span> | 
| <span data-ttu-id="a1c87-550">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-550">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-551">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-551">Build</span></span> |  
| <span data-ttu-id="a1c87-552">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-552">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-553">.NET Framework 3</span><span class="sxs-lookup"><span data-stu-id="a1c87-553">.NET Framework 3</span></span> |
| <span data-ttu-id="a1c87-554">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-554">**Attributes**</span></span>              | <span data-ttu-id="a1c87-555">用戶端認證類型 - None</span><span class="sxs-lookup"><span data-stu-id="a1c87-555">Client Credential Type - None</span></span> |
| <span data-ttu-id="a1c87-556">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-556">**References**</span></span>              | <span data-ttu-id="a1c87-557">[MSDN](https://msdn.microsoft.com/library/ff648500.aspx)、[Fortify](https://vulncat.fortify.com/en/vulncat/index.html)</span><span class="sxs-lookup"><span data-stu-id="a1c87-557">[MSDN](https://msdn.microsoft.com/library/ff648500.aspx), [Fortify](https://vulncat.fortify.com/en/vulncat/index.html)</span></span> |
| <span data-ttu-id="a1c87-558">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-558">**Steps**</span></span> | <span data-ttu-id="a1c87-559">缺少驗證表示每個人都能夠存取此服務。</span><span class="sxs-lookup"><span data-stu-id="a1c87-559">The absence of authentication means everyone is able to access this service.</span></span> <span data-ttu-id="a1c87-560">不會驗證其用戶端的服務可允許所有使用者進行存取。</span><span class="sxs-lookup"><span data-stu-id="a1c87-560">A service that does not authenticate its clients allows access to all users.</span></span> <span data-ttu-id="a1c87-561">設定應用程式以針對用戶端認證進行驗證。</span><span class="sxs-lookup"><span data-stu-id="a1c87-561">Configure the application to authenticate against client credentials.</span></span> <span data-ttu-id="a1c87-562">將訊息 clientCredentialType 設定為 Windows 或 [憑證] 即可完成此作業。</span><span class="sxs-lookup"><span data-stu-id="a1c87-562">This can be done by setting the message clientCredentialType to Windows or Certificate.</span></span> |

### <a name="example"></a><span data-ttu-id="a1c87-563">範例</span><span class="sxs-lookup"><span data-stu-id="a1c87-563">Example</span></span>
```
<message clientCredentialType=""Certificate""/>
```

## <span data-ttu-id="a1c87-564"><a id="transport-none"></a>WCF - 請勿將傳輸 clientCredentialType 設定為 none</span><span class="sxs-lookup"><span data-stu-id="a1c87-564"><a id="transport-none"></a>WCF-Do not set Transport clientCredentialType to none</span></span>

| <span data-ttu-id="a1c87-565">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-565">Title</span></span>                   | <span data-ttu-id="a1c87-566">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-566">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-567">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-567">**Component**</span></span>               | <span data-ttu-id="a1c87-568">WCF</span><span class="sxs-lookup"><span data-stu-id="a1c87-568">WCF</span></span> | 
| <span data-ttu-id="a1c87-569">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-569">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-570">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-570">Build</span></span> |  
| <span data-ttu-id="a1c87-571">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-571">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-572">泛型、.NET Framework 3</span><span class="sxs-lookup"><span data-stu-id="a1c87-572">Generic, .NET Framework 3</span></span> |
| <span data-ttu-id="a1c87-573">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-573">**Attributes**</span></span>              | <span data-ttu-id="a1c87-574">用戶端認證類型 - None</span><span class="sxs-lookup"><span data-stu-id="a1c87-574">Client Credential Type - None</span></span> |
| <span data-ttu-id="a1c87-575">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-575">**References**</span></span>              | <span data-ttu-id="a1c87-576">[MSDN](https://msdn.microsoft.com/library/ff648500.aspx)、[Fortify](https://vulncat.fortify.com/en/vulncat/index.html)</span><span class="sxs-lookup"><span data-stu-id="a1c87-576">[MSDN](https://msdn.microsoft.com/library/ff648500.aspx), [Fortify](https://vulncat.fortify.com/en/vulncat/index.html)</span></span> |
| <span data-ttu-id="a1c87-577">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-577">**Steps**</span></span> | <span data-ttu-id="a1c87-578">缺少驗證表示每個人都能夠存取此服務。</span><span class="sxs-lookup"><span data-stu-id="a1c87-578">The absence of authentication means everyone is able to access this service.</span></span> <span data-ttu-id="a1c87-579">不會驗證其用戶端的服務可允許所有使用者存取其功能。</span><span class="sxs-lookup"><span data-stu-id="a1c87-579">A service that does not authenticate its clients allows all users to access its functionality.</span></span> <span data-ttu-id="a1c87-580">設定應用程式以針對用戶端認證進行驗證。</span><span class="sxs-lookup"><span data-stu-id="a1c87-580">Configure the application to authenticate against client credentials.</span></span> <span data-ttu-id="a1c87-581">將傳輸 clientCredentialType 設定為 Windows 或 [憑證] 即可完成此作業。</span><span class="sxs-lookup"><span data-stu-id="a1c87-581">This can be done by setting the transport clientCredentialType to Windows or Certificate.</span></span> |

### <a name="example"></a><span data-ttu-id="a1c87-582">範例</span><span class="sxs-lookup"><span data-stu-id="a1c87-582">Example</span></span>
```
<transport clientCredentialType=""Certificate""/>
```

## <span data-ttu-id="a1c87-583"><a id="authn-secure-api"></a>確保使用標準驗證技術來保護 Web API</span><span class="sxs-lookup"><span data-stu-id="a1c87-583"><a id="authn-secure-api"></a>Ensure that standard authentication techniques are used to secure Web APIs</span></span>

| <span data-ttu-id="a1c87-584">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-584">Title</span></span>                   | <span data-ttu-id="a1c87-585">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-585">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-586">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-586">**Component**</span></span>               | <span data-ttu-id="a1c87-587">Web API</span><span class="sxs-lookup"><span data-stu-id="a1c87-587">Web API</span></span> | 
| <span data-ttu-id="a1c87-588">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-588">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-589">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-589">Build</span></span> |  
| <span data-ttu-id="a1c87-590">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-590">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-591">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-591">Generic</span></span> |
| <span data-ttu-id="a1c87-592">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-592">**Attributes**</span></span>              | <span data-ttu-id="a1c87-593">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-593">N/A</span></span>  |
| <span data-ttu-id="a1c87-594">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-594">**References**</span></span>              | <span data-ttu-id="a1c87-595">[ASP.NET Web API 中的驗證和授權](http://www.asp.net/web-api/overview/security/authentication-and-authorization-in-aspnet-web-api)、[外部驗證服務與 ASP.NET Web API (C#)](http://www.asp.net/web-api/overview/security/external-authentication-services)</span><span class="sxs-lookup"><span data-stu-id="a1c87-595">[Authentication and Authorization in ASP.NET Web API](http://www.asp.net/web-api/overview/security/authentication-and-authorization-in-aspnet-web-api), [External Authentication Services with ASP.NET Web API (C#)](http://www.asp.net/web-api/overview/security/external-authentication-services)</span></span> |
| <span data-ttu-id="a1c87-596">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-596">**Steps**</span></span> | <p><span data-ttu-id="a1c87-597">驗證是實體證明其身分識別的程序 (通常透過使用者名稱和密碼等認證)。</span><span class="sxs-lookup"><span data-stu-id="a1c87-597">Authentication is the process where an entity proves its identity, typically through credentials, such as a user name and password.</span></span> <span data-ttu-id="a1c87-598">有多個驗證通訊協定可列入考量。</span><span class="sxs-lookup"><span data-stu-id="a1c87-598">There are multiple authentication protocols available which may be considered.</span></span> <span data-ttu-id="a1c87-599">下列是其中一些通訊協定︰</span><span class="sxs-lookup"><span data-stu-id="a1c87-599">Some of them are listed below:</span></span></p><ul><li><span data-ttu-id="a1c87-600">Client certificates</span><span class="sxs-lookup"><span data-stu-id="a1c87-600">Client certificates</span></span></li><li><span data-ttu-id="a1c87-601">Windows 架構</span><span class="sxs-lookup"><span data-stu-id="a1c87-601">Windows based</span></span></li><li><span data-ttu-id="a1c87-602">表單架構</span><span class="sxs-lookup"><span data-stu-id="a1c87-602">Forms based</span></span></li><li><span data-ttu-id="a1c87-603">同盟 - ADFS</span><span class="sxs-lookup"><span data-stu-id="a1c87-603">Federation - ADFS</span></span></li><li><span data-ttu-id="a1c87-604">同盟 - Azure AD</span><span class="sxs-lookup"><span data-stu-id="a1c87-604">Federation - Azure AD</span></span></li><li><span data-ttu-id="a1c87-605">同盟 - Identity Server</span><span class="sxs-lookup"><span data-stu-id="a1c87-605">Federation - Identity Server</span></span></li></ul><p><span data-ttu-id="a1c87-606">[參考] 區段中的連結提供如何實作每個驗證方案來保護 Web API 的低階詳細資料。</span><span class="sxs-lookup"><span data-stu-id="a1c87-606">Links in the references section provide low-level details on how each of the authentication schemes can be implemented to secure a Web API.</span></span></p>|

## <span data-ttu-id="a1c87-607"><a id="authn-aad"></a>使用 Azure Active Directory 所支援的標準驗證案例</span><span class="sxs-lookup"><span data-stu-id="a1c87-607"><a id="authn-aad"></a>Use standard authentication scenarios supported by Azure Active Directory</span></span>

| <span data-ttu-id="a1c87-608">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-608">Title</span></span>                   | <span data-ttu-id="a1c87-609">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-609">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-610">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-610">**Component**</span></span>               | <span data-ttu-id="a1c87-611">Azure AD</span><span class="sxs-lookup"><span data-stu-id="a1c87-611">Azure AD</span></span> | 
| <span data-ttu-id="a1c87-612">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-612">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-613">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-613">Build</span></span> |  
| <span data-ttu-id="a1c87-614">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-614">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-615">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-615">Generic</span></span> |
| <span data-ttu-id="a1c87-616">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-616">**Attributes**</span></span>              | <span data-ttu-id="a1c87-617">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-617">N/A</span></span>  |
| <span data-ttu-id="a1c87-618">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-618">**References**</span></span>              | <span data-ttu-id="a1c87-619">[Azure AD 的驗證案例](https://azure.microsoft.com/documentation/articles/active-directory-authentication-scenarios/)、[Azure Active Directory 程式碼範例](https://azure.microsoft.com/documentation/articles/active-directory-code-samples/)、[Azure Active Directory 開發人員指南](https://azure.microsoft.com/documentation/articles/active-directory-developers-guide/)</span><span class="sxs-lookup"><span data-stu-id="a1c87-619">[Authentication Scenarios for Azure AD](https://azure.microsoft.com/documentation/articles/active-directory-authentication-scenarios/), [Azure Active Directory Code Samples](https://azure.microsoft.com/documentation/articles/active-directory-code-samples/), [Azure Active Directory developer's guide](https://azure.microsoft.com/documentation/articles/active-directory-developers-guide/)</span></span> |
| <span data-ttu-id="a1c87-620">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-620">**Steps**</span></span> | <p><span data-ttu-id="a1c87-621">Azure Active Directory (Azure AD) 提供身分識別做為服務，支援業界標準通訊協定 (例如 OAuth 2.0 和 OpenID Connect)，以簡化開發人員的驗證工作。</span><span class="sxs-lookup"><span data-stu-id="a1c87-621">Azure Active Directory (Azure AD) simplifies authentication for developers by providing identity as a service, with support for industry-standard protocols such as OAuth 2.0 and OpenID Connect.</span></span> <span data-ttu-id="a1c87-622">以下是 Azure AD 支援的五個主要應用程式案例：</span><span class="sxs-lookup"><span data-stu-id="a1c87-622">Below are the five primary application scenarios supported by Azure AD:</span></span></p><ul><li><span data-ttu-id="a1c87-623">Web 瀏覽器到 Web 應用程式：使用者需要登入 Azure AD 所保護的 Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="a1c87-623">Web Browser to Web Application: A user needs to sign in to a web application that is secured by Azure AD</span></span></li><li><span data-ttu-id="a1c87-624">單一頁面應用程式 (SPA)：使用者需要登入 Azure AD 所保護的單一頁面應用程式</span><span class="sxs-lookup"><span data-stu-id="a1c87-624">Single Page Application (SPA): A user needs to sign in to a single page application that is secured by Azure AD</span></span></li><li><span data-ttu-id="a1c87-625">原生應用程式到 Web API：在電話、平板電腦或電腦執行的原生應用程式需要驗證使用者，以便從 Azure AD 所保護的 Web API 取得資源</span><span class="sxs-lookup"><span data-stu-id="a1c87-625">Native Application to Web API: A native application that runs on a phone, tablet, or PC needs to authenticate a user to get resources from a web API that is secured by Azure AD</span></span></li><li><span data-ttu-id="a1c87-626">Web 應用程式到 Web API：Web 應用程式需要從 Azure AD 所保護的 Web API 取得資源</span><span class="sxs-lookup"><span data-stu-id="a1c87-626">Web Application to Web API: A web application needs to get resources from a web API secured by Azure AD</span></span></li><li><span data-ttu-id="a1c87-627">Daemon 或伺服器應用程式到 Web API：無 Web 使用者介面的 Daemon 應用程式或伺服器應用程式，需要從 Azure AD 所保護的 Web API 取得資源</span><span class="sxs-lookup"><span data-stu-id="a1c87-627">Daemon or Server Application to Web API: A daemon application or a server application with no web user interface needs to get resources from a web API secured by Azure AD</span></span></li></ul><p><span data-ttu-id="a1c87-628">請參閱 [參考] 區段中的連結，以取得低階實作詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-628">Please refer to the links in the references section for low-level implementation details</span></span></p>|

## <span data-ttu-id="a1c87-629"><a id="adal-scalable"></a>以可調整的替代項目覆寫預設 ADAL 權杖快取</span><span class="sxs-lookup"><span data-stu-id="a1c87-629"><a id="adal-scalable"></a>Override the default ADAL token cache with a scalable alternative</span></span>

| <span data-ttu-id="a1c87-630">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-630">Title</span></span>                   | <span data-ttu-id="a1c87-631">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-631">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-632">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-632">**Component**</span></span>               | <span data-ttu-id="a1c87-633">Azure AD</span><span class="sxs-lookup"><span data-stu-id="a1c87-633">Azure AD</span></span> | 
| <span data-ttu-id="a1c87-634">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-634">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-635">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-635">Build</span></span> |  
| <span data-ttu-id="a1c87-636">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-636">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-637">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-637">Generic</span></span> |
| <span data-ttu-id="a1c87-638">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-638">**Attributes**</span></span>              | <span data-ttu-id="a1c87-639">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-639">N/A</span></span>  |
| <span data-ttu-id="a1c87-640">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-640">**References**</span></span>              | <span data-ttu-id="a1c87-641">[Modern Authentication with Azure Active Directory for Web Applications](https://blogs.msdn.microsoft.com/microsoft_press/2016/01/04/new-book-modern-authentication-with-azure-active-directory-for-web-applications/)、[使用 Redis 作為 ADAL 權杖快取](https://blogs.msdn.microsoft.com/mrochon/2016/09/19/using-redis-as-adal-token-cache/)</span><span class="sxs-lookup"><span data-stu-id="a1c87-641">[Modern Authentication with Azure Active Directory for Web Applications](https://blogs.msdn.microsoft.com/microsoft_press/2016/01/04/new-book-modern-authentication-with-azure-active-directory-for-web-applications/), [Using Redis as ADAL token cache](https://blogs.msdn.microsoft.com/mrochon/2016/09/19/using-redis-as-adal-token-cache/)</span></span>  |
| <span data-ttu-id="a1c87-642">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-642">**Steps**</span></span> | <p><span data-ttu-id="a1c87-643">ADAL (Active Directory 驗證程式庫) 使用的預設快取是依賴靜態存放區、整個程序可用的記憶體內部快取。</span><span class="sxs-lookup"><span data-stu-id="a1c87-643">The default cache that ADAL (Active Directory Authentication Library) uses is an in-memory cache that relies on a static store, available process-wide.</span></span> <span data-ttu-id="a1c87-644">雖然這適用於原生應用程式，但不會針對中間層和後端應用程式進行調整，原因如下︰</span><span class="sxs-lookup"><span data-stu-id="a1c87-644">While this works for native applications, it does not scale for mid tier and backend applications for the following reasons:</span></span></p><ul><li><span data-ttu-id="a1c87-645">這些應用程式是由許多使用者同時存取。</span><span class="sxs-lookup"><span data-stu-id="a1c87-645">These applications are accessed by many users at once.</span></span> <span data-ttu-id="a1c87-646">在相同存放區中儲存所有的存取權杖會在大規模運作時產生隔離問題並帶來挑戰︰許多使用者 (各自有許多權杖) 的數字和代價很高的查閱作業，可能表示許多使用者，每個都有最多的語彙基元為代表他們執行的應用程式存取的資源</span><span class="sxs-lookup"><span data-stu-id="a1c87-646">Saving all access tokens in the same store creates isolation issues and presents challenges when operating at scale: many users, each with as many tokens as the resources the app accesses on their behalf, can mean huge numbers and very expensive lookup operations</span></span></li><li><span data-ttu-id="a1c87-647">這些應用程式通常會部署在分散式拓撲上，其中多個節點必須存取相同的快取</span><span class="sxs-lookup"><span data-stu-id="a1c87-647">These applications are typically deployed on distributed topologies, where multiple nodes must have access to the same cache</span></span></li><li><span data-ttu-id="a1c87-648">快取的權杖必須在程序回收和停用後存留下來</span><span class="sxs-lookup"><span data-stu-id="a1c87-648">Cached tokens must survive process recycles and deactivations</span></span></li></ul><p><span data-ttu-id="a1c87-649">基於上述原因，實作 Web 應用程式時，建議以可調整的替代項目 (例如 Azure Redis 快取) 覆寫預設 ADAL 權杖快取。</span><span class="sxs-lookup"><span data-stu-id="a1c87-649">For all the above reasons, while implementing web apps, it is recommended to override the default ADAL token cache with a scalable alternative such as Azure Redis cache.</span></span></p>|

## <span data-ttu-id="a1c87-650"><a id="tokenreplaycache-adal"></a>確保使用 TokenReplayCache 來防止重新執行 ADAL 驗證權杖</span><span class="sxs-lookup"><span data-stu-id="a1c87-650"><a id="tokenreplaycache-adal"></a>Ensure that TokenReplayCache is used to prevent the replay of ADAL authentication tokens</span></span>

| <span data-ttu-id="a1c87-651">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-651">Title</span></span>                   | <span data-ttu-id="a1c87-652">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-652">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-653">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-653">**Component**</span></span>               | <span data-ttu-id="a1c87-654">Azure AD</span><span class="sxs-lookup"><span data-stu-id="a1c87-654">Azure AD</span></span> | 
| <span data-ttu-id="a1c87-655">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-655">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-656">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-656">Build</span></span> |  
| <span data-ttu-id="a1c87-657">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-657">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-658">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-658">Generic</span></span> |
| <span data-ttu-id="a1c87-659">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-659">**Attributes**</span></span>              | <span data-ttu-id="a1c87-660">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-660">N/A</span></span>  |
| <span data-ttu-id="a1c87-661">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-661">**References**</span></span>              | [<span data-ttu-id="a1c87-662">Modern Authentication with Azure Active Directory for Web Applications</span><span class="sxs-lookup"><span data-stu-id="a1c87-662">Modern Authentication with Azure Active Directory for Web Applications</span></span>](https://blogs.msdn.microsoft.com/microsoft_press/2016/01/04/new-book-modern-authentication-with-azure-active-directory-for-web-applications/) |
| <span data-ttu-id="a1c87-663">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-663">**Steps**</span></span> | <p><span data-ttu-id="a1c87-664">TokenReplayCache 屬性可讓開發人員為了確認沒有權杖可使用一次以上，而定義權杖重新執行快取以及可用來儲存權杖的存放區。</span><span class="sxs-lookup"><span data-stu-id="a1c87-664">The TokenReplayCache property allows developers to define a token replay cache, a store that can be used for saving tokens for the purpose of verifying that no token can be used more than once.</span></span></p><p><span data-ttu-id="a1c87-665">這是對抗常見攻擊 (恰如其名的權杖重新執行攻擊) 的措施︰攔截登入時所傳送權杖的攻擊者可能會試著將權杖再次傳送至應用程式 (「重新執行」它)，以便建立新的工作階段。</span><span class="sxs-lookup"><span data-stu-id="a1c87-665">This is a measure against a common attack, the aptly called token replay attack: an attacker intercepting the token sent at sign-in might try to send it to the app again (“replay” it) for establishing a new session.</span></span> <span data-ttu-id="a1c87-666">例如，在 OIDC 程式碼授與流程中，使用者驗證成功後，對信賴憑證者之 "/signin-oidc" 端點的要求是由 "id_token"、"code" 和 "state" 參數所構成。</span><span class="sxs-lookup"><span data-stu-id="a1c87-666">E.g., In OIDC code-grant flow, after successful user authentication, a request to "/signin-oidc" endpoint of the relying party is made with "id_token", "code" and "state" parameters.</span></span></p><p><span data-ttu-id="a1c87-667">信賴憑證者會驗證此要求並建立新的工作階段。</span><span class="sxs-lookup"><span data-stu-id="a1c87-667">The relying party validates this request and establishes a new session.</span></span> <span data-ttu-id="a1c87-668">如果敵人擷取此要求並重新執行它，敵人即可建立成功的工作階段並欺騙使用者。</span><span class="sxs-lookup"><span data-stu-id="a1c87-668">If an adversary captures this request and replays it, he/she can establish a successful session and spoof the user.</span></span> <span data-ttu-id="a1c87-669">OpenID Connect 中存在的 nonce 可以限制，但未完全消除可成功發動攻擊的情況。</span><span class="sxs-lookup"><span data-stu-id="a1c87-669">The presence of the nonce in OpenID Connect can limit but not fully eliminate the circumstances in which the attack can be successfully enacted.</span></span> <span data-ttu-id="a1c87-670">若要保護其應用程式，開發人員可以提供 ITokenReplayCache 的實作，並將執行個體指派給 TokenReplayCache。</span><span class="sxs-lookup"><span data-stu-id="a1c87-670">To protect their applications, developers can provide an implementation of ITokenReplayCache and assign an instance to TokenReplayCache.</span></span></p>|

### <a name="example"></a><span data-ttu-id="a1c87-671">範例</span><span class="sxs-lookup"><span data-stu-id="a1c87-671">Example</span></span>
```C#
// ITokenReplayCache defined in ADAL
public interface ITokenReplayCache
{
bool TryAdd(string securityToken, DateTime expiresOn);
bool TryFind(string securityToken);
}
```

### <a name="example"></a><span data-ttu-id="a1c87-672">範例</span><span class="sxs-lookup"><span data-stu-id="a1c87-672">Example</span></span>
<span data-ttu-id="a1c87-673">以下是 ITokenReplayCache 介面的範例實作。</span><span class="sxs-lookup"><span data-stu-id="a1c87-673">Here is a sample implementation of the ITokenReplayCache interface.</span></span> <span data-ttu-id="a1c87-674">(請自訂並實作您的專案特定快取架構)</span><span class="sxs-lookup"><span data-stu-id="a1c87-674">(Please customize and implement your project-specific caching framework)</span></span>
```C#
public class TokenReplayCache : ITokenReplayCache
{
    private readonly ICacheProvider cache; // Your project-specific cache provider
    public TokenReplayCache(ICacheProvider cache)
    {
        this.cache = cache;
    }
    public bool TryAdd(string securityToken, DateTime expiresOn)
    {
        if (this.cache.Get<string>(securityToken) == null)
        {
            this.cache.Set(securityToken, securityToken);
            return true;
        }
        return false;
    }
    public bool TryFind(string securityToken)
    {
        return this.cache.Get<string>(securityToken) != null;
    }
}
```
<span data-ttu-id="a1c87-675">實作的快取必須透過 "TokenValidationParameters" 屬性在 OIDC 選項中參照，如下所示。</span><span class="sxs-lookup"><span data-stu-id="a1c87-675">The implemented cache has to be referenced in OIDC options via the "TokenValidationParameters" property as follows.</span></span>
```C#
OpenIdConnectOptions openIdConnectOptions = new OpenIdConnectOptions
{
    AutomaticAuthenticate = true,
    ... // other configuration properties follow..
    TokenValidationParameters = new TokenValidationParameters
    {
        TokenReplayCache = new TokenReplayCache(/*Inject your cache provider*/);
    }
}
```

<span data-ttu-id="a1c87-676">請注意，若要測試此組態的有效性，請登入本機受 OIDC 保護的應用程式並擷取 Fiddler 中對 `"/signin-oidc"` 端點的要求。</span><span class="sxs-lookup"><span data-stu-id="a1c87-676">Please note that to test the effectiveness of this configuration, login into your local OIDC-protected application and capture the request to `"/signin-oidc"` endpoint in fiddler.</span></span> <span data-ttu-id="a1c87-677">若未妥善保護，在 Fiddler 中重新執行此要求會設定新的工作階段 cookie。</span><span class="sxs-lookup"><span data-stu-id="a1c87-677">When the protection is not in place, replaying this request in fiddler will set a new session cookie.</span></span> <span data-ttu-id="a1c87-678">在新增 TokenReplayCache 後重新執行要求時，應用程式會擲出例外狀況，如下所示︰`SecurityTokenReplayDetectedException: IDX10228: The securityToken has previously been validated, securityToken: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSIsImtpZCI6Ik1uQ1......`</span><span class="sxs-lookup"><span data-stu-id="a1c87-678">When the request is replayed after the TokenReplayCache protection is added, the application will throw an exception as follows: `SecurityTokenReplayDetectedException: IDX10228: The securityToken has previously been validated, securityToken: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSIsImtpZCI6Ik1uQ1......`</span></span>

## <span data-ttu-id="a1c87-679"><a id="adal-oauth2"></a>使用 ADAL 程式庫來管理從 OAuth2 用戶端至 AAD (或內部部署 AD) 的權杖要求</span><span class="sxs-lookup"><span data-stu-id="a1c87-679"><a id="adal-oauth2"></a>Use ADAL libraries to manage token requests from OAuth2 clients to AAD (or on-premises AD)</span></span>

| <span data-ttu-id="a1c87-680">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-680">Title</span></span>                   | <span data-ttu-id="a1c87-681">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-681">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-682">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-682">**Component**</span></span>               | <span data-ttu-id="a1c87-683">Azure AD</span><span class="sxs-lookup"><span data-stu-id="a1c87-683">Azure AD</span></span> | 
| <span data-ttu-id="a1c87-684">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-684">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-685">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-685">Build</span></span> |  
| <span data-ttu-id="a1c87-686">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-686">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-687">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-687">Generic</span></span> |
| <span data-ttu-id="a1c87-688">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-688">**Attributes**</span></span>              | <span data-ttu-id="a1c87-689">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-689">N/A</span></span>  |
| <span data-ttu-id="a1c87-690">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-690">**References**</span></span>              | [<span data-ttu-id="a1c87-691">ADAL</span><span class="sxs-lookup"><span data-stu-id="a1c87-691">ADAL</span></span>](https://azure.microsoft.com/documentation/articles/active-directory-authentication-libraries/) |
| <span data-ttu-id="a1c87-692">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-692">**Steps**</span></span> | <p><span data-ttu-id="a1c87-693">Azure AD 驗證程式庫 (ADAL) 可讓用戶端應用程式開發人員輕鬆地向雲端或內部部署 Active Directory (AD) 驗證使用者，然後取得存取權杖來保護 API 呼叫。</span><span class="sxs-lookup"><span data-stu-id="a1c87-693">The Azure AD authentication Library (ADAL) enables client application developers to easily authenticate users to cloud or on-premises Active Directory (AD), and then obtain access tokens for securing API calls.</span></span></p><p><span data-ttu-id="a1c87-694">ADAL 有許多功能可使開發人員的驗證更容易，例如非同步支援、儲存存取權杖和更新權杖的可設定權杖快取、當存取權杖到期並且更新權杖可供使用時自動更新權杖等等。</span><span class="sxs-lookup"><span data-stu-id="a1c87-694">ADAL has many features that make authentication easier for developers, such as asynchronous support, a configurable token cache that stores access tokens and refresh tokens, automatic token refresh when an access token expires and a refresh token is available, and more.</span></span></p><p><span data-ttu-id="a1c87-695">藉由處理大部分的複雜度，ADAL 可以幫助開發人員專注於他們的應用程式中的商務邏輯，並輕鬆地保護資源而不需成為安全性方面的專家。</span><span class="sxs-lookup"><span data-stu-id="a1c87-695">By handling most of the complexity, ADAL can help a developer focus on business logic in their application and easily secure resources without being an expert on security.</span></span> <span data-ttu-id="a1c87-696">不同的程式庫適用於 .NET、JavaScript (用戶端和 Node.js)、iOS、Android 和 Java。</span><span class="sxs-lookup"><span data-stu-id="a1c87-696">Separate libraries are available for .NET, JavaScript (client and Node.js), iOS, Android and Java.</span></span></p>|

## <span data-ttu-id="a1c87-697"><a id="authn-devices-field"></a>驗證連線到現場閘道的裝置</span><span class="sxs-lookup"><span data-stu-id="a1c87-697"><a id="authn-devices-field"></a>Authenticate devices connecting to the Field Gateway</span></span>

| <span data-ttu-id="a1c87-698">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-698">Title</span></span>                   | <span data-ttu-id="a1c87-699">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-699">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-700">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-700">**Component**</span></span>               | <span data-ttu-id="a1c87-701">IoT 現場閘道</span><span class="sxs-lookup"><span data-stu-id="a1c87-701">IoT Field Gateway</span></span> | 
| <span data-ttu-id="a1c87-702">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-702">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-703">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-703">Build</span></span> |  
| <span data-ttu-id="a1c87-704">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-704">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-705">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-705">Generic</span></span> |
| <span data-ttu-id="a1c87-706">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-706">**Attributes**</span></span>              | <span data-ttu-id="a1c87-707">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-707">N/A</span></span>  |
| <span data-ttu-id="a1c87-708">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-708">**References**</span></span>              | <span data-ttu-id="a1c87-709">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-709">N/A</span></span>  |
| <span data-ttu-id="a1c87-710">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-710">**Steps**</span></span> | <span data-ttu-id="a1c87-711">確保每個裝置在接受資料之前，以及在利用雲端閘道進行上游通訊之前，已經由現場閘道驗證。</span><span class="sxs-lookup"><span data-stu-id="a1c87-711">Ensure that each device is authenticated by the Field Gateway before accepting data from them and before facilitating upstream communications with the Cloud Gateway.</span></span> <span data-ttu-id="a1c87-712">此外，確保裝置與每一裝置認證連線，即可唯一識別個別裝置。</span><span class="sxs-lookup"><span data-stu-id="a1c87-712">Also, ensure that devices connect with a per device credential so that individual devices can be uniquely identified.</span></span>|

## <span data-ttu-id="a1c87-713"><a id="authn-devices-cloud"></a>確保會驗證連線到雲端閘道的裝置</span><span class="sxs-lookup"><span data-stu-id="a1c87-713"><a id="authn-devices-cloud"></a>Ensure that devices connecting to Cloud gateway are authenticated</span></span>

| <span data-ttu-id="a1c87-714">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-714">Title</span></span>                   | <span data-ttu-id="a1c87-715">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-715">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-716">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-716">**Component**</span></span>               | <span data-ttu-id="a1c87-717">IoT 雲端閘道</span><span class="sxs-lookup"><span data-stu-id="a1c87-717">IoT Cloud Gateway</span></span> | 
| <span data-ttu-id="a1c87-718">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-718">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-719">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-719">Build</span></span> |  
| <span data-ttu-id="a1c87-720">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-720">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-721">泛型、C#、Node.JS</span><span class="sxs-lookup"><span data-stu-id="a1c87-721">Generic, C#, Node.JS,</span></span>  |
| <span data-ttu-id="a1c87-722">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-722">**Attributes**</span></span>              | <span data-ttu-id="a1c87-723">N/A、閘道選擇 - Azure IoT 中樞</span><span class="sxs-lookup"><span data-stu-id="a1c87-723">N/A, Gateway choice - Azure IoT Hub</span></span> |
| <span data-ttu-id="a1c87-724">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-724">**References**</span></span>              | <span data-ttu-id="a1c87-725">N/A、[採用 .NET 的 Azure IoT 中樞](https://azure.microsoft.com/documentation/articles/iot-hub-csharp-csharp-getstarted/)、[開始使用 IoT 中樞和 Node JS](https://azure.microsoft.com/documentation/articles/iot-hub-node-node-getstarted)、[使用 SAS 和憑證保護 IoT](https://azure.microsoft.com/documentation/articles/iot-hub-sas-tokens/)、[Git 儲存機制](https://github.com/Azure/azure-iot-sdks/tree/master/node)</span><span class="sxs-lookup"><span data-stu-id="a1c87-725">N/A, [Azure IoT hub with .NET](https://azure.microsoft.com/documentation/articles/iot-hub-csharp-csharp-getstarted/), [Getting Started wih IoT hub and Node JS](https://azure.microsoft.com/documentation/articles/iot-hub-node-node-getstarted), [Securing IoT with SAS and certificates](https://azure.microsoft.com/documentation/articles/iot-hub-sas-tokens/), [Git repository](https://github.com/Azure/azure-iot-sdks/tree/master/node)</span></span> |
| <span data-ttu-id="a1c87-726">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-726">**Steps**</span></span> | <ul><li><span data-ttu-id="a1c87-727">**泛型︰**使用傳輸層安全性 (TLS) 或 IPSec 來驗證裝置。</span><span class="sxs-lookup"><span data-stu-id="a1c87-727">**Generic:** Authenticate the device using Transport Layer Security (TLS) or IPSec.</span></span> <span data-ttu-id="a1c87-728">如果裝置無法處理完整的非對稱密碼編譯，則基礎結構應該支援在這些裝置上使用預先共用金鑰 (PSK)。</span><span class="sxs-lookup"><span data-stu-id="a1c87-728">Infrastructure should support using pre-shared key (PSK) on those devices that cannot handle full asymmetric cryptography.</span></span> <span data-ttu-id="a1c87-729">利用 Azure AD、Oauth。</span><span class="sxs-lookup"><span data-stu-id="a1c87-729">Leverage Azure AD, Oauth.</span></span></li><li><span data-ttu-id="a1c87-730">**C#：**建立 DeviceClient 執行個體時，Create 方法預設會建立一個使用 AMQP 通訊協定來與 IoT 中樞通訊的 DeviceClient 執行個體。</span><span class="sxs-lookup"><span data-stu-id="a1c87-730">**C#:** When creating a DeviceClient instance, by default, the Create method creates a DeviceClient instance that uses the AMQP protocol to communicate with IoT Hub.</span></span> <span data-ttu-id="a1c87-731">若要使用 HTTPS 通訊協定，請使用可讓您指定通訊協定的 Create 方法的覆寫。</span><span class="sxs-lookup"><span data-stu-id="a1c87-731">To use the HTTPS protocol, use the override of the Create method that enables you to specify the protocol.</span></span> <span data-ttu-id="a1c87-732">若您使用 HTTPS 通訊協定，您也應該將 `Microsoft.AspNet.WebApi.Client` Nuget 套件新增至您的專案，以包含 `System.Net.Http.Formatting` 命名空間。</span><span class="sxs-lookup"><span data-stu-id="a1c87-732">If you use the HTTPS protocol, you should also add the `Microsoft.AspNet.WebApi.Client` NuGet package to your project to include the `System.Net.Http.Formatting` namespace.</span></span></li></ul>|

### <a name="example"></a><span data-ttu-id="a1c87-733">範例</span><span class="sxs-lookup"><span data-stu-id="a1c87-733">Example</span></span>
```C#
static DeviceClient deviceClient;

static string deviceKey = "{device key}";
static string iotHubUri = "{iot hub hostname}";

var messageString = "{message in string format}";
var message = new Message(Encoding.ASCII.GetBytes(messageString));

deviceClient = DeviceClient.Create(iotHubUri, new DeviceAuthenticationWithRegistrySymmetricKey("myFirstDevice", deviceKey));

await deviceClient.SendEventAsync(message);
```

### <a name="example"></a><span data-ttu-id="a1c87-734">範例</span><span class="sxs-lookup"><span data-stu-id="a1c87-734">Example</span></span>
<span data-ttu-id="a1c87-735">**Node.JS：驗證**</span><span class="sxs-lookup"><span data-stu-id="a1c87-735">**Node.JS: Authentication**</span></span>
#### <a name="symmetric-key"></a><span data-ttu-id="a1c87-736">對稱金鑰</span><span class="sxs-lookup"><span data-stu-id="a1c87-736">Symmetric key</span></span>
* <span data-ttu-id="a1c87-737">在 Azure 上建立 IoT 中樞</span><span class="sxs-lookup"><span data-stu-id="a1c87-737">Create a IoT hub on azure</span></span>
* <span data-ttu-id="a1c87-738">在裝置識別登錄中建立一個項目</span><span class="sxs-lookup"><span data-stu-id="a1c87-738">Create an entry in the device identity registry</span></span>
    ```javascript
    var device = new iothub.Device(null);
    device.deviceId = <DeviceId >
    registry.create(device, function(err, deviceInfo, res) {})
    ```
* <span data-ttu-id="a1c87-739">建立模擬裝置</span><span class="sxs-lookup"><span data-stu-id="a1c87-739">Create a simulated device</span></span>
    ```javascript
    var clientFromConnectionString = require('azure-iot-device-amqp').clientFromConnectionString;
    var Message = require('azure-iot-device').Message;
    var connectionString = 'HostName=<HostName>DeviceId=<DeviceId>SharedAccessKey=<SharedAccessKey>';
    var client = clientFromConnectionString(connectionString);
    ```
#### <a name="sas-token"></a><span data-ttu-id="a1c87-740">SAS 權杖</span><span class="sxs-lookup"><span data-stu-id="a1c87-740">SAS Token</span></span>
* <span data-ttu-id="a1c87-741">取得使用對稱金鑰時在內部產生的權杖，但我們也可以明確地產生和使用權杖</span><span class="sxs-lookup"><span data-stu-id="a1c87-741">Gets internally generated when using symmetric key but we can generate and use it explicitly as well</span></span>
* <span data-ttu-id="a1c87-742">定義通訊協定︰`var Http = require('azure-iot-device-http').Http;`</span><span class="sxs-lookup"><span data-stu-id="a1c87-742">Define a protocol : `var Http = require('azure-iot-device-http').Http;`</span></span>
* <span data-ttu-id="a1c87-743">建立 SAS 權杖：</span><span class="sxs-lookup"><span data-stu-id="a1c87-743">Create a sas token :</span></span>
    ```javascript
    resourceUri = encodeURIComponent(resourceUri.toLowerCase()).toLowerCase();
    var deviceName = "<deviceName >";
    var expires = (Date.now() / 1000) + expiresInMins * 60;
    var toSign = resourceUri + '\n' + expires;
    // using crypto
    var decodedPassword = new Buffer(signingKey, 'base64').toString('binary');
    const hmac = crypto.createHmac('sha256', decodedPassword);
    hmac.update(toSign);
    var base64signature = hmac.digest('base64');
    var base64UriEncoded = encodeURIComponent(base64signature);
    // construct authorization string
    var token = "SharedAccessSignature sr=" + resourceUri + "%2fdevices%2f"+deviceName+"&sig="
    + base64UriEncoded + "&se=" + expires;
    if (policyName) token += "&skn="+policyName;
    return token;
    ```
* <span data-ttu-id="a1c87-744">使用 SAS 權杖進行連線︰</span><span class="sxs-lookup"><span data-stu-id="a1c87-744">Connect using sas token:</span></span> 
    ```javascript
    Client.fromSharedAccessSignature(sas, Http); 
    ```
#### <a name="certificates"></a><span data-ttu-id="a1c87-745">憑證</span><span class="sxs-lookup"><span data-stu-id="a1c87-745">Certificates</span></span>
* <span data-ttu-id="a1c87-746">使用任何工具 (例如 OpenSSL) 產生自我簽署的 X509 憑證，以產生 .cert 和 .key 檔案來分別儲存憑證和金鑰</span><span class="sxs-lookup"><span data-stu-id="a1c87-746">Generate a self signed X509 certificate using any tool such as OpenSSL to generate a .cert and .key files to store the certificate and the key respectively</span></span>
* <span data-ttu-id="a1c87-747">使用憑證佈建可接受安全連線的裝置。</span><span class="sxs-lookup"><span data-stu-id="a1c87-747">Provision a device that accepts secured connection using certificates.</span></span>
    ```javascript
    var connectionString = '<connectionString>';
    var registry = iothub.Registry.fromConnectionString(connectionString);
    var deviceJSON = {deviceId:"<deviceId>",
    authentication: {
        x509Thumbprint: {
        primaryThumbprint: "<PrimaryThumbprint>",
        secondaryThumbprint: "<SecondaryThumbprint>"
        }
    }}
    var device = deviceJSON;
    registry.create(device, function (err) {});
    ```
* <span data-ttu-id="a1c87-748">使用憑證連接裝置</span><span class="sxs-lookup"><span data-stu-id="a1c87-748">Connect a device using a certificate</span></span>
    ```javascript
    var Protocol = require('azure-iot-device-http').Http;
    var Client = require('azure-iot-device').Client;
    var connectionString = 'HostName=<HostName>DeviceId=<DeviceId>x509=true';
    var client = Client.fromConnectionString(connectionString, Protocol);
    var options = {
        key: fs.readFileSync('./key.pem', 'utf8'),
        cert: fs.readFileSync('./server.crt', 'utf8')
    }; 
    // Calling setOptions with the x509 certificate and key (and optionally, passphrase) will configure the client //transport to use x509 when connecting to IoT Hub
    client.setOptions(options);
    //call fn to execute after the connection is set up
    client.open(fn);
    ```

## <span data-ttu-id="a1c87-749"><a id="authn-cred"></a>使用每一裝置驗證認證</span><span class="sxs-lookup"><span data-stu-id="a1c87-749"><a id="authn-cred"></a>Use per-device authentication credentials</span></span>

| <span data-ttu-id="a1c87-750">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-750">Title</span></span>                   | <span data-ttu-id="a1c87-751">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-751">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-752">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-752">**Component**</span></span>               | <span data-ttu-id="a1c87-753">IoT 雲端閘道</span><span class="sxs-lookup"><span data-stu-id="a1c87-753">IoT Cloud Gateway</span></span>  | 
| <span data-ttu-id="a1c87-754">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-754">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-755">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-755">Build</span></span> |  
| <span data-ttu-id="a1c87-756">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-756">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-757">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-757">Generic</span></span> |
| <span data-ttu-id="a1c87-758">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-758">**Attributes**</span></span>              | <span data-ttu-id="a1c87-759">閘道選擇 - Azure IoT 中樞</span><span class="sxs-lookup"><span data-stu-id="a1c87-759">Gateway choice - Azure IoT Hub</span></span> |
| <span data-ttu-id="a1c87-760">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-760">**References**</span></span>              | [<span data-ttu-id="a1c87-761">Azure IoT 中樞安全性權杖</span><span class="sxs-lookup"><span data-stu-id="a1c87-761">Azure IoT Hub Security Tokens</span></span>](https://azure.microsoft.com/documentation/articles/iot-hub-sas-tokens/) |
| <span data-ttu-id="a1c87-762">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-762">**Steps**</span></span> | <span data-ttu-id="a1c87-763">使用每一裝置驗證認證搭配以裝置金鑰或用戶端憑證為基礎的 SaS 權杖，而不是 IoT 中樞共用存取原則。</span><span class="sxs-lookup"><span data-stu-id="a1c87-763">Use per device authentication credentials using SaS tokens based on Device key or Client Certificate, instead of IoT Hub-level shared access policies.</span></span> <span data-ttu-id="a1c87-764">這可防止其他人在一個裝置或現場閘道上重複使用驗證權杖</span><span class="sxs-lookup"><span data-stu-id="a1c87-764">This prevents the reuse of authentication tokens of one device or field gateway by another</span></span> |

## <span data-ttu-id="a1c87-765"><a id="req-containers-anon"></a>確保只有必要的容器和 blob 會取得匿名讀取權限</span><span class="sxs-lookup"><span data-stu-id="a1c87-765"><a id="req-containers-anon"></a>Ensure that only the required containers and blobs are given anonymous read access</span></span>

| <span data-ttu-id="a1c87-766">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-766">Title</span></span>                   | <span data-ttu-id="a1c87-767">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-767">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-768">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-768">**Component**</span></span>               | <span data-ttu-id="a1c87-769">Azure 儲存體</span><span class="sxs-lookup"><span data-stu-id="a1c87-769">Azure Storage</span></span> | 
| <span data-ttu-id="a1c87-770">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-770">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-771">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-771">Build</span></span> |  
| <span data-ttu-id="a1c87-772">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-772">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-773">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-773">Generic</span></span> |
| <span data-ttu-id="a1c87-774">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-774">**Attributes**</span></span>              | <span data-ttu-id="a1c87-775">StorageType - Blob</span><span class="sxs-lookup"><span data-stu-id="a1c87-775">StorageType - Blob</span></span> |
| <span data-ttu-id="a1c87-776">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-776">**References**</span></span>              | <span data-ttu-id="a1c87-777">[管理對容器與 Blob 的匿名讀取權限](https://azure.microsoft.com/documentation/articles/storage-manage-access-to-resources/)、[共用存取簽章，第 1 部分：了解 SAS 模型](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/)</span><span class="sxs-lookup"><span data-stu-id="a1c87-777">[Manage anonymous read access to containers and blobs](https://azure.microsoft.com/documentation/articles/storage-manage-access-to-resources/), [Shared Access Signatures, Part 1: Understanding the SAS model](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/)</span></span> |
| <span data-ttu-id="a1c87-778">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-778">**Steps**</span></span> | <p><span data-ttu-id="a1c87-779">根據預設，可能只有儲存體帳戶的擁有者能存取容器及其內部的任何 Blob。</span><span class="sxs-lookup"><span data-stu-id="a1c87-779">By default, a container and any blobs within it may be accessed only by the owner of the storage account.</span></span> <span data-ttu-id="a1c87-780">若要為匿名使用者授與容器及其 Blob 的讀取權限，您可以設定容器權限以允許公用存取。</span><span class="sxs-lookup"><span data-stu-id="a1c87-780">To give anonymous users read permissions to a container and its blobs, one can set the container permissions to allow public access.</span></span> <span data-ttu-id="a1c87-781">匿名使用者可以讀取可公開存取之容器內的 Blob，而不需驗證要求。</span><span class="sxs-lookup"><span data-stu-id="a1c87-781">Anonymous users can read blobs within a publicly accessible container without authenticating the request.</span></span></p><p><span data-ttu-id="a1c87-782">容器會提供下列選項來管理容器存取：</span><span class="sxs-lookup"><span data-stu-id="a1c87-782">Containers provide the following options for managing container access:</span></span></p><ul><li><span data-ttu-id="a1c87-783">完整的公開讀取權限：可以透過匿名要求讀取容器和 Blob 資料。</span><span class="sxs-lookup"><span data-stu-id="a1c87-783">Full public read access: Container and blob data can be read via anonymous request.</span></span> <span data-ttu-id="a1c87-784">用戶端可以透過匿名要求列舉容器內的 Blob，但無法列舉儲存體帳戶內的容器。</span><span class="sxs-lookup"><span data-stu-id="a1c87-784">Clients can enumerate blobs within the container via anonymous request, but cannot enumerate containers within the storage account.</span></span></li><li><span data-ttu-id="a1c87-785">僅對 Blob 有公開讀取權限：您可以透過匿名要求讀取此容器內的 Blob 資料，但您無法使用容器資料。</span><span class="sxs-lookup"><span data-stu-id="a1c87-785">Public read access for blobs only: Blob data within this container can be read via anonymous request, but container data is not available.</span></span> <span data-ttu-id="a1c87-786">用戶端無法透過匿名要求列舉容器內的 Blob</span><span class="sxs-lookup"><span data-stu-id="a1c87-786">Clients cannot enumerate blobs within the container via anonymous request</span></span></li><li><span data-ttu-id="a1c87-787">沒有公開讀取權限：只有帳戶擁有者可以讀取容器和 Blob 資料。</span><span class="sxs-lookup"><span data-stu-id="a1c87-787">No public read access: Container and blob data can be read by the account owner only</span></span></li></ul><p><span data-ttu-id="a1c87-788">匿名存取適用於某些 Blob 應永遠可供匿名讀取存取的狀況。</span><span class="sxs-lookup"><span data-stu-id="a1c87-788">Anonymous access is best for scenarios where certain blobs should always be available for anonymous read access.</span></span> <span data-ttu-id="a1c87-789">如需更精密的控制，您可以建立共用存取簽章，以便在指定的時間間隔內，使用不同的權限來委派受限制的存取權。</span><span class="sxs-lookup"><span data-stu-id="a1c87-789">For finer-grained control, one can create a shared access signature, which enables to delegate restricted access using different permissions and over a specified time interval.</span></span> <span data-ttu-id="a1c87-790">確保容器和 blob (可能包含敏感性資料) 不會意外取得匿名存取權</span><span class="sxs-lookup"><span data-stu-id="a1c87-790">Ensure that containers and blobs, which may potentially contain sensitive data, are not given anonymous access accidentally</span></span></p>|

## <span data-ttu-id="a1c87-791"><a id="limited-access-sas"></a>使用 SAS 或 SAP 對 Azure 儲存體中的物件授與有限的存取權</span><span class="sxs-lookup"><span data-stu-id="a1c87-791"><a id="limited-access-sas"></a>Grant limited access to objects in Azure storage using SAS or SAP</span></span>

| <span data-ttu-id="a1c87-792">Title</span><span class="sxs-lookup"><span data-stu-id="a1c87-792">Title</span></span>                   | <span data-ttu-id="a1c87-793">詳細資料</span><span class="sxs-lookup"><span data-stu-id="a1c87-793">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="a1c87-794">**元件**</span><span class="sxs-lookup"><span data-stu-id="a1c87-794">**Component**</span></span>               | <span data-ttu-id="a1c87-795">Azure 儲存體</span><span class="sxs-lookup"><span data-stu-id="a1c87-795">Azure Storage</span></span> | 
| <span data-ttu-id="a1c87-796">**SDL 階段**</span><span class="sxs-lookup"><span data-stu-id="a1c87-796">**SDL Phase**</span></span>               | <span data-ttu-id="a1c87-797">建置</span><span class="sxs-lookup"><span data-stu-id="a1c87-797">Build</span></span> |  
| <span data-ttu-id="a1c87-798">**適用的技術**</span><span class="sxs-lookup"><span data-stu-id="a1c87-798">**Applicable Technologies**</span></span> | <span data-ttu-id="a1c87-799">泛型</span><span class="sxs-lookup"><span data-stu-id="a1c87-799">Generic</span></span> |
| <span data-ttu-id="a1c87-800">**屬性**</span><span class="sxs-lookup"><span data-stu-id="a1c87-800">**Attributes**</span></span>              | <span data-ttu-id="a1c87-801">N/A</span><span class="sxs-lookup"><span data-stu-id="a1c87-801">N/A</span></span> |
| <span data-ttu-id="a1c87-802">**參考**</span><span class="sxs-lookup"><span data-stu-id="a1c87-802">**References**</span></span>              | <span data-ttu-id="a1c87-803">[共用存取簽章，第 1 部分：了解 SAS 模型](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/)、[共用存取簽章，第 2 部分：透過 Blob 儲存體建立及使用 SAS](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-2/)、[如何使用共用存取簽章和預存存取原則將存取權委派給帳戶中的物件](https://azure.microsoft.com/documentation/articles/storage-security-guide/#_how-to-delegate-access-to-objects-in-your-account-using-shared-access-signatures-and-stored-access-policies)</span><span class="sxs-lookup"><span data-stu-id="a1c87-803">[Shared Access Signatures, Part 1: Understanding the SAS model](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/), [Shared Access Signatures, Part 2: Create and use a SAS with Blob storage](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-2/), [How to delegate access to objects in your account using Shared Access Signatures and Stored Access Policies](https://azure.microsoft.com/documentation/articles/storage-security-guide/#_how-to-delegate-access-to-objects-in-your-account-using-shared-access-signatures-and-stored-access-policies)</span></span> |
| <span data-ttu-id="a1c87-804">**步驟**</span><span class="sxs-lookup"><span data-stu-id="a1c87-804">**Steps**</span></span> | <p><span data-ttu-id="a1c87-805">若要在無需公開帳戶存取金鑰的情況下，將儲存體帳戶中物件的限制存取授與其他用戶端，則使用共用存取簽章 (SAS) 會是個佷有效的方式。</span><span class="sxs-lookup"><span data-stu-id="a1c87-805">Using a shared access signature (SAS) is a powerful way to grant limited access to objects in a storage account to other clients, without having to expose account access key.</span></span> <span data-ttu-id="a1c87-806">SAS 是一種 URI，URI 會在其查詢參數中包含通過驗證存取儲存體資源的所有必要資訊。</span><span class="sxs-lookup"><span data-stu-id="a1c87-806">The SAS is a URI that encompasses in its query parameters all of the information necessary for authenticated access to a storage resource.</span></span> <span data-ttu-id="a1c87-807">若要使用 SAS 存取儲存體資源，用戶端只需在適當的建構函式或方法中傳入 SAS 即可。</span><span class="sxs-lookup"><span data-stu-id="a1c87-807">To access storage resources with the SAS, the client only needs to pass in the SAS to the appropriate constructor or method.</span></span></p><p><span data-ttu-id="a1c87-808">當您想要將儲存體帳戶中的資源存取權提供給無法放心託付帳戶金鑰的用戶端時，您可以使用 SAS。</span><span class="sxs-lookup"><span data-stu-id="a1c87-808">You can use a SAS when you want to provide access to resources in your storage account to a client that can't be trusted with the account key.</span></span> <span data-ttu-id="a1c87-809">您的儲存體帳戶金鑰包括主要和次要金鑰，兩者皆可授與帳戶及帳戶內所有資源的系統管理存取權。</span><span class="sxs-lookup"><span data-stu-id="a1c87-809">Your storage account keys include both a primary and secondary key, both of which grant administrative access to your account and all of the resources in it.</span></span> <span data-ttu-id="a1c87-810">提供任一帳戶金鑰都會讓您的帳戶受到惡意或粗心使用的可能性。</span><span class="sxs-lookup"><span data-stu-id="a1c87-810">Exposing either of your account keys opens your account to the possibility of malicious or negligent use.</span></span> <span data-ttu-id="a1c87-811">共用存取簽章提供一個安全的替代方式，無需帳戶金鑰便可讓其他用戶端根據他們被授與的權限，來讀取、寫入及刪除儲存體帳戶中的資料。</span><span class="sxs-lookup"><span data-stu-id="a1c87-811">Shared access signatures provide a safe alternative that allows other clients to read, write, and delete data in your storage account according to the permissions you've granted, and without need for the account key.</span></span></p><p><span data-ttu-id="a1c87-812">如果您每次都有一組類似的邏輯參數，使用預存存取原則 (SAP) 會是個不錯的做法。</span><span class="sxs-lookup"><span data-stu-id="a1c87-812">If you have a logical set of parameters that are similar each time, using a Stored Access Policy (SAP) is a better idea.</span></span> <span data-ttu-id="a1c87-813">因為使用衍生自預存存取原則的 SAS 讓您能夠立即撤銷該 SAS，所以建議的最佳做法是一律儲存預存存取原則 (如果可能)。</span><span class="sxs-lookup"><span data-stu-id="a1c87-813">Because using a SAS derived from a Stored Access Policy gives you the ability to revoke that SAS immediately, it is the recommended best practice to always use Stored Access Policies when possible.</span></span></p>|