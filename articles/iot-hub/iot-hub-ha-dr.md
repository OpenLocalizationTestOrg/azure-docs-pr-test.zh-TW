---
title: "aaaAzure IoT 中樞高可用性和災害復原 |Microsoft 文件"
description: "描述 hello Azure 與 IoT 中樞功能，可協助您 toobuild 高可用性 Azure IoT 解決方案與災害復原功能。"
services: iot-hub
documentationcenter: 
author: fsautomata
manager: timlt
editor: 
ms.assetid: ae320e58-aa20-45b9-abdc-fa4faae8e6dd
ms.service: iot-hub
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 11/16/2016
ms.author: elioda
ms.openlocfilehash: 74e1fa1682258819ffb3fd84eb79e42fc6e4120f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="iot-hub-high-availability-and-disaster-recovery"></a><span data-ttu-id="39425-103">IoT 中樞高可用性和災害復原</span><span class="sxs-lookup"><span data-stu-id="39425-103">IoT Hub high availability and disaster recovery</span></span>
<span data-ttu-id="39425-104">作為 Azure 服務，IoT 中樞會提供高可用性 (HA) 在 hello Azure 區域層級，使用的備援，而無需 hello 方案所需的任何其他工作。</span><span class="sxs-lookup"><span data-stu-id="39425-104">As an Azure service, IoT Hub provides high availability (HA) using redundancies at hello Azure region level, without any additional work required by hello solution.</span></span> <span data-ttu-id="39425-105">hello Microsoft Azure 平台也包括功能 toohelp 您建置解決方案，跨區域可用性與災害復原 (DR) 功能。</span><span class="sxs-lookup"><span data-stu-id="39425-105">hello Microsoft Azure platform also includes features toohelp you build solutions with disaster recovery (DR) capabilities or cross-region availability.</span></span> <span data-ttu-id="39425-106">如果您想 tooprovide 全域，跨地區的裝置或使用者的高可用性設計，並準備您的方案 tootake 利用這些 Azure DR 功能。</span><span class="sxs-lookup"><span data-stu-id="39425-106">If you want tooprovide global, cross-region high availability for devices or users, design and prepare your solutions tootake advantage of these Azure DR features.</span></span> <span data-ttu-id="39425-107">hello 文章[Azure 業務續航力技術指引](../resiliency/resiliency-technical-guidance.md)說明 hello 內建功能，在 Azure 中的業務續航力功能和 DR 能力。</span><span class="sxs-lookup"><span data-stu-id="39425-107">hello article [Azure Business Continuity Technical Guidance](../resiliency/resiliency-technical-guidance.md) describes hello built-in features in Azure for business continuity and DR.</span></span> <span data-ttu-id="39425-108">hello[災害復原與高可用性 Azure 應用程式][ Disaster recovery and high availability for Azure applications]白皮書提供的架構指引策略 Azure 應用程式 tooachieve HA 功能和 DR 能力。</span><span class="sxs-lookup"><span data-stu-id="39425-108">hello [Disaster recovery and high availability for Azure applications][Disaster recovery and high availability for Azure applications] paper provides architecture guidance on strategies for Azure applications tooachieve HA and DR.</span></span>

## <a name="azure-iot-hub-dr"></a><span data-ttu-id="39425-109">Azure IoT 中樞 DR</span><span class="sxs-lookup"><span data-stu-id="39425-109">Azure IoT Hub DR</span></span>
<span data-ttu-id="39425-110">此外 toointra 區域 HA IoT 中樞實作嚴重損壞修復的容錯移轉機制，不需要介入 hello 使用者。</span><span class="sxs-lookup"><span data-stu-id="39425-110">In addition toointra-region HA, IoT Hub implements failover mechanisms for disaster recovery that require no intervention from hello user.</span></span> <span data-ttu-id="39425-111">IoT 中樞 DR 自我起始，並有 2-26 小時和 hello 下列復原點目標 (Rpo) 的復原時間目標 (RTO)。</span><span class="sxs-lookup"><span data-stu-id="39425-111">IoT Hub DR is self-initiated and has a recovery time objective (RTO) of 2-26 hours, and hello following recovery point objectives (RPOs).</span></span>

| <span data-ttu-id="39425-112">功能</span><span class="sxs-lookup"><span data-stu-id="39425-112">Functionality</span></span> | <span data-ttu-id="39425-113">RPO</span><span class="sxs-lookup"><span data-stu-id="39425-113">RPO</span></span> |
| --- | --- |
| <span data-ttu-id="39425-114">登錄和通訊作業的服務可用性</span><span class="sxs-lookup"><span data-stu-id="39425-114">Service availability for registry and communication operations</span></span> |<span data-ttu-id="39425-115">可能的 CName 遺失</span><span class="sxs-lookup"><span data-stu-id="39425-115">Possible CName loss</span></span> |
| <span data-ttu-id="39425-116">身分識別登錄中的身分識別資料</span><span class="sxs-lookup"><span data-stu-id="39425-116">Identity data in identity registry</span></span> |<span data-ttu-id="39425-117">0 到 5 分鐘的資料遺失</span><span class="sxs-lookup"><span data-stu-id="39425-117">0-5 mins data loss</span></span> |
| <span data-ttu-id="39425-118">裝置到雲端的訊息</span><span class="sxs-lookup"><span data-stu-id="39425-118">Device-to-cloud messages</span></span> |<span data-ttu-id="39425-119">所有未讀取的訊息都會遺失</span><span class="sxs-lookup"><span data-stu-id="39425-119">All unread messages are lost</span></span> |
| <span data-ttu-id="39425-120">作業監視訊息</span><span class="sxs-lookup"><span data-stu-id="39425-120">Operations monitoring messages</span></span> |<span data-ttu-id="39425-121">所有未讀取的訊息都會遺失</span><span class="sxs-lookup"><span data-stu-id="39425-121">All unread messages are lost</span></span> |
| <span data-ttu-id="39425-122">雲端到裝置的訊息</span><span class="sxs-lookup"><span data-stu-id="39425-122">Cloud-to-device messages</span></span> |<span data-ttu-id="39425-123">0 到 5 分鐘的資料遺失</span><span class="sxs-lookup"><span data-stu-id="39425-123">0-5 mins data loss</span></span> |
| <span data-ttu-id="39425-124">雲端到裝置的意見反應佇列</span><span class="sxs-lookup"><span data-stu-id="39425-124">Cloud-to-device feedback queue</span></span> |<span data-ttu-id="39425-125">所有未讀取的訊息都會遺失</span><span class="sxs-lookup"><span data-stu-id="39425-125">All unread messages are lost</span></span> |

## <a name="regional-failover-with-iot-hub"></a><span data-ttu-id="39425-126">使用 IoT 中心的區域容錯移轉</span><span class="sxs-lookup"><span data-stu-id="39425-126">Regional failover with IoT Hub</span></span>
<span data-ttu-id="39425-127">完整的處理方式的 IoT 解決方案中的部署拓撲超出本文的 hello 範圍。</span><span class="sxs-lookup"><span data-stu-id="39425-127">A complete treatment of deployment topologies in IoT solutions is outside hello scope of this article.</span></span> <span data-ttu-id="39425-128">hello 篇文章討論 hello*地區性容錯移轉*hello 用途的高可用性和災害復原部署模型。</span><span class="sxs-lookup"><span data-stu-id="39425-128">hello article discusses hello *regional failover* deployment model for hello purpose of high availability and disaster recovery.</span></span>

<span data-ttu-id="39425-129">在區域的容錯移轉模式下，hello 方案後端執行主要是在資料中心的位置，而且次要 IoT 中樞及後端部署在另一個資料中心位置。</span><span class="sxs-lookup"><span data-stu-id="39425-129">In a regional failover model, hello solution back end runs primarily in one datacenter location, and a secondary IoT hub and back end are deployed in another datacenter location.</span></span> <span data-ttu-id="39425-130">如果 hello 主要資料中心中的 hello IoT 中樞因發生中斷，或 hello hello 裝置 toohello 主要資料中心的網路連線中斷。</span><span class="sxs-lookup"><span data-stu-id="39425-130">If hello IoT hub in hello primary datacenter suffers an outage or hello network connectivity from hello device toohello primary datacenter is interrupted.</span></span> <span data-ttu-id="39425-131">每當無法存取 hello 主要閘道時，裝置會使用次要服務端點。</span><span class="sxs-lookup"><span data-stu-id="39425-131">Devices use a secondary service endpoint whenever hello primary gateway cannot be reached.</span></span> <span data-ttu-id="39425-132">使用跨地區容錯移轉功能，能夠改善 hello 方案可用性超出單一區域的 hello 高可用性。</span><span class="sxs-lookup"><span data-stu-id="39425-132">With a cross-region failover capability, hello solution availability can be improved beyond hello high availability of a single region.</span></span>

<span data-ttu-id="39425-133">在高層級，tooimplement 與 IoT 中樞區域的容錯移轉模型，您需要 hello 下列：</span><span class="sxs-lookup"><span data-stu-id="39425-133">At a high level, tooimplement a regional failover model with IoT Hub, you need hello following:</span></span>

* <span data-ttu-id="39425-134">**次要的 IoT 中樞與路由邏輯裝置**： 在服務中斷，主要區域中的 hello 案例中，裝置必須啟動連接 tooyour 次要區域。</span><span class="sxs-lookup"><span data-stu-id="39425-134">**A secondary IoT hub and device routing logic**: In hello case of a service disruption in your primary region, devices must start connecting tooyour secondary region.</span></span> <span data-ttu-id="39425-135">提供的大部分服務相關的 hello 狀態感知本質，通常會方案管理員 tootrigger hello 區域間容錯移轉程序。</span><span class="sxs-lookup"><span data-stu-id="39425-135">Given hello state-aware nature of most services involved, it is common for solution administrators tootrigger hello inter-region failover process.</span></span> <span data-ttu-id="39425-136">hello 最佳方式 toocommunicate hello 新端點 toodevices，同時維持 hello 程序中，控制項是的 toohave 它們定期檢查*指引*hello 目前作用中端點的服務。</span><span class="sxs-lookup"><span data-stu-id="39425-136">hello best way toocommunicate hello new endpoint toodevices, while maintaining control of hello process, is toohave them regularly check a *concierge* service for hello current active endpoint.</span></span> <span data-ttu-id="39425-137">hello 指引服務可能是複寫，並保持連線到的 web 應用程式使用 DNS 重新導向技術 (比方說，使用[Azure Traffic Manager][Azure Traffic Manager])。</span><span class="sxs-lookup"><span data-stu-id="39425-137">hello concierge service can be a web application that is replicated and kept reachable using DNS-redirection techniques (for example, using [Azure Traffic Manager][Azure Traffic Manager]).</span></span>
* <span data-ttu-id="39425-138">**身分識別登錄複寫**-toobe 可用，次要 IoT 中樞 hello 必須包含所有 toohello 方案可以連接到的裝置識別身分。</span><span class="sxs-lookup"><span data-stu-id="39425-138">**Identity registry replication** - toobe usable, hello secondary IoT hub must contain all device identities that can connect toohello solution.</span></span> <span data-ttu-id="39425-139">hello 方案應該保留的裝置識別的異地備援備份，並上傳 toohello 次要 IoT 中樞之後，才能切換 hello hello 裝置的使用中的端點。</span><span class="sxs-lookup"><span data-stu-id="39425-139">hello solution should keep geo-replicated backups of device identities, and upload them toohello secondary IoT hub before switching hello active endpoint for hello devices.</span></span> <span data-ttu-id="39425-140">hello 裝置身分識別的 IoT 中樞的匯出功能會在此內容中很有用。</span><span class="sxs-lookup"><span data-stu-id="39425-140">hello device identity export functionality of IoT Hub is useful in this context.</span></span> <span data-ttu-id="39425-141">如需詳細資訊，請參閱 [IoT 中樞開發人員指南 - 身分識別登錄][IoT Hub developer guide - identity registry]。</span><span class="sxs-lookup"><span data-stu-id="39425-141">For more information, see [IoT Hub developer guide - identity registry][IoT Hub developer guide - identity registry].</span></span>
* <span data-ttu-id="39425-142">**合併邏輯**-當 hello 主要區域再次變為無法使用，所有 hello 狀態且已建立 hello 次要網站中的資料必須是移轉後 toohello 主要區域。</span><span class="sxs-lookup"><span data-stu-id="39425-142">**Merging logic** - When hello primary region becomes available again, all hello state and data that have been created in hello secondary site must be migrated back toohello primary region.</span></span> <span data-ttu-id="39425-143">此狀態與資料大多與相關 toodevice 的身分識別與應用程式中繼資料，必須與 hello 主要 IoT 中樞與 hello 主要區域中的任何其他特定應用程式存放區合併。</span><span class="sxs-lookup"><span data-stu-id="39425-143">This state and data mostly relates toodevice identities and application metadata, which must be merged with hello primary IoT hub and any other application-specific stores in hello primary region.</span></span> <span data-ttu-id="39425-144">toosimplify 此步驟中，您應該使用等冪作業。</span><span class="sxs-lookup"><span data-stu-id="39425-144">toosimplify this step, you should use idempotent operations.</span></span> <span data-ttu-id="39425-145">作業具有等冪性降到最低 hello 副作用從 hello 最終一致的發佈的事件，以及從重複的項目或次序不對傳遞的事件。</span><span class="sxs-lookup"><span data-stu-id="39425-145">Idempotent operations minimize hello side-effects from hello eventual consistent distribution of events, and from duplicates or out-of-order delivery of events.</span></span> <span data-ttu-id="39425-146">此外，hello 應用程式邏輯應該設計的 tootolerate 潛在的不一致或 「 稍微"結束日期狀態。</span><span class="sxs-lookup"><span data-stu-id="39425-146">In addition, hello application logic should be designed tootolerate potential inconsistencies or "slightly" out of date-state.</span></span> <span data-ttu-id="39425-147">這種情況可能是因為 toohello 其他所需的時間 hello 系統太 「 修復 」 根據復原點目標 (RPO)。</span><span class="sxs-lookup"><span data-stu-id="39425-147">This situation can occur due toohello additional time it takes for hello system too"heal" based on recovery point objectives (RPO).</span></span>

## <a name="next-steps"></a><span data-ttu-id="39425-148">後續步驟</span><span class="sxs-lookup"><span data-stu-id="39425-148">Next steps</span></span>
<span data-ttu-id="39425-149">請遵循這些連結 toolearn 深入了解 Azure IoT 中樞：</span><span class="sxs-lookup"><span data-stu-id="39425-149">Follow these links toolearn more about Azure IoT Hub:</span></span>

* <span data-ttu-id="39425-150">[開始使用 IoT 中心 (教學課程)][lnk-get-started]</span><span class="sxs-lookup"><span data-stu-id="39425-150">[Get started with IoT Hubs (Tutorial)][lnk-get-started]</span></span>
* <span data-ttu-id="39425-151">[何謂 Azure IoT 中樞？][What is Azure IoT Hub?]</span><span class="sxs-lookup"><span data-stu-id="39425-151">[What is Azure IoT Hub?][What is Azure IoT Hub?]</span></span>

[Disaster recovery and high availability for Azure applications]: ../resiliency/resiliency-disaster-recovery-high-availability-azure-applications.md
[Azure Business Continuity Technical Guidance]: https://azure.microsoft.com/documentation/articles/resiliency-technical-guidance/
[Azure Traffic Manager]: https://azure.microsoft.com/documentation/services/traffic-manager/
[IoT Hub developer guide - identity registry]: iot-hub-devguide-identity-registry.md

[lnk-get-started]: iot-hub-csharp-csharp-getstarted.md
[What is Azure IoT Hub?]: iot-hub-what-is-iot-hub.md
