---
title: "Azure IoT 中樞高可用性和災害復原 | Microsoft Docs"
description: "描述 Azure 和 IoT 中樞功能，協助您建立具有災害復原功能的高可用性 Azure IoT 解決方案。"
services: iot-hub
documentationcenter: 
author: fsautomata
manager: timlt
editor: 
ms.assetid: ae320e58-aa20-45b9-abdc-fa4faae8e6dd
ms.service: iot-hub
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 11/16/2016
ms.author: elioda
ms.openlocfilehash: 76c3187549e1821908263c30e394db26ee6f75e6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="iot-hub-high-availability-and-disaster-recovery"></a><span data-ttu-id="552b0-103">IoT 中樞高可用性和災害復原</span><span class="sxs-lookup"><span data-stu-id="552b0-103">IoT Hub high availability and disaster recovery</span></span>
<span data-ttu-id="552b0-104">作為 Azure 服務，IoT 中心提供高可用性 (HA)，在 Azure 區域層級使用備援，且解決方案不需任何額外的工作。</span><span class="sxs-lookup"><span data-stu-id="552b0-104">As an Azure service, IoT Hub provides high availability (HA) using redundancies at the Azure region level, without any additional work required by the solution.</span></span> <span data-ttu-id="552b0-105">Microsoft Azure 平台也包含各種功能，以協助您建置具有災害復原 (DR) 功能或跨區域可用性的解決方案。</span><span class="sxs-lookup"><span data-stu-id="552b0-105">The Microsoft Azure platform also includes features to help you build solutions with disaster recovery (DR) capabilities or cross-region availability.</span></span> <span data-ttu-id="552b0-106">若要提供全域、跨區域的高可用性給裝置或使用者，請設計及準備解決方案以善用這些 Azure DR 功能。</span><span class="sxs-lookup"><span data-stu-id="552b0-106">If you want to provide global, cross-region high availability for devices or users, design and prepare your solutions to take advantage of these Azure DR features.</span></span> <span data-ttu-id="552b0-107">[Azure 業務持續性技術指引](../resiliency/resiliency-technical-guidance.md) 一文描述業務持續性和 DR 的 Azure 內建功能。</span><span class="sxs-lookup"><span data-stu-id="552b0-107">The article [Azure Business Continuity Technical Guidance](../resiliency/resiliency-technical-guidance.md) describes the built-in features in Azure for business continuity and DR.</span></span> <span data-ttu-id="552b0-108">[Azure 應用程式的災害復原與高可用性][Disaster recovery and high availability for Azure applications]一文針對 Azure 應用程式的策略提供架構指引以達到 HA 和 DR。</span><span class="sxs-lookup"><span data-stu-id="552b0-108">The [Disaster recovery and high availability for Azure applications][Disaster recovery and high availability for Azure applications] paper provides architecture guidance on strategies for Azure applications to achieve HA and DR.</span></span>

## <a name="azure-iot-hub-dr"></a><span data-ttu-id="552b0-109">Azure IoT 中樞 DR</span><span class="sxs-lookup"><span data-stu-id="552b0-109">Azure IoT Hub DR</span></span>
<span data-ttu-id="552b0-110">除了內部區域 HA，IoT 中樞會實作不需要使用者介入的災害復原容錯移轉機制。</span><span class="sxs-lookup"><span data-stu-id="552b0-110">In addition to intra-region HA, IoT Hub implements failover mechanisms for disaster recovery that require no intervention from the user.</span></span> <span data-ttu-id="552b0-111">IoT 中樞 DR 會自行起動，其復原時間目標 (RTO) 為 2 到 26 小時，以及下列復原點目標 (RPO)。</span><span class="sxs-lookup"><span data-stu-id="552b0-111">IoT Hub DR is self-initiated and has a recovery time objective (RTO) of 2-26 hours, and the following recovery point objectives (RPOs).</span></span>

| <span data-ttu-id="552b0-112">功能</span><span class="sxs-lookup"><span data-stu-id="552b0-112">Functionality</span></span> | <span data-ttu-id="552b0-113">RPO</span><span class="sxs-lookup"><span data-stu-id="552b0-113">RPO</span></span> |
| --- | --- |
| <span data-ttu-id="552b0-114">登錄和通訊作業的服務可用性</span><span class="sxs-lookup"><span data-stu-id="552b0-114">Service availability for registry and communication operations</span></span> |<span data-ttu-id="552b0-115">可能的 CName 遺失</span><span class="sxs-lookup"><span data-stu-id="552b0-115">Possible CName loss</span></span> |
| <span data-ttu-id="552b0-116">身分識別登錄中的身分識別資料</span><span class="sxs-lookup"><span data-stu-id="552b0-116">Identity data in identity registry</span></span> |<span data-ttu-id="552b0-117">0 到 5 分鐘的資料遺失</span><span class="sxs-lookup"><span data-stu-id="552b0-117">0-5 mins data loss</span></span> |
| <span data-ttu-id="552b0-118">裝置到雲端的訊息</span><span class="sxs-lookup"><span data-stu-id="552b0-118">Device-to-cloud messages</span></span> |<span data-ttu-id="552b0-119">所有未讀取的訊息都會遺失</span><span class="sxs-lookup"><span data-stu-id="552b0-119">All unread messages are lost</span></span> |
| <span data-ttu-id="552b0-120">作業監視訊息</span><span class="sxs-lookup"><span data-stu-id="552b0-120">Operations monitoring messages</span></span> |<span data-ttu-id="552b0-121">所有未讀取的訊息都會遺失</span><span class="sxs-lookup"><span data-stu-id="552b0-121">All unread messages are lost</span></span> |
| <span data-ttu-id="552b0-122">雲端到裝置的訊息</span><span class="sxs-lookup"><span data-stu-id="552b0-122">Cloud-to-device messages</span></span> |<span data-ttu-id="552b0-123">0 到 5 分鐘的資料遺失</span><span class="sxs-lookup"><span data-stu-id="552b0-123">0-5 mins data loss</span></span> |
| <span data-ttu-id="552b0-124">雲端到裝置的意見反應佇列</span><span class="sxs-lookup"><span data-stu-id="552b0-124">Cloud-to-device feedback queue</span></span> |<span data-ttu-id="552b0-125">所有未讀取的訊息都會遺失</span><span class="sxs-lookup"><span data-stu-id="552b0-125">All unread messages are lost</span></span> |

## <a name="regional-failover-with-iot-hub"></a><span data-ttu-id="552b0-126">使用 IoT 中心的區域容錯移轉</span><span class="sxs-lookup"><span data-stu-id="552b0-126">Regional failover with IoT Hub</span></span>
<span data-ttu-id="552b0-127">IoT 解決方案中部署拓撲的完整處理方式不在本文討論範圍內。</span><span class="sxs-lookup"><span data-stu-id="552b0-127">A complete treatment of deployment topologies in IoT solutions is outside the scope of this article.</span></span> <span data-ttu-id="552b0-128">本文討論為了實現高可用性和災害復原的目的，所建立的*區域容錯移轉*部署模型。</span><span class="sxs-lookup"><span data-stu-id="552b0-128">The article discusses the *regional failover* deployment model for the purpose of high availability and disaster recovery.</span></span>

<span data-ttu-id="552b0-129">在區域容錯移轉模型中，解決方案後端主要是在某個資料中心位置執行，而次要 IoT 中樞和後端則會部署在另一個資料中心位置。</span><span class="sxs-lookup"><span data-stu-id="552b0-129">In a regional failover model, the solution back end runs primarily in one datacenter location, and a secondary IoT hub and back end are deployed in another datacenter location.</span></span> <span data-ttu-id="552b0-130">如果主要資料中心的 IoT 中樞遭遇服務中斷，或從裝置到主要資料中心的網路連線中斷。</span><span class="sxs-lookup"><span data-stu-id="552b0-130">If the IoT hub in the primary datacenter suffers an outage or the network connectivity from the device to the primary datacenter is interrupted.</span></span> <span data-ttu-id="552b0-131">每當無法連接主要閘道器時，裝置會使用次要服務端點。</span><span class="sxs-lookup"><span data-stu-id="552b0-131">Devices use a secondary service endpoint whenever the primary gateway cannot be reached.</span></span> <span data-ttu-id="552b0-132">使用跨區域容錯移轉功能時，可改善解決方案的可用性，勝過單一區域的高可用性。</span><span class="sxs-lookup"><span data-stu-id="552b0-132">With a cross-region failover capability, the solution availability can be improved beyond the high availability of a single region.</span></span>

<span data-ttu-id="552b0-133">在較高層級，為了使用 IoT 中樞實作區域容錯移轉模型，您需要下列內容：</span><span class="sxs-lookup"><span data-stu-id="552b0-133">At a high level, to implement a regional failover model with IoT Hub, you need the following:</span></span>

* <span data-ttu-id="552b0-134">**次要 IoT 中樞和裝置路由邏輯**：萬一主要區域的服務中斷，裝置必須開始與您的次要地區連接。</span><span class="sxs-lookup"><span data-stu-id="552b0-134">**A secondary IoT hub and device routing logic**: In the case of a service disruption in your primary region, devices must start connecting to your secondary region.</span></span> <span data-ttu-id="552b0-135">由於大部分服務狀態感知的本質，解決方案的系統管理員通常會觸發區域間的容錯移轉程序。</span><span class="sxs-lookup"><span data-stu-id="552b0-135">Given the state-aware nature of most services involved, it is common for solution administrators to trigger the inter-region failover process.</span></span> <span data-ttu-id="552b0-136">要讓新端點與裝置通訊，同時保有程序的控制權，最佳方式是讓它們定期檢查「指引」服務是否有目前作用中的端點。</span><span class="sxs-lookup"><span data-stu-id="552b0-136">The best way to communicate the new endpoint to devices, while maintaining control of the process, is to have them regularly check a *concierge* service for the current active endpoint.</span></span> <span data-ttu-id="552b0-137">這裡的指引服務可以是 Web 應用程式，其可藉由使用 DNS 重新導向技術複寫並保持連接 (例如使用 [Azure 流量管理員][Azure Traffic Manager])。</span><span class="sxs-lookup"><span data-stu-id="552b0-137">The concierge service can be a web application that is replicated and kept reachable using DNS-redirection techniques (for example, using [Azure Traffic Manager][Azure Traffic Manager]).</span></span>
* <span data-ttu-id="552b0-138">**身分識別登錄複寫** - 為了成為可用狀態，次要 IoT 中樞必須包含能夠連接到解決方案的所有裝置身分識別。</span><span class="sxs-lookup"><span data-stu-id="552b0-138">**Identity registry replication** - To be usable, the secondary IoT hub must contain all device identities that can connect to the solution.</span></span> <span data-ttu-id="552b0-139">解決方案應該保留裝置身分識別的異地複寫備份，並在切換裝置的作用中端點之前將其上傳至次要 IoT 中樞。</span><span class="sxs-lookup"><span data-stu-id="552b0-139">The solution should keep geo-replicated backups of device identities, and upload them to the secondary IoT hub before switching the active endpoint for the devices.</span></span> <span data-ttu-id="552b0-140">IoT 中樞的裝置身分識別匯出功能在此內容中很有用。</span><span class="sxs-lookup"><span data-stu-id="552b0-140">The device identity export functionality of IoT Hub is useful in this context.</span></span> <span data-ttu-id="552b0-141">如需詳細資訊，請參閱 [IoT 中樞開發人員指南 - 身分識別登錄][IoT Hub developer guide - identity registry]。</span><span class="sxs-lookup"><span data-stu-id="552b0-141">For more information, see [IoT Hub developer guide - identity registry][IoT Hub developer guide - identity registry].</span></span>
* <span data-ttu-id="552b0-142">**合併邏輯** - 當主要區域再次可供使用時，所有在次要站台中建立的狀態和資料都必須移轉回主要區域。</span><span class="sxs-lookup"><span data-stu-id="552b0-142">**Merging logic** - When the primary region becomes available again, all the state and data that have been created in the secondary site must be migrated back to the primary region.</span></span> <span data-ttu-id="552b0-143">此狀態和資料大多與裝置身分識別和應用程式中繼資料相關，必須與主要 IoT 中樞合併，也可能要與主要區域中的其他應用程式專屬存放區合併。</span><span class="sxs-lookup"><span data-stu-id="552b0-143">This state and data mostly relates to device identities and application metadata, which must be merged with the primary IoT hub and any other application-specific stores in the primary region.</span></span> <span data-ttu-id="552b0-144">若要簡化此步驟，您應該使用等冪作業。</span><span class="sxs-lookup"><span data-stu-id="552b0-144">To simplify this step, you should use idempotent operations.</span></span> <span data-ttu-id="552b0-145">等冪作業可以將副作用降到最低，不只包括來自最終一致的事件分佈的副作用，也包括來自事件的重複項目或失序傳遞的副作用。</span><span class="sxs-lookup"><span data-stu-id="552b0-145">Idempotent operations minimize the side-effects from the eventual consistent distribution of events, and from duplicates or out-of-order delivery of events.</span></span> <span data-ttu-id="552b0-146">此外，應用程式邏輯應該設計為能夠容忍潛在的不一致或「稍微」過期的狀態。</span><span class="sxs-lookup"><span data-stu-id="552b0-146">In addition, the application logic should be designed to tolerate potential inconsistencies or "slightly" out of date-state.</span></span> <span data-ttu-id="552b0-147">發生此狀況可能是因為系統需要額外的時間來根據復原點目標 (RPO)「療癒」。</span><span class="sxs-lookup"><span data-stu-id="552b0-147">This situation can occur due to the additional time it takes for the system to "heal" based on recovery point objectives (RPO).</span></span>

## <a name="next-steps"></a><span data-ttu-id="552b0-148">後續步驟</span><span class="sxs-lookup"><span data-stu-id="552b0-148">Next steps</span></span>
<span data-ttu-id="552b0-149">遵循下列連結以深入了解 Azure IoT 中樞：</span><span class="sxs-lookup"><span data-stu-id="552b0-149">Follow these links to learn more about Azure IoT Hub:</span></span>

* <span data-ttu-id="552b0-150">[開始使用 IoT 中心 (教學課程)][lnk-get-started]</span><span class="sxs-lookup"><span data-stu-id="552b0-150">[Get started with IoT Hubs (Tutorial)][lnk-get-started]</span></span>
* <span data-ttu-id="552b0-151">[何謂 Azure IoT 中樞？][What is Azure IoT Hub?]</span><span class="sxs-lookup"><span data-stu-id="552b0-151">[What is Azure IoT Hub?][What is Azure IoT Hub?]</span></span>

[Disaster recovery and high availability for Azure applications]: ../resiliency/resiliency-disaster-recovery-high-availability-azure-applications.md
[Azure Business Continuity Technical Guidance]: https://azure.microsoft.com/documentation/articles/resiliency-technical-guidance/
[Azure Traffic Manager]: https://azure.microsoft.com/documentation/services/traffic-manager/
[IoT Hub developer guide - identity registry]: iot-hub-devguide-identity-registry.md

[lnk-get-started]: iot-hub-csharp-csharp-getstarted.md
[What is Azure IoT Hub?]: iot-hub-what-is-iot-hub.md
