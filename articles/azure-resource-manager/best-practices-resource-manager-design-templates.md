---
title: "aaaDesign Azure 複雜的解決方案範本 |Microsoft 文件"
description: "顯示為複雜的實例設計 Azure Resource Manager 範本的最佳做法"
services: azure-resource-manager
documentationcenter: 
author: tfitzmac
manager: timlt
editor: tysonn
ms.assetid: ce1141d6-ece7-4976-acea-1db1f775409e
ms.service: azure-resource-manager
ms.workload: multiple
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/19/2016
ms.author: tomfitz
ms.openlocfilehash: aa45e9a46d79a6336b696cff8fd37f65fa449f11
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="design-patterns-for-azure-resource-manager-templates-when-deploying-complex-solutions"></a><span data-ttu-id="6d260-103">部署複雜的解決方案時，設計 Azure Resource Manager 範本的模式</span><span class="sxs-lookup"><span data-stu-id="6d260-103">Design patterns for Azure Resource Manager templates when deploying complex solutions</span></span>
<span data-ttu-id="6d260-104">在 Azure Resource Manager 範本上使用彈性的做法，您可以快速且一致地部署複雜的拓撲。</span><span class="sxs-lookup"><span data-stu-id="6d260-104">Using a flexible approach based on Azure Resource Manager templates, you can deploy complex topologies quickly and consistently.</span></span> <span data-ttu-id="6d260-105">您可以調整這些部署，輕鬆地為核心發展供應項目或極端值的案例或客戶的 tooaccommodate 變化。</span><span class="sxs-lookup"><span data-stu-id="6d260-105">You can adapt these deployments easily as core offerings evolve or tooaccommodate variants for outlier scenarios or customers.</span></span>

<span data-ttu-id="6d260-106">本主題是較大份白皮書的一部分。</span><span class="sxs-lookup"><span data-stu-id="6d260-106">This topic is part of a larger whitepaper.</span></span> <span data-ttu-id="6d260-107">tooread hello 完整紙張，下載[世界類別 Azure 資源管理員範本考量和證明作法](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf)。</span><span class="sxs-lookup"><span data-stu-id="6d260-107">tooread hello full paper, download [World Class Azure Resource Manager Templates Considerations and Proven Practices](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf).</span></span>

<span data-ttu-id="6d260-108">範本會結合 hello hello 基礎 hello 適應性與可讀性的 JavaScript Object Notation (JSON) 的 Azure 資源管理員的優點。</span><span class="sxs-lookup"><span data-stu-id="6d260-108">Templates combine hello benefits of hello underlying Azure Resource Manager with hello adaptability and readability of JavaScript Object Notation (JSON).</span></span> <span data-ttu-id="6d260-109">使用範本，您可以：</span><span class="sxs-lookup"><span data-stu-id="6d260-109">Using templates, you can:</span></span>

* <span data-ttu-id="6d260-110">以一致的方式部署拓撲及其工作負載。</span><span class="sxs-lookup"><span data-stu-id="6d260-110">Deploy topologies and their workloads consistently.</span></span>
* <span data-ttu-id="6d260-111">使用資源群組，一併管理應用程式中的所有資源。</span><span class="sxs-lookup"><span data-stu-id="6d260-111">Manage all your resources in an application together using resource groups.</span></span>
* <span data-ttu-id="6d260-112">適用於角色型存取控制 (RBAC) toogrant 適當的存取權 toousers、 群組和服務。</span><span class="sxs-lookup"><span data-stu-id="6d260-112">Apply role-based access control (RBAC) toogrant appropriate access toousers, groups, and services.</span></span>
* <span data-ttu-id="6d260-113">使用標記的關聯 toostreamline 工作，例如計費彙總套件。</span><span class="sxs-lookup"><span data-stu-id="6d260-113">Use tagging associations toostreamline tasks such as billing rollups.</span></span>

<span data-ttu-id="6d260-114">本文提供在我們的設計工作階段以及真實世界中與 Azure 客戶諮詢小組 (AzureCAT) 客戶進行範本實作過程中所識別的取用案例、架構及實作模式的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="6d260-114">This article provides details on consumption scenarios, architecture, and implementation patterns identified during our design sessions and real-world template implementations with Azure Customer Advisory Team (AzureCAT) customers.</span></span> <span data-ttu-id="6d260-115">遠離 academic，這些方法會通過驗證的最佳通知 hello 開發的範本 12 hello 頂端以 Linux 為基礎的 OSS 技術，包括： Apache Kafka Apache Spark、 Cloudera、 Couchbase、 的 Hortonworks HDP、 由 DataStax EnterpriseApache Cassandra、 Elasticsearch、 Jenkins、 MongoDB、 PostgreSQL、 Redis 和 Nagios。</span><span class="sxs-lookup"><span data-stu-id="6d260-115">Far from academic, these approaches are proven practices informed by hello development of templates for 12 of hello top Linux-based OSS technologies, including: Apache Kafka, Apache Spark, Cloudera, Couchbase, Hortonworks HDP, DataStax Enterprise powered by Apache Cassandra, Elasticsearch, Jenkins, MongoDB, PostgreSQL, Redis, and Nagios.</span></span> 

<span data-ttu-id="6d260-116">這篇文章會共用您設計架構世界類別 Azure 資源管理員範本這些經過證實的作法 toohelp。</span><span class="sxs-lookup"><span data-stu-id="6d260-116">This article shares these proven practices toohelp you architect world class Azure Resource Manager templates.</span></span>  

<span data-ttu-id="6d260-117">透過與客戶合作，我們已在企業、系統整合者和 CSV 之間識別出數個 Resource Manager 範本取用體驗。</span><span class="sxs-lookup"><span data-stu-id="6d260-117">In our work with customers, we have identified several Resource Manager template consumption experiences across enterprises, System Integrators (SI)s, and CSVs.</span></span> <span data-ttu-id="6d260-118">hello 下列各節提供常見的案例和模式的高階概觀不同客戶類型。</span><span class="sxs-lookup"><span data-stu-id="6d260-118">hello following sections provide a high-level overview of common scenarios and patterns for different customer types.</span></span>

## <a name="enterprises-and-system-integrators"></a><span data-ttu-id="6d260-119">企業和系統整合者</span><span class="sxs-lookup"><span data-stu-id="6d260-119">Enterprises and system integrators</span></span>
<span data-ttu-id="6d260-120">在大型組織中，我們常看到兩種 Resource Manager 範本取用取用者︰內部軟體開發團隊和公司 IT。</span><span class="sxs-lookup"><span data-stu-id="6d260-120">Within large organizations, we commonly see two consumers of Resource Manager templates: internal software development teams and corporate IT.</span></span> <span data-ttu-id="6d260-121">我們找到 hello SIs 的 hello 案例對應 toohello 案例，企業，因此 hello 相同的考量。</span><span class="sxs-lookup"><span data-stu-id="6d260-121">We've found that hello scenarios for hello SIs map toohello scenarios for Enterprises, so hello same considerations apply.</span></span>

### <a name="internal-software-development-teams"></a><span data-ttu-id="6d260-122">內部軟體開發團隊</span><span class="sxs-lookup"><span data-stu-id="6d260-122">Internal software development teams</span></span>
<span data-ttu-id="6d260-123">如果您的小組正在開發軟體 toosupport 業務範本可讓您的輕鬆 tooquickly 部署在特定的商務方案中使用的技術。</span><span class="sxs-lookup"><span data-stu-id="6d260-123">If your team develops software toosupport your business, templates provide an easy way tooquickly deploy technologies for use in business-specific solutions.</span></span> <span data-ttu-id="6d260-124">您也可以使用範本 toorapidly 建立定型環境可讓小組成員 toogain 所需的技巧。</span><span class="sxs-lookup"><span data-stu-id="6d260-124">You can also use templates toorapidly create training environments that enable team members toogain necessary skills.</span></span>

<span data-ttu-id="6d260-125">您可以使用範本做為是或擴充或組合這些 tooaccommodate 您的需求。</span><span class="sxs-lookup"><span data-stu-id="6d260-125">You can use templates as-is or extend or compose them tooaccommodate your needs.</span></span> <span data-ttu-id="6d260-126">在範本內使用標記，您可以利用各種不同的檢視 (例如，團隊、專案、個人及教育) 來提供帳單摘要。</span><span class="sxs-lookup"><span data-stu-id="6d260-126">Using tagging within templates, you can provide a billing summary with various views such as team, project, individual, and education.</span></span>

<span data-ttu-id="6d260-127">企業通常會想軟體開發小組 toocreate 一致部署解決方案的範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-127">Businesses often want software development teams toocreate a template for consistent deployment of a solution.</span></span> <span data-ttu-id="6d260-128">hello 範本有助於進行條件約束，因此該環境內的特定項目保持固定，而且無法加以覆寫。</span><span class="sxs-lookup"><span data-stu-id="6d260-128">hello template facilitates constraints so certain items within that environment remain fixed and can't be overridden.</span></span> <span data-ttu-id="6d260-129">例如，銀行可能需要範本 tooinclude RBAC 好讓程式設計人員無法修改銀行方案 toosend 資料 tooa 個人儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="6d260-129">For example, a bank might require a template tooinclude RBAC so a programmer can’t revise a banking solution toosend data tooa personal storage account.</span></span>

### <a name="corporate-it"></a><span data-ttu-id="6d260-130">公司 IT</span><span class="sxs-lookup"><span data-stu-id="6d260-130">Corporate IT</span></span>
<span data-ttu-id="6d260-131">公司 IT 組織通常會使用範本來傳遞雲端容量和雲端裝載功能。</span><span class="sxs-lookup"><span data-stu-id="6d260-131">Corporate IT organizations typically use templates for delivering cloud capacity and cloud-hosted capabilities.</span></span>

#### <a name="cloud-capacity"></a><span data-ttu-id="6d260-132">雲端容量</span><span class="sxs-lookup"><span data-stu-id="6d260-132">Cloud capacity</span></span>
<span data-ttu-id="6d260-133">企業 IT 群組 tooprovide 雲端容量的小組常見方法是使用"t 恤大小 」，也就是標準供應項目大小例如小型、 中型和大型。</span><span class="sxs-lookup"><span data-stu-id="6d260-133">A common way for corporate IT groups tooprovide cloud capacity for teams is with "t-shirt sizes", which are standard offering sizes such as small, medium, and large.</span></span> <span data-ttu-id="6d260-134">hello t 恤尺寸供應項目可以混合不同資源類型和數量，同時提供可讓可能 toouse 範本的標準化的層級。</span><span class="sxs-lookup"><span data-stu-id="6d260-134">hello t-shirt sized offerings can mix different resource types and quantities while providing a level of standardization that makes it possible toouse templates.</span></span> <span data-ttu-id="6d260-135">hello 範本提供一致的方式來強制執行公司原則，並使用標記 tooprovide 計費 tooconsuming 組織的容量。</span><span class="sxs-lookup"><span data-stu-id="6d260-135">hello templates deliver capacity in a consistent way that enforces corporate policies and uses tagging tooprovide chargeback tooconsuming organizations.</span></span>

<span data-ttu-id="6d260-136">例如，您可能需要 tooprovide 開發、 測試或實際執行環境中的 hello 軟體開發團隊可以部署解決方案。</span><span class="sxs-lookup"><span data-stu-id="6d260-136">For example, you may need tooprovide development, test, or production environments within which hello software development teams can deploy their solutions.</span></span> <span data-ttu-id="6d260-137">hello 的環境具有預先定義的網路拓撲，且無法變更 hello 軟體開發團隊的項目，例如存取 toohello 公用網際網路和封包檢查的規則。</span><span class="sxs-lookup"><span data-stu-id="6d260-137">hello environment has a predefined network topology and elements that hello software development teams cannot change, such as rules governing access toohello public internet and packet inspection.</span></span> <span data-ttu-id="6d260-138">您也可能使用不同的存取權限 hello 環境對於這些環境的組織特定角色。</span><span class="sxs-lookup"><span data-stu-id="6d260-138">You may also have organization-specific roles for these environments with distinct access rights for hello environment.</span></span>

#### <a name="cloud-hosted-capabilities"></a><span data-ttu-id="6d260-139">雲端裝載功能</span><span class="sxs-lookup"><span data-stu-id="6d260-139">Cloud-hosted capabilities</span></span>
<span data-ttu-id="6d260-140">您可以使用範本 toosupport 雲端裝載功能，包括個別軟體套件或提供商務 toointernal 行複合供應項目。</span><span class="sxs-lookup"><span data-stu-id="6d260-140">You can use templates toosupport cloud-hosted capabilities, including individual software packages or composite offerings that are offered toointernal lines of business.</span></span> <span data-ttu-id="6d260-141">複合供應項目的一個範例是，在預先定義的網路拓撲上，利用最佳化且已連接的組態來提供的「分析即為服務」(分析、視覺化和其他技術)。</span><span class="sxs-lookup"><span data-stu-id="6d260-141">An example of a composite offering would be analytics-as-a-service—analytics, visualization, and other technologies—delivered in an optimized, connected configuration on a predefined network topology.</span></span>

<span data-ttu-id="6d260-142">雲端託管的功能會受到 hello 安全性與角色建立 hello 供應項目上所建立的雲端容量的考量。</span><span class="sxs-lookup"><span data-stu-id="6d260-142">Cloud-hosted capabilities are affected by hello security and role considerations established by hello cloud capacity offering on which they’re built.</span></span> <span data-ttu-id="6d260-143">這些功能會依原樣提供，或提供來做為受管理的服務。</span><span class="sxs-lookup"><span data-stu-id="6d260-143">These capabilities are offered as is or as a managed service.</span></span> <span data-ttu-id="6d260-144">Hello 後者，存取限制的角色，才能進行管理的 tooenable 存取到 hello 環境。</span><span class="sxs-lookup"><span data-stu-id="6d260-144">For hello latter, access-constrained roles are required tooenable access into hello environment for management purposes.</span></span>

## <a name="cloud-service-vendors"></a><span data-ttu-id="6d260-145">雲端服務廠商</span><span class="sxs-lookup"><span data-stu-id="6d260-145">Cloud service vendors</span></span>
<span data-ttu-id="6d260-146">之後談話 toomany Csv，找到多個方法，您可以採取 toodeploy 服務向客戶和相關聯的需求。</span><span class="sxs-lookup"><span data-stu-id="6d260-146">After talking toomany CSVs, we identified multiple approaches you can take toodeploy services for your customers and associated requirements.</span></span>

### <a name="csv-hosted-offering"></a><span data-ttu-id="6d260-147">CSV 裝載的供應項目</span><span class="sxs-lookup"><span data-stu-id="6d260-147">CSV-hosted offering</span></span>
<span data-ttu-id="6d260-148">如果您在自己的 Azure 訂用帳戶中裝載您供應項目，則有兩種常見的裝載方法：針對每位客戶部署不同的部署，或部署縮放單位來支持針對所有客戶使用的共用基礎結構。</span><span class="sxs-lookup"><span data-stu-id="6d260-148">If you host your offering in your own Azure subscription, two hosting approaches are common: deploying a distinct deployment for every customer or deploying scale units that underpin a shared infrastructure used for all customers.</span></span>

* <span data-ttu-id="6d260-149">**針對每位客戶進行不同的部署。**</span><span class="sxs-lookup"><span data-stu-id="6d260-149">**Distinct deployments for each customer.**</span></span> <span data-ttu-id="6d260-150">針對每位客戶進行不同的部署，需要具備不同已知組態的固定拓撲。</span><span class="sxs-lookup"><span data-stu-id="6d260-150">Distinct deployments per customer require fixed topologies of different known configurations.</span></span> <span data-ttu-id="6d260-151">這些部署可能會有不同的虛擬機器 (VM) 大小、各種不同的節點數目，以及不同的相關聯儲存體數量。</span><span class="sxs-lookup"><span data-stu-id="6d260-151">These deployments may have different virtual machine (VM) sizes, varying numbers of nodes, and different amounts of associated storage.</span></span> <span data-ttu-id="6d260-152">部署的標記可用來彙總每位客戶的帳單。</span><span class="sxs-lookup"><span data-stu-id="6d260-152">Tagging of deployments is used for roll-up billing of each customer.</span></span> <span data-ttu-id="6d260-153">RBAC 可能已啟用的 tooallow 客戶存取 tooaspects 其雲端環境。</span><span class="sxs-lookup"><span data-stu-id="6d260-153">RBAC may be enabled tooallow customers access tooaspects of their cloud environment.</span></span>
* <span data-ttu-id="6d260-154">**共用多租用戶環境中的縮放單位。**</span><span class="sxs-lookup"><span data-stu-id="6d260-154">**Scale units in shared multi-tenant environments.**</span></span> <span data-ttu-id="6d260-155">範本可以代表多租用戶環境的縮放單位。</span><span class="sxs-lookup"><span data-stu-id="6d260-155">A template can represent a scale unit for multi-tenant environments.</span></span> <span data-ttu-id="6d260-156">在此情況下，hello 相同的基礎結構是使用的 toosupport 所有客戶。</span><span class="sxs-lookup"><span data-stu-id="6d260-156">In this case, hello same infrastructure is used toosupport all customers.</span></span> <span data-ttu-id="6d260-157">hello 部署代表一組提供的容量 hello 裝載供應項目，例如使用者人數和交易數目的層級的資源。</span><span class="sxs-lookup"><span data-stu-id="6d260-157">hello deployments represent a group of resources that deliver a level of capacity for hello hosted offering, such as number of users and number of transactions.</span></span> <span data-ttu-id="6d260-158">這些縮放單位會隨著需求增加或減少。</span><span class="sxs-lookup"><span data-stu-id="6d260-158">These scale units are increased or decreased as demand requires.</span></span>

### <a name="csv-offering-injected-into-customer-subscription"></a><span data-ttu-id="6d260-159">插入客戶訂用帳戶的 CSV 供應項目</span><span class="sxs-lookup"><span data-stu-id="6d260-159">CSV offering injected into customer subscription</span></span>
<span data-ttu-id="6d260-160">您可以 toodeploy 軟體到擁有一般客戶的訂閱。</span><span class="sxs-lookup"><span data-stu-id="6d260-160">You may want toodeploy your software into subscriptions owned by end customers.</span></span> <span data-ttu-id="6d260-161">您可以使用範本 toodeploy 不同部署到客戶的 Azure 帳戶。</span><span class="sxs-lookup"><span data-stu-id="6d260-161">You can use templates toodeploy distinct deployments into a customer’s Azure account.</span></span>

<span data-ttu-id="6d260-162">這些部署使用 RBAC，因此您可以更新和管理 hello 客戶的帳戶中的 hello 部署。</span><span class="sxs-lookup"><span data-stu-id="6d260-162">These deployments use RBAC so you can update and manage hello deployment within hello customer’s account.</span></span>

### <a name="azure-marketplace"></a><span data-ttu-id="6d260-163">Azure Marketplace</span><span class="sxs-lookup"><span data-stu-id="6d260-163">Azure Marketplace</span></span>
<span data-ttu-id="6d260-164">tooadvertise 和賣出透過服務商場，例如 Azure Marketplace 供應項目，您可以開發範本 toodeliver 不同類型的客戶的 Azure 帳戶中執行的部署。</span><span class="sxs-lookup"><span data-stu-id="6d260-164">tooadvertise and sell your offerings through a marketplace, such as Azure Marketplace, you can develop templates toodeliver distinct types of deployments that run in a customer’s Azure account.</span></span> <span data-ttu-id="6d260-165">這些不同的部署通常可以用 T 恤尺寸 (小型、中型、大型)、產品/對象類型 (社群、開發人員、企業) 或功能類型 (基本、高可用性) 來描述。</span><span class="sxs-lookup"><span data-stu-id="6d260-165">These distinct deployments can be typically described as a t-shirt size (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span></span>  <span data-ttu-id="6d260-166">在某些情況下，這些類型可讓您 toospecify hello 部署，例如 VM 類型或磁碟數目的某些屬性。</span><span class="sxs-lookup"><span data-stu-id="6d260-166">In some cases, these types allow you toospecify certain attributes of hello deployment, such as VM type or number of disks.</span></span>

## <a name="oss-projects"></a><span data-ttu-id="6d260-167">OSS 專案</span><span class="sxs-lookup"><span data-stu-id="6d260-167">OSS projects</span></span>
<span data-ttu-id="6d260-168">開放原始碼專案內的資源管理員範本可讓社群 toodeploy 快速使用經過證實的作法的方案。</span><span class="sxs-lookup"><span data-stu-id="6d260-168">Within open source projects, Resource Manager templates enable a community toodeploy a solution quickly using proven practices.</span></span> <span data-ttu-id="6d260-169">您可以儲存範本 GitHub 儲存機制中，好讓 hello 社群可以修改它們經過一段時間。</span><span class="sxs-lookup"><span data-stu-id="6d260-169">You can store templates in a GitHub repository so hello community can revise them over time.</span></span> <span data-ttu-id="6d260-170">使用者可在自己的 Azure 訂用帳戶中部署這些範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-170">Users deploy these templates in their own Azure subscriptions.</span></span>

<span data-ttu-id="6d260-171">hello 下列各節列出您設計您的方案之前需要 tooconsider hello 項目。</span><span class="sxs-lookup"><span data-stu-id="6d260-171">hello following sections identify hello things you need tooconsider before designing your solution.</span></span>

## <a name="identifying-what-is-outside-and-inside-a-vm"></a><span data-ttu-id="6d260-172">識別 VM 內部和外部的功能</span><span class="sxs-lookup"><span data-stu-id="6d260-172">Identifying what is outside and inside a VM</span></span>
<span data-ttu-id="6d260-173">設計您的範本時，它會是很有幫助 toolook hello 需求方面外部和內部 hello 虛擬機器 (Vm):</span><span class="sxs-lookup"><span data-stu-id="6d260-173">As you design your template, it’s helpful toolook at hello requirements in terms of what's outside and inside hello virtual machines (VMs):</span></span>

* <span data-ttu-id="6d260-174">外部表示 Vm 和其他資源，例如 hello 網路拓樸、 標記，參考 toohello 憑證/機密資料，並且以角色為基礎的存取控制、 以部署的 hello。</span><span class="sxs-lookup"><span data-stu-id="6d260-174">Outside means hello VMs and other resources of your deployment, such as hello network topology, tagging, references toohello certs/secrets, and role-based access control.</span></span> <span data-ttu-id="6d260-175">這些資源全都是您範本的一部分。</span><span class="sxs-lookup"><span data-stu-id="6d260-175">All these resources are part of your template.</span></span>
* <span data-ttu-id="6d260-176">內部表示 hello 安裝軟體，以及整體預期狀態設定。</span><span class="sxs-lookup"><span data-stu-id="6d260-176">Inside means hello installed software and overall desired state configuration.</span></span> <span data-ttu-id="6d260-177">其他機制 (例如 VM 延伸模組或指令碼) 可完整使用或部分使用。</span><span class="sxs-lookup"><span data-stu-id="6d260-177">Other mechanisms, such as VM extensions or scripts, are used in whole or in part.</span></span> <span data-ttu-id="6d260-178">這些機制可能會識別並 hello 範本所執行，但不在其中。</span><span class="sxs-lookup"><span data-stu-id="6d260-178">These mechanisms may be identified and executed by hello template but aren’t in it.</span></span>

<span data-ttu-id="6d260-179">您會執行 「 內部 hello 方塊 」 活動的常見範例包含-</span><span class="sxs-lookup"><span data-stu-id="6d260-179">Common examples of activities you would do “inside hello box” include -</span></span>  

* <span data-ttu-id="6d260-180">安裝或移除伺服器角色和功能</span><span class="sxs-lookup"><span data-stu-id="6d260-180">Install or remove server roles and features</span></span>
* <span data-ttu-id="6d260-181">安裝及設定軟體在 hello 節點或叢集層級</span><span class="sxs-lookup"><span data-stu-id="6d260-181">Install and configure software at hello node or cluster level</span></span>
* <span data-ttu-id="6d260-182">在 Web 伺服器上部署網站</span><span class="sxs-lookup"><span data-stu-id="6d260-182">Deploy websites on a web server</span></span>
* <span data-ttu-id="6d260-183">部署資料庫結構描述</span><span class="sxs-lookup"><span data-stu-id="6d260-183">Deploy database schemas</span></span>
* <span data-ttu-id="6d260-184">管理登錄或其他類型的組態設定</span><span class="sxs-lookup"><span data-stu-id="6d260-184">Manage registry or other types of configuration settings</span></span>
* <span data-ttu-id="6d260-185">管理檔案和目錄</span><span class="sxs-lookup"><span data-stu-id="6d260-185">Manage files and directories</span></span>
* <span data-ttu-id="6d260-186">啟動、停止及管理處理程序和服務</span><span class="sxs-lookup"><span data-stu-id="6d260-186">Start, stop, and manage processes and services</span></span>
* <span data-ttu-id="6d260-187">管理本機群組和使用者帳戶</span><span class="sxs-lookup"><span data-stu-id="6d260-187">Manage local groups and user accounts</span></span>
* <span data-ttu-id="6d260-188">安裝和管理封裝 (.msi、.exe、yum 等等)</span><span class="sxs-lookup"><span data-stu-id="6d260-188">Install and manage packages (.msi, .exe, yum, etc.)</span></span>
* <span data-ttu-id="6d260-189">管理環境變數</span><span class="sxs-lookup"><span data-stu-id="6d260-189">Manage environment variables</span></span>
* <span data-ttu-id="6d260-190">執行原生指令碼 (Windows PowerShell、bash 等)</span><span class="sxs-lookup"><span data-stu-id="6d260-190">Run native scripts (Windows PowerShell, bash, etc.)</span></span>

### <a name="desired-state-configuration-dsc"></a><span data-ttu-id="6d260-191">期望狀態組態 (DSC)</span><span class="sxs-lookup"><span data-stu-id="6d260-191">Desired state configuration (DSC)</span></span>
<span data-ttu-id="6d260-192">思考 hello 的超過部署 Vm 的內部狀態，您會想 toomake 確定此部署不"漂移"從 hello 組態，定義並簽入原始檔控制。</span><span class="sxs-lookup"><span data-stu-id="6d260-192">Thinking about hello internal state of your VMs beyond deployment, you want toomake sure this deployment doesn’t "drift" from hello configuration that you have defined and checked into source control.</span></span> <span data-ttu-id="6d260-193">這個方法可確保您的開發人員或操作人員不進行臨機操作變更 tooan 環境不驗證、 測試，或在原始檔控制記錄。</span><span class="sxs-lookup"><span data-stu-id="6d260-193">This approach ensures your developers or operations staff don’t make ad-hoc changes tooan environment that are not vetted, tested, or recorded in source control.</span></span> <span data-ttu-id="6d260-194">此控制項是很重要，因為 hello 手動變更原始檔控制中。</span><span class="sxs-lookup"><span data-stu-id="6d260-194">This control is important, because hello manual changes are not in source control.</span></span> <span data-ttu-id="6d260-195">它們並非也 hello 標準部署的一部分，將會影響未來自動化的 hello 軟體部署。</span><span class="sxs-lookup"><span data-stu-id="6d260-195">They are also not part of hello standard deployment and will impact future automated deployments of hello software.</span></span>

<span data-ttu-id="6d260-196">從安全性觀點來看，除了您的內部員工，期望狀態組態也很重要。</span><span class="sxs-lookup"><span data-stu-id="6d260-196">Beyond your internal employees, desired state configuration is also important from a security perspective.</span></span> <span data-ttu-id="6d260-197">駭客會定期嘗試 toocompromise，並利用軟體系統。</span><span class="sxs-lookup"><span data-stu-id="6d260-197">Hackers are regularly trying toocompromise and exploit software systems.</span></span> <span data-ttu-id="6d260-198">成功時，它是常見的 tooinstall 檔案，並變更 hello 遭入侵的系統狀態。</span><span class="sxs-lookup"><span data-stu-id="6d260-198">When successful, it's common tooinstall files and otherwise change hello state of a compromised system.</span></span> <span data-ttu-id="6d260-199">您可以使用預期的狀態設定，來識別 hello 預期和實際狀態之間的差異和還原已知的組態項目。</span><span class="sxs-lookup"><span data-stu-id="6d260-199">Using desired state configuration, you can identify deltas between hello desired and actual state and restore a known configuration.</span></span>

<span data-ttu-id="6d260-200">有個 hello 最受歡迎的機制 DSC-PowerShell DSC、 Chef 和 Puppet 資源擴充功能。</span><span class="sxs-lookup"><span data-stu-id="6d260-200">There are resource extensions for hello most popular mechanisms for DSC - PowerShell DSC, Chef, and Puppet.</span></span> <span data-ttu-id="6d260-201">每個延伸模組可以部署 VM 的 hello 初始狀態，而且也會使用的 toomake 確定 hello 需要維護狀態。</span><span class="sxs-lookup"><span data-stu-id="6d260-201">Each of these extensions can deploy hello initial state of your VM and also be used toomake sure hello desired state is maintained.</span></span>

## <a name="common-template-scopes"></a><span data-ttu-id="6d260-202">通用範本範圍</span><span class="sxs-lookup"><span data-stu-id="6d260-202">Common template scopes</span></span>
<span data-ttu-id="6d260-203">在我們的經驗中，我們看到了範圍所浮現的三個主要解決方案範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-203">In our experience, we’ve seen three key solution templates scopes emerge.</span></span> <span data-ttu-id="6d260-204">Hello 下列各節說明這些 – 容量、 功能，以及端對端方案 – 的三個範圍。</span><span class="sxs-lookup"><span data-stu-id="6d260-204">These three scopes – capacity, capability, and end-to-end solution – are described in hello following sections.</span></span>

### <a name="capacity-scope"></a><span data-ttu-id="6d260-205">容量範圍</span><span class="sxs-lookup"><span data-stu-id="6d260-205">Capacity scope</span></span>
<span data-ttu-id="6d260-206">容量範圍提供一組標準的預先設定符合規定及原則 toobe 拓撲中的資源。</span><span class="sxs-lookup"><span data-stu-id="6d260-206">A capacity scope delivers a set of resources in a standard topology that is pre-configured toobe in compliance with regulations and policies.</span></span> <span data-ttu-id="6d260-207">hello 最常見的範例部署中的企業 IT 或 si 亦然案例的標準的開發環境。</span><span class="sxs-lookup"><span data-stu-id="6d260-207">hello most common example is deploying a standard development environment in an Enterprise IT or SI scenario.</span></span>

### <a name="capability-scope"></a><span data-ttu-id="6d260-208">功能範圍</span><span class="sxs-lookup"><span data-stu-id="6d260-208">Capability scope</span></span>
<span data-ttu-id="6d260-209">功能範圍著重於部署和設定特定技術的拓撲。</span><span class="sxs-lookup"><span data-stu-id="6d260-209">A capability scope is focused on deploying and configuring a topology for a given technology.</span></span> <span data-ttu-id="6d260-210">常見案例包括像是 SQL Server、Cassandra、Hadoop 等技術。</span><span class="sxs-lookup"><span data-stu-id="6d260-210">Common scenarios including technologies such as SQL Server, Cassandra, Hadoop.</span></span>

### <a name="end-to-end-solution-scope"></a><span data-ttu-id="6d260-211">端對端解決方案範圍</span><span class="sxs-lookup"><span data-stu-id="6d260-211">End-to-end solution scope</span></span>
<span data-ttu-id="6d260-212">端對端解決方案範圍目標超過單一的功能，並改為著重在提供多個功能所組成的結束 tooend 解決方案。</span><span class="sxs-lookup"><span data-stu-id="6d260-212">An End-to-End Solution Scope is targeted beyond a single capability, and instead focused on delivering an end tooend solution comprised of multiple capabilities.</span></span>  

<span data-ttu-id="6d260-213">已設定解決方案範圍的範本範圍會將其本身顯示為一組具有一或多個已設定功能範圍的範本，其中含有解決方案特定的資源、邏輯和期望狀態。</span><span class="sxs-lookup"><span data-stu-id="6d260-213">A solution-scoped template scope manifests itself as a set of one or more capability-scoped templates with solution-specific resources, logic, and desired state.</span></span> <span data-ttu-id="6d260-214">方案範圍範本的範例是結束 tooend 資料管線解決方案範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-214">An example of a solution-scoped template is an end tooend data pipeline solution template.</span></span> <span data-ttu-id="6d260-215">hello 範本可能會混合解決方案專用拓撲和狀態，例如 Kafka、 風暴，以及 Hadoop 的多個功能範圍方案範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-215">hello template might mix solution-specific topology and state with multiple capability-scoped solution templates such as Kafka, Storm, and Hadoop.</span></span>

## <a name="choosing-free-form-vs-known-configurations"></a><span data-ttu-id="6d260-216">選擇自由格式與已知的組態</span><span class="sxs-lookup"><span data-stu-id="6d260-216">Choosing free-form vs. known configurations</span></span>
<span data-ttu-id="6d260-217">您一開始可能會認為範本應該授與取用者 hello 具有彈性，但許多考量影響 hello 選擇是否 toouse 自由格式設定與已知的組態。</span><span class="sxs-lookup"><span data-stu-id="6d260-217">You might initially think a template should give consumers hello utmost flexibility, but many considerations affect hello choice of whether toouse free-form configurations vs. known configurations.</span></span> <span data-ttu-id="6d260-218">本章節識別 hello 主要客戶需求和技術形狀共用此文件中的 hello 方法的考量。</span><span class="sxs-lookup"><span data-stu-id="6d260-218">This section identifies hello key customer requirements and technical considerations that shaped hello approach shared in this document.</span></span>

### <a name="free-form-configurations"></a><span data-ttu-id="6d260-219">自由格式組態</span><span class="sxs-lookup"><span data-stu-id="6d260-219">Free-form configurations</span></span>
<span data-ttu-id="6d260-220">Hello 介面上的聲音理想自由形式的組態。</span><span class="sxs-lookup"><span data-stu-id="6d260-220">On hello surface, free-form configurations sound ideal.</span></span> <span data-ttu-id="6d260-221">它們 tooselect VM 類型可讓您和提供任意的節點數目，並且附加這些節點的磁碟，這樣做為參數 tooa 範本和。</span><span class="sxs-lookup"><span data-stu-id="6d260-221">They allow you tooselect a VM type and provide an arbitrary number of nodes and attached disks for those nodes — and do so as parameters tooa template.</span></span> <span data-ttu-id="6d260-222">不過，這個做法不適用於某些案例。</span><span class="sxs-lookup"><span data-stu-id="6d260-222">However, this approach is not ideal for some scenarios.</span></span>

<span data-ttu-id="6d260-223">在[虛擬機器的大小](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)，識別出 hello 不同 VM 類型和可用的大小，和持久的 hello 數的每個磁碟 （2、 4、 8、 16 個 / 32），可以附加。</span><span class="sxs-lookup"><span data-stu-id="6d260-223">In [Sizes for virtual machines](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), hello different VM types and available sizes are identified, and each of hello number of durable disks (2, 4, 8, 16, or 32) that can be attached.</span></span> <span data-ttu-id="6d260-224">每個連接的磁碟可提供 500 個 IOPS，而您可以利用這個 IOPS 數目做為乘數來共用這些磁碟數目的倍數。</span><span class="sxs-lookup"><span data-stu-id="6d260-224">Each attached disk provides 500 IOPS and multiples of these disks can be pooled for a multiplier of that number of IOPS.</span></span> <span data-ttu-id="6d260-225">例如，16 個磁碟可以是共用的 tooprovide 8000 的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="6d260-225">For example, 16 disks can be pooled tooprovide 8,000 IOPS.</span></span> <span data-ttu-id="6d260-226">集區會透過 hello 作業系統，在 Linux 中使用 Microsoft Windows 儲存空間或獨立磁碟 (RAID) 的備援陣列中的組態來完成。</span><span class="sxs-lookup"><span data-stu-id="6d260-226">Pooling is done with configuration in hello operating system, using Microsoft Windows Storage Spaces or redundant array of inexpensive disks (RAID) in Linux.</span></span>

<span data-ttu-id="6d260-227">自由格式的組態可讓 hello 選取數個 VM 執行個體，不同 VM 類型，且這些執行個體，如 hello VM 類型的各種磁碟大小，和一或多個指令碼 tooconfigure hello VM 內容。</span><span class="sxs-lookup"><span data-stu-id="6d260-227">A free-form configuration enables hello selection several VM instances, various VM types and sizes for those instances, various disks for hello VM type, and one or more scripts tooconfigure hello VM contents.</span></span>

<span data-ttu-id="6d260-228">通常，部署可能會有多種類型的節點 (例如主要和資料節點)，因此，經常會針對每個節點類型提供此彈性。</span><span class="sxs-lookup"><span data-stu-id="6d260-228">It is common that a deployment may have multiple types of nodes, such as master and data nodes, so this flexibility is often provided for every node type.</span></span>

<span data-ttu-id="6d260-229">當您開始的任何重要性 toodeploy 叢集，您會開始 toowork 處理這些複雜的案例。</span><span class="sxs-lookup"><span data-stu-id="6d260-229">As you start toodeploy clusters of any significance, you begin toowork with these complex scenarios.</span></span> <span data-ttu-id="6d260-230">如果您已部署 Hadoop 叢集，例如，8 主要節點和 200 資料節點，以及每個主要節點上的 4 連接的磁碟管理的集區和每個資料節點的集區連接 16 個磁碟具有您必須 208 Vm 和 3,232 磁碟 toomanage。</span><span class="sxs-lookup"><span data-stu-id="6d260-230">If you were deploying a Hadoop cluster, for example, with 8 master nodes and 200 data nodes, and pooled 4 attached disks on each master node and pooled 16 attached disks per data node, you would have 208 VMs and 3,232 disks toomanage.</span></span>

<span data-ttu-id="6d260-231">儲存體帳戶，將節流處理的要求上述其識別的 20000 交易/秒限制，所以您應該查看資料分割的儲存體帳戶，並使用計算 toodetermine hello 適當數目的儲存體帳戶 tooaccommodate 此拓撲。</span><span class="sxs-lookup"><span data-stu-id="6d260-231">A storage account will throttle requests above its identified 20,000 transactions/second limit, so you should look at storage account partitioning and use calculations toodetermine hello appropriate number of storage accounts tooaccommodate this topology.</span></span> <span data-ttu-id="6d260-232">指定 hello 許多 hello 自由格式的方法，動態計算所支援的組合是必要的 toodetermine hello 適當的資料分割。</span><span class="sxs-lookup"><span data-stu-id="6d260-232">Given hello multitude of combinations supported by hello free-form approach, dynamic calculations are required toodetermine hello appropriate partitioning.</span></span> <span data-ttu-id="6d260-233">hello Azure 資源管理員範本語言不目前提供數學函式，所以您必須執行這些計算程式碼中，產生唯一的硬式編碼的範本與 hello 適當的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="6d260-233">hello Azure Resource Manager Template Language does not presently provide mathematical functions, so you must perform these calculations in code, generating a unique, hard-coded template with hello appropriate details.</span></span>

<span data-ttu-id="6d260-234">在企業 IT 和 SI 案例中，某人必須維護 hello 範本，以及支援一或多個組織部署的 hello 拓撲。</span><span class="sxs-lookup"><span data-stu-id="6d260-234">In enterprise IT and SI scenarios, someone must maintain hello templates and support hello deployed topologies for one or more organizations.</span></span> <span data-ttu-id="6d260-235">這個額外負擔 (每位客戶都有不同的組態和範本) 並不盡理想。</span><span class="sxs-lookup"><span data-stu-id="6d260-235">This additional overhead — different configurations and templates for each customer — is far from desirable.</span></span>

<span data-ttu-id="6d260-236">您可以使用這些範本 toodeploy 環境中客戶的 Azure 訂用帳戶，但同時公司的 IT 團隊和 Csv 通常將它們部署到他們自己的訂用帳戶，使用計費函式 toobill 他們的客戶。</span><span class="sxs-lookup"><span data-stu-id="6d260-236">You can use these templates toodeploy environments in your customer’s Azure subscription, but both corporate IT teams and CSVs typically deploy them into their own subscriptions, using a chargeback function toobill their customers.</span></span> <span data-ttu-id="6d260-237">在這些情況下，hello 目標中是用於多位客戶 toodeploy 容量的訂用帳戶和保持部署密集的方式擴展到 hello 訂閱 toominimize 訂用帳戶蔓延到集區，也就是多個訂用帳戶 toomanage。</span><span class="sxs-lookup"><span data-stu-id="6d260-237">In these scenarios, hello goal is toodeploy capacity for multiple customers across a pool of subscriptions and keep deployments densely populated into hello subscriptions toominimize subscription sprawl—that is, more subscriptions toomanage.</span></span> <span data-ttu-id="6d260-238">真正動態部署大小，以達到這種類型的密度需要仔細規劃和其他開發來代表 hello 組織 scaffolding 工作。</span><span class="sxs-lookup"><span data-stu-id="6d260-238">With truly dynamic deployment sizes, achieving this type of density requires careful planning and additional development for scaffolding work on behalf of hello organization.</span></span>

<span data-ttu-id="6d260-239">此外，您無法建立訂用帳戶，透過 API 呼叫，但必須透過 hello 入口網站手動執行。</span><span class="sxs-lookup"><span data-stu-id="6d260-239">In addition, you can’t create subscriptions via an API call but must do so manually through hello portal.</span></span> <span data-ttu-id="6d260-240">任何產生的訂用帳戶蔓延到 hello 訂用帳戶數目增加時，需要人為介入，就無法利用其自動化。</span><span class="sxs-lookup"><span data-stu-id="6d260-240">As hello number of subscriptions increases, any resulting subscription sprawl requires human intervention—it can’t be automated.</span></span> <span data-ttu-id="6d260-241">很多，所以部署的 hello 大小可以有變化，您必須 toopre 佈建訂用帳戶數目手動 tooensure 訂用帳戶可用。</span><span class="sxs-lookup"><span data-stu-id="6d260-241">With so much variability in hello sizes of deployments, you would have toopre-provision a number of subscriptions manually tooensure subscriptions are available.</span></span>

<span data-ttu-id="6d260-242">考慮這所有因素，真正的自由格式組態乍看之下比較不具吸引力。</span><span class="sxs-lookup"><span data-stu-id="6d260-242">Considering all these factors, a truly free-form configuration is less appealing than at first blush.</span></span>

### <a name="known-configurations--hello-t-shirt-sizing-approach"></a><span data-ttu-id="6d260-243">已知的組態 — hello t 恤調整大小方法</span><span class="sxs-lookup"><span data-stu-id="6d260-243">Known configurations — hello t-shirt sizing approach</span></span>
<span data-ttu-id="6d260-244">而是提供範本，提供總彈性和無數的變化，我們的經驗中常見的模式是 tooprovide hello 能力 tooselect 已知的組態 — 標準 t 恤作用中，例如沙箱小型、 中型和大型調整大小。</span><span class="sxs-lookup"><span data-stu-id="6d260-244">Rather than offer a template that provides total flexibility and countless variations, in our experience a common pattern is tooprovide hello ability tooselect known configurations — in effect, standard t-shirt sizes such as sandbox, small, medium, and large.</span></span> <span data-ttu-id="6d260-245">T 恤尺寸的其他範例包括產品供應項目，例如社群版本或企業版本。</span><span class="sxs-lookup"><span data-stu-id="6d260-245">Other examples of t-shirt sizes are product offerings, such as community edition or enterprise edition.</span></span>  <span data-ttu-id="6d260-246">在其他情況下，這可能是某種技術的工作負載特定組態，例如，對應減少或沒有 SQL。</span><span class="sxs-lookup"><span data-stu-id="6d260-246">In other cases, it may be workload-specific configurations of a technology – such as map reduce or no sql.</span></span>

<span data-ttu-id="6d260-247">許多企業 IT 組織、OSS 廠商和 SI 目前都能在內部部署且虛擬化的環境 (企業) 中或做為「軟體即為服務」(SaaS) 供應項目 (CSV 和 OSV)，使用這種方式來使他們的供應項目可供使用。</span><span class="sxs-lookup"><span data-stu-id="6d260-247">Many enterprise IT organizations, OSS vendors, and SIs make their offerings available today in this way in on-premises, virtualized environments (enterprises) or as software-as-a-service (SaaS) offerings (CSVs and OSVs).</span></span>

<span data-ttu-id="6d260-248">這種方法可針對預先為客戶設定好的各種大小提供良好且已知的組態。</span><span class="sxs-lookup"><span data-stu-id="6d260-248">This approach provides good, known configurations of varying sizes that are preconfigured for customers.</span></span> <span data-ttu-id="6d260-249">沒有已知的設定，客戶必須判斷在自己的叢集大小調整，納入平台資源條件約束，並執行數學 tooidentify hello 產生分割的儲存體帳戶和其他資源 （因為 toocluster 大小和資源條件約束）。</span><span class="sxs-lookup"><span data-stu-id="6d260-249">Without known configurations, end customers must determine cluster sizing on their own, factor in platform resource constraints, and do math tooidentify hello resulting partitioning of storage accounts and other resources (due toocluster size and resource constraints).</span></span> <span data-ttu-id="6d260-250">已知的組態可讓客戶 tooeasily 選取 hello 右 t 恤尺寸 — 也就是給定的部署。</span><span class="sxs-lookup"><span data-stu-id="6d260-250">Known configurations enable customers tooeasily select hello right t-shirt size—that is, a given deployment.</span></span> <span data-ttu-id="6d260-251">此外 toomaking hello 客戶更好的體驗，少數的已知設定更容易 toosupport 並可協助您提供更高的密度。</span><span class="sxs-lookup"><span data-stu-id="6d260-251">In addition toomaking a better experience for hello customer, a small number of known configurations is easier toosupport and can help you deliver a higher level of density.</span></span>

<span data-ttu-id="6d260-252">著重於 T 恤尺寸的已知組態方法在某個尺寸內可能也會擁有各種節點數目。</span><span class="sxs-lookup"><span data-stu-id="6d260-252">A known configuration approach focused on t-shirt sizes may also have varying number of nodes within a size.</span></span> <span data-ttu-id="6d260-253">例如，小型 T 恤尺寸可能介於 3 到 10 個節點之間。</span><span class="sxs-lookup"><span data-stu-id="6d260-253">For example, a small t-shirt size may be between 3 and 10 nodes.</span></span>  <span data-ttu-id="6d260-254">hello t 恤尺寸會設計的 tooaccommodate too10 節點上，提供 hello 消費者 hello 能力 toomake 自由格式選取項目向上 toohello 識別的最大大小。</span><span class="sxs-lookup"><span data-stu-id="6d260-254">hello t-shirt size would be designed tooaccommodate up too10 nodes and provide hello consumer hello ability toomake free form selections up toohello maximum size identified.</span></span>  

<span data-ttu-id="6d260-255">根據工作負載類型 t 恤尺寸可能更多的自由格式在本質上就可以部署，但是會有工作負載的不同節點大小和 hello 軟體的組態 hello 節點上的節點的 hello 數目而言。</span><span class="sxs-lookup"><span data-stu-id="6d260-255">A t-shirt size based on workload type, may be more free form in nature in terms of hello number of nodes that can be deployed but will have workload distinct node size and configuration of hello software on hello node.</span></span>

<span data-ttu-id="6d260-256">根據提供的產品，例如 community 或企業，可能會有不同的資源類型和可部署的節點數目上限的 t 恤大小通常與 toolicensing 考量或功能可用性跨 hello 不同供應項目。</span><span class="sxs-lookup"><span data-stu-id="6d260-256">T-shirt sizes based on product offerings, such as community or Enterprise, may have distinct resource types and maximum number of nodes that can be deployed, typically tied toolicensing considerations or feature availability across hello different offerings.</span></span>

<span data-ttu-id="6d260-257">您也可以配合客戶具有使用 hello JSON 為基礎的範本的唯一變數。</span><span class="sxs-lookup"><span data-stu-id="6d260-257">You can also accommodate customers with unique variants using hello JSON-based templates.</span></span> <span data-ttu-id="6d260-258">當處理極端值，您可以合併 hello 適當規劃和開發、 支援和成本的考量。</span><span class="sxs-lookup"><span data-stu-id="6d260-258">When dealing with outliers, you can incorporate hello appropriate planning and considerations for development, support, and costing.</span></span>

<span data-ttu-id="6d260-259">根據 hello 客戶範本耗用情形，以及識別這個文件的 hello 開頭的需求，我們所識別的範本分解的模式。</span><span class="sxs-lookup"><span data-stu-id="6d260-259">Based on hello customer template consumption scenarios, and requirements identified at hello start of this document, we identified a pattern for template decomposition.</span></span>

## <a name="capacity-and-capability-scoped-solution-templates"></a><span data-ttu-id="6d260-260">已設定容量和功能範圍的解決方案範本</span><span class="sxs-lookup"><span data-stu-id="6d260-260">Capacity and capability-scoped solution templates</span></span>
<span data-ttu-id="6d260-261">分解提供支援重複使用擴充性測試，和工具的模組化方法 tootemplate 開發。</span><span class="sxs-lookup"><span data-stu-id="6d260-261">Decomposition provides a modular approach tootemplate development that supports reuse, extensibility, testing, and tooling.</span></span> <span data-ttu-id="6d260-262">本章節會詳細說明如何分解方法可以套用的 tootemplates 具有容量或功能領域。</span><span class="sxs-lookup"><span data-stu-id="6d260-262">This section provides detail on how a decomposition approach can be applied tootemplates with a Capacity or Capability scope.</span></span>

<span data-ttu-id="6d260-263">這種方法，主要範本會從範本取用者接收參數值，然後下游連結 tooseveral 類型的範本和指令碼，如下所示。</span><span class="sxs-lookup"><span data-stu-id="6d260-263">In this approach, a main template receives parameter values from a template consumer, then links tooseveral types of templates and scripts downstream as shown below.</span></span> <span data-ttu-id="6d260-264">參數、 靜態變數，並產生的變數是使用的 tooprovide 值出 hello 連結的範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-264">Parameters, static variables, and generated variables are used tooprovide values in and out of hello linked templates.</span></span>

![範本參數](./media/best-practices-resource-manager-design-templates/template-parameters.png)

<span data-ttu-id="6d260-266">**參數會傳遞 tooa 主要範本則 toolinked 範本**</span><span class="sxs-lookup"><span data-stu-id="6d260-266">**Parameters are passed tooa main template then toolinked templates**</span></span>

<span data-ttu-id="6d260-267">下列各節焦點 hello 類型的範本和單一範本就會分解成的指令碼的 hello。</span><span class="sxs-lookup"><span data-stu-id="6d260-267">hello following sections focus on hello types of templates and scripts that a single template is decomposed into.</span></span> <span data-ttu-id="6d260-268">hello 章節將用來傳遞各 hello 範本的狀態資訊的方法。</span><span class="sxs-lookup"><span data-stu-id="6d260-268">hello sections present approaches for passing state information among hello templates.</span></span> <span data-ttu-id="6d260-269">每個範本和 hello 指令碼中的型別 hello 映像描述以及範例。</span><span class="sxs-lookup"><span data-stu-id="6d260-269">Each template and hello script types in hello image are described along with examples.</span></span> <span data-ttu-id="6d260-270">如需內容相關範例，請參閱本文件稍後的＜整合在一起：範例實作＞。</span><span class="sxs-lookup"><span data-stu-id="6d260-270">For a contextual example, see "Putting it together: a sample implementation" later in this document.</span></span>

### <a name="template-metadata"></a><span data-ttu-id="6d260-271">範本中繼資料</span><span class="sxs-lookup"><span data-stu-id="6d260-271">Template metadata</span></span>
<span data-ttu-id="6d260-272">範本中繼資料 （hello metadata.json 檔案） 包含描述的範本，在 JSON 中，可讓人了和軟體系統讀取的索引鍵/值組。</span><span class="sxs-lookup"><span data-stu-id="6d260-272">Template metadata (hello metadata.json file) contains key/value pairs that describe a template in JSON, which can be read by humans and software systems.</span></span>

![範本中繼資料](./media/best-practices-resource-manager-design-templates/template-metadata.png)

<span data-ttu-id="6d260-274">**範本中繼資料描述 hello metadata.json 檔案中**</span><span class="sxs-lookup"><span data-stu-id="6d260-274">**Template metadata is described in hello metadata.json file**</span></span>

<span data-ttu-id="6d260-275">軟體代理程式可以擷取 hello metadata.json 檔案，並將 hello 資訊和連結 toohello 範本發行網頁或目錄中。</span><span class="sxs-lookup"><span data-stu-id="6d260-275">Software agents can retrieve hello metadata.json file and publish hello information and a link toohello template in a web page or directory.</span></span> <span data-ttu-id="6d260-276">項目包括 itemDisplayName、description、summary、githubUsername 及 dateUpdated。</span><span class="sxs-lookup"><span data-stu-id="6d260-276">Elements include *itemDisplayName*, *description*, *summary*, *githubUsername*, and *dateUpdated*.</span></span>

<span data-ttu-id="6d260-277">以下顯示完整的範例檔案。</span><span class="sxs-lookup"><span data-stu-id="6d260-277">An example file is shown below in its entirety.</span></span>

    {
        "itemDisplayName": "PostgreSQL 9.3 on Ubuntu VMs",
        "description": "This template creates a PostgreSQL streaming-replication between a master and one or more slave servers each with 2 striped data disks. hello database servers are deployed into a private-only subnet with one publicly accessible jumpbox VM in a DMZ subnet with public IP.",
        "summary": "PostgreSQL stream-replication with multiple slave servers and a publicly accessible jumpbox VM",
        "githubUsername": "arsenvlad",
        "dateUpdated": "2015-04-24"
    }

### <a name="main-template"></a><span data-ttu-id="6d260-278">主要的範本</span><span class="sxs-lookup"><span data-stu-id="6d260-278">Main template</span></span>
<span data-ttu-id="6d260-279">hello 主要範本從使用者接收參數，會使用該資訊 toopopulate 複雜物件變數，並執行 hello 連結的範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-279">hello main template receives parameters from a user, uses that information toopopulate complex object variables, and executes hello linked templates.</span></span>

![主要的範本](./media/best-practices-resource-manager-design-templates/main-template.png)

<span data-ttu-id="6d260-281">**hello 主要範本會從使用者接收參數**</span><span class="sxs-lookup"><span data-stu-id="6d260-281">**hello main template receives parameters from a user**</span></span>

<span data-ttu-id="6d260-282">提供一個參數是已知的組態類型也稱為 hello t 恤大小參數，因為其標準化的值，例如小型、 中型或大型。</span><span class="sxs-lookup"><span data-stu-id="6d260-282">One parameter that is provided is a known configuration type also known as hello t-shirt size parameter because of its standardized values such as small, medium, or large.</span></span> <span data-ttu-id="6d260-283">實際上，您可以用多種方式使用此參數。</span><span class="sxs-lookup"><span data-stu-id="6d260-283">In practice, you can use this parameter in multiple ways.</span></span> <span data-ttu-id="6d260-284">如需詳細資訊，請參閱本文件稍後的＜已知組態資源範本＞。</span><span class="sxs-lookup"><span data-stu-id="6d260-284">For details, see "Known configuration resources template" later in this document.</span></span>

<span data-ttu-id="6d260-285">不論 hello 已知使用者參數所指定的設定部署一些資源。</span><span class="sxs-lookup"><span data-stu-id="6d260-285">Some resources are deployed regardless of hello known configuration specified by a user parameter.</span></span> <span data-ttu-id="6d260-286">這些資源都會使用單一的共用的資源範本佈建和共用的其他範本，以便先執行 hello 共用的資源的範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-286">These resources are provisioned using a single shared resource template and are shared by other templates, so hello shared resource template is run first.</span></span>

<span data-ttu-id="6d260-287">某些資源會選擇性地部署，不論 hello 指定已知的組態。</span><span class="sxs-lookup"><span data-stu-id="6d260-287">Some resources are deployed optionally regardless of hello specified known configuration.</span></span>

### <a name="shared-resources-template"></a><span data-ttu-id="6d260-288">共用的資源範本</span><span class="sxs-lookup"><span data-stu-id="6d260-288">Shared resources template</span></span>
<span data-ttu-id="6d260-289">此範本會提供所有已知組態上通用的資源。</span><span class="sxs-lookup"><span data-stu-id="6d260-289">This template delivers resources that are common across all known configurations.</span></span> <span data-ttu-id="6d260-290">它包含 hello 虛擬網路，可用性設定組，以及不論已部署的 hello 已知的組態範本都需要具備其他資源。</span><span class="sxs-lookup"><span data-stu-id="6d260-290">It contains hello virtual network, availability sets, and other resources that are required regardless of hello known configuration template that is deployed.</span></span>

![範本資源](./media/best-practices-resource-manager-design-templates/template-resources.png)

<span data-ttu-id="6d260-292">**共用的資源範本**</span><span class="sxs-lookup"><span data-stu-id="6d260-292">**Shared resources template**</span></span>

<span data-ttu-id="6d260-293">資源名稱，例如 hello 虛擬網路名稱，以 hello 主要範本為基礎。</span><span class="sxs-lookup"><span data-stu-id="6d260-293">Resource names, such as hello virtual network name, are based on hello main template.</span></span> <span data-ttu-id="6d260-294">您可以將其指定為該範本內的變數，或接收這些 hello 使用者，視需要由您的組織與參數。</span><span class="sxs-lookup"><span data-stu-id="6d260-294">You can specify them as a variable within that template or receive them as a parameter from hello user, as required by your organization.</span></span>

### <a name="optional-resources-template"></a><span data-ttu-id="6d260-295">選擇性資源範本</span><span class="sxs-lookup"><span data-stu-id="6d260-295">Optional resources template</span></span>
<span data-ttu-id="6d260-296">hello 選擇性資源範本包含以程式設計方式部署 hello 的參數或變數的值為基礎的資源。</span><span class="sxs-lookup"><span data-stu-id="6d260-296">hello optional resources template contains resources that are programmatically deployed based on hello value of a parameter or variable.</span></span>

![選擇性資源](./media/best-practices-resource-manager-design-templates/optional-resources.png)

<span data-ttu-id="6d260-298">**選擇性資源範本**</span><span class="sxs-lookup"><span data-stu-id="6d260-298">**Optional resources template**</span></span>

<span data-ttu-id="6d260-299">例如，您可以使用選擇性資源範本 tooconfigure 讓間接存取 tooa 部署環境的 hello jumpbox 公用網際網路。</span><span class="sxs-lookup"><span data-stu-id="6d260-299">For example, you can use an optional resources template tooconfigure a jumpbox that enables indirect access tooa deployed environment from hello public Internet.</span></span> <span data-ttu-id="6d260-300">您可以使用參數或變數 tooidentify，是否應該啟用 hello jumpbox 和 hello *concat*函式 toobuild hello 目標 hello 範本名稱，例如*jumpbox_enabled.json*。</span><span class="sxs-lookup"><span data-stu-id="6d260-300">You would use a parameter or variable tooidentify whether hello jumpbox should be enabled and hello *concat* function toobuild hello target name for hello template, such as *jumpbox_enabled.json*.</span></span> <span data-ttu-id="6d260-301">連結的範本會使用產生變數 tooinstall hello jumpbox hello。</span><span class="sxs-lookup"><span data-stu-id="6d260-301">Template linking would use hello resulting variable tooinstall hello jumpbox.</span></span>

<span data-ttu-id="6d260-302">您可以連結 hello 選擇性資源範本，從多個位置：</span><span class="sxs-lookup"><span data-stu-id="6d260-302">You can link hello optional resources template from multiple places:</span></span>

* <span data-ttu-id="6d260-303">當適用 tooevery 部署從 hello 共用的資源範本建立的參數驅動的連結。</span><span class="sxs-lookup"><span data-stu-id="6d260-303">When applicable tooevery deployment, create a parameter-driven link from hello shared resources template.</span></span>
* <span data-ttu-id="6d260-304">當適用 tooselect 已知的組態 — 比方說，只會在大型部署上安裝，建立從 hello 已知的組態範本參數具或變數急迫連結。</span><span class="sxs-lookup"><span data-stu-id="6d260-304">When applicable tooselect known configurations—for example, only install on large deployments—create a parameter-driven or variable-driven link from hello known configuration template.</span></span>

<span data-ttu-id="6d260-305">選擇性指定的資源是否可能不重點的 hello 範本的取用者而 hello 範本提供者。</span><span class="sxs-lookup"><span data-stu-id="6d260-305">Whether a given resource is optional may not be driven by hello template consumer but instead by hello template provider.</span></span> <span data-ttu-id="6d260-306">例如，您可能需要 toosatisfy 特定產品需求或產品附加元件 （一般 csv） 或 tooenforce 原則 (一般為 SIs 與企業 IT 群組)。</span><span class="sxs-lookup"><span data-stu-id="6d260-306">For example, you may need toosatisfy a particular product requirement or product add-on (common for CSVs) or tooenforce policies (common for SIs and enterprise IT groups).</span></span> <span data-ttu-id="6d260-307">在這些情況下，您可以使用變數 tooidentify 是否應該部署的 hello 資源。</span><span class="sxs-lookup"><span data-stu-id="6d260-307">In these cases, you can use a variable tooidentify whether hello resource should be deployed.</span></span>

### <a name="known-configuration-resources-template"></a><span data-ttu-id="6d260-308">已知組態資源範本</span><span class="sxs-lookup"><span data-stu-id="6d260-308">Known configuration resources template</span></span>
<span data-ttu-id="6d260-309">在 hello 主要範本中，參數可以是公開的 tooallow hello 範本的取用者 toospecify 所需的已知的設定 toodeploy。</span><span class="sxs-lookup"><span data-stu-id="6d260-309">In hello main template, a parameter can be exposed tooallow hello template consumer toospecify a desired known configuration toodeploy.</span></span> <span data-ttu-id="6d260-310">通常，這個已知組態會使用具有一組固定組態大小 (例如，沙箱、小型、中型和大型) 的 T 恤尺寸方法。</span><span class="sxs-lookup"><span data-stu-id="6d260-310">Often, this known configuration uses a t-shirt size approach with a set of fixed configuration sizes such as sandbox, small, medium, and large.</span></span>

![已知組態資源](./media/best-practices-resource-manager-design-templates/known-config.png)

<span data-ttu-id="6d260-312">**已知組態資源範本**</span><span class="sxs-lookup"><span data-stu-id="6d260-312">**Known configuration resources template**</span></span>

<span data-ttu-id="6d260-313">hello t 恤大小方法常用，但 hello 參數可代表任何已知的組態集。</span><span class="sxs-lookup"><span data-stu-id="6d260-313">hello t-shirt size approach is commonly used, but hello parameters can represent any set of known configurations.</span></span> <span data-ttu-id="6d260-314">例如，您可以為企業應用程式指定一組環境，例如，開發、測試和產品。</span><span class="sxs-lookup"><span data-stu-id="6d260-314">For example, you can specify a set of environments for an enterprise application such as Development, Test, and Product.</span></span> <span data-ttu-id="6d260-315">您可以使用不同雲端服務 toorepresent 或縮放單位、 產品版本或產品的組態，例如 Community、 Developer 或 Enterprise。</span><span class="sxs-lookup"><span data-stu-id="6d260-315">Or you could use it for a cloud service toorepresent different scale units, product versions, or product configurations such as Community, Developer, or Enterprise.</span></span>

<span data-ttu-id="6d260-316">如同 hello 共用的資源的範本，變數會從傳遞 toohello 已知的組態範本：</span><span class="sxs-lookup"><span data-stu-id="6d260-316">As with hello shared resource template, variables are passed toohello known configurations template from either:</span></span>

* <span data-ttu-id="6d260-317">畷樾簅 — 也就是 hello 參數傳送 toohello 主要範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-317">An end user—that is, hello parameters sent toohello main template.</span></span>
* <span data-ttu-id="6d260-318">組織 — 也就是 hello 代表內部的需求或原則 hello 主要範本中的變數。</span><span class="sxs-lookup"><span data-stu-id="6d260-318">An organization—that is, hello variables in hello main template that represent internal requirements or policies.</span></span>

### <a name="member-resources-template"></a><span data-ttu-id="6d260-319">成員資源範本</span><span class="sxs-lookup"><span data-stu-id="6d260-319">Member resources template</span></span>
<span data-ttu-id="6d260-320">在已知組態中，通常會包含一或多個成員節點類型。</span><span class="sxs-lookup"><span data-stu-id="6d260-320">Within a known configuration, one or more member node types are often included.</span></span> <span data-ttu-id="6d260-321">例如，使用 Hadoop，您會有主要節點和資料節點。</span><span class="sxs-lookup"><span data-stu-id="6d260-321">For example, with Hadoop you have master nodes and data nodes.</span></span> <span data-ttu-id="6d260-322">如果正在安裝 MongoDB，則會有資料節點和仲裁程式。</span><span class="sxs-lookup"><span data-stu-id="6d260-322">If you are installing MongoDB, you have data nodes and an arbiter.</span></span> <span data-ttu-id="6d260-323">如果正在部署 DataStax，就必須擁有資料節點，以及已安裝 OpsCenter 的 VM。</span><span class="sxs-lookup"><span data-stu-id="6d260-323">If you are deploying DataStax, you have data nodes and a VM with OpsCenter installed.</span></span>

![成員資源](./media/best-practices-resource-manager-design-templates/member-resources.png)

<span data-ttu-id="6d260-325">**成員資源範本**</span><span class="sxs-lookup"><span data-stu-id="6d260-325">**Member resources template**</span></span>

<span data-ttu-id="6d260-326">每種類型的節點可以有不同的 Vm，連接的磁碟，指令碼 tooinstall 的數字的大小，並設定 hello 節點、 連接埠組態的 hello Vm、 執行個體數目和其他詳細資料。</span><span class="sxs-lookup"><span data-stu-id="6d260-326">Each type of nodes can have different sizes of VMs, numbers of attached disks, scripts tooinstall and set up hello nodes, port configurations for hello VMs, number of instances, and other details.</span></span> <span data-ttu-id="6d260-327">因此每個節點類型會取得自己成員資源範本，其中包含 hello 和詳細資料部署和設定基礎結構，以及執行指令碼 toodeploy 設定 hello VM 內的軟體。</span><span class="sxs-lookup"><span data-stu-id="6d260-327">So each node type gets its own member resource template, which contains hello details for deploying and configuring an infrastructure as well as executing scripts toodeploy and configure software within hello VM.</span></span>

<span data-ttu-id="6d260-328">針對 VM，通常會使用兩種類型的指令碼：廣泛可重複使用和自訂的指令碼。</span><span class="sxs-lookup"><span data-stu-id="6d260-328">For VMs, typically two types of scripts are used, widely reusable and custom scripts.</span></span>

### <a name="widely-reusable-scripts"></a><span data-ttu-id="6d260-329">廣泛可重複使用的指令碼</span><span class="sxs-lookup"><span data-stu-id="6d260-329">Widely reusable scripts</span></span>
<span data-ttu-id="6d260-330">廣泛可重複使用的指令碼可以在多種類型的範本上使用。</span><span class="sxs-lookup"><span data-stu-id="6d260-330">Widely reusable scripts can be used across multiple types of templates.</span></span> <span data-ttu-id="6d260-331">其中一個 hello 更好的範例，這些廣泛的可重複使用的指令碼設定 RAID Linux toopool 磁碟上，並取得更多的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="6d260-331">One of hello better examples of these widely reusable scripts sets up RAID on Linux toopool disks and gain a greater number of IOPS.</span></span> <span data-ttu-id="6d260-332">不論 hello hello VM 中安裝的軟體，此指令碼提供經過證實的作法重複使用常見的案例。</span><span class="sxs-lookup"><span data-stu-id="6d260-332">Regardless of hello software being installed in hello VM, this script provides reuse of proven practices for common scenarios.</span></span>

![可重複使用的指令碼](./media/best-practices-resource-manager-design-templates/reusable-scripts.png)

<span data-ttu-id="6d260-334">**成員資源範本能夠呼叫廣泛可重複使用的指令碼**</span><span class="sxs-lookup"><span data-stu-id="6d260-334">**Member resources templates can call widely reusable scripts**</span></span>

### <a name="custom-scripts"></a><span data-ttu-id="6d260-335">自訂指令碼</span><span class="sxs-lookup"><span data-stu-id="6d260-335">Custom scripts</span></span>
<span data-ttu-id="6d260-336">範本通常會呼叫一或多個指令碼，在 VM 內安裝和設定軟體。</span><span class="sxs-lookup"><span data-stu-id="6d260-336">Templates commonly call one or more scripts that install and configure software within VMs.</span></span> <span data-ttu-id="6d260-337">常見的模式會出現在大型拓撲中，其中部署了一或多個成員類型的多個執行個體。</span><span class="sxs-lookup"><span data-stu-id="6d260-337">A common pattern is seen with large topologies where multiple instances of one or more member types are deployed.</span></span> <span data-ttu-id="6d260-338">安裝指令碼會針對每個可平行執行的 VM 加以啟動，後面接著要在部署所有 VM (或指定成員類型的所有 VM) 之後呼叫的安裝指令碼。</span><span class="sxs-lookup"><span data-stu-id="6d260-338">An installation script is initiated for every VM that can be run in parallel, followed by a setup script that is called after all VMs (or all VMs of a given member type) are deployed.</span></span>

![自訂指令碼](./media/best-practices-resource-manager-design-templates/custom-scripts.png)

<span data-ttu-id="6d260-340">**成員資源範本可基於特定目的呼叫指定碼，例如 VM 組態**</span><span class="sxs-lookup"><span data-stu-id="6d260-340">**Member resources templates can call scripts for a specific purpose such as VM configuration**</span></span>

## <a name="capability-scoped-solution-template-example---redis"></a><span data-ttu-id="6d260-341">已設定功能範圍的解決方案範本範例 - Redis</span><span class="sxs-lookup"><span data-stu-id="6d260-341">Capability-scoped solution template example - Redis</span></span>
<span data-ttu-id="6d260-342">tooshow 如何實作可能會運作，讓我們看看建置範本，可促進 hello 部署和設定 Redis 以標準 t 恤尺寸的實際範例。</span><span class="sxs-lookup"><span data-stu-id="6d260-342">tooshow how an implementation might work, let's look at a practical example of building a template that facilitates hello deployment and configuration of Redis in standard t-shirt sizes.</span></span>  

<span data-ttu-id="6d260-343">Hello 部署有一組共用的資源 （虛擬網路、 儲存體帳戶，可用性設定組） 和選擇性的資源 (jumpbox)。</span><span class="sxs-lookup"><span data-stu-id="6d260-343">For hello deployment, there are a set of shared resources (virtual network, storage account, availability sets) and an optional resource (jumpbox).</span></span> <span data-ttu-id="6d260-344">有多個以 T 恤尺寸 (小型、中型、大型) 來表示的已知組態，但每一個都具有單一節點類型。</span><span class="sxs-lookup"><span data-stu-id="6d260-344">There are multiple known configurations represented as t-shirt sizes (small, medium, large) but each with a single node type.</span></span> <span data-ttu-id="6d260-345">此外，還有兩個具備特定目的的指令碼 (安裝、組態)。</span><span class="sxs-lookup"><span data-stu-id="6d260-345">There are also two purpose-specific scripts (installation, configuration).</span></span>

### <a name="creating-hello-template-files"></a><span data-ttu-id="6d260-346">建立 hello 範本檔案</span><span class="sxs-lookup"><span data-stu-id="6d260-346">Creating hello template files</span></span>
<span data-ttu-id="6d260-347">您會建立名為 azuredeploy.json 的主要範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-347">You would create a Main Template named azuredeploy.json.</span></span>

<span data-ttu-id="6d260-348">您會建立名為 shared-resources.json 的共用資源範本</span><span class="sxs-lookup"><span data-stu-id="6d260-348">You create Shared Resources Template named shared-resources.json</span></span>

<span data-ttu-id="6d260-349">建立名為 jumpbox_enabled.json 的 jumpbox 選擇性資源範本 tooenable hello 部署</span><span class="sxs-lookup"><span data-stu-id="6d260-349">You create an Optional Resource Template tooenable hello deployment of a jumpbox, named jumpbox_enabled.json</span></span>

<span data-ttu-id="6d260-350">Redis 只會使用單一節點類型，因此您將建立名為 node-resources.json 的單一成員資源範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-350">Redis uses just a single node type, so you create a single Member Resource Template named node-resources.json.</span></span>

<span data-ttu-id="6d260-351">使用 Redis，您會想 tooinstall 每個個別的節點，然後再將 hello 叢集。</span><span class="sxs-lookup"><span data-stu-id="6d260-351">With Redis, you want tooinstall each individual node, and then set up hello cluster.</span></span>  <span data-ttu-id="6d260-352">您有指令碼 tooaccommodate hello 安裝並設定，為叢集 redis install.sh 和 redis-叢集-setup.sh。</span><span class="sxs-lookup"><span data-stu-id="6d260-352">You have scripts tooaccommodate hello installation and set up, redis-cluster-install.sh and redis-cluster-setup.sh.</span></span>

### <a name="linking-hello-templates"></a><span data-ttu-id="6d260-353">連結 hello 範本</span><span class="sxs-lookup"><span data-stu-id="6d260-353">Linking hello templates</span></span>
<span data-ttu-id="6d260-354">使用範本的連結，連結 toohello 共用的資源範本會建立 hello 虛擬網路外 hello 主要範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-354">Using template linking, hello main template links out toohello shared resources template, which establishes hello virtual network.</span></span>

<span data-ttu-id="6d260-355">是否應該部署 jumpbox hello 主要範本 tooenable 取用者的 hello 範本 toospecify 內加入邏輯。</span><span class="sxs-lookup"><span data-stu-id="6d260-355">Logic is added within hello main template tooenable consumers of hello template toospecify whether a jumpbox should be deployed.</span></span> <span data-ttu-id="6d260-356">*啟用*值 hello *EnableJumpbox*參數會指出該 hello 客戶想 toodeploy jumpbox。</span><span class="sxs-lookup"><span data-stu-id="6d260-356">An *enabled* value for hello *EnableJumpbox* parameter indicates that hello customer wants toodeploy a jumpbox.</span></span> <span data-ttu-id="6d260-357">Hello 範本時提供此值，串連*_enabled*作為 hello jumpbox 功能的後置詞 tooa 基底範本名稱。</span><span class="sxs-lookup"><span data-stu-id="6d260-357">When this value is provided, hello template concatenates *_enabled* as a suffix tooa base template name for hello jumpbox capability.</span></span>

<span data-ttu-id="6d260-358">hello 主要範本適用於 hello*大型*參數值 t 恤大小，然後使用的尾碼 tooa 基底範本名稱為 out 範本連結中的值太*technology_on_os_large.json*。</span><span class="sxs-lookup"><span data-stu-id="6d260-358">hello main template applies hello *large* parameter value as a suffix tooa base template name for t-shirt sizes, and then uses that value in a template link out too*technology_on_os_large.json*.</span></span>

<span data-ttu-id="6d260-359">hello 拓撲會看起來像下圖。</span><span class="sxs-lookup"><span data-stu-id="6d260-359">hello topology would resemble this illustration.</span></span>

![Redis 範本](./media/best-practices-resource-manager-design-templates/redis-template.png)

<span data-ttu-id="6d260-361">**Redis 範本的範本結構**</span><span class="sxs-lookup"><span data-stu-id="6d260-361">**Template structure for a Redis template**</span></span>

### <a name="configuring-state"></a><span data-ttu-id="6d260-362">設定狀態</span><span class="sxs-lookup"><span data-stu-id="6d260-362">Configuring state</span></span>
<span data-ttu-id="6d260-363">Hello hello 叢集中的節點，有兩個步驟 tooconfiguring hello 狀態，表示由特定用途的指令碼。</span><span class="sxs-lookup"><span data-stu-id="6d260-363">For hello nodes in hello cluster, there are two steps tooconfiguring hello state, both represented by Purpose Specific Scripts.</span></span>  <span data-ttu-id="6d260-364">「 redis 叢集-為 install.sh 」 安裝 Redis 並"redis-叢集 setup.sh 的 「 設定 hello 叢集。</span><span class="sxs-lookup"><span data-stu-id="6d260-364">"redis-cluster-install.sh" installs Redis and "redis-cluster-setup.sh" sets up hello cluster.</span></span>

### <a name="supporting-different-size-deployments"></a><span data-ttu-id="6d260-365">支援不同大小的部署</span><span class="sxs-lookup"><span data-stu-id="6d260-365">Supporting Different Size Deployments</span></span>
<span data-ttu-id="6d260-366">內部變數，hello t 恤大小範本指定的每個型別的節點的 hello 數目 hello toodeploy 指定的大小 (*大型*)。</span><span class="sxs-lookup"><span data-stu-id="6d260-366">Inside variables, hello t-shirt size template specifies hello number of nodes of each type toodeploy for hello specified size (*large*).</span></span> <span data-ttu-id="6d260-367">然後將部署此數目的 VM 執行個體使用資源迴圈，將節點名稱附加數字序號，從含有提供唯一的名稱 tooresources *copyIndex()*。</span><span class="sxs-lookup"><span data-stu-id="6d260-367">It then deploys that number of VM instances using resource loops, providing unique names tooresources by appending a node name with a numeric sequence number from *copyIndex()*.</span></span> <span data-ttu-id="6d260-368">它會依照對於這兩個作用中且暖區域的 Vm，hello t 恤名稱範本中所定義</span><span class="sxs-lookup"><span data-stu-id="6d260-368">It does these steps for both hot and warm zone VMs, as defined in hello t-shirt name template</span></span>

## <a name="decomposition-and-end-to-end-solution-scoped-templates"></a><span data-ttu-id="6d260-369">分解和已設定端對端解決方案範圍的範本</span><span class="sxs-lookup"><span data-stu-id="6d260-369">Decomposition and end-to-end solution scoped templates</span></span>
<span data-ttu-id="6d260-370">具有端對端解決方案範圍的解決方案範本會將重點放在提供端對端解決方案。</span><span class="sxs-lookup"><span data-stu-id="6d260-370">A solution template with an end-to-end solution scope is focused on delivering an end-to-end solution.</span></span>  <span data-ttu-id="6d260-371">這個做法通常是多個已設定功能範圍的範本以及其他資源、邏輯和狀態的組合。</span><span class="sxs-lookup"><span data-stu-id="6d260-371">This approach is typically a composition of multiple capability-scoped templates with additional resources, logic, and state.</span></span>

<span data-ttu-id="6d260-372">Hello 圖中反白顯示，hello 功能範圍範本所使用的相同模型已擴充與端對端方案領域的範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-372">As highlighted in hello image below, hello same model used for capability scoped templates is extended for templates with an End-to-End Solution Scope.</span></span>

<span data-ttu-id="6d260-373">共用資源範本和選擇性資源範本做的 hello hello 容量和功能的功能相同範圍範本方法，但 hello 結束 tooend 解決方案的範圍。</span><span class="sxs-lookup"><span data-stu-id="6d260-373">A Shared Resources Template and Optional Resources Templates serve hello same function as in hello capacity and capability scoped template approaches, but are scoped for hello end tooend solution.</span></span>

<span data-ttu-id="6d260-374">當端點 tooend 解決方案範圍範本也通常有 t 恤大小，hello 已知設定資源範本反映所需的 hello 解決方案指定的已知設定內容。</span><span class="sxs-lookup"><span data-stu-id="6d260-374">As end tooend solution scoped templates also can typically have t-shirt sizes, hello Known Configuration Resources template reflects what is required for a given known configuration of hello solution.</span></span>

<span data-ttu-id="6d260-375">hello 已知設定資源範本連結 tooone 或更多的功能範圍是相關 toohello tooend 解決方案也 hello 成員資源範本所需的 hello tooend 解決方案的解決方案範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-375">hello Known Configuration Resources Template links tooone or more capability scoped solution templates that are relevant toohello end tooend solution as well as hello Member Resource Templates that are required for hello end tooend solution.</span></span>

<span data-ttu-id="6d260-376">Hello t 恤尺寸的 hello 方案可能會與 hello 個別功能範圍範本不同，hello 已知設定資源範本內的變數是使用的 tooprovide hello 適當的值範圍的下游功能方案範本 toodeploy hello 適當 t 恤尺寸。</span><span class="sxs-lookup"><span data-stu-id="6d260-376">As hello t-shirt size of hello solution may be different than hello individual capability-scoped template, variables within hello Known Configuration Resources Template are used tooprovide hello appropriate values for downstream capability scoped solution templates toodeploy hello appropriate t-shirt size.</span></span>

![端對端](./media/best-practices-resource-manager-design-templates/end-to-end.png)

<span data-ttu-id="6d260-378">**hello 模型用於容量或範圍的功能解決方案範本可以輕易地延伸結束 tooend 方案範本範圍**</span><span class="sxs-lookup"><span data-stu-id="6d260-378">**hello model used for capacity or capability scoped solution templates can be readily extended for end tooend solution template scopes**</span></span>

## <a name="preparing-templates-for-hello-marketplace"></a><span data-ttu-id="6d260-379">準備 hello Marketplace 中的範本</span><span class="sxs-lookup"><span data-stu-id="6d260-379">Preparing templates for hello Marketplace</span></span>
<span data-ttu-id="6d260-380">hello 上述方法，輕易地配合企業、 SIs 和 Csv 想 tooeither 部署 hello 範本本身的位置，或啟用其自己的客戶 toodeploy 的案例。</span><span class="sxs-lookup"><span data-stu-id="6d260-380">hello preceding approach readily accommodates scenarios where Enterprises, SIs, and CSVs want tooeither deploy hello templates themselves or enable their customers toodeploy on their own.</span></span>

<span data-ttu-id="6d260-381">另一個所需的案例將透過 hello marketplace 範本部署。</span><span class="sxs-lookup"><span data-stu-id="6d260-381">Another desired scenario is deploying a template via hello marketplace.</span></span>  <span data-ttu-id="6d260-382">這個分解方法適用於 hello marketplace，一些微幅變更。</span><span class="sxs-lookup"><span data-stu-id="6d260-382">This decomposition approach works for hello marketplace as well, with some minor changes.</span></span>

<span data-ttu-id="6d260-383">如先前所述，範本可以使用的 toooffer hello 市場中銷售的不同部署類型。</span><span class="sxs-lookup"><span data-stu-id="6d260-383">As mentioned previously, templates can be used toooffer distinct deployment types for sale in hello marketplace.</span></span> <span data-ttu-id="6d260-384">不同的部署類型可能是 T 恤尺寸 (小型、中型、大型)、產品/對象類型 (社群、開發人員、企業) 或功能類型 (基本、高可用性)。</span><span class="sxs-lookup"><span data-stu-id="6d260-384">Distinct deployment types may be t-shirt sizes (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span></span>

<span data-ttu-id="6d260-385">為現有的結束 tooend 如下所示，hello 方案或功能已設定領域的範本可以輕易地利用 toolist hello 不同已知的組態 hello marketplace 中。</span><span class="sxs-lookup"><span data-stu-id="6d260-385">As shown below, hello existing end tooend solution or capability scoped templates can be readily utilized toolist hello different known configurations in hello marketplace.</span></span>

<span data-ttu-id="6d260-386">hello 參數 toohello 主要範本第一次修改 tooremove hello 名為 tshirtSize 的輸入的參數。</span><span class="sxs-lookup"><span data-stu-id="6d260-386">hello parameters toohello main template are first modified tooremove hello inbound parameter named tshirtSize.</span></span>

<span data-ttu-id="6d260-387">Hello 不同部署類型會對應 toohello 已知設定資源範本，他們也需要 hello 通用資源與組態中找到 hello 共用資源範本，而可能選擇性資源範本。</span><span class="sxs-lookup"><span data-stu-id="6d260-387">While hello distinct deployment types map toohello Known Configuration Resources Template, they also need hello common resources and configuration found in hello Shared Resources Template and potentially those in Optional Resource Templates.</span></span>

<span data-ttu-id="6d260-388">如果您想 toopublish 您範本 toohello marketplace，您會建立主要範本，以取代的 hello 先前可用的輸入的參數 tshirtSize tooa 變數的內嵌 hello 範本內的不同複本。</span><span class="sxs-lookup"><span data-stu-id="6d260-388">If you want toopublish your template toohello marketplace, you establish distinct copies of your Main template that replaces hello previously available inbound parameter of tshirtSize tooa variable embedded within hello template.</span></span>

![Marketplace](./media/best-practices-resource-manager-design-templates/marketplace.png)

<span data-ttu-id="6d260-390">**改寫方案範圍 hello marketplace 的範本**</span><span class="sxs-lookup"><span data-stu-id="6d260-390">**Adapting a solution scoped template for hello marketplace**</span></span>

## <a name="next-steps"></a><span data-ttu-id="6d260-391">後續步驟</span><span class="sxs-lookup"><span data-stu-id="6d260-391">Next steps</span></span>
* <span data-ttu-id="6d260-392">toolearn 有關共用狀態，進出範本，請參閱[共用 Azure Resource Manager 範本中的狀態](best-practices-resource-manager-state.md)。</span><span class="sxs-lookup"><span data-stu-id="6d260-392">toolearn about sharing state into and out of templates, see [Sharing state in Azure Resource Manager templates](best-practices-resource-manager-state.md).</span></span>
* <span data-ttu-id="6d260-393">如需指引企業可以如何使用資源管理員 tooeffectively 管理訂用帳戶，請參閱[Azure 企業版 scaffold-精準的訂閱控管](resource-manager-subscription-governance.md)。</span><span class="sxs-lookup"><span data-stu-id="6d260-393">For guidance on how enterprises can use Resource Manager tooeffectively manage subscriptions, see [Azure enterprise scaffold - prescriptive subscription governance](resource-manager-subscription-governance.md).</span></span>

