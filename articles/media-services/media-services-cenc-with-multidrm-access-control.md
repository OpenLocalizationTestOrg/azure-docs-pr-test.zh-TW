---
title: "具有多重 DRM 及存取控制的 CENC：Azure 與 Azure 媒體服務的參考設計和實作 | Microsoft Docs"
description: "深入了解如何 toolicensing hello Microsoft® Smooth Streaming Client Porting Kit。"
services: media-services
documentationcenter: 
author: willzhan
manager: cfowler
editor: 
ms.assetid: 7814739b-cea9-4b9b-8370-538702e5c615
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: willzhan;kilroyh;yanmf;juliako
ms.openlocfilehash: 033fb618650c4fbe9069d467159a8734da759bba
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="cenc-with-multi-drm-and-access-control-a-reference-design-and-implementation-on-azure-and-azure-media-services"></a><span data-ttu-id="8ab92-103">具有多重 DRM 及存取控制的 CENC：Azure 與 Azure 媒體服務的參考設計和實作</span><span class="sxs-lookup"><span data-stu-id="8ab92-103">CENC with Multi-DRM and Access Control: A Reference Design and Implementation on Azure and Azure Media Services</span></span>
 
## <a name="introduction"></a><span data-ttu-id="8ab92-104">簡介</span><span class="sxs-lookup"><span data-stu-id="8ab92-104">Introduction</span></span>
<span data-ttu-id="8ab92-105">它是眾所周知它是複雜的工作 toodesign，並建置 OTT DRM 子系統或線上串流處理解決方案。</span><span class="sxs-lookup"><span data-stu-id="8ab92-105">It is well known that it is a complex task toodesign and build a DRM subsystem for an OTT or online streaming solution.</span></span> <span data-ttu-id="8ab92-106">而且它是一般練習的運算子/線上視訊提供者 toooutsource 這個組件 toospecialized DRM 服務提供者。</span><span class="sxs-lookup"><span data-stu-id="8ab92-106">And it is a common practice for operators/online video providers toooutsource this part toospecialized DRM service providers.</span></span> <span data-ttu-id="8ab92-107">這份文件 hello 目標是 toopresent 參考設計和實作端對端 DRM 子系統 OTT 或線上串流處理解決方案中。</span><span class="sxs-lookup"><span data-stu-id="8ab92-107">hello goal of this document is toopresent a reference design and implementation of end-to-end DRM subsystem in OTT or online streaming solution.</span></span>

<span data-ttu-id="8ab92-108">本文件的 hello 目標讀者是工程師 DRM 子系統 OTT 或線上串流/多-screen 解決方案，或非興趣 DRM 子系統的的讀取器中使用。</span><span class="sxs-lookup"><span data-stu-id="8ab92-108">hello targeted readers of this document are engineers working in DRM subsystem of OTT or online streaming/multi-screen solutions, or any readers interested in DRM subsystem.</span></span> <span data-ttu-id="8ab92-109">hello 假設是讀者已熟悉 hello DRM 技術，例如 PlayReady、 Widevine、 FairPlay 或 Adobe Access 的 hello 市場上其中。</span><span class="sxs-lookup"><span data-stu-id="8ab92-109">hello assumption is that readers are familiar with at least one of hello DRM technologies on hello market, such as PlayReady, Widevine, FairPlay or Adobe Access.</span></span>

<span data-ttu-id="8ab92-110">根據 DRM，我們也包含 CENC (Common Encryption) 與多重 DRM。</span><span class="sxs-lookup"><span data-stu-id="8ab92-110">By DRM, we also include CENC (Common Encryption) with multi-DRM.</span></span> <span data-ttu-id="8ab92-111">線上串流和 OTT 產業中的主要趨勢是 toouse CENC 多-native-DRM 各種用戶端的平台，使用 shift 鍵，從各種用戶端的平台針對使用單一的 DRM 與用戶端 SDK 的 hello 先前趨勢。</span><span class="sxs-lookup"><span data-stu-id="8ab92-111">A major trend in online streaming and OTT industry is toouse CENC with multi-native-DRM on various client platforms, which is a shift from hello previous trend of using a single DRM and its client SDK for various client platforms.</span></span> <span data-ttu-id="8ab92-112">當使用多 native DRM CENC，PlayReady 和 Widevine 加密 hello[一般加密 (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/)規格。</span><span class="sxs-lookup"><span data-stu-id="8ab92-112">When using CENC with multi-native-DRM, both PlayReady and Widevine are encrypted per hello [Common Encryption (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) specification.</span></span>

<span data-ttu-id="8ab92-113">使用多重 DRM CENC hello 優點如下：</span><span class="sxs-lookup"><span data-stu-id="8ab92-113">hello benefits of CENC with multi-DRM are as follows:</span></span>

1. <span data-ttu-id="8ab92-114">降低加密成本，因為對於不同平台使用其原生 DRM 進行單一加密處理；</span><span class="sxs-lookup"><span data-stu-id="8ab92-114">Reduces encryption cost since a single encryption processing is used targeting different platforms with its native DRMs;</span></span>
2. <span data-ttu-id="8ab92-115">可減少由於需要加密的資產的單一複本; 因此管理加密的資產 hello 成本</span><span class="sxs-lookup"><span data-stu-id="8ab92-115">Reduces hello cost of managing encrypted assets since only a single copy of encrypted assets is needed;</span></span>
3. <span data-ttu-id="8ab92-116">排除 DRM 授權成本，因為原生 DRM 用戶端 hello 通常是免費的原生平台上的用戶端。</span><span class="sxs-lookup"><span data-stu-id="8ab92-116">Eliminates DRM client licensing cost since hello native DRM client is usually free on its native platform.</span></span>

<span data-ttu-id="8ab92-117">Microsoft 已經成為 DASH 和 CENC 與其他一些主要業界播放器的積極推動者。</span><span class="sxs-lookup"><span data-stu-id="8ab92-117">Microsoft has been an active promoter of DASH and CENC together with some major industry players.</span></span> <span data-ttu-id="8ab92-118">Microsoft Azure 媒體服務已提供 DASH 和 CENC 的支援。</span><span class="sxs-lookup"><span data-stu-id="8ab92-118">Microsoft Azure Media Services has been providing support of DASH and CENC.</span></span> <span data-ttu-id="8ab92-119">如需最新的通知，請參閱 Mingfei 的部落格：[Announcing Google Widevine license delivery services in Azure Media Services (宣佈在 Azure 媒體服務中推出 Google Widevine 授權傳遞服務)](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/)，和 [Azure Media Services adds Google Widevine packaging for delivering multi-DRM stream (Azure 媒體服務新增 Google Widevine 封裝來傳遞多重 DRM 串流)](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-119">For recent announcements, please see Mingfei’s blogs: [Announcing Google Widevine license delivery services in Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/), and [Azure Media Services adds Google Widevine packaging for delivering multi-DRM stream](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/).</span></span>  

### <a name="overview-of-this-article"></a><span data-ttu-id="8ab92-120">本文概觀：</span><span class="sxs-lookup"><span data-stu-id="8ab92-120">Overview of this article</span></span>
<span data-ttu-id="8ab92-121">本文的 hello 目標包括 hello 下列：</span><span class="sxs-lookup"><span data-stu-id="8ab92-121">hello goal of this article includes hello following:</span></span>

1. <span data-ttu-id="8ab92-122">提供使用 CENC 與多重 DRM 的 DRM 子系統的參考設計；</span><span class="sxs-lookup"><span data-stu-id="8ab92-122">Provides a reference design of DRM subsystem using CENC with multi-DRM;</span></span>
2. <span data-ttu-id="8ab92-123">提供 Microsoft Azure/Azure 媒體服務平台上的參考實作；</span><span class="sxs-lookup"><span data-stu-id="8ab92-123">Provides a reference implementation on Microsoft Azure/Azure Media Services platform;</span></span>
3. <span data-ttu-id="8ab92-124">討論某些設計和實作主題。</span><span class="sxs-lookup"><span data-stu-id="8ab92-124">Discusses some design and implementation topics.</span></span>

<span data-ttu-id="8ab92-125">在 hello 文章中，「 多 DRM"涵蓋 hello 下列：</span><span class="sxs-lookup"><span data-stu-id="8ab92-125">In hello article, “multi-DRM” covers hello following:</span></span>

1. <span data-ttu-id="8ab92-126">Microsoft PlayReady (英文)</span><span class="sxs-lookup"><span data-stu-id="8ab92-126">Microsoft PlayReady</span></span>
2. <span data-ttu-id="8ab92-127">Google Widevine</span><span class="sxs-lookup"><span data-stu-id="8ab92-127">Google Widevine</span></span>
3. <span data-ttu-id="8ab92-128">Apple FairPlay</span><span class="sxs-lookup"><span data-stu-id="8ab92-128">Apple FairPlay</span></span> 

<span data-ttu-id="8ab92-129">hello 表摘要說明 hello 原生的平台/原生應用程式，以及每個 DRM 所支援的瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="8ab92-129">hello following table summarizes hello native platform/native app, and browsers supported by each DRM.</span></span>

| <span data-ttu-id="8ab92-130">**用戶端平台**</span><span class="sxs-lookup"><span data-stu-id="8ab92-130">**Client Platform**</span></span> | <span data-ttu-id="8ab92-131">**原生 DRM 支援**</span><span class="sxs-lookup"><span data-stu-id="8ab92-131">**Native DRM Support**</span></span> | <span data-ttu-id="8ab92-132">**瀏覽器/應用程式**</span><span class="sxs-lookup"><span data-stu-id="8ab92-132">**Browser/App**</span></span> | <span data-ttu-id="8ab92-133">**串流格式**</span><span class="sxs-lookup"><span data-stu-id="8ab92-133">**Streaming Formats**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="8ab92-134">**智慧型電視、運算子 STB、OTT STB**</span><span class="sxs-lookup"><span data-stu-id="8ab92-134">**Smart TVs, operator STBs, OTT STBs**</span></span> |<span data-ttu-id="8ab92-135">主要為 PlayReady，及/或 Widevine，及/或其他的 DRM</span><span class="sxs-lookup"><span data-stu-id="8ab92-135">PlayReady primarily, and/or Widevine, and/or other</span></span> |<span data-ttu-id="8ab92-136">Linux、Opera、WebKit 及其他瀏覽器/應用程式</span><span class="sxs-lookup"><span data-stu-id="8ab92-136">Linux, Opera, WebKit, Other</span></span> |<span data-ttu-id="8ab92-137">各種格式</span><span class="sxs-lookup"><span data-stu-id="8ab92-137">Various formats</span></span> |
| <span data-ttu-id="8ab92-138">**Windows 10 裝置 (Windows 電腦、Windows 平板電腦、Windows Phone、Xbox)**</span><span class="sxs-lookup"><span data-stu-id="8ab92-138">**Windows 10 devices (Windows PC, Windows Tablets, Windows Phone, Xbox)**</span></span> |<span data-ttu-id="8ab92-139">PlayReady</span><span class="sxs-lookup"><span data-stu-id="8ab92-139">PlayReady</span></span> |<span data-ttu-id="8ab92-140">MS Edge/IE11/EME</span><span class="sxs-lookup"><span data-stu-id="8ab92-140">MS Edge/IE11/EME</span></span><br/><br/><br/><span data-ttu-id="8ab92-141">UWP</span><span class="sxs-lookup"><span data-stu-id="8ab92-141">UWP</span></span> |<span data-ttu-id="8ab92-142">DASH (HLS 並不支援 PlayReady)</span><span class="sxs-lookup"><span data-stu-id="8ab92-142">DASH (For HLS, PlayReady is not supported)</span></span><br/><br/><span data-ttu-id="8ab92-143">DASH、Smooth Streaming (HLS 並不支援 PlayReady)</span><span class="sxs-lookup"><span data-stu-id="8ab92-143">DASH, Smooth Streaming (For HLS, PlayReady is not supported)</span></span> |
| <span data-ttu-id="8ab92-144">**Android 裝置 (電話、平板電腦、電視)**</span><span class="sxs-lookup"><span data-stu-id="8ab92-144">**Android devices (Phone, Tablet, TV)**</span></span> |<span data-ttu-id="8ab92-145">Widevine</span><span class="sxs-lookup"><span data-stu-id="8ab92-145">Widevine</span></span> |<span data-ttu-id="8ab92-146">Chrome/EME</span><span class="sxs-lookup"><span data-stu-id="8ab92-146">Chrome/EME</span></span> |<span data-ttu-id="8ab92-147">DASH,HLS</span><span class="sxs-lookup"><span data-stu-id="8ab92-147">DASH,HLS</span></span> |
| <span data-ttu-id="8ab92-148">**iOS (iPhone、iPad)、OS X 用戶端和 Apple 電視**</span><span class="sxs-lookup"><span data-stu-id="8ab92-148">**iOS (iPhone, iPad), OS X clients and Apple TV**</span></span> |<span data-ttu-id="8ab92-149">FairPlay</span><span class="sxs-lookup"><span data-stu-id="8ab92-149">FairPlay</span></span> |<span data-ttu-id="8ab92-150">Safari 8+/EME</span><span class="sxs-lookup"><span data-stu-id="8ab92-150">Safari 8+/EME</span></span> |<span data-ttu-id="8ab92-151">HLS</span><span class="sxs-lookup"><span data-stu-id="8ab92-151">HLS</span></span> |


<span data-ttu-id="8ab92-152">請考慮為每個 DRM 部署的 hello 目前狀態，服務通常會想 tooimplement 2 或 3 DRMs toomake 確定解決所有的 hello 類型的端點在 hello 最佳的方式。</span><span class="sxs-lookup"><span data-stu-id="8ab92-152">Considering hello current state of deployment for each DRM, a service will typically want tooimplement 2 or 3 DRMs toomake sure you address all hello types of endpoints in hello best way.</span></span>

<span data-ttu-id="8ab92-153">Hello 複雜度 hello 服務邏輯之間沒有取捨，hello 複雜性 hello 用戶端端 tooreach 特定層級的使用者體驗上 hello 各種用戶端。</span><span class="sxs-lookup"><span data-stu-id="8ab92-153">There is a tradeoff between hello complexity of hello service logic and hello complexity on hello client side tooreach a certain level of user experience on hello various clients.</span></span>

<span data-ttu-id="8ab92-154">toomake 選取範圍，請注意下列重點：</span><span class="sxs-lookup"><span data-stu-id="8ab92-154">toomake your selection, keep in mind these facts:</span></span>

* <span data-ttu-id="8ab92-155">PlayReady 原生實作在每種 Windows 裝置及部分 Android 裝置中，且可透過軟體 SDK 在幾乎所有平台上實作</span><span class="sxs-lookup"><span data-stu-id="8ab92-155">PlayReady is natively implemented in every Windows device, on some Android devices, and available through software SDKs on virtually any platform</span></span>
* <span data-ttu-id="8ab92-156">Widevine 原生實作在每種 Android 裝置、Chrome 及部分其他的裝置中</span><span class="sxs-lookup"><span data-stu-id="8ab92-156">Widevine is natively implemented in every Android device, in Chrome, and in some other devices</span></span>
* <span data-ttu-id="8ab92-157">FairPlay 只使用在 iOS 和 Mac OS 用戶端中，或是透過 iTunes 來提供。</span><span class="sxs-lookup"><span data-stu-id="8ab92-157">FairPlay is available only on iOS and Mac OS clients or through iTunes.</span></span>

<span data-ttu-id="8ab92-158">因此典型的多重 DRM 會是：</span><span class="sxs-lookup"><span data-stu-id="8ab92-158">So a typical multi-DRM would be:</span></span>

* <span data-ttu-id="8ab92-159">選項 1：PlayReady 及 Widevine</span><span class="sxs-lookup"><span data-stu-id="8ab92-159">Option 1: PlayReady and Widevine</span></span>
* <span data-ttu-id="8ab92-160">選項 2：PlayReady、Widevine 和 FairPlay</span><span class="sxs-lookup"><span data-stu-id="8ab92-160">Option 2: PlayReady, Widevine and FairPlay</span></span>

## <a name="a-reference-design"></a><span data-ttu-id="8ab92-161">參考設計</span><span class="sxs-lookup"><span data-stu-id="8ab92-161">A reference design</span></span>
<span data-ttu-id="8ab92-162">在本節中，我們將提供參考設計也就是使用無從驗證 tootechnologies tooimplement 它。</span><span class="sxs-lookup"><span data-stu-id="8ab92-162">In this section, we will present a reference design which is agnostic tootechnologies used tooimplement it.</span></span>

<span data-ttu-id="8ab92-163">DRM 子系統可能包含下列元件的 hello:</span><span class="sxs-lookup"><span data-stu-id="8ab92-163">A DRM subsystem may contain hello following components:</span></span>

1. <span data-ttu-id="8ab92-164">金鑰管理</span><span class="sxs-lookup"><span data-stu-id="8ab92-164">Key management</span></span>
2. <span data-ttu-id="8ab92-165">DRM 封裝</span><span class="sxs-lookup"><span data-stu-id="8ab92-165">DRM packaging</span></span>
3. <span data-ttu-id="8ab92-166">DRM 授權傳遞</span><span class="sxs-lookup"><span data-stu-id="8ab92-166">DRM license delivery</span></span>
4. <span data-ttu-id="8ab92-167">權利檢查</span><span class="sxs-lookup"><span data-stu-id="8ab92-167">Entitlement check</span></span>
5. <span data-ttu-id="8ab92-168">驗證/授權</span><span class="sxs-lookup"><span data-stu-id="8ab92-168">Authentication/authorization</span></span>
6. <span data-ttu-id="8ab92-169">播放器</span><span class="sxs-lookup"><span data-stu-id="8ab92-169">Player</span></span>
7. <span data-ttu-id="8ab92-170">原始/CDN</span><span class="sxs-lookup"><span data-stu-id="8ab92-170">Origin/CDN</span></span>

<span data-ttu-id="8ab92-171">hello 下列圖表說明 hello 高等級的互動 DRM 子系統中的 hello 元件之間。</span><span class="sxs-lookup"><span data-stu-id="8ab92-171">hello following diagram illustrates hello high level interaction among hello components in a DRM subsystem.</span></span>

![DRM 子系統與 CENC](./media/media-services-cenc-with-multidrm-access-control/media-services-generic-drm-subsystem-with-cenc.png)

<span data-ttu-id="8ab92-173">Hello 設計有三個基本 」 層級 」:</span><span class="sxs-lookup"><span data-stu-id="8ab92-173">There are three basic “layers” in hello design:</span></span>

1. <span data-ttu-id="8ab92-174">後台系統層級 (黑色)，不會對外部公開；</span><span class="sxs-lookup"><span data-stu-id="8ab92-174">Back office layer (in black) which are not exposed externally;</span></span>
2. <span data-ttu-id="8ab92-175">包含所有面向公用; 的 hello 端點的 「 周邊網路 」 層 （藍色）</span><span class="sxs-lookup"><span data-stu-id="8ab92-175">“DMZ” layer (blue) containing all hello endpoints facing public;</span></span>
3. <span data-ttu-id="8ab92-176">公用網際網路層級 (淺藍色)，包含具有跨公用網際網路流量的 CDN 和播放器。</span><span class="sxs-lookup"><span data-stu-id="8ab92-176">Public Internet layer (light blue) containing CDN and players with traffic across public Internet.</span></span>

<span data-ttu-id="8ab92-177">應該有用來控制 DRM 保護的內容管理工具，無論是靜態或動態加密。</span><span class="sxs-lookup"><span data-stu-id="8ab92-177">There should be a content management tool for controlling DRM protection, regardless it is static or dynamic encryption.</span></span> <span data-ttu-id="8ab92-178">DRM 加密的 hello 輸入應該包括：</span><span class="sxs-lookup"><span data-stu-id="8ab92-178">hello inputs for DRM encryption should include:</span></span>

1. <span data-ttu-id="8ab92-179">MBR 視訊內容；</span><span class="sxs-lookup"><span data-stu-id="8ab92-179">MBR video content;</span></span>
2. <span data-ttu-id="8ab92-180">內容金鑰；</span><span class="sxs-lookup"><span data-stu-id="8ab92-180">Content key;</span></span>
3. <span data-ttu-id="8ab92-181">授權取得 URL。</span><span class="sxs-lookup"><span data-stu-id="8ab92-181">License acquisition URLs.</span></span>

<span data-ttu-id="8ab92-182">在播放期間，hello 高的層級非固定格式為：</span><span class="sxs-lookup"><span data-stu-id="8ab92-182">During playback time, hello high level flow is:</span></span>

1. <span data-ttu-id="8ab92-183">使用者已通過驗證；</span><span class="sxs-lookup"><span data-stu-id="8ab92-183">User is authenticated;</span></span>
2. <span data-ttu-id="8ab92-184">授權權杖建立 hello 使用者;</span><span class="sxs-lookup"><span data-stu-id="8ab92-184">Authorization token is created for hello user;</span></span>
3. <span data-ttu-id="8ab92-185">受 DRM 保護內容 （資訊清單） 是下載的 tooplayer;</span><span class="sxs-lookup"><span data-stu-id="8ab92-185">DRM protected content (manifest) is downloaded tooplayer;</span></span>
4. <span data-ttu-id="8ab92-186">玩家送出授權擷取要求 toolicense 伺服器以及金鑰識別碼和授權權杖。</span><span class="sxs-lookup"><span data-stu-id="8ab92-186">Player submits license acquisition request toolicense servers together with key ID and authorization token.</span></span>

<span data-ttu-id="8ab92-187">之前移動 toohello 下一個主題： hello 相關的幾個字設計的金鑰管理。</span><span class="sxs-lookup"><span data-stu-id="8ab92-187">Before moving toohello next topic, a few words about hello design of key management.</span></span>

| <span data-ttu-id="8ab92-188">**ContentKey–to-Asset**</span><span class="sxs-lookup"><span data-stu-id="8ab92-188">**ContentKey–to-Asset**</span></span> | <span data-ttu-id="8ab92-189">**案例**</span><span class="sxs-lookup"><span data-stu-id="8ab92-189">**Scenario**</span></span> |
| --- | --- |
| <span data-ttu-id="8ab92-190">1 對 1</span><span class="sxs-lookup"><span data-stu-id="8ab92-190">1–to-1</span></span> |<span data-ttu-id="8ab92-191">hello 簡單的情況。</span><span class="sxs-lookup"><span data-stu-id="8ab92-191">hello simplest case.</span></span> <span data-ttu-id="8ab92-192">它提供 hello 最精細的控制。</span><span class="sxs-lookup"><span data-stu-id="8ab92-192">It provides hello finest control.</span></span> <span data-ttu-id="8ab92-193">但是，這通常會導致 hello 最高的授權傳遞成本。</span><span class="sxs-lookup"><span data-stu-id="8ab92-193">But this generally results in hello highest license delivery cost.</span></span> <span data-ttu-id="8ab92-194">每個受保護的資產需要至少一個授權要求。</span><span class="sxs-lookup"><span data-stu-id="8ab92-194">At minimum one license request is required for each protected asset.</span></span> |
| <span data-ttu-id="8ab92-195">1 對多</span><span class="sxs-lookup"><span data-stu-id="8ab92-195">1–to-Many</span></span> |<span data-ttu-id="8ab92-196">您可以使用相同的內容金鑰的多個資產的 hello。</span><span class="sxs-lookup"><span data-stu-id="8ab92-196">You could use hello same content key for multiple assets.</span></span> <span data-ttu-id="8ab92-197">例如，為所有的 hello 資產中的邏輯群組，例如內容類型或內容類型 （或電影 Gene） 的子集，您可以使用單一的內容金鑰。</span><span class="sxs-lookup"><span data-stu-id="8ab92-197">For example, for all hello assets in a logical group such as a genre or subset of genre (or Movie Gene), you could use a single content key.</span></span> |
| <span data-ttu-id="8ab92-198">多對 1</span><span class="sxs-lookup"><span data-stu-id="8ab92-198">Many–to-1</span></span> |<span data-ttu-id="8ab92-199">每個資產需要有多個內容金鑰。</span><span class="sxs-lookup"><span data-stu-id="8ab92-199">Multiple content keys are needed for each asset.</span></span> <br/><br/><span data-ttu-id="8ab92-200">例如，如果您需要具有多重 DRM tooapply 動態 CENC 保護 MPEG DASH 和 HLS 動態 aes-128 加密，您需要兩個不同內容索引鍵，每個都有它自己的 ContentKeyType。</span><span class="sxs-lookup"><span data-stu-id="8ab92-200">For example, if you need tooapply dynamic CENC protection with multi-DRM for MPEG-DASH, and dynamic AES-128 encryption for HLS, you need two separate content keys, each with its own ContentKeyType.</span></span> <span data-ttu-id="8ab92-201">（hello 做為動態 CENC 保護內容的金鑰，ContentKeyType.CommonEncryption 應該用於，而內容應該使用金鑰用於動態 aes-128 加密，ContentKeyType.EnvelopeEncryption hello。）</span><span class="sxs-lookup"><span data-stu-id="8ab92-201">(For hello content key used for dynamic CENC protection, ContentKeyType.CommonEncryption should be used, while for hello content key used for dynamic AES-128 encryption, ContentKeyType.EnvelopeEncryption should be used.)</span></span><br/><br/><span data-ttu-id="8ab92-202">另一個範例中的虛線 CENC 保護內容，理論上，請使用的 tooprotect 視訊資料流和另一個內容金鑰 tooprotect 音訊資料流，可以是一個內容金鑰。</span><span class="sxs-lookup"><span data-stu-id="8ab92-202">Another example, in CENC protection of DASH content, in theory, one content key can be used tooprotect video stream and another content key tooprotect audio stream.</span></span> |
| <span data-ttu-id="8ab92-203">許多 – 太對多</span><span class="sxs-lookup"><span data-stu-id="8ab92-203">Many – too- Many</span></span> |<span data-ttu-id="8ab92-204">Hello 上述兩個案例的組合： 一組內容金鑰可用於每個 hello 的多個資產的 hello 相同資產 「 群組 」。</span><span class="sxs-lookup"><span data-stu-id="8ab92-204">Combination of hello above two scenarios: one set of content keys are used for each of hello multiple assets in hello same asset “group”.</span></span> |

<span data-ttu-id="8ab92-205">另一個重要的因素 tooconsider 是 hello 使用持續性和非持續性授權。</span><span class="sxs-lookup"><span data-stu-id="8ab92-205">Another important factor tooconsider is hello use of persistent and non-persistent licenses.</span></span>

<span data-ttu-id="8ab92-206">這些考量為何重要？</span><span class="sxs-lookup"><span data-stu-id="8ab92-206">Why are these considerations important?</span></span>

<span data-ttu-id="8ab92-207">它們有直接的影響 toolicense 傳遞，若您使用公用雲端來授權傳遞成本。</span><span class="sxs-lookup"><span data-stu-id="8ab92-207">They have direct impact toolicense delivery cost if you use public cloud for license delivery.</span></span> <span data-ttu-id="8ab92-208">讓我們考量有下列兩個不同的設計案例 tooillustrate hello:</span><span class="sxs-lookup"><span data-stu-id="8ab92-208">Let’s consider hello following two different design cases tooillustrate:</span></span>

1. <span data-ttu-id="8ab92-209">每月訂用帳戶：使用持續性授權，以及 1 對多的內容金鑰對資產對應。</span><span class="sxs-lookup"><span data-stu-id="8ab92-209">Monthly subscription: Use persistent license, and 1-to-many content key-to-asset mapping.</span></span> <span data-ttu-id="8ab92-210">例如</span><span class="sxs-lookup"><span data-stu-id="8ab92-210">E.g.</span></span> <span data-ttu-id="8ab92-211">所有的 hello 兒童影片中，我們會使用單一內容金鑰加密。</span><span class="sxs-lookup"><span data-stu-id="8ab92-211">for all hello kids movies, we use a single content key for encryption.</span></span> <span data-ttu-id="8ab92-212">在此案例中：</span><span class="sxs-lookup"><span data-stu-id="8ab92-212">In this case:</span></span>

    <span data-ttu-id="8ab92-213">所有兒童影片/裝置的授權數總計 = 1</span><span class="sxs-lookup"><span data-stu-id="8ab92-213">Total # licenses requested for all kids movies/device = 1</span></span>
2. <span data-ttu-id="8ab92-214">每月訂用帳戶：使用非持續性授權，以及內容金鑰和資產之間的 1 對 1 對應。</span><span class="sxs-lookup"><span data-stu-id="8ab92-214">Monthly subscription: Use non-persistent license, and 1-to-1 mapping between content key and asset.</span></span> <span data-ttu-id="8ab92-215">在此案例中：</span><span class="sxs-lookup"><span data-stu-id="8ab92-215">In this case:</span></span>

    <span data-ttu-id="8ab92-216">所有兒童影片/裝置的授權數總計 = [觀賞影片數] x [工作階段數]</span><span class="sxs-lookup"><span data-stu-id="8ab92-216">Total # licenses requested for all kids movies/device = [# movies watched] x [# sessions]</span></span>

<span data-ttu-id="8ab92-217">您可以輕鬆地看到，hello 兩個不同的設計導致非常不同的授權要求模式，因此授權成本如果授權傳遞服務係由 Azure Media Services 例如公用雲端的傳遞。</span><span class="sxs-lookup"><span data-stu-id="8ab92-217">As you can easily see, hello two different designs result in very different license request patterns hence license delivery cost if license delivery service is provided by a public cloud such as Azure Media Services.</span></span>

## <a name="mapping-design-tootechnology-for-implementation"></a><span data-ttu-id="8ab92-218">對應設計 tootechnology 實作</span><span class="sxs-lookup"><span data-stu-id="8ab92-218">Mapping design tootechnology for implementation</span></span>
<span data-ttu-id="8ab92-219">接下來，我們將 Microsoft Azure/Azure Media Services 平台上，我們一般設計 tootechnologies 對應藉由指定的每個建置組塊的技術 toouse。</span><span class="sxs-lookup"><span data-stu-id="8ab92-219">Next, we map our generic design tootechnologies on Microsoft Azure/Azure Media Services platform, by specifying which technology toouse for each building block.</span></span>

<span data-ttu-id="8ab92-220">hello 下表顯示 hello 對應：</span><span class="sxs-lookup"><span data-stu-id="8ab92-220">hello following table shows hello mapping:</span></span>

| <span data-ttu-id="8ab92-221">**建置組塊**</span><span class="sxs-lookup"><span data-stu-id="8ab92-221">**Building Block**</span></span> | <span data-ttu-id="8ab92-222">**Technology**</span><span class="sxs-lookup"><span data-stu-id="8ab92-222">**Technology**</span></span> |
| --- | --- |
| <span data-ttu-id="8ab92-223">**播放器**</span><span class="sxs-lookup"><span data-stu-id="8ab92-223">**Player**</span></span> |[<span data-ttu-id="8ab92-224">Azure Media Player</span><span class="sxs-lookup"><span data-stu-id="8ab92-224">Azure Media Player</span></span>](https://azure.microsoft.com/services/media-services/media-player/) |
| <span data-ttu-id="8ab92-225">**身分識別提供者 (IDP)**</span><span class="sxs-lookup"><span data-stu-id="8ab92-225">**Identity Provider (IDP)**</span></span> |<span data-ttu-id="8ab92-226">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="8ab92-226">Azure Active Directory</span></span> |
| <span data-ttu-id="8ab92-227">**安全權杖服務 (STS)**</span><span class="sxs-lookup"><span data-stu-id="8ab92-227">**Secure Token Service (STS)**</span></span> |<span data-ttu-id="8ab92-228">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="8ab92-228">Azure Active Directory</span></span> |
| <span data-ttu-id="8ab92-229">**DRM 保護工作流程**</span><span class="sxs-lookup"><span data-stu-id="8ab92-229">**DRM Protection Workflow**</span></span> |<span data-ttu-id="8ab92-230">Azure 媒體服務動態保護</span><span class="sxs-lookup"><span data-stu-id="8ab92-230">Azure Media Services Dynamic Protection</span></span> |
| <span data-ttu-id="8ab92-231">**DRM 授權傳遞**</span><span class="sxs-lookup"><span data-stu-id="8ab92-231">**DRM License Delivery**</span></span> |<span data-ttu-id="8ab92-232">1.Azure 媒體服務授權傳遞 (PlayReady、Widevine、FairPlay) 或</span><span class="sxs-lookup"><span data-stu-id="8ab92-232">1. Azure Media Services License Delivery (PlayReady, Widevine, FairPlay), or</span></span> <br/><span data-ttu-id="8ab92-233">2.Axinom 授權伺服器，</span><span class="sxs-lookup"><span data-stu-id="8ab92-233">2. Axinom License Server,</span></span> <br/><span data-ttu-id="8ab92-234">3.自訂 PlayReady 授權伺服器</span><span class="sxs-lookup"><span data-stu-id="8ab92-234">3. Custom PlayReady License Server</span></span> |
| <span data-ttu-id="8ab92-235">**原始**</span><span class="sxs-lookup"><span data-stu-id="8ab92-235">**Origin**</span></span> |<span data-ttu-id="8ab92-236">Azure 媒體服務串流端點</span><span class="sxs-lookup"><span data-stu-id="8ab92-236">Azure Media Services Streaming Endpoint</span></span> |
| <span data-ttu-id="8ab92-237">**金鑰管理**</span><span class="sxs-lookup"><span data-stu-id="8ab92-237">**Key Management**</span></span> |<span data-ttu-id="8ab92-238">不需要參考實作</span><span class="sxs-lookup"><span data-stu-id="8ab92-238">Not needed for reference implementation</span></span> |
| <span data-ttu-id="8ab92-239">**內容管理**</span><span class="sxs-lookup"><span data-stu-id="8ab92-239">**Content Management**</span></span> |<span data-ttu-id="8ab92-240">C# 主控台應用程式</span><span class="sxs-lookup"><span data-stu-id="8ab92-240">A C# console application</span></span> |

<span data-ttu-id="8ab92-241">換句話說，身分識別提供者 (IDP) 和安全權杖服務 (STS) 都將是 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="8ab92-241">In other words, both Identity Provider (IDP) and Secure Token Service (STS) will be Azure AD.</span></span> <span data-ttu-id="8ab92-242">對於播放器，我們將會使用 [Azure 媒體播放器 API](http://amp.azure.net/libs/amp/latest/docs/)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-242">For player, we will use [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="8ab92-243">Azure 媒體服務和 Azure Media Player 都支援具有多重 DRM 的 DASH 和 CENC。</span><span class="sxs-lookup"><span data-stu-id="8ab92-243">Both Azure Media Services and Azure Media Player support DASH and CENC with multi-DRM.</span></span>

<span data-ttu-id="8ab92-244">下列圖表顯示 hello hello 以上述技術對應 hello 的整體結構與流程。</span><span class="sxs-lookup"><span data-stu-id="8ab92-244">hello following diagram shows hello overall structure and flow with hello above technology mapping.</span></span>

![AMS 上的 CENC](./media/media-services-cenc-with-multidrm-access-control/media-services-cenc-subsystem-on-AMS-platform.png)

<span data-ttu-id="8ab92-246">順序 tooset 動態 CENC 加密設定，在 hello 內容管理工具將使用下列輸入 hello:</span><span class="sxs-lookup"><span data-stu-id="8ab92-246">In order tooset up dynamic CENC encryption, hello content management tool will use hello following inputs:</span></span>

1. <span data-ttu-id="8ab92-247">開啟內容；</span><span class="sxs-lookup"><span data-stu-id="8ab92-247">Open content;</span></span>
2. <span data-ttu-id="8ab92-248">來自金鑰產生/管理的內容金鑰；</span><span class="sxs-lookup"><span data-stu-id="8ab92-248">Content key from key generation/management;</span></span>
3. <span data-ttu-id="8ab92-249">授權取得 URL；</span><span class="sxs-lookup"><span data-stu-id="8ab92-249">License acquisition URLs;</span></span>
4. <span data-ttu-id="8ab92-250">Azure AD 中的資訊清單。</span><span class="sxs-lookup"><span data-stu-id="8ab92-250">A list of information from Azure AD.</span></span>

<span data-ttu-id="8ab92-251">hello 輸出 hello 內容管理工具將會：</span><span class="sxs-lookup"><span data-stu-id="8ab92-251">hello output of hello content management tool will be:</span></span>

1. <span data-ttu-id="8ab92-252">包含如何授權傳遞驗證的 JWT 語彙基元和 DRM 授權規格; hello 規格 ContentKeyAuthorizationPolicy</span><span class="sxs-lookup"><span data-stu-id="8ab92-252">ContentKeyAuthorizationPolicy containing hello specification on how license delivery verifies a JWT token and DRM license specifications;</span></span>
2. <span data-ttu-id="8ab92-253">AssetDeliveryPolicy，包含串流格式、DRM 保護和授權取得 URL 的規格。</span><span class="sxs-lookup"><span data-stu-id="8ab92-253">AssetDeliveryPolicy containing specifications on streaming format, DRM protection and license acquisition URLs.</span></span>

<span data-ttu-id="8ab92-254">Hello 流程是在執行階段如下：</span><span class="sxs-lookup"><span data-stu-id="8ab92-254">During runtime, hello flow is as below:</span></span>

1. <span data-ttu-id="8ab92-255">在使用者驗證時，會產生 JWT 權杖；</span><span class="sxs-lookup"><span data-stu-id="8ab92-255">Upon user authentication, a JWT token is generated;</span></span>
2. <span data-ttu-id="8ab92-256">包含 「 EntitledUserGroup"hello 群組物件識別碼的 「 群組 」 宣告的 hello 宣告 hello JWT 權杖中包含的其中一個。</span><span class="sxs-lookup"><span data-stu-id="8ab92-256">One of hello claims contained in hello JWT token is “groups” claim containing hello group object ID of “EntitledUserGroup”.</span></span> <span data-ttu-id="8ab92-257">這個宣告會用於傳遞「權利檢查」。</span><span class="sxs-lookup"><span data-stu-id="8ab92-257">This claim will be used for passing “entitlement check”.</span></span>
3. <span data-ttu-id="8ab92-258">播放程式下載用戶端資訊清單的 CENC 受保護的內容和 「 看見 」 hello 下列：</span><span class="sxs-lookup"><span data-stu-id="8ab92-258">Player downloads client manifest of a CENC protected content and “sees” hello following:</span></span>

   1. <span data-ttu-id="8ab92-259">金鑰識別碼，</span><span class="sxs-lookup"><span data-stu-id="8ab92-259">key ID,</span></span>
   2. <span data-ttu-id="8ab92-260">hello 內容是受保護的 CENC</span><span class="sxs-lookup"><span data-stu-id="8ab92-260">hello content is CENC protected,</span></span>
   3. <span data-ttu-id="8ab92-261">授權取得 URL。</span><span class="sxs-lookup"><span data-stu-id="8ab92-261">License acquisition URLs.</span></span>
4. <span data-ttu-id="8ab92-262">播放程式就會根據 hello 瀏覽器/DRM 支援授權擷取要求。</span><span class="sxs-lookup"><span data-stu-id="8ab92-262">Player makes a license acquisition request based on hello browser/DRM supported.</span></span> <span data-ttu-id="8ab92-263">Hello 授權取得要求、 索引鍵識別碼和 hello JWT 中也會提交語彙基元。</span><span class="sxs-lookup"><span data-stu-id="8ab92-263">In hello license acquisition request, key ID and hello JWT token will also be submitted.</span></span> <span data-ttu-id="8ab92-264">授權傳遞服務會確認 hello JWT 權杖和 hello 宣告包含之前發出 hello 需要授權。</span><span class="sxs-lookup"><span data-stu-id="8ab92-264">License delivery service will verify hello JWT token and hello claims contained before issuing hello needed license.</span></span>

## <a name="implementation"></a><span data-ttu-id="8ab92-265">實作</span><span class="sxs-lookup"><span data-stu-id="8ab92-265">Implementation</span></span>
### <a name="implementation-procedures"></a><span data-ttu-id="8ab92-266">實作程序</span><span class="sxs-lookup"><span data-stu-id="8ab92-266">Implementation procedures</span></span>
<span data-ttu-id="8ab92-267">hello 實作會包含下列步驟的 hello:</span><span class="sxs-lookup"><span data-stu-id="8ab92-267">hello implementation will include hello following steps:</span></span>

1. <span data-ttu-id="8ab92-268">準備測試 asset(s)： 編碼/封裝測試視訊 toomulti-位元速率分散 MP4 Azure 媒體服務中的。</span><span class="sxs-lookup"><span data-stu-id="8ab92-268">Prepare test asset(s): encode/package a test video toomulti-bitrate fragmented MP4 in Azure Media Services.</span></span> <span data-ttu-id="8ab92-269">這項資產不受 DRM 保護。</span><span class="sxs-lookup"><span data-stu-id="8ab92-269">This asset is NOT DRM protected.</span></span> <span data-ttu-id="8ab92-270">DRM 保護稍後會由動態保護完成。</span><span class="sxs-lookup"><span data-stu-id="8ab92-270">DRM protection will be done by dynamic protection later.</span></span>
2. <span data-ttu-id="8ab92-271">建立金鑰識別碼和內容金鑰 (選擇性地從金鑰種子)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-271">Create key ID and content key (optionally from key seed).</span></span> <span data-ttu-id="8ab92-272">對於我們的目的，不需要金鑰管理系統，因為我們只會針對一些測試資產處理一組金鑰識別碼和內容金鑰；</span><span class="sxs-lookup"><span data-stu-id="8ab92-272">For our purpose, key management system is not needed since we are dealing with only a single set of key ID and content key for a couple of test assets;</span></span>
3. <span data-ttu-id="8ab92-273">使用 AMS API tooconfigure 多重 DRM 授權傳遞服務 hello 測試資產。</span><span class="sxs-lookup"><span data-stu-id="8ab92-273">Use AMS API tooconfigure multi-DRM license delivery services for hello test asset.</span></span> <span data-ttu-id="8ab92-274">如果您使用自訂的授權伺服器透過您的公司或您公司的廠商，而不是在 Azure 媒體服務授權服務，您可以略過此步驟，並指定在 hello 步驟中設定授權傳遞的授權取得 Url。</span><span class="sxs-lookup"><span data-stu-id="8ab92-274">If you are using custom license servers by your company or your company’s vendors instead of license services in Azure Media Services, you can skip this step and specify license acquisition URLs in hello step for configuring license delivery.</span></span> <span data-ttu-id="8ab92-275">AMS API 是所需的一些詳細的 toospecify 組態，例如授權原則限制，授權等不同 DRM 授權服務的回應範本。此時，hello Azure 入口網站尚未提供此設定 hello 所需 UI。</span><span class="sxs-lookup"><span data-stu-id="8ab92-275">AMS API is needed toospecify some detailed configurations, such as authorization policy restriction, license response templates for different DRM license services, etc. At this time, hello Azure portal does not yet provide hello needed UI for this configuration.</span></span> <span data-ttu-id="8ab92-276">您可以在 Julia Kornich 的文件中尋找 API 層級資訊和範例程式碼： [使用 PlayReady 和/或 Widevine Dynamic Common Encryption](media-services-protect-with-drm.md)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-276">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
4. <span data-ttu-id="8ab92-277">用於 hello 測試資產 AMS API tooconfigure 資產傳遞原則。</span><span class="sxs-lookup"><span data-stu-id="8ab92-277">Use AMS API tooconfigure asset delivery policy for hello test asset.</span></span> <span data-ttu-id="8ab92-278">您可以在 Julia Kornich 的文件中尋找 API 層級資訊和範例程式碼： [使用 PlayReady 和/或 Widevine Dynamic Common Encryption](media-services-protect-with-drm.md)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-278">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
5. <span data-ttu-id="8ab92-279">在 Azure 中建立和設定 Azure Active Directory 租用戶；</span><span class="sxs-lookup"><span data-stu-id="8ab92-279">Create and configure an Azure Active Directory tenant in Azure;</span></span>
6. <span data-ttu-id="8ab92-280">Azure Active Directory 租用戶中建立幾個使用者帳戶和群組： 您應該至少建立"EntitledUser 」 群組，並新增使用者 toothis 群組。</span><span class="sxs-lookup"><span data-stu-id="8ab92-280">Create a few user accounts and groups in your Azure Active Directory tenant: you should create at least “EntitledUser” group and add a user toothis group.</span></span> <span data-ttu-id="8ab92-281">此群組中的使用者將會傳入取得授權的權限核取並不在此群組中的使用者將會失敗 toopass 驗證檢查，而且也不會無法 tooacquire 任何授權。</span><span class="sxs-lookup"><span data-stu-id="8ab92-281">Users in this group will pass entitlement check in license acquisition and users not in this group will fail toopass authentication check and will not be able tooacquire any license.</span></span> <span data-ttu-id="8ab92-282">這個 「 EntitledUser 」 群組的成員，是在 hello Azure AD 所簽發的 JWT 權杖中必要的 「 群組 」 宣告。</span><span class="sxs-lookup"><span data-stu-id="8ab92-282">Being a member of this “EntitledUser” group is a required “groups” claim in hello JWT token issued by Azure AD.</span></span> <span data-ttu-id="8ab92-283">這個宣告需求應該在設定多重 DRM 授權傳遞服務步驟中指定。</span><span class="sxs-lookup"><span data-stu-id="8ab92-283">This claim requirement should be specified in configuring multi-DRM license delivery services step.</span></span>
7. <span data-ttu-id="8ab92-284">建立 ASP.NET MVC 應用程式，它將會裝載視訊播放器。</span><span class="sxs-lookup"><span data-stu-id="8ab92-284">Create an ASP.NET MVC app which will be hosting your video player.</span></span> <span data-ttu-id="8ab92-285">此 ASP.NET 應用程式將保護的 hello Azure Active Directory 租用戶的使用者驗證。</span><span class="sxs-lookup"><span data-stu-id="8ab92-285">This ASP.NET app will be protected with user authentication against hello Azure Active Directory tenant.</span></span> <span data-ttu-id="8ab92-286">在 hello 存取權杖取得使用者驗證之後，將會包含適當的宣告。</span><span class="sxs-lookup"><span data-stu-id="8ab92-286">Proper claims will be included in hello access tokens obtained after user authentication.</span></span> <span data-ttu-id="8ab92-287">建議在此步驟使用 OpenID Connect API。</span><span class="sxs-lookup"><span data-stu-id="8ab92-287">OpenID Connect API is recommended for this step.</span></span> <span data-ttu-id="8ab92-288">您需要下列 NuGet 封裝 tooinstall hello:</span><span class="sxs-lookup"><span data-stu-id="8ab92-288">You need tooinstall hello following NuGet packages:</span></span>
   * <span data-ttu-id="8ab92-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span><span class="sxs-lookup"><span data-stu-id="8ab92-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span></span>
   * <span data-ttu-id="8ab92-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span><span class="sxs-lookup"><span data-stu-id="8ab92-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span></span>
   * <span data-ttu-id="8ab92-291">Install-Package Microsoft.Owin.Security.Cookies</span><span class="sxs-lookup"><span data-stu-id="8ab92-291">Install-Package Microsoft.Owin.Security.Cookies</span></span>
   * <span data-ttu-id="8ab92-292">Install-Package Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="8ab92-292">Install-Package Microsoft.Owin.Host.SystemWeb</span></span>
   * <span data-ttu-id="8ab92-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span><span class="sxs-lookup"><span data-stu-id="8ab92-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span></span>
8. <span data-ttu-id="8ab92-294">使用 [Azure 媒體播放器 API](http://amp.azure.net/libs/amp/latest/docs/)來建立播放器。</span><span class="sxs-lookup"><span data-stu-id="8ab92-294">Create a player using [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="8ab92-295">[Azure Media Player 的 ProtectionInfo API](http://amp.azure.net/libs/amp/latest/docs/) toospecify 可讓您在不同的 DRM 平台上的 DRM 技術 toouse。</span><span class="sxs-lookup"><span data-stu-id="8ab92-295">[Azure Media Player’s ProtectionInfo API](http://amp.azure.net/libs/amp/latest/docs/) allows you toospecify which DRM technology toouse on different DRM platform.</span></span>
9. <span data-ttu-id="8ab92-296">測試矩陣：</span><span class="sxs-lookup"><span data-stu-id="8ab92-296">Test matrix:</span></span>

| <span data-ttu-id="8ab92-297">**DRM**</span><span class="sxs-lookup"><span data-stu-id="8ab92-297">**DRM**</span></span> | <span data-ttu-id="8ab92-298">**[瀏覽器]**</span><span class="sxs-lookup"><span data-stu-id="8ab92-298">**Browser**</span></span> | <span data-ttu-id="8ab92-299">**有權限的使用者的結果**</span><span class="sxs-lookup"><span data-stu-id="8ab92-299">**Result for Entitled User**</span></span> | <span data-ttu-id="8ab92-300">**無權限的使用者的結果**</span><span class="sxs-lookup"><span data-stu-id="8ab92-300">**Result for Un-entitled User**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="8ab92-301">**PlayReady**</span><span class="sxs-lookup"><span data-stu-id="8ab92-301">**PlayReady**</span></span> |<span data-ttu-id="8ab92-302">MS Edge 或 Windows 10 上的 IE11</span><span class="sxs-lookup"><span data-stu-id="8ab92-302">MS Edge or IE11 on Windows 10</span></span> |<span data-ttu-id="8ab92-303">成功</span><span class="sxs-lookup"><span data-stu-id="8ab92-303">Succeed</span></span> |<span data-ttu-id="8ab92-304">不合格</span><span class="sxs-lookup"><span data-stu-id="8ab92-304">Fail</span></span> |
| <span data-ttu-id="8ab92-305">**Widevine**</span><span class="sxs-lookup"><span data-stu-id="8ab92-305">**Widevine**</span></span> |<span data-ttu-id="8ab92-306">Windows 10 上的 Chrome</span><span class="sxs-lookup"><span data-stu-id="8ab92-306">Chrome on Windows 10</span></span> |<span data-ttu-id="8ab92-307">成功</span><span class="sxs-lookup"><span data-stu-id="8ab92-307">Succeed</span></span> |<span data-ttu-id="8ab92-308">不合格</span><span class="sxs-lookup"><span data-stu-id="8ab92-308">Fail</span></span> |
| <span data-ttu-id="8ab92-309">**FairPlay**</span><span class="sxs-lookup"><span data-stu-id="8ab92-309">**FairPlay**</span></span> |<span data-ttu-id="8ab92-310">TBD</span><span class="sxs-lookup"><span data-stu-id="8ab92-310">TBD</span></span> | | |

<span data-ttu-id="8ab92-311">Azure 媒體服務團隊的 George Trifonov 所撰寫的部落格提供針對 ASP.NET MVC 播放器應用程式來設定 Azure Active Directory 的詳細步驟： [Integrate Azure Media Services OWIN MVC based app with Azure Active Directory and restrict content key delivery based on JWT claims (整合 Azure 媒體服務 OWIN MVC 型應用程式與 Azure Active Directory，並根據 JWT 宣告來限制內容金鑰傳遞)](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-311">George Trifonov of Azure Media Services Team has written a blog providing detailed steps in setting up Azure Active Directory for an ASP.NET MVC player app: [Integrate Azure Media Services OWIN MVC based app with Azure Active Directory and restrict content key delivery based on JWT claims](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span></span>

<span data-ttu-id="8ab92-312">George 也撰寫了一篇相關的部落格文章： [JWT token Authentication in Azure Media Services and Dynamic Encryption (Azure 媒體服務和動態加密中的 JWT 權杖驗證)](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-312">George has also written a blog on [JWT token Authentication in Azure Media Services and Dynamic Encryption](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span> <span data-ttu-id="8ab92-313">以下是他 [整合 Azure AD 與 Azure 媒體服務金鑰傳遞的範例](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-313">And here is his [sample on Azure AD integration with Azure Media Services key delivery](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span></span>

<span data-ttu-id="8ab92-314">如需 Azure Active Directory 的詳細資訊：</span><span class="sxs-lookup"><span data-stu-id="8ab92-314">For information on Azure Active Directory:</span></span>

* <span data-ttu-id="8ab92-315">您可以在 [Azure Active Directory 開發人員指南](../active-directory/active-directory-developers-guide.md)中找到開發人員的資訊。</span><span class="sxs-lookup"><span data-stu-id="8ab92-315">You can find developer information in [Azure Active Directory Developer’s Guide](../active-directory/active-directory-developers-guide.md).</span></span>
* <span data-ttu-id="8ab92-316">您可以在 [管理 Azure AD 目錄](../active-directory/active-directory-administer.md)中找到系統管理員的資訊。</span><span class="sxs-lookup"><span data-stu-id="8ab92-316">You can find administrator information in [Administer Your Azure AD Directory](../active-directory/active-directory-administer.md).</span></span>

### <a name="some-gotchas-in-implementation"></a><span data-ttu-id="8ab92-317">實作中的一些錯誤</span><span class="sxs-lookup"><span data-stu-id="8ab92-317">Some gotchas in implementation</span></span>
<span data-ttu-id="8ab92-318">Hello 實作中有一些 「 問題 」。</span><span class="sxs-lookup"><span data-stu-id="8ab92-318">There are some “gotchas” in hello implementation.</span></span> <span data-ttu-id="8ab92-319">但願 hello 遵循 「 問題 」 的清單可協助您疑難排解萬一您遇到問題。</span><span class="sxs-lookup"><span data-stu-id="8ab92-319">Hopefully hello following list of “gotchas” can help you troubleshooting in case you run into issues.</span></span>

1. <span data-ttu-id="8ab92-320">**簽發者**的 URL 結尾應該是 **"/"**。</span><span class="sxs-lookup"><span data-stu-id="8ab92-320">**Issuer** URL should end with **"/"**.</span></span>  

    <span data-ttu-id="8ab92-321">**對象**應該 hello 播放器應用程式用戶端識別碼，而且您也應該加入**"/"** hello hello 簽發者 URL 結尾處。</span><span class="sxs-lookup"><span data-stu-id="8ab92-321">**Audience** should be hello player application client ID and you should also add **"/"** at hello end of hello issuer URL.</span></span>

        <add key="ida:audience" value="[Application Client ID GUID]" />
        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/" />

    <span data-ttu-id="8ab92-322">在[JWT 解碼器](http://jwt.calebb.net/)，您應該會看到**則**和**iss** hello JWT 權杖中，如下：</span><span class="sxs-lookup"><span data-stu-id="8ab92-322">In [JWT Decoder](http://jwt.calebb.net/), you should see **aud** and **iss** as below in hello JWT token:</span></span>

    ![第 1 個錯誤](./media/media-services-cenc-with-multidrm-access-control/media-services-1st-gotcha.png)
2. <span data-ttu-id="8ab92-324">（在 hello 應用程式設定 索引標籤），請在 AAD 中新增 toohello 應用程式的權限。</span><span class="sxs-lookup"><span data-stu-id="8ab92-324">Add Permissions toohello application in AAD (on Configure tab of hello application).</span></span> <span data-ttu-id="8ab92-325">對於每個應用程式這是必要的 (本機和已部署版本)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-325">This is required for each application (local and deployed versions).</span></span>

    ![第 2 個錯誤](./media/media-services-cenc-with-multidrm-access-control/media-services-perms-to-other-apps.png)
3. <span data-ttu-id="8ab92-327">使用中設定動態 CENC 保護 hello 正確的簽發者：</span><span class="sxs-lookup"><span data-stu-id="8ab92-327">Use hello right issuer in setting up dynamic CENC protection:</span></span>

        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/"/>

    <span data-ttu-id="8ab92-328">hello 下列將不會運作：</span><span class="sxs-lookup"><span data-stu-id="8ab92-328">hello following will not work:</span></span>

        <add key="ida:issuer" value="https://willzhanad.onmicrosoft.com/" />

    <span data-ttu-id="8ab92-329">hello GUID 是 hello AAD 租用戶識別碼。</span><span class="sxs-lookup"><span data-stu-id="8ab92-329">hello GUID is hello AAD tenant ID.</span></span> <span data-ttu-id="8ab92-330">hello GUID 可以找到端點快顯視窗中，在 Azure 入口網站中。</span><span class="sxs-lookup"><span data-stu-id="8ab92-330">hello GUID can be found in Endpoints popup in Azure portal.</span></span>
4. <span data-ttu-id="8ab92-331">授與群組成員資格宣告權限。</span><span class="sxs-lookup"><span data-stu-id="8ab92-331">Grant group membership claims privileges.</span></span> <span data-ttu-id="8ab92-332">確定 AAD 應用程式資訊清單檔中，我們有下列 hello</span><span class="sxs-lookup"><span data-stu-id="8ab92-332">Make sure in AAD application manifest file, we have hello following</span></span>

    <span data-ttu-id="8ab92-333">"groupMembershipClaims":"All"（hello 預設值是 null）</span><span class="sxs-lookup"><span data-stu-id="8ab92-333">"groupMembershipClaims": "All",    (hello default value is null)</span></span>
5. <span data-ttu-id="8ab92-334">建立限制需求時，設定適當的 TokenType。</span><span class="sxs-lookup"><span data-stu-id="8ab92-334">Setting proper TokenType when creating restriction requirements.</span></span>

        objTokenRestrictionTemplate.TokenType = TokenType.JWT;

    <span data-ttu-id="8ab92-335">新增支援的 JWT (AAD) 此外 tooSWT (ACS)，因為 hello 預設 TokenType 是 TokenType.JWT。</span><span class="sxs-lookup"><span data-stu-id="8ab92-335">Since adding support of JWT (AAD) in addition tooSWT (ACS), hello default TokenType is TokenType.JWT.</span></span> <span data-ttu-id="8ab92-336">如果您使用 SWT/ACS 時，您必須設定 tooTokenType.SWT。</span><span class="sxs-lookup"><span data-stu-id="8ab92-336">If you use SWT/ACS, you must set tooTokenType.SWT.</span></span>

## <a name="additional-topics-for-implementation"></a><span data-ttu-id="8ab92-337">Additional Topics for Implementation (其他關於實作的主題)</span><span class="sxs-lookup"><span data-stu-id="8ab92-337">Additional Topics for Implementation</span></span>
<span data-ttu-id="8ab92-338">接下來，我們將討論設計和實作中的其他主題。</span><span class="sxs-lookup"><span data-stu-id="8ab92-338">Next we will disc uss some additional topics in our design and implementation.</span></span>

### <a name="http-or-https"></a><span data-ttu-id="8ab92-339">HTTP 或 HTTPS？</span><span class="sxs-lookup"><span data-stu-id="8ab92-339">HTTP or HTTPS?</span></span>
<span data-ttu-id="8ab92-340">hello 我們建立的 ASP.NET MVC 播放器應用程式必須支援下列 hello:</span><span class="sxs-lookup"><span data-stu-id="8ab92-340">hello ASP.NET MVC player application we built must support hello following:</span></span>

1. <span data-ttu-id="8ab92-341">透過 Azure AD 中，這需要 toobe HTTPS; 下的使用者驗證</span><span class="sxs-lookup"><span data-stu-id="8ab92-341">User authentication through Azure AD which needs toobe under HTTPS;</span></span>
2. <span data-ttu-id="8ab92-342">JWT 權杖 exchange 用戶端與 Azure AD 中，這需要 HTTPS; 下的 toobe 之間</span><span class="sxs-lookup"><span data-stu-id="8ab92-342">JWT token exchange between client and Azure AD which needs toobe under HTTPS;</span></span>
3. <span data-ttu-id="8ab92-343">DRM 取得 hello 用戶端為必要的 toobe HTTPS 之下，如果授權傳遞由 Azure Media Services 提供的授權。</span><span class="sxs-lookup"><span data-stu-id="8ab92-343">DRM license acquisition by hello client which is required toobe under HTTPS if license delivery is provided by Azure Media Services.</span></span> <span data-ttu-id="8ab92-344">當然，PlayReady 產品套件不會針對授權傳遞來授權 HTTPS。</span><span class="sxs-lookup"><span data-stu-id="8ab92-344">Of course, PlayReady product suite does not mandate HTTPS for license delivery.</span></span> <span data-ttu-id="8ab92-345">如果您的 PlayReady 授權伺服器位於 Azure 媒體服務以外的地方，則可以使用 HTTP 或 HTTPS。</span><span class="sxs-lookup"><span data-stu-id="8ab92-345">If your PlayReady license server is outside of Azure Media Services, either HTTP or HTTPS could be used.</span></span>

<span data-ttu-id="8ab92-346">因此，hello ASP.NET 播放器應用程式將最佳做法是使用 HTTPS。</span><span class="sxs-lookup"><span data-stu-id="8ab92-346">Therefore, hello ASP.NET player application will use HTTPS as a best practice.</span></span> <span data-ttu-id="8ab92-347">這表示的 hello Azure Media Player 會在 HTTPS 頁面。</span><span class="sxs-lookup"><span data-stu-id="8ab92-347">This means hello Azure Media Player will be on a page under HTTPS.</span></span> <span data-ttu-id="8ab92-348">不過，對於資料流我們偏好 HTTP，因此我們需要 tooconsider 混合內容的問題。</span><span class="sxs-lookup"><span data-stu-id="8ab92-348">However, for streaming we prefer HTTP, hence we need tooconsider mixed content issue.</span></span>

1. <span data-ttu-id="8ab92-349">瀏覽器不允許混合的內容。</span><span class="sxs-lookup"><span data-stu-id="8ab92-349">Browser does not allow mixed content.</span></span> <span data-ttu-id="8ab92-350">但是如 Silverlight 的外掛程式和適用於 Smooth 和 DASH 的 OSMF 外掛程式允許。</span><span class="sxs-lookup"><span data-stu-id="8ab92-350">But plugins like Silverlight and OSMF plugin for smooth and DASH allow.</span></span> <span data-ttu-id="8ab92-351">混合的內容的安全性問題-這是因為 toohello 威脅的 hello 能力 tooinject 而造成惡意 JS hello 客戶資料 toobe 風險。</span><span class="sxs-lookup"><span data-stu-id="8ab92-351">Mixed content is a security concern - This is due toohello threat of hello ability tooinject malicious JS which can cause hello customer data toobe at risk.</span></span>  <span data-ttu-id="8ab92-352">瀏覽器封鎖了這項預設，且目前 hello 唯一方式 toowork 周圍 hello 伺服器 （來源） 端上，tooallow （不論 https 或 http） 的所有網域。</span><span class="sxs-lookup"><span data-stu-id="8ab92-352">Browsers block this by default and so far hello only way toowork around it is on hello server (origin) side, tooallow all domains (regardless https or http).</span></span> <span data-ttu-id="8ab92-353">這可能也不是個好主意。</span><span class="sxs-lookup"><span data-stu-id="8ab92-353">This is probably not a good idea either.</span></span>
2. <span data-ttu-id="8ab92-354">我們應該避免混合的內容：都使用 HTTP 或都使用 HTTPS。</span><span class="sxs-lookup"><span data-stu-id="8ab92-354">We should avoid mixed content: either both use HTTP or both use HTTPS.</span></span> <span data-ttu-id="8ab92-355">播放混合的內容時，silverlightSS 技術需要清除混合內容警告。</span><span class="sxs-lookup"><span data-stu-id="8ab92-355">When playing mixed content, silverlightSS tech requires clearing a mixed content warning.</span></span> <span data-ttu-id="8ab92-356">flashSS 技術會處理混合的內容，而沒有混合內容警告。</span><span class="sxs-lookup"><span data-stu-id="8ab92-356">flashSS tech handles mixed content without mixed content warning.</span></span>
3. <span data-ttu-id="8ab92-357">如果您的串流端點是在 2014 年 8 月之前建立，它將不會支援 HTTPS。</span><span class="sxs-lookup"><span data-stu-id="8ab92-357">If your streaming endpoint was created before August 2014, it will not support HTTPS.</span></span> <span data-ttu-id="8ab92-358">在此情況下，請針對 HTTPS 建立並使用新的串流端點。</span><span class="sxs-lookup"><span data-stu-id="8ab92-358">In this case, please create and use a new streaming endpoint for HTTPS.</span></span>

<span data-ttu-id="8ab92-359">在 hello 參考實作中，受 DRM 保護內容的應用程式和資料流將會在 HTTTPS 之下。</span><span class="sxs-lookup"><span data-stu-id="8ab92-359">In hello reference implementation, for DRM protected contents, both application and streaming will be under HTTTPS.</span></span> <span data-ttu-id="8ab92-360">開啟的內容，hello 播放程式不需要驗證或授權，因此您擁有 hello liberty toouse 是 HTTP 或 HTTPS。</span><span class="sxs-lookup"><span data-stu-id="8ab92-360">For open contents, hello player does not need authentication or license, so you have hello liberty toouse either HTTP or HTTPS.</span></span>

### <a name="azure-active-directory-signing-key-rollover"></a><span data-ttu-id="8ab92-361">Azure Active Directory 簽署金鑰變換</span><span class="sxs-lookup"><span data-stu-id="8ab92-361">Azure Active Directory signing key rollover</span></span>
<span data-ttu-id="8ab92-362">這是重要的點 tootake 實作的考量。</span><span class="sxs-lookup"><span data-stu-id="8ab92-362">This is an important point tootake into consideration of your implementation.</span></span> <span data-ttu-id="8ab92-363">如果您不會考慮此實作中，已完成的 hello 系統最後會完全位於最多 6 週停止運作。</span><span class="sxs-lookup"><span data-stu-id="8ab92-363">If you do not consider this in your implementation, hello completed system will eventually stop working completely within at most 6 weeks.</span></span>

<span data-ttu-id="8ab92-364">Azure AD 會使用業界標準 tooestablish 信任其本身之間使用 Azure AD 的應用程式。</span><span class="sxs-lookup"><span data-stu-id="8ab92-364">Azure AD uses industry standard tooestablish trust between itself and applications using Azure AD.</span></span> <span data-ttu-id="8ab92-365">具體而言，Azure AD 使用簽署金鑰，該金鑰是由公開和私密金鑰組所組成。</span><span class="sxs-lookup"><span data-stu-id="8ab92-365">Specifically, Azure AD uses a signing key that consists of a public and private key pair.</span></span> <span data-ttu-id="8ab92-366">當 Azure AD 會建立包含 hello 使用者的相關資訊的安全性權杖時，這個權杖是由使用其私密金鑰，然後才傳送出去後 toohello 應用程式的 Azure AD 中簽署。</span><span class="sxs-lookup"><span data-stu-id="8ab92-366">When Azure AD creates a security token that contains information about hello user, this token is signed by Azure AD using its private key before it is sent back toohello application.</span></span> <span data-ttu-id="8ab92-367">hello 語彙基元的 tooverify 有效且確實來自 Azure AD，hello 應用程式必須驗證 hello 權杖之簽章使用 hello hello 租用戶同盟中繼資料文件中包含的 Azure AD 所公開的公開金鑰。</span><span class="sxs-lookup"><span data-stu-id="8ab92-367">tooverify that hello token is valid and actually originated from Azure AD, hello application must validate hello token’s signature using hello public key exposed by Azure AD that is contained in hello tenant’s federation metadata document.</span></span> <span data-ttu-id="8ab92-368">這個公用金鑰 – 和簽章的金鑰衍生出 hello – 是 hello 用於在 Azure AD 中的所有租用戶的同一個。</span><span class="sxs-lookup"><span data-stu-id="8ab92-368">This public key – and hello signing key from which it derives – is hello same one used for all tenants in Azure AD.</span></span>

<span data-ttu-id="8ab92-369">Azure AD 金鑰變換的詳細的資訊，請參閱 hello 文件：[重要資訊在 Azure AD 中簽署金鑰變換](../active-directory/active-directory-signing-key-rollover.md)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-369">Detailed info on Azure AD key rollover can be found in hello document: [Important Information about Signing Key Rollover in Azure AD](../active-directory/active-directory-signing-key-rollover.md).</span></span>

<span data-ttu-id="8ab92-370">Hello 之間[公開-私密金鑰組](https://login.microsoftonline.com/common/discovery/keys/)，</span><span class="sxs-lookup"><span data-stu-id="8ab92-370">Between hello [public-private key pair](https://login.microsoftonline.com/common/discovery/keys/),</span></span>

* <span data-ttu-id="8ab92-371">使用 hello 私密金鑰由 Azure Active Directory toogenerate JWT 權杖中。</span><span class="sxs-lookup"><span data-stu-id="8ab92-371">hello private key is used by Azure Active Directory toogenerate a JWT token;</span></span>
* <span data-ttu-id="8ab92-372">hello 公開金鑰用在 AMS tooverify hello JWT 權杖中; 例如 DRM 授權傳遞服務應用程式</span><span class="sxs-lookup"><span data-stu-id="8ab92-372">hello public key is used by an application such as DRM License Delivery Services in AMS tooverify hello JWT token;</span></span>

<span data-ttu-id="8ab92-373">基於安全性目的，Azure Active Directory 會定期替換此憑證 (每隔 6 週)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-373">For security purpose, Azure Active Directory rotates this certificate periodically (every 6 weeks).</span></span> <span data-ttu-id="8ab92-374">發生安全性漏洞時 hello 金鑰變換可能會發生任何時間。</span><span class="sxs-lookup"><span data-stu-id="8ab92-374">In case of security breaches, hello key rollover can occur any time.</span></span> <span data-ttu-id="8ab92-375">因此，在 AMS hello 授權傳遞服務需要 tooupdate hello 公開金鑰做為 Azure AD 會旋轉 hello 金鑰組，否則在 AMS 權杖驗證將會失敗並會發出任何授權。</span><span class="sxs-lookup"><span data-stu-id="8ab92-375">Therefore, hello license delivery services in AMS need tooupdate hello public key used as Azure AD rotates hello key pair, otherwise token authentication in AMS will fail and no license will be issued.</span></span>

<span data-ttu-id="8ab92-376">設定 DRM 授權傳遞服務時，這是藉由設定 TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument 來達成。</span><span class="sxs-lookup"><span data-stu-id="8ab92-376">This is achieved by setting TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument when configuring DRM license delivery services.</span></span>

<span data-ttu-id="8ab92-377">hello JWT 權杖流程為如下：</span><span class="sxs-lookup"><span data-stu-id="8ab92-377">hello JWT token flow is as below:</span></span>

1. <span data-ttu-id="8ab92-378">Azure AD 會發出 hello JWT 權杖，hello 目前私密金鑰已驗證使用者;</span><span class="sxs-lookup"><span data-stu-id="8ab92-378">Azure AD will issue hello JWT token with hello current private key for an authenticated user;</span></span>
2. <span data-ttu-id="8ab92-379">當播放程式看到 CENC 具有多重 DRM 保護內容時，它會先找出 hello Azure AD 所簽發的 JWT 語彙基元。</span><span class="sxs-lookup"><span data-stu-id="8ab92-379">When a player sees a CENC with multi-DRM protected content, it will first locate hello JWT token issued by Azure AD.</span></span>
3. <span data-ttu-id="8ab92-380">hello player AMS; 以傳送 hello JWT 語彙基元 toolicense 傳遞服務與授權擷取要求</span><span class="sxs-lookup"><span data-stu-id="8ab92-380">hello player sends license acquisition request with hello JWT token toolicense delivery services in AMS;</span></span>
4. <span data-ttu-id="8ab92-381">AMS hello 授權傳遞服務會使用 hello 目前/有效公用的金鑰從 Azure AD tooverify hello JWT 權杖中，然後再發出授權。</span><span class="sxs-lookup"><span data-stu-id="8ab92-381">hello license delivery services in AMS will use hello current/valid public key from Azure AD tooverify hello JWT token, before issuing licenses.</span></span>

<span data-ttu-id="8ab92-382">DRM 授權傳遞服務永遠會檢查 hello 目前/有效公開金鑰從 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="8ab92-382">DRM license delivery services will always be checking for hello current/valid public key from Azure AD.</span></span> <span data-ttu-id="8ab92-383">將用來驗證 Azure AD 所簽發的 JWT 語彙基元的 hello 金鑰 hello Azure AD 所呈現的公開金鑰。</span><span class="sxs-lookup"><span data-stu-id="8ab92-383">hello public key presented by Azure AD will be hello key used for verifying a JWT token issued by Azure AD.</span></span>

<span data-ttu-id="8ab92-384">如果之後 AAD 產生的 JWT 語彙基元，但玩家 tooDRM 授權傳遞服務會在 AMS 針對驗證權杖會傳送 hello JWT 之前，會發生情況 hello 金鑰變換？</span><span class="sxs-lookup"><span data-stu-id="8ab92-384">What if hello key rollover happens after AAD generates a JWT token but before hello JWT token is sent by players tooDRM license delivery services in AMS for verification?</span></span>

<span data-ttu-id="8ab92-385">因為金鑰可能會在任何時間變換，一定會一個以上有效的公開金鑰可用 hello 同盟中繼資料文件中。</span><span class="sxs-lookup"><span data-stu-id="8ab92-385">Because a key may be rolled at any moment, there is always more than one valid public key available in hello federation metadata document.</span></span> <span data-ttu-id="8ab92-386">Azure 媒體服務授權傳遞可使用任何 hello 指定索引鍵在 hello 文件，由於其中一個索引鍵可能會過期，所以另一個可能是一個取代，等等。</span><span class="sxs-lookup"><span data-stu-id="8ab92-386">Azure Media Services license delivery can use any of hello keys specified in hello document, since one key may be rolled soon, another may be its replacement, and so forth.</span></span>

### <a name="where-is-hello-access-token"></a><span data-ttu-id="8ab92-387">其中是 hello 存取權杖？</span><span class="sxs-lookup"><span data-stu-id="8ab92-387">Where is hello Access Token?</span></span>
<span data-ttu-id="8ab92-388">如果您查看如何 web 應用程式呼叫 API 應用程式在[使用 OAuth 2.0 用戶端認證授與應用程式識別](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api)，hello 驗證流程為如下：</span><span class="sxs-lookup"><span data-stu-id="8ab92-388">If you look at how a web app calls an API app under [Application Identity with OAuth 2.0 Client Credentials Grant](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), hello authentication flow is as below:</span></span>

1. <span data-ttu-id="8ab92-389">使用者登入 tooAzure AD hello web 應用程式中 (請參閱 hello[應用程式的網頁瀏覽器 tooWeb](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-389">A user is signed in tooAzure AD in hello web application (see hello [Web Browser tooWeb Application](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application).</span></span>
2. <span data-ttu-id="8ab92-390">hello Azure AD 授權端點重新導向 hello 使用者代理程式後 toohello 用戶端應用程式並提供授權碼。</span><span class="sxs-lookup"><span data-stu-id="8ab92-390">hello Azure AD authorization endpoint redirects hello user agent back toohello client application with an authorization code.</span></span> <span data-ttu-id="8ab92-391">hello 使用者代理程式傳回授權碼 toohello 用戶端應用程式的重新導向 URI。</span><span class="sxs-lookup"><span data-stu-id="8ab92-391">hello user agent returns authorization code toohello client application’s redirect URI.</span></span>
3. <span data-ttu-id="8ab92-392">hello web 應用程式需要 tooacquire 存取權杖，使其可以 toohello web API 進行驗證和擷取 hello 所需的資源。</span><span class="sxs-lookup"><span data-stu-id="8ab92-392">hello web application needs tooacquire an access token so that it can authenticate toohello web API and retrieve hello desired resource.</span></span> <span data-ttu-id="8ab92-393">它會要求 tooAzure AD 的權杖端點，以提供 hello 認證、 用戶端識別碼和 web API 的應用程式識別碼 URI。</span><span class="sxs-lookup"><span data-stu-id="8ab92-393">It makes a request tooAzure AD’s token endpoint, providing hello credential, client ID, and web API’s application ID URI.</span></span> <span data-ttu-id="8ab92-394">它會呈現 hello 授權程式碼 tooprove 該 hello 使用者已經同意。</span><span class="sxs-lookup"><span data-stu-id="8ab92-394">It presents hello authorization code tooprove that hello user has consented.</span></span>
4. <span data-ttu-id="8ab92-395">Azure AD 驗證 hello 應用程式，並傳回是使用的 toocall hello web API 的 JWT 存取權杖。</span><span class="sxs-lookup"><span data-stu-id="8ab92-395">Azure AD authenticates hello application and returns a JWT access token that is used toocall hello web API.</span></span>
5. <span data-ttu-id="8ab92-396">透過 HTTPS，hello web 應用程式會使用 hello hello 要求 toohello web API hello 授權標頭中傳回 JWT 存取權杖 tooadd hello 含有"Bearer"稱號的 JWT 字串。</span><span class="sxs-lookup"><span data-stu-id="8ab92-396">Over HTTPS, hello web application uses hello returned JWT access token tooadd hello JWT string with a “Bearer” designation in hello Authorization header of hello request toohello web API.</span></span> <span data-ttu-id="8ab92-397">hello web 應用程式開發介面，然後驗證 hello JWT 權杖中，而如果驗證成功，傳回 hello 需要資源。</span><span class="sxs-lookup"><span data-stu-id="8ab92-397">hello web API then validates hello JWT token, and if validation is successful, returns hello desired resource.</span></span>

<span data-ttu-id="8ab92-398">在 「 應用程式識別碼 」 流程中，hello web API 信任該 hello web 應用程式已驗證的 hello 使用者。</span><span class="sxs-lookup"><span data-stu-id="8ab92-398">In this “application identity” flow, hello web API trusts that hello web application authenticated hello user.</span></span> <span data-ttu-id="8ab92-399">基於這個理由，這種模式稱為受信任子系統。</span><span class="sxs-lookup"><span data-stu-id="8ab92-399">For this reason, this pattern is called a trusted subsystem.</span></span> <span data-ttu-id="8ab92-400">hello[此頁面上的圖表](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code)說明授權碼授與流程的運作方式。</span><span class="sxs-lookup"><span data-stu-id="8ab92-400">hello [diagram on this page](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) describes how authorization code grant flow works.</span></span>

<span data-ttu-id="8ab92-401">在取得授權權杖的限制，我們會遵循 hello 相同的受信任的子系統模式。</span><span class="sxs-lookup"><span data-stu-id="8ab92-401">In license acquisition with token restriction, we are following hello same trusted subsystem pattern.</span></span> <span data-ttu-id="8ab92-402">Azure 媒體服務中的 hello 授權傳遞服務，且 hello web API 資源 hello 「 後端資源 」 的 web 應用程式需要 tooaccess。</span><span class="sxs-lookup"><span data-stu-id="8ab92-402">And hello license delivery service in Azure Media Services is hello web API resource, hello “backend resource” a web application needs tooaccess.</span></span> <span data-ttu-id="8ab92-403">因此，其中是 hello 存取權杖？</span><span class="sxs-lookup"><span data-stu-id="8ab92-403">So where is hello access token?</span></span>

<span data-ttu-id="8ab92-404">的確，我們會從 Azure AD 取得存取權杖。</span><span class="sxs-lookup"><span data-stu-id="8ab92-404">Indeed, we are obtaining access token from Azure AD.</span></span> <span data-ttu-id="8ab92-405">使用者驗證成功之後，會傳回授權碼。</span><span class="sxs-lookup"><span data-stu-id="8ab92-405">After successful user authentication, authorization code is returned.</span></span> <span data-ttu-id="8ab92-406">hello 授權程式碼接著會使用，以及用戶端識別碼和應用程式金鑰，tooexchange 存取權杖。</span><span class="sxs-lookup"><span data-stu-id="8ab92-406">hello authorization code is then used, together with client ID and app key, tooexchange for access token.</span></span> <span data-ttu-id="8ab92-407">Hello 存取權杖是存取指向 「 指標 」 應用程式，或代表 Azure Media Services 授權傳遞服務。</span><span class="sxs-lookup"><span data-stu-id="8ab92-407">And hello access token is for accessing a “pointer” application pointing or representing Azure Media Services license delivery service.</span></span>

<span data-ttu-id="8ab92-408">我們需要 tooregister，並在 Azure AD 中的 hello 「 指標 」 應用程式設定下列 hello 步驟：</span><span class="sxs-lookup"><span data-stu-id="8ab92-408">We need tooregister and configure hello “pointer” app in Azure AD by following hello steps below:</span></span>

1. <span data-ttu-id="8ab92-409">Hello Azure AD 租用戶中</span><span class="sxs-lookup"><span data-stu-id="8ab92-409">In hello Azure AD tenant</span></span>

   * <span data-ttu-id="8ab92-410">新增應用程式 (資源) 與登入 URL：</span><span class="sxs-lookup"><span data-stu-id="8ab92-410">add an application (resource) with sign-on URL:</span></span>

   <span data-ttu-id="8ab92-411">https://[resource_name].azurewebsites.net/ 和</span><span class="sxs-lookup"><span data-stu-id="8ab92-411">https://[resource_name].azurewebsites.net/ and</span></span>

   * <span data-ttu-id="8ab92-412">應用程式識別碼 URL：</span><span class="sxs-lookup"><span data-stu-id="8ab92-412">app ID URL:</span></span>

   <span data-ttu-id="8ab92-413">https://[aad_tenant_name].onmicrosoft.com/[resource_name]；</span><span class="sxs-lookup"><span data-stu-id="8ab92-413">https://[aad_tenant_name].onmicrosoft.com/[resource_name];</span></span>
2. <span data-ttu-id="8ab92-414">加入新的金鑰 hello 資源應用程式。</span><span class="sxs-lookup"><span data-stu-id="8ab92-414">Add a new key for hello resource app;</span></span>
3. <span data-ttu-id="8ab92-415">更新 hello 應用程式資訊清單檔，使 hello groupMembershipClaims 屬性具有下列值的 hello:"groupMembershipClaims":"All"，</span><span class="sxs-lookup"><span data-stu-id="8ab92-415">Update hello app manifest file so that hello groupMembershipClaims property has hello following value: "groupMembershipClaims": "All",</span></span>  
4. <span data-ttu-id="8ab92-416">Hello Azure AD 應用程式指向 toohello hello 區段 [權限 tooother applications] 中的，播放程式 web 應用程式中加入它上方步驟 1 中已加入 hello 資源應用程式。</span><span class="sxs-lookup"><span data-stu-id="8ab92-416">In hello Azure AD app pointing toohello player web app, in hello section “permissions tooother applications”, add hello resource app which was added in step 1 above.</span></span> <span data-ttu-id="8ab92-417">在 [委派的權限] 底下勾選 [存取 [resource_name]] 核取記號。</span><span class="sxs-lookup"><span data-stu-id="8ab92-417">Under “delegated permissions” check “Access [resource_name]” checkmark.</span></span> <span data-ttu-id="8ab92-418">如此 hello 的 web 應用程式權限 toocreate 存取權杖來存取 hello 資源應用程式。</span><span class="sxs-lookup"><span data-stu-id="8ab92-418">This gives hello web app permission toocreate access tokens for accessing hello resource app.</span></span> <span data-ttu-id="8ab92-419">您應該為此作業的 hello web 應用程式的本機和已部署版本如果您正在開發使用 Visual Studio 和 Azure web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="8ab92-419">You should do this for both local and deployed version of hello web app if you are developing with Visual Studio and Azure web app.</span></span>

<span data-ttu-id="8ab92-420">因此，hello Azure AD 所簽發的 JWT 權杖確實是 hello 存取這項 「 指標 」 資源的存取權杖。</span><span class="sxs-lookup"><span data-stu-id="8ab92-420">Therefore, hello JWT token issued by Azure AD is indeed hello access token for accessing this “pointer” resource.</span></span>

### <a name="what-about-live-streaming"></a><span data-ttu-id="8ab92-421">即時串流呢？</span><span class="sxs-lookup"><span data-stu-id="8ab92-421">What about Live Streaming?</span></span>
<span data-ttu-id="8ab92-422">在上述的 hello，我們討論具有已將焦點放在隨資產。</span><span class="sxs-lookup"><span data-stu-id="8ab92-422">In hello above, our discussion has been focusing on on-demand assets.</span></span> <span data-ttu-id="8ab92-423">即時串流呢？</span><span class="sxs-lookup"><span data-stu-id="8ab92-423">What about live streaming?</span></span>

<span data-ttu-id="8ab92-424">hello 好消息是，您可以使用完全相同的設計和實作保護即時資料流在 Azure Media Services 中，將為"VOD asset"的程式相關聯的 hello 資產 hello。</span><span class="sxs-lookup"><span data-stu-id="8ab92-424">hello good news is that you can use exactly hello same design and implementation for protecting live streaming in Azure Media Services, by treating hello asset associated with a program as a “VOD asset”.</span></span>

<span data-ttu-id="8ab92-425">具體來說，它是已知 toodo live streaming Azure Media Services 中，您需要 toocreate 通道，然後在 hello 通道下的程式。</span><span class="sxs-lookup"><span data-stu-id="8ab92-425">Specifically, it is well known that toodo live streaming in Azure Media Services, you need toocreate a channel, then a program under hello channel.</span></span> <span data-ttu-id="8ab92-426">toocreate hello 程式，您需要 toocreate 其中將包含 hello 程式 hello 即時封存資產。</span><span class="sxs-lookup"><span data-stu-id="8ab92-426">toocreate hello program, you need toocreate an asset which will contain hello live archive for hello program.</span></span> <span data-ttu-id="8ab92-427">中的 hello 實況內容，您只需要 toodo，多重 DRM 保護的順序 tooprovide CENC 會 tooapply hello 相同的安裝程式/處理 toohello 資產如同開始 hello 程式之前，它會是"VOD asset"。</span><span class="sxs-lookup"><span data-stu-id="8ab92-427">In order tooprovide CENC with multi-DRM protection of hello live content, all you need toodo, is tooapply hello same setup/processing toohello asset as if it was a “VOD asset” before you start hello program.</span></span>

### <a name="what-about-license-servers-outside-of-azure-media-services"></a><span data-ttu-id="8ab92-428">在 Azure 媒體服務外部的授權伺服器呢？</span><span class="sxs-lookup"><span data-stu-id="8ab92-428">What about license servers outside of Azure Media Services?</span></span>
<span data-ttu-id="8ab92-429">通常，客戶可能會在他們自己的資料中心或由 DRM 服務提供者裝載的位置，投資授權伺服器陣列。</span><span class="sxs-lookup"><span data-stu-id="8ab92-429">Often, customers may have invested in license server farm either in their own data center or hosted by DRM service providers.</span></span> <span data-ttu-id="8ab92-430">幸運的是，Azure 媒體服務內容保護可讓您 toooperate 以混合模式： 內容裝載，並動態地加以保護 Azure Media Services 中，雖然 DRM 授權都已傳遞方法外 Azure Media Services 的伺服器。</span><span class="sxs-lookup"><span data-stu-id="8ab92-430">Fortunately, Azure Media Services Content Protection allows you toooperate in hybrid mode: contents hosted and dynamically protected in Azure Media Services, while DRM licenses are delivered by servers outside Azure Media Services.</span></span> <span data-ttu-id="8ab92-431">在此情況下，有下列變更的考量因素的 hello:</span><span class="sxs-lookup"><span data-stu-id="8ab92-431">In this case, there are hello following considerations of changes:</span></span>

1. <span data-ttu-id="8ab92-432">hello Secure Token Service 的需求 tooissue 語彙基元會被可接受和可驗證 hello 授權伺服器陣列。</span><span class="sxs-lookup"><span data-stu-id="8ab92-432">hello Secure Token Service needs tooissue tokens which are acceptable and can be verified by hello license server farm.</span></span> <span data-ttu-id="8ab92-433">比方說，Axinom 所提供的 hello Widevine 授權伺服器要求特定 JWT 權杖中包含 「 權利訊息 」。</span><span class="sxs-lookup"><span data-stu-id="8ab92-433">For example, hello Widevine license servers provided by Axinom requires a specific JWT token which contains “entitlement message”.</span></span> <span data-ttu-id="8ab92-434">因此，您需要 toohave STS tooissue 這類的 JWT 語彙基元。</span><span class="sxs-lookup"><span data-stu-id="8ab92-434">Therefore, you need toohave an STS tooissue such JWT token.</span></span> <span data-ttu-id="8ab92-435">hello 作者完這類實作，而且您可以找到 hello 詳細資料，在下列文件中的 hello [Azure 文件中心](https://azure.microsoft.com/documentation/):[使用 Axinom toodeliver Widevine 授權 tooAzure Media Services](media-services-axinom-integration.md).</span><span class="sxs-lookup"><span data-stu-id="8ab92-435">hello authors have completed such an implementation and you can find hello details in hello following document in [Azure Documentation Center](https://azure.microsoft.com/documentation/): [Using Axinom toodeliver Widevine licenses tooAzure Media Services](media-services-axinom-integration.md).</span></span>
2. <span data-ttu-id="8ab92-436">您不再需要 tooconfigure 授權傳遞服務 (ContentKeyAuthorizationPolicy) Azure 媒體服務中。</span><span class="sxs-lookup"><span data-stu-id="8ab92-436">You no longer need tooconfigure license delivery service (ContentKeyAuthorizationPolicy) in Azure Media Services.</span></span> <span data-ttu-id="8ab92-437">您的需要 toodo 是 tooprovide hello 授權取得 Url （針對 PlayReady、 Widevine 和 FairPlay） 中使用多重 DRM 設定 CENC 設定 AssetDeliveryPolicy 時。</span><span class="sxs-lookup"><span data-stu-id="8ab92-437">What you need toodo is tooprovide hello license acquisition URLs (for PlayReady, Widevine and FairPlay) when you configure AssetDeliveryPolicy in setting up CENC with multi-DRM.</span></span>

### <a name="what-if-i-want-toouse-a-custom-sts"></a><span data-ttu-id="8ab92-438">如果我想 toouse 自訂 STS 嗎？</span><span class="sxs-lookup"><span data-stu-id="8ab92-438">What if I want toouse a custom STS?</span></span>
<span data-ttu-id="8ab92-439">可能有少數客戶可能會選擇 toouse 自訂 STS (Secure Token Service) 提供的 JWT 權杖的原因。</span><span class="sxs-lookup"><span data-stu-id="8ab92-439">There could be a few reasons that a customer may choose toouse a custom STS (Secure Token Service) for providing JWT tokens.</span></span> <span data-ttu-id="8ab92-440">以下是其中一些原因：</span><span class="sxs-lookup"><span data-stu-id="8ab92-440">Some of them are:</span></span>

1. <span data-ttu-id="8ab92-441">hello 身分識別提供者 (IDP) 使用 hello 客戶不支援 STS。</span><span class="sxs-lookup"><span data-stu-id="8ab92-441">hello Identity Provider (IDP) used by hello customer does not support STS.</span></span> <span data-ttu-id="8ab92-442">在此情況下，自訂 STS 是一個選項。</span><span class="sxs-lookup"><span data-stu-id="8ab92-442">In this case a custom STS may be an option.</span></span>
2. <span data-ttu-id="8ab92-443">hello 客戶可能需要更多彈性或緊密控制中的客戶的訂閱者 」 計費系統整合 STS。</span><span class="sxs-lookup"><span data-stu-id="8ab92-443">hello customer may need more flexible or tighter control in integrating STS with customer’s subscriber billing system.</span></span> <span data-ttu-id="8ab92-444">例如，MVPD 運算子可能提供 OTT 訂閱者的多個封裝，例如 premium、 basic、 運動、 等 hello 運算子可能會想要 toomatch hello 宣告在權杖中的訂閱者的封裝，如此只有 hello 右封裝中的內容開放使用。</span><span class="sxs-lookup"><span data-stu-id="8ab92-444">For example, an MVPD operator may offer multiple OTT subscriber packages such as premium, basic, sports, etc. hello operator may want toomatch hello claims in a token with a subscriber’s package so that only contents in hello right package is made available.</span></span> <span data-ttu-id="8ab92-445">在此情況下，自訂 STS 提供 hello 所需的彈性和控制。</span><span class="sxs-lookup"><span data-stu-id="8ab92-445">In this case, a custom STS provides hello needed flexibility and control.</span></span>

<span data-ttu-id="8ab92-446">兩項變更需要 toobe 時使用的自訂 STS:</span><span class="sxs-lookup"><span data-stu-id="8ab92-446">Two changes need toobe made when using a custom STS:</span></span>

1. <span data-ttu-id="8ab92-447">設定資產的授權傳遞服務時，您會需要用來驗證的 hello 自訂 STS （以下詳細說明），而不是從 Azure Active Directory 的 hello 目前金鑰 toospecify hello 安全性金鑰。</span><span class="sxs-lookup"><span data-stu-id="8ab92-447">When configuring license delivery service for an asset, you need toospecify hello security key used for verification by hello custom STS (more details below) instead of hello current key from Azure Active Directory.</span></span>
2. <span data-ttu-id="8ab92-448">產生 JTW 語彙基元時，而不是 hello 的 Azure Active Directory 中的 hello 目前 X509 憑證的私用金鑰指定的安全性金鑰。</span><span class="sxs-lookup"><span data-stu-id="8ab92-448">When a JTW token is generated, a security key is specified instead of hello private key of hello current X509 certificate in Azure Active Directory.</span></span>

<span data-ttu-id="8ab92-449">有兩種類型的安全性金鑰：</span><span class="sxs-lookup"><span data-stu-id="8ab92-449">There are two types of security keys:</span></span>

1. <span data-ttu-id="8ab92-450">對稱金鑰： hello 產生和驗證 JWT 權杖中，使用相同的金鑰</span><span class="sxs-lookup"><span data-stu-id="8ab92-450">Symmetric key: hello same key is used for both generating and verifying a JWT token;</span></span>
2. <span data-ttu-id="8ab92-451">非對稱金鑰： 在 X509 憑證用於私用金鑰來加密/產生 JWT 語彙基元和 hello 公開金鑰來驗證 hello 語彙基元公開-私密金鑰組。</span><span class="sxs-lookup"><span data-stu-id="8ab92-451">Asymmetric key: a public-private key pair in an X509 certificate is used with private key for encrypting/generating a JWT token and hello public key for verifying hello token.</span></span>

#### <a name="tech-note"></a><span data-ttu-id="8ab92-452">技術提示</span><span class="sxs-lookup"><span data-stu-id="8ab92-452">Tech note</span></span>
<span data-ttu-id="8ab92-453">如果您使用.NET Framework C# 開發平台，作為 hello X509 / 用於非對稱安全性金鑰的憑證必須具有金鑰長度至少為 2048年。</span><span class="sxs-lookup"><span data-stu-id="8ab92-453">If you use .NET Framework/C# as your development platform, hello X509 certificate used for asymmetric security key must have key length at least 2048.</span></span> <span data-ttu-id="8ab92-454">這是 hello 類別 System.IdentityModel.Tokens.X509AsymmetricSecurityKey.NET Framework 中的需求。</span><span class="sxs-lookup"><span data-stu-id="8ab92-454">This is a requirement of hello class System.IdentityModel.Tokens.X509AsymmetricSecurityKey in .NET Framework.</span></span> <span data-ttu-id="8ab92-455">否則，會擲回下列例外狀況的 hello:</span><span class="sxs-lookup"><span data-stu-id="8ab92-455">Otherwise, hello following exception will be thrown:</span></span>

<span data-ttu-id="8ab92-456">IDX10630: hello 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' 的簽章不能小於 '2048' 位元。</span><span class="sxs-lookup"><span data-stu-id="8ab92-456">IDX10630: hello 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' for signing cannot be smaller than '2048' bits.</span></span>

## <a name="hello-completed-system-and-test"></a><span data-ttu-id="8ab92-457">hello 完成系統和測試</span><span class="sxs-lookup"><span data-stu-id="8ab92-457">hello completed system and test</span></span>
<span data-ttu-id="8ab92-458">我們將逐步引導幾個案例 hello 完成端對端系統中，讓讀者可以再取得登入帳戶有基本的 hello 行為的 「 圖片 」。</span><span class="sxs-lookup"><span data-stu-id="8ab92-458">We will walk through a few scenarios in hello completed end-to-end system so that readers can have a basic “picture” of hello behavior before getting a login account.</span></span>

<span data-ttu-id="8ab92-459">hello player web 應用程式和其登入可以找到[這裡](https://openidconnectweb.azurewebsites.net/)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-459">hello player web application and its login can be found [here](https://openidconnectweb.azurewebsites.net/).</span></span>

<span data-ttu-id="8ab92-460">如果您需要的是 「 非整合式 」 案例： 哪些是未受保護或受 DRM 保護裝載在 Azure Media Services 視訊資產，但沒有 （發出要求的方式授權 toowhoever） 權杖的驗證，您可以測試它沒有登入 （藉由切換tooHTTP 如果視訊串流是透過 HTTP)。</span><span class="sxs-lookup"><span data-stu-id="8ab92-460">If what you need is “non-integrated” scenario: video assets hosted in Azure Media Services which are either unprotected, or DRM protected but without token authentication (issuing a license toowhoever requesting it), you can test it without login (by switching tooHTTP if your video streaming is over HTTP).</span></span>

<span data-ttu-id="8ab92-461">如果您需要的是端對端整合的案例： 在 Azure Media Services 動態的 DRM 保護，權杖驗證與由 Azure AD 產生的 JWT 語彙基元是視訊資產，您需要 toologin。</span><span class="sxs-lookup"><span data-stu-id="8ab92-461">If what you need is end-to-end integrated scenario: video assets is under dynamic DRM protection in Azure Media Services, with token authentication and JWT token being generated by Azure AD, you need toologin.</span></span>

### <a name="user-login"></a><span data-ttu-id="8ab92-462">使用者登入</span><span class="sxs-lookup"><span data-stu-id="8ab92-462">User login</span></span>
<span data-ttu-id="8ab92-463">在訂單 tootest hello 端對端整合 DRM 系統中，您需要 toohave 「 帳戶 」 建立或加入。</span><span class="sxs-lookup"><span data-stu-id="8ab92-463">In order tootest hello end-to-end integrated DRM system, you need toohave an “account” created or added.</span></span>

<span data-ttu-id="8ab92-464">哪個帳戶？</span><span class="sxs-lookup"><span data-stu-id="8ab92-464">What account?</span></span>

<span data-ttu-id="8ab92-465">雖然 Azure 原先只允許 Microsoft 帳戶使用者進行存取，但它現在可讓這兩個系統的使用者進行存取。</span><span class="sxs-lookup"><span data-stu-id="8ab92-465">Although Azure originally allowed access only by Microsoft account users, it now allows access by users from both systems.</span></span> <span data-ttu-id="8ab92-466">這項作業完成透過所有 hello Azure 屬性信任 Azure AD 進行驗證，讓 Azure AD 驗證組織使用者，以及建立的同盟關係讓 Azure AD 信任 hello Microsoft 帳戶消費者識別系統tooauthenticate 取用者的使用者。</span><span class="sxs-lookup"><span data-stu-id="8ab92-466">This was done by having all hello Azure properties trust Azure AD for authentication, having Azure AD authenticate organizational users, and by creating a federation relationship where Azure AD trusts hello Microsoft account consumer identity system tooauthenticate consumer users.</span></span> <span data-ttu-id="8ab92-467">如此一來，Azure AD 便能 tooauthenticate 「 來賓 」 Microsoft 帳戶，以及 「 原生 」 Azure AD 帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ab92-467">As a result, Azure AD is able tooauthenticate “guest” Microsoft accounts as well as “native” Azure AD accounts.</span></span>

<span data-ttu-id="8ab92-468">由於 Azure AD 信任 Microsoft 帳戶 (MSA) 網域，您可以加入任何帳戶，從任何 hello 下列網域 toohello 自訂的 Azure AD 租用戶，並使用 hello 帳戶 toologin:</span><span class="sxs-lookup"><span data-stu-id="8ab92-468">Since Azure AD trusts Microsoft Account (MSA) domain, you can add any accounts from any of hello following domains toohello custom Azure AD tenant and use hello account toologin:</span></span>

| <span data-ttu-id="8ab92-469">**網域名稱**</span><span class="sxs-lookup"><span data-stu-id="8ab92-469">**Domain Name**</span></span> | <span data-ttu-id="8ab92-470">**網域**</span><span class="sxs-lookup"><span data-stu-id="8ab92-470">**Domain**</span></span> |
| --- | --- |
| <span data-ttu-id="8ab92-471">**自訂 Azure AD 租用戶網域**</span><span class="sxs-lookup"><span data-stu-id="8ab92-471">**Custom Azure AD tenant domain**</span></span> |<span data-ttu-id="8ab92-472">somename.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="8ab92-472">somename.onmicrosoft.com</span></span> |
| <span data-ttu-id="8ab92-473">**公司網域**</span><span class="sxs-lookup"><span data-stu-id="8ab92-473">**Corporate domain**</span></span> |<span data-ttu-id="8ab92-474">microsoft.com</span><span class="sxs-lookup"><span data-stu-id="8ab92-474">microsoft.com</span></span> |
| <span data-ttu-id="8ab92-475">**Microsoft 帳戶 (MSA) 網域**</span><span class="sxs-lookup"><span data-stu-id="8ab92-475">**Microsoft Account (MSA) domain**</span></span> |<span data-ttu-id="8ab92-476">outlook.com、live.com、hotmail.com</span><span class="sxs-lookup"><span data-stu-id="8ab92-476">outlook.com, live.com, hotmail.com</span></span> |

<span data-ttu-id="8ab92-477">您可以連絡任何 hello 作者 toohave 建立或加入為您的帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ab92-477">You may contact any of hello authors toohave an account created or added for you.</span></span>

<span data-ttu-id="8ab92-478">以下是不同的網域帳戶所使用的不同的登入頁面的 hello 螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="8ab92-478">Below are hello screenshots of different login pages used by different domain accounts.</span></span>

<span data-ttu-id="8ab92-479">**自訂的 Azure AD 租用戶的網域帳戶**： 在此情況下，請參閱 hello 自訂的 Azure AD 租用戶網域 hello 自訂登入頁面。</span><span class="sxs-lookup"><span data-stu-id="8ab92-479">**Custom Azure AD tenant domain account**: In this case, you see hello customized login page of hello custom Azure AD tenant domain.</span></span>

![自訂 Azure AD 租用戶網域帳戶](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain1.png)

<span data-ttu-id="8ab92-481">**Microsoft 網域帳戶使用智慧卡**： 在此情況下您會看到 hello 登入頁面自訂 microsoft 公司 IT 使用雙因素驗證。</span><span class="sxs-lookup"><span data-stu-id="8ab92-481">**Microsoft domain account with smart card**: In this case you see hello login page customized by Microsoft corporate IT with two-factor authentication.</span></span>

![自訂 Azure AD 租用戶網域帳戶](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain2.png)

<span data-ttu-id="8ab92-483">**Microsoft 帳戶 (MSA)**： 在此情況下，您看到 hello Microsoft 帳戶登入頁面的消費者。</span><span class="sxs-lookup"><span data-stu-id="8ab92-483">**Microsoft Account (MSA)**: In this case, you see hello login page of Microsoft Account for consumers.</span></span>

![自訂 Azure AD 租用戶網域帳戶](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain3.png)

### <a name="using-encrypted-media-extensions-for-playready"></a><span data-ttu-id="8ab92-485">Using Encrypted Media Extensions for PlayReady (使用 PlayReady 的加密媒體擴充)</span><span class="sxs-lookup"><span data-stu-id="8ab92-485">Using Encrypted Media Extensions for PlayReady</span></span>
<span data-ttu-id="8ab92-486">在新式瀏覽器與加密媒體擴充功能 (EME) 的支援，例如 Windows 10 PlayReady 上的 Windows 8.1 和，IE 11 和 Microsoft Edge 瀏覽器將的 PlayReady hello EME 基礎 DRM。</span><span class="sxs-lookup"><span data-stu-id="8ab92-486">On a modern browser with Encrypted Media Extensions (EME) for PlayReady support, such as IE 11 on Windows 8.1 and up, and Microsoft Edge browser on Windows 10, PlayReady will be hello underlying DRM for EME.</span></span>

![針對 PlayReady 使用 EME](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready1.png)

<span data-ttu-id="8ab92-488">hello 深色的播放程式區域是視訊的因為 toohello 事實 PlayReady 保護可防止一個進行螢幕擷取畫面的受保護。</span><span class="sxs-lookup"><span data-stu-id="8ab92-488">hello dark player area is due toohello fact that PlayReady protection prevents one from making screen capture of protected video.</span></span>

<span data-ttu-id="8ab92-489">hello 下列畫面顯示 hello player 外掛程式和 MSE/EME 支援。</span><span class="sxs-lookup"><span data-stu-id="8ab92-489">hello following screen shows hello player plugins and MSE/EME support.</span></span>

![針對 PlayReady 使用 EME](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready2.png)

<span data-ttu-id="8ab92-491">Windows 10 的 Microsoft Edge 及 IE 11 中的 EME，允許支援 [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) 的 Windows 10 裝置上的 PlayReady SL3000 叫用。</span><span class="sxs-lookup"><span data-stu-id="8ab92-491">EME in Microsoft Edge and IE 11 on Windows 10 allows invoking of [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) on Windows 10 devices which support it.</span></span> <span data-ttu-id="8ab92-492">PlayReady SL3000 解除鎖定 hello 資料流程增強的優質內容 (4k 首，等) 和新的內容傳遞模型 （如增強內容的早期視窗）。</span><span class="sxs-lookup"><span data-stu-id="8ab92-492">PlayReady SL3000 unlocks hello flow of enhanced premium content (4K, HDR, etc.) and new content delivery models (early window for Enhanced Content).</span></span>

<span data-ttu-id="8ab92-493">專注於 hello Windows 裝置： PlayReady 是 hello 只在 Windows 裝置 (PlayReady SL3000) hello HW 中的 DRM。</span><span class="sxs-lookup"><span data-stu-id="8ab92-493">Focus on hello Windows devices: PlayReady is hello only DRM in hello HW available on Windows devices (PlayReady SL3000).</span></span> <span data-ttu-id="8ab92-494">串流服務可透過 EME 或 UWP 應用程式來使用 PlayReady，並利用 PlayReady SL3000 來提供比其他 DRM 所能提供更高的影片品質，</span><span class="sxs-lookup"><span data-stu-id="8ab92-494">A streaming service can use PlayReady through EME or through a UWP application and offer a higher video quality using PlayReady SL3000 than another DRM.</span></span> <span data-ttu-id="8ab92-495">一般而言，2k 內容將通過 Chrome 或 Firefox，而且 4 K 透過 Microsoft Edge/IE11 或 UWP 應用程式內容 hello 相同裝置 （取決於服務設定和實作）。</span><span class="sxs-lookup"><span data-stu-id="8ab92-495">Typically, 2K content will flow through Chrome or Firefox, and 4K content through Microsoft Edge/IE11 or a UWP application on hello same device (depending on service settings and implementation).</span></span>

#### <a name="using-eme-for-widevine"></a><span data-ttu-id="8ab92-496">針對 Widevine 使用 EME</span><span class="sxs-lookup"><span data-stu-id="8ab92-496">Using EME for Widevine</span></span>
<span data-ttu-id="8ab92-497">Google Widevine EME/Widevine 上的支援，例如 Chrome 41 + Windows 10、 Windows 8.1、 Mac OSX Yosemite，以及 Chrome Android 的第 4.4.4 的新式瀏覽器是 hello EME 背後的 DRM。</span><span class="sxs-lookup"><span data-stu-id="8ab92-497">On a modern browser with EME/Widevine support, such as Chrome 41+ on Windows 10, Windows 8.1, Mac OSX Yosemite, and Chrome on Android 4.4.4, Google Widevine is hello DRM behind EME.</span></span>

![針對 Widevine 使用 EME](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine1.png)

<span data-ttu-id="8ab92-499">請注意，Widevine 不會防止對受保護的視訊進行螢幕擷取。</span><span class="sxs-lookup"><span data-stu-id="8ab92-499">Notice that Widevine does not prevent one from making screen capture of protected video.</span></span>

![針對 Widevine 使用 EME](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine2.png)

### <a name="not-entitled-users"></a><span data-ttu-id="8ab92-501">不是有權限的使用者</span><span class="sxs-lookup"><span data-stu-id="8ab92-501">Not entitled users</span></span>
<span data-ttu-id="8ab92-502">如果使用者不是 「 標題為使用者 」 群組的成員，hello 使用者不會檢查無法 toopass 」 權限 」，而且 hello 多重 DRM 授權服務會拒絕 tooissue hello 要求的授權，如下所示。</span><span class="sxs-lookup"><span data-stu-id="8ab92-502">If a user is not a member of "Entitled Users" group, hello user will not be able toopass “entitlement check” and hello multi-DRM license service will refuse tooissue hello requested license as shown below.</span></span> <span data-ttu-id="8ab92-503">hello 詳細的描述是 「 授權取得失敗 」，這是專為。</span><span class="sxs-lookup"><span data-stu-id="8ab92-503">hello detailed description is “License acquire failed”, which is as designed.</span></span>

![無權限的使用者](./media/media-services-cenc-with-multidrm-access-control/media-services-unentitledusers.png)

### <a name="running-custom-secure-token-service"></a><span data-ttu-id="8ab92-505">Running custom Secure Token Service (執行自訂安全權杖服務)</span><span class="sxs-lookup"><span data-stu-id="8ab92-505">Running custom Secure Token Service</span></span>
<span data-ttu-id="8ab92-506">執行自訂安全性權杖服務 (STS) 中的 hello 案例中，hello JWT 權杖中將會發出 hello 自訂 STS 所使用對稱或非對稱金鑰。</span><span class="sxs-lookup"><span data-stu-id="8ab92-506">For hello scenario of running custom Secure Token Service (STS), hello JWT token will be issued by hello custom STS using either symmetric or asymmetric key.</span></span>

<span data-ttu-id="8ab92-507">使用對稱金鑰 （使用 Chrome） 的 hello 案例：</span><span class="sxs-lookup"><span data-stu-id="8ab92-507">hello case of using symmetric key (using Chrome):</span></span>

![執行自訂 STS](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts1.png)

<span data-ttu-id="8ab92-509">hello 案例使用非對稱金鑰透過 X509 憑證 （使用 Microsoft 新式瀏覽器）。</span><span class="sxs-lookup"><span data-stu-id="8ab92-509">hello case of using asymmetric key via an X509 certificate (using Microsoft modern browser).</span></span>

![執行自訂 STS](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts2.png)

<span data-ttu-id="8ab92-511">在這兩 hello 上述情況下，使用者驗證會 hello 相同 – 透過 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="8ab92-511">In both of hello above cases, user authentication stays hello same – through Azure AD.</span></span> <span data-ttu-id="8ab92-512">hello 唯一的差別在於 hello 自訂 STS，而不是 Azure AD 所簽發的 JWT 語彙基元。</span><span class="sxs-lookup"><span data-stu-id="8ab92-512">hello only difference is that JWT tokens are issued by hello custom STS instead of Azure AD.</span></span> <span data-ttu-id="8ab92-513">當然，在設定動態 CENC 保護時，授權傳遞服務的 hello 限制指定 hello 類型 JWT 權杖中，對稱或非對稱金鑰。</span><span class="sxs-lookup"><span data-stu-id="8ab92-513">Of course, when configuring dynamic CENC protection, hello restriction of license delivery service specifies hello type of JWT token, either symmetric or asymmetric key.</span></span>

## <a name="summary"></a><span data-ttu-id="8ab92-514">摘要</span><span class="sxs-lookup"><span data-stu-id="8ab92-514">Summary</span></span>
<span data-ttu-id="8ab92-515">在本文件中，我們討論了透過權杖驗證的 CENC 與多重原生 DRM 和存取控制：它的設計和實作使用 Azure、Azure 媒體服務和 Azure Media Player。</span><span class="sxs-lookup"><span data-stu-id="8ab92-515">In this document, we discussed CENC with multi-native-DRM and access control via token authentication: its design and its implementation using Azure, Azure Media Services and Azure Media Player.</span></span>

* <span data-ttu-id="8ab92-516">其中包含 DRM/CENC 子系統; 中的 hello 必要元件會參考設計</span><span class="sxs-lookup"><span data-stu-id="8ab92-516">A reference design is presented which contains all hello necessary components in a DRM/CENC subsystem;</span></span>
* <span data-ttu-id="8ab92-517">Azure、Azure 媒體服務和 Azure Media Player 的參考實作。</span><span class="sxs-lookup"><span data-stu-id="8ab92-517">A reference implementation on Azure, Azure Media Services and Azure Media Player.</span></span>
* <span data-ttu-id="8ab92-518">也會討論一些 hello 設計與實作中直接相關的主題。</span><span class="sxs-lookup"><span data-stu-id="8ab92-518">Some topics directly involved in hello design and implementation are also discussed.</span></span>

## <a name="media-services-learning-paths"></a><span data-ttu-id="8ab92-519">媒體服務學習路徑</span><span class="sxs-lookup"><span data-stu-id="8ab92-519">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="8ab92-520">提供意見反應</span><span class="sxs-lookup"><span data-stu-id="8ab92-520">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]
 
