---
title: "如何控制 App Service 環境的輸入流量"
description: "了解如何設定網路安全性規則，以控制 App Service 環境的輸入流量。"
services: app-service
documentationcenter: 
author: ccompy
manager: erikre
editor: 
ms.assetid: 4cc82439-8791-48a4-9485-de6d8e1d1a08
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/11/2017
ms.author: stefsch
ms.openlocfilehash: ee0a2248a1cd5d76f87b280de05410b94f96c8af
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-control-inbound-traffic-to-an-app-service-environment"></a><span data-ttu-id="7062e-103">如何控制 App Service 環境的輸入流量</span><span class="sxs-lookup"><span data-stu-id="7062e-103">How To Control Inbound Traffic to an App Service Environment</span></span>
## <a name="overview"></a><span data-ttu-id="7062e-104">概觀</span><span class="sxs-lookup"><span data-stu-id="7062e-104">Overview</span></span>
<span data-ttu-id="7062e-105">您可以在 Azure Resource Manager 虛擬網路**或**傳統部署模型[虛擬網路][virtualnetwork]中建立 App Service Environment。</span><span class="sxs-lookup"><span data-stu-id="7062e-105">An App Service Environment can be created in **either** an Azure Resource Manager virtual network, **or** a classic deployment model [virtual network][virtualnetwork].</span></span>  <span data-ttu-id="7062e-106">建立 APP Service 環境時，可以定義新的虛擬網路和新的子網路。</span><span class="sxs-lookup"><span data-stu-id="7062e-106">A new virtual network and new subnet can be defined at the time an App Service Environment is created.</span></span>  <span data-ttu-id="7062e-107">或者亦可在先前既存的虛擬網路和既存的子網路中建立 APP Service 環境。</span><span class="sxs-lookup"><span data-stu-id="7062e-107">Alternatively, an App Service Environment can be created in a pre-existing virtual network and pre-existing subnet.</span></span>  <span data-ttu-id="7062e-108">在 2016 年 6 月所進行的變更之後，ASE 也可以部署到使用公用位址範圍或 RFC1918 位址空間 (也就是</span><span class="sxs-lookup"><span data-stu-id="7062e-108">With a change made in June 2016, ASEs can also be deployed into virtual networks that use either public address ranges, or RFC1918 address spaces (i.e.</span></span> <span data-ttu-id="7062e-109">私人位址) 的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="7062e-109">private addresses).</span></span>  <span data-ttu-id="7062e-110">如需有關建立 App Service Environment 的詳細資訊，請參閱[如何建立 App Service Environment][HowToCreateAnAppServiceEnvironment]。</span><span class="sxs-lookup"><span data-stu-id="7062e-110">For more details on creating an App Service Environment see [How To Create an App Service Environment][HowToCreateAnAppServiceEnvironment].</span></span>

<span data-ttu-id="7062e-111">App Service 環境必須一律建立於子網路中，因為子網路可提供網路界限以便用來鎖定上游裝置和服務背後的輸入流量，因此只接受來自特定上游 IP 位址的 HTTP 和 HTTPS 流量。</span><span class="sxs-lookup"><span data-stu-id="7062e-111">An App Service Environment must always be created within a subnet because a subnet provides a network boundary which can be used to lock down inbound traffic behind upstream devices and services such that HTTP and HTTPS traffic is only accepted from specific upstream IP addresses.</span></span>

<span data-ttu-id="7062e-112">您可以使用[網路安全性群組][NetworkSecurityGroups]來控制子網路上的輸入和輸出網路流量。</span><span class="sxs-lookup"><span data-stu-id="7062e-112">Inbound and outbound network traffic on a subnet is controlled using a [network security group][NetworkSecurityGroups].</span></span> <span data-ttu-id="7062e-113">控制輸入流量時，需要在網路安全性群組中建立網路安全性規則，然後將網路安全性群組指派給包含 App Service 環境的子網路。</span><span class="sxs-lookup"><span data-stu-id="7062e-113">Controlling inbound traffic requires creating network security rules in a network security group, and then assigning the network security group the subnet containing the App Service Environment.</span></span>

<span data-ttu-id="7062e-114">將網路安全性群組指派給子網路後，會根據網路安全性群組中定義的允許和拒絕規則，允許/封鎖 App Service 環境中應用程式的輸入流量。</span><span class="sxs-lookup"><span data-stu-id="7062e-114">Once a network security group is assigned to a subnet, inbound traffic to apps in the App Service Environment is allowed/blocked based on the allow and deny rules defined in the network security group.</span></span>

[!INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]

## <a name="inbound-network-ports-used-in-an-app-service-environment"></a><span data-ttu-id="7062e-115">App Service Environment 中使用的輸入網路連接埠</span><span class="sxs-lookup"><span data-stu-id="7062e-115">Inbound Network Ports Used in an App Service Environment</span></span>
<span data-ttu-id="7062e-116">利用網路安全性群組鎖定輸入網路流量之前，請務必知道 App Service 環境所用的必要和選用網路連接埠集合。</span><span class="sxs-lookup"><span data-stu-id="7062e-116">Before locking down inbound network traffic with a network security group, it is important to know the set of required and optional network ports used by an App Service Environment.</span></span>  <span data-ttu-id="7062e-117">意外關閉送至某些連接埠的流量，可能會導致在 App Service 環境中喪失功能。</span><span class="sxs-lookup"><span data-stu-id="7062e-117">Accidentally closing off traffic to some ports can result in loss of functionality in an App Service Environment.</span></span>

<span data-ttu-id="7062e-118">以下是 App Service 環境所使用的連接埠清單。</span><span class="sxs-lookup"><span data-stu-id="7062e-118">The following is a list of ports used by an App Service Environment.</span></span> <span data-ttu-id="7062e-119">除非明確註明，否則所有連接埠為 **TCP**：</span><span class="sxs-lookup"><span data-stu-id="7062e-119">All ports are **TCP**, unless otherwise clearly noted:</span></span>

* <span data-ttu-id="7062e-120">454：Azure 基礎結構透過 SSL 用來管理和維護 App Service 環境的**必要連接埠**。</span><span class="sxs-lookup"><span data-stu-id="7062e-120">454:  **Required port** used by Azure infrastructure for managing and maintaining App Service Environments via SSL.</span></span>  <span data-ttu-id="7062e-121">不會封鎖對此連接埠的流量。</span><span class="sxs-lookup"><span data-stu-id="7062e-121">Do not block traffic to this port.</span></span>  <span data-ttu-id="7062e-122">此連接埠一律繫結至 ASE 的公用 VIP。</span><span class="sxs-lookup"><span data-stu-id="7062e-122">This port is always bound to the public VIP of an ASE.</span></span>
* <span data-ttu-id="7062e-123">455：Azure 基礎結構透過 SSL 用來管理和維護 App Service 環境的**必要連接埠**。</span><span class="sxs-lookup"><span data-stu-id="7062e-123">455:  **Required port** used by Azure infrastructure for managing and maintaining App Service Environments via SSL.</span></span>  <span data-ttu-id="7062e-124">不會封鎖對此連接埠的流量。</span><span class="sxs-lookup"><span data-stu-id="7062e-124">Do not block traffic to this port.</span></span>  <span data-ttu-id="7062e-125">此連接埠一律繫結至 ASE 的公用 VIP。</span><span class="sxs-lookup"><span data-stu-id="7062e-125">This port is always bound to the public VIP of an ASE.</span></span>
* <span data-ttu-id="7062e-126">80：對於在 App Service 環境的 App Service 方案中執行的應用程式，其輸入 HTTP 流量的預設連接埠。</span><span class="sxs-lookup"><span data-stu-id="7062e-126">80:  Default port for inbound HTTP traffic to apps running in App Service Plans in an App Service Environment.</span></span>  <span data-ttu-id="7062e-127">在啟用 ILB 的 ASE 上，此連接埠繫結至 ASE 的 ILB 位址。</span><span class="sxs-lookup"><span data-stu-id="7062e-127">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="7062e-128">443：對於在 App Service 環境的 App Service 方案中執行的應用程式，其輸入 SSL 流量的預設連接埠。</span><span class="sxs-lookup"><span data-stu-id="7062e-128">443: Default port for inbound SSL traffic to apps running in App Service Plans in an App Service Environment.</span></span>  <span data-ttu-id="7062e-129">在啟用 ILB 的 ASE 上，此連接埠繫結至 ASE 的 ILB 位址。</span><span class="sxs-lookup"><span data-stu-id="7062e-129">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="7062e-130">21：FTP 的控制通道。</span><span class="sxs-lookup"><span data-stu-id="7062e-130">21:  Control channel for FTP.</span></span>  <span data-ttu-id="7062e-131">如果未使用 FTP，就可以安全地封鎖此連接埠。</span><span class="sxs-lookup"><span data-stu-id="7062e-131">This port can be safely blocked if FTP is not being used.</span></span>  <span data-ttu-id="7062e-132">在啟用 ILB 的 ASE 上，此連接埠可以繫結至 ASE 的 ILB 位址。</span><span class="sxs-lookup"><span data-stu-id="7062e-132">On an ILB-enabled ASE, this port can be bound to the ILB address for an ASE.</span></span>
* <span data-ttu-id="7062e-133">990：FTPS 的控制通道。</span><span class="sxs-lookup"><span data-stu-id="7062e-133">990:  Control channel for FTPS.</span></span>  <span data-ttu-id="7062e-134">如果未使用 FTPS，就可以安全地封鎖此連接埠。</span><span class="sxs-lookup"><span data-stu-id="7062e-134">This port can be safely blocked if FTPS is not being used.</span></span>  <span data-ttu-id="7062e-135">在啟用 ILB 的 ASE 上，此連接埠可以繫結至 ASE 的 ILB 位址。</span><span class="sxs-lookup"><span data-stu-id="7062e-135">On an ILB-enabled ASE, this port can be bound to the ILB address for an ASE.</span></span>
* <span data-ttu-id="7062e-136">10001-10020：FTP 的資料通道。</span><span class="sxs-lookup"><span data-stu-id="7062e-136">10001-10020: Data channels for FTP.</span></span>  <span data-ttu-id="7062e-137">如同控制通道，若未使用 FTP，即可安全地封鎖這些連接埠。</span><span class="sxs-lookup"><span data-stu-id="7062e-137">As with the control channel, these ports can be safely blocked if FTP is not being used.</span></span>  <span data-ttu-id="7062e-138">在啟用 ILB 的 ASE 上，此連接埠可以繫結至 ASE 的 ILB 位址。</span><span class="sxs-lookup"><span data-stu-id="7062e-138">On an ILB-enabled ASE, this port can be bound to the ASE's ILB address.</span></span>
* <span data-ttu-id="7062e-139">4016：用於 Visual Studio 2012 的遠端偵錯。</span><span class="sxs-lookup"><span data-stu-id="7062e-139">4016: Used for remote debugging with Visual Studio 2012.</span></span>  <span data-ttu-id="7062e-140">如果未使用此功能，就可以安全地封鎖此連接埠。</span><span class="sxs-lookup"><span data-stu-id="7062e-140">This port can be safely blocked if the feature is not being used.</span></span>  <span data-ttu-id="7062e-141">在啟用 ILB 的 ASE 上，此連接埠繫結至 ASE 的 ILB 位址。</span><span class="sxs-lookup"><span data-stu-id="7062e-141">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="7062e-142">4018：用於 Visual Studio 2013 的遠端偵錯。</span><span class="sxs-lookup"><span data-stu-id="7062e-142">4018: Used for remote debugging with Visual Studio 2013.</span></span>  <span data-ttu-id="7062e-143">如果未使用此功能，就可以安全地封鎖此連接埠。</span><span class="sxs-lookup"><span data-stu-id="7062e-143">This port can be safely blocked if the feature is not being used.</span></span>  <span data-ttu-id="7062e-144">在啟用 ILB 的 ASE 上，此連接埠繫結至 ASE 的 ILB 位址。</span><span class="sxs-lookup"><span data-stu-id="7062e-144">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="7062e-145">4020：用於 Visual Studio 2015 的遠端偵錯。</span><span class="sxs-lookup"><span data-stu-id="7062e-145">4020: Used for remote debugging with Visual Studio 2015.</span></span>  <span data-ttu-id="7062e-146">如果未使用此功能，就可以安全地封鎖此連接埠。</span><span class="sxs-lookup"><span data-stu-id="7062e-146">This port can be safely blocked if the feature is not being used.</span></span>  <span data-ttu-id="7062e-147">在啟用 ILB 的 ASE 上，此連接埠繫結至 ASE 的 ILB 位址。</span><span class="sxs-lookup"><span data-stu-id="7062e-147">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>

## <a name="outbound-connectivity-and-dns-requirements"></a><span data-ttu-id="7062e-148">輸出連線和 DNS 需求</span><span class="sxs-lookup"><span data-stu-id="7062e-148">Outbound Connectivity and DNS Requirements</span></span>
<span data-ttu-id="7062e-149">若要讓 App Service Environment 正確運作，它還需要不同端點的輸出存取權。</span><span class="sxs-lookup"><span data-stu-id="7062e-149">For an App Service Environment to function properly, it also requires outbound access to various endpoints.</span></span> <span data-ttu-id="7062e-150">[ExpressRoute 的網路組態](app-service-app-service-environment-network-configuration-expressroute.md#required-network-connectivity) 文章的＜需要的網路連線＞一節中有提供 ASE 所使用的外部端點完整清單。</span><span class="sxs-lookup"><span data-stu-id="7062e-150">A full list of the external endpoints used by an ASE is in the "Required Network Connectivity" section of the [Network Configuration for ExpressRoute](app-service-app-service-environment-network-configuration-expressroute.md#required-network-connectivity) article.</span></span>

<span data-ttu-id="7062e-151">App Service 環境需要針對虛擬網路設定的有效 DNS 基礎結構。</span><span class="sxs-lookup"><span data-stu-id="7062e-151">App Service Environments require a valid DNS infrastructure configured for the virtual network.</span></span>  <span data-ttu-id="7062e-152">如果 DNS 設定在建立 App Service 環境之後因為任何原因而變更，開發人員可以強制 App Service 環境挑選新的 DNS 組態。</span><span class="sxs-lookup"><span data-stu-id="7062e-152">If for any reason the DNS configuration is changed after an App Service Environment has been created, developers can force an App Service Environment to pick up the new DNS configuration.</span></span>  <span data-ttu-id="7062e-153">若是使用位於 [Azure 入口網站][NewPortal]中 [App Service Environment 管理] 刀鋒視窗頂端的 [重新啟動] 圖示來觸發輪流環境重新開機，就會導致環境挑選新的 DNS 組態。</span><span class="sxs-lookup"><span data-stu-id="7062e-153">Triggering a rolling environment reboot using the "Restart" icon located at the top of the App Service Environment management blade in the [Azure portal][NewPortal] will cause the environment to pick up the new DNS configuration.</span></span>

<span data-ttu-id="7062e-154">也建議事先在虛擬網路上設定任何自訂 DNS 伺服器，再建立 App Service 環境。</span><span class="sxs-lookup"><span data-stu-id="7062e-154">It is also recommended that any custom DNS servers on the vnet be setup ahead of time prior to creating an App Service Environment.</span></span>  <span data-ttu-id="7062e-155">如果在建立 App Service 環境時變更虛擬網路的 DNS 組態，則會導致 App Service 環境建立程序失敗。</span><span class="sxs-lookup"><span data-stu-id="7062e-155">If a virtual network's DNS configuration is changed while an App Service Environment is being created, that will result in the App Service Environment creation process failing.</span></span>  <span data-ttu-id="7062e-156">同樣地，若自訂 DNS 伺服器存在於 VPN 閘道的另一端，且 DNS 伺服器無法連線或使用，則 App Service 環境建立程序也會失敗。</span><span class="sxs-lookup"><span data-stu-id="7062e-156">In a similar vein, if a custom DNS server exists on the other end of a VPN gateway, and the DNS server is unreachable or unavailable, the App Service Environment creation process will also fail.</span></span>

## <a name="creating-a-network-security-group"></a><span data-ttu-id="7062e-157">建立網路安全性群組</span><span class="sxs-lookup"><span data-stu-id="7062e-157">Creating a Network Security Group</span></span>
<span data-ttu-id="7062e-158">如需有關網路安全性群組如何運作的完整詳細資料，請參閱下列[資訊][NetworkSecurityGroups]。</span><span class="sxs-lookup"><span data-stu-id="7062e-158">For full details on how network security groups work see the following [information][NetworkSecurityGroups].</span></span>  <span data-ttu-id="7062e-159">下面的「Azure 服務管理」範例說明網路安全性群組的重點，其中是將焦點放在設定網路安全群組並套用到包含 App Service Environment 的子網路。</span><span class="sxs-lookup"><span data-stu-id="7062e-159">The Azure Service Management example below touches on highlights of network security groups, with a focus on configuring and applying a network security group to a subnet that contains an App Service Environment.</span></span>

<span data-ttu-id="7062e-160">**注意︰** 您可以使用 [Azure 入口網站](https://portal.azure.com) 或透過 Azure PowerShell，利用圖形方式設定網路安全性群組。</span><span class="sxs-lookup"><span data-stu-id="7062e-160">**Note:** Network security groups can be configured graphically using the [Azure Portal](https://portal.azure.com) or through Azure PowerShell.</span></span>

<span data-ttu-id="7062e-161">網路安全性群組首次會建立為與訂用帳戶相關聯的獨立實體。</span><span class="sxs-lookup"><span data-stu-id="7062e-161">Network security groups are first created as a standalone entity associated with a subscription.</span></span> <span data-ttu-id="7062e-162">由於網路安全性群組建立於 Azure 區域，所以請確保網路安全性群組建立於與 App Service 環境相同的區域中。</span><span class="sxs-lookup"><span data-stu-id="7062e-162">Since network security groups are created in an Azure region, ensure that the network security group is created in the same region as the App Service Environment.</span></span>

<span data-ttu-id="7062e-163">以下示範如何建立網路安全性群組：</span><span class="sxs-lookup"><span data-stu-id="7062e-163">The following demonstrates creating a network security group:</span></span>

    New-AzureNetworkSecurityGroup -Name "testNSGexample" -Location "South Central US" -Label "Example network security group for an app service environment"

<span data-ttu-id="7062e-164">建立網路安全性群組後，會加入一或多個網路安全性規則。</span><span class="sxs-lookup"><span data-stu-id="7062e-164">Once a network security group is created, one or more network security rules are added to it.</span></span>  <span data-ttu-id="7062e-165">由於這組規則會隨著時間改變，所以建議區隔用於規則優先順序的編號配置，以便陸續插入其他規則。</span><span class="sxs-lookup"><span data-stu-id="7062e-165">Since the set of rules may change over time, it is recommended to space out the numbering scheme used for rule priorities to make it easy to insert additional rules over time.</span></span>

<span data-ttu-id="7062e-166">下列範例顯示的規則可明確授與以下連接埠的存取權：Azure 基礎結構管理和維護 App Service 環境所需的管理連接埠。</span><span class="sxs-lookup"><span data-stu-id="7062e-166">The example below shows a rule that explicitly grants access to the management ports needed by the Azure infrastructure to manage and maintain an App Service Environment.</span></span>  <span data-ttu-id="7062e-167">請注意，所有管理流量都會透過 SSL 傳送並受用戶端憑證保護，因此即使連接埠已開啟，Azure 管理基礎結構以外的任何實體都無法予以存取。</span><span class="sxs-lookup"><span data-stu-id="7062e-167">Note that all management traffic flows over SSL and is secured by client certificates, so even though the ports are opened they are inaccessible by any entity other than Azure management infrastructure.</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "ALLOW AzureMngmt" -Type Inbound -Priority 100 -Action Allow -SourceAddressPrefix 'INTERNET'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '454-455' -Protocol TCP


<span data-ttu-id="7062e-168">鎖定對連接埠 80 和 443 的存取，以「隱藏」上游裝置或服務背後的 App Service 環境時，您必須知道上游 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="7062e-168">When locking down access to port 80 and 443 to "hide" an App Service Environment behind upstream devices or services, you will need to know the upstream IP address.</span></span>  <span data-ttu-id="7062e-169">例如，如果您使用 Web 應用程式防火牆 (WAF)，則 WAF 將會有自己的 IP 位址，以便在將流量 Proxy 處理至下游 App Service 環境時使用。</span><span class="sxs-lookup"><span data-stu-id="7062e-169">For example, if you are using a web application firewall (WAF), the WAF will have its own IP address (or addresses) which it uses when proxying traffic to a downstream App Service Environment.</span></span>  <span data-ttu-id="7062e-170">您必須在網路安全性規則的 *SourceAddressPrefix* 參數中使用此 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="7062e-170">You will need to use this IP address in the *SourceAddressPrefix* parameter of a network security rule.</span></span>

<span data-ttu-id="7062e-171">在下面範例中，明確允許來自特定上游 IP 位址的輸入流量。</span><span class="sxs-lookup"><span data-stu-id="7062e-171">In the example below, inbound traffic from a specific upstream IP address is explicitly allowed.</span></span>  <span data-ttu-id="7062e-172">位址 *1.2.3.4* 會做為上游 WAF 的 IP 位址預留位置。</span><span class="sxs-lookup"><span data-stu-id="7062e-172">The address *1.2.3.4* is used as a placeholder for the IP address of an upstream WAF.</span></span>  <span data-ttu-id="7062e-173">變更此值，以符合您的上游裝置或服務所使用的位址。</span><span class="sxs-lookup"><span data-stu-id="7062e-173">Change the value to match the address used by your upstream device or service.</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT HTTP" -Type Inbound -Priority 200 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '80' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT HTTPS" -Type Inbound -Priority 300 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '443' -Protocol TCP

<span data-ttu-id="7062e-174">如果需要 FTP 支援，可以使用下列規則做為範本，以授與對 FTP 控制連接埠和資料通道連接埠的存取權。</span><span class="sxs-lookup"><span data-stu-id="7062e-174">If FTP support is desired, the following rules can be used as a template to grant access to the FTP control port and data channel ports.</span></span>  <span data-ttu-id="7062e-175">由於 FTP 是可設定狀態的通訊協定，所以您無法透過傳統 HTTP/HTTPS 防火牆或 Proxy 裝置路由傳送 FTP 流量。</span><span class="sxs-lookup"><span data-stu-id="7062e-175">Since FTP is a stateful protocol, you may not be able to route FTP traffic through a traditional HTTP/HTTPS firewall or proxy device.</span></span>  <span data-ttu-id="7062e-176">在此情況下，您將需要將 *SourceAddressPrefix* 設定為不同的值 -例如，FTP 用戶端執行所在開發人員或部署電腦的 IP 位址範圍。</span><span class="sxs-lookup"><span data-stu-id="7062e-176">In this case you will need to set the *SourceAddressPrefix* to a different value - for example the IP address range of developer or deployment machines on which FTP clients are running.</span></span> 

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT FTPCtrl" -Type Inbound -Priority 400 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '21' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT FTPDataRange" -Type Inbound -Priority 500 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '10001-10020' -Protocol TCP

<span data-ttu-id="7062e-177">(**注意**：資料通道連接埠範圍可能會在預覽期間變更。)</span><span class="sxs-lookup"><span data-stu-id="7062e-177">(**Note:**  the data channel port range may change during the preview period.)</span></span>

<span data-ttu-id="7062e-178">如果使用 Visual Studio 遠端偵錯，則下列規則會示範如何授與存取權。</span><span class="sxs-lookup"><span data-stu-id="7062e-178">If remote debugging with Visual Studio is used, the following rules demonstrate how to grant access.</span></span>  <span data-ttu-id="7062e-179">因為每個支援的 Visual Studio 版本使用不同的連接埠進行遠端偵錯，所以每個版本會有個別的規則。</span><span class="sxs-lookup"><span data-stu-id="7062e-179">There is a separate rule for each supported version of Visual Studio since each version uses a different port for remote debugging.</span></span>  <span data-ttu-id="7062e-180">如同 FTP 存取，遠端偵錯流量可能不會透過傳統 WAF 或 Proxy 裝置正確傳送。</span><span class="sxs-lookup"><span data-stu-id="7062e-180">As with FTP access, remote debugging traffic may not flow properly through a traditional WAF or proxy device.</span></span>  <span data-ttu-id="7062e-181">可將 *SourceAddressPrefix* 改為設定成執行 Visual Studio 之開發人員電腦的 IP 位址範圍。</span><span class="sxs-lookup"><span data-stu-id="7062e-181">The *SourceAddressPrefix* can instead be set to the IP address range of developer machines running Visual Studio.</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT RemoteDebuggingVS2012" -Type Inbound -Priority 600 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '4016' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT RemoteDebuggingVS2013" -Type Inbound -Priority 700 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '4018' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT RemoteDebuggingVS2015" -Type Inbound -Priority 800 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '4020' -Protocol TCP

## <a name="assigning-a-network-security-group-to-a-subnet"></a><span data-ttu-id="7062e-182">將網路安全性群組指派給子網路</span><span class="sxs-lookup"><span data-stu-id="7062e-182">Assigning a Network Security Group to a Subnet</span></span>
<span data-ttu-id="7062e-183">網路安全性群組有拒絕存取所有外部流量的預設安全性規則。</span><span class="sxs-lookup"><span data-stu-id="7062e-183">A network security group has a default security rule which denies access to all external traffic.</span></span>  <span data-ttu-id="7062e-184">結合上述的網路安全性規則與用來封鎖輸入流量的預設安全性規則，結果就是只有來自與 *允許* 動作相關聯之來源位址範圍的流量，能夠傳送到在 App Service 環境中執行的應用程式。</span><span class="sxs-lookup"><span data-stu-id="7062e-184">The result from combining the network security rules described above, and the default security rule blocking inbound traffic, is that only traffic from source address ranges associated with an *Allow* action will be able to send traffic to apps running in an App Service Environment.</span></span>

<span data-ttu-id="7062e-185">在網路安全性群組填入安全性規則之後，必須將該群組指派給包含 App Service 環境的子網路。</span><span class="sxs-lookup"><span data-stu-id="7062e-185">After a network security group is populated with security rules, it needs to be assigned to the subnet containing the App Service Environment.</span></span>  <span data-ttu-id="7062e-186">指派命令會同時參考 App Service 環境所在的虛擬網路名稱，以及 App Service 環境建立所在的子網路名稱。</span><span class="sxs-lookup"><span data-stu-id="7062e-186">The assignment command references both the name of the virtual network where the App Service Environment resides, as well as the name of the subnet where the App Service Environment was created.</span></span>  

<span data-ttu-id="7062e-187">下列範例顯示要指派給子網路和虛擬網路的網路安全性群組：</span><span class="sxs-lookup"><span data-stu-id="7062e-187">The example below shows a network security group being assigned to a subnet and virtual network:</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityGroupToSubnet -VirtualNetworkName 'testVNet' -SubnetName 'Subnet-test'

<span data-ttu-id="7062e-188">網路安全性群組指派成功後 (指派是一項長時間執行的作業並可能需要幾分鐘才能完成)，只有符合 *允許* 規則的輸入流量才能成功抵達 App Service 環境中的應用程式。</span><span class="sxs-lookup"><span data-stu-id="7062e-188">Once the network security group assignment succeeds (the assignment is a long-running operations and can take a few minutes to complete), only inbound traffic matching *Allow* rules will successfully reach apps in the App Service Environment.</span></span>

<span data-ttu-id="7062e-189">基於完整性，下列範例示範如何移除進而取消網路安全性群組與子網路的關聯：</span><span class="sxs-lookup"><span data-stu-id="7062e-189">For completeness the following example shows how to remove and thus dis-associate the network security group from the subnet:</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Remove-AzureNetworkSecurityGroupFromSubnet -VirtualNetworkName 'testVNet' -SubnetName 'Subnet-test'

## <a name="special-considerations-for-explicit-ip-ssl"></a><span data-ttu-id="7062e-190">明確 IP-SSL 的特殊考量</span><span class="sxs-lookup"><span data-stu-id="7062e-190">Special Considerations for Explicit IP-SSL</span></span>
<span data-ttu-id="7062e-191">如果為應用程式設定了明確的 IP-SSL 位址 (「僅」適用於具有公用 VIP 的 ASE)，而不是使用 App Service Environment 的預設 IP 位址，則 HTTP 和 HTTPS 流量都會透過一組與連接埠 80 和 443 不同的連接埠流向子網路。</span><span class="sxs-lookup"><span data-stu-id="7062e-191">If an app is configured with an explicit IP-SSL address (applicable *only* to ASEs that have a public VIP), instead of using the default IP address of the App Service Environment, both HTTP and HTTPS traffic flows into the subnet over a different set of ports other than ports 80 and 443.</span></span>

<span data-ttu-id="7062e-192">每個 IP-SSL 位址使用的個別連接埠組合，可以在 App Service 環境的詳細資料 UX 刀鋒視窗的入口網站使用者介面中找到。</span><span class="sxs-lookup"><span data-stu-id="7062e-192">The individual pair of ports used by each IP-SSL address can be found in the portal user interface from the App Service Environment's details UX blade.</span></span>  <span data-ttu-id="7062e-193">選取 [所有設定] --> [IP 位址]。</span><span class="sxs-lookup"><span data-stu-id="7062e-193">Select "All settings" --> "IP addresses".</span></span>  <span data-ttu-id="7062e-194">「IP 位址」刀鋒視窗會顯示 App Service 環境所有明確設定的 IP-SSL 位址，以及特殊連接埠配對，這些特殊連接埠配對則是用於路由與每個 IP-SSL 位址關聯的 HTTP 和 HTTPS 流量。</span><span class="sxs-lookup"><span data-stu-id="7062e-194">The "IP addresses" blade shows a table of all explicitly configured IP-SSL addresses for the App Service Environment, along with the special port pair that is used to route HTTP and HTTPS traffic associated with each IP-SSL address.</span></span>  <span data-ttu-id="7062e-195">在網路安全性群組中設定規則時，必須針對 DestinationPortRange 參數使用此連接埠配對。</span><span class="sxs-lookup"><span data-stu-id="7062e-195">It is this port pair that needs to be used for the DestinationPortRange parameters when configuring rules in a network security group.</span></span>

<span data-ttu-id="7062e-196">當 ASE 上的 app 設定為使用 IP-SSL 時，外部客戶將不會看到且不需要擔心特殊連接埠配對對應。</span><span class="sxs-lookup"><span data-stu-id="7062e-196">When an app on an ASE is configured to use IP-SSL, external customers will not see and do not need to worry about the special port pair mapping.</span></span>  <span data-ttu-id="7062e-197">應用程式流量會正常流向設定的 IP-SSL 位址。</span><span class="sxs-lookup"><span data-stu-id="7062e-197">Traffic to the apps will flow normally to the configured IP-SSL address.</span></span>  <span data-ttu-id="7062e-198">將流量路由到包含 ASE 的子網路時，在路由流量最後階段期間，特殊連接埠組合的轉譯會於內部自動發生。</span><span class="sxs-lookup"><span data-stu-id="7062e-198">The translation to the special port pair automatically happens internally during the final leg of routing traffic into the subnet containing the ASE.</span></span> 

## <a name="getting-started"></a><span data-ttu-id="7062e-199">開始使用</span><span class="sxs-lookup"><span data-stu-id="7062e-199">Getting started</span></span>
<span data-ttu-id="7062e-200">若要開始使用 App Service Environment，請參閱 [App Service Environment 簡介][IntroToAppServiceEnvironment]</span><span class="sxs-lookup"><span data-stu-id="7062e-200">To get started with App Service Environments, see [Introduction to App Service Environment][IntroToAppServiceEnvironment]</span></span>

<span data-ttu-id="7062e-201">您可以在 [應用程式服務環境的讀我檔案](../app-service/app-service-app-service-environments-readme.md)中取得 App Service 環境的所有相關文章與做法。</span><span class="sxs-lookup"><span data-stu-id="7062e-201">All articles and How-To's for App Service Environments are available in the [README for Application Service Environments](../app-service/app-service-app-service-environments-readme.md).</span></span>

<span data-ttu-id="7062e-202">如需有關將應用程式安全地從 App Service Environment 連接到後端資源的詳細資料，請參閱[安全地從 App Service Environment 連接到後端資源][SecurelyConnecttoBackend]</span><span class="sxs-lookup"><span data-stu-id="7062e-202">For details around apps securely connecting to backend resource from an App Service Environment, see [Securely connecting to Backend resources from an App Service Environment][SecurelyConnecttoBackend]</span></span>

<span data-ttu-id="7062e-203">如需有關 Azure App Service 平台的詳細資訊，請參閱 [Azure App Service][AzureAppService]。</span><span class="sxs-lookup"><span data-stu-id="7062e-203">For more information about the Azure App Service platform, see [Azure App Service][AzureAppService].</span></span>

[!INCLUDE [app-service-web-whats-changed](../../includes/app-service-web-whats-changed.md)]

[!INCLUDE [app-service-web-try-app-service](../../includes/app-service-web-try-app-service.md)]

<!-- LINKS -->
[virtualnetwork]: https://azure.microsoft.com/documentation/articles/virtual-networks-faq/
[HowToCreateAnAppServiceEnvironment]: http://azure.microsoft.com/documentation/articles/app-service-web-how-to-create-an-app-service-environment/
[NetworkSecurityGroups]: https://azure.microsoft.com/documentation/articles/virtual-networks-nsg/
[AzureAppService]: http://azure.microsoft.com/documentation/articles/app-service-value-prop-what-is/
[IntroToAppServiceEnvironment]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-intro/
[SecurelyConnecttoBackend]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-securely-connecting-to-backend-resources/
[NewPortal]:  https://portal.azure.com  

<!-- IMAGES -->

