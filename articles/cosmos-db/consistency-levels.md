---
title: "Azure Cosmos DB 中的一致性層級 | Microsoft Docs"
description: "Azure Cosmos DB 具有五個一致性層級，有助於在最終一致性、可用性和延遲的取捨之間取得平衡。"
keywords: "最終一致性, azure cosmos db, azure, Microsoft azure"
services: cosmos-db
author: mimig1
manager: jhubbard
editor: cgronlun
documentationcenter: 
ms.assetid: 3fe51cfa-a889-4a4a-b320-16bf871fe74c
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: mimig
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: a1ebec2285982c70aa9dc49950769fe18e2e2d0d
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/03/2017
---
# <a name="tunable-data-consistency-levels-in-azure-cosmos-db"></a><span data-ttu-id="da3e6-104">Azure Cosmos DB 中的 Tunable 資料一致性層級</span><span class="sxs-lookup"><span data-stu-id="da3e6-104">Tunable data consistency levels in Azure Cosmos DB</span></span>
<span data-ttu-id="da3e6-105">Azure Cosmos DB 是針對每個資料模型考量到全球發佈的全新設計。</span><span class="sxs-lookup"><span data-stu-id="da3e6-105">Azure Cosmos DB is designed from the ground up with global distribution in mind for every data model.</span></span> <span data-ttu-id="da3e6-106">它的設計目的是提供可預測的低延遲保證、99.99% 的可用性 SLA，以及多個定義完善且寬鬆的一致性層級模型。</span><span class="sxs-lookup"><span data-stu-id="da3e6-106">It is designed to offer predictable low latency guarantees, a 99.99% availability SLA, and multiple well-defined relaxed consistency models.</span></span> <span data-ttu-id="da3e6-107">Azure Cosmos DB 目前提供五種一致性層級：強式、限定過期、工作階段、一致的前置和最終。</span><span class="sxs-lookup"><span data-stu-id="da3e6-107">Currently, Azure Cosmos DB provides five consistency levels: strong, bounded-staleness, session, consistent prefix, and eventual.</span></span> 

<span data-ttu-id="da3e6-108">除了**強式**和**最終一致性**模型通常是由分散式資料庫所提供，Azure Cosmos DB 還提供其他三個已仔細編碼且可運作的一致性模型，並已根據真實世界的使用案例驗證過它們的實用性。</span><span class="sxs-lookup"><span data-stu-id="da3e6-108">Besides **strong** and **eventual consistency** models commonly offered by distributed databases, Azure Cosmos DB offers three more carefully codified and operationalized consistency models, and has validated their usefulness against real world use cases.</span></span> <span data-ttu-id="da3e6-109">這些模型是**限定過期**、**工作階段**和**一致前置詞**一致性層級。</span><span class="sxs-lookup"><span data-stu-id="da3e6-109">These are the **bounded staleness**, **session**, and **consistent prefix** consistency levels.</span></span> <span data-ttu-id="da3e6-110">總言之，這五個一致性層級可讓您在一致性、可用性與延遲三者間做出合理取捨。</span><span class="sxs-lookup"><span data-stu-id="da3e6-110">Collectively these five consistency levels enable you to make well-reasoned trade-offs between consistency, availability, and latency.</span></span> 

## <a name="distributed-databases-and-consistency"></a><span data-ttu-id="da3e6-111">分散式資料庫和一致性</span><span class="sxs-lookup"><span data-stu-id="da3e6-111">Distributed databases and consistency</span></span>
<span data-ttu-id="da3e6-112">商業散發資料庫分為兩類：完全不會提供完善且可證明之一致性選擇的資料庫，以及提供兩個極端的可程式性選擇 (強式與最終一致性) 的資料庫。</span><span class="sxs-lookup"><span data-stu-id="da3e6-112">Commercial distributed databases fall into two categories: databases that do not offer well-defined, provable consistency choices at all, and databases which offer two extreme programmability choices (strong vs. eventual consistency).</span></span> 

<span data-ttu-id="da3e6-113">前者增加了應用程式開發人員其複寫通訊協定細節的負擔，並期望他們在一致性、可用性、延遲和輸送量之間做出困難的取捨。</span><span class="sxs-lookup"><span data-stu-id="da3e6-113">The former burdens application developers with minutia of their replication protocols and expects them to make difficult tradeoffs between consistency, availability, latency, and throughput.</span></span> <span data-ttu-id="da3e6-114">後者則是將壓力放在選擇兩個極端其中之一。</span><span class="sxs-lookup"><span data-stu-id="da3e6-114">The latter puts a pressure to choose one of the two extremes.</span></span> <span data-ttu-id="da3e6-115">儘管有超過 50 個一致性模型的研究和建議，散發資料庫社群仍無法商業化超越強式與最終一致性的一致性層級。</span><span class="sxs-lookup"><span data-stu-id="da3e6-115">Despite the abundance of research and proposals for more than 50 consistency models, the distributed database community has not been able to commercialize consistency levels beyond strong and eventual consistency.</span></span> <span data-ttu-id="da3e6-116">Cosmos DB 讓開發人員在五個完善定義的一致性模型，以及一致性頻譜之間選擇 – 強式、限定過期、[工作階段](http://dl.acm.org/citation.cfm?id=383631)、一致前置詞和最終。</span><span class="sxs-lookup"><span data-stu-id="da3e6-116">Cosmos DB allows developers to choose between five well-defined consistency models along the consistency spectrum – strong, bounded staleness, [session](http://dl.acm.org/citation.cfm?id=383631), consistent prefix, and eventual.</span></span> 

![Azure Cosmos DB 提供多個定義完善 (寬鬆) 的一致性模型，讓您可從中選擇](./media/consistency-levels/five-consistency-levels.png)

<span data-ttu-id="da3e6-118">下表說明每個一致性層級提供的特定保證。</span><span class="sxs-lookup"><span data-stu-id="da3e6-118">The following table illustrates the specific guarantees each consistency level provides.</span></span>
 
<span data-ttu-id="da3e6-119">**一致性層級和保證**</span><span class="sxs-lookup"><span data-stu-id="da3e6-119">**Consistency Levels and guarantees**</span></span>

| <span data-ttu-id="da3e6-120">一致性層級</span><span class="sxs-lookup"><span data-stu-id="da3e6-120">Consistency Level</span></span> | <span data-ttu-id="da3e6-121">保證</span><span class="sxs-lookup"><span data-stu-id="da3e6-121">Guarantees</span></span> |
| --- | --- |
| <span data-ttu-id="da3e6-122">強式</span><span class="sxs-lookup"><span data-stu-id="da3e6-122">Strong</span></span> | <span data-ttu-id="da3e6-123">線性化能力</span><span class="sxs-lookup"><span data-stu-id="da3e6-123">Linearizability</span></span> |
| <span data-ttu-id="da3e6-124">限定過期</span><span class="sxs-lookup"><span data-stu-id="da3e6-124">Bounded Staleness</span></span> | <span data-ttu-id="da3e6-125">一致前置詞。</span><span class="sxs-lookup"><span data-stu-id="da3e6-125">Consistent Prefix.</span></span> <span data-ttu-id="da3e6-126">讀取落後寫入 (k 前置詞或 t 間隔)</span><span class="sxs-lookup"><span data-stu-id="da3e6-126">Reads lag behind writes by k prefixes or t interval</span></span> |
| <span data-ttu-id="da3e6-127">工作階段</span><span class="sxs-lookup"><span data-stu-id="da3e6-127">Session</span></span>   | <span data-ttu-id="da3e6-128">一致前置詞。</span><span class="sxs-lookup"><span data-stu-id="da3e6-128">Consistent Prefix.</span></span> <span data-ttu-id="da3e6-129">單純讀取、單純寫入、讀取您的寫入、讀取後接寫入</span><span class="sxs-lookup"><span data-stu-id="da3e6-129">Monotonic reads, monotonic writes, read-your-writes, write-follows-reads</span></span> |
| <span data-ttu-id="da3e6-130">一致前置詞</span><span class="sxs-lookup"><span data-stu-id="da3e6-130">Consistent Prefix</span></span> | <span data-ttu-id="da3e6-131">傳回的更新是所有更新的部分前置詞 (沒有間隔)</span><span class="sxs-lookup"><span data-stu-id="da3e6-131">Updates returned are some prefix of all the updates, with no gaps</span></span> |
| <span data-ttu-id="da3e6-132">最終</span><span class="sxs-lookup"><span data-stu-id="da3e6-132">Eventual</span></span>  | <span data-ttu-id="da3e6-133">次序錯誤讀取</span><span class="sxs-lookup"><span data-stu-id="da3e6-133">Out of order reads</span></span> |

<span data-ttu-id="da3e6-134">您可以在 Cosmos DB 帳戶上設定預設一致性層級 (並在稍後覆寫特定讀取要求的一致性)。</span><span class="sxs-lookup"><span data-stu-id="da3e6-134">You can configure the default consistency level on your Cosmos DB account (and later override the consistency on a specific read request).</span></span> <span data-ttu-id="da3e6-135">就內部而言，預設的一致性層級適用於跨區域之分割區集合內的資料。</span><span class="sxs-lookup"><span data-stu-id="da3e6-135">Internally, the default consistency level applies to data within the partition sets which may span regions.</span></span> <span data-ttu-id="da3e6-136">大約 73% 的租用戶使用工作階段一致性，而 20% 的租用戶則偏好限定過期。</span><span class="sxs-lookup"><span data-stu-id="da3e6-136">About 73% of our tenants use session consistency and 20% prefer bounded staleness.</span></span> <span data-ttu-id="da3e6-137">我們發現，大約有 3% 的客戶在一開始試驗不同的一致性層級，然後才決定應用程式的特定一致性選擇。</span><span class="sxs-lookup"><span data-stu-id="da3e6-137">We observe that approximately 3% of our customers experiment with various consistency levels initially before settling on a specific consistency choice for their application.</span></span> <span data-ttu-id="da3e6-138">我們也發現只有 2% 的租用戶在個別要求基礎上覆寫一致性層級。</span><span class="sxs-lookup"><span data-stu-id="da3e6-138">We also observe that only 2% of our tenants override consistency levels on a per request basis.</span></span> 

<span data-ttu-id="da3e6-139">在 Cosmos DB 中，在工作階段、一致前置詞和最終一致性提供服務的讀取，比起使用強式或限定過期一致性的讀取，其成本便宜兩倍。</span><span class="sxs-lookup"><span data-stu-id="da3e6-139">In Cosmos DB, reads served at session, consistent prefix and eventual consistency are twice as cheap as reads with strong or bounded staleness consistency.</span></span> <span data-ttu-id="da3e6-140">Cosmos DB 有領先業界的完整 99.99% SLA，包括一致性保證以及可用性、輸送量和延遲。</span><span class="sxs-lookup"><span data-stu-id="da3e6-140">Cosmos DB has industry leading comprehensive 99.99% SLAs including consistency guarantees along with availability, throughput, and latency.</span></span> <span data-ttu-id="da3e6-141">我們採用[線性化能力檢查程式](http://dl.acm.org/citation.cfm?id=1806634)，在我們的服務遙測上持續運作，並且公開向您報告任何一致性違規。</span><span class="sxs-lookup"><span data-stu-id="da3e6-141">We employ a [linearizability checker](http://dl.acm.org/citation.cfm?id=1806634), which continuously operates over our service telemetry and openly reports any consistency violations to you.</span></span> <span data-ttu-id="da3e6-142">針對限定過期，我們監視以及報告任何違反 k 和 t 界限的違規。</span><span class="sxs-lookup"><span data-stu-id="da3e6-142">For bounded staleness, we monitor and report any violations to k and t bounds.</span></span> <span data-ttu-id="da3e6-143">針對所有五個寬鬆的一致性層級，我們也會直接向您報告[概率限定過期度量](http://dl.acm.org/citation.cfm?id=2212359)。</span><span class="sxs-lookup"><span data-stu-id="da3e6-143">For all five relaxed consistency levels, we also report the [probabilistic bounded staleness metric](http://dl.acm.org/citation.cfm?id=2212359) directly to you.</span></span>  

## <a name="scope-of-consistency"></a><span data-ttu-id="da3e6-144">一致性的範圍</span><span class="sxs-lookup"><span data-stu-id="da3e6-144">Scope of consistency</span></span>
<span data-ttu-id="da3e6-145">已將一致性的規模範圍限制為單一使用者要求。</span><span class="sxs-lookup"><span data-stu-id="da3e6-145">The granularity of consistency is scoped to a single user request.</span></span> <span data-ttu-id="da3e6-146">寫入要求可能會對應至插入、取代、更新插入或刪除交易。</span><span class="sxs-lookup"><span data-stu-id="da3e6-146">A write request may correspond to an insert, replace, upsert, or delete transaction.</span></span> <span data-ttu-id="da3e6-147">如同寫入，讀取/查詢交易也會將範圍限制為單一使用者要求。</span><span class="sxs-lookup"><span data-stu-id="da3e6-147">As with writes, a read/query transaction is also scoped to a single user request.</span></span> <span data-ttu-id="da3e6-148">使用者可能需要在大型結果集 (橫跨多個分割區) 上編頁，但是每一個讀取交易的範圍都會限制為單一頁面，並從單一分割區中提供服務。</span><span class="sxs-lookup"><span data-stu-id="da3e6-148">The user may be required to paginate over a large result-set, spanning multiple partitions, but each read transaction is scoped to a single page and served from within a single partition.</span></span>

## <a name="consistency-levels"></a><span data-ttu-id="da3e6-149">一致性層級</span><span class="sxs-lookup"><span data-stu-id="da3e6-149">Consistency levels</span></span>
<span data-ttu-id="da3e6-150">您可以設定資料庫帳戶的「預設一致性層級」，以套用至 Cosmos DB 帳戶底下的所有集合 (和資料庫)。</span><span class="sxs-lookup"><span data-stu-id="da3e6-150">You can configure a default consistency level on your database account that applies to all collections (and databases) under your Cosmos DB account.</span></span> <span data-ttu-id="da3e6-151">所有對使用者定義的資源發出的讀取和查詢，預設都會使用資料庫帳戶上所指定的預設一致性層級。</span><span class="sxs-lookup"><span data-stu-id="da3e6-151">By default, all reads and queries issued against the user-defined resources use the default consistency level specified on the database account.</span></span> <span data-ttu-id="da3e6-152">您可以使用每個支援的 API，放寬特定讀取/查詢要求的一致性層級。</span><span class="sxs-lookup"><span data-stu-id="da3e6-152">You can relax the consistency level of a specific read/query request using in each of the supported APIs.</span></span> <span data-ttu-id="da3e6-153">Azure Cosmos DB 複寫通訊協定支援五種類型的一致性層級，可在特定一致性保證和效能之間明確進行取捨，如本章節所述。</span><span class="sxs-lookup"><span data-stu-id="da3e6-153">There are five types of consistency levels supported by the Azure Cosmos DB replication protocol that provide a clear trade-off between specific consistency guarantees and performance, as described in this section.</span></span>

<span data-ttu-id="da3e6-154">**重要事項**：</span><span class="sxs-lookup"><span data-stu-id="da3e6-154">**Strong**:</span></span> 

* <span data-ttu-id="da3e6-155">強式一致性利用保證傳回項目最新版本的讀取來提供[線性化](https://aphyr.com/posts/313-strong-consistency-models)保證。</span><span class="sxs-lookup"><span data-stu-id="da3e6-155">Strong consistency offers a [linearizability](https://aphyr.com/posts/313-strong-consistency-models) guarantee with the reads guaranteed to return the most recent version of an item.</span></span> 
* <span data-ttu-id="da3e6-156">「增強式」一致性保證只有在複本的多數仲裁持久認可寫入之後，才會顯示寫入。</span><span class="sxs-lookup"><span data-stu-id="da3e6-156">Strong consistency guarantees that a write is only visible after it is committed durably by the majority quorum of replicas.</span></span> <span data-ttu-id="da3e6-157">寫入不是會被主要和次要仲裁同步地持久認可，就是會被中止。</span><span class="sxs-lookup"><span data-stu-id="da3e6-157">A write is either synchronously committed durably by both the primary and the quorum of secondaries, or it is aborted.</span></span> <span data-ttu-id="da3e6-158">讀取的認可一律是交由多數讀取仲裁來負責；用戶端絕不會看到未認可或不完整的寫入，而且一律保證會讀取最新認可的寫入。</span><span class="sxs-lookup"><span data-stu-id="da3e6-158">A read is always acknowledged by the majority read quorum, a client can never see an uncommitted or partial write and is always guaranteed to read the latest acknowledged write.</span></span> 
* <span data-ttu-id="da3e6-159">設定為使用強式一致性的 Azure Cosmos DB 帳戶，無法將一個以上的 Azure 區域關聯至它們的 Azure Cosmos DB 帳戶。</span><span class="sxs-lookup"><span data-stu-id="da3e6-159">Azure Cosmos DB accounts that are configured to use strong consistency cannot associate more than one Azure region with their Azure Cosmos DB account.</span></span> 
* <span data-ttu-id="da3e6-160">具有強式一致性的讀取作業成本 (就取用的 [要求單位](request-units.md) 而言) 會高於工作階段和最終，但與限定過期相同。</span><span class="sxs-lookup"><span data-stu-id="da3e6-160">The cost of a read operation (in terms of [request units](request-units.md) consumed) with strong consistency is higher than session and eventual, but the same as bounded staleness.</span></span>

<span data-ttu-id="da3e6-161">**限定過期**：</span><span class="sxs-lookup"><span data-stu-id="da3e6-161">**Bounded staleness**:</span></span> 

* <span data-ttu-id="da3e6-162">限定過期一致性保證讀取可能會落後寫入最多 K 個項目版本或首碼或是 t 個時間間隔。</span><span class="sxs-lookup"><span data-stu-id="da3e6-162">Bounded staleness consistency guarantees that the reads may lag behind writes by at most *K* versions or prefixes of an item or *t* time-interval.</span></span> 
* <span data-ttu-id="da3e6-163">因此，當選擇限定過期時，有兩種方式可以設定「過期」︰項目的版本數 K，它是讀取落後寫入的數目，以及時間間隔 t</span><span class="sxs-lookup"><span data-stu-id="da3e6-163">Therefore, when choosing bounded staleness, the "staleness" can be configured in two ways: number of versions *K* of the item by which the reads lag behind the writes, and the time interval *t*</span></span> 
* <span data-ttu-id="da3e6-164">限定過期提供全域訂單總數，但「過期期間」內的除外。</span><span class="sxs-lookup"><span data-stu-id="da3e6-164">Bounded staleness offers total global order except within the "staleness window."</span></span> <span data-ttu-id="da3e6-165">在區域內，「過期期間」內外都有單純的讀取保證存在。</span><span class="sxs-lookup"><span data-stu-id="da3e6-165">The monotonic read guarantees exists within a region both inside and outside the "staleness window."</span></span> 
* <span data-ttu-id="da3e6-166">限定過期可提供比工作階段或最終一致性還要強大的一致性保證。</span><span class="sxs-lookup"><span data-stu-id="da3e6-166">Bounded staleness provides a stronger consistency guarantee than session or eventual consistency.</span></span> <span data-ttu-id="da3e6-167">針對全球發佈的應用程式，如果您想要強式一致性但也想要 99.99% 的可用性和低度延遲，我們建議您使用限定過期。</span><span class="sxs-lookup"><span data-stu-id="da3e6-167">For globally distributed applications, we recommend you use bounded staleness for scenarios where you would like to have strong consistency but also want 99.99% availability and low latency.</span></span> 
* <span data-ttu-id="da3e6-168">使用限定過期一致性設定的 Azure Cosmos DB 帳戶可以將任意數目的 Azure 區域關聯至它們的 Azure Cosmos DB 區域。</span><span class="sxs-lookup"><span data-stu-id="da3e6-168">Azure Cosmos DB accounts that are configured with bounded staleness consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 
* <span data-ttu-id="da3e6-169">具有限定過期的讀取作業成本 (就取用的 RU 而言) 會高於工作階段和最終一致性，但與強式一致性相同。</span><span class="sxs-lookup"><span data-stu-id="da3e6-169">The cost of a read operation (in terms of RUs consumed) with bounded staleness is higher than session and eventual consistency, but the same as strong consistency.</span></span>

<span data-ttu-id="da3e6-170">**工作階段**：</span><span class="sxs-lookup"><span data-stu-id="da3e6-170">**Session**:</span></span> 

* <span data-ttu-id="da3e6-171">與強式和限定過期一致性層級所提供的全域一致性模型不同，工作階段一致性範圍會限制為用戶端工作階段。</span><span class="sxs-lookup"><span data-stu-id="da3e6-171">Unlike the global consistency models offered by strong and bounded staleness consistency levels, session consistency is scoped to a client session.</span></span> 
* <span data-ttu-id="da3e6-172">工作階段一致性適用於所有牽涉到裝置或使用者工作階段的案例，因為它保證單純讀取、單純寫入和讀取您自己的寫入 (RYW) 保證。</span><span class="sxs-lookup"><span data-stu-id="da3e6-172">Session consistency is ideal for all scenarios where a device or user session is involved since it guarantees monotonic reads, monotonic writes, and read your own writes (RYW) guarantees.</span></span> 
* <span data-ttu-id="da3e6-173">工作階段一致性可為工作階段提供可預測的一致性，以及在提供最低延遲的寫入和讀取時提供最高的讀取輸送量。</span><span class="sxs-lookup"><span data-stu-id="da3e6-173">Session consistency provides predictable consistency for a session, and maximum read throughput while offering the lowest latency writes and reads.</span></span> 
* <span data-ttu-id="da3e6-174">使用工作階段一致性設定的 Azure Cosmos DB 帳戶可以將任意數目的 Azure 區域關聯至它們的 Azure Cosmos DB 區域。</span><span class="sxs-lookup"><span data-stu-id="da3e6-174">Azure Cosmos DB accounts that are configured with session consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 
* <span data-ttu-id="da3e6-175">具有工作階段一致性的讀取作業成本 (就取用的 RU 而言) 會低於強式和限定過期，但高於最終一致性。</span><span class="sxs-lookup"><span data-stu-id="da3e6-175">The cost of a read operation (in terms of RUs consumed) with session consistency level is less than strong and bounded staleness, but more than eventual consistency</span></span>

<span data-ttu-id="da3e6-176"><a id="consistent-prefix"></a>
**一致前置詞**：</span><span class="sxs-lookup"><span data-stu-id="da3e6-176"><a id="consistent-prefix"></a>
**Consistent Prefix**:</span></span> 

* <span data-ttu-id="da3e6-177">一致前置詞保證之後如果沒有再收到任何寫入，群組內的複本最後會只剩一個。</span><span class="sxs-lookup"><span data-stu-id="da3e6-177">Consistent prefix guarantees that in absence of any further writes, the replicas within the group eventually converge.</span></span> 
* <span data-ttu-id="da3e6-178">一致前置詞保證讀取永遠不會看到沒有順序的寫入。</span><span class="sxs-lookup"><span data-stu-id="da3e6-178">Consistent prefix guarantees that reads never see out of order writes.</span></span> <span data-ttu-id="da3e6-179">如果寫入以 `A, B, C` 順序執行，則用戶端會看到 `A`、`A,B` 或 `A,B,C`，但是永遠不會看到沒有順序的情形，像是 `A,C` 或 `B,A,C`。</span><span class="sxs-lookup"><span data-stu-id="da3e6-179">If writes were performed in the order `A, B, C`, then a client sees either `A`, `A,B`, or `A,B,C`, but never out of order like `A,C` or `B,A,C`.</span></span>
* <span data-ttu-id="da3e6-180">使用一致前置詞一致性設定的 Azure Cosmos DB 帳戶可以將任意數目的 Azure 區域關聯至它們的 Azure Cosmos DB 區域。</span><span class="sxs-lookup"><span data-stu-id="da3e6-180">Azure Cosmos DB accounts that are configured with consistent prefix consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 

<span data-ttu-id="da3e6-181">**最終**：</span><span class="sxs-lookup"><span data-stu-id="da3e6-181">**Eventual**:</span></span> 

* <span data-ttu-id="da3e6-182">最終一致性保證之後如果沒有再收到任何寫入，群組內的複本最後會只剩一個。</span><span class="sxs-lookup"><span data-stu-id="da3e6-182">Eventual consistency guarantees that in absence of any further writes, the replicas within the group eventually converge.</span></span> 
* <span data-ttu-id="da3e6-183">最終一致性是最差的一致性形式，用戶端可能會取得比之前所看到的值還要舊的值。</span><span class="sxs-lookup"><span data-stu-id="da3e6-183">Eventual consistency is the weakest form of consistency where a client may get the values that are older than the ones it had seen before.</span></span>
* <span data-ttu-id="da3e6-184">「最終一致性」提供最差的讀取一致性，但是讀取和寫入的延遲皆是最低。</span><span class="sxs-lookup"><span data-stu-id="da3e6-184">Eventual consistency provides the weakest read consistency but offers the lowest latency for both reads and writes.</span></span>
* <span data-ttu-id="da3e6-185">使用最終一致性設定的 Azure Cosmos DB 帳戶可以將任意數目的 Azure 區域關聯至它們的 Azure Cosmos DB 區域。</span><span class="sxs-lookup"><span data-stu-id="da3e6-185">Azure Cosmos DB accounts that are configured with eventual consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 
* <span data-ttu-id="da3e6-186">具有最終一致性的讀取作業成本 (就取用的 RU 而言) 是所有 Azure Cosmos DB 一致性層級中最低的。</span><span class="sxs-lookup"><span data-stu-id="da3e6-186">The cost of a read operation (in terms of RUs consumed) with the eventual consistency level is the lowest of all the Azure Cosmos DB consistency levels.</span></span>

## <a name="configuring-the-default-consistency-level"></a><span data-ttu-id="da3e6-187">設定預設一致性層級</span><span class="sxs-lookup"><span data-stu-id="da3e6-187">Configuring the default consistency level</span></span>
1. <span data-ttu-id="da3e6-188">在 [Azure 入口網站](https://portal.azure.com/)的 Jumpbar 中，按一下 [Azure Cosmos DB]。</span><span class="sxs-lookup"><span data-stu-id="da3e6-188">In the [Azure portal](https://portal.azure.com/), in the Jumpbar, click **Azure Cosmos DB**.</span></span>
2. <span data-ttu-id="da3e6-189">在 [Azure Cosmos DB] 刀鋒視窗中，選取要修改的資料庫帳戶。</span><span class="sxs-lookup"><span data-stu-id="da3e6-189">In the **Azure Cosmos DB** blade, select the database account to modify.</span></span>
3. <span data-ttu-id="da3e6-190">在帳戶刀鋒視窗中，按一下 [預設一致性] 。</span><span class="sxs-lookup"><span data-stu-id="da3e6-190">In the account blade, click **Default consistency**.</span></span>
4. <span data-ttu-id="da3e6-191">在 [預設一致性] 刀鋒視窗中，選取新的一致性層級，然後按一下 [儲存]。</span><span class="sxs-lookup"><span data-stu-id="da3e6-191">In the **Default Consistency** blade, select the new consistency level and click **Save**.</span></span>
   
    ![此螢幕擷取畫面反白顯示 [設定] 圖示和 [預設一致性] 項目](./media/consistency-levels/database-consistency-level-1.png)

## <a name="consistency-levels-for-queries"></a><span data-ttu-id="da3e6-193">查詢的一致性層級</span><span class="sxs-lookup"><span data-stu-id="da3e6-193">Consistency levels for queries</span></span>
<span data-ttu-id="da3e6-194">根據預設，針對使用者定義的資源，查詢的一致性層級會與讀取的一致性層級相同。</span><span class="sxs-lookup"><span data-stu-id="da3e6-194">By default, for user-defined resources, the consistency level for queries is the same as the consistency level for reads.</span></span> <span data-ttu-id="da3e6-195">每次在集合中插入、取代或刪除項目時，預設會同步更新索引到 Cosmos DB 容器。</span><span class="sxs-lookup"><span data-stu-id="da3e6-195">By default, the index is updated synchronously on each insert, replace, or delete of an item to the Cosmos DB container.</span></span> <span data-ttu-id="da3e6-196">這個行為讓查詢能夠使用與點的讀取相同的一致性層級。</span><span class="sxs-lookup"><span data-stu-id="da3e6-196">This enables the queries to honor the same consistency level as that of point reads.</span></span> <span data-ttu-id="da3e6-197">雖然 Azure Cosmos DB 的寫入已經過最佳化處理，並支援持續的寫入數量、同步索引維護，以及提供一致的查詢，但您還是可以設定特定集合，讓集合的索引更新速度變慢。</span><span class="sxs-lookup"><span data-stu-id="da3e6-197">While Azure Cosmos DB is write optimized and supports sustained volumes of writes, synchronous index maintenance and serving consistent queries, you can configure certain collections to update their index lazily.</span></span> <span data-ttu-id="da3e6-198">讓索引速度變慢可提升寫入效能，而且適合用於工作負載主要是進行大量讀取的大量擷取案例。</span><span class="sxs-lookup"><span data-stu-id="da3e6-198">Lazy indexing further boosts the write performance and is ideal for bulk ingestion scenarios when a workload is primarily read-heavy.</span></span>  

| <span data-ttu-id="da3e6-199">索引模式</span><span class="sxs-lookup"><span data-stu-id="da3e6-199">Indexing Mode</span></span> | <span data-ttu-id="da3e6-200">讀取</span><span class="sxs-lookup"><span data-stu-id="da3e6-200">Reads</span></span> | <span data-ttu-id="da3e6-201">查詢</span><span class="sxs-lookup"><span data-stu-id="da3e6-201">Queries</span></span> |
| --- | --- | --- |
| <span data-ttu-id="da3e6-202">一致 (預設)</span><span class="sxs-lookup"><span data-stu-id="da3e6-202">Consistent (default)</span></span> |<span data-ttu-id="da3e6-203">從強式、限定過期、工作階段、一致前置詞或最終等選項中選取</span><span class="sxs-lookup"><span data-stu-id="da3e6-203">Select from strong, bounded staleness, session, consistent prefix, or eventual</span></span> |<span data-ttu-id="da3e6-204">從強式、限定過期、工作階段或最終等選項中選取</span><span class="sxs-lookup"><span data-stu-id="da3e6-204">Select from strong, bounded staleness, session, or eventual</span></span> |
| <span data-ttu-id="da3e6-205">緩慢</span><span class="sxs-lookup"><span data-stu-id="da3e6-205">Lazy</span></span> |<span data-ttu-id="da3e6-206">從強式、限定過期、工作階段、一致前置詞或最終等選項中選取</span><span class="sxs-lookup"><span data-stu-id="da3e6-206">Select from strong, bounded staleness, session, consistent prefix, or eventual</span></span> |<span data-ttu-id="da3e6-207">最終</span><span class="sxs-lookup"><span data-stu-id="da3e6-207">Eventual</span></span> |
| <span data-ttu-id="da3e6-208">None</span><span class="sxs-lookup"><span data-stu-id="da3e6-208">None</span></span> |<span data-ttu-id="da3e6-209">從強式、限定過期、工作階段、一致前置詞或最終等選項中選取</span><span class="sxs-lookup"><span data-stu-id="da3e6-209">Select from strong, bounded staleness, session, consistent prefix, or eventual</span></span> |<span data-ttu-id="da3e6-210">不適用</span><span class="sxs-lookup"><span data-stu-id="da3e6-210">Not applicable</span></span> |

<span data-ttu-id="da3e6-211">和讀取要求相同，您可以在每個 API 中降低特定查詢要求的一致性層級。</span><span class="sxs-lookup"><span data-stu-id="da3e6-211">As with read requests, you can lower the consistency level of a specific query request in each API.</span></span>

## <a name="next-steps"></a><span data-ttu-id="da3e6-212">後續步驟</span><span class="sxs-lookup"><span data-stu-id="da3e6-212">Next steps</span></span>
<span data-ttu-id="da3e6-213">如果您想要詳細了解一致性層級和取捨，我們建議下列資源：</span><span class="sxs-lookup"><span data-stu-id="da3e6-213">If you'd like to do more reading about consistency levels and tradeoffs, we recommend the following resources:</span></span>

* <span data-ttu-id="da3e6-214">Doug Terry。</span><span class="sxs-lookup"><span data-stu-id="da3e6-214">Doug Terry.</span></span> <span data-ttu-id="da3e6-215">透過棒球來解說複寫的資料一致性 (影片)。</span><span class="sxs-lookup"><span data-stu-id="da3e6-215">Replicated Data Consistency explained through baseball (video).</span></span>   
  [<span data-ttu-id="da3e6-216">https://www.youtube.com/watch?v=gluIh8zd26I</span><span class="sxs-lookup"><span data-stu-id="da3e6-216">https://www.youtube.com/watch?v=gluIh8zd26I</span></span>](https://www.youtube.com/watch?v=gluIh8zd26I)
* <span data-ttu-id="da3e6-217">Doug Terry。</span><span class="sxs-lookup"><span data-stu-id="da3e6-217">Doug Terry.</span></span> <span data-ttu-id="da3e6-218">透過棒球來解說複寫的資料一致性。</span><span class="sxs-lookup"><span data-stu-id="da3e6-218">Replicated Data Consistency explained through baseball.</span></span>   
  [<span data-ttu-id="da3e6-219">http://research.microsoft.com/pubs/157411/ConsistencyAndBaseballReport.pdf</span><span class="sxs-lookup"><span data-stu-id="da3e6-219">http://research.microsoft.com/pubs/157411/ConsistencyAndBaseballReport.pdf</span></span>](http://research.microsoft.com/pubs/157411/ConsistencyAndBaseballReport.pdf)
* <span data-ttu-id="da3e6-220">Doug Terry。</span><span class="sxs-lookup"><span data-stu-id="da3e6-220">Doug Terry.</span></span> <span data-ttu-id="da3e6-221">弱式一致複寫資料的工作階段保證。</span><span class="sxs-lookup"><span data-stu-id="da3e6-221">Session Guarantees for Weakly Consistent Replicated Data.</span></span>   
  [<span data-ttu-id="da3e6-222">http://dl.acm.org/citation.cfm?id=383631</span><span class="sxs-lookup"><span data-stu-id="da3e6-222">http://dl.acm.org/citation.cfm?id=383631</span></span>](http://dl.acm.org/citation.cfm?id=383631)
* <span data-ttu-id="da3e6-223">Daniel Abadi。</span><span class="sxs-lookup"><span data-stu-id="da3e6-223">Daniel Abadi.</span></span> <span data-ttu-id="da3e6-224">現代分散式資料庫系統設計的一致性取捨：CAP 是整個過程中的唯一解決方案」。</span><span class="sxs-lookup"><span data-stu-id="da3e6-224">Consistency Tradeoffs in Modern Distributed Database Systems Design: CAP is only part of the story”.</span></span>   
  [<span data-ttu-id="da3e6-225">http://computer.org/csdl/mags/co/2012/02/mco2012020037-abs.html</span><span class="sxs-lookup"><span data-stu-id="da3e6-225">http://computer.org/csdl/mags/co/2012/02/mco2012020037-abs.html</span></span>](http://computer.org/csdl/mags/co/2012/02/mco2012020037-abs.html)
* <span data-ttu-id="da3e6-226">Peter Bailis、Shivaram Venkataraman、Michael J. Franklin、Joseph M. Hellerstein、Ion Stoica。</span><span class="sxs-lookup"><span data-stu-id="da3e6-226">Peter Bailis, Shivaram Venkataraman, Michael J. Franklin, Joseph M. Hellerstein, Ion Stoica.</span></span> <span data-ttu-id="da3e6-227">實際部分仲裁的機率界限-陳舊 (PBS)。</span><span class="sxs-lookup"><span data-stu-id="da3e6-227">Probabilistic Bounded Staleness (PBS) for Practical Partial Quorums.</span></span>   
  [<span data-ttu-id="da3e6-228">http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf</span><span class="sxs-lookup"><span data-stu-id="da3e6-228">http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf</span></span>](http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf)
* <span data-ttu-id="da3e6-229">Werner Vogels。</span><span class="sxs-lookup"><span data-stu-id="da3e6-229">Werner Vogels.</span></span> <span data-ttu-id="da3e6-230">再論最終一致。</span><span class="sxs-lookup"><span data-stu-id="da3e6-230">Eventual Consistent - Revisited.</span></span>    
  [<span data-ttu-id="da3e6-231">http://allthingsdistributed.com/2008/12/eventually_consistent.html</span><span class="sxs-lookup"><span data-stu-id="da3e6-231">http://allthingsdistributed.com/2008/12/eventually_consistent.html</span></span>](http://allthingsdistributed.com/2008/12/eventually_consistent.html)
* <span data-ttu-id="da3e6-232">Moni Naor、Avishai Wool，仲裁系統的負載、容量及可用性，SIAM 計算期刊，v.27 n.2，p.423-447，1998 年 4 月。</span><span class="sxs-lookup"><span data-stu-id="da3e6-232">Moni Naor , Avishai Wool, The Load, Capacity, and Availability of Quorum Systems, SIAM Journal on Computing, v.27 n.2, p.423-447, April 1998.</span></span>
  [<span data-ttu-id="da3e6-233">http://epubs.siam.org/doi/abs/10.1137/S0097539795281232</span><span class="sxs-lookup"><span data-stu-id="da3e6-233">http://epubs.siam.org/doi/abs/10.1137/S0097539795281232</span></span>](http://epubs.siam.org/doi/abs/10.1137/S0097539795281232)
* <span data-ttu-id="da3e6-234">Sebastian Burckhardt，Chris Dern，Macanal Musuvathi，Roy Tan，陣容：完整和自動的線性化能力檢查程式，程式設計語言設計和實作的 2010 ACM SIGPLAN 會議論文集，2010 年 6 月 05-10 日，加拿大，安大略，多倫多 [doi>10.1145/1806596.1806634] [http://dl.acm.org/citation.cfm?id=1806634](http://dl.acm.org/citation.cfm?id=1806634)</span><span class="sxs-lookup"><span data-stu-id="da3e6-234">Sebastian Burckhardt, Chris Dern, Macanal Musuvathi, Roy Tan, Line-up: a complete and automatic linearizability checker, Proceedings of the 2010 ACM SIGPLAN conference on Programming language design and implementation, June 05-10, 2010, Toronto, Ontario, Canada  [doi>10.1145/1806596.1806634] [http://dl.acm.org/citation.cfm?id=1806634](http://dl.acm.org/citation.cfm?id=1806634)</span></span>
* <span data-ttu-id="da3e6-235">Peter Bailis，Shivaram Venkataraman，Michael J. Franklin，Joseph M. Hellerstein，Ion Stoica，實用部分仲裁的概率限定過期，VLDB Endowment 論文集，v.5 n.8，p.776-787，2012 年 4 月 [http://dl.acm.org/citation.cfm?id=2212359](http://dl.acm.org/citation.cfm?id=2212359)</span><span class="sxs-lookup"><span data-stu-id="da3e6-235">Peter Bailis, Shivaram Venkataraman, Michael J. Franklin, Joseph M. Hellerstein , Ion Stoica, Probabilistically bounded staleness for practical partial quorums, Proceedings of the VLDB Endowment, v.5 n.8, p.776-787, April 2012 [http://dl.acm.org/citation.cfm?id=2212359](http://dl.acm.org/citation.cfm?id=2212359)</span></span>
