---
title: "aaaOnline 利用 Azure Cosmos DB 備份和還原 |Microsoft 文件"
description: "深入了解如何 tooperform 自動備份和還原 Azure Cosmos DB 資料庫上。"
keywords: "備份與還原, 線上備份"
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/11/2017
ms.author: raprasa
ms.openlocfilehash: a0b464c95681dfc7b5462b02bf04c2c43d6bc16f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a><span data-ttu-id="1a4fe-104">使用 Azure Cosmos DB 進行自動線上備份及還原</span><span class="sxs-lookup"><span data-stu-id="1a4fe-104">Automatic online backup and restore with Azure Cosmos DB</span></span>
<span data-ttu-id="1a4fe-105">Azure Cosmos DB 可以定期自動備份您的所有資料。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span></span> <span data-ttu-id="1a4fe-106">hello 自動備份而不會影響 hello 效能或可用性資料庫作業。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-106">hello automatic backups are taken without affecting hello performance or availability of your database operations.</span></span> <span data-ttu-id="1a4fe-107">所有備份會儲存在另一個儲存體服務中，而且這些備份會全域複寫用於為區域性災害提供復原功能。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="1a4fe-108">當您不小心刪除 Comos DB 容器，而稍後需要資料復原或災害復原解決方案 hello 自動備份適用於案例。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-108">hello automatic backups are intended for scenarios when you accidentally delete your Comos DB container and later require data recovery or a disaster recovery solution.</span></span>  

<span data-ttu-id="1a4fe-109">本文章重述的 hello 資料備援和可用性 Cosmos DB 中的開頭，並接著討論備份。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-109">This article starts with a quick recap of hello data redundancy and availability in Cosmos DB, and then discusses backups.</span></span> 

## <a name="high-availability-with-cosmos-db---a-recap"></a><span data-ttu-id="1a4fe-110">Cosmos DB 的高可用性 - 回顧</span><span class="sxs-lookup"><span data-stu-id="1a4fe-110">High availability with Cosmos DB - a recap</span></span>
<span data-ttu-id="1a4fe-111">Cosmos DB 是設計的 toobe[分散](distribute-data-globally.md)– 可讓您 tooscale 輸送量到多個 Azure 區域，以及原則導向容錯移轉和透明多路連接的應用程式開發介面。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-111">Cosmos DB is designed toobe [globally distributed](distribute-data-globally.md) – it allows you tooscale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span></span> <span data-ttu-id="1a4fe-112">資料庫系統供應項目為[99.99%可用性 Sla](https://azure.microsoft.com/support/legal/sla/cosmos-db)，Cosmos DB 中的所有 hello 寫入都都由本機資料中心內的複本的仲裁內容經過永久認可的 toolocal 磁碟之前認可 toohello 用戶端。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-112">As a database system offering [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db), all hello writes in Cosmos DB are durably committed toolocal disks by a quorum of replicas within a local data center before acknowledging toohello client.</span></span> <span data-ttu-id="1a4fe-113">請注意 hello 高可用性的 Cosmos DB 依賴本機儲存體，而不需依賴任何外部儲存體技術。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-113">Note that hello high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span></span> <span data-ttu-id="1a4fe-114">此外，如果您的資料庫帳戶與多個 Azure 區域相關聯，您的寫入也會在其他區域複寫。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-114">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span></span> <span data-ttu-id="1a4fe-115">tooscale 在低延遲的輸送量和存取資料，您可以有許多讀取要與您的資料庫帳戶相關聯的區域。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-115">tooscale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span></span> <span data-ttu-id="1a4fe-116">每個讀取區域 hello （複寫） 資料永久保存複本組中。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-116">In each read region, hello (replicated) data is durably persisted across a replica set.</span></span>  

<span data-ttu-id="1a4fe-117">Hello 下列圖表所示，單一 Cosmos DB 容器是[水平分割](partition-data.md)。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-117">As illustrated in hello following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span></span> <span data-ttu-id="1a4fe-118">「 分割 」 會在下列圖表中的 hello 圓圈來標註，且每個資料分割會產生複本集透過高可用性。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-118">A “partition” is denoted by a circle in hello following diagram, and each partition is made highly available via a replica set.</span></span> <span data-ttu-id="1a4fe-119">這是在單一 Azure 區域 （以 hello X 軸表示） 的 hello 本機發佈。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-119">This is hello local distribution within a single Azure region (denoted by hello X axis).</span></span> <span data-ttu-id="1a4fe-120">此外，每個資料分割 （使用其對應的複本集） 然後會全域發佈到您的資料庫帳戶 （例如，在此圖 hello 三個區域 – 美國東部、 美國西部和印度中部） 相關聯的多個區域。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-120">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration hello three regions – East US, West US and Central India).</span></span> <span data-ttu-id="1a4fe-121">hello 「 資料分割集 」 是全域散發實體組成的多個複本 （hello Y 軸所表示） 的每個區域中的資料。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-121">hello “partition set” is a globally distributed entity comprising of multiple copies of your data in each region (denoted by hello Y axis).</span></span> <span data-ttu-id="1a4fe-122">您可以將優先順序指派 toohello 區域與您的資料庫帳戶相關聯，而且 Cosmos DB 以透明的方式將容錯移轉 toohello 下一個區域發生嚴重損壞。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-122">You can assign priority toohello regions associated with your database account and Cosmos DB will transparently failover toohello next region in case of disaster.</span></span> <span data-ttu-id="1a4fe-123">您也可以手動可以模擬容錯移轉 tootest hello 端對端應用程式可用性。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-123">You can also manually simulate failover tootest hello end-to-end availability of your application.</span></span>  

<span data-ttu-id="1a4fe-124">hello 圖顯示高度以 Cosmos DB 備援 hello。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-124">hello following image illustrates hello high degree of redundancy with Cosmos DB.</span></span>

![Cosmos DB 的高度備援性](./media/online-backup-and-restore/redundancy.png)

![Cosmos DB 的高度備援性](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a><span data-ttu-id="1a4fe-127">完整自動線上備份</span><span class="sxs-lookup"><span data-stu-id="1a4fe-127">Full, automatic, online backups</span></span>
<span data-ttu-id="1a4fe-128">糟糕，我刪掉容器或資料庫了！</span><span class="sxs-lookup"><span data-stu-id="1a4fe-128">Oops, I deleted my container or database!</span></span> <span data-ttu-id="1a4fe-129">以 Cosmos DB 不僅資料，但是 hello 備份資料也會有高備援和恢復功能 tooregional 損毀。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-129">With Cosmos DB, not only your data, but hello backups of your data are also made highly redundant and resilient tooregional disasters.</span></span> <span data-ttu-id="1a4fe-130">目前，這些自動化備份大約每四個小時備份一次，並隨時儲存 2 個最新的備份。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-130">These automated backups are currently taken approximately every four hours and latest 2 backups are stored at all times.</span></span> <span data-ttu-id="1a4fe-131">如果 hello 資料意外卸除或損毀，請[連絡 Azure 支援](https://azure.microsoft.com/support/options/)8 小時內。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-131">If hello data is accidently dropped or corrupted, please [contact Azure support](https://azure.microsoft.com/support/options/) within 8 hours.</span></span> 

<span data-ttu-id="1a4fe-132">hello 備份而不會影響 hello 效能或可用性資料庫作業。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-132">hello backups are taken without affecting hello performance or availability of your database operations.</span></span> <span data-ttu-id="1a4fe-133">Cosmos DB hello 背景會 hello 備份，而不需要使用您已佈建之俄文或 hello 效能影響，而不影響 hello 可用性資料庫。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-133">Cosmos DB takes hello backup in hello background without consuming your provisioned RUs or affecting hello performance and without affecting hello availability of your database.</span></span> 

<span data-ttu-id="1a4fe-134">不同於您儲存 Cosmos DB 內部的資料，hello 自動備份會儲存在 Azure Blob 儲存體服務。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-134">Unlike your data that is stored inside Cosmos DB, hello automatic backups are stored in Azure Blob Storage service.</span></span> <span data-ttu-id="1a4fe-135">tooguarantee hello 低效率延遲/上載 hello 快照集的備份是上傳的 tooan 執行個體，Azure Blob 儲存體中的 hello 與 hello 目前寫入區域 Cosmos DB 資料庫帳戶的相同的區域。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-135">tooguarantee hello low latency/efficient upload, hello snapshot of your backup is uploaded tooan instance of Azure Blob storage in hello same region as hello current write region of your Cosmos DB database account.</span></span> <span data-ttu-id="1a4fe-136">針對地區的災害復原時，備份資料 Azure Blob 儲存體中的每個快照集是一次複寫透過地理備援儲存體 (GRS) tooanother 區域。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-136">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) tooanother region.</span></span> <span data-ttu-id="1a4fe-137">hello 下列圖表顯示 hello 整個 Cosmos DB 容器 （具有所有三個主要磁碟分割在美國西部，在此範例中） 備份到遠端的 Azure Blob 儲存體帳戶，在美國西部然後 GRS 複寫 tooEast 我們。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-137">hello following diagram shows that hello entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated tooEast US.</span></span> 

<span data-ttu-id="1a4fe-138">hello 下列影像說明 GRS Azure 儲存體中的所有 Cosmos DB 實體的定期完整備份。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-138">hello following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span></span>

![GRS Azure 儲存體中所有 Cosmos DB 實體的定期完整備份](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a><span data-ttu-id="1a4fe-140">備份保留期限</span><span class="sxs-lookup"><span data-stu-id="1a4fe-140">Backup retention period</span></span>
<span data-ttu-id="1a4fe-141">如上面所述，Azure Cosmos DB 每四個小時會採用您資料的快照集，並保留 30 天 hello 的每個資料分割的最後兩個快照集。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-141">As described above, Azure Cosmos DB takes snapshots of your data every four hours and retains hello last two snapshots of every partition for 30 days.</span></span> <span data-ttu-id="1a4fe-142">依我們的合規性規定，會在 90 天後清除快照集。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-142">Per our compliance regulations, snapshots are purged after 90 days.</span></span>

<span data-ttu-id="1a4fe-143">如果您想 toomaintain 您自己的快照集，您可以使用 hello 匯出 tooJSON 選項在 hello Azure Cosmos DB[資料移轉工具](import-data.md#export-to-json-file)tooschedule 其他備份。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-143">If you want toomaintain your own snapshots, you can use hello export tooJSON option in hello Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) tooschedule additional backups.</span></span> 

## <a name="restoring-a-database-from-an-online-backup"></a><span data-ttu-id="1a4fe-144">從線上備份還原資料庫</span><span class="sxs-lookup"><span data-stu-id="1a4fe-144">Restoring a database from an online backup</span></span>
<span data-ttu-id="1a4fe-145">如果您不小心刪除您的資料庫或集合，您可以[提出支援票證](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade)或[連絡 Azure 支援](https://azure.microsoft.com/support/options/)toorestore hello hello 最後一次自動備份的資料。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-145">If you accidentally delete your database or collection, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) toorestore hello data from hello last automatic backup.</span></span> <span data-ttu-id="1a4fe-146">如果您需要 toorestore 資料庫因為資料損毀問題，請參閱[處理資料損毀](#handling-data-corruption)tootake 其他所需步驟從穿透 hello 備份 tooprevent hello 損毀資料。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-146">If you need toorestore your database because of data corruption issue, see [Handling data corruption](#handling-data-corruption) as you need tootake additional steps tooprevent hello corrupted data from penetrating hello backups.</span></span> <span data-ttu-id="1a4fe-147">還原您備份 toobe 是特定快照集，Cosmos DB 需要 hello 資料無法 hello hello 該快照集備份週期期間。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-147">For a specific snapshot of your backup toobe restored, Cosmos DB requires that hello data was available for hello duration of hello backup cycle for that snapshot.</span></span>

## <a name="handling-data-corruption"></a><span data-ttu-id="1a4fe-148">處理資料損毀</span><span class="sxs-lookup"><span data-stu-id="1a4fe-148">Handling data corruption</span></span>
<span data-ttu-id="1a4fe-149">Azure Cosmos DB hello 系統中保留 hello 的每個資料分割的最後兩個備份。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-149">Azure Cosmos DB retains hello last two backups of every partition in hello system.</span></span> <span data-ttu-id="1a4fe-150">（的文件、 圖形、 表格集合） 的容器或資料庫意外刪除，因為其中一個 hello 最後一個版本可以還原時，非常適合此模型。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-150">This model works very well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of hello last versions can be restored.</span></span> <span data-ttu-id="1a4fe-151">不過，hello 的情況下如果當使用者可能會造成資料損毀問題，Azure Cosmos DB 可能不知道 hello 資料損毀，並就有可能在 hello 損毀，可能會有滲入 hello 備份。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-151">However, in hello case when when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of hello data corruption, and it is possible that hello corruption may have penetrated hello backups.</span></span> <span data-ttu-id="1a4fe-152">一旦偵測到損毀，您應該刪除損毀的 hello 容器 （集合/圖表/資料表），因此備份已損毀的資料遭到覆寫受到保護。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-152">As soon as corruption is detected, you should delete hello corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span></span> <span data-ttu-id="1a4fe-153">因為 hello 最後一個備份可能是四個小時，可以運用 hello 使用者[變更摘要](change-feed.md)toocapture 和市集 hello 最後四個小時的資料之前刪除 hello 容器。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-153">Since hello last backup could be four hours old, hello user can employ [change feed](change-feed.md) toocapture and store hello last four hours worth of data before deleting hello container.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1a4fe-154">後續步驟</span><span class="sxs-lookup"><span data-stu-id="1a4fe-154">Next steps</span></span>

<span data-ttu-id="1a4fe-155">tooreplicate 資料庫中多個資料中心，請參閱[分散您的資料以 Cosmos DB 全域](distribute-data-globally.md)。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-155">tooreplicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span></span> 

<span data-ttu-id="1a4fe-156">toofile 連絡 Azure 支援人員，[檔案 hello Azure 入口網站票證](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade)。</span><span class="sxs-lookup"><span data-stu-id="1a4fe-156">toofile contact Azure Support, [file a ticket from hello Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span></span>

