---
title: "使用 Azure Cosmos DB 全域散發資料 | Microsoft Docs"
description: "了解如何從 Azure Cosmos DB (全域散發的多模型資料庫服務)，使用全域資料庫進行全球規模的異地複寫、容錯移轉及資料復原。"
services: cosmos-db
documentationcenter: 
author: arramac
manager: jhubbard
editor: 
ms.assetid: ba5ad0cc-aa1f-4f40-aee9-3364af070725
ms.service: cosmos-db
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/14/2017
ms.author: arramac
ms.openlocfilehash: da2cb358d196e41656bd7f6a06ff77e77c7315c1
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/03/2017
---
# <a name="how-to-distribute-data-globally-with-azure-cosmos-db"></a><span data-ttu-id="51f05-103">如何使用 Azure Cosmos DB 全域散發資料</span><span class="sxs-lookup"><span data-stu-id="51f05-103">How to distribute data globally with Azure Cosmos DB</span></span>
<span data-ttu-id="51f05-104">Azure 無所不在 - 跨 30 多個地理區域，遍佈全球並持續擴充中。</span><span class="sxs-lookup"><span data-stu-id="51f05-104">Azure is ubiquitous - it has a global footprint across 30+ geographical regions and is continuously expanding.</span></span> <span data-ttu-id="51f05-105">遍及全球的 Azure 提供給開發人員的其中一項差異化功能，就是能夠輕鬆地建置、部署及管理分散在世界各地的應用程式。</span><span class="sxs-lookup"><span data-stu-id="51f05-105">With its worldwide presence, one of the differentiated capabilities Azure offers to its developers is the ability to build, deploy, and manage globally distributed applications easily.</span></span> 

<span data-ttu-id="51f05-106">[Azure Cosmos DB](../cosmos-db/introduction.md) 是 Microsoft 全域散發的多模型資料庫服務，適用於任務關鍵性應用程式。</span><span class="sxs-lookup"><span data-stu-id="51f05-106">[Azure Cosmos DB](../cosmos-db/introduction.md) is Microsoft's globally distributed, multi-model database service for mission-critical applications.</span></span> <span data-ttu-id="51f05-107">Azure Cosmos DB 提供周全的全域散發、全球[彈性調整的輸送量和儲存體](../cosmos-db/partition-data.md)、達到第 99 個百分位數的個位數毫秒延遲、[五個定義完善的一致性層級](consistency-levels.md)，以及保證的高可用性，全部都由[領先業界的 SLA](https://azure.microsoft.com/support/legal/sla/cosmos-db/) 所支援。</span><span class="sxs-lookup"><span data-stu-id="51f05-107">Azure Cosmos DB provides turnkey global distribution, [elastic scaling of throughput and storage](../cosmos-db/partition-data.md) worldwide, single-digit millisecond latencies at the 99th percentile, [five well-defined consistency levels](consistency-levels.md), and guaranteed high availability, all backed by [industry-leading SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db/).</span></span> <span data-ttu-id="51f05-108">Azure Cosmos DB 會[自動編製資料的索引](http://www.vldb.org/pvldb/vol8/p1668-shukla.pdf)，您不需要處理結構描述和索引管理。</span><span class="sxs-lookup"><span data-stu-id="51f05-108">Azure Cosmos DB [automatically indexes data](http://www.vldb.org/pvldb/vol8/p1668-shukla.pdf) without requiring you to deal with schema and index management.</span></span> <span data-ttu-id="51f05-109">它是多重模型，可支援文件、索引鍵/值、圖表和單欄式資料模型。</span><span class="sxs-lookup"><span data-stu-id="51f05-109">It is multi-model and supports document, key-value, graph, and columnar data models.</span></span> <span data-ttu-id="51f05-110">Azure Cosmos DB 是經過仔細工程設計的全新雲端服務，可供多租用戶使用和提供全域散發功能。</span><span class="sxs-lookup"><span data-stu-id="51f05-110">As a cloud-born service, Azure Cosmos DB is carefully engineered with multi-tenancy and global distribution from the ground up.</span></span>

<span data-ttu-id="51f05-111">**分割並散發在多個 Azure 區域的單一 Azure Cosmos DB 集合**</span><span class="sxs-lookup"><span data-stu-id="51f05-111">**A single Azure Cosmos DB collection partitioned and distributed across multiple Azure regions**</span></span>

![分割並散發在三個區域的 Azure Cosmos DB 集合](./media/distribute-data-globally/global-apps.png)

<span data-ttu-id="51f05-113">如我們在建置 Azure Cosmos DB 時所知，當務之急是新增全域散發功能，而不能只將它放在「單一網站」資料庫系統上。</span><span class="sxs-lookup"><span data-stu-id="51f05-113">As we have learned while building Azure Cosmos DB, adding global distribution cannot be an afterthought - it cannot be "bolted-on" atop a "single site" database system.</span></span> <span data-ttu-id="51f05-114">全域分散式資料庫提供的功能遠遠超越「單一網站」資料庫提供的傳統地理災害復原 (Geo-DR) 功能。</span><span class="sxs-lookup"><span data-stu-id="51f05-114">The capabilities offered by a globally distributed database span beyond that of traditional geographical disaster recovery (Geo-DR) offered by "single-site" databases.</span></span> <span data-ttu-id="51f05-115">提供 Geo-DR 功能的單一網站資料庫是分散在世界各地的資料庫嚴格子集。</span><span class="sxs-lookup"><span data-stu-id="51f05-115">Single site databases offering Geo-DR capability are a strict subset of globally distributed databases.</span></span> 

<span data-ttu-id="51f05-116">使用 Azure Cosmos DB 周全的全域散發功能，藉由在資料庫記錄上採用 Lambda 模式 (例如，[AWS DynamoDB 複寫 (英文)](https://github.com/awslabs/dynamodb-cross-region-library/blob/master/README.md))，或跨多個區域執行「重複寫入」，開發人員就不必建置自己的複寫結構。</span><span class="sxs-lookup"><span data-stu-id="51f05-116">With Azure Cosmos DB's turnkey global distribution, developers do not have to build their own replication scaffolding by employing either the Lambda pattern (for example, [AWS DynamoDB replication](https://github.com/awslabs/dynamodb-cross-region-library/blob/master/README.md)) over the database log or by doing "double writes" across multiple regions.</span></span> <span data-ttu-id="51f05-117">由於無法確保這類方法的正確性，並提供健全的 SLA，因此我們不建議使用這些方法。</span><span class="sxs-lookup"><span data-stu-id="51f05-117">We do not recommend these approaches since it is impossible to ensure correctness of such approaches and provide sound SLAs.</span></span> 

<span data-ttu-id="51f05-118">在本文中，我們提供 Azure Cosmos DB 的全域散發功能概觀。</span><span class="sxs-lookup"><span data-stu-id="51f05-118">In this article, we provide an overview of Azure Cosmos DB's global distribution capabilities.</span></span> <span data-ttu-id="51f05-119">我們也會說明 Azure Cosmos DB 唯一能提供完整 SLA 的方法。</span><span class="sxs-lookup"><span data-stu-id="51f05-119">We also describe Azure Cosmos DB's unique approach to providing comprehensive SLAs.</span></span> 

## <span data-ttu-id="51f05-120"><a id="EnableGlobalDistribution"></a>啟用周全的全域散發</span><span class="sxs-lookup"><span data-stu-id="51f05-120"><a id="EnableGlobalDistribution"></a>Enabling turnkey global distribution</span></span>
<span data-ttu-id="51f05-121">Azure Cosmos DB 提供下列功能，讓您輕鬆地撰寫全球規模的應用程式。</span><span class="sxs-lookup"><span data-stu-id="51f05-121">Azure Cosmos DB provides the following capabilities to enable you to easily write planet scale applications.</span></span> <span data-ttu-id="51f05-122">透過 Azure Cosmos DB 的資源提供者型 [REST API](https://docs.microsoft.com/rest/api/documentdbresourceprovider/) 和 Azure 入口網站，即可使用這些功能。</span><span class="sxs-lookup"><span data-stu-id="51f05-122">These capabilities are available via the Azure Cosmos DB's resource provider-based [REST APIs](https://docs.microsoft.com/rest/api/documentdbresourceprovider/) as well as the Azure portal.</span></span>

### <span data-ttu-id="51f05-123"><a id="RegionalPresence"></a>遍及各區，無所不在</span><span class="sxs-lookup"><span data-stu-id="51f05-123"><a id="RegionalPresence"></a>Ubiquitous regional presence</span></span> 
<span data-ttu-id="51f05-124">Azure 透過不斷連上[新的地理區域](https://azure.microsoft.com/regions/)，而日益普及。</span><span class="sxs-lookup"><span data-stu-id="51f05-124">Azure is constantly growing its geographical presence by bringing [new regions](https://azure.microsoft.com/regions/) online.</span></span> <span data-ttu-id="51f05-125">根據預設，新的 Azure 區域全部都可使用 Azure Cosmos DB。</span><span class="sxs-lookup"><span data-stu-id="51f05-125">Azure Cosmos DB is available in all new Azure regions by default.</span></span> <span data-ttu-id="51f05-126">一旦 Azure 為企業開啟新的區域，這就能讓您將地理區域關聯至 Azure Cosmos DB 資料庫帳戶。</span><span class="sxs-lookup"><span data-stu-id="51f05-126">This allows you to associate a geographical region with your Azure Cosmos DB database account as soon as Azure opens the new region for business.</span></span>

<span data-ttu-id="51f05-127">**新的 Azure 區域預設全部都可使用 Azure Cosmos DB**</span><span class="sxs-lookup"><span data-stu-id="51f05-127">**Azure Cosmos DB is available in all Azure regions by default**</span></span>

![新的 Azure 區域全部都可使用 Azure Cosmos DB](./media/distribute-data-globally/azure-regions.png)

### <span data-ttu-id="51f05-129"><a id="UnlimitedRegionsPerAccount"></a>將數目不拘的區域與您的 Azure Cosmos DB 資料庫帳戶產生關聯</span><span class="sxs-lookup"><span data-stu-id="51f05-129"><a id="UnlimitedRegionsPerAccount"></a>Associating an unlimited number of regions with your Azure Cosmos DB database account</span></span>
<span data-ttu-id="51f05-130">Azure Cosmos DB 可讓您將任何數目的 Azure 區域與您的 Azure Cosmos DB 資料庫帳戶產生關聯。</span><span class="sxs-lookup"><span data-stu-id="51f05-130">Azure Cosmos DB allows you to associate any number of Azure regions with your Azure Cosmos DB database account.</span></span> <span data-ttu-id="51f05-131">除了異地隔離限制 (例如中國、德國) 之外，可和 Azure Cosmos DB 資料庫帳戶產生關聯的區域數沒有限制。</span><span class="sxs-lookup"><span data-stu-id="51f05-131">Outside of geo-fencing restrictions (for example, China, Germany), there are no limitations on the number of regions that can be associated with your Azure Cosmos DB database account.</span></span> <span data-ttu-id="51f05-132">下圖顯示設定為橫跨 25 個 Azure 區域的資料庫帳戶。</span><span class="sxs-lookup"><span data-stu-id="51f05-132">The following figure shows a database account configured to span across 25 Azure regions.</span></span>  

<span data-ttu-id="51f05-133">**橫跨 25 個 Azure 區域的租用戶 Azure Cosmos DB 資料庫帳戶**</span><span class="sxs-lookup"><span data-stu-id="51f05-133">**A tenant's Azure Cosmos DB database account spanning 25 Azure regions**</span></span>

![橫跨 25 個 Azure 區域的 Azure Cosmos DB 資料庫帳戶](./media/distribute-data-globally/spanning-regions.png)

### <span data-ttu-id="51f05-135"><a id="PolicyBasedGeoFencing"></a>原則式異地隔離限制</span><span class="sxs-lookup"><span data-stu-id="51f05-135"><a id="PolicyBasedGeoFencing"></a>Policy-based geo-fencing</span></span>
<span data-ttu-id="51f05-136">Azure Cosmos DB 是設計來取得原則式異地隔離功能。</span><span class="sxs-lookup"><span data-stu-id="51f05-136">Azure Cosmos DB is designed to have policy-based geo-fencing capabilities.</span></span> <span data-ttu-id="51f05-137">異地隔離這個重要元件可確保資料管理和法規遵循限制，並防止特定地區與您的帳戶產生關聯。</span><span class="sxs-lookup"><span data-stu-id="51f05-137">Geo-fencing is an important component to ensure data governance and compliance restrictions and may prevent associating a specific region with your account.</span></span> <span data-ttu-id="51f05-138">異地隔離範例包括 (但不限於) 不超過主權雲端 (例如中國和德國) 或政府稅務界限 (例如澳洲) 界定各區域的全域散發範疇。</span><span class="sxs-lookup"><span data-stu-id="51f05-138">Examples of geo-fencing include (but are not restricted to), scoping global distribution to the regions within a sovereign cloud (for example, China and Germany), or within a government taxation boundary (for example, Australia).</span></span> <span data-ttu-id="51f05-139">使用 Azure 訂用帳戶的中繼資料控制原則。</span><span class="sxs-lookup"><span data-stu-id="51f05-139">The policies are controlled using the metadata of your Azure subscription.</span></span>

### <span data-ttu-id="51f05-140"><a id="DynamicallyAddRegions"></a>動態新增和移除區域</span><span class="sxs-lookup"><span data-stu-id="51f05-140"><a id="DynamicallyAddRegions"></a>Dynamically add and remove regions</span></span>
<span data-ttu-id="51f05-141">Azure Cosmos DB 可讓您隨時對資料庫帳戶新增 (關聯) 或移除 (中斷關聯) 區域 (請參閱[上圖](#UnlimitedRegionsPerAccount))。</span><span class="sxs-lookup"><span data-stu-id="51f05-141">Azure Cosmos DB allows you to add (associate) or remove (dissociate) regions to your database account at any point in time (see [preceding figure](#UnlimitedRegionsPerAccount)).</span></span> <span data-ttu-id="51f05-142">藉由以平行方式跨分割區複寫資料，Azure Cosmos DB 可確保當新區域上線時，30 分鐘內就能在世界各地以高達 100 TB 的速度使用 Azure Cosmos DB。</span><span class="sxs-lookup"><span data-stu-id="51f05-142">By virtue of replicating data across partitions in parallel, Azure Cosmos DB ensures that when a new region comes online, Azure Cosmos DB is available within 30 minutes anywhere in the world for up to 100 TBs.</span></span> 

### <span data-ttu-id="51f05-143"><a id="FailoverPriorities"></a>容錯移轉優先順序</span><span class="sxs-lookup"><span data-stu-id="51f05-143"><a id="FailoverPriorities"></a>Failover priorities</span></span>
<span data-ttu-id="51f05-144">若要在數個區域發生中斷時完全控制區域容錯移轉的順序，Azure Cosmos DB 可讓您將優先順序關聯至與資料庫帳戶相關的各個區域 (請參閱下圖)。</span><span class="sxs-lookup"><span data-stu-id="51f05-144">To control exact sequence of regional failovers when there is a multi-regional outage, Azure Cosmos DB enables you to associate the priority to various regions associated with the database account (see the following figure).</span></span> <span data-ttu-id="51f05-145">Azure Cosmos DB 確保會以您所指定的優先順序自動進行容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="51f05-145">Azure Cosmos DB ensures that the automatic failover sequence occurs in the priority order you specified.</span></span> <span data-ttu-id="51f05-146">如需有關區域性容錯移轉的詳細資訊，請參閱 [Azure Cosmos DB 中商務持續性的自動區域容錯移轉](regional-failover.md)。</span><span class="sxs-lookup"><span data-stu-id="51f05-146">For more information about regional failovers, see [Automatic regional failovers for business continuity in Azure Cosmos DB](regional-failover.md).</span></span>

<span data-ttu-id="51f05-147">**Azure Cosmos DB 的租用戶能為和資料庫帳戶相關的區域設定容錯移轉優先順序 (右窗格)**</span><span class="sxs-lookup"><span data-stu-id="51f05-147">**A tenant of Azure Cosmos DB can configure the failover priority order (right pane) for regions associated with a database account**</span></span>

![使用 Azure Cosmos DB 設定容錯移轉優先順序](./media/distribute-data-globally/failover-priorities.png)

### <span data-ttu-id="51f05-149"><a id="OfflineRegions"></a>讓區域動態「離線」</span><span class="sxs-lookup"><span data-stu-id="51f05-149"><a id="OfflineRegions"></a>Dynamically taking a region "offline"</span></span>
<span data-ttu-id="51f05-150">Azure Cosmos DB 可讓您將特定區域的資料庫帳戶離線，稍後再讓它重新上線。</span><span class="sxs-lookup"><span data-stu-id="51f05-150">Azure Cosmos DB enables you to take your database account offline in a specific region and bring it back online later.</span></span> <span data-ttu-id="51f05-151">標示為離線的區域不會主動參與複寫，也不是容錯移轉順序的一部分。</span><span class="sxs-lookup"><span data-stu-id="51f05-151">Regions marked offline do not actively participate in replication and are not part of the failover sequence.</span></span> <span data-ttu-id="51f05-152">這可讓您在對應用程式推出可能有風險的升級時，將上一個已知良好的資料庫映像凍結在其中一個讀取區域。</span><span class="sxs-lookup"><span data-stu-id="51f05-152">This enables you to freeze the last known good database image in one of the read regions before rolling out potentially risky upgrades to your application.</span></span>

### <span data-ttu-id="51f05-153"><a id="ConsistencyLevels"></a>多個定義完善的一致性模型可供全球複寫資料庫使用</span><span class="sxs-lookup"><span data-stu-id="51f05-153"><a id="ConsistencyLevels"></a>Multiple, well-defined consistency models for globally replicated databases</span></span>
<span data-ttu-id="51f05-154">Azure Cosmos DB 會公開由 SLA 所支援的[多個定義完善的一致性層級](consistency-levels.md)。</span><span class="sxs-lookup"><span data-stu-id="51f05-154">Azure Cosmos DB exposes [multiple well-defined consistency levels](consistency-levels.md) backed by SLAs.</span></span> <span data-ttu-id="51f05-155">您可以根據工作負載/案例選擇特定的一致性模型 (從可用的選項清單中)。</span><span class="sxs-lookup"><span data-stu-id="51f05-155">You can choose a specific consistency model (from the available list of options) depending on the workload/scenarios.</span></span> 

### <span data-ttu-id="51f05-156"><a id="TunableConsistency"></a>可微調全球複寫資料庫不一致之處</span><span class="sxs-lookup"><span data-stu-id="51f05-156"><a id="TunableConsistency"></a>Tunable consistency for globally replicated databases</span></span>
<span data-ttu-id="51f05-157">Azure Cosmos DB 可讓您在執行階段以程式設計方式覆寫和放寬個別要求的預設一致性選擇。</span><span class="sxs-lookup"><span data-stu-id="51f05-157">Azure Cosmos DB allows you to programmatically override and relax the default consistency choice on a per request basis, at runtime.</span></span> 

### <span data-ttu-id="51f05-158"><a id="DynamicallyConfigurableReadWriteRegions"></a>可動態設定讀取和寫入區域</span><span class="sxs-lookup"><span data-stu-id="51f05-158"><a id="DynamicallyConfigurableReadWriteRegions"></a>Dynamically configurable read and write regions</span></span>
<span data-ttu-id="51f05-159">Azure Cosmos DB 可讓您將區域 (和資料庫相關聯) 設定為「讀取」、「寫入」或「讀取/寫入」區域。</span><span class="sxs-lookup"><span data-stu-id="51f05-159">Azure Cosmos DB enables you to configure the regions (associated with the database) for "read", "write" or "read/write" regions.</span></span> 

### <span data-ttu-id="51f05-160"><a id="ElasticallyScaleThroughput"></a>在 Azure 區域，來彈性調整的輸送量</span><span class="sxs-lookup"><span data-stu-id="51f05-160"><a id="ElasticallyScaleThroughput"></a>Elastically scaling throughput across Azure regions</span></span>
<span data-ttu-id="51f05-161">您能以程式設計方式佈建輸送量，彈性地調整 Azure Cosmos DB 集合。</span><span class="sxs-lookup"><span data-stu-id="51f05-161">You can elastically scale an Azure Cosmos DB collection by provisioning throughput programmatically.</span></span> <span data-ttu-id="51f05-162">散發集合的所有區域都會套用該輸送量。</span><span class="sxs-lookup"><span data-stu-id="51f05-162">The throughput is applied to all the regions the collection is distributed in.</span></span>

### <span data-ttu-id="51f05-163"><a id="GeoLocalReadsAndWrites"></a>異地本機讀取和寫入</span><span class="sxs-lookup"><span data-stu-id="51f05-163"><a id="GeoLocalReadsAndWrites"></a>Geo-local reads and writes</span></span>
<span data-ttu-id="51f05-164">資料庫分散在世界各地的主要優點是世界各地資料都提供低延遲存取。</span><span class="sxs-lookup"><span data-stu-id="51f05-164">The key benefit of a globally distributed database is to offer low latency access to the data anywhere in the world.</span></span> <span data-ttu-id="51f05-165">Azure Cosmos DB 可在 P99 進行各種資料庫作業時提供低延遲保證。</span><span class="sxs-lookup"><span data-stu-id="51f05-165">Azure Cosmos DB offers low latency guarantees at P99 for various database operations.</span></span> <span data-ttu-id="51f05-166">它可確保將所有讀取都路由到最接近的本機讀取區域。</span><span class="sxs-lookup"><span data-stu-id="51f05-166">It ensures that all reads are routed to the closest local read region.</span></span> <span data-ttu-id="51f05-167">使用區域本機的仲裁發出讀取，來提供讀取要求。這同樣適用於寫入。</span><span class="sxs-lookup"><span data-stu-id="51f05-167">To serve a read request, the quorum local to the region in which the read is issued is used; the same applies to the writes.</span></span> <span data-ttu-id="51f05-168">只有大多數複本在本機永久認可寫入，而不限在遠端複本上認可寫入之後，寫入才會受到認可。</span><span class="sxs-lookup"><span data-stu-id="51f05-168">A write is acknowledged only after a majority of replicas has durably committed the write locally but without being gated on remote replicas to acknowledge the writes.</span></span> <span data-ttu-id="51f05-169">換句話說，Azure Cosmos DB 的複寫通訊協定會基於下列假設情況來運作：假設讀取和寫入仲裁永遠都會個別位於發出要求的讀取和寫入區域本地。</span><span class="sxs-lookup"><span data-stu-id="51f05-169">Put differently, the replication protocol of Azure Cosmos DB operates under the assumption that the read and write quorums are always local to the read and write regions, respectively, in which the request is issued.</span></span>

### <span data-ttu-id="51f05-170"><a id="ManualFailover"></a>手動起始區域的容錯移轉</span><span class="sxs-lookup"><span data-stu-id="51f05-170"><a id="ManualFailover"></a>Manually initiate regional failover</span></span>
<span data-ttu-id="51f05-171">Azure Cosmos DB 可讓您觸發資料庫帳戶的容錯移轉，以驗證整個應用程式的「端對端」可用性屬性 (除資料庫之外)。</span><span class="sxs-lookup"><span data-stu-id="51f05-171">Azure Cosmos DB allows you to trigger the failover of the database account to validate the *end to end* availability properties of the entire application (beyond the database).</span></span> <span data-ttu-id="51f05-172">由於保證失敗偵測和選出領導者的安全性與作用中屬性，因此 Azure Cosmos DB 可保證租用戶起始的手動容錯移轉作業「零資料遺失」。</span><span class="sxs-lookup"><span data-stu-id="51f05-172">Since both the safety and liveness properties of the failure detection and leader election are guaranteed, Azure Cosmos DB guarantees *zero-data-loss* for a tenant-initiated manual failover operation.</span></span>

### <span data-ttu-id="51f05-173"><a id="AutomaticFailover"></a>自動容錯移轉</span><span class="sxs-lookup"><span data-stu-id="51f05-173"><a id="AutomaticFailover"></a>Automatic failover</span></span>
<span data-ttu-id="51f05-174">Azure Cosmos DB 支援在發生一或多個區域中斷時自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="51f05-174">Azure Cosmos DB supports automatic failover in case of one or more regional outages.</span></span> <span data-ttu-id="51f05-175">進行區域容錯移轉時，Azure Cosmos DB 會維持其讀取延遲、執行時間可用性、一致性及輸送量 SLA。</span><span class="sxs-lookup"><span data-stu-id="51f05-175">During a regional failover, Azure Cosmos DB maintains its read latency, uptime availability, consistency, and throughput SLAs.</span></span> <span data-ttu-id="51f05-176">Azure Cosmos DB 提供完成自動容錯移轉作業的持續時間上限。</span><span class="sxs-lookup"><span data-stu-id="51f05-176">Azure Cosmos DB provides an upper bound on the duration of an automatic failover operation to complete.</span></span> <span data-ttu-id="51f05-177">資料很可能會在區域中斷時的這段時間遺失。</span><span class="sxs-lookup"><span data-stu-id="51f05-177">This is the window of potential data loss during the regional outage.</span></span>

### <span data-ttu-id="51f05-178"><a id="GranularFailover"></a>專為不同的容錯移轉資料粒度設計</span><span class="sxs-lookup"><span data-stu-id="51f05-178"><a id="GranularFailover"></a>Designed for different failover granularities</span></span>
<span data-ttu-id="51f05-179">目前是在資料庫帳戶的資料粒度公開自動和手動容錯移轉功能。</span><span class="sxs-lookup"><span data-stu-id="51f05-179">Currently the automatic and manual failover capabilities are exposed at the granularity of the database account.</span></span> <span data-ttu-id="51f05-180">請注意，Azure Cosmos DB 在內部的設計是以更精細的資料庫、集合或甚至是 (擁有一系列索引鍵的集合) 分割區的資料粒度「自動」容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="51f05-180">Note, internally Azure Cosmos DB is designed to offer *automatic* failover at finer granularity of a database, collection, or even a partition (of a collection owning a range of keys).</span></span> 

### <span data-ttu-id="51f05-181"><a id="MultiHomingAPIs"></a>Azure Cosmos DB 中的多路連接 API</span><span class="sxs-lookup"><span data-stu-id="51f05-181"><a id="MultiHomingAPIs"></a>Multi-homing APIs in Azure Cosmos DB</span></span>
<span data-ttu-id="51f05-182">Azure Cosmos DB 可讓您使用邏輯 (區域無從驗證) 或實體 (區域特定) 端點來和資料庫互動。</span><span class="sxs-lookup"><span data-stu-id="51f05-182">Azure Cosmos DB allows you to interact with the database using either logical (region agnostic) or physical (region-specific) endpoints.</span></span> <span data-ttu-id="51f05-183">使用邏輯端點，萬一進行容錯移轉時，可確保以透明的方式多路連接應用程式。</span><span class="sxs-lookup"><span data-stu-id="51f05-183">Using logical endpoints ensures that the application can transparently be multi-homed in case of failover.</span></span> <span data-ttu-id="51f05-184">後者實體端點可微調控制應用程式，將讀取和寫入將重新導向特定區域。</span><span class="sxs-lookup"><span data-stu-id="51f05-184">The latter, physical endpoints, provide fine-grained control to the application to redirect reads and writes to specific regions.</span></span>

<span data-ttu-id="51f05-185">在個別連結的文章中，可以找到如何設定 [DocumentDB](../cosmos-db/tutorial-global-distribution-documentdb.md)、[圖形 API](../cosmos-db/tutorial-global-distribution-graph.md)、[資料表 API](../cosmos-db/tutorial-global-distribution-table.md) 和 [MongoDB API](../cosmos-db/tutorial-global-distribution-mongodb.md) 讀取喜好設定的資訊。</span><span class="sxs-lookup"><span data-stu-id="51f05-185">You can find information on how to configure read preferences for the [DocumentDB API](../cosmos-db/tutorial-global-distribution-documentdb.md), [Graph API](../cosmos-db/tutorial-global-distribution-graph.md), [Table API](../cosmos-db/tutorial-global-distribution-table.md), and [MongoDB API](../cosmos-db/tutorial-global-distribution-mongodb.md) in their respective linked articles.</span></span>

### <span data-ttu-id="51f05-186"><a id="TransparentSchemaMigration"></a>透明且一致的資料庫結構描述與索引移轉</span><span class="sxs-lookup"><span data-stu-id="51f05-186"><a id="TransparentSchemaMigration"></a>Transparent and consistent database schema and index migration</span></span> 
<span data-ttu-id="51f05-187">Azure Cosmos DB 完全[無從驗證結構描述 (英文)](http://www.vldb.org/pvldb/vol8/p1668-shukla.pdf)。</span><span class="sxs-lookup"><span data-stu-id="51f05-187">Azure Cosmos DB is fully [schema agnostic](http://www.vldb.org/pvldb/vol8/p1668-shukla.pdf).</span></span> <span data-ttu-id="51f05-188">資料庫引擎的獨特設計能自動且同步對內嵌的所有資料編製索引，不需要您提供任何結構描述或次要索引。</span><span class="sxs-lookup"><span data-stu-id="51f05-188">The unique design of its database engine allows it to automatically and synchronously index all of the data it ingests without requiring any schema or secondary indices from you.</span></span> <span data-ttu-id="51f05-189">這可讓您快速地反覆查看分散在世界各地的應用程式，而不必擔心資料庫結構描述和索引移轉，或協調多階段應用程式推出結構描述變更。</span><span class="sxs-lookup"><span data-stu-id="51f05-189">This enables you to iterate your globally distributed application rapidly without worrying about database schema and index migration or coordinating multi-phase application rollouts of schema changes.</span></span> <span data-ttu-id="51f05-190">Azure Cosmos DB 保證任何明確由您對編製索引原則所做的變更，都不會導致效能或可用性降低。</span><span class="sxs-lookup"><span data-stu-id="51f05-190">Azure Cosmos DB guarantees that any changes to indexing policies explicitly made by you does not result into degradation of either performance or availability.</span></span>  

### <span data-ttu-id="51f05-191"><a id="ComprehensiveSLAs"></a>全方位 SLA (不光只有高可用性)</span><span class="sxs-lookup"><span data-stu-id="51f05-191"><a id="ComprehensiveSLAs"></a>Comprehensive SLAs (beyond just high availability)</span></span>
<span data-ttu-id="51f05-192">Azure Cosmos DB 是全域散發的資料庫服務，可提供定義完善的 SLA 以將資料庫視為一體，全面處理**資料遺失**、**可用性**、**在 P99 的延遲**、**輸送量**及**一致性**，而不論與資料庫相關聯的區域數目為何。</span><span class="sxs-lookup"><span data-stu-id="51f05-192">As a globally distributed database service, Azure Cosmos DB offers well-defined SLA for **data-loss**, **availability**, **latency at P99**, **throughput** and **consistency** for the database as a whole, regardless of the number of regions associated with the database.</span></span>  

## <span data-ttu-id="51f05-193"><a id="LatencyGuarantees"></a>延遲保證</span><span class="sxs-lookup"><span data-stu-id="51f05-193"><a id="LatencyGuarantees"></a>Latency guarantees</span></span>
<span data-ttu-id="51f05-194">像是 Azure Cosmos DB 之全域散發資料庫服務的主要優點是，為您在世界各地的資料提供低延遲存取。</span><span class="sxs-lookup"><span data-stu-id="51f05-194">The key benefit of a globally distributed database service like Azure Cosmos DB is to offer low latency access to your data anywhere in the world.</span></span> <span data-ttu-id="51f05-195">Azure Cosmos DB 可在 P99 進行各種資料庫作業時保證低延遲。</span><span class="sxs-lookup"><span data-stu-id="51f05-195">Azure Cosmos DB offers guaranteed low latency at P99 for various database operations.</span></span> <span data-ttu-id="51f05-196">Azure Cosmos DB 採用的複寫通訊協定可確保一律會在用戶端所在區域執行資料庫作業 (理想的情況是讀取和寫入)。</span><span class="sxs-lookup"><span data-stu-id="51f05-196">The replication protocol that Azure Cosmos DB employs ensures that the database operations (ideally, both reads and writes) are always performed in the region local to that of the client.</span></span> <span data-ttu-id="51f05-197">Azure Cosmos DB 的延遲 SLA 包括 P99，適用於各種要求和回應大小的讀取、(同步) 編製索引的寫入和查詢。</span><span class="sxs-lookup"><span data-stu-id="51f05-197">The latency SLA of Azure Cosmos DB includes P99 for both reads, (synchronously) indexed writes and queries for various request and response sizes.</span></span> <span data-ttu-id="51f05-198">寫入延遲保證，包含持久的多數仲裁在本機資料中心內認可。</span><span class="sxs-lookup"><span data-stu-id="51f05-198">The latency guarantees for writes include durable majority quorum commits within the local datacenter.</span></span>

### <span data-ttu-id="51f05-199"><a id="LatencyAndConsistency"></a>延遲和一致性的關聯性</span><span class="sxs-lookup"><span data-stu-id="51f05-199"><a id="LatencyAndConsistency"></a>Latency's relationship with consistency</span></span> 
<span data-ttu-id="51f05-200">要在世界各地安裝分散在世界各地的服務提供絕佳一致性，需要同時複寫，然後寫入，或同時執行跨區域讀取 – 光線速度和廣域網路網路可靠性決定強式一致性會有高延遲和低可用性的資料庫作業。</span><span class="sxs-lookup"><span data-stu-id="51f05-200">For a globally distributed service to offer strong consistency in a globally distributed setup, it needs to synchronously replicate the writes or synchronous perform cross-region reads – the speed of light and the wide area network reliability dictate that strong consistency results in high latencies and low availability of database operations.</span></span> <span data-ttu-id="51f05-201">因此，為了保證在 P99 提供低延遲和 99.99 可用性，服務必須採用非同步複寫。</span><span class="sxs-lookup"><span data-stu-id="51f05-201">Hence, in order to offer guaranteed low latencies at P99 and 99.99 availability, the service must employ asynchronous replication.</span></span> <span data-ttu-id="51f05-202">這轉而要求服務還必須提供[定義完善、寬鬆的一致性選項](consistency-levels.md) – 比強式稍差 (以保證提供低延遲與高可用性)，且最好比「最終」一致性更強 (提供直覺式程式設計模型)。</span><span class="sxs-lookup"><span data-stu-id="51f05-202">This in-turn requires that the service must also offer [well-defined, relaxed consistency choice(s)](consistency-levels.md) – weaker than strong (to offer low latency and availability guarantees) and ideally stronger than "eventual" consistency (to offer an intuitive programming model).</span></span>

<span data-ttu-id="51f05-203">Azure Cosmos DB 確保不需要讀取作業來連絡跨多個區域的複本，以提供特定一致性層級保證。</span><span class="sxs-lookup"><span data-stu-id="51f05-203">Azure Cosmos DB ensures that a read operation is not required to contact replicas across multiple regions to deliver the specific consistency level guarantee.</span></span> <span data-ttu-id="51f05-204">同樣地，它可確保 跨所有區域複寫資料時，不會封鎖寫入作業 (也就是寫入會以非同步的方式跨區域複寫)。</span><span class="sxs-lookup"><span data-stu-id="51f05-204">Likewise, it ensures that a write operation does not get blocked while the data is being replicated across all the regions (i.e. writes are asynchronously replicated across regions).</span></span> <span data-ttu-id="51f05-205">對於多重區域資料庫帳戶，可以提供多個寬鬆的一致性層級。</span><span class="sxs-lookup"><span data-stu-id="51f05-205">For multi-region database accounts multiple relaxed consistency levels are available.</span></span> 

### <span data-ttu-id="51f05-206"><a id="LatencyAndAvailability"></a>延遲和可用性的關聯性</span><span class="sxs-lookup"><span data-stu-id="51f05-206"><a id="LatencyAndAvailability"></a>Latency's relationship with availability</span></span> 
<span data-ttu-id="51f05-207">延遲和可用性就像錢幣的一體兩面。</span><span class="sxs-lookup"><span data-stu-id="51f05-207">Latency and availability are the two sides of the same coin.</span></span> <span data-ttu-id="51f05-208">我們會討論穩定狀態下的作業延遲和可面對失敗時的可用性。</span><span class="sxs-lookup"><span data-stu-id="51f05-208">We talk about latency of the operation in steady state and availability, in the face of failures.</span></span> <span data-ttu-id="51f05-209">從應用程式的觀點而言，執行緩慢的資料庫作業和無法使用的資料庫，並無法辨別。</span><span class="sxs-lookup"><span data-stu-id="51f05-209">From the application standpoint, a slow running database operation is indistinguishable from a database that is unavailable.</span></span> 

<span data-ttu-id="51f05-210">Azure Cosmos DB 會就各種資料庫作業的延遲提供絕對的時間上限，來區分高延遲和無法使用的情況。</span><span class="sxs-lookup"><span data-stu-id="51f05-210">To distinguish high latency from unavailability, Azure Cosmos DB provides an absolute upper bound on latency of various database operations.</span></span> <span data-ttu-id="51f05-211">如果完成資料庫作業所花費的時間超過上限，Azure Cosmos DB 就會傳回逾時錯誤。</span><span class="sxs-lookup"><span data-stu-id="51f05-211">If the database operation takes longer than the upper bound to complete, Azure Cosmos DB returns a timeout error.</span></span> <span data-ttu-id="51f05-212">Azure Cosmos DB 可用性 SLA 可確保針對可用性 SLA 計算逾時。</span><span class="sxs-lookup"><span data-stu-id="51f05-212">The Azure Cosmos DB availability SLA ensures that the timeouts are counted against the availability SLA.</span></span> 

### <span data-ttu-id="51f05-213"><a id="LatencyAndThroughput"></a>延遲和輸送量的關聯性</span><span class="sxs-lookup"><span data-stu-id="51f05-213"><a id="LatencyAndThroughput"></a>Latency's relationship with throughput</span></span>
<span data-ttu-id="51f05-214">Azure Cosmos DB 不會要您在延遲和輸送量之間做出選擇。</span><span class="sxs-lookup"><span data-stu-id="51f05-214">Azure Cosmos DB does not make you choose between latency and throughput.</span></span> <span data-ttu-id="51f05-215">而是接受 SLA，用於在 P99 的延遲並傳遞您佈建的輸送量。</span><span class="sxs-lookup"><span data-stu-id="51f05-215">It honors the SLA for both latency at P99 and deliver the throughput that you have provisioned.</span></span> 

## <span data-ttu-id="51f05-216"><a id="ConsistencyGuarantees"></a>一致性保證</span><span class="sxs-lookup"><span data-stu-id="51f05-216"><a id="ConsistencyGuarantees"></a>Consistency guarantees</span></span>
<span data-ttu-id="51f05-217">雖然[強式一致性模型](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf)是可程式性的黃金標準，但要付出的很大代價是高延遲 (穩定狀態下) 和喪失可用性 (面對失敗)。</span><span class="sxs-lookup"><span data-stu-id="51f05-217">While the [strong consistency model](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf) is the gold standard of programmability, it comes at the steep price of high latency (in steady state) and loss of availability (in the face of failures).</span></span> 

<span data-ttu-id="51f05-218">Azure Cosmos DB 會提供定義完善的程式設計模型，讓您理解有關複寫資料的一致性。</span><span class="sxs-lookup"><span data-stu-id="51f05-218">Azure Cosmos DB offers a well-defined programming model to you to reason about replicated data's consistency.</span></span> <span data-ttu-id="51f05-219">為了讓您建置多路連接的應用程式，Azure Cosmos DB 所公開的一致性模型是設計來讓區域無從驗證，以及不依存於提供讀取和寫入的區域。</span><span class="sxs-lookup"><span data-stu-id="51f05-219">In order to enable you to build multi-homed applications, the consistency models exposed by Azure Cosmos DB are designed to be region-agnostic and not depend on the region from where the reads and writes are served.</span></span> 

<span data-ttu-id="51f05-220">Azure Cosmos DB 的一致性 SLA 保證 100% 的讀取要求都將符合您要求的一致性層級 (資料庫帳戶上的預設一致性層級或要求上的覆寫值)。</span><span class="sxs-lookup"><span data-stu-id="51f05-220">Azure Cosmos DB's consistency SLA guarantees that 100% of read requests will meet the consistency guarantee for the consistency level requested by you (either the default consistency level on the database account or the overridden value on the request).</span></span> <span data-ttu-id="51f05-221">如果和一致性層級相關聯的所有一致性保證全都滿足，就會將讀取要求視為已符合一致性 SLA。</span><span class="sxs-lookup"><span data-stu-id="51f05-221">A read request is considered to have met the consistency SLA if all the consistency guarantees associated with the consistency level are satisfied.</span></span> <span data-ttu-id="51f05-222">下表擷取的一致性保證會對應至 Azure Cosmos DB 提供的特定一致性層級。</span><span class="sxs-lookup"><span data-stu-id="51f05-222">The following table captures the consistency guarantees that correspond to specific consistency levels offered by Azure Cosmos DB.</span></span>

<span data-ttu-id="51f05-223">**和 Azure Cosmos DB 中所指定一致性層級相關聯的一致性保證**</span><span class="sxs-lookup"><span data-stu-id="51f05-223">**Consistency guarantees associated with a given consistency level in Azure Cosmos DB**</span></span>

<table>
    <tr>
        <td><span data-ttu-id="51f05-224"><strong>一致性層級</strong></span><span class="sxs-lookup"><span data-stu-id="51f05-224"><strong>Consistency Level</strong></span></span></td>
        <td><span data-ttu-id="51f05-225"><strong>一致性特性</strong></span><span class="sxs-lookup"><span data-stu-id="51f05-225"><strong>Consistency Characteristics</strong></span></span></td>
        <td><span data-ttu-id="51f05-226"><strong>SLA</strong></span><span class="sxs-lookup"><span data-stu-id="51f05-226"><strong>SLA</strong></span></span></td>
    </tr>
    <tr>
        <td rowspan="3"><span data-ttu-id="51f05-227">工作階段</span><span class="sxs-lookup"><span data-stu-id="51f05-227">Session</span></span></td>
        <td><span data-ttu-id="51f05-228">讀取自己的寫入</span><span class="sxs-lookup"><span data-stu-id="51f05-228">Read your own write</span></span></td>
        <td><span data-ttu-id="51f05-229">100%</span><span class="sxs-lookup"><span data-stu-id="51f05-229">100%</span></span></td>
    </tr>
    <tr>
        <td><span data-ttu-id="51f05-230">單純讀取</span><span class="sxs-lookup"><span data-stu-id="51f05-230">Monotonic read</span></span></td>
        <td><span data-ttu-id="51f05-231">100%</span><span class="sxs-lookup"><span data-stu-id="51f05-231">100%</span></span></td>
    </tr>
    <tr>
        <td><span data-ttu-id="51f05-232">一致的前置詞</span><span class="sxs-lookup"><span data-stu-id="51f05-232">Consistent prefix</span></span></td>
        <td><span data-ttu-id="51f05-233">100%</span><span class="sxs-lookup"><span data-stu-id="51f05-233">100%</span></span></td>
    </tr>
    <tr>
        <td rowspan="3"><span data-ttu-id="51f05-234">界限-陳舊</span><span class="sxs-lookup"><span data-stu-id="51f05-234">Bounded staleness</span></span></td>
        <td><span data-ttu-id="51f05-235">單純讀取 (區域內)</span><span class="sxs-lookup"><span data-stu-id="51f05-235">Monotonic read (within a region)</span></span></td>
        <td><span data-ttu-id="51f05-236">100%</span><span class="sxs-lookup"><span data-stu-id="51f05-236">100%</span></span></td>
    </tr>
    <tr>
        <td><span data-ttu-id="51f05-237">一致的前置詞</span><span class="sxs-lookup"><span data-stu-id="51f05-237">Consistent prefix</span></span></td>
        <td><span data-ttu-id="51f05-238">100%</span><span class="sxs-lookup"><span data-stu-id="51f05-238">100%</span></span></td>
    </tr>
    <tr>
        <td><span data-ttu-id="51f05-239">過期限定 &lt; K、T</span><span class="sxs-lookup"><span data-stu-id="51f05-239">Staleness bound &lt; K,T</span></span></td>
        <td><span data-ttu-id="51f05-240">100%</span><span class="sxs-lookup"><span data-stu-id="51f05-240">100%</span></span></td>
    </tr>
    <tr>
        <td><span data-ttu-id="51f05-241">一致的前置詞</span><span class="sxs-lookup"><span data-stu-id="51f05-241">Consistent prefix</span></span></td>
        <td><span data-ttu-id="51f05-242">一致的前置詞</span><span class="sxs-lookup"><span data-stu-id="51f05-242">Consistent prefix</span></span></td>
        <td><span data-ttu-id="51f05-243">100%</span><span class="sxs-lookup"><span data-stu-id="51f05-243">100%</span></span></td>
    </tr>
    <tr>
        <td><span data-ttu-id="51f05-244">重要事項</span><span class="sxs-lookup"><span data-stu-id="51f05-244">Strong</span></span></td>
        <td><span data-ttu-id="51f05-245">線性</span><span class="sxs-lookup"><span data-stu-id="51f05-245">Linearizable</span></span></td>
        <td><span data-ttu-id="51f05-246">100%</span><span class="sxs-lookup"><span data-stu-id="51f05-246">100%</span></span></td>
    </tr>
</table>

### <span data-ttu-id="51f05-247"><a id="ConsistencyAndAvailability"></a>一致性和可用性的關聯性</span><span class="sxs-lookup"><span data-stu-id="51f05-247"><a id="ConsistencyAndAvailability"></a>Consistency's relationship with availability</span></span>
<span data-ttu-id="51f05-248">[CAP 定理 (CAP theorem)](https://people.eecs.berkeley.edu/~brewer/cs262b-2004/PODC-keynote.pdf) [不可達的結果 (impossibility result)](http://www.glassbeam.com/sites/all/themes/glassbeam/images/blog/10.1.1.67.6951.pdf) 證明系統面對失敗時，確實無法維持可用，同時提供線性一致性。</span><span class="sxs-lookup"><span data-stu-id="51f05-248">The [impossibility result](http://www.glassbeam.com/sites/all/themes/glassbeam/images/blog/10.1.1.67.6951.pdf) of the [CAP theorem](https://people.eecs.berkeley.edu/~brewer/cs262b-2004/PODC-keynote.pdf) proves that it is indeed impossible for the system to remain available and offer linearizable consistency in the face of failures.</span></span> <span data-ttu-id="51f05-249">資料庫服務必須選擇 CP 或 AP - CP 系統會為了線性一致性而放棄可用性，而 AP 系統則會為了可用性而放棄[線性一致性 (英文)](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf)。</span><span class="sxs-lookup"><span data-stu-id="51f05-249">The database service must choose to be either CP or AP - CP systems forgo availability in favor of linearizable consistency while the AP systems forgo [linearizable consistency](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf) in favor of availability.</span></span> <span data-ttu-id="51f05-250">Azure Cosmos DB 永遠不會違反要求的一致性層級，因此使其正式成為 CP 系統。</span><span class="sxs-lookup"><span data-stu-id="51f05-250">Azure Cosmos DB never violates the requested consistency level, which formally makes it a CP system.</span></span> <span data-ttu-id="51f05-251">然而實際上，一致性並不主張孤注一擲 – 除了線性和最終一致性之間的一致性範圍，還有數個定義完善的一致性模型。</span><span class="sxs-lookup"><span data-stu-id="51f05-251">However, in practice consistency is not an all or nothing proposition – there are multiple well-defined consistency models along the consistency spectrum between linearizable and eventual consistency.</span></span> <span data-ttu-id="51f05-252">在 Azure Cosmos DB 中，我們試著利用真實世界的適用性和直覺式程式設計模型，來識別數個寬鬆的一致性模型。</span><span class="sxs-lookup"><span data-stu-id="51f05-252">In Azure Cosmos DB, we have tried to identify several of the relaxed consistency models with real world applicability and an intuitive programming model.</span></span> <span data-ttu-id="51f05-253">Azure Cosmos DB 透過提供 99.99 可用性 SLA 以及[多個寬鬆但定義完善的一致性層級](consistency-levels.md)，來瀏覽一致性可用性的權衡取捨。</span><span class="sxs-lookup"><span data-stu-id="51f05-253">Azure Cosmos DB navigates the consistency-availability tradeoffs by offering 99.99 availability SLA along with [multiple relaxed yet well-defined consistency levels](consistency-levels.md).</span></span> 

### <span data-ttu-id="51f05-254"><a id="ConsistencyAndAvailability"></a>一致性和延遲的關聯性</span><span class="sxs-lookup"><span data-stu-id="51f05-254"><a id="ConsistencyAndAvailability"></a>Consistency's relationship with latency</span></span>
<span data-ttu-id="51f05-255">Daniel Abadi 教授提出更全面的 CAP 變化稱為 [PACELC](http://cs-www.cs.yale.edu/homes/dna/papers/abadi-pacelc.pdf)，也能解釋在穩定狀態下對延遲和一致性的權衡取捨。</span><span class="sxs-lookup"><span data-stu-id="51f05-255">A more comprehensive variation of CAP was proposed by Prof. Daniel Abadi and it is called [PACELC](http://cs-www.cs.yale.edu/homes/dna/papers/abadi-pacelc.pdf), which also accounts for latency and consistency tradeoffs in steady state.</span></span> <span data-ttu-id="51f05-256">它指出在穩定狀態下，資料庫系統必須在一致性和延遲之間做出選擇。</span><span class="sxs-lookup"><span data-stu-id="51f05-256">It states that in steady state, the database system must choose between consistency and latency.</span></span> <span data-ttu-id="51f05-257">使用多個寬鬆的一致性模型 (受非同步複寫和本機讀取、寫入仲裁支援)，Azure Cosmos DB 確保所有讀取和寫入都會分別在讀取和寫入區域本地進行。</span><span class="sxs-lookup"><span data-stu-id="51f05-257">With multiple relaxed consistency models (backed by asynchronous replication and local read, write quorums), Azure Cosmos DB ensures that all reads and writes are local to the read and write regions respectively.</span></span>  <span data-ttu-id="51f05-258">這可讓 Azure Cosmos DB 在一致性層級的區域內提供低延遲保證。</span><span class="sxs-lookup"><span data-stu-id="51f05-258">This allows Azure Cosmos DB to offer low latency guarantees within the region for the consistency levels.</span></span>  

### <span data-ttu-id="51f05-259"><a id="ConsistencyAndThroughput"></a>一致性和輸送量的關聯性</span><span class="sxs-lookup"><span data-stu-id="51f05-259"><a id="ConsistencyAndThroughput"></a>Consistency's relationship with throughput</span></span>
<span data-ttu-id="51f05-260">由於實作特定一致性模型，取決於選擇的[仲裁類型](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf)，而輸送量也根據一致性選擇而不同。</span><span class="sxs-lookup"><span data-stu-id="51f05-260">Since the implementation of a specific consistency model depends on the choice of a [quorum type](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf), the throughput also varies based on the choice of consistency.</span></span> <span data-ttu-id="51f05-261">例如，在 Azure Cosmos DB 中進行強式一致的讀取時，輸送量大約是進行最終一致讀取的一半。</span><span class="sxs-lookup"><span data-stu-id="51f05-261">For instance, in Azure Cosmos DB, the throughput with strongly consistent reads is roughly half to that of eventually consistent reads.</span></span> 
 
<span data-ttu-id="51f05-262">**Azure Cosmos DB 中特定一致性層級之讀取容量的關聯性**</span><span class="sxs-lookup"><span data-stu-id="51f05-262">**Relationship of read capacity for a specific consistency level in Azure Cosmos DB**</span></span>

![一致性和輸送量之間的關聯性](./media/distribute-data-globally/consistency-and-throughput.png)

## <span data-ttu-id="51f05-264"><a id="ThroughputGuarantees"></a>輸送量保證</span><span class="sxs-lookup"><span data-stu-id="51f05-264"><a id="ThroughputGuarantees"></a>Throughput guarantees</span></span> 
<span data-ttu-id="51f05-265">Azure Cosmos DB 可讓您視需求彈性地跨不同的區域調整輸送量 (以及儲存體)。</span><span class="sxs-lookup"><span data-stu-id="51f05-265">Azure Cosmos DB allows you to scale throughput (as well as, storage), elastically across different regions depending on the demand.</span></span> 

<span data-ttu-id="51f05-266">**單一 Azure Cosmos DB 集合經過分割 (跨三個分區)，然後散發在三個 Azure 區域**</span><span class="sxs-lookup"><span data-stu-id="51f05-266">**A single Azure Cosmos DB collection partitioned (across three shards) and then distributed across three Azure regions**</span></span>

![Azure Cosmos DB 已散發並分割集合](../cosmos-db/media/introduction/azure-cosmos-db-global-distribution.png)

<span data-ttu-id="51f05-268">Azure Cosmos DB 集合可使用兩個維度來散發：在區域內，然後跨區域。</span><span class="sxs-lookup"><span data-stu-id="51f05-268">An Azure Cosmos DB collection gets distributed using two dimensions – within a region and then across regions.</span></span> <span data-ttu-id="51f05-269">方式如下：</span><span class="sxs-lookup"><span data-stu-id="51f05-269">Here's how:</span></span> 

* <span data-ttu-id="51f05-270">在單一區域內，以資源分割區的方式相應放大 Azure Cosmos DB 集合。</span><span class="sxs-lookup"><span data-stu-id="51f05-270">Within a single region, an Azure Cosmos DB collection is scaled out in terms of resource partitions.</span></span> <span data-ttu-id="51f05-271">藉由在一組複本間複寫狀態機器，每個資源資料分割都會管理一組索引鍵且極為一致並高度可用。</span><span class="sxs-lookup"><span data-stu-id="51f05-271">Each resource partition manages a set of keys and is strongly consistent and highly available by virtue of state machine replication among a set of replicas.</span></span> <span data-ttu-id="51f05-272">Azure Cosmos DB 是全面管理資源的系統，其中的資源分割區負責依照配置給它之系統資源的預算來傳遞自己的輸送量。</span><span class="sxs-lookup"><span data-stu-id="51f05-272">Azure Cosmos DB is a fully resource governed system where a resource partition is responsible for delivering its share of throughput for the budget of system resources allocated to it.</span></span> <span data-ttu-id="51f05-273">調整 Azure Cosmos DB 集合的大小完全透明：Azure Cosmos DB 會管理資源分割區，並視需要予以分割及合併。</span><span class="sxs-lookup"><span data-stu-id="51f05-273">The scaling of an Azure Cosmos DB collection is completely transparent – Azure Cosmos DB manages the resource partitions and splits and merges it as needed.</span></span> 
* <span data-ttu-id="51f05-274">接著將每個資源資料分割散發在多個區域。</span><span class="sxs-lookup"><span data-stu-id="51f05-274">Each of the resource partitions is then distributed across multiple regions.</span></span> <span data-ttu-id="51f05-275">各個區域表單分割集的資源資料分割都有同一組索引鍵 (請參閱[上圖](#ThroughputGuarantees))。</span><span class="sxs-lookup"><span data-stu-id="51f05-275">Resource partitions owning the same set of keys across various regions form partition set (see [preceding figure](#ThroughputGuarantees)).</span></span>  <span data-ttu-id="51f05-276">使用狀態機器複寫，跨多個區域協調分割集內的資源資料分割。</span><span class="sxs-lookup"><span data-stu-id="51f05-276">Resource partitions within a partition set are coordinated using state machine replication across the multiple regions.</span></span> <span data-ttu-id="51f05-277">根據設定的一致性層級，分割集內的資源資料分割設定為動態使用不同的拓撲 (例如，星形、菊輪鍊、樹狀目錄等)。</span><span class="sxs-lookup"><span data-stu-id="51f05-277">Depending on the consistency level configured, the resource partitions within a partition set are configured dynamically using different topologies (for example, star, daisy-chain, tree etc.).</span></span> 

<span data-ttu-id="51f05-278">透過回應相當靈敏的分割區管理、負載平衡及嚴格的資源管理，Azure Cosmos DB 可讓您彈性地調整 Azure Cosmos DB 集合上數個 Azure 區域的輸送量。</span><span class="sxs-lookup"><span data-stu-id="51f05-278">By virtue of a highly responsive partition management, load balancing and strict resource governance, Azure Cosmos DB allows you to elastically scale throughput across multiple Azure regions on an Azure Cosmos DB collection.</span></span> <span data-ttu-id="51f05-279">變更集合上的輸送量是 Azure Cosmos DB 中的執行階段作業，和其他資料庫作業一樣，Azure Cosmos DB 可為變更輸送量的要求保證其延遲絕對時間上限。</span><span class="sxs-lookup"><span data-stu-id="51f05-279">Changing throughput on a collection is a runtime operation in Azure Cosmos DB - like with other database operations Azure Cosmos DB guarantees the absolute upper bound on latency for your request to change the throughput.</span></span> <span data-ttu-id="51f05-280">例如，下圖顯示的客戶集合會根據需求彈性地佈建輸送量 (在兩個區域有每秒 1M-10M 個要求)。</span><span class="sxs-lookup"><span data-stu-id="51f05-280">As an example, the following figure shows a customer's collection with elastically provisioned throughput (ranging from 1M-10M requests/sec across two regions) based on the demand.</span></span>
 
<span data-ttu-id="51f05-281">**彈性地佈建輸送量的客戶集合 (每秒 1M-10M 個要求)**</span><span class="sxs-lookup"><span data-stu-id="51f05-281">**A customer's collection with elastically provisioned throughput (1M-10M requests/sec)**</span></span>

![Azure Cosmos DB 可彈性佈建輸送量](./media/distribute-data-globally/elastic-throughput.png)

### <span data-ttu-id="51f05-283"><a id="ThroughputAndConsistency"></a>輸送量和一致性的關聯性</span><span class="sxs-lookup"><span data-stu-id="51f05-283"><a id="ThroughputAndConsistency"></a>Throughput's relationship with consistency</span></span> 
<span data-ttu-id="51f05-284">與[一致性和輸送量的關聯性](#ConsistencyAndThroughput)相同。</span><span class="sxs-lookup"><span data-stu-id="51f05-284">Same as [Consistency's relationship with throughput](#ConsistencyAndThroughput).</span></span>

### <span data-ttu-id="51f05-285"><a id="ThroughputAndAvailability"></a>輸送量和可用性的關聯性</span><span class="sxs-lookup"><span data-stu-id="51f05-285"><a id="ThroughputAndAvailability"></a>Throughput's relationship with availability</span></span>
<span data-ttu-id="51f05-286">Azure Cosmos DB 會在變更輸送量時維持其可用性。</span><span class="sxs-lookup"><span data-stu-id="51f05-286">Azure Cosmos DB continues to maintain its availability when the changes are made to the throughput.</span></span> <span data-ttu-id="51f05-287">Azure Cosmos DB 會明確管理分割區 (例如，分割、合併、複製作業)，並在應用程式彈性增加或減少輸送量時，確保這些作業不會降低效能或可用性。</span><span class="sxs-lookup"><span data-stu-id="51f05-287">Azure Cosmos DB transparently manages partitions (for example, split, merge, clone operations) and ensures that the operations do not degrade performance or availability, while the application elastically increases or decreases throughput.</span></span> 

## <span data-ttu-id="51f05-288"><a id="AvailabilityGuarantees"></a>可用性保證</span><span class="sxs-lookup"><span data-stu-id="51f05-288"><a id="AvailabilityGuarantees"></a>Availability guarantees</span></span>
<span data-ttu-id="51f05-289">Azure Cosmos DB 針對每個資料面和控制面作業提供 99.99%的執行時間可用性 SLA。</span><span class="sxs-lookup"><span data-stu-id="51f05-289">Azure Cosmos DB offers a 99.99% uptime availability SLA for each of the data and control plane operations.</span></span> <span data-ttu-id="51f05-290">如先前所述，Azure Cosmos DB 的可用性保證包含每個資料面和控制面作業的延遲絕對上限。</span><span class="sxs-lookup"><span data-stu-id="51f05-290">As described earlier, Azure Cosmos DB's availability guarantees include an absolute upper bound on latency for every data and control plane operations.</span></span> <span data-ttu-id="51f05-291">可用性保證堅定不移，而且不會隨區域數目或區域之間的地理距離變化。</span><span class="sxs-lookup"><span data-stu-id="51f05-291">The availability guarantees are steadfast and do not change with the number of regions or geographical distance between regions.</span></span> <span data-ttu-id="51f05-292">可用性保證適用於手動以及自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="51f05-292">Availability guarantees apply with both manual as well as, automatic failover.</span></span> <span data-ttu-id="51f05-293">Azure Cosmos DB 提供透明的多路連接 API，可以確保您的應用程式在進行容錯移轉時能操作邏輯端點，並明確地將要求路由傳送至新的區域。</span><span class="sxs-lookup"><span data-stu-id="51f05-293">Azure Cosmos DB offers transparent multi-homing APIs that ensure that your application can operate against logical endpoints and can transparently route the requests to the new region in case of failover.</span></span> <span data-ttu-id="51f05-294">換句話說，進行區域性容錯移轉並維持可用性 SLA 的情況下，不需要重新部署您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="51f05-294">Put differently, your application does not need to be redeployed upon regional failover and the availability SLAs are maintained.</span></span>

### <span data-ttu-id="51f05-295"><a id="AvailabilityAndConsistency"></a>可用性和一致性、延遲及輸送量的關聯性</span><span class="sxs-lookup"><span data-stu-id="51f05-295"><a id="AvailabilityAndConsistency"></a>Availability's relationship with consistency, latency, and throughput</span></span>
<span data-ttu-id="51f05-296">可用性和一致性、延遲及輸送量的關聯性，如[一致性和可用性的關聯性](#ConsistencyAndAvailability)、[延遲和可用性的關聯性](#LatencyAndAvailability)及[輸送量和可用性的關聯性](#ThroughputAndAvailability)中所述。</span><span class="sxs-lookup"><span data-stu-id="51f05-296">Availability’s relationship with consistency, latency, and throughput is described in  [Consistency's relationship with availability](#ConsistencyAndAvailability), [Latency's relationship with availability](#LatencyAndAvailability) and [Throughput's relationship with availability](#ThroughputAndAvailability).</span></span> 

## <span data-ttu-id="51f05-297"><a id="GuaranteesAgainstDataLoss"></a>「資料遺失」的保證和系統行為</span><span class="sxs-lookup"><span data-stu-id="51f05-297"><a id="GuaranteesAgainstDataLoss"></a>Guarantees and system behavior for "data loss"</span></span>
<span data-ttu-id="51f05-298">在 Azure Cosmos DB 中，每個分割區 (集合) 都有數個複本散佈在至少 10-20 個容錯網域，藉以提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="51f05-298">In Azure Cosmos DB, each partition (of a collection) is made highly available by a number of replicas, which are spread across at least 10-20 fault domains.</span></span> <span data-ttu-id="51f05-299">所有寫入在對用戶端認可之前，均會由複本的多數仲裁同步且永久地認可。</span><span class="sxs-lookup"><span data-stu-id="51f05-299">All writes are synchronously and durably committed by a majority quorum of replicas before they are acknowledged to the client.</span></span> <span data-ttu-id="51f05-300">協調分散在多個區域的資料分割，需要套用非同步複寫。</span><span class="sxs-lookup"><span data-stu-id="51f05-300">Asynchronous replication is applied with coordination across partitions spread across multiple regions.</span></span> <span data-ttu-id="51f05-301">Azure Cosmos DB 保證租用戶起始的手動容錯移轉零資料遺失。</span><span class="sxs-lookup"><span data-stu-id="51f05-301">Azure Cosmos DB guarantees that there is no data loss for a tenant-initiated manual failover.</span></span> <span data-ttu-id="51f05-302">在自動容錯移轉期間，Azure Cosmos DB 在其 SLA 中保證資料遺失期間為已設定之限定過期間隔的上限。</span><span class="sxs-lookup"><span data-stu-id="51f05-302">During automatic failover, Azure Cosmos DB guarantees an upper bound of the configured bounded staleness interval on the data loss window as part of its SLA.</span></span>

## <span data-ttu-id="51f05-303"><a id="CustomerFacingSLAMetrics"></a>客戶面向 SLA 計量</span><span class="sxs-lookup"><span data-stu-id="51f05-303"><a id="CustomerFacingSLAMetrics"></a>Customer-facing SLA metrics</span></span>
<span data-ttu-id="51f05-304">Azure Cosmos DB 會直接公開輸送量、延遲、一致性和可用性計量。</span><span class="sxs-lookup"><span data-stu-id="51f05-304">Azure Cosmos DB transparently exposes the throughput, latency, consistency and availability metrics.</span></span> <span data-ttu-id="51f05-305">這些計量可以程式設計方式或透過 Azure 入口網站存取 (請見下圖)。</span><span class="sxs-lookup"><span data-stu-id="51f05-305">These metrics are accessible programmatically and via the Azure portal (see following figure).</span></span> <span data-ttu-id="51f05-306">您也可以設定各種使用 Azure Application Insights 的臨界值警示。</span><span class="sxs-lookup"><span data-stu-id="51f05-306">You can also set up alerts on various thresholds using Azure Application Insights.</span></span>
 
<span data-ttu-id="51f05-307">**每個租用戶都能直接取得一致性、延遲、輸送量和可用性計量資訊**</span><span class="sxs-lookup"><span data-stu-id="51f05-307">**Consistency, Latency, Throughput, and Availability metrics are transparently available to each tenant**</span></span>

![Azure Cosmos DB 客戶可見的 SLA 計量](./media/distribute-data-globally/customer-slas.png)

## <span data-ttu-id="51f05-309"><a id="Next Steps"></a>接續步驟</span><span class="sxs-lookup"><span data-stu-id="51f05-309"><a id="Next Steps"></a>Next steps</span></span>
* <span data-ttu-id="51f05-310">若要使用 Azure 入口網站對您的 Azure Cosmos DB 帳戶實作全域複寫，請參閱[如何使用 Azure 入口網站執行 Azure Cosmos DB 全域資料庫複寫](tutorial-global-distribution-documentdb.md)。</span><span class="sxs-lookup"><span data-stu-id="51f05-310">To implement global replication on your Azure Cosmos DB account using the Azure portal, see [How to perform Azure Cosmos DB global database replication using the Azure portal](tutorial-global-distribution-documentdb.md).</span></span>
* <span data-ttu-id="51f05-311">若要了解如何使用 Azure Cosmos DB 實作多重主機架構，請參閱[使用 Azure Cosmos DB 的多重主機資料庫架構](multi-region-writers.md)。</span><span class="sxs-lookup"><span data-stu-id="51f05-311">To learn about how to implement multi-master architectures with Azure Cosmos DB, see [Multi-master database architectures with Azure Cosmos DB](multi-region-writers.md).</span></span>
* <span data-ttu-id="51f05-312">若要深入了解自動和手動容錯移轉如何在 Azure Cosmos DB 中運作，請參閱 [Azure Cosmos DB 的區域性容錯移轉](regional-failover.md)。</span><span class="sxs-lookup"><span data-stu-id="51f05-312">To learn more about how automatic and manual failovers work in Azure Cosmos DB, see [Regional Failovers in Azure Cosmos DB](regional-failover.md).</span></span>

## <span data-ttu-id="51f05-313"><a id="References"></a>參考</span><span class="sxs-lookup"><span data-stu-id="51f05-313"><a id="References"></a>References</span></span>
1. <span data-ttu-id="51f05-314">Eric Brewer。</span><span class="sxs-lookup"><span data-stu-id="51f05-314">Eric Brewer.</span></span> [<span data-ttu-id="51f05-315">面對健全的分散式系統 (英文)</span><span class="sxs-lookup"><span data-stu-id="51f05-315">Towards Robust Distributed Systems</span></span>](https://people.eecs.berkeley.edu/~brewer/cs262b-2004/PODC-keynote.pdf)
2. <span data-ttu-id="51f05-316">Eric Brewer。</span><span class="sxs-lookup"><span data-stu-id="51f05-316">Eric Brewer.</span></span> [<span data-ttu-id="51f05-317">CAP 12 年後 - 規則如何變化(英文)</span><span class="sxs-lookup"><span data-stu-id="51f05-317">CAP Twelve Years Later – How the rules have changed</span></span>](http://informatik.unibas.ch/fileadmin/Lectures/HS2012/CS341/workshops/reportsAndSlides/PresentationKevinUrban.pdf)
3. <span data-ttu-id="51f05-318">Gilbert、Lynch。</span><span class="sxs-lookup"><span data-stu-id="51f05-318">Gilbert, Lynch.</span></span><span data-ttu-id="51f05-319"> - [一致、可用、資料分割容錯 Web 服務的布魯爾推測和可行性](http://www.glassbeam.com/sites/all/themes/glassbeam/images/blog/10.1.1.67.6951.pdf) (英文)</span><span class="sxs-lookup"><span data-stu-id="51f05-319"> - [Brewer&#39;s Conjecture and Feasibility of Consistent, Available, Partition Tolerant Web Services](http://www.glassbeam.com/sites/all/themes/glassbeam/images/blog/10.1.1.67.6951.pdf)</span></span>
4. <span data-ttu-id="51f05-320">Daniel Abadi。</span><span class="sxs-lookup"><span data-stu-id="51f05-320">Daniel Abadi.</span></span> [<span data-ttu-id="51f05-321">現代分散式資料庫系統設計的一致性取捨 (英文)</span><span class="sxs-lookup"><span data-stu-id="51f05-321">Consistency Tradeoffs in Modern Distributed Database Systems Design</span></span>](http://cs-www.cs.yale.edu/homes/dna/papers/abadi-pacelc.pdf)
5. <span data-ttu-id="51f05-322">Martin Kleppmann。</span><span class="sxs-lookup"><span data-stu-id="51f05-322">Martin Kleppmann.</span></span> [<span data-ttu-id="51f05-323">不要再以 CP 或 AP 來稱呼資料庫 (英文)</span><span class="sxs-lookup"><span data-stu-id="51f05-323">Please stop calling databases CP or AP</span></span>](https://martin.kleppmann.com/2015/05/11/please-stop-calling-databases-cp-or-ap.html)
6. <span data-ttu-id="51f05-324">Peter Bailis et al。[實際部分仲裁的隨機限定過期 (PBS) (英文)](http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf)</span><span class="sxs-lookup"><span data-stu-id="51f05-324">Peter Bailis et al. [Probabilistic Bounded Staleness (PBS) for Practical Partial Quorums](http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf)</span></span>
7. <span data-ttu-id="51f05-325">Naor 和 Wool。</span><span class="sxs-lookup"><span data-stu-id="51f05-325">Naor and Wool.</span></span> [<span data-ttu-id="51f05-326">仲裁系統的負載、容量及可用性 (英文)</span><span class="sxs-lookup"><span data-stu-id="51f05-326">Load, Capacity and Availability in Quorum Systems</span></span>](http://www.cs.utexas.edu/~lorenzo/corsi/cs395t/04S/notes/naor98load.pdf)
8. <span data-ttu-id="51f05-327">Herlihy 和 Wing。</span><span class="sxs-lookup"><span data-stu-id="51f05-327">Herlihy and Wing.</span></span> [<span data-ttu-id="51f05-328">線性：並行物件的正確性條件 (英文)</span><span class="sxs-lookup"><span data-stu-id="51f05-328">Lineralizability: A correctness condition for concurrent objects</span></span>](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf)
9. [<span data-ttu-id="51f05-329">Azure Cosmos DB SLA</span><span class="sxs-lookup"><span data-stu-id="51f05-329">Azure Cosmos DB SLA</span></span>](https://azure.microsoft.com/support/legal/sla/cosmos-db/)
