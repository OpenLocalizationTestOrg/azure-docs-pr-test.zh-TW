---
title: "使用 OpenID Connect 的 Web 登入 - Azure AD B2C | Microsoft Docs"
description: "使用 OpenID Connect 驗證通訊協定的 Azure Active Directory 實作來建置 Web 應用程式"
services: active-directory-b2c
documentationcenter: 
author: saeedakhter-msft
manager: krassk
editor: parakhj
ms.assetid: 21d420c8-3c10-4319-b681-adf2e89e7ede
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/16/2017
ms.author: saeedakhter-msft
ms.openlocfilehash: b0c33a47dd0cae79eab32ac578448fae8bf59be5
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="azure-active-directory-b2c-web-sign-in-with-openid-connect"></a><span data-ttu-id="b2071-103">Azure Active Directory B2C：利用 OpenID Connect 的 Web 登入</span><span class="sxs-lookup"><span data-stu-id="b2071-103">Azure Active Directory B2C: Web sign-in with OpenID Connect</span></span>
<span data-ttu-id="b2071-104">OpenID Connect 是建置在 OAuth 2.0 之上的驗證通訊協定，可用來將使用者安全地登入 Web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="b2071-104">OpenID Connect is an authentication protocol, built on top of OAuth 2.0, that can be used to securely sign users in to web applications.</span></span> <span data-ttu-id="b2071-105">藉由使用 OpenID Connect 的 Azure Active Directory B2C (Azure AD B2C) 實作，您就能將 Web 應用程式中的註冊、登入及其他識別管理體驗外包給 Azure Active Directory (Azure AD)。</span><span class="sxs-lookup"><span data-stu-id="b2071-105">By using the Azure Active Directory B2C (Azure AD B2C) implementation of OpenID Connect, you can outsource sign-up, sign-in, and other identity management experiences in your web applications to Azure Active Directory (Azure AD).</span></span> <span data-ttu-id="b2071-106">本指南會以與語言無關的方式示範如何執行此動作。</span><span class="sxs-lookup"><span data-stu-id="b2071-106">This guide shows you how to do so in a language-independent manner.</span></span> <span data-ttu-id="b2071-107">而是在說明如何傳送和接收 HTTP 訊息，但不使用我們的任何開放原始碼程式庫。</span><span class="sxs-lookup"><span data-stu-id="b2071-107">It describes how to send and receive HTTP messages without using any of our open-source libraries.</span></span>

<span data-ttu-id="b2071-108">[OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html) 擴充 OAuth 2.0 的*授權*通訊協定來做為*驗證*通訊協定。</span><span class="sxs-lookup"><span data-stu-id="b2071-108">[OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html) extends the OAuth 2.0 *authorization* protocol for use as an *authentication* protocol.</span></span> <span data-ttu-id="b2071-109">讓您能利用 OAuth 來執行單一登入。</span><span class="sxs-lookup"><span data-stu-id="b2071-109">This allows you to perform single sign-on by using OAuth.</span></span> <span data-ttu-id="b2071-110">它引進「識別碼權杖」的概念，這是一種安全性權杖，可讓用戶端驗證使用者的身分識別，並取得有關使用者的基本設定檔資訊。</span><span class="sxs-lookup"><span data-stu-id="b2071-110">It introduces the concept of an *ID token*, which is a security token that allows the client to verify the identity of the user and obtain basic profile information about the user.</span></span>

<span data-ttu-id="b2071-111">由於它會擴充 OAuth 2.0，因此也能讓應用程式安全地取得「存取權杖」。</span><span class="sxs-lookup"><span data-stu-id="b2071-111">Because it extends OAuth 2.0, it also enables apps to securely acquire *access tokens*.</span></span> <span data-ttu-id="b2071-112">您可以使用 access_tokens，來存取受到[授權伺服器](active-directory-b2c-reference-protocols.md#the-basics)保護的資源。</span><span class="sxs-lookup"><span data-stu-id="b2071-112">You can use access_tokens to access resources that are secured by an [authorization server](active-directory-b2c-reference-protocols.md#the-basics).</span></span> <span data-ttu-id="b2071-113">如果您要建置的 Web 應用程式是裝載在伺服器上，且必須透過瀏覽器來存取，我們建議您使用 OpenID Connect。</span><span class="sxs-lookup"><span data-stu-id="b2071-113">We recommend OpenID Connect if you're building a web application that is hosted on a server and accessed through a browser.</span></span> <span data-ttu-id="b2071-114">如果您想要利用 Azure AD B2C 在行動或桌面應用程式中新增身分識別管理功能，您應該要使用 [OAuth 2.0](active-directory-b2c-reference-oauth-code.md) ，而不是 OpenID Connect。</span><span class="sxs-lookup"><span data-stu-id="b2071-114">If you want to add identity management to your mobile or desktop applications by using Azure AD B2C, you should use [OAuth 2.0](active-directory-b2c-reference-oauth-code.md) rather than OpenID Connect.</span></span>

<span data-ttu-id="b2071-115">Azure AD B2C 擴充標準的 OpenID Connect 通訊協定，功能更強大，而不僅止於簡單的驗證和授權。</span><span class="sxs-lookup"><span data-stu-id="b2071-115">Azure AD B2C extends the standard OpenID Connect protocol to do more than simple authentication and authorization.</span></span> <span data-ttu-id="b2071-116">它引進[原則參數](active-directory-b2c-reference-policies.md)，讓您能利用 OpenID Connect 來為應用程式新增使用者體驗，例如註冊、登入和設定檔管理。</span><span class="sxs-lookup"><span data-stu-id="b2071-116">It introduces the [policy parameter](active-directory-b2c-reference-policies.md), which enables you to use OpenID Connect to add user experiences--such as sign-up, sign-in, and profile management--to your app.</span></span> <span data-ttu-id="b2071-117">以下我們將示範如何利用 OpenID Connect 和原則，在您的 Web 應用程式中實作上述每一種體驗。</span><span class="sxs-lookup"><span data-stu-id="b2071-117">Here, we show you how to use OpenID Connect and policies to implement each of these experiences in your web applications.</span></span> <span data-ttu-id="b2071-118">我們也會示範如何取得用來存取 Web API 的存取權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-118">We'll also show you how to get access tokens for accessing web APIs.</span></span>

<span data-ttu-id="b2071-119">下一節中的範例 HTTP 要求會使用我們的範例 B2C 目錄 fabrikamb2c.onmicrosoft.com，以及我們的範例應用程式 https://aadb2cplayground.azurewebsites.net 和原則。</span><span class="sxs-lookup"><span data-stu-id="b2071-119">The example HTTP requests in the next section use our sample B2C directory, fabrikamb2c.onmicrosoft.com, as well as our sample application, https://aadb2cplayground.azurewebsites.net, and policies.</span></span> <span data-ttu-id="b2071-120">您可以隨意使用這些值來自行試驗要求，也可以把它們換成您自己的值。</span><span class="sxs-lookup"><span data-stu-id="b2071-120">You're free to try out the requests yourself by using these values, or you can replace them with your own.</span></span>
<span data-ttu-id="b2071-121">了解如何 [取得您自己的 B2C 租用戶、應用程式和原則](#use-your-own-b2c-directory)。</span><span class="sxs-lookup"><span data-stu-id="b2071-121">Learn how to [get your own B2C tenant, application, and policies](#use-your-own-b2c-directory).</span></span>

## <a name="send-authentication-requests"></a><span data-ttu-id="b2071-122">傳送驗證要求</span><span class="sxs-lookup"><span data-stu-id="b2071-122">Send authentication requests</span></span>
<span data-ttu-id="b2071-123">當 Web 應用程式需要驗證使用者和執行原則時，它可以將使用者導向至 `/authorize` 端點。</span><span class="sxs-lookup"><span data-stu-id="b2071-123">When your web app needs to authenticate the user and execute a policy, it can direct the user to the `/authorize` endpoint.</span></span> <span data-ttu-id="b2071-124">這是流程中的互動部分，可根據原則讓使用者能夠採取行動。</span><span class="sxs-lookup"><span data-stu-id="b2071-124">This is the interactive portion of the flow, where the user takes action, depending on the policy.</span></span>

<span data-ttu-id="b2071-125">在這項要求中，用戶端會在 `scope` 參數中指出它需要向使用者要求的權限，以及在 `p` 參數中指出它要執行的原則。</span><span class="sxs-lookup"><span data-stu-id="b2071-125">In this request, the client indicates the permissions that it needs to acquire from the user in the `scope` parameter and the policy to execute in the `p` parameter.</span></span> <span data-ttu-id="b2071-126">後續小節中提供三個範例 (含有換行符號以提高可讀性)，各使用不同的原則。</span><span class="sxs-lookup"><span data-stu-id="b2071-126">Three examples are provided in the following sections (with line breaks for readability), each using a different policy.</span></span> <span data-ttu-id="b2071-127">為了瞭解每個要求的運作方式，請試著將要求貼到瀏覽器來執行。</span><span class="sxs-lookup"><span data-stu-id="b2071-127">To get a feel for how each request works, try pasting the request into a browser and running it.</span></span>

#### <a name="use-a-sign-in-policy"></a><span data-ttu-id="b2071-128">使用登入原則</span><span class="sxs-lookup"><span data-stu-id="b2071-128">Use a sign-in policy</span></span>
```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code+id_token
&redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
&response_mode=form_post
&scope=openid%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&nonce=12345
&p=b2c_1_sign_in
```

#### <a name="use-a-sign-up-policy"></a><span data-ttu-id="b2071-129">使用註冊原則</span><span class="sxs-lookup"><span data-stu-id="b2071-129">Use a sign-up policy</span></span>
```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code+id_token
&redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
&response_mode=form_post
&scope=openid%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&nonce=12345
&p=b2c_1_sign_up
```

#### <a name="use-an-edit-profile-policy"></a><span data-ttu-id="b2071-130">使用編輯設定檔原則</span><span class="sxs-lookup"><span data-stu-id="b2071-130">Use an edit-profile policy</span></span>
```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code+id_token
&redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
&response_mode=form_post
&scope=openid%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&nonce=12345
&p=b2c_1_edit_profile
```

| <span data-ttu-id="b2071-131">參數</span><span class="sxs-lookup"><span data-stu-id="b2071-131">Parameter</span></span> | <span data-ttu-id="b2071-132">必要？</span><span class="sxs-lookup"><span data-stu-id="b2071-132">Required?</span></span> | <span data-ttu-id="b2071-133">說明</span><span class="sxs-lookup"><span data-stu-id="b2071-133">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="b2071-134">client_id</span><span class="sxs-lookup"><span data-stu-id="b2071-134">client_id</span></span> |<span data-ttu-id="b2071-135">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-135">Required</span></span> |<span data-ttu-id="b2071-136">[Azure 入口網站](https://portal.azure.com/) 指派給您應用程式的應用程式識別碼。</span><span class="sxs-lookup"><span data-stu-id="b2071-136">The application ID that the [Azure portal](https://portal.azure.com/) assigned to your app.</span></span> |
| <span data-ttu-id="b2071-137">response_type</span><span class="sxs-lookup"><span data-stu-id="b2071-137">response_type</span></span> |<span data-ttu-id="b2071-138">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-138">Required</span></span> |<span data-ttu-id="b2071-139">回應類型，其中必須包含適用於 OpenID Connect 的識別碼權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-139">The response type, which must include an ID token for OpenID Connect.</span></span> <span data-ttu-id="b2071-140">如果您的 Web 應用程式也需要權杖來呼叫 Web API，則可以使用 `code+id_token`，如同這裡的作法。</span><span class="sxs-lookup"><span data-stu-id="b2071-140">If your web app also needs tokens for calling a web API, you can use `code+id_token`, as we've done here.</span></span> |
| <span data-ttu-id="b2071-141">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="b2071-141">redirect_uri</span></span> |<span data-ttu-id="b2071-142">建議</span><span class="sxs-lookup"><span data-stu-id="b2071-142">Recommended</span></span> |<span data-ttu-id="b2071-143">應用程式的 `redirect_uri` 參數，您的應用程式可在此傳送及接收驗證回應。</span><span class="sxs-lookup"><span data-stu-id="b2071-143">The `redirect_uri` parameter of your app, where authentication responses can be sent and received by your app.</span></span> <span data-ttu-id="b2071-144">它必須與您在入口網站中註冊的其中一個 `redirect_uri` 參數完全相符，不過必須是 URL 編碼格式。</span><span class="sxs-lookup"><span data-stu-id="b2071-144">It must exactly match one of the `redirect_uri` parameters that you registered in the portal, except that it must be URL encoded.</span></span> |
| <span data-ttu-id="b2071-145">scope</span><span class="sxs-lookup"><span data-stu-id="b2071-145">scope</span></span> |<span data-ttu-id="b2071-146">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-146">Required</span></span> |<span data-ttu-id="b2071-147">範圍的空格分隔清單。</span><span class="sxs-lookup"><span data-stu-id="b2071-147">A space-separated list of scopes.</span></span> <span data-ttu-id="b2071-148">向 Azure AD 指出要求兩個權限的單一範圍值。</span><span class="sxs-lookup"><span data-stu-id="b2071-148">A single scope value indicates to Azure AD both permissions that are being requested.</span></span> <span data-ttu-id="b2071-149">`openid` 範圍指示使用識別碼權杖形式的權限，以登入使用者及取得使用者相關資料 (本文稍後將進一步說明)。</span><span class="sxs-lookup"><span data-stu-id="b2071-149">The `openid` scope indicates a permission to sign in the user and get data about the user in the form of ID tokens (more to come on this later in the article).</span></span> <span data-ttu-id="b2071-150">對於 Web 應用程式， `offline_access` 範圍是選擇性。</span><span class="sxs-lookup"><span data-stu-id="b2071-150">The `offline_access` scope is optional for web apps.</span></span> <span data-ttu-id="b2071-151">它表示您的應用程式將需要「重新整理權杖」，才能長久存取資源。</span><span class="sxs-lookup"><span data-stu-id="b2071-151">It indicates that your app will need a *refresh token* for long-lived access to resources.</span></span> |
| <span data-ttu-id="b2071-152">response_mode</span><span class="sxs-lookup"><span data-stu-id="b2071-152">response_mode</span></span> |<span data-ttu-id="b2071-153">建議</span><span class="sxs-lookup"><span data-stu-id="b2071-153">Recommended</span></span> |<span data-ttu-id="b2071-154">應該用來將產生的授權碼傳回應用程式的方法。</span><span class="sxs-lookup"><span data-stu-id="b2071-154">The method that should be used to send the resulting authorization code back to your app.</span></span> <span data-ttu-id="b2071-155">它可以是 `query`、`form_post` 或 `fragment`。</span><span class="sxs-lookup"><span data-stu-id="b2071-155">It can be either `query`, `form_post`, or `fragment`.</span></span>  <span data-ttu-id="b2071-156">如需最佳安全性，建議使用 `form_post` 回應模式。</span><span class="sxs-lookup"><span data-stu-id="b2071-156">The `form_post` response mode is recommended for best security.</span></span> |
| <span data-ttu-id="b2071-157">state</span><span class="sxs-lookup"><span data-stu-id="b2071-157">state</span></span> |<span data-ttu-id="b2071-158">建議</span><span class="sxs-lookup"><span data-stu-id="b2071-158">Recommended</span></span> |<span data-ttu-id="b2071-159">要求中包含的值，也會隨權杖回應傳回。</span><span class="sxs-lookup"><span data-stu-id="b2071-159">A value included in the request that is also returned in the token response.</span></span> <span data-ttu-id="b2071-160">它可以是您所想要內容中的字串。</span><span class="sxs-lookup"><span data-stu-id="b2071-160">It can be a string of any content that you want.</span></span> <span data-ttu-id="b2071-161">隨機產生的唯一值通常用於防止跨站台要求偽造攻擊。</span><span class="sxs-lookup"><span data-stu-id="b2071-161">A randomly generated unique value is typically used for preventing cross-site request forgery attacks.</span></span> <span data-ttu-id="b2071-162">驗證要求出現前，也會先使用此狀態為使用者在應用程式中的狀態資訊編碼，例如他們先前所在的網頁。</span><span class="sxs-lookup"><span data-stu-id="b2071-162">The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page they were on.</span></span> |
| <span data-ttu-id="b2071-163">nonce</span><span class="sxs-lookup"><span data-stu-id="b2071-163">nonce</span></span> |<span data-ttu-id="b2071-164">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-164">Required</span></span> |<span data-ttu-id="b2071-165">要求中包含的值 (由應用程式產生)，將包含於所產生的識別碼權杖中以作為宣告。</span><span class="sxs-lookup"><span data-stu-id="b2071-165">A value included in the request (generated by the app) that will be included in the resulting ID token as a claim.</span></span> <span data-ttu-id="b2071-166">應用程式接著便可確認此值，以減少權杖重新執行攻擊。</span><span class="sxs-lookup"><span data-stu-id="b2071-166">The app can then verify this value to mitigate token replay attacks.</span></span> <span data-ttu-id="b2071-167">此值通常是隨機的唯一字串，可用以識別要求的來源。</span><span class="sxs-lookup"><span data-stu-id="b2071-167">The value is typically a randomized unique string that can be used to identify the origin of the request.</span></span> |
| <span data-ttu-id="b2071-168">p</span><span class="sxs-lookup"><span data-stu-id="b2071-168">p</span></span> |<span data-ttu-id="b2071-169">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-169">Required</span></span> |<span data-ttu-id="b2071-170">系統將會執行的原則。</span><span class="sxs-lookup"><span data-stu-id="b2071-170">The policy that will be executed.</span></span> <span data-ttu-id="b2071-171">這是在您的 B2C 租用戶中所建立的原則名稱。</span><span class="sxs-lookup"><span data-stu-id="b2071-171">It is the name of a policy that is created in your B2C tenant.</span></span> <span data-ttu-id="b2071-172">原則名稱值的開頭必須是 `b2c\_1\_`。</span><span class="sxs-lookup"><span data-stu-id="b2071-172">The policy name value should begin with `b2c\_1\_`.</span></span> <span data-ttu-id="b2071-173">深入了解原則與[可延伸原則架構](active-directory-b2c-reference-policies.md)。</span><span class="sxs-lookup"><span data-stu-id="b2071-173">Learn more about policies and the [extensible policy framework](active-directory-b2c-reference-policies.md).</span></span> |
| <span data-ttu-id="b2071-174">prompt</span><span class="sxs-lookup"><span data-stu-id="b2071-174">prompt</span></span> |<span data-ttu-id="b2071-175">選用</span><span class="sxs-lookup"><span data-stu-id="b2071-175">Optional</span></span> |<span data-ttu-id="b2071-176">需要的使用者互動類型。</span><span class="sxs-lookup"><span data-stu-id="b2071-176">The type of user interaction that is required.</span></span> <span data-ttu-id="b2071-177">此時唯一有效的值是 `login`，可強制使用者針對該要求輸入其認證。</span><span class="sxs-lookup"><span data-stu-id="b2071-177">The only valid value at this time is `login`, which forces the user to enter their credentials on that request.</span></span> <span data-ttu-id="b2071-178">單一登入將沒有作用。</span><span class="sxs-lookup"><span data-stu-id="b2071-178">Single sign-on will not take effect.</span></span> |

<span data-ttu-id="b2071-179">此時會要求使用者完成原則的工作流程。</span><span class="sxs-lookup"><span data-stu-id="b2071-179">At this point, the user is asked to complete the policy's workflow.</span></span> <span data-ttu-id="b2071-180">視原則的定義方式而定，這可能會牽涉到讓使用者輸入自己的使用者名稱及密碼、以社交身分識別登入、註冊目錄，或是其他任何數目的步驟。</span><span class="sxs-lookup"><span data-stu-id="b2071-180">This might involve the user entering their username and password, signing in with a social identity, signing up for the directory, or any other number of steps, depending on how the policy is defined.</span></span>

<span data-ttu-id="b2071-181">當使用者完成原則之後，Azure AD 就會使用 `response_mode` 參數中指定的方法，以指示的 `redirect_uri` 參數將回應傳回您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="b2071-181">After the user completes the policy, Azure AD returns a response to your app at the indicated `redirect_uri` parameter, by using the method that is specified in the `response_mode` parameter.</span></span> <span data-ttu-id="b2071-182">上述各種情況的回應均相同，與已執行的原則無關。</span><span class="sxs-lookup"><span data-stu-id="b2071-182">The response is the same for each of the preceding cases, independent of the policy that is executed.</span></span>

<span data-ttu-id="b2071-183">使用 `response_mode=fragment` 的成功回應如下所示：</span><span class="sxs-lookup"><span data-stu-id="b2071-183">A successful response using `response_mode=fragment` would look like:</span></span>

```
GET https://aadb2cplayground.azurewebsites.net/#
id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...
&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...
&state=arbitrary_data_you_can_receive_in_the_response
```

| <span data-ttu-id="b2071-184">參數</span><span class="sxs-lookup"><span data-stu-id="b2071-184">Parameter</span></span> | <span data-ttu-id="b2071-185">說明</span><span class="sxs-lookup"><span data-stu-id="b2071-185">Description</span></span> |
| --- | --- |
| <span data-ttu-id="b2071-186">id_token</span><span class="sxs-lookup"><span data-stu-id="b2071-186">id_token</span></span> |<span data-ttu-id="b2071-187">應用程式所要求的識別碼權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-187">The ID token that the app requested.</span></span> <span data-ttu-id="b2071-188">您可以使用識別碼權杖來確認使用者的身分識別，然後開始與使用者的工作階段。</span><span class="sxs-lookup"><span data-stu-id="b2071-188">You can use the ID token to verify the user's identity and begin a session with the user.</span></span> <span data-ttu-id="b2071-189">如需識別碼權杖及其內容的詳細資料，請參閱 [Azure AD B2C 權杖參考](active-directory-b2c-reference-tokens.md)。</span><span class="sxs-lookup"><span data-stu-id="b2071-189">More details on ID tokens and their contents are included in the [Azure AD B2C token reference](active-directory-b2c-reference-tokens.md).</span></span> |
| <span data-ttu-id="b2071-190">code</span><span class="sxs-lookup"><span data-stu-id="b2071-190">code</span></span> |<span data-ttu-id="b2071-191">應用程式要求的授權碼 (如果您使用 `response_type=code+id_token`)。</span><span class="sxs-lookup"><span data-stu-id="b2071-191">The authorization code that the app requested, if you used `response_type=code+id_token`.</span></span> <span data-ttu-id="b2071-192">應用程式可以使用授權碼來要求目標資源的存取權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-192">The app can use the authorization code to request an access token for a target resource.</span></span> <span data-ttu-id="b2071-193">授權碼的存留期很短。</span><span class="sxs-lookup"><span data-stu-id="b2071-193">Authorization codes are very short-lived.</span></span> <span data-ttu-id="b2071-194">通常會在大約 10 分鐘後過期。</span><span class="sxs-lookup"><span data-stu-id="b2071-194">Typically, they expire after about 10 minutes.</span></span> |
| <span data-ttu-id="b2071-195">state</span><span class="sxs-lookup"><span data-stu-id="b2071-195">state</span></span> |<span data-ttu-id="b2071-196">如果要求中包含 `state` 參數，回應中就應該出現相同的值。</span><span class="sxs-lookup"><span data-stu-id="b2071-196">If a `state` parameter is included in the request, the same value should appear in the response.</span></span> <span data-ttu-id="b2071-197">應用程式應確認要求和回應中的 `state` 值完全相同。</span><span class="sxs-lookup"><span data-stu-id="b2071-197">The app should verify that the `state` values in the request and response are identical.</span></span> |

<span data-ttu-id="b2071-198">錯誤回應也能夠傳送到 `redirect_uri` 參數，讓應用程式能適當地處理：</span><span class="sxs-lookup"><span data-stu-id="b2071-198">Error responses can also be sent to the `redirect_uri` parameter so that the app can handle them appropriately:</span></span>

```
GET https://aadb2cplayground.azurewebsites.net/#
error=access_denied
&error_description=the+user+canceled+the+authentication
&state=arbitrary_data_you_can_receive_in_the_response
```

| <span data-ttu-id="b2071-199">參數</span><span class="sxs-lookup"><span data-stu-id="b2071-199">Parameter</span></span> | <span data-ttu-id="b2071-200">說明</span><span class="sxs-lookup"><span data-stu-id="b2071-200">Description</span></span> |
| --- | --- |
| <span data-ttu-id="b2071-201">錯誤</span><span class="sxs-lookup"><span data-stu-id="b2071-201">error</span></span> |<span data-ttu-id="b2071-202">可用以分類所發生的錯誤類型，以及可用來回應錯誤的錯誤碼字串。</span><span class="sxs-lookup"><span data-stu-id="b2071-202">An error-code string that can be used to classify types of errors that occur and that can be used to react to errors.</span></span> |
| <span data-ttu-id="b2071-203">error_description</span><span class="sxs-lookup"><span data-stu-id="b2071-203">error_description</span></span> |<span data-ttu-id="b2071-204">協助開發人員識別驗證錯誤根本原因的特定錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="b2071-204">A specific error message that can help a developer identify the root cause of an authentication error.</span></span> |
| <span data-ttu-id="b2071-205">state</span><span class="sxs-lookup"><span data-stu-id="b2071-205">state</span></span> |<span data-ttu-id="b2071-206">如需完整說明，請參閱本節的第一個表格。</span><span class="sxs-lookup"><span data-stu-id="b2071-206">See the full description in the first table in this section.</span></span> <span data-ttu-id="b2071-207">如果要求中包含 `state` 參數，回應中就應該出現相同的值。</span><span class="sxs-lookup"><span data-stu-id="b2071-207">If a `state` parameter is included in the request, the same value should appear in the response.</span></span> <span data-ttu-id="b2071-208">應用程式應確認要求和回應中的 `state` 值完全相同。</span><span class="sxs-lookup"><span data-stu-id="b2071-208">The app should verify that the `state` values in the request and response are identical.</span></span> |

## <a name="validate-the-id-token"></a><span data-ttu-id="b2071-209">驗證識別碼權杖</span><span class="sxs-lookup"><span data-stu-id="b2071-209">Validate the ID token</span></span>
<span data-ttu-id="b2071-210">只收到識別碼權杖並不足以驗證使用者。</span><span class="sxs-lookup"><span data-stu-id="b2071-210">Just receiving an ID token is not enough to authenticate the user.</span></span> <span data-ttu-id="b2071-211">您必須驗證識別碼權杖的簽章，並依照應用程式的要求來確認權杖中的宣告。</span><span class="sxs-lookup"><span data-stu-id="b2071-211">You must validate the ID token's signature and verify the claims in the token per your app's requirements.</span></span> <span data-ttu-id="b2071-212">Azure AD B2C 使用 [JSON Web Tokens (JWT)](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html) 和公開金鑰加密編譯來簽署權杖及驗證其是否有效。</span><span class="sxs-lookup"><span data-stu-id="b2071-212">Azure AD B2C uses [JSON Web Tokens (JWTs)](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html) and public key cryptography to sign tokens and verify that they are valid.</span></span>

<span data-ttu-id="b2071-213">視您偏好的語言而定，有許多針對驗證 JWT 的開放原始碼程式庫可用。</span><span class="sxs-lookup"><span data-stu-id="b2071-213">There are many open-source libraries that are available for validating JWTs, depending on your language of preference.</span></span> <span data-ttu-id="b2071-214">我們建議您探索這些程式庫，而不是實作您自己的驗證邏輯。</span><span class="sxs-lookup"><span data-stu-id="b2071-214">We recommend exploring those options rather than implementing your own validation logic.</span></span> <span data-ttu-id="b2071-215">當您在思考如何適當地運用那些程式庫時，這裡的資訊會很有用。</span><span class="sxs-lookup"><span data-stu-id="b2071-215">The information here will be useful in figuring out how to properly use those libraries.</span></span>

<span data-ttu-id="b2071-216">Azure AD B2C 具有 OpenID Connect 中繼資料端點，可讓應用程式在執行階段提取 Azure AD B2C 的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="b2071-216">Azure AD B2C has an OpenID Connect metadata endpoint, which allows an app to fetch information about Azure AD B2C at runtime.</span></span> <span data-ttu-id="b2071-217">這項資訊包括端點、權杖內容和權杖簽署金鑰。</span><span class="sxs-lookup"><span data-stu-id="b2071-217">This information includes endpoints, token contents, and token signing keys.</span></span> <span data-ttu-id="b2071-218">您的 B2C 租用戶中的每個原則都有一份 JSON 中繼資料文件。</span><span class="sxs-lookup"><span data-stu-id="b2071-218">There is a JSON metadata document for each policy in your B2C tenant.</span></span> <span data-ttu-id="b2071-219">例如，`fabrikamb2c.onmicrosoft.com` 中適用於 `b2c_1_sign_in` 原則的中繼資料文件位於：</span><span class="sxs-lookup"><span data-stu-id="b2071-219">For example, the metadata document for the `b2c_1_sign_in` policy in `fabrikamb2c.onmicrosoft.com` is located at:</span></span>

`https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1_sign_in`

<span data-ttu-id="b2071-220">此設定文件的屬性之一是 `jwks_uri`，就上述原則而言，它的值是：</span><span class="sxs-lookup"><span data-stu-id="b2071-220">One of the properties of this configuration document is `jwks_uri`, whose value for the same policy would be:</span></span>

<span data-ttu-id="b2071-221">`https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/discovery/v2.0/keys?p=b2c_1_sign_in`。</span><span class="sxs-lookup"><span data-stu-id="b2071-221">`https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/discovery/v2.0/keys?p=b2c_1_sign_in`.</span></span>

<span data-ttu-id="b2071-222">若要判斷使用了哪個原則來簽署識別碼權杖 (以及可從何處擷取中繼資料)，您有兩個選項。</span><span class="sxs-lookup"><span data-stu-id="b2071-222">To determine which policy was used in signing an ID token (and from where to fetch the metadata), you have two options.</span></span> <span data-ttu-id="b2071-223">首先，原則名稱包含於識別碼權杖的 `acr` 宣告中。</span><span class="sxs-lookup"><span data-stu-id="b2071-223">First, the policy name is included in the `acr` claim in the ID token.</span></span> <span data-ttu-id="b2071-224">如需如何從識別碼權杖剖析宣告的相關資訊，請參閱 [Azure AD B2C 權杖參考](active-directory-b2c-reference-tokens.md)。</span><span class="sxs-lookup"><span data-stu-id="b2071-224">For information on how to parse the claims from an ID token, see the [Azure AD B2C token reference](active-directory-b2c-reference-tokens.md).</span></span> <span data-ttu-id="b2071-225">另一個選項是當您發出要求時在 `state` 參數的值中將原則編碼，然後將它解碼以判斷使用了哪個原則。</span><span class="sxs-lookup"><span data-stu-id="b2071-225">Your other option is to encode the policy in the value of the `state` parameter when you issue the request, and then decode it to determine which policy was used.</span></span> <span data-ttu-id="b2071-226">任一種方法都有效。</span><span class="sxs-lookup"><span data-stu-id="b2071-226">Either method is valid.</span></span>

<span data-ttu-id="b2071-227">當您從 OpenID Connect 中繼資料端點取得中繼資料文件之後，就可以使用 RSA 256 公開金鑰 (位於此端點) 來驗證識別碼權杖的簽章。</span><span class="sxs-lookup"><span data-stu-id="b2071-227">After you've acquired the metadata document from the OpenID Connect metadata endpoint, you can use the RSA 256 public keys (which are located at this endpoint) to validate the signature of the ID token.</span></span> <span data-ttu-id="b2071-228">此端點隨時都可能列出多個金鑰，每個金鑰都由 `kid` 宣告所識別。</span><span class="sxs-lookup"><span data-stu-id="b2071-228">There might be multiple keys listed at this endpoint at any given point in time, each identified by a `kid` claim.</span></span> <span data-ttu-id="b2071-229">識別碼權杖的標頭也會包含 `kid` 宣告，指出簽署該識別碼權杖所使用的金鑰。</span><span class="sxs-lookup"><span data-stu-id="b2071-229">The header of the ID token also contains a `kid` claim, which indicates which of these keys was used to sign the ID token.</span></span> <span data-ttu-id="b2071-230">如需詳細資訊，請參閱 [Azure AD B2C 權杖參考](active-directory-b2c-reference-tokens.md) (特別是關於[驗證權杖](active-directory-b2c-reference-tokens.md#token-validation)的小節)。</span><span class="sxs-lookup"><span data-stu-id="b2071-230">For more information, see the [Azure AD B2C token reference](active-directory-b2c-reference-tokens.md) (the section on [validating tokens](active-directory-b2c-reference-tokens.md#token-validation), in particular).</span></span>
<!--TODO: Improve the information on this-->

<span data-ttu-id="b2071-231">當您驗證識別碼權杖的簽章之後，必須驗證數個宣告。</span><span class="sxs-lookup"><span data-stu-id="b2071-231">After you've validated the signature of the ID token, there are several claims that you need to verify.</span></span> <span data-ttu-id="b2071-232">例如：</span><span class="sxs-lookup"><span data-stu-id="b2071-232">For instance:</span></span>

* <span data-ttu-id="b2071-233">您應該驗證 `nonce` 宣告以防止權杖重新執行攻擊。</span><span class="sxs-lookup"><span data-stu-id="b2071-233">You should validate the `nonce` claim to prevent token replay attacks.</span></span> <span data-ttu-id="b2071-234">其值應該是您在登入要求中所指定的內容。</span><span class="sxs-lookup"><span data-stu-id="b2071-234">Its value should be what you specified in the sign-in request.</span></span>
* <span data-ttu-id="b2071-235">您應該驗證 `aud` 宣告，以確認識別碼權杖是針對您的應用程式所核發。</span><span class="sxs-lookup"><span data-stu-id="b2071-235">You should validate the `aud` claim to ensure that the ID token was issued for your app.</span></span> <span data-ttu-id="b2071-236">這個值就是您應用程式的應用程式識別碼。</span><span class="sxs-lookup"><span data-stu-id="b2071-236">Its value should be the application ID of your app.</span></span>
* <span data-ttu-id="b2071-237">您應該驗證 `iat` 及 `exp` 宣告，以確保識別碼權杖尚未過期。</span><span class="sxs-lookup"><span data-stu-id="b2071-237">You should validate the `iat` and `exp` claims to ensure that the ID token has not expired.</span></span>

<span data-ttu-id="b2071-238">另外還有數個您應該執行的驗證。</span><span class="sxs-lookup"><span data-stu-id="b2071-238">There are also several more validations that you should perform.</span></span> <span data-ttu-id="b2071-239">詳細說明請參閱 [OpenID Connect 核心規格](http://openid.net/specs/openid-connect-core-1_0.html) \(英文\)。視您的案例而定，您可能也會想要驗證其他宣告。</span><span class="sxs-lookup"><span data-stu-id="b2071-239">These are described in detail in the [OpenID Connect Core Spec](http://openid.net/specs/openid-connect-core-1_0.html).  You might also want to validate additional claims, depending on your scenario.</span></span> <span data-ttu-id="b2071-240">一些常見的驗證包括：</span><span class="sxs-lookup"><span data-stu-id="b2071-240">Some common validations include:</span></span>

* <span data-ttu-id="b2071-241">確保使用者/組織已為應用程式註冊。</span><span class="sxs-lookup"><span data-stu-id="b2071-241">Ensuring that the user/organization has signed up for the app.</span></span>
* <span data-ttu-id="b2071-242">確保使用者有適當的授權/權限。</span><span class="sxs-lookup"><span data-stu-id="b2071-242">Ensuring that the user has proper authorization/privileges.</span></span>
* <span data-ttu-id="b2071-243">確保驗證方式有一定的強度，例如 Azure Multi-Factor Authentication。</span><span class="sxs-lookup"><span data-stu-id="b2071-243">Ensuring that a certain strength of authentication has occurred, such as Azure Multi-Factor Authentication.</span></span>

<span data-ttu-id="b2071-244">如需識別碼權杖中宣告的詳細資訊，請參閱 [Azure AD B2C 權杖參考](active-directory-b2c-reference-tokens.md)。</span><span class="sxs-lookup"><span data-stu-id="b2071-244">For more information on the claims in an ID token, see the [Azure AD B2C token reference](active-directory-b2c-reference-tokens.md).</span></span>

<span data-ttu-id="b2071-245">當您驗證過識別碼權杖之後，便可開始關於該使用者的工作階段。</span><span class="sxs-lookup"><span data-stu-id="b2071-245">After you have validated the ID token, you can begin a session with the user.</span></span> <span data-ttu-id="b2071-246">您可以使用識別碼權杖中的宣告，以便在應用程式中取得使用者的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="b2071-246">You can use the claims in the ID token to obtain information about the user in your app.</span></span> <span data-ttu-id="b2071-247">這項資訊的用途包括顯示、記錄和授權。</span><span class="sxs-lookup"><span data-stu-id="b2071-247">Uses for this information include display, records, and authorization.</span></span>

## <a name="get-a-token"></a><span data-ttu-id="b2071-248">取得權杖</span><span class="sxs-lookup"><span data-stu-id="b2071-248">Get a token</span></span>
<span data-ttu-id="b2071-249">如果您的 Web 應用程式只需執行原則，則可略過接下來的幾節。</span><span class="sxs-lookup"><span data-stu-id="b2071-249">If you need your web app to only execute policies, you can skip the next few sections.</span></span> <span data-ttu-id="b2071-250">這幾節僅適用於需要對 Web API 進行已驗證的呼叫，同時受 Azure AD B2C 保護的 Web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="b2071-250">These sections are applicable only to web apps that need to make authenticated calls to a web API and are also protected by Azure AD B2C.</span></span>

<span data-ttu-id="b2071-251">您可以藉由將 `POST` 要求傳送至 `/token` 端點，將取得 (使用 `response_type=code+id_token`) 的權杖授權碼兌換成所需的資源。</span><span class="sxs-lookup"><span data-stu-id="b2071-251">You can redeem the authorization code that you acquired (by using `response_type=code+id_token`) for a token to the desired resource by sending a `POST` request to the `/token` endpoint.</span></span> <span data-ttu-id="b2071-252">您目前唯一可要求權杖的資源，就是應用程式本身的後端 Web API。</span><span class="sxs-lookup"><span data-stu-id="b2071-252">Currently, the only resource that you can request a token for is your app's own back-end web API.</span></span> <span data-ttu-id="b2071-253">用來為您自己要求權杖的慣例是使用應用程式的用戶端識別碼做為範圍：</span><span class="sxs-lookup"><span data-stu-id="b2071-253">The convention for requesting a token to yourself is to use your app's client ID as the scope:</span></span>

```
POST fabrikamb2c.onmicrosoft.com/oauth2/v2.0/token?p=b2c_1_sign_in HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6&scope=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&redirect_uri=urn:ietf:wg:oauth:2.0:oob&client_secret=<your-application-secret>

```

| <span data-ttu-id="b2071-254">參數</span><span class="sxs-lookup"><span data-stu-id="b2071-254">Parameter</span></span> | <span data-ttu-id="b2071-255">必要？</span><span class="sxs-lookup"><span data-stu-id="b2071-255">Required?</span></span> | <span data-ttu-id="b2071-256">說明</span><span class="sxs-lookup"><span data-stu-id="b2071-256">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="b2071-257">p</span><span class="sxs-lookup"><span data-stu-id="b2071-257">p</span></span> |<span data-ttu-id="b2071-258">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-258">Required</span></span> |<span data-ttu-id="b2071-259">用來取得授權碼的原則。</span><span class="sxs-lookup"><span data-stu-id="b2071-259">The policy that was used to acquire the authorization code.</span></span> <span data-ttu-id="b2071-260">您無法在此要求中使用不同的原則。</span><span class="sxs-lookup"><span data-stu-id="b2071-260">You cannot use a different policy in this request.</span></span> <span data-ttu-id="b2071-261">請注意，您要將這個參數新增到查詢字串，而不是 `POST` 主體。</span><span class="sxs-lookup"><span data-stu-id="b2071-261">Note that you add this parameter to the query string, not to the `POST` body.</span></span> |
| <span data-ttu-id="b2071-262">client_id</span><span class="sxs-lookup"><span data-stu-id="b2071-262">client_id</span></span> |<span data-ttu-id="b2071-263">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-263">Required</span></span> |<span data-ttu-id="b2071-264">[Azure 入口網站](https://portal.azure.com/) 指派給您應用程式的應用程式識別碼。</span><span class="sxs-lookup"><span data-stu-id="b2071-264">The application ID that the [Azure portal](https://portal.azure.com/) assigned to your app.</span></span> |
| <span data-ttu-id="b2071-265">grant_type</span><span class="sxs-lookup"><span data-stu-id="b2071-265">grant_type</span></span> |<span data-ttu-id="b2071-266">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-266">Required</span></span> |<span data-ttu-id="b2071-267">授與的類型，針對授權碼流程來說，必須是 `authorization_code` 。</span><span class="sxs-lookup"><span data-stu-id="b2071-267">The type of grant, which must be `authorization_code` for the authorization code flow.</span></span> |
| <span data-ttu-id="b2071-268">scope</span><span class="sxs-lookup"><span data-stu-id="b2071-268">scope</span></span> |<span data-ttu-id="b2071-269">建議</span><span class="sxs-lookup"><span data-stu-id="b2071-269">Recommended</span></span> |<span data-ttu-id="b2071-270">範圍的空格分隔清單。</span><span class="sxs-lookup"><span data-stu-id="b2071-270">A space-separated list of scopes.</span></span> <span data-ttu-id="b2071-271">向 Azure AD 指出要求兩個權限的單一範圍值。</span><span class="sxs-lookup"><span data-stu-id="b2071-271">A single scope value indicates to Azure AD both permissions that are being requested.</span></span> <span data-ttu-id="b2071-272">`openid` 範圍指示使用 id_tokens 參數形式的權限，以登入使用者及取得使用者相關資料。</span><span class="sxs-lookup"><span data-stu-id="b2071-272">The `openid` scope indicates a permission to sign in the user and get data about the user in the form of id_token parameters.</span></span> <span data-ttu-id="b2071-273">它可用來將權杖傳送到您應用程式本身的後端 Web API，其會由與用戶端相同的應用程式識別碼來表示。</span><span class="sxs-lookup"><span data-stu-id="b2071-273">It can be used to get tokens to your app's own back-end web API, which is represented by the same application ID as the client.</span></span> <span data-ttu-id="b2071-274">`offline_access` 範圍表示您的應用程式將需要重新整理權杖，才能長久存取資源。</span><span class="sxs-lookup"><span data-stu-id="b2071-274">The `offline_access` scope indicates that your app will need a refresh token for long-lived access to resources.</span></span> |
| <span data-ttu-id="b2071-275">code</span><span class="sxs-lookup"><span data-stu-id="b2071-275">code</span></span> |<span data-ttu-id="b2071-276">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-276">Required</span></span> |<span data-ttu-id="b2071-277">您在流程的第一個階段中取得的授權碼。</span><span class="sxs-lookup"><span data-stu-id="b2071-277">The authorization code that you acquired in the first leg of the flow.</span></span> |
| <span data-ttu-id="b2071-278">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="b2071-278">redirect_uri</span></span> |<span data-ttu-id="b2071-279">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-279">Required</span></span> |<span data-ttu-id="b2071-280">應用程式的 `redirect_uri` 參數，您會在此處收到授權碼。</span><span class="sxs-lookup"><span data-stu-id="b2071-280">The `redirect_uri` parameter of the application where you received the authorization code.</span></span> |
| <span data-ttu-id="b2071-281">client_secret</span><span class="sxs-lookup"><span data-stu-id="b2071-281">client_secret</span></span> |<span data-ttu-id="b2071-282">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-282">Required</span></span> |<span data-ttu-id="b2071-283">您在 [Azure 入口網站](https://portal.azure.com/)中產生的應用程式祕密。</span><span class="sxs-lookup"><span data-stu-id="b2071-283">The application secret that you generated in the [Azure portal](https://portal.azure.com/).</span></span> <span data-ttu-id="b2071-284">這個應用程式密碼是重要的安全性構件，</span><span class="sxs-lookup"><span data-stu-id="b2071-284">This application secret is an important security artifact.</span></span> <span data-ttu-id="b2071-285">您應該要用安全的方法把它儲存在您的伺服器上。</span><span class="sxs-lookup"><span data-stu-id="b2071-285">You should store it securely on your server.</span></span> <span data-ttu-id="b2071-286">您也應該定期輪換此用戶端祕密。</span><span class="sxs-lookup"><span data-stu-id="b2071-286">You should also rotate this client secret on a periodic basis.</span></span> |

<span data-ttu-id="b2071-287">成功的權杖回應看起來如下：</span><span class="sxs-lookup"><span data-stu-id="b2071-287">A successful token response looks like:</span></span>

```
{
    "not_before": "1442340812",
    "token_type": "Bearer",
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "scope": "90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access",
    "expires_in": "3600",
    "refresh_token": "AAQfQmvuDy8WtUv-sd0TBwWVQs1rC-Lfxa_NDkLqpg50Cxp5Dxj0VPF1mx2Z...",
}
```
| <span data-ttu-id="b2071-288">參數</span><span class="sxs-lookup"><span data-stu-id="b2071-288">Parameter</span></span> | <span data-ttu-id="b2071-289">說明</span><span class="sxs-lookup"><span data-stu-id="b2071-289">Description</span></span> |
| --- | --- |
| <span data-ttu-id="b2071-290">not_before</span><span class="sxs-lookup"><span data-stu-id="b2071-290">not_before</span></span> |<span data-ttu-id="b2071-291">權杖生效的時間 (以新紀元 (Epoch) 時間表示)。</span><span class="sxs-lookup"><span data-stu-id="b2071-291">The time at which the token is considered valid, in epoch time.</span></span> |
| <span data-ttu-id="b2071-292">token_type</span><span class="sxs-lookup"><span data-stu-id="b2071-292">token_type</span></span> |<span data-ttu-id="b2071-293">權杖類型值。</span><span class="sxs-lookup"><span data-stu-id="b2071-293">The token type value.</span></span> <span data-ttu-id="b2071-294">Azure AD 唯一支援的類型是 `Bearer`。</span><span class="sxs-lookup"><span data-stu-id="b2071-294">The only type that Azure AD supports is `Bearer`.</span></span> |
| <span data-ttu-id="b2071-295">access_token</span><span class="sxs-lookup"><span data-stu-id="b2071-295">access_token</span></span> |<span data-ttu-id="b2071-296">您所要求已簽署的 JWT 權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-296">The signed JWT token that you requested.</span></span> |
| <span data-ttu-id="b2071-297">scope</span><span class="sxs-lookup"><span data-stu-id="b2071-297">scope</span></span> |<span data-ttu-id="b2071-298">權杖有效的範圍。</span><span class="sxs-lookup"><span data-stu-id="b2071-298">The scopes for which the token is valid.</span></span> <span data-ttu-id="b2071-299">這些可用來快取權杖，供以後使用。</span><span class="sxs-lookup"><span data-stu-id="b2071-299">These can be used for caching tokens for later use.</span></span> |
| <span data-ttu-id="b2071-300">expires_in</span><span class="sxs-lookup"><span data-stu-id="b2071-300">expires_in</span></span> |<span data-ttu-id="b2071-301">存取權杖的有效時間長度 (以秒為單位)。</span><span class="sxs-lookup"><span data-stu-id="b2071-301">The length of time that the access token is valid (in seconds).</span></span> |
| <span data-ttu-id="b2071-302">refresh_token</span><span class="sxs-lookup"><span data-stu-id="b2071-302">refresh_token</span></span> |<span data-ttu-id="b2071-303">OAuth 2.0 重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-303">An OAuth 2.0 refresh token.</span></span> <span data-ttu-id="b2071-304">應用程式在目前的權杖過期之後，可以使用這個權杖來取得其他權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-304">The app can use this token to acquire additional tokens after the current token expires.</span></span> <span data-ttu-id="b2071-305">重新整理權杖的有效期很長，而且可用來長期保留資源存取權。</span><span class="sxs-lookup"><span data-stu-id="b2071-305">Refresh tokens are long-lived and can be used to retain access to resources for extended periods of time.</span></span> <span data-ttu-id="b2071-306">如需詳細資訊，請參閱 [B2C 權杖參考](active-directory-b2c-reference-tokens.md)。</span><span class="sxs-lookup"><span data-stu-id="b2071-306">For more details, refer to the [B2C token reference](active-directory-b2c-reference-tokens.md).</span></span> <span data-ttu-id="b2071-307">請注意，您必須同時在授權和權杖要求中使用範圍 `offline_access`，才能接收重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-307">Note that you must have used the scope `offline_access` in both the authorization and token requests in order to receive a refresh token.</span></span> |

<span data-ttu-id="b2071-308">錯誤回應看起來如下：</span><span class="sxs-lookup"><span data-stu-id="b2071-308">Error responses look like:</span></span>

```
{
    "error": "access_denied",
    "error_description": "The user revoked access to the app.",
}
```

| <span data-ttu-id="b2071-309">參數</span><span class="sxs-lookup"><span data-stu-id="b2071-309">Parameter</span></span> | <span data-ttu-id="b2071-310">說明</span><span class="sxs-lookup"><span data-stu-id="b2071-310">Description</span></span> |
| --- | --- |
| <span data-ttu-id="b2071-311">錯誤</span><span class="sxs-lookup"><span data-stu-id="b2071-311">error</span></span> |<span data-ttu-id="b2071-312">可用以分類所發生的錯誤類型，以及可用來回應錯誤的錯誤碼字串。</span><span class="sxs-lookup"><span data-stu-id="b2071-312">An error-code string that can be used to classify types of errors that occur and that can be used to react to errors.</span></span> |
| <span data-ttu-id="b2071-313">error_description</span><span class="sxs-lookup"><span data-stu-id="b2071-313">error_description</span></span> |<span data-ttu-id="b2071-314">協助開發人員識別驗證錯誤根本原因的特定錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="b2071-314">A specific error message that can help a developer identify the root cause of an authentication error.</span></span> |

## <a name="use-the-token"></a><span data-ttu-id="b2071-315">使用權杖</span><span class="sxs-lookup"><span data-stu-id="b2071-315">Use the token</span></span>
<span data-ttu-id="b2071-316">現在您已成功取得存取權杖，因此可在對後端 Web API 發出的要求中使用該權杖，方法是在 `Authorization` 標頭中加入該權杖：</span><span class="sxs-lookup"><span data-stu-id="b2071-316">Now that you've successfully acquired an access token, you can use the token in requests to your back-end web APIs by including it in the `Authorization` header:</span></span>

```
GET /tasks
Host: https://mytaskwebapi.com
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...
```

## <a name="refresh-the-token"></a><span data-ttu-id="b2071-317">重新整理權杖</span><span class="sxs-lookup"><span data-stu-id="b2071-317">Refresh the token</span></span>
<span data-ttu-id="b2071-318">識別碼權杖只會短暫存在。</span><span class="sxs-lookup"><span data-stu-id="b2071-318">ID tokens are short-lived.</span></span> <span data-ttu-id="b2071-319">因此在該權杖過期之後，您必須重新整理權杖，才能繼續存取資源。</span><span class="sxs-lookup"><span data-stu-id="b2071-319">You must refresh them after they expire to continue being able to access resources.</span></span> <span data-ttu-id="b2071-320">方法是向 `/token` 端點送出另一個 `POST` 要求，</span><span class="sxs-lookup"><span data-stu-id="b2071-320">You can do so by submitting another `POST` request to the `/token` endpoint.</span></span> <span data-ttu-id="b2071-321">此時，請提供 `refresh_token` 參數，而不是 `code` 參數：</span><span class="sxs-lookup"><span data-stu-id="b2071-321">This time, provide the `refresh_token` parameter instead of the `code` parameter:</span></span>

```
POST fabrikamb2c.onmicrosoft.com/oauth2/v2.0/token?p=b2c_1_sign_in HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token&client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6&scope=openid offline_access&refresh_token=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&redirect_uri=urn:ietf:wg:oauth:2.0:oob&client_secret=<your-application-secret>
```

| <span data-ttu-id="b2071-322">參數</span><span class="sxs-lookup"><span data-stu-id="b2071-322">Parameter</span></span> | <span data-ttu-id="b2071-323">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-323">Required</span></span> | <span data-ttu-id="b2071-324">說明</span><span class="sxs-lookup"><span data-stu-id="b2071-324">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="b2071-325">p</span><span class="sxs-lookup"><span data-stu-id="b2071-325">p</span></span> |<span data-ttu-id="b2071-326">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-326">Required</span></span> |<span data-ttu-id="b2071-327">用來取得原始重新整理權杖的原則。</span><span class="sxs-lookup"><span data-stu-id="b2071-327">The policy that was used to acquire the original refresh token.</span></span> <span data-ttu-id="b2071-328">您無法在此要求中使用不同的原則。</span><span class="sxs-lookup"><span data-stu-id="b2071-328">You cannot use a different policy in this request.</span></span> <span data-ttu-id="b2071-329">請注意，您要將這個參數新增到查詢字串，而不是 POST 主體。</span><span class="sxs-lookup"><span data-stu-id="b2071-329">Note that you add this parameter to the query string, not to the POST body.</span></span> |
| <span data-ttu-id="b2071-330">client_id</span><span class="sxs-lookup"><span data-stu-id="b2071-330">client_id</span></span> |<span data-ttu-id="b2071-331">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-331">Required</span></span> |<span data-ttu-id="b2071-332">[Azure 入口網站](https://portal.azure.com/) 指派給您應用程式的應用程式識別碼。</span><span class="sxs-lookup"><span data-stu-id="b2071-332">The application ID that the [Azure portal](https://portal.azure.com/) assigned to your app.</span></span> |
| <span data-ttu-id="b2071-333">grant_type</span><span class="sxs-lookup"><span data-stu-id="b2071-333">grant_type</span></span> |<span data-ttu-id="b2071-334">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-334">Required</span></span> |<span data-ttu-id="b2071-335">授與的類型，對於授權碼流程的這個階段來說，必須是重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-335">The type of grant, which must be a refresh token for this leg of the authorization code flow.</span></span> |
| <span data-ttu-id="b2071-336">scope</span><span class="sxs-lookup"><span data-stu-id="b2071-336">scope</span></span> |<span data-ttu-id="b2071-337">建議</span><span class="sxs-lookup"><span data-stu-id="b2071-337">Recommended</span></span> |<span data-ttu-id="b2071-338">範圍的空格分隔清單。</span><span class="sxs-lookup"><span data-stu-id="b2071-338">A space-separated list of scopes.</span></span> <span data-ttu-id="b2071-339">向 Azure AD 指出要求兩個權限的單一範圍值。</span><span class="sxs-lookup"><span data-stu-id="b2071-339">A single scope value indicates to Azure AD both permissions that are being requested.</span></span> <span data-ttu-id="b2071-340">`openid` 範圍指示使用識別碼權杖形式的權限，以登入使用者及取得使用者相關資料。</span><span class="sxs-lookup"><span data-stu-id="b2071-340">The `openid` scope indicates a permission to sign in the user and get data about the user in the form of ID tokens.</span></span> <span data-ttu-id="b2071-341">它可用來將權杖傳送到您應用程式本身的後端 Web API，其會由與用戶端相同的應用程式識別碼來表示。</span><span class="sxs-lookup"><span data-stu-id="b2071-341">It can be used to get tokens to your app's own back-end web API, which is represented by the same application ID as the client.</span></span> <span data-ttu-id="b2071-342">`offline_access` 範圍表示您的應用程式將需要重新整理權杖，才能長久存取資源。</span><span class="sxs-lookup"><span data-stu-id="b2071-342">The `offline_access` scope indicates that your app will need a refresh token for long-lived access to resources.</span></span> |
| <span data-ttu-id="b2071-343">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="b2071-343">redirect_uri</span></span> |<span data-ttu-id="b2071-344">建議</span><span class="sxs-lookup"><span data-stu-id="b2071-344">Recommended</span></span> |<span data-ttu-id="b2071-345">應用程式的 `redirect_uri` 參數，您會在此處收到授權碼。</span><span class="sxs-lookup"><span data-stu-id="b2071-345">The `redirect_uri` parameter of the application where you received the authorization code.</span></span> |
| <span data-ttu-id="b2071-346">refresh_token</span><span class="sxs-lookup"><span data-stu-id="b2071-346">refresh_token</span></span> |<span data-ttu-id="b2071-347">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-347">Required</span></span> |<span data-ttu-id="b2071-348">您在流程的第二個階段中取得的原始重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-348">The original refresh token that you acquired in the second leg of the flow.</span></span> <span data-ttu-id="b2071-349">請注意，您必須同時在授權和權杖要求中使用範圍 `offline_access`，才能接收重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-349">Note that you must have used the scope `offline_access` in both the authorization and token requests in order to receive a refresh token.</span></span> |
| <span data-ttu-id="b2071-350">client_secret</span><span class="sxs-lookup"><span data-stu-id="b2071-350">client_secret</span></span> |<span data-ttu-id="b2071-351">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-351">Required</span></span> |<span data-ttu-id="b2071-352">您在 [Azure 入口網站](https://portal.azure.com/)中產生的應用程式祕密。</span><span class="sxs-lookup"><span data-stu-id="b2071-352">The application secret that you generated in the [Azure portal](https://portal.azure.com/).</span></span> <span data-ttu-id="b2071-353">這個應用程式密碼是重要的安全性構件，</span><span class="sxs-lookup"><span data-stu-id="b2071-353">This application secret is an important security artifact.</span></span> <span data-ttu-id="b2071-354">您應該要用安全的方法把它儲存在您的伺服器上。</span><span class="sxs-lookup"><span data-stu-id="b2071-354">You should store it securely on your server.</span></span> <span data-ttu-id="b2071-355">您也應該定期輪換此用戶端祕密。</span><span class="sxs-lookup"><span data-stu-id="b2071-355">You should also rotate this client secret on a periodic basis.</span></span> |

<span data-ttu-id="b2071-356">成功的權杖回應看起來如下：</span><span class="sxs-lookup"><span data-stu-id="b2071-356">A successful token response looks like:</span></span>

```
{
    "not_before": "1442340812",
    "token_type": "Bearer",
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "scope": "90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access",
    "expires_in": "3600",
    "refresh_token": "AAQfQmvuDy8WtUv-sd0TBwWVQs1rC-Lfxa_NDkLqpg50Cxp5Dxj0VPF1mx2Z...",
}
```
| <span data-ttu-id="b2071-357">參數</span><span class="sxs-lookup"><span data-stu-id="b2071-357">Parameter</span></span> | <span data-ttu-id="b2071-358">說明</span><span class="sxs-lookup"><span data-stu-id="b2071-358">Description</span></span> |
| --- | --- |
| <span data-ttu-id="b2071-359">not_before</span><span class="sxs-lookup"><span data-stu-id="b2071-359">not_before</span></span> |<span data-ttu-id="b2071-360">權杖生效的時間 (以新紀元 (Epoch) 時間表示)。</span><span class="sxs-lookup"><span data-stu-id="b2071-360">The time at which the token is considered valid, in epoch time.</span></span> |
| <span data-ttu-id="b2071-361">token_type</span><span class="sxs-lookup"><span data-stu-id="b2071-361">token_type</span></span> |<span data-ttu-id="b2071-362">權杖類型值。</span><span class="sxs-lookup"><span data-stu-id="b2071-362">The token type value.</span></span> <span data-ttu-id="b2071-363">Azure AD 唯一支援的類型是 `Bearer`。</span><span class="sxs-lookup"><span data-stu-id="b2071-363">The only type that Azure AD supports is `Bearer`.</span></span> |
| <span data-ttu-id="b2071-364">access_token</span><span class="sxs-lookup"><span data-stu-id="b2071-364">access_token</span></span> |<span data-ttu-id="b2071-365">您所要求已簽署的 JWT 權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-365">The signed JWT token that you requested.</span></span> |
| <span data-ttu-id="b2071-366">scope</span><span class="sxs-lookup"><span data-stu-id="b2071-366">scope</span></span> |<span data-ttu-id="b2071-367">權杖有效的範圍，可用於快取權杖，供以後使用。</span><span class="sxs-lookup"><span data-stu-id="b2071-367">The scope that the token is valid for, which can be used for caching tokens for later use.</span></span> |
| <span data-ttu-id="b2071-368">expires_in</span><span class="sxs-lookup"><span data-stu-id="b2071-368">expires_in</span></span> |<span data-ttu-id="b2071-369">存取權杖的有效時間長度 (以秒為單位)。</span><span class="sxs-lookup"><span data-stu-id="b2071-369">The length of time that the access token is valid (in seconds).</span></span> |
| <span data-ttu-id="b2071-370">refresh_token</span><span class="sxs-lookup"><span data-stu-id="b2071-370">refresh_token</span></span> |<span data-ttu-id="b2071-371">OAuth 2.0 重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-371">An OAuth 2.0 refresh token.</span></span> <span data-ttu-id="b2071-372">應用程式在目前的權杖過期之後，可以使用這個權杖來取得其他權杖。</span><span class="sxs-lookup"><span data-stu-id="b2071-372">The app can use this token to acquire additional tokens after the current token expires.</span></span>  <span data-ttu-id="b2071-373">重新整理權杖的有效期很長，而且可用來長期保留資源存取權。</span><span class="sxs-lookup"><span data-stu-id="b2071-373">Refresh tokens are long-lived and can be used to retain access to resources for extended periods of time.</span></span> <span data-ttu-id="b2071-374">如需詳細資訊，請參閱 [B2C 權杖參考](active-directory-b2c-reference-tokens.md)。</span><span class="sxs-lookup"><span data-stu-id="b2071-374">For more detail, refer to the [B2C token reference](active-directory-b2c-reference-tokens.md).</span></span> |

<span data-ttu-id="b2071-375">錯誤回應看起來如下：</span><span class="sxs-lookup"><span data-stu-id="b2071-375">Error responses look like:</span></span>

```
{
    "error": "access_denied",
    "error_description": "The user revoked access to the app.",
}
```

| <span data-ttu-id="b2071-376">參數</span><span class="sxs-lookup"><span data-stu-id="b2071-376">Parameter</span></span> | <span data-ttu-id="b2071-377">說明</span><span class="sxs-lookup"><span data-stu-id="b2071-377">Description</span></span> |
| --- | --- |
| <span data-ttu-id="b2071-378">錯誤</span><span class="sxs-lookup"><span data-stu-id="b2071-378">error</span></span> |<span data-ttu-id="b2071-379">可用以分類所發生的錯誤類型，以及可用來回應錯誤的錯誤碼字串。</span><span class="sxs-lookup"><span data-stu-id="b2071-379">An error-code string that can be used to classify types of errors that occur and that can be used to react to errors.</span></span> |
| <span data-ttu-id="b2071-380">error_description</span><span class="sxs-lookup"><span data-stu-id="b2071-380">error_description</span></span> |<span data-ttu-id="b2071-381">協助開發人員識別驗證錯誤根本原因的特定錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="b2071-381">A specific error message that can help a developer identify the root cause of an authentication error.</span></span> |

## <a name="send-a-sign-out-request"></a><span data-ttu-id="b2071-382">傳送登出要求</span><span class="sxs-lookup"><span data-stu-id="b2071-382">Send a sign-out request</span></span>
<span data-ttu-id="b2071-383">當您想要讓使用者登出應用程式時，只是清除應用程式的 Cookie，或是結束使用者的工作階段是不夠的。</span><span class="sxs-lookup"><span data-stu-id="b2071-383">When you want to sign the user out of the app, it is not enough to clear your app's cookies or otherwise end the session with the user.</span></span> <span data-ttu-id="b2071-384">您也必須把使用者重新導向至 Azure AD 來登出。如果您沒有這麼做，使用者可能不必重新輸入認證，就能夠向您的應用程式重新驗證自己的身分。</span><span class="sxs-lookup"><span data-stu-id="b2071-384">You must also redirect the user to Azure AD to sign out. If you fail to do so, the user might be able to reauthenticate to your app without entering their credentials again.</span></span> <span data-ttu-id="b2071-385">這是因為使用者將擁有有效的 Azure AD 單一登入工作階段。</span><span class="sxs-lookup"><span data-stu-id="b2071-385">This is because they will have a valid single sign-on session with Azure AD.</span></span>

<span data-ttu-id="b2071-386">您只要將使用者重新導向至 `end_session` 端點 (列於之前在＜驗證識別碼權杖＞一節中所述的 OpenID Connect 中繼資料文件中) 即可：</span><span class="sxs-lookup"><span data-stu-id="b2071-386">You can simply redirect the user to the `end_session` endpoint that is listed in the OpenID Connect metadata document described earlier in the "Validate the ID token" section:</span></span>

```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/logout?
p=b2c_1_sign_in
&post_logout_redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
```

| <span data-ttu-id="b2071-387">參數</span><span class="sxs-lookup"><span data-stu-id="b2071-387">Parameter</span></span> | <span data-ttu-id="b2071-388">必要？</span><span class="sxs-lookup"><span data-stu-id="b2071-388">Required?</span></span> | <span data-ttu-id="b2071-389">說明</span><span class="sxs-lookup"><span data-stu-id="b2071-389">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="b2071-390">p</span><span class="sxs-lookup"><span data-stu-id="b2071-390">p</span></span> |<span data-ttu-id="b2071-391">必要</span><span class="sxs-lookup"><span data-stu-id="b2071-391">Required</span></span> |<span data-ttu-id="b2071-392">您想要用來將使用者登出應用程式的原則。</span><span class="sxs-lookup"><span data-stu-id="b2071-392">The policy that you want to use to sign the user out of your application.</span></span> |
| <span data-ttu-id="b2071-393">post_logout_redirect_uri</span><span class="sxs-lookup"><span data-stu-id="b2071-393">post_logout_redirect_uri</span></span> |<span data-ttu-id="b2071-394">建議</span><span class="sxs-lookup"><span data-stu-id="b2071-394">Recommended</span></span> |<span data-ttu-id="b2071-395">使用者在成功登出之後，應該要前往的 URL。若未包含此資料，Azure AD B2C 就會向使用者顯示一般訊息。</span><span class="sxs-lookup"><span data-stu-id="b2071-395">The URL that the user should be redirected to after successful sign-out. If it is not included, Azure AD B2C shows the user a generic message.</span></span> |

> [!NOTE]
> <span data-ttu-id="b2071-396">儘管將使用者導向至 `end_session` 端點就能清除使用者於 Azure AD B2C 的部分單一登入狀態，但無法讓使用者登出其社交身分識別提供者 (IDP) 工作階段。</span><span class="sxs-lookup"><span data-stu-id="b2071-396">Although directing the user to the `end_session` endpoint will clear some of the user's single sign-on state with Azure AD B2C, it will not sign the user out of their social identity provider (IDP) session.</span></span> <span data-ttu-id="b2071-397">如果使用者之後在登入時選取相同的 IDP，該使用者不必輸入自己的認證，就能讓系統重新驗證自己的身分。</span><span class="sxs-lookup"><span data-stu-id="b2071-397">If the user selects the same IDP during a subsequent sign-in, they will be reauthenticated, without entering their credentials.</span></span> <span data-ttu-id="b2071-398">如果使用者想要登出您的 B2C 應用程式，不一定代表他們想要登出自己的 Facebook 帳戶。</span><span class="sxs-lookup"><span data-stu-id="b2071-398">If a user wants to sign out of your B2C application, it does not necessarily mean they want to sign out of their Facebook account.</span></span> <span data-ttu-id="b2071-399">不過，如果是使用本機帳戶，使用者的工作階段便會正確地結束。</span><span class="sxs-lookup"><span data-stu-id="b2071-399">However, in the case of local accounts, the user's session will be ended properly.</span></span>
> 
> 

## <a name="use-your-own-b2c-tenant"></a><span data-ttu-id="b2071-400">使用您自己的 B2C 租用戶</span><span class="sxs-lookup"><span data-stu-id="b2071-400">Use your own B2C tenant</span></span>
<span data-ttu-id="b2071-401">如果您想要親自嘗試這些要求，必須先執行下列三個步驟，然後用您自己的值來取代上述的範例值：</span><span class="sxs-lookup"><span data-stu-id="b2071-401">If you want to try these requests for yourself, you must first perform these three steps, and then replace the example values described earlier with your own:</span></span>

1. <span data-ttu-id="b2071-402">[建立 B2C 租用戶](active-directory-b2c-get-started.md)，並在要求中使用您租用戶的名稱。</span><span class="sxs-lookup"><span data-stu-id="b2071-402">[Create a B2C tenant](active-directory-b2c-get-started.md), and use the name of your tenant in the requests.</span></span>
2. <span data-ttu-id="b2071-403">[建立應用程式](active-directory-b2c-app-registration.md)來取得應用程式識別碼。</span><span class="sxs-lookup"><span data-stu-id="b2071-403">[Create an application](active-directory-b2c-app-registration.md) to obtain an application ID.</span></span> <span data-ttu-id="b2071-404">在應用程式中加入 Web 應用程式/Web API。</span><span class="sxs-lookup"><span data-stu-id="b2071-404">Include a web app/web API in your app.</span></span> <span data-ttu-id="b2071-405">也可以選擇建立應用程式祕密。</span><span class="sxs-lookup"><span data-stu-id="b2071-405">Optionally, create an application secret.</span></span>
3. <span data-ttu-id="b2071-406">[建立您的原則](active-directory-b2c-reference-policies.md) 來取得原則名稱。</span><span class="sxs-lookup"><span data-stu-id="b2071-406">[Create your policies](active-directory-b2c-reference-policies.md) to obtain your policy names.</span></span>

