---
title: "Azure Active Directory B2C：權杖參考 | Microsoft Docs"
description: "在 Azure Active Directory B2C 中簽發的權杖類型"
services: active-directory-b2c
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 6df79878-65cb-4dfc-98bb-2b328055bc2e
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 3/17/2017
ms.author: dastrock
ms.openlocfilehash: 39cfbc1c6dea138fe2f1eb3190770606f3895d40
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="azure-ad-b2c-token-reference"></a><span data-ttu-id="d88fa-103">Azure AD B2C：權杖參考</span><span class="sxs-lookup"><span data-stu-id="d88fa-103">Azure AD B2C: Token reference</span></span>
<span data-ttu-id="d88fa-104">Azure Active Directory B2C (Azure AD B2C) 會在處理每個[驗證流程](active-directory-b2c-apps.md)時發出數種安全性權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-104">Azure Active Directory B2C (Azure AD B2C) emits several types of security tokens as it processes each [authentication flow](active-directory-b2c-apps.md).</span></span> <span data-ttu-id="d88fa-105">本文件說明每種權杖的格式、安全性特性和內容。</span><span class="sxs-lookup"><span data-stu-id="d88fa-105">This document describes the format, security characteristics, and contents of each type of token.</span></span>

## <a name="types-of-tokens"></a><span data-ttu-id="d88fa-106">權杖的類型</span><span class="sxs-lookup"><span data-stu-id="d88fa-106">Types of tokens</span></span>
<span data-ttu-id="d88fa-107">Azure AD B2C 支援 [OAuth 2.0 授權通訊協定](active-directory-b2c-reference-protocols.md)，該通訊協定會使用存取權杖與重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-107">Azure AD B2C supports the [OAuth 2.0 authorization protocol](active-directory-b2c-reference-protocols.md), which makes use of both access tokens and refresh tokens.</span></span> <span data-ttu-id="d88fa-108">它也支援透過 [OpenID Connect](active-directory-b2c-reference-protocols.md)進行驗證和登入，這引進第三種類型的權杖：ID 權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-108">It also supports authentication and sign-in via [OpenID Connect](active-directory-b2c-reference-protocols.md), which introduces a third type of token: the ID token.</span></span> <span data-ttu-id="d88fa-109">每個權杖都是以持有人權杖表示。</span><span class="sxs-lookup"><span data-stu-id="d88fa-109">Each of these tokens is represented as a bearer token.</span></span>

<span data-ttu-id="d88fa-110">持有人權杖是輕巧型的安全性權杖，授權「持有人」存取受保護的資源。</span><span class="sxs-lookup"><span data-stu-id="d88fa-110">A bearer token is a lightweight security token that grants the "bearer" access to a protected resource.</span></span> <span data-ttu-id="d88fa-111">持有人是可出示權杖的任何一方。</span><span class="sxs-lookup"><span data-stu-id="d88fa-111">The bearer is any party that can present the token.</span></span> <span data-ttu-id="d88fa-112">Azure AD 必須先驗證合作對象，才能接收持有人權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-112">Azure AD must first authenticate a party before it can receive a bearer token.</span></span> <span data-ttu-id="d88fa-113">但若傳輸和儲存時未採取必要的步驟來保護權杖，它可能會被非預期的一方攔截和使用。</span><span class="sxs-lookup"><span data-stu-id="d88fa-113">But if the required steps are not taken to secure the token in transmission and storage, it can be intercepted and used by an unintended party.</span></span> <span data-ttu-id="d88fa-114">某些安全性權杖有內建的機制，可防止未授權的合作對象使用它們，但持有人權杖沒有這項機制。</span><span class="sxs-lookup"><span data-stu-id="d88fa-114">Some security tokens have a built-in mechanism for preventing unauthorized parties from using them, but bearer tokens do not have this mechanism.</span></span> <span data-ttu-id="d88fa-115">它們必須在安全的通道 (例如傳輸層安全性 (HTTPS)) 中傳輸。</span><span class="sxs-lookup"><span data-stu-id="d88fa-115">They must be transported in a secure channel, such as transport layer security (HTTPS).</span></span>

<span data-ttu-id="d88fa-116">如果持有人權杖是在安全通道外部進行傳輸，則惡意人士就能使用攔截式攻擊來取得權杖，未經授權地使用該權杖來存取受保護的資源。</span><span class="sxs-lookup"><span data-stu-id="d88fa-116">If a bearer token is transmitted outside a secure channel, a malicious party can use a man-in-the-middle attack to acquire the token and use it to gain unauthorized access to a protected resource.</span></span> <span data-ttu-id="d88fa-117">儲存或快取持有人權杖供以後使用時，也適用相同的安全性原則。</span><span class="sxs-lookup"><span data-stu-id="d88fa-117">The same security principles apply when bearer tokens are stored or cached for later use.</span></span> <span data-ttu-id="d88fa-118">務必確定您的應用程式以安全的方式傳輸和儲存持有人權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-118">Always ensure that your app transmits and stores bearer tokens in a secure manner.</span></span>

<span data-ttu-id="d88fa-119">如需持有人權杖的其他安全性考量，請參閱 [RFC 6750 第 5 節](http://tools.ietf.org/html/rfc6750)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-119">For additional security considerations on bearer tokens, see [RFC 6750 Section 5](http://tools.ietf.org/html/rfc6750).</span></span>

<span data-ttu-id="d88fa-120">許多由 Azure AD B2C 所簽發的權杖都實作為 JSON Web 權杖 (JWT)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-120">Many of the tokens that Azure AD B2C issues are implemented as JSON web tokens (JWTs).</span></span> <span data-ttu-id="d88fa-121">JWT 是一種精簡的 URL 安全方法，可在兩方之間傳輸資訊。</span><span class="sxs-lookup"><span data-stu-id="d88fa-121">A JWT is a compact, URL-safe means of transferring information between two parties.</span></span> <span data-ttu-id="d88fa-122">JWT 包含稱為宣告的資訊。</span><span class="sxs-lookup"><span data-stu-id="d88fa-122">JWTs contain information known as claims.</span></span> <span data-ttu-id="d88fa-123">這些是權杖持有人及主體相關資訊的判斷提示。</span><span class="sxs-lookup"><span data-stu-id="d88fa-123">These are assertions of information about the bearer and the subject of the token.</span></span> <span data-ttu-id="d88fa-124">JWT 中的宣告是為了傳輸而編碼和序列化的 JSON 物件。</span><span class="sxs-lookup"><span data-stu-id="d88fa-124">The claims in JWTs are JSON objects that are encoded and serialized for transmission.</span></span> <span data-ttu-id="d88fa-125">因為 Azure AD B2C 所簽發的 JWT 已簽署但未加密，所以您可以輕鬆地檢查 JWT 的內容以便偵錯。</span><span class="sxs-lookup"><span data-stu-id="d88fa-125">Because the JWTs issued by Azure AD B2C are signed but not encrypted, you can easily inspect the contents of a JWT to debug it.</span></span> <span data-ttu-id="d88fa-126">有一些工具可以這樣做，包括 [calebb.net](http://calebb.net)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-126">Several tools are available that can do this, including [calebb.net](http://calebb.net).</span></span> <span data-ttu-id="d88fa-127">如需 JWT 的詳細資訊，請參閱 [JWT 規格](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-127">For more information about JWTs, refer to [JWT specifications](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html).</span></span>

### <a name="id-tokens"></a><span data-ttu-id="d88fa-128">ID 權杖</span><span class="sxs-lookup"><span data-stu-id="d88fa-128">ID tokens</span></span>
<span data-ttu-id="d88fa-129">ID 權杖是您的應用程式從 Azure AD B2C `authorize` 和 `token` 端點接收的一種安全性權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-129">An ID token is a form of security token that your app receives from the Azure AD B2C `authorize` and `token` endpoints.</span></span> <span data-ttu-id="d88fa-130">ID 權杖以 [JWT](#types-of-tokens)表示，而且包含宣告讓您用來識別應用程式中的使用者。</span><span class="sxs-lookup"><span data-stu-id="d88fa-130">ID tokens are represented as [JWTs](#types-of-tokens), and they contain claims that you can use to identify users in your app.</span></span> <span data-ttu-id="d88fa-131">從 `authorize` 端點取得 ID 權杖時，通常會用來讓使用者登入 Web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="d88fa-131">When ID tokens are acquired from the `authorize` endpoint, they are often used to sign in users to web applications.</span></span> <span data-ttu-id="d88fa-132">從 `token` 端點取得 ID 權杖時，可在相同應用程式或服務的兩個元件之間進行通訊時在 HTTP 要求中傳送。</span><span class="sxs-lookup"><span data-stu-id="d88fa-132">When ID tokens are acquired from the `token` endpoint, they can be sent in HTTP requests during communication between two components of the same application or service.</span></span> <span data-ttu-id="d88fa-133">您可以依需要在 ID 權杖中使用宣告。</span><span class="sxs-lookup"><span data-stu-id="d88fa-133">You can use the claims in an ID token as you see fit.</span></span> <span data-ttu-id="d88fa-134">它們通常用來顯示帳戶資訊，或決定應用程式中的存取控制。</span><span class="sxs-lookup"><span data-stu-id="d88fa-134">They are commonly used to display account information or to make access control decisions in an app.</span></span>  

<span data-ttu-id="d88fa-135">識別碼權杖已簽署，但目前未加密。</span><span class="sxs-lookup"><span data-stu-id="d88fa-135">ID tokens are signed, but they are not currently encrypted.</span></span> <span data-ttu-id="d88fa-136">當您的應用程式或 API 收到 ID 權杖時，它必須 [驗證簽章](#token-validation) 以證明權杖的真實性。</span><span class="sxs-lookup"><span data-stu-id="d88fa-136">When your app or API receives an ID token, it must [validate the signature](#token-validation) to prove that the token is authentic.</span></span> <span data-ttu-id="d88fa-137">您的應用程式或 API 也必須驗證權杖中的幾個宣告，以證明它有效。</span><span class="sxs-lookup"><span data-stu-id="d88fa-137">Your app or API must also validate a few claims in the token to prove that it is valid.</span></span> <span data-ttu-id="d88fa-138">應用程式所驗證的宣告會視案例需求而有所不同，但您的應用程式必須在每一種案例中執行一些 [常見的宣告驗證](#token-validation) 。</span><span class="sxs-lookup"><span data-stu-id="d88fa-138">Depending on the scenario requirements, the claims validated by an app can vary, but your app must perform some [common claim validations](#token-validation) in every scenario.</span></span>

#### <a name="sample-id-token"></a><span data-ttu-id="d88fa-139">範例 ID 權杖</span><span class="sxs-lookup"><span data-stu-id="d88fa-139">Sample ID token</span></span>
```
// Line breaks for display purposes only

eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IklkVG9rZW5TaWduaW5nS2V5Q29udGFpbmVyIn0.
eyJleHAiOjE0NDIzNjAwMzQsIm5iZiI6MTQ0MjM1NjQzNCwidmVyIjoiMS4wIiwiaXNzIjoiaHR0cHM6Ly9s
b2dpbi5taWNyb3NvZnRvbmxpbmUuY29tLzc3NTUyN2ZmLTlhMzctNDMwNy04YjNkLWNjMzExZjU4ZDkyNS92
Mi4wLyIsImFjciI6ImIyY18xX3NpZ25faW5fc3RvY2siLCJzdWIiOiJOb3Qgc3VwcG9ydGVkIGN1cnJlbnRs
eS4gVXNlIG9pZCBjbGFpbS4iLCJhdWQiOiI5MGMwZmU2My1iY2YyLTQ0ZDUtOGZiNy1iOGJiYzBiMjlkYzYi
LCJpYXQiOjE0NDIzNTY0MzQsImF1dGhfdGltZSI6MTQ0MjM1NjQzNCwiaWRwIjoiZmFjZWJvb2suY29tIn0.
h-uiKcrT882pSKUtWCpj-_3b3vPs3bOWsESAhPMrL-iIIacKc6_uZrWxaWvIYkLra5czBcGKWrYwrAC8ZvQe
DJWZ50WXQrZYODEW1OUwzaD_I1f1HE0c2uvaWdGXBpDEVdsD3ExKaFlKGjFR2V7F-fPThkVDdKmkUDQX3bVc
yyj2V2nlCQ9jd7aGnokTPfLfpOjuIrTsAdPcGpe5hfSEuwYDmqOJjGs9Jp1f-eSNEiCDQOaTBSvr479L5ptP
XWeQZyX2SypN05Rjr05bjZh3j70ZUimiocfJzjibeoDCaQTz907yAg91WYuFOrQxb-5BaUoR7K-O7vxr2M-_
CQhoFA

```

### <a name="access-tokens"></a><span data-ttu-id="d88fa-140">存取權杖</span><span class="sxs-lookup"><span data-stu-id="d88fa-140">Access tokens</span></span>
<span data-ttu-id="d88fa-141">存取權杖也是您的應用程式從 Azure AD B2C `authorize` 和 `token` 端點接收的一種安全性權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-141">An access token is also a form of security token that your app receives from the Azure AD B2C `authorize` and `token` endpoints.</span></span> <span data-ttu-id="d88fa-142">存取權杖也會以 [JWT](#types-of-tokens) 表示，而且其中包含宣告以供您用來識別對您 API 所授與的權限。</span><span class="sxs-lookup"><span data-stu-id="d88fa-142">Access tokens are also represented as [JWTs](#types-of-tokens), and they contain claims that you can use to identify the granted permissions to your APIs.</span></span> <span data-ttu-id="d88fa-143">存取權杖已簽署，但目前未加密。</span><span class="sxs-lookup"><span data-stu-id="d88fa-143">Access tokens are signed, but they are not currently encrypted.</span></span> <span data-ttu-id="d88fa-144">您應該使用存取權杖來提供伺服器 API 和資源的存取權。</span><span class="sxs-lookup"><span data-stu-id="d88fa-144">Access tokens should be used to provide access to APIs and resource servers.</span></span> <span data-ttu-id="d88fa-145">深入了解如何[使用存取權杖](active-directory-b2c-access-tokens.md)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-145">Learn more about how to [use access tokens](active-directory-b2c-access-tokens.md).</span></span> 

<span data-ttu-id="d88fa-146">當您的 API 收到存取權杖時，它必須 [驗證簽章](#token-validation) 以證明權杖的真實性。</span><span class="sxs-lookup"><span data-stu-id="d88fa-146">When your API receives an access token, it must [validate the signature](#token-validation) to prove that the token is authentic.</span></span> <span data-ttu-id="d88fa-147">您的 API 也必須驗證權杖中的幾個宣告，以證明它有效。</span><span class="sxs-lookup"><span data-stu-id="d88fa-147">Your API must also validate a few claims in the token to prove that it is valid.</span></span> <span data-ttu-id="d88fa-148">應用程式所驗證的宣告會視案例需求而有所不同，但您的應用程式必須在每一種案例中執行一些 [常見的宣告驗證](#token-validation) 。</span><span class="sxs-lookup"><span data-stu-id="d88fa-148">Depending on the scenario requirements, the claims validated by an app can vary, but your app must perform some [common claim validations](#token-validation) in every scenario.</span></span>

### <a name="claims-in-id-and-access-tokens"></a><span data-ttu-id="d88fa-149">識別碼和存取權杖中的宣告</span><span class="sxs-lookup"><span data-stu-id="d88fa-149">Claims in ID and access tokens</span></span>
<span data-ttu-id="d88fa-150">當您使用 Azure AD B2C 時，您可以精確控制權杖的內容。</span><span class="sxs-lookup"><span data-stu-id="d88fa-150">When you use Azure AD B2C, you have fine-grained control over the content of your tokens.</span></span> <span data-ttu-id="d88fa-151">您可以設定 [原則](active-directory-b2c-reference-policies.md) ，以在宣告中傳送您的應用程式運作時所需的幾組特定的使用者資料。</span><span class="sxs-lookup"><span data-stu-id="d88fa-151">You can configure [policies](active-directory-b2c-reference-policies.md) to send certain sets of user data in claims that your app requires for its operations.</span></span> <span data-ttu-id="d88fa-152">這些宣告可以包含標準的屬性，例如使用者的 `displayName` 和 `emailAddress`。</span><span class="sxs-lookup"><span data-stu-id="d88fa-152">These claims can include standard properties such as the user's `displayName` and `emailAddress`.</span></span> <span data-ttu-id="d88fa-153">其中也可以包含您在 B2C 目錄中可定義的 [自訂使用者屬性](active-directory-b2c-reference-custom-attr.md) 。</span><span class="sxs-lookup"><span data-stu-id="d88fa-153">They can also include [custom user attributes](active-directory-b2c-reference-custom-attr.md) that you can define in your B2C directory.</span></span> <span data-ttu-id="d88fa-154">您收到的每個識別碼權杖和存取權杖都會包含一組特定的安全性相關宣告。</span><span class="sxs-lookup"><span data-stu-id="d88fa-154">Every ID and access token that you receive contains a certain set of security-related claims.</span></span> <span data-ttu-id="d88fa-155">您的應用程式可以使用這些宣告來安全地驗證使用者和要求。</span><span class="sxs-lookup"><span data-stu-id="d88fa-155">Your applications can use these claims to securely authenticate users and requests.</span></span>

<span data-ttu-id="d88fa-156">請注意，ID 權杖中的宣告不依任何特定順序傳回。</span><span class="sxs-lookup"><span data-stu-id="d88fa-156">Note that the claims in ID tokens are not returned in any particular order.</span></span> <span data-ttu-id="d88fa-157">此外，隨時都可以在 ID 權杖中加入新的宣告。</span><span class="sxs-lookup"><span data-stu-id="d88fa-157">In addition, new claims can be introduced in ID tokens at any time.</span></span> <span data-ttu-id="d88fa-158">加入新的宣告時，您的應用程式不會損壞。</span><span class="sxs-lookup"><span data-stu-id="d88fa-158">Your app should not break as new claims are introduced.</span></span> <span data-ttu-id="d88fa-159">以下是 Azure AD B2C 所簽發的識別碼權杖和存取權杖中應該會有的宣告。</span><span class="sxs-lookup"><span data-stu-id="d88fa-159">Here are the claims that you expect to exist in ID and access tokens issued by Azure AD B2C.</span></span> <span data-ttu-id="d88fa-160">其他任何宣告都由原則決定。</span><span class="sxs-lookup"><span data-stu-id="d88fa-160">Any additional claims are determined by policies.</span></span> <span data-ttu-id="d88fa-161">練習時，請試著將範例 ID 權杖中的宣告貼入 [calebb.net](http://calebb.net)中進行檢查。</span><span class="sxs-lookup"><span data-stu-id="d88fa-161">For practice, try inspecting the claims in the sample ID token by pasting it into [calebb.net](http://calebb.net).</span></span> <span data-ttu-id="d88fa-162">在 [OpenID Connect 規格](http://openid.net/specs/openid-connect-core-1_0.html)中可找到進一步的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="d88fa-162">Further details can be found in the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html).</span></span>

| <span data-ttu-id="d88fa-163">名稱</span><span class="sxs-lookup"><span data-stu-id="d88fa-163">Name</span></span> | <span data-ttu-id="d88fa-164">宣告</span><span class="sxs-lookup"><span data-stu-id="d88fa-164">Claim</span></span> | <span data-ttu-id="d88fa-165">範例值</span><span class="sxs-lookup"><span data-stu-id="d88fa-165">Example value</span></span> | <span data-ttu-id="d88fa-166">說明</span><span class="sxs-lookup"><span data-stu-id="d88fa-166">Description</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="d88fa-167">對象</span><span class="sxs-lookup"><span data-stu-id="d88fa-167">Audience</span></span> |`aud` |`90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6` |<span data-ttu-id="d88fa-168">對象宣告識別權杖的預定接收者。</span><span class="sxs-lookup"><span data-stu-id="d88fa-168">An audience claim identifies the intended recipient of the token.</span></span> <span data-ttu-id="d88fa-169">在 Azure AD B2C 中，對象是在應用程式註冊入口網站中指派給您應用程式的應用程式識別碼。</span><span class="sxs-lookup"><span data-stu-id="d88fa-169">For Azure AD B2C, the audience is your app's application ID, as assigned to your app in the app registration portal.</span></span> <span data-ttu-id="d88fa-170">您的應用程式應驗證此值並拒絕不相符的權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-170">Your app should validate this value and reject the token if it does not match.</span></span> |
| <span data-ttu-id="d88fa-171">Issuer</span><span class="sxs-lookup"><span data-stu-id="d88fa-171">Issuer</span></span> |`iss` |`https://login.microsoftonline.com/775527ff-9a37-4307-8b3d-cc311f58d925/v2.0/` |<span data-ttu-id="d88fa-172">此宣告會識別負責建構並傳回權杖的 Security Token Service (STS)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-172">This claim identifies the security token service (STS) that constructs and returns the token.</span></span> <span data-ttu-id="d88fa-173">它也會識別用於驗證使用者的 Azure AD 目錄。</span><span class="sxs-lookup"><span data-stu-id="d88fa-173">It also identifies the Azure AD directory in which the user was authenticated.</span></span> <span data-ttu-id="d88fa-174">您的應用程式應該驗證簽發者宣告，以確保權杖來自 Azure Active Directory v2.0 端點。</span><span class="sxs-lookup"><span data-stu-id="d88fa-174">Your app should validate the issuer claim to ensure that the token came from the Azure Active Directory v2.0 endpoint.</span></span> |
| <span data-ttu-id="d88fa-175">發出時間</span><span class="sxs-lookup"><span data-stu-id="d88fa-175">Issued at</span></span> |`iat` |`1438535543` |<span data-ttu-id="d88fa-176">此宣告是簽發權杖的時間，以新紀元時間表示。</span><span class="sxs-lookup"><span data-stu-id="d88fa-176">This claim is the time at which the token was issued, represented in epoch time.</span></span> |
| <span data-ttu-id="d88fa-177">到期時間</span><span class="sxs-lookup"><span data-stu-id="d88fa-177">Expiration time</span></span> |`exp` |`1438539443` |<span data-ttu-id="d88fa-178">此到期時間宣告是權杖失效的時間，以新紀元時間表示。</span><span class="sxs-lookup"><span data-stu-id="d88fa-178">The expiration time claim is the time at which the token becomes invalid, represented in epoch time.</span></span> <span data-ttu-id="d88fa-179">您的應用程式應使用此宣告來驗證權杖存留期的有效性。</span><span class="sxs-lookup"><span data-stu-id="d88fa-179">Your app should use this claim to verify the validity of the token lifetime.</span></span> |
| <span data-ttu-id="d88fa-180">生效時間</span><span class="sxs-lookup"><span data-stu-id="d88fa-180">Not before</span></span> |`nbf` |`1438535543` |<span data-ttu-id="d88fa-181">此宣告是權杖生效的時間，以新紀元時間表示。</span><span class="sxs-lookup"><span data-stu-id="d88fa-181">This claim is the time at which the token becomes valid, represented in epoch time.</span></span> <span data-ttu-id="d88fa-182">這通常與權杖的簽發時間相同。</span><span class="sxs-lookup"><span data-stu-id="d88fa-182">This is usually the same as the time the token was issued.</span></span> <span data-ttu-id="d88fa-183">您的應用程式應使用此宣告來驗證權杖存留期的有效性。</span><span class="sxs-lookup"><span data-stu-id="d88fa-183">Your app should use this claim to verify the validity of the token lifetime.</span></span> |
| <span data-ttu-id="d88fa-184">版本</span><span class="sxs-lookup"><span data-stu-id="d88fa-184">Version</span></span> |`ver` |`1.0` |<span data-ttu-id="d88fa-185">這是 Azure AD 所定義的 ID 權杖版本。</span><span class="sxs-lookup"><span data-stu-id="d88fa-185">This is the version of the ID token, as defined by Azure AD.</span></span> |
| <span data-ttu-id="d88fa-186">代碼雜湊</span><span class="sxs-lookup"><span data-stu-id="d88fa-186">Code hash</span></span> |`c_hash` |`SGCPtt01wxwfgnYZy2VJtQ` |<span data-ttu-id="d88fa-187">只有當 ID 權杖與 OAuth 2.0 授權碼一起簽發時，權杖才會包含代碼雜湊。</span><span class="sxs-lookup"><span data-stu-id="d88fa-187">A code hash is included in an ID token only when the token is issued together with an OAuth 2.0 authorization code.</span></span> <span data-ttu-id="d88fa-188">代碼雜湊可用來驗證授權碼的真實性。</span><span class="sxs-lookup"><span data-stu-id="d88fa-188">A code hash can be used to validate the authenticity of an authorization code.</span></span> <span data-ttu-id="d88fa-189">如需如何執行此驗證的詳細資訊，請參閱 [OpenID Connect 規格](http://openid.net/specs/openid-connect-core-1_0.html) \(英文\)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-189">For more details on how to perform this validation, see the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html).</span></span>  |
| <span data-ttu-id="d88fa-190">存取權杖雜湊</span><span class="sxs-lookup"><span data-stu-id="d88fa-190">Access token hash</span></span> |`at_hash` |`SGCPtt01wxwfgnYZy2VJtQ` |<span data-ttu-id="d88fa-191">只有當 ID 權杖與 OAuth 2.0 存取權杖一起簽發時，權杖才會包含存取權杖雜湊。</span><span class="sxs-lookup"><span data-stu-id="d88fa-191">An access token hash is included in an ID token only when the token is issued together with an OAuth 2.0 access token.</span></span> <span data-ttu-id="d88fa-192">存取權杖雜湊可用來驗證存取權杖的真實性。</span><span class="sxs-lookup"><span data-stu-id="d88fa-192">An access token hash can be used to validate the authenticity of an access token.</span></span> <span data-ttu-id="d88fa-193">如需如何執行此驗證的詳細資訊，請參閱 [OpenID Connect 規格](http://openid.net/specs/openid-connect-core-1_0.html) \(英文\)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-193">For more details on how to perform this validation, see the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html)</span></span>  |
| <span data-ttu-id="d88fa-194">Nonce</span><span class="sxs-lookup"><span data-stu-id="d88fa-194">Nonce</span></span> |`nonce` |`12345` |<span data-ttu-id="d88fa-195">Nonce 是用來緩和權杖重新執行攻擊的策略。</span><span class="sxs-lookup"><span data-stu-id="d88fa-195">A nonce is a strategy used to mitigate token replay attacks.</span></span> <span data-ttu-id="d88fa-196">您的應用程式可以使用 `nonce` 查詢參數，在授權要求中指定 Nonce。</span><span class="sxs-lookup"><span data-stu-id="d88fa-196">Your app can specify a nonce in an authorization request by using the `nonce` query parameter.</span></span> <span data-ttu-id="d88fa-197">您在要求中提供的值將只會在 ID 權杖的 `nonce` 宣告中發出 (未經修改)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-197">The value you provide in the request will be emitted unmodified in the `nonce` claim of an ID token only.</span></span> <span data-ttu-id="d88fa-198">這可讓您的應用程式根據在要求上指定的值驗證此值，使應用程式的工作階段與給定的 ID 權杖產生關聯。</span><span class="sxs-lookup"><span data-stu-id="d88fa-198">This allows your app to verify the value against the value it specified on the request, which associates the app's session with a given ID token.</span></span> <span data-ttu-id="d88fa-199">您的應用程式應在 ID 權杖驗證程序中執行這項驗證。</span><span class="sxs-lookup"><span data-stu-id="d88fa-199">Your app should perform this validation during the ID token validation process.</span></span> |
| <span data-ttu-id="d88fa-200">主旨</span><span class="sxs-lookup"><span data-stu-id="d88fa-200">Subject</span></span> |`sub` |`884408e1-2918-4cz0-b12d-3aa027d7563b` |<span data-ttu-id="d88fa-201">這是權杖聲稱資訊時所針對的主體，例如應用程式的使用者。</span><span class="sxs-lookup"><span data-stu-id="d88fa-201">This is the principal about which the token asserts information, such as the user of an app.</span></span> <span data-ttu-id="d88fa-202">這個值不可變，而且無法重新指派或重複使用。</span><span class="sxs-lookup"><span data-stu-id="d88fa-202">This value is immutable and cannot be reassigned or reused.</span></span> <span data-ttu-id="d88fa-203">它可用來安全地執行授權檢查，例如當權杖用於存取資源時。</span><span class="sxs-lookup"><span data-stu-id="d88fa-203">It can be used to perform authorization checks safely, such as when the token is used to access a resource.</span></span> <span data-ttu-id="d88fa-204">根據預設，主體宣告會填入目錄中使用者的物件識別碼。</span><span class="sxs-lookup"><span data-stu-id="d88fa-204">By default, the subject claim is populated with the object ID of the user in the directory.</span></span> <span data-ttu-id="d88fa-205">若要深入了解，請參閱 [Azure Active Directory B2C︰權杖、工作階段及單一登入設定](active-directory-b2c-token-session-sso.md)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-205">To learn more, see [Azure Active Directory B2C: Token, session, and single sign-on configuration](active-directory-b2c-token-session-sso.md).</span></span> |
| <span data-ttu-id="d88fa-206">驗證內容類別參考</span><span class="sxs-lookup"><span data-stu-id="d88fa-206">Authentication context class reference</span></span> |`acr` |<span data-ttu-id="d88fa-207">不適用</span><span class="sxs-lookup"><span data-stu-id="d88fa-207">Not applicable</span></span> |<span data-ttu-id="d88fa-208">目前未使用 (較舊的原則除外)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-208">Not used currently, except in the case of older policies.</span></span> <span data-ttu-id="d88fa-209">若要深入了解，請參閱 [Azure Active Directory B2C︰權杖、工作階段及單一登入設定](active-directory-b2c-token-session-sso.md)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-209">To learn more, see [Azure Active Directory B2C: Token, session, and single sign-on configuration](active-directory-b2c-token-session-sso.md).</span></span> |
| <span data-ttu-id="d88fa-210">信任架構原則</span><span class="sxs-lookup"><span data-stu-id="d88fa-210">Trust framework policy</span></span> |`tfp` |`b2c_1_sign_in` |<span data-ttu-id="d88fa-211">這是用來取得 ID 權杖的原則名稱。</span><span class="sxs-lookup"><span data-stu-id="d88fa-211">This is the name of the policy that was used to acquire the ID token.</span></span> |
| <span data-ttu-id="d88fa-212">驗證期間</span><span class="sxs-lookup"><span data-stu-id="d88fa-212">Authentication time</span></span> |`auth_time` |`1438535543` |<span data-ttu-id="d88fa-213">此宣告是使用者上次輸入認證的時間，以新紀元時間表示。</span><span class="sxs-lookup"><span data-stu-id="d88fa-213">This claim is the time at which a user last entered credentials, represented in epoch time.</span></span> |

### <a name="refresh-tokens"></a><span data-ttu-id="d88fa-214">重新整理權杖</span><span class="sxs-lookup"><span data-stu-id="d88fa-214">Refresh tokens</span></span>
<span data-ttu-id="d88fa-215">重新整理權杖是可供您的應用程式在 OAuth 2.0 流程中取得新的 ID 權杖和存取權杖的安全性權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-215">Refresh tokens are security tokens that your app can use to acquire new ID tokens and access tokens in an OAuth 2.0 flow.</span></span> <span data-ttu-id="d88fa-216">它們可讓您的應用程式代表使用者來長期存取資源，而不需與使用者互動。</span><span class="sxs-lookup"><span data-stu-id="d88fa-216">They provide your app with long-term access to resources on behalf of users without requiring interaction with those users.</span></span>

<span data-ttu-id="d88fa-217">若要在權杖回應中接收重新整理權杖，您的應用程式必須要求 `offline_acesss` 範圍。</span><span class="sxs-lookup"><span data-stu-id="d88fa-217">To receive a refresh token in a token response, your app must request the `offline_acesss` scope.</span></span> <span data-ttu-id="d88fa-218">若要深入了解 `offline_access` 範圍，請參閱 [Azure AD B2C 通訊協定參考](active-directory-b2c-reference-protocols.md)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-218">To learn more about the `offline_access` scope, refer to the [Azure AD B2C protocol reference](active-directory-b2c-reference-protocols.md).</span></span>

<span data-ttu-id="d88fa-219">重新整理權杖永遠對您的應用程式完全不透明。</span><span class="sxs-lookup"><span data-stu-id="d88fa-219">Refresh tokens are, and will always be, completely opaque to your app.</span></span> <span data-ttu-id="d88fa-220">它們是由 Azure AD 所簽發，只能由 Azure AD 檢查和解譯。</span><span class="sxs-lookup"><span data-stu-id="d88fa-220">They are issued by Azure AD and can be inspected and interpreted only by Azure AD.</span></span> <span data-ttu-id="d88fa-221">它們屬於長效權杖，但在撰寫您的應用程式時，不應該期待重新整理權杖會持續一段特定時間。</span><span class="sxs-lookup"><span data-stu-id="d88fa-221">They are long-lived, but your app should not be written with the expectation that a refresh token will last for a specific period of time.</span></span> <span data-ttu-id="d88fa-222">重新整理權杖可能會因為各種原因而隨時失效。</span><span class="sxs-lookup"><span data-stu-id="d88fa-222">Refresh tokens can be invalidated at any moment for a variety of reasons.</span></span> <span data-ttu-id="d88fa-223">讓您的應用程式知道重新整理權杖是否有效的唯一方式，就是對 Azure AD 提出權杖要求以嘗試兌換。</span><span class="sxs-lookup"><span data-stu-id="d88fa-223">The only way for your app to know if a refresh token is valid is to attempt to redeem it by making a token request to Azure AD.</span></span>

<span data-ttu-id="d88fa-224">當您以重新整理權杖來兌換新的權杖時 (而且如果您的應用程式已獲得 `offline_access` 範圍)，您會在權杖回應中收到新的重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-224">When you redeem a refresh token for a new token (and if your app has been granted the `offline_access` scope), you will receive a new refresh token in the token response.</span></span> <span data-ttu-id="d88fa-225">您應儲存新簽發的重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-225">You should save the newly issued refresh token.</span></span> <span data-ttu-id="d88fa-226">它應該取代您先前使用於要求中的重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-226">It should replace the refresh token you previously used in the request.</span></span> <span data-ttu-id="d88fa-227">這有助於保證您的重新整理權杖盡可能長期保持有效。</span><span class="sxs-lookup"><span data-stu-id="d88fa-227">This helps guarantee that your refresh tokens remain valid for as long as possible.</span></span>

## <a name="token-validation"></a><span data-ttu-id="d88fa-228">權杖驗證</span><span class="sxs-lookup"><span data-stu-id="d88fa-228">Token validation</span></span>
<span data-ttu-id="d88fa-229">若要驗證權杖，您的應用程式應該檢查權杖的簽章和宣告。</span><span class="sxs-lookup"><span data-stu-id="d88fa-229">To validate a token, your app should check both the signature and claims of the token.</span></span>

<span data-ttu-id="d88fa-230">視您偏好的語言而定，有許多開放原始碼程式庫可用來驗證 JWT。</span><span class="sxs-lookup"><span data-stu-id="d88fa-230">Many open source libraries are available for validating JWTs, depending on your preferred language.</span></span> <span data-ttu-id="d88fa-231">我們建議您探索這些選項，而不是實作您自己的驗證邏輯。</span><span class="sxs-lookup"><span data-stu-id="d88fa-231">We recommend that you explore those options rather than implement your own validation logic.</span></span> <span data-ttu-id="d88fa-232">本指南中的資訊有助於您了解如何適當使用這些程式庫。</span><span class="sxs-lookup"><span data-stu-id="d88fa-232">The information in this guide can help you learn how to properly use those libraries.</span></span>

### <a name="validate-the-signature"></a><span data-ttu-id="d88fa-233">驗證簽章</span><span class="sxs-lookup"><span data-stu-id="d88fa-233">Validate the signature</span></span>
<span data-ttu-id="d88fa-234">JWT 包含三個區段 (以 `.` 字元分隔)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-234">A JWT contains three segments, separated by the `.` character.</span></span> <span data-ttu-id="d88fa-235">第一個區段是*標頭*，第二個是*主體*，而第三個是*簽章*。</span><span class="sxs-lookup"><span data-stu-id="d88fa-235">The first segment is the *header*, the second is the *body*, and the third is the *signature*.</span></span> <span data-ttu-id="d88fa-236">簽章區段可用來驗證權杖的真實性，您的應用程式才得以信任。</span><span class="sxs-lookup"><span data-stu-id="d88fa-236">The signature segment can be used to validate the authenticity of the token so that it can be trusted by your app.</span></span>

<span data-ttu-id="d88fa-237">Azure AD B2C 權杖是經由業界標準非對稱式加密演算法 (例如 RSA 256) 進行簽署。</span><span class="sxs-lookup"><span data-stu-id="d88fa-237">Azure AD B2C tokens are signed by using industry-standard asymmetric encryption algorithms, such as RSA 256.</span></span> <span data-ttu-id="d88fa-238">權杖標頭包含用來簽署權杖的金鑰和加密方法相關資訊：</span><span class="sxs-lookup"><span data-stu-id="d88fa-238">The header of the token contains information about the key and encryption method used to sign the token:</span></span>

```
{
        "typ": "JWT",
        "alg": "RS256",
        "kid": "GvnPApfWMdLRi8PDmisFn7bprKg"
}
```

<span data-ttu-id="d88fa-239">`alg` 宣告指出用來簽署權杖的演算法。</span><span class="sxs-lookup"><span data-stu-id="d88fa-239">The `alg` claim indicates the algorithm that was used to sign the token.</span></span> <span data-ttu-id="d88fa-240">`kid` 宣告指出用來簽署權杖的特定公開金鑰。</span><span class="sxs-lookup"><span data-stu-id="d88fa-240">The `kid` claim indicates the particular public key that was used to sign the token.</span></span>

<span data-ttu-id="d88fa-241">無論何時，Azure AD 都能使用任何一組特定的公開-私密金鑰組來簽署權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-241">At any given time, Azure AD can sign a token by using any one of a certain set of public-private key pairs.</span></span> <span data-ttu-id="d88fa-242">Azure AD 會定期替換一組可能的金鑰，所以應將您的應用程式撰寫成自動處理這些金鑰變更。</span><span class="sxs-lookup"><span data-stu-id="d88fa-242">Azure AD rotates the possible set of keys periodically, so your app should be written to handle those key changes automatically.</span></span> <span data-ttu-id="d88fa-243">檢查 Azure AD 所用公開金鑰的更新的合理頻率為每 24 小時。</span><span class="sxs-lookup"><span data-stu-id="d88fa-243">A reasonable frequency to check for updates to the public keys used by Azure AD is every 24 hours.</span></span>

<span data-ttu-id="d88fa-244">Azure AD B2C 具有 OpenID Connect 中繼資料端點。</span><span class="sxs-lookup"><span data-stu-id="d88fa-244">Azure AD B2C has an OpenID Connect metadata endpoint.</span></span> <span data-ttu-id="d88fa-245">這可讓應用程式在執行階段擷取 Azure AD B2C 的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="d88fa-245">This allows apps to fetch information about Azure AD B2C at runtime.</span></span> <span data-ttu-id="d88fa-246">這項資訊包括端點、權杖內容和權杖簽署金鑰。</span><span class="sxs-lookup"><span data-stu-id="d88fa-246">This information includes endpoints, token contents, and token signing keys.</span></span> <span data-ttu-id="d88fa-247">您的 B2C 目錄包含每個原則的 JSON 中繼資料文件。</span><span class="sxs-lookup"><span data-stu-id="d88fa-247">Your B2C directory contains a JSON metadata document for each policy.</span></span> <span data-ttu-id="d88fa-248">例如，`fabrikamb2c.onmicrosoft.com` 中適用於 `b2c_1_sign_in` 原則的中繼資料文件位於：</span><span class="sxs-lookup"><span data-stu-id="d88fa-248">For example, the metadata document for the `b2c_1_sign_in` policy in  `fabrikamb2c.onmicrosoft.com` is located at:</span></span>

```
https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1_sign_in
```

<span data-ttu-id="d88fa-249">`fabrikamb2c.onmicrosoft.com` 是用來驗證使用者的 B2C 目錄，而 `b2c_1_sign_in` 是用來取得權杖的原則。</span><span class="sxs-lookup"><span data-stu-id="d88fa-249">`fabrikamb2c.onmicrosoft.com` is the B2C directory used to authenticate the user, and `b2c_1_sign_in` is the policy used to acquire the token.</span></span> <span data-ttu-id="d88fa-250">若要判斷哪個原則用來簽署權杖 (以及何處可擷取中繼資料)，您有兩個選項。</span><span class="sxs-lookup"><span data-stu-id="d88fa-250">To determine which policy was used to sign a token (and where to go to fetch the metadata), you have two options.</span></span> <span data-ttu-id="d88fa-251">首先，原則名稱包含在權杖的 `acr` 宣告中。</span><span class="sxs-lookup"><span data-stu-id="d88fa-251">First, the policy name is included in the `acr` claim in the token.</span></span> <span data-ttu-id="d88fa-252">您可以將 JWT 主體進行 base 64 解碼，並將產生的 JSON 字串還原序列化，以剖析 JWT 主體中的宣告。</span><span class="sxs-lookup"><span data-stu-id="d88fa-252">You can parse claims out of the body of the JWT by base-64 decoding the body and deserializing the JSON string that results.</span></span> <span data-ttu-id="d88fa-253">`acr` 宣告會是用來簽發權杖的原則名稱。</span><span class="sxs-lookup"><span data-stu-id="d88fa-253">The `acr` claim will be the name of the policy that was used to issue the token.</span></span>  <span data-ttu-id="d88fa-254">另一個選項是當您發出要求時在 `state` 參數的值中將原則編碼，然後將它解碼以判斷使用了哪個原則。</span><span class="sxs-lookup"><span data-stu-id="d88fa-254">Your other option is to encode the policy in the value of the `state` parameter when you issue the request, and then decode it to determine which policy was used.</span></span> <span data-ttu-id="d88fa-255">任一種方法都有效。</span><span class="sxs-lookup"><span data-stu-id="d88fa-255">Either method is valid.</span></span>

<span data-ttu-id="d88fa-256">中繼資料文件是包含幾項實用資訊的 JSON 物件。</span><span class="sxs-lookup"><span data-stu-id="d88fa-256">The metadata document is a JSON object that contains several useful pieces of information.</span></span> <span data-ttu-id="d88fa-257">其中包括執行 OpenID Connect 驗證時所需端點的位置。</span><span class="sxs-lookup"><span data-stu-id="d88fa-257">These include the location of the endpoints required to perform OpenID Connect authentication.</span></span> <span data-ttu-id="d88fa-258">它們還包含 `jwks_uri`，指出用來簽署權杖的公用金鑰組的位置。</span><span class="sxs-lookup"><span data-stu-id="d88fa-258">They also include `jwks_uri`, which gives the location of the set of public keys that are used to sign tokens.</span></span> <span data-ttu-id="d88fa-259">這裡提供該位置，但最好使用中繼資料文件並剖析 `jwks_uri`來動態擷取該位置：</span><span class="sxs-lookup"><span data-stu-id="d88fa-259">That location is provided here, but it is best to fetch the location dynamically by using the metadata document and parsing out `jwks_uri`:</span></span>

```
https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/discovery/v2.0/keys?p=b2c_1_sign_in
```

<span data-ttu-id="d88fa-260">位於此 URL 的 JSON 文件包含特定時刻使用的所有公開金鑰資訊。</span><span class="sxs-lookup"><span data-stu-id="d88fa-260">The JSON document located at this URL contains all the public key information in use at a particular moment.</span></span> <span data-ttu-id="d88fa-261">您的應用程式可以使用 JWT 標頭中的 `kid` 宣告，以選取 JSON 文件中用來簽署特定權杖的公開金鑰。</span><span class="sxs-lookup"><span data-stu-id="d88fa-261">Your app can use the `kid` claim in the JWT header to select the public key in the JSON document that is used to sign a particular token.</span></span> <span data-ttu-id="d88fa-262">接著可以使用正確的公開金鑰和指定的演算法來執行簽章驗證。</span><span class="sxs-lookup"><span data-stu-id="d88fa-262">It can then perform signature validation by using the correct public key and the indicated algorithm.</span></span>

<span data-ttu-id="d88fa-263">描述如何執行簽章驗證已超出本文的範圍。</span><span class="sxs-lookup"><span data-stu-id="d88fa-263">A description of how to perform signature validation is outside the scope of this document.</span></span> <span data-ttu-id="d88fa-264">如果需要的話，有許多開放原始碼程式庫可協助您處理這方面。</span><span class="sxs-lookup"><span data-stu-id="d88fa-264">Many open source libraries are available to help you with this if you need it.</span></span>

### <a name="validate-the-claims"></a><span data-ttu-id="d88fa-265">驗證宣告</span><span class="sxs-lookup"><span data-stu-id="d88fa-265">Validate the claims</span></span>
<span data-ttu-id="d88fa-266">當您的應用程式或 API 收到 ID 權杖時，還應該對 ID 權杖中的宣告執行幾項檢查。</span><span class="sxs-lookup"><span data-stu-id="d88fa-266">When your app or API receives an ID token, it should also perform several checks against the claims in the ID token.</span></span> <span data-ttu-id="d88fa-267">包含但不限於：</span><span class="sxs-lookup"><span data-stu-id="d88fa-267">These include, but are not limited to:</span></span>

* <span data-ttu-id="d88fa-268">**對象** 宣告：這會確認 ID 權杖預定要提供給您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="d88fa-268">The **audience** claim: This verifies that the ID token was intended to be given to your app.</span></span>
* <span data-ttu-id="d88fa-269">**生效時間**和**到期時間**宣告：這些會確認 ID 權杖尚未過期。</span><span class="sxs-lookup"><span data-stu-id="d88fa-269">The **not before** and **expiration time** claims: These verify that the ID token has not expired.</span></span>
* <span data-ttu-id="d88fa-270">**簽發者** 宣告：這會確認權杖已由 Azure AD 簽發給您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="d88fa-270">The **issuer** claim: This verifies that the token was issued to your app by Azure AD.</span></span>
* <span data-ttu-id="d88fa-271">**Nonce**：這是用來緩和權杖重新執行攻擊的策略。</span><span class="sxs-lookup"><span data-stu-id="d88fa-271">The **nonce**: This is a strategy for token replay attack mitigation.</span></span>

<span data-ttu-id="d88fa-272">如需您應用程式應執行之驗證的完整清單，請參閱 [OpenID Connect 規格](https://openid.net) \(英文\)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-272">For a full list of validations your app should perform, refer to the [OpenID Connect specification](https://openid.net).</span></span> <span data-ttu-id="d88fa-273">先前的 [權杖一節](#types-of-tokens)包含這些宣告的預期值的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="d88fa-273">Details of the expected values for these claims are included in the preceding [token section](#types-of-tokens).</span></span>  

## <a name="token-lifetimes"></a><span data-ttu-id="d88fa-274">權杖存留期</span><span class="sxs-lookup"><span data-stu-id="d88fa-274">Token lifetimes</span></span>
<span data-ttu-id="d88fa-275">下列權杖存留期讓您了解更透徹。</span><span class="sxs-lookup"><span data-stu-id="d88fa-275">The following token lifetimes are provided to further your knowledge.</span></span> <span data-ttu-id="d88fa-276">當您開發及偵錯應用程式時，它們可以協助您。</span><span class="sxs-lookup"><span data-stu-id="d88fa-276">They can help you when you develop and debug apps.</span></span> <span data-ttu-id="d88fa-277">請注意，撰寫您的應用程式時，請不要認為任何存留期會維持不變。</span><span class="sxs-lookup"><span data-stu-id="d88fa-277">Note that your apps should not be written to expect any of these lifetimes to remain constant.</span></span> <span data-ttu-id="d88fa-278">它們會變更。</span><span class="sxs-lookup"><span data-stu-id="d88fa-278">They can and will change.</span></span> <span data-ttu-id="d88fa-279">請閱讀更多在 Azure AD B2C 中[自訂權杖存留期](active-directory-b2c-token-session-sso.md)的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="d88fa-279">Read more about the [customization of token lifetimes](active-directory-b2c-token-session-sso.md) in Azure AD B2C.</span></span>

| <span data-ttu-id="d88fa-280">權杖</span><span class="sxs-lookup"><span data-stu-id="d88fa-280">Token</span></span> | <span data-ttu-id="d88fa-281">存留期</span><span class="sxs-lookup"><span data-stu-id="d88fa-281">Lifetime</span></span> | <span data-ttu-id="d88fa-282">說明</span><span class="sxs-lookup"><span data-stu-id="d88fa-282">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="d88fa-283">ID 權杖</span><span class="sxs-lookup"><span data-stu-id="d88fa-283">ID tokens</span></span> |<span data-ttu-id="d88fa-284">一小時</span><span class="sxs-lookup"><span data-stu-id="d88fa-284">One hour</span></span> |<span data-ttu-id="d88fa-285">ID 權杖的有效期通常為 1 小時。</span><span class="sxs-lookup"><span data-stu-id="d88fa-285">ID tokens are typically valid for an hour.</span></span> <span data-ttu-id="d88fa-286">Web 應用程式可以使用此存留期來維持它自己與使用者之間的工作階段 (建議選項)。</span><span class="sxs-lookup"><span data-stu-id="d88fa-286">Your web app can use this lifetime to maintain its own sessions with users (recommended).</span></span> <span data-ttu-id="d88fa-287">您也可以選擇不同的工作階段存留期。</span><span class="sxs-lookup"><span data-stu-id="d88fa-287">You can also choose a different session lifetime.</span></span> <span data-ttu-id="d88fa-288">如果您的應用程式需要取得新的 ID 權杖，它只需要對 Azure AD 提出新的登入要求。</span><span class="sxs-lookup"><span data-stu-id="d88fa-288">If your app needs to get a new ID token, it simply needs to make a new sign-in request to Azure AD.</span></span> <span data-ttu-id="d88fa-289">如果使用者與 Azure AD 之間存在有效的瀏覽器工作階段，該使用者可能不需要再次輸入認證。</span><span class="sxs-lookup"><span data-stu-id="d88fa-289">If a user has a valid browser session with Azure AD, that user might not be required to enter credentials again.</span></span> |
| <span data-ttu-id="d88fa-290">重新整理權杖</span><span class="sxs-lookup"><span data-stu-id="d88fa-290">Refresh tokens</span></span> |<span data-ttu-id="d88fa-291">最多 14 天</span><span class="sxs-lookup"><span data-stu-id="d88fa-291">Up to 14 days</span></span> |<span data-ttu-id="d88fa-292">單一重新整理權杖的有效期最多 14 天。</span><span class="sxs-lookup"><span data-stu-id="d88fa-292">A single refresh token is valid for a maximum of 14 days.</span></span> <span data-ttu-id="d88fa-293">不過，重新整理權杖可能會基於許多因素而隨時失效。</span><span class="sxs-lookup"><span data-stu-id="d88fa-293">However, a refresh token can become invalid at any time for a number of reasons.</span></span> <span data-ttu-id="d88fa-294">您的應用程式應繼續嘗試使用重新整理權杖，直到要求失敗，或您的應用程式更換新的重新整理權杖為止。</span><span class="sxs-lookup"><span data-stu-id="d88fa-294">Your app should continue to try to use a refresh token until the request fails, or until your app replaces the refresh token with a new one.</span></span> <span data-ttu-id="d88fa-295">在使用者上次輸入認證之後經過 90 天，重新整理權杖也會失效。</span><span class="sxs-lookup"><span data-stu-id="d88fa-295">A refresh token can also become invalid if 90 days have passed since the user last entered credentials.</span></span> |
| <span data-ttu-id="d88fa-296">授權碼</span><span class="sxs-lookup"><span data-stu-id="d88fa-296">Authorization codes</span></span> |<span data-ttu-id="d88fa-297">五分鐘</span><span class="sxs-lookup"><span data-stu-id="d88fa-297">Five minutes</span></span> |<span data-ttu-id="d88fa-298">授權碼是刻意設計成短期。</span><span class="sxs-lookup"><span data-stu-id="d88fa-298">Authorization codes are intentionally short-lived.</span></span> <span data-ttu-id="d88fa-299">它們應在收到時立即兌換成存取權杖、ID 權杖或重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="d88fa-299">They should be redeemed immediately for access tokens, ID tokens, or refresh tokens when they are received.</span></span> |

