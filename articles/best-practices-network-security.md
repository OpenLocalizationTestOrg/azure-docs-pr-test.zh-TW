---
title: "Azure 網路安全性最佳作法 |Microsoft Docs"
description: "了解 Azure 中可用來協助建立安全網路環境中的一些重要功能"
services: virtual-network
documentationcenter: na
author: tracsman
manager: rossort
editor: 
ms.assetid: d169387a-1243-4867-a602-01d6f2d8a2a1
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/03/2017
ms.author: jonor
ms.openlocfilehash: fb5e399d4ab02a7f2805cc280b213bf5b44f6993
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="microsoft-cloud-services-and-network-security"></a><span data-ttu-id="fdecd-103">Microsoft 雲端服務和網路安全性</span><span class="sxs-lookup"><span data-stu-id="fdecd-103">Microsoft cloud services and network security</span></span>
<span data-ttu-id="fdecd-104">Microsoft 雲端服務提供超大規模的服務和基礎結構、企業級的功能，以及許多混合式連線選項。</span><span class="sxs-lookup"><span data-stu-id="fdecd-104">Microsoft cloud services deliver hyper-scale services and infrastructure, enterprise-grade capabilities, and many choices for hybrid connectivity.</span></span> <span data-ttu-id="fdecd-105">客戶可以選擇透過網際網路或透過 Azure ExpressRoute (提供私人網路連線能力) 存取這些服務。</span><span class="sxs-lookup"><span data-stu-id="fdecd-105">Customers can choose to access these services either via the Internet or with Azure ExpressRoute, which provides private network connectivity.</span></span> <span data-ttu-id="fdecd-106">Microsoft Azure 平台可讓客戶順暢地將基礎結構延伸至雲端並建置多層式架構。</span><span class="sxs-lookup"><span data-stu-id="fdecd-106">The Microsoft Azure platform allows customers to seamlessly extend their infrastructure into the cloud and build multi-tier architectures.</span></span> <span data-ttu-id="fdecd-107">另外，協力廠商可以提供安全性服務和虛擬設備，以啟用增強的功能。</span><span class="sxs-lookup"><span data-stu-id="fdecd-107">Additionally, third parties can enable enhanced capabilities by offering security services and virtual appliances.</span></span> <span data-ttu-id="fdecd-108">當客戶使用透過 ExpressRoute 存取的 Microsoft 雲端服務，這份白皮書提供他們應該考慮的安全性和架構性問題的概觀。</span><span class="sxs-lookup"><span data-stu-id="fdecd-108">This white paper provides an overview of security and architectural issues that customers should consider when using Microsoft cloud services accessed via ExpressRoute.</span></span> <span data-ttu-id="fdecd-109">也包括在 Azure 虛擬網路中建立更安全的服務。</span><span class="sxs-lookup"><span data-stu-id="fdecd-109">It also covers creating more secure services in Azure virtual networks.</span></span>

## <a name="fast-start"></a><span data-ttu-id="fdecd-110">快速開始</span><span class="sxs-lookup"><span data-stu-id="fdecd-110">Fast start</span></span>
<span data-ttu-id="fdecd-111">以下邏輯圖表以具體範例說明 Azure 平台可用的許多安全性技術。</span><span class="sxs-lookup"><span data-stu-id="fdecd-111">The following logic chart can direct you to a specific example of the many security techniques available with the Azure platform.</span></span> <span data-ttu-id="fdecd-112">如需快速參考，請找出最符合您情況的範例。</span><span class="sxs-lookup"><span data-stu-id="fdecd-112">For quick reference, find the example that best fits your case.</span></span> <span data-ttu-id="fdecd-113">如需延伸說明，請繼續閱讀本文。</span><span class="sxs-lookup"><span data-stu-id="fdecd-113">For expanded explanations, continue reading through the paper.</span></span>
<span data-ttu-id="fdecd-114">[![0]][0]</span><span class="sxs-lookup"><span data-stu-id="fdecd-114">[![0]][0]</span></span>

[<span data-ttu-id="fdecd-115">範例 1︰建置周邊網路 (也稱為 DMZ、非軍事區或屏蔽式子網路)，使用網路安全性群組 (NSG) 協助保護應用程式。</span><span class="sxs-lookup"><span data-stu-id="fdecd-115">Example 1: Build a perimeter network (also known as DMZ, demilitarized zone, or screened subnet) to help protect applications with network security groups (NSGs).</span></span>](#example-1-build-a-perimeter-network-to-help-protect-applications-with-nsgs)</br><span data-ttu-id="fdecd-116">
[範例 2：建置周邊網路，使用防火牆和 NSG 協助保護應用程式。](#example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs)</span><span class="sxs-lookup"><span data-stu-id="fdecd-116">
[Example 2: Build a perimeter network to help protect applications with a firewall and NSGs.](#example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs)</span></span></br><span data-ttu-id="fdecd-117">
[範例 3︰建置周邊網路，使用防火牆、使用者定義的路由 (UDR) 及 NSG 協助保護網路。](#example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg)</span><span class="sxs-lookup"><span data-stu-id="fdecd-117">
[Example 3: Build a perimeter network to help protect networks with a firewall, user-defined route (UDR), and NSG.](#example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg)</span></span></br><span data-ttu-id="fdecd-118">
[範例 4：新增使用站對站、虛擬設備的虛擬私人網路 (VPN) 混合式連接。](#example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn)</span><span class="sxs-lookup"><span data-stu-id="fdecd-118">
[Example 4: Add a hybrid connection with a site-to-site, virtual appliance virtual private network (VPN).](#example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn)</span></span></br><span data-ttu-id="fdecd-119">
[範例 5：新增使用站對站 Azure VPN 閘道的混合式連接。](#example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway)</span><span class="sxs-lookup"><span data-stu-id="fdecd-119">
[Example 5: Add a hybrid connection with a site-to-site, Azure VPN gateway.](#example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway)</span></span></br><span data-ttu-id="fdecd-120">
[範例 6：新增使用 ExpressRoute 的混合式連接。](#example-6-add-a-hybrid-connection-with-expressroute)</span><span class="sxs-lookup"><span data-stu-id="fdecd-120">
[Example 6: Add a hybrid connection with ExpressRoute.](#example-6-add-a-hybrid-connection-with-expressroute)</span></span></br>
<span data-ttu-id="fdecd-121">本文會在未來幾個月內，陸續加入在虛擬網路、高可用性及服務鏈結之間加入連接的範例。</span><span class="sxs-lookup"><span data-stu-id="fdecd-121">Examples for adding connections between virtual networks, high availability, and service chaining will be added to this document over the next few months.</span></span>

## <a name="microsoft-compliance-and-infrastructure-protection"></a><span data-ttu-id="fdecd-122">Microsoft 法規遵循與基礎結構保護</span><span class="sxs-lookup"><span data-stu-id="fdecd-122">Microsoft compliance and infrastructure protection</span></span>
<span data-ttu-id="fdecd-123">為了協助組織符合控管個人資料收集和使用之國家、區域和業界特定需求的標準，Microsoft 提供超過 40 個認證和證明。</span><span class="sxs-lookup"><span data-stu-id="fdecd-123">To help organizations comply with national, regional, and industry-specific requirements governing the collection and use of individuals’ data, Microsoft offers over 40 certifications and attestations.</span></span> <span data-ttu-id="fdecd-124">所有雲端服務提供者中最完整的組合。</span><span class="sxs-lookup"><span data-stu-id="fdecd-124">The most comprehensive set of any cloud service provider.</span></span>

<span data-ttu-id="fdecd-125">如需詳細資訊，請參閱 [Microsoft 信任中心][TrustCenter]的合規性資訊。</span><span class="sxs-lookup"><span data-stu-id="fdecd-125">For more information, see the compliance information on the [Microsoft Trust Center][TrustCenter].</span></span>

<span data-ttu-id="fdecd-126">Microsoft 有完整的方法來保護執行超大規模全域服務所需的雲端基礎結構。</span><span class="sxs-lookup"><span data-stu-id="fdecd-126">Microsoft has a comprehensive approach to protect cloud infrastructure needed to run hyper-scale global services.</span></span> <span data-ttu-id="fdecd-127">Microsoft 雲端基礎結構除實體資料中心之外，還包括硬體、軟體、網路、管理和操作人員。</span><span class="sxs-lookup"><span data-stu-id="fdecd-127">Microsoft cloud infrastructure includes hardware, software, networks, and administrative and operations staff, in addition to the physical data centers.</span></span>

<span data-ttu-id="fdecd-128">![2]</span><span class="sxs-lookup"><span data-stu-id="fdecd-128">![2]</span></span>

<span data-ttu-id="fdecd-129">這個方法為客戶提供更安全的基礎，將他們的服務部署在 Microsoft 雲端。</span><span class="sxs-lookup"><span data-stu-id="fdecd-129">This approach provides a more secure foundation for customers to deploy their services in the Microsoft cloud.</span></span> <span data-ttu-id="fdecd-130">接著就由客戶設計和建立安全性架構來保護這些服務。</span><span class="sxs-lookup"><span data-stu-id="fdecd-130">The next step is for customers to design and create a security architecture to protect these services.</span></span>

## <a name="traditional-security-architectures-and-perimeter-networks"></a><span data-ttu-id="fdecd-131">傳統的安全性架構和周邊網路</span><span class="sxs-lookup"><span data-stu-id="fdecd-131">Traditional security architectures and perimeter networks</span></span>
<span data-ttu-id="fdecd-132">雖然 Microsoft 大量投資在保護雲端基礎結構，客戶也必須保護其雲端服務和資源群組。</span><span class="sxs-lookup"><span data-stu-id="fdecd-132">Although Microsoft invests heavily in protecting the cloud infrastructure, customers must also protect their cloud services and resource groups.</span></span> <span data-ttu-id="fdecd-133">安全性的多層式方法提供最佳的防護。</span><span class="sxs-lookup"><span data-stu-id="fdecd-133">A multilayered approach to security provides the best defense.</span></span> <span data-ttu-id="fdecd-134">周邊網路安全區可防止不受信任的網路存取內部網路資源。</span><span class="sxs-lookup"><span data-stu-id="fdecd-134">A perimeter network security zone protects internal network resources from an untrusted network.</span></span> <span data-ttu-id="fdecd-135">周邊網路是指座落在網際網路和受保護的企業 IT 基礎結構之間的網路邊緣或部分地帶。</span><span class="sxs-lookup"><span data-stu-id="fdecd-135">A perimeter network refers to the edges or parts of the network that sit between the Internet and the protected enterprise IT infrastructure.</span></span>

<span data-ttu-id="fdecd-136">在典型的企業網路中，核心基礎結構的周邊有多層的安全性裝置，嚴加防禦。</span><span class="sxs-lookup"><span data-stu-id="fdecd-136">In typical enterprise networks, the core infrastructure is heavily fortified at the perimeters, with multiple layers of security devices.</span></span> <span data-ttu-id="fdecd-137">每一層的界限都由裝置和原則強制執行點組成。</span><span class="sxs-lookup"><span data-stu-id="fdecd-137">The boundary of each layer consists of devices and policy enforcement points.</span></span> <span data-ttu-id="fdecd-138">每一層可能包含以下網路安全性裝置的組合：防火牆、阻斷服務 (DoS) 預防、入侵偵測或保護系統 (IDS/IPS) 和 VPN 裝置。</span><span class="sxs-lookup"><span data-stu-id="fdecd-138">Each layer can include a combination of the following network security devices: firewalls, Denial of Service (DoS) prevention, Intrusion Detection or Protection Systems (IDS/IPS), and VPN devices.</span></span> <span data-ttu-id="fdecd-139">原則可能以防火牆原則、存取控制清單 (ACL) 或特定路由等形式強制執行。</span><span class="sxs-lookup"><span data-stu-id="fdecd-139">Policy enforcement can take the form of firewall policies, access control lists (ACLs), or specific routing.</span></span> <span data-ttu-id="fdecd-140">網路的第一防線 (直接接受來自網際網路的連入流量) 由這些機制聯合起來阻擋攻擊和有害的流量，但允許合法的要求進入網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-140">The first line of defense in the network, directly accepting incoming traffic from the Internet, is a combination of these mechanisms to block attacks and harmful traffic while allowing legitimate requests further into the network.</span></span> <span data-ttu-id="fdecd-141">此流量會直接路由至周邊網路的資源中。</span><span class="sxs-lookup"><span data-stu-id="fdecd-141">This traffic routes directly to resources in the perimeter network.</span></span> <span data-ttu-id="fdecd-142">該資源可能與網路中更深處的資源「交談」，傳送至下一個界限先進行驗證。</span><span class="sxs-lookup"><span data-stu-id="fdecd-142">That resource may then “talk” to resources deeper in the network, transiting the next boundary for validation first.</span></span> <span data-ttu-id="fdecd-143">最外層稱為周邊網路，因為網路的這個部分對網際網路公開，而兩側通常會有某種形式的保護。</span><span class="sxs-lookup"><span data-stu-id="fdecd-143">The outermost layer is called the perimeter network because this part of the network is exposed to the Internet, usually with some form of protection on both sides.</span></span> <span data-ttu-id="fdecd-144">下圖顯示公司網路中的單一子網路周邊網路範例，有兩個安全性界限。</span><span class="sxs-lookup"><span data-stu-id="fdecd-144">The following figure shows an example of a single subnet perimeter network in a corporate network, with two security boundaries.</span></span>

<span data-ttu-id="fdecd-145">![3]</span><span class="sxs-lookup"><span data-stu-id="fdecd-145">![3]</span></span>

<span data-ttu-id="fdecd-146">有許多架構用來實作周邊網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-146">There are many architectures used to implement a perimeter network.</span></span> <span data-ttu-id="fdecd-147">這些架構從簡單的負載平衡器到多子網路的周邊網路都有，每個界限上設有各種機制來阻擋流量，並保護公司網路的更深層級。</span><span class="sxs-lookup"><span data-stu-id="fdecd-147">These architectures can range from a simple load balancer to a multiple-subnet perimeter network with varied mechanisms at each boundary to block traffic and protect the deeper layers of the corporate network.</span></span> <span data-ttu-id="fdecd-148">如何組建周邊網路取決於組織的特定需求和整體的風險承受度。</span><span class="sxs-lookup"><span data-stu-id="fdecd-148">How the perimeter network is built depends on the specific needs of the organization and its overall risk tolerance.</span></span>

<span data-ttu-id="fdecd-149">當客戶將工作負載移到公用雲端時，Azure 中的周邊網路架構必須支援類似的功能，才能符合法規遵循和安全性需求。</span><span class="sxs-lookup"><span data-stu-id="fdecd-149">As customers move their workloads to public clouds, it is critical to support similar capabilities for perimeter network architecture in Azure to meet compliance and security requirements.</span></span> <span data-ttu-id="fdecd-150">本文提供客戶如何在 Azure 中組建安全網路環境方法的指導方針。</span><span class="sxs-lookup"><span data-stu-id="fdecd-150">This document provides guidelines on how customers can build a secure network environment in Azure.</span></span> <span data-ttu-id="fdecd-151">它著重在周邊網路，但也包含網路安全性各層面的完整討論。</span><span class="sxs-lookup"><span data-stu-id="fdecd-151">It focuses on the perimeter network, but also includes a comprehensive discussion of many aspects of network security.</span></span> <span data-ttu-id="fdecd-152">下列問題會通知這項討論︰</span><span class="sxs-lookup"><span data-stu-id="fdecd-152">The following questions inform this discussion:</span></span>

* <span data-ttu-id="fdecd-153">如何組建 Azure 的周邊網路？</span><span class="sxs-lookup"><span data-stu-id="fdecd-153">How can a perimeter network in Azure be built?</span></span>
* <span data-ttu-id="fdecd-154">組建周邊網路需要哪些 Azure 功能？</span><span class="sxs-lookup"><span data-stu-id="fdecd-154">What are some of the Azure features available to build the perimeter network?</span></span>
* <span data-ttu-id="fdecd-155">如何保護後端工作負載？</span><span class="sxs-lookup"><span data-stu-id="fdecd-155">How can back-end workloads be protected?</span></span>
* <span data-ttu-id="fdecd-156">如何控制網際網路對 Azure 中的工作負載進行通訊？</span><span class="sxs-lookup"><span data-stu-id="fdecd-156">How are Internet communications controlled to the workloads in Azure?</span></span>
* <span data-ttu-id="fdecd-157">如何保護內部部署網路不受 Azure 中的部署所影響？</span><span class="sxs-lookup"><span data-stu-id="fdecd-157">How can the on-premises networks be protected from deployments in Azure?</span></span>
* <span data-ttu-id="fdecd-158">何時該使用原生 Azure 安全性功能？何時又該使用協力廠商設備或服務？</span><span class="sxs-lookup"><span data-stu-id="fdecd-158">When should native Azure security features be used versus third-party appliances or services?</span></span>

<span data-ttu-id="fdecd-159">下圖顯示 Azure 提供給客戶的各種安全性層級。</span><span class="sxs-lookup"><span data-stu-id="fdecd-159">The following diagram shows various layers of security Azure provides to customers.</span></span> <span data-ttu-id="fdecd-160">這些層級既是 Azure 平台本身的原生功能，也是客戶定義的功能︰</span><span class="sxs-lookup"><span data-stu-id="fdecd-160">These layers are both native in the Azure platform itself and customer-defined features:</span></span>

<span data-ttu-id="fdecd-161">![4]</span><span class="sxs-lookup"><span data-stu-id="fdecd-161">![4]</span></span>

<span data-ttu-id="fdecd-162">從網際網路往內，Azure DDoS 會協防針對 Azure 的大規模攻擊。</span><span class="sxs-lookup"><span data-stu-id="fdecd-162">Inbound from the Internet, Azure DDoS helps protect against large-scale attacks against Azure.</span></span> <span data-ttu-id="fdecd-163">下一層是客戶定義的公用 IP 位址 (端點)，用來判斷什麼流量可通過雲端服務進入虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-163">The next layer is customer-defined public IP addresses (endpoints), which are used to determine which traffic can pass through the cloud service to the virtual network.</span></span> <span data-ttu-id="fdecd-164">原生 Azure 虛擬網路隔離可確保與其他所有網路完全隔離，而且流量只能流經使用者設定的路徑和方法。</span><span class="sxs-lookup"><span data-stu-id="fdecd-164">Native Azure virtual network isolation ensures complete isolation from all other networks and that traffic only flows through user configured paths and methods.</span></span> <span data-ttu-id="fdecd-165">這些路徑和方法就是下一層，可利用 NSG、UDR 和網路虛擬設備來建立安全性界限，以保護受保護網路中的應用程式部署。</span><span class="sxs-lookup"><span data-stu-id="fdecd-165">These paths and methods are the next layer, where NSGs, UDR, and network virtual appliances can be used to create security boundaries to protect the application deployments in the protected network.</span></span>

<span data-ttu-id="fdecd-166">下一節提供 Azure 虛擬網路的概觀。</span><span class="sxs-lookup"><span data-stu-id="fdecd-166">The next section provides an overview of Azure virtual networks.</span></span> <span data-ttu-id="fdecd-167">這些虛擬網路由客戶建立，也是部署的工作負載所連接的目的地。</span><span class="sxs-lookup"><span data-stu-id="fdecd-167">These virtual networks are created by customers, and are what their deployed workloads are connected to.</span></span> <span data-ttu-id="fdecd-168">虛擬網路是建立周邊網路來保護 Azure 中的客戶部署時，所需的一切網路安全性功能的基礎。</span><span class="sxs-lookup"><span data-stu-id="fdecd-168">Virtual networks are the basis of all the network security features required to establish a perimeter network to protect customer deployments in Azure.</span></span>

## <a name="overview-of-azure-virtual-networks"></a><span data-ttu-id="fdecd-169">Azure 虛擬網路的概觀</span><span class="sxs-lookup"><span data-stu-id="fdecd-169">Overview of Azure virtual networks</span></span>
<span data-ttu-id="fdecd-170">在網際網路流量能進入 Azure 虛擬網路之前，Azure 平台本身就有兩層安全性：</span><span class="sxs-lookup"><span data-stu-id="fdecd-170">Before Internet traffic can get to the Azure virtual networks, there are two layers of security inherent to the Azure platform:</span></span>

1.    <span data-ttu-id="fdecd-171">**DDoS 保護**：DDoS 保護是 Azure 實體網路層，保護 Azure 平台本身免於大規模的網際網路攻擊。</span><span class="sxs-lookup"><span data-stu-id="fdecd-171">**DDoS protection**: DDoS protection is a layer of the Azure physical network that protects the Azure platform itself from large-scale Internet-based attacks.</span></span> <span data-ttu-id="fdecd-172">這些攻擊會使用多個 "Bot" 節點嘗試灌爆網際網路服務。</span><span class="sxs-lookup"><span data-stu-id="fdecd-172">These attacks use multiple “bot” nodes in an attempt to overwhelm an Internet service.</span></span> <span data-ttu-id="fdecd-173">Azure 有一層很強大的 DDoS 保護網可篩選所有輸入、輸出及跨 Azure 區域的連線。</span><span class="sxs-lookup"><span data-stu-id="fdecd-173">Azure has a robust DDoS protection mesh on all inbound, outbound, and cross-Azure region connectivity.</span></span> <span data-ttu-id="fdecd-174">這個 DDoS 保護層沒有可讓使用者設定的屬性，客戶也無法接觸。</span><span class="sxs-lookup"><span data-stu-id="fdecd-174">This DDoS protection layer has no user configurable attributes and is not accessible to the customer.</span></span> <span data-ttu-id="fdecd-175">DDoS 保護層級會將 Azure 當做平台來保護，防範大規模攻擊，它也會監視輸出流量和跨 Azure 區域的流量。</span><span class="sxs-lookup"><span data-stu-id="fdecd-175">The DDoS protection layer protects Azure as a platform from large-scale attacks, it also monitors out-bound traffic and cross-Azure region traffic.</span></span> <span data-ttu-id="fdecd-176">在虛擬網路上使用網路虛擬設備，可以由客戶針對較小規模的攻擊設定多幾層的彈性，不會令平台層級保護破功。</span><span class="sxs-lookup"><span data-stu-id="fdecd-176">Using network virtual appliances on the VNet, additional layers of resilience can be configured by the customer against a smaller scale attack that doesn't trip the platform level protection.</span></span> <span data-ttu-id="fdecd-177">DDoS 的實際執行範例；如果網際網路對向的 IP 位址遭到大規模 DDoS 攻擊，Azure 會偵測攻擊的來源，並在有問題的流量到達其目的地之前中止它。</span><span class="sxs-lookup"><span data-stu-id="fdecd-177">An example of DDoS in action; if an internet facing IP address was attacked by a large-scale DDoS attack, Azure would detect the sources of the attacks and scrub the offending traffic before it reached its intended destination.</span></span> <span data-ttu-id="fdecd-178">在大多數情況下，受到攻擊的端點不會被攻擊影響。</span><span class="sxs-lookup"><span data-stu-id="fdecd-178">In almost all cases, the attacked endpoint isn't affected by the attack.</span></span> <span data-ttu-id="fdecd-179">在少數端點會受影響的情況下，其流量不會影響到其他端點，只會影響受攻擊的端點。</span><span class="sxs-lookup"><span data-stu-id="fdecd-179">In the rare cases that an endpoint is affected, no traffic is affected to other endpoints, only the attacked endpoint.</span></span> <span data-ttu-id="fdecd-180">因此，其他客戶和服務也不會看到此攻擊所造成的影響。</span><span class="sxs-lookup"><span data-stu-id="fdecd-180">Thus other customers and services would see no impact from that attack.</span></span> <span data-ttu-id="fdecd-181">請務必注意，Azure DDoS 只尋找大規模攻擊。</span><span class="sxs-lookup"><span data-stu-id="fdecd-181">It's critical to note that Azure DDoS is only looking for large-scale attacks.</span></span> <span data-ttu-id="fdecd-182">在超過平台層級保護臨界值之前，您的特定服務有可能被覆蓋。</span><span class="sxs-lookup"><span data-stu-id="fdecd-182">It is possible that your specific service could be overwhelmed before the platform level protection thresholds are exceeded.</span></span> <span data-ttu-id="fdecd-183">例如，單一 A0 IIS 伺服器上的網站，在 Azure 平台層級 DDoS 保護註冊威脅之前，可能被 DDoS 攻擊而離線。</span><span class="sxs-lookup"><span data-stu-id="fdecd-183">For example, a web site on a single A0 IIS server, could be taken offline by a DDoS attack before Azure platform level DDoS protection registered a threat.</span></span>

2.  <span data-ttu-id="fdecd-184">**公用 IP 位址**︰公用 IP 位址允許雲端服務或資源群組將公用的網際網路 IP 位址和連接埠公開；公用 IP 位址是透過服務端點、公用 IP 位址、應用程式閘道器以及其他 Azure 功能 (可向路由至您的資源的網際網路顯示公用 IP 位址) 啟用。</span><span class="sxs-lookup"><span data-stu-id="fdecd-184">**Public IP Addresses**: Public IP addresses (enabled via service endpoints, Public IP addresses, Application Gateway, and other Azure features that present a public IP address to the internet routed to your resource) allow cloud services or resource groups to have public Internet IP addresses and ports exposed.</span></span> <span data-ttu-id="fdecd-185">端點使用網路位址轉譯 (NAT) 將流量路由到 Azure 虛擬網路的內部位址和連接埠。</span><span class="sxs-lookup"><span data-stu-id="fdecd-185">The endpoint uses Network Address Translation (NAT) to route traffic to the internal address and port on the Azure virtual network.</span></span> <span data-ttu-id="fdecd-186">這個路徑是外部流量進入虛擬網路的主要方式。</span><span class="sxs-lookup"><span data-stu-id="fdecd-186">This path is the primary way for external traffic to pass into the virtual network.</span></span> <span data-ttu-id="fdecd-187">公用 IP 位址可由使用者設定，用於判斷傳入什麼流量，以及該流量在虛擬網路上如何轉譯及轉譯至何處。</span><span class="sxs-lookup"><span data-stu-id="fdecd-187">The Public IP addresses are configurable to determine which traffic is passed in, and how and where it's translated on to the virtual network.</span></span>

<span data-ttu-id="fdecd-188">一旦流量到達虛擬網路，就有許多功能可派上用場。</span><span class="sxs-lookup"><span data-stu-id="fdecd-188">Once traffic reaches the virtual network, there are many features that come into play.</span></span> <span data-ttu-id="fdecd-189">Azure 虛擬網路是客戶連接工作負載的基礎，也是套用基本網路層級安全性的位置。</span><span class="sxs-lookup"><span data-stu-id="fdecd-189">Azure virtual networks are the foundation for customers to attach their workloads and where basic network-level security applies.</span></span> <span data-ttu-id="fdecd-190">它是客戶在 Azure 中的私人網路 (虛擬網路覆疊)，具有下列功能和特性：</span><span class="sxs-lookup"><span data-stu-id="fdecd-190">It is a private network (a virtual network overlay) in Azure for customers with the following features and characteristics:</span></span>

* <span data-ttu-id="fdecd-191">**流量隔離**：虛擬網路是 Azure 平台上的流量隔離界限。</span><span class="sxs-lookup"><span data-stu-id="fdecd-191">**Traffic isolation**: A virtual network is the traffic isolation boundary on the Azure platform.</span></span> <span data-ttu-id="fdecd-192">一個虛擬網路中的虛擬機器 (VM) 無法與不同虛擬網路中的 VM 直接通訊，即使兩個虛擬網路是由同一位客戶所建立也一樣。</span><span class="sxs-lookup"><span data-stu-id="fdecd-192">Virtual machines (VMs) in one virtual network cannot communicate directly to VMs in a different virtual network, even if both virtual networks are created by the same customer.</span></span> <span data-ttu-id="fdecd-193">隔離是很重要的屬性，可確保客戶 VM 和通訊仍然隱蔽於虛擬網路內。</span><span class="sxs-lookup"><span data-stu-id="fdecd-193">Isolation is a critical property that ensures customer VMs and communication remains private within a virtual network.</span></span>

>[!NOTE]
><span data-ttu-id="fdecd-194">流量隔離只會參考「輸入」虛擬網路的流量。</span><span class="sxs-lookup"><span data-stu-id="fdecd-194">Traffic isolation refers only to traffic *inbound* to the virtual network.</span></span> <span data-ttu-id="fdecd-195">依預設，系統允許從 VNet 到網際網路的輸出流量，但如果 NSG 有需要可加以阻止。</span><span class="sxs-lookup"><span data-stu-id="fdecd-195">By default outbound traffic from the VNet to the internet is allowed, but can be prevented if desired by NSGs.</span></span>
>
>

* <span data-ttu-id="fdecd-196">**多層拓撲**：虛擬網路可讓客戶配置子網路並為工作負載的不同元素或「層」指定個別位址空間，以定義多層拓撲。</span><span class="sxs-lookup"><span data-stu-id="fdecd-196">**Multi-tier topology**: Virtual networks allow customers to define multi-tier topology by allocating subnets and designating separate address spaces for different elements or “tiers” of their workloads.</span></span> <span data-ttu-id="fdecd-197">這些邏輯分群和拓撲可讓客戶根據工作負載類型來定義不同的存取原則，還可控制各層之間的流量。</span><span class="sxs-lookup"><span data-stu-id="fdecd-197">These logical groupings and topologies enable customers to define different access policy based on the workload types, and also control traffic flows between the tiers.</span></span>
* <span data-ttu-id="fdecd-198">**跨單位連線**：客戶可以在虛擬網路和多個內部部署網站或 Azure 中的其他虛擬網路之間，建立跨單位連線。</span><span class="sxs-lookup"><span data-stu-id="fdecd-198">**Cross-premises connectivity**: Customers can establish cross-premises connectivity between a virtual network and multiple on-premises sites or other virtual networks in Azure.</span></span> <span data-ttu-id="fdecd-199">若要建立連線，客戶可以使用 VNet 對等互連、Azure VPN 閘道、協力廠商的網路虛擬設備或 ExpressRoute。</span><span class="sxs-lookup"><span data-stu-id="fdecd-199">To construct a connection, customers can use VNet Peering, Azure VPN Gateways, third-party network virtual appliances, or ExpressRoute.</span></span> <span data-ttu-id="fdecd-200">Azure 支援使用標準 IPsec/IKE 通訊協定和 ExpressRoute 私人連線能力的站對站 (S2S) VPN。</span><span class="sxs-lookup"><span data-stu-id="fdecd-200">Azure supports site-to-site (S2S) VPNs using standard IPsec/IKE protocols and ExpressRoute private connectivity.</span></span>
* <span data-ttu-id="fdecd-201">**NSG** 可讓客戶依所需的精細度建立規則 (ACL)：網路介面、個別的 VM 或虛擬子網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-201">**NSG** allows customers to create rules (ACLs) at the desired level of granularity: network interfaces, individual VMs, or virtual subnets.</span></span> <span data-ttu-id="fdecd-202">客戶可以從客戶網路上的系統，透過跨單位連線或直接網際網路通訊，允許或拒絕虛擬網路內的工作負載，以控制存取權。</span><span class="sxs-lookup"><span data-stu-id="fdecd-202">Customers can control access by permitting or denying communication between the workloads within a virtual network, from systems on customer’s networks via cross-premises connectivity, or direct Internet communication.</span></span>
* <span data-ttu-id="fdecd-203">**UDR** 和 **IP 轉送**可讓客戶定義虛擬網路內的不同層之間的通訊路徑。</span><span class="sxs-lookup"><span data-stu-id="fdecd-203">**UDR** and **IP Forwarding** allow customers to define the communication paths between different tiers within a virtual network.</span></span> <span data-ttu-id="fdecd-204">客戶可以部署防火牆、IDS/IPS 和其他虛擬設備，並透過這些安全性設備來路由傳送網路流量，以強制執行安全性界限原則、稽核和檢查。</span><span class="sxs-lookup"><span data-stu-id="fdecd-204">Customers can deploy a firewall, IDS/IPS, and other virtual appliances, and route network traffic through these security appliances for security boundary policy enforcement, auditing, and inspection.</span></span>
* <span data-ttu-id="fdecd-205">**網路虛擬設備** ：Azure Marketplace 和 VM 映像資源庫中提供防火牆、負載平衡器和 IDS/IPS 等安全性設備。</span><span class="sxs-lookup"><span data-stu-id="fdecd-205">**Network virtual appliances** in the Azure Marketplace: Security appliances such as firewalls, load balancers, and IDS/IPS are available in the Azure Marketplace and the VM Image Gallery.</span></span> <span data-ttu-id="fdecd-206">客戶可以將這些設備部署到其虛擬網路，特別是安全性界限 (包括周邊網路子網路)，以完成多層式安全網路環境。</span><span class="sxs-lookup"><span data-stu-id="fdecd-206">Customers can deploy these appliances into their virtual networks, and specifically, at their security boundaries (including the perimeter network subnets) to complete a multi-tiered secure network environment.</span></span>

<span data-ttu-id="fdecd-207">根據這些功能，下圖提供一個如何在 Azure 中建構周邊網路架構的範例：</span><span class="sxs-lookup"><span data-stu-id="fdecd-207">With these features and capabilities, one example of how a perimeter network architecture could be constructed in Azure is the following diagram:</span></span>

<span data-ttu-id="fdecd-208">![5]</span><span class="sxs-lookup"><span data-stu-id="fdecd-208">![5]</span></span>

## <a name="perimeter-network-characteristics-and-requirements"></a><span data-ttu-id="fdecd-209">周邊網路特性和需求</span><span class="sxs-lookup"><span data-stu-id="fdecd-209">Perimeter network characteristics and requirements</span></span>
<span data-ttu-id="fdecd-210">周邊網路是網路的前端，直接與來自網際網路的通訊正面接觸。</span><span class="sxs-lookup"><span data-stu-id="fdecd-210">The perimeter network is the front end of the network, directly interfacing communication from the Internet.</span></span> <span data-ttu-id="fdecd-211">連入封包應該會先流經安全性設備，如防火牆、IDS 和 IPS 等，才會到達後端伺服器。</span><span class="sxs-lookup"><span data-stu-id="fdecd-211">The incoming packets should flow through the security appliances, such as the firewall, IDS, and IPS, before reaching the back-end servers.</span></span> <span data-ttu-id="fdecd-212">來自工作負載的網際網路繫結封包可能也會流經周邊網路中的安全性設備，經過原則強制執行、檢查和稽核之後，才會離開網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-212">Internet-bound packets from the workloads can also flow through the security appliances in the perimeter network for policy enforcement, inspection, and auditing purposes, before leaving the network.</span></span> <span data-ttu-id="fdecd-213">此外，周邊網路也可以裝載客戶虛擬網路與內部部署網路之間的跨單位 VPN 閘道。</span><span class="sxs-lookup"><span data-stu-id="fdecd-213">Additionally, the perimeter network can host cross-premises VPN gateways between customer virtual networks and on-premises networks.</span></span>

### <a name="perimeter-network-characteristics"></a><span data-ttu-id="fdecd-214">周邊網路特性</span><span class="sxs-lookup"><span data-stu-id="fdecd-214">Perimeter network characteristics</span></span>
<span data-ttu-id="fdecd-215">請參見上圖，好的周邊網路應有下列特性︰</span><span class="sxs-lookup"><span data-stu-id="fdecd-215">Referencing the previous figure, some of the characteristics of a good perimeter network are as follows:</span></span>

* <span data-ttu-id="fdecd-216">網際網路對向︰</span><span class="sxs-lookup"><span data-stu-id="fdecd-216">Internet-facing:</span></span>
  * <span data-ttu-id="fdecd-217">周邊網路子網路本身是網際網路對向，直接與網際網路進行通訊。</span><span class="sxs-lookup"><span data-stu-id="fdecd-217">The perimeter network subnet itself is Internet-facing, directly communicating with the Internet.</span></span>
  * <span data-ttu-id="fdecd-218">公用 IP 位址、VIP 及/或服務端點會將網際網路流量傳遞給前端網路和裝置。</span><span class="sxs-lookup"><span data-stu-id="fdecd-218">Public IP addresses, VIPs, and/or service endpoints pass Internet traffic to the front-end network and devices.</span></span>
  * <span data-ttu-id="fdecd-219">來自網際網路的輸入流量會先通過安全性裝置，才會通過前端網路上其他資源。</span><span class="sxs-lookup"><span data-stu-id="fdecd-219">Inbound traffic from the Internet passes through security devices before other resources on the front-end network.</span></span>
  * <span data-ttu-id="fdecd-220">如果已啟用輸出安全性，流量會通過安全性裝置 (最後一個步驟)，然後才會傳遞到網際網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-220">If outbound security is enabled, traffic passes through security devices, as the final step, before passing to the Internet.</span></span>
* <span data-ttu-id="fdecd-221">受保護的網路︰</span><span class="sxs-lookup"><span data-stu-id="fdecd-221">Protected network:</span></span>
  * <span data-ttu-id="fdecd-222">網際網路到核心基礎結構之間沒有直接的路徑。</span><span class="sxs-lookup"><span data-stu-id="fdecd-222">There is no direct path from the Internet to the core infrastructure.</span></span>
  * <span data-ttu-id="fdecd-223">連到核心基礎結構的通道必須通過 NSG、防火牆或 VPN 裝置等安全性裝置。</span><span class="sxs-lookup"><span data-stu-id="fdecd-223">Channels to the core infrastructure must traverse through security devices such as NSGs, firewalls, or VPN devices.</span></span>
  * <span data-ttu-id="fdecd-224">其他裝置不得橋接網際網路和核心基礎結構。</span><span class="sxs-lookup"><span data-stu-id="fdecd-224">Other devices must not bridge Internet and the core infrastructure.</span></span>
  * <span data-ttu-id="fdecd-225">在網際網路對向和受保護網路面向的周邊網路界限上的安全性裝置 (例如，上圖中顯示的兩個防火牆圖示)，實際上可能是單一虛擬設備，但針對每個界限各有不同的規則或介面。</span><span class="sxs-lookup"><span data-stu-id="fdecd-225">Security devices on both the Internet-facing and the protected network facing boundaries of the perimeter network (for example, the two firewall icons shown in the previous figure) may actually be a single virtual appliance with differentiated rules or interfaces for each boundary.</span></span> <span data-ttu-id="fdecd-226">例如，一部實體裝置，邏輯上隔開，可處理周邊網路兩個界限的負載。</span><span class="sxs-lookup"><span data-stu-id="fdecd-226">For example, one physical device, logically separated, handling the load for both boundaries of the perimeter network.</span></span>
* <span data-ttu-id="fdecd-227">其他常見的做法和條件約束：</span><span class="sxs-lookup"><span data-stu-id="fdecd-227">Other common practices and constraints:</span></span>
  * <span data-ttu-id="fdecd-228">工作負載不得儲存商務關鍵資訊。</span><span class="sxs-lookup"><span data-stu-id="fdecd-228">Workloads must not store business critical information.</span></span>
  * <span data-ttu-id="fdecd-229">只有獲授權的系統管理員才能存取和更新周邊網路設定和部署。</span><span class="sxs-lookup"><span data-stu-id="fdecd-229">Access and updates to perimeter network configurations and deployments are limited to only authorized administrators.</span></span>

### <a name="perimeter-network-requirements"></a><span data-ttu-id="fdecd-230">周邊網路需求</span><span class="sxs-lookup"><span data-stu-id="fdecd-230">Perimeter network requirements</span></span>
<span data-ttu-id="fdecd-231">為了發揮這些特性，請依照虛擬網路需求的這些指導方針，實作成功的周邊網路：</span><span class="sxs-lookup"><span data-stu-id="fdecd-231">To enable these characteristics, follow these guidelines on virtual network requirements to implement a successful perimeter network:</span></span>

* <span data-ttu-id="fdecd-232">**子網路架構：** 指定虛擬網路，使整個子網路專門作為周邊網路，與相同虛擬網路中的其他子網路分開。</span><span class="sxs-lookup"><span data-stu-id="fdecd-232">**Subnet architecture:** Specify the virtual network such that an entire subnet is dedicated as the perimeter network, separated from other subnets in the same virtual network.</span></span> <span data-ttu-id="fdecd-233">這樣隔開可確保周邊網路與其他內部或私人子網路層之間的流量，一定會流經防火牆或 IDS/IPS 虛擬設備。</span><span class="sxs-lookup"><span data-stu-id="fdecd-233">This separation ensures the traffic between the perimeter network and other internal or private subnet tiers flows through a firewall or IDS/IPS virtual appliance.</span></span>  <span data-ttu-id="fdecd-234">界限子網路上使用者定義的路由，需將此流量轉送到虛擬設備。</span><span class="sxs-lookup"><span data-stu-id="fdecd-234">User-defined routes on the boundary subnets are required to forward this traffic to the virtual appliance.</span></span>
* <span data-ttu-id="fdecd-235">**NSG：** 周邊網路子網路本身應該開啟，允許與網際網路通訊，但這不表示客戶應該略過 NSG。</span><span class="sxs-lookup"><span data-stu-id="fdecd-235">**NSG:** The perimeter network subnet itself should be open to allow communication with the Internet, but that does not mean customers should be bypassing NSGs.</span></span> <span data-ttu-id="fdecd-236">遵循一般的安全性做法，以減少網路介面暴露在網際網路中。</span><span class="sxs-lookup"><span data-stu-id="fdecd-236">Follow common security practices to minimize the network surfaces exposed to the Internet.</span></span> <span data-ttu-id="fdecd-237">鎖定可以存取部署或特定應用程式通訊協定和已開啟連接埠的遠端位址範圍。</span><span class="sxs-lookup"><span data-stu-id="fdecd-237">Lock down the remote address ranges allowed to access the deployments or the specific application protocols and ports that are open.</span></span> <span data-ttu-id="fdecd-238">但可能在某些情況下，完全鎖定不一定行得通。</span><span class="sxs-lookup"><span data-stu-id="fdecd-238">There may be circumstances, however, in which a complete lock-down is not possible.</span></span> <span data-ttu-id="fdecd-239">例如，如果客戶在 Azure 中有外部網站，則周邊網路應該允許從任何公開 IP 位址傳入的 Web 要求，但只應該開啟 Web 應用程式連接埠：80 連接埠 上的 TCP 和/或 443 連接埠上的 TCP。</span><span class="sxs-lookup"><span data-stu-id="fdecd-239">For example, if customers have an external website in Azure, the perimeter network should allow the incoming web requests from any public IP addresses, but should only open the web application ports: TCP on port 80 and/or TCP on port 443.</span></span>
* <span data-ttu-id="fdecd-240">**路由表：** 周邊網路子網路本身必須能夠直接與網際網路通訊，但不應該允許未通過防火牆或安全性設備，就直接與後端或內部部署網路之間往返通訊。</span><span class="sxs-lookup"><span data-stu-id="fdecd-240">**Routing table:** The perimeter network subnet itself should be able to communicate to the Internet directly, but should not allow direct communication to and from the back end or on-premises networks without going through a firewall or security appliance.</span></span>
* <span data-ttu-id="fdecd-241">**安全性設備設定：**為了路由傳送和檢查周邊網路與受保護網路其餘部分之間的封包，安全性設備 (如防火牆、IDS 和 IPS 裝置) 可以有多重主目錄。</span><span class="sxs-lookup"><span data-stu-id="fdecd-241">**Security appliance configuration:** To route and inspect packets between the perimeter network and the rest of the protected networks, the security appliances such as firewall, IDS, and IPS devices may be multi-homed.</span></span> <span data-ttu-id="fdecd-242">但周邊網路和後端子網路可能有個別的 NIC。</span><span class="sxs-lookup"><span data-stu-id="fdecd-242">They may have separate NICs for the perimeter network and the back-end subnets.</span></span> <span data-ttu-id="fdecd-243">周邊網路的 NIC會使用相應的 NSG 和周邊網路路由表，直接與網際網路往返通訊。</span><span class="sxs-lookup"><span data-stu-id="fdecd-243">The NICs in the perimeter network communicate directly to and from the Internet, with the corresponding NSGs and the perimeter network routing table.</span></span> <span data-ttu-id="fdecd-244">對於相應的後端子網路，連接到後端子網路的 NIC 會有更受限制的 NSG 和路由表。</span><span class="sxs-lookup"><span data-stu-id="fdecd-244">The NICs connecting to the back-end subnets have more restricted NSGs and routing tables of the corresponding back-end subnets.</span></span>
* <span data-ttu-id="fdecd-245">**安全性設備功能：** 部署在周邊網路中的安全性設備通常會執行下列功能：</span><span class="sxs-lookup"><span data-stu-id="fdecd-245">**Security appliance functionality:** The security appliances deployed in the perimeter network typically perform the following functionality:</span></span>
  * <span data-ttu-id="fdecd-246">防火牆：對連入要求強制執行防火牆規則或存取控制原則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-246">Firewall: Enforcing firewall rules or access control policies for the incoming requests.</span></span>
  * <span data-ttu-id="fdecd-247">威脅偵測和防止：偵測並減輕來自網際網路的惡意攻擊。</span><span class="sxs-lookup"><span data-stu-id="fdecd-247">Threat detection and prevention: Detecting and mitigating malicious attacks from the Internet.</span></span>
  * <span data-ttu-id="fdecd-248">稽核和記錄：維護詳細記錄供稽核和分析。</span><span class="sxs-lookup"><span data-stu-id="fdecd-248">Auditing and logging: Maintaining detailed logs for auditing and analysis.</span></span>
  * <span data-ttu-id="fdecd-249">反向 Proxy︰將連入要求重新導向至對應的後端伺服器。</span><span class="sxs-lookup"><span data-stu-id="fdecd-249">Reverse proxy: Redirecting the incoming requests to the corresponding back-end servers.</span></span> <span data-ttu-id="fdecd-250">此重新導向包括將前端裝置上的目的地位址 (通常是防火牆) 對應和轉譯到後端伺服器位址。</span><span class="sxs-lookup"><span data-stu-id="fdecd-250">This redirection involves mapping and translating the destination addresses on the front-end devices, typically firewalls, to the back-end server addresses.</span></span>
  * <span data-ttu-id="fdecd-251">正向 Proxy：提供 NAT 並稽核從虛擬網路內開始到網際網路的通訊。</span><span class="sxs-lookup"><span data-stu-id="fdecd-251">Forward proxy: Providing NAT and performing auditing for communication initiated from within the virtual network to the Internet.</span></span>
  * <span data-ttu-id="fdecd-252">路由器：轉送虛擬網路內的傳入流量和跨子網路的流量。</span><span class="sxs-lookup"><span data-stu-id="fdecd-252">Router: Forwarding incoming and cross-subnet traffic inside the virtual network.</span></span>
  * <span data-ttu-id="fdecd-253">VPN 裝置：作為內部部署網路上的客戶與 Azure 虛擬網路之間跨單位 VPN 連線的跨單位 VPN 閘道。</span><span class="sxs-lookup"><span data-stu-id="fdecd-253">VPN device: Acting as the cross-premises VPN gateways for cross-premises VPN connectivity between customer on-premises networks and Azure virtual networks.</span></span>
  * <span data-ttu-id="fdecd-254">VPN 伺服器：接受連接到 Azure 虛擬網路的 VPN 用戶端。</span><span class="sxs-lookup"><span data-stu-id="fdecd-254">VPN server: Accepting VPN clients connecting to Azure virtual networks.</span></span>

> [!TIP]
> <span data-ttu-id="fdecd-255">隔開下列兩個群組：獲授權可存取周邊網路安全性裝置的個人，與獲授權成為應用程式開發、部署或作業系統管理員的個人。</span><span class="sxs-lookup"><span data-stu-id="fdecd-255">Keep the following two groups separate: the individuals authorized to access the perimeter network security gear and the individuals authorized as application development, deployment, or operations administrators.</span></span> <span data-ttu-id="fdecd-256">將這些群組隔開可區分權責，防止單一個人略過應用程式安全性和網路安全性控制。</span><span class="sxs-lookup"><span data-stu-id="fdecd-256">Keeping these groups separate allows for a segregation of duties and prevents a single person from bypassing both applications security and network security controls.</span></span>
>
>

### <a name="questions-to-be-asked-when-building-network-boundaries"></a><span data-ttu-id="fdecd-257">組建網路界限時的疑問</span><span class="sxs-lookup"><span data-stu-id="fdecd-257">Questions to be asked when building network boundaries</span></span>
<span data-ttu-id="fdecd-258">在本節中，除非特別說明，否則「網路」一詞是指由訂用帳戶管理員所建立的私人 Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-258">In this section, unless specifically mentioned, the term "networks" refers to private Azure virtual networks created by a subscription administrator.</span></span> <span data-ttu-id="fdecd-259">此詞非指 Azure 內的基礎實體網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-259">The term doesn't refer to the underlying physical networks within Azure.</span></span>

<span data-ttu-id="fdecd-260">此外，Azure 虛擬網路通常用來擴充傳統的內部部署網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-260">Also, Azure virtual networks are often used to extend traditional on-premises networks.</span></span> <span data-ttu-id="fdecd-261">站對站或 ExpressRoute 混合式網路功能解決方案可以與周邊網路架構合併。</span><span class="sxs-lookup"><span data-stu-id="fdecd-261">It is possible to incorporate either site-to-site or ExpressRoute hybrid networking solutions with perimeter network architectures.</span></span> <span data-ttu-id="fdecd-262">此混合連結在組建網路安全性界限時，是很重要的考量。</span><span class="sxs-lookup"><span data-stu-id="fdecd-262">This hybrid link is an important consideration in building network security boundaries.</span></span>

<span data-ttu-id="fdecd-263">當您建立有周邊網路和多個安全性界限的網路時，需要回答下列三個重要問題。</span><span class="sxs-lookup"><span data-stu-id="fdecd-263">The following three questions are critical to answer when you're building a network with a perimeter network and multiple security boundaries.</span></span>

#### <a name="1-how-many-boundaries-are-needed"></a><span data-ttu-id="fdecd-264">1) 需要多少界限？</span><span class="sxs-lookup"><span data-stu-id="fdecd-264">1) How many boundaries are needed?</span></span>
<span data-ttu-id="fdecd-265">第一個決策點是決定在特定案例下需要多少安全性界限：</span><span class="sxs-lookup"><span data-stu-id="fdecd-265">The first decision point is to decide how many security boundaries are needed in a given scenario:</span></span>

* <span data-ttu-id="fdecd-266">單一界限：虛擬網路與網際網路之間的前端周邊網路是一個界限。</span><span class="sxs-lookup"><span data-stu-id="fdecd-266">A single boundary: One on the front-end perimeter network, between the virtual network and the Internet.</span></span>
* <span data-ttu-id="fdecd-267">兩個界限：一個在周邊網路的網際網路端，另一個在 Azure 虛擬網路的周邊網路子網路和後端子網路之間。</span><span class="sxs-lookup"><span data-stu-id="fdecd-267">Two boundaries: One on the Internet side of the perimeter network, and another between the perimeter network subnet and the back-end subnets in the Azure virtual networks.</span></span>
* <span data-ttu-id="fdecd-268">三個界限：一個在周邊網路的網際網路端，一個在周邊網路和後端子網路之間，還有一個在後端子網路和內部部署網路之間。</span><span class="sxs-lookup"><span data-stu-id="fdecd-268">Three boundaries: One on the Internet side of the perimeter network, one between the perimeter network and back-end subnets, and one between the back-end subnets and the on-premises network.</span></span>
* <span data-ttu-id="fdecd-269">N 個界限︰可變的數字。</span><span class="sxs-lookup"><span data-stu-id="fdecd-269">N boundaries: A variable number.</span></span> <span data-ttu-id="fdecd-270">視安全性需求而定，特定網路中可套用的安全性界限數量沒有限制。</span><span class="sxs-lookup"><span data-stu-id="fdecd-270">Depending on security requirements, there is no limit to the number of security boundaries that can be applied in a given network.</span></span>

<span data-ttu-id="fdecd-271">需要的界限類型和數量，依照公司的風險承受度和實作的特定案例而有所不同。</span><span class="sxs-lookup"><span data-stu-id="fdecd-271">The number and type of boundaries needed vary based on a company’s risk tolerance and the specific scenario being implemented.</span></span> <span data-ttu-id="fdecd-272">這通常是組織內的多個團隊共同達成的決策，通常包括風險和合規性小組、網路和平台小組及應用程式開發小組。</span><span class="sxs-lookup"><span data-stu-id="fdecd-272">This decision is often made together with multiple groups within an organization, often including a risk and compliance team, a network and platform team, and an application development team.</span></span> <span data-ttu-id="fdecd-273">了解安全性、所涉及的資料及運用之技術的人，在此決策上應該要有發言權，以確保對每個實作表達適當的安全性立場。</span><span class="sxs-lookup"><span data-stu-id="fdecd-273">People with knowledge of security, the data involved, and the technologies being used should have a say in this decision to ensure the appropriate security stance for each implementation.</span></span>

> [!TIP]
> <span data-ttu-id="fdecd-274">應該儘可能以最少的界限來滿足特定情況下的安全性需求。</span><span class="sxs-lookup"><span data-stu-id="fdecd-274">Use the smallest number of boundaries that satisfy the security requirements for a given situation.</span></span> <span data-ttu-id="fdecd-275">界限愈多，操作和疑難排解就愈困難，後續管理多個界限原則時的管理負荷也越沈重。</span><span class="sxs-lookup"><span data-stu-id="fdecd-275">With more boundaries, operations and troubleshooting can be more difficult, as well as the management overhead involved with managing the multiple boundary policies over time.</span></span> <span data-ttu-id="fdecd-276">不過，沒有足夠的界限會增加風險。</span><span class="sxs-lookup"><span data-stu-id="fdecd-276">However, insufficient boundaries increase risk.</span></span> <span data-ttu-id="fdecd-277">取得平衡相當重要。</span><span class="sxs-lookup"><span data-stu-id="fdecd-277">Finding the balance is critical.</span></span>
>
>

<span data-ttu-id="fdecd-278">![6]</span><span class="sxs-lookup"><span data-stu-id="fdecd-278">![6]</span></span>

<span data-ttu-id="fdecd-279">上圖中顯示有三個安全性界限網路的高層級檢視。</span><span class="sxs-lookup"><span data-stu-id="fdecd-279">The preceding figure shows a high-level view of a three security boundary network.</span></span> <span data-ttu-id="fdecd-280">界限介於周邊網路和網際網路、Azure 前端和後端私人子網路，以及 Azure 後端子網路和內部部署公司網路之間。</span><span class="sxs-lookup"><span data-stu-id="fdecd-280">The boundaries are between the perimeter network and the Internet, the Azure front-end and back-end private subnets, and the Azure back-end subnet and the on-premises corporate network.</span></span>

#### <a name="2-where-are-the-boundaries-located"></a><span data-ttu-id="fdecd-281">2) 界限位於何處？</span><span class="sxs-lookup"><span data-stu-id="fdecd-281">2) Where are the boundaries located?</span></span>
<span data-ttu-id="fdecd-282">一旦決定界限數量，下一個決策點就是在何處實作它們。</span><span class="sxs-lookup"><span data-stu-id="fdecd-282">Once the number of boundaries are decided, where to implement them is the next decision point.</span></span> <span data-ttu-id="fdecd-283">通常有三個選項︰</span><span class="sxs-lookup"><span data-stu-id="fdecd-283">There are generally three choices:</span></span>

* <span data-ttu-id="fdecd-284">使用網際網路型的中繼服務 (例如，雲端 Web 應用程式防火牆，本文中不討論)</span><span class="sxs-lookup"><span data-stu-id="fdecd-284">Using an Internet-based intermediary service (for example, a cloud-based Web application firewall, which is not discussed in this document)</span></span>
* <span data-ttu-id="fdecd-285">在 Azure 中使用原生功能及/或網路虛擬設備</span><span class="sxs-lookup"><span data-stu-id="fdecd-285">Using native features and/or network virtual appliances in Azure</span></span>
* <span data-ttu-id="fdecd-286">在內部部署網路上使用實體裝置</span><span class="sxs-lookup"><span data-stu-id="fdecd-286">Using physical devices on the on-premises network</span></span>

<span data-ttu-id="fdecd-287">在純粹的 Azure 網路上，選項包括原生的 Azure 功能 (例如 Azure 負載平衡器)，或由 Azure 豐富的合作夥伴生態系統提供的網路虛擬設備 (例如檢查點防火牆)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-287">On purely Azure networks, the options are native Azure features (for example, Azure Load Balancers) or network virtual appliances from the rich partner ecosystem of Azure (for example, Check Point firewalls).</span></span>

<span data-ttu-id="fdecd-288">如果 Azure 與內部部署網路之間需要界限，安全性裝置可以位於連線的任一端 (或兩端)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-288">If a boundary is needed between Azure and an on-premises network, the security devices can reside on either side of the connection (or both sides).</span></span> <span data-ttu-id="fdecd-289">因此，必須決定放置安全性裝置的位置。</span><span class="sxs-lookup"><span data-stu-id="fdecd-289">Thus a decision must be made on the location to place security gear.</span></span>

<span data-ttu-id="fdecd-290">上圖中，網際網路到周邊網路及前端到後端的邊界完全在 Azure 內，而且必須是原生的 Azure 功能或網路虛擬設備。</span><span class="sxs-lookup"><span data-stu-id="fdecd-290">In the previous figure, the Internet-to-perimeter network and the front-to-back-end boundaries are entirely contained within Azure, and must be either native Azure features or network virtual appliances.</span></span> <span data-ttu-id="fdecd-291">在 Azure (後端子網路) 與公司網路之間的界限上，安全性裝置可以在 Azure 端或內部部署端，甚至是兩端的裝置組合。</span><span class="sxs-lookup"><span data-stu-id="fdecd-291">Security devices on the boundary between Azure (back-end subnet) and the corporate network could be either on the Azure side or the on-premises side, or even a combination of devices on both sides.</span></span> <span data-ttu-id="fdecd-292">任一選項都可能有顯著的優點和缺點，必須認真考慮。</span><span class="sxs-lookup"><span data-stu-id="fdecd-292">There can be significant advantages and disadvantages to either option that must be seriously considered.</span></span>

<span data-ttu-id="fdecd-293">例如，在內部部署網路端上使用現有的實體安全性裝置，就不需要新的裝置。</span><span class="sxs-lookup"><span data-stu-id="fdecd-293">For example, using existing physical security gear on the on-premises network side has the advantage that no new gear is needed.</span></span> <span data-ttu-id="fdecd-294">它只需要重新設定。</span><span class="sxs-lookup"><span data-stu-id="fdecd-294">It just needs reconfiguration.</span></span> <span data-ttu-id="fdecd-295">但缺點則是所有流量必須從 Azure 回到內部部署網路，才能被安全性裝置看到。</span><span class="sxs-lookup"><span data-stu-id="fdecd-295">The disadvantage, however, is that all traffic must come back from Azure to the on-premises network to be seen by the security gear.</span></span> <span data-ttu-id="fdecd-296">因此，如果將 Azure 到 Azure 流量強制送回內部部署網路來強制執行安全性原則，可能會造成顯著的延遲，影響應用程式效能和使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="fdecd-296">Thus Azure-to-Azure traffic could incur significant latency, and affect application performance and user experience, if it was forced back to the on-premises network for security policy enforcement.</span></span>

#### <a name="3-how-are-the-boundaries-implemented"></a><span data-ttu-id="fdecd-297">3) 如何實作界限？</span><span class="sxs-lookup"><span data-stu-id="fdecd-297">3) How are the boundaries implemented?</span></span>
<span data-ttu-id="fdecd-298">每個安全性界限可能有不同的功能需求 (例如，周邊網路的網際網路端需要 IDS 和防火牆規則，但周邊網路與後端子網路之間只需要 ACL)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-298">Each security boundary will likely have different capability requirements (for example, IDS and firewall rules on the Internet side of the perimeter network, but only ACLs between the perimeter network and back-end subnet).</span></span> <span data-ttu-id="fdecd-299">決定使用哪個裝置 (或多少個裝置)，取決於案例和安全性需求。</span><span class="sxs-lookup"><span data-stu-id="fdecd-299">Deciding on which device (or how many devices) to use depends on the scenario and security requirements.</span></span> <span data-ttu-id="fdecd-300">在下一節中，範例 1、2 和 3 會討論一些可用的選項。</span><span class="sxs-lookup"><span data-stu-id="fdecd-300">In the following section, examples 1, 2, and 3 discuss some options that could be used.</span></span> <span data-ttu-id="fdecd-301">檢閱 Azure 原生網路功能和 Azure 中由合作夥伴生態系統提供的裝置，將可以找到大量選項來解決幾乎任何的案例。</span><span class="sxs-lookup"><span data-stu-id="fdecd-301">Reviewing the Azure native network features and the devices available in Azure from the partner ecosystem shows the myriad options available to solve virtually any scenario.</span></span>

<span data-ttu-id="fdecd-302">另一個重要的實作決策點就是如何連接內部部署網路與 Azure。</span><span class="sxs-lookup"><span data-stu-id="fdecd-302">Another key implementation decision point is how to connect the on-premises network with Azure.</span></span> <span data-ttu-id="fdecd-303">您應該使用 Azure 虛擬閘道還是網路虛擬設備呢？</span><span class="sxs-lookup"><span data-stu-id="fdecd-303">Should you use the Azure virtual gateway or a network virtual appliance?</span></span> <span data-ttu-id="fdecd-304">下節 (範例 4、5 和 6) 對這些選項會有更詳細的描述和討論。</span><span class="sxs-lookup"><span data-stu-id="fdecd-304">These options are discussed in greater detail in the following section (examples 4, 5, and 6).</span></span>

<span data-ttu-id="fdecd-305">您可能也需要 Azure 虛擬網路之間的流量。</span><span class="sxs-lookup"><span data-stu-id="fdecd-305">Additionally, traffic between virtual networks within Azure may be needed.</span></span> <span data-ttu-id="fdecd-306">這些案例都會在日後加入。</span><span class="sxs-lookup"><span data-stu-id="fdecd-306">These scenarios will be added in the future.</span></span>

<span data-ttu-id="fdecd-307">一旦解答上述問題， [快速開始](#fast-start) 一節可協助您識別最適合特定案例的範例。</span><span class="sxs-lookup"><span data-stu-id="fdecd-307">Once you know the answers to the previous questions, the [Fast Start](#fast-start) section can help identify which examples are most appropriate for a given scenario.</span></span>

## <a name="examples-building-security-boundaries-with-azure-virtual-networks"></a><span data-ttu-id="fdecd-308">範例：使用 Azure 虛擬網路組建安全性界限</span><span class="sxs-lookup"><span data-stu-id="fdecd-308">Examples: Building security boundaries with Azure virtual networks</span></span>
### <a name="example-1-build-a-perimeter-network-to-help-protect-applications-with-nsgs"></a><span data-ttu-id="fdecd-309">範例 1：建置周邊網路，使用 NSG 協助保護應用程式</span><span class="sxs-lookup"><span data-stu-id="fdecd-309">Example 1 Build a perimeter network to help protect applications with NSGs</span></span>
<span data-ttu-id="fdecd-310">[回到快速開始](#fast-start) | [此範例的詳細組建指示][Example1]</span><span class="sxs-lookup"><span data-stu-id="fdecd-310">[Back to Fast start](#fast-start) | [Detailed build instructions for this example][Example1]</span></span>

<span data-ttu-id="fdecd-311">[![7]][7]</span><span class="sxs-lookup"><span data-stu-id="fdecd-311">[![7]][7]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="fdecd-312">環境描述</span><span class="sxs-lookup"><span data-stu-id="fdecd-312">Environment description</span></span>
<span data-ttu-id="fdecd-313">此範例中的訂用帳戶包含下列資源：</span><span class="sxs-lookup"><span data-stu-id="fdecd-313">In this example, there is a subscription that contains the following resources:</span></span>

- <span data-ttu-id="fdecd-314">單一資源群組</span><span class="sxs-lookup"><span data-stu-id="fdecd-314">A single resource group</span></span>
- <span data-ttu-id="fdecd-315">含 “FrontEnd” 和 “BackEnd” 兩個子網路的虛擬網路</span><span class="sxs-lookup"><span data-stu-id="fdecd-315">A virtual network with two subnets: “FrontEnd” and “BackEnd”</span></span>
- <span data-ttu-id="fdecd-316">套用至這兩個子網路的單一網路安全性群組</span><span class="sxs-lookup"><span data-stu-id="fdecd-316">A Network Security Group that is applied to both subnets</span></span>
- <span data-ttu-id="fdecd-317">一個代表應用程式 Web 伺服器的 Windows Server (“IIS01”)</span><span class="sxs-lookup"><span data-stu-id="fdecd-317">A Windows server that represents an application web server (“IIS01”)</span></span>
- <span data-ttu-id="fdecd-318">兩個代表應用程式後端伺服器的 Windows Server (“AppVM01”、“AppVM02”)</span><span class="sxs-lookup"><span data-stu-id="fdecd-318">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
- <span data-ttu-id="fdecd-319">一個代表 DNS 伺服器的 Windows Server ("DNS01")</span><span class="sxs-lookup"><span data-stu-id="fdecd-319">A Windows server that represents a DNS server (“DNS01”)</span></span>
- <span data-ttu-id="fdecd-320">與應用程式 Web 伺服器相關聯的公用 IP</span><span class="sxs-lookup"><span data-stu-id="fdecd-320">A public IP associated with the application web server</span></span>

<span data-ttu-id="fdecd-321">如需指令碼和 Azure Resource Manager 範本，請參閱[詳細的組建指示][Example1]。</span><span class="sxs-lookup"><span data-stu-id="fdecd-321">For scripts and an Azure Resource Manager template, see the [detailed build instructions][Example1].</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="fdecd-322">NSG 描述</span><span class="sxs-lookup"><span data-stu-id="fdecd-322">NSG description</span></span>
<span data-ttu-id="fdecd-323">此範例會組建 NSG 群組，然後載入六個規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-323">In this example, an NSG group is built and then loaded with six rules.</span></span>

> [!TIP]
> <span data-ttu-id="fdecd-324">一般而言，您應該先建立特定的「允許」規則，再建立較一般的「拒絕」規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-324">Generally speaking, you should create your specific “Allow” rules first, followed by the more generic “Deny” rules.</span></span> <span data-ttu-id="fdecd-325">指定的優先順序決定要先評估哪些規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-325">The given priority dictates which rules are evaluated first.</span></span> <span data-ttu-id="fdecd-326">一旦發現流量適用特定規則，就不會再評估後續規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-326">Once traffic is found to apply to a specific rule, no further rules are evaluated.</span></span> <span data-ttu-id="fdecd-327">NSG 規則可以套用在輸入或輸出方向 (從子網路的觀點出發)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-327">NSG rules can apply in either the inbound or outbound direction (from the perspective of the subnet).</span></span>
>
>

<span data-ttu-id="fdecd-328">指令碼會以宣告方式為輸入流量建置下列規則：</span><span class="sxs-lookup"><span data-stu-id="fdecd-328">Declaratively, the following rules are being built for inbound traffic:</span></span>

1. <span data-ttu-id="fdecd-329">允許內部 DNS 流量 (連接埠 53)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-329">Internal DNS traffic (port 53) is allowed.</span></span>
2. <span data-ttu-id="fdecd-330">允許從網際網路到任何虛擬機器的 RDP 流量 (連接埠 3389)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-330">RDP traffic (port 3389) from the Internet to any Virtual Machine is allowed.</span></span>
3. <span data-ttu-id="fdecd-331">允許從網際網路到 Web 伺服器 (IIS01) 的 HTTP 流量 (連接埠 80)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-331">HTTP traffic (port 80) from the Internet to web server (IIS01) is allowed.</span></span>
4. <span data-ttu-id="fdecd-332">允許從 IIS01 到 AppVM1 的任何流量 (所有連接埠)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-332">Any traffic (all ports) from IIS01 to AppVM1 is allowed.</span></span>
5. <span data-ttu-id="fdecd-333">拒絕從網際網路到整個虛擬網路 (兩個子網路) 的任何流量 (所有連接埠)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-333">Any traffic (all ports) from the Internet to the entire virtual network (both subnets) is denied.</span></span>
6. <span data-ttu-id="fdecd-334">拒絕從前端子網路到後端子網路的任何流量 (所有連接埠)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-334">Any traffic (all ports) from the front-end subnet to the back-end subnet is denied.</span></span>

<span data-ttu-id="fdecd-335">這些規則繫結至每個子網路，如果 HTTP 要求是從網際網路輸入 Web 伺服器，則 3 (允許) 和 5 (拒絕) 兩個規則都會套用。</span><span class="sxs-lookup"><span data-stu-id="fdecd-335">With these rules bound to each subnet, if an HTTP request was inbound from the Internet to the web server, both rules 3 (allow) and 5 (deny) would apply.</span></span> <span data-ttu-id="fdecd-336">但因規則 3 具有較高的優先順序，所以只會套用規則 3，規則 5 不起作用。</span><span class="sxs-lookup"><span data-stu-id="fdecd-336">But because rule 3 has a higher priority, only it would apply, and rule 5 would not come into play.</span></span> <span data-ttu-id="fdecd-337">因此會允許 HTTP 要求送往 Web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="fdecd-337">Thus the HTTP request would be allowed to the web server.</span></span> <span data-ttu-id="fdecd-338">如果相同的流量嘗試抵達 DNS01 伺服器，規則 5 (拒絕) 會先適用，因此不會允許流量傳遞給伺服器。</span><span class="sxs-lookup"><span data-stu-id="fdecd-338">If that same traffic was trying to reach the DNS01 server, rule 5 (deny) would be the first to apply, and the traffic would not be allowed to pass to the server.</span></span> <span data-ttu-id="fdecd-339">規則 6 (拒絕) 封鎖前端子網路和後端子網路交談 (規則 1 和 4 所允許的流量除外)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-339">Rule 6 (deny) blocks the front-end subnet from talking to the back-end subnet (except for allowed traffic in rules 1 and 4).</span></span> <span data-ttu-id="fdecd-340">萬一攻擊者危害前端的 Web 應用程式，這條規則可以保護後端網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-340">This rule-set protects the back-end network in case an attacker compromises the web application on the front end.</span></span> <span data-ttu-id="fdecd-341">攻擊者對後端「受保護」網路的存取受到限制 (僅限對 AppVM01 伺服器公開的資源)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-341">The attacker would have limited access to the back-end “protected” network (only to resources exposed on the AppVM01 server).</span></span>

<span data-ttu-id="fdecd-342">有一個預設輸出規則可允許流量外流到網際網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-342">There is a default outbound rule that allows traffic out to the Internet.</span></span> <span data-ttu-id="fdecd-343">在此範例中，我們會允許輸出流量，並不會修改任何輸出規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-343">For this example, we’re allowing outbound traffic and not modifying any outbound rules.</span></span> <span data-ttu-id="fdecd-344">若要鎖定兩個方向的流量，則需要使用者定義的路由 (請見範例 3)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-344">To lock down traffic in both directions, user-defined routing is required (see example 3).</span></span>

#### <a name="conclusion"></a><span data-ttu-id="fdecd-345">結論</span><span class="sxs-lookup"><span data-stu-id="fdecd-345">Conclusion</span></span>
<span data-ttu-id="fdecd-346">這個範例隔離後端子網路與輸入流量的方式相當直接簡單。</span><span class="sxs-lookup"><span data-stu-id="fdecd-346">This example is a relatively simple and straightforward way of isolating the back-end subnet from inbound traffic.</span></span> <span data-ttu-id="fdecd-347">如需詳細資訊，請參閱[詳細的組建指示][Example1]。</span><span class="sxs-lookup"><span data-stu-id="fdecd-347">For more information, see the [detailed build instructions][Example1].</span></span> <span data-ttu-id="fdecd-348">這些指示包括：</span><span class="sxs-lookup"><span data-stu-id="fdecd-348">These instructions include:</span></span>

* <span data-ttu-id="fdecd-349">如何使用傳統 PowerShell 指令碼組建這個周邊網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-349">How to build this perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="fdecd-350">如何使用 Azure Resource Manager 範本組建這個周邊網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-350">How to build this perimeter network with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="fdecd-351">每個 NSG 命令的詳細描述。</span><span class="sxs-lookup"><span data-stu-id="fdecd-351">Detailed descriptions of each NSG command.</span></span>
* <span data-ttu-id="fdecd-352">詳細的流量流程案例，顯示每一層允許或拒絕流量的方式。</span><span class="sxs-lookup"><span data-stu-id="fdecd-352">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>


### <a name="example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs"></a><span data-ttu-id="fdecd-353">範例 2：建置周邊網路，使用防火牆和 NSG 協助保護應用程式</span><span class="sxs-lookup"><span data-stu-id="fdecd-353">Example 2 Build a perimeter network to help protect applications with a firewall and NSGs</span></span>
<span data-ttu-id="fdecd-354">[回到快速開始](#fast-start) | [此範例的詳細組建指示][Example2]</span><span class="sxs-lookup"><span data-stu-id="fdecd-354">[Back to Fast start](#fast-start) | [Detailed build instructions for this example][Example2]</span></span>

<span data-ttu-id="fdecd-355">[![8]][8]</span><span class="sxs-lookup"><span data-stu-id="fdecd-355">[![8]][8]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="fdecd-356">環境描述</span><span class="sxs-lookup"><span data-stu-id="fdecd-356">Environment description</span></span>
<span data-ttu-id="fdecd-357">此範例中的訂用帳戶包含下列資源：</span><span class="sxs-lookup"><span data-stu-id="fdecd-357">In this example, there is a subscription that contains the following resources:</span></span>

* <span data-ttu-id="fdecd-358">單一資源群組</span><span class="sxs-lookup"><span data-stu-id="fdecd-358">A single resource group</span></span>
* <span data-ttu-id="fdecd-359">含 “FrontEnd” 和 “BackEnd” 兩個子網路的虛擬網路</span><span class="sxs-lookup"><span data-stu-id="fdecd-359">A virtual network with two subnets: “FrontEnd” and “BackEnd”</span></span>
* <span data-ttu-id="fdecd-360">套用至這兩個子網路的單一網路安全性群組</span><span class="sxs-lookup"><span data-stu-id="fdecd-360">A Network Security Group that is applied to both subnets</span></span>
* <span data-ttu-id="fdecd-361">一個網路虛擬設備，在此範例中為防火牆，連接到 Frontend 子網路</span><span class="sxs-lookup"><span data-stu-id="fdecd-361">A network virtual appliance, in this case a firewall, connected to the front-end subnet</span></span>
* <span data-ttu-id="fdecd-362">一個代表應用程式 Web 伺服器的 Windows Server (“IIS01”)</span><span class="sxs-lookup"><span data-stu-id="fdecd-362">A Windows server that represents an application web server (“IIS01”)</span></span>
* <span data-ttu-id="fdecd-363">兩個代表應用程式後端伺服器的 Windows Server (“AppVM01”、“AppVM02”)</span><span class="sxs-lookup"><span data-stu-id="fdecd-363">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
* <span data-ttu-id="fdecd-364">一個代表 DNS 伺服器的 Windows Server ("DNS01")</span><span class="sxs-lookup"><span data-stu-id="fdecd-364">A Windows server that represents a DNS server (“DNS01”)</span></span>

<span data-ttu-id="fdecd-365">如需指令碼和 Azure Resource Manager 範本，請參閱[詳細的組建指示][Example2]。</span><span class="sxs-lookup"><span data-stu-id="fdecd-365">For scripts and an Azure Resource Manager template, see the [detailed build instructions][Example2].</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="fdecd-366">NSG 描述</span><span class="sxs-lookup"><span data-stu-id="fdecd-366">NSG description</span></span>
<span data-ttu-id="fdecd-367">此範例會組建 NSG 群組，然後載入六個規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-367">In this example, an NSG group is built and then loaded with six rules.</span></span>

> [!TIP]
> <span data-ttu-id="fdecd-368">一般而言，您應該先建立特定的「允許」規則，再建立較一般的「拒絕」規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-368">Generally speaking, you should create your specific “Allow” rules first, followed by the more generic “Deny” rules.</span></span> <span data-ttu-id="fdecd-369">指定的優先順序決定要先評估哪些規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-369">The given priority dictates which rules are evaluated first.</span></span> <span data-ttu-id="fdecd-370">一旦發現流量適用特定規則，就不會再評估後續規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-370">Once traffic is found to apply to a specific rule, no further rules are evaluated.</span></span> <span data-ttu-id="fdecd-371">NSG 規則可以套用在輸入或輸出方向 (從子網路的觀點出發)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-371">NSG rules can apply in either the inbound or outbound direction (from the perspective of the subnet).</span></span>
>
>

<span data-ttu-id="fdecd-372">指令碼會以宣告方式為輸入流量建置下列規則：</span><span class="sxs-lookup"><span data-stu-id="fdecd-372">Declaratively, the following rules are being built for inbound traffic:</span></span>

1. <span data-ttu-id="fdecd-373">允許內部 DNS 流量 (連接埠 53)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-373">Internal DNS traffic (port 53) is allowed.</span></span>
2. <span data-ttu-id="fdecd-374">允許從網際網路到任何虛擬機器的 RDP 流量 (連接埠 3389)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-374">RDP traffic (port 3389) from the Internet to any Virtual Machine is allowed.</span></span>
3. <span data-ttu-id="fdecd-375">允許從網際網路到網路虛擬設備 (防火牆) 的任何流量 (所有連接埠)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-375">Any Internet traffic (all ports) to the network virtual appliance (firewall) is allowed.</span></span>
4. <span data-ttu-id="fdecd-376">允許從 IIS01 到 AppVM1 的任何流量 (所有連接埠)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-376">Any traffic (all ports) from IIS01 to AppVM1 is allowed.</span></span>
5. <span data-ttu-id="fdecd-377">拒絕從網際網路到整個虛擬網路 (兩個子網路) 的任何流量 (所有連接埠)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-377">Any traffic (all ports) from the Internet to the entire virtual network (both subnets) is denied.</span></span>
6. <span data-ttu-id="fdecd-378">拒絕從前端子網路到後端子網路的任何流量 (所有連接埠)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-378">Any traffic (all ports) from the front-end subnet to the back-end subnet is denied.</span></span>

<span data-ttu-id="fdecd-379">這些規則繫結至每個子網路，如果 HTTP 要求是從網際網路輸入防火牆，則 3 (允許) 和 5 (拒絕) 兩個規則都會套用。</span><span class="sxs-lookup"><span data-stu-id="fdecd-379">With these rules bound to each subnet, if an HTTP request was inbound from the Internet to the firewall, both rules 3 (allow) and 5 (deny) would apply.</span></span> <span data-ttu-id="fdecd-380">但因規則 3 具有較高的優先順序，所以只會套用規則 3，規則 5 不起作用。</span><span class="sxs-lookup"><span data-stu-id="fdecd-380">But because rule 3 has a higher priority, only it would apply, and rule 5 would not come into play.</span></span> <span data-ttu-id="fdecd-381">因此會允許 HTTP 要求送往防火牆。</span><span class="sxs-lookup"><span data-stu-id="fdecd-381">Thus the HTTP request would be allowed to the firewall.</span></span> <span data-ttu-id="fdecd-382">如果相同的流量嘗試到達 IIS01 伺服器，即使是在 Frontend 子網路上，則會套用規則 5 (拒絕)，因此不會允許流量傳遞給伺服器。</span><span class="sxs-lookup"><span data-stu-id="fdecd-382">If that same traffic was trying to reach the IIS01 server, even though it’s on the front-end subnet, rule 5 (deny) would apply, and the traffic would not be allowed to pass to the server.</span></span> <span data-ttu-id="fdecd-383">規則 6 (拒絕) 封鎖前端子網路和後端子網路交談 (規則 1 和 4 所允許的流量除外)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-383">Rule 6 (deny) blocks the front-end subnet from talking to the back-end subnet (except for allowed traffic in rules 1 and 4).</span></span> <span data-ttu-id="fdecd-384">萬一攻擊者危害前端的 Web 應用程式，這條規則可以保護後端網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-384">This rule-set protects the back-end network in case an attacker compromises the web application on the front end.</span></span> <span data-ttu-id="fdecd-385">攻擊者對後端「受保護」網路的存取受到限制 (僅限對 AppVM01 伺服器公開的資源)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-385">The attacker would have limited access to the back-end “protected” network (only to resources exposed on the AppVM01 server).</span></span>

<span data-ttu-id="fdecd-386">有一個預設輸出規則可允許流量外流到網際網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-386">There is a default outbound rule that allows traffic out to the Internet.</span></span> <span data-ttu-id="fdecd-387">在此範例中，我們會允許輸出流量，並不會修改任何輸出規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-387">For this example, we’re allowing outbound traffic and not modifying any outbound rules.</span></span> <span data-ttu-id="fdecd-388">若要鎖定兩個方向的流量，則需要使用者定義的路由 (請見範例 3)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-388">To lock down traffic in both directions, user-defined routing is required (see example 3).</span></span>

#### <a name="firewall-rule-description"></a><span data-ttu-id="fdecd-389">防火牆規則描述</span><span class="sxs-lookup"><span data-stu-id="fdecd-389">Firewall rule description</span></span>
<span data-ttu-id="fdecd-390">防火牆上應該建立轉送規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-390">On the firewall, forwarding rules should be created.</span></span> <span data-ttu-id="fdecd-391">此範例只會將網際網路流量往內路由傳送到防火牆，再傳送到 Web 伺服器，因此只需要一個轉送網路位址轉譯 (NAT) 規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-391">Since this example only routes Internet traffic in-bound to the firewall and then to the web server, only one forwarding network address translation (NAT) rule is needed.</span></span>

<span data-ttu-id="fdecd-392">轉寄規則接受任何叫用防火牆嘗試連線到 HTTP (連接埠 80 或 HTTPS 為 443) 的輸入來源位址。</span><span class="sxs-lookup"><span data-stu-id="fdecd-392">The forwarding rule accepts any inbound source address that hits the firewall trying to reach HTTP (port 80 or 443 for HTTPS).</span></span> <span data-ttu-id="fdecd-393">它會傳出防火牆的本機介面，重新導向至 IP 位址 10.0.1.5 的 Web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="fdecd-393">It's sent out of the firewall’s local interface and redirected to the web server with the IP Address of 10.0.1.5.</span></span>

#### <a name="conclusion"></a><span data-ttu-id="fdecd-394">結論</span><span class="sxs-lookup"><span data-stu-id="fdecd-394">Conclusion</span></span>
<span data-ttu-id="fdecd-395">這個範例使用防火牆保護應用程式並隔離後端子網路與輸入流量的方式相當直接簡單。</span><span class="sxs-lookup"><span data-stu-id="fdecd-395">This example is a relatively straightforward way of protecting your application with a firewall and isolating the back-end subnet from inbound traffic.</span></span> <span data-ttu-id="fdecd-396">如需詳細資訊，請參閱[詳細的組建指示][Example2]。</span><span class="sxs-lookup"><span data-stu-id="fdecd-396">For more information, see the [detailed build instructions][Example2].</span></span> <span data-ttu-id="fdecd-397">這些指示包括：</span><span class="sxs-lookup"><span data-stu-id="fdecd-397">These instructions include:</span></span>

* <span data-ttu-id="fdecd-398">如何使用傳統 PowerShell 指令碼組建這個周邊網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-398">How to build this perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="fdecd-399">如何使用 Azure Resource Manager 範本組建這個範例。</span><span class="sxs-lookup"><span data-stu-id="fdecd-399">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="fdecd-400">每個 NSG 命令和防火牆規則的詳細描述。</span><span class="sxs-lookup"><span data-stu-id="fdecd-400">Detailed descriptions of each NSG command and firewall rule.</span></span>
* <span data-ttu-id="fdecd-401">詳細的流量流程案例，顯示每一層允許或拒絕流量的方式。</span><span class="sxs-lookup"><span data-stu-id="fdecd-401">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>

### <a name="example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg"></a><span data-ttu-id="fdecd-402">範例 3︰建置周邊網路，使用防火牆、UDR 及 NSG 協助保護網路</span><span class="sxs-lookup"><span data-stu-id="fdecd-402">Example 3 Build a perimeter network to help protect networks with a firewall and UDR and NSG</span></span>
<span data-ttu-id="fdecd-403">[回到快速開始](#fast-start) | [此範例的詳細組建指示][Example3]</span><span class="sxs-lookup"><span data-stu-id="fdecd-403">[Back to Fast start](#fast-start) | [Detailed build instructions for this example][Example3]</span></span>

<span data-ttu-id="fdecd-404">[![9]][9]</span><span class="sxs-lookup"><span data-stu-id="fdecd-404">[![9]][9]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="fdecd-405">環境描述</span><span class="sxs-lookup"><span data-stu-id="fdecd-405">Environment description</span></span>
<span data-ttu-id="fdecd-406">此範例中的訂用帳戶包含下列資源：</span><span class="sxs-lookup"><span data-stu-id="fdecd-406">In this example, there is a subscription that contains the following resources:</span></span>

* <span data-ttu-id="fdecd-407">單一資源群組</span><span class="sxs-lookup"><span data-stu-id="fdecd-407">A single resource group</span></span>
* <span data-ttu-id="fdecd-408">一個虛擬網路，包含三個子網路：“SecNet”、“FrontEnd”、“BackEnd”</span><span class="sxs-lookup"><span data-stu-id="fdecd-408">A virtual network with three subnets: “SecNet”, “FrontEnd”, and “BackEnd”</span></span>
* <span data-ttu-id="fdecd-409">一個網路虛擬設備，在本例中為防火牆，連接到 SecNet 子網路</span><span class="sxs-lookup"><span data-stu-id="fdecd-409">A network virtual appliance, in this case a firewall, connected to the SecNet subnet</span></span>
* <span data-ttu-id="fdecd-410">一個代表應用程式 Web 伺服器的 Windows Server (“IIS01”)</span><span class="sxs-lookup"><span data-stu-id="fdecd-410">A Windows server that represents an application web server (“IIS01”)</span></span>
* <span data-ttu-id="fdecd-411">兩個代表應用程式後端伺服器的 Windows Server (“AppVM01”、“AppVM02”)</span><span class="sxs-lookup"><span data-stu-id="fdecd-411">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
* <span data-ttu-id="fdecd-412">一個代表 DNS 伺服器的 Windows Server ("DNS01")</span><span class="sxs-lookup"><span data-stu-id="fdecd-412">A Windows server that represents a DNS server (“DNS01”)</span></span>

<span data-ttu-id="fdecd-413">如需指令碼和 Azure Resource Manager 範本，請參閱[詳細的組建指示][Example3]。</span><span class="sxs-lookup"><span data-stu-id="fdecd-413">For scripts and an Azure Resource Manager template, see the [detailed build instructions][Example3].</span></span>

#### <a name="udr-description"></a><span data-ttu-id="fdecd-414">UDR 描述</span><span class="sxs-lookup"><span data-stu-id="fdecd-414">UDR description</span></span>
<span data-ttu-id="fdecd-415">根據預設，下列系統路由的定義如下：</span><span class="sxs-lookup"><span data-stu-id="fdecd-415">By default, the following system routes are defined as:</span></span>

        Effective routes :
         Address Prefix    Next hop type    Next hop IP address Status   Source     
         --------------    -------------    ------------------- ------   ------     
         {10.0.0.0/16}     VNETLocal                            Active   Default    
         {0.0.0.0/0}       Internet                             Active   Default    
         {10.0.0.0/8}      Null                                 Active   Default    
         {100.64.0.0/10}   Null                                 Active   Default    
         {172.16.0.0/12}   Null                                 Active   Default    
         {192.168.0.0/16}  Null                                 Active   Default

<span data-ttu-id="fdecd-416">VNETLocal 一定是一或多個定義的位址首碼，這些首碼組成該特定網路定的虛擬網路 (也就是它會依虛擬網路而變，取決於各個特定虛擬網路的定義)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-416">The VNETLocal is always one or more defined address prefixes that make up the virtual network for that specific network (that is, it changes from virtual network to virtual network, depending on how each specific virtual network is defined).</span></span> <span data-ttu-id="fdecd-417">其餘系統路由則為靜態和預設值，如表中所述。</span><span class="sxs-lookup"><span data-stu-id="fdecd-417">The remaining system routes are static and default as indicated in the table.</span></span>

<span data-ttu-id="fdecd-418">本例中會建立兩個路由表，分別用於前端和後端子網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-418">In this example, two routing tables are created, one each for the front-end and back-end subnets.</span></span> <span data-ttu-id="fdecd-419">每個資料表都會載入適用於給定子網路的靜態路由。</span><span class="sxs-lookup"><span data-stu-id="fdecd-419">Each table is loaded with static routes appropriate for the given subnet.</span></span> <span data-ttu-id="fdecd-420">在此範例中，每個資料表會有三個路由，負責將所有流量 (0.0.0.0/0) 導向防火牆 (下一個躍點 = 虛擬設備 IP 位址)：</span><span class="sxs-lookup"><span data-stu-id="fdecd-420">In this example, each table has three routes that direct all traffic (0.0.0.0/0) through the firewall (Next hop = Virtual Appliance IP address):</span></span>

1. <span data-ttu-id="fdecd-421">未定義下一個躍點的本機子網路流量，以允許本機子網路流量略過防火牆。</span><span class="sxs-lookup"><span data-stu-id="fdecd-421">Local subnet traffic with no Next Hop defined to allow local subnet traffic to bypass the firewall.</span></span>
2. <span data-ttu-id="fdecd-422">下一個躍點定義為防火牆的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-422">Virtual network traffic with a Next Hop defined as firewall.</span></span> <span data-ttu-id="fdecd-423">這個「下一個躍點」會覆寫允許本機虛擬網路流量直接路由的預設規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-423">This next hop overrides the default rule that allows local virtual network traffic to route directly.</span></span>
3. <span data-ttu-id="fdecd-424">下一個躍點定義為防火牆的所有其餘流量 (0/0)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-424">All remaining traffic (0/0) with a Next Hop defined as the firewall.</span></span>

> [!TIP]
> <span data-ttu-id="fdecd-425">UDR 中沒有本機子網路項目，會中斷本機子網路通訊。</span><span class="sxs-lookup"><span data-stu-id="fdecd-425">Not having the local subnet entry in the UDR breaks local subnet communications.</span></span>
>
> * <span data-ttu-id="fdecd-426">在我們的範例中，10.0.1.0/24 指向 VNETLocal 相當重要 ！</span><span class="sxs-lookup"><span data-stu-id="fdecd-426">In our example, 10.0.1.0/24 pointing to VNETLocal is critical!</span></span> <span data-ttu-id="fdecd-427">若不這麼做，離開 Web 伺服器 (10.0.1.4)、目的地是另一部本機伺服器 (例如 10.0.1.25) 的封包都會失敗，因為它們將會傳送至 NVA。</span><span class="sxs-lookup"><span data-stu-id="fdecd-427">Without it, packet leaving the Web Server (10.0.1.4) destined to another local server (for example) 10.0.1.25 will fail as they will be sent to the NVA.</span></span> <span data-ttu-id="fdecd-428">NVA 會將它傳送至子網路，而子網路會再將它傳送至 NVA，形成無限迴圈。</span><span class="sxs-lookup"><span data-stu-id="fdecd-428">The NVA will send it to the subnet, and the subnet will resend it to the NVA in an infinite loop.</span></span>
> * <span data-ttu-id="fdecd-429">在連線至不同子網路且有多個 NIC 的設備上 (通常屬於傳統的內部部署設備)，形成路由迴圈的機會通常比較高。</span><span class="sxs-lookup"><span data-stu-id="fdecd-429">The chances of a routing loop are typically higher on appliances with multiple NICs that are connected to separate subnets, which is often of traditional, on-premises appliances.</span></span>
>
>

<span data-ttu-id="fdecd-430">路由表一經建立就必須將繫結至其子網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-430">Once the routing tables are created, they must be bound to their subnets.</span></span> <span data-ttu-id="fdecd-431">前端子網路路由表在建立並繫結至子網路後，應該會像下面的輸出：</span><span class="sxs-lookup"><span data-stu-id="fdecd-431">The front-end subnet routing table, once created and bound to the subnet, would look like this output:</span></span>

        Effective routes :
         Address Prefix    Next hop type    Next hop IP address Status   Source     
         --------------    -------------    ------------------- ------   ------     
         {10.0.1.0/24}     VNETLocal                            Active
         {10.0.0.0/16}     VirtualAppliance 10.0.0.4            Active    
         {0.0.0.0/0}       VirtualAppliance 10.0.0.4            Active

> [!NOTE]
> <span data-ttu-id="fdecd-432">UDR 現在可套用至 ExpressRoute 線路所連線的閘道子網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-432">UDR can now be applied to the gateway subnet on which the ExpressRoute circuit is connected.</span></span>
>
> <span data-ttu-id="fdecd-433">範例 3 和 4 示範如何使用 ExpressRoute 或站對站網路啟用周邊網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-433">Examples of how to enable your perimeter network with ExpressRoute or site-to-site networking are shown in examples 3 and 4.</span></span>
>
>

#### <a name="ip-forwarding-description"></a><span data-ttu-id="fdecd-434">IP 轉送描述</span><span class="sxs-lookup"><span data-stu-id="fdecd-434">IP Forwarding description</span></span>
<span data-ttu-id="fdecd-435">IP 轉送是 UDR 的隨附功能。</span><span class="sxs-lookup"><span data-stu-id="fdecd-435">IP Forwarding is a companion feature to UDR.</span></span> <span data-ttu-id="fdecd-436">IP 轉送是虛擬設備的一項設定，以允許它接收不是要特別傳送到設備的流量，再將流量轉送到其最終目的地。</span><span class="sxs-lookup"><span data-stu-id="fdecd-436">IP Forwarding is a setting on a virtual appliance that allows it to receive traffic not specifically addressed to the appliance, and then forward that traffic to its ultimate destination.</span></span>

<span data-ttu-id="fdecd-437">舉例來說，如果 AppVM01 對 DNS01 伺服器提出要求，UDR 會將此流量路由傳送到防火牆。</span><span class="sxs-lookup"><span data-stu-id="fdecd-437">For example, if AppVM01 makes a request to the DNS01 server, UDR would route this traffic to the firewall.</span></span> <span data-ttu-id="fdecd-438">在啟用 IP 轉送時，目的地為 DNS01 (10.0.2.4) 的流量會被設備 (10.0.0.4) 所接受，然後轉送到其最終目的地 (10.0.2.4)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-438">With IP Forwarding enabled, the traffic for the DNS01 destination (10.0.2.4) is accepted by the appliance (10.0.0.4) and then forwarded to its ultimate destination (10.0.2.4).</span></span> <span data-ttu-id="fdecd-439">若防火牆未啟用 IP 轉送，即使路由表將防火牆作為下一個躍點，流量也不會被設備所接受。</span><span class="sxs-lookup"><span data-stu-id="fdecd-439">Without IP Forwarding enabled on the firewall, traffic would not be accepted by the appliance even though the route table has the firewall as the next hop.</span></span> <span data-ttu-id="fdecd-440">如果要使用虛擬設備，請務必記得一同啟用 IP 轉送和 UDR。</span><span class="sxs-lookup"><span data-stu-id="fdecd-440">To use a virtual appliance, it’s critical to remember to enable IP Forwarding along with UDR.</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="fdecd-441">NSG 描述</span><span class="sxs-lookup"><span data-stu-id="fdecd-441">NSG description</span></span>
<span data-ttu-id="fdecd-442">本例會組建 NSG 群組，然後在其中載入單一規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-442">In this example, an NSG group is built and then loaded with a single rule.</span></span> <span data-ttu-id="fdecd-443">這個群組接著只會繫結到前端和後端子網路 (不會繫結到 SecNet)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-443">This group is then bound only to the front-end and back-end subnets (not the SecNet).</span></span> <span data-ttu-id="fdecd-444">指令碼會以宣告方式建置下列規則：</span><span class="sxs-lookup"><span data-stu-id="fdecd-444">Declaratively the following rule is being built:</span></span>

* <span data-ttu-id="fdecd-445">拒絕從網際網路到整個虛擬網路 (所有子網路) 的任何流量 (所有連接埠)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-445">Any traffic (all ports) from the Internet to the entire virtual network (all subnets) is denied.</span></span>

<span data-ttu-id="fdecd-446">雖然本例中使用 NSG，但它的主要目的是作為防止人為設定錯誤的第二道防線。</span><span class="sxs-lookup"><span data-stu-id="fdecd-446">Although NSGs are used in this example, its main purpose is as a secondary layer of defense against manual misconfiguration.</span></span> <span data-ttu-id="fdecd-447">目標是要封鎖從網際網路到前端或後端子網路的所有輸入流量。</span><span class="sxs-lookup"><span data-stu-id="fdecd-447">The goal is to block all inbound traffic from the Internet to either the front-end or back-end subnets.</span></span> <span data-ttu-id="fdecd-448">流量應該只從 SecNet 子網路到防火牆 (然後，如果合適，再到前端或後端子網路)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-448">Traffic should only flow through the SecNet subnet to the firewall (and then, if appropriate, on to the front-end or back-end subnets).</span></span> <span data-ttu-id="fdecd-449">此外，在具有 UDR 規則時，確實能夠流往前端或後端子網路的流量皆會被引導出來並流向防火牆 (多虧有了 UDR)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-449">Plus, with the UDR rules in place, any traffic that did make it into the front-end or back-end subnets would be directed out to the firewall (thanks to UDR).</span></span> <span data-ttu-id="fdecd-450">防火牆會將此流量視為非對稱流量，並且會捨棄輸出流量。</span><span class="sxs-lookup"><span data-stu-id="fdecd-450">The firewall would see this traffic as an asymmetric flow and would drop the outbound traffic.</span></span> <span data-ttu-id="fdecd-451">因此子網路有三層的安全性保護︰</span><span class="sxs-lookup"><span data-stu-id="fdecd-451">Thus there are three layers of security protecting the subnets:</span></span>

* <span data-ttu-id="fdecd-452">任何前端或後端 NIC 上沒有公用 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="fdecd-452">No Public IP addresses on any FrontEnd or BackEnd NICs.</span></span>
* <span data-ttu-id="fdecd-453">NSG 拒絕來自網際網路的流量。</span><span class="sxs-lookup"><span data-stu-id="fdecd-453">NSGs denying traffic from the Internet.</span></span>
* <span data-ttu-id="fdecd-454">防火牆卸除對稱流量。</span><span class="sxs-lookup"><span data-stu-id="fdecd-454">The firewall dropping asymmetric traffic.</span></span>

<span data-ttu-id="fdecd-455">此範例的 NSG 有一個有趣的地方，那就是它只有一個規則，此規則是為了要拒絕由網際網路流往整個虛擬網路 (包括安全性子網路) 的流量。</span><span class="sxs-lookup"><span data-stu-id="fdecd-455">One interesting point regarding the NSG in this example is that it contains only one rule, which is to deny Internet traffic to the entire virtual network, including the Security subnet.</span></span> <span data-ttu-id="fdecd-456">不過，由於 NSG 只會繫結至前端和後端子網路，因此不會對流往安全性子網路的輸入流量處理此規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-456">However, since the NSG is only bound to the front-end and back-end subnets, the rule isn’t processed on traffic inbound to the Security subnet.</span></span> <span data-ttu-id="fdecd-457">如此一來，流量就會傳送到安全性子網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-457">As a result, traffic flows to the Security subnet.</span></span>

#### <a name="firewall-rules"></a><span data-ttu-id="fdecd-458">防火牆規則</span><span class="sxs-lookup"><span data-stu-id="fdecd-458">Firewall rules</span></span>
<span data-ttu-id="fdecd-459">防火牆上應該建立轉送規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-459">On the firewall, forwarding rules should be created.</span></span> <span data-ttu-id="fdecd-460">因為防火牆會封鎖或轉送所有輸入、輸出和內部虛擬網路流量，所以需要許多防火牆規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-460">Since the firewall is blocking or forwarding all inbound, outbound, and intra-virtual network traffic, many firewall rules are needed.</span></span> <span data-ttu-id="fdecd-461">此外，所有輸入流量都會抵達安全性服務的公用 IP 位址 (在不同連接埠上)，並由防火牆進行處理。</span><span class="sxs-lookup"><span data-stu-id="fdecd-461">Also, all inbound traffic hits the Security Service public IP address (on different ports), to be processed by the firewall.</span></span> <span data-ttu-id="fdecd-462">最佳做法是先繪製邏輯流量圖，再設定子網路和防火牆規則，以避免日後還要修改。</span><span class="sxs-lookup"><span data-stu-id="fdecd-462">A best practice is to diagram the logical flows before setting up the subnets and firewall rules, to avoid rework later.</span></span> <span data-ttu-id="fdecd-463">下圖是此範例中的防火牆規則的邏輯視圖：</span><span class="sxs-lookup"><span data-stu-id="fdecd-463">The following figure is a logical view of the firewall rules for this example:</span></span>

<span data-ttu-id="fdecd-464">![10]</span><span class="sxs-lookup"><span data-stu-id="fdecd-464">![10]</span></span>

> [!NOTE]
> <span data-ttu-id="fdecd-465">根據所使用的網路虛擬應用裝置，會有不同的管理連接埠。</span><span class="sxs-lookup"><span data-stu-id="fdecd-465">Based on the Network Virtual Appliance used, the management ports vary.</span></span> <span data-ttu-id="fdecd-466">在此範例中，所參考的 Barracuda NextGen 防火牆使用連接埠 22、801 和 807。</span><span class="sxs-lookup"><span data-stu-id="fdecd-466">In this example, a Barracuda NextGen Firewall is referenced, which uses ports 22, 801, and 807.</span></span> <span data-ttu-id="fdecd-467">請參閱設備廠商的說明文件來尋找用於管理所使用裝置的確切連接埠。</span><span class="sxs-lookup"><span data-stu-id="fdecd-467">Consult the appliance vendor documentation to find the exact ports used for management of the device being used.</span></span>
>
>

#### <a name="firewall-rules-description"></a><span data-ttu-id="fdecd-468">防火牆規則描述</span><span class="sxs-lookup"><span data-stu-id="fdecd-468">Firewall rules description</span></span>
<span data-ttu-id="fdecd-469">上述的邏輯圖中沒有顯示安全性子網路，因為子網路上只有防火牆這項資源。</span><span class="sxs-lookup"><span data-stu-id="fdecd-469">In the preceding logical diagram, the security subnet is not shown because the firewall is the only resource on that subnet.</span></span> <span data-ttu-id="fdecd-470">圖中顯示防火牆規則以及這些規則在邏輯上是如何允許或拒絕流量的流動，而非顯示實際路由路徑。</span><span class="sxs-lookup"><span data-stu-id="fdecd-470">The diagram is showing the firewall rules and how they logically allow or deny traffic flows, not the actual routed path.</span></span> <span data-ttu-id="fdecd-471">此外，針對 RDP 流量選取的外部連接埠皆為較高範圍的連接埠 (8014 – 8026)，且在選取時會稍微配合本機 IP 位址的最後兩個八位元數字，以方便閱讀 (例如，本機伺服器位址 10.0.1.4 會與外部連接埠 8014 相關聯)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-471">Also, the external ports selected for the RDP traffic are higher ranged ports (8014 – 8026) and were selected to loosely align with the last two octets of the local IP address for easier readability (for example, local server address 10.0.1.4 is associated with external port 8014).</span></span> <span data-ttu-id="fdecd-472">不過您可以使用任何更高範圍的連接埠，只要連接埠未衝突即可。</span><span class="sxs-lookup"><span data-stu-id="fdecd-472">Any higher non-conflicting ports, however, could be used.</span></span>

<span data-ttu-id="fdecd-473">本例中，我們需要七種類型的規則︰</span><span class="sxs-lookup"><span data-stu-id="fdecd-473">For this example, we need seven types of rules:</span></span>

* <span data-ttu-id="fdecd-474">外部規則 (適用於輸入流量)：</span><span class="sxs-lookup"><span data-stu-id="fdecd-474">External rules (for inbound traffic):</span></span>
  1. <span data-ttu-id="fdecd-475">防火牆管理規則：此應用程式重新導向規則允許流量傳遞至網路虛擬設備的管理連接埠。</span><span class="sxs-lookup"><span data-stu-id="fdecd-475">Firewall management rule: This App Redirect rule allows traffic to pass to the management ports of the network virtual appliance.</span></span>
  2. <span data-ttu-id="fdecd-476">RDP 規則 (適用於每部 Windows 伺服器)：這四個規則 (每部伺服器一個) 允許透過 RDP 管理個別伺服器。</span><span class="sxs-lookup"><span data-stu-id="fdecd-476">RDP rules (for each Windows server): These four rules (one for each server) allow management of the individual servers via RDP.</span></span> <span data-ttu-id="fdecd-477">根據所使用的網路虛擬設備功能而定，也可將四個 RDP 規則結合成一個規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-477">The four RDP rules could also be collapsed into one rule, depending on the capabilities of the network virtual appliance being used.</span></span>
  3. <span data-ttu-id="fdecd-478">應用程式流量規則：這些規則有兩個，第一個適用於前端 Web 流量，第二個適用於後端流量 (例如，Web 伺服器流往資料層)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-478">Application traffic rules: There are two of these rules, the first for the front-end web traffic, and the second for the back-end traffic (for example, web server to data tier).</span></span> <span data-ttu-id="fdecd-479">這些規則的設定取決於網路架構 (伺服器的放置位置) 和流量流動行為 (流量的流動方向，以及使用的連接埠)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-479">The configuration of these rules depends on the network architecture (where your servers are placed) and traffic flows (which direction the traffic flows, and which ports are used).</span></span>
     * <span data-ttu-id="fdecd-480">第一個規則允許實際的應用程式流量抵達應用程式伺服器。</span><span class="sxs-lookup"><span data-stu-id="fdecd-480">The first rule allows the actual application traffic to reach the application server.</span></span> <span data-ttu-id="fdecd-481">其他規則所考慮的是安全性和管理等方面的事項，而應用程式規則則是用來允許外部使用者或服務存取應用程式。</span><span class="sxs-lookup"><span data-stu-id="fdecd-481">While the other rules allow for security and management, application traffic rules are what allow external users or services to access the applications.</span></span> <span data-ttu-id="fdecd-482">本例中，連接埠 80 上有單一 Web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="fdecd-482">For this example, there is a single web server on port 80.</span></span> <span data-ttu-id="fdecd-483">因此單一防火牆應用程式規則會將流往外部 IP 的輸入流量，重新導向到 Web 伺服器的內部 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="fdecd-483">Thus a single firewall application rule redirects inbound traffic to the external IP, to the web servers internal IP address.</span></span> <span data-ttu-id="fdecd-484">重新導向的流量工作階段會透過 NAT 轉譯到內部伺服器。</span><span class="sxs-lookup"><span data-stu-id="fdecd-484">The redirected traffic session would be translated via NAT to the internal server.</span></span>
     * <span data-ttu-id="fdecd-485">第二個規則是後端規則，允許 Web 伺服器透過任何連接埠與 AppVM01 伺服器 (而非 AppVM02) 對談。</span><span class="sxs-lookup"><span data-stu-id="fdecd-485">The second rule is the back-end rule to allow the web server to talk to the AppVM01 server (but not AppVM02) via any port.</span></span>
* <span data-ttu-id="fdecd-486">內部規則 (適用於內部虛擬網路流量)</span><span class="sxs-lookup"><span data-stu-id="fdecd-486">Internal rules (for intra-virtual network traffic)</span></span>
  1. <span data-ttu-id="fdecd-487">輸出到網際網路規則：這個規則允許來自任何網路的流量傳遞至選定的網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-487">Outbound to Internet rule: This rule allows traffic from any network to pass to the selected networks.</span></span> <span data-ttu-id="fdecd-488">此規則通常是防火牆上既有的預設規則，但會處於停用狀態。</span><span class="sxs-lookup"><span data-stu-id="fdecd-488">This rule is usually a default rule already on the firewall, but in a disabled state.</span></span> <span data-ttu-id="fdecd-489">在此範例中，應啟用此規則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-489">This rule should be enabled for this example.</span></span>
  2. <span data-ttu-id="fdecd-490">DNS 規則：此規則只會允許 DNS (連接埠 53) 流量傳遞至 DNS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="fdecd-490">DNS rule: This rule allows only DNS (port 53) traffic to pass to the DNS server.</span></span> <span data-ttu-id="fdecd-491">在這種環境中，大部分從前端到後端流量都會被封鎖。</span><span class="sxs-lookup"><span data-stu-id="fdecd-491">For this environment, most traffic from the front end to the back end is blocked.</span></span> <span data-ttu-id="fdecd-492">這個規則特別允許來自任何本機子網路的 DNS。</span><span class="sxs-lookup"><span data-stu-id="fdecd-492">This rule specifically allows DNS from any local subnet.</span></span>
  3. <span data-ttu-id="fdecd-493">子網路對子網路規則：此規則會允許後端子網路上的任何伺服器連接至前端子網路上的任何伺服器 (但不允許反向連接)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-493">Subnet to subnet rule: This rule is to allow any server on the back-end subnet to connect to any server on the front-end subnet (but not the reverse).</span></span>
* <span data-ttu-id="fdecd-494">保險規則 (適用於不符合上述任一規則的流量)：</span><span class="sxs-lookup"><span data-stu-id="fdecd-494">Fail-safe rule (for traffic that doesn’t meet any of the previous):</span></span>
  1. <span data-ttu-id="fdecd-495">拒絕所有流量規則：請一律將這一條拒絕規則作為最終規則 (以優先順序來看)，這樣一來，如果流量的流動行為無法符合上述任何規則時，便會由此規則將其捨棄。</span><span class="sxs-lookup"><span data-stu-id="fdecd-495">Deny all traffic rule: This deny rule should always be the final rule (in terms of priority), and as such if a traffic flow fails to match any of the preceding rules it is dropped by this rule.</span></span> <span data-ttu-id="fdecd-496">這是預設規則，通常為現成啟用狀態。</span><span class="sxs-lookup"><span data-stu-id="fdecd-496">This rule is a default rule and usually in-place and active.</span></span> <span data-ttu-id="fdecd-497">通常不需要對此規則進行任何修改。</span><span class="sxs-lookup"><span data-stu-id="fdecd-497">No modifications are usually needed to this rule.</span></span>

> [!TIP]
> <span data-ttu-id="fdecd-498">為簡化這個範例，第二個應用程式流量規則允許任何連接埠。</span><span class="sxs-lookup"><span data-stu-id="fdecd-498">On the second application traffic rule, to simplify this example, any port is allowed.</span></span> <span data-ttu-id="fdecd-499">在真實案例中，應使用最特定的連接埠和位址範圍來降低這項規則被攻擊的範圍。</span><span class="sxs-lookup"><span data-stu-id="fdecd-499">In a real scenario, the most specific port and address ranges should be used to reduce the attack surface of this rule.</span></span>
>
>

<span data-ttu-id="fdecd-500">建立好上述所有規則後，請務必檢閱每個規則的優先順序，以確保可依需要允許或拒絕流量。</span><span class="sxs-lookup"><span data-stu-id="fdecd-500">Once the previous rules are created, it’s important to review the priority of each rule to ensure traffic is allowed or denied as desired.</span></span> <span data-ttu-id="fdecd-501">在此範例中，規則是依照優先順序排列。</span><span class="sxs-lookup"><span data-stu-id="fdecd-501">For this example, the rules are in priority order.</span></span>

#### <a name="conclusion"></a><span data-ttu-id="fdecd-502">結論</span><span class="sxs-lookup"><span data-stu-id="fdecd-502">Conclusion</span></span>
<span data-ttu-id="fdecd-503">本範例較為複雜，但卻比之前的範例能更完整地保護和隔離網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-503">This example is a more complex but complete way of protecting and isolating the network than the previous examples.</span></span> <span data-ttu-id="fdecd-504">(範例 2 只保護應用程式，範例 1 只隔離子網路)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-504">(Example 2 protects just the application, and Example 1 just isolates subnets).</span></span> <span data-ttu-id="fdecd-505">這項設計允許同時監視兩個方向的流量，且不只保護輸入應用程式伺服器，還會對此網路上的所有伺服器強制執行網路安全性原則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-505">This design allows for monitoring traffic in both directions, and protects not just the inbound application server but enforces network security policy for all servers on this network.</span></span> <span data-ttu-id="fdecd-506">此外，根據使用的應用裝置而定，還能達成完整的流量稽核和感知。</span><span class="sxs-lookup"><span data-stu-id="fdecd-506">Also, depending on the appliance used, full traffic auditing and awareness can be achieved.</span></span> <span data-ttu-id="fdecd-507">如需詳細資訊，請參閱[詳細的組建指示][Example3]。</span><span class="sxs-lookup"><span data-stu-id="fdecd-507">For more information, see the [detailed build instructions][Example3].</span></span> <span data-ttu-id="fdecd-508">這些指示包括：</span><span class="sxs-lookup"><span data-stu-id="fdecd-508">These instructions include:</span></span>

* <span data-ttu-id="fdecd-509">如何使用傳統 PowerShell 指令碼組建這個範例周邊網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-509">How to build this example perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="fdecd-510">如何使用 Azure Resource Manager 範本組建這個範例。</span><span class="sxs-lookup"><span data-stu-id="fdecd-510">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="fdecd-511">每個 UDR、NSG 命令和防火牆規則的詳細描述。</span><span class="sxs-lookup"><span data-stu-id="fdecd-511">Detailed descriptions of each UDR, NSG command, and firewall rule.</span></span>
* <span data-ttu-id="fdecd-512">詳細的流量流程案例，顯示每一層允許或拒絕流量的方式。</span><span class="sxs-lookup"><span data-stu-id="fdecd-512">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>

### <a name="example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn"></a><span data-ttu-id="fdecd-513">範例 4 新增使用站對站虛擬設備 VPN 的混合式連接</span><span class="sxs-lookup"><span data-stu-id="fdecd-513">Example 4 Add a hybrid connection with a site-to-site, virtual appliance VPN</span></span>
<span data-ttu-id="fdecd-514">[回到快速開始](#fast-start) | 詳細的組建指示即將推出</span><span class="sxs-lookup"><span data-stu-id="fdecd-514">[Back to Fast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="fdecd-515">[![11]][11]</span><span class="sxs-lookup"><span data-stu-id="fdecd-515">[![11]][11]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="fdecd-516">環境描述</span><span class="sxs-lookup"><span data-stu-id="fdecd-516">Environment description</span></span>
<span data-ttu-id="fdecd-517">使用網路虛擬設備 (NVA) 的混合式網路可以加入至範例 1、2 或 3 所描述的任何周邊網路類型。</span><span class="sxs-lookup"><span data-stu-id="fdecd-517">Hybrid networking using a network virtual appliance (NVA) can be added to any of the perimeter network types described in examples 1, 2, or 3.</span></span>

<span data-ttu-id="fdecd-518">如上圖所示，透過網際網路的 VPN 連線 (站對站) 用於透過 NVA，將內部部署網路連接到 Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-518">As shown in the previous figure, a VPN connection over the Internet (site-to-site) is used to connect an on-premises network to an Azure virtual network via an NVA.</span></span>

> [!NOTE]
> <span data-ttu-id="fdecd-519">使用 ExpressRoute 時如果啟用了 [Azure 公用對等] 選項，應該會建立靜態的路由。</span><span class="sxs-lookup"><span data-stu-id="fdecd-519">If you use ExpressRoute with the Azure Public Peering option enabled, a static route should be created.</span></span> <span data-ttu-id="fdecd-520">這個靜態路由應該會路由至您公司網際網路外的 NVA VPN IP 位址，而且不是透過 ExpressRoute 連線。</span><span class="sxs-lookup"><span data-stu-id="fdecd-520">This static route should route to the NVA VPN IP address out your corporate Internet and not via the ExpressRoute connection.</span></span> <span data-ttu-id="fdecd-521">ExpressRoute [Azure 公用對等] 選項所需要的 NAT 可中斷 VPN 工作階段。</span><span class="sxs-lookup"><span data-stu-id="fdecd-521">The NAT required on the ExpressRoute Azure Public Peering option can break the VPN session.</span></span>
>
>

<span data-ttu-id="fdecd-522">一旦 VPN 備妥，NVA 就會變成所有網路和子網路的中央中樞。</span><span class="sxs-lookup"><span data-stu-id="fdecd-522">Once the VPN is in place, the NVA becomes the central hub for all networks and subnets.</span></span> <span data-ttu-id="fdecd-523">防火牆轉送規則會決定允許、由 NAT 轉譯、重新導向或捨棄哪些流量流程 (即使是內部部署網路與 Azure 之間的流量流程也是這樣)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-523">The firewall forwarding rules determine which traffic flows are allowed, are translated via NAT, are redirected, or are dropped (even for traffic flows between the on-premises network and Azure).</span></span>

<span data-ttu-id="fdecd-524">應該謹慎考量流量流程，它們可能因為這種設計模式而最佳化或退化，視特定的使用案例而定。</span><span class="sxs-lookup"><span data-stu-id="fdecd-524">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on the specific use case.</span></span>

<span data-ttu-id="fdecd-525">使用範例 3 中組建的環境，然後加入站對站 VPN 混合式網路連線，會產生下列設計：</span><span class="sxs-lookup"><span data-stu-id="fdecd-525">Using the environment built in example 3, and then adding a site-to-site VPN hybrid network connection, produces the following design:</span></span>

<span data-ttu-id="fdecd-526">[![12]][12]</span><span class="sxs-lookup"><span data-stu-id="fdecd-526">[![12]][12]</span></span>

<span data-ttu-id="fdecd-527">內部部署路由器或與用於 VPN 的 NVA 相容的任何其他網路裝置，就是 VPN 用戶端。</span><span class="sxs-lookup"><span data-stu-id="fdecd-527">The on-premises router, or any other network device that is compatible with your NVA for VPN, would be the VPN client.</span></span> <span data-ttu-id="fdecd-528">此實體裝置負責使用 NVA 起始並維護您的 VPN 連線。</span><span class="sxs-lookup"><span data-stu-id="fdecd-528">This physical device would be responsible for initiating and maintaining the VPN connection with your NVA.</span></span>

<span data-ttu-id="fdecd-529">就 NVA 而言，網路在邏輯上就像四個不同的「安全性區域 」，而以 NVA 上的規則為總指揮，統管這些區域之間的流量：</span><span class="sxs-lookup"><span data-stu-id="fdecd-529">Logically to the NVA, the network looks like four separate “security zones” with the rules on the NVA being the primary director of traffic between these zones:</span></span>

<span data-ttu-id="fdecd-530">![13]</span><span class="sxs-lookup"><span data-stu-id="fdecd-530">![13]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="fdecd-531">結論</span><span class="sxs-lookup"><span data-stu-id="fdecd-531">Conclusion</span></span>
<span data-ttu-id="fdecd-532">將站對站 VPN 混合式網路連線加入至 Azure 虛擬網路，能夠安全地將內部部署網路擴充至 Azure。</span><span class="sxs-lookup"><span data-stu-id="fdecd-532">The addition of a site-to-site VPN hybrid network connection to an Azure virtual network can extend the on-premises network into Azure in a secure manner.</span></span> <span data-ttu-id="fdecd-533">使用 VPN 連線時，流量會加密並透過網際網路來路由傳送。</span><span class="sxs-lookup"><span data-stu-id="fdecd-533">In using a VPN connection, your traffic is encrypted and routes via the Internet.</span></span> <span data-ttu-id="fdecd-534">本例中使用 NVA 集中強制執行和管理安全性原則。</span><span class="sxs-lookup"><span data-stu-id="fdecd-534">The NVA in this example provides a central location to enforce and manage the security policy.</span></span> <span data-ttu-id="fdecd-535">如需詳細資訊，請參閱＜詳細的組建指示＞(即將推出)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-535">For more information, see the detailed build instructions (forthcoming).</span></span> <span data-ttu-id="fdecd-536">這些指示包括：</span><span class="sxs-lookup"><span data-stu-id="fdecd-536">These instructions include:</span></span>

* <span data-ttu-id="fdecd-537">如何使用 PowerShell 指令碼組建這個範例周邊網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-537">How to build this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="fdecd-538">如何使用 Azure Resource Manager 範本組建這個範例。</span><span class="sxs-lookup"><span data-stu-id="fdecd-538">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="fdecd-539">顯示此設計中流量如何流通的詳細流量流程案例。</span><span class="sxs-lookup"><span data-stu-id="fdecd-539">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

### <a name="example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway"></a><span data-ttu-id="fdecd-540">範例 5 新增使用站對站 Azure VPN 閘道的混合式連接</span><span class="sxs-lookup"><span data-stu-id="fdecd-540">Example 5 Add a hybrid connection with a site-to-site, Azure VPN gateway</span></span>
<span data-ttu-id="fdecd-541">[回到快速開始](#fast-start) | 詳細的組建指示即將推出</span><span class="sxs-lookup"><span data-stu-id="fdecd-541">[Back to Fast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="fdecd-542">[![14]][14]</span><span class="sxs-lookup"><span data-stu-id="fdecd-542">[![14]][14]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="fdecd-543">環境描述</span><span class="sxs-lookup"><span data-stu-id="fdecd-543">Environment description</span></span>
<span data-ttu-id="fdecd-544">使用 Azure VPN 閘道的混合式網路可以加入至範例 1 或 2 所描述的任一種周邊網路類型。</span><span class="sxs-lookup"><span data-stu-id="fdecd-544">Hybrid networking using an Azure VPN gateway can be added to either perimeter network type described in examples 1 or 2.</span></span>

<span data-ttu-id="fdecd-545">如上圖所示，透過網際網路的 VPN 連線 (站對站) 用於透過 Azure VPN 閘道，將內部部署網路連接到 Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-545">As shown in the preceding figure, a VPN connection over the Internet (site-to-site) is used to connect an on-premises network to an Azure virtual network via an Azure VPN gateway.</span></span>

> [!NOTE]
> <span data-ttu-id="fdecd-546">使用 ExpressRoute 時如果啟用了 [Azure 公用對等] 選項，應該會建立靜態的路由。</span><span class="sxs-lookup"><span data-stu-id="fdecd-546">If you use ExpressRoute with the Azure Public Peering option enabled, a static route should be created.</span></span> <span data-ttu-id="fdecd-547">這個靜態路由應該會路由至您公司網際網路外的 NVA VPN IP 位址，而且不是透過 ExpressRoute WAN。</span><span class="sxs-lookup"><span data-stu-id="fdecd-547">This  static route should route to the NVA VPN IP address out your corporate Internet and not via the ExpressRoute WAN.</span></span> <span data-ttu-id="fdecd-548">ExpressRoute [Azure 公用對等] 選項所需要的 NAT 可中斷 VPN 工作階段。</span><span class="sxs-lookup"><span data-stu-id="fdecd-548">The NAT required on the ExpressRoute Azure Public Peering option can break the VPN session.</span></span>
>
>

<span data-ttu-id="fdecd-549">下圖顯示這個範例的兩個網路邊緣。</span><span class="sxs-lookup"><span data-stu-id="fdecd-549">The following figure shows the two network edges in this example.</span></span> <span data-ttu-id="fdecd-550">在第一個邊緣，NVA 和 NSG 控制 Azure 內部網路以及 Azure 和網際網路之間的流量流程。</span><span class="sxs-lookup"><span data-stu-id="fdecd-550">On the first edge, the NVA and NSGs control traffic flows for intra-Azure networks and between Azure and the Internet.</span></span> <span data-ttu-id="fdecd-551">第二個邊緣是 Azure VPN 閘道，這是內部部署與 Azure 之間分開隔離的網路邊緣。</span><span class="sxs-lookup"><span data-stu-id="fdecd-551">The second edge is the Azure VPN gateway, which is a separate and isolated network edge between on-premises and Azure.</span></span>

<span data-ttu-id="fdecd-552">應該謹慎考量流量流程，它們可能因為這種設計模式而最佳化或退化，視特定的使用案例而定。</span><span class="sxs-lookup"><span data-stu-id="fdecd-552">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on the specific use case.</span></span>

<span data-ttu-id="fdecd-553">使用範例 1 中組建的環境，然後加入站對站 VPN 混合式網路連線，會產生下列設計：</span><span class="sxs-lookup"><span data-stu-id="fdecd-553">Using the environment built in example 1, and then adding a site-to-site VPN hybrid network connection, produces the following design:</span></span>

<span data-ttu-id="fdecd-554">[![15]][15]</span><span class="sxs-lookup"><span data-stu-id="fdecd-554">[![15]][15]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="fdecd-555">結論</span><span class="sxs-lookup"><span data-stu-id="fdecd-555">Conclusion</span></span>
<span data-ttu-id="fdecd-556">將站對站 VPN 混合式網路連線加入至 Azure 虛擬網路，能夠安全地將內部部署網路擴充至 Azure。</span><span class="sxs-lookup"><span data-stu-id="fdecd-556">The addition of a site-to-site VPN hybrid network connection to an Azure virtual network can extend the on-premises network into Azure in a secure manner.</span></span> <span data-ttu-id="fdecd-557">使用原生 Azure VPN 閘道時，流量會由 IPSec 加密並透過網際網路來路由傳送。</span><span class="sxs-lookup"><span data-stu-id="fdecd-557">Using the native Azure VPN gateway, your traffic is IPSec encrypted and routes via the Internet.</span></span> <span data-ttu-id="fdecd-558">此外，使用 Azure VPN 閘道的成本也較低 (不像協力廠商 NVA 一樣需要額外的授權成本)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-558">Also, using the Azure VPN gateway can provide a lower-cost option (no additional licensing cost as with third-party NVAs).</span></span> <span data-ttu-id="fdecd-559">這個選項是範例 1 最經濟實惠的地方，因為不使用任何 NVA。</span><span class="sxs-lookup"><span data-stu-id="fdecd-559">This option is most economical in example 1, where no NVA is used.</span></span> <span data-ttu-id="fdecd-560">如需詳細資訊，請參閱＜詳細的組建指示＞(即將推出)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-560">For more information, see the detailed build instructions (forthcoming).</span></span> <span data-ttu-id="fdecd-561">這些指示包括：</span><span class="sxs-lookup"><span data-stu-id="fdecd-561">These instructions include:</span></span>

* <span data-ttu-id="fdecd-562">如何使用 PowerShell 指令碼組建這個範例周邊網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-562">How to build this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="fdecd-563">如何使用 Azure Resource Manager 範本組建這個範例。</span><span class="sxs-lookup"><span data-stu-id="fdecd-563">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="fdecd-564">顯示此設計中流量如何流通的詳細流量流程案例。</span><span class="sxs-lookup"><span data-stu-id="fdecd-564">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

### <a name="example-6-add-a-hybrid-connection-with-expressroute"></a><span data-ttu-id="fdecd-565">範例 6：新增使用 ExpressRoute 的混合式連接</span><span class="sxs-lookup"><span data-stu-id="fdecd-565">Example 6 Add a hybrid connection with ExpressRoute</span></span>
<span data-ttu-id="fdecd-566">[回到快速開始](#fast-start) | 詳細的組建指示即將推出</span><span class="sxs-lookup"><span data-stu-id="fdecd-566">[Back to Fast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="fdecd-567">[![16]][16]</span><span class="sxs-lookup"><span data-stu-id="fdecd-567">[![16]][16]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="fdecd-568">環境描述</span><span class="sxs-lookup"><span data-stu-id="fdecd-568">Environment description</span></span>
<span data-ttu-id="fdecd-569">使用 ExpressRoute 私用對等連線的混合式網路可以加入至範例 1 或 2 所描述的任一種周邊網路類型。</span><span class="sxs-lookup"><span data-stu-id="fdecd-569">Hybrid networking using an ExpressRoute private peering connection can be added to either perimeter network type described in examples 1 or 2.</span></span>

<span data-ttu-id="fdecd-570">如上圖所示，ExpressRoute 私用對等提供內部部署網路與 Azure 虛擬網路之間的直接連線。</span><span class="sxs-lookup"><span data-stu-id="fdecd-570">As shown in the preceding figure, ExpressRoute private peering provides a direct connection between your on-premises network and the Azure virtual network.</span></span> <span data-ttu-id="fdecd-571">流量只會在服務提供者網路和 Microsoft Azure 網路上流動，永遠不會到達網際網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-571">Traffic transits only the service provider network and the Microsoft Azure network, never touching the Internet.</span></span>

> [!TIP]
> <span data-ttu-id="fdecd-572">使用 ExpressRoute 讓公司網路流量遠離網際網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-572">Using ExpressRoute keeps corporate network traffic off the Internet.</span></span> <span data-ttu-id="fdecd-573">也能符合 ExpressRoute 提供者的服務等級協定。</span><span class="sxs-lookup"><span data-stu-id="fdecd-573">It also allows for service level agreements from your ExpressRoute provider.</span></span> <span data-ttu-id="fdecd-574">Azure 閘道在 ExpressRoute 上的傳遞速度高達 10 Gbps，而使用站對站 VPN 時，Azure 閘道的最大輸送量為 200 Mbps。</span><span class="sxs-lookup"><span data-stu-id="fdecd-574">The Azure Gateway can pass up to 10 Gbps with ExpressRoute, whereas with site-to-site VPNs, the Azure Gateway maximum throughput is 200 Mbps.</span></span>
>
>

<span data-ttu-id="fdecd-575">如下圖所示，使用此選項後，環境現在有兩個網路邊緣。</span><span class="sxs-lookup"><span data-stu-id="fdecd-575">As seen in the following diagram, with this option the environment now has two network edges.</span></span> <span data-ttu-id="fdecd-576">NVA 和 NSG 控制 Azure 網路內部及 Azure 與網際網路之間的流量流程，而閘道是內部部署與 Azure 之間的一個獨立且隔離的網路邊緣。</span><span class="sxs-lookup"><span data-stu-id="fdecd-576">The NVA and NSG control traffic flows for intra-Azure networks and between Azure and the Internet, while the gateway is a separate and isolated network edge between on-premises and Azure.</span></span>

<span data-ttu-id="fdecd-577">應該謹慎考量流量流程，它們可能因為這種設計模式而最佳化或退化，視特定的使用案例而定。</span><span class="sxs-lookup"><span data-stu-id="fdecd-577">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on the specific use case.</span></span>

<span data-ttu-id="fdecd-578">使用範例 1 中組建的環境，然後加入 ExpressRoute 混合式網路連線，會產生下列設計：</span><span class="sxs-lookup"><span data-stu-id="fdecd-578">Using the environment built in example 1, and then adding an ExpressRoute hybrid network connection, produces the following design:</span></span>

<span data-ttu-id="fdecd-579">[![17]][17]</span><span class="sxs-lookup"><span data-stu-id="fdecd-579">[![17]][17]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="fdecd-580">結論</span><span class="sxs-lookup"><span data-stu-id="fdecd-580">Conclusion</span></span>
<span data-ttu-id="fdecd-581">加入 ExpressRoute 私用對等網路連線，能夠以安全、短延遲、高效能的方式將內部部署網路擴充至 Azure。</span><span class="sxs-lookup"><span data-stu-id="fdecd-581">The addition of an ExpressRoute Private Peering network connection can extend the on-premises network into Azure in a secure, lower latency, higher performing manner.</span></span> <span data-ttu-id="fdecd-582">此外，如這個範例所示，使用原生 Azure 閘道的成本也較低 (不像協力廠商 NVA 一樣需要額外授權)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-582">Also, using the native Azure Gateway, as in this example, provides a lower-cost option (no additional licensing as with third-party NVAs).</span></span> <span data-ttu-id="fdecd-583">如需詳細資訊，請參閱＜詳細的組建指示＞(即將推出)。</span><span class="sxs-lookup"><span data-stu-id="fdecd-583">For more information, see the detailed build instructions (forthcoming).</span></span> <span data-ttu-id="fdecd-584">這些指示包括：</span><span class="sxs-lookup"><span data-stu-id="fdecd-584">These instructions include:</span></span>

* <span data-ttu-id="fdecd-585">如何使用 PowerShell 指令碼組建這個範例周邊網路。</span><span class="sxs-lookup"><span data-stu-id="fdecd-585">How to build this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="fdecd-586">如何使用 Azure Resource Manager 範本組建這個範例。</span><span class="sxs-lookup"><span data-stu-id="fdecd-586">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="fdecd-587">顯示此設計中流量如何流通的詳細流量流程案例。</span><span class="sxs-lookup"><span data-stu-id="fdecd-587">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

## <a name="references"></a><span data-ttu-id="fdecd-588">參考</span><span class="sxs-lookup"><span data-stu-id="fdecd-588">References</span></span>
### <a name="helpful-websites-and-documentation"></a><span data-ttu-id="fdecd-589">實用的網站和文件</span><span class="sxs-lookup"><span data-stu-id="fdecd-589">Helpful websites and documentation</span></span>
* <span data-ttu-id="fdecd-590">使用 Azure Resource Manager 存取 Azure：</span><span class="sxs-lookup"><span data-stu-id="fdecd-590">Access Azure with Azure Resource Manager:</span></span>
* <span data-ttu-id="fdecd-591">使用 PowerShell 存取 Azure：[https://docs.microsoft.com/powershell/azureps-cmdlets-docs/](/powershell/azure/overview)</span><span class="sxs-lookup"><span data-stu-id="fdecd-591">Accessing Azure with PowerShell: [https://docs.microsoft.com/powershell/azureps-cmdlets-docs/](/powershell/azure/overview)</span></span>
* <span data-ttu-id="fdecd-592">虛擬網路文件：[https://docs.microsoft.com/azure/virtual-network/](https://docs.microsoft.com/azure/virtual-network/)</span><span class="sxs-lookup"><span data-stu-id="fdecd-592">Virtual networking documentation: [https://docs.microsoft.com/azure/virtual-network/](https://docs.microsoft.com/azure/virtual-network/)</span></span>
* <span data-ttu-id="fdecd-593">網路安全性群組文件：[https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg](virtual-network/virtual-networks-nsg.md)</span><span class="sxs-lookup"><span data-stu-id="fdecd-593">Network security group documentation: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg](virtual-network/virtual-networks-nsg.md)</span></span>
* <span data-ttu-id="fdecd-594">使用者定義路由文件：[https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview](virtual-network/virtual-networks-udr-overview.md)</span><span class="sxs-lookup"><span data-stu-id="fdecd-594">User-defined routing documentation: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview](virtual-network/virtual-networks-udr-overview.md)</span></span>
* <span data-ttu-id="fdecd-595">Azure 虛擬閘道器︰[https://docs.microsoft.com/azure/vpn-gateway/](https://docs.microsoft.com/azure/vpn-gateway/)</span><span class="sxs-lookup"><span data-stu-id="fdecd-595">Azure virtual gateways: [https://docs.microsoft.com/azure/vpn-gateway/](https://docs.microsoft.com/azure/vpn-gateway/)</span></span>
* <span data-ttu-id="fdecd-596">站對站 VPN：[https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell](vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md)</span><span class="sxs-lookup"><span data-stu-id="fdecd-596">Site-to-Site VPNs: [https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell](vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md)</span></span>
* <span data-ttu-id="fdecd-597">ExpressRoute 文件 (請務必閱讀＜使用者入門＞和＜作法＞兩節)：[https://docs.microsoft.com/azure/expressroute/](https://docs.microsoft.com/azure/expressroute/)</span><span class="sxs-lookup"><span data-stu-id="fdecd-597">ExpressRoute documentation (be sure to check out the “Getting Started” and “How To” sections): [https://docs.microsoft.com/azure/expressroute/](https://docs.microsoft.com/azure/expressroute/)</span></span>

<!--Image References-->
<span data-ttu-id="fdecd-598">[0]: ./media/best-practices-network-security/flowchart.png "安全性選項流程圖"</span><span class="sxs-lookup"><span data-stu-id="fdecd-598">[0]: ./media/best-practices-network-security/flowchart.png "Security Options Flowchart"</span></span>
<span data-ttu-id="fdecd-599">[2]: ./media/best-practices-network-security/azuresecurityfeatures.png "Azure Security Features"</span><span class="sxs-lookup"><span data-stu-id="fdecd-599">[2]: ./media/best-practices-network-security/azuresecurityfeatures.png "Azure Security Features"</span></span>
<span data-ttu-id="fdecd-600">[3]: ./media/best-practices-network-security/dmzcorporate.png "A DMZ in a Corporate network"</span><span class="sxs-lookup"><span data-stu-id="fdecd-600">[3]: ./media/best-practices-network-security/dmzcorporate.png "A DMZ in a Corporate network"</span></span>
<span data-ttu-id="fdecd-601">[4]: ./media/best-practices-network-security/azuresecurityarchitecture.png "Azure Security Architecture"</span><span class="sxs-lookup"><span data-stu-id="fdecd-601">[4]: ./media/best-practices-network-security/azuresecurityarchitecture.png "Azure Security Architecture"</span></span>
<span data-ttu-id="fdecd-602">[5]: ./media/best-practices-network-security/dmzazure.png "A DMZ in an Azure Virtual Network"</span><span class="sxs-lookup"><span data-stu-id="fdecd-602">[5]: ./media/best-practices-network-security/dmzazure.png "A DMZ in an Azure Virtual Network"</span></span>
<span data-ttu-id="fdecd-603">[6]: ./media/best-practices-network-security/dmzhybrid.png "Hybrid Network with Three Security Boundaries"</span><span class="sxs-lookup"><span data-stu-id="fdecd-603">[6]: ./media/best-practices-network-security/dmzhybrid.png "Hybrid Network with Three Security Boundaries"</span></span>
<span data-ttu-id="fdecd-604">[7]: ./media/best-practices-network-security/example1design.png "具有 NSG 的輸入 DMZ"</span><span class="sxs-lookup"><span data-stu-id="fdecd-604">[7]: ./media/best-practices-network-security/example1design.png "Inbound DMZ with NSG"</span></span>
<span data-ttu-id="fdecd-605">[8]: ./media/best-practices-network-security/example2design.png "具有 NVA 和 NSG 的輸入 DMZ"</span><span class="sxs-lookup"><span data-stu-id="fdecd-605">[8]: ./media/best-practices-network-security/example2design.png "Inbound DMZ with NVA and NSG"</span></span>
<span data-ttu-id="fdecd-606">[9]: ./media/best-practices-network-security/example3design.png "具有 NVA、NSG 和 UDR 的雙向 DMZ"</span><span class="sxs-lookup"><span data-stu-id="fdecd-606">[9]: ./media/best-practices-network-security/example3design.png "Bi-directional DMZ with NVA, NSG, and UDR"</span></span>
<span data-ttu-id="fdecd-607">[10]: ./media/best-practices-network-security/example3firewalllogical.png "Logical View of the Firewall Rules"</span><span class="sxs-lookup"><span data-stu-id="fdecd-607">[10]: ./media/best-practices-network-security/example3firewalllogical.png "Logical View of the Firewall Rules"</span></span>
<span data-ttu-id="fdecd-608">[11]: ./media/best-practices-network-security/example3designoptions.png "連接 NVA 的 DMZ 混合式網路"</span><span class="sxs-lookup"><span data-stu-id="fdecd-608">[11]: ./media/best-practices-network-security/example3designoptions.png "DMZ with NVA Connected Hybrid Network"</span></span>
<span data-ttu-id="fdecd-609">[12]: ./media/best-practices-network-security/example4designs2s.png "使用站對站 VPN 連接 NVA 的 DMZ"</span><span class="sxs-lookup"><span data-stu-id="fdecd-609">[12]: ./media/best-practices-network-security/example4designs2s.png "DMZ with NVA Connected Using a Site-to-Site VPN"</span></span>
<span data-ttu-id="fdecd-610">[13]: ./media/best-practices-network-security/example4networklogical.png "Logical Network from NVA Perspective"</span><span class="sxs-lookup"><span data-stu-id="fdecd-610">[13]: ./media/best-practices-network-security/example4networklogical.png "Logical Network from NVA Perspective"</span></span>
<span data-ttu-id="fdecd-611">[14]: ./media/best-practices-network-security/example5designoptions.png "連接 Azure 閘道的 DMZ 站對站混合式網路"</span><span class="sxs-lookup"><span data-stu-id="fdecd-611">[14]: ./media/best-practices-network-security/example5designoptions.png "DMZ with Azure Gateway Connected Site-to-Site Hybrid Network"</span></span>
<span data-ttu-id="fdecd-612">[15]: ./media/best-practices-network-security/example5designs2s.png "使用站對站 VPN 連接 Azure 閘道的 DMZ"</span><span class="sxs-lookup"><span data-stu-id="fdecd-612">[15]: ./media/best-practices-network-security/example5designs2s.png "DMZ with Azure Gateway Using Site-to-Site VPN"</span></span>
<span data-ttu-id="fdecd-613">[16]: ./media/best-practices-network-security/example6designoptions.png "連接 Azure 閘道的 DMZ ExpressRoute 混合式網路"</span><span class="sxs-lookup"><span data-stu-id="fdecd-613">[16]: ./media/best-practices-network-security/example6designoptions.png "DMZ with Azure Gateway Connected ExpressRoute Hybrid Network"</span></span>
<span data-ttu-id="fdecd-614">[17]: ./media/best-practices-network-security/example6designexpressroute.png "使用 ExpressRoute 連線連接 Azure 閘道的 DMZ"</span><span class="sxs-lookup"><span data-stu-id="fdecd-614">[17]: ./media/best-practices-network-security/example6designexpressroute.png "DMZ with Azure Gateway Using an ExpressRoute Connection"</span></span>

<!--Link References-->
[TrustCenter]: https://azure.microsoft.com/support/trust-center/compliance/
[Example1]: ./virtual-network/virtual-networks-dmz-nsg.md
[Example2]: ./virtual-network/virtual-networks-dmz-nsg-fw-asm.md
[Example3]: ./virtual-network/virtual-networks-dmz-nsg-fw-udr-asm.md
[Example4]: ./virtual-network/virtual-networks-hybrid-s2s-nva-asm.md
[Example5]: ./virtual-network/virtual-networks-hybrid-s2s-agw-asm.md
[Example6]: ./virtual-network/virtual-networks-hybrid-expressroute-asm.md
[Example7]: ./virtual-network/virtual-networks-vnet2vnet-direct-asm.md
[Example8]: ./virtual-network/virtual-networks-vnet2vnet-transit-asm.md
