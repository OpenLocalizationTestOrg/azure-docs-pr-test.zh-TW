---
title: "aaaAzure 網路安全性最佳作法 |Microsoft 文件"
description: "了解一些 hello Azure toohelp 中可用的關鍵功能建立安全的網路環境"
services: virtual-network
documentationcenter: na
author: tracsman
manager: rossort
editor: 
ms.assetid: d169387a-1243-4867-a602-01d6f2d8a2a1
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/03/2017
ms.author: jonor
ms.openlocfilehash: b851b2862428a8bd5e7525c85584fc1c14ffcabe
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="microsoft-cloud-services-and-network-security"></a><span data-ttu-id="ea3e4-103">Microsoft 雲端服務和網路安全性</span><span class="sxs-lookup"><span data-stu-id="ea3e4-103">Microsoft cloud services and network security</span></span>
<span data-ttu-id="ea3e4-104">Microsoft 雲端服務提供超大規模的服務和基礎結構、企業級的功能，以及許多混合式連線選項。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-104">Microsoft cloud services deliver hyper-scale services and infrastructure, enterprise-grade capabilities, and many choices for hybrid connectivity.</span></span> <span data-ttu-id="ea3e4-105">客戶可以選擇 tooaccess 透過 hello 網際網路或 Azure ExpressRoute，後者提供私人網路連線與這些服務。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-105">Customers can choose tooaccess these services either via hello Internet or with Azure ExpressRoute, which provides private network connectivity.</span></span> <span data-ttu-id="ea3e4-106">hello Microsoft Azure 平台可讓的客戶將他們的基礎結構延伸至雲端 hello tooseamlessly，並建置多層式架構。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-106">hello Microsoft Azure platform allows customers tooseamlessly extend their infrastructure into hello cloud and build multi-tier architectures.</span></span> <span data-ttu-id="ea3e4-107">另外，協力廠商可以提供安全性服務和虛擬設備，以啟用增強的功能。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-107">Additionally, third parties can enable enhanced capabilities by offering security services and virtual appliances.</span></span> <span data-ttu-id="ea3e4-108">當客戶使用透過 ExpressRoute 存取的 Microsoft 雲端服務，這份白皮書提供他們應該考慮的安全性和架構性問題的概觀。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-108">This white paper provides an overview of security and architectural issues that customers should consider when using Microsoft cloud services accessed via ExpressRoute.</span></span> <span data-ttu-id="ea3e4-109">也包括在 Azure 虛擬網路中建立更安全的服務。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-109">It also covers creating more secure services in Azure virtual networks.</span></span>

## <a name="fast-start"></a><span data-ttu-id="ea3e4-110">快速開始</span><span class="sxs-lookup"><span data-stu-id="ea3e4-110">Fast start</span></span>
<span data-ttu-id="ea3e4-111">hello 下列邏輯圖表可以引導您 tooa 特定範例中的 hello hello Azure 平台提供的許多安全性技術。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-111">hello following logic chart can direct you tooa specific example of hello many security techniques available with hello Azure platform.</span></span> <span data-ttu-id="ea3e4-112">提供快速參考找出最符合您案例的 hello 範例。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-112">For quick reference, find hello example that best fits your case.</span></span> <span data-ttu-id="ea3e4-113">展開的說明，請繼續閱讀 hello 紙張。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-113">For expanded explanations, continue reading through hello paper.</span></span>
<span data-ttu-id="ea3e4-114">[![0]][0]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-114">[![0]][0]</span></span>

[<span data-ttu-id="ea3e4-115">範例 1： 建置周邊網路 （也稱為 DMZ、 非軍事區域或遮蔽式子網路） toohelp 保護應用程式，利用網路安全性群組 (Nsg)。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-115">Example 1: Build a perimeter network (also known as DMZ, demilitarized zone, or screened subnet) toohelp protect applications with network security groups (NSGs).</span></span>](#example-1-build-a-perimeter-network-to-help-protect-applications-with-nsgs)</br><span data-ttu-id="ea3e4-116">
[範例 2： 建立周邊網路 toohelp 保護與防火牆以及 Nsg 的應用程式。](#example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-116">
[Example 2: Build a perimeter network toohelp protect applications with a firewall and NSGs.](#example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs)</span></span></br><span data-ttu-id="ea3e4-117">
[範例 3： 建立周邊網路 toohelp 保護網路與防火牆、 使用者定義的路由 (UDR)，以及 NSG。](#example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-117">
[Example 3: Build a perimeter network toohelp protect networks with a firewall, user-defined route (UDR), and NSG.](#example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg)</span></span></br><span data-ttu-id="ea3e4-118">
[範例 4：新增使用站對站、虛擬設備的虛擬私人網路 (VPN) 混合式連接。](#example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-118">
[Example 4: Add a hybrid connection with a site-to-site, virtual appliance virtual private network (VPN).](#example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn)</span></span></br><span data-ttu-id="ea3e4-119">
[範例 5：新增使用站對站 Azure VPN 閘道的混合式連接。](#example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-119">
[Example 5: Add a hybrid connection with a site-to-site, Azure VPN gateway.](#example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway)</span></span></br><span data-ttu-id="ea3e4-120">
[範例 6：新增使用 ExpressRoute 的混合式連接。](#example-6-add-a-hybrid-connection-with-expressroute)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-120">
[Example 6: Add a hybrid connection with ExpressRoute.](#example-6-add-a-hybrid-connection-with-expressroute)</span></span></br>
<span data-ttu-id="ea3e4-121">虛擬網路、 高可用性和服務鏈結之間加入連接的範例會新增 toothis 文件 hello 接下來的幾個月。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-121">Examples for adding connections between virtual networks, high availability, and service chaining will be added toothis document over hello next few months.</span></span>

## <a name="microsoft-compliance-and-infrastructure-protection"></a><span data-ttu-id="ea3e4-122">Microsoft 法規遵循與基礎結構保護</span><span class="sxs-lookup"><span data-stu-id="ea3e4-122">Microsoft compliance and infrastructure protection</span></span>
<span data-ttu-id="ea3e4-123">toohelp 組織符合國家、 地區和業界的特定需求，可控管 hello 集合與使用個人資料，Microsoft 會提供超過 40 認證與認證。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-123">toohelp organizations comply with national, regional, and industry-specific requirements governing hello collection and use of individuals’ data, Microsoft offers over 40 certifications and attestations.</span></span> <span data-ttu-id="ea3e4-124">hello 最完整設定的任何雲端服務提供者。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-124">hello most comprehensive set of any cloud service provider.</span></span>

<span data-ttu-id="ea3e4-125">如需詳細資訊，請參閱 < hello 相容性資訊在 hello [Microsoft 信任中心][TrustCenter]。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-125">For more information, see hello compliance information on hello [Microsoft Trust Center][TrustCenter].</span></span>

<span data-ttu-id="ea3e4-126">Microsoft 有一套方法 tooprotect 雲端基礎結構所需 toorun 超小數位數全域服務。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-126">Microsoft has a comprehensive approach tooprotect cloud infrastructure needed toorun hyper-scale global services.</span></span> <span data-ttu-id="ea3e4-127">Microsoft 雲端基礎結構包含硬體、 軟體、 網路和系統管理和作業人員此外 toohello 實體資料中心。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-127">Microsoft cloud infrastructure includes hardware, software, networks, and administrative and operations staff, in addition toohello physical data centers.</span></span>

<span data-ttu-id="ea3e4-128">![2]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-128">![2]</span></span>

<span data-ttu-id="ea3e4-129">此方法提供在 hello Microsoft 雲端服務的客戶 toodeploy 為更安全的基礎。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-129">This approach provides a more secure foundation for customers toodeploy their services in hello Microsoft cloud.</span></span> <span data-ttu-id="ea3e4-130">hello 下一個步驟是客戶 toodesign，並建立安全性架構 tooprotect 這些服務。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-130">hello next step is for customers toodesign and create a security architecture tooprotect these services.</span></span>

## <a name="traditional-security-architectures-and-perimeter-networks"></a><span data-ttu-id="ea3e4-131">傳統的安全性架構和周邊網路</span><span class="sxs-lookup"><span data-stu-id="ea3e4-131">Traditional security architectures and perimeter networks</span></span>
<span data-ttu-id="ea3e4-132">雖然 Microsoft invests 大量保護 hello 雲端基礎結構，客戶也必須保護其雲端服務和資源群組。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-132">Although Microsoft invests heavily in protecting hello cloud infrastructure, customers must also protect their cloud services and resource groups.</span></span> <span data-ttu-id="ea3e4-133">多層次的方法 toosecurity 提供 hello 最佳防禦。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-133">A multilayered approach toosecurity provides hello best defense.</span></span> <span data-ttu-id="ea3e4-134">周邊網路安全區可防止不受信任的網路存取內部網路資源。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-134">A perimeter network security zone protects internal network resources from an untrusted network.</span></span> <span data-ttu-id="ea3e4-135">周邊網路是指 toohello 邊緣或坐 hello 網際網路與受保護的 hello 企業 IT 基礎結構之間的 hello 網路組件。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-135">A perimeter network refers toohello edges or parts of hello network that sit between hello Internet and hello protected enterprise IT infrastructure.</span></span>

<span data-ttu-id="ea3e4-136">在一般企業網路中，hello 核心基礎結構磐石在 hello 周邊，具有多個圖層的安全性裝置。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-136">In typical enterprise networks, hello core infrastructure is heavily fortified at hello perimeters, with multiple layers of security devices.</span></span> <span data-ttu-id="ea3e4-137">每個圖層的 hello 界限是由裝置和原則強制點所組成。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-137">hello boundary of each layer consists of devices and policy enforcement points.</span></span> <span data-ttu-id="ea3e4-138">每個圖層可以包含下列網路安全性裝置 hello 的組合： 防火牆、 防止阻絕服務 (DoS)、 入侵偵測或保護系統 (識別碼/IP) 和 VPN 裝置。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-138">Each layer can include a combination of hello following network security devices: firewalls, Denial of Service (DoS) prevention, Intrusion Detection or Protection Systems (IDS/IPS), and VPN devices.</span></span> <span data-ttu-id="ea3e4-139">強制執行原則可採用防火牆原則、 存取控制清單 (Acl)，或特定路由的 hello 的形式。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-139">Policy enforcement can take hello form of firewall policies, access control lists (ACLs), or specific routing.</span></span> <span data-ttu-id="ea3e4-140">hello 第一道防線在 hello 網路中，直接接受來自網際網路，hello 連入流量是同時進入 hello 網路允許進一步合法要求這些機制 tooblock 攻擊和有害流量的組合。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-140">hello first line of defense in hello network, directly accepting incoming traffic from hello Internet, is a combination of these mechanisms tooblock attacks and harmful traffic while allowing legitimate requests further into hello network.</span></span> <span data-ttu-id="ea3e4-141">此流量會路由傳送直接 tooresources hello 周邊網路中。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-141">This traffic routes directly tooresources in hello perimeter network.</span></span> <span data-ttu-id="ea3e4-142">該資源可能然後 「 交談 」 在 hello 網路中，傳送 hello 接下來的界限進行驗證，更深入的 tooresources 第一次。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-142">That resource may then “talk” tooresources deeper in hello network, transiting hello next boundary for validation first.</span></span> <span data-ttu-id="ea3e4-143">hello 最外層稱為 hello 周邊網路，因為這個 hello 網路的一部分是公開的 toohello 網際網路，通常會有某種形式的兩端上的保護。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-143">hello outermost layer is called hello perimeter network because this part of hello network is exposed toohello Internet, usually with some form of protection on both sides.</span></span> <span data-ttu-id="ea3e4-144">hello 下圖顯示單一子網路周邊網路的範例在公司網路中，具有兩個安全性界限。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-144">hello following figure shows an example of a single subnet perimeter network in a corporate network, with two security boundaries.</span></span>

<span data-ttu-id="ea3e4-145">![3]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-145">![3]</span></span>

<span data-ttu-id="ea3e4-146">有許多架構使用 tooimplement 周邊網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-146">There are many architectures used tooimplement a perimeter network.</span></span> <span data-ttu-id="ea3e4-147">這些架構可以使用各種機制，在每個界限 tooblock 流量的範圍從簡單的負載平衡器 tooa 多個子網路周邊網路，並保護 hello hello 公司網路的更深的階層。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-147">These architectures can range from a simple load balancer tooa multiple-subnet perimeter network with varied mechanisms at each boundary tooblock traffic and protect hello deeper layers of hello corporate network.</span></span> <span data-ttu-id="ea3e4-148">建置 hello 周邊網路的方式取決於 hello hello 組織和其整體風險承受度的特定需求。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-148">How hello perimeter network is built depends on hello specific needs of hello organization and its overall risk tolerance.</span></span>

<span data-ttu-id="ea3e4-149">當客戶移動其工作負載 toopublic 雲端時，它是關鍵 toosupport 類似的功能，在 Azure toomeet 相容性和安全性需求的周邊網路架構。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-149">As customers move their workloads toopublic clouds, it is critical toosupport similar capabilities for perimeter network architecture in Azure toomeet compliance and security requirements.</span></span> <span data-ttu-id="ea3e4-150">本文提供客戶如何在 Azure 中組建安全網路環境方法的指導方針。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-150">This document provides guidelines on how customers can build a secure network environment in Azure.</span></span> <span data-ttu-id="ea3e4-151">它著重在 hello 周邊網路，但也包含網路安全性的各個層面的完整討論。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-151">It focuses on hello perimeter network, but also includes a comprehensive discussion of many aspects of network security.</span></span> <span data-ttu-id="ea3e4-152">下列問題的 hello 通知本討論內容：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-152">hello following questions inform this discussion:</span></span>

* <span data-ttu-id="ea3e4-153">如何組建 Azure 的周邊網路？</span><span class="sxs-lookup"><span data-stu-id="ea3e4-153">How can a perimeter network in Azure be built?</span></span>
* <span data-ttu-id="ea3e4-154">有哪些 hello Azure 功能可用 toobuild hello 周邊網路？</span><span class="sxs-lookup"><span data-stu-id="ea3e4-154">What are some of hello Azure features available toobuild hello perimeter network?</span></span>
* <span data-ttu-id="ea3e4-155">如何保護後端工作負載？</span><span class="sxs-lookup"><span data-stu-id="ea3e4-155">How can back-end workloads be protected?</span></span>
* <span data-ttu-id="ea3e4-156">在 Azure 中的網際網路通訊控制 toohello 工作負載的方式？</span><span class="sxs-lookup"><span data-stu-id="ea3e4-156">How are Internet communications controlled toohello workloads in Azure?</span></span>
* <span data-ttu-id="ea3e4-157">Hello 在內部部署網路，要如何保護從在 Azure 中部署？</span><span class="sxs-lookup"><span data-stu-id="ea3e4-157">How can hello on-premises networks be protected from deployments in Azure?</span></span>
* <span data-ttu-id="ea3e4-158">何時該使用原生 Azure 安全性功能？何時又該使用協力廠商設備或服務？</span><span class="sxs-lookup"><span data-stu-id="ea3e4-158">When should native Azure security features be used versus third-party appliances or services?</span></span>

<span data-ttu-id="ea3e4-159">hello 下列圖表顯示安全性，Azure 提供 toocustomers 的各種層的級。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-159">hello following diagram shows various layers of security Azure provides toocustomers.</span></span> <span data-ttu-id="ea3e4-160">這些圖層都是原生 hello Azure 平台本身中的，而且客戶定義的功能：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-160">These layers are both native in hello Azure platform itself and customer-defined features:</span></span>

<span data-ttu-id="ea3e4-161">![4]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-161">![4]</span></span>

<span data-ttu-id="ea3e4-162">輸入從 hello 網際網路，Azure DDoS 有助於保護對 Azure 大規模的攻擊。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-162">Inbound from hello Internet, Azure DDoS helps protect against large-scale attacks against Azure.</span></span> <span data-ttu-id="ea3e4-163">hello 下一層是客戶定義的公用 IP 位址 （端點），也就是使用的 toodetermine 哪些流量可以通過 hello 雲端服務 toohello 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-163">hello next layer is customer-defined public IP addresses (endpoints), which are used toodetermine which traffic can pass through hello cloud service toohello virtual network.</span></span> <span data-ttu-id="ea3e4-164">原生 Azure 虛擬網路隔離可確保與其他所有網路完全隔離，而且流量只能流經使用者設定的路徑和方法。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-164">Native Azure virtual network isolation ensures complete isolation from all other networks and that traffic only flows through user configured paths and methods.</span></span> <span data-ttu-id="ea3e4-165">這些路徑和方法的 hello 下一層，Nsg、 UDR 和網路的虛擬應用裝置可以是使用的 toocreate 安全性界限 tooprotect hello 應用程式部署在受保護的 hello 網路中。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-165">These paths and methods are hello next layer, where NSGs, UDR, and network virtual appliances can be used toocreate security boundaries tooprotect hello application deployments in hello protected network.</span></span>

<span data-ttu-id="ea3e4-166">hello 下一節提供 Azure 虛擬網路的概觀。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-166">hello next section provides an overview of Azure virtual networks.</span></span> <span data-ttu-id="ea3e4-167">這些虛擬網路由客戶建立，也是部署的工作負載所連接的目的地。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-167">These virtual networks are created by customers, and are what their deployed workloads are connected to.</span></span> <span data-ttu-id="ea3e4-168">虛擬網路是 hello 為基礎的所有 hello 網路安全性功能需要 tooestablish 周邊網路 tooprotect 客戶部署在 Azure 中。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-168">Virtual networks are hello basis of all hello network security features required tooestablish a perimeter network tooprotect customer deployments in Azure.</span></span>

## <a name="overview-of-azure-virtual-networks"></a><span data-ttu-id="ea3e4-169">Azure 虛擬網路的概觀</span><span class="sxs-lookup"><span data-stu-id="ea3e4-169">Overview of Azure virtual networks</span></span>
<span data-ttu-id="ea3e4-170">網際網路流量 toohello Azure 虛擬網路，才能進行有兩個圖層的安全性繼承 toohello Azure 平台：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-170">Before Internet traffic can get toohello Azure virtual networks, there are two layers of security inherent toohello Azure platform:</span></span>

1.    <span data-ttu-id="ea3e4-171">**DDoS 保護**: DDoS 保護是 hello Azure 大規模以網際網路為基礎的攻擊會防止 hello Azure 平台本身的實體網路的圖層。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-171">**DDoS protection**: DDoS protection is a layer of hello Azure physical network that protects hello Azure platform itself from large-scale Internet-based attacks.</span></span> <span data-ttu-id="ea3e4-172">這些攻擊會使用多個 「 bot 」 節點中嘗試 toooverwhelm 網際網路服務。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-172">These attacks use multiple “bot” nodes in an attempt toooverwhelm an Internet service.</span></span> <span data-ttu-id="ea3e4-173">Azure 有一層很強大的 DDoS 保護網可篩選所有輸入、輸出及跨 Azure 區域的連線。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-173">Azure has a robust DDoS protection mesh on all inbound, outbound, and cross-Azure region connectivity.</span></span> <span data-ttu-id="ea3e4-174">DDoS 保護層，這個沒有任何使用者可設定屬性，並不是可存取 toohello 客戶。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-174">This DDoS protection layer has no user configurable attributes and is not accessible toohello customer.</span></span> <span data-ttu-id="ea3e4-175">hello DDoS 保護層，以保護 Azure 做為平台，從大規模的攻擊時，它也會監視傳出的流量和跨 Azure 區域的流量。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-175">hello DDoS protection layer protects Azure as a platform from large-scale attacks, it also monitors out-bound traffic and cross-Azure region traffic.</span></span> <span data-ttu-id="ea3e4-176">使用網路虛擬裝置 hello VNet 上，可以 hello 客戶針對較小的標尺攻擊，不會中斷 hello 平台層級的保護設定額外恢復功能層級。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-176">Using network virtual appliances on hello VNet, additional layers of resilience can be configured by hello customer against a smaller scale attack that doesn't trip hello platform level protection.</span></span> <span data-ttu-id="ea3e4-177">舉例來說，DDoS 動作;如果網際網路對向的 IP 位址遭到攻擊大規模 DDoS 攻擊，Azure 會偵測 hello 攻擊的 hello 來源，並刪除 hello 違規流量之前它已達到所要的目的地。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-177">An example of DDoS in action; if an internet facing IP address was attacked by a large-scale DDoS attack, Azure would detect hello sources of hello attacks and scrub hello offending traffic before it reached its intended destination.</span></span> <span data-ttu-id="ea3e4-178">在大多數情況下，hello 容易受到攻擊的端點不會受到 hello 攻擊。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-178">In almost all cases, hello attacked endpoint isn't affected by hello attack.</span></span> <span data-ttu-id="ea3e4-179">在端點，會受到影響 hello 罕見情況下，沒有流量會是受影響的 tooother 的端點只有遭受攻擊的 hello 端點。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-179">In hello rare cases that an endpoint is affected, no traffic is affected tooother endpoints, only hello attacked endpoint.</span></span> <span data-ttu-id="ea3e4-180">因此，其他客戶和服務也不會看到此攻擊所造成的影響。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-180">Thus other customers and services would see no impact from that attack.</span></span> <span data-ttu-id="ea3e4-181">Azure DDoS 只會查看大規模攻擊的重大 toonote 它。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-181">It's critical toonote that Azure DDoS is only looking for large-scale attacks.</span></span> <span data-ttu-id="ea3e4-182">很可能超出 hello 平台層級的保護臨界值之前，可能爆您特定的服務。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-182">It is possible that your specific service could be overwhelmed before hello platform level protection thresholds are exceeded.</span></span> <span data-ttu-id="ea3e4-183">例如，單一 A0 IIS 伺服器上的網站，在 Azure 平台層級 DDoS 保護註冊威脅之前，可能被 DDoS 攻擊而離線。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-183">For example, a web site on a single A0 IIS server, could be taken offline by a DDoS attack before Azure platform level DDoS protection registered a threat.</span></span>

2.  <span data-ttu-id="ea3e4-184">**公用 IP 位址**： 公用 IP 位址 （透過服務端點、 公用 IP 位址、 應用程式閘道，以及其他 Azure 功能，都沒有公用 IP 位址 toohello 網際網路路由傳送 tooyour 資源已啟用） 讓雲端服務或資源群組 toohave 公用網際網路 IP 位址和公開的連接埠。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-184">**Public IP Addresses**: Public IP addresses (enabled via service endpoints, Public IP addresses, Application Gateway, and other Azure features that present a public IP address toohello internet routed tooyour resource) allow cloud services or resource groups toohave public Internet IP addresses and ports exposed.</span></span> <span data-ttu-id="ea3e4-185">hello 端點會使用網路位址轉譯 (NAT) tooroute 流量 toohello 內部位址和連接埠上 hello Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-185">hello endpoint uses Network Address Translation (NAT) tooroute traffic toohello internal address and port on hello Azure virtual network.</span></span> <span data-ttu-id="ea3e4-186">這個路徑是在 hello 的虛擬網路的外部流量 toopass hello 主要方式。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-186">This path is hello primary way for external traffic toopass into hello virtual network.</span></span> <span data-ttu-id="ea3e4-187">hello 公用 IP 位址是可設定 toodetermine 傳入的流量，及如何及在何處轉譯 toohello 虛擬網路上。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-187">hello Public IP addresses are configurable toodetermine which traffic is passed in, and how and where it's translated on toohello virtual network.</span></span>

<span data-ttu-id="ea3e4-188">當流量達到 hello 虛擬網路時，有許多功能，可開始執行。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-188">Once traffic reaches hello virtual network, there are many features that come into play.</span></span> <span data-ttu-id="ea3e4-189">Azure 虛擬網路是 hello 客戶 tooattach 的基礎，其工作負載和其中適用於基本的網路層級安全性。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-189">Azure virtual networks are hello foundation for customers tooattach their workloads and where basic network-level security applies.</span></span> <span data-ttu-id="ea3e4-190">它位於私人網路 （虛擬網路的重疊） Azure hello 的客戶下列功能和特性：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-190">It is a private network (a virtual network overlay) in Azure for customers with hello following features and characteristics:</span></span>

* <span data-ttu-id="ea3e4-191">**流量隔離**： 虛擬網路是 hello Azure 平台上的 hello 流量隔離界限。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-191">**Traffic isolation**: A virtual network is hello traffic isolation boundary on hello Azure platform.</span></span> <span data-ttu-id="ea3e4-192">一個虛擬網路中的虛擬機器 (Vm) 無法通訊，直接在不同虛擬網路中，即使這兩個虛擬網路建立的 tooVMs hello 同一位客戶。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-192">Virtual machines (VMs) in one virtual network cannot communicate directly tooVMs in a different virtual network, even if both virtual networks are created by hello same customer.</span></span> <span data-ttu-id="ea3e4-193">隔離是很重要的屬性，可確保客戶 VM 和通訊仍然隱蔽於虛擬網路內。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-193">Isolation is a critical property that ensures customer VMs and communication remains private within a virtual network.</span></span>

>[!NOTE]
><span data-ttu-id="ea3e4-194">流量隔離是指只 tootraffic*輸入*toohello 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-194">Traffic isolation refers only tootraffic *inbound* toohello virtual network.</span></span> <span data-ttu-id="ea3e4-195">透過預設輸出流量的 hello VNet toohello 從網際網路允許，但如果有需要請 Nsg 可以避免。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-195">By default outbound traffic from hello VNet toohello internet is allowed, but can be prevented if desired by NSGs.</span></span>
>
>

* <span data-ttu-id="ea3e4-196">**多層式拓撲**： 虛擬網路可讓客戶 toodefine 多層式拓撲藉由配置子網路，並指定不同的項目或 「 層 」 其工作負載的不同的位址空間。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-196">**Multi-tier topology**: Virtual networks allow customers toodefine multi-tier topology by allocating subnets and designating separate address spaces for different elements or “tiers” of their workloads.</span></span> <span data-ttu-id="ea3e4-197">這些邏輯群組拓撲啟用客戶 toodefine 不同的存取原則，根據 hello 工作負載類型，而且也可以控制 hello 各層之間的流量。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-197">These logical groupings and topologies enable customers toodefine different access policy based on hello workload types, and also control traffic flows between hello tiers.</span></span>
* <span data-ttu-id="ea3e4-198">**跨單位連線**：客戶可以在虛擬網路和多個內部部署網站或 Azure 中的其他虛擬網路之間，建立跨單位連線。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-198">**Cross-premises connectivity**: Customers can establish cross-premises connectivity between a virtual network and multiple on-premises sites or other virtual networks in Azure.</span></span> <span data-ttu-id="ea3e4-199">tooconstruct 連接，客戶可以使用對等互連的 VNet，Azure VPN 閘道、 協力廠商的網路虛擬應用裝置或 ExpressRoute。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-199">tooconstruct a connection, customers can use VNet Peering, Azure VPN Gateways, third-party network virtual appliances, or ExpressRoute.</span></span> <span data-ttu-id="ea3e4-200">Azure 支援使用標準 IPsec/IKE 通訊協定和 ExpressRoute 私人連線能力的站對站 (S2S) VPN。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-200">Azure supports site-to-site (S2S) VPNs using standard IPsec/IKE protocols and ExpressRoute private connectivity.</span></span>
* <span data-ttu-id="ea3e4-201">**NSG**可讓客戶 toocreate 規則 (Acl)，在 hello 預期的資料粒度的層級： 網路介面，個別的 Vm 或虛擬子網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-201">**NSG** allows customers toocreate rules (ACLs) at hello desired level of granularity: network interfaces, individual VMs, or virtual subnets.</span></span> <span data-ttu-id="ea3e4-202">客戶可以藉由允許或拒絕虛擬網路，客戶透過跨單位連線的網路上的系統中的 hello 工作負載之間的通訊會控制存取，或直接網際網路通訊。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-202">Customers can control access by permitting or denying communication between hello workloads within a virtual network, from systems on customer’s networks via cross-premises connectivity, or direct Internet communication.</span></span>
* <span data-ttu-id="ea3e4-203">**UDR**和**IP 轉送**讓客戶虛擬網路內的不同層之間 toodefine hello 通訊路徑。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-203">**UDR** and **IP Forwarding** allow customers toodefine hello communication paths between different tiers within a virtual network.</span></span> <span data-ttu-id="ea3e4-204">客戶可以部署防火牆、IDS/IPS 和其他虛擬設備，並透過這些安全性設備來路由傳送網路流量，以強制執行安全性界限原則、稽核和檢查。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-204">Customers can deploy a firewall, IDS/IPS, and other virtual appliances, and route network traffic through these security appliances for security boundary policy enforcement, auditing, and inspection.</span></span>
* <span data-ttu-id="ea3e4-205">**網路虛擬裝置**hello Azure Marketplace 中： 例如防火牆、 負載平衡器、 和識別碼/IP 的安全性設備 hello Azure Marketplace 中可用以及 hello VM 映像庫。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-205">**Network virtual appliances** in hello Azure Marketplace: Security appliances such as firewalls, load balancers, and IDS/IPS are available in hello Azure Marketplace and hello VM Image Gallery.</span></span> <span data-ttu-id="ea3e4-206">客戶可以部署到他們的虛擬網路，並明確地說，在其安全性界限 （包括 hello 周邊網路子網路） toocomplete 多層保護網路的環境，這些應用裝置。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-206">Customers can deploy these appliances into their virtual networks, and specifically, at their security boundaries (including hello perimeter network subnets) toocomplete a multi-tiered secure network environment.</span></span>

<span data-ttu-id="ea3e4-207">使用這些功能和能力，周邊網路架構可以如何建構在 Azure 中的其中一個範例會為下列圖表 hello:</span><span class="sxs-lookup"><span data-stu-id="ea3e4-207">With these features and capabilities, one example of how a perimeter network architecture could be constructed in Azure is hello following diagram:</span></span>

<span data-ttu-id="ea3e4-208">![5]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-208">![5]</span></span>

## <a name="perimeter-network-characteristics-and-requirements"></a><span data-ttu-id="ea3e4-209">周邊網路特性和需求</span><span class="sxs-lookup"><span data-stu-id="ea3e4-209">Perimeter network characteristics and requirements</span></span>
<span data-ttu-id="ea3e4-210">hello 前端 hello 網路直接相互關連來自 hello 網際網路通訊的 hello 周邊網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-210">hello perimeter network is hello front end of hello network, directly interfacing communication from hello Internet.</span></span> <span data-ttu-id="ea3e4-211">hello 連入封包應該流經 hello 安全性應用裝置，例如 hello 防火牆、 識別碼和 IP 時，才會到達 hello 後端伺服器。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-211">hello incoming packets should flow through hello security appliances, such as hello firewall, IDS, and IPS, before reaching hello back-end servers.</span></span> <span data-ttu-id="ea3e4-212">網際網路繫結的封包從 hello 工作負載也能通過 hello 的安全性設備卻 hello 周邊網路中強制執行原則、 檢查，和稽核時，才退出 hello 網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-212">Internet-bound packets from hello workloads can also flow through hello security appliances in hello perimeter network for policy enforcement, inspection, and auditing purposes, before leaving hello network.</span></span> <span data-ttu-id="ea3e4-213">此外，hello 周邊網路中可以裝載的客戶虛擬網路與內部部署網路之間的跨單位 VPN 閘道。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-213">Additionally, hello perimeter network can host cross-premises VPN gateways between customer virtual networks and on-premises networks.</span></span>

### <a name="perimeter-network-characteristics"></a><span data-ttu-id="ea3e4-214">周邊網路特性</span><span class="sxs-lookup"><span data-stu-id="ea3e4-214">Perimeter network characteristics</span></span>
<span data-ttu-id="ea3e4-215">參考 hello 上圖中，某些 hello 良好的周邊網路特性如下：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-215">Referencing hello previous figure, some of hello characteristics of a good perimeter network are as follows:</span></span>

* <span data-ttu-id="ea3e4-216">網際網路對向︰</span><span class="sxs-lookup"><span data-stu-id="ea3e4-216">Internet-facing:</span></span>
  * <span data-ttu-id="ea3e4-217">hello 周邊網路的子網路本身為網際網路對向，直接與 hello 網際網路通訊。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-217">hello perimeter network subnet itself is Internet-facing, directly communicating with hello Internet.</span></span>
  * <span data-ttu-id="ea3e4-218">公用 IP 位址、 Vip，及/或服務端點傳遞網際網路流量 toohello 前端網路和裝置。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-218">Public IP addresses, VIPs, and/or service endpoints pass Internet traffic toohello front-end network and devices.</span></span>
  * <span data-ttu-id="ea3e4-219">輸入從 hello 網際網路通過之前其他資源的安全性裝置 hello 前端網路的流量。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-219">Inbound traffic from hello Internet passes through security devices before other resources on hello front-end network.</span></span>
  * <span data-ttu-id="ea3e4-220">如果已啟用連出安全性，流量通過安全性裝置 hello 最後一個步驟之前傳遞 toohello 網際網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-220">If outbound security is enabled, traffic passes through security devices, as hello final step, before passing toohello Internet.</span></span>
* <span data-ttu-id="ea3e4-221">受保護的網路︰</span><span class="sxs-lookup"><span data-stu-id="ea3e4-221">Protected network:</span></span>
  * <span data-ttu-id="ea3e4-222">沒有直接路徑從 hello 網際網路 toohello 核心基礎結構。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-222">There is no direct path from hello Internet toohello core infrastructure.</span></span>
  * <span data-ttu-id="ea3e4-223">通道 toohello 核心基礎結構必須周遊安全性裝置，例如 Nsg、 防火牆或 VPN 裝置。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-223">Channels toohello core infrastructure must traverse through security devices such as NSGs, firewalls, or VPN devices.</span></span>
  * <span data-ttu-id="ea3e4-224">其他裝置必須橋網際網路和 hello 核心基礎結構。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-224">Other devices must not bridge Internet and hello core infrastructure.</span></span>
  * <span data-ttu-id="ea3e4-225">兩者的安全性裝置 hello 網際網路對向並 hello 受保護的網路對向的 hello 周邊網路 （例如，hello 兩個防火牆圖示 hello 上圖所示） 界限實際上可能是單一的虛擬設備已區分的規則或每個界限的介面。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-225">Security devices on both hello Internet-facing and hello protected network facing boundaries of hello perimeter network (for example, hello two firewall icons shown in hello previous figure) may actually be a single virtual appliance with differentiated rules or interfaces for each boundary.</span></span> <span data-ttu-id="ea3e4-226">例如，一個實體裝置，以邏輯方式分隔，處理這兩個界限的 hello 周邊網路的 hello 負載。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-226">For example, one physical device, logically separated, handling hello load for both boundaries of hello perimeter network.</span></span>
* <span data-ttu-id="ea3e4-227">其他常見的做法和條件約束：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-227">Other common practices and constraints:</span></span>
  * <span data-ttu-id="ea3e4-228">工作負載不得儲存商務關鍵資訊。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-228">Workloads must not store business critical information.</span></span>
  * <span data-ttu-id="ea3e4-229">存取和更新 tooperimeter 網路組態和部署是有限的 tooonly 授權管理員。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-229">Access and updates tooperimeter network configurations and deployments are limited tooonly authorized administrators.</span></span>

### <a name="perimeter-network-requirements"></a><span data-ttu-id="ea3e4-230">周邊網路需求</span><span class="sxs-lookup"><span data-stu-id="ea3e4-230">Perimeter network requirements</span></span>
<span data-ttu-id="ea3e4-231">tooenable 這些特性，在虛擬網路需求 tooimplement 成功周邊網路上遵循下列指導方針：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-231">tooenable these characteristics, follow these guidelines on virtual network requirements tooimplement a successful perimeter network:</span></span>

* <span data-ttu-id="ea3e4-232">**子網路架構：**指定 hello 虛擬網路的整個子網路專門為 hello 周邊網路，分開 hello 中的其他子網路相同虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-232">**Subnet architecture:** Specify hello virtual network such that an entire subnet is dedicated as hello perimeter network, separated from other subnets in hello same virtual network.</span></span> <span data-ttu-id="ea3e4-233">這項分隔可確保 hello hello 周邊網路與其他內部或私人子網路層流經防火牆或識別碼/IP 虛擬應用裝置之間的流量。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-233">This separation ensures hello traffic between hello perimeter network and other internal or private subnet tiers flows through a firewall or IDS/IPS virtual appliance.</span></span>  <span data-ttu-id="ea3e4-234">子網路是 hello 界限上的使用者定義的路由需要 tooforward 此流量 toohello 虛擬應用裝置。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-234">User-defined routes on hello boundary subnets are required tooforward this traffic toohello virtual appliance.</span></span>
* <span data-ttu-id="ea3e4-235">**NSG:** hello 周邊網路的子網路本身應該開啟 tooallow 通訊以 hello 網際網路，但這不表示客戶應該略過 Nsg。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-235">**NSG:** hello perimeter network subnet itself should be open tooallow communication with hello Internet, but that does not mean customers should be bypassing NSGs.</span></span> <span data-ttu-id="ea3e4-236">請遵循下列一般安全性作法 toominimize hello 網路介面公開 toohello 網際網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-236">Follow common security practices toominimize hello network surfaces exposed toohello Internet.</span></span> <span data-ttu-id="ea3e4-237">鎖定 hello 允許 tooaccess hello 部署或 hello 特定應用程式通訊協定和連接埠已開啟的遠端位址範圍。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-237">Lock down hello remote address ranges allowed tooaccess hello deployments or hello specific application protocols and ports that are open.</span></span> <span data-ttu-id="ea3e4-238">但可能在某些情況下，完全鎖定不一定行得通。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-238">There may be circumstances, however, in which a complete lock-down is not possible.</span></span> <span data-ttu-id="ea3e4-239">例如，如果客戶在 Azure 中設有外部網站，hello 周邊網路應該允許來自任何公用 IP 位址，hello 內送網站要求但只應該開啟 hello web 應用程式連接埠： TCP 連接埠 80 和 （或) 上的 tcp 連接埠 443。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-239">For example, if customers have an external website in Azure, hello perimeter network should allow hello incoming web requests from any public IP addresses, but should only open hello web application ports: TCP on port 80 and/or TCP on port 443.</span></span>
* <span data-ttu-id="ea3e4-240">**路由表：** hello 周邊網路的子網路本身應該能夠 toocommunicate toohello 網際網路直接，但應該不允許從 hello 後端或在內部部署網路的直接通訊 tooand 而不需要透過防火牆或安全性應用裝置。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-240">**Routing table:** hello perimeter network subnet itself should be able toocommunicate toohello Internet directly, but should not allow direct communication tooand from hello back end or on-premises networks without going through a firewall or security appliance.</span></span>
* <span data-ttu-id="ea3e4-241">**安全性應用裝置組態：** tooroute 和檢查 hello 周邊網路與 hello rest 的受保護的 hello 網路之間的封包、 hello 安全性應用裝置，例如防火牆、 ID 及 IP 裝置，可能是多重主目錄。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-241">**Security appliance configuration:** tooroute and inspect packets between hello perimeter network and hello rest of hello protected networks, hello security appliances such as firewall, IDS, and IPS devices may be multi-homed.</span></span> <span data-ttu-id="ea3e4-242">它們可能會有不同的 Nic hello 周邊網路和 hello 後端子網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-242">They may have separate NICs for hello perimeter network and hello back-end subnets.</span></span> <span data-ttu-id="ea3e4-243">hello 周邊網路中的 hello Nic 直接通訊 tooand 從 hello 網際網路，以 hello 對應 Nsg hello 周邊網路及路由表。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-243">hello NICs in hello perimeter network communicate directly tooand from hello Internet, with hello corresponding NSGs and hello perimeter network routing table.</span></span> <span data-ttu-id="ea3e4-244">Nsg 與 hello 對應後端子網路的路由表，hello Nic 連線 toohello 後端子網路有更多限制。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-244">hello NICs connecting toohello back-end subnets have more restricted NSGs and routing tables of hello corresponding back-end subnets.</span></span>
* <span data-ttu-id="ea3e4-245">**安全性應用裝置功能：**通常 hello 周邊網路中部署的 hello 的安全性設備卻會執行下列功能的 hello:</span><span class="sxs-lookup"><span data-stu-id="ea3e4-245">**Security appliance functionality:** hello security appliances deployed in hello perimeter network typically perform hello following functionality:</span></span>
  * <span data-ttu-id="ea3e4-246">防火牆： 強制防火牆規則或 hello 連入要求的存取控制原則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-246">Firewall: Enforcing firewall rules or access control policies for hello incoming requests.</span></span>
  * <span data-ttu-id="ea3e4-247">威脅偵測與預防： 偵測及緩和 hello 網際網路的惡意攻擊。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-247">Threat detection and prevention: Detecting and mitigating malicious attacks from hello Internet.</span></span>
  * <span data-ttu-id="ea3e4-248">稽核和記錄：維護詳細記錄供稽核和分析。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-248">Auditing and logging: Maintaining detailed logs for auditing and analysis.</span></span>
  * <span data-ttu-id="ea3e4-249">反向 proxy： 重新導向 hello 連入要求 toohello 相對應的後端伺服器。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-249">Reverse proxy: Redirecting hello incoming requests toohello corresponding back-end servers.</span></span> <span data-ttu-id="ea3e4-250">此重新導向包含對應，以及轉譯 hello 目的地位址 hello 前端在裝置上，通常防火牆，toohello 後端伺服器位址。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-250">This redirection involves mapping and translating hello destination addresses on hello front-end devices, typically firewalls, toohello back-end server addresses.</span></span>
  * <span data-ttu-id="ea3e4-251">轉送 proxy： 提供 NAT 並執行從起始內 hello 虛擬網路 toohello 網際網路通訊的稽核。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-251">Forward proxy: Providing NAT and performing auditing for communication initiated from within hello virtual network toohello Internet.</span></span>
  * <span data-ttu-id="ea3e4-252">路由器： 轉送 hello 虛擬網路內的內送和跨子網路流量。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-252">Router: Forwarding incoming and cross-subnet traffic inside hello virtual network.</span></span>
  * <span data-ttu-id="ea3e4-253">VPN 裝置： 做為 hello 跨單位 VPN 閘道的跨單位客戶的內部網路和 Azure 虛擬網路之間的 VPN 連線。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-253">VPN device: Acting as hello cross-premises VPN gateways for cross-premises VPN connectivity between customer on-premises networks and Azure virtual networks.</span></span>
  * <span data-ttu-id="ea3e4-254">VPN 伺服器： 接受 tooAzure 虛擬網路連接的 VPN 用戶端。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-254">VPN server: Accepting VPN clients connecting tooAzure virtual networks.</span></span>

> [!TIP]
> <span data-ttu-id="ea3e4-255">將下列兩個群組個別的 hello: hello 個人授權 tooaccess hello 周邊網路安全性齒輪和 hello 誰有權為應用程式的開發、 部署或作業的系統管理員。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-255">Keep hello following two groups separate: hello individuals authorized tooaccess hello perimeter network security gear and hello individuals authorized as application development, deployment, or operations administrators.</span></span> <span data-ttu-id="ea3e4-256">將這些群組隔開可區分權責，防止單一個人略過應用程式安全性和網路安全性控制。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-256">Keeping these groups separate allows for a segregation of duties and prevents a single person from bypassing both applications security and network security controls.</span></span>
>
>

### <a name="questions-toobe-asked-when-building-network-boundaries"></a><span data-ttu-id="ea3e4-257">當建置網路界限時，要求的問題 toobe</span><span class="sxs-lookup"><span data-stu-id="ea3e4-257">Questions toobe asked when building network boundaries</span></span>
<span data-ttu-id="ea3e4-258">在本節中，除非特別說明，hello 詞彙 「 網路 」 是指 tooprivate Azure 訂用帳戶系統管理員所建立的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-258">In this section, unless specifically mentioned, hello term "networks" refers tooprivate Azure virtual networks created by a subscription administrator.</span></span> <span data-ttu-id="ea3e4-259">hello 詞彙並不會參照 toohello 基礎實體的網路在 Azure 中。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-259">hello term doesn't refer toohello underlying physical networks within Azure.</span></span>

<span data-ttu-id="ea3e4-260">此外，Azure 虛擬網路通常是使用的 tooextend 傳統內部部署網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-260">Also, Azure virtual networks are often used tooextend traditional on-premises networks.</span></span> <span data-ttu-id="ea3e4-261">它是可能 tooincorporate 站對站或 ExpressRoute 混合式網路功能與周邊網路架構的解決方案。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-261">It is possible tooincorporate either site-to-site or ExpressRoute hybrid networking solutions with perimeter network architectures.</span></span> <span data-ttu-id="ea3e4-262">此混合連結在組建網路安全性界限時，是很重要的考量。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-262">This hybrid link is an important consideration in building network security boundaries.</span></span>

<span data-ttu-id="ea3e4-263">hello 下列三種問題時重要 tooanswer 您正在建立的網路與周邊網路與多個安全性界限。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-263">hello following three questions are critical tooanswer when you're building a network with a perimeter network and multiple security boundaries.</span></span>

#### <a name="1-how-many-boundaries-are-needed"></a><span data-ttu-id="ea3e4-264">1) 需要多少界限？</span><span class="sxs-lookup"><span data-stu-id="ea3e4-264">1) How many boundaries are needed?</span></span>
<span data-ttu-id="ea3e4-265">hello 第一個決策點是在特定的案例需要多少的安全性界限 toodecide:</span><span class="sxs-lookup"><span data-stu-id="ea3e4-265">hello first decision point is toodecide how many security boundaries are needed in a given scenario:</span></span>

* <span data-ttu-id="ea3e4-266">單一界限： hello 虛擬網路與 hello 網際網路之間的 hello 前端周邊網路上的其中一個。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-266">A single boundary: One on hello front-end perimeter network, between hello virtual network and hello Internet.</span></span>
* <span data-ttu-id="ea3e4-267">兩個界限： 一個 hello hello 周邊網路，網際網路端上，另一個 hello 周邊網路子網路與 hello 後端中的子網路之間 hello Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-267">Two boundaries: One on hello Internet side of hello perimeter network, and another between hello perimeter network subnet and hello back-end subnets in hello Azure virtual networks.</span></span>
* <span data-ttu-id="ea3e4-268">三個界限： hello 網際網路端 hello 周邊網路上的一個，一個 hello 周邊網路與後端的子網路之間，hello 後端子網路與 hello 在內部部署網路之間的另一個。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-268">Three boundaries: One on hello Internet side of hello perimeter network, one between hello perimeter network and back-end subnets, and one between hello back-end subnets and hello on-premises network.</span></span>
* <span data-ttu-id="ea3e4-269">N 個界限︰可變的數字。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-269">N boundaries: A variable number.</span></span> <span data-ttu-id="ea3e4-270">根據安全性需求，沒有任何 toohello 數目限制的安全性界限，可以套用在指定的網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-270">Depending on security requirements, there is no limit toohello number of security boundaries that can be applied in a given network.</span></span>

<span data-ttu-id="ea3e4-271">hello 界限改變所需的數目和類型根據公司的風險容忍度及 hello 特定案例實作。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-271">hello number and type of boundaries needed vary based on a company’s risk tolerance and hello specific scenario being implemented.</span></span> <span data-ttu-id="ea3e4-272">這通常是組織內的多個團隊共同達成的決策，通常包括風險和合規性小組、網路和平台小組及應用程式開發小組。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-272">This decision is often made together with multiple groups within an organization, often including a risk and compliance team, a network and platform team, and an application development team.</span></span> <span data-ttu-id="ea3e4-273">了解的安全性、 hello 資料，以及正在使用的 hello 技術人員應具有說中每個實作此決策 tooensure hello 適當的安全性方針。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-273">People with knowledge of security, hello data involved, and hello technologies being used should have a say in this decision tooensure hello appropriate security stance for each implementation.</span></span>

> [!TIP]
> <span data-ttu-id="ea3e4-274">使用 hello 最小數目滿足 hello 安全性需求的特定情況下的界限。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-274">Use hello smallest number of boundaries that satisfy hello security requirements for a given situation.</span></span> <span data-ttu-id="ea3e4-275">與多個界限，操作和疑難排解可以很困難，以及一段時間 hello 管理負荷與管理 hello 界限的多個原則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-275">With more boundaries, operations and troubleshooting can be more difficult, as well as hello management overhead involved with managing hello multiple boundary policies over time.</span></span> <span data-ttu-id="ea3e4-276">不過，沒有足夠的界限會增加風險。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-276">However, insufficient boundaries increase risk.</span></span> <span data-ttu-id="ea3e4-277">尋找 hello 平衡相當重要。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-277">Finding hello balance is critical.</span></span>
>
>

<span data-ttu-id="ea3e4-278">![6]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-278">![6]</span></span>

<span data-ttu-id="ea3e4-279">hello 上圖中顯示三個安全性界限網路的高層級檢視。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-279">hello preceding figure shows a high-level view of a three security boundary network.</span></span> <span data-ttu-id="ea3e4-280">hello 界限是 hello 周邊網路與 hello 網際網路、 hello Azure 前端和後端私人子網路和 hello Azure 後端子和 hello 在內部部署公司網路之間。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-280">hello boundaries are between hello perimeter network and hello Internet, hello Azure front-end and back-end private subnets, and hello Azure back-end subnet and hello on-premises corporate network.</span></span>

#### <a name="2-where-are-hello-boundaries-located"></a><span data-ttu-id="ea3e4-281">2） hello 界限位於何處？</span><span class="sxs-lookup"><span data-stu-id="ea3e4-281">2) Where are hello boundaries located?</span></span>
<span data-ttu-id="ea3e4-282">一旦 hello 界限數目會決定，其中這些的 tooimplement hello 下一個決策點。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-282">Once hello number of boundaries are decided, where tooimplement them is hello next decision point.</span></span> <span data-ttu-id="ea3e4-283">通常有三個選項︰</span><span class="sxs-lookup"><span data-stu-id="ea3e4-283">There are generally three choices:</span></span>

* <span data-ttu-id="ea3e4-284">使用網際網路型的中繼服務 (例如，雲端 Web 應用程式防火牆，本文中不討論)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-284">Using an Internet-based intermediary service (for example, a cloud-based Web application firewall, which is not discussed in this document)</span></span>
* <span data-ttu-id="ea3e4-285">在 Azure 中使用原生功能及/或網路虛擬設備</span><span class="sxs-lookup"><span data-stu-id="ea3e4-285">Using native features and/or network virtual appliances in Azure</span></span>
* <span data-ttu-id="ea3e4-286">Hello 與內部網路上使用實體裝置</span><span class="sxs-lookup"><span data-stu-id="ea3e4-286">Using physical devices on hello on-premises network</span></span>

<span data-ttu-id="ea3e4-287">純粹 Azure 網路上，hello 選項的原生 Azure 功能 （例如，Azure 負載平衡器），或從網路虛擬裝置 hello 豐富的合作夥伴生態系統的 Azure （例如，檢查點防火牆）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-287">On purely Azure networks, hello options are native Azure features (for example, Azure Load Balancers) or network virtual appliances from hello rich partner ecosystem of Azure (for example, Check Point firewalls).</span></span>

<span data-ttu-id="ea3e4-288">如果需要 Azure 與內部部署網路之間的界限，則 hello 安全性裝置可位於任一邊的 hello 連線 （或兩側）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-288">If a boundary is needed between Azure and an on-premises network, hello security devices can reside on either side of hello connection (or both sides).</span></span> <span data-ttu-id="ea3e4-289">因此必須決定 hello 位置 tooplace 安全性設備上。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-289">Thus a decision must be made on hello location tooplace security gear.</span></span>

<span data-ttu-id="ea3e4-290">在 hello 上圖中，hello 網際網路到周邊網路 hello 前至後端界限完全包含在 Azure 中，並必須是原生的 Azure 功能或網路虛擬裝置。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-290">In hello previous figure, hello Internet-to-perimeter network and hello front-to-back-end boundaries are entirely contained within Azure, and must be either native Azure features or network virtual appliances.</span></span> <span data-ttu-id="ea3e4-291">安全性裝置 hello Azure （後端子網路） 之間的界限和 hello Azure 端上或 hello 內部端或甚至裝置兩端的組合，可能是 hello 公司網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-291">Security devices on hello boundary between Azure (back-end subnet) and hello corporate network could be either on hello Azure side or hello on-premises side, or even a combination of devices on both sides.</span></span> <span data-ttu-id="ea3e4-292">可以是重要的優點和缺點 tooeither 選項必須慎重考慮。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-292">There can be significant advantages and disadvantages tooeither option that must be seriously considered.</span></span>

<span data-ttu-id="ea3e4-293">比方說，使用現有的實體安全性設備在 hello 內部網路端必須所需之任何新的裝備 hello 優點。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-293">For example, using existing physical security gear on hello on-premises network side has hello advantage that no new gear is needed.</span></span> <span data-ttu-id="ea3e4-294">它只需要重新設定。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-294">It just needs reconfiguration.</span></span> <span data-ttu-id="ea3e4-295">然而，hello 缺點是，所有流量都必須都來自回 Azure toohello 在內部部署網路 toobe 看到 hello 安全性齒輪。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-295">hello disadvantage, however, is that all traffic must come back from Azure toohello on-premises network toobe seen by hello security gear.</span></span> <span data-ttu-id="ea3e4-296">因此 Azure-Azure 流量可能會造成顯著的延遲，和會影響應用程式效能和使用者經驗，如果它已強制回復 toohello 在內部部署網路上強制執行安全性原則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-296">Thus Azure-to-Azure traffic could incur significant latency, and affect application performance and user experience, if it was forced back toohello on-premises network for security policy enforcement.</span></span>

#### <a name="3-how-are-hello-boundaries-implemented"></a><span data-ttu-id="ea3e4-297">3） 如何實作 hello 界限？</span><span class="sxs-lookup"><span data-stu-id="ea3e4-297">3) How are hello boundaries implemented?</span></span>
<span data-ttu-id="ea3e4-298">每個安全性界限可能會有不同的功能需求 （例如，識別碼和 hello hello 周邊網路，但只有 Acl hello 周邊網路與後端子網路之間的網際網路一端上的防火牆規則）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-298">Each security boundary will likely have different capability requirements (for example, IDS and firewall rules on hello Internet side of hello perimeter network, but only ACLs between hello perimeter network and back-end subnet).</span></span> <span data-ttu-id="ea3e4-299">決定哪一種裝置 （或有多少裝置） 取決於 toouse hello 案例和安全性需求。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-299">Deciding on which device (or how many devices) toouse depends on hello scenario and security requirements.</span></span> <span data-ttu-id="ea3e4-300">Hello 下列區段，在範例 1、 2 和 3 會討論一些可用的選項。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-300">In hello following section, examples 1, 2, and 3 discuss some options that could be used.</span></span> <span data-ttu-id="ea3e4-301">檢閱 hello Azure 的原生網路功能和從 hello 合作夥伴生態系統可用在 Azure 中的 hello 裝置顯示 hello 無數選項可用 toosolve 幾乎任何案例。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-301">Reviewing hello Azure native network features and hello devices available in Azure from hello partner ecosystem shows hello myriad options available toosolve virtually any scenario.</span></span>

<span data-ttu-id="ea3e4-302">另一個重要實作決策點是如何 tooconnect hello 內部部署與 Azure 網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-302">Another key implementation decision point is how tooconnect hello on-premises network with Azure.</span></span> <span data-ttu-id="ea3e4-303">您應該使用 hello Azure 的虛擬閘道或網路的虛擬應用裝置？</span><span class="sxs-lookup"><span data-stu-id="ea3e4-303">Should you use hello Azure virtual gateway or a network virtual appliance?</span></span> <span data-ttu-id="ea3e4-304">Hello 下列區段 （範例 4、 5 和 6） 中更詳細討論這些選項。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-304">These options are discussed in greater detail in hello following section (examples 4, 5, and 6).</span></span>

<span data-ttu-id="ea3e4-305">您可能也需要 Azure 虛擬網路之間的流量。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-305">Additionally, traffic between virtual networks within Azure may be needed.</span></span> <span data-ttu-id="ea3e4-306">Hello 未來將會加入這些案例。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-306">These scenarios will be added in hello future.</span></span>

<span data-ttu-id="ea3e4-307">一旦您知道 hello 答案 toohello 上述問題，hello[快速啟動](#fast-start)> 一節可協助您識別哪些範例包括最適合特定案例。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-307">Once you know hello answers toohello previous questions, hello [Fast Start](#fast-start) section can help identify which examples are most appropriate for a given scenario.</span></span>

## <a name="examples-building-security-boundaries-with-azure-virtual-networks"></a><span data-ttu-id="ea3e4-308">範例：使用 Azure 虛擬網路組建安全性界限</span><span class="sxs-lookup"><span data-stu-id="ea3e4-308">Examples: Building security boundaries with Azure virtual networks</span></span>
### <a name="example-1-build-a-perimeter-network-toohelp-protect-applications-with-nsgs"></a><span data-ttu-id="ea3e4-309">範例 1 組建周邊網路 toohelp 保護應用程式與 Nsg</span><span class="sxs-lookup"><span data-stu-id="ea3e4-309">Example 1 Build a perimeter network toohelp protect applications with NSGs</span></span>
<span data-ttu-id="ea3e4-310">[備份 tooFast 開始](#fast-start) | [Detailed 建置此範例中的指示][Example1]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-310">[Back tooFast start](#fast-start) | [Detailed build instructions for this example][Example1]</span></span>

<span data-ttu-id="ea3e4-311">[![7]][7]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-311">[![7]][7]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="ea3e4-312">環境描述</span><span class="sxs-lookup"><span data-stu-id="ea3e4-312">Environment description</span></span>
<span data-ttu-id="ea3e4-313">在此範例中，沒有訂用帳戶包含下列資源的 hello:</span><span class="sxs-lookup"><span data-stu-id="ea3e4-313">In this example, there is a subscription that contains hello following resources:</span></span>

- <span data-ttu-id="ea3e4-314">單一資源群組</span><span class="sxs-lookup"><span data-stu-id="ea3e4-314">A single resource group</span></span>
- <span data-ttu-id="ea3e4-315">含 “FrontEnd” 和 “BackEnd” 兩個子網路的虛擬網路</span><span class="sxs-lookup"><span data-stu-id="ea3e4-315">A virtual network with two subnets: “FrontEnd” and “BackEnd”</span></span>
- <span data-ttu-id="ea3e4-316">已套用的 tooboth 子網路的網路安全性群組</span><span class="sxs-lookup"><span data-stu-id="ea3e4-316">A Network Security Group that is applied tooboth subnets</span></span>
- <span data-ttu-id="ea3e4-317">一個代表應用程式 Web 伺服器的 Windows Server (“IIS01”)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-317">A Windows server that represents an application web server (“IIS01”)</span></span>
- <span data-ttu-id="ea3e4-318">兩個代表應用程式後端伺服器的 Windows Server (“AppVM01”、“AppVM02”)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-318">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
- <span data-ttu-id="ea3e4-319">一個代表 DNS 伺服器的 Windows Server ("DNS01")</span><span class="sxs-lookup"><span data-stu-id="ea3e4-319">A Windows server that represents a DNS server (“DNS01”)</span></span>
- <span data-ttu-id="ea3e4-320">Hello 應用程式 web 伺服器相關聯的公用 IP</span><span class="sxs-lookup"><span data-stu-id="ea3e4-320">A public IP associated with hello application web server</span></span>

<span data-ttu-id="ea3e4-321">如需指令碼和 Azure 資源管理員範本，請參閱 hello[詳細組建指示][Example1]。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-321">For scripts and an Azure Resource Manager template, see hello [detailed build instructions][Example1].</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="ea3e4-322">NSG 描述</span><span class="sxs-lookup"><span data-stu-id="ea3e4-322">NSG description</span></span>
<span data-ttu-id="ea3e4-323">此範例會組建 NSG 群組，然後載入六個規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-323">In this example, an NSG group is built and then loaded with six rules.</span></span>

> [!TIP]
> <span data-ttu-id="ea3e4-324">一般而言，您應該建立特定的 「 允許 」 規則首先，後面接著 hello 一般 「 拒絕 」 規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-324">Generally speaking, you should create your specific “Allow” rules first, followed by hello more generic “Deny” rules.</span></span> <span data-ttu-id="ea3e4-325">hello 的優先順序會規定哪些規則會先評估。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-325">hello given priority dictates which rules are evaluated first.</span></span> <span data-ttu-id="ea3e4-326">一旦流量找到 tooapply tooa 特定規則，則會不評估任何進一步的規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-326">Once traffic is found tooapply tooa specific rule, no further rules are evaluated.</span></span> <span data-ttu-id="ea3e4-327">NSG 規則可以套用在 hello 輸入或輸出方向 （從 hello 觀點 hello 子網路）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-327">NSG rules can apply in either hello inbound or outbound direction (from hello perspective of hello subnet).</span></span>
>
>

<span data-ttu-id="ea3e4-328">以宣告方式，下列規則的 hello 正在建置輸入流量：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-328">Declaratively, hello following rules are being built for inbound traffic:</span></span>

1. <span data-ttu-id="ea3e4-329">允許內部 DNS 流量 (連接埠 53)。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-329">Internal DNS traffic (port 53) is allowed.</span></span>
2. <span data-ttu-id="ea3e4-330">允許從 hello 網際網路 tooany 虛擬機器的 RDP 流量 （連接埠 3389）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-330">RDP traffic (port 3389) from hello Internet tooany Virtual Machine is allowed.</span></span>
3. <span data-ttu-id="ea3e4-331">允許從 hello 網際網路 tooweb 伺服器 (IIS01) 的 HTTP 流量 （連接埠 80）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-331">HTTP traffic (port 80) from hello Internet tooweb server (IIS01) is allowed.</span></span>
4. <span data-ttu-id="ea3e4-332">允許從 IIS01 tooAppVM1 任何流量 （所有連接埠）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-332">Any traffic (all ports) from IIS01 tooAppVM1 is allowed.</span></span>
5. <span data-ttu-id="ea3e4-333">拒絕從 hello 網際網路 toohello 整個虛擬網路 （這兩個子網路） 的任何流量 （所有連接埠）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-333">Any traffic (all ports) from hello Internet toohello entire virtual network (both subnets) is denied.</span></span>
6. <span data-ttu-id="ea3e4-334">拒絕 hello 前端的子網路 toohello 後端子網路的任何流量 （所有連接埠）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-334">Any traffic (all ports) from hello front-end subnet toohello back-end subnet is denied.</span></span>

<span data-ttu-id="ea3e4-335">與這些規則繫結的 tooeach 子網路中，輸入 hello Internet toohello 網頁伺服器從 HTTP 要求是否兩者的規則 3 （允許） 及 5 （拒絕） 將會套用。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-335">With these rules bound tooeach subnet, if an HTTP request was inbound from hello Internet toohello web server, both rules 3 (allow) and 5 (deny) would apply.</span></span> <span data-ttu-id="ea3e4-336">但因規則 3 具有較高的優先順序，所以只會套用規則 3，規則 5 不起作用。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-336">But because rule 3 has a higher priority, only it would apply, and rule 5 would not come into play.</span></span> <span data-ttu-id="ea3e4-337">因此 hello HTTP 要求會允許 toohello web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-337">Thus hello HTTP request would be allowed toohello web server.</span></span> <span data-ttu-id="ea3e4-338">如果該相同流量已嘗試 tooreach hello DNS01 伺服器，規則 5 （拒絕） 是 hello 第一個 tooapply，和 hello 流量就不會允許 toopass toohello 伺服器。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-338">If that same traffic was trying tooreach hello DNS01 server, rule 5 (deny) would be hello first tooapply, and hello traffic would not be allowed toopass toohello server.</span></span> <span data-ttu-id="ea3e4-339">規則 6 （拒絕） 區塊 hello 前端子網路與對話 toohello 後端子 （除了規則 1 和 4 中允許的流量）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-339">Rule 6 (deny) blocks hello front-end subnet from talking toohello back-end subnet (except for allowed traffic in rules 1 and 4).</span></span> <span data-ttu-id="ea3e4-340">如果攻擊者危害 hello hello 前端上的 web 應用程式，此規則集可保護 hello 後端網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-340">This rule-set protects hello back-end network in case an attacker compromises hello web application on hello front end.</span></span> <span data-ttu-id="ea3e4-341">hello 攻擊者會受限於 toohello 後端 「 受保護的 「 網路存取 (只 tooresources 公開 hello AppVM01 伺服器上)。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-341">hello attacker would have limited access toohello back-end “protected” network (only tooresources exposed on hello AppVM01 server).</span></span>

<span data-ttu-id="ea3e4-342">沒有預設的輸出規則，允許出 toohello 網際網路的流量。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-342">There is a default outbound rule that allows traffic out toohello Internet.</span></span> <span data-ttu-id="ea3e4-343">在此範例中，我們會允許輸出流量，並不會修改任何輸出規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-343">For this example, we’re allowing outbound traffic and not modifying any outbound rules.</span></span> <span data-ttu-id="ea3e4-344">關閉兩個方向的流量 toolock，使用者定義路由是必要 （請參閱範例 3）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-344">toolock down traffic in both directions, user-defined routing is required (see example 3).</span></span>

#### <a name="conclusion"></a><span data-ttu-id="ea3e4-345">結論</span><span class="sxs-lookup"><span data-stu-id="ea3e4-345">Conclusion</span></span>
<span data-ttu-id="ea3e4-346">這個範例是相當簡單且直接的方式，隔離 hello 後端的輸入流量子網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-346">This example is a relatively simple and straightforward way of isolating hello back-end subnet from inbound traffic.</span></span> <span data-ttu-id="ea3e4-347">如需詳細資訊，請參閱 hello[詳細組建指示][Example1]。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-347">For more information, see hello [detailed build instructions][Example1].</span></span> <span data-ttu-id="ea3e4-348">這些指示包括：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-348">These instructions include:</span></span>

* <span data-ttu-id="ea3e4-349">如何 toobuild 此周邊網路與傳統的 PowerShell 指令碼。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-349">How toobuild this perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="ea3e4-350">如何 toobuild 此周邊網路與 Azure Resource Manager 範本。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-350">How toobuild this perimeter network with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="ea3e4-351">每個 NSG 命令的詳細描述。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-351">Detailed descriptions of each NSG command.</span></span>
* <span data-ttu-id="ea3e4-352">詳細的流量流程案例，顯示每一層允許或拒絕流量的方式。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-352">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>


### <a name="example-2-build-a-perimeter-network-toohelp-protect-applications-with-a-firewall-and-nsgs"></a><span data-ttu-id="ea3e4-353">範例 2 組建周邊網路 toohelp 保護應用程式與防火牆以及 Nsg</span><span class="sxs-lookup"><span data-stu-id="ea3e4-353">Example 2 Build a perimeter network toohelp protect applications with a firewall and NSGs</span></span>
<span data-ttu-id="ea3e4-354">[備份 tooFast 開始](#fast-start) | [Detailed 建置此範例中的指示][Example2]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-354">[Back tooFast start](#fast-start) | [Detailed build instructions for this example][Example2]</span></span>

<span data-ttu-id="ea3e4-355">[![8]][8]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-355">[![8]][8]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="ea3e4-356">環境描述</span><span class="sxs-lookup"><span data-stu-id="ea3e4-356">Environment description</span></span>
<span data-ttu-id="ea3e4-357">在此範例中，沒有訂用帳戶包含下列資源的 hello:</span><span class="sxs-lookup"><span data-stu-id="ea3e4-357">In this example, there is a subscription that contains hello following resources:</span></span>

* <span data-ttu-id="ea3e4-358">單一資源群組</span><span class="sxs-lookup"><span data-stu-id="ea3e4-358">A single resource group</span></span>
* <span data-ttu-id="ea3e4-359">含 “FrontEnd” 和 “BackEnd” 兩個子網路的虛擬網路</span><span class="sxs-lookup"><span data-stu-id="ea3e4-359">A virtual network with two subnets: “FrontEnd” and “BackEnd”</span></span>
* <span data-ttu-id="ea3e4-360">已套用的 tooboth 子網路的網路安全性群組</span><span class="sxs-lookup"><span data-stu-id="ea3e4-360">A Network Security Group that is applied tooboth subnets</span></span>
* <span data-ttu-id="ea3e4-361">網路的虛擬設備，在這個案例中為防火牆、 連接 toohello 前端子網路</span><span class="sxs-lookup"><span data-stu-id="ea3e4-361">A network virtual appliance, in this case a firewall, connected toohello front-end subnet</span></span>
* <span data-ttu-id="ea3e4-362">一個代表應用程式 Web 伺服器的 Windows Server (“IIS01”)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-362">A Windows server that represents an application web server (“IIS01”)</span></span>
* <span data-ttu-id="ea3e4-363">兩個代表應用程式後端伺服器的 Windows Server (“AppVM01”、“AppVM02”)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-363">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
* <span data-ttu-id="ea3e4-364">一個代表 DNS 伺服器的 Windows Server ("DNS01")</span><span class="sxs-lookup"><span data-stu-id="ea3e4-364">A Windows server that represents a DNS server (“DNS01”)</span></span>

<span data-ttu-id="ea3e4-365">如需指令碼和 Azure 資源管理員範本，請參閱 hello[詳細組建指示][Example2]。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-365">For scripts and an Azure Resource Manager template, see hello [detailed build instructions][Example2].</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="ea3e4-366">NSG 描述</span><span class="sxs-lookup"><span data-stu-id="ea3e4-366">NSG description</span></span>
<span data-ttu-id="ea3e4-367">此範例會組建 NSG 群組，然後載入六個規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-367">In this example, an NSG group is built and then loaded with six rules.</span></span>

> [!TIP]
> <span data-ttu-id="ea3e4-368">一般而言，您應該建立特定的 「 允許 」 規則首先，後面接著 hello 一般 「 拒絕 」 規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-368">Generally speaking, you should create your specific “Allow” rules first, followed by hello more generic “Deny” rules.</span></span> <span data-ttu-id="ea3e4-369">hello 的優先順序會規定哪些規則會先評估。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-369">hello given priority dictates which rules are evaluated first.</span></span> <span data-ttu-id="ea3e4-370">一旦流量找到 tooapply tooa 特定規則，則會不評估任何進一步的規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-370">Once traffic is found tooapply tooa specific rule, no further rules are evaluated.</span></span> <span data-ttu-id="ea3e4-371">NSG 規則可以套用在 hello 輸入或輸出方向 （從 hello 觀點 hello 子網路）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-371">NSG rules can apply in either hello inbound or outbound direction (from hello perspective of hello subnet).</span></span>
>
>

<span data-ttu-id="ea3e4-372">以宣告方式，下列規則的 hello 正在建置輸入流量：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-372">Declaratively, hello following rules are being built for inbound traffic:</span></span>

1. <span data-ttu-id="ea3e4-373">允許內部 DNS 流量 (連接埠 53)。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-373">Internal DNS traffic (port 53) is allowed.</span></span>
2. <span data-ttu-id="ea3e4-374">允許從 hello 網際網路 tooany 虛擬機器的 RDP 流量 （連接埠 3389）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-374">RDP traffic (port 3389) from hello Internet tooany Virtual Machine is allowed.</span></span>
3. <span data-ttu-id="ea3e4-375">允許任何網際網路流量 （所有連接埠） toohello 網路的虛擬設備 （防火牆）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-375">Any Internet traffic (all ports) toohello network virtual appliance (firewall) is allowed.</span></span>
4. <span data-ttu-id="ea3e4-376">允許從 IIS01 tooAppVM1 任何流量 （所有連接埠）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-376">Any traffic (all ports) from IIS01 tooAppVM1 is allowed.</span></span>
5. <span data-ttu-id="ea3e4-377">拒絕從 hello 網際網路 toohello 整個虛擬網路 （這兩個子網路） 的任何流量 （所有連接埠）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-377">Any traffic (all ports) from hello Internet toohello entire virtual network (both subnets) is denied.</span></span>
6. <span data-ttu-id="ea3e4-378">拒絕 hello 前端的子網路 toohello 後端子網路的任何流量 （所有連接埠）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-378">Any traffic (all ports) from hello front-end subnet toohello back-end subnet is denied.</span></span>

<span data-ttu-id="ea3e4-379">與這些規則繫結的 tooeach 子網路中，如果 HTTP 要求已從 hello 網際網路 toohello 防火牆，兩者的規則 3 （允許） 及 5 （拒絕） 將會套用。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-379">With these rules bound tooeach subnet, if an HTTP request was inbound from hello Internet toohello firewall, both rules 3 (allow) and 5 (deny) would apply.</span></span> <span data-ttu-id="ea3e4-380">但因規則 3 具有較高的優先順序，所以只會套用規則 3，規則 5 不起作用。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-380">But because rule 3 has a higher priority, only it would apply, and rule 5 would not come into play.</span></span> <span data-ttu-id="ea3e4-381">因此 hello HTTP 要求會允許 toohello 防火牆。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-381">Thus hello HTTP request would be allowed toohello firewall.</span></span> <span data-ttu-id="ea3e4-382">如果嘗試 tooreach hello IIS01 伺服器，該相同的流量，即使它是 hello 前端子網路上，規則 5 （拒絕） 將會套用，和 hello 流量就不會允許 toopass toohello 伺服器。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-382">If that same traffic was trying tooreach hello IIS01 server, even though it’s on hello front-end subnet, rule 5 (deny) would apply, and hello traffic would not be allowed toopass toohello server.</span></span> <span data-ttu-id="ea3e4-383">規則 6 （拒絕） 區塊 hello 前端子網路與對話 toohello 後端子 （除了規則 1 和 4 中允許的流量）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-383">Rule 6 (deny) blocks hello front-end subnet from talking toohello back-end subnet (except for allowed traffic in rules 1 and 4).</span></span> <span data-ttu-id="ea3e4-384">如果攻擊者危害 hello hello 前端上的 web 應用程式，此規則集可保護 hello 後端網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-384">This rule-set protects hello back-end network in case an attacker compromises hello web application on hello front end.</span></span> <span data-ttu-id="ea3e4-385">hello 攻擊者會受限於 toohello 後端 「 受保護的 「 網路存取 (只 tooresources 公開 hello AppVM01 伺服器上)。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-385">hello attacker would have limited access toohello back-end “protected” network (only tooresources exposed on hello AppVM01 server).</span></span>

<span data-ttu-id="ea3e4-386">沒有預設的輸出規則，允許出 toohello 網際網路的流量。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-386">There is a default outbound rule that allows traffic out toohello Internet.</span></span> <span data-ttu-id="ea3e4-387">在此範例中，我們會允許輸出流量，並不會修改任何輸出規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-387">For this example, we’re allowing outbound traffic and not modifying any outbound rules.</span></span> <span data-ttu-id="ea3e4-388">關閉兩個方向的流量 toolock，使用者定義路由是必要 （請參閱範例 3）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-388">toolock down traffic in both directions, user-defined routing is required (see example 3).</span></span>

#### <a name="firewall-rule-description"></a><span data-ttu-id="ea3e4-389">防火牆規則描述</span><span class="sxs-lookup"><span data-stu-id="ea3e4-389">Firewall rule description</span></span>
<span data-ttu-id="ea3e4-390">Hello 防火牆上應該建立轉送規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-390">On hello firewall, forwarding rules should be created.</span></span> <span data-ttu-id="ea3e4-391">由於這個範例只有路由網際網路流量中繫結 toohello 防火牆，然後 toohello web 伺服器上，只有一個轉送網路位址轉譯 (NAT)，因此也需要規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-391">Since this example only routes Internet traffic in-bound toohello firewall and then toohello web server, only one forwarding network address translation (NAT) rule is needed.</span></span>

<span data-ttu-id="ea3e4-392">hello 轉送規則會接受任何輸入的來源位址，叫用 hello 防火牆嘗試 tooreach HTTP （連接埠 80 或 443 用於 HTTPS）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-392">hello forwarding rule accepts any inbound source address that hits hello firewall trying tooreach HTTP (port 80 or 443 for HTTPS).</span></span> <span data-ttu-id="ea3e4-393">它送出 hello 防火牆的本機介面並重新導向 toohello web 伺服器上的使用 hello 10.0.1.5 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-393">It's sent out of hello firewall’s local interface and redirected toohello web server with hello IP Address of 10.0.1.5.</span></span>

#### <a name="conclusion"></a><span data-ttu-id="ea3e4-394">結論</span><span class="sxs-lookup"><span data-stu-id="ea3e4-394">Conclusion</span></span>
<span data-ttu-id="ea3e4-395">這個範例是相當簡單的方式保護您的應用程式的防火牆與隔離 hello 後端的輸入流量子網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-395">This example is a relatively straightforward way of protecting your application with a firewall and isolating hello back-end subnet from inbound traffic.</span></span> <span data-ttu-id="ea3e4-396">如需詳細資訊，請參閱 hello[詳細組建指示][Example2]。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-396">For more information, see hello [detailed build instructions][Example2].</span></span> <span data-ttu-id="ea3e4-397">這些指示包括：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-397">These instructions include:</span></span>

* <span data-ttu-id="ea3e4-398">如何 toobuild 此周邊網路與傳統的 PowerShell 指令碼。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-398">How toobuild this perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="ea3e4-399">如何 toobuild 此範例使用 Azure Resource Manager 範本。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-399">How toobuild this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="ea3e4-400">每個 NSG 命令和防火牆規則的詳細描述。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-400">Detailed descriptions of each NSG command and firewall rule.</span></span>
* <span data-ttu-id="ea3e4-401">詳細的流量流程案例，顯示每一層允許或拒絕流量的方式。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-401">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>

### <a name="example-3-build-a-perimeter-network-toohelp-protect-networks-with-a-firewall-and-udr-and-nsg"></a><span data-ttu-id="ea3e4-402">範例 3 建置周邊網路 toohelp 保護網路與防火牆、 UDR 和 NSG</span><span class="sxs-lookup"><span data-stu-id="ea3e4-402">Example 3 Build a perimeter network toohelp protect networks with a firewall and UDR and NSG</span></span>
<span data-ttu-id="ea3e4-403">[備份 tooFast 開始](#fast-start) | [Detailed 建置此範例中的指示][Example3]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-403">[Back tooFast start](#fast-start) | [Detailed build instructions for this example][Example3]</span></span>

<span data-ttu-id="ea3e4-404">[![9]][9]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-404">[![9]][9]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="ea3e4-405">環境描述</span><span class="sxs-lookup"><span data-stu-id="ea3e4-405">Environment description</span></span>
<span data-ttu-id="ea3e4-406">在此範例中，沒有訂用帳戶包含下列資源的 hello:</span><span class="sxs-lookup"><span data-stu-id="ea3e4-406">In this example, there is a subscription that contains hello following resources:</span></span>

* <span data-ttu-id="ea3e4-407">單一資源群組</span><span class="sxs-lookup"><span data-stu-id="ea3e4-407">A single resource group</span></span>
* <span data-ttu-id="ea3e4-408">一個虛擬網路，包含三個子網路：“SecNet”、“FrontEnd”、“BackEnd”</span><span class="sxs-lookup"><span data-stu-id="ea3e4-408">A virtual network with three subnets: “SecNet”, “FrontEnd”, and “BackEnd”</span></span>
* <span data-ttu-id="ea3e4-409">網路的虛擬設備，在這個案例中為防火牆、 連接 toohello SecNet 子網路</span><span class="sxs-lookup"><span data-stu-id="ea3e4-409">A network virtual appliance, in this case a firewall, connected toohello SecNet subnet</span></span>
* <span data-ttu-id="ea3e4-410">一個代表應用程式 Web 伺服器的 Windows Server (“IIS01”)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-410">A Windows server that represents an application web server (“IIS01”)</span></span>
* <span data-ttu-id="ea3e4-411">兩個代表應用程式後端伺服器的 Windows Server (“AppVM01”、“AppVM02”)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-411">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
* <span data-ttu-id="ea3e4-412">一個代表 DNS 伺服器的 Windows Server ("DNS01")</span><span class="sxs-lookup"><span data-stu-id="ea3e4-412">A Windows server that represents a DNS server (“DNS01”)</span></span>

<span data-ttu-id="ea3e4-413">如需指令碼和 Azure 資源管理員範本，請參閱 hello[詳細組建指示][Example3]。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-413">For scripts and an Azure Resource Manager template, see hello [detailed build instructions][Example3].</span></span>

#### <a name="udr-description"></a><span data-ttu-id="ea3e4-414">UDR 描述</span><span class="sxs-lookup"><span data-stu-id="ea3e4-414">UDR description</span></span>
<span data-ttu-id="ea3e4-415">根據預設，下列系統路由 hello 的定義如下：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-415">By default, hello following system routes are defined as:</span></span>

        Effective routes :
         Address Prefix    Next hop type    Next hop IP address Status   Source     
         --------------    -------------    ------------------- ------   ------     
         {10.0.0.0/16}     VNETLocal                            Active   Default    
         {0.0.0.0/0}       Internet                             Active   Default    
         {10.0.0.0/8}      Null                                 Active   Default    
         {100.64.0.0/10}   Null                                 Active   Default    
         {172.16.0.0/12}   Null                                 Active   Default    
         {192.168.0.0/16}  Null                                 Active   Default

<span data-ttu-id="ea3e4-416">hello VNETLocal 永遠是構成該特定網路的 hello 虛擬網路的一或多個定義的位址首碼 （也就是說，它會變更虛擬網路 toovirtual 網路之外，根據每個特定的虛擬網路的定義方式）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-416">hello VNETLocal is always one or more defined address prefixes that make up hello virtual network for that specific network (that is, it changes from virtual network toovirtual network, depending on how each specific virtual network is defined).</span></span> <span data-ttu-id="ea3e4-417">hello 剩餘的系統路由是靜態的而且預設 hello 資料表中所示。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-417">hello remaining system routes are static and default as indicated in hello table.</span></span>

<span data-ttu-id="ea3e4-418">在此範例中，兩個路由會建立資料表，各一個 hello 前端和後端子網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-418">In this example, two routing tables are created, one each for hello front-end and back-end subnets.</span></span> <span data-ttu-id="ea3e4-419">每個資料表會載入適當的 hello 指定子網路的靜態路由。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-419">Each table is loaded with static routes appropriate for hello given subnet.</span></span> <span data-ttu-id="ea3e4-420">在此範例中，每一個資料表具有三個路由 (0.0.0.0/0) 的所有流量都導向透過 hello 防火牆 (下個躍點 = 虛擬應用裝置的 IP 位址):</span><span class="sxs-lookup"><span data-stu-id="ea3e4-420">In this example, each table has three routes that direct all traffic (0.0.0.0/0) through hello firewall (Next hop = Virtual Appliance IP address):</span></span>

1. <span data-ttu-id="ea3e4-421">本機子網路流量沒有下一個躍點定義 tooallow 本機子網路流量 toobypass hello 防火牆。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-421">Local subnet traffic with no Next Hop defined tooallow local subnet traffic toobypass hello firewall.</span></span>
2. <span data-ttu-id="ea3e4-422">下一個躍點定義為防火牆的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-422">Virtual network traffic with a Next Hop defined as firewall.</span></span> <span data-ttu-id="ea3e4-423">這個下一個躍點會覆寫，可讓本機虛擬網路流量 tooroute 直接 hello 預設規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-423">This next hop overrides hello default rule that allows local virtual network traffic tooroute directly.</span></span>
3. <span data-ttu-id="ea3e4-424">所有其他流量 (0/0)，與下個躍點定義為 hello 防火牆。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-424">All remaining traffic (0/0) with a Next Hop defined as hello firewall.</span></span>

> [!TIP]
> <span data-ttu-id="ea3e4-425">Hello UDR 符號本機子網路的通訊沒有 hello 本機子網路項目。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-425">Not having hello local subnet entry in hello UDR breaks local subnet communications.</span></span>
>
> * <span data-ttu-id="ea3e4-426">在本例中，指向 tooVNETLocal 10.0.1.0/24 相當重要 ！</span><span class="sxs-lookup"><span data-stu-id="ea3e4-426">In our example, 10.0.1.0/24 pointing tooVNETLocal is critical!</span></span> <span data-ttu-id="ea3e4-427">未安裝，離開 hello 目的地 Web 伺服器 (10.0.1.4) tooanother 本機伺服器 （例如） 10.0.1.25 封包都會失敗，因為它們會傳送 toohello NVA。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-427">Without it, packet leaving hello Web Server (10.0.1.4) destined tooanother local server (for example) 10.0.1.25 will fail as they will be sent toohello NVA.</span></span> <span data-ttu-id="ea3e4-428">hello NVA 會將它傳送 toohello 子網路，並 hello 子網路將會重新傳送 toohello NVA 無限迴圈。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-428">hello NVA will send it toohello subnet, and hello subnet will resend it toohello NVA in an infinite loop.</span></span>
> * <span data-ttu-id="ea3e4-429">路由迴圈的 hello 機會是通常具有連線的 tooseparate 子網路子網路，這通常是傳統的內部部署裝置的多個 Nic 的設備上更高版本。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-429">hello chances of a routing loop are typically higher on appliances with multiple NICs that are connected tooseparate subnets, which is often of traditional, on-premises appliances.</span></span>
>
>

<span data-ttu-id="ea3e4-430">一旦建立 hello 路由表，它們必須是繫結的 tootheir 子網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-430">Once hello routing tables are created, they must be bound tootheir subnets.</span></span> <span data-ttu-id="ea3e4-431">hello 前端的子網路路由表，一旦建立和繫結 toohello 子網路，此輸出會如下：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-431">hello front-end subnet routing table, once created and bound toohello subnet, would look like this output:</span></span>

        Effective routes :
         Address Prefix    Next hop type    Next hop IP address Status   Source     
         --------------    -------------    ------------------- ------   ------     
         {10.0.1.0/24}     VNETLocal                            Active
         {10.0.0.0/16}     VirtualAppliance 10.0.0.4            Active    
         {0.0.0.0/0}       VirtualAppliance 10.0.0.4            Active

> [!NOTE]
> <span data-ttu-id="ea3e4-432">UDR 現在可以套用的 toohello 閘道子網路連接的 hello ExpressRoute 電路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-432">UDR can now be applied toohello gateway subnet on which hello ExpressRoute circuit is connected.</span></span>
>
> <span data-ttu-id="ea3e4-433">範例 3 和 4 中顯示的方式 tooenable 您周邊網路與 ExpressRoute 或站對站網路功能的範例。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-433">Examples of how tooenable your perimeter network with ExpressRoute or site-to-site networking are shown in examples 3 and 4.</span></span>
>
>

#### <a name="ip-forwarding-description"></a><span data-ttu-id="ea3e4-434">IP 轉送描述</span><span class="sxs-lookup"><span data-stu-id="ea3e4-434">IP Forwarding description</span></span>
<span data-ttu-id="ea3e4-435">IP 轉送 」 是附屬功能 tooUDR。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-435">IP Forwarding is a companion feature tooUDR.</span></span> <span data-ttu-id="ea3e4-436">IP 轉送 」 是設定為，允許它 tooreceive 未特別定址流量 toohello 應用裝置，並將該流量 tooits 最終目的端的虛擬應用裝置上。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-436">IP Forwarding is a setting on a virtual appliance that allows it tooreceive traffic not specifically addressed toohello appliance, and then forward that traffic tooits ultimate destination.</span></span>

<span data-ttu-id="ea3e4-437">例如，如果 AppVM01 使得要求 toohello DNS01 伺服器，UDR 會路由傳送此流量 toohello 防火牆。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-437">For example, if AppVM01 makes a request toohello DNS01 server, UDR would route this traffic toohello firewall.</span></span> <span data-ttu-id="ea3e4-438">IP 轉送已啟用，hello DNS01 目的地 (10.0.2.4) 的 hello 流量是接受 hello 應用裝置 (10.0.0.4) 與轉送 tooits 最終目的端 (10.0.2.4)。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-438">With IP Forwarding enabled, hello traffic for hello DNS01 destination (10.0.2.4) is accepted by hello appliance (10.0.0.4) and then forwarded tooits ultimate destination (10.0.2.4).</span></span> <span data-ttu-id="ea3e4-439">不含 IP 轉送 hello 防火牆上啟用，流量就不會接受 hello 應用裝置即使 hello 路由表有 hello 防火牆為 hello 下一個躍點。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-439">Without IP Forwarding enabled on hello firewall, traffic would not be accepted by hello appliance even though hello route table has hello firewall as hello next hop.</span></span> <span data-ttu-id="ea3e4-440">toouse 虛擬應用裝置，它是關鍵 tooremember tooenable IP 轉送以及 UDR。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-440">toouse a virtual appliance, it’s critical tooremember tooenable IP Forwarding along with UDR.</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="ea3e4-441">NSG 描述</span><span class="sxs-lookup"><span data-stu-id="ea3e4-441">NSG description</span></span>
<span data-ttu-id="ea3e4-442">本例會組建 NSG 群組，然後在其中載入單一規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-442">In this example, an NSG group is built and then loaded with a single rule.</span></span> <span data-ttu-id="ea3e4-443">此群組，就只有 toohello 前端和後端的子網路 (不 hello SecNet) 繫結。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-443">This group is then bound only toohello front-end and back-end subnets (not hello SecNet).</span></span> <span data-ttu-id="ea3e4-444">以宣告方式建立 hello 下列規則：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-444">Declaratively hello following rule is being built:</span></span>

* <span data-ttu-id="ea3e4-445">拒絕從 hello 網際網路 toohello 整個虛擬網路 （所有的子網路） 的任何流量 （所有連接埠）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-445">Any traffic (all ports) from hello Internet toohello entire virtual network (all subnets) is denied.</span></span>

<span data-ttu-id="ea3e4-446">雖然本例中使用 NSG，但它的主要目的是作為防止人為設定錯誤的第二道防線。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-446">Although NSGs are used in this example, its main purpose is as a secondary layer of defense against manual misconfiguration.</span></span> <span data-ttu-id="ea3e4-447">hello 的目標是 tooblock 從所有傳入的流量 hello 網際網路 tooeither hello 前端或後端的子網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-447">hello goal is tooblock all inbound traffic from hello Internet tooeither hello front-end or back-end subnets.</span></span> <span data-ttu-id="ea3e4-448">應該只有流量通過 hello SecNet 子網路 toohello 防火牆 (然後視情況 toohello 前端或後端子網路上)。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-448">Traffic should only flow through hello SecNet subnet toohello firewall (and then, if appropriate, on toohello front-end or back-end subnets).</span></span> <span data-ttu-id="ea3e4-449">此外，以 hello UDR 規則的地方，任何未將它轉換 hello 前端或後端的子網路的流量會被導向出 toohello 防火牆 (感謝您 tooUDR)。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-449">Plus, with hello UDR rules in place, any traffic that did make it into hello front-end or back-end subnets would be directed out toohello firewall (thanks tooUDR).</span></span> <span data-ttu-id="ea3e4-450">hello 防火牆非對稱式資料流將會看到這個流量，而且將會降低 hello 輸出流量。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-450">hello firewall would see this traffic as an asymmetric flow and would drop hello outbound traffic.</span></span> <span data-ttu-id="ea3e4-451">因此有三個層級的保護 hello 子網路的安全性：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-451">Thus there are three layers of security protecting hello subnets:</span></span>

* <span data-ttu-id="ea3e4-452">任何前端或後端 NIC 上沒有公用 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-452">No Public IP addresses on any FrontEnd or BackEnd NICs.</span></span>
* <span data-ttu-id="ea3e4-453">Nsg 拒絕 hello 網際網路流量。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-453">NSGs denying traffic from hello Internet.</span></span>
* <span data-ttu-id="ea3e4-454">hello 防火牆卸除對稱流量。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-454">hello firewall dropping asymmetric traffic.</span></span>

<span data-ttu-id="ea3e4-455">在此範例中的 hello NSG 相關一個有趣的一點是它包含一個規則，也就是 toodeny 網際網路流量 toohello 整個虛擬網路，包括 hello 安全性子網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-455">One interesting point regarding hello NSG in this example is that it contains only one rule, which is toodeny Internet traffic toohello entire virtual network, including hello Security subnet.</span></span> <span data-ttu-id="ea3e4-456">不過，由於 hello NSG 僅繫結 toohello 前端和後端子網路，hello 規則才會處理流量的輸入 toohello 安全性子網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-456">However, since hello NSG is only bound toohello front-end and back-end subnets, hello rule isn’t processed on traffic inbound toohello Security subnet.</span></span> <span data-ttu-id="ea3e4-457">如此一來，流量流 toohello 安全性子網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-457">As a result, traffic flows toohello Security subnet.</span></span>

#### <a name="firewall-rules"></a><span data-ttu-id="ea3e4-458">防火牆規則</span><span class="sxs-lookup"><span data-stu-id="ea3e4-458">Firewall rules</span></span>
<span data-ttu-id="ea3e4-459">Hello 防火牆上應該建立轉送規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-459">On hello firewall, forwarding rules should be created.</span></span> <span data-ttu-id="ea3e4-460">由於 hello 防火牆封鎖或轉送所有輸入、 輸出和內部虛擬網路流量，都需要多個防火牆規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-460">Since hello firewall is blocking or forwarding all inbound, outbound, and intra-virtual network traffic, many firewall rules are needed.</span></span> <span data-ttu-id="ea3e4-461">此外，所有傳入的流量達到 hello 安全性服務公用 IP 位址 （在不同的連接埠），toobe 處理 hello 防火牆。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-461">Also, all inbound traffic hits hello Security Service public IP address (on different ports), toobe processed by hello firewall.</span></span> <span data-ttu-id="ea3e4-462">最佳做法是設定 hello 子網路之前，先 toodiagram hello 邏輯流程和防火牆規則，tooavoid 稍後重新設定。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-462">A best practice is toodiagram hello logical flows before setting up hello subnets and firewall rules, tooavoid rework later.</span></span> <span data-ttu-id="ea3e4-463">hello 圖是此範例中的 hello 防火牆規則的邏輯檢視：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-463">hello following figure is a logical view of hello firewall rules for this example:</span></span>

<span data-ttu-id="ea3e4-464">![10]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-464">![10]</span></span>

> [!NOTE]
> <span data-ttu-id="ea3e4-465">根據網路虛擬應用裝置中使用的 hello，hello 管理連接埠會有不同。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-465">Based on hello Network Virtual Appliance used, hello management ports vary.</span></span> <span data-ttu-id="ea3e4-466">在此範例中，所參考的 Barracuda NextGen 防火牆使用連接埠 22、801 和 807。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-466">In this example, a Barracuda NextGen Firewall is referenced, which uses ports 22, 801, and 807.</span></span> <span data-ttu-id="ea3e4-467">請參閱 hello 應用裝置廠商文件 toofind hello 確切使用連接埠正在使用的 hello 裝置的管理。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-467">Consult hello appliance vendor documentation toofind hello exact ports used for management of hello device being used.</span></span>
>
>

#### <a name="firewall-rules-description"></a><span data-ttu-id="ea3e4-468">防火牆規則描述</span><span class="sxs-lookup"><span data-stu-id="ea3e4-468">Firewall rules description</span></span>
<span data-ttu-id="ea3e4-469">在 hello 前面邏輯圖表，因為 hello 防火牆 hello 該子網路上唯一的資源，不會顯示 hello 安全性子網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-469">In hello preceding logical diagram, hello security subnet is not shown because hello firewall is hello only resource on that subnet.</span></span> <span data-ttu-id="ea3e4-470">hello 圖表會顯示 hello 防火牆規則，以及如何在邏輯上允許或拒絕流量，不 hello 實際路由路徑。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-470">hello diagram is showing hello firewall rules and how they logically allow or deny traffic flows, not hello actual routed path.</span></span> <span data-ttu-id="ea3e4-471">此外，hello 外部連接埠為 hello RDP 流量會更高範圍的連接埠 (8014 – 8026) 和已選取的 tooloosely 對齊 hello 與選取的最後一個 hello 本機 IP 位址更容易閱讀的兩個八位元 （例如，本機伺服器位址 10.0.1.4 是相關聯與外部連接埠 8014）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-471">Also, hello external ports selected for hello RDP traffic are higher ranged ports (8014 – 8026) and were selected tooloosely align with hello last two octets of hello local IP address for easier readability (for example, local server address 10.0.1.4 is associated with external port 8014).</span></span> <span data-ttu-id="ea3e4-472">不過您可以使用任何更高範圍的連接埠，只要連接埠未衝突即可。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-472">Any higher non-conflicting ports, however, could be used.</span></span>

<span data-ttu-id="ea3e4-473">本例中，我們需要七種類型的規則︰</span><span class="sxs-lookup"><span data-stu-id="ea3e4-473">For this example, we need seven types of rules:</span></span>

* <span data-ttu-id="ea3e4-474">外部規則 (適用於輸入流量)：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-474">External rules (for inbound traffic):</span></span>
  1. <span data-ttu-id="ea3e4-475">防火牆管理規則： 此應用程式重新導向規則允許流量 toopass toohello 管理連接埠的 hello 網路的虛擬設備。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-475">Firewall management rule: This App Redirect rule allows traffic toopass toohello management ports of hello network virtual appliance.</span></span>
  2. <span data-ttu-id="ea3e4-476">RDP 規則 （適用於每個 Windows 伺服器）： 這些四項規則 （每個伺服器一個） 允許的 hello 管理個別的伺服器，透過 RDP。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-476">RDP rules (for each Windows server): These four rules (one for each server) allow management of hello individual servers via RDP.</span></span> <span data-ttu-id="ea3e4-477">hello 四個 RDP 規則無法也摺疊成一個規則，視 hello 的 hello 網路虛擬設備所使用的功能而定。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-477">hello four RDP rules could also be collapsed into one rule, depending on hello capabilities of hello network virtual appliance being used.</span></span>
  3. <span data-ttu-id="ea3e4-478">應用程式流量規則： 有兩個的這些規則，先針對 hello 前端的 web 流量，hello 和 hello hello 後端流量 （例如，web 伺服器 toodata 層） 的第二個。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-478">Application traffic rules: There are two of these rules, hello first for hello front-end web traffic, and hello second for hello back-end traffic (for example, web server toodata tier).</span></span> <span data-ttu-id="ea3e4-479">這些規則的 hello 組態取決於 hello （您的伺服器放置的位置） 的網路架構及流量 （流動的方向 hello 流量，及使用哪些連接埠）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-479">hello configuration of these rules depends on hello network architecture (where your servers are placed) and traffic flows (which direction hello traffic flows, and which ports are used).</span></span>
     * <span data-ttu-id="ea3e4-480">hello 第一個規則可讓 hello 實際的應用程式流量 tooreach hello 應用程式伺服器。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-480">hello first rule allows hello actual application traffic tooreach hello application server.</span></span> <span data-ttu-id="ea3e4-481">Hello 其他規則允許的安全性與管理，而應用程式流量規則是允許外部使用者或服務 tooaccess hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-481">While hello other rules allow for security and management, application traffic rules are what allow external users or services tooaccess hello applications.</span></span> <span data-ttu-id="ea3e4-482">本例中，連接埠 80 上有單一 Web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-482">For this example, there is a single web server on port 80.</span></span> <span data-ttu-id="ea3e4-483">因此單一防火牆應用程式規則重新導向輸入的流量 toohello 外部 IP，toohello web 伺服器的內部 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-483">Thus a single firewall application rule redirects inbound traffic toohello external IP, toohello web servers internal IP address.</span></span> <span data-ttu-id="ea3e4-484">透過 NAT toohello 內部伺服器，會轉譯 hello 重新導向流量的工作階段。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-484">hello redirected traffic session would be translated via NAT toohello internal server.</span></span>
     * <span data-ttu-id="ea3e4-485">hello 第二個規則是 hello 後端規則 tooallow hello web 伺服器 tootalk toohello AppVM01 伺服器 （但不是 AppVM02） 透過任何連接埠。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-485">hello second rule is hello back-end rule tooallow hello web server tootalk toohello AppVM01 server (but not AppVM02) via any port.</span></span>
* <span data-ttu-id="ea3e4-486">內部規則 (適用於內部虛擬網路流量)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-486">Internal rules (for intra-virtual network traffic)</span></span>
  1. <span data-ttu-id="ea3e4-487">輸出 tooInternet 規則： 這個規則允許來自任何網路流量 toopass toohello 選取網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-487">Outbound tooInternet rule: This rule allows traffic from any network toopass toohello selected networks.</span></span> <span data-ttu-id="ea3e4-488">此規則通常是預設的規則已經 hello 在防火牆上，但是已停用狀態。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-488">This rule is usually a default rule already on hello firewall, but in a disabled state.</span></span> <span data-ttu-id="ea3e4-489">在此範例中，應啟用此規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-489">This rule should be enabled for this example.</span></span>
  2. <span data-ttu-id="ea3e4-490">DNS 規則： 這個規則允許只有 DNS （連接埠 53） 流量 toopass toohello DNS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-490">DNS rule: This rule allows only DNS (port 53) traffic toopass toohello DNS server.</span></span> <span data-ttu-id="ea3e4-491">如果此環境中，會封鎖大部分的流量從 hello 前端 toohello 後端。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-491">For this environment, most traffic from hello front end toohello back end is blocked.</span></span> <span data-ttu-id="ea3e4-492">這個規則特別允許來自任何本機子網路的 DNS。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-492">This rule specifically allows DNS from any local subnet.</span></span>
  3. <span data-ttu-id="ea3e4-493">子網路 toosubnet 規則： 這項規則是 tooallow hello 後端子 tooconnect tooany 伺服器 hello 前端子網路 （但不是 hello 反向） 上的任何伺服器。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-493">Subnet toosubnet rule: This rule is tooallow any server on hello back-end subnet tooconnect tooany server on hello front-end subnet (but not hello reverse).</span></span>
* <span data-ttu-id="ea3e4-494">（適用於不符合任何先前的 hello 的流量） 的保全規則：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-494">Fail-safe rule (for traffic that doesn’t meet any of hello previous):</span></span>
  1. <span data-ttu-id="ea3e4-495">拒絕所有流量的規則： 此都拒絕規則應該一律 hello 最終規則 （依據優先順序） 且因此如果流量失敗時 toomatch hello 上述規則不會捨棄此規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-495">Deny all traffic rule: This deny rule should always be hello final rule (in terms of priority), and as such if a traffic flow fails toomatch any of hello preceding rules it is dropped by this rule.</span></span> <span data-ttu-id="ea3e4-496">這是預設規則，通常為現成啟用狀態。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-496">This rule is a default rule and usually in-place and active.</span></span> <span data-ttu-id="ea3e4-497">任何修改，不就需要通常 toothis 規則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-497">No modifications are usually needed toothis rule.</span></span>

> [!TIP]
> <span data-ttu-id="ea3e4-498">Hello 上第二個應用程式流量的規則，toosimplify 此範例中，任何連接埠不允許。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-498">On hello second application traffic rule, toosimplify this example, any port is allowed.</span></span> <span data-ttu-id="ea3e4-499">在實際案例中，hello 最特定的連接埠和位址範圍應該是此規則使用的 tooreduce hello 受攻擊面。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-499">In a real scenario, hello most specific port and address ranges should be used tooreduce hello attack surface of this rule.</span></span>
>
>

<span data-ttu-id="ea3e4-500">一旦建立 hello 一個規則，請務必允許或拒絕所需的每個規則 tooensure 流量 tooreview hello 優先順序。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-500">Once hello previous rules are created, it’s important tooreview hello priority of each rule tooensure traffic is allowed or denied as desired.</span></span> <span data-ttu-id="ea3e4-501">例如，hello 規則是依優先順序。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-501">For this example, hello rules are in priority order.</span></span>

#### <a name="conclusion"></a><span data-ttu-id="ea3e4-502">結論</span><span class="sxs-lookup"><span data-stu-id="ea3e4-502">Conclusion</span></span>
<span data-ttu-id="ea3e4-503">這個範例是更複雜，但完成種保護及隔離 hello 網路比 hello 前面的範例。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-503">This example is a more complex but complete way of protecting and isolating hello network than hello previous examples.</span></span> <span data-ttu-id="ea3e4-504">（範例 2 會保護只 hello 應用程式，而範例 1 只會隔離子網路）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-504">(Example 2 protects just hello application, and Example 1 just isolates subnets).</span></span> <span data-ttu-id="ea3e4-505">這項設計可以讓監視這兩個方向的流量和保護不只是 hello 輸入應用程式伺服器，但此網路上的所有伺服器的網路安全性原則會強制執行。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-505">This design allows for monitoring traffic in both directions, and protects not just hello inbound application server but enforces network security policy for all servers on this network.</span></span> <span data-ttu-id="ea3e4-506">此外，hello 應用裝置中使用，根據稽核完整的流量和感知即可達成。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-506">Also, depending on hello appliance used, full traffic auditing and awareness can be achieved.</span></span> <span data-ttu-id="ea3e4-507">如需詳細資訊，請參閱 hello[詳細組建指示][Example3]。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-507">For more information, see hello [detailed build instructions][Example3].</span></span> <span data-ttu-id="ea3e4-508">這些指示包括：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-508">These instructions include:</span></span>

* <span data-ttu-id="ea3e4-509">如何 toobuild 此範例周邊網路與傳統的 PowerShell 指令碼。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-509">How toobuild this example perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="ea3e4-510">如何 toobuild 此範例使用 Azure Resource Manager 範本。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-510">How toobuild this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="ea3e4-511">每個 UDR、NSG 命令和防火牆規則的詳細描述。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-511">Detailed descriptions of each UDR, NSG command, and firewall rule.</span></span>
* <span data-ttu-id="ea3e4-512">詳細的流量流程案例，顯示每一層允許或拒絕流量的方式。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-512">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>

### <a name="example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn"></a><span data-ttu-id="ea3e4-513">範例 4 新增使用站對站虛擬設備 VPN 的混合式連接</span><span class="sxs-lookup"><span data-stu-id="ea3e4-513">Example 4 Add a hybrid connection with a site-to-site, virtual appliance VPN</span></span>
<span data-ttu-id="ea3e4-514">[備份 tooFast 開始](#fast-start)|推出詳述可用的組建指令</span><span class="sxs-lookup"><span data-stu-id="ea3e4-514">[Back tooFast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="ea3e4-515">[![11]][11]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-515">[![11]][11]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="ea3e4-516">環境描述</span><span class="sxs-lookup"><span data-stu-id="ea3e4-516">Environment description</span></span>
<span data-ttu-id="ea3e4-517">混合式網路使用網路虛擬應用裝置 (NVA) 可以加入 tooany hello 範例 1、 2 或 3 中所述的周邊網路類型。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-517">Hybrid networking using a network virtual appliance (NVA) can be added tooany of hello perimeter network types described in examples 1, 2, or 3.</span></span>

<span data-ttu-id="ea3e4-518">Hello 上圖所示，透過 VPN 連線 hello 網際網路 （站對站） 是使用的 tooconnect 在內部部署網路 tooan NVA 透過 Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-518">As shown in hello previous figure, a VPN connection over hello Internet (site-to-site) is used tooconnect an on-premises network tooan Azure virtual network via an NVA.</span></span>

> [!NOTE]
> <span data-ttu-id="ea3e4-519">如果您使用 ExpressRoute 啟用的 hello Azure 公用對等互連選項時，就應該建立靜態路由。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-519">If you use ExpressRoute with hello Azure Public Peering option enabled, a static route should be created.</span></span> <span data-ttu-id="ea3e4-520">這個靜態路由應該路由 toohello NVA VPN IP 位址，您公司的網際網路且不會透過 hello ExpressRoute 連線。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-520">This static route should route toohello NVA VPN IP address out your corporate Internet and not via hello ExpressRoute connection.</span></span> <span data-ttu-id="ea3e4-521">hello NAT 需要 hello ExpressRoute Azure 公用對等體的選項可能會破壞 hello VPN 工作階段。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-521">hello NAT required on hello ExpressRoute Azure Public Peering option can break hello VPN session.</span></span>
>
>

<span data-ttu-id="ea3e4-522">一旦 hello VPN 已經就定位，hello NVA 會變成 hello 集中所有的網路和子網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-522">Once hello VPN is in place, hello NVA becomes hello central hub for all networks and subnets.</span></span> <span data-ttu-id="ea3e4-523">hello 防火牆轉寄規則會決定允許流量，哪些流量都會透過 NAT 轉譯、 重新導向，或會卸除 （即使 hello 與內部網路與 Azure 之間的流量）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-523">hello firewall forwarding rules determine which traffic flows are allowed, are translated via NAT, are redirected, or are dropped (even for traffic flows between hello on-premises network and Azure).</span></span>

<span data-ttu-id="ea3e4-524">流量應該要謹慎，因為它們可以最佳化，或降低設計模式中，根據 hello 特定使用案例。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-524">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on hello specific use case.</span></span>

<span data-ttu-id="ea3e4-525">使用內建的範例 3，hello 環境，然後再新增 站對站 VPN 混合式網路連線，會產生下列設計 hello:</span><span class="sxs-lookup"><span data-stu-id="ea3e4-525">Using hello environment built in example 3, and then adding a site-to-site VPN hybrid network connection, produces hello following design:</span></span>

<span data-ttu-id="ea3e4-526">[![12]][12]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-526">[![12]][12]</span></span>

<span data-ttu-id="ea3e4-527">hello 在內部部署路由器或與您的 VPN、 NVA 相容的任何其他網路裝置是 hello VPN 用戶端。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-527">hello on-premises router, or any other network device that is compatible with your NVA for VPN, would be hello VPN client.</span></span> <span data-ttu-id="ea3e4-528">此實體的裝置會負責起始和維護您 NVA hello VPN 連線。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-528">This physical device would be responsible for initiating and maintaining hello VPN connection with your NVA.</span></span>

<span data-ttu-id="ea3e4-529">以邏輯方式 toohello NVA，hello 網路看起來像 4 個不同 hello 規則的 「 安全性區域 」 hello NVA 必須 hello 主要主管這些區域之間的流量：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-529">Logically toohello NVA, hello network looks like four separate “security zones” with hello rules on hello NVA being hello primary director of traffic between these zones:</span></span>

<span data-ttu-id="ea3e4-530">![13]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-530">![13]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="ea3e4-531">結論</span><span class="sxs-lookup"><span data-stu-id="ea3e4-531">Conclusion</span></span>
<span data-ttu-id="ea3e4-532">hello 加入站對站 VPN 混合式網路連接 tooan Azure 虛擬網路可以 hello 在內部部署網路擴充至 Azure 以安全的方式。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-532">hello addition of a site-to-site VPN hybrid network connection tooan Azure virtual network can extend hello on-premises network into Azure in a secure manner.</span></span> <span data-ttu-id="ea3e4-533">您的流量會加密，並將路由中使用 VPN 連線，透過網際網路 hello。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-533">In using a VPN connection, your traffic is encrypted and routes via hello Internet.</span></span> <span data-ttu-id="ea3e4-534">在此範例中的 hello NVA 提供中央位置 tooenforce，並管理 hello 安全性原則。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-534">hello NVA in this example provides a central location tooenforce and manage hello security policy.</span></span> <span data-ttu-id="ea3e4-535">如需詳細資訊，請參閱詳細的 hello 建置 （推出） 的指示。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-535">For more information, see hello detailed build instructions (forthcoming).</span></span> <span data-ttu-id="ea3e4-536">這些指示包括：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-536">These instructions include:</span></span>

* <span data-ttu-id="ea3e4-537">如何 toobuild 此範例周邊網路的 PowerShell 指令碼。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-537">How toobuild this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="ea3e4-538">如何 toobuild 此範例使用 Azure Resource Manager 範本。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-538">How toobuild this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="ea3e4-539">顯示此設計中流量如何流通的詳細流量流程案例。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-539">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

### <a name="example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway"></a><span data-ttu-id="ea3e4-540">範例 5 新增使用站對站 Azure VPN 閘道的混合式連接</span><span class="sxs-lookup"><span data-stu-id="ea3e4-540">Example 5 Add a hybrid connection with a site-to-site, Azure VPN gateway</span></span>
<span data-ttu-id="ea3e4-541">[備份 tooFast 開始](#fast-start)|推出詳述可用的組建指令</span><span class="sxs-lookup"><span data-stu-id="ea3e4-541">[Back tooFast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="ea3e4-542">[![14]][14]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-542">[![14]][14]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="ea3e4-543">環境描述</span><span class="sxs-lookup"><span data-stu-id="ea3e4-543">Environment description</span></span>
<span data-ttu-id="ea3e4-544">使用 Azure VPN 閘道的混合式網路可以加入 tooeither 周邊網路類型 1 或 2 的範例中所述。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-544">Hybrid networking using an Azure VPN gateway can be added tooeither perimeter network type described in examples 1 or 2.</span></span>

<span data-ttu-id="ea3e4-545">Hello 前圖所示，透過 VPN 連線 hello 網際網路 （站對站） 是使用的 tooconnect 在內部部署網路 tooan 透過 Azure VPN 閘道的 Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-545">As shown in hello preceding figure, a VPN connection over hello Internet (site-to-site) is used tooconnect an on-premises network tooan Azure virtual network via an Azure VPN gateway.</span></span>

> [!NOTE]
> <span data-ttu-id="ea3e4-546">如果您使用 ExpressRoute 啟用的 hello Azure 公用對等互連選項時，就應該建立靜態路由。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-546">If you use ExpressRoute with hello Azure Public Peering option enabled, a static route should be created.</span></span> <span data-ttu-id="ea3e4-547">這個靜態路由應該路由 toohello 您公司的網際網路且不會透過 ExpressRoute WAN hello NVA VPN IP 位址。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-547">This  static route should route toohello NVA VPN IP address out your corporate Internet and not via hello ExpressRoute WAN.</span></span> <span data-ttu-id="ea3e4-548">hello NAT 需要 hello ExpressRoute Azure 公用對等體的選項可能會破壞 hello VPN 工作階段。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-548">hello NAT required on hello ExpressRoute Azure Public Peering option can break hello VPN session.</span></span>
>
>

<span data-ttu-id="ea3e4-549">hello 下圖顯示 hello 兩個網路邊緣在此範例中。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-549">hello following figure shows hello two network edges in this example.</span></span> <span data-ttu-id="ea3e4-550">在第一個邊緣 hello，hello NVA 和 Nsg 控制內部 Azure 網路和 Azure 之間的流量並 hello 網際網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-550">On hello first edge, hello NVA and NSGs control traffic flows for intra-Azure networks and between Azure and hello Internet.</span></span> <span data-ttu-id="ea3e4-551">hello 第二個邊緣是 hello Azure VPN 閘道，這是在內部部署與 Azure 之間不同的隔離網路邊緣。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-551">hello second edge is hello Azure VPN gateway, which is a separate and isolated network edge between on-premises and Azure.</span></span>

<span data-ttu-id="ea3e4-552">流量應該要謹慎，因為它們可以最佳化，或降低設計模式中，根據 hello 特定使用案例。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-552">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on hello specific use case.</span></span>

<span data-ttu-id="ea3e4-553">使用範例 1，內建的 hello 環境，然後再新增 站對站 VPN 混合式網路連線，會產生下列設計 hello:</span><span class="sxs-lookup"><span data-stu-id="ea3e4-553">Using hello environment built in example 1, and then adding a site-to-site VPN hybrid network connection, produces hello following design:</span></span>

<span data-ttu-id="ea3e4-554">[![15]][15]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-554">[![15]][15]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="ea3e4-555">結論</span><span class="sxs-lookup"><span data-stu-id="ea3e4-555">Conclusion</span></span>
<span data-ttu-id="ea3e4-556">hello 加入站對站 VPN 混合式網路連接 tooan Azure 虛擬網路可以 hello 在內部部署網路擴充至 Azure 以安全的方式。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-556">hello addition of a site-to-site VPN hybrid network connection tooan Azure virtual network can extend hello on-premises network into Azure in a secure manner.</span></span> <span data-ttu-id="ea3e4-557">使用 hello 原生 Azure VPN 閘道，您的流量是 IPSec 加密，並透過 hello 網際網路路由傳送。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-557">Using hello native Azure VPN gateway, your traffic is IPSec encrypted and routes via hello Internet.</span></span> <span data-ttu-id="ea3e4-558">此外，使用 hello Azure VPN 閘道，可以提供 （沒有其他授權成本與第三方 NVAs） 的成本較低的選項。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-558">Also, using hello Azure VPN gateway can provide a lower-cost option (no additional licensing cost as with third-party NVAs).</span></span> <span data-ttu-id="ea3e4-559">這個選項是範例 1 最經濟實惠的地方，因為不使用任何 NVA。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-559">This option is most economical in example 1, where no NVA is used.</span></span> <span data-ttu-id="ea3e4-560">如需詳細資訊，請參閱詳細的 hello 建置 （推出） 的指示。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-560">For more information, see hello detailed build instructions (forthcoming).</span></span> <span data-ttu-id="ea3e4-561">這些指示包括：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-561">These instructions include:</span></span>

* <span data-ttu-id="ea3e4-562">如何 toobuild 此範例周邊網路的 PowerShell 指令碼。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-562">How toobuild this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="ea3e4-563">如何 toobuild 此範例使用 Azure Resource Manager 範本。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-563">How toobuild this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="ea3e4-564">顯示此設計中流量如何流通的詳細流量流程案例。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-564">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

### <a name="example-6-add-a-hybrid-connection-with-expressroute"></a><span data-ttu-id="ea3e4-565">範例 6：新增使用 ExpressRoute 的混合式連接</span><span class="sxs-lookup"><span data-stu-id="ea3e4-565">Example 6 Add a hybrid connection with ExpressRoute</span></span>
<span data-ttu-id="ea3e4-566">[備份 tooFast 開始](#fast-start)|推出詳述可用的組建指令</span><span class="sxs-lookup"><span data-stu-id="ea3e4-566">[Back tooFast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="ea3e4-567">[![16]][16]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-567">[![16]][16]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="ea3e4-568">環境描述</span><span class="sxs-lookup"><span data-stu-id="ea3e4-568">Environment description</span></span>
<span data-ttu-id="ea3e4-569">混合式網路，使用的 ExpressRoute 私用對等連接，可以加入 tooeither 周邊網路類型 1 或 2 的範例中所述。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-569">Hybrid networking using an ExpressRoute private peering connection can be added tooeither perimeter network type described in examples 1 or 2.</span></span>

<span data-ttu-id="ea3e4-570">Hello 前圖所示，ExpressRoute 私人互連提供您的內部部署網路與 hello Azure 虛擬網路之間的直接連線。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-570">As shown in hello preceding figure, ExpressRoute private peering provides a direct connection between your on-premises network and hello Azure virtual network.</span></span> <span data-ttu-id="ea3e4-571">流量代表只有 hello 服務提供者網路和 hello Microsoft Azure 網路，永遠不會觸及 hello 網際網路。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-571">Traffic transits only hello service provider network and hello Microsoft Azure network, never touching hello Internet.</span></span>

> [!TIP]
> <span data-ttu-id="ea3e4-572">使用 ExpressRoute 關閉 hello 網際網路保持公司的網路流量。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-572">Using ExpressRoute keeps corporate network traffic off hello Internet.</span></span> <span data-ttu-id="ea3e4-573">也能符合 ExpressRoute 提供者的服務等級協定。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-573">It also allows for service level agreements from your ExpressRoute provider.</span></span> <span data-ttu-id="ea3e4-574">而透過站對站 Vpn，hello Azure 閘道最大輸送量是 200 Mbps too10 Gbps 透過 ExpressRoute，可以傳送 hello Azure 閘道。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-574">hello Azure Gateway can pass up too10 Gbps with ExpressRoute, whereas with site-to-site VPNs, hello Azure Gateway maximum throughput is 200 Mbps.</span></span>
>
>

<span data-ttu-id="ea3e4-575">Hello 下列圖表所示，使用此選項 hello 環境現在有兩個網路邊緣。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-575">As seen in hello following diagram, with this option hello environment now has two network edges.</span></span> <span data-ttu-id="ea3e4-576">hello NVA 以及 NSG 控制流量的內部 Azure 網路之間以及 Azure 與 hello 網際網路與內部部署與 Azure 之間的不同的隔離網路邊緣 hello 閘道時。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-576">hello NVA and NSG control traffic flows for intra-Azure networks and between Azure and hello Internet, while hello gateway is a separate and isolated network edge between on-premises and Azure.</span></span>

<span data-ttu-id="ea3e4-577">流量應該要謹慎，因為它們可以最佳化，或降低設計模式中，根據 hello 特定使用案例。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-577">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on hello specific use case.</span></span>

<span data-ttu-id="ea3e4-578">使用範例 1，內建的 hello 環境，然後再新增 ExpressRoute 混合式網路連線，會產生下列設計 hello:</span><span class="sxs-lookup"><span data-stu-id="ea3e4-578">Using hello environment built in example 1, and then adding an ExpressRoute hybrid network connection, produces hello following design:</span></span>

<span data-ttu-id="ea3e4-579">[![17]][17]</span><span class="sxs-lookup"><span data-stu-id="ea3e4-579">[![17]][17]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="ea3e4-580">結論</span><span class="sxs-lookup"><span data-stu-id="ea3e4-580">Conclusion</span></span>
<span data-ttu-id="ea3e4-581">ExpressRoute 私用對等互連網路連線的 hello 加法可以 hello 在內部部署網路擴充至 Azure 中的安全、 低延遲、 更高版本執行的方式。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-581">hello addition of an ExpressRoute Private Peering network connection can extend hello on-premises network into Azure in a secure, lower latency, higher performing manner.</span></span> <span data-ttu-id="ea3e4-582">此外，使用 hello 原生 Azure 閘道，就如同此範例中，提供成本較低的選項 （沒有其他授權與第三方 NVAs 一樣）。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-582">Also, using hello native Azure Gateway, as in this example, provides a lower-cost option (no additional licensing as with third-party NVAs).</span></span> <span data-ttu-id="ea3e4-583">如需詳細資訊，請參閱詳細的 hello 建置 （推出） 的指示。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-583">For more information, see hello detailed build instructions (forthcoming).</span></span> <span data-ttu-id="ea3e4-584">這些指示包括：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-584">These instructions include:</span></span>

* <span data-ttu-id="ea3e4-585">如何 toobuild 此範例周邊網路的 PowerShell 指令碼。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-585">How toobuild this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="ea3e4-586">如何 toobuild 此範例使用 Azure Resource Manager 範本。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-586">How toobuild this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="ea3e4-587">顯示此設計中流量如何流通的詳細流量流程案例。</span><span class="sxs-lookup"><span data-stu-id="ea3e4-587">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

## <a name="references"></a><span data-ttu-id="ea3e4-588">參考</span><span class="sxs-lookup"><span data-stu-id="ea3e4-588">References</span></span>
### <a name="helpful-websites-and-documentation"></a><span data-ttu-id="ea3e4-589">實用的網站和文件</span><span class="sxs-lookup"><span data-stu-id="ea3e4-589">Helpful websites and documentation</span></span>
* <span data-ttu-id="ea3e4-590">使用 Azure Resource Manager 存取 Azure：</span><span class="sxs-lookup"><span data-stu-id="ea3e4-590">Access Azure with Azure Resource Manager:</span></span>
* <span data-ttu-id="ea3e4-591">使用 PowerShell 存取 Azure：[https://docs.microsoft.com/powershell/azureps-cmdlets-docs/](/powershell/azure/overview)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-591">Accessing Azure with PowerShell: [https://docs.microsoft.com/powershell/azureps-cmdlets-docs/](/powershell/azure/overview)</span></span>
* <span data-ttu-id="ea3e4-592">虛擬網路文件：[https://docs.microsoft.com/azure/virtual-network/](https://docs.microsoft.com/azure/virtual-network/)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-592">Virtual networking documentation: [https://docs.microsoft.com/azure/virtual-network/](https://docs.microsoft.com/azure/virtual-network/)</span></span>
* <span data-ttu-id="ea3e4-593">網路安全性群組文件：[https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg](virtual-network/virtual-networks-nsg.md)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-593">Network security group documentation: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg](virtual-network/virtual-networks-nsg.md)</span></span>
* <span data-ttu-id="ea3e4-594">使用者定義路由文件：[https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview](virtual-network/virtual-networks-udr-overview.md)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-594">User-defined routing documentation: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview](virtual-network/virtual-networks-udr-overview.md)</span></span>
* <span data-ttu-id="ea3e4-595">Azure 虛擬閘道器︰[https://docs.microsoft.com/azure/vpn-gateway/](https://docs.microsoft.com/azure/vpn-gateway/)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-595">Azure virtual gateways: [https://docs.microsoft.com/azure/vpn-gateway/](https://docs.microsoft.com/azure/vpn-gateway/)</span></span>
* <span data-ttu-id="ea3e4-596">站對站 VPN：[https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell](vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-596">Site-to-Site VPNs: [https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell](vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md)</span></span>
* <span data-ttu-id="ea3e4-597">（是確定 toocheck 出 hello 「 入門 」 和 「 如何 」 區段） 的 ExpressRoute 文件： [https://docs.microsoft.com/azure/expressroute/](https://docs.microsoft.com/azure/expressroute/)</span><span class="sxs-lookup"><span data-stu-id="ea3e4-597">ExpressRoute documentation (be sure toocheck out hello “Getting Started” and “How To” sections): [https://docs.microsoft.com/azure/expressroute/](https://docs.microsoft.com/azure/expressroute/)</span></span>

<!--Image References-->
[0]: ./media/best-practices-network-security/flowchart.png "安全性選項流程圖"
[2]: ./media/best-practices-network-security/azuresecurityfeatures.png "Azure Security Features"
[3]: ./media/best-practices-network-security/dmzcorporate.png "A DMZ in a Corporate network"
[4]: ./media/best-practices-network-security/azuresecurityarchitecture.png "Azure Security Architecture"
[5]: ./media/best-practices-network-security/dmzazure.png "A DMZ in an Azure Virtual Network"
[6]: ./media/best-practices-network-security/dmzhybrid.png "Hybrid Network with Three Security Boundaries"
[7]: ./media/best-practices-network-security/example1design.png "具有 NSG 的輸入 DMZ"
[8]: ./media/best-practices-network-security/example2design.png "具有 NVA 和 NSG 的輸入 DMZ"
[9]: ./media/best-practices-network-security/example3design.png "具有 NVA、NSG 和 UDR 的雙向 DMZ"
[10]: ./media/best-practices-network-security/example3firewalllogical.png "hello 防火牆規則的邏輯檢視"
[11]: ./media/best-practices-network-security/example3designoptions.png "連接 NVA 的 DMZ 混合式網路"
[12]: ./media/best-practices-network-security/example4designs2s.png "使用站對站 VPN 連接 NVA 的 DMZ"
[13]: ./media/best-practices-network-security/example4networklogical.png "Logical Network from NVA Perspective"
[14]: ./media/best-practices-network-security/example5designoptions.png "連接 Azure 閘道的 DMZ 站對站混合式網路"
[15]: ./media/best-practices-network-security/example5designs2s.png "使用站對站 VPN 連接 Azure 閘道的 DMZ"
[16]: ./media/best-practices-network-security/example6designoptions.png "連接 Azure 閘道的 DMZ ExpressRoute 混合式網路"
[17]: ./media/best-practices-network-security/example6designexpressroute.png "使用 ExpressRoute 連線連接 Azure 閘道的 DMZ"

<!--Link References-->
[TrustCenter]: https://azure.microsoft.com/support/trust-center/compliance/
[Example1]: ./virtual-network/virtual-networks-dmz-nsg.md
[Example2]: ./virtual-network/virtual-networks-dmz-nsg-fw-asm.md
[Example3]: ./virtual-network/virtual-networks-dmz-nsg-fw-udr-asm.md
[Example4]: ./virtual-network/virtual-networks-hybrid-s2s-nva-asm.md
[Example5]: ./virtual-network/virtual-networks-hybrid-s2s-agw-asm.md
[Example6]: ./virtual-network/virtual-networks-hybrid-expressroute-asm.md
[Example7]: ./virtual-network/virtual-networks-vnet2vnet-direct-asm.md
[Example8]: ./virtual-network/virtual-networks-vnet2vnet-transit-asm.md
