---
title: "aaaUse 需要大量計算的 Azure Vm 與批次 |Microsoft 文件"
description: "具備 RDMA 功能，或按一下 啟用 GPU 的 VM tootake 利用 Azure Batch 集區中的調整大小"
services: batch
documentationcenter: 
author: dlepow
manager: timlt
editor: 
ms.assetid: 
ms.service: batch
ms.workload: big-compute
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/27/2017
ms.author: danlep
ms.openlocfilehash: 6a462a5f2a44ddcec8bf4e5c200d444cac8fafe6
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="use-rdma-capable-or-gpu-enabled-instances-in-batch-pools"></a><span data-ttu-id="91dc5-103">在 Batch 集區中使用具備 RDMA 功能或已啟用 GPU 功能的執行個體</span><span class="sxs-lookup"><span data-stu-id="91dc5-103">Use RDMA-capable or GPU-enabled instances in Batch pools</span></span>

<span data-ttu-id="91dc5-104">toorun 特定批次作業，您可能會想針對大規模的計算的 Azure VM 大小的 tootake 優點。</span><span class="sxs-lookup"><span data-stu-id="91dc5-104">toorun certain Batch jobs, you might want tootake advantage of Azure VM sizes designed for large-scale computation.</span></span> <span data-ttu-id="91dc5-105">例如，toorun 多重執行個體[MPI 工作負載](batch-mpi.md)、 您可以選擇 A8、 A9、 或 H 序列的大小會有網路介面的遠端直接記憶體存取 (RDMA)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-105">For example, toorun multi-instance [MPI workloads](batch-mpi.md), you can choose A8, A9, or H-series sizes that have a network interface for Remote Direct Memory Access (RDMA).</span></span> <span data-ttu-id="91dc5-106">這些大小連接 tooan InfiniBand 網路節點間的通訊，可加速 MPI 應用程式。</span><span class="sxs-lookup"><span data-stu-id="91dc5-106">These sizes connect tooan InfiniBand network for inter-node communication, which can accelerate MPI applications.</span></span> <span data-ttu-id="91dc5-107">如果是 CUDA 應用程式，則可以選擇 N 系列大小，因為這些大小包含 NVIDIA Tesla 圖形處理器 (GPU) 顯示卡。</span><span class="sxs-lookup"><span data-stu-id="91dc5-107">Or for CUDA applications, you can choose N-series sizes that include NVIDIA Tesla graphics processing unit (GPU) cards.</span></span>

<span data-ttu-id="91dc5-108">本文提供指引和範例 toouse 一些 Azure 的特定大小，請在批次集區。</span><span class="sxs-lookup"><span data-stu-id="91dc5-108">This article provides guidance and examples toouse some of Azure's specialized sizes in Batch pools.</span></span> <span data-ttu-id="91dc5-109">若要了解規格及背景，請參閱：</span><span class="sxs-lookup"><span data-stu-id="91dc5-109">For specs and background, see:</span></span>

* <span data-ttu-id="91dc5-110">高效能計算 VM 大小 ([Linux](../virtual-machines/linux/sizes-hpc.md)、[Windows](../virtual-machines/windows/sizes-hpc.md))</span><span class="sxs-lookup"><span data-stu-id="91dc5-110">High performance compute VM sizes ([Linux](../virtual-machines/linux/sizes-hpc.md), [Windows](../virtual-machines/windows/sizes-hpc.md))</span></span> 

* <span data-ttu-id="91dc5-111">已啟用 GPU 功能的 VM 大小 ([Linux](../virtual-machines/linux/sizes-gpu.md)、[Windows](../virtual-machines/windows/sizes-gpu.md))</span><span class="sxs-lookup"><span data-stu-id="91dc5-111">GPU-enabled VM sizes ([Linux](../virtual-machines/linux/sizes-gpu.md), [Windows](../virtual-machines/windows/sizes-gpu.md))</span></span> 


## <a name="subscription-and-account-limits"></a><span data-ttu-id="91dc5-112">訂用帳戶與帳戶限制</span><span class="sxs-lookup"><span data-stu-id="91dc5-112">Subscription and account limits</span></span>

* <span data-ttu-id="91dc5-113">**配額**-hello 數目或類型，可能會限制一個或多個 Azure 配額的節點中，您可以加入 tooa 批次集區。</span><span class="sxs-lookup"><span data-stu-id="91dc5-113">**Quotas** - One or more Azure quotas may limit hello number or type of nodes you can add tooa Batch pool.</span></span> <span data-ttu-id="91dc5-114">您會更有可能 toobe 限制，當您選擇具備 RDMA 功能，啟用 GPU 或其他多核心的 VM 大小。</span><span class="sxs-lookup"><span data-stu-id="91dc5-114">You are more likely toobe limited when you choose RDMA-capable, GPU-enabled, or other multicore VM sizes.</span></span> <span data-ttu-id="91dc5-115">根據您所建立的批次帳戶 hello 類型，toohello 帳戶本身或 tooyour 訂用帳戶，無法套用 hello 配額。</span><span class="sxs-lookup"><span data-stu-id="91dc5-115">Depending on hello type of Batch account you created, hello quotas could apply toohello account itself or tooyour subscription.</span></span>

    * <span data-ttu-id="91dc5-116">如果您建立您的 Batch 帳戶在 hello**批次服務**組態都受到 hello[每個批次帳戶的專用的核心配額](batch-quota-limit.md#resource-quotas)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-116">If you created your Batch account in hello **Batch service** configuration, you are limited by hello [dedicated cores quota per Batch account](batch-quota-limit.md#resource-quotas).</span></span> <span data-ttu-id="91dc5-117">根據預設，這個配額為 20 個核心。</span><span class="sxs-lookup"><span data-stu-id="91dc5-117">By default, this quota is 20 cores.</span></span> <span data-ttu-id="91dc5-118">個別配額套用太[低優先權 Vm](batch-low-pri-vms.md)，如果您使用它們。</span><span class="sxs-lookup"><span data-stu-id="91dc5-118">A separate quota applies too[low-priority VMs](batch-low-pri-vms.md), if you use them.</span></span> 

    * <span data-ttu-id="91dc5-119">如果您建立 hello 帳戶在 hello**使用者訂用帳戶**組態，您的訂用帳戶限制每個區域的 VM 核心的 hello 數目。</span><span class="sxs-lookup"><span data-stu-id="91dc5-119">If you created hello account in hello **User subscription** configuration, your subscription limits hello number of VM cores per region.</span></span> <span data-ttu-id="91dc5-120">請參閱 [Azure 訂用帳戶和服務限制、配額與限制](../azure-subscription-service-limits.md)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-120">See [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md).</span></span> <span data-ttu-id="91dc5-121">您的訂用帳戶也會套用地區配額 toocertain VM 大小，包括 HPC 和 GPU 的執行個體。</span><span class="sxs-lookup"><span data-stu-id="91dc5-121">Your subscription also applies a regional quota toocertain VM sizes, including HPC and GPU instances.</span></span> <span data-ttu-id="91dc5-122">在 hello 使用者訂用帳戶設定中，沒有其他配額套用 toohello Batch 帳戶。</span><span class="sxs-lookup"><span data-stu-id="91dc5-122">In hello user subscription configuration, no additional quotas apply toohello Batch account.</span></span> 

  <span data-ttu-id="91dc5-123">在批次中使用特製化的 VM 大小時您可能需要指定 tooincrease 一或多個配額。</span><span class="sxs-lookup"><span data-stu-id="91dc5-123">You might need tooincrease one or more quotas when using a specialized VM size in Batch.</span></span> <span data-ttu-id="91dc5-124">toorequest 增加配額，開啟[線上客戶支援要求](../azure-supportability/how-to-create-azure-support-request.md)不收費。</span><span class="sxs-lookup"><span data-stu-id="91dc5-124">toorequest a quota increase, open an [online customer support request](../azure-supportability/how-to-create-azure-support-request.md) at no charge.</span></span>

* <span data-ttu-id="91dc5-125">**區域可用性**-需要大量計算 Vm 可能無法使用您用來建立批次帳戶的 hello 區域中。</span><span class="sxs-lookup"><span data-stu-id="91dc5-125">**Region availability** - Compute-intensive VMs might not be available in hello regions where you create your Batch accounts.</span></span> <span data-ttu-id="91dc5-126">toocheck 的大小是可用，請參閱[依地區可用的產品](https://azure.microsoft.com/regions/services/)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-126">toocheck that a size is available, see [Products available by region](https://azure.microsoft.com/regions/services/).</span></span>


## <a name="dependencies"></a><span data-ttu-id="91dc5-127">相依項目</span><span class="sxs-lookup"><span data-stu-id="91dc5-127">Dependencies</span></span>

<span data-ttu-id="91dc5-128">只能在某些作業系統支援 hello RDMA 和 GPU 功能需要大量計算的大小。</span><span class="sxs-lookup"><span data-stu-id="91dc5-128">hello RDMA and GPU capabilities of compute-intensive sizes are supported only in certain operating systems.</span></span> <span data-ttu-id="91dc5-129">根據您的作業系統，您可能需要 tooinstall，或設定額外的驅動程式或其他軟體。</span><span class="sxs-lookup"><span data-stu-id="91dc5-129">Depending on your operating system, you might need tooinstall or configure additional driver or other software.</span></span> <span data-ttu-id="91dc5-130">hello 下表摘要說明這些相依性。</span><span class="sxs-lookup"><span data-stu-id="91dc5-130">hello following tables summarize these dependencies.</span></span> <span data-ttu-id="91dc5-131">如需詳細資訊，請參閱連結的文章。</span><span class="sxs-lookup"><span data-stu-id="91dc5-131">See linked articles for details.</span></span> <span data-ttu-id="91dc5-132">選項 tooconfigure 批次集區，請參閱本文稍後。</span><span class="sxs-lookup"><span data-stu-id="91dc5-132">For options tooconfigure Batch pools, see later in this article.</span></span>


### <a name="linux-pools---virtual-machine-configuration"></a><span data-ttu-id="91dc5-133">Linux 集區 - 虛擬機器組態</span><span class="sxs-lookup"><span data-stu-id="91dc5-133">Linux pools - Virtual machine configuration</span></span>

| <span data-ttu-id="91dc5-134">大小</span><span class="sxs-lookup"><span data-stu-id="91dc5-134">Size</span></span> | <span data-ttu-id="91dc5-135">功能</span><span class="sxs-lookup"><span data-stu-id="91dc5-135">Capability</span></span> | <span data-ttu-id="91dc5-136">作業系統</span><span class="sxs-lookup"><span data-stu-id="91dc5-136">Operating systems</span></span> | <span data-ttu-id="91dc5-137">必要的軟體</span><span class="sxs-lookup"><span data-stu-id="91dc5-137">Required software</span></span> | <span data-ttu-id="91dc5-138">集區設定</span><span class="sxs-lookup"><span data-stu-id="91dc5-138">Pool settings</span></span> |
| -------- | -------- | ----- |  -------- | ----- |
| [<span data-ttu-id="91dc5-139">H16r、H16mr、A8、A9</span><span class="sxs-lookup"><span data-stu-id="91dc5-139">H16r, H16mr, A8, A9</span></span>](../virtual-machines/linux/sizes-hpc.md#rdma-capable-instances) | <span data-ttu-id="91dc5-140">RDMA</span><span class="sxs-lookup"><span data-stu-id="91dc5-140">RDMA</span></span> | <span data-ttu-id="91dc5-141">SUSE Linux Enterprise Server 12 HPC 或</span><span class="sxs-lookup"><span data-stu-id="91dc5-141">SUSE Linux Enterprise Server 12 HPC or</span></span><br/><span data-ttu-id="91dc5-142">CentOS 型 HPC</span><span class="sxs-lookup"><span data-stu-id="91dc5-142">CentOS-based HPC</span></span><br/><span data-ttu-id="91dc5-143">(Azure Marketplace)</span><span class="sxs-lookup"><span data-stu-id="91dc5-143">(Azure Marketplace)</span></span> | <span data-ttu-id="91dc5-144">Intel MPI 5</span><span class="sxs-lookup"><span data-stu-id="91dc5-144">Intel MPI 5</span></span> | <span data-ttu-id="91dc5-145">啟用節點間通訊、停用並行工作執行</span><span class="sxs-lookup"><span data-stu-id="91dc5-145">Enable inter-node communication, disable concurrent task execution</span></span> |
| [<span data-ttu-id="91dc5-146">NC 系列*</span><span class="sxs-lookup"><span data-stu-id="91dc5-146">NC series*</span></span>](../virtual-machines/linux/n-series-driver-setup.md#install-cuda-drivers-for-nc-vms) | <span data-ttu-id="91dc5-147">NVIDIA Tesla K80 GPU</span><span class="sxs-lookup"><span data-stu-id="91dc5-147">NVIDIA Tesla K80 GPU</span></span> | <span data-ttu-id="91dc5-148">Ubuntu 16.04 LTS。</span><span class="sxs-lookup"><span data-stu-id="91dc5-148">Ubuntu 16.04 LTS.</span></span><br/><span data-ttu-id="91dc5-149">Red Hat Enterprise Linux 7.3，或</span><span class="sxs-lookup"><span data-stu-id="91dc5-149">Red Hat Enterprise Linux 7.3, or</span></span><br/><span data-ttu-id="91dc5-150">CentOS 型 7.3</span><span class="sxs-lookup"><span data-stu-id="91dc5-150">CentOS-based 7.3</span></span><br/><span data-ttu-id="91dc5-151">(Azure Marketplace)</span><span class="sxs-lookup"><span data-stu-id="91dc5-151">(Azure Marketplace)</span></span> | <span data-ttu-id="91dc5-152">NVIDIA CUDA Toolkit 8.0 驅動程式</span><span class="sxs-lookup"><span data-stu-id="91dc5-152">NVIDIA CUDA Toolkit 8.0 drivers</span></span> | <span data-ttu-id="91dc5-153">N/A</span><span class="sxs-lookup"><span data-stu-id="91dc5-153">N/A</span></span> | 
| [<span data-ttu-id="91dc5-154">NV 系列</span><span class="sxs-lookup"><span data-stu-id="91dc5-154">NV series</span></span>](../virtual-machines/linux/n-series-driver-setup.md#install-grid-drivers-for-nv-vms) | <span data-ttu-id="91dc5-155">NVIDIA Tesla M60 GPU</span><span class="sxs-lookup"><span data-stu-id="91dc5-155">NVIDIA Tesla M60 GPU</span></span> | <span data-ttu-id="91dc5-156">Ubuntu 16.04 LTS</span><span class="sxs-lookup"><span data-stu-id="91dc5-156">Ubuntu 16.04 LTS</span></span><br/><span data-ttu-id="91dc5-157">Red Hat Enterprise Linux 7.3</span><span class="sxs-lookup"><span data-stu-id="91dc5-157">Red Hat Enterprise Linux 7.3</span></span><br/><span data-ttu-id="91dc5-158">CentOS 型 7.3</span><span class="sxs-lookup"><span data-stu-id="91dc5-158">CentOS-based 7.3</span></span><br/><span data-ttu-id="91dc5-159">(Azure Marketplace)</span><span class="sxs-lookup"><span data-stu-id="91dc5-159">(Azure Marketplace)</span></span> | <span data-ttu-id="91dc5-160">NVIDIA GRID 4.3 驅動程式</span><span class="sxs-lookup"><span data-stu-id="91dc5-160">NVIDIA GRID 4.3 drivers</span></span> | <span data-ttu-id="91dc5-161">N/A</span><span class="sxs-lookup"><span data-stu-id="91dc5-161">N/A</span></span> |

<span data-ttu-id="91dc5-162">*具有 Intel MPI 的 CentOS 型 7.3 HPC 可支援在 NC24r VM 上進行 RDMA 連線。</span><span class="sxs-lookup"><span data-stu-id="91dc5-162">*RDMA connectivity on NC24r VMs is supported on CentOS-based 7.3 HPC with Intel MPI.</span></span>



### <a name="windows-pools---virtual-machine-configuration"></a><span data-ttu-id="91dc5-163">Windows 集區 - 虛擬機器組態</span><span class="sxs-lookup"><span data-stu-id="91dc5-163">Windows pools - Virtual machine configuration</span></span>

| <span data-ttu-id="91dc5-164">大小</span><span class="sxs-lookup"><span data-stu-id="91dc5-164">Size</span></span> | <span data-ttu-id="91dc5-165">功能</span><span class="sxs-lookup"><span data-stu-id="91dc5-165">Capability</span></span> | <span data-ttu-id="91dc5-166">作業系統</span><span class="sxs-lookup"><span data-stu-id="91dc5-166">Operating systems</span></span> | <span data-ttu-id="91dc5-167">必要的軟體</span><span class="sxs-lookup"><span data-stu-id="91dc5-167">Required software</span></span> | <span data-ttu-id="91dc5-168">集區設定</span><span class="sxs-lookup"><span data-stu-id="91dc5-168">Pool settings</span></span> |
| -------- | ------ | -------- | -------- | ----- |
| [<span data-ttu-id="91dc5-169">H16r、H16mr、A8、A9</span><span class="sxs-lookup"><span data-stu-id="91dc5-169">H16r, H16mr, A8, A9</span></span>](../virtual-machines/windows/sizes-hpc.md#rdma-capable-instances) | <span data-ttu-id="91dc5-170">RDMA</span><span class="sxs-lookup"><span data-stu-id="91dc5-170">RDMA</span></span> | <span data-ttu-id="91dc5-171">Windows Server 2012 R2 或</span><span class="sxs-lookup"><span data-stu-id="91dc5-171">Windows Server 2012 R2 or</span></span><br/><span data-ttu-id="91dc5-172">Windows Server 2012 (Azure Marketplace)</span><span class="sxs-lookup"><span data-stu-id="91dc5-172">Windows Server 2012 (Azure Marketplace)</span></span> | <span data-ttu-id="91dc5-173">Microsoft MPI 2012 R2 或更新版本，或</span><span class="sxs-lookup"><span data-stu-id="91dc5-173">Microsoft MPI 2012 R2 or later, or</span></span><br/> <span data-ttu-id="91dc5-174">Intel MPI 5</span><span class="sxs-lookup"><span data-stu-id="91dc5-174">Intel MPI 5</span></span><br/><br/><span data-ttu-id="91dc5-175">HpcVMDrivers Azure VM 擴充功能</span><span class="sxs-lookup"><span data-stu-id="91dc5-175">HpcVMDrivers Azure VM extension</span></span> | <span data-ttu-id="91dc5-176">啟用節點間通訊、停用並行工作執行</span><span class="sxs-lookup"><span data-stu-id="91dc5-176">Enable inter-node communication, disable concurrent task execution</span></span> |
| [<span data-ttu-id="91dc5-177">NC 系列*</span><span class="sxs-lookup"><span data-stu-id="91dc5-177">NC series*</span></span>](../virtual-machines/windows/n-series-driver-setup.md) | <span data-ttu-id="91dc5-178">NVIDIA Tesla K80 GPU</span><span class="sxs-lookup"><span data-stu-id="91dc5-178">NVIDIA Tesla K80 GPU</span></span> | <span data-ttu-id="91dc5-179">Windows Server 2016 或</span><span class="sxs-lookup"><span data-stu-id="91dc5-179">Windows Server 2016 or</span></span> <br/><span data-ttu-id="91dc5-180">Windows Server 2012 R2 (Azure Marketplace)</span><span class="sxs-lookup"><span data-stu-id="91dc5-180">Windows Server 2012 R2 (Azure Marketplace)</span></span> | <span data-ttu-id="91dc5-181">NVIDIA Tesla 驅動程式或 CUDA Toolkit 8.0 驅動程式</span><span class="sxs-lookup"><span data-stu-id="91dc5-181">NVIDIA Tesla drivers or CUDA Toolkit 8.0 drivers</span></span>| <span data-ttu-id="91dc5-182">N/A</span><span class="sxs-lookup"><span data-stu-id="91dc5-182">N/A</span></span> | 
| [<span data-ttu-id="91dc5-183">NV 系列</span><span class="sxs-lookup"><span data-stu-id="91dc5-183">NV series</span></span>](../virtual-machines/windows/n-series-driver-setup.md) | <span data-ttu-id="91dc5-184">NVIDIA Tesla M60 GPU</span><span class="sxs-lookup"><span data-stu-id="91dc5-184">NVIDIA Tesla M60 GPU</span></span> | <span data-ttu-id="91dc5-185">Windows Server 2016 或</span><span class="sxs-lookup"><span data-stu-id="91dc5-185">Windows Server 2016 or</span></span><br/><span data-ttu-id="91dc5-186">Windows Server 2012 R2 (Azure Marketplace)</span><span class="sxs-lookup"><span data-stu-id="91dc5-186">Windows Server 2012 R2 (Azure Marketplace)</span></span> | <span data-ttu-id="91dc5-187">NVIDIA GRID 4.3 驅動程式</span><span class="sxs-lookup"><span data-stu-id="91dc5-187">NVIDIA GRID 4.3 drivers</span></span> | <span data-ttu-id="91dc5-188">N/A</span><span class="sxs-lookup"><span data-stu-id="91dc5-188">N/A</span></span> |

<span data-ttu-id="91dc5-189">*具有 HpcVMDrivers 擴充功能和 Microsoft MPI 或 Intel MPI 的 Windows Server 2012 R2 可支援在 NC24r VM 上進行 RDMA 連線。</span><span class="sxs-lookup"><span data-stu-id="91dc5-189">*RDMA connectivity on NC24r VMs is supported on Windows Server 2012 R2 with HpcVMDrivers extension and Microsoft MPI or Intel MPI.</span></span>

### <a name="windows-pools---cloud-services-configuration"></a><span data-ttu-id="91dc5-190">Windows 集區 - 雲端服務組態</span><span class="sxs-lookup"><span data-stu-id="91dc5-190">Windows pools - Cloud services configuration</span></span>

> [!NOTE]
> <span data-ttu-id="91dc5-191">批次集區與 hello 雲端服務組態中不支援 N 序列的大小。</span><span class="sxs-lookup"><span data-stu-id="91dc5-191">N-series sizes are not supported in Batch pools with hello cloud services configuration.</span></span>
>

| <span data-ttu-id="91dc5-192">大小</span><span class="sxs-lookup"><span data-stu-id="91dc5-192">Size</span></span> | <span data-ttu-id="91dc5-193">功能</span><span class="sxs-lookup"><span data-stu-id="91dc5-193">Capability</span></span> | <span data-ttu-id="91dc5-194">作業系統</span><span class="sxs-lookup"><span data-stu-id="91dc5-194">Operating systems</span></span> | <span data-ttu-id="91dc5-195">必要的軟體</span><span class="sxs-lookup"><span data-stu-id="91dc5-195">Required software</span></span> | <span data-ttu-id="91dc5-196">集區設定</span><span class="sxs-lookup"><span data-stu-id="91dc5-196">Pool settings</span></span> |
| -------- | ------- | -------- | -------- | ----- |
| [<span data-ttu-id="91dc5-197">H16r、H16mr、A8、A9</span><span class="sxs-lookup"><span data-stu-id="91dc5-197">H16r, H16mr, A8, A9</span></span>](../virtual-machines/windows/sizes-hpc.md#rdma-capable-instances) | <span data-ttu-id="91dc5-198">RDMA</span><span class="sxs-lookup"><span data-stu-id="91dc5-198">RDMA</span></span> | <span data-ttu-id="91dc5-199">Windows Server 2012 R2、</span><span class="sxs-lookup"><span data-stu-id="91dc5-199">Windows Server 2012 R2,</span></span><br/><span data-ttu-id="91dc5-200">Windows Server 2012 或</span><span class="sxs-lookup"><span data-stu-id="91dc5-200">Windows Server 2012, or</span></span><br/><span data-ttu-id="91dc5-201">Windows Server 2008 R2 (Guest OS 系列)</span><span class="sxs-lookup"><span data-stu-id="91dc5-201">Windows Server 2008 R2 (Guest OS family)</span></span> | <span data-ttu-id="91dc5-202">Microsoft MPI 2012 R2 或更新版本，或</span><span class="sxs-lookup"><span data-stu-id="91dc5-202">Microsoft MPI 2012 R2 or later, or</span></span><br/><span data-ttu-id="91dc5-203">Intel MPI 5</span><span class="sxs-lookup"><span data-stu-id="91dc5-203">Intel MPI 5</span></span><br/><br/><span data-ttu-id="91dc5-204">HpcVMDrivers Azure VM 擴充功能</span><span class="sxs-lookup"><span data-stu-id="91dc5-204">HpcVMDrivers Azure VM extension</span></span> | <span data-ttu-id="91dc5-205">啟用節點間通訊、</span><span class="sxs-lookup"><span data-stu-id="91dc5-205">Enable inter-node communication,</span></span><br/> <span data-ttu-id="91dc5-206">停用並行工作執行</span><span class="sxs-lookup"><span data-stu-id="91dc5-206">disable concurrent task execution</span></span> |





## <a name="pool-configuration-options"></a><span data-ttu-id="91dc5-207">集區組態選項</span><span class="sxs-lookup"><span data-stu-id="91dc5-207">Pool configuration options</span></span>

<span data-ttu-id="91dc5-208">tooconfigure 特製化的 VM 大小，批次集區、 hello 批次應用程式開發介面和工具會提供數個選項所需的 tooinstall 軟體或驅動程式，包括：</span><span class="sxs-lookup"><span data-stu-id="91dc5-208">tooconfigure a specialized VM size for your Batch pool, hello Batch APIs and tools provide several options tooinstall required software or drivers, including:</span></span>

* <span data-ttu-id="91dc5-209">[啟動工作](batch-api-basics.md#start-task)-以資源檔案 tooan hello 中的 Azure 儲存體帳戶上傳的安裝套件與 hello 批次帳戶相同的區域。</span><span class="sxs-lookup"><span data-stu-id="91dc5-209">[Start task](batch-api-basics.md#start-task) - Upload an installation package as a resource file tooan Azure storage account in hello same region as hello Batch account.</span></span> <span data-ttu-id="91dc5-210">Hello 集區啟動時，請以無訊息方式建立開始工作命令列 tooinstall hello 資源檔案。</span><span class="sxs-lookup"><span data-stu-id="91dc5-210">Create a start task command line tooinstall hello resource file silently when hello pool starts.</span></span> <span data-ttu-id="91dc5-211">如需詳細資訊，請參閱 hello [REST API 文件](/rest/api/batchservice/add-a-pool-to-an-account#bk_starttask)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-211">For more information, see hello [REST API documentation](/rest/api/batchservice/add-a-pool-to-an-account#bk_starttask).</span></span>

  > [!NOTE] 
  > <span data-ttu-id="91dc5-212">hello 啟動工作必須執行以提升權限 （系統管理員） 權限，以及必須等候成功。</span><span class="sxs-lookup"><span data-stu-id="91dc5-212">hello start task must run with elevated (admin) permissions, and it must wait for success.</span></span>
  >

* <span data-ttu-id="91dc5-213">[應用程式封裝](batch-application-packages.md)-zip 壓縮的安裝封裝 tooyour 批次帳戶中加入和設定封裝參考 hello 集區。</span><span class="sxs-lookup"><span data-stu-id="91dc5-213">[Application package](batch-application-packages.md) - Add a zipped installation package tooyour Batch account, and configure a package reference in hello pool.</span></span> <span data-ttu-id="91dc5-214">這個設定會將上傳，並會 hello hello 集區中的所有節點上的封裝。</span><span class="sxs-lookup"><span data-stu-id="91dc5-214">This setting uploads and unzips hello package on all nodes in hello pool.</span></span> <span data-ttu-id="91dc5-215">如果 hello 封裝是安裝程式，建立啟動工作命令列 toosilently 安裝 hello 應用程式集區的所有節點上。</span><span class="sxs-lookup"><span data-stu-id="91dc5-215">If hello package is an installer, create a start task command line toosilently install hello app on all pool nodes.</span></span> <span data-ttu-id="91dc5-216">排程的 toorun 節點上工作時，選擇性地安裝 hello 封裝。</span><span class="sxs-lookup"><span data-stu-id="91dc5-216">Optionally, install hello package when a task is scheduled toorun on a node.</span></span>

* <span data-ttu-id="91dc5-217">[自訂的集區映像](batch-api-basics.md#pool)-建立自訂的 Windows 或 Linux VM 映像，其中包含驅動程式、 軟體或其他設定所需的 hello VM 大小。</span><span class="sxs-lookup"><span data-stu-id="91dc5-217">[Custom pool image](batch-api-basics.md#pool) - Create a custom Windows or Linux VM image that contains drivers, software, or other settings required for hello VM size.</span></span> <span data-ttu-id="91dc5-218">如果您建立您的 Batch 帳戶在 hello 使用者訂用帳戶設定中，指定 hello 批次集區的自訂映像。</span><span class="sxs-lookup"><span data-stu-id="91dc5-218">If you created your Batch account in hello user subscription configuration, specify hello custom image for your Batch pool.</span></span> <span data-ttu-id="91dc5-219">（自訂映像不支援在 hello 批次服務組態中的帳戶）。自訂映像只可以搭配 hello 虛擬機器組態中的集區。</span><span class="sxs-lookup"><span data-stu-id="91dc5-219">(Custom images are not supported in accounts in hello Batch service configuration.) Custom images can only be used with pools in hello virtual machine configuration.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="91dc5-220">在 Batch 集區中，您目前無法使用以受控磁碟或進階儲存體建立的自訂映像。</span><span class="sxs-lookup"><span data-stu-id="91dc5-220">In Batch pools, you can't currently use a custom image created with managed disks or with Premium storage.</span></span>
  >



* <span data-ttu-id="91dc5-221">[批次造船廠](https://github.com/Azure/batch-shipyard)hello GPU 和 rdma 來說 toowork 以透明的方式會以自動設定 Azure 批次的容器化工作負載。</span><span class="sxs-lookup"><span data-stu-id="91dc5-221">[Batch Shipyard](https://github.com/Azure/batch-shipyard) automatically configures hello GPU and RDMA toowork transparently with containerized workloads on Azure Batch.</span></span> <span data-ttu-id="91dc5-222">Batch Shipyard 完全是透過組態檔來驅動。</span><span class="sxs-lookup"><span data-stu-id="91dc5-222">Batch Shipyard is entirely driven with configuration files.</span></span> <span data-ttu-id="91dc5-223">有許多範例配方設定可啟用 GPU 和 rdma 來說工作負載，例如 hello [CNTK GPU 配方](https://github.com/Azure/batch-shipyard/tree/master/recipes/CNTK-GPU-OpenMPI)的預先設定了 N 系列 Vm 的 GPU 驅動程式，並載入 Microsoft 認知工具組做為 Docker 映像的軟體。</span><span class="sxs-lookup"><span data-stu-id="91dc5-223">There are many sample recipe configurations available that enable GPU and RDMA workloads such as hello [CNTK GPU Recipe](https://github.com/Azure/batch-shipyard/tree/master/recipes/CNTK-GPU-OpenMPI)  which preconfigures GPU drivers on N-series VMs and loads Microsoft Cognitive Toolkit software as a Docker image.</span></span>


## <a name="example-microsoft-mpi-on-an-a8-vm-pool"></a><span data-ttu-id="91dc5-224">範例：A8 VM 集區上的 Microsoft MPI</span><span class="sxs-lookup"><span data-stu-id="91dc5-224">Example: Microsoft MPI on an A8 VM pool</span></span>

<span data-ttu-id="91dc5-225">toorun Windows MPI 應用程式集區的 Azure A8 節點上，您需要 tooinstall 支援的 MPI 實作。</span><span class="sxs-lookup"><span data-stu-id="91dc5-225">toorun Windows MPI applications on a pool of Azure A8 nodes, you need tooinstall a supported MPI implementation.</span></span> <span data-ttu-id="91dc5-226">以下是範例步驟 tooinstall [Microsoft MPI](https://msdn.microsoft.com/library/bb524831(v=vs.85).aspx) Windows 在集區使用的批次應用程式套件。</span><span class="sxs-lookup"><span data-stu-id="91dc5-226">Here are sample steps tooinstall [Microsoft MPI](https://msdn.microsoft.com/library/bb524831(v=vs.85).aspx) on a Windows pool using a Batch application package.</span></span>

1. <span data-ttu-id="91dc5-227">下載 hello[安裝套件](http://go.microsoft.com/FWLink/p/?LinkID=389556)(MSMpiSetup.exe) 的 Microsoft MPI hello 最新版本。</span><span class="sxs-lookup"><span data-stu-id="91dc5-227">Download hello [setup package](http://go.microsoft.com/FWLink/p/?LinkID=389556) (MSMpiSetup.exe) for hello latest version of Microsoft MPI.</span></span>
2. <span data-ttu-id="91dc5-228">建立 hello 封裝 zip 檔案。</span><span class="sxs-lookup"><span data-stu-id="91dc5-228">Create a zip file of hello package.</span></span>
3. <span data-ttu-id="91dc5-229">上傳 hello 封裝 tooyour Batch 帳戶。</span><span class="sxs-lookup"><span data-stu-id="91dc5-229">Upload hello package tooyour Batch account.</span></span> <span data-ttu-id="91dc5-230">如需步驟，請參閱 hello[應用程式封裝](batch-application-packages.md)指引。</span><span class="sxs-lookup"><span data-stu-id="91dc5-230">For steps, see hello [application packages](batch-application-packages.md) guidance.</span></span> <span data-ttu-id="91dc5-231">指定應用程式識別碼 (例如 MSMPI) 和版本 (例如 8.1)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-231">Specify an application id such as *MSMPI*, and a version such as *8.1*.</span></span> 
4. <span data-ttu-id="91dc5-232">使用 hello 批次 Api 或 Azure 入口網站，建立具有所需的 hello 節點和小數位數數目的 hello 雲端服務組態中的集區。</span><span class="sxs-lookup"><span data-stu-id="91dc5-232">Using hello Batch APIs or Azure portal, create a pool in hello cloud services configuration with hello desired number of nodes and scale.</span></span> <span data-ttu-id="91dc5-233">hello 下表顯示範例設定 tooset MPI 註冊以使用啟動工作的自動安裝模式：</span><span class="sxs-lookup"><span data-stu-id="91dc5-233">hello following table shows sample settings tooset up MPI in unattended mode using a start task:</span></span>

| <span data-ttu-id="91dc5-234">設定</span><span class="sxs-lookup"><span data-stu-id="91dc5-234">Setting</span></span> | <span data-ttu-id="91dc5-235">值</span><span class="sxs-lookup"><span data-stu-id="91dc5-235">Value</span></span> |
| ---- | ----- | 
| <span data-ttu-id="91dc5-236">**映像類型**</span><span class="sxs-lookup"><span data-stu-id="91dc5-236">**Image Type**</span></span> | <span data-ttu-id="91dc5-237">雲端服務</span><span class="sxs-lookup"><span data-stu-id="91dc5-237">Cloud Services</span></span> |
| <span data-ttu-id="91dc5-238">**作業系統系列**</span><span class="sxs-lookup"><span data-stu-id="91dc5-238">**OS family**</span></span> | <span data-ttu-id="91dc5-239">Windows Server 2012 R2 (作業系統系列 4)</span><span class="sxs-lookup"><span data-stu-id="91dc5-239">Windows Server 2012 R2 (OS family 4)</span></span> |
| <span data-ttu-id="91dc5-240">**節點大小**</span><span class="sxs-lookup"><span data-stu-id="91dc5-240">**Node size**</span></span> | <span data-ttu-id="91dc5-241">A8 標準</span><span class="sxs-lookup"><span data-stu-id="91dc5-241">A8 Standard</span></span> |
| <span data-ttu-id="91dc5-242">**已啟用節點間通訊**</span><span class="sxs-lookup"><span data-stu-id="91dc5-242">**Internode communication enabled**</span></span> | <span data-ttu-id="91dc5-243">True</span><span class="sxs-lookup"><span data-stu-id="91dc5-243">True</span></span> |
| <span data-ttu-id="91dc5-244">**每個節點的工作數上限**</span><span class="sxs-lookup"><span data-stu-id="91dc5-244">**Max tasks per node**</span></span> | <span data-ttu-id="91dc5-245">1</span><span class="sxs-lookup"><span data-stu-id="91dc5-245">1</span></span> |
| <span data-ttu-id="91dc5-246">**應用程式套件參考**</span><span class="sxs-lookup"><span data-stu-id="91dc5-246">**Application package references**</span></span> | <span data-ttu-id="91dc5-247">MSMPI</span><span class="sxs-lookup"><span data-stu-id="91dc5-247">MSMPI</span></span> |
| <span data-ttu-id="91dc5-248">**已啟用啟動工作**</span><span class="sxs-lookup"><span data-stu-id="91dc5-248">**Start task enabled**</span></span> | <span data-ttu-id="91dc5-249">True</span><span class="sxs-lookup"><span data-stu-id="91dc5-249">True</span></span><br><span data-ttu-id="91dc5-250">**命令列** - `"cmd /c %AZ_BATCH_APP_PACKAGE_MSMPI#8.1%\\MSMpiSetup.exe -unattend -force"`</span><span class="sxs-lookup"><span data-stu-id="91dc5-250">**Command line** - `"cmd /c %AZ_BATCH_APP_PACKAGE_MSMPI#8.1%\\MSMpiSetup.exe -unattend -force"`</span></span><br/><span data-ttu-id="91dc5-251">**使用者身分識別** - 集區的自動使用者、系統管理員</span><span class="sxs-lookup"><span data-stu-id="91dc5-251">**User identity** - Pool autouser, admin</span></span><br/><span data-ttu-id="91dc5-252">**等待成功** - True</span><span class="sxs-lookup"><span data-stu-id="91dc5-252">**Wait for success** - True</span></span>

## <a name="example-nvidia-tesla-drivers-on-nc-vm-pool"></a><span data-ttu-id="91dc5-253">範例：NC VM 集區上的 NVIDIA Tesla 驅動程式</span><span class="sxs-lookup"><span data-stu-id="91dc5-253">Example: NVIDIA Tesla drivers on NC VM pool</span></span>

<span data-ttu-id="91dc5-254">toorun CUDA 應用程式集區的 NC Linux 節點上，您需要 tooinstall CUDA Toolkit 8.0 hello 節點上。</span><span class="sxs-lookup"><span data-stu-id="91dc5-254">toorun CUDA applications on a pool of Linux NC nodes, you need tooinstall CUDA Toolkit 8.0 on hello nodes.</span></span> <span data-ttu-id="91dc5-255">hello Toolkit 安裝 hello 必要 NVIDIA Tesla GPU 驅動程式。</span><span class="sxs-lookup"><span data-stu-id="91dc5-255">hello Toolkit installs hello necessary NVIDIA Tesla GPU drivers.</span></span> <span data-ttu-id="91dc5-256">以下是範例步驟 toodeploy hello GPU 驅動程式的自訂 Ubuntu 16.04 LTS 映像：</span><span class="sxs-lookup"><span data-stu-id="91dc5-256">Here are sample steps toodeploy a custom Ubuntu 16.04 LTS image with hello GPU drivers:</span></span>

1. <span data-ttu-id="91dc5-257">部署執行 Ubuntu 16.04 LTS 的 Azure NC6 VM。</span><span class="sxs-lookup"><span data-stu-id="91dc5-257">Deploy an Azure NC6 VM running Ubuntu 16.04 LTS.</span></span> <span data-ttu-id="91dc5-258">例如，在 hello 美國中南部地區建立 hello VM。</span><span class="sxs-lookup"><span data-stu-id="91dc5-258">For example, create hello VM in hello US South Central region.</span></span> <span data-ttu-id="91dc5-259">請確定您有標準的儲存區，建立 hello VM 和*沒有*管理的磁碟。</span><span class="sxs-lookup"><span data-stu-id="91dc5-259">Make sure that you create hello VM with standard storage, and *without* managed disks.</span></span>
2. <span data-ttu-id="91dc5-260">請遵循 hello 步驟 tooconnect toohello VM 和[安裝 CUDA 驅動程式](../virtual-machines/linux/n-series-driver-setup.md#install-cuda-drivers-for-nc-vms)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-260">Follow hello steps tooconnect toohello VM and [install CUDA drivers](../virtual-machines/linux/n-series-driver-setup.md#install-cuda-drivers-for-nc-vms).</span></span>
3. <span data-ttu-id="91dc5-261">取消佈建 hello Linux 代理程式，然後擷取 Linux VM 映像使用 hello Azure CLI 1.0 命令。</span><span class="sxs-lookup"><span data-stu-id="91dc5-261">Deprovision hello Linux agent, and then capture Linux VM image using hello Azure CLI 1.0 commands.</span></span> <span data-ttu-id="91dc5-262">如需相關步驟，請參閱[擷取在 Azure 上執行的 Linux 虛擬機器](../virtual-machines/linux/capture-image-nodejs.md)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-262">For steps, see [Capture a Linux virtual machine running on Azure](../virtual-machines/linux/capture-image-nodejs.md).</span></span> <span data-ttu-id="91dc5-263">記下 hello 影像 URI。</span><span class="sxs-lookup"><span data-stu-id="91dc5-263">Make a note of hello image URI.</span></span>
  > [!IMPORTANT]
  > <span data-ttu-id="91dc5-264">請勿針對 Azure 批次使用 Azure CLI 2.0 命令 toocapture hello 映像。</span><span class="sxs-lookup"><span data-stu-id="91dc5-264">Do not use Azure CLI 2.0 commands toocapture hello image for Azure Batch.</span></span> <span data-ttu-id="91dc5-265">目前 hello CLI 2.0 命令只會擷取使用受管理的磁碟建立的 Vm。</span><span class="sxs-lookup"><span data-stu-id="91dc5-265">Currently hello CLI 2.0 commands only capture VMs created using managed disks.</span></span>
  >
4. <span data-ttu-id="91dc5-266">建立批次帳戶，使用 hello 使用者訂用帳戶設定，支援 NC Vm 所在的地區。</span><span class="sxs-lookup"><span data-stu-id="91dc5-266">Create a Batch account, with hello user subscription configuration, in a region that supports NC VMs.</span></span>
5. <span data-ttu-id="91dc5-267">使用 hello 批次 Api 或 Azure 入口網站使用 hello 自訂映像來建立資料庫，並以 hello 所需的節點和小數位數數目。</span><span class="sxs-lookup"><span data-stu-id="91dc5-267">Using hello Batch APIs or Azure portal, create a pool using hello custom image and with hello desired number of nodes and scale.</span></span> <span data-ttu-id="91dc5-268">hello 下表顯示 hello 映像的範例集區設定：</span><span class="sxs-lookup"><span data-stu-id="91dc5-268">hello following table shows sample pool settings for hello image:</span></span>

| <span data-ttu-id="91dc5-269">設定</span><span class="sxs-lookup"><span data-stu-id="91dc5-269">Setting</span></span> | <span data-ttu-id="91dc5-270">值</span><span class="sxs-lookup"><span data-stu-id="91dc5-270">Value</span></span> |
| ---- | ---- |
| <span data-ttu-id="91dc5-271">**映像類型**</span><span class="sxs-lookup"><span data-stu-id="91dc5-271">**Image Type**</span></span> | <span data-ttu-id="91dc5-272">自訂映像</span><span class="sxs-lookup"><span data-stu-id="91dc5-272">Custom Image</span></span> |
| <span data-ttu-id="91dc5-273">**自訂映像**</span><span class="sxs-lookup"><span data-stu-id="91dc5-273">**Custom Image**</span></span> | <span data-ttu-id="91dc5-274">影像 hello 表單的 URI`https://yourstorageaccountdisks.blob.core.windows.net/system/Microsoft.Compute/Images/vhds/MyVHDNamePrefix-osDisk.xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx.vhd`</span><span class="sxs-lookup"><span data-stu-id="91dc5-274">Image URI of hello form `https://yourstorageaccountdisks.blob.core.windows.net/system/Microsoft.Compute/Images/vhds/MyVHDNamePrefix-osDisk.xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx.vhd`</span></span> |
| <span data-ttu-id="91dc5-275">**節點代理程式 SKU**</span><span class="sxs-lookup"><span data-stu-id="91dc5-275">**Node agent SKU**</span></span> | <span data-ttu-id="91dc5-276">batch.node.ubuntu 16.04</span><span class="sxs-lookup"><span data-stu-id="91dc5-276">batch.node.ubuntu 16.04</span></span> |
| <span data-ttu-id="91dc5-277">**節點大小**</span><span class="sxs-lookup"><span data-stu-id="91dc5-277">**Node size**</span></span> | <span data-ttu-id="91dc5-278">NC6 標準</span><span class="sxs-lookup"><span data-stu-id="91dc5-278">NC6 Standard</span></span> |



## <a name="next-steps"></a><span data-ttu-id="91dc5-279">後續步驟</span><span class="sxs-lookup"><span data-stu-id="91dc5-279">Next steps</span></span>

* <span data-ttu-id="91dc5-280">Azure Batch 集區上的 toorun MPI 工作，請參閱 「 hello [Windows](batch-mpi.md)或[Linux](https://blogs.technet.microsoft.com/windowshpc/2016/07/20/introducing-mpi-support-for-linux-on-azure-batch/)範例。</span><span class="sxs-lookup"><span data-stu-id="91dc5-280">toorun MPI jobs on an Azure Batch pool, see hello [Windows](batch-mpi.md) or [Linux](https://blogs.technet.microsoft.com/windowshpc/2016/07/20/introducing-mpi-support-for-linux-on-azure-batch/) examples.</span></span>

* <span data-ttu-id="91dc5-281">例如批次中的 GPU 工作負載的詳細資訊，請參閱 hello[批次造船廠](https://github.com/Azure/batch-shipyard/)的訣竅。</span><span class="sxs-lookup"><span data-stu-id="91dc5-281">For examples of GPU workloads on Batch, see hello [Batch Shipyard](https://github.com/Azure/batch-shipyard/) recipes.</span></span>
