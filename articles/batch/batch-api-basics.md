---
title: "適用於開發人員的 Azure 批次 aaaOverview |Microsoft 文件"
description: "了解 hello 批次服務和其 Api 開發的觀點而言 hello 功能。"
services: batch
documentationcenter: .net
author: tamram
manager: timlt
editor: 
ms.assetid: 416b95f8-2d7b-4111-8012-679b0f60d204
ms.service: batch
ms.devlang: multiple
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: big-compute
ms.date: 06/28/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 3da9d82572b28d05d1923166bd08c26725ca3316
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="develop-large-scale-parallel-compute-solutions-with-batch"></a><span data-ttu-id="48049-103">使用 Batch 開發大規模的平行運算解決方案</span><span class="sxs-lookup"><span data-stu-id="48049-103">Develop large-scale parallel compute solutions with Batch</span></span>

<span data-ttu-id="48049-104">本概觀 hello 的 hello Azure 批次服務的核心元件，我們將討論 hello 主要服務功能和資源，批次的開發人員可以使用 toobuild 大規模的平行運算解決方案。</span><span class="sxs-lookup"><span data-stu-id="48049-104">In this overview of hello core components of hello Azure Batch service, we discuss hello primary service features and resources that Batch developers can use toobuild large-scale parallel compute solutions.</span></span>

<span data-ttu-id="48049-105">您正在開發分散式計算應用程式，或服務，會發出直接[REST API] [ batch_rest_api]呼叫，或您要使用其中一種 hello[批次 Sdk](batch-apis-tools.md#azure-accounts-for-batch-development)，您將使用許多 hello 資源和本文所討論的功能。</span><span class="sxs-lookup"><span data-stu-id="48049-105">Whether you're developing a distributed computational application or service that issues direct [REST API][batch_rest_api] calls or you're using one of hello [Batch SDKs](batch-apis-tools.md#azure-accounts-for-batch-development), you'll use many of hello resources and features discussed in this article.</span></span>

> [!TIP]
> <span data-ttu-id="48049-106">較高層級簡介 toohello 批次服務，請參閱[Azure Batch 基本概念](batch-technical-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-106">For a higher-level introduction toohello Batch service, see [Basics of Azure Batch](batch-technical-overview.md).</span></span>
>
>

## <a name="batch-service-workflow"></a><span data-ttu-id="48049-107">Batch 服務工作流程</span><span class="sxs-lookup"><span data-stu-id="48049-107">Batch service workflow</span></span>
<span data-ttu-id="48049-108">hello 下列高階工作流程是典型的幾乎所有應用程式和使用 hello 處理平行的工作負載的批次服務的服務：</span><span class="sxs-lookup"><span data-stu-id="48049-108">hello following high-level workflow is typical of nearly all applications and services that use hello Batch service for processing parallel workloads:</span></span>

1. <span data-ttu-id="48049-109">上傳 hello**資料檔案**想 tooprocess tooan [Azure 儲存體][ azure_storage]帳戶。</span><span class="sxs-lookup"><span data-stu-id="48049-109">Upload hello **data files** that you want tooprocess tooan [Azure Storage][azure_storage] account.</span></span> <span data-ttu-id="48049-110">批次包含內建支援，可以存取 Azure Blob 儲存體，和您的工作可以下載這些檔案太[計算節點](#compute-node)hello 工作執行時。</span><span class="sxs-lookup"><span data-stu-id="48049-110">Batch includes built-in support for accessing Azure Blob storage, and your tasks can download these files too[compute nodes](#compute-node) when hello tasks are run.</span></span>
2. <span data-ttu-id="48049-111">上傳 hello**應用程式檔案**將執行您的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-111">Upload hello **application files** that your tasks will run.</span></span> <span data-ttu-id="48049-112">這些檔案可以是二進位檔或指令碼和它們的相依性，並且會執行作業中的 hello 工作。</span><span class="sxs-lookup"><span data-stu-id="48049-112">These files can be binaries or scripts and their dependencies, and are executed by hello tasks in your jobs.</span></span> <span data-ttu-id="48049-113">您的工作可以下載這些檔案從您的儲存體帳戶，或者您可以使用 hello[應用程式封裝](#application-packages)批次的應用程式管理和部署的功能。</span><span class="sxs-lookup"><span data-stu-id="48049-113">Your tasks can download these files from your Storage account, or you can use hello [application packages](#application-packages) feature of Batch for application management and deployment.</span></span>
3. <span data-ttu-id="48049-114">建立計算節點的 [集區](#pool) 。</span><span class="sxs-lookup"><span data-stu-id="48049-114">Create a [pool](#pool) of compute nodes.</span></span> <span data-ttu-id="48049-115">當您建立一個集區時，您會指定 hello 的 hello 集區、 大小和 hello 作業系統的運算節點數目。</span><span class="sxs-lookup"><span data-stu-id="48049-115">When you create a pool, you specify hello number of compute nodes for hello pool, their size, and hello operating system.</span></span> <span data-ttu-id="48049-116">當工作中的每個工作執行時，它會指派 tooexecute 其中一個集區中的 hello 節點上。</span><span class="sxs-lookup"><span data-stu-id="48049-116">When each task in your job runs, it's assigned tooexecute on one of hello nodes in your pool.</span></span>
4. <span data-ttu-id="48049-117">建立 [作業](#job)。</span><span class="sxs-lookup"><span data-stu-id="48049-117">Create a [job](#job).</span></span> <span data-ttu-id="48049-118">作業可管理一群工作。</span><span class="sxs-lookup"><span data-stu-id="48049-118">A job manages a collection of tasks.</span></span> <span data-ttu-id="48049-119">您會將每個作業 tooa 特定集區將在其中執行該作業的工作產生關聯。</span><span class="sxs-lookup"><span data-stu-id="48049-119">You associate each job tooa specific pool where that job's tasks will run.</span></span>
5. <span data-ttu-id="48049-120">新增[工作](#task)toohello 作業。</span><span class="sxs-lookup"><span data-stu-id="48049-120">Add [tasks](#task) toohello job.</span></span> <span data-ttu-id="48049-121">Hello 應用程式或指令碼，您上傳 tooprocess hello 資料檔案，它會從儲存體帳戶下載，則會執行每項工作。</span><span class="sxs-lookup"><span data-stu-id="48049-121">Each task runs hello application or script that you uploaded tooprocess hello data files it downloads from your Storage account.</span></span> <span data-ttu-id="48049-122">每項工作完成時，它可以上傳其輸出 tooAzure 儲存體。</span><span class="sxs-lookup"><span data-stu-id="48049-122">As each task completes, it can upload its output tooAzure Storage.</span></span>
6. <span data-ttu-id="48049-123">監控工作進度，並從 Azure 儲存體擷取 hello 工作輸出。</span><span class="sxs-lookup"><span data-stu-id="48049-123">Monitor job progress and retrieve hello task output from Azure Storage.</span></span>

<span data-ttu-id="48049-124">hello 下列各節討論這些與 hello 批次的啟用分散式計算案例的其他資源。</span><span class="sxs-lookup"><span data-stu-id="48049-124">hello following sections discuss these and hello other resources of Batch that enable your distributed computational scenario.</span></span>

> [!NOTE]
> <span data-ttu-id="48049-125">您需要[批次帳戶](#account)toouse hello 批次服務。</span><span class="sxs-lookup"><span data-stu-id="48049-125">You need a [Batch account](#account) toouse hello Batch service.</span></span> <span data-ttu-id="48049-126">大部分 Batch 解決方案也會使用 [Azure 儲存體][azure_storage] 帳戶來儲存和擷取檔案。</span><span class="sxs-lookup"><span data-stu-id="48049-126">Most Batch solutions also use an [Azure Storage][azure_storage] account for file storage and retrieval.</span></span> <span data-ttu-id="48049-127">批次目前支援的只有 hello**一般用途**儲存體帳戶類型，如步驟 5 中所述[建立儲存體帳戶](../storage/common/storage-create-storage-account.md#create-a-storage-account)中[關於 Azure 儲存體帳戶](../storage/common/storage-create-storage-account.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-127">Batch currently supports only hello **general-purpose** storage account type, as described in step 5 of [Create a storage account](../storage/common/storage-create-storage-account.md#create-a-storage-account) in [About Azure storage accounts](../storage/common/storage-create-storage-account.md).</span></span>
>
>

## <a name="batch-service-resources"></a><span data-ttu-id="48049-128">Batch 服務資源</span><span class="sxs-lookup"><span data-stu-id="48049-128">Batch service resources</span></span>
<span data-ttu-id="48049-129">部分的下列資源--帳戶 hello 計算節點、 集區、 工作和工作，即所需使用 hello 批次服務的所有方案。</span><span class="sxs-lookup"><span data-stu-id="48049-129">Some of hello following resources--accounts, compute nodes, pools, jobs, and tasks--are required by all solutions that use hello Batch service.</span></span> <span data-ttu-id="48049-130">其他資源 (如作業排程和應用程式套件) 都很實用，但為選用功能。</span><span class="sxs-lookup"><span data-stu-id="48049-130">Others, like job schedules and application packages, are helpful, but optional, features.</span></span>

* [<span data-ttu-id="48049-131">帳戶</span><span class="sxs-lookup"><span data-stu-id="48049-131">Account</span></span>](#account)
* [<span data-ttu-id="48049-132">計算節點</span><span class="sxs-lookup"><span data-stu-id="48049-132">Compute node</span></span>](#compute-node)
* [<span data-ttu-id="48049-133">集區</span><span class="sxs-lookup"><span data-stu-id="48049-133">Pool</span></span>](#pool)
* [<span data-ttu-id="48049-134">作業</span><span class="sxs-lookup"><span data-stu-id="48049-134">Job</span></span>](#job)

  * [<span data-ttu-id="48049-135">作業排程</span><span class="sxs-lookup"><span data-stu-id="48049-135">Job schedules</span></span>](#scheduled-jobs)
* [<span data-ttu-id="48049-136">Task</span><span class="sxs-lookup"><span data-stu-id="48049-136">Task</span></span>](#task)

  * [<span data-ttu-id="48049-137">啟動工作</span><span class="sxs-lookup"><span data-stu-id="48049-137">Start task</span></span>](#start-task)
  * [<span data-ttu-id="48049-138">作業管理員工作</span><span class="sxs-lookup"><span data-stu-id="48049-138">Job manager task</span></span>](#job-manager-task)
  * [<span data-ttu-id="48049-139">作業準備和作業釋放工作</span><span class="sxs-lookup"><span data-stu-id="48049-139">Job preparation and release tasks</span></span>](#job-preparation-and-release-tasks)
  * [<span data-ttu-id="48049-140">多重執行個體工作 (MPI)</span><span class="sxs-lookup"><span data-stu-id="48049-140">Multi-instance task (MPI)</span></span>](#multi-instance-tasks)
  * [<span data-ttu-id="48049-141">作業相依性</span><span class="sxs-lookup"><span data-stu-id="48049-141">Task dependencies</span></span>](#task-dependencies)
* [<span data-ttu-id="48049-142">應用程式封裝</span><span class="sxs-lookup"><span data-stu-id="48049-142">Application packages</span></span>](#application-packages)

## <a name="account"></a><span data-ttu-id="48049-143">帳戶</span><span class="sxs-lookup"><span data-stu-id="48049-143">Account</span></span>
<span data-ttu-id="48049-144">批次帳戶是 hello 批次服務中的唯一識別的實體。</span><span class="sxs-lookup"><span data-stu-id="48049-144">A Batch account is a uniquely identified entity within hello Batch service.</span></span> <span data-ttu-id="48049-145">所有處理都與 Batch 帳戶相關聯。</span><span class="sxs-lookup"><span data-stu-id="48049-145">All processing is associated with a Batch account.</span></span>

<span data-ttu-id="48049-146">您可以建立使用 hello Azure Batch 帳戶[Azure 入口網站](batch-account-create-portal.md)或以程式設計的方式，例如以 hello [Batch Management.NET 程式庫](batch-management-dotnet.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-146">You can create an Azure Batch account using hello [Azure portal](batch-account-create-portal.md) or programmatically, such as with hello [Batch Management .NET library](batch-management-dotnet.md).</span></span> <span data-ttu-id="48049-147">建立 hello 帳戶時，您可以將 Azure 儲存體帳戶產生關聯。</span><span class="sxs-lookup"><span data-stu-id="48049-147">When creating hello account, you can associate an Azure storage account.</span></span>

### <a name="pool-allocation-mode"></a><span data-ttu-id="48049-148">集區配置模式</span><span class="sxs-lookup"><span data-stu-id="48049-148">Pool allocation mode</span></span>

<span data-ttu-id="48049-149">當您建立 Batch 帳戶時，可以指定如何配置計算節點的[集區](#pool)。</span><span class="sxs-lookup"><span data-stu-id="48049-149">When you create a Batch account, you can specify how [pools](#pool) of compute nodes are allocated.</span></span> <span data-ttu-id="48049-150">您可以選擇 tooallocate 集區的運算節點中的訂用帳戶管理的 Azure 批次，或您可以將他們配置您的訂用帳戶中。</span><span class="sxs-lookup"><span data-stu-id="48049-150">You can choose tooallocate pools of compute nodes in a subscription managed by Azure Batch, or you can allocate them in your own subscription.</span></span> <span data-ttu-id="48049-151">hello*集區配置模式*hello 帳戶的屬性會決定集區配置的位置。</span><span class="sxs-lookup"><span data-stu-id="48049-151">hello *pool allocation mode* property for hello account determines where pools are allocated.</span></span> 

<span data-ttu-id="48049-152">toodecide 的集區配置模式 toouse，請考慮這最適合您的案例：</span><span class="sxs-lookup"><span data-stu-id="48049-152">toodecide which pool allocation mode toouse, consider which best fits your scenario:</span></span>

* <span data-ttu-id="48049-153">**批次服務**： 批次服務是 hello 預設集區配置模式，集區中配置管理 Azure 訂用帳戶中的 hello 背景。</span><span class="sxs-lookup"><span data-stu-id="48049-153">**Batch Service**: Batch Service is hello default pool allocation mode, in which pools are allocated behind hello scenes in Azure-managed subscriptions.</span></span> <span data-ttu-id="48049-154">請記住下列重點 hello 批次服務集區配置模式的相關：</span><span class="sxs-lookup"><span data-stu-id="48049-154">Keep in mind these key points about hello Batch Service pool allocation mode:</span></span>

    - <span data-ttu-id="48049-155">hello 批次服務集區配置模式下支援雲端服務和虛擬機器的集區。</span><span class="sxs-lookup"><span data-stu-id="48049-155">hello Batch Service pool allocation mode supports both Cloud Service and Virtual Machine pools.</span></span>
    - <span data-ttu-id="48049-156">hello 批次服務集區配置模式支援兩個共用金鑰驗證或[Azure Active Directory 驗證](batch-aad-auth.md)(Azure AD)。</span><span class="sxs-lookup"><span data-stu-id="48049-156">hello Batch Service pool allocation mode supports both shared key authentication or [Azure Active Directory authentication](batch-aad-auth.md) (Azure AD).</span></span> 
    - <span data-ttu-id="48049-157">您可以使用任一專用或低優先順序的計算節點以 hello 批次服務集區配置模式下所配置的集區中。</span><span class="sxs-lookup"><span data-stu-id="48049-157">You can use either dedicated or low-priority compute nodes in pools allocated with hello Batch Service pool allocation mode.</span></span>
    - <span data-ttu-id="48049-158">如果您計劃 toocreate Azure 虛擬機器的集區從自訂 VM 映像，或者如果您計劃 toouse 虛擬網路，請勿使用 hello 批次服務集區配置模式。</span><span class="sxs-lookup"><span data-stu-id="48049-158">Do not use hello Batch Service pool allocation mode if you plan toocreate Azure virtual machine pools from custom VM images, or if you plan toouse a virtual network.</span></span> <span data-ttu-id="48049-159">改為建立您的帳戶與 hello 使用者訂用帳戶集區配置模式。</span><span class="sxs-lookup"><span data-stu-id="48049-159">Create your account with hello User Subscription pool allocation mode instead.</span></span>
    - <span data-ttu-id="48049-160">建立與 hello 批次服務集區配置模式下，帳戶佈建的虛擬機器集區必須從建立[Azure 虛擬機器 Marketplace] [ vm_marketplace]映像。</span><span class="sxs-lookup"><span data-stu-id="48049-160">Virtual Machine pools provisioned in an account created with hello Batch Service pool allocation mode must be created from [Azure Virtual Machines Marketplace][vm_marketplace] images.</span></span>

* <span data-ttu-id="48049-161">**使用者訂用帳戶**: hello 使用者訂用帳戶集區配置模式中，批次集區會在 hello hello 帳戶建立所在的 Azure 訂用帳戶中配置。</span><span class="sxs-lookup"><span data-stu-id="48049-161">**User subscription**: With hello User Subscription pool allocation mode, Batch pools are allocated in hello Azure subscription where hello account is created.</span></span> <span data-ttu-id="48049-162">請記住下列重點 hello 使用者訂用帳戶集區配置模式的相關：</span><span class="sxs-lookup"><span data-stu-id="48049-162">Keep in mind these key points about hello User Subscription pool allocation mode:</span></span>
     
    - <span data-ttu-id="48049-163">hello 使用者訂用帳戶集區配置模式下支援只有虛擬機器的集區。</span><span class="sxs-lookup"><span data-stu-id="48049-163">hello User Subscription pool allocation mode supports only Virtual Machine pools.</span></span> <span data-ttu-id="48049-164">並不支援雲端服務集區。</span><span class="sxs-lookup"><span data-stu-id="48049-164">It does not support Cloud Services pools.</span></span>
    - <span data-ttu-id="48049-165">toocreate 虛擬機器的集區的自訂 VM 映像或 toouse 虛擬網路與虛擬機器集區，您必須使用 hello 使用者訂用帳戶集區配置模式。</span><span class="sxs-lookup"><span data-stu-id="48049-165">toocreate Virtual Machine pools from custom VM images or toouse a virtual network with Virtual Machine pools, you must use hello User Subscription pool allocation mode.</span></span>  
    - <span data-ttu-id="48049-166">您必須使用[Azure Active Directory 驗證](batch-aad-auth.md)與 hello 使用者訂用帳戶中配置的集區。</span><span class="sxs-lookup"><span data-stu-id="48049-166">You must use [Azure Active Directory authentication](batch-aad-auth.md) with pools that are allocated in hello user subscription.</span></span> 
    - <span data-ttu-id="48049-167">您必須設定 Azure 金鑰保存庫為您的 Batch 帳戶如果 hello 集區配置模式下設定 tooUser 訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="48049-167">You must set up an Azure key vault for your Batch account if hello pool allocation mode is set tooUser Subscription.</span></span> 
    - <span data-ttu-id="48049-168">您可以使用只有專用的運算節點中建立與 hello 使用者訂用帳戶集區配置模式下的帳戶的集區中。</span><span class="sxs-lookup"><span data-stu-id="48049-168">You can use only dedicated compute nodes in pools in an account created with hello User Subscription pool allocation mode.</span></span> <span data-ttu-id="48049-169">不支援低優先順序的節點。</span><span class="sxs-lookup"><span data-stu-id="48049-169">Low-priority nodes are not supported.</span></span>
    - <span data-ttu-id="48049-170">在具有 hello 使用者訂用帳戶集區配置模式下的帳戶中佈建的虛擬機器集區可以建立從[Azure 虛擬機器 Marketplace] [ vm_marketplace]映像，或從自訂映像，您提供。</span><span class="sxs-lookup"><span data-stu-id="48049-170">Virtual Machine pools provisioned in an account with hello User Subscription pool allocation mode can be created either from [Azure Virtual Machines Marketplace][vm_marketplace] images, or from custom images that you provide.</span></span>

<span data-ttu-id="48049-171">下表中的 hello 比較 hello 批次服務和使用者訂用帳戶集區配置模式。</span><span class="sxs-lookup"><span data-stu-id="48049-171">hello following table compares hello Batch Service and User Subscription pool allocation modes.</span></span>

| <span data-ttu-id="48049-172">**集區配置模式**</span><span class="sxs-lookup"><span data-stu-id="48049-172">**Pool allocation mode**</span></span>                 | <span data-ttu-id="48049-173">**Batch 服務**</span><span class="sxs-lookup"><span data-stu-id="48049-173">**Batch Service**</span></span>                                                                                       | <span data-ttu-id="48049-174">**使用者訂用帳戶**</span><span class="sxs-lookup"><span data-stu-id="48049-174">**User Subscription**</span></span>                                                              |
|-------------------------------------------|---------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|
| <span data-ttu-id="48049-175">**集區配置位置**</span><span class="sxs-lookup"><span data-stu-id="48049-175">**Pools are allocated in**</span></span>               | <span data-ttu-id="48049-176">Azure 管理的訂用帳戶</span><span class="sxs-lookup"><span data-stu-id="48049-176">An Azure-managed subscription</span></span>                                                                           | <span data-ttu-id="48049-177">hello 使用者訂用帳戶中的 hello 批次建立帳戶</span><span class="sxs-lookup"><span data-stu-id="48049-177">hello user subscription in which hello Batch account is created</span></span>                        |
| <span data-ttu-id="48049-178">**支援的組態**</span><span class="sxs-lookup"><span data-stu-id="48049-178">**Supported configurations**</span></span>             | <ul><li><span data-ttu-id="48049-179">雲端服務設定</span><span class="sxs-lookup"><span data-stu-id="48049-179">Cloud Service Configuration</span></span></li><li><span data-ttu-id="48049-180">虛擬機器設定 (Linux 和 Windows)</span><span class="sxs-lookup"><span data-stu-id="48049-180">Virtual Machine Configuration (Linux and Windows)</span></span></li></ul> | <ul><li><span data-ttu-id="48049-181">虛擬機器設定 (Linux 和 Windows)</span><span class="sxs-lookup"><span data-stu-id="48049-181">Virtual Machine Configuration (Linux and Windows)</span></span></li></ul>                |
| <span data-ttu-id="48049-182">**支援的 VM 映像**</span><span class="sxs-lookup"><span data-stu-id="48049-182">**Supported VM images**</span></span>                  | <ul><li><span data-ttu-id="48049-183">Azure Marketplace 影像</span><span class="sxs-lookup"><span data-stu-id="48049-183">Azure Marketplace images</span></span></li></ul>                                                              | <ul><li><span data-ttu-id="48049-184">Azure Marketplace 影像</span><span class="sxs-lookup"><span data-stu-id="48049-184">Azure Marketplace images</span></span></li><li><span data-ttu-id="48049-185">自訂映像</span><span class="sxs-lookup"><span data-stu-id="48049-185">Custom images</span></span></li></ul>                   |
| <span data-ttu-id="48049-186">**支援的計算節點類型**</span><span class="sxs-lookup"><span data-stu-id="48049-186">**Supported compute node types**</span></span>         | <ul><li><span data-ttu-id="48049-187">專用節點</span><span class="sxs-lookup"><span data-stu-id="48049-187">Dedicated nodes</span></span></li><li><span data-ttu-id="48049-188">低優先順序節點</span><span class="sxs-lookup"><span data-stu-id="48049-188">Low-priority nodes</span></span></li></ul>                                            | <ul><li><span data-ttu-id="48049-189">專用節點</span><span class="sxs-lookup"><span data-stu-id="48049-189">Dedicated nodes</span></span></li></ul>                                                  |
| <span data-ttu-id="48049-190">**支援的驗證**</span><span class="sxs-lookup"><span data-stu-id="48049-190">**Supported authentication**</span></span>             | <ul><li><span data-ttu-id="48049-191">共用金鑰</span><span class="sxs-lookup"><span data-stu-id="48049-191">Shared Key</span></span></li><li><span data-ttu-id="48049-192">Azure AD</span><span class="sxs-lookup"><span data-stu-id="48049-192">Azure AD</span></span></li></ul>                                                           | <ul><li><span data-ttu-id="48049-193">Azure AD</span><span class="sxs-lookup"><span data-stu-id="48049-193">Azure AD</span></span></li></ul>                                                         |
| <span data-ttu-id="48049-194">**需要 Azure Key Vault**</span><span class="sxs-lookup"><span data-stu-id="48049-194">**Azure Key Vault required**</span></span>             | <span data-ttu-id="48049-195">否</span><span class="sxs-lookup"><span data-stu-id="48049-195">No</span></span>                                                                                                      | <span data-ttu-id="48049-196">是</span><span class="sxs-lookup"><span data-stu-id="48049-196">Yes</span></span>                                                                                |
| <span data-ttu-id="48049-197">**核心配額**</span><span class="sxs-lookup"><span data-stu-id="48049-197">**Core quota**</span></span>                           | <span data-ttu-id="48049-198">取決於 Batch 核心配額</span><span class="sxs-lookup"><span data-stu-id="48049-198">Determined by Batch core quota</span></span>                                                                          | <span data-ttu-id="48049-199">取決於訂用帳戶核心配額</span><span class="sxs-lookup"><span data-stu-id="48049-199">Determined by subscription core quota</span></span>                                              |
| <span data-ttu-id="48049-200">**Azure 虛擬網路 (Vnet) 支援**</span><span class="sxs-lookup"><span data-stu-id="48049-200">**Azure Virtual Network (Vnet) support**</span></span> | <span data-ttu-id="48049-201">建立以 hello 雲端服務組態集區</span><span class="sxs-lookup"><span data-stu-id="48049-201">Pools created with hello Cloud Service Configuration</span></span>                                                      | <span data-ttu-id="48049-202">建立以 hello 虛擬機器組態的集區</span><span class="sxs-lookup"><span data-stu-id="48049-202">Pools created with hello Virtual Machine Configuration</span></span>                               |
| <span data-ttu-id="48049-203">**支援的 Vnet 部署模型**</span><span class="sxs-lookup"><span data-stu-id="48049-203">**Vnet deployment model supported**</span></span>      | <span data-ttu-id="48049-204">使用傳統部署模型建立的 Vnet</span><span class="sxs-lookup"><span data-stu-id="48049-204">Vnets created with classic deployment model</span></span>                                                             | <span data-ttu-id="48049-205">Vnet 建立 hello 傳統部署模型或 Azure 資源管理員</span><span class="sxs-lookup"><span data-stu-id="48049-205">Vnets created with either hello classic deployment model or Azure   Resource Manager</span></span> |

## <a name="azure-storage-account"></a><span data-ttu-id="48049-206">Azure 儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="48049-206">Azure Storage account</span></span>

<span data-ttu-id="48049-207">大部分 Batch 解決方案都使用 Azure 儲存體來儲存資源檔和輸出檔。</span><span class="sxs-lookup"><span data-stu-id="48049-207">Most Batch solutions use Azure Storage for storing resource files and output files.</span></span>  

<span data-ttu-id="48049-208">批次目前僅支援 hello 一般用途儲存體帳戶類型，如所述的步驟 5 中[建立儲存體帳戶](../storage/common/storage-create-storage-account.md#create-a-storage-account)中[關於 Azure 儲存體帳戶](../storage/common/storage-create-storage-account.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-208">Batch currently supports only hello general-purpose storage account type, as described in step 5 of [Create a storage account](../storage/common/storage-create-storage-account.md#create-a-storage-account) in [About Azure storage accounts](../storage/common/storage-create-storage-account.md).</span></span> <span data-ttu-id="48049-209">您的 Batch 工作 (包括標準工作、啟動工作、作業準備工作和作業發行工作) 必須指定位於一般用途的儲存體帳戶中的資源檔。</span><span class="sxs-lookup"><span data-stu-id="48049-209">Your Batch tasks (including standard tasks, start tasks, job preparation tasks, and job release tasks) must specify resource files that reside in general-purpose storage accounts.</span></span>


## <a name="compute-node"></a><span data-ttu-id="48049-210">計算節點</span><span class="sxs-lookup"><span data-stu-id="48049-210">Compute node</span></span>
<span data-ttu-id="48049-211">Azure 虛擬機器 (VM) 或雲端服務是專用的 tooprocessing 部分應用程式的工作負載的 VM 運算節點。</span><span class="sxs-lookup"><span data-stu-id="48049-211">A compute node is an Azure virtual machine (VM) or cloud service VM that is dedicated tooprocessing a portion of your application's workload.</span></span> <span data-ttu-id="48049-212">節點的 hello 大小會決定 hello CPU 核心數目、 記憶體容量和配置 toohello 節點的本機檔案系統大小。</span><span class="sxs-lookup"><span data-stu-id="48049-212">hello size of a node determines hello number of CPU cores, memory capacity, and local file system size that is allocated toohello node.</span></span> <span data-ttu-id="48049-213">您可以使用 Azure 雲端服務，從 hello 的映像，以建立集區的 Windows 或 Linux 節點[Azure 虛擬機器 Marketplace][vm_marketplace]，或您準備自訂映像。</span><span class="sxs-lookup"><span data-stu-id="48049-213">You can create pools of Windows or Linux nodes by using Azure Cloud Services, images from hello [Azure Virtual Machines Marketplace][vm_marketplace], or custom images that you prepare.</span></span> <span data-ttu-id="48049-214">請參閱下列資訊 hello[集區](#pool)> 一節，如需有關這些選項。</span><span class="sxs-lookup"><span data-stu-id="48049-214">See hello following [Pool](#pool) section for more information on these options.</span></span>

<span data-ttu-id="48049-215">節點可以執行任何可執行檔或指令碼支援的 hello 作業系統環境的 hello 節點。</span><span class="sxs-lookup"><span data-stu-id="48049-215">Nodes can run any executable or script that is supported by hello operating system environment of hello node.</span></span> <span data-ttu-id="48049-216">這包括適用於 Windows 的 \*.exe、\*.cmd、\*.bat 和 PowerShell 指令碼，以及適用於 Linux 的二進位檔、Shell 和 Python 指令碼。</span><span class="sxs-lookup"><span data-stu-id="48049-216">This includes \*.exe, \*.cmd, \*.bat and PowerShell scripts for Windows--and binaries, shell, and Python scripts for Linux.</span></span>

<span data-ttu-id="48049-217">Batch 中的所有計算節點也包括︰</span><span class="sxs-lookup"><span data-stu-id="48049-217">All compute nodes in Batch also include:</span></span>

* <span data-ttu-id="48049-218">工作可參考的標準[資料夾結構](#files-and-directories)與相關聯的[環境變數](#environment-settings-for-tasks)。</span><span class="sxs-lookup"><span data-stu-id="48049-218">A standard [folder structure](#files-and-directories) and associated [environment variables](#environment-settings-for-tasks) that are available for reference by tasks.</span></span>
* <span data-ttu-id="48049-219">**防火牆**之設定的設定 toocontrol 存取。</span><span class="sxs-lookup"><span data-stu-id="48049-219">**Firewall** settings that are configured toocontrol access.</span></span>
* <span data-ttu-id="48049-220">[遠端存取](#connecting-to-compute-nodes)tooboth (遠端桌面通訊協定 (RDP)) Windows 和 Linux (安全殼層 (SSH)) 節點。</span><span class="sxs-lookup"><span data-stu-id="48049-220">[Remote access](#connecting-to-compute-nodes) tooboth Windows (Remote Desktop Protocol (RDP)) and Linux (Secure Shell (SSH)) nodes.</span></span>

## <a name="pool"></a><span data-ttu-id="48049-221">集區</span><span class="sxs-lookup"><span data-stu-id="48049-221">Pool</span></span>
<span data-ttu-id="48049-222">集區是應用程式執行所在的一群節點。</span><span class="sxs-lookup"><span data-stu-id="48049-222">A pool is a collection of nodes that your application runs on.</span></span> <span data-ttu-id="48049-223">hello 集區可以手動建立，或自動 hello 批次服務時指定 hello 工作 toobe 完成。</span><span class="sxs-lookup"><span data-stu-id="48049-223">hello pool can be created manually by you, or automatically by hello Batch service when you specify hello work toobe done.</span></span> <span data-ttu-id="48049-224">您可以建立和管理的集區，以符合您的應用程式的 hello 資源需求。</span><span class="sxs-lookup"><span data-stu-id="48049-224">You can create and manage a pool that meets hello resource requirements of your application.</span></span> <span data-ttu-id="48049-225">集區僅供在其中建立 hello Batch 帳戶。</span><span class="sxs-lookup"><span data-stu-id="48049-225">A pool can be used only by hello Batch account in which it was created.</span></span> <span data-ttu-id="48049-226">批次帳戶可以有多個集區。</span><span class="sxs-lookup"><span data-stu-id="48049-226">A Batch account can have more than one pool.</span></span>

<span data-ttu-id="48049-227">在 hello 核心 Azure 運算平台上，建置 azure 批次集區。</span><span class="sxs-lookup"><span data-stu-id="48049-227">Azure Batch pools build on top of hello core Azure compute platform.</span></span> <span data-ttu-id="48049-228">它們提供大規模的配置、 應用程式安裝、 資料分佈、 健康狀態監控，以及彈性調整的運算節點區內 hello 數字 ([調整](#scaling-compute-resources))。</span><span class="sxs-lookup"><span data-stu-id="48049-228">They provide large-scale allocation, application installation, data distribution, health monitoring, and flexible adjustment of hello number of compute nodes within a pool ([scaling](#scaling-compute-resources)).</span></span>

<span data-ttu-id="48049-229">加入 tooa 集區的每個節點會指派唯一的名稱和 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="48049-229">Every node that is added tooa pool is assigned a unique name and IP address.</span></span> <span data-ttu-id="48049-230">當從集區移除節點時，toohello 作業系統或檔案所做的任何變更都會遺失，且其名稱和 IP 位址釋出供未來使用。</span><span class="sxs-lookup"><span data-stu-id="48049-230">When a node is removed from a pool, any changes that are made toohello operating system or files are lost, and its name and IP address are released for future use.</span></span> <span data-ttu-id="48049-231">當節點離開集區時，其存留期就結束。</span><span class="sxs-lookup"><span data-stu-id="48049-231">When a node leaves a pool, its lifetime is over.</span></span>

<span data-ttu-id="48049-232">當您建立一個集區時，您可以指定下列屬性的 hello。</span><span class="sxs-lookup"><span data-stu-id="48049-232">When you create a pool, you can specify hello following attributes.</span></span> <span data-ttu-id="48049-233">某些設定而有所不同，hello hello 批次的集區配置模式下[帳戶](#account):</span><span class="sxs-lookup"><span data-stu-id="48049-233">Some settings differ, depending on hello pool allocation mode of hello Batch [account](#account):</span></span>

- <span data-ttu-id="48049-234">計算節點作業系統和版本</span><span class="sxs-lookup"><span data-stu-id="48049-234">Compute node operating system and version</span></span>
- <span data-ttu-id="48049-235">計算節點類型和目標節點數目</span><span class="sxs-lookup"><span data-stu-id="48049-235">Compute node type and target number of nodes</span></span>
- <span data-ttu-id="48049-236">Hello 計算節點的大小</span><span class="sxs-lookup"><span data-stu-id="48049-236">Size of hello compute nodes</span></span>
- <span data-ttu-id="48049-237">調整原則</span><span class="sxs-lookup"><span data-stu-id="48049-237">Scaling policy</span></span>
- <span data-ttu-id="48049-238">工作排程原則</span><span class="sxs-lookup"><span data-stu-id="48049-238">Task scheduling policy</span></span>
- <span data-ttu-id="48049-239">計算節點的通訊狀態</span><span class="sxs-lookup"><span data-stu-id="48049-239">Communication status for compute nodes</span></span>
- <span data-ttu-id="48049-240">計算節點的啟動工作</span><span class="sxs-lookup"><span data-stu-id="48049-240">Start tasks for compute nodes</span></span>
- <span data-ttu-id="48049-241">應用程式封裝</span><span class="sxs-lookup"><span data-stu-id="48049-241">Application packages</span></span>
- <span data-ttu-id="48049-242">網路組態</span><span class="sxs-lookup"><span data-stu-id="48049-242">Network configuration</span></span>

<span data-ttu-id="48049-243">這些設定在 hello 下列各節中詳細說明。</span><span class="sxs-lookup"><span data-stu-id="48049-243">Each of these settings is described in more detail in hello following sections.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="48049-244">以 hello 批次服務集區配置模式下建立的批次帳戶有限制 hello 批次帳戶的核心數目的預設配額。</span><span class="sxs-lookup"><span data-stu-id="48049-244">Batch accounts created with hello Batch Service pool allocation mode have a default quota that limits hello number of cores in a Batch account.</span></span> <span data-ttu-id="48049-245">hello 核心數目對應 toohello 的運算節點數目。</span><span class="sxs-lookup"><span data-stu-id="48049-245">hello number of cores corresponds toohello number of compute nodes.</span></span> <span data-ttu-id="48049-246">您可以找到 hello 預設配額和指示如何太[增加配額](batch-quota-limit.md#increase-a-quota)中[hello Azure 批次服務的配額與限制](batch-quota-limit.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-246">You can find hello default quotas and instructions on how too[increase a quota](batch-quota-limit.md#increase-a-quota) in [Quotas and limits for hello Azure Batch service](batch-quota-limit.md).</span></span> <span data-ttu-id="48049-247">如果您的集區不達成其目標節點數目，hello 核心配額可能 hello 原因。</span><span class="sxs-lookup"><span data-stu-id="48049-247">If your pool is not achieving its target number of nodes, hello core quota might be hello reason.</span></span>
>
><span data-ttu-id="48049-248">以 hello 使用者訂用帳戶集區配置模式下建立的批次帳戶未觀察到的 hello 批次服務配額。</span><span class="sxs-lookup"><span data-stu-id="48049-248">Batch accounts created with hello User Subscription pool allocation mode do not observe hello Batch service quotas.</span></span> <span data-ttu-id="48049-249">相反地，它們共用在 hello hello 的核心配額指定訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="48049-249">Instead, they share in hello core quota for hello specified subscription.</span></span> <span data-ttu-id="48049-250">如需詳細資訊，請參閱 [Azure 訂用帳戶和服務限制、配額與條件約束](../azure-subscription-service-limits.md)中的 [虛擬機器限制](../azure-subscription-service-limits.md#virtual-machines-limits)。</span><span class="sxs-lookup"><span data-stu-id="48049-250">For more information, see [Virtual Machines limits](../azure-subscription-service-limits.md#virtual-machines-limits) in [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md).</span></span>
>
>

### <a name="compute-node-operating-system-and-version"></a><span data-ttu-id="48049-251">計算節點作業系統和版本</span><span class="sxs-lookup"><span data-stu-id="48049-251">Compute node operating system and version</span></span>

<span data-ttu-id="48049-252">當您建立的批次集區時，您可以指定 hello Azure 虛擬機器組態和 hello 類型的作業系統想 toorun hello 集區中每個計算節點上的系統。</span><span class="sxs-lookup"><span data-stu-id="48049-252">When you create a Batch pool, you can specify hello Azure virtual machine configuration and hello type of operating system you want toorun on each compute node in hello pool.</span></span> <span data-ttu-id="48049-253">hello 共有兩種設定可在批次中可：</span><span class="sxs-lookup"><span data-stu-id="48049-253">hello two types of configurations available in Batch are:</span></span>

- <span data-ttu-id="48049-254">hello**虛擬機器組態**，以指定該 hello 集區 Azure 虛擬機器所組成。</span><span class="sxs-lookup"><span data-stu-id="48049-254">hello **Virtual Machine Configuration**, which specifies that hello pool is comprised of Azure virtual machines.</span></span> <span data-ttu-id="48049-255">這些 VM 可能會從 Linux 或 Windows 映像加以建立。</span><span class="sxs-lookup"><span data-stu-id="48049-255">These VMs may be created from either Linux or Windows images.</span></span> 

    <span data-ttu-id="48049-256">當您建立 hello 虛擬機器組態為基礎的集區時，您必須指定不僅 hello 的 hello 節點的大小和 hello 映像使用 toocreate hello 來源，但也 hello**虛擬機器映像參考**和 hello批次**節點代理程式 SKU** toobe hello 節點上安裝。</span><span class="sxs-lookup"><span data-stu-id="48049-256">When you create a pool based on hello Virtual Machine Configuration, you must specify not only hello size of hello nodes and hello source of hello images used toocreate them, but also hello **virtual machine image reference** and hello Batch **node agent SKU** toobe installed on hello nodes.</span></span> <span data-ttu-id="48049-257">如需指定這些集區屬性的詳細資訊，請參閱 [在 Azure Batch 集區中佈建 Linux 計算節點](batch-linux-nodes.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-257">For more information about specifying these pool properties, see [Provision Linux compute nodes in Azure Batch pools](batch-linux-nodes.md).</span></span>

- <span data-ttu-id="48049-258">hello**雲端服務設定**，以指定該 hello 集區 Azure 雲端服務節點所組成。</span><span class="sxs-lookup"><span data-stu-id="48049-258">hello **Cloud Services Configuration**, which specifies that hello pool is comprised of Azure Cloud Services nodes.</span></span> <span data-ttu-id="48049-259">雲端服務組態「只」提供 Windows 計算節點。</span><span class="sxs-lookup"><span data-stu-id="48049-259">Cloud Services provide Windows compute nodes *only*.</span></span>

    <span data-ttu-id="48049-260">雲端服務設定集區的可用的作業系統會列在 hello [Azure 客體作業系統版本與 SDK 相容性比較表](../cloud-services/cloud-services-guestos-update-matrix.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-260">Available operating systems for Cloud Services Configuration pools are listed in hello [Azure Guest OS releases and SDK compatibility matrix](../cloud-services/cloud-services-guestos-update-matrix.md).</span></span> <span data-ttu-id="48049-261">當您建立包含雲端服務節點的集區時，您需要 toospecify hello 節點大小及其*OS 系列*。</span><span class="sxs-lookup"><span data-stu-id="48049-261">When you create a pool that contains Cloud Services nodes, you need toospecify hello node size and its *OS Family*.</span></span> <span data-ttu-id="48049-262">雲端服務是部署的 tooAzure 的速度會比執行 Windows 的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="48049-262">Cloud Services are deployed tooAzure more quickly than virtual machines running Windows.</span></span> <span data-ttu-id="48049-263">如果您需要 Windows 計算節點的集區，可能會發現雲端服務提供了部署時間方面的效能優勢。</span><span class="sxs-lookup"><span data-stu-id="48049-263">If you want pools of Windows compute nodes, you may find that Cloud Services provide a performance benefit in terms of deployment time.</span></span>

    * <span data-ttu-id="48049-264">hello *OS 系列*也會決定哪一個版本的.NET 安裝以 hello OS。</span><span class="sxs-lookup"><span data-stu-id="48049-264">hello *OS Family* also determines which versions of .NET are installed with hello OS.</span></span>
    * <span data-ttu-id="48049-265">與雲端服務中的背景工作角色，您可以指定*OS 版本*(如需背景工作角色的詳細資訊，請參閱 hello[告訴我雲端服務](../cloud-services/cloud-services-choose-me.md#tell-me-about-cloud-services)> 一節中 hello[雲端服務概觀](../cloud-services/cloud-services-choose-me.md))。</span><span class="sxs-lookup"><span data-stu-id="48049-265">As with worker roles within Cloud Services, you can specify an *OS Version* (for more information on worker roles, see hello [Tell me about cloud services](../cloud-services/cloud-services-choose-me.md#tell-me-about-cloud-services) section in hello [Cloud Services overview](../cloud-services/cloud-services-choose-me.md)).</span></span>
    * <span data-ttu-id="48049-266">因為背景工作角色，我們建議您指定`*`hello *OS 版本*以便 hello 節點會自動升級，而且沒有任何所需 toocater toonewly 發行版本。</span><span class="sxs-lookup"><span data-stu-id="48049-266">As with worker roles, we recommend that you specify `*` for hello *OS Version* so that hello nodes are automatically upgraded, and there is no work required toocater toonewly released versions.</span></span> <span data-ttu-id="48049-267">選取特定的作業系統版本的 hello 主要使用案例是 tooensure 應用程式相容性，可讓測試 toobe 允許 hello 版本 toobe 更新之前所執行的回溯相容性。</span><span class="sxs-lookup"><span data-stu-id="48049-267">hello primary use case for selecting a specific OS version is tooensure application compatibility, which allows backward compatibility testing toobe performed before allowing hello version toobe updated.</span></span> <span data-ttu-id="48049-268">在驗證之後 hello *OS 版本*可以更新 hello 集區可以安裝新作業系統映像 hello-針對任何正在執行的工作會被打斷並且排入佇列。</span><span class="sxs-lookup"><span data-stu-id="48049-268">After validation, hello *OS Version* for hello pool can be updated and hello new OS image can be installed--any running tasks are interrupted and requeued.</span></span>

<span data-ttu-id="48049-269">當您建立一個集區時，您必須 tooselect hello 適當**nodeAgentSkuId**，端視 hello OS hello 基底映像的 VHD。</span><span class="sxs-lookup"><span data-stu-id="48049-269">When you create a pool, you need tooselect hello appropriate **nodeAgentSkuId**, depending on hello OS of hello base image of your VHD.</span></span> <span data-ttu-id="48049-270">您可以取得可用的節點代理程式 SKU 識別碼傳回 tootheir 對應 OS 映像參考呼叫 hello[清單支援節點代理程式 Sku](https://docs.microsoft.com/rest/api/batchservice/list-supported-node-agent-skus)作業。</span><span class="sxs-lookup"><span data-stu-id="48049-270">You can get a mapping of available node agent SKU ID's tootheir OS Image references by calling hello [List Supported Node Agent SKUs](https://docs.microsoft.com/rest/api/batchservice/list-supported-node-agent-skus) operation.</span></span>

<span data-ttu-id="48049-271">請參閱 hello[帳戶](#account)> 一節，如需設定 hello 集區配置模式下，當您建立批次帳戶資訊。</span><span class="sxs-lookup"><span data-stu-id="48049-271">See hello [Account](#account) section for information on setting hello pool allocation mode when you create a Batch account.</span></span>

#### <a name="custom-images-for-virtual-machine-pools"></a><span data-ttu-id="48049-272">適用於虛擬機器集區的自訂映像</span><span class="sxs-lookup"><span data-stu-id="48049-272">Custom images for Virtual Machine pools</span></span>

<span data-ttu-id="48049-273">toouse 自訂映像 tooprovision 虛擬機器集區，建立您的 Batch 帳戶與 hello 使用者訂用帳戶集區配置模式。</span><span class="sxs-lookup"><span data-stu-id="48049-273">toouse a custom image tooprovision Virtual Machine pools, create your Batch account with hello User Subscription pool allocation mode.</span></span> <span data-ttu-id="48049-274">在此模式中，批次集區配置到 hello hello 帳戶所在的訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="48049-274">With this mode, Batch pools are allocated into hello subscription where hello account resides.</span></span> <span data-ttu-id="48049-275">請參閱 hello[帳戶](#account)> 一節，如需設定 hello 集區配置模式下，當您建立批次帳戶資訊。</span><span class="sxs-lookup"><span data-stu-id="48049-275">See hello [Account](#account) section for information on setting hello pool allocation mode when you create a Batch account.</span></span>

<span data-ttu-id="48049-276">toouse 自訂映像，您將需要 tooprepare hello 映像，將它一般化。</span><span class="sxs-lookup"><span data-stu-id="48049-276">toouse a custom image, you'll need tooprepare hello image by generalizing it.</span></span> <span data-ttu-id="48049-277">準備 Azure 的 Vm 所傳來的自訂 Linux 映像的相關資訊，請參閱[擷取做為範本 Azure Linux VM toouse](../virtual-machines/linux/capture-image-nodejs.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-277">For information about preparing custom Linux images from Azure VMs, see [Capture an Azure Linux VM toouse as a template](../virtual-machines/linux/capture-image-nodejs.md).</span></span> <span data-ttu-id="48049-278">如需有關從 Azure VM 準備自訂 Windows 映像的資訊，請參閱[使用 Azure PowerShell 建立自訂 VM 映像](../virtual-machines/windows/tutorial-custom-images.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-278">For information about preparing custom Windows images from Azure VMs, see [Create custom VM images with Azure PowerShell](../virtual-machines/windows/tutorial-custom-images.md).</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="48049-279">當您準備自訂映像，請記得 hello 下列：</span><span class="sxs-lookup"><span data-stu-id="48049-279">When preparing your custom image, keep in mind hello following:</span></span>
> - <span data-ttu-id="48049-280">請確定該 hello 基本 OS 映像使用的 tooprovision 您批次集區並沒有任何預先安裝 Azure 擴充功能，例如 hello 自訂指令碼延伸模組。</span><span class="sxs-lookup"><span data-stu-id="48049-280">Ensure that hello base OS image you use tooprovision your Batch pools does not have any pre-installed Azure extensions, such as hello Custom Script extension.</span></span> <span data-ttu-id="48049-281">如果 hello 映像包含預先安裝的擴充功能，則 Azure 可能會遇到部署 hello VM 的問題。</span><span class="sxs-lookup"><span data-stu-id="48049-281">If hello image contains a pre-installed extension, Azure may encounter problems deploying hello VM.</span></span>
> - <span data-ttu-id="48049-282">請確定該 hello 基本 OS 映像您提供使用 hello 預設暫存磁碟機，如 hello 批次節點代理程式目前必須要有 hello 預設暫存磁碟機。</span><span class="sxs-lookup"><span data-stu-id="48049-282">Ensure that hello base OS image you provide uses hello default temp drive, as hello Batch node agent currently expects hello default temp drive.</span></span>
>
>

<span data-ttu-id="48049-283">toocreate 使用自訂映像的虛擬機器組態集區，您將需要一個或更一般的 Azure 儲存體帳戶 toostore 自訂的 VHD 映像。</span><span class="sxs-lookup"><span data-stu-id="48049-283">toocreate a Virtual Machine Configuration pool using a custom image, you'll need one or more standard Azure Storage accounts toostore your custom VHD images.</span></span> <span data-ttu-id="48049-284">自訂映像會儲存為 blob。</span><span class="sxs-lookup"><span data-stu-id="48049-284">Custom images are stored as blobs.</span></span> <span data-ttu-id="48049-285">您的自訂映像時建立集區，tooreference 指定 hello hello hello 自訂映像 VHD blob 的 Uri [osDisk](https://docs.microsoft.com/rest/api/batchservice/add-a-pool-to-an-account#bk_osdisk)屬性 hello [virtualMachineConfiguration](https://docs.microsoft.com/rest/api/batchservice/add-a-pool-to-an-account#bk_vmconf)屬性。</span><span class="sxs-lookup"><span data-stu-id="48049-285">tooreference your custom images when you create a pool, specify hello URIs of hello custom image VHD blobs for hello [osDisk](https://docs.microsoft.com/rest/api/batchservice/add-a-pool-to-an-account#bk_osdisk) property of hello [virtualMachineConfiguration](https://docs.microsoft.com/rest/api/batchservice/add-a-pool-to-an-account#bk_vmconf) property.</span></span>

<span data-ttu-id="48049-286">請確定您的儲存體帳戶符合下列準則的 hello:</span><span class="sxs-lookup"><span data-stu-id="48049-286">Make sure that your storage accounts meet hello following criteria:</span></span>   

- <span data-ttu-id="48049-287">hello 儲存體帳戶包含 hello 自訂映像的 VHD blob 需要在 toobe hello 相同訂用帳戶，因為 hello 批次帳戶 （hello 使用者訂用帳戶）。</span><span class="sxs-lookup"><span data-stu-id="48049-287">hello storage accounts containing hello custom image VHD blobs need toobe in hello same subscription as hello Batch account (hello user subscription).</span></span>
- <span data-ttu-id="48049-288">hello 指定儲存體帳戶需要在 hello toobe hello Batch 帳戶與相同的區域。</span><span class="sxs-lookup"><span data-stu-id="48049-288">hello specified storage accounts need toobe in hello same region as hello Batch account.</span></span>
- <span data-ttu-id="48049-289">目前僅支援標準一般用途的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="48049-289">Only standard general-purpose storage accounts are currently supported.</span></span> <span data-ttu-id="48049-290">Hello 未來會支援 azure 高階儲存體。</span><span class="sxs-lookup"><span data-stu-id="48049-290">Azure Premium storage will be supported in hello future.</span></span>
- <span data-ttu-id="48049-291">您可以指定一個具有多個自訂 VHD blob 的儲存體帳戶，或是多個儲存體帳戶，每個皆具有單一的 blob。</span><span class="sxs-lookup"><span data-stu-id="48049-291">You can specify one storage account with multiple custom VHD blobs or multiple storage accounts each having a single blob.</span></span> <span data-ttu-id="48049-292">我們建議您 toouse 多個儲存體帳戶 tooget 更佳的效能。</span><span class="sxs-lookup"><span data-stu-id="48049-292">We recommend you toouse multiple storage accounts tooget a better performance.</span></span>
- <span data-ttu-id="48049-293">Too40 Linux VM 執行個體或 20 Windows VM 執行個體，可支援一個唯一的自訂映像的 VHD blob。</span><span class="sxs-lookup"><span data-stu-id="48049-293">One unique custom image VHD blob can support up too40 Linux VM instances or 20 Windows VM instances.</span></span> <span data-ttu-id="48049-294">您將需要 toocreate hello VHD blob toocreate 集區與多個 Vm 的副本。</span><span class="sxs-lookup"><span data-stu-id="48049-294">You will need toocreate copies of hello VHD blob toocreate pools with more VMs.</span></span> <span data-ttu-id="48049-295">例如，具有 200 Windows Vm 之集區需要 10 個唯一的 VHD blob 指定 hello **osDisk**屬性。</span><span class="sxs-lookup"><span data-stu-id="48049-295">For example, a pool with 200 Windows VMs needs 10 unique VHD blobs specified for hello **osDisk** property.</span></span>

<span data-ttu-id="48049-296">toocreate 使用 hello Azure 入口網站的自訂映像從集區：</span><span class="sxs-lookup"><span data-stu-id="48049-296">toocreate a pool from a custom image using hello Azure portal:</span></span>

1. <span data-ttu-id="48049-297">瀏覽 tooyour hello Azure 入口網站中的批次帳戶。</span><span class="sxs-lookup"><span data-stu-id="48049-297">Navigate tooyour Batch account in hello Azure portal.</span></span>
2. <span data-ttu-id="48049-298">在 hello**設定**刀鋒視窗中，選取 hello**集區**功能表項目。</span><span class="sxs-lookup"><span data-stu-id="48049-298">On hello **Settings** blade, select hello **Pools** menu item.</span></span>
3. <span data-ttu-id="48049-299">在 hello**集區**刀鋒視窗中，選取 hello**新增**hello; 命令**新增集區**刀鋒視窗會顯示。</span><span class="sxs-lookup"><span data-stu-id="48049-299">On hello **Pools** blade, select hello **Add** command; hello **Add pool** blade will be displayed.</span></span>
4. <span data-ttu-id="48049-300">選取**自訂映像 (Linux/Windows)**從 hello**映像類型**下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="48049-300">Select **Custom Image (Linux/Windows)** from hello **Image Type** dropdown.</span></span> <span data-ttu-id="48049-301">hello 入口網站會顯示 hello**自訂映像**選擇器。</span><span class="sxs-lookup"><span data-stu-id="48049-301">hello portal displays hello **Custom Image** picker.</span></span> <span data-ttu-id="48049-302">從 hello 選擇一或多個 Vhd 相同的容器，按一下 hello**選取** 按鈕。</span><span class="sxs-lookup"><span data-stu-id="48049-302">Choose one or more VHDs from hello same container and click hello **Select** button.</span></span> 
    <span data-ttu-id="48049-303">將加入支援多個 Vhd，從不同的儲存體帳戶和不同的容器，在未來的 hello。</span><span class="sxs-lookup"><span data-stu-id="48049-303">Support for multiple VHDs from different storage accounts and different containers will be added in hello future.</span></span>
5. <span data-ttu-id="48049-304">選取正確的 hello **Sku/方案發行者/**您自訂的 Vhd，請選取所需的 hello**快取**模式中，然後在所有的填滿 hello hello 集區的其他參數。</span><span class="sxs-lookup"><span data-stu-id="48049-304">Select hello correct **Publisher/Offer/Sku** for your custom VHDs, select hello desired **Caching** mode, then fill in all hello other parameters for hello pool.</span></span>
6. <span data-ttu-id="48049-305">toocheck 如果集區為基礎的自訂映像，請參閱 hello**作業系統**屬性中的 hello hello 資源摘要區段**集區**刀鋒視窗。</span><span class="sxs-lookup"><span data-stu-id="48049-305">toocheck if a pool is based on a custom image, see hello **Operating System** property in hello resource summary section of hello **Pool** blade.</span></span> <span data-ttu-id="48049-306">hello 這個屬性的值應該是**自訂 VM 映像**。</span><span class="sxs-lookup"><span data-stu-id="48049-306">hello value of this property should be **Custom VM image**.</span></span>
7. <span data-ttu-id="48049-307">集區相關聯的所有自訂 Vhd 會顯示在集區 hello**屬性**刀鋒視窗。</span><span class="sxs-lookup"><span data-stu-id="48049-307">All custom VHDs associated with a pool are displayed on hello pool's **Properties** blade.</span></span>

### <a name="compute-node-type-and-target-number-of-nodes"></a><span data-ttu-id="48049-308">計算節點類型和目標節點數目</span><span class="sxs-lookup"><span data-stu-id="48049-308">Compute node type and target number of nodes</span></span>

<span data-ttu-id="48049-309">當您建立一個集區時，您可以指定哪些類型的計算節點，並針對每個 hello 目標數目。</span><span class="sxs-lookup"><span data-stu-id="48049-309">When you create a pool, you can specify which types of compute nodes you want and hello target number for each.</span></span> <span data-ttu-id="48049-310">計算節點的 hello 兩個類型為：</span><span class="sxs-lookup"><span data-stu-id="48049-310">hello two types of compute nodes are:</span></span>

- <span data-ttu-id="48049-311">**專用計算節點。**</span><span class="sxs-lookup"><span data-stu-id="48049-311">**Dedicated compute nodes.**</span></span> <span data-ttu-id="48049-312">專用計算節點會保留給您的工作負載使用。</span><span class="sxs-lookup"><span data-stu-id="48049-312">Dedicated compute nodes are reserved for your workloads.</span></span> <span data-ttu-id="48049-313">它們會比低優先權的節點更為昂貴，但保證 toonever 清空。</span><span class="sxs-lookup"><span data-stu-id="48049-313">They are more expensive than low-priority nodes, but they are guaranteed toonever be preempted.</span></span>

- <span data-ttu-id="48049-314">**低優先順序的計算節點。**</span><span class="sxs-lookup"><span data-stu-id="48049-314">**Low-priority compute nodes.**</span></span> <span data-ttu-id="48049-315">低優先權的節點多餘的容量在中充分利用 Azure toorun 批次的工作負載。</span><span class="sxs-lookup"><span data-stu-id="48049-315">Low-priority nodes take advantage of surplus capacity in Azure toorun your Batch workloads.</span></span> <span data-ttu-id="48049-316">低優先順序的節點每小時比專用節點更便宜，並可啟用需要大量計算能力的工作負載。</span><span class="sxs-lookup"><span data-stu-id="48049-316">Low-priority nodes are less expensive per hour than dedicated nodes, and enable workloads requiring a lot of compute power.</span></span> <span data-ttu-id="48049-317">如需詳細資訊，請參閱[使用低優先順序的 VM 搭配 Batch](batch-low-pri-vms.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-317">For more information, see [Use low-priority VMs with Batch](batch-low-pri-vms.md).</span></span>

    <span data-ttu-id="48049-318">Azure 多餘的容量不足時，可能會佔用低優先順序的計算節點。</span><span class="sxs-lookup"><span data-stu-id="48049-318">Low-priority compute nodes may be preempted when Azure has insufficient surplus capacity.</span></span> <span data-ttu-id="48049-319">如果節點先佔時執行工作時，hello 工作會排入佇列，然後再次執行，一旦計算節點再次變為無法使用。</span><span class="sxs-lookup"><span data-stu-id="48049-319">If a node is preempted while running tasks, hello tasks are requeued and run again once a compute node becomes available again.</span></span> <span data-ttu-id="48049-320">低優先權的節點會是很適合用於工作負載 hello 作業完成時間是彈性以及 hello 工作分散到多的節點。</span><span class="sxs-lookup"><span data-stu-id="48049-320">Low-priority nodes are a good option for workloads where hello job completion time is flexible and hello work is distributed across many nodes.</span></span> <span data-ttu-id="48049-321">在您的案例決定 toouse 低優先權的節點之前，請確定任何工作，會遺失，因為 toopreemption 會最少且容易 toorecreate。</span><span class="sxs-lookup"><span data-stu-id="48049-321">Before you decide toouse low-priority nodes for your scenario, make sure that any work lost due toopreemption will be minimal and easy toorecreate.</span></span>

    <span data-ttu-id="48049-322">只會針對批次帳戶建立 hello 集區配置模式下設定太低優先順序的計算節點可用**批次服務**。</span><span class="sxs-lookup"><span data-stu-id="48049-322">Low-priority compute nodes are available only for Batch accounts created with hello pool allocation mode set too**Batch Service**.</span></span>

<span data-ttu-id="48049-323">您可以在 hello 這兩個低優先權置和專用的運算節點相同的集區。</span><span class="sxs-lookup"><span data-stu-id="48049-323">You can have both low-priority and dedicated compute nodes in hello same pool.</span></span> <span data-ttu-id="48049-324">每個節點類型&mdash;低優先權置和專用&mdash;有它自己的目標設定，可以指定預期的 hello 節點數目。</span><span class="sxs-lookup"><span data-stu-id="48049-324">Each type of node &mdash; low-priority and dedicated &mdash; has its own target setting, for which you can specify hello desired number of nodes.</span></span> 
    
<span data-ttu-id="48049-325">hello 的運算節點數目是參照的 tooas*目標*因為在某些情況下，您的集區可能無法送達預期的 hello 節點數目。</span><span class="sxs-lookup"><span data-stu-id="48049-325">hello number of compute nodes is referred tooas a *target* because, in some situations, your pool might not reach hello desired number of nodes.</span></span> <span data-ttu-id="48049-326">例如，集區可能無法達成 hello 目標若達到 hello[核心配額](batch-quota-limit.md)您批次帳戶第一次。</span><span class="sxs-lookup"><span data-stu-id="48049-326">For example, a pool might not achieve hello target if it reaches hello [core quota](batch-quota-limit.md) for your Batch account first.</span></span> <span data-ttu-id="48049-327">或 hello 集區可能無法達成 hello 目標，如果您已套用的自動調整公式 toohello 集區，以限制 hello 的節點數目上限。</span><span class="sxs-lookup"><span data-stu-id="48049-327">Or, hello pool might not achieve hello target if you have applied an auto-scaling formula toohello pool that limits hello maximum number of nodes.</span></span>

<span data-ttu-id="48049-328">如需低優先順序和專用計算節點的價格資訊，請參閱 [Batch 價格](https://azure.microsoft.com/pricing/details/batch/)。</span><span class="sxs-lookup"><span data-stu-id="48049-328">For pricing information for both low-priority and dedicated compute nodes, see [Batch Pricing](https://azure.microsoft.com/pricing/details/batch/).</span></span>

### <a name="size-of-hello-compute-nodes"></a><span data-ttu-id="48049-329">Hello 計算節點的大小</span><span class="sxs-lookup"><span data-stu-id="48049-329">Size of hello compute nodes</span></span>

<span data-ttu-id="48049-330">**雲端服務組態** 計算節點大小會列於 [雲端服務的大小](../cloud-services/cloud-services-sizes-specs.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-330">**Cloud Services Configuration** compute node sizes are listed in [Sizes for Cloud Services](../cloud-services/cloud-services-sizes-specs.md).</span></span> <span data-ttu-id="48049-331">Batch 支援 `ExtraSmall`、`STANDARD_A1_V2` 和 `STANDARD_A2_V2` 以外的所有雲端服務大小。</span><span class="sxs-lookup"><span data-stu-id="48049-331">Batch supports all Cloud Services sizes except `ExtraSmall`, `STANDARD_A1_V2`, and `STANDARD_A2_V2`.</span></span>

<span data-ttu-id="48049-332">[虛擬機器組態] 計算節點大小列於 [Azure 中的虛擬機器大小](../virtual-machines/linux/sizes.md) (Linux) 和 [Azure 中的虛擬機器大小](../virtual-machines/windows/sizes.md) (Windows)。</span><span class="sxs-lookup"><span data-stu-id="48049-332">**Virtual Machine Configuration** compute node sizes are listed in [Sizes for virtual machines in Azure](../virtual-machines/linux/sizes.md) (Linux) and [Sizes for virtual machines in Azure](../virtual-machines/windows/sizes.md) (Windows).</span></span> <span data-ttu-id="48049-333">除了 `STANDARD_A0` 和進階儲存體的大小 (`STANDARD_GS`、`STANDARD_DS` 和 `STANDARD_DSV2` 系列) 以外，Batch 支援所有的 Azure VM 大小。</span><span class="sxs-lookup"><span data-stu-id="48049-333">Batch supports all Azure VM sizes except `STANDARD_A0` and those with premium storage (`STANDARD_GS`, `STANDARD_DS`, and `STANDARD_DSV2` series).</span></span>

<span data-ttu-id="48049-334">選取時計算節點大小，請考慮 hello 特性和 hello hello 節點，您將執行的應用程式的需求。</span><span class="sxs-lookup"><span data-stu-id="48049-334">When selecting a compute node size, consider hello characteristics and requirements of hello applications you'll run on hello nodes.</span></span> <span data-ttu-id="48049-335">層面，例如是否 hello 應用程式是多執行緒和會耗用多少記憶體可協助判斷 hello 最適當且符合成本效益節點大小。</span><span class="sxs-lookup"><span data-stu-id="48049-335">Aspects like whether hello application is multithreaded and how much memory it consumes can help determine hello most suitable and cost-effective node size.</span></span> <span data-ttu-id="48049-336">它是一般 tooselect 假設一項工作的節點大小將會在節點執行一次。</span><span class="sxs-lookup"><span data-stu-id="48049-336">It's typical tooselect a node size assuming one task will run on a node at a time.</span></span> <span data-ttu-id="48049-337">不過，很可能 toohave 多個工作 （並因此多個應用程式執行個體）[平行執行](batch-parallel-node-tasks.md)在作業執行期間計算節點。</span><span class="sxs-lookup"><span data-stu-id="48049-337">However, it is possible toohave multiple tasks (and therefore multiple application instances) [run in parallel](batch-parallel-node-tasks.md) on compute nodes during job execution.</span></span> <span data-ttu-id="48049-338">在此案例中很常見 toochoose 較大節點大小 tooaccommodate hello 增加的要求平行工作執行。</span><span class="sxs-lookup"><span data-stu-id="48049-338">In this case, it is common toochoose a larger node size tooaccommodate hello increased demand of parallel task execution.</span></span> <span data-ttu-id="48049-339">如需詳細資訊，請參閱[工作排程原則](#task-scheduling-policy)。</span><span class="sxs-lookup"><span data-stu-id="48049-339">See [Task scheduling policy](#task-scheduling-policy) for more information.</span></span>

<span data-ttu-id="48049-340">所有集區中的 hello 節點都 hello 相同大小。</span><span class="sxs-lookup"><span data-stu-id="48049-340">All of hello nodes in a pool are hello same size.</span></span> <span data-ttu-id="48049-341">如果您想 toorun 應用程式使用不同的系統需求和 （或） 載入層級，我們建議您使用不同的集區。</span><span class="sxs-lookup"><span data-stu-id="48049-341">If you intend toorun applications with differing system requirements and/or load levels, we recommend that you use separate pools.</span></span>

### <a name="scaling-policy"></a><span data-ttu-id="48049-342">調整原則</span><span class="sxs-lookup"><span data-stu-id="48049-342">Scaling policy</span></span>

<span data-ttu-id="48049-343">針對動態的工作負載，您可以撰寫，並套用[的自動調整公式](#scaling-compute-resources)tooa 集區。</span><span class="sxs-lookup"><span data-stu-id="48049-343">For dynamic workloads, you can write and apply an [auto-scaling formula](#scaling-compute-resources) tooa pool.</span></span> <span data-ttu-id="48049-344">hello 批次服務會定期評估您的公式，並調整 hello 節點區內 hello 根據不同的集區、 作業，以及您可以指定的工作參數的數目。</span><span class="sxs-lookup"><span data-stu-id="48049-344">hello Batch service periodically evaluates your formula and adjusts hello number of nodes within hello pool based on various pool, job, and task parameters that you can specify.</span></span>

### <a name="task-scheduling-policy"></a><span data-ttu-id="48049-345">工作排程原則</span><span class="sxs-lookup"><span data-stu-id="48049-345">Task scheduling policy</span></span>

<span data-ttu-id="48049-346">hello[工作，每個節點的最大](batch-parallel-node-tasks.md)組態選項會決定 hello 可以平行執行 hello 集區中每個計算節點上的工作數目上限。</span><span class="sxs-lookup"><span data-stu-id="48049-346">hello [max tasks per node](batch-parallel-node-tasks.md) configuration option determines hello maximum number of tasks that can be run in parallel on each compute node within hello pool.</span></span>

<span data-ttu-id="48049-347">hello 預設組態會指定節點上，執行一次一項工作，但是有很有幫助 toohave 案例的節點上同時執行兩個或多個工作。</span><span class="sxs-lookup"><span data-stu-id="48049-347">hello default configuration specifies that one task at a time runs on a node, but there are scenarios where it is beneficial toohave two or more tasks executed on a node simultaneously.</span></span> <span data-ttu-id="48049-348">請參閱 hello[範例案例](batch-parallel-node-tasks.md#example-scenario)在 hello[並行節點工作](batch-parallel-node-tasks.md)文章 toosee 如何從每個節點的多個工作可以受益。</span><span class="sxs-lookup"><span data-stu-id="48049-348">See hello [example scenario](batch-parallel-node-tasks.md#example-scenario) in hello [concurrent node tasks](batch-parallel-node-tasks.md) article toosee how you can benefit from multiple tasks per node.</span></span>

<span data-ttu-id="48049-349">您也可以指定*填滿類型*可判斷是否位於集區中的所有節點間平均散佈 hello 工作批次，或指派工作 tooanother 節點之前組件以 hello 工作最大數目的每個節點。</span><span class="sxs-lookup"><span data-stu-id="48049-349">You can also specify a *fill type* which determines whether Batch spreads hello tasks evenly across all nodes in a pool, or packs each node with hello maximum number of tasks before assigning tasks tooanother node.</span></span>

### <a name="communication-status-for-compute-nodes"></a><span data-ttu-id="48049-350">計算節點的通訊狀態</span><span class="sxs-lookup"><span data-stu-id="48049-350">Communication status for compute nodes</span></span>

<span data-ttu-id="48049-351">在大部分情況下，工作會獨立運作，而且不需要 toocommunicate 彼此。</span><span class="sxs-lookup"><span data-stu-id="48049-351">In most scenarios, tasks operate independently and do not need toocommunicate with one another.</span></span> <span data-ttu-id="48049-352">不過，有一些工作必須進行通訊的應用程式，例如 [MPI 案例](batch-mpi.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-352">However, there are some applications in which tasks must communicate, like [MPI scenarios](batch-mpi.md).</span></span>

<span data-ttu-id="48049-353">您可以設定集區 tooallow**節點間通訊**，如此一來，集區中的節點可以在執行階段通訊。</span><span class="sxs-lookup"><span data-stu-id="48049-353">You can configure a pool tooallow **internode communication**, so that nodes within a pool can communicate at runtime.</span></span> <span data-ttu-id="48049-354">啟用節點間通訊時，[雲端服務組態] 集區中的節點可以在超過 1100 個連接埠上彼此通訊，而且 [虛擬機器組態] 集區並不會限制任何連接埠的流量。</span><span class="sxs-lookup"><span data-stu-id="48049-354">When internode communication is enabled, nodes in Cloud Services Configuration pools can communicate with each other on ports greater than 1100, and Virtual Machine Configuration pools do not restrict traffic on any port.</span></span>

<span data-ttu-id="48049-355">請注意，啟用節點間通訊也會影響叢集內的 hello 節點 hello 放置可能會由於部署的限制限制 hello 的集區中的節點數目上限。</span><span class="sxs-lookup"><span data-stu-id="48049-355">Note that enabling internode communication also impacts hello placement of hello nodes within clusters and might limit hello maximum number of nodes in a pool because of deployment restrictions.</span></span> <span data-ttu-id="48049-356">如果您的應用程式不需要節點之間的通訊，hello 批次服務可以配置可能有大量節點 toohello 集區從許多不同的叢集和資料中心 tooenable 增加平行處理能力。</span><span class="sxs-lookup"><span data-stu-id="48049-356">If your application does not require communication between nodes, hello Batch service can allocate a potentially large number of nodes toohello pool from many different clusters and datacenters tooenable increased parallel processing power.</span></span>

### <a name="start-tasks-for-compute-nodes"></a><span data-ttu-id="48049-357">計算節點的啟動工作</span><span class="sxs-lookup"><span data-stu-id="48049-357">Start tasks for compute nodes</span></span>

<span data-ttu-id="48049-358">選擇性的 hello*啟動工作*該節點會加入 hello 集區，而且每次節點重新啟動或重新安裝映像的每個節點上執行。</span><span class="sxs-lookup"><span data-stu-id="48049-358">hello optional *start task* executes on each node as that node joins hello pool, and each time a node is restarted or reimaged.</span></span> <span data-ttu-id="48049-359">hello 啟動工作是特別適用於運算節點準備 hello 執行的工作，例如安裝 hello 計算節點執行您的工作的 hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="48049-359">hello start task is especially useful for preparing compute nodes for hello execution of tasks, like installing hello applications that your tasks run on hello compute nodes.</span></span>

### <a name="application-packages"></a><span data-ttu-id="48049-360">應用程式封裝</span><span class="sxs-lookup"><span data-stu-id="48049-360">Application packages</span></span>

<span data-ttu-id="48049-361">您可以指定[應用程式封裝](#application-packages)toodeploy toohello 計算 hello 集區中的節點。</span><span class="sxs-lookup"><span data-stu-id="48049-361">You can specify [application packages](#application-packages) toodeploy toohello compute nodes in hello pool.</span></span> <span data-ttu-id="48049-362">應用程式套件提供簡化的部署和版本管理您的工作執行的 hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="48049-362">Application packages provide simplified deployment and versioning of hello applications that your tasks run.</span></span> <span data-ttu-id="48049-363">您針對集區指定的應用程式封裝會安裝於加入該集區的每個節點，以及在節點重新啟動或重新安裝映像時安裝。</span><span class="sxs-lookup"><span data-stu-id="48049-363">Application packages that you specify for a pool are installed on every node that joins that pool, and every time a node is rebooted or reimaged.</span></span>

> [!NOTE]
> <span data-ttu-id="48049-364">在 2017 年 7 月 5 日之後建立的所有 Batch 集區都支援應用程式套件。</span><span class="sxs-lookup"><span data-stu-id="48049-364">Application packages are supported on all Batch pools created after 5 July 2017.</span></span> <span data-ttu-id="48049-365">只有建立 hello 集區時使用的雲端服務組態，10 年 3 月 2016年和 5 年 7 月 2017年之間建立的批次集區中支援它們。</span><span class="sxs-lookup"><span data-stu-id="48049-365">They are supported on Batch pools created between 10 March 2016 and 5 July 2017 only if hello pool was created using a Cloud Service configuration.</span></span> <span data-ttu-id="48049-366">建立先前 too10 2016 年 3 月的批次集區不支援應用程式封裝。</span><span class="sxs-lookup"><span data-stu-id="48049-366">Batch pools created prior too10 March 2016 do not support application packages.</span></span> <span data-ttu-id="48049-367">如需有關使用應用程式套件 toodeploy 您應用程式 tooyour 批次的節點，請參閱[部署與批次應用程式套件的應用程式 toocompute 節點](batch-application-packages.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-367">For more information about using application packages toodeploy your applications tooyour Batch nodes, see [Deploy applications toocompute nodes with Batch application packages](batch-application-packages.md).</span></span>
>
>

### <a name="network-configuration"></a><span data-ttu-id="48049-368">網路組態</span><span class="sxs-lookup"><span data-stu-id="48049-368">Network configuration</span></span>

<span data-ttu-id="48049-369">您可以指定 hello Azure 子網路[虛擬網路 (VNet)](../virtual-network/virtual-networks-overview.md)應在哪個 hello 集區計算建立節點。</span><span class="sxs-lookup"><span data-stu-id="48049-369">You can specify hello subnet of an Azure [virtual network (VNet)](../virtual-network/virtual-networks-overview.md) in which hello pool's compute nodes should be created.</span></span> <span data-ttu-id="48049-370">請參閱 hello[集區的網路設定](#pool-network-configuration)節的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="48049-370">See hello [Pool network configuration](#pool-network-configuration) section for more information.</span></span>


## <a name="job"></a><span data-ttu-id="48049-371">作業</span><span class="sxs-lookup"><span data-stu-id="48049-371">Job</span></span>
<span data-ttu-id="48049-372">作業是工作的集合。</span><span class="sxs-lookup"><span data-stu-id="48049-372">A job is a collection of tasks.</span></span> <span data-ttu-id="48049-373">它會管理其工作集區中的 hello 計算節點上執行計算的方式。</span><span class="sxs-lookup"><span data-stu-id="48049-373">It manages how computation is performed by its tasks on hello compute nodes in a pool.</span></span>

* <span data-ttu-id="48049-374">指定 hello hello 工作**集區**在哪一個 hello 工作是 toobe 執行。</span><span class="sxs-lookup"><span data-stu-id="48049-374">hello job specifies hello **pool** in which hello work is toobe run.</span></span> <span data-ttu-id="48049-375">您可以為每個作業建立新的集區，或將集區使用於許多工作。</span><span class="sxs-lookup"><span data-stu-id="48049-375">You can create a new pool for each job, or use one pool for many jobs.</span></span> <span data-ttu-id="48049-376">您可以針對與作業排程相關聯的每項作業建立集區，或針對與作業排程相關聯的所有作業建立集區。</span><span class="sxs-lookup"><span data-stu-id="48049-376">You can create a pool for each job that is associated with a job schedule, or for all jobs that are associated with a job schedule.</span></span>
* <span data-ttu-id="48049-377">您可以指定選擇性的 **作業優先順序**。</span><span class="sxs-lookup"><span data-stu-id="48049-377">You can specify an optional **job priority**.</span></span> <span data-ttu-id="48049-378">工作提交具有較高的優先順序比目前正在進行中的工作之後，hello hello 較高優先順序作業的工作會插入到 hello 佇列前面 hello 較低優先順序的工作的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-378">When a job is submitted with a higher priority than jobs that are currently in progress, hello tasks for hello higher-priority job are inserted into hello queue ahead of tasks for hello lower-priority jobs.</span></span> <span data-ttu-id="48049-379">已在執行中的較低優先順序作業中的工作不會被優先佔用。</span><span class="sxs-lookup"><span data-stu-id="48049-379">Tasks in lower-priority jobs that are already running are not preempted.</span></span>
* <span data-ttu-id="48049-380">您可以使用作業**條件約束**toospecify 某些限制為您的工作：</span><span class="sxs-lookup"><span data-stu-id="48049-380">You can use job **constraints** toospecify certain limits for your jobs:</span></span>

    <span data-ttu-id="48049-381">您可以設定**最大 wallclock 時間**，如此一來，如果工作執行的時間超過指定的 hello wallclock 最大時間，hello 工作和所有的工作都會終止。</span><span class="sxs-lookup"><span data-stu-id="48049-381">You can set a **maximum wallclock time**, so that if a job runs for longer than hello maximum wallclock time that is specified, hello job and all of its tasks are terminated.</span></span>

    <span data-ttu-id="48049-382">Batch 可以偵測並重試失敗的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-382">Batch can detect and then retry failed tasks.</span></span> <span data-ttu-id="48049-383">您可以指定 hello**工作重試次數上限**做為條件約束，包括工作是否*一律*或*從未*重試。</span><span class="sxs-lookup"><span data-stu-id="48049-383">You can specify hello **maximum number of task retries** as a constraint, including whether a task is *always* or *never* retried.</span></span> <span data-ttu-id="48049-384">重試工作表示該 hello 工作排入佇列的 toobe 再執行一次。</span><span class="sxs-lookup"><span data-stu-id="48049-384">Retrying a task means that hello task is requeued toobe run again.</span></span>
* <span data-ttu-id="48049-385">用戶端應用程式可以加入工作 tooa 作業，或者您可以指定[作業管理員工作](#job-manager-task)。</span><span class="sxs-lookup"><span data-stu-id="48049-385">Your client application can add tasks tooa job, or you can specify a [job manager task](#job-manager-task).</span></span> <span data-ttu-id="48049-386">作業管理員工作包含作業的必要 toocreate hello 所需工作的 hello 資訊、 與 hello 作業管理員工作在其中一個 hello 上正在執行中的計算節點 hello 集區。</span><span class="sxs-lookup"><span data-stu-id="48049-386">A job manager task contains hello information that is necessary toocreate hello required tasks for a job, with hello job manager task being run on one of hello compute nodes in hello pool.</span></span> <span data-ttu-id="48049-387">hello 作業管理員工作會處理批次-由具體它已排入佇列只要 hello 工作建立時，並重新啟動失敗。</span><span class="sxs-lookup"><span data-stu-id="48049-387">hello job manager task is handled specifically by Batch--it is queued as soon as hello job is created, and is restarted if it fails.</span></span> <span data-ttu-id="48049-388">作業管理員工作是*必要*工作所建立的[作業排程](#scheduled-jobs)，所以 hello 唯一方式 toodefine hello 工作 hello 工作具現化之前。</span><span class="sxs-lookup"><span data-stu-id="48049-388">A job manager task is *required* for jobs that are created by a [job schedule](#scheduled-jobs) because it is hello only way toodefine hello tasks before hello job is instantiated.</span></span>
* <span data-ttu-id="48049-389">根據預設，工作 hello 作用中狀態時維持 hello 作業內的所有工作都都已完成。</span><span class="sxs-lookup"><span data-stu-id="48049-389">By default, jobs remain in hello active state when all tasks within hello job are complete.</span></span> <span data-ttu-id="48049-390">使 hello 作業會自動終止 hello 作業中的所有工作完成時，您可以變更此行為。</span><span class="sxs-lookup"><span data-stu-id="48049-390">You can change this behavior so that hello job is automatically terminated when all tasks in hello job are complete.</span></span> <span data-ttu-id="48049-391">集 hello 作業的**onAllTasksComplete**屬性 ([OnAllTasksComplete] [ net_onalltaskscomplete]在批次.NET) 太*terminatejob* tooautomatically所有的工作會處於 hello 完成狀態，請終止 hello 工作。</span><span class="sxs-lookup"><span data-stu-id="48049-391">Set hello job's **onAllTasksComplete** property ([OnAllTasksComplete][net_onalltaskscomplete] in Batch .NET) too*terminatejob* tooautomatically terminate hello job when all of its tasks are in hello completed state.</span></span>

    <span data-ttu-id="48049-392">請注意 hello 批次服務會考量與工作*沒有*工作 toohave 所有的工作完成。</span><span class="sxs-lookup"><span data-stu-id="48049-392">Note that hello Batch service considers a job with *no* tasks toohave all of its tasks completed.</span></span> <span data-ttu-id="48049-393">因此，這個選項最常搭配 [作業管理員工作](#job-manager-task)使用。</span><span class="sxs-lookup"><span data-stu-id="48049-393">Therefore, this option is most commonly used with a [job manager task](#job-manager-task).</span></span> <span data-ttu-id="48049-394">如果您想 toouse 自動作業終止，而不是工作管理員，您應該一開始會設定新的工作**onAllTasksComplete**屬性太*noaction*，然後將它設定太*terminatejob*只完成新增工作 toohello 工作之後。</span><span class="sxs-lookup"><span data-stu-id="48049-394">If you want toouse automatic job termination without a job manager, you should initially set a new job's **onAllTasksComplete** property too*noaction*, then set it too*terminatejob* only after you've finished adding tasks toohello job.</span></span>

### <a name="job-priority"></a><span data-ttu-id="48049-395">作業優先順序</span><span class="sxs-lookup"><span data-stu-id="48049-395">Job priority</span></span>
<span data-ttu-id="48049-396">您可以指派優先權 toojobs 在批次中所建立。</span><span class="sxs-lookup"><span data-stu-id="48049-396">You can assign a priority toojobs that you create in Batch.</span></span> <span data-ttu-id="48049-397">hello 批次服務將使用 hello hello 作業 toodetermine hello 順序的工作排程帳戶內的優先順序值 (這不是與混淆的 toobe[排程的工作](#scheduled-jobs))。</span><span class="sxs-lookup"><span data-stu-id="48049-397">hello Batch service uses hello priority value of hello job toodetermine hello order of job scheduling within an account (this is not toobe confused with a [scheduled job](#scheduled-jobs)).</span></span> <span data-ttu-id="48049-398">hello 優先順序值的範圍從-1000 too1000，與-1000 hello 最低優先順序，1000年正在 hello 最高。</span><span class="sxs-lookup"><span data-stu-id="48049-398">hello priority values range from -1000 too1000, with -1000 being hello lowest priority and 1000 being hello highest.</span></span> <span data-ttu-id="48049-399">tooupdate hello 優先順序的作業時，呼叫 hello[更新作業的 hello 屬性][ rest_update_job]作業 (批次 REST)，或修改 hello [CloudJob.Priority] [ net_cloudjob_priority]屬性 (批次.NET)。</span><span class="sxs-lookup"><span data-stu-id="48049-399">tooupdate hello priority of a job, call hello [Update hello properties of a job][rest_update_job] operation (Batch REST), or modify hello [CloudJob.Priority][net_cloudjob_priority] property (Batch .NET).</span></span>

<span data-ttu-id="48049-400">Hello 內使用相同帳戶，較高優先順序的作業會排程優先於優先順序較低的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-400">Within hello same account, higher-priority jobs have scheduling precedence over lower-priority jobs.</span></span> <span data-ttu-id="48049-401">一個帳戶中具有較高優先順序值的作業，其排程優先順序並不高於不同帳戶中較低優先順序值的另一項作業。</span><span class="sxs-lookup"><span data-stu-id="48049-401">A job with a higher-priority value in one account does not have scheduling precedence over another job with a lower-priority value in a different account.</span></span>

<span data-ttu-id="48049-402">不同集區的作業排程是獨立的。</span><span class="sxs-lookup"><span data-stu-id="48049-402">Job scheduling across pools is independent.</span></span> <span data-ttu-id="48049-403">在不同的集區之間，即使作業的優先順序較高，如果其相關聯的集區缺少閒置的節點，並不保證此作業會優先排程。</span><span class="sxs-lookup"><span data-stu-id="48049-403">Between different pools, it is not guaranteed that a higher-priority job is scheduled first if its associated pool is short of idle nodes.</span></span> <span data-ttu-id="48049-404">在 hello 相同的集區作業以 hello 相同優先權層級機會都相同的排程。</span><span class="sxs-lookup"><span data-stu-id="48049-404">In hello same pool, jobs with hello same priority level have an equal chance of being scheduled.</span></span>

### <a name="scheduled-jobs"></a><span data-ttu-id="48049-405">Scheduled jobs</span><span class="sxs-lookup"><span data-stu-id="48049-405">Scheduled jobs</span></span>
<span data-ttu-id="48049-406">[工作排程][ rest_job_schedules] toocreate hello 批次服務內的週期性工作可讓您。</span><span class="sxs-lookup"><span data-stu-id="48049-406">[Job schedules][rest_job_schedules] enable you toocreate recurring jobs within hello Batch service.</span></span> <span data-ttu-id="48049-407">作業排程指定 toorun 作業，並且包含執行 hello 作業 toobe hello 規格。</span><span class="sxs-lookup"><span data-stu-id="48049-407">A job schedule specifies when toorun jobs and includes hello specifications for hello jobs toobe run.</span></span> <span data-ttu-id="48049-408">您可以指定 hello hello 排程-持續時間的時間上限時 hello 排程作用中-且 hello 期間建立工作的頻率排程期。</span><span class="sxs-lookup"><span data-stu-id="48049-408">You can specify hello duration of hello schedule--how long and when hello schedule is in effect--and how frequently jobs are created during hello scheduled period.</span></span>

## <a name="task"></a><span data-ttu-id="48049-409">Task</span><span class="sxs-lookup"><span data-stu-id="48049-409">Task</span></span>
<span data-ttu-id="48049-410">工作是與作業相關聯的計算單位。</span><span class="sxs-lookup"><span data-stu-id="48049-410">A task is a unit of computation that is associated with a job.</span></span> <span data-ttu-id="48049-411">工作是在節點上執行。</span><span class="sxs-lookup"><span data-stu-id="48049-411">It runs on a node.</span></span> <span data-ttu-id="48049-412">工作會指派 tooa 節點執行，或佇列中直到節點變成可用為止。</span><span class="sxs-lookup"><span data-stu-id="48049-412">Tasks are assigned tooa node for execution, or are queued until a node becomes free.</span></span> <span data-ttu-id="48049-413">簡而言之，工作會執行一個或多個程式或指令碼在計算節點 tooperform hello 您需要完成的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-413">Put simply, a task runs one or more programs or scripts on a compute node tooperform hello work you need done.</span></span>

<span data-ttu-id="48049-414">建立工作時，您可以指定︰</span><span class="sxs-lookup"><span data-stu-id="48049-414">When you create a task, you can specify:</span></span>

* <span data-ttu-id="48049-415">hello**命令列**hello 工作。</span><span class="sxs-lookup"><span data-stu-id="48049-415">hello **command line** for hello task.</span></span> <span data-ttu-id="48049-416">這是 hello hello 計算節點執行應用程式或指令碼的命令列。</span><span class="sxs-lookup"><span data-stu-id="48049-416">This is hello command line that runs your application or script on hello compute node.</span></span>

    <span data-ttu-id="48049-417">請務必 hello 命令列的 toonote 實際上不會執行下一個殼層。</span><span class="sxs-lookup"><span data-stu-id="48049-417">It is important toonote that hello command line does not actually run under a shell.</span></span> <span data-ttu-id="48049-418">因此，它原本就不會使用的殼層功能，例如[環境變數](#environment-settings-for-tasks)擴充 (這包括 hello `PATH`)。</span><span class="sxs-lookup"><span data-stu-id="48049-418">Therefore, it cannot natively take advantage of shell features like [environment variable](#environment-settings-for-tasks) expansion (this includes hello `PATH`).</span></span> <span data-ttu-id="48049-419">tootake 利用這類功能，您必須叫用 hello 殼層 hello 命令列-例如，透過啟動`cmd.exe`Windows 節點上或`/bin/sh`on Linux:</span><span class="sxs-lookup"><span data-stu-id="48049-419">tootake advantage of such features, you must invoke hello shell in hello command line--for example, by launching `cmd.exe` on Windows nodes or `/bin/sh` on Linux:</span></span>

    `cmd /c MyTaskApplication.exe %MY_ENV_VAR%`

    `/bin/sh -c MyTaskApplication $MY_ENV_VAR`

    <span data-ttu-id="48049-420">應用程式或指令碼不是，如果您的工作需要 toorun hello 節點的`PATH`或參考環境變數，叫用明確在 hello 工作命令列中的 hello shell。</span><span class="sxs-lookup"><span data-stu-id="48049-420">If your tasks need toorun an application or script that is not in hello node's `PATH` or reference environment variables, invoke hello shell explicitly in hello task command line.</span></span>
* <span data-ttu-id="48049-421">**資源檔**包含 hello 資料 toobe 處理。</span><span class="sxs-lookup"><span data-stu-id="48049-421">**Resource files** that contain hello data toobe processed.</span></span> <span data-ttu-id="48049-422">Hello 工作的命令列執行之前，這些檔案會自動複製的 toohello 節點，從 Blob 儲存體中的一般用途的 Azure 儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="48049-422">These files are automatically copied toohello node from Blob storage in a general-purpose Azure Storage account before hello task's command line is executed.</span></span> <span data-ttu-id="48049-423">如需詳細資訊，請參閱 hello 章節[啟動工作](#start-task)和[檔案和目錄](#files-and-directories)。</span><span class="sxs-lookup"><span data-stu-id="48049-423">For more information, see hello sections [Start task](#start-task) and [Files and directories](#files-and-directories).</span></span>
* <span data-ttu-id="48049-424">hello**環境變數**您的應用程式所需。</span><span class="sxs-lookup"><span data-stu-id="48049-424">hello **environment variables** that are required by your application.</span></span> <span data-ttu-id="48049-425">如需詳細資訊，請參閱 hello[工作的環境設定](#environment-settings-for-tasks)> 一節。</span><span class="sxs-lookup"><span data-stu-id="48049-425">For more information, see hello [Environment settings for tasks](#environment-settings-for-tasks) section.</span></span>
* <span data-ttu-id="48049-426">hello**條件約束**下哪些 hello 應該執行的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-426">hello **constraints** under which hello task should execute.</span></span> <span data-ttu-id="48049-427">例如，條件約束包括 hello 最大時間 hello 工作允許 toorun，hello 最大次數應該重試失敗的工作，且 hello 最大時間 hello 工作的工作目錄中的檔案會保留。</span><span class="sxs-lookup"><span data-stu-id="48049-427">For example, constraints include hello maximum time that hello task is allowed toorun, hello maximum number of times a failed task should be retried, and hello maximum time that files in hello task's working directory are retained.</span></span>
* <span data-ttu-id="48049-428">**應用程式封裝**toodeploy toohello 計算的節點的 hello 工作是排定的 toorun。</span><span class="sxs-lookup"><span data-stu-id="48049-428">**Application packages** toodeploy toohello compute node on which hello task is scheduled toorun.</span></span> <span data-ttu-id="48049-429">[應用程式封裝](#application-packages)提供簡化的部署和版本管理您的工作執行的 hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="48049-429">[Application packages](#application-packages) provide simplified deployment and versioning of hello applications that your tasks run.</span></span> <span data-ttu-id="48049-430">工作層級應用程式封裝是特別有用的共用集區，其中一個集區中，執行不同的工作，且環境中的工作完成時，不會刪除 hello 集區。</span><span class="sxs-lookup"><span data-stu-id="48049-430">Task-level application packages are especially useful in shared-pool environments, where different jobs are run on one pool, and hello pool is not deleted when a job is completed.</span></span> <span data-ttu-id="48049-431">如果作業有 hello 集區中的節點比有較少的工作，工作應用程式封裝可以減少資料傳輸因為您的應用程式是執行工作的已部署的唯一 toohello 節點。</span><span class="sxs-lookup"><span data-stu-id="48049-431">If your job has fewer tasks than nodes in hello pool, task application packages can minimize data transfer since your application is deployed only toohello nodes that run tasks.</span></span>

<span data-ttu-id="48049-432">此外您定義 tooperform 計算節點上的 tootasks，hello 下列特殊的工作也會提供 hello 批次服務：</span><span class="sxs-lookup"><span data-stu-id="48049-432">In addition tootasks you define tooperform computation on a node, hello following special tasks are also provided by hello Batch service:</span></span>

* [<span data-ttu-id="48049-433">啟動工作</span><span class="sxs-lookup"><span data-stu-id="48049-433">Start task</span></span>](#start-task)
* [<span data-ttu-id="48049-434">作業管理員工作</span><span class="sxs-lookup"><span data-stu-id="48049-434">Job manager task</span></span>](#job-manager-task)
* [<span data-ttu-id="48049-435">作業準備和作業釋放工作</span><span class="sxs-lookup"><span data-stu-id="48049-435">Job preparation and release tasks</span></span>](#job-preparation-and-release-tasks)
* [<span data-ttu-id="48049-436">多重執行個體工作 (MPI)</span><span class="sxs-lookup"><span data-stu-id="48049-436">Multi-instance tasks (MPI)</span></span>](#multi-instance-tasks)
* [<span data-ttu-id="48049-437">作業相依性</span><span class="sxs-lookup"><span data-stu-id="48049-437">Task dependencies</span></span>](#task-dependencies)

### <a name="start-task"></a><span data-ttu-id="48049-438">啟動工作</span><span class="sxs-lookup"><span data-stu-id="48049-438">Start task</span></span>
<span data-ttu-id="48049-439">透過建立關聯**啟動工作**與集區，您就可以準備 hello 作業環境的節點。</span><span class="sxs-lookup"><span data-stu-id="48049-439">By associating a **start task** with a pool, you can prepare hello operating environment of its nodes.</span></span> <span data-ttu-id="48049-440">例如，您可以執行動作，如安裝您的工作執行的 hello 應用程式或啟動的背景處理序。</span><span class="sxs-lookup"><span data-stu-id="48049-440">For example, you can perform actions like installing hello applications that your tasks run or starting background processes.</span></span> <span data-ttu-id="48049-441">hello 執行啟動工作每次節點開始，只要它會保留在 hello 集區-包括 hello 節點時第一次加入 toohello 集區和何時重新啟動或重新安裝映像。</span><span class="sxs-lookup"><span data-stu-id="48049-441">hello start task runs every time a node starts, for as long as it remains in hello pool--including when hello node is first added toohello pool and when it is restarted or reimaged.</span></span>

<span data-ttu-id="48049-442">Hello 啟動工作的主要優點是它可以包含所有必要 tooconfigure hello 資訊的計算節點，並安裝所需的工作執行的 hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="48049-442">A primary benefit of hello start task is that it can contain all of hello information that is necessary tooconfigure a compute node and install hello applications that are required for task execution.</span></span> <span data-ttu-id="48049-443">因此，增加 hello 集區中的節點數目很簡單，只指定 hello 新目標節點計數。</span><span class="sxs-lookup"><span data-stu-id="48049-443">Therefore, increasing hello number of nodes in a pool is as simple as specifying hello new target node count.</span></span> <span data-ttu-id="48049-444">hello 啟動工作提供 hello 批次服務 hello 資訊所需的 tooconfigure hello 新節點並取得這些做好接受的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-444">hello start task provides hello Batch service hello information that is needed tooconfigure hello new nodes and get them ready for accepting tasks.</span></span>

<span data-ttu-id="48049-445">做為任何 Azure 批次工作，您可以指定一份**資源檔**中[Azure 儲存體][azure_storage]，此外 tooa**命令列**toobe執行。</span><span class="sxs-lookup"><span data-stu-id="48049-445">As with any Azure Batch task, you can specify a list of **resource files** in [Azure Storage][azure_storage], in addition tooa **command line** toobe executed.</span></span> <span data-ttu-id="48049-446">hello 批次服務會首先會從 Azure 儲存體，複製 hello 資源檔案 toohello 節點，然後執行 hello 命令列。</span><span class="sxs-lookup"><span data-stu-id="48049-446">hello Batch service first copies hello resource files toohello node from Azure Storage, and then runs hello command line.</span></span> <span data-ttu-id="48049-447">集區啟動工作，hello 檔案清單通常包含 hello 工作應用程式和其相依性。</span><span class="sxs-lookup"><span data-stu-id="48049-447">For a pool start task, hello file list typically contains hello task application and its dependencies.</span></span>

<span data-ttu-id="48049-448">不過，hello 啟動工作也可能包括參考資料 toobe hello 計算節點執行的所有工作所都使用的。</span><span class="sxs-lookup"><span data-stu-id="48049-448">However, hello start task could also include reference data toobe used by all tasks that are running on hello compute node.</span></span> <span data-ttu-id="48049-449">例如，無法執行啟動工作的命令列`robocopy`作業 toocopy 應用程式檔案 （其指定的資源檔，下載 toohello 節點） 從 hello 啟動工作的[工作目錄](#files-and-directories)toohello[共用的資料夾](#files-and-directories)，然後執行 MSI 或`setup.exe`。</span><span class="sxs-lookup"><span data-stu-id="48049-449">For example, a start task's command line could perform a `robocopy` operation toocopy application files (which were specified as resource files and downloaded toohello node) from hello start task's [working directory](#files-and-directories) toohello [shared folder](#files-and-directories), and then run an MSI or `setup.exe`.</span></span>

<span data-ttu-id="48049-450">最好通常為 hello 開始工作 toocomplete hello 批次服務 toowait 之前考慮 hello 節點準備 toobe 指派工作，但您可以設定此。</span><span class="sxs-lookup"><span data-stu-id="48049-450">It is typically desirable for hello Batch service toowait for hello start task toocomplete before considering hello node ready toobe assigned tasks, but you can configure this.</span></span>

<span data-ttu-id="48049-451">如果計算節點上，啟動工作失敗，則 hello hello 節點狀態是更新的 tooreflect hello 失敗，且 hello 節點未指派任何工作。</span><span class="sxs-lookup"><span data-stu-id="48049-451">If a start task fails on a compute node, then hello state of hello node is updated tooreflect hello failure, and hello node is not assigned any tasks.</span></span> <span data-ttu-id="48049-452">如果發生問題的資源檔案複製從儲存體，或如果 hello 由其命令列執行的處理程序傳回非零結束代碼，啟動工作可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="48049-452">A start task can fail if there is an issue copying its resource files from storage, or if hello process executed by its command line returns a nonzero exit code.</span></span>

<span data-ttu-id="48049-453">如果您加入或更新現有的集區的 hello 啟動工作，您必須重新啟動 hello 啟動工作 toobe 套用 toohello 節點及其的計算節點。</span><span class="sxs-lookup"><span data-stu-id="48049-453">If you add or update hello start task for an existing pool, you must reboot its compute nodes for hello start task toobe applied toohello nodes.</span></span>

>[!NOTE]
> <span data-ttu-id="48049-454">hello 啟動工作的總大小必須小於或等於 too32768 字元，包括資源檔和環境變數。</span><span class="sxs-lookup"><span data-stu-id="48049-454">hello total size of a start task must be less than or equal too32768 characters, including resource files and environment variables.</span></span> <span data-ttu-id="48049-455">tooensure 啟動工作符合此需求，您可以使用兩種方法的其中一個：</span><span class="sxs-lookup"><span data-stu-id="48049-455">tooensure that your start task meets this requirement, you can use one of two approaches:</span></span>
>
> 1. <span data-ttu-id="48049-456">您可以使用應用程式封裝 toodistribute 應用程式或資料批次集區中的每個節點之間。</span><span class="sxs-lookup"><span data-stu-id="48049-456">You can use application packages toodistribute applications or data across each node in your Batch pool.</span></span> <span data-ttu-id="48049-457">如需應用程式套件的詳細資訊，請參閱[部署與批次應用程式套件的應用程式 toocompute 節點](batch-application-packages.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-457">For more information about application packages, see [Deploy applications toocompute nodes with Batch application packages](batch-application-packages.md).</span></span>
> 2. <span data-ttu-id="48049-458">您可以手動建立已壓縮的封存檔，其中包含您的應用程式檔案。</span><span class="sxs-lookup"><span data-stu-id="48049-458">You can manually create a zipped archive containing your applications files.</span></span> <span data-ttu-id="48049-459">將您的 zip 的封存 tooAzure 儲存體上傳為 blob。</span><span class="sxs-lookup"><span data-stu-id="48049-459">Upload your zipped archive tooAzure Storage as a blob.</span></span> <span data-ttu-id="48049-460">指定封存壓縮的 hello 做為啟動工作的資源檔。</span><span class="sxs-lookup"><span data-stu-id="48049-460">Specify hello zipped archive as a resource file for your start task.</span></span> <span data-ttu-id="48049-461">Hello 命令列執行開始工作之前，請解壓縮 hello 封存從 hello 命令列。</span><span class="sxs-lookup"><span data-stu-id="48049-461">Before you run hello command line for your start task, unzip hello archive from hello command line.</span></span> 
>
>    <span data-ttu-id="48049-462">toounzip hello 封存檔中，您可以使用 hello 封存您選擇的工具。</span><span class="sxs-lookup"><span data-stu-id="48049-462">toounzip hello archive, you can use hello archiving tool of your choice.</span></span> <span data-ttu-id="48049-463">您將需要 tooinclude hello 工具 toounzip hello 封存做 hello 啟動工作的資源檔。</span><span class="sxs-lookup"><span data-stu-id="48049-463">You will need tooinclude hello tool that you use toounzip hello archive as a resource file for hello start task.</span></span>
>
>

### <a name="job-manager-task"></a><span data-ttu-id="48049-464">作業管理員工作</span><span class="sxs-lookup"><span data-stu-id="48049-464">Job manager task</span></span>
<span data-ttu-id="48049-465">您通常會使用**作業管理員工作**toocontrol 及/或監視工作執行，例如 toocreate 和送出 hello 工作作業，判斷其他工作 toorun，判斷當工作完成時。</span><span class="sxs-lookup"><span data-stu-id="48049-465">You typically use a **job manager task** toocontrol and/or monitor job execution--for example, toocreate and submit hello tasks for a job, determine additional tasks toorun, and determine when work is complete.</span></span> <span data-ttu-id="48049-466">不過，作業管理員工作不受限制的 toothese 活動。</span><span class="sxs-lookup"><span data-stu-id="48049-466">However, a job manager task is not restricted toothese activities.</span></span> <span data-ttu-id="48049-467">它是可以執行任何動作所需的 hello 作業完全完備的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-467">It is a fully fledged task that can perform any actions that are required for hello job.</span></span> <span data-ttu-id="48049-468">比方說，作業管理員工作可能會下載指定為參數的檔案、 分析 hello 內容，該檔案，以及提交這些內容為基礎的其他工作。</span><span class="sxs-lookup"><span data-stu-id="48049-468">For example, a job manager task might download a file that is specified as a parameter, analyze hello contents of that file, and submit additional tasks based on those contents.</span></span>

<span data-ttu-id="48049-469">作業管理員工作會在所有其他工作之前啟動。</span><span class="sxs-lookup"><span data-stu-id="48049-469">A job manager task is started before all other tasks.</span></span> <span data-ttu-id="48049-470">它提供下列功能的 hello:</span><span class="sxs-lookup"><span data-stu-id="48049-470">It provides hello following features:</span></span>

* <span data-ttu-id="48049-471">它會自動做為工作所提交 hello 批次服務建立 hello 作業時。</span><span class="sxs-lookup"><span data-stu-id="48049-471">It is automatically submitted as a task by hello Batch service when hello job is created.</span></span>
* <span data-ttu-id="48049-472">它會排程的 tooexecute hello 之前作業的其他工作。</span><span class="sxs-lookup"><span data-stu-id="48049-472">It is scheduled tooexecute before hello other tasks in a job.</span></span>
* <span data-ttu-id="48049-473">其相關聯的節點是 hello 最後 toobe 正在 downsized hello 集區時，從集區移除。</span><span class="sxs-lookup"><span data-stu-id="48049-473">Its associated node is hello last toobe removed from a pool when hello pool is being downsized.</span></span>
* <span data-ttu-id="48049-474">其終止可以繫結的 toohello 終止 hello 作業中的所有工作。</span><span class="sxs-lookup"><span data-stu-id="48049-474">Its termination can be tied toohello termination of all tasks in hello job.</span></span>
* <span data-ttu-id="48049-475">作業管理員工作需要重新啟動 toobe 時指定 hello 最高優先權。</span><span class="sxs-lookup"><span data-stu-id="48049-475">A job manager task is given hello highest priority when it needs toobe restarted.</span></span> <span data-ttu-id="48049-476">如果找不到閒置的節點，hello 批次服務可能會終止其中一個 hello hello 作業管理員工作 toorun hello 集區 toomake 空間中的其他執行中工作。</span><span class="sxs-lookup"><span data-stu-id="48049-476">If an idle node is not available, hello Batch service might terminate one of hello other running tasks in hello pool toomake room for hello job manager task toorun.</span></span>
* <span data-ttu-id="48049-477">一項作業中的作業管理員工作沒有透過 hello 工作的其他工作的優先順序。</span><span class="sxs-lookup"><span data-stu-id="48049-477">A job manager task in one job does not have priority over hello tasks of other jobs.</span></span> <span data-ttu-id="48049-478">不同作業之間，只注重作業層級優先順序。</span><span class="sxs-lookup"><span data-stu-id="48049-478">Across jobs, only job-level priorities are observed.</span></span>

### <a name="job-preparation-and-release-tasks"></a><span data-ttu-id="48049-479">作業準備和作業釋放工作</span><span class="sxs-lookup"><span data-stu-id="48049-479">Job preparation and release tasks</span></span>
<span data-ttu-id="48049-480">Batch 會提供作業前執行設定的作業準備工作。</span><span class="sxs-lookup"><span data-stu-id="48049-480">Batch provides job preparation tasks for pre-job execution setup.</span></span> <span data-ttu-id="48049-481">作業釋放工作則用於作業後維護或清理。</span><span class="sxs-lookup"><span data-stu-id="48049-481">Job release tasks are for post-job maintenance or cleanup.</span></span>

* <span data-ttu-id="48049-482">**作業準備工作**: toorun 排程工作的所有計算節點上執行作業準備工作，而任何 hello 之前，先執行其他作業 」 工作。</span><span class="sxs-lookup"><span data-stu-id="48049-482">**Job preparation task**: A job preparation task runs on all compute nodes that are scheduled toorun tasks, before any of hello other job tasks are executed.</span></span> <span data-ttu-id="48049-483">您可以使用作業準備工作 toocopy 共用的所有工作，但資料唯一 toohello 工作，例如。</span><span class="sxs-lookup"><span data-stu-id="48049-483">You can use a job preparation task toocopy data that is shared by all tasks, but is unique toohello job, for example.</span></span>
* <span data-ttu-id="48049-484">**作業解除工作**: hello 執行至少一個工作的集區中的每個節點上完成作業後，執行作業解除工作。</span><span class="sxs-lookup"><span data-stu-id="48049-484">**Job release task**: When a job has completed, a job release task runs on each node in hello pool that executed at least one task.</span></span> <span data-ttu-id="48049-485">您可以使用作業發行工作 toodelete 資料複製的 hello 作業準備工作或 toocompress 和上傳診斷記錄資料，例如。</span><span class="sxs-lookup"><span data-stu-id="48049-485">You can use a job release task toodelete data that is copied by hello job preparation task, or toocompress and upload diagnostic log data, for example.</span></span>

<span data-ttu-id="48049-486">同時作業準備，與發行工作時，允許您 toospecify 命令列 toorun hello 工作會叫用。</span><span class="sxs-lookup"><span data-stu-id="48049-486">Both job preparation and release tasks allow you toospecify a command line toorun when hello task is invoked.</span></span> <span data-ttu-id="48049-487">它們會提供許多功能，例如檔案下載、提升權限的執行、自訂環境變數、最大執行持續時間、重試計數、檔案保留時間。</span><span class="sxs-lookup"><span data-stu-id="48049-487">They offer features like file download, elevated execution, custom environment variables, maximum execution duration, retry count, and file retention time.</span></span>

<span data-ttu-id="48049-488">如需關於作業準備和釋放工作的詳細資訊，請參閱 [在 Azure Batch 計算節點上執行準備和完成的工作](batch-job-prep-release.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-488">For more information on job preparation and release tasks, see [Run job preparation and completion tasks on Azure Batch compute nodes](batch-job-prep-release.md).</span></span>

### <a name="multi-instance-task"></a><span data-ttu-id="48049-489">多重執行個體工作</span><span class="sxs-lookup"><span data-stu-id="48049-489">Multi-instance task</span></span>
<span data-ttu-id="48049-490">A[多重執行個體工作](batch-mpi.md)是同時為多個計算節點上的設定的 toorun 的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-490">A [multi-instance task](batch-mpi.md) is a task that is configured toorun on more than one compute node simultaneously.</span></span> <span data-ttu-id="48049-491">多個執行個體的工作，您可以啟用高效能運算的案例需要的運算節點的群組一起配置 tooprocess 單一的工作負載 (例如訊息傳遞介面 (MPI))。</span><span class="sxs-lookup"><span data-stu-id="48049-491">With multi-instance tasks, you can enable high-performance computing scenarios that require a group of compute nodes that are allocated together tooprocess a single workload (like Message Passing Interface (MPI)).</span></span>

<span data-ttu-id="48049-492">如需執行批次中的 MPI 工作使用 hello 批次.NET 程式庫的詳細討論，請參閱[使用多個執行個體工作 toorun Azure 批次中的訊息傳遞介面 (MPI) 應用程式](batch-mpi.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-492">For a detailed discussion on running MPI jobs in Batch by using hello Batch .NET library, check out [Use multi-instance tasks toorun Message Passing Interface (MPI) applications in Azure Batch](batch-mpi.md).</span></span>

### <a name="task-dependencies"></a><span data-ttu-id="48049-493">作業相依性</span><span class="sxs-lookup"><span data-stu-id="48049-493">Task dependencies</span></span>
<span data-ttu-id="48049-494">[工作的相依性](batch-task-dependencies.md)名稱所示為 hello、 讓您 toospecify 工作相依於 hello 完成之前執行其他工作。</span><span class="sxs-lookup"><span data-stu-id="48049-494">[Task dependencies](batch-task-dependencies.md), as hello name implies, allow you toospecify that a task depends on hello completion of other tasks before its execution.</span></span> <span data-ttu-id="48049-495">這項功能提供支援的情況下，「 下游 」 工作會消耗 hello 輸出的 「 上游 」 的工作--或上游的工作執行某些初始化所需的下游工作。</span><span class="sxs-lookup"><span data-stu-id="48049-495">This feature provides support for situations in which a "downstream" task consumes hello output of an "upstream" task--or when an upstream task performs some initialization that is required by a downstream task.</span></span> <span data-ttu-id="48049-496">toouse 這項功能，您必須第一個啟用工作相依性批次作業。</span><span class="sxs-lookup"><span data-stu-id="48049-496">toouse this feature, you must first enable task dependencies on your Batch job.</span></span> <span data-ttu-id="48049-497">然後，針對每項工作相依於另一個 （或其他許多），指定 hello 取決於該工作的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-497">Then, for each task that depends on another (or many others), you specify hello tasks which that task depends on.</span></span>

<span data-ttu-id="48049-498">與工作相依性，您可以設定類似 hello 下列案例：</span><span class="sxs-lookup"><span data-stu-id="48049-498">With task dependencies, you can configure scenarios like hello following:</span></span>

* <span data-ttu-id="48049-499">taskB 相依於 taskA (直到 taskA 完成，才會開始執行 taskB)。</span><span class="sxs-lookup"><span data-stu-id="48049-499">*taskB* depends on *taskA* (*taskB* will not begin execution until *taskA* has completed).</span></span>
* <span data-ttu-id="48049-500">taskC 同時相依於 taskA 和 taskB。</span><span class="sxs-lookup"><span data-stu-id="48049-500">*taskC* depends on both *taskA* and *taskB*.</span></span>
* <span data-ttu-id="48049-501">taskD 在執行前相依於某個範圍的工作，例如工作 1 至 10。</span><span class="sxs-lookup"><span data-stu-id="48049-501">*taskD* depends on a range of tasks, such as tasks *1* through *10*, before it executes.</span></span>

<span data-ttu-id="48049-502">簽出[工作 Azure 批次中的相依性](batch-task-dependencies.md)和 hello [TaskDependencies] [ github_sample_taskdeps] hello 中的程式碼範例[azure 批次範例][github_samples] GitHub 儲存機制，如需深入了解有關這項功能。</span><span class="sxs-lookup"><span data-stu-id="48049-502">Check out [Task dependencies in Azure Batch](batch-task-dependencies.md) and hello [TaskDependencies][github_sample_taskdeps] code sample in hello [azure-batch-samples][github_samples] GitHub repository for more in-depth details on this feature.</span></span>

## <a name="environment-settings-for-tasks"></a><span data-ttu-id="48049-503">工作的環境設定</span><span class="sxs-lookup"><span data-stu-id="48049-503">Environment settings for tasks</span></span>
<span data-ttu-id="48049-504">Hello 批次服務所執行的每一項工作中有存取 tooenvironment 變數，它會計算節點上設定。</span><span class="sxs-lookup"><span data-stu-id="48049-504">Each task executed by hello Batch service has access tooenvironment variables that it sets on compute nodes.</span></span> <span data-ttu-id="48049-505">這包括 hello 批次服務所定義的環境變數 ([服務定義][msdn_env_vars]) 以及您可以為您的工作定義的自訂環境變數。</span><span class="sxs-lookup"><span data-stu-id="48049-505">This includes environment variables defined by hello Batch service ([service-defined][msdn_env_vars]) and custom environment variables that you can define for your tasks.</span></span> <span data-ttu-id="48049-506">hello 應用程式和您的工作執行的指令碼沒有存取 toothese 環境變數在執行期間。</span><span class="sxs-lookup"><span data-stu-id="48049-506">hello applications and scripts your tasks execute have access toothese environment variables during execution.</span></span>

<span data-ttu-id="48049-507">您也可以填入 hello hello 工作或作業層級設定自訂的環境變數*環境設定*這些實體的屬性。</span><span class="sxs-lookup"><span data-stu-id="48049-507">You can set custom environment variables at hello task or job level by populating hello *environment settings* property for these entities.</span></span> <span data-ttu-id="48049-508">例如，請參閱 hello[加入工作 tooa 作業][ rest_add_task]作業 (批次 REST API) 或 hello [CloudTask.EnvironmentSettings] [ net_cloudtask_env]和[CloudJob.CommonEnvironmentSettings] [ net_job_env]批次.NET 中的屬性。</span><span class="sxs-lookup"><span data-stu-id="48049-508">For example, see hello [Add a task tooa job][rest_add_task] operation (Batch REST API), or hello [CloudTask.EnvironmentSettings][net_cloudtask_env] and [CloudJob.CommonEnvironmentSettings][net_job_env] properties in Batch .NET.</span></span>

<span data-ttu-id="48049-509">用戶端應用程式或服務可以使用來取得工作的環境變數，服務定義和自訂，hello[取得工作的相關資訊][ rest_get_task_info]作業 (批次 REST) 或存取hello [CloudTask.EnvironmentSettings] [ net_cloudtask_env]屬性 (批次.NET)。</span><span class="sxs-lookup"><span data-stu-id="48049-509">Your client application or service can obtain a task's environment variables, both service-defined and custom, by using hello [Get information about a task][rest_get_task_info] operation (Batch REST) or by accessing hello [CloudTask.EnvironmentSettings][net_cloudtask_env] property (Batch .NET).</span></span> <span data-ttu-id="48049-510">計算節點上執行的處理序可以存取這些和其他環境變數，在 [hello] 節點，例如，使用 hello 熟悉`%VARIABLE_NAME%`(Windows) 或`$VARIABLE_NAME`(Linux) 語法。</span><span class="sxs-lookup"><span data-stu-id="48049-510">Processes executing on a compute node can access these and other environment variables on hello node, for example, by using hello familiar `%VARIABLE_NAME%` (Windows) or `$VARIABLE_NAME` (Linux) syntax.</span></span>

<span data-ttu-id="48049-511">您可以在[計算節點環境變數][msdn_env_vars]中找到所有服務定義的環境變數完整清單。</span><span class="sxs-lookup"><span data-stu-id="48049-511">You can find a full list of all service-defined environment variables in [Compute node environment variables][msdn_env_vars].</span></span>

## <a name="files-and-directories"></a><span data-ttu-id="48049-512">檔案和目錄</span><span class="sxs-lookup"><span data-stu-id="48049-512">Files and directories</span></span>
<span data-ttu-id="48049-513">每個工作會在其「工作目錄」  下建立零個或多個檔案和目錄。</span><span class="sxs-lookup"><span data-stu-id="48049-513">Each task has a *working directory* under which it creates zero or more files and directories.</span></span> <span data-ttu-id="48049-514">這個工作目錄可以用來儲存 hello 工作，它處理、 hello 資料所執行的 hello 程式和 hello 輸出的 hello 處理，它會執行。</span><span class="sxs-lookup"><span data-stu-id="48049-514">This working directory can be used for storing hello program that is run by hello task, hello data that it processes, and hello output of hello processing it performs.</span></span> <span data-ttu-id="48049-515">Hello 工作使用者所擁有的所有檔案和目錄的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-515">All files and directories of a task are owned by hello task user.</span></span>

<span data-ttu-id="48049-516">hello 批次服務會公開 hello hello 節點上的檔案系統的一部分*根目錄*。</span><span class="sxs-lookup"><span data-stu-id="48049-516">hello Batch service exposes a portion of hello file system on a node as hello *root directory*.</span></span> <span data-ttu-id="48049-517">工作可以藉由參考 hello 存取 hello 根目錄`AZ_BATCH_NODE_ROOT_DIR`環境變數。</span><span class="sxs-lookup"><span data-stu-id="48049-517">Tasks can access hello root directory by referencing hello `AZ_BATCH_NODE_ROOT_DIR` environment variable.</span></span> <span data-ttu-id="48049-518">如需有關如何使用環境變數的詳細資訊，請參閱 [工作的環境設定](#environment-settings-for-tasks)。</span><span class="sxs-lookup"><span data-stu-id="48049-518">For more information about using environment variables, see [Environment settings for tasks](#environment-settings-for-tasks).</span></span>

<span data-ttu-id="48049-519">hello 的根目錄包含下列目錄結構的 hello:</span><span class="sxs-lookup"><span data-stu-id="48049-519">hello root directory contains hello following directory structure:</span></span>

![計算節點目錄結構][1]

* <span data-ttu-id="48049-521">**共用**： 這個目錄太提供讀取/寫入存取*所有*節點上執行的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-521">**shared**: This directory provides read/write access too*all* tasks that run on a node.</span></span> <span data-ttu-id="48049-522">Hello 節點執行任何工作，都可以建立、 讀取、 更新和刪除這個目錄中的檔案。</span><span class="sxs-lookup"><span data-stu-id="48049-522">Any task that runs on hello node can create, read, update, and delete files in this directory.</span></span> <span data-ttu-id="48049-523">工作可以存取這個目錄藉由參考 hello`AZ_BATCH_NODE_SHARED_DIR`環境變數。</span><span class="sxs-lookup"><span data-stu-id="48049-523">Tasks can access this directory by referencing hello `AZ_BATCH_NODE_SHARED_DIR` environment variable.</span></span>
* <span data-ttu-id="48049-524">**啟動**：啟動工作使用這個目錄做為它的工作目錄。</span><span class="sxs-lookup"><span data-stu-id="48049-524">**startup**: This directory is used by a start task as its working directory.</span></span> <span data-ttu-id="48049-525">所有的 hello 檔案，則下載的 toohello hello 啟動工作的節點會儲存在這裡。</span><span class="sxs-lookup"><span data-stu-id="48049-525">All of hello files that are downloaded toohello node by hello start task are stored here.</span></span> <span data-ttu-id="48049-526">hello 啟動工作，都可以建立、 讀取、 更新和刪除此目錄下的檔案。</span><span class="sxs-lookup"><span data-stu-id="48049-526">hello start task can create, read, update, and delete files under this directory.</span></span> <span data-ttu-id="48049-527">工作可以存取這個目錄藉由參考 hello`AZ_BATCH_NODE_STARTUP_DIR`環境變數。</span><span class="sxs-lookup"><span data-stu-id="48049-527">Tasks can access this directory by referencing hello `AZ_BATCH_NODE_STARTUP_DIR` environment variable.</span></span>
* <span data-ttu-id="48049-528">**工作**: hello 節點上執行的每項工作會建立目錄。</span><span class="sxs-lookup"><span data-stu-id="48049-528">**Tasks**: A directory is created for each task that runs on hello node.</span></span> <span data-ttu-id="48049-529">它參考 hello 存取`AZ_BATCH_TASK_DIR`環境變數。</span><span class="sxs-lookup"><span data-stu-id="48049-529">It is accessed by referencing hello `AZ_BATCH_TASK_DIR` environment variable.</span></span>

    <span data-ttu-id="48049-530">在每個工作目錄，hello 批次服務會建立工作目錄 (`wd`) 會指定其唯一的路徑所 hello`AZ_BATCH_TASK_WORKING_DIR`環境變數。</span><span class="sxs-lookup"><span data-stu-id="48049-530">Within each task directory, hello Batch service creates a working directory (`wd`) whose unique path is specified by hello `AZ_BATCH_TASK_WORKING_DIR` environment variable.</span></span> <span data-ttu-id="48049-531">此目錄提供讀取/寫入存取 toohello 工作。</span><span class="sxs-lookup"><span data-stu-id="48049-531">This directory provides read/write access toohello task.</span></span> <span data-ttu-id="48049-532">hello 工作可以建立、 讀取、 更新和刪除這個目錄下的檔案。</span><span class="sxs-lookup"><span data-stu-id="48049-532">hello task can create, read, update, and delete files under this directory.</span></span> <span data-ttu-id="48049-533">這個目錄會保留根據 hello *RetentionTime* hello 工作指定的條件約束。</span><span class="sxs-lookup"><span data-stu-id="48049-533">This directory is retained based on hello *RetentionTime* constraint that is specified for hello task.</span></span>

    <span data-ttu-id="48049-534">`stdout.txt`和`stderr.txt`： 這些檔案會寫入 hello hello 工作執行期間的 toohello 工作資料夾。</span><span class="sxs-lookup"><span data-stu-id="48049-534">`stdout.txt` and `stderr.txt`: These files are written toohello task folder during hello execution of hello task.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="48049-535">當從 hello 集區中移除某個節點*所有*的 hello 儲存在 hello 節點的檔案會遭到移除。</span><span class="sxs-lookup"><span data-stu-id="48049-535">When a node is removed from hello pool, *all* of hello files that are stored on hello node are removed.</span></span>
>
>

## <a name="application-packages"></a><span data-ttu-id="48049-536">應用程式封裝</span><span class="sxs-lookup"><span data-stu-id="48049-536">Application packages</span></span>
<span data-ttu-id="48049-537">hello[應用程式封裝](batch-application-packages.md)便於管理的應用程式部署功能提供 toohello 計算節點的 程式集區。</span><span class="sxs-lookup"><span data-stu-id="48049-537">hello [application packages](batch-application-packages.md) feature provides easy management and deployment of applications toohello compute nodes in your pools.</span></span> <span data-ttu-id="48049-538">您可以上傳和管理您的工作，包括其二進位檔 hello 應用程式執行的多個版本，並支援檔案。</span><span class="sxs-lookup"><span data-stu-id="48049-538">You can upload and manage multiple versions of hello applications run by your tasks, including their binaries and support files.</span></span> <span data-ttu-id="48049-539">然後您可自動部署一或多個這些應用程式 toohello 計算集區中的節點。</span><span class="sxs-lookup"><span data-stu-id="48049-539">Then you can automatically deploy one or more of these applications toohello compute nodes in your pool.</span></span>

<span data-ttu-id="48049-540">您可以指定在 hello 集區和工作層級的應用程式封裝。</span><span class="sxs-lookup"><span data-stu-id="48049-540">You can specify application packages at hello pool and task level.</span></span> <span data-ttu-id="48049-541">當您指定集區的應用程式封裝時，hello 應用程式是部署的 tooevery hello 集區中的節點。</span><span class="sxs-lookup"><span data-stu-id="48049-541">When you specify pool application packages, hello application is deployed tooevery node in hello pool.</span></span> <span data-ttu-id="48049-542">當您指定的工作應用程式封裝時，hello 應用程式已部署的唯一 toonodes 的 hello 作業 」 工作的至少一個已排程的 toorun，hello 之前執行工作的命令列。</span><span class="sxs-lookup"><span data-stu-id="48049-542">When you specify task application packages, hello application is deployed only toonodes that are scheduled toorun at least one of hello job's tasks, just before hello task's command line is run.</span></span>

<span data-ttu-id="48049-543">批次的控制代碼 hello 使用 Azure 儲存體 toostore 應用程式封裝的詳細資料，並將其部署 toocompute 節點，因此可以簡化您的程式碼和管理額外負荷。</span><span class="sxs-lookup"><span data-stu-id="48049-543">Batch handles hello details of working with Azure Storage toostore your application packages and deploy them toocompute nodes, so both your code and management overhead can be simplified.</span></span>

<span data-ttu-id="48049-544">toofind 深入了解 hello 應用程式封裝功能，請參閱[部署與批次應用程式套件的應用程式 toocompute 節點](batch-application-packages.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-544">toofind out more about hello application package feature, check out [Deploy applications toocompute nodes with Batch application packages](batch-application-packages.md).</span></span>

> [!NOTE]
> <span data-ttu-id="48049-545">如果您將加入集區的應用程式封裝 tooan*現有*集區，如 hello 應用程式套件部署 toobe toohello 節點，您必須重新啟動其計算節點。</span><span class="sxs-lookup"><span data-stu-id="48049-545">If you add pool application packages tooan *existing* pool, you must reboot its compute nodes for hello application packages toobe deployed toohello nodes.</span></span>
>
>

## <a name="pool-and-compute-node-lifetime"></a><span data-ttu-id="48049-546">集區和計算節點存留期</span><span class="sxs-lookup"><span data-stu-id="48049-546">Pool and compute node lifetime</span></span>
<span data-ttu-id="48049-547">當您設計您的 Azure 批次方案時，您可以 toomake 設計決策與相關當集區建立，並將時間計算這些集區中的節點會保持可用。</span><span class="sxs-lookup"><span data-stu-id="48049-547">When you design your Azure Batch solution, you have toomake a design decision about how and when pools are created, and how long compute nodes within those pools are kept available.</span></span>

<span data-ttu-id="48049-548">在某一端 hello 廣泛的詳細資訊，您可以建立您送出，每個工作的集區及執行其工作完成時立即刪除 hello 集區。</span><span class="sxs-lookup"><span data-stu-id="48049-548">On one end of hello spectrum, you can create a pool for each job that you submit, and delete hello pool as soon as its tasks finish execution.</span></span> <span data-ttu-id="48049-549">這最大化使用量，因為有需要與在閒置時，立即關閉時，只會配置 hello 節點。</span><span class="sxs-lookup"><span data-stu-id="48049-549">This maximizes utilization because hello nodes are only allocated when needed, and shut down as soon as they're idle.</span></span> <span data-ttu-id="48049-550">這表示 hello 工作必須等候 hello 節點 toobe 配置，很重要的工作都會排定執行節點，可個別、 已配置，因為與 hello 的 toonote 時啟動工作已完成。</span><span class="sxs-lookup"><span data-stu-id="48049-550">While this means that hello job must wait for hello nodes toobe allocated, it's important toonote that tasks are scheduled for execution as soon as nodes are individually available, allocated, and hello start task has completed.</span></span> <span data-ttu-id="48049-551">批次未*不*等候直到所有節點區內都可用指派工作 toohello 節點之前。</span><span class="sxs-lookup"><span data-stu-id="48049-551">Batch does *not* wait until all nodes within a pool are available before assigning tasks toohello nodes.</span></span> <span data-ttu-id="48049-552">這可確保所有可用節點的最大使用率。</span><span class="sxs-lookup"><span data-stu-id="48049-552">This ensures maximum utilization of all available nodes.</span></span>

<span data-ttu-id="48049-553">在 hello 另一端的 hello 另一方面，如果需要立即啟動工作是 hello 最高的優先順序，您可以建立事先的集區並讓它的節點可供才能提交工作。</span><span class="sxs-lookup"><span data-stu-id="48049-553">At hello other end of hello spectrum, if having jobs start immediately is hello highest priority, you can create a pool ahead of time and make its nodes available before jobs are submitted.</span></span> <span data-ttu-id="48049-554">在此案例中，工作可以立即啟動，但節點可能閒置時等候它們 toobe 指派。</span><span class="sxs-lookup"><span data-stu-id="48049-554">In this scenario, tasks can start immediately, but nodes might sit idle while waiting for them toobe assigned.</span></span>

<span data-ttu-id="48049-555">有一個通常用來處理可變但持續負載的組合方法。</span><span class="sxs-lookup"><span data-stu-id="48049-555">A combined approach is typically used for handling a variable, but ongoing, load.</span></span> <span data-ttu-id="48049-556">您可以有多個工作提交給，但可以調整 hello 節點數目，向上或向下，根據 toohello 工作負載集區 (請參閱[調整計算資源](#scaling-compute-resources)hello 下列區段中)。</span><span class="sxs-lookup"><span data-stu-id="48049-556">You can have a pool that multiple jobs are submitted to, but can scale hello number of nodes up or down according toohello job load (see [Scaling compute resources](#scaling-compute-resources) in hello following section).</span></span> <span data-ttu-id="48049-557">您可以根據目前的負載被動完成，或在負載可預測時主動完成。</span><span class="sxs-lookup"><span data-stu-id="48049-557">You can do this reactively, based on current load, or proactively, if load can be predicted.</span></span>

## <a name="virtual-network-vnet-and-firewall-configuration"></a><span data-ttu-id="48049-558">虛擬網路 (VNet) 和防火牆設定</span><span class="sxs-lookup"><span data-stu-id="48049-558">Virtual network (VNet) and firewall configuration</span></span> 

<span data-ttu-id="48049-559">當您佈建的 Azure 批次中的運算節點的集區時，您可以將 hello 集區與子網路的 Azure[虛擬網路 (VNet)](../virtual-network/virtual-networks-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-559">When you provision a pool of compute nodes in Azure Batch, you can associate hello pool with a subnet of an Azure [virtual network (VNet)](../virtual-network/virtual-networks-overview.md).</span></span> <span data-ttu-id="48049-560">toolearn 進一步了解建立 VNet 與子網路，請參閱[建立 Azure 虛擬網路子網路與](../virtual-network/virtual-networks-create-vnet-arm-pportal.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-560">toolearn more about creating a VNet with subnets, see [Create an Azure virtual network with subnets](../virtual-network/virtual-networks-create-vnet-arm-pportal.md).</span></span> 

 * <span data-ttu-id="48049-561">hello 與集區相關聯的 VNet 必須是：</span><span class="sxs-lookup"><span data-stu-id="48049-561">hello VNet associated with a pool must be:</span></span>

   * <span data-ttu-id="48049-562">在 hello 相同 Azure**區域**為 hello Azure Batch 帳戶。</span><span class="sxs-lookup"><span data-stu-id="48049-562">In hello same Azure **region** as hello Azure Batch account.</span></span>
   * <span data-ttu-id="48049-563">在 hello 相同**訂用帳戶**為 hello Azure Batch 帳戶。</span><span class="sxs-lookup"><span data-stu-id="48049-563">In hello same **subscription** as hello Azure Batch account.</span></span>

* <span data-ttu-id="48049-564">hello 的 VNet 支援的型別取決於集區配置的方式在 hello Batch 帳戶：</span><span class="sxs-lookup"><span data-stu-id="48049-564">hello type of VNet supported depends on how pools are being allocated for hello Batch account:</span></span>

    - <span data-ttu-id="48049-565">如果 hello 批次帳戶集區配置模式下設定 tooBatch 服務，則您可以指派以 hello 建立 VNet 只有 toopools**雲端服務設定**。</span><span class="sxs-lookup"><span data-stu-id="48049-565">If hello pool allocation mode for your Batch account is set tooBatch Service, then you can assign a VNet only toopools created with hello **Cloud Services Configuration**.</span></span> <span data-ttu-id="48049-566">此外，VNet 必須建立與 hello 傳統部署模型 hello 所指定。</span><span class="sxs-lookup"><span data-stu-id="48049-566">Additionally, hello specified VNet must be created with hello classic deployment model.</span></span> <span data-ttu-id="48049-567">不支援與 hello Azure Resource Manager 部署模型所建立的 Vnet。</span><span class="sxs-lookup"><span data-stu-id="48049-567">VNets created with hello Azure Resource Manager deployment model are not supported.</span></span>
 
    - <span data-ttu-id="48049-568">如果 hello 批次帳戶集區配置模式下設定 tooUser 訂用帳戶，則您可以指派以 hello 建立 VNet 只有 toopools**虛擬機器組態**。</span><span class="sxs-lookup"><span data-stu-id="48049-568">If hello pool allocation mode for your Batch account is set tooUser Subscription, then you can assign a VNet only toopools created with hello **Virtual Machine Configuration**.</span></span> <span data-ttu-id="48049-569">建立 hello 與集區**雲端服務組態**不支援。</span><span class="sxs-lookup"><span data-stu-id="48049-569">Pools created with hello **Cloud Service Configuration** are not supported.</span></span> <span data-ttu-id="48049-570">hello 與 hello Azure Resource Manager 部署模型或 hello 傳統部署模型可能建立相關聯的 VNet。</span><span class="sxs-lookup"><span data-stu-id="48049-570">hello associated VNet may be created with either hello Azure Resource Manager deployment model or hello classic deployment model.</span></span>

    <span data-ttu-id="48049-571">表摘要 VNet 支援根據 toopool 配置模式，請參閱 hello[集區配置模式](#pool-allocation-mode)> 一節。</span><span class="sxs-lookup"><span data-stu-id="48049-571">For a table summarizing VNet support according toopool allocation mode, see hello [Pool allocation mode](#pool-allocation-mode) section.</span></span>

* <span data-ttu-id="48049-572">如果您的 Batch 帳戶的 hello 集區配置模式下設定 tooBatch 服務，您必須提供權限 hello 批次服務主體 tooaccess hello VNet。</span><span class="sxs-lookup"><span data-stu-id="48049-572">If hello pool allocation mode for your Batch account is set tooBatch Service, then you must provide permissions for hello Batch service principal tooaccess hello VNet.</span></span> <span data-ttu-id="48049-573">hello VNet 必須指派 hello [Classic Virtual Machine Contributor Role-Based 存取控制 (RBAC)](https://azure.microsoft.com/documentation/articles/role-based-access-built-in-roles/#classic-virtual-machine-contributor)角色 toohello 批次服務主體。</span><span class="sxs-lookup"><span data-stu-id="48049-573">hello VNet must assign hello [Classic Virtual Machine Contributor Role-Based Access Control (RBAC)](https://azure.microsoft.com/documentation/articles/role-based-access-built-in-roles/#classic-virtual-machine-contributor) role toohello Batch service principal.</span></span> <span data-ttu-id="48049-574">如果未提供 RBAC 角色指定 hello hello 批次服務會傳回 400 （不正確的要求）。</span><span class="sxs-lookup"><span data-stu-id="48049-574">If hello specified RBAC role is not provided, hello Batch service returns 400 (Bad Request).</span></span> <span data-ttu-id="48049-575">tooadd hello Azure 入口網站中的 hello 角色：</span><span class="sxs-lookup"><span data-stu-id="48049-575">tooadd hello role in hello Azure portal:</span></span>

    1. <span data-ttu-id="48049-576">選取 hello **VNet**，然後**存取控制 (IAM)** > **角色** > **虛擬機器參與者** > **新增**。</span><span class="sxs-lookup"><span data-stu-id="48049-576">Select hello **VNet**, then **Access control (IAM)** > **Roles** > **Virtual Machine Contributor** > **Add**.</span></span>
    2. <span data-ttu-id="48049-577">在 hello**新增權限**刀鋒視窗中，選取 hello**虛擬機器參與者**角色。</span><span class="sxs-lookup"><span data-stu-id="48049-577">On hello **Add permissions** blade, select hello **Virtual Machine Contributor** role.</span></span>
    3. <span data-ttu-id="48049-578">在 hello**新增權限**刀鋒視窗中，搜尋 hello 批次 API。</span><span class="sxs-lookup"><span data-stu-id="48049-578">On hello **Add permissions** blade, search for hello Batch API.</span></span> <span data-ttu-id="48049-579">搜尋每個這些字串接著直到您找到 hello API:</span><span class="sxs-lookup"><span data-stu-id="48049-579">Search for each of these strings in turn until you find hello API:</span></span>
        1. <span data-ttu-id="48049-580">**MicrosoftAzureBatch**。</span><span class="sxs-lookup"><span data-stu-id="48049-580">**MicrosoftAzureBatch**.</span></span>
        2. <span data-ttu-id="48049-581">**Microsoft Azure Batch**。</span><span class="sxs-lookup"><span data-stu-id="48049-581">**Microsoft Azure Batch**.</span></span> <span data-ttu-id="48049-582">較新的 Azure AD 租用戶可以使用這個名稱。</span><span class="sxs-lookup"><span data-stu-id="48049-582">Newer Azure AD tenants may use this name.</span></span>
        3. <span data-ttu-id="48049-583">**ddbf3205-c6bd-46ae-8127-60eb93363864**是 hello 識別碼 hello 批次 API。</span><span class="sxs-lookup"><span data-stu-id="48049-583">**ddbf3205-c6bd-46ae-8127-60eb93363864** is hello ID for hello Batch API.</span></span> 
    3. <span data-ttu-id="48049-584">選取 hello 批次 API 服務主體。</span><span class="sxs-lookup"><span data-stu-id="48049-584">Select hello Batch API service principal.</span></span> 
    4. <span data-ttu-id="48049-585">按一下 [儲存] 。</span><span class="sxs-lookup"><span data-stu-id="48049-585">Click **Save**.</span></span>

        ![指定 VM 參與者角色 tooBatch 服務主體](./media/batch-api-basics/iam-add-role.png)


* <span data-ttu-id="48049-587">hello 指定子網路必須擁有足夠的可用**IP 位址**tooaccommodate hello 的目標節點總數，也就是 hello 的 hello 總和`targetDedicatedNodes`和`targetLowPriorityNodes`hello 集區的內容。</span><span class="sxs-lookup"><span data-stu-id="48049-587">hello specified subnet should have enough free **IP addresses** tooaccommodate hello total number of target nodes; that is, hello sum of hello `targetDedicatedNodes` and `targetLowPriorityNodes` properties of hello pool.</span></span> <span data-ttu-id="48049-588">如果 hello 子網路沒有足夠的可用 IP 位址，hello 批次服務部分配置 hello 集區中的 hello 計算節點，並傳回調整大小錯誤。</span><span class="sxs-lookup"><span data-stu-id="48049-588">If hello subnet doesn't have enough free IP addresses, hello Batch service partially allocates hello compute nodes in hello pool and returns a resize error.</span></span>

* <span data-ttu-id="48049-589">hello 指定子網路必須允許來自 hello 批次服務 toobe 通訊能 tooschedule 工作 hello 計算節點上。</span><span class="sxs-lookup"><span data-stu-id="48049-589">hello specified subnet must allow communication from hello Batch service toobe able tooschedule tasks on hello compute nodes.</span></span> <span data-ttu-id="48049-590">如果通訊 toohello 計算節點拒絕**網路安全性群組 (NSG)** hello 批次服務會將太 hello 的 hello 運算節點的狀態相關聯 VNet，hello**無法使用**。</span><span class="sxs-lookup"><span data-stu-id="48049-590">If communication toohello compute nodes is denied by a **Network Security Group (NSG)** associated with hello VNet, then hello Batch service sets hello state of hello compute nodes too**unusable**.</span></span>

* <span data-ttu-id="48049-591">如果 hello 可讓您指定具有相關聯的 VNet**網路安全性群組 (Nsg)**及/或**防火牆**，則必須啟用幾個保留的系統連接埠，以輸入通訊：</span><span class="sxs-lookup"><span data-stu-id="48049-591">If hello specified VNet has associated **Network Security Groups (NSGs)** and/or a **firewall**, then a few reserved system ports must be enabled for inbound communication:</span></span>

- <span data-ttu-id="48049-592">若為使用虛擬機器組態所建立的集區，請啟用連接埠 29876 和 29877，另外，請針對 Linux 啟用連接埠 22，至於 Windows 則啟用連接埠 3389。</span><span class="sxs-lookup"><span data-stu-id="48049-592">For pools created with a virtual machine configuration, enable ports 29876 and 29877, as well as port 22 for Linux and port 3389 for Windows.</span></span> 
- <span data-ttu-id="48049-593">若為使用雲端服務組態所建立的集區，請啟用連接埠 10100、20100 和 30100。</span><span class="sxs-lookup"><span data-stu-id="48049-593">For pools created with a cloud service configuration, enable ports 10100, 20100, and 30100.</span></span> 
- <span data-ttu-id="48049-594">啟用輸出連線 tooAzure 連接埠 443 上的儲存體。</span><span class="sxs-lookup"><span data-stu-id="48049-594">Enable outbound connections tooAzure Storage on port 443.</span></span> <span data-ttu-id="48049-595">此外，請確定為 VNET 提供服務的任何自訂 DNS 伺服器，都能解析您的 Azure 儲存體端點。</span><span class="sxs-lookup"><span data-stu-id="48049-595">Also, ensure that your Azure Storage endpoint can be resolved by any custom DNS servers that serve your VNET.</span></span> <span data-ttu-id="48049-596">具體來說，hello 表單的 URL`<account>.table.core.windows.net`應該是可解析。</span><span class="sxs-lookup"><span data-stu-id="48049-596">Specifically, a URL of hello form `<account>.table.core.windows.net` should be resolvable.</span></span>

    <span data-ttu-id="48049-597">hello 以下表格說明 hello 輸入 tooenable 需要您建立與 hello 虛擬機器組態的集區的連接埠：</span><span class="sxs-lookup"><span data-stu-id="48049-597">hello following table describes hello inbound ports that you need tooenable for pools that you created with hello virtual machine configuration:</span></span>

    |    <span data-ttu-id="48049-598">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="48049-598">Destination Port(s)</span></span>    |    <span data-ttu-id="48049-599">來源 IP 位址</span><span class="sxs-lookup"><span data-stu-id="48049-599">Source IP address</span></span>      |    <span data-ttu-id="48049-600">Batch 會新增 NSG 嗎？</span><span class="sxs-lookup"><span data-stu-id="48049-600">Does Batch add NSGs?</span></span>    |    <span data-ttu-id="48049-601">所需的 VM toobe 可用？</span><span class="sxs-lookup"><span data-stu-id="48049-601">Required for VM toobe usable?</span></span>    |    <span data-ttu-id="48049-602">使用者的動作</span><span class="sxs-lookup"><span data-stu-id="48049-602">Action from user</span></span>   |
    |---------------------------|---------------------------|----------------------------|-------------------------------------|-----------------------|
    |    <ul><li><span data-ttu-id="48049-603">使用 hello 虛擬機器組態建立的集區： 29876、 29877</span><span class="sxs-lookup"><span data-stu-id="48049-603">For pools created with hello virtual machine configuration: 29876, 29877</span></span></li><li><span data-ttu-id="48049-604">建立與 hello 雲端服務組態的集區： 10100、 20100、 30100</span><span class="sxs-lookup"><span data-stu-id="48049-604">For pools created with hello cloud service configuration: 10100, 20100, 30100</span></span></li></ul>         |    <span data-ttu-id="48049-605">僅限 Batch 服務角色 IP 位址</span><span class="sxs-lookup"><span data-stu-id="48049-605">Only Batch service role IP addresses</span></span> |    <span data-ttu-id="48049-606">是。</span><span class="sxs-lookup"><span data-stu-id="48049-606">Yes.</span></span> <span data-ttu-id="48049-607">批次會新增在 hello 層級的網路介面 (NIC) 附加 tooVMs Nsg。</span><span class="sxs-lookup"><span data-stu-id="48049-607">Batch adds NSGs at hello level of network interfaces (NIC) attached tooVMs.</span></span> <span data-ttu-id="48049-608">這些 NSG 只允許來自 Batch 服務角色 IP 位址的流量。</span><span class="sxs-lookup"><span data-stu-id="48049-608">These NSGs allow traffic only from Batch service role IP addresses.</span></span> <span data-ttu-id="48049-609">即使您 abra estos puertos para hello 整個網站，取得在 hello NIC 封鎖 hello 流量</span><span class="sxs-lookup"><span data-stu-id="48049-609">Even if you open these ports for hello  entire web, hello traffic will get blocked at hello NIC.</span></span> |    <span data-ttu-id="48049-610">是</span><span class="sxs-lookup"><span data-stu-id="48049-610">Yes</span></span>  |  <span data-ttu-id="48049-611">您不需要 toospecify NSG，因為批次允許只有批次的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="48049-611">You do not need toospecify an NSG, because Batch allows only Batch IP addresses.</span></span> <br /><br /> <span data-ttu-id="48049-612">不過，如果您指定 NSG，請確定這些連接埠已對輸入流量開啟。</span><span class="sxs-lookup"><span data-stu-id="48049-612">However, if you do specify an NSG, please ensure that these ports are open for inbound traffic.</span></span> <br /><br /> <span data-ttu-id="48049-613">如果您指定 * 當 hello 您 NSG 中的來源 IP，批次仍將 Nsg 加入的附加 NIC tooVMs hello 層級。</span><span class="sxs-lookup"><span data-stu-id="48049-613">If you specify * as hello source IP in your NSG, Batch still adds NSGs at hello level of NIC attached tooVMs.</span></span> |
    |    <span data-ttu-id="48049-614">3389、22</span><span class="sxs-lookup"><span data-stu-id="48049-614">3389, 22</span></span>               |    <span data-ttu-id="48049-615">使用者電腦，作為偵錯用途，好讓您可以從遠端存取 hello VM。</span><span class="sxs-lookup"><span data-stu-id="48049-615">User machines, used for debugging purposes, so that you can remotely access hello VM.</span></span>    |    <span data-ttu-id="48049-616">否</span><span class="sxs-lookup"><span data-stu-id="48049-616">No</span></span>                                    |    <span data-ttu-id="48049-617">否</span><span class="sxs-lookup"><span data-stu-id="48049-617">No</span></span>                     |    <span data-ttu-id="48049-618">如果您想 toopermit 遠端存取 (RDP/SSH) toohello VM，請加入 Nsg。</span><span class="sxs-lookup"><span data-stu-id="48049-618">Add NSGs if you want toopermit remote access (RDP/SSH) toohello VM.</span></span>   |                 

    <span data-ttu-id="48049-619">hello 下表描述您需要儲存體 tooenable toopermit 存取 tooAzure hello 輸出連接埠：</span><span class="sxs-lookup"><span data-stu-id="48049-619">hello following table describes hello outbound port that you need tooenable toopermit access tooAzure Storage:</span></span>

    |    <span data-ttu-id="48049-620">輸出連接埠</span><span class="sxs-lookup"><span data-stu-id="48049-620">Outbound Port(s)</span></span>    |    <span data-ttu-id="48049-621">目的地</span><span class="sxs-lookup"><span data-stu-id="48049-621">Destination</span></span>    |    <span data-ttu-id="48049-622">Batch 會新增 NSG 嗎？</span><span class="sxs-lookup"><span data-stu-id="48049-622">Does Batch add NSGs?</span></span>    |    <span data-ttu-id="48049-623">所需的 VM toobe 可用？</span><span class="sxs-lookup"><span data-stu-id="48049-623">Required for VM toobe usable?</span></span>    |    <span data-ttu-id="48049-624">使用者的動作</span><span class="sxs-lookup"><span data-stu-id="48049-624">Action from user</span></span>    |
    |------------------------|-------------------|----------------------------|-------------------------------------|------------------------|
    |    <span data-ttu-id="48049-625">443</span><span class="sxs-lookup"><span data-stu-id="48049-625">443</span></span>    |    <span data-ttu-id="48049-626">Azure 儲存體</span><span class="sxs-lookup"><span data-stu-id="48049-626">Azure Storage</span></span>    |    <span data-ttu-id="48049-627">否</span><span class="sxs-lookup"><span data-stu-id="48049-627">No</span></span>    |    <span data-ttu-id="48049-628">是</span><span class="sxs-lookup"><span data-stu-id="48049-628">Yes</span></span>    |    <span data-ttu-id="48049-629">如果您新增任何 Nsg，請確定此連接埠是開啟 toooutbound 流量。</span><span class="sxs-lookup"><span data-stu-id="48049-629">If you add any NSGs, then ensure that this port is open toooutbound   traffic.</span></span>    |


## <a name="scaling-compute-resources"></a><span data-ttu-id="48049-630">調整計算資源</span><span class="sxs-lookup"><span data-stu-id="48049-630">Scaling compute resources</span></span>
<span data-ttu-id="48049-631">與[自動縮放比例](batch-automatic-scaling.md)，您可以讓 hello 批次服務動態調整 hello 根據 toohello 目前工作負載和資源使用狀況計算案例的集區中的運算節點數目。</span><span class="sxs-lookup"><span data-stu-id="48049-631">With [automatic scaling](batch-automatic-scaling.md), you can have hello Batch service dynamically adjust hello number of compute nodes in a pool according toohello current workload and resource usage of your compute scenario.</span></span> <span data-ttu-id="48049-632">這可讓您 toolower hello 您需要使用只有 hello 資源以執行您的應用程式的整體成本，並釋出那些您不需要。</span><span class="sxs-lookup"><span data-stu-id="48049-632">This allows you toolower hello overall cost of running your application by using only hello resources you need, and releasing those you don't need.</span></span>

<span data-ttu-id="48049-633">撰寫 [自動調整公式](batch-automatic-scaling.md#automatic-scaling-formulas) 並將該公式與集區建立關聯，以啟用自動調整。</span><span class="sxs-lookup"><span data-stu-id="48049-633">You enable automatic scaling by writing an [automatic scaling formula](batch-automatic-scaling.md#automatic-scaling-formulas) and associating that formula with a pool.</span></span> <span data-ttu-id="48049-634">hello 批次服務會使用 hello 公式 toodetermine hello 目標數目節點區內 hello hello 下一步調整間隔 （您可以設定間隔）。</span><span class="sxs-lookup"><span data-stu-id="48049-634">hello Batch service uses hello formula toodetermine hello target number of nodes in hello pool for hello next scaling interval (an interval that you can configure).</span></span> <span data-ttu-id="48049-635">當您建立它，或啟用稍後調整集區上，您可以指定 hello 自動調整集區設定。</span><span class="sxs-lookup"><span data-stu-id="48049-635">You can specify hello automatic scaling settings for a pool when you create it, or enable scaling on a pool later.</span></span> <span data-ttu-id="48049-636">您也可以更新 hello 調整啟用調整集區上的設定。</span><span class="sxs-lookup"><span data-stu-id="48049-636">You can also update hello scaling settings on a scaling-enabled pool.</span></span>

<span data-ttu-id="48049-637">例如，可能是作業會需要您送出非常大量的工作 toobe 執行。</span><span class="sxs-lookup"><span data-stu-id="48049-637">As an example, perhaps a job requires that you submit a very large number of tasks toobe executed.</span></span> <span data-ttu-id="48049-638">您可以指派的縮放比例的公式 toohello 集區，調整 hello hello hello 目前的佇列工作數目和 hello 完成率 hello 作業中的 hello 工作為基礎的集區中的節點數目。</span><span class="sxs-lookup"><span data-stu-id="48049-638">You can assign a scaling formula toohello pool that adjusts hello number of nodes in hello pool based on hello current number of queued tasks and hello completion rate of hello tasks in hello job.</span></span> <span data-ttu-id="48049-639">hello 批次服務會定期評估 hello 公式，並調整大小 hello 集區，根據工作負載和其他公式的設定。</span><span class="sxs-lookup"><span data-stu-id="48049-639">hello Batch service periodically evaluates hello formula and resizes hello pool, based on workload and your other formula settings.</span></span> <span data-ttu-id="48049-640">hello 服務節點將視需要增加時有大量的佇列工作，並移除的節點時沒有排入佇列或執行工作。</span><span class="sxs-lookup"><span data-stu-id="48049-640">hello service adds nodes as needed when there are a large number of queued tasks, and removes nodes when there are no queued or running tasks.</span></span>

<span data-ttu-id="48049-641">調整的公式可以根據 hello 下列度量：</span><span class="sxs-lookup"><span data-stu-id="48049-641">A scaling formula can be based on hello following metrics:</span></span>

* <span data-ttu-id="48049-642">**時間度量**收集中指定的 hello 每隔五分鐘的統計資料為根據的小時數。</span><span class="sxs-lookup"><span data-stu-id="48049-642">**Time metrics** are based on statistics collected every five minutes in hello specified number of hours.</span></span>
* <span data-ttu-id="48049-643">**資源度量** 是以 CPU 使用量、頻寬使用量、記憶體使用量和節點的數目為基礎。</span><span class="sxs-lookup"><span data-stu-id="48049-643">**Resource metrics** are based on CPU usage, bandwidth usage, memory usage, and number of nodes.</span></span>
* <span data-ttu-id="48049-644">**工作計量**是以工作狀態為基礎，例如 [作用中] \(已排入佇列)、[執行中] 或 [已完成]。</span><span class="sxs-lookup"><span data-stu-id="48049-644">**Task metrics** are based on task state, such as *Active* (queued), *Running*, or *Completed*.</span></span>

<span data-ttu-id="48049-645">當自動縮放比例減少的集區中的運算節點的 hello 數目時，您必須考慮如何 toohandle 工作執行時的 hello hello 減少作業。</span><span class="sxs-lookup"><span data-stu-id="48049-645">When automatic scaling decreases hello number of compute nodes in a pool, you must consider how toohandle tasks that are running at hello time of hello decrease operation.</span></span> <span data-ttu-id="48049-646">tooaccommodate，批次提供*節點解除配置選項*併入您的公式。</span><span class="sxs-lookup"><span data-stu-id="48049-646">tooaccommodate this, Batch provides a *node deallocation option* that you can include in your formulas.</span></span> <span data-ttu-id="48049-647">例如，您可以指定，正在執行的工作會立即停止，立即停止然後另一個節點上，執行排入佇列或 hello 節點會從 hello 集區移除之前，允許 toofinish。</span><span class="sxs-lookup"><span data-stu-id="48049-647">For example, you can specify that running tasks are stopped immediately, stopped immediately and then requeued for execution on another node, or allowed toofinish before hello node is removed from hello pool.</span></span>

<span data-ttu-id="48049-648">如需關於自動調整應用程式的詳細資訊，請參閱 [自動調整 Azure Batch 集區中的計算節點](batch-automatic-scaling.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-648">For more information about automatically scaling an application, see [Automatically scale compute nodes in an Azure Batch pool](batch-automatic-scaling.md).</span></span>

> [!TIP]
> <span data-ttu-id="48049-649">toomaximize 運算資源使用量、 設定 hello 目標數目節點 toozero hello 結束工作，但不允許執行的工作 toofinish。</span><span class="sxs-lookup"><span data-stu-id="48049-649">toomaximize compute resource utilization, set hello target number of nodes toozero at hello end of a job, but allow running tasks toofinish.</span></span>
>
>

## <a name="security-with-certificates"></a><span data-ttu-id="48049-650">憑證的安全性</span><span class="sxs-lookup"><span data-stu-id="48049-650">Security with certificates</span></span>
<span data-ttu-id="48049-651">時，您通常需要 toouse 憑證加密或解密機密資訊的工作，例如 hello 金鑰[Azure 儲存體帳戶][azure_storage]。</span><span class="sxs-lookup"><span data-stu-id="48049-651">You typically need toouse certificates when you encrypt or decrypt sensitive information for tasks, like hello key for an [Azure Storage account][azure_storage].</span></span> <span data-ttu-id="48049-652">toosupport，您可以在節點上安裝憑證。</span><span class="sxs-lookup"><span data-stu-id="48049-652">toosupport this, you can install certificates on nodes.</span></span> <span data-ttu-id="48049-653">加密的密碼會透過命令列參數傳遞 tootasks 或內嵌在其中一個 hello 工作的資源，並可使用的 toodecrypt hello 安裝憑證。 它們。</span><span class="sxs-lookup"><span data-stu-id="48049-653">Encrypted secrets are passed tootasks via command-line parameters or embedded in one of hello task resources, and hello installed certificates can be used toodecrypt them.</span></span>

<span data-ttu-id="48049-654">使用 hello[加入憑證][ rest_add_cert]作業 (批次 REST) 或[CertificateOperations.CreateCertificate] [ net_create_cert]方法 (批次.NET)tooadd 憑證 tooa Batch 帳戶。</span><span class="sxs-lookup"><span data-stu-id="48049-654">You use hello [Add certificate][rest_add_cert] operation (Batch REST) or [CertificateOperations.CreateCertificate][net_create_cert] method (Batch .NET) tooadd a certificate tooa Batch account.</span></span> <span data-ttu-id="48049-655">您接著可以將 hello 憑證與新的或現有的集區。</span><span class="sxs-lookup"><span data-stu-id="48049-655">You can then associate hello certificate with a new or existing pool.</span></span> <span data-ttu-id="48049-656">憑證與集區相關聯時，hello 批次服務會在 hello 集區中的每個節點上安裝 hello 憑證。</span><span class="sxs-lookup"><span data-stu-id="48049-656">When a certificate is associated with a pool, hello Batch service installs hello certificate on each node in hello pool.</span></span> <span data-ttu-id="48049-657">hello 節點啟動時，啟動 （包括 hello 啟動工作和作業管理員工作） 的任何工作之前，hello 批次服務會安裝 hello 適當的憑證。</span><span class="sxs-lookup"><span data-stu-id="48049-657">hello Batch service installs hello appropriate certificates when hello node starts up, before launching any tasks (including hello start task and job manager task).</span></span>

<span data-ttu-id="48049-658">如果您新增憑證 tooan*現有*集區，您必須重新啟動其計算節點 hello 憑證 toobe 套用 toohello 節點。</span><span class="sxs-lookup"><span data-stu-id="48049-658">If you add certificates tooan *existing* pool, you must reboot its compute nodes for hello certificates toobe applied toohello nodes.</span></span>

## <a name="error-handling"></a><span data-ttu-id="48049-659">錯誤處理</span><span class="sxs-lookup"><span data-stu-id="48049-659">Error handling</span></span>
<span data-ttu-id="48049-660">您可能會發現需要 toohandle 批次方案中的工作和應用程式失敗。</span><span class="sxs-lookup"><span data-stu-id="48049-660">You might find it necessary toohandle both task and application failures within your Batch solution.</span></span>

### <a name="task-failure-handling"></a><span data-ttu-id="48049-661">工作失敗處理</span><span class="sxs-lookup"><span data-stu-id="48049-661">Task failure handling</span></span>
<span data-ttu-id="48049-662">工作失敗可分成下列幾類：</span><span class="sxs-lookup"><span data-stu-id="48049-662">Task failures fall into these categories:</span></span>

* <span data-ttu-id="48049-663">**前置處理失敗**</span><span class="sxs-lookup"><span data-stu-id="48049-663">**Pre-processing failures**</span></span>

    <span data-ttu-id="48049-664">如果工作失敗 toostart，前置處理的錯誤設定 hello 工作。</span><span class="sxs-lookup"><span data-stu-id="48049-664">If a task fails toostart, a pre-processing error is set for hello task.</span></span>  

    <span data-ttu-id="48049-665">前置處理錯誤的發生原因 hello 工作的資源檔案已移動、 hello 儲存體帳戶已無法再使用，或遇到其他問題，予以防止的 hello 成功複製的檔案 toohello 節點。</span><span class="sxs-lookup"><span data-stu-id="48049-665">Pre-processing errors can occur if hello task's resource files have moved, hello Storage account is no longer available, or another issue was encountered that prevented hello successful copying of files toohello node.</span></span>

* <span data-ttu-id="48049-666">**檔案上傳失敗**</span><span class="sxs-lookup"><span data-stu-id="48049-666">**File upload failures**</span></span>

    <span data-ttu-id="48049-667">如果工作指定的檔案上傳因任何原因失敗，將檔案上傳錯誤設定 hello 工作。</span><span class="sxs-lookup"><span data-stu-id="48049-667">If uploading files that are specified for a task fails for any reason, a file upload error is set for hello task.</span></span>

    <span data-ttu-id="48049-668">檔案可能會發生錯誤如果 hello SAS 提供存取 Azure 儲存體無效或不提供寫入權限、 如果 hello 儲存體帳戶不再可用，或者如果另一個問題是發生導致 hello 成功複製的檔案上傳hello 節點。</span><span class="sxs-lookup"><span data-stu-id="48049-668">File upload errors can occur if hello SAS supplied for accessing Azure Storage is invalid or does not provide write permissions, if hello storage account is no longer available, or if another issue was encountered that prevented hello successful copying of files from hello node.</span></span>    

* <span data-ttu-id="48049-669">**應用程式失敗**</span><span class="sxs-lookup"><span data-stu-id="48049-669">**Application failures**</span></span>

    <span data-ttu-id="48049-670">hello 工作的命令列所指定的 hello 程序也會失敗。</span><span class="sxs-lookup"><span data-stu-id="48049-670">hello process that is specified by hello task's command line can also fail.</span></span> <span data-ttu-id="48049-671">hello 程序會被視為 toohave 失敗時則為非零結束代碼由 hello hello 工作所執行的處理序 (請參閱*工作的結束代碼*hello 下一節)。</span><span class="sxs-lookup"><span data-stu-id="48049-671">hello process is deemed toohave failed when a nonzero exit code is returned by hello process that is executed by hello task (see *Task exit codes* in hello next section).</span></span>

    <span data-ttu-id="48049-672">應用程式失敗，您可以設定批次向上 tooa tooautomatically 重試 hello 工作指定的次數。</span><span class="sxs-lookup"><span data-stu-id="48049-672">For application failures, you can configure Batch tooautomatically retry hello task up tooa specified number of times.</span></span>

* <span data-ttu-id="48049-673">**條件約束失敗**</span><span class="sxs-lookup"><span data-stu-id="48049-673">**Constraint failures**</span></span>

    <span data-ttu-id="48049-674">您可以設定的條件約束會指定作業或工作，hello 最大的執行持續期間 hello *maxWallClockTime*。</span><span class="sxs-lookup"><span data-stu-id="48049-674">You can set a constraint that specifies hello maximum execution duration for a job or task, hello *maxWallClockTime*.</span></span> <span data-ttu-id="48049-675">這可用於結束失敗 tooprogress 的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-675">This can be useful for terminating tasks that fail tooprogress.</span></span>

    <span data-ttu-id="48049-676">當超過 hello 最大時間量時，hello 工作會標示為*完成*，但 hello 結束程式碼會設定太`0xC000013A`和 hello *schedulingError*欄位標示為`{ category:"ServerError", code="TaskEnded"}`。</span><span class="sxs-lookup"><span data-stu-id="48049-676">When hello maximum amount of time has been exceeded, hello task is marked as *completed*, but hello exit code is set too`0xC000013A` and hello *schedulingError* field is marked as `{ category:"ServerError", code="TaskEnded"}`.</span></span>

### <a name="debugging-application-failures"></a><span data-ttu-id="48049-677">應用程式失敗偵錯</span><span class="sxs-lookup"><span data-stu-id="48049-677">Debugging application failures</span></span>
* <span data-ttu-id="48049-678">`stderr`和`stdout`</span><span class="sxs-lookup"><span data-stu-id="48049-678">`stderr` and `stdout`</span></span>

    <span data-ttu-id="48049-679">在執行期間，應用程式可能會產生您可以使用 tootroubleshoot 問題的診斷輸出。</span><span class="sxs-lookup"><span data-stu-id="48049-679">During execution, an application might produce diagnostic output that you can use tootroubleshoot issues.</span></span> <span data-ttu-id="48049-680">Hello 中所述前一節的[檔案和目錄](#files-and-directories)，hello 批次服務寫入標準輸出和標準錯誤輸出太`stdout.txt`和`stderr.txt`hello hello 工作目錄中的檔案計算節點。</span><span class="sxs-lookup"><span data-stu-id="48049-680">As mentioned in hello earlier section [Files and directories](#files-and-directories), hello Batch service writes standard output and standard error output too`stdout.txt` and `stderr.txt` files in hello task directory on hello compute node.</span></span> <span data-ttu-id="48049-681">您可以使用 hello Azure 入口網站，或其中一個 hello 批次 Sdk toodownload 這些檔案。</span><span class="sxs-lookup"><span data-stu-id="48049-681">You can use hello Azure portal or one of hello Batch SDKs toodownload these files.</span></span> <span data-ttu-id="48049-682">例如，您可以擷取這些和其他檔案，供疑難排解之用，使用[ComputeNode.GetNodeFile] [ net_getfile_node]和[CloudTask.GetNodeFile] [ net_getfile_task] hello 批次.NET 程式庫中。</span><span class="sxs-lookup"><span data-stu-id="48049-682">For example, you can retrieve these and other files for troubleshooting purposes by using [ComputeNode.GetNodeFile][net_getfile_node] and [CloudTask.GetNodeFile][net_getfile_task] in hello Batch .NET library.</span></span>

* <span data-ttu-id="48049-683">**工作結束代碼**</span><span class="sxs-lookup"><span data-stu-id="48049-683">**Task exit codes**</span></span>

    <span data-ttu-id="48049-684">如先前所述，則工作會標示為失敗 hello 批次服務，如果 hello hello 工作所執行的處理序傳回非零結束代碼。</span><span class="sxs-lookup"><span data-stu-id="48049-684">As mentioned earlier, a task is marked as failed by hello Batch service if hello process that is executed by hello task returns a nonzero exit code.</span></span> <span data-ttu-id="48049-685">批次時工作執行的處理序，填入 hello 工作結束程式碼內容，以 hello*傳回 hello 程序的程式碼*。</span><span class="sxs-lookup"><span data-stu-id="48049-685">When a task executes a process, Batch populates hello task's exit code property with hello *return code of hello process*.</span></span> <span data-ttu-id="48049-686">它是工作的結束碼的重要 toonote**不**取決於 hello 批次服務。</span><span class="sxs-lookup"><span data-stu-id="48049-686">It is important toonote that a task's exit code is **not** determined by hello Batch service.</span></span> <span data-ttu-id="48049-687">取決於工作的結束代碼 hello 程序本身或 hello 作業系統上執行哪些 hello 程序。</span><span class="sxs-lookup"><span data-stu-id="48049-687">A task's exit code is determined by hello process itself or hello operating system on which hello process executed.</span></span>

### <a name="accounting-for-task-failures-or-interruptions"></a><span data-ttu-id="48049-688">處理工作失敗或中斷</span><span class="sxs-lookup"><span data-stu-id="48049-688">Accounting for task failures or interruptions</span></span>
<span data-ttu-id="48049-689">工作可能偶爾會失敗或中斷。</span><span class="sxs-lookup"><span data-stu-id="48049-689">Tasks might occasionally fail or be interrupted.</span></span> <span data-ttu-id="48049-690">hello 工作應用程式本身可能會失敗，hello 節點正在執行哪些 hello 工作可能會重新開機，或 hello 節點可能會移除從 hello 集區調整大小作業期間如果 hello 集區的解除配置原則是設定 tooremove 立即而不需等待的節點工作 toofinish。</span><span class="sxs-lookup"><span data-stu-id="48049-690">hello task application itself might fail, hello node on which hello task is running might be rebooted, or hello node might be removed from hello pool during a resize operation if hello pool's deallocation policy is set tooremove nodes immediately without waiting for tasks toofinish.</span></span> <span data-ttu-id="48049-691">在所有情況下，hello 工作可以自動排入佇列的批次以便在另一個節點上執行。</span><span class="sxs-lookup"><span data-stu-id="48049-691">In all cases, hello task can be automatically requeued by Batch for execution on another node.</span></span>

<span data-ttu-id="48049-692">它也可能會有間歇性問題 toocause 工作 toohang 或花太長 tooexecute。</span><span class="sxs-lookup"><span data-stu-id="48049-692">It is also possible for an intermittent issue toocause a task toohang or take too long tooexecute.</span></span> <span data-ttu-id="48049-693">您可以設定工作的 hello 最大執行時間間隔。</span><span class="sxs-lookup"><span data-stu-id="48049-693">You can set hello maximum execution interval for a task.</span></span> <span data-ttu-id="48049-694">如果超過 hello 最大執行時間間隔，hello 批次服務會中斷 hello 工作應用程式。</span><span class="sxs-lookup"><span data-stu-id="48049-694">If hello maximum execution interval is exceeded, hello Batch service interrupts hello task application.</span></span>

### <a name="connecting-toocompute-nodes"></a><span data-ttu-id="48049-695">連接 toocompute 節點</span><span class="sxs-lookup"><span data-stu-id="48049-695">Connecting toocompute nodes</span></span>
<span data-ttu-id="48049-696">您可以執行其他偵錯和疑難排解遠端登入 tooa 計算節點。</span><span class="sxs-lookup"><span data-stu-id="48049-696">You can perform additional debugging and troubleshooting by signing in tooa compute node remotely.</span></span> <span data-ttu-id="48049-697">您可以使用 Windows 節點 hello Azure 入口網站 toodownload 遠端桌面通訊協定 (RDP) 檔案，並取得 Linux 節點的安全殼層 (SSH) 連接資訊。</span><span class="sxs-lookup"><span data-stu-id="48049-697">You can use hello Azure portal toodownload a Remote Desktop Protocol (RDP) file for Windows nodes and obtain Secure Shell (SSH) connection information for Linux nodes.</span></span> <span data-ttu-id="48049-698">您同樣可以這樣使用 hello 批次 Api-例如，[批次.NET] [ net_rdpfile]或[批次 Python](batch-linux-nodes.md#connect-to-linux-nodes-using-ssh)。</span><span class="sxs-lookup"><span data-stu-id="48049-698">You can also do this by using hello Batch APIs--for example, with [Batch .NET][net_rdpfile] or [Batch Python](batch-linux-nodes.md#connect-to-linux-nodes-using-ssh).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="48049-699">透過 RDP 或 SSH tooconnect tooa 節點，您必須先建立使用者 hello 節點上。</span><span class="sxs-lookup"><span data-stu-id="48049-699">tooconnect tooa node via RDP or SSH, you must first create a user on hello node.</span></span> <span data-ttu-id="48049-700">toodo，您可以使用 Azure 入口網站，hello[新增使用者帳戶 tooa 節點][ rest_create_user]使用 hello 批次 REST API，呼叫 hello [ComputeNode.CreateComputeNodeUser] [net_create_user]方法在批次.NET 或呼叫 hello [add_user] [ py_add_user] hello 批次 Python 模組中的方法。</span><span class="sxs-lookup"><span data-stu-id="48049-700">toodo this, you can use hello Azure portal, [add a user account tooa node][rest_create_user] by using hello Batch REST API, call hello [ComputeNode.CreateComputeNodeUser][net_create_user] method in Batch .NET, or call hello [add_user][py_add_user] method in hello Batch Python module.</span></span>
>
>

### <a name="troubleshooting-problematic-compute-nodes"></a><span data-ttu-id="48049-701">疑難排解有問題的計算節點</span><span class="sxs-lookup"><span data-stu-id="48049-701">Troubleshooting problematic compute nodes</span></span>
<span data-ttu-id="48049-702">在某些工作失敗的情況下，批次的用戶端應用程式或服務可以檢查失敗的 hello 工作 tooidentify 異常節點 hello 中繼資料。</span><span class="sxs-lookup"><span data-stu-id="48049-702">In situations where some of your tasks are failing, your Batch client application or service can examine hello metadata of hello failed tasks tooidentify a misbehaving node.</span></span> <span data-ttu-id="48049-703">集區中的每個節點指定唯一的識別碼，以及工作執行所在的 hello 節點包含在 hello 工作中繼資料。</span><span class="sxs-lookup"><span data-stu-id="48049-703">Each node in a pool is given a unique ID, and hello node on which a task runs is included in hello task metadata.</span></span> <span data-ttu-id="48049-704">在找出問題節點之後，您即可對其採取數個行動︰</span><span class="sxs-lookup"><span data-stu-id="48049-704">After you've identified a problem node, you can take several actions with it:</span></span>

* <span data-ttu-id="48049-705">**重新啟動 hello 節點**([REST][rest_reboot] | [.NET][net_reboot])</span><span class="sxs-lookup"><span data-stu-id="48049-705">**Reboot hello node** ([REST][rest_reboot] | [.NET][net_reboot])</span></span>

    <span data-ttu-id="48049-706">重新啟動的 hello 節點有時可以清除等陷入不斷或損毀處理序的潛在問題。</span><span class="sxs-lookup"><span data-stu-id="48049-706">Restarting hello node can sometimes clear up latent issues like stuck or crashed processes.</span></span> <span data-ttu-id="48049-707">請注意，是否您的集區會使用啟動工作，或您的工作會使用作業準備工作，它們會執行 hello 節點重新啟動時。</span><span class="sxs-lookup"><span data-stu-id="48049-707">Note that if your pool uses a start task or your job uses a job preparation task, they are executed when hello node restarts.</span></span>
* <span data-ttu-id="48049-708">**重新安裝映像 hello 節點**([REST][rest_reimage] | [.NET][net_reimage])</span><span class="sxs-lookup"><span data-stu-id="48049-708">**Reimage hello node** ([REST][rest_reimage] | [.NET][net_reimage])</span></span>

    <span data-ttu-id="48049-709">這會重新安裝 hello 作業系統 hello 節點上。</span><span class="sxs-lookup"><span data-stu-id="48049-709">This reinstalls hello operating system on hello node.</span></span> <span data-ttu-id="48049-710">與重新啟動節點，啟動工作，並已建立映像 hello 節點之後，會重新執行作業準備工作。</span><span class="sxs-lookup"><span data-stu-id="48049-710">As with rebooting a node, start tasks and job preparation tasks are rerun after hello node has been reimaged.</span></span>
* <span data-ttu-id="48049-711">**移除 hello 集區中的 hello 節點**([REST][rest_remove] | [.NET][net_remove])</span><span class="sxs-lookup"><span data-stu-id="48049-711">**Remove hello node from hello pool** ([REST][rest_remove] | [.NET][net_remove])</span></span>

    <span data-ttu-id="48049-712">有時候很有必要 toocompletely 移除 hello 節點從 hello 集區。</span><span class="sxs-lookup"><span data-stu-id="48049-712">Sometimes it is necessary toocompletely remove hello node from hello pool.</span></span>
* <span data-ttu-id="48049-713">**停用工作排程在 hello 節點**([REST][rest_offline] | [.NET][net_offline])</span><span class="sxs-lookup"><span data-stu-id="48049-713">**Disable task scheduling on hello node** ([REST][rest_offline] | [.NET][net_offline])</span></span>

    <span data-ttu-id="48049-714">這實際上會讓 hello 節點離線，好讓沒有進一步的工作會指派 tooit，但是允許 hello 節點 tooremain 執行以及 hello 集區中。</span><span class="sxs-lookup"><span data-stu-id="48049-714">This effectively takes hello node offline so that no further tasks are assigned tooit, but allows hello node tooremain running and in hello pool.</span></span> <span data-ttu-id="48049-715">這可讓您 tooperform 進一步調查 hello 原因的 hello 失敗遺失 hello 失敗的工作的資料，而不造成額外的工作失敗的 hello 節點。</span><span class="sxs-lookup"><span data-stu-id="48049-715">This enables you tooperform further investigation into hello cause of hello failures without losing hello failed task's data, and without hello node causing additional task failures.</span></span> <span data-ttu-id="48049-716">例如，您可以停用工作排程 hello 節點上然後[遠端登入](#connecting-to-compute-nodes)tooexamine hello 節點的事件記錄檔，或執行其他疑難排解。</span><span class="sxs-lookup"><span data-stu-id="48049-716">For example, you can disable task scheduling on hello node, then [sign in remotely](#connecting-to-compute-nodes) tooexamine hello node's event logs or perform other troubleshooting.</span></span> <span data-ttu-id="48049-717">完成您的調查之後，您可以藉由啟用工作排程，然後讓 hello 節點上線 ([REST][rest_online] | [.NET] [net_online])，或執行 hello 的其中一個先前所討論的其他動作。</span><span class="sxs-lookup"><span data-stu-id="48049-717">After you've finished your investigation, you can then bring hello node back online by enabling task scheduling ([REST][rest_online] | [.NET][net_online]), or perform one of hello other actions discussed earlier.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="48049-718">描述這一節-每個動作以重新開機，重新安裝映像、 remove 和停用排程工作-您可以 toospecify 執行 hello 動作時，如何處理目前在 hello 節點上執行的工作。</span><span class="sxs-lookup"><span data-stu-id="48049-718">With each action that is described in this section--reboot, reimage, remove, and disable task scheduling--you are able toospecify how tasks currently running on hello node are handled when you perform hello action.</span></span> <span data-ttu-id="48049-719">例如，當您停用工作排程在節點上使用 hello 批次.NET 用戶端程式庫，您可以指定[DisableComputeNodeSchedulingOption] [ net_offline_option]列舉值 toospecify，是否太**Terminate**執行工作、**重新排入佇列**以供在其他節點上排程或執行 hello 動作之前允許執行的工作 toocomplete (**TaskCompletion**)。</span><span class="sxs-lookup"><span data-stu-id="48049-719">For example, when you disable task scheduling on a node by using hello Batch .NET client library, you can specify a [DisableComputeNodeSchedulingOption][net_offline_option] enum value toospecify whether too**Terminate** running tasks, **Requeue** them for scheduling on other nodes, or allow running tasks toocomplete before performing hello action (**TaskCompletion**).</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="48049-720">後續步驟</span><span class="sxs-lookup"><span data-stu-id="48049-720">Next steps</span></span>
* <span data-ttu-id="48049-721">深入了解 hello[批次應用程式開發介面和工具](batch-apis-tools.md)可用來建置批次的解決方案。</span><span class="sxs-lookup"><span data-stu-id="48049-721">Learn about hello [Batch APIs and tools](batch-apis-tools.md) available for building Batch solutions.</span></span>
* <span data-ttu-id="48049-722">逐步解說範例批次應用程式中逐步[開始使用 hello Azure Batch Library for.NET](batch-dotnet-get-started.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-722">Walk through a sample Batch application step-by-step in [Get started with hello Azure Batch Library for .NET](batch-dotnet-get-started.md).</span></span> <span data-ttu-id="48049-723">另外還有[Python 版本](batch-python-tutorial.md)在 Linux 執行工作負載的 hello 教學課程的計算節點。</span><span class="sxs-lookup"><span data-stu-id="48049-723">There is also a [Python version](batch-python-tutorial.md) of hello tutorial that runs a workload on Linux compute nodes.</span></span>
* <span data-ttu-id="48049-724">下載並建置 hello[批次總管][ github_batchexplorer]開發批次方案過程中使用的範例專案。</span><span class="sxs-lookup"><span data-stu-id="48049-724">Download and build hello [Batch Explorer][github_batchexplorer] sample project for use while you develop your Batch solutions.</span></span> <span data-ttu-id="48049-725">您可以使用 hello 批次檔案總管 執行 hello 下列以及其他更多：</span><span class="sxs-lookup"><span data-stu-id="48049-725">Using hello Batch Explorer, you can perform hello following and more:</span></span>

  * <span data-ttu-id="48049-726">監視和管理 Batch 帳戶內的集區、作業和工作</span><span class="sxs-lookup"><span data-stu-id="48049-726">Monitor and manipulate pools, jobs, and tasks within your Batch account</span></span>
  * <span data-ttu-id="48049-727">從節點下載 `stdout.txt`、`stderr.txt` 和其他檔案</span><span class="sxs-lookup"><span data-stu-id="48049-727">Download `stdout.txt`, `stderr.txt`, and other files from nodes</span></span>
  * <span data-ttu-id="48049-728">在節點上建立使用者，並下載遠端登入的 RDP 檔案</span><span class="sxs-lookup"><span data-stu-id="48049-728">Create users on nodes and download RDP files for remote login</span></span>
* <span data-ttu-id="48049-729">了解如何太[建立集區的 Linux 運算節點](batch-linux-nodes.md)。</span><span class="sxs-lookup"><span data-stu-id="48049-729">Learn how too[create pools of Linux compute nodes](batch-linux-nodes.md).</span></span>
* <span data-ttu-id="48049-730">請瀏覽 hello [Azure Batch 論壇][ batch_forum] MSDN 上。</span><span class="sxs-lookup"><span data-stu-id="48049-730">Visit hello [Azure Batch forum][batch_forum] on MSDN.</span></span> <span data-ttu-id="48049-731">hello 論壇是關於更佳放置 tooask 問題，您只想了，或在批次中使用的是專家。</span><span class="sxs-lookup"><span data-stu-id="48049-731">hello forum is a good place tooask questions, whether you are just learning or are an expert in using Batch.</span></span>

[1]: ./media/batch-api-basics/node-folder-structure.png

[azure_storage]: https://azure.microsoft.com/services/storage/
[batch_forum]: https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurebatch
[cloud_service_sizes]: ../cloud-services/cloud-services-sizes-specs.md
[msmpi]: https://msdn.microsoft.com/library/bb524831.aspx
[github_samples]: https://github.com/Azure/azure-batch-samples
[github_sample_taskdeps]:  https://github.com/Azure/azure-batch-samples/tree/master/CSharp/ArticleProjects/TaskDependencies
[github_batchexplorer]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/BatchExplorer
[batch_net_api]: https://msdn.microsoft.com/library/azure/mt348682.aspx
[msdn_env_vars]: https://msdn.microsoft.com/library/azure/mt743623.aspx
[net_cloudjob_jobmanagertask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudjob.jobmanagertask.aspx
[net_cloudjob_priority]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudjob.priority.aspx
[net_cloudpool_starttask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudpool.starttask.aspx
[net_cloudtask_env]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudtask.environmentsettings.aspx
[net_create_cert]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.certificateoperations.createcertificate.aspx
[net_create_user]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.createcomputenodeuser.aspx
[net_getfile_node]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.getnodefile.aspx
[net_getfile_task]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudtask.getnodefile.aspx
[net_job_env]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudjob.commonenvironmentsettings.aspx
[net_multiinstancesettings]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.multiinstancesettings.aspx
[net_onalltaskscomplete]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudjob.onalltaskscomplete.aspx
[net_rdp]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.getrdpfile.aspx
[net_reboot]: https://msdn.microsoft.com/library/azure/mt631495.aspx
[net_reimage]: https://msdn.microsoft.com/library/azure/mt631496.aspx
[net_remove]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.pooloperations.removefrompoolasync.aspx
[net_offline]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.disableschedulingasync.aspx
[net_online]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.enableschedulingasync.aspx
[net_offline_option]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.common.disablecomputenodeschedulingoption.aspx
[net_rdpfile]: https://msdn.microsoft.com/library/azure/Mt272127.aspx
[vnet]: https://msdn.microsoft.com/library/azure/dn820174.aspx#bk_netconf

[py_add_user]: http://azure-sdk-for-python.readthedocs.io/en/latest/ref/azure.batch.operations.html#azure.batch.operations.ComputeNodeOperations.add_user

[batch_rest_api]: https://msdn.microsoft.com/library/azure/Dn820158.aspx
[rest_add_job]: https://msdn.microsoft.com/library/azure/mt282178.aspx
[rest_add_pool]: https://msdn.microsoft.com/library/azure/dn820174.aspx
[rest_add_cert]: https://msdn.microsoft.com/library/azure/dn820169.aspx
[rest_add_task]: https://msdn.microsoft.com/library/azure/dn820105.aspx
[rest_create_user]: https://msdn.microsoft.com/library/azure/dn820137.aspx
[rest_get_task_info]: https://msdn.microsoft.com/library/azure/dn820133.aspx
[rest_job_schedules]: https://msdn.microsoft.com/library/azure/mt282179.aspx
[rest_multiinstance]: https://msdn.microsoft.com/library/azure/mt637905.aspx
[rest_multiinstancesettings]: https://msdn.microsoft.com/library/azure/dn820105.aspx#multiInstanceSettings
[rest_update_job]: https://msdn.microsoft.com/library/azure/dn820162.aspx
[rest_rdp]: https://msdn.microsoft.com/library/azure/dn820120.aspx
[rest_reboot]: https://msdn.microsoft.com/library/azure/dn820171.aspx
[rest_reimage]: https://msdn.microsoft.com/library/azure/dn820157.aspx
[rest_remove]: https://msdn.microsoft.com/library/azure/dn820194.aspx
[rest_offline]: https://msdn.microsoft.com/library/azure/mt637904.aspx
[rest_online]: https://msdn.microsoft.com/library/azure/mt637907.aspx

[vm_marketplace]: https://azure.microsoft.com/marketplace/virtual-machines/
