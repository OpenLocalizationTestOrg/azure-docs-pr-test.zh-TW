---
title: "航太在航太工業中使用 Azure - Cortana Intelligence 解決方案進行預測性維護的範本 | Microsoft Docs"
description: "航太、公用事業和運輸中預測性維護的 Microsoft Cortana Intelligence 解決方案範本。"
services: cortana-analytics
documentationcenter: 
author: fboylu
manager: jhubbard
editor: cgronlun
ms.assetid: 2e8b66db-91eb-432b-b305-6abccca25620
ms.service: cortana-analytics
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/14/2017
ms.author: fboylu
ms.openlocfilehash: da7826c49c3548600187956908f5369cc4891065
ms.sourcegitcommit: 4ac89872f4c86c612a71eb7ec30b755e7df89722
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/07/2017
---
# <a name="cortana-intelligence-solution-template-playbook-for-predictive-maintenance-in-aerospace-and-other-businesses"></a>航太與其他業務中預測性維護的 Cortana Intelligence 解決方案範本的腳本
## <a name="executive-summary"></a>執行摘要
預測性維護是要求最高的預測性分析應用程式之一，其優點不容置疑，包括大幅節省成本。 本腳本旨在提供預測性維護解決方案的參考資料，著重於主要使用案例。
它能夠讓讀者了解預測性維護的最常見商務案例、減輕這類解決方案之商務問題的挑戰、解決這些商務問題所需的資料，以及使用這類資料和最佳作法搭配範例解決方案架構來建置解決方案的預測性模型化技巧。
此外，還描述了所開發預測性模型的詳細規格，例如特徵設計、模型開發和效能評估。 基本上，本腳本結合了成功開發及部署預測性維護解決方案所需的商務和分析指導方針。 這些指導方針能夠協助讀者使用 Cortana Intelligence Suite 和 (尤其是) Azure Machine Learning 建立初步解決方案，以做為其長期預測性維護策略的起點。 在 [Cortana Analytics](http://www.microsoft.com/server-cloud/cortana-analytics-suite/overview.aspx) 和 [Azure Machine Learning](https://azure.microsoft.com/services/machine-learning/) 頁面可取得 Cortana Intelligence Suite 和 Azure Machine Learning 相關文件。

> [!TIP]
> 如需實作此解決方案範本的技術指南，請參閱 [預測性維護的 Cortana Intelligence 解決方案範本技術指南](cortana-analytics-technical-guide-predictive-maintenance.md)。
> 若要下載可提供此範本架構概觀的圖表，請參閱 [預測性維護的 Cortana Intelligence 解決方案範本架構](cortana-analytics-architecture-predictive-maintenance.md)。
> 
> 

## <a name="playbook-overview-and-target-audience"></a>腳本概觀和適用對象
本腳本主要適用於具有各種背景且對預測性維護空間感興趣的技術和非技術讀者。 本腳本涵蓋各種預測性維護解決方案的高階層面，以及如何加以實作的詳細資料。 周全的內容可滿足下列兩種對象的需求：只對了解解決方案空間和應用程式類型有興趣的讀者，以及想要實作這些解決方案，因而對技術詳細資料感興趣的讀者。

本腳本的大部分內容並未假設先驗資料科學知識或專業技術。 不過，本腳本的某些部分則需要稍微熟悉資料科學概念，才能夠遵循實作詳細資料。 必須具備入門級資料科學技能，才能夠完全吸收這幾節的資料。

本腳本的前半部涵蓋預測性維護應用程式的簡介、如何限定預測性維護解決方案、包含商務問題詳細資料的常見使用案例集合、這些使用案例的相關資料，以及實作這些預測性維護解決方案的商業優勢。 這幾節則不需具備任何預測性分析領域的技術知識。

在本腳本的後半部中，我們將討論預測性維護應用程式的預測性模型化技巧類型，以及如何透過腳本前半部所述的使用案例中的範例來實作這些模型。 因此文中逐步解說資料前處理的步驟，例如資料標記和特徵設計、模型選取、訓練/測試和效能評估最佳作法。 下列各節適合於技術讀者。

## <a name="predictive-maintenance-in-iot"></a>IoT 中的預測性維護
未排程的設備停機時間可能會對企業造成極度破壞性的影響。 務必讓現場設備保持運作，並減少代價很高的非排程停機時間，才能達到最大使用率和效能。 簡單來說，在現今的商務營運環境中，等待故障發生的代價極為慘痛。 為了保持競爭力，公司利用從各種管道收集來的資料，以尋求可將資產效能最大化的新方法。 利用採用歷史模式的預測性分析技巧來預測未來結果，是分析這類資訊的重要方法之一。 其中一個最受歡迎的解決方案稱為「預測性維護」，其通常可定義為但不限於預測近期內資產故障的可能性，所以可監視資產，主動識別故障並在發生故障前採取動作。 這些解決方案會偵測故障模式，以判斷故障風險最大的資產。 早期找出問題有助於以更符合成本效益的方式部署有限的維護資源，並增強品質和供應鏈流程。

隨著物聯網 (IoT) 應用程式的興起，預測性維護逐漸受到業界關注，因為資料收集和處理技術已臻成熟，足以即時或分批產生、傳輸、儲存和分析所有種類的資料。 這類技術能夠利用進階分析解決方案、預測性維護解決方案，輕鬆開發和部署端對端解決方案，以提供公認最大的優勢。

預測性維護領域中的商務問題包羅萬象，包括因為非預期的故障以及對複雜商務環境中的問題根本原因見解有限所引起的高營運風險。 這些問題大多可以歸類成下列幾個商務問題：

* 設備在近期內故障的機率為何？
* 設備的剩餘使用年限為何？
* 故障原因為何以及應執行哪些維護動作來修正這些問題？

利用預測性維護來回答這些問題，企業可以︰

* 在故障發生前發現故障情況，以降低營運風險並提高資產報酬率
* 減少不必要的以時間為基礎的維護作業並控制維護成本
* 改善整體品牌形象、消除不良名聲以及客戶流失所造成的銷售損失
* 藉由預測再訂購點來降低庫存量，進而降低庫存成本
* 探索與各種維護問題有關連的模式

預測性維護方案可提供給企業一些關鍵效能指標，例如：用來監視即時資產狀況的健康狀態分數、資產的剩餘壽命預估、主動維護活動的建議，以及更換零件的預估訂單日期。

## <a name="qualification-criteria-for-predictive-maintenance"></a>預測性維護的限定準則
在此務必強調，預測性維護不一定能有效解決所有的使用案例或商務問題。 重要限定準則包括問題是否具預測性本質、存在明確的動作路徑以便在事先偵測到故障時避開，而最重要的是，可取得品質足以支援使用案例的資料。 在這裡，我們著重於建置成功預測性維護解決方案的資料需求。

建立預測性模型時，我們會使用歷程記錄資料來訓練模型，而後該模型可辨識隱藏的模式並進一步在未來的資料中識別出這些模式。 這些模型是以依特徵描述的範例和預測目標進行訓練。 經過訓練的模型應該只會查看新範例的特徵，進而在目標上進行預測。 請務必記得模型會擷取特徵和預測目標之間的關聯性。 為了訓練有效的機器學習模型，我們需要訓練資料 (包括對預測目標有實際預測能力的特徵)，這表示資料應預期精確的預測與相關的預測的目標的預測能力的。

舉例來說，如果目標是要預測列車輪子的故障，則訓練資料應包含輪子相關特徵 (例如可反映輪子健康狀態、里程數、裝載貨物等的遙測資料)。 不過，如果目標是要預測訓練引擎失敗，我們可能需要另一組具有引擎相關特徵的訓練資料。 在建立預測性模型之前，我們希望商務專家能了解資料相關性需求，並提供選取相關資料子集以供分析所需的領域知識。

在限定適用於預測性維護解決方案的商務問題時，我們會尋找三個基本資料來源：

1. 故障歷程記錄：在預測性維護應用程式中，故障事件通常非常罕見。 不過，在建立可預測故障的預測性模型時，此演算法需要透過訓練程序來了解正常運作模式和故障模式。 因此，訓練資料一定要在兩個類別中包含足量的範例，才能夠了解這兩個不同的模式。 基於這個理由，我們要求資料有足量的故障事件。 在維護記錄和零件更換歷程記錄中可以找到故障事件，或是訓練資料中的異常狀況也可做為領域專家所認同的故障。
2. 維護/維修歷程記錄：預測性維護解決方案的基本資料來源是資產的詳細維護歷程記錄，其中包含所更換的零組件相關資訊、所執行的預防性維護活動等等。請務必記得擷取這些事件，因為這些事件會影響降低模式，而缺少這項資訊將會造成誤導的結果。
3. 機器狀況：為了預測機器在故障前將會多持續幾天 (小時、英哩、交易等)，我們假設機器的健康狀態在其作業期間將會隨著時間降低。 因此，我們預期資料會包含隨時間變化的特徵，以擷取此老化模式以及任何會導致降低的異常狀況。 在 IoT 應用程式中，來自不同感應器的遙測資料就是一個很好的例子。 為了預測機器是否即將在某個時間範圍內故障，在理想的情況下，資料應在實際故障事件之前擷取這個時間範圍的效能降低趨勢。

此外，我們需要與預測目標資產的運作情況直接相關的資料。 目標是根據商務需求與資料可用性來決定。 以列車輪子故障預測為例，我們可能會預測「輪子是否即將故障」或「整列火車是否即將故障」。 第一項預測的目標為比較特定的零組件，而第二項預測的目標為火車故障。 第二項預測是比較一般的問題，其所需的資料元素比第一項預測更分散，以致更難以建立模型。 相反地，只是藉由查看概括火車狀況資料來嘗試預測輪子故障並不可行，因為該資料不包含零組件層級的資訊。 一般而言，預測特定故障事件比預測一般故障事件更加合理。

有關故障歷程記錄資料的常見問題之一是「需要多少個故障事件才能訓練模型且多少個事件才算「足夠？ 」 該問題沒有明確的答案，因為在許多預測性分析案例中，資料品質通常會支配什麼是可接受的答案。 如果資料集不包含與故障預測相關的特徵，則即使有許多故障事件，也不可能建立良好的模型。 不過，經驗法則是故障事件愈多，模型就會愈好，而概略估計需要多少個故障範例是極為內容和資料相依的測量方法。 此問題將會在處理不平衡資料集的章節中進行討論，而我們會提出幾個建議方法來對付沒有足量故障的問題。

## <a name="sample-use-cases"></a>範例使用案例
本節著重於好幾個產業 (如航太、公用事業和運輸) 的各種預測性維護使用案例。 每個小節深入探索從這些領域收集的使用案例，並討論商務問題、商務問題相關資料以及預測性維護解決方案的優點。

### <a name="aerospace"></a>航太
#### <a name="use-case-1-flight-delay-and-cancellations"></a>使用案例 1：航班延誤和取消
##### <a name="business-problem-and-data-sources"></a>*商務問題和資料來源*
航空公司所面臨的其中一個主要商務問題，就是與因機械問題而延誤航班相關的重大成本。 如果無法修復機械故障，甚至可能會取消航班。 這會付出極大的代價，因為延誤會造成排程和作業問題、導致信譽不佳和客戶不滿，以及其衍生他許多問題。 航空公司對於事先預測這類機械故障特別感興趣，讓他們可以減少航班延誤或取消情況。 這些案例的預測性維護解決方案的目標在於根據相關的資料來源 (例如維護歷程記錄和飛行路線資訊)，預測班機延誤或取消的機率。 這個使用案例的兩個主要資料來源是班機航段和頁面記錄檔。 班機航段資料包括有關飛行路線的詳細資訊，例如：起飛和抵達的日期和時間、起飛和抵達的機場等。頁面記錄檔資料包括維護人員所記錄的一系列錯誤和維護代碼。

##### <a name="business-value-of-the-predictive-model"></a>*預測性模型的商業價值*
使用可用的歷程記錄資料，透過多類別演算法來建立預測性模型，以預測在接下來 24 小時內會導致航班延誤或取消的機械問題。 藉由這項預測，可採取必要的維護動作來降低執行班機勤務時的風險，因而避免延誤或取消情形。 使用 Azure Machine Learning Web 服務，可以將預測性模型順暢而輕鬆地整合到航空公司的現有作業平台。 

#### <a name="use-case-2-aircraft-component-failure"></a>使用案例 2：飛機零組件故障
##### <a name="business-problem-and-data-sources"></a>*商務問題和資料來源*
飛機引擎是非常敏感且昂貴的設備部分，而更換引擎零件是航空業界最常見的維護工作。 航空公司的維護解決方案需要審慎管理零組件存貨的可用性、遞送和規劃。 能夠蒐集零組件可靠性的情報消息，將使投資成本大幅降低。 這個使用案例的主要資料來源是從飛機上數個感應器收集來的遙測資料，可提供飛機狀況的資訊。 維護記錄也會用來識別零組件發生故障和更換的時間。

##### <a name="business-value-of-the-predictive-model"></a>預測性模型的商業價值
已建立一個多類別的分類模型，可預測下個月內特定零組件引起故障的機率。 航空公司可以運用這些解決方案，來降低零組件維修成本、改善零組件存貨可用性、降低相關資產的庫存量及改善維護計劃。

### <a name="utilities"></a>公用事業
#### <a name="use-case-1-atm-cash-dispense-failure"></a>使用案例 1：ATM 現金提領失敗
##### <a name="business-problem-and-data-sources"></a>*商務問題和資料來源*
資產密集產業的經營者常表示其企業的主要營運風險就是其資產的非預期故障。 舉例而說，機器故障 (例如銀行業的 ATM) 是經常發生的常見問題。 這幾種問題讓這類機器的操作人員非常渴望擁有預測性維護解決方案。 在此使用案例中，預測問題用來計算 ATM 現金提款交易將會因為提款機故障 (例如卡紙或零件故障) 而中斷的機率。 這個案例的主要資料來源是在提領現金鈔票時會收集測量數據的感應器讀數，以及收集一段時間的維護記錄。 感應器資料包含完成的每筆交易的感應器讀數，以及提領的每張鈔票的感應器讀數。 感應器讀數提供了一些測量數據，例如鈔票之間的間隔，厚度、鈔票送達距離等等。維護資料包含錯誤代碼與維修資訊。 這些資料用來找出失敗案例。

##### <a name="business-value-of-the-predictive-model"></a>*預測性模型的商業價值*
已建立兩個預測性模型，可預測現金提款交易失敗以及交易期間內提領的個別鈔票失敗。 能夠事先預測交易失敗，即可主動檢修 ATM 以避免發生故障。 此外，透過鈔票失敗預測，如果交易可能在完成前因為鈔票提領失敗而失敗，最好是停止程序並警告客戶此交易未完成，而不是在發生錯誤後等待維護服務人員抵達，這可能會導致客戶更加不滿。

#### <a name="use-case-2-wind-turbine-failures"></a>使用案例 2：風力渦輪機故障
##### <a name="business-problem-and-data-sources"></a>*商務問題和資料來源*
隨著環保意識的提升，風力渦輪機已成為主要的能源產生來源之一，它們通常需花費數百萬美元。 風力渦輪機的其中一個重要零組件是配有許多感應器的發電機馬達，可協助監視渦輪機狀況和狀態。 感應器讀數包含可用來建立預測性模型的寶貴資訊，可供預測重要的關鍵效能指標 (KPI)，例如風力渦輪機零組件的平均故障時間。 這個使用案例的資料來自位於三個不同廠區位置的多部風力渦輪機。 每隔 10 秒會從每部渦輪機上近一百台的感應器記錄測量數據 (為期一年)。 這些讀數包括一些測量數據，例如溫度、發電機速度、渦輪機電力和發電機繞組。

##### <a name="business-value-of-the-predictive-model"></a>*預測性模型的商業價值*
已建立一些預測性模型，可估計發電機和溫度感應器的剩餘使用年限。 透過預測故障機率，維護技術人員可以著重於可能不久就會故障的可疑渦輪機，進而補強以時間為基礎的維護制度。
此外，預測性模型深入分析不同因素對故障機率的貢獻程度，協助企業進一步了解問題的根本原因。

#### <a name="use-case-3-circuit-breaker-failures"></a>使用案例 3：斷路器故障
##### <a name="business-problem-and-data-sources"></a>*商務問題和資料來源*
電力和天然氣運作 (包括電能的產生、配送和銷售) 需要大量維護，以確保電力線路隨時都能運作，進而保證將能源配送到每戶人家。 這類運作失敗極為嚴重，因為在發生電力問題的區域中幾乎每個實體都會受到影響。 斷路器對於這類運作而言非常重要，因為在發生問題和簡短電路的情況下，斷路器會切斷電流，以免電力線路發生任何損壞。 這個使用案例的商務問題是要根據指定的維護記錄、命令歷程記錄和技術規格來預測斷路器故障。

這個案例的三個主要資料來源是維護記錄 (包括校正性、預防性和有系統的動作)、運作資料 (包括傳送至斷路器的自動和手動命令，例如開啟和關閉動作)，以及每個斷路器的屬性相關技術規格資料。例如製造年份、位置、型號等。

##### <a name="business-value-of-the-predictive-model"></a>*預測性模型的商業價值*
預測性維護解決方案有助於降低維修成本及提高設備 (例如斷路器) 的生命週期。 這些模型也有助於改善電力網路的品質，因為這些模型提前提供的警告可減少非預期的故障，而使服務中斷情形變少。

#### <a name="use-case-4-elevator-door-failures"></a>使用案例 4：電梯門故障
##### <a name="business-problem-and-data-sources"></a>*商務問題和資料來源*
大多數的電梯公司通常都有數百萬部電梯在世界各地運作。 為了取得競爭優勢，他們會著重於客戶最為關切的可靠性。 利用物聯網的潛力，將其電梯連接到雲端並從電梯感應器和系統蒐集資料，即可將資料轉換成珍貴的商業智慧，其提供競爭對手尚未可用的預測性和先佔式維護，進而大幅改善運作。 這個案例的商務需求是要提供一個知識庫預測性應用程式，用來預測電梯門故障的可能原因。 這項實作所需的資料包含三個部分：電梯靜態特徵 (例如識別碼，合約維護頻率、建築類型等)、使用量資訊 (例如電梯門循環次數、平均關門時間等) 以及故障歷程記錄 (也就是過去的故障記錄及其原因)。

已使用 Azure Machine Learning 建立一個多類別羅吉斯迴歸模型，並以整合式靜態特徵和使用量資料做為特徵，以及以過去故障記錄的原因做為類別標籤來解決預測問題。 現場技術人員所用行動裝置上的應用程式將使用此預測性模型來協助提升工作效率。 當技術人員到現場維修電梯時，他們可以參考此應用程式，以取得建議原因和儘速修復電梯門的最佳維護動作程序。

### <a name="transportation-and-logistics"></a>運輸和物流
#### <a name="use-case-1-brake-disc-failures"></a>使用案例 1：煞車碟盤故障
##### <a name="business-problem-and-data-sources"></a>*商務問題和資料來源*
車輛的一般維護原則包括校正性和預防性維護。 校正性維護意指在發生可能對駕駛造成嚴重不便的故障之後修復車輛，因而造成非預期的機能失常和浪費在造訪技師的時間。 大部分的車輛也會受限於預防性維護原則，該原則要求依照排程執行某些檢查，其中不會考慮到汽車子系統的實際狀況。 這些方法均無法成功地完全排除問題。 這裡提供的特定使用案例是一項煞車碟盤故障預測，該預測是以透過汽車輪胎系統中安裝的感應器所收集的資料為基礎，而這些感應器會追蹤過去的行駛模式和汽車所處的其他狀況。 這個案例的最重要資料來源為測量加速、煞車模式、行駛距離、速度等的感應器資料。這項資訊若搭配其他靜態資訊 (如汽車特徵)，有助於建置一組可用於預測性模型中的理想預測值。 另一組必備資訊是從零件訂單資料庫 (用來保留汽車在保養廠進行保養時的備用零件訂單日期與數量) 推斷而來的故障資料。

##### <a name="business-value-of-the-predictive-model"></a>*預測性模型的商業價值*
此處預測方法的商業價值很豐厚。 預測性維護系統可以根據預測性模型來安排進廠保養時間。 此模型可以代表汽車目前狀況和行駛歷程記錄的感應資訊為基礎。 這種方法可以將非預期故障的風險降至最低，但非預期故障也可能會發生在下一次定期保養之前。
此外，也可以減少不必要的預防性維護。 駕駛可以主動獲知在幾週內可能需要更換零件，並將該資訊提供給保養廠。 然後保養廠可以為該駕駛事先準備個別的保養套組。

#### <a name="use-case-2-subway-train-door-failures"></a>使用案例 2：地鐵列車門故障
##### <a name="business-problem-and-data-sources"></a>*商務問題和資料來源*
列車的車門故障是地鐵誤點和營運問題的主要原因之一。 預測列車的車門是否故障，或是能夠預測下一次發生車門故障的天數，極有遠見。 這提供了最佳化列車車門保養及降低列車停擺時間的機會。

#### <a name="data-sources"></a>資料來源
此使用案例中有三個資料來源 

* **列車事件資料**，這是列車事件的歷程記錄， 
* **維護資料** ，例如維護類型、工單類型和優先順序代碼，  
* **故障記錄**。

##### <a name="business-value-of-the-predictive-model"></a>*預測性模型的商業價值*
已建立兩個模型，分別使用二元分類來預測隔天故障機率，以及使用迴歸來預測下次發生故障的天數。 與先前的案例類似，這些模型可補強定期維護制度，進而創造出提升服務品質和提高客戶滿意度的大好機會。

## <a name="data-preparation"></a>資料準備
### <a name="data-sources"></a>資料來源
預測性維護問題的常見資料元素可彙總如下：

* 故障歷程記錄：機器或機器內零組件的故障歷程記錄。
* 維護歷程記錄：機器的維修歷程記錄，例如錯誤代碼、之前維護活動或零組件替換。
* 機器狀況和使用量：機器的運作狀況，例如從感應器收集的資料。
* 機器特徵：機器的特徵，例如引擎大小、廠牌和型號、地點。
* 操作者特徵：操作者的特徵，例如性別、過去經驗。

故障歷程記錄通常有可能包含在維修歷程記錄中，例如以特殊錯誤代碼或備用零件的訂單日期形式呈現。 在這些情況下，可以從維護資料擷取故障資料。 此外，不同的商業領域可能有各種會影響故障模式的其他資料來源，這裡並未一一列出。 在建立預測性模型時請教各領域專家，應可找出這些資料來源。

上述使用案例中的某些資料元素範例包括：

失敗記錄： 飛行延遲日期、 飛機元件失敗的日期和類型、 ATM 現金提款交易失敗、 訓練/電梯門失敗、 剎車組磁碟取代訂單日期、 wind 渦輪機失敗的日期和斷路器命令失敗。

維護歷程記錄：航班錯誤記錄檔、ATM 交易錯誤記錄檔、列車維護記錄 (包括維護類型、簡短描述等) 和斷路器維護記錄。

機器狀況和使用量：飛行路線和時間、從飛機引擎收集的感應器資料、ATM 交易的感應器讀數、列車事件資料、從風力渦輪機、電梯和連線汽車收集的感應器讀數。

機器特徵：斷路器技術規格 (例如電壓等級)、地理位置或汽車特徵 (例如廠牌、型號、引擎大小、輪胎類型、生產設備等)。

根據上述的資料來源，我們在預測性維護領域中觀察到的兩種主要資料類型為暫時資料和靜態資料。
故障歷程記錄、機器狀況、維修歷程記錄、使用量歷程記錄幾乎都附有時間戳記，以指出每一筆資料的收集時間。 一般而言，機器特徵和操作者特徵屬於靜態資料，因為它們通常會描述機器的技術規格或操作者的屬性。 這些特徵可能會隨著時間改變，若是如此，則應將它們視為具有時間戳記的資料來源。

### <a name="merging-data-sources"></a>合併資料來源
在進入任何類型的特徵設計或標記程序之前，我們必須先以建立特徵所需的形式來準備我們的資料。 最終目標是要針對每個資產的每個時間單位產生一筆記錄，並將其特徵和標籤饋入機器學習演算法中。 若要準備明確的最終資料集，則必須採取一些前處理步驟。 第一個步驟是將資料收集期間分割成數個時間單位，而每一筆記錄會屬於某項資產的某一個時間單位。 資料收集可以也分割成其他單位 (例如動作)，不過為了簡單起見，我們將使用時間單位進行其餘的說明。

根據資料準備的效率以及在不同時間單位之間的資產狀況中觀察到的變更或領域特有的其他因素，時間的度量單位可以是秒、分鐘、小時、天、月、週期、英哩或交易。 換句話說，時間單位不一定要與資料收集的頻率相同，因為在許多情況下，資料可能不會顯示單位之間的差異。 比方說，如果每隔 10 秒收集一次溫度值，則為整個分析挑選 10 秒的時間單位會使範例數目不當擴大，而不需提供任何其他資訊。 比較好的策略會是使用一小時的平均值做為範例。

前一節說明的可能資料來源的一般資料結構描述範例如下：

維護記錄：這些是已執行的維護動作記錄。 原始維護資料通常附有資產識別碼和時間戳記，以及當時執行維護活動的相關資訊。 如果出現這種原始資料，維護活動必須轉譯成類別資料行，而每個類別會對應至某個維護動作類型。 維護記錄的基本資料結構描述包含資產識別碼、時間和維護動作資料行。

故障記錄：這些是屬於預測目標的記錄，我們稱之為故障或故障原因。 這些可以是依特定商務狀況所定義的特定錯誤代碼或故障事件。 在某些情況下，資料會包含多個錯誤代碼，其中一些會對應至感興趣的故障。 並非所有的錯誤都是預測的目標，因此其他錯誤通常用來建構可能與故障相互關聯的特徵。 故障記錄的基本資料結構描述會包含資產識別碼、時間和故障或故障原因 (如果可取得原因) 資料行。

機器狀況：這些是有關機器運作狀況的監視資料 (最好是即時資料)。 比方說，機門故障，開門和關門時間是有關機門目前狀況的良好指標。 機器狀況的基本資料結構描述包含資產識別碼、時間和狀況值資料行。

機器和操作者資料：機器和操作者資料可以合併成一個結構描述，以識別哪一項資產是由哪一個操作者操作以及資產和操作者屬性。 例如，汽車通常是由駕駛所擁有，其屬性包含年齡、駕駛經驗等。如果此資料會隨著時間改變，這項資料也應該包含時間資料行，並應視為不同的功能產生的資料的時間。 機器狀況的基本資料結構描述包含資產識別碼、資產特徵、操作者識別碼和操作者特徵。

將機器狀況資料表與資產識別碼和時間欄位上的故障記錄進行左聯結，即可產生標記和特徵產生前的最後一個資料表。 然後這個資料表會與資產識別碼和時間欄位上的維修記錄聯結，最後再與資產識別碼上的機器和操作者特徵聯結。 第一個左聯結會在機器運作正常時讓故障資料行維持 null 值，而這些 null 值可由正常運作的指標值插補。 此故障資料行將用於建立預測性模型的標籤。

### <a name="feature-engineering"></a>特徵設計
模型化的第一個步驟就是特徵設計。 特徵產生的原則就是使用截至特定時間點所收集的歷程記錄資料，在概念上描述和摘要說明機器在該時間點的健康狀況。 在下一節中，我們將提供可用於預測性維護的技巧類型概觀，以及如何針對每種技巧進行標記。 應使用的確切技巧取決於資料和商務問題。 不過，以下所述的特徵設計方法可當作建立特徵的基準。 我們會接著討論應從附有時間戳記的資料來源建構的延隔時間特徵，以及從靜態資料來源建立的靜態特徵，並提供使用案例中的範例。

#### <a name="lag-features"></a>延隔時間特徵
如先前所述，在預測性維護中，歷程記錄資料通常附有時間戳記，以指出每一筆資料的收集時間。 有許多方法可從附有時間戳記資料的資料建立特徵。 在這一節中，我們會討論用於預測性維護的其中一些方法。 不過，我們不會只受限於這些方法。 因為特徵設計被視為預測性模型中最具創意的領域之一，所以可能有許多其他方式可用來建立特徵。 我們在此提供了某些一般技巧。

##### <a name="rolling-aggregates"></a>*滾動彙總*
對於資產的每一筆記錄，我們選擇大小為 "W" 的滾動時段，這也就是我們想要計算歷程記錄彙總的時間單位數。 然後，我們會使用該記錄的日期之前的 W 個期間，計算滾動彙總特徵。 滾動彙總的範例包括：滾動計數、平均值、標準差、以標準差為基礎的離群值、CUSUM 量值、時段的最小和最大值。 還有另一個有趣的技巧，就是使用以異常偵測演算法偵測資料異常的演算法來擷取趨勢變更、尖峰和層級變更。

如需示範，請參閱圖 1，我們以藍線表示針對每個時間單位的資產所記錄的感應器值，並標示 W = 3 時位於 t<sub>1</sub> 和 t<sub>2</sub> 之記錄 (分別以橘色和綠色群組表示) 的滾動平均特徵計算。

![圖 1. 滾動彙總特徵](./media/cortana-analytics-playbook-predictive-maintenance/rolling-aggregate-features.png)

圖 1. 滾動彙總特徵

舉例來說，飛機零組件故障時，上一週、過去三天和過去一天的感應器值會用來建立滾動平均值、標準差及總和特徵。 同樣地，ATM 故障時，則會使用原始感應器值和滾動平均值、中間值、值域、標準差、超過三個標準差的離群值數目、CUMSUM 上限和下限特徵。

對於航班延誤預測，則會使用上一週的錯誤代碼計數來建立特徵。 對於列車門故障，則會使用過去一天的事件計數、過去 2 週的事件計數和過去 15 天的事件計數變異來建立延隔時間特徵。 維護相關事件採用了相同的計算方式。

此外，透過挑選非常大的 W (例如， 年)，就能查看資產的完整歷程記錄 (例如計算所有維護記錄、故障等)， 直到記錄的時間為止。 這個方法用於計算過去三年的斷路器故障。 同樣對於列車故障，所有維護事件都會計算在內，以建立一個可擷取長期維護效果的特徵。

##### <a name="tumbling-aggregates"></a>*輪轉彙總*
針對資產的每個標記記錄，我們挑選了一個大小為 "W-<sub>k</sub>" 的時段，其中 k 是我們想要為其建立延隔時間特徵之大小 "W" 的數量或時段。 可為 "k" 挑選較大的數目以擷取長期降低模式，或挑選較小的數目以擷取短期效果。 我們接著使用 k 個輪轉時段 W-<sub>k</sub> 、W-<sub>(k-1)</sub> ...... W-<sub>2</sub>、W-<sub>1</sub> 來建立記錄日期和時間之前期間的彙總特徵 (請參閱圖 2)。 這些也是圖 2 中未擷取之時間單位的記錄層級滾動時段，但概念與圖 1 相同，其中 t<sub>2</sub> 也會用來示範滾動效果。

![圖 2. 輪轉彙總特徵](./media/cortana-analytics-playbook-predictive-maintenance/tumbling-aggregate-features.png)

圖 2. 輪轉彙總特徵

以風力渦輪機為例，使用 W=1 和 k=3 個月來建立過去 3 個月內每個月的延隔時間特徵 (使用最大和最小離群值)。

#### <a name="static-features"></a>靜態特徵
這些是設備的技術規格，例如製造日期、型號、位置等等。雖然延隔時間特徵本質上多半為數值，而靜態特徵通常會變成模型中的類別變數。 舉例來說，會使用斷路器屬性 (例如電壓、電流和電力規則以及變壓器類型、電源等)。 對於煞車碟盤故障，輪圈類型 (例如是否為合金或鋼材) 會當作一些靜態特徵使用。

在特徵產生期間，應執行其他一些重要步驟，例如處理遺失值和正規化。 遺失值插補和資料正規化的方法都有很多種，此處將不會加以討論。 不過，嘗試不同的方法來看看是否可能提升預測效能，則是非常實用。

當時間單位為 1 天時，上一節所述的特徵設計步驟後面的最終特徵資料表應該類似下列範例資料結構描述：

| 資產識別碼 | 時間 | 特徵資料行 | 標籤 |
| --- | --- | --- | --- |
| 1 |第 1 天 | | |
| 1 |第 2 天 | | |
| ... |... | | |
| 2 |第 1 天 | | |
| 2 |第 2 天 | | |
| ... |... | | |

## <a name="modeling-techniques"></a>模型化技巧
預測性維護是非常豐富的領域，通常會採用可從許多不同角度的預測性模型觀點著手的商務問題。 在後續各節中，我們會提供一些主要技巧，以便將可利用預測性維護解決方案回答的不同商務問題模型化。 雖有相似之處，但每個模型都有自己用來建構標籤 (後面詳加說明) 的方法。 此外，您可以參考 Azure Machine Learning 提供的範例實驗中包含的測性維護範本。 我們將在 [資源] 區段中提供此範本的線上內容連結。 您可以看到如何應用上面討論的一些特徵設計技巧以及將在後續各節中說明的模型化技巧，透過 Azure Machine Learning 來預測飛機引擎故障。

### <a name="binary-classification-for-predictive-maintenance"></a>預測性維護的二元分類
預測性維護的二元分類可用來預測在未來某個期間內設備會故障的機率。 此期間是根據商務規則和既有資料來決定。 某些共同期間是購買備用零件來更換可能受損零組件所需的最小前置時間，或是部署維護資源來執行維護例行工作所需的時間，以便修正可能在該期間內發生的問題。 我們將這個未來水平期間稱為 "X"。

為了使用二元分類，我們必須識別兩種範例類型 (我們稱之為肯定和否定)。 每個範例都是一筆記錄，其屬於資產的某個時間單位，可透過特徵設計 (使用歷程記錄和先前所述的其他資料來源) 在概念上描述和摘要說明截至該時間單位為止的運作狀況。 在預測性維護的二元分類內容中，肯定類型表示故障 (標籤 1)，而否定類型表示正常作業 (標籤 = 0)，其中的標籤屬於「類別」類型。 其目標在於尋找一個模型，以便將每個新範例識別為在接下來 X 個時間單位內可能會故障或運作正常。

#### <a name="label-construction"></a>標籤建構
若要建立一個預測性模型來回答「資產在接下來 X 個時間單位內會故障的機率為何？」這個問題，請取用資產故障前的 X 筆記錄並將其標記為「即將故障」(標籤 = 1)，而將其他所有記錄標記為「正常」(標籤 = 0)，即可完成標記。 在此方法中，標籤為類別變數 (請參閱圖 3)。

![圖 3. 二元分類的標記方式](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-binary-classification.png)

圖 3. 二元分類的標記方式

對於航班延誤和取消，會挑選一天做為 X 來預測接下來 24 小時內的延誤。 故障前 24 小時內的所有航班已都標記為 1。 對於 ATM 現金提領失敗，會建立二元分類模型來預測交易在接下來 10 分鐘內失敗的機率，也可預測後續 100 張鈔票提領失敗的機率。 若為第一個模型，在失敗的最後 10 分鐘內發生的所有交易都會被標記為 1。 若為第二個模型，在失敗的最後 100 張鈔票內提領的所有鈔票都會被標記為 1。 斷路器故障時的工作是要預測下一個斷路器命令會失敗的機率，在此情況下會選擇一個未來命令做為 X。 對於列車門故障，已建立二元分類模型來預測在接下來 7 天內的故障。 對於風力渦輪機故障，已選擇 3 個月做為 X。

風力渦輪機和列車門案例也會用於迴歸分析，以使用相同的資料來預測剩餘使用年限 (但是利用下一節中說明的不同標記策略)。

### <a name="regression-for-predictive-maintenance"></a>預測性維護的迴歸
預測性維護中的迴歸模型用來計算資產的剩餘使用年限 (RUL)，其已定義為資產在發生下一次故障前可運作的時間量。 與二元分類相同，每個範例都是一筆記錄，其屬於資產的時間單位 "Y"。 不過，在迴歸的內容中，目標在於尋找一個模型，以將每個新範例的剩餘使用年限計算為一個連續的數字，而這就是故障前剩餘的一段時間。 我們認為這段期間是 Y 的某個倍數。測量每個範例在下一次故障前的剩餘時間量，也可以計算該範例的剩餘使用年限。

#### <a name="label-construction"></a>標籤建構
假設有一個問題：「設備的剩餘使用年限為何？
」，取用故障前的每筆記錄並藉由計算下一次故障前剩餘多少個時間單位來加以標記，即可建構迴歸模型的標籤。 在此方法中，標籤為連續變數 (請參閱圖 4)。

![圖 4. 迴歸的標記方式](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-regression.png)

圖 4. 迴歸的標記方式

不同於二元分類，進行迴歸時，資料中沒有任何故障記錄的資產無法用於模型化，因為標記是以參照失敗點來完成，而且若不知道資產在故障前存留多久時間，便無法進行其計算。 這個問題可由另一個稱為「存活分析」的統計技巧來得到最妥善的解決。
我們不會在本腳本中討論存活分析，因為將此技巧套用至資料會隨時間變化且間隔頻繁的預測性維護使用案例時，有可能會更加複雜。

### <a name="multi-class-classification-for-predictive-maintenance"></a>預測性維護的多類別分類
預測性維護的多類別分類可用來預測兩種未來結果。 第一種是要將資產指派給多個可能期間中的其中一個，讓每個資產有故障的時間範圍。 第二種是要識別在未來期間內因為多個根本原因中的其中一個而發生故障的可能性。 這可讓具備此知識的維護人員可以預先處理問題。 另一個多類別模型化技巧則著重於判斷特定失敗的最可能根本原因。 這可針對為了修復故障所要採取的最上層維護動作，提供一些建議。
由於具備根原因的排名清單及其相關聯的修復動作，  
技術人員可以更有效率地在失敗之後採取其第一個修復動作。

#### <a name="label-construction"></a>標籤建構
假設有以下兩個問題：「資產在接下來 "aZ" 個時間單位內故障的機率為何 (其中 "a" 是期間數)」和「資產在接下來 X 個時間單位內會由於問題 "P<sub>i</sub>" 而故障的機率為何 (其中 "i" 是可能根本原因數目)」，請以下列方式對這些技巧進行標記。

針對第一個問題，取用資產故障前的 aZ 筆記錄並使用時間值區 (3Z、2Z、Z) 做為其標籤來加以標記，而將其他所有記錄標記為「正常」(標籤 = 0)，即可完成標記。 在此方法中，標籤為類別變數 (請參閱圖 5)。

![圖 5. 故障時間預測的多類別分類標記方式](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-multiclass-classification-for-failure-time-prediction.png)

圖 5. 故障時間預測的多類別分類標記方式

針對第一個問題，取用資產故障前的 X 筆記錄並將其標記為「即將由於問題 P<sub>i</sub> 而失敗」(標籤 = P<sub>i</sub>)，而將其他所有記錄標記為「正常」(標籤 = 0)，即可完成標記。 在此方法中，標籤為類別變數 (請參閱圖 6)。

![圖 6. 根本原因預測的多類別分類標記方式](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-multiclass-classification-for-root-cause-prediction.png)

圖 6. 根本原因預測的多類別分類標記方式

此模型將指派因為每個 P<sub>i</sub> 的故障機率，以及沒有故障的機率。 這些機率可依大小排序，以便預設未來最可能發生的問題。 飛機零組件故障使用案例已結構化為多類別分類問題。 這可預測在下個月內由於兩個不同壓力閥零組件造成故障的機率。

對於故障後的建議維護動作，標記作業不需要挑選未來水平期間。 這是因為此模型不會預測未來故障，但只是預測發生故障後最可能的根本原因。 電梯門故障屬於第三個案例，其目標是要預測故障的原因 (假設有運作狀況的歷程記錄資料)。 此模型會接著用來預測故障發生後最可能的根本原因。 此模型的主要優點之一就是將協助沒有經驗的技術人員輕鬆地診斷和修正問題，否則需要數年的經驗才能解決問題。

## <a name="training-validation-and-testing-methods-in-predictive-maintenance"></a>預測性維護中的訓練、驗證及測試方法
在預測性維護中，類似於任何其他包含時間戳記資料的解決方案空間，典型訓練和測試例行工作必須考慮隨時間變化的層面，才能更妥善概括看不見的未來資料。

### <a name="cross-validation"></a>交叉驗證
許多機器學習演算法相依於可大幅改變模型效能的超參數數目。 在訓練模型時，不會自動計算這些超參數的最佳值，但是應該由資料科學家指定。 尋找良好超參數值的方法有好幾種。 最常見的方法是 "k-fold cross-validation"，可隨機將範例分割成 "k" 疊。 對於每組超參數值，學習演算法會執行 k 次。 在每次反覆運算時，目前這疊中的範例會做為驗證集，而其餘的範例則會做為訓練集。 此演算法會透過訓練範例進行訓練，而效能計量則會透過驗證範例進行計算。 在每一組超參數值的這個迴圈結束時，我們會計算 k 個效能計量值的平均值，並選擇具有最佳平均效能的超參數值。

如先前所述，在預測性維護問題中，會將資料記錄成來自數個資料來源之事件的時間序列。 這些記錄可以根據標記記錄或範例的時間來排序。 因此，如果我們將資料集隨機分割成訓練和驗證集，則有些訓練範例的時間會晚於某些驗證範例。 這會導致根據模型訓練前到來的資料來預估超參數值的未來效能。 這些估計可能過於樂觀，尤其是在時間序列不固定並隨著時間改變其行為的時候。 因此，所選的超參數值可能不是最理想的。

尋找理想超參數值的更好方法就是以時間相依方式將範例分割成訓練和驗證集，讓所有驗證範例的時間晚於所有訓練範例。 然後，針對每一組超參數值，我們會透過訓練集來訓練演算法、透過相同的驗證集來測量模型的效能，並選擇可顯示最佳效能的超參數值。 當時間序列資料不固定並隨著時間演化時，訓練/驗證分割所選的超參數值會導致「模型」的未來效能優於交叉驗證隨機選擇的值。

使用經由訓練/驗證分割或交叉驗證找到的最佳超參數值，透過整個資料來訓練學習演算法，就會產生最終模型。

### <a name="testing-for-model-performance"></a>測試模型效能
建立模型之後，我們必須估計其在新資料上的未來效能。 最簡單的估計值可能是訓練資料的模型效能。 但此估計值過於樂觀，因為此模型是針對用來估計效能的資料所量身打造。 透過驗證集計算的超參數值效能計量，或經由交叉驗證計算的平均效能計量，可能是比較理想的估計。 但是基於如先前所述的相同原因，這些估計仍然過於樂觀。 我們需要更實際的方法來測量模型效能。

其中一種方法就是隨機將資料分割成訓練、驗證和測試集。 訓練和驗證集用來選取超參數值，並利用這些值來訓練模型。 模型的效能是透過測試集進行測量。

預測性維護的另一種相關方法就是以時間相依方式將範例分割成訓練、驗證和測試集，讓所有測試範例的時間晚於所有訓練和驗證範例。 在分割之後，會如先前所述產生模型和測量效能。

當時間序列固定且易於預測時，這兩種方法會產生類似的未來效能估計。 當時間序列不固定且/或難以預測時，第二種方法會產生比第一種方法更確實的未來效能估計。

### <a name="time-dependent-split"></a>時間相依分割
最好的作法是，我們會在這一節中深入探討如何實作時間相依分割。 我們會說明訓練與測試集之間的時間相依雙向分割，不過訓練與驗證集的時間相依分割應可套用完全相同的邏輯。

假設我們有一連串的時間戳記事件，例如來自各種感應器的測量資料。 系統會針對包含多個事件的時間範圍，定義訓練和測試範例的特徵以及其標籤。
例如，對於二元分類，如〈特徵設計〉和〈模型化技巧〉章節所述，會根據過去的事件建立特徵，並根據未來 "X" 個時間單位內的未來事件建立標籤。 因此，範例的標記時間範圍會晚於其特徵的時間範圍。 對於時間相依分割，我們會挑選一個時間點，我們將在此時間點使用截至該點為止的歷程記錄資料，透過微調的超參數來訓練模型。 為了避免超出訓練截止日的未來標籤外洩至訓練資料中，我們會選擇最新的時間範圍，以將訓練範例標記為訓練截止日前的 X 個時間單位。 在圖 7 中，每個實心圓都代表最終特徵資料集中的一列，其特徵和標籤都是根據上述的方法進行計算。 因此，此圖顯示在實作 X=2 和 W=3 的時間相依分割時，應該進入訓練和測試集的記錄：

![圖 7. 二元分類的時間相依分割](./media/cortana-analytics-playbook-predictive-maintenance/time-dependent-split-for-binary-classification.png)

圖 7. 二元分類的時間相依分割

綠色方塊表示屬於可用於訓練之時間單位的記錄。 如先前所述，最終特徵資料表中的每個訓練範例是在訓練截止日之前，藉由查看過去 3 期特徵產生和未來 2 期標記方式所產生。 當訓練集中的範例未來 2 期有任何部分超出訓練截止日時，我們就不會使用這些範例，因為我們假設我們無法看到超出訓練截止日的資料。 由於該條件約束，黑色範例代表最終標記資料集的記錄，而這些記錄不該使用於訓練資料集。 這些記錄不會使用於測試資料，因為它們是在訓練截止日之前，而且其標記時間範圍將部分取決於訓練時間範圍，但情況不該如此，因為我們想要完全區隔訓練與測試的標記時間範圍，以防止標籤資訊外洩。

這個技巧可讓接近訓練截止日的訓練與測試範例之間，用於產生特徵的資料重疊。 根據資料的可用性而定，不使用測試集中任何在訓練截止的 W 個時間單位內的範例，甚至可以完成更嚴格的區隔。

從我們的工作，我們發現外洩問題對於用來預測剩餘使用年限的迴歸模型的影響更嚴重，而且使用隨機區隔會導致極端過適。 同樣地，在迴歸問題中，分割應該如下：屬於訓練截止前故障之資產的記錄應該使用於訓練集，而屬於截止後故障之資產的記錄則應該使用於測試集。

在一般方法中，另一個分割訓練與測試資料的重要最佳作法，就是採用依資產識別碼分割，如此一來，用於訓練的資產就不會用於測試，因為測試的概念是要確定使用新資產來進行預測時，模型可提供確實的結果。

### <a name="handling-imbalanced-data"></a>處理不平衡的資料
在分類問題中，如果有更多的一個類別比其他的範例資料是要平衡。 在理想情況下，我們希望訓練資料中每個類別都有足夠的代表性資料，才能夠區分不同的類別。 如果一個類別少於 10% 的資料，我們就可以說資料不平衡，我們稱之為不具代表性的資料集少數類別。 我們在許多案例中都發現不平衡的資料集，也就是說：相較於資料集中的其他類別，有一個類別嚴重不具代表性，例如僅佔資料點的 0.001%。 在許多領域 (包括詐騙偵測、網路入侵和預測性維護) 中，類別不平衡是個問題，也就是說在構成少數類別範例之資產的生命週期中通常很少會出現失敗。

在類別不平衡的情況下，大多數標準學習演算法的效能都會受到影響，因為其目標在於將整體錯誤率降到最低。 例如，在具有 99% 否定類別範例和 1% 肯定類別範例的資料集中，我們只需將所有執行個體標記為否定，即可取得 99% 的精確度。 不過，這會讓所有的肯定範例歸類錯誤，所以即使精確度計量非常高，此演算法也不算是有用的演算法。 因此，傳統評估計量資訊 (例如錯誤率的整體精確度) 還不足以進行不平衡的學習。 在不平衡的資料集案例中，會使用其他計量 (例如精確度、召回、F1 分數和已調整成本的 ROC 曲線) 進行評估，我們將在〈評估計量〉一節中討論。

不過，有一些方法可協助矯正類別不平衡問題。 取樣技巧和成本導向學習是兩大主要方法。

#### <a name="sampling-methods"></a>取樣方法
在不平衡的學習中使用取樣方法，包括經由一些機制修改資料集，以便提供平衡的資料集。 雖然有許多不同的取樣技巧，但最直接的取樣方法是隨機超取樣和低取樣。

簡單來說，隨機超取樣就是從少數類別中選取一個隨機樣本，複製這些範例，然後將它們加入至訓練資料集。 這會增加少數類別中的範例總數，最終讓不同類別的範例數達到平衡。 超取樣的其中一個危險性，就是某些範例的多個執行個體可能會導致分類器變得太特定，以致發生過適情況。
這會導致高訓練精確度，但看不見的測試資料的效能可能很差。 相反地，隨機低取樣就是從多數類別中選取一個隨機樣本，並從訓練資料集中移除這些範例。 不過，從多數類別中移除範例可能會導致分類器錯過屬於多數類別的重要概念。 在混合式取樣中，少數類別會超取樣，而多數類別則會低取樣，同時也是另一個可行的方法。 其他還有許多更複雜的取樣技巧可使用，而適用於類別不平衡的有效取樣方法是很熱門的研究領域，經常受到各方的注意和貢獻。 使用不同的技巧來決定最有效的方法，通常會留待資料科學家進行研究，而最有效的方法會與資料屬性高度相依。 此外，請務必確定取樣方法只會套用到訓練集，但不會套用到測試集。

#### <a name="cost-sensitive-learning"></a>成本導向學習
在預測性維護中，構成少數類別的失敗比一般範例更有意思，因此重點通常在於演算法處理失敗的效能。 這通常稱為將不同類別的元素歸類錯誤的不平等損失或不對稱成本，其中將肯定錯誤地預測為否定的成本比將否定錯誤地預測為肯定的成本還要高。 想用的分類器應該能夠對少數類別提供很高的預測精確度，但不會嚴重影響到多數類別的精確度。

有數種方法能夠達成此目的。 將高成本指派給少數類別歸類錯誤，並嘗試將整體成本降到最低，即可有效處理不平等損失的問題。 有些機器學習演算法原本就會使用此概念，例如 SVM(支援向量機器)，其在訓練期間可以合併肯定和否定範例的成本。 同樣地，使用提升 (Boosting) 方法通常會在資料不平衡的情況中顯示良好的效能，例如促進式決策樹演算法。

## <a name="evaluation-metrics"></a>評估計量
如先前所述，類別不平衡會導致效能不佳，由於在少數類別案例中，演算法傾向於將多數類別範例做更妥善的歸類，因為當多數類別標記正確時，歸類錯誤總數會大幅改善。 這會導致召回率很低，而當企業的誤判成本非常高時，就會變成更大的問題。 精確度是最受歡迎的計量，可用來描述分類器的效能。 但是如上所述，精確度無效而且不會反映分類器功能的真實效能，因為它對於資料分佈非常敏感。 所以改用其他評估計量來評估不平衡的學習問題。 在這些情況下，精確度、召回和 F1 分數應該是評估預測性維護模型效能時應該先查看的計量。 在預測性維護中，召回率代表模型在測試集中正確找出多少個失敗。 較高的召回率表示模型成功攔截真正的失敗。 精確度計量與誤判率相關，較低的精確率對應於較高的誤判率。 F1 分數認為精確度和召回率的最佳值是 1，最差值是 0。

此外，在二元分類中，評估效能時，十分位數資料表和增益圖都非常有幫助。 它們只著重於肯定類別 (失敗)，而且比起只看 ROC (接收端操作特性) 曲線上的固定運算點，其提供的演算法效能圖片更為複雜。
根據模型在決定最後一個標籤之前所預測的失敗機率來排序測試範例，便可取得十分位數資料表。 經過排序的範例接著會以十分位數分組 (即 10% 範例的機率最大，然後是 20%、30% 等等)。 計算每個十分位數的真陽性率與其隨機基線 (也就是 0.1、0.2...) 之間的比率，即可估計演算法效能在每個十分位數的變更方式。 增益圖可用來繪製十分位數值，做法是繪製所有十分位數的十分位數真陽性率與隨機真陽性率配對。 通常，第一個十分位數會是結果的焦點，因為我們可在此看到最大的增益值。 此外，第一個十分位數使用於預測性維護時，也可被視為「有風險」的代表性資料。

## <a name="sample-solution-architecture"></a>範例解決方案架構
部署預測性維護解決方案時，我們對於可提供以下連續循環的端對端解決方案很感興趣：資料擷取、資料儲存 (用於訓練模型)、特徵產生、結果的預測何視覺化，以及警示產生機制 (例如資產監視儀表板)。 我們想要一個資料管線，可以連續自動化方式對使用者提供未來深入解析資訊。 下面圖 8 說明這類 IoT 資料管線的範例預測性維護架構。 在此架構中，即時遙測資料會收集到可儲存串流資料的事件中樞。 此資料會經由串流分析擷取，以便進行即時資料處理，例如產生特徵。 然後特徵可用來呼叫預測性模型 Web 服務，而結果會顯示在儀表板上。 在此同時，擷取的資料也會儲存在歷程記錄資料庫中，並與外部資料來源 (例如內部部署資料庫) 合併，以建立模型化的訓練範例。
相同的資料倉儲可用於範例的批次計分及儲存結果，而後再次用於在儀表板上提供預測性報告。

![圖 8. 預測性維護的範例解決方案架構](./media/cortana-analytics-playbook-predictive-maintenance/example-solution-architecture-for-predictive-maintenance.png)

圖 8. 預測性維護的範例解決方案架構

如需此架構的每個元件的詳細資訊，請參閱 [Azure](https://azure.microsoft.com/) 文件。

