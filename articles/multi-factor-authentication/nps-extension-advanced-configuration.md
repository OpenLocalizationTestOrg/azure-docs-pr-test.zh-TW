---
title: "aaaConfigure hello Azure MFA NPS 擴充功能 |Microsoft 文件"
description: "安裝 hello NPS 擴充功能之後，請使用下列步驟進行進階設定，例如 IP 允許清單和 UPN 取代。"
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/14/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: c3aed077b23c95f874861eb00c8e6dca668329c1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="advanced-configuration-options-for-hello-nps-extension-for-multi-factor-authentication"></a><span data-ttu-id="41a8d-103">進階組態選項的 hello NPS 擴充功能的多重要素驗證</span><span class="sxs-lookup"><span data-stu-id="41a8d-103">Advanced configuration options for hello NPS extension for Multi-Factor Authentication</span></span>

<span data-ttu-id="41a8d-104">hello 網路原則伺服器 (NPS) 延伸模組會延伸到您在內部部署基礎結構的雲端型 Azure Multi-factor Authentication 功能。</span><span class="sxs-lookup"><span data-stu-id="41a8d-104">hello Network Policy Server (NPS) extension extends your cloud-based Azure Multi-Factor Authentication features into your on-premises infrastructure.</span></span> <span data-ttu-id="41a8d-105">本文假設您已擁有 hello 擴充功能安裝，而想的 tooknow toocustomize hello 延伸模組，您需要的方式。</span><span class="sxs-lookup"><span data-stu-id="41a8d-105">This article assumes that you already have hello extension installed, and now want tooknow how toocustomize hello extension for you needs.</span></span> 

## <a name="alternate-login-id"></a><span data-ttu-id="41a8d-106">替代登入識別碼</span><span class="sxs-lookup"><span data-stu-id="41a8d-106">Alternate login ID</span></span>

<span data-ttu-id="41a8d-107">因為 hello NPS 擴充連接 tooboth，您的內部部署和雲端目錄，您可能會遇到的問題，您在內部部署使用者主體名稱 (Upn) 不符 hello hello 雲端中的名稱。</span><span class="sxs-lookup"><span data-stu-id="41a8d-107">Since hello NPS extension connects tooboth your on-premises and cloud directories, you might encounter an issue where your on-premises user principal names (UPNs) don't match hello names in hello cloud.</span></span> <span data-ttu-id="41a8d-108">toosolve 這個問題，請使用替代登入識別碼。</span><span class="sxs-lookup"><span data-stu-id="41a8d-108">toosolve this problem, use alternate login IDs.</span></span> 

<span data-ttu-id="41a8d-109">內 hello NPS 擴充功能，您可以指定用來取代 hello UPN Azure Multi-factor Authentication Server 的 Active Directory 屬性 toobe。</span><span class="sxs-lookup"><span data-stu-id="41a8d-109">Within hello NPS extension, you can designate an Active Directory attribute toobe used in place of hello UPN for Azure Multi-Factor Authentication.</span></span> <span data-ttu-id="41a8d-110">這可讓您 tooprotect 雙步驟驗證您的內部資源而不需修改內部部署 Upn。</span><span class="sxs-lookup"><span data-stu-id="41a8d-110">This enables you tooprotect your on-premises resources with two-step verification without modifying your on-premises UPNs.</span></span> 

<span data-ttu-id="41a8d-111">tooconfigure 替代登入識別碼，跳過`HKLM\SOFTWARE\Microsoft\AzureMfa`和編輯下列登錄值的 hello:</span><span class="sxs-lookup"><span data-stu-id="41a8d-111">tooconfigure alternate login IDs, go too`HKLM\SOFTWARE\Microsoft\AzureMfa` and edit hello following registry values:</span></span>

| <span data-ttu-id="41a8d-112">名稱</span><span class="sxs-lookup"><span data-stu-id="41a8d-112">Name</span></span> | <span data-ttu-id="41a8d-113">類型</span><span class="sxs-lookup"><span data-stu-id="41a8d-113">Type</span></span> | <span data-ttu-id="41a8d-114">預設值</span><span class="sxs-lookup"><span data-stu-id="41a8d-114">Default value</span></span> | <span data-ttu-id="41a8d-115">說明</span><span class="sxs-lookup"><span data-stu-id="41a8d-115">Description</span></span> |
| ---- | ---- | ------------- | ----------- |
| <span data-ttu-id="41a8d-116">LDAP_ALTERNATE_LOGINID_ATTRIBUTE</span><span class="sxs-lookup"><span data-stu-id="41a8d-116">LDAP_ALTERNATE_LOGINID_ATTRIBUTE</span></span> | <span data-ttu-id="41a8d-117">字串</span><span class="sxs-lookup"><span data-stu-id="41a8d-117">string</span></span> | <span data-ttu-id="41a8d-118">空白</span><span class="sxs-lookup"><span data-stu-id="41a8d-118">Empty</span></span> | <span data-ttu-id="41a8d-119">將指定 hello 屬性名稱的 Active Directory 的 toouse 而不是 hello UPN。</span><span class="sxs-lookup"><span data-stu-id="41a8d-119">Designate hello name of Active Directory attribute that you want toouse instead of hello UPN.</span></span> <span data-ttu-id="41a8d-120">這個屬性用做 hello AlternateLoginId 屬性。</span><span class="sxs-lookup"><span data-stu-id="41a8d-120">This attribute is used as hello AlternateLoginId attribute.</span></span> <span data-ttu-id="41a8d-121">如果此登錄值設定 tooa[有效的 Active Directory 屬性](https://msdn.microsoft.com/library/ms675090.aspx)（適用於例如郵件或 displayName），然後 hello 屬性的值用來取代 hello 使用者的 UPN 來進行驗證。</span><span class="sxs-lookup"><span data-stu-id="41a8d-121">If this registry value is set tooa [valid Active Directory attribute](https://msdn.microsoft.com/library/ms675090.aspx) (for example, mail or displayName), then hello attribute's value is used in place of hello user's UPN for authentication.</span></span> <span data-ttu-id="41a8d-122">如果此登錄值是空的或不設定，則會停用 AlternateLoginId 而且 hello 使用者的 UPN 會用於驗證。</span><span class="sxs-lookup"><span data-stu-id="41a8d-122">If this registry value is empty or not configured, then AlternateLoginId is disabled and hello user's UPN is used for authentication.</span></span> |
| <span data-ttu-id="41a8d-123">LDAP_FORCE_GLOBAL_CATALOG</span><span class="sxs-lookup"><span data-stu-id="41a8d-123">LDAP_FORCE_GLOBAL_CATALOG</span></span> | <span data-ttu-id="41a8d-124">布林值</span><span class="sxs-lookup"><span data-stu-id="41a8d-124">boolean</span></span> | <span data-ttu-id="41a8d-125">False</span><span class="sxs-lookup"><span data-stu-id="41a8d-125">False</span></span> | <span data-ttu-id="41a8d-126">使用這個旗標 tooforce hello 通用類別目錄的 LDAP 搜尋時查閱 AlternateLoginId。</span><span class="sxs-lookup"><span data-stu-id="41a8d-126">Use this flag tooforce hello use of Global Catalog for LDAP searches when looking up AlternateLoginId.</span></span> <span data-ttu-id="41a8d-127">將網域控制站設定為通用類別目錄中，加入 hello AlternateLoginId 屬性 toohello 通用類別目錄，然後再啟用 此旗標。</span><span class="sxs-lookup"><span data-stu-id="41a8d-127">Configure a domain controller as a Global Catalog, add hello AlternateLoginId attribute toohello Global Catalog, and then enable this flag.</span></span> <br><br> <span data-ttu-id="41a8d-128">如果 LDAP_LOOKUP_FORESTS 設定 （不是空白），**這個旗標會強制執行為 true**，不論 hello hello 登錄設定值。</span><span class="sxs-lookup"><span data-stu-id="41a8d-128">If LDAP_LOOKUP_FORESTS is configured (not empty), **this flag is enforced as true**, regardless of hello value of hello registry setting.</span></span> <span data-ttu-id="41a8d-129">在此情況下，hello NPS 擴充功能需要 hello 通用類別目錄 toobe 設有 hello AlternateLoginId 屬性，每個樹系。</span><span class="sxs-lookup"><span data-stu-id="41a8d-129">In this case, hello NPS extension requires hello Global Catalog toobe configured with hello AlternateLoginId attribute for each forest.</span></span> |
| <span data-ttu-id="41a8d-130">LDAP_LOOKUP_FORESTS</span><span class="sxs-lookup"><span data-stu-id="41a8d-130">LDAP_LOOKUP_FORESTS</span></span> | <span data-ttu-id="41a8d-131">字串</span><span class="sxs-lookup"><span data-stu-id="41a8d-131">string</span></span> | <span data-ttu-id="41a8d-132">空白</span><span class="sxs-lookup"><span data-stu-id="41a8d-132">Empty</span></span> | <span data-ttu-id="41a8d-133">提供樹系 toosearch 以分號分隔的清單。</span><span class="sxs-lookup"><span data-stu-id="41a8d-133">Provide a semi-colon separated list of forests toosearch.</span></span> <span data-ttu-id="41a8d-134">例如，*contoso.com;foobar.com*。如果設定此登錄值，hello NPS 擴充反覆 hello 順序中所列的人員，並傳回 hello 第一個成功 AlternateLoginId 值搜尋所有 hello 樹系。</span><span class="sxs-lookup"><span data-stu-id="41a8d-134">For example, *contoso.com;foobar.com*. If this registry value is configured, hello NPS extension iteratively searches all hello forests in hello order in which they were listed, and returns hello first successful AlternateLoginId value.</span></span> <span data-ttu-id="41a8d-135">如果未設定此登錄值，hello AlternateLoginId 查閱是局部的 toohello 目前網域。</span><span class="sxs-lookup"><span data-stu-id="41a8d-135">If this registry value is not configured, hello AlternateLoginId lookup is confined toohello current domain.</span></span>|

<span data-ttu-id="41a8d-136">tootroubleshoot 問題與替代登入識別碼，使用建議的步驟 hello[替代登入識別碼的錯誤](multi-factor-authentication-nps-errors.md#alternate-login-id-errors)。</span><span class="sxs-lookup"><span data-stu-id="41a8d-136">tootroubleshoot problems with alternate login IDs, use hello recommended steps for [Alternate login ID errors](multi-factor-authentication-nps-errors.md#alternate-login-id-errors).</span></span>

## <a name="ip-exceptions"></a><span data-ttu-id="41a8d-137">IP 例外狀況</span><span class="sxs-lookup"><span data-stu-id="41a8d-137">IP exceptions</span></span>

<span data-ttu-id="41a8d-138">如果您需要 toomonitor 伺服器可用性，例如負載平衡器如果確認哪一部伺服器在執行之前傳送工作負載，您不想封鎖的驗證要求這些檢查 toobe。</span><span class="sxs-lookup"><span data-stu-id="41a8d-138">If you need toomonitor server availability, like if load balancers verify which servers are running before sending workloads, you don't want these checks toobe blocked by verification requests.</span></span> <span data-ttu-id="41a8d-139">相反地，建立一份您知道服務帳戶所使用的 IP 位址清單，並停用該清單的 Multi-Factor Authentication 需求。</span><span class="sxs-lookup"><span data-stu-id="41a8d-139">Instead, create a list of IP addresses that you know are used by service accounts, and disable Multi-Factor Authentication requirements for that list.</span></span> 

<span data-ttu-id="41a8d-140">tooconfigure IP 白名單，跳過`HKLM\SOFTWARE\Microsoft\AzureMfa`並設定下列登錄值的 hello:</span><span class="sxs-lookup"><span data-stu-id="41a8d-140">tooconfigure an IP whitelist, go too`HKLM\SOFTWARE\Microsoft\AzureMfa` and configure hello following registry value:</span></span> 

| <span data-ttu-id="41a8d-141">名稱</span><span class="sxs-lookup"><span data-stu-id="41a8d-141">Name</span></span> | <span data-ttu-id="41a8d-142">類型</span><span class="sxs-lookup"><span data-stu-id="41a8d-142">Type</span></span> | <span data-ttu-id="41a8d-143">預設值</span><span class="sxs-lookup"><span data-stu-id="41a8d-143">Default value</span></span> | <span data-ttu-id="41a8d-144">說明</span><span class="sxs-lookup"><span data-stu-id="41a8d-144">Description</span></span> |
| ---- | ---- | ------------- | ----------- |
| <span data-ttu-id="41a8d-145">IP_WHITELIST</span><span class="sxs-lookup"><span data-stu-id="41a8d-145">IP_WHITELIST</span></span> | <span data-ttu-id="41a8d-146">字串</span><span class="sxs-lookup"><span data-stu-id="41a8d-146">string</span></span> | <span data-ttu-id="41a8d-147">空白</span><span class="sxs-lookup"><span data-stu-id="41a8d-147">Empty</span></span> | <span data-ttu-id="41a8d-148">提供 IP 位址清單 (以分號分隔)。</span><span class="sxs-lookup"><span data-stu-id="41a8d-148">Provide a semi-colon separated list of IP addresses.</span></span> <span data-ttu-id="41a8d-149">包括 hello IP 位址的服務要求產生的位置，像是 hello NAS/VPN 伺服器的電腦。</span><span class="sxs-lookup"><span data-stu-id="41a8d-149">Include hello IP addresses of machines where service requests originate, like hello NAS/VPN server.</span></span> <span data-ttu-id="41a8d-150">不支援 IP 範圍和子網路。</span><span class="sxs-lookup"><span data-stu-id="41a8d-150">IP ranges are subnets are not supported.</span></span> <br><br> <span data-ttu-id="41a8d-151">例如，*10.0.0.1;10.0.0.2;10.0.0.3*。</span><span class="sxs-lookup"><span data-stu-id="41a8d-151">For example, *10.0.0.1;10.0.0.2;10.0.0.3*.</span></span>

<span data-ttu-id="41a8d-152">當要求進入從存在於 hello 白名單 IP 位址時，則會略過雙步驟驗證。</span><span class="sxs-lookup"><span data-stu-id="41a8d-152">When a request comes in from an IP address that exists in hello whitelist, two-step verification is skipped.</span></span> <span data-ttu-id="41a8d-153">hello IP 白名單是比較的 toohello IP 位址中的 hello 提供*ratNASIPAddress* hello RADIUS 要求的屬性。</span><span class="sxs-lookup"><span data-stu-id="41a8d-153">hello IP whitelist is compared toohello IP address that is provided in hello *ratNASIPAddress* attribute of hello RADIUS request.</span></span> <span data-ttu-id="41a8d-154">如果 RADIUS 要求進入沒有 hello ratNASIPAddress 屬性，則會記錄下列警告 hello:"P_WHITE_LIST_WARNING::IP 白名單忽略因為 NasIpAddress 屬性中的 RADIUS 要求中遺漏來源 IP。 」</span><span class="sxs-lookup"><span data-stu-id="41a8d-154">If a RADIUS request comes in without hello ratNASIPAddress attribute, hello following warning is logged: "P_WHITE_LIST_WARNING::IP Whitelist is being ignored as source IP is missing in RADIUS request in NasIpAddress attribute."</span></span>

## <a name="next-steps"></a><span data-ttu-id="41a8d-155">後續步驟</span><span class="sxs-lookup"><span data-stu-id="41a8d-155">Next steps</span></span>

[<span data-ttu-id="41a8d-156">針對 Azure Multi-factor Authentication 解決 hello NPS 擴充功能中的錯誤訊息</span><span class="sxs-lookup"><span data-stu-id="41a8d-156">Resolve error messages from hello NPS extension for Azure Multi-Factor Authentication</span></span>](multi-factor-authentication-nps-errors.md)
