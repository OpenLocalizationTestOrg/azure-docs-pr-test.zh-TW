---
title: "將 PhoneFactor 升級至 Azure MFA Server | Microsoft Docs"
description: "當您從舊版的 PhoneFactor Agent 升級時，開始使用 Azure MFA Server。"
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 42838ff7-bdf2-4d06-bacc-b3839a00cd76
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/06/2017
ms.author: kgremban
ms.openlocfilehash: 7ab7e693909f807781744ae53eed75d425096590
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="upgrade-the-phonefactor-agent-to-azure-multi-factor-authentication-server"></a><span data-ttu-id="21fe9-103">將 PhoneFactor Agent 升級為 Azure Multi-Factor Authentication Server</span><span class="sxs-lookup"><span data-stu-id="21fe9-103">Upgrade the PhoneFactor Agent to Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="21fe9-104">若要將 PhoneFactor Agent v5.x 或更舊版本升級至 Azure Multi-factor Authentication Server，請先解除安裝 PhoneFactor Agent 和附屬元件。</span><span class="sxs-lookup"><span data-stu-id="21fe9-104">To upgrade the PhoneFactor Agent v5.x or older to Azure Multi-Factor Authentication Server, uninstall the PhoneFactor Agent and affiliated components first.</span></span> <span data-ttu-id="21fe9-105">然後即可安裝 Multi-Factor Authentication Server 與其附屬元件。</span><span class="sxs-lookup"><span data-stu-id="21fe9-105">Then the Multi-Factor Authentication Server and its affiliated components can be installed.</span></span>

## <a name="uninstall-the-phonefactor-agent"></a><span data-ttu-id="21fe9-106">解除安裝 PhoneFactor Agent</span><span class="sxs-lookup"><span data-stu-id="21fe9-106">Uninstall the PhoneFactor Agent</span></span>

1. <span data-ttu-id="21fe9-107">首先，備份 PhoneFactor 資料檔案。</span><span class="sxs-lookup"><span data-stu-id="21fe9-107">First, back up the PhoneFactor data file.</span></span> <span data-ttu-id="21fe9-108">預設安裝位置是 C:\Program Files\PhoneFactor\Data\Phonefactor.pfdata。</span><span class="sxs-lookup"><span data-stu-id="21fe9-108">The default installation location is C:\Program Files\PhoneFactor\Data\Phonefactor.pfdata.</span></span>

2. <span data-ttu-id="21fe9-109">如果已安裝使用者入口網站：</span><span class="sxs-lookup"><span data-stu-id="21fe9-109">If the User Portal is installed:</span></span>
  1. <span data-ttu-id="21fe9-110">瀏覽至安裝資料夾，然後備份 web.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="21fe9-110">Navigate to the install folder and back up the web.config file.</span></span> <span data-ttu-id="21fe9-111">預設安裝位置是 C:\inetpub\wwwroot\PhoneFactor。</span><span class="sxs-lookup"><span data-stu-id="21fe9-111">The default installation location is C:\inetpub\wwwroot\PhoneFactor.</span></span>

  2. <span data-ttu-id="21fe9-112">如果您已在入口網站中加入自訂佈景主題，請備份 C:\inetpub\wwwroot\PhoneFactor\App_Themes 目錄下的自訂資料夾。</span><span class="sxs-lookup"><span data-stu-id="21fe9-112">If you have added custom themes to the portal, back up your custom folder below the C:\inetpub\wwwroot\PhoneFactor\App_Themes directory.</span></span>

  3. <span data-ttu-id="21fe9-113">透過 PhoneFactor Agent 解除安裝使用者入口網站 (唯有安裝在與 PhoneFactor Agent 相同的伺服器時才適用) 或透過 Windows [程式和功能]。</span><span class="sxs-lookup"><span data-stu-id="21fe9-113">Uninstall the User Portal either through the PhoneFactor Agent (only available if installed on the same server as the PhoneFactor Agent) or through Windows Programs and Features.</span></span>

3. <span data-ttu-id="21fe9-114">如果已安裝 Mobile App Web 服務：</span><span class="sxs-lookup"><span data-stu-id="21fe9-114">If the Mobile App Web Service is installed:</span></span>

  1. <span data-ttu-id="21fe9-115">移至安裝資料夾，然後備份 web.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="21fe9-115">Go to the install folder and back up the web.config file.</span></span> <span data-ttu-id="21fe9-116">預設安裝位置是 C:\inetpub\wwwroot\PhoneFactorPhoneAppWebService。</span><span class="sxs-lookup"><span data-stu-id="21fe9-116">The default installation location is C:\inetpub\wwwroot\PhoneFactorPhoneAppWebService.</span></span>

  2. <span data-ttu-id="21fe9-117">透過 Windows [程式和功能] 解除安裝 Mobile App Web 服務。</span><span class="sxs-lookup"><span data-stu-id="21fe9-117">Uninstall the Mobile App Web Service through Windows Programs and Features.</span></span>

4. <span data-ttu-id="21fe9-118">如果您已安裝 Web 服務 SDK，請透過 PhoneFactor Agent 或透過 Windows [程式和功能] 解除安裝。</span><span class="sxs-lookup"><span data-stu-id="21fe9-118">If the Web Service SDK is installed, uninstall it either through the PhoneFactor Agent or through Windows Programs and Features.</span></span>

5. <span data-ttu-id="21fe9-119">透過 Windows [程式和功能] 解除安裝 PhoneFactor Agent。</span><span class="sxs-lookup"><span data-stu-id="21fe9-119">Uninstall the PhoneFactor Agent through Windows Programs and Features.</span></span>

## <a name="install-the-multi-factor-authentication-server"></a><span data-ttu-id="21fe9-120">安裝 Multi-Factor Authentication Server</span><span class="sxs-lookup"><span data-stu-id="21fe9-120">Install the Multi-Factor Authentication Server</span></span>

<span data-ttu-id="21fe9-121">系統會從先前 PhoneFactor Agent 安裝的登錄接續安裝路徑，因此它應該會安裝在相同位置 (例如，C:\Program Files\PhoneFactor)。</span><span class="sxs-lookup"><span data-stu-id="21fe9-121">The installation path is picked up from the registry from the previous PhoneFactor Agent installation, so it should install in the same location (for example, C:\Program Files\PhoneFactor).</span></span> <span data-ttu-id="21fe9-122">新安裝將會有不同的預設安裝路徑 (例如，C:\Program Files\Multi-Factor Authentication Server)。</span><span class="sxs-lookup"><span data-stu-id="21fe9-122">New installations have a different default install path (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> <span data-ttu-id="21fe9-123">先前 PhoneFactor Agent 所留下的資料檔案應該會在安裝期間升級，因此在安裝新的 Multi-Factor Authentication Server 之後，使用者和設定應該會留在原地。</span><span class="sxs-lookup"><span data-stu-id="21fe9-123">The data file left by the previous PhoneFactor Agent should be upgraded during installation, so your users and settings should still be there after installing the new Multi-Factor Authentication Server.</span></span>

1. <span data-ttu-id="21fe9-124">如果出現提示，請啟用 Multi-Factor Authentication Server，並確認已將它指派給正確的複寫群組。</span><span class="sxs-lookup"><span data-stu-id="21fe9-124">If prompted, activate the Multi-Factor Authentication Server and ensure it is assigned to the correct replication group.</span></span>

2. <span data-ttu-id="21fe9-125">如果您之前已安裝 Web 服務 SDK，請透過 Multi-Factor Authentication Server 使用者介面安裝新的 Web 服務 SDK。</span><span class="sxs-lookup"><span data-stu-id="21fe9-125">If the Web Service SDK was previously installed, install the new Web Service SDK through the Multi-Factor Authentication Server User Interface.</span></span>

  <span data-ttu-id="21fe9-126">預設虛擬目錄名稱現在是 **MultiFactorAuthWebServiceSdk**，而非 **PhoneFactorWebServiceSdk**。</span><span class="sxs-lookup"><span data-stu-id="21fe9-126">The default virtual directory name is now **MultiFactorAuthWebServiceSdk** instead of **PhoneFactorWebServiceSdk**.</span></span> <span data-ttu-id="21fe9-127">如果您想要使用先前的名稱，必須在安裝期間變更虛擬目錄的名稱。</span><span class="sxs-lookup"><span data-stu-id="21fe9-127">If you want to use the previous name, you must change the name of the virtual directory during installation.</span></span> <span data-ttu-id="21fe9-128">否則，如果您允許安裝使用新預設名稱，必須變更所有參考 Web 服務 SDK 之應用程式中的 URL (例如使用者入口網站和 Mobile App Web 服務)，使其指向正確位置。</span><span class="sxs-lookup"><span data-stu-id="21fe9-128">Otherwise, if you allow the install to use the new default name, you have to change the URL in any applications that reference the Web Service SDK (like the User Portal and Mobile App Web Service) to point at the correct location.</span></span>

3. <span data-ttu-id="21fe9-129">如果您之前將使用者入口網站安裝在 PhoneFactor Agent Server 上，請透過 Multi-Factor Authentication Server 使用者介面安裝新的 Multi-Factor Authentication 使用者入口網站。</span><span class="sxs-lookup"><span data-stu-id="21fe9-129">If the User Portal was previously installed on the PhoneFactor Agent Server, install the new Multi-Factor Authentication User Portal through the Multi-Factor Authentication Server User Interface.</span></span>

  <span data-ttu-id="21fe9-130">預設虛擬目錄名稱現在是 **MultiFactorAuth**，而非 **PhoneFactor**。</span><span class="sxs-lookup"><span data-stu-id="21fe9-130">The default virtual directory name is now **MultiFactorAuth** instead of **PhoneFactor**.</span></span> <span data-ttu-id="21fe9-131">如果您想要使用先前的名稱，必須在安裝期間變更虛擬目錄的名稱。</span><span class="sxs-lookup"><span data-stu-id="21fe9-131">If you want to use the previous name, you must change the name of the virtual directory during installation.</span></span> <span data-ttu-id="21fe9-132">否則，如果您允許安裝使用新預設名稱，應該要在 Multi-Factor Authentication Server 中按一下 [使用者入口網站] 圖示，然後更新 [設定] 索引標籤中的使用者入口網站 URL。</span><span class="sxs-lookup"><span data-stu-id="21fe9-132">Otherwise, if you allow the install to use the new default name, you should click the User Portal icon in the Multi-Factor Authentication Server and update the User Portal URL on the Settings tab.</span></span>

4. <span data-ttu-id="21fe9-133">如果您之前將使用者入口網站和/或 Mobile App Web 服務安裝在 PhoneFactor Agent 之外的伺服器上：</span><span class="sxs-lookup"><span data-stu-id="21fe9-133">If the User Portal and/or Mobile App Web Service was previously installed on a different server from the PhoneFactor Agent:</span></span>

  1. <span data-ttu-id="21fe9-134">移至安裝位置 (例如，C:\Program Files\PhoneFactor)，然後將一個或多個安裝程式複製到其他伺服器。</span><span class="sxs-lookup"><span data-stu-id="21fe9-134">Go to the install location (for example, C:\Program Files\PhoneFactor) and copy one or more installers to the other server.</span></span> <span data-ttu-id="21fe9-135">使用者入口網站和 Mobile App Web 服務備有 32 位元和 64 位元安裝程式。</span><span class="sxs-lookup"><span data-stu-id="21fe9-135">There are 32-bit and 64-bit installers for both the User Portal and Mobile App Web Service.</span></span> <span data-ttu-id="21fe9-136">它們稱為 MultiFactorAuthenticationUserPortalSetupXX.msi 和 MultiFactorAuthenticationMobileAppWebServiceSetupXX.msi。</span><span class="sxs-lookup"><span data-stu-id="21fe9-136">They are called MultiFactorAuthenticationUserPortalSetupXX.msi and MultiFactorAuthenticationMobileAppWebServiceSetupXX.msi.</span></span>

  2. <span data-ttu-id="21fe9-137">若要將使用者入口網站安裝在 Web 伺服器上，請以系統管理員身分開啟命令提示字元，然後執行 MultiFactorAuthenticationUserPortalSetupXX.msi。</span><span class="sxs-lookup"><span data-stu-id="21fe9-137">To install the User Portal on the web server, open a command prompt as an administrator and run MultiFactorAuthenticationUserPortalSetupXX.msi.</span></span>

    <span data-ttu-id="21fe9-138">預設虛擬目錄名稱現在是 **MultiFactorAuth**，而非 **PhoneFactor**。</span><span class="sxs-lookup"><span data-stu-id="21fe9-138">The default virtual directory name is now **MultiFactorAuth** instead of **PhoneFactor**.</span></span> <span data-ttu-id="21fe9-139">如果您想要使用先前的名稱，必須在安裝期間變更虛擬目錄的名稱。</span><span class="sxs-lookup"><span data-stu-id="21fe9-139">If you want to use the previous name, you must change the name of the virtual directory during installation.</span></span> <span data-ttu-id="21fe9-140">否則，如果您允許安裝使用新預設名稱，應該要在 Multi-Factor Authentication Server 中按一下 [使用者入口網站] 圖示，然後更新 [設定] 索引標籤中的使用者入口網站 URL。</span><span class="sxs-lookup"><span data-stu-id="21fe9-140">Otherwise, if you allow the install to use the new default name, you should click the User Portal icon in the Multi-Factor Authentication Server and update the User Portal URL on the Settings tab.</span></span> <span data-ttu-id="21fe9-141">您需要通知現有使用者有關新 URL 的資訊。</span><span class="sxs-lookup"><span data-stu-id="21fe9-141">Existing users need to be informed of the new URL.</span></span>

  3. <span data-ttu-id="21fe9-142">移至使用者入口網站安裝位置 (例如，C:\inetpub\wwwroot\MultiFactorAuth)，然後編輯 web.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="21fe9-142">Go to the User Portal install location (for example, C:\inetpub\wwwroot\MultiFactorAuth) and edit the web.config file.</span></span> <span data-ttu-id="21fe9-143">在將 web.config 檔案升級為新 web.config 檔案之前備份的原始檔案中，複製 appSettings 和 applicationSettings 區段中的值。</span><span class="sxs-lookup"><span data-stu-id="21fe9-143">Copy the values in the appSettings and applicationSettings sections from your original web.config file that was backed up before the upgrade into the new web.config file.</span></span> <span data-ttu-id="21fe9-144">在安裝 Web 服務 SDK 時，如果新的預設虛擬目錄名稱已保留，請變更 applicationSettings 區段中的 URL，以指向正確位置。</span><span class="sxs-lookup"><span data-stu-id="21fe9-144">If the new default virtual directory name was kept when installing the Web Service SDK, change the URL in the applicationSettings section to point to the correct location.</span></span> <span data-ttu-id="21fe9-145">如果先前 web.config 檔案中有其他任何經過變更的預設值，請將這些相同變更套用到新的 web.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="21fe9-145">If any other defaults were changed in the previous web.config file, apply those same changes to the new web.config file.</span></span>

  4. <span data-ttu-id="21fe9-146">若要將 Mobile App Web 服務安裝在 Web 伺服器上，請以系統管理員身分開啟命令提示字元，然後執行 MultiFactorAuthenticationMobileAppWebServiceSetupXX.msi。</span><span class="sxs-lookup"><span data-stu-id="21fe9-146">To install the Mobile App Web Service on the web server, open a command prompt as an administrator and run the MultiFactorAuthenticationMobileAppWebServiceSetupXX.msi.</span></span>

    <span data-ttu-id="21fe9-147">預設虛擬目錄名稱現在是 **MultiFactorAuthMobileAppWebService**，而非 **PhoneFactorPhoneAppWebService**。</span><span class="sxs-lookup"><span data-stu-id="21fe9-147">The default virtual directory name is now **MultiFactorAuthMobileAppWebService** instead of **PhoneFactorPhoneAppWebService**.</span></span> <span data-ttu-id="21fe9-148">如果您想要使用先前的名稱，必須在安裝期間變更虛擬目錄的名稱。</span><span class="sxs-lookup"><span data-stu-id="21fe9-148">If you want to use the previous name, you must change the name of the virtual directory during installation.</span></span> <span data-ttu-id="21fe9-149">您也許會想要選擇較短的名稱，以便使用者在行動裝置上輸入。</span><span class="sxs-lookup"><span data-stu-id="21fe9-149">You may want to choose a shorter name to make it easy for end users to type in on their mobile devices.</span></span> <span data-ttu-id="21fe9-150">否則，如果您允許安裝使用新預設名稱，應該要在 Multi-Factor Authentication Server 中按一下 [行動應用程式] 圖示，然後更新 Mobile App Web 服務 URL。</span><span class="sxs-lookup"><span data-stu-id="21fe9-150">Otherwise, if you allow the install to use the new default name, you should click the Mobile App icon in the Multi-Factor Authentication Server and update the Mobile App Web Service URL.</span></span>

  5. <span data-ttu-id="21fe9-151">移至 Mobile App Web 服務安裝位置 (例如，C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService)，然後編輯 web.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="21fe9-151">Go to the Mobile App Web Service install location (for example, C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService) and edit the web.config file.</span></span> <span data-ttu-id="21fe9-152">在將 web.config 檔案升級為新 web.config 檔案之前備份的原始檔案中，複製 appSettings 和 applicationSettings 區段中的值。</span><span class="sxs-lookup"><span data-stu-id="21fe9-152">Copy the values in the appSettings and applicationSettings sections from your original web.config file that was backed up before the upgrade into the new web.config file.</span></span> <span data-ttu-id="21fe9-153">在安裝 Web 服務 SDK 時，如果新的預設虛擬目錄名稱已保留，請變更 applicationSettings 區段中的 URL，以指向正確位置。</span><span class="sxs-lookup"><span data-stu-id="21fe9-153">If the new default virtual directory name was kept when installing the Web Service SDK, change the URL in the applicationSettings section to point to the correct location.</span></span> <span data-ttu-id="21fe9-154">如果先前 web.config 檔案中有其他任何經過變更的預設值，請將這些相同變更套用到新的 web.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="21fe9-154">If any other defaults were changed in the previous web.config file, apply those same changes to the new web.config file.</span></span>

## <a name="next-steps"></a><span data-ttu-id="21fe9-155">後續步驟</span><span class="sxs-lookup"><span data-stu-id="21fe9-155">Next steps</span></span>

- <span data-ttu-id="21fe9-156">針對 Azure Multi-Factor Authentication Server [安裝使用者入口網站](multi-factor-authentication-get-started-portal.md)。</span><span class="sxs-lookup"><span data-stu-id="21fe9-156">[Install the users portal](multi-factor-authentication-get-started-portal.md) for the Azure Multi-Factor Authentication Server.</span></span>

- <span data-ttu-id="21fe9-157">為您的應用程式[設定 Windows 驗證](multi-factor-authentication-get-started-server-windows.md)。</span><span class="sxs-lookup"><span data-stu-id="21fe9-157">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications.</span></span> 
