---
title: "aaaUpgrade PhoneFactor tooAzure MFA Server |Microsoft 文件"
description: "開始使用 Azure MFA Server 從 hello 較舊的 phonefactor 代理程式升級時。"
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 42838ff7-bdf2-4d06-bacc-b3839a00cd76
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/06/2017
ms.author: kgremban
ms.openlocfilehash: 15b7b8517929c30f66e6a39cd44c69d12d25c6d7
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="upgrade-hello-phonefactor-agent-tooazure-multi-factor-authentication-server"></a><span data-ttu-id="19271-103">升級 hello PhoneFactor Agent tooAzure Multi-factor Authentication Server</span><span class="sxs-lookup"><span data-stu-id="19271-103">Upgrade hello PhoneFactor Agent tooAzure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="19271-104">tooupgrade hello PhoneFactor Agent v5.x 或較舊 tooAzure Multi-factor Authentication Server、 解除安裝 PhoneFactor Agent hello 和附屬元件第一次。</span><span class="sxs-lookup"><span data-stu-id="19271-104">tooupgrade hello PhoneFactor Agent v5.x or older tooAzure Multi-Factor Authentication Server, uninstall hello PhoneFactor Agent and affiliated components first.</span></span> <span data-ttu-id="19271-105">然後 hello Multi-factor Authentication Server，而且可以安裝及其附屬的元件。</span><span class="sxs-lookup"><span data-stu-id="19271-105">Then hello Multi-Factor Authentication Server and its affiliated components can be installed.</span></span>

## <a name="uninstall-hello-phonefactor-agent"></a><span data-ttu-id="19271-106">解除安裝 PhoneFactor Agent hello</span><span class="sxs-lookup"><span data-stu-id="19271-106">Uninstall hello PhoneFactor Agent</span></span>

1. <span data-ttu-id="19271-107">首先，請備份 hello PhoneFactor 資料檔案。</span><span class="sxs-lookup"><span data-stu-id="19271-107">First, back up hello PhoneFactor data file.</span></span> <span data-ttu-id="19271-108">hello 預設安裝位置是 C:\Program Files\PhoneFactor\Data\Phonefactor.pfdata。</span><span class="sxs-lookup"><span data-stu-id="19271-108">hello default installation location is C:\Program Files\PhoneFactor\Data\Phonefactor.pfdata.</span></span>

2. <span data-ttu-id="19271-109">如果已安裝使用者入口網站 hello:</span><span class="sxs-lookup"><span data-stu-id="19271-109">If hello User Portal is installed:</span></span>
  1. <span data-ttu-id="19271-110">瀏覽 toohello 安裝資料夾，然後備份 hello web.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="19271-110">Navigate toohello install folder and back up hello web.config file.</span></span> <span data-ttu-id="19271-111">hello 預設安裝位置是 C:\inetpub\wwwroot\PhoneFactor。</span><span class="sxs-lookup"><span data-stu-id="19271-111">hello default installation location is C:\inetpub\wwwroot\PhoneFactor.</span></span>

  2. <span data-ttu-id="19271-112">如果您已新增自訂佈景主題 toohello 入口網站，備份 hello C:\inetpub\wwwroot\PhoneFactor\App_Themes 目錄下的自訂資料夾。</span><span class="sxs-lookup"><span data-stu-id="19271-112">If you have added custom themes toohello portal, back up your custom folder below hello C:\inetpub\wwwroot\PhoneFactor\App_Themes directory.</span></span>

  3. <span data-ttu-id="19271-113">解除安裝使用者入口網站 hello 透過 hello PhoneFactor Agent (只有安裝在 hello 與相同的伺服器 hello PhoneFactor 代理程式) 或透過 Windows 程式和功能。</span><span class="sxs-lookup"><span data-stu-id="19271-113">Uninstall hello User Portal either through hello PhoneFactor Agent (only available if installed on hello same server as hello PhoneFactor Agent) or through Windows Programs and Features.</span></span>

3. <span data-ttu-id="19271-114">如果已安裝 Mobile App Web Service hello:</span><span class="sxs-lookup"><span data-stu-id="19271-114">If hello Mobile App Web Service is installed:</span></span>

  1. <span data-ttu-id="19271-115">移 toohello 安裝資料夾，然後備份 hello web.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="19271-115">Go toohello install folder and back up hello web.config file.</span></span> <span data-ttu-id="19271-116">hello 預設安裝位置是 C:\inetpub\wwwroot\PhoneFactorPhoneAppWebService。</span><span class="sxs-lookup"><span data-stu-id="19271-116">hello default installation location is C:\inetpub\wwwroot\PhoneFactorPhoneAppWebService.</span></span>

  2. <span data-ttu-id="19271-117">解除安裝 hello Mobile App Web Service 透過 Windows 程式和功能。</span><span class="sxs-lookup"><span data-stu-id="19271-117">Uninstall hello Mobile App Web Service through Windows Programs and Features.</span></span>

4. <span data-ttu-id="19271-118">如果已安裝 hello Web 服務 SDK，請在透過 hello PhoneFactor 代理程式或透過 Windows 程式和功能解除安裝。</span><span class="sxs-lookup"><span data-stu-id="19271-118">If hello Web Service SDK is installed, uninstall it either through hello PhoneFactor Agent or through Windows Programs and Features.</span></span>

5. <span data-ttu-id="19271-119">解除安裝 hello PhoneFactor 代理程式，透過 Windows 程式和功能。</span><span class="sxs-lookup"><span data-stu-id="19271-119">Uninstall hello PhoneFactor Agent through Windows Programs and Features.</span></span>

## <a name="install-hello-multi-factor-authentication-server"></a><span data-ttu-id="19271-120">安裝 hello Multi-factor Authentication Server</span><span class="sxs-lookup"><span data-stu-id="19271-120">Install hello Multi-Factor Authentication Server</span></span>

<span data-ttu-id="19271-121">hello 安裝路徑從挑選 hello 登錄 hello 先前 PhoneFactor 代理程式安裝，因此它應該安裝相同 hello 位置 (例如 C:\Program Files\PhoneFactor)。</span><span class="sxs-lookup"><span data-stu-id="19271-121">hello installation path is picked up from hello registry from hello previous PhoneFactor Agent installation, so it should install in hello same location (for example, C:\Program Files\PhoneFactor).</span></span> <span data-ttu-id="19271-122">新安裝將會有不同的預設安裝路徑 (例如，C:\Program Files\Multi-Factor Authentication Server)。</span><span class="sxs-lookup"><span data-stu-id="19271-122">New installations have a different default install path (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> <span data-ttu-id="19271-123">hello 左的 hello 先前 PhoneFactor 代理程式應該在安裝期間，會升級，因此您的使用者和設定仍應該有在安裝之後 hello 新的 Multi-factor Authentication Server 資料檔案。</span><span class="sxs-lookup"><span data-stu-id="19271-123">hello data file left by hello previous PhoneFactor Agent should be upgraded during installation, so your users and settings should still be there after installing hello new Multi-Factor Authentication Server.</span></span>

1. <span data-ttu-id="19271-124">如果出現提示，請啟用 hello Multi-factor Authentication Server，並確定它指派 toohello 正確的複寫群組。</span><span class="sxs-lookup"><span data-stu-id="19271-124">If prompted, activate hello Multi-Factor Authentication Server and ensure it is assigned toohello correct replication group.</span></span>

2. <span data-ttu-id="19271-125">如果先前已安裝 Web 服務 SDK，hello 安裝 hello 新的 Web 服務 SDK，透過 hello Multi-factor Authentication Server 使用者介面。</span><span class="sxs-lookup"><span data-stu-id="19271-125">If hello Web Service SDK was previously installed, install hello new Web Service SDK through hello Multi-Factor Authentication Server User Interface.</span></span>

  <span data-ttu-id="19271-126">hello 的預設虛擬目錄名稱現在是**MultiFactorAuthWebServiceSdk**而不是**PhoneFactorWebServiceSdk**。</span><span class="sxs-lookup"><span data-stu-id="19271-126">hello default virtual directory name is now **MultiFactorAuthWebServiceSdk** instead of **PhoneFactorWebServiceSdk**.</span></span> <span data-ttu-id="19271-127">如果您想 toouse hello 先前的名稱，您必須在安裝期間變更 hello hello 虛擬目錄名稱。</span><span class="sxs-lookup"><span data-stu-id="19271-127">If you want toouse hello previous name, you must change hello name of hello virtual directory during installation.</span></span> <span data-ttu-id="19271-128">否則，如果您允許 hello 安裝 toouse hello 新的預設名稱，您必須 toochange hello URL 任何應用程式中該參考 hello （例如 hello 使用者入口網站和行動裝置應用程式 Web 服務） 的 Web 服務 SDK toopoint hello 正確位置。</span><span class="sxs-lookup"><span data-stu-id="19271-128">Otherwise, if you allow hello install toouse hello new default name, you have toochange hello URL in any applications that reference hello Web Service SDK (like hello User Portal and Mobile App Web Service) toopoint at hello correct location.</span></span>

3. <span data-ttu-id="19271-129">如果 hello hello PhoneFactor 代理程式伺服器，在先前已安裝使用者入口網站安裝 hello 新 Multi-factor Authentication 使用者入口網站透過 hello Multi-factor Authentication Server 使用者介面。</span><span class="sxs-lookup"><span data-stu-id="19271-129">If hello User Portal was previously installed on hello PhoneFactor Agent Server, install hello new Multi-Factor Authentication User Portal through hello Multi-Factor Authentication Server User Interface.</span></span>

  <span data-ttu-id="19271-130">hello 的預設虛擬目錄名稱現在是**MultiFactorAuth**而不是**PhoneFactor**。</span><span class="sxs-lookup"><span data-stu-id="19271-130">hello default virtual directory name is now **MultiFactorAuth** instead of **PhoneFactor**.</span></span> <span data-ttu-id="19271-131">如果您想 toouse hello 先前的名稱，您必須在安裝期間變更 hello hello 虛擬目錄名稱。</span><span class="sxs-lookup"><span data-stu-id="19271-131">If you want toouse hello previous name, you must change hello name of hello virtual directory during installation.</span></span> <span data-ttu-id="19271-132">否則，如果您允許 hello 安裝 toouse hello 新的預設名稱，您應該按一下 Multi-factor Authentication Server hello hello 使用者入口網站 圖示，並更新 hello 設定 索引標籤上的 hello 使用者入口網站 URL。</span><span class="sxs-lookup"><span data-stu-id="19271-132">Otherwise, if you allow hello install toouse hello new default name, you should click hello User Portal icon in hello Multi-Factor Authentication Server and update hello User Portal URL on hello Settings tab.</span></span>

4. <span data-ttu-id="19271-133">如果 hello 使用者入口網站及/或 Mobile App Web Service 先前已安裝在不同的伺服器上 hello PhoneFactor 代理程式：</span><span class="sxs-lookup"><span data-stu-id="19271-133">If hello User Portal and/or Mobile App Web Service was previously installed on a different server from hello PhoneFactor Agent:</span></span>

  1. <span data-ttu-id="19271-134">請 toohello 安裝位置 (例如 C:\Program Files\PhoneFactor)，並複製一或多個安裝程式 toohello 另一部伺服器。</span><span class="sxs-lookup"><span data-stu-id="19271-134">Go toohello install location (for example, C:\Program Files\PhoneFactor) and copy one or more installers toohello other server.</span></span> <span data-ttu-id="19271-135">有 32 位元和 64 位元的 hello 使用者入口網站和行動裝置應用程式 Web 服務的安裝程式。</span><span class="sxs-lookup"><span data-stu-id="19271-135">There are 32-bit and 64-bit installers for both hello User Portal and Mobile App Web Service.</span></span> <span data-ttu-id="19271-136">它們稱為 MultiFactorAuthenticationUserPortalSetupXX.msi 和 MultiFactorAuthenticationMobileAppWebServiceSetupXX.msi。</span><span class="sxs-lookup"><span data-stu-id="19271-136">They are called MultiFactorAuthenticationUserPortalSetupXX.msi and MultiFactorAuthenticationMobileAppWebServiceSetupXX.msi.</span></span>

  2. <span data-ttu-id="19271-137">tooinstall hello 使用者入口網站 hello 網頁伺服器上，開啟命令提示字元，以系統管理員，然後執行 MultiFactorAuthenticationUserPortalSetupXX.msi。</span><span class="sxs-lookup"><span data-stu-id="19271-137">tooinstall hello User Portal on hello web server, open a command prompt as an administrator and run MultiFactorAuthenticationUserPortalSetupXX.msi.</span></span>

    <span data-ttu-id="19271-138">hello 的預設虛擬目錄名稱現在是**MultiFactorAuth**而不是**PhoneFactor**。</span><span class="sxs-lookup"><span data-stu-id="19271-138">hello default virtual directory name is now **MultiFactorAuth** instead of **PhoneFactor**.</span></span> <span data-ttu-id="19271-139">如果您想 toouse hello 先前的名稱，您必須在安裝期間變更 hello hello 虛擬目錄名稱。</span><span class="sxs-lookup"><span data-stu-id="19271-139">If you want toouse hello previous name, you must change hello name of hello virtual directory during installation.</span></span> <span data-ttu-id="19271-140">否則，如果您允許 hello 安裝 toouse hello 新的預設名稱，您應該按一下 Multi-factor Authentication Server hello hello 使用者入口網站 圖示，並更新 hello 設定 索引標籤上的 hello 使用者入口網站 URL。現有的使用者需要 toobe hello 新 URL 的通知。</span><span class="sxs-lookup"><span data-stu-id="19271-140">Otherwise, if you allow hello install toouse hello new default name, you should click hello User Portal icon in hello Multi-Factor Authentication Server and update hello User Portal URL on hello Settings tab. Existing users need toobe informed of hello new URL.</span></span>

  3. <span data-ttu-id="19271-141">移 toohello 使用者入口網站安裝位置 (例如 C:\inetpub\wwwroot\MultiFactorAuth) 並編輯 hello web.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="19271-141">Go toohello User Portal install location (for example, C:\inetpub\wwwroot\MultiFactorAuth) and edit hello web.config file.</span></span> <span data-ttu-id="19271-142">複製您 hello 升級前備份到 hello 新的 web.config 檔案的原始 web.config 檔案中的 hello appSettings 及 applicationSettings 區段中的 hello 值。</span><span class="sxs-lookup"><span data-stu-id="19271-142">Copy hello values in hello appSettings and applicationSettings sections from your original web.config file that was backed up before hello upgrade into hello new web.config file.</span></span> <span data-ttu-id="19271-143">如果安裝 hello Web 服務 SDK 時保留 hello 新的預設虛擬目錄名稱，，變更 hello applicationSettings 區段 toopoint toohello 正確的位置中的 hello URL。</span><span class="sxs-lookup"><span data-stu-id="19271-143">If hello new default virtual directory name was kept when installing hello Web Service SDK, change hello URL in hello applicationSettings section toopoint toohello correct location.</span></span> <span data-ttu-id="19271-144">如果在 hello 先前的 web.config 檔案中變更了任何其他預設值，適用於那些相同變更 toohello 新的 web.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="19271-144">If any other defaults were changed in hello previous web.config file, apply those same changes toohello new web.config file.</span></span>

  4. <span data-ttu-id="19271-145">tooinstall hello Mobile App Web Service hello 網頁伺服器上，開啟命令提示字元，以系統管理員，然後執行 hello MultiFactorAuthenticationMobileAppWebServiceSetupXX.msi。</span><span class="sxs-lookup"><span data-stu-id="19271-145">tooinstall hello Mobile App Web Service on hello web server, open a command prompt as an administrator and run hello MultiFactorAuthenticationMobileAppWebServiceSetupXX.msi.</span></span>

    <span data-ttu-id="19271-146">hello 的預設虛擬目錄名稱現在是**MultiFactorAuthMobileAppWebService**而不是**PhoneFactorPhoneAppWebService**。</span><span class="sxs-lookup"><span data-stu-id="19271-146">hello default virtual directory name is now **MultiFactorAuthMobileAppWebService** instead of **PhoneFactorPhoneAppWebService**.</span></span> <span data-ttu-id="19271-147">如果您想 toouse hello 先前的名稱，您必須在安裝期間變更 hello hello 虛擬目錄名稱。</span><span class="sxs-lookup"><span data-stu-id="19271-147">If you want toouse hello previous name, you must change hello name of hello virtual directory during installation.</span></span> <span data-ttu-id="19271-148">您可能會想 toochoose 較短的名稱 toomake 輕鬆使用者 tootype 中行動裝置上。</span><span class="sxs-lookup"><span data-stu-id="19271-148">You may want toochoose a shorter name toomake it easy for end users tootype in on their mobile devices.</span></span> <span data-ttu-id="19271-149">否則，如果您允許 hello 安裝 toouse hello 新的預設名稱，您應該按一下 hello hello Multi-factor Authentication Server 中的行動裝置應用程式圖示，並更新 hello Mobile App Web Service URL。</span><span class="sxs-lookup"><span data-stu-id="19271-149">Otherwise, if you allow hello install toouse hello new default name, you should click hello Mobile App icon in hello Multi-Factor Authentication Server and update hello Mobile App Web Service URL.</span></span>

  5. <span data-ttu-id="19271-150">移 toohello Mobile App Web Service 安裝位置 (例如 C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService) 並編輯 hello web.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="19271-150">Go toohello Mobile App Web Service install location (for example, C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService) and edit hello web.config file.</span></span> <span data-ttu-id="19271-151">複製您 hello 升級前備份到 hello 新的 web.config 檔案的原始 web.config 檔案中的 hello appSettings 及 applicationSettings 區段中的 hello 值。</span><span class="sxs-lookup"><span data-stu-id="19271-151">Copy hello values in hello appSettings and applicationSettings sections from your original web.config file that was backed up before hello upgrade into hello new web.config file.</span></span> <span data-ttu-id="19271-152">如果安裝 hello Web 服務 SDK 時保留 hello 新的預設虛擬目錄名稱，，變更 hello applicationSettings 區段 toopoint toohello 正確的位置中的 hello URL。</span><span class="sxs-lookup"><span data-stu-id="19271-152">If hello new default virtual directory name was kept when installing hello Web Service SDK, change hello URL in hello applicationSettings section toopoint toohello correct location.</span></span> <span data-ttu-id="19271-153">如果在 hello 先前的 web.config 檔案中變更了任何其他預設值，適用於那些相同變更 toohello 新的 web.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="19271-153">If any other defaults were changed in hello previous web.config file, apply those same changes toohello new web.config file.</span></span>

## <a name="next-steps"></a><span data-ttu-id="19271-154">後續步驟</span><span class="sxs-lookup"><span data-stu-id="19271-154">Next steps</span></span>

- <span data-ttu-id="19271-155">[安裝 hello 使用者入口網站](multi-factor-authentication-get-started-portal.md)hello Azure Multi-factor Authentication Server。</span><span class="sxs-lookup"><span data-stu-id="19271-155">[Install hello users portal](multi-factor-authentication-get-started-portal.md) for hello Azure Multi-Factor Authentication Server.</span></span>

- <span data-ttu-id="19271-156">為您的應用程式[設定 Windows 驗證](multi-factor-authentication-get-started-server-windows.md)。</span><span class="sxs-lookup"><span data-stu-id="19271-156">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications.</span></span> 
