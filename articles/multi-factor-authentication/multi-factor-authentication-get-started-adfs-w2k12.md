---
title: "aaaMFA 與 Windows Server 中的 AD FS 伺服器 |Microsoft 文件"
description: "本文說明 tooget 2016 和 Windows Server 2012 R2 中的 AD FS 與 Azure Multi-factor Authentication 的啟動方式。"
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 57208068-1e55-45b6-840f-fdcd13723074
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/29/2017
ms.author: kgremban
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 656785abcc63a020add765a86670b488a3b84b51
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-multi-factor-authentication-server-toowork-with-ad-fs-in-windows-server"></a><span data-ttu-id="640ac-103">使用 Windows Server 中的 AD FS 設定 Azure Multi-factor Authentication Server toowork</span><span class="sxs-lookup"><span data-stu-id="640ac-103">Configure Azure Multi-Factor Authentication Server toowork with AD FS in Windows Server</span></span>
<span data-ttu-id="640ac-104">如果您使用 Active Directory Federation Services (AD FS)，而且想 toosecure 雲端或內部部署資源，您可以使用 AD FS 設定 Azure Multi-factor Authentication Server toowork。</span><span class="sxs-lookup"><span data-stu-id="640ac-104">If you use Active Directory Federation Services (AD FS) and want toosecure cloud or on-premises resources, you can configure Azure Multi-Factor Authentication Server toowork with AD FS.</span></span> <span data-ttu-id="640ac-105">此組態會觸發高價值端點的雙步驟驗證。</span><span class="sxs-lookup"><span data-stu-id="640ac-105">This configuration triggers two-step verification for high-value endpoints.</span></span>

<span data-ttu-id="640ac-106">在本文中，我們將討論如何搭配 Windows Server 2012 R2 或 Windows Server 2016 中的 AD FS 使用 Azure Multi-Factor Authentication Server。</span><span class="sxs-lookup"><span data-stu-id="640ac-106">In this article, we discuss using Azure Multi-Factor Authentication Server with AD FS in Windows Server 2012 R2 or Windows Server 2016.</span></span> <span data-ttu-id="640ac-107">如需詳細資訊，了解太[地使用 AD FS 2.0 中使用 Azure Multi-factor Authentication Server 保護雲端和內部部署資源](multi-factor-authentication-get-started-adfs-adfs2.md)。</span><span class="sxs-lookup"><span data-stu-id="640ac-107">For more information, read about how too[secure cloud and on-premises resources by using Azure Multi-Factor Authentication Server with AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span></span>

## <a name="secure-windows-server-ad-fs-with-azure-multi-factor-authentication-server"></a><span data-ttu-id="640ac-108">使用 Azure Multi-Factor Authentication Server 保護 Windows Server AD FS</span><span class="sxs-lookup"><span data-stu-id="640ac-108">Secure Windows Server AD FS with Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="640ac-109">當您安裝 Azure Multi-factor Authentication Server 時，您會有下列選項的 hello:</span><span class="sxs-lookup"><span data-stu-id="640ac-109">When you install Azure Multi-Factor Authentication Server, you have hello following options:</span></span>

* <span data-ttu-id="640ac-110">本機 hello 上安裝 Azure Multi-factor Authentication Server 與 AD FS 相同的伺服器</span><span class="sxs-lookup"><span data-stu-id="640ac-110">Install Azure Multi-Factor Authentication Server locally on hello same server as AD FS</span></span>
* <span data-ttu-id="640ac-111">Hello AD FS 伺服器上本機安裝 hello Azure 多重要素驗證配接器，然後再安裝一部電腦上的 Multi-factor Authentication Server</span><span class="sxs-lookup"><span data-stu-id="640ac-111">Install hello Azure Multi-Factor Authentication adapter locally on hello AD FS server, and then install Multi-Factor Authentication Server on a different computer</span></span>

<span data-ttu-id="640ac-112">開始之前，請留意的 hello 下列資訊：</span><span class="sxs-lookup"><span data-stu-id="640ac-112">Before you begin, be aware of hello following information:</span></span>

* <span data-ttu-id="640ac-113">您不需要的 tooinstall Azure Multi-factor Authentication Server AD FS 伺服器上。</span><span class="sxs-lookup"><span data-stu-id="640ac-113">You are not required tooinstall Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="640ac-114">不過，您必須安裝 hello Multi-factor Authentication 配接器的 Windows Server 2012 R2 或 Windows Server 2016 執行 AD FS 上的 AD FS。</span><span class="sxs-lookup"><span data-stu-id="640ac-114">However, you must install hello Multi-Factor Authentication adapter for AD FS on a Windows Server 2012 R2 or Windows Server 2016 that is running AD FS.</span></span> <span data-ttu-id="640ac-115">如果是支援的版本，而且您 hello AD FS 配接器個別安裝 AD FS 同盟伺服器上，您可以在不同電腦上安裝 hello 伺服器。</span><span class="sxs-lookup"><span data-stu-id="640ac-115">You can install hello server on a different computer if it is a supported version and you install hello AD FS adapter separately on your AD FS federation server.</span></span> <span data-ttu-id="640ac-116">請參閱 hello 下列程序 toolearn 如何 tooinstall hello 配接器分開。</span><span class="sxs-lookup"><span data-stu-id="640ac-116">See hello following procedures toolearn how tooinstall hello adapter separately.</span></span>
* <span data-ttu-id="640ac-117">如果您的組織使用簡訊或行動裝置應用程式驗證方法，定義公司設定中的 hello 字串包含預留位置，<$*application_name*$>。</span><span class="sxs-lookup"><span data-stu-id="640ac-117">If your organization is using text message or mobile app verification methods, hello strings defined in Company Settings contain a placeholder, <$*application_name*$>.</span></span> <span data-ttu-id="640ac-118">在 MFA Server v7.1 中，您可以提供要取代此預留位置的應用程式名稱。</span><span class="sxs-lookup"><span data-stu-id="640ac-118">In MFA Server v7.1, you can provide an application name that replaces this placeholder.</span></span> <span data-ttu-id="640ac-119">在 v7.0 或較舊，這個版面配置不會自動時，取代使用 hello AD FS 配接器。</span><span class="sxs-lookup"><span data-stu-id="640ac-119">In v7.0 or older, this placeholder is not automatically replaced when you use hello AD FS adapter.</span></span> <span data-ttu-id="640ac-120">如需這些較舊版本，保護 AD FS 時，從 hello 適當的字串移除 hello 預留位置。</span><span class="sxs-lookup"><span data-stu-id="640ac-120">For those older versions, remove hello placeholder from hello appropriate strings when you secure AD FS.</span></span>
* <span data-ttu-id="640ac-121">使用 toosign 中的 hello 帳戶必須具有 Active Directory 服務中的使用者權限 toocreate 安全性群組。</span><span class="sxs-lookup"><span data-stu-id="640ac-121">hello account that you use toosign in must have user rights toocreate security groups in your Active Directory service.</span></span>
* <span data-ttu-id="640ac-122">hello Multi-factor Authentication AD FS 配接器安裝精靈會建立名執行個體的 Active Directory 中 PhoneFactor Admins 安全性群組。</span><span class="sxs-lookup"><span data-stu-id="640ac-122">hello Multi-Factor Authentication AD FS adapter installation wizard creates a security group called PhoneFactor Admins in your instance of Active Directory.</span></span> <span data-ttu-id="640ac-123">接著，它會加入您的同盟服務 toothis 群組 hello AD FS 服務帳戶。</span><span class="sxs-lookup"><span data-stu-id="640ac-123">It then adds hello AD FS service account of your federation service toothis group.</span></span> <span data-ttu-id="640ac-124">PhoneFactor Admins 群組確實已經建立該 hello 與 hello AD FS 服務帳戶是這個群組的成員，請確認您的網域控制站上。</span><span class="sxs-lookup"><span data-stu-id="640ac-124">Verify on your domain controller that hello PhoneFactor Admins group is indeed created and that hello AD FS service account is a member of this group.</span></span> <span data-ttu-id="640ac-125">如果有必要，請手動加入 hello AD FS 服務帳戶 toohello PhoneFactor Admins 群組您的網域控制站上。</span><span class="sxs-lookup"><span data-stu-id="640ac-125">If necessary, manually add hello AD FS service account toohello PhoneFactor Admins group on your domain controller.</span></span>
* <span data-ttu-id="640ac-126">與 hello 使用者入口網站安裝 hello Web 服務 SDK 的相關資訊，請參閱有關[hello 使用者入口網站部署為 Azure Multi-factor Authentication Server。](multi-factor-authentication-get-started-portal.md)</span><span class="sxs-lookup"><span data-stu-id="640ac-126">For information about installing hello Web Service SDK with hello user portal, read about [deploying hello user portal for Azure Multi-Factor Authentication Server.](multi-factor-authentication-get-started-portal.md)</span></span>

### <a name="install-azure-multi-factor-authentication-server-locally-on-hello-ad-fs-server"></a><span data-ttu-id="640ac-127">Azure Multi-factor Authentication Server 伺服器本機上安裝 AD FS hello</span><span class="sxs-lookup"><span data-stu-id="640ac-127">Install Azure Multi-Factor Authentication Server locally on hello AD FS server</span></span>
1. <span data-ttu-id="640ac-128">在 AD FS 伺服器上下載並安裝 Azure Multi-Factor Authentication Server。</span><span class="sxs-lookup"><span data-stu-id="640ac-128">Download and install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="640ac-129">如需安裝資訊，請參閱 [開始使用 Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md)。</span><span class="sxs-lookup"><span data-stu-id="640ac-129">For installation information, read about [getting started with Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
2. <span data-ttu-id="640ac-130">在 hello Azure Multi-factor Authentication Server 管理主控台中，按一下 hello **AD FS**圖示。</span><span class="sxs-lookup"><span data-stu-id="640ac-130">In hello Azure Multi-Factor Authentication Server management console, click hello **AD FS** icon.</span></span> <span data-ttu-id="640ac-131">選取 hello 選項**允許使用者註冊**和**tooselect 方法可讓使用者**。</span><span class="sxs-lookup"><span data-stu-id="640ac-131">Select hello options **Allow user enrollment** and **Allow users tooselect method**.</span></span>
3. <span data-ttu-id="640ac-132">選取您想要 toospecify 貴組織的任何其他選項。</span><span class="sxs-lookup"><span data-stu-id="640ac-132">Select any additional options you'd like toospecify for your organization.</span></span>
4. <span data-ttu-id="640ac-133">按一下 [安裝 AD FS 配接器] 。</span><span class="sxs-lookup"><span data-stu-id="640ac-133">Click **Install AD FS Adapter**.</span></span>
   
   <span data-ttu-id="640ac-134"><center>![雲端](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span><span class="sxs-lookup"><span data-stu-id="640ac-134"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span></span>

5. <span data-ttu-id="640ac-135">如果顯示 hello Active Directory 視窗，就表示兩件事。</span><span class="sxs-lookup"><span data-stu-id="640ac-135">If hello Active Directory window is displayed, that means two things.</span></span> <span data-ttu-id="640ac-136">您的電腦是聯結的 tooa 網域和 hello hello AD FS 介面卡與 hello Multi-factor Authentication 服務之間安全通訊的 Active Directory 組態不完整。</span><span class="sxs-lookup"><span data-stu-id="640ac-136">Your computer is joined tooa domain, and hello Active Directory configuration for securing communication between hello AD FS adapter and hello Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="640ac-137">按一下**下一步**tooautomatically 完成這項設定，或選取 hello**略過自動 Active Directory 設定，然後設定手動**核取方塊。</span><span class="sxs-lookup"><span data-stu-id="640ac-137">Click **Next** tooautomatically complete this configuration, or select hello **Skip automatic Active Directory configuration and configure settings manually** check box.</span></span> <span data-ttu-id="640ac-138">按一下 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="640ac-138">Click **Next**.</span></span>
6. <span data-ttu-id="640ac-139">如果顯示 hello 本機群組的 windows，這表示兩件事。</span><span class="sxs-lookup"><span data-stu-id="640ac-139">If hello Local Group windows is displayed, that means two things.</span></span> <span data-ttu-id="640ac-140">您的電腦不是聯結的 tooa 網域而 hello AD FS 介面卡與 hello Multi-factor Authentication 服務之間安全通訊的 hello 本機群組設定尚未完成。</span><span class="sxs-lookup"><span data-stu-id="640ac-140">Your computer is not joined tooa domain, and hello local group configuration for securing communication between hello AD FS adapter and hello Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="640ac-141">按一下**下一步**tooautomatically 完成這項設定，或選取 hello**略過自動本機群組設定，然後設定手動**核取方塊。</span><span class="sxs-lookup"><span data-stu-id="640ac-141">Click **Next** tooautomatically complete this configuration, or select hello **Skip automatic Local Group configuration and configure settings manually** check box.</span></span> <span data-ttu-id="640ac-142">按一下 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="640ac-142">Click **Next**.</span></span>
7. <span data-ttu-id="640ac-143">在 hello 安裝精靈 中，按一下 **下一步**。</span><span class="sxs-lookup"><span data-stu-id="640ac-143">In hello installation wizard, click **Next**.</span></span> <span data-ttu-id="640ac-144">Azure Multi-factor Authentication Server 建立 hello PhoneFactor Admins 群組，並將 hello AD FS 服務帳戶 toohello PhoneFactor Admins 群組。</span><span class="sxs-lookup"><span data-stu-id="640ac-144">Azure Multi-Factor Authentication Server creates hello PhoneFactor Admins group and adds hello AD FS service account toohello PhoneFactor Admins group.</span></span>
   <span data-ttu-id="640ac-145"><center>![雲端](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span><span class="sxs-lookup"><span data-stu-id="640ac-145"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span></span>
8. <span data-ttu-id="640ac-146">在 hello**啟動安裝程式**頁面上，按一下**下一步**。</span><span class="sxs-lookup"><span data-stu-id="640ac-146">On hello **Launch Installer** page, click **Next**.</span></span>
9. <span data-ttu-id="640ac-147">在 hello Multi-factor Authentication AD FS 配接器安裝程式中，按一下 **下一步**。</span><span class="sxs-lookup"><span data-stu-id="640ac-147">In hello Multi-Factor Authentication AD FS adapter installer, click **Next**.</span></span>
10. <span data-ttu-id="640ac-148">按一下**關閉**hello 安裝完成時。</span><span class="sxs-lookup"><span data-stu-id="640ac-148">Click **Close** when hello installation is finished.</span></span>
11. <span data-ttu-id="640ac-149">如果已安裝 hello 配接器，您必須使用 AD FS 來進行註冊。</span><span class="sxs-lookup"><span data-stu-id="640ac-149">When hello adapter has been installed, you must register it with AD FS.</span></span> <span data-ttu-id="640ac-150">開啟 Windows PowerShell 並執行下列命令的 hello:</span><span class="sxs-lookup"><span data-stu-id="640ac-150">Open Windows PowerShell and run hello following command:</span></span><br><span data-ttu-id="640ac-151">
    `C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
    <center>![雲端](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span><span class="sxs-lookup"><span data-stu-id="640ac-151">
`C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
<center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span></span>
12. <span data-ttu-id="640ac-152">toouse 您新註冊的配接器，用來在 AD FS 中編輯 hello 通用驗證原則。</span><span class="sxs-lookup"><span data-stu-id="640ac-152">toouse your newly registered adapter, edit hello global authentication policy in AD FS.</span></span> <span data-ttu-id="640ac-153">在 hello AD FS 管理主控台中，移 toohello**驗證原則**節點。</span><span class="sxs-lookup"><span data-stu-id="640ac-153">In hello AD FS management console, go toohello **Authentication Policies** node.</span></span> <span data-ttu-id="640ac-154">在 hello **multi-factor Authentication**區段中，按一下 hello**編輯**連結下一步 toohello**通用設定**> 一節。</span><span class="sxs-lookup"><span data-stu-id="640ac-154">In hello **Multi-factor Authentication** section, click hello **Edit** link next toohello **Global Settings** section.</span></span> <span data-ttu-id="640ac-155">在 hello**編輯全域驗證原則**視窗中，選取**Multi-factor Authentication**作為其他驗證方法，然後按一下**確定**。</span><span class="sxs-lookup"><span data-stu-id="640ac-155">In hello **Edit Global Authentication Policy** window, select **Multi-Factor Authentication** as an additional authentication method, and then click **OK**.</span></span> <span data-ttu-id="640ac-156">hello 配接器會登錄為 WindowsAzureMultiFactorAuthentication。</span><span class="sxs-lookup"><span data-stu-id="640ac-156">hello adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="640ac-157">重新啟動 hello 註冊 tootake 效果 hello AD FS 服務。</span><span class="sxs-lookup"><span data-stu-id="640ac-157">Restart hello AD FS service for hello registration tootake effect.</span></span>

<span data-ttu-id="640ac-158"><center>![雲端](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span><span class="sxs-lookup"><span data-stu-id="640ac-158"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span></span>

<span data-ttu-id="640ac-159">此時，Multi-factor Authentication Server 設定 toobe 與 AD FS 的其他驗證提供者 toouse。</span><span class="sxs-lookup"><span data-stu-id="640ac-159">At this point, Multi-Factor Authentication Server is set up toobe an additional authentication provider toouse with AD FS.</span></span>

## <a name="install-a-standalone-instance-of-hello-ad-fs-adapter-by-using-hello-web-service-sdk"></a><span data-ttu-id="640ac-160">使用 hello Web 服務 SDK 安裝 hello AD FS 配接器的獨立執行個體</span><span class="sxs-lookup"><span data-stu-id="640ac-160">Install a standalone instance of hello AD FS adapter by using hello Web Service SDK</span></span>
1. <span data-ttu-id="640ac-161">安裝 Web 服務 SDK hello hello 執行 Multi-factor Authentication Server 的伺服器上。</span><span class="sxs-lookup"><span data-stu-id="640ac-161">Install hello Web Service SDK on hello server that is running Multi-Factor Authentication Server.</span></span>
2. <span data-ttu-id="640ac-162">複製 hello 下列檔案從 hello \Program Files\Multi-Authentication Server 目錄 toohello 伺服器計劃 tooinstall hello AD FS 配接器：</span><span class="sxs-lookup"><span data-stu-id="640ac-162">Copy hello following files from hello \Program Files\Multi-Factor Authentication Server directory toohello server on which you plan tooinstall hello AD FS adapter:</span></span>
   * <span data-ttu-id="640ac-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="640ac-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
   * <span data-ttu-id="640ac-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="640ac-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="640ac-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="640ac-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="640ac-166">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="640ac-166">MultiFactorAuthenticationAdfsAdapter.config</span></span>
3. <span data-ttu-id="640ac-167">執行 hello MultiFactorAuthenticationAdfsAdapterSetup64.msi 安裝檔案。</span><span class="sxs-lookup"><span data-stu-id="640ac-167">Run hello MultiFactorAuthenticationAdfsAdapterSetup64.msi installation file.</span></span>
4. <span data-ttu-id="640ac-168">在 hello Multi-factor Authentication AD FS 配接器安裝程式中，按一下 **下一步**toostart hello 安裝。</span><span class="sxs-lookup"><span data-stu-id="640ac-168">In hello Multi-Factor Authentication AD FS adapter installer, click **Next** toostart hello installation.</span></span>
5. <span data-ttu-id="640ac-169">按一下**關閉**hello 安裝完成時。</span><span class="sxs-lookup"><span data-stu-id="640ac-169">Click **Close** when hello installation is finished.</span></span>

## <a name="edit-hello-multifactorauthenticationadfsadapterconfig-file"></a><span data-ttu-id="640ac-170">編輯 hello MultiFactorAuthenticationAdfsAdapter.config 檔案</span><span class="sxs-lookup"><span data-stu-id="640ac-170">Edit hello MultiFactorAuthenticationAdfsAdapter.config file</span></span>
<span data-ttu-id="640ac-171">請遵循這些步驟 tooedit hello MultiFactorAuthenticationAdfsAdapter.config 檔案：</span><span class="sxs-lookup"><span data-stu-id="640ac-171">Follow these steps tooedit hello MultiFactorAuthenticationAdfsAdapter.config file:</span></span>

1. <span data-ttu-id="640ac-172">設定 hello **UseWebServiceSdk**節點太**true**。</span><span class="sxs-lookup"><span data-stu-id="640ac-172">Set hello **UseWebServiceSdk** node too**true**.</span></span>  
2. <span data-ttu-id="640ac-173">設定 hello 值**WebServiceSdkUrl** toohello hello Multi-factor Authentication Web 服務 SDK URL。</span><span class="sxs-lookup"><span data-stu-id="640ac-173">Set hello value for **WebServiceSdkUrl** toohello URL of hello Multi-Factor Authentication Web Service SDK.</span></span> <span data-ttu-id="640ac-174">例如： *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*，其中*certificatename* hello 您的憑證名稱。</span><span class="sxs-lookup"><span data-stu-id="640ac-174">For example:  *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, Where *certificatename* is hello name of your certificate.</span></span>  
3. <span data-ttu-id="640ac-175">編輯 hello Register-multifactorauthenticationadfsadapter.ps1 指令碼，藉由新增*-ConfigurationFilePath&lt;路徑&gt;* toohello 結尾 hello`Register-AdfsAuthenticationProvider`命令，其中 *&lt;路徑&gt;* hello 完整路徑 toohello MultiFactorAuthenticationAdfsAdapter.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="640ac-175">Edit hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding *-ConfigurationFilePath &lt;path&gt;* toohello end of hello `Register-AdfsAuthenticationProvider` command, where *&lt;path&gt;* is hello full path toohello MultiFactorAuthenticationAdfsAdapter.config file.</span></span>

### <a name="configure-hello-web-service-sdk-with-a-username-and-password"></a><span data-ttu-id="640ac-176">使用使用者名稱和密碼設定 Web 服務 SDK hello</span><span class="sxs-lookup"><span data-stu-id="640ac-176">Configure hello Web Service SDK with a username and password</span></span>
<span data-ttu-id="640ac-177">有兩個選項，以設定 Web 服務 SDK hello。</span><span class="sxs-lookup"><span data-stu-id="640ac-177">There are two options for configuring hello Web Service SDK.</span></span> <span data-ttu-id="640ac-178">hello 第一個是使用者名稱和密碼，hello 第二個用戶端憑證。</span><span class="sxs-lookup"><span data-stu-id="640ac-178">hello first is with a username and password, hello second is with a client certificate.</span></span> <span data-ttu-id="640ac-179">依照下列步驟進行 hello 第一個選項，或跳 hello 第二個。</span><span class="sxs-lookup"><span data-stu-id="640ac-179">Follow these steps for hello first option, or skip ahead for hello second.</span></span>  

1. <span data-ttu-id="640ac-180">設定 hello 值**WebServiceSdkUsername** tooan 帳戶 hello PhoneFactor Admins 安全性群組的成員。</span><span class="sxs-lookup"><span data-stu-id="640ac-180">Set hello value for **WebServiceSdkUsername** tooan account that is a member of hello PhoneFactor Admins security group.</span></span> <span data-ttu-id="640ac-181">使用 hello&lt;網域&gt;&#92;&lt;使用者名稱&gt;格式。</span><span class="sxs-lookup"><span data-stu-id="640ac-181">Use hello &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
2. <span data-ttu-id="640ac-182">設定 hello 值**webservicesdkpassword 設定**toohello 適當的帳戶密碼。</span><span class="sxs-lookup"><span data-stu-id="640ac-182">Set hello value for **WebServiceSdkPassword** toohello appropriate account password.</span></span>

### <a name="configure-hello-web-service-sdk-with-a-client-certificate"></a><span data-ttu-id="640ac-183">設定用戶端憑證的 hello Web 服務 SDK</span><span class="sxs-lookup"><span data-stu-id="640ac-183">Configure hello Web Service SDK with a client certificate</span></span>
<span data-ttu-id="640ac-184">如果您不想 toouse 使用者名稱和密碼，請依照下列用戶端憑證與這些步驟 tooconfigure hello Web 服務 SDK。</span><span class="sxs-lookup"><span data-stu-id="640ac-184">If you don't want toouse a username and password, follow these steps tooconfigure hello Web Service SDK with a client certificate.</span></span>

1. <span data-ttu-id="640ac-185">從執行 hello Web 服務 SDK 的 hello 伺服器憑證授權單位取得用戶端憑證。</span><span class="sxs-lookup"><span data-stu-id="640ac-185">Obtain a client certificate from a certificate authority for hello server that is running hello Web Service SDK.</span></span> <span data-ttu-id="640ac-186">了解如何太[取得用戶端憑證](https://technet.microsoft.com/library/cc770328.aspx)。</span><span class="sxs-lookup"><span data-stu-id="640ac-186">Learn how too[obtain client certificates](https://technet.microsoft.com/library/cc770328.aspx).</span></span>  
2. <span data-ttu-id="640ac-187">匯入 hello 用戶端憑證 toohello 本機電腦個人憑證存放區執行 hello Web 服務 SDK 的 hello 伺服器上。</span><span class="sxs-lookup"><span data-stu-id="640ac-187">Import hello client certificate toohello local computer personal certificate store on hello server that is running hello Web Service SDK.</span></span> <span data-ttu-id="640ac-188">請確定該 hello 憑證授權單位的公開憑證位於受信任的根憑證的憑證存放區。</span><span class="sxs-lookup"><span data-stu-id="640ac-188">Make sure that hello certificate authority's public certificate is in Trusted Root Certificates certificate store.</span></span>  
3. <span data-ttu-id="640ac-189">匯出 hello 用戶端憑證 tooa.pfx 檔案的 hello 公用和私用的金鑰。</span><span class="sxs-lookup"><span data-stu-id="640ac-189">Export hello public and private keys of hello client certificate tooa .pfx file.</span></span>  
4. <span data-ttu-id="640ac-190">Hello 公開金鑰 Base64 格式 tooa.cer 檔案中的匯出。</span><span class="sxs-lookup"><span data-stu-id="640ac-190">Export hello public key in Base64 format tooa .cer file.</span></span>  
5. <span data-ttu-id="640ac-191">在 [伺服器管理員] 中，確認已安裝該 hello 網頁伺服器 (IIS) \Web Server\Security\IIS 用戶端憑證對應驗證功能。</span><span class="sxs-lookup"><span data-stu-id="640ac-191">In Server Manager, verify that hello Web Server (IIS)\Web Server\Security\IIS Client Certificate Mapping Authentication feature is installed.</span></span> <span data-ttu-id="640ac-192">如果未安裝，請選取**新增角色及功能**tooadd 這項功能。</span><span class="sxs-lookup"><span data-stu-id="640ac-192">If it is not installed, select **Add Roles and Features** tooadd this feature.</span></span>  
6. <span data-ttu-id="640ac-193">在 [IIS 管理員] 中，按兩下**組態編輯器**hello 網站中的包含 hello Web 服務 SDK 虛擬目錄。</span><span class="sxs-lookup"><span data-stu-id="640ac-193">In IIS Manager, double-click **Configuration Editor** in hello website that contains hello Web Service SDK virtual directory.</span></span> <span data-ttu-id="640ac-194">它是重要的 tooselect hello 網站，而非 hello 虛擬目錄。</span><span class="sxs-lookup"><span data-stu-id="640ac-194">It is important tooselect hello website, not hello virtual directory.</span></span>  
7. <span data-ttu-id="640ac-195">移 toohello **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** > 一節。</span><span class="sxs-lookup"><span data-stu-id="640ac-195">Go toohello **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** section.</span></span>  
8. <span data-ttu-id="640ac-196">集合也啟用**true**。</span><span class="sxs-lookup"><span data-stu-id="640ac-196">Set enabled too**true**.</span></span>  
9. <span data-ttu-id="640ac-197">將 onetoonecertificatemappingsenabled 設定太**true**。</span><span class="sxs-lookup"><span data-stu-id="640ac-197">Set oneToOneCertificateMappingsEnabled too**true**.</span></span>  
10. <span data-ttu-id="640ac-198">按一下 hello **...**按鈕下一步 toooneToOneMappings，，然後按一下hello**新增**連結。</span><span class="sxs-lookup"><span data-stu-id="640ac-198">Click hello **...** button next toooneToOneMappings, and then click hello **Add** link.</span></span>  
11. <span data-ttu-id="640ac-199">開啟您稍早匯出的 hello Base64.cer 檔案。</span><span class="sxs-lookup"><span data-stu-id="640ac-199">Open hello Base64 .cer file you exported earlier.</span></span> <span data-ttu-id="640ac-200">移除 *-----BEGIN CERTIFICATE-----*、*-----END CERTIFICATE-----*，以及任何分行符號。</span><span class="sxs-lookup"><span data-stu-id="640ac-200">Remove *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----*, and any line breaks.</span></span> <span data-ttu-id="640ac-201">將複製 hello 產生的字串。</span><span class="sxs-lookup"><span data-stu-id="640ac-201">Copy hello resulting string.</span></span>  
12. <span data-ttu-id="640ac-202">設定憑證 toohello 字串 hello 前面步驟中複製。</span><span class="sxs-lookup"><span data-stu-id="640ac-202">Set certificate toohello string copied in hello preceding step.</span></span>  
13. <span data-ttu-id="640ac-203">集合也啟用**true**。</span><span class="sxs-lookup"><span data-stu-id="640ac-203">Set enabled too**true**.</span></span>  
14. <span data-ttu-id="640ac-204">設定使用者名稱 tooan 帳戶 hello PhoneFactor Admins 安全性群組的成員。</span><span class="sxs-lookup"><span data-stu-id="640ac-204">Set userName tooan account that is a member of hello PhoneFactor Admins security group.</span></span> <span data-ttu-id="640ac-205">使用 hello&lt;網域&gt;&#92;&lt;使用者名稱&gt;格式。</span><span class="sxs-lookup"><span data-stu-id="640ac-205">Use hello &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
15. <span data-ttu-id="640ac-206">設定 hello 密碼 toohello 適當的帳戶密碼，然後關閉 設定編輯器。</span><span class="sxs-lookup"><span data-stu-id="640ac-206">Set hello password toohello appropriate account password, and then close Configuration Editor.</span></span>  
16. <span data-ttu-id="640ac-207">按一下 hello**套用**連結。</span><span class="sxs-lookup"><span data-stu-id="640ac-207">Click hello **Apply** link.</span></span>  
17. <span data-ttu-id="640ac-208">在 hello Web 服務 SDK 虛擬目錄中，按兩下**驗證**。</span><span class="sxs-lookup"><span data-stu-id="640ac-208">In hello Web Service SDK virtual directory, double-click **Authentication**.</span></span>  
18. <span data-ttu-id="640ac-209">請確認 ASP.NET 模擬與基本驗證已設定太**啟用**，而且其他所有項目也設定太**已停用**。</span><span class="sxs-lookup"><span data-stu-id="640ac-209">Verify that ASP.NET Impersonation and Basic Authentication are set too**Enabled**, and that all other items are set too**Disabled**.</span></span>  
19. <span data-ttu-id="640ac-210">在 hello Web 服務 SDK 虛擬目錄中，按兩下**SSL 設定**。</span><span class="sxs-lookup"><span data-stu-id="640ac-210">In hello Web Service SDK virtual directory, double-click **SSL Settings**.</span></span>  
20. <span data-ttu-id="640ac-211">設定用戶端憑證太**接受**，然後按一下**套用**。</span><span class="sxs-lookup"><span data-stu-id="640ac-211">Set Client Certificates too**Accept**, and then click **Apply**.</span></span>  
21. <span data-ttu-id="640ac-212">將匯出執行 hello AD FS 配接器的較早 toohello 伺服器 hello.pfx 檔案複製。</span><span class="sxs-lookup"><span data-stu-id="640ac-212">Copy hello .pfx file you exported earlier toohello server that is running hello AD FS adapter.</span></span>  
22. <span data-ttu-id="640ac-213">匯入 hello.pfx 檔案 toohello 本機電腦個人憑證存放區。</span><span class="sxs-lookup"><span data-stu-id="640ac-213">Import hello .pfx file toohello local computer personal certificate store.</span></span>  
23. <span data-ttu-id="640ac-214">以滑鼠右鍵按一下並選取**管理私密金鑰**，，然後授與讀取權限 toohello 帳戶 toosign 用於 toohello AD FS 服務。</span><span class="sxs-lookup"><span data-stu-id="640ac-214">Right-click and select **Manage Private Keys**, and then grant read access toohello account you used toosign in toohello AD FS service.</span></span>  
24. <span data-ttu-id="640ac-215">從 hello 開啟 hello 用戶端憑證並複製 hello 指紋**詳細資料** 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="640ac-215">Open hello client certificate and copy hello thumbprint from hello **Details** tab.</span></span>  
25. <span data-ttu-id="640ac-216">在 hello MultiFactorAuthenticationAdfsAdapter.config 檔案中，設定**WebServiceSdkCertificateThumbprint** toohello 字串 hello 上一個步驟中複製。</span><span class="sxs-lookup"><span data-stu-id="640ac-216">In hello MultiFactorAuthenticationAdfsAdapter.config file, set **WebServiceSdkCertificateThumbprint** toohello string copied in hello previous step.</span></span>  

<span data-ttu-id="640ac-217">最後，tooregister hello 配接器執行 hello \Program Files\Multi-因素 Authentication Server\register-multifactorauthenticationadfsadapter.ps1 指令碼在 PowerShell 中的。</span><span class="sxs-lookup"><span data-stu-id="640ac-217">Finally, tooregister hello adapter, run hello \Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 script in PowerShell.</span></span> <span data-ttu-id="640ac-218">hello 配接器會登錄為 WindowsAzureMultiFactorAuthentication。</span><span class="sxs-lookup"><span data-stu-id="640ac-218">hello adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="640ac-219">重新啟動 hello 註冊 tootake 效果 hello AD FS 服務。</span><span class="sxs-lookup"><span data-stu-id="640ac-219">Restart hello AD FS service for hello registration tootake effect.</span></span>

## <a name="secure-azure-ad-resources-using-ad-fs"></a><span data-ttu-id="640ac-220">使用 AD FS 保護 Azure AD 資源</span><span class="sxs-lookup"><span data-stu-id="640ac-220">Secure Azure AD resources using AD FS</span></span>
<span data-ttu-id="640ac-221">toosecure 您雲端的資源，設定宣告規則，讓使用者執行雙步驟驗證成功時，Active Directory Federation Services 會發出 hello multipleauthn 宣告。</span><span class="sxs-lookup"><span data-stu-id="640ac-221">toosecure your cloud resource, set up a claims rule so that Active Directory Federation Services emits hello multipleauthn claim when a user performs two-step verification successfully.</span></span> <span data-ttu-id="640ac-222">這個宣告會傳遞 tooAzure AD 上。</span><span class="sxs-lookup"><span data-stu-id="640ac-222">This claim is passed on tooAzure AD.</span></span> <span data-ttu-id="640ac-223">請遵循此程序 toowalk，透過 hello 步驟：</span><span class="sxs-lookup"><span data-stu-id="640ac-223">Follow this procedure toowalk through hello steps:</span></span>

1. <span data-ttu-id="640ac-224">開啟 [AD FS 管理]。</span><span class="sxs-lookup"><span data-stu-id="640ac-224">Open AD FS Management.</span></span>
2. <span data-ttu-id="640ac-225">Hello 左側選取**信賴憑證者信任**。</span><span class="sxs-lookup"><span data-stu-id="640ac-225">On hello left, select **Relying Party Trusts**.</span></span>
3. <span data-ttu-id="640ac-226">以滑鼠右鍵按一下 [Microsoft Office 365 身分識別平台]，然後選取 [編輯宣告規則...]</span><span class="sxs-lookup"><span data-stu-id="640ac-226">Right-click on **Microsoft Office 365 Identity Platform** and select **Edit Claim Rules…**</span></span>

   ![雲端](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip1.png)

4. <span data-ttu-id="640ac-228">在 [發佈轉換規則] 上，按一下 [新增規則]</span><span class="sxs-lookup"><span data-stu-id="640ac-228">On Issuance Transform Rules, click **Add Rule.**</span></span>

   ![雲端](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip2.png)

5. <span data-ttu-id="640ac-230">在 hello 新增轉換宣告規則精靈中，選取**傳遞或篩選傳入宣告**從 hello 下拉式清單，然後按一下 **下一步**。</span><span class="sxs-lookup"><span data-stu-id="640ac-230">On hello Add Transform Claim Rule Wizard, select **Pass Through or Filter an Incoming Claim** from hello drop-down and click **Next**.</span></span>

   ![雲端](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip3.png)

6. <span data-ttu-id="640ac-232">指定規則的名稱。</span><span class="sxs-lookup"><span data-stu-id="640ac-232">Give your rule a name.</span></span>
7. <span data-ttu-id="640ac-233">選取**驗證方法參考**為 hello 傳入宣告類型。</span><span class="sxs-lookup"><span data-stu-id="640ac-233">Select **Authentication Methods References** as hello Incoming claim type.</span></span>
8. <span data-ttu-id="640ac-234">選取 [傳遞所有宣告值]。</span><span class="sxs-lookup"><span data-stu-id="640ac-234">Select **Pass through all claim values**.</span></span>
    <span data-ttu-id="640ac-235">![新增轉換宣告規則精靈](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span><span class="sxs-lookup"><span data-stu-id="640ac-235">![Add Transform Claim Rule Wizard](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span></span>
9. <span data-ttu-id="640ac-236">按一下 [完成] 。</span><span class="sxs-lookup"><span data-stu-id="640ac-236">Click **Finish**.</span></span> <span data-ttu-id="640ac-237">關閉 hello AD FS 管理主控台。</span><span class="sxs-lookup"><span data-stu-id="640ac-237">Close hello AD FS Management console.</span></span>

## <a name="related-topics"></a><span data-ttu-id="640ac-238">相關主題</span><span class="sxs-lookup"><span data-stu-id="640ac-238">Related topics</span></span>
<span data-ttu-id="640ac-239">如需疑難排解說明，請參閱 hello [Azure Multi-factor Authentication 常見問題集](multi-factor-authentication-faq.md)</span><span class="sxs-lookup"><span data-stu-id="640ac-239">For troubleshooting help, see hello [Azure Multi-Factor Authentication FAQs](multi-factor-authentication-faq.md)</span></span>
