---
title: "LDAP 驗證和 Azure MFA Server | Microsoft Docs"
description: "此 Azure Multi-Factor Authentication 頁面協助您部署 LDAP 驗證與 Azure Multi-Factor Authentication Server。"
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: e1a68568-53d1-4365-9e41-50925ad00869
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/03/2017
ms.author: kgremban
ms.openlocfilehash: 8f4d5f9e84ad7bb4fff501370036e7f0da589bf3
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="ldap-authentication-and-azure-multi-factor-authentication-server"></a><span data-ttu-id="5aca0-103">LDAP 驗證和 Azure Multi-Factor Authentication Server</span><span class="sxs-lookup"><span data-stu-id="5aca0-103">LDAP authentication and Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="5aca0-104">根據預設，Azure Multi-Factor Authentication Server 會設定為從 Active Directory 匯入或同步處理使用者。</span><span class="sxs-lookup"><span data-stu-id="5aca0-104">By default, the Azure Multi-Factor Authentication Server is configured to import or synchronize users from Active Directory.</span></span> <span data-ttu-id="5aca0-105">不過，它可以設定為繫結至不同 LDAP 目錄 (例如 ADAM 目錄) 或特定的 Active Directory 網域控制站。</span><span class="sxs-lookup"><span data-stu-id="5aca0-105">However, it can be configured to bind to different LDAP directories, such as an ADAM directory, or specific Active Directory domain controller.</span></span> <span data-ttu-id="5aca0-106">在透過 LDAP 來連線到目錄時，Azure Multi-Factor Authentication Server 可作為 LDAP Proxy 來執行驗證。</span><span class="sxs-lookup"><span data-stu-id="5aca0-106">When connected to a directory via LDAP, the Azure Multi-Factor Authentication Server can act as an LDAP proxy to perform authentications.</span></span> <span data-ttu-id="5aca0-107">它也支援使用 LDAP 繫結做為 RADIUS 目標、使用 IIS 驗證預先驗證使用者，或做為 Azure MFA 使用者入口網站中的主要驗證。</span><span class="sxs-lookup"><span data-stu-id="5aca0-107">It also allows for the use of LDAP bind as a RADIUS target, for pre-authentication of users with IIS Authentication, or for primary authentication in the Azure MFA user portal.</span></span>

<span data-ttu-id="5aca0-108">若要使用 Azure Multi-Factor Authentication 作為 LDAP Proxy，請在 LDAP 用戶端 (例如 VPN 應用裝置、應用程式) 和 LDAP 目錄伺服器之間插入 Azure Multi-Factor Authentication Server。</span><span class="sxs-lookup"><span data-stu-id="5aca0-108">To use Azure Multi-Factor Authentication as an LDAP proxy, insert the Azure Multi-Factor Authentication Server between the LDAP client (for example, VPN appliance, application) and the LDAP directory server.</span></span> <span data-ttu-id="5aca0-109">Azure Multi-Factor Authentication Server 必須設定為能夠與用戶端伺服器和 LDAP 目錄進行通訊。</span><span class="sxs-lookup"><span data-stu-id="5aca0-109">The Azure Multi-Factor Authentication Server must be configured to communicate with both the client servers and the LDAP directory.</span></span> <span data-ttu-id="5aca0-110">在此組態中，Azure Multi-Factor Authentication Server 接受來自用戶端伺服器和應用程式的 LDAP 要求，然後轉送至目標 LDAP 目錄伺服器來驗證主要認證。</span><span class="sxs-lookup"><span data-stu-id="5aca0-110">In this configuration, the Azure Multi-Factor Authentication Server accepts LDAP requests from client servers and applications and forwards them to the target LDAP directory server to validate the primary credentials.</span></span> <span data-ttu-id="5aca0-111">如果 LDAP 目錄認為主要認證有效，Azure Multi-Factor Authentication 會執行第二步身分識別驗證，然後將回應傳回給 LDAP 用戶端。</span><span class="sxs-lookup"><span data-stu-id="5aca0-111">If the LDAP directory validates the primary credentials, Azure Multi-Factor Authentication performs a second identity verification and sends a response back to the LDAP client.</span></span> <span data-ttu-id="5aca0-112">只有在 LDAP 伺服器驗證和第二步驗證皆成功時，整個驗證才會成功。</span><span class="sxs-lookup"><span data-stu-id="5aca0-112">The entire authentication succeeds only if both the LDAP server authentication and the second-step verification succeed.</span></span>

## <a name="configure-ldap-authentication"></a><span data-ttu-id="5aca0-113">設定 LDAP 驗證</span><span class="sxs-lookup"><span data-stu-id="5aca0-113">Configure LDAP authentication</span></span>
<span data-ttu-id="5aca0-114">若要設定 LDAP 驗證，請在 Windows 伺服器上安裝 Azure Multi-Factor Authentication Server。</span><span class="sxs-lookup"><span data-stu-id="5aca0-114">To configure LDAP authentication, install the Azure Multi-Factor Authentication Server on a Windows server.</span></span> <span data-ttu-id="5aca0-115">請使用下列程序：</span><span class="sxs-lookup"><span data-stu-id="5aca0-115">Use the following procedure:</span></span>

### <a name="add-an-ldap-client"></a><span data-ttu-id="5aca0-116">新增 LDAP 用戶端</span><span class="sxs-lookup"><span data-stu-id="5aca0-116">Add an LDAP client</span></span>

1. <span data-ttu-id="5aca0-117">在 Azure Multi-Factor Authentication Server 中，選取左功能表中的 [LDAP 驗證] 圖示。</span><span class="sxs-lookup"><span data-stu-id="5aca0-117">In the Azure Multi-Factor Authentication Server, select the LDAP Authentication icon in the left menu.</span></span>
2. <span data-ttu-id="5aca0-118">核取 [啟用 LDAP 驗證] 核取方塊。</span><span class="sxs-lookup"><span data-stu-id="5aca0-118">Check the **Enable LDAP Authentication** checkbox.</span></span>

   ![LDAP 驗證](./media/multi-factor-authentication-get-started-server-ldap/ldap2.png)

3. <span data-ttu-id="5aca0-120">如果 Azure Multi-Factor Authentication LDAP 服務應該繫結到非標準連接埠，以接聽 LDAP 要求，請在 [用戶端] 索引標籤上變更 TCP 連接埠和 SSL 連接埠。</span><span class="sxs-lookup"><span data-stu-id="5aca0-120">On the Clients tab, change the TCP port and SSL port if the Azure Multi-Factor Authentication LDAP service should bind to non-standard ports to listen for LDAP requests.</span></span>
4. <span data-ttu-id="5aca0-121">如果您打算在用戶端到 Azure Multi-Factor Authentication Server 之間使用 LDAPS，則必須將 SSL 憑證安裝在與 MFA 伺服器相同的伺服器上。</span><span class="sxs-lookup"><span data-stu-id="5aca0-121">If you plan to use LDAPS from the client to the Azure Multi-Factor Authentication Server, an SSL certificate must be installed on the same server as MFA Server.</span></span> <span data-ttu-id="5aca0-122">按一下 [SSL 憑證] 方塊旁的 [瀏覽]，然後選取要用於安全連線的憑證。</span><span class="sxs-lookup"><span data-stu-id="5aca0-122">Click **Browse** next to the SSL certificate box, and select a certificate to use for the secure connection.</span></span>
5. <span data-ttu-id="5aca0-123">按一下 [新增] 。</span><span class="sxs-lookup"><span data-stu-id="5aca0-123">Click **Add**.</span></span>
6. <span data-ttu-id="5aca0-124">在 [新增 LDAP 用戶端] 對話方塊中，輸入要向「伺服器」驗證的應用裝置、伺服器或應用程式的 IP 位址，以及應用程式名稱 (選擇性)。</span><span class="sxs-lookup"><span data-stu-id="5aca0-124">In the Add LDAP Client dialog box, enter the IP address of the appliance, server, or application that authenticates to the Server and an Application name (optional).</span></span> <span data-ttu-id="5aca0-125">應用程式名稱會出現在 Azure Multi-Factor Authentication 報表中，而且可能顯示在簡訊或行動應用程式驗證訊息內。</span><span class="sxs-lookup"><span data-stu-id="5aca0-125">The Application name appears in Azure Multi-Factor Authentication reports and may be displayed within SMS or Mobile App authentication messages.</span></span>
7. <span data-ttu-id="5aca0-126">如果所有使用者都已經或將要匯入到「伺服器」，且必須接受雙步驟驗證，請核取 [需要進行 Azure Multi-Factor Authentication 使用者比對] 方塊。</span><span class="sxs-lookup"><span data-stu-id="5aca0-126">Check the **Require Azure Multi-Factor Authentication user match** box if all users have been or will be imported into the Server and subject to two-step verification.</span></span> <span data-ttu-id="5aca0-127">如果有大量使用者尚未匯入伺服器及/或將免除雙步驟驗證，請勿核取此方塊。</span><span class="sxs-lookup"><span data-stu-id="5aca0-127">If a significant number of users have not yet been imported into the Server and/or are exempt from two-step verification, leave the box unchecked.</span></span> <span data-ttu-id="5aca0-128">如需此功能的其他資訊，請參閱 MFA 伺服器說明檔。</span><span class="sxs-lookup"><span data-stu-id="5aca0-128">See the MFA Server help file for additional information on this feature.</span></span>

<span data-ttu-id="5aca0-129">重複上述步驟來新增其他 LDAP 用戶端。</span><span class="sxs-lookup"><span data-stu-id="5aca0-129">Repeat these steps to add additional LDAP clients.</span></span>

### <a name="configure-the-ldap-directory-connection"></a><span data-ttu-id="5aca0-130">設定 LDAP 目錄連線</span><span class="sxs-lookup"><span data-stu-id="5aca0-130">Configure the LDAP directory connection</span></span>

<span data-ttu-id="5aca0-131">當 Azure Multi-Factor Authentication 設定為接受 LDAP 驗證時，它必須將這些驗證交由 LDAP 目錄代理。</span><span class="sxs-lookup"><span data-stu-id="5aca0-131">When the Azure Multi-Factor Authentication is configured to receive LDAP authentications, it must proxy those authentications to the LDAP directory.</span></span> <span data-ttu-id="5aca0-132">因此，[目標] 索引標籤只會顯示灰色的單一選項來使用 LDAP 目標。</span><span class="sxs-lookup"><span data-stu-id="5aca0-132">Therefore, the Target tab only displays a single, grayed out option to use an LDAP target.</span></span>

1. <span data-ttu-id="5aca0-133">若要設定 LDAP 目錄連線，請按一下 [目錄整合] 圖示。</span><span class="sxs-lookup"><span data-stu-id="5aca0-133">To configure the LDAP directory connection, click the **Directory Integration** icon.</span></span>
2. <span data-ttu-id="5aca0-134">在 [設定] 索引標籤上，選取 [使用特定 LDAP 設定] 選項按鈕。</span><span class="sxs-lookup"><span data-stu-id="5aca0-134">On the Settings tab, select the **Use specific LDAP configuration** radio button.</span></span>
3. <span data-ttu-id="5aca0-135">選取 [編輯...]</span><span class="sxs-lookup"><span data-stu-id="5aca0-135">Select **Edit…**</span></span>
4. <span data-ttu-id="5aca0-136">在 [編輯 LDAP 設定] 對話方塊的欄位中，填入連接到 AD 目錄所需的資訊。</span><span class="sxs-lookup"><span data-stu-id="5aca0-136">In the Edit LDAP Configuration dialog box, populate the fields with the information required to connect to the LDAP directory.</span></span> <span data-ttu-id="5aca0-137">欄位說明包含在 Azure Multi-Factor Authentication Server 說明檔中。</span><span class="sxs-lookup"><span data-stu-id="5aca0-137">Descriptions of the fields are included in the Azure Multi-Factor Authentication Server help file.</span></span>

    ![目錄整合](./media/multi-factor-authentication-get-started-server-ldap/ldap.png)

5. <span data-ttu-id="5aca0-139">按一下 [測試] 按鈕來測試 LDAP 連接。</span><span class="sxs-lookup"><span data-stu-id="5aca0-139">Test the LDAP connection by clicking the **Test** button.</span></span>
6. <span data-ttu-id="5aca0-140">如果 LDAP 連接測試成功，請按一下 [確定] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="5aca0-140">If the LDAP connection test was successful, click the **OK** button.</span></span>
7. <span data-ttu-id="5aca0-141">按一下 [篩選] 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="5aca0-141">Click the **Filters** tab.</span></span> <span data-ttu-id="5aca0-142">「伺服器」已預先設定為從 Active Directory 載入容器、安全性群組和使用者。</span><span class="sxs-lookup"><span data-stu-id="5aca0-142">The Server is pre-configured to load containers, security groups, and users from Active Directory.</span></span> <span data-ttu-id="5aca0-143">如果繫結至不同 LDAP 目錄，您可能需要編輯顯示的篩選。</span><span class="sxs-lookup"><span data-stu-id="5aca0-143">If binding to a different LDAP directory, you probably need to edit the filters displayed.</span></span> <span data-ttu-id="5aca0-144">如需篩選的詳細資訊，請按一下 [說明] 連結。</span><span class="sxs-lookup"><span data-stu-id="5aca0-144">Click the **Help** link for more information on filters.</span></span>
8. <span data-ttu-id="5aca0-145">按一下 [屬性]  索引標籤。</span><span class="sxs-lookup"><span data-stu-id="5aca0-145">Click the **Attributes** tab.</span></span> <span data-ttu-id="5aca0-146">「伺服器」已預先設定為從 Active Directory 對應屬性。</span><span class="sxs-lookup"><span data-stu-id="5aca0-146">The Server is pre-configured to map attributes from Active Directory.</span></span>
9. <span data-ttu-id="5aca0-147">如果要繫結至不同 LDAP 目錄，或要變更預先設定的屬性對應，請按一下 [編輯...]</span><span class="sxs-lookup"><span data-stu-id="5aca0-147">If you're binding to a different LDAP directory or to change the pre-configured attribute mappings, click **Edit…**</span></span>
10. <span data-ttu-id="5aca0-148">在 [編輯屬性] 對話方塊中，修改您的目錄的 LDAP 屬性對應。</span><span class="sxs-lookup"><span data-stu-id="5aca0-148">In the Edit Attributes dialog box, modify the LDAP attribute mappings for your directory.</span></span> <span data-ttu-id="5aca0-149">您可以輸入屬性名稱，或按一下每個欄位旁邊的 [...]</span><span class="sxs-lookup"><span data-stu-id="5aca0-149">Attribute names can be typed in or selected by clicking the **…**</span></span> <span data-ttu-id="5aca0-150">按鈕來選取。</span><span class="sxs-lookup"><span data-stu-id="5aca0-150">button next to each field.</span></span> <span data-ttu-id="5aca0-151">如需屬性的詳細資訊，請按一下 [說明] 連結。</span><span class="sxs-lookup"><span data-stu-id="5aca0-151">Click the **Help** link for more information on attributes.</span></span>
11. <span data-ttu-id="5aca0-152">按一下 [確定] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="5aca0-152">Click the **OK** button.</span></span>
12. <span data-ttu-id="5aca0-153">按一下 [公司設定] 圖示，然後選取 [使用者名稱解析] 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="5aca0-153">Click the **Company Settings** icon and select the **Username Resolution** tab.</span></span>
13. <span data-ttu-id="5aca0-154">如果要從加入網域的伺服器連線到 Active Directory，請將 [使用 Windows 安全性識別碼 (SID) 來比對使用者名稱] 選項按鈕保持選取狀態。</span><span class="sxs-lookup"><span data-stu-id="5aca0-154">If you're connecting to Active Directory from a domain-joined server, leave the **Use Windows security identifiers (SIDs) for matching usernames** radio button selected.</span></span> <span data-ttu-id="5aca0-155">否則，請選取 [使用 LDAP 唯一識別碼屬性來比對使用者名稱] 選項按鈕。</span><span class="sxs-lookup"><span data-stu-id="5aca0-155">Otherwise, select the **Use LDAP unique identifier attribute for matching usernames** radio button.</span></span> 

<span data-ttu-id="5aca0-156">已選取 [使用 LDAP 唯一識別碼屬性來比對使用者名稱] 選項按鈕時，Azure Multi-factor Authentication Server 會嘗試將每個使用者名稱解析為 LDAP 目錄中的唯一識別碼。</span><span class="sxs-lookup"><span data-stu-id="5aca0-156">When the **Use LDAP unique identifier attribute for matching usernames** radio button is selected, the Azure Multi-Factor Authentication Server attempts to resolve each username to a unique identifier in the LDAP directory.</span></span> <span data-ttu-id="5aca0-157">將會對 [目錄整合] -> [屬性] 索引標籤中定義的使用者名稱屬性執行 LDAP 搜尋。</span><span class="sxs-lookup"><span data-stu-id="5aca0-157">An LDAP search is performed on the Username attributes defined in the Directory Integration -> Attributes tab.</span></span> <span data-ttu-id="5aca0-158">當使用者進行驗證時，使用者名稱會解析為 LDAP 目錄中的唯一識別碼。</span><span class="sxs-lookup"><span data-stu-id="5aca0-158">When a user authenticates, the username is resolved to the unique identifier in the LDAP directory.</span></span> <span data-ttu-id="5aca0-159">唯一識別碼可用來比對 Azure Multi-Factor Authentication 資料檔中的使用者。</span><span class="sxs-lookup"><span data-stu-id="5aca0-159">The unique identifier is used for matching the user in the Azure Multi-Factor Authentication data file.</span></span> <span data-ttu-id="5aca0-160">這可進行不區分大小寫的比較，且允許完整或簡短的使用者名稱格式。</span><span class="sxs-lookup"><span data-stu-id="5aca0-160">This allows for case-insensitive comparisons, and long and short username formats.</span></span>

<span data-ttu-id="5aca0-161">在完成這些步驟後，MFA Server 會在設定的連接埠上接聽來自所設定用戶端的 LDAP 存取要求，並且會作為 Proxy 將這些要求交由 LDAP 目錄進行驗證。</span><span class="sxs-lookup"><span data-stu-id="5aca0-161">After you complete these steps, the MFA Server listens on the configured ports for LDAP access requests from the configured clients, and acts as a proxy for those requests to the LDAP directory for authentication.</span></span>

## <a name="configure-ldap-client"></a><span data-ttu-id="5aca0-162">設定 LDAP 用戶端</span><span class="sxs-lookup"><span data-stu-id="5aca0-162">Configure LDAP client</span></span>
<span data-ttu-id="5aca0-163">若要設定 LDAP 用戶端，請遵循下列指導方針：</span><span class="sxs-lookup"><span data-stu-id="5aca0-163">To configure the LDAP client, use the guidelines:</span></span>

* <span data-ttu-id="5aca0-164">將您的應用裝置、伺服器或應用程式設定為透過 LDAP 向 Azure Multi-Factor Authentication Server 驗證，就好像您的 LDAP 目錄一樣。</span><span class="sxs-lookup"><span data-stu-id="5aca0-164">Configure your appliance, server, or application to authenticate via LDAP to the Azure Multi-Factor Authentication Server as though it were your LDAP directory.</span></span> <span data-ttu-id="5aca0-165">使用您平常直接連接到您的 LDAP 目錄時所用的相同設定，唯一的差別是使用 Azure Multi-Factor Authentication Server 的伺服器名稱或 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="5aca0-165">Use the same settings that you would normally use to connect directly to your LDAP directory, except for the server name or IP address, which will be that of the Azure Multi-Factor Authentication Server.</span></span>
* <span data-ttu-id="5aca0-166">將 LDAP 逾時設定為 30 至 60 秒，以保留足夠的時間向 LDAP 目錄驗證使用者的認證、執行第二步驗證、接收回應，然後回應 LDAP 存取要求。</span><span class="sxs-lookup"><span data-stu-id="5aca0-166">Configure the LDAP timeout to 30-60 seconds so that there is time to validate the user’s credentials with the LDAP directory, perform the second-step verification, receive their response, and respond to the LDAP access request.</span></span>
* <span data-ttu-id="5aca0-167">如果使用 LDAPS，則提出 LDAP 查詢的應用裝置或伺服器必須信任安裝在 Azure Multi-Factor Authentication Server 上的 SSL 憑證。</span><span class="sxs-lookup"><span data-stu-id="5aca0-167">If using LDAPS, the appliance or server making the LDAP queries must trust the SSL certificate installed on the Azure Multi-Factor Authentication Server.</span></span>

