---
title: "aaaLDAP 驗證和 Azure MFA Server |Microsoft 文件"
description: "這是可協助您部署 LDAP 驗證和 Azure Multi-factor Authentication Server 的 hello Azure 多因素驗證頁面。"
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: e1a68568-53d1-4365-9e41-50925ad00869
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/03/2017
ms.author: kgremban
ms.openlocfilehash: 17a26b57dbf6afa2fcfdb3d19c5b5ba2987a9f79
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="ldap-authentication-and-azure-multi-factor-authentication-server"></a><span data-ttu-id="6d35c-103">LDAP 驗證和 Azure Multi-Factor Authentication Server</span><span class="sxs-lookup"><span data-stu-id="6d35c-103">LDAP authentication and Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="6d35c-104">根據預設，hello Azure Multi-factor Authentication Server 設定的 tooimport 或從 Active Directory 同步處理使用者。</span><span class="sxs-lookup"><span data-stu-id="6d35c-104">By default, hello Azure Multi-Factor Authentication Server is configured tooimport or synchronize users from Active Directory.</span></span> <span data-ttu-id="6d35c-105">不過，它可以設定的 toobind toodifferent LDAP 目錄，例如 ADAM 目錄或特定 Active Directory 網域控制站。</span><span class="sxs-lookup"><span data-stu-id="6d35c-105">However, it can be configured toobind toodifferent LDAP directories, such as an ADAM directory, or specific Active Directory domain controller.</span></span> <span data-ttu-id="6d35c-106">當透過 LDAP 連線的 tooa 目錄，hello Azure Multi-factor Authentication Server 可做為 LDAP proxy tooperform 驗證。</span><span class="sxs-lookup"><span data-stu-id="6d35c-106">When connected tooa directory via LDAP, hello Azure Multi-Factor Authentication Server can act as an LDAP proxy tooperform authentications.</span></span> <span data-ttu-id="6d35c-107">它也允許 hello 使用 LDAP 繫結作為 RADIUS 目標，預先驗證與 IIS 驗證的使用者或 hello Azure MFA 使用者入口網站中的主要驗證。</span><span class="sxs-lookup"><span data-stu-id="6d35c-107">It also allows for hello use of LDAP bind as a RADIUS target, for pre-authentication of users with IIS Authentication, or for primary authentication in hello Azure MFA user portal.</span></span>

<span data-ttu-id="6d35c-108">Azure Multi-factor Authentication 作為 LDAP proxy、 toouse 插入 hello LDAP 用戶端 （例如 VPN 應用裝置、 應用程式） 與 hello LDAP 目錄伺服器之間的 hello Azure Multi-factor Authentication Server。</span><span class="sxs-lookup"><span data-stu-id="6d35c-108">toouse Azure Multi-Factor Authentication as an LDAP proxy, insert hello Azure Multi-Factor Authentication Server between hello LDAP client (for example, VPN appliance, application) and hello LDAP directory server.</span></span> <span data-ttu-id="6d35c-109">hello Azure Multi-factor Authentication Server 必須已設定的 toocommunicate hello 用戶端伺服器和 hello LDAP 目錄。</span><span class="sxs-lookup"><span data-stu-id="6d35c-109">hello Azure Multi-Factor Authentication Server must be configured toocommunicate with both hello client servers and hello LDAP directory.</span></span> <span data-ttu-id="6d35c-110">此設定會 hello Azure Multi-factor Authentication Server 會接受來自用戶端伺服器及應用程式的 LDAP 要求，並轉送 toohello 目標 LDAP 目錄伺服器 toovalidate hello 主要認證。</span><span class="sxs-lookup"><span data-stu-id="6d35c-110">In this configuration, hello Azure Multi-Factor Authentication Server accepts LDAP requests from client servers and applications and forwards them toohello target LDAP directory server toovalidate hello primary credentials.</span></span> <span data-ttu-id="6d35c-111">如果 hello LDAP 目錄驗證主要認證的 hello，Azure Multi-factor Authentication Server 會執行第二個的身分識別驗證，並傳送回應後 toohello LDAP 用戶端。</span><span class="sxs-lookup"><span data-stu-id="6d35c-111">If hello LDAP directory validates hello primary credentials, Azure Multi-Factor Authentication performs a second identity verification and sends a response back toohello LDAP client.</span></span> <span data-ttu-id="6d35c-112">只有當 hello LDAP 伺服器驗證和 hello 第二個步驟驗證成功，hello，整個驗證會成功。</span><span class="sxs-lookup"><span data-stu-id="6d35c-112">hello entire authentication succeeds only if both hello LDAP server authentication and hello second-step verification succeed.</span></span>

## <a name="configure-ldap-authentication"></a><span data-ttu-id="6d35c-113">設定 LDAP 驗證</span><span class="sxs-lookup"><span data-stu-id="6d35c-113">Configure LDAP authentication</span></span>
<span data-ttu-id="6d35c-114">Windows server 上安裝 hello Azure Multi-factor Authentication Server tooconfigure LDAP 驗證。</span><span class="sxs-lookup"><span data-stu-id="6d35c-114">tooconfigure LDAP authentication, install hello Azure Multi-Factor Authentication Server on a Windows server.</span></span> <span data-ttu-id="6d35c-115">使用下列程序的 hello:</span><span class="sxs-lookup"><span data-stu-id="6d35c-115">Use hello following procedure:</span></span>

### <a name="add-an-ldap-client"></a><span data-ttu-id="6d35c-116">新增 LDAP 用戶端</span><span class="sxs-lookup"><span data-stu-id="6d35c-116">Add an LDAP client</span></span>

1. <span data-ttu-id="6d35c-117">在 hello Azure Multi-factor Authentication Server，選取左窗格中 hello hello [LDAP 驗證] 圖示。</span><span class="sxs-lookup"><span data-stu-id="6d35c-117">In hello Azure Multi-Factor Authentication Server, select hello LDAP Authentication icon in hello left menu.</span></span>
2. <span data-ttu-id="6d35c-118">檢查 hello**啟用 LDAP 驗證**核取方塊。</span><span class="sxs-lookup"><span data-stu-id="6d35c-118">Check hello **Enable LDAP Authentication** checkbox.</span></span>

   ![LDAP 驗證](./media/multi-factor-authentication-get-started-server-ldap/ldap2.png)

3. <span data-ttu-id="6d35c-120">Hello 用戶端 索引標籤上變更 hello TCP 連接埠和 SSL 連接埠如果 hello Azure Multi-factor Authentication LDAP 服務應繫結 toonon 標準連接埠 toolisten LDAP 要求。</span><span class="sxs-lookup"><span data-stu-id="6d35c-120">On hello Clients tab, change hello TCP port and SSL port if hello Azure Multi-Factor Authentication LDAP service should bind toonon-standard ports toolisten for LDAP requests.</span></span>
4. <span data-ttu-id="6d35c-121">如果您計畫從 hello Azure Multi-factor Authentication Server 的用戶端 toohello toouse LDAPS，SSL 憑證必須安裝在 hello 與 MFA Server 相同的伺服器。</span><span class="sxs-lookup"><span data-stu-id="6d35c-121">If you plan toouse LDAPS from hello client toohello Azure Multi-Factor Authentication Server, an SSL certificate must be installed on hello same server as MFA Server.</span></span> <span data-ttu-id="6d35c-122">按一下**瀏覽**下一步 toohello SSL 憑證 方塊中，然後選取憑證 toouse hello 安全的連接。</span><span class="sxs-lookup"><span data-stu-id="6d35c-122">Click **Browse** next toohello SSL certificate box, and select a certificate toouse for hello secure connection.</span></span>
5. <span data-ttu-id="6d35c-123">按一下 [新增] 。</span><span class="sxs-lookup"><span data-stu-id="6d35c-123">Click **Add**.</span></span>
6. <span data-ttu-id="6d35c-124">在 hello [新增 LDAP 用戶端] 對話方塊中，輸入 hello 的 hello 應用裝置、 伺服器或驗證 toohello 伺服器和應用程式名稱 （選用） 的應用程式的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6d35c-124">In hello Add LDAP Client dialog box, enter hello IP address of hello appliance, server, or application that authenticates toohello Server and an Application name (optional).</span></span> <span data-ttu-id="6d35c-125">hello 應用程式名稱會出現在 Azure Multi-factor Authentication 報告，並可能會顯示在簡訊或行動裝置應用程式驗證訊息內。</span><span class="sxs-lookup"><span data-stu-id="6d35c-125">hello Application name appears in Azure Multi-Factor Authentication reports and may be displayed within SMS or Mobile App authentication messages.</span></span>
7. <span data-ttu-id="6d35c-126">檢查 hello**需要 Azure Multi-factor Authentication 使用者比對**方塊如果所有使用者，或者將匯入伺服器 hello 和主旨 tootwo 步驟驗證。</span><span class="sxs-lookup"><span data-stu-id="6d35c-126">Check hello **Require Azure Multi-Factor Authentication user match** box if all users have been or will be imported into hello Server and subject tootwo-step verification.</span></span> <span data-ttu-id="6d35c-127">如果大量使用者尚未匯入伺服器 hello 和/或豁免雙步驟驗證，請不要 hello 方塊中選取。</span><span class="sxs-lookup"><span data-stu-id="6d35c-127">If a significant number of users have not yet been imported into hello Server and/or are exempt from two-step verification, leave hello box unchecked.</span></span> <span data-ttu-id="6d35c-128">這項功能，請參閱 hello MFA Server 說明檔以取得其他資訊。</span><span class="sxs-lookup"><span data-stu-id="6d35c-128">See hello MFA Server help file for additional information on this feature.</span></span>

<span data-ttu-id="6d35c-129">重複這些步驟 tooadd 其他 LDAP 用戶端。</span><span class="sxs-lookup"><span data-stu-id="6d35c-129">Repeat these steps tooadd additional LDAP clients.</span></span>

### <a name="configure-hello-ldap-directory-connection"></a><span data-ttu-id="6d35c-130">設定 hello LDAP 目錄連線</span><span class="sxs-lookup"><span data-stu-id="6d35c-130">Configure hello LDAP directory connection</span></span>

<span data-ttu-id="6d35c-131">Hello Azure 多重要素驗證時設定的 tooreceive LDAP 驗證，則必須將這些驗證 toohello LDAP 目錄。</span><span class="sxs-lookup"><span data-stu-id="6d35c-131">When hello Azure Multi-Factor Authentication is configured tooreceive LDAP authentications, it must proxy those authentications toohello LDAP directory.</span></span> <span data-ttu-id="6d35c-132">因此，hello 目標 索引標籤只會顯示單一灰色選項 toouse LDAP 目標。</span><span class="sxs-lookup"><span data-stu-id="6d35c-132">Therefore, hello Target tab only displays a single, grayed out option toouse an LDAP target.</span></span>

1. <span data-ttu-id="6d35c-133">tooconfigure hello LDAP 目錄連線，按一下 hello**目錄整合**圖示。</span><span class="sxs-lookup"><span data-stu-id="6d35c-133">tooconfigure hello LDAP directory connection, click hello **Directory Integration** icon.</span></span>
2. <span data-ttu-id="6d35c-134">在 hello 設定 索引標籤上選取 hello**使用特定 LDAP 設定**選項按鈕。</span><span class="sxs-lookup"><span data-stu-id="6d35c-134">On hello Settings tab, select hello **Use specific LDAP configuration** radio button.</span></span>
3. <span data-ttu-id="6d35c-135">選取 [編輯...]</span><span class="sxs-lookup"><span data-stu-id="6d35c-135">Select **Edit…**</span></span>
4. <span data-ttu-id="6d35c-136">在 hello [編輯 LDAP 組態] 對話方塊中，填入 hello 欄位 hello 所需的資訊 tooconnect toohello LDAP 目錄。</span><span class="sxs-lookup"><span data-stu-id="6d35c-136">In hello Edit LDAP Configuration dialog box, populate hello fields with hello information required tooconnect toohello LDAP directory.</span></span> <span data-ttu-id="6d35c-137">Hello 欄位的說明包含在 hello Azure Multi-factor Authentication Server 說明檔。</span><span class="sxs-lookup"><span data-stu-id="6d35c-137">Descriptions of hello fields are included in hello Azure Multi-Factor Authentication Server help file.</span></span>

    ![目錄整合](./media/multi-factor-authentication-get-started-server-ldap/ldap.png)

5. <span data-ttu-id="6d35c-139">按一下 hello 測試 hello LDAP 連線**測試** 按鈕。</span><span class="sxs-lookup"><span data-stu-id="6d35c-139">Test hello LDAP connection by clicking hello **Test** button.</span></span>
6. <span data-ttu-id="6d35c-140">如果 hello LDAP 連線測試成功，請按一下 hello**確定** 按鈕。</span><span class="sxs-lookup"><span data-stu-id="6d35c-140">If hello LDAP connection test was successful, click hello **OK** button.</span></span>
7. <span data-ttu-id="6d35c-141">按一下 hello**篩選** 索引標籤 hello 伺服器已預先設定的 tooload 容器、 安全性群組和使用者從 Active Directory。</span><span class="sxs-lookup"><span data-stu-id="6d35c-141">Click hello **Filters** tab. hello Server is pre-configured tooload containers, security groups, and users from Active Directory.</span></span> <span data-ttu-id="6d35c-142">如果繫結 tooa 不同的 LDAP 目錄，您可能需要顯示 tooedit hello 篩選器。</span><span class="sxs-lookup"><span data-stu-id="6d35c-142">If binding tooa different LDAP directory, you probably need tooedit hello filters displayed.</span></span> <span data-ttu-id="6d35c-143">按一下 hello**協助**如需篩選的詳細資訊的連結。</span><span class="sxs-lookup"><span data-stu-id="6d35c-143">Click hello **Help** link for more information on filters.</span></span>
8. <span data-ttu-id="6d35c-144">按一下 hello**屬性** 索引標籤 hello 伺服器是 Active Directory 中的預先設定的 toomap 屬性。</span><span class="sxs-lookup"><span data-stu-id="6d35c-144">Click hello **Attributes** tab. hello Server is pre-configured toomap attributes from Active Directory.</span></span>
9. <span data-ttu-id="6d35c-145">如果您要繫結 tooa 不同 LDAP 目錄或 toochange hello 預先設定的屬性對應，按一下**編輯...**</span><span class="sxs-lookup"><span data-stu-id="6d35c-145">If you're binding tooa different LDAP directory or toochange hello pre-configured attribute mappings, click **Edit…**</span></span>
10. <span data-ttu-id="6d35c-146">在 hello [編輯屬性] 對話方塊中，修改您的目錄 hello LDAP 屬性對應。</span><span class="sxs-lookup"><span data-stu-id="6d35c-146">In hello Edit Attributes dialog box, modify hello LDAP attribute mappings for your directory.</span></span> <span data-ttu-id="6d35c-147">屬性名稱可以輸入或選取按一下 hello **...**</span><span class="sxs-lookup"><span data-stu-id="6d35c-147">Attribute names can be typed in or selected by clicking hello **…**</span></span> <span data-ttu-id="6d35c-148">下一個 tooeach 欄位按鈕。</span><span class="sxs-lookup"><span data-stu-id="6d35c-148">button next tooeach field.</span></span> <span data-ttu-id="6d35c-149">按一下 hello**協助**屬性的詳細資訊的連結。</span><span class="sxs-lookup"><span data-stu-id="6d35c-149">Click hello **Help** link for more information on attributes.</span></span>
11. <span data-ttu-id="6d35c-150">按一下 hello**確定** 按鈕。</span><span class="sxs-lookup"><span data-stu-id="6d35c-150">Click hello **OK** button.</span></span>
12. <span data-ttu-id="6d35c-151">按一下 hello**公司設定**圖示，然後選取 hello**使用者名稱解析** 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="6d35c-151">Click hello **Company Settings** icon and select hello **Username Resolution** tab.</span></span>
13. <span data-ttu-id="6d35c-152">如果您正在從已加入網域的伺服器連接 tooActive 目錄，將保留 hello**使用 Windows 安全性識別碼 (Sid) 比對使用者名稱**選取選項按鈕。</span><span class="sxs-lookup"><span data-stu-id="6d35c-152">If you're connecting tooActive Directory from a domain-joined server, leave hello **Use Windows security identifiers (SIDs) for matching usernames** radio button selected.</span></span> <span data-ttu-id="6d35c-153">否則，請選取 hello**使用 LDAP 唯一識別碼屬性比對使用者名稱**選項按鈕。</span><span class="sxs-lookup"><span data-stu-id="6d35c-153">Otherwise, select hello **Use LDAP unique identifier attribute for matching usernames** radio button.</span></span> 

<span data-ttu-id="6d35c-154">當 hello**使用 LDAP 唯一識別碼屬性比對使用者名稱**選取選項按鈕，hello Azure Multi-factor Authentication Server 會嘗試 tooresolve 每個使用者名稱 tooa 唯一識別碼 hello LDAP 目錄中的。</span><span class="sxs-lookup"><span data-stu-id="6d35c-154">When hello **Use LDAP unique identifier attribute for matching usernames** radio button is selected, hello Azure Multi-Factor Authentication Server attempts tooresolve each username tooa unique identifier in hello LDAP directory.</span></span> <span data-ttu-id="6d35c-155">在執行 LDAP 搜尋上 hello Username 屬性定義在 hello 目錄整合-> 屬性 索引標籤。使用者驗證時，hello 使用者名稱時解析的 toohello hello LDAP 目錄中的唯一識別碼。</span><span class="sxs-lookup"><span data-stu-id="6d35c-155">An LDAP search is performed on hello Username attributes defined in hello Directory Integration -> Attributes tab. When a user authenticates, hello username is resolved toohello unique identifier in hello LDAP directory.</span></span> <span data-ttu-id="6d35c-156">hello 唯一識別項用於比對 hello Azure Multi-factor Authentication 資料檔中的 hello 使用者。</span><span class="sxs-lookup"><span data-stu-id="6d35c-156">hello unique identifier is used for matching hello user in hello Azure Multi-Factor Authentication data file.</span></span> <span data-ttu-id="6d35c-157">這可進行不區分大小寫的比較，且允許完整或簡短的使用者名稱格式。</span><span class="sxs-lookup"><span data-stu-id="6d35c-157">This allows for case-insensitive comparisons, and long and short username formats.</span></span>

<span data-ttu-id="6d35c-158">完成這些步驟之後，hello MFA Server 會接聽 hello 的 LDAP 存取要求的 hello 設定連接埠上設定用戶端，以及做為 proxy 的那些要求 toohello LDAP 目錄進行驗證。</span><span class="sxs-lookup"><span data-stu-id="6d35c-158">After you complete these steps, hello MFA Server listens on hello configured ports for LDAP access requests from hello configured clients, and acts as a proxy for those requests toohello LDAP directory for authentication.</span></span>

## <a name="configure-ldap-client"></a><span data-ttu-id="6d35c-159">設定 LDAP 用戶端</span><span class="sxs-lookup"><span data-stu-id="6d35c-159">Configure LDAP client</span></span>
<span data-ttu-id="6d35c-160">tooconfigure hello LDAP 用戶端，使用 hello 指導方針：</span><span class="sxs-lookup"><span data-stu-id="6d35c-160">tooconfigure hello LDAP client, use hello guidelines:</span></span>

* <span data-ttu-id="6d35c-161">設定您的應用裝置、 伺服器或應用程式 tooauthenticate 透過 LDAP toohello Azure Multi-factor Authentication Server，就好像是 LDAP 目錄。</span><span class="sxs-lookup"><span data-stu-id="6d35c-161">Configure your appliance, server, or application tooauthenticate via LDAP toohello Azure Multi-Factor Authentication Server as though it were your LDAP directory.</span></span> <span data-ttu-id="6d35c-162">使用 hello 相同設定，您通常會使用 tooconnect 直接 tooyour LDAP 目錄中的，除了 hello 伺服器名稱或 IP 位址，應採用 hello Azure Multi-factor Authentication Server。</span><span class="sxs-lookup"><span data-stu-id="6d35c-162">Use hello same settings that you would normally use tooconnect directly tooyour LDAP directory, except for hello server name or IP address, which will be that of hello Azure Multi-Factor Authentication Server.</span></span>
* <span data-ttu-id="6d35c-163">設定 hello LDAP 逾時 too30 60 秒，以便有時間 toovalidate hello 使用者的認證與 hello LDAP 目錄、 執行 hello 第二個步驟的驗證、 接收其回應，以及回應 toohello LDAP 存取要求。</span><span class="sxs-lookup"><span data-stu-id="6d35c-163">Configure hello LDAP timeout too30-60 seconds so that there is time toovalidate hello user’s credentials with hello LDAP directory, perform hello second-step verification, receive their response, and respond toohello LDAP access request.</span></span>
* <span data-ttu-id="6d35c-164">如果使用 LDAPS，hello 應用裝置或 hello，LDAP 查詢的伺服器必須信任 hello hello Azure Multi-factor Authentication Server 上安裝的 SSL 憑證。</span><span class="sxs-lookup"><span data-stu-id="6d35c-164">If using LDAPS, hello appliance or server making hello LDAP queries must trust hello SSL certificate installed on hello Azure Multi-Factor Authentication Server.</span></span>

