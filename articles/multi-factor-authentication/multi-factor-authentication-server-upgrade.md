---
title: "Azure MFA Server 升級 | Microsoft Docs"
description: "將 Azure Multi-Factor Authentication Server 升級為較新版本的步驟和指引。"
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 50bb8ac3-5559-4d8b-a96a-799a74978b14
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: 6e4e09f8539aad56f92ad9137f4a6b9eb0d82370
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="upgrade-to-the-latest-azure-multi-factor-authentication-server"></a><span data-ttu-id="ab909-103">升級為最新的 Azure Multi-Factor Authentication Server</span><span class="sxs-lookup"><span data-stu-id="ab909-103">Upgrade to the latest Azure Multi-Factor Authentication Server</span></span>

<span data-ttu-id="ab909-104">本文將逐步引導您完成升級 Azure Multi-Factor Authentication (MFA) Server v6.0 或更新版本的程序。</span><span class="sxs-lookup"><span data-stu-id="ab909-104">This article walks you through the process of upgrading Azure Multi-Factor Authentication (MFA) Server v6.0 or higher.</span></span> <span data-ttu-id="ab909-105">如果您需要升級舊版的 PhoneFactor Agent，請參閱[將 PhoneFactor Agent 升級為 Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md)。</span><span class="sxs-lookup"><span data-stu-id="ab909-105">If you need to upgrade an old version of the PhoneFactor Agent, refer to [Upgrade the PhoneFactor Agent to Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md).</span></span>

<span data-ttu-id="ab909-106">如果您要從 v6.x 或更舊版本升級為 v7.x 或更新版本，所有元件都會從 .NET 2.0 變更為 .NET 4.5。</span><span class="sxs-lookup"><span data-stu-id="ab909-106">If you're upgrading from v6.x or older to v7.x or newer, all components change from .NET 2.0 to .NET 4.5.</span></span> <span data-ttu-id="ab909-107">所有元件也都需要 Microsoft Visual C++ 2015 可轉散發套件更新 1 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="ab909-107">All components also require Microsoft Visual C++ 2015 Redistributable Update 1 or higher.</span></span> <span data-ttu-id="ab909-108">MFA Server 安裝程式會同時安裝這些元件的 x86 和 x64 版本 (如果尚未安裝)。</span><span class="sxs-lookup"><span data-stu-id="ab909-108">The MFA Server installer installs both the x86 and x64 versions of these components if they aren't already installed.</span></span> <span data-ttu-id="ab909-109">如果使用者入口網站和行動裝置應用程式 Web 服務在不同的伺服器上執行，則您需要先安裝這些套件，再升級這些元件。</span><span class="sxs-lookup"><span data-stu-id="ab909-109">If the User Portal and Mobile App Web Service run on separate servers, you need to install those packages before upgrading those components.</span></span> <span data-ttu-id="ab909-110">您可以在 [Microsoft 下載中心](https://www.microsoft.com/en-us/download/)搜尋最新的 Microsoft Visual C++ 2015 可轉散發套件更新。</span><span class="sxs-lookup"><span data-stu-id="ab909-110">You can search for the latest Microsoft Visual C++ 2015 Redistributable update on the [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span></span> 

## <a name="install-the-latest-version-of-azure-mfa-server"></a><span data-ttu-id="ab909-111">安裝最新版的 Azure MFA Server</span><span class="sxs-lookup"><span data-stu-id="ab909-111">Install the latest version of Azure MFA Server</span></span>

1. <span data-ttu-id="ab909-112">使用[下載 zure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) 中的指示，來取得最新版的 Azure MFA Server。</span><span class="sxs-lookup"><span data-stu-id="ab909-112">Use the instructions in [Download the Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) to get the latest version of the Azure MFA Server.</span></span>
2. <span data-ttu-id="ab909-113">在您的主要 MFA Server 上，針對位於 C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (假設此為預設安裝位置) 的 MFA Server 資料檔案製作備份。</span><span class="sxs-lookup"><span data-stu-id="ab909-113">Make a backup of the MFA Server data file located at C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (assuming the default install location) on your master MFA Server.</span></span>
3. <span data-ttu-id="ab909-114">如果您執行多部伺服器以取得高可用性，請變更用戶端系統來向 MFA Server 驗證，如此便能讓它們停止將流量傳送到正在升級的伺服器。</span><span class="sxs-lookup"><span data-stu-id="ab909-114">If you run multiple servers for high availability, change the client systems that authenticate to the MFA Server so that they stop sending traffic to the servers that are upgrading.</span></span> <span data-ttu-id="ab909-115">如果您使用負載平衡器，請從負載平衡器移除 MFA Server、進行升級，然後將伺服器加回到伺服器陣列。</span><span class="sxs-lookup"><span data-stu-id="ab909-115">If you use a load balancer, remove a MFA Server from the load balancer, do the upgrade, and then add the server back into the farm.</span></span>
4. <span data-ttu-id="ab909-116">在每部 MFA Server 上執行新的安裝程式。</span><span class="sxs-lookup"><span data-stu-id="ab909-116">Run the new installer on each MFA Server.</span></span> <span data-ttu-id="ab909-117">先升級次級伺服器，因為它們可以讀取由主要伺服器所複寫的舊資料檔。</span><span class="sxs-lookup"><span data-stu-id="ab909-117">Upgrade subordinate servers first because they can read the old data file being replicated by the master.</span></span> 

  <span data-ttu-id="ab909-118">您不需解除安裝目前的 MFA Server，就能執行安裝程式。</span><span class="sxs-lookup"><span data-stu-id="ab909-118">You do not need to uninstall your current MFA Server before running the installer.</span></span> <span data-ttu-id="ab909-119">安裝程式會執行就地升級。</span><span class="sxs-lookup"><span data-stu-id="ab909-119">The installer performs an in-place upgrade.</span></span> <span data-ttu-id="ab909-120">系統會從先前安裝的登錄中挑選安裝路徑，因此它會安裝在相同位置 (例如，C:\Program Files\Multi-Factor Authentication Server)。</span><span class="sxs-lookup"><span data-stu-id="ab909-120">The installation path is picked up from the registry from the previous installation, so it installs in the same location (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> 
  
5. <span data-ttu-id="ab909-121">如果系統提示您安裝 Microsoft Visual C++ 2015 可轉散發套件的更新套件，請接受提示。</span><span class="sxs-lookup"><span data-stu-id="ab909-121">If you're prompted to install a Microsoft Visual C++ 2015 Redistributable update package, accept the prompt.</span></span> <span data-ttu-id="ab909-122">隨即會同時安裝套件的 x86 和 x64 版本。</span><span class="sxs-lookup"><span data-stu-id="ab909-122">Both the x86 and x64 versions of the package are installed.</span></span>
5. <span data-ttu-id="ab909-123">如果您使用 Web 服務 SDK，系統會提示您安裝新的 Web 服務 SDK。</span><span class="sxs-lookup"><span data-stu-id="ab909-123">If you use the Web Service SDK, you are prompted to install the new Web Service SDK.</span></span> <span data-ttu-id="ab909-124">當您安裝新的 Web 服務 SDK 時，請確定虛擬目錄名稱符合先前安裝的虛擬目錄 (例如，MultiFactorAuthWebServiceSdk)。</span><span class="sxs-lookup"><span data-stu-id="ab909-124">When you install the new Web Service SDK, make sure that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuthWebServiceSdk).</span></span>
6. <span data-ttu-id="ab909-125">在所有次級伺服器上重複執行這些步驟。</span><span class="sxs-lookup"><span data-stu-id="ab909-125">Repeat the steps on all subordinate servers.</span></span> <span data-ttu-id="ab909-126">將其中一部次級伺服器升階為新的主要伺服器，然後升級舊的主要伺服器。</span><span class="sxs-lookup"><span data-stu-id="ab909-126">Promote one of the subordinates to be the new master, then upgrade the old master server.</span></span> 

## <a name="upgrade-the-user-portal"></a><span data-ttu-id="ab909-127">升級使用者入口網站</span><span class="sxs-lookup"><span data-stu-id="ab909-127">Upgrade the User Portal</span></span>

1. <span data-ttu-id="ab909-128">製作 web.config 檔案的備份，此檔案位於使用者入口網站安裝位置的虛擬目錄中 (例如，C:\inetpub\wwwroot\MultiFactorAuth)。</span><span class="sxs-lookup"><span data-stu-id="ab909-128">Make a backup of the web.config file that is in the virtual directory of the User Portal installation location (for example, C:\inetpub\wwwroot\MultiFactorAuth).</span></span> <span data-ttu-id="ab909-129">如果對預設佈景主題做了任何變更，也請製作 App_Themes\Default 資料夾的備份。</span><span class="sxs-lookup"><span data-stu-id="ab909-129">If any changes were made to the default theme, make a backup of the App_Themes\Default folder as well.</span></span> <span data-ttu-id="ab909-130">最好是建立預設資料夾的複本，並建立新的佈景主題，再變更預設佈景主題。</span><span class="sxs-lookup"><span data-stu-id="ab909-130">It is better to create a copy of the Default folder and create a new theme than to change the Default theme.</span></span>
2. <span data-ttu-id="ab909-131">如果使用者入口網站與其他 MFA Server 元件在相同的伺服器上執行，MFA Server 安裝會提示您更新使用者入口網站。</span><span class="sxs-lookup"><span data-stu-id="ab909-131">If the User Portal runs on the same server as the other MFA Server components, the MFA Server installation prompts you to update the User Portal.</span></span> <span data-ttu-id="ab909-132">接受提示並安裝使用者入口網站更新。</span><span class="sxs-lookup"><span data-stu-id="ab909-132">Accept the prompt and install the User Portal update.</span></span> <span data-ttu-id="ab909-133">檢查虛擬目錄名稱是否符合先前安裝的虛擬目錄 (例如，MultiFactorAuth)。</span><span class="sxs-lookup"><span data-stu-id="ab909-133">Check that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuth).</span></span>
3. <span data-ttu-id="ab909-134">如果使用者入口網站位在它自己的伺服器上，請從其中一部 MFA Server 的安裝位置複製 MultiFactorAuthenticationUserPortalSetup64.msi 檔案，然後將它放入使用者入口網站 Web 伺服器中。</span><span class="sxs-lookup"><span data-stu-id="ab909-134">If the User Portal is on its own server, copy the MultiFactorAuthenticationUserPortalSetup64.msi file from the install location of one of the MFA Servers and put it onto the User Portal web server.</span></span> <span data-ttu-id="ab909-135">執行安裝程式。</span><span class="sxs-lookup"><span data-stu-id="ab909-135">Run the installer.</span></span> 

  <span data-ttu-id="ab909-136">如果發生錯誤並指出「需要 Microsoft Visual C++ 2015 可轉散發套件更新 1 或更新版本」，可從[Microsoft 下載中心](https://www.microsoft.com/download/)下載並安裝最新的更新套件。</span><span class="sxs-lookup"><span data-stu-id="ab909-136">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="ab909-137">同時安裝 x86 和 x64 版本。</span><span class="sxs-lookup"><span data-stu-id="ab909-137">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="ab909-138">安裝更新的使用者入口網站軟體之後，將您在步驟 1 中製作的 web.config 備份與新的 web.config 檔案進行比較。</span><span class="sxs-lookup"><span data-stu-id="ab909-138">After the updated User Portal software is installed, compare the web.config backup you made in step 1 with the new web.config file.</span></span> <span data-ttu-id="ab909-139">如果新的 web.config 中沒有任何新的屬性，請將您的備份 web.config 複製到虛擬目錄，以覆寫新檔案。</span><span class="sxs-lookup"><span data-stu-id="ab909-139">If no new attributes exist in the new web.config, copy your backup web.config into the virtual directory to overwrite the new one.</span></span> <span data-ttu-id="ab909-140">另一個選項是從備份檔案複製 appSettings 值和 Web 服務 SDK URL，然後貼入新的 web.config。</span><span class="sxs-lookup"><span data-stu-id="ab909-140">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="ab909-141">如果您在多部伺服器上具有使用者入口網站，請全部重複執行安裝。</span><span class="sxs-lookup"><span data-stu-id="ab909-141">If you have the User Portal on multiple servers, repeat the installation on all of them.</span></span> 


## <a name="upgrade-the-mobile-app-web-service"></a><span data-ttu-id="ab909-142">升級行動裝置應用程式 Web 服務</span><span class="sxs-lookup"><span data-stu-id="ab909-142">Upgrade the Mobile App Web Service</span></span>

1. <span data-ttu-id="ab909-143">製作 web.config 檔案的備份，此檔案位於行動裝置應用程式 Web 服務安裝位置的虛擬目錄中 (例如，C:\inetpub\wwwroot\app 或 C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService)。</span><span class="sxs-lookup"><span data-stu-id="ab909-143">Make a backup of the web.config file that is in the virtual directory of the Mobile App Web Service installation location (for example, C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span></span>
2. <span data-ttu-id="ab909-144">從 MFA Server 的安裝位置複製 MultiFactorAuthenticationMobileAppWebServiceSetup64.msi 檔案，然後將它放入行動裝置應用程式註冊 Web 伺服器中。</span><span class="sxs-lookup"><span data-stu-id="ab909-144">Copy the MultiFactorAuthenticationMobileAppWebServiceSetup64.msi file from the install location of the MFA Servers and put it onto the Mobile App registration web server.</span></span>
3. <span data-ttu-id="ab909-145">執行安裝程式。</span><span class="sxs-lookup"><span data-stu-id="ab909-145">Run the installer.</span></span> 

  <span data-ttu-id="ab909-146">如果發生錯誤並指出需要 Microsoft Visual C++ 2015 可轉散發套件更新 1 或更新版本，可從[Microsoft 下載中心](https://www.microsoft.com/download/)下載並安裝最新的更新套件。</span><span class="sxs-lookup"><span data-stu-id="ab909-146">If an error occurs stating that Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required, download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="ab909-147">同時安裝 x86 和 x64 版本。</span><span class="sxs-lookup"><span data-stu-id="ab909-147">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="ab909-148">安裝更新的行動裝置應用程式 Web 服務軟體之後，將您在步驟 1 中備份的 web.config 檔案與新的 web.config 檔案進行比較。</span><span class="sxs-lookup"><span data-stu-id="ab909-148">After the updated Mobile App Web Service software installs, compare the web.config file that was backed up in step 1 with the new web.config file.</span></span> <span data-ttu-id="ab909-149">如果新的 web.config 中沒有任何新的屬性，您可以將儲存的 web.config 複製回虛擬目錄，並覆寫新的檔案。</span><span class="sxs-lookup"><span data-stu-id="ab909-149">If no new attributes exist in the new web.config, you can copy your saved web.config back into the virtual directory and overwrite the new one.</span></span> <span data-ttu-id="ab909-150">另一個選項是從備份檔案複製 appSettings 值和 Web 服務 SDK URL，然後貼入新的 web.config。</span><span class="sxs-lookup"><span data-stu-id="ab909-150">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="ab909-151">如果您在多部伺服器上具有行動裝置應用程式 Web 服務，請全部重複執行安裝。</span><span class="sxs-lookup"><span data-stu-id="ab909-151">If you have the Mobile App Web Service on multiple servers, repeat the installation on all of them.</span></span> 

## <a name="upgrade-the-ad-fs-adapters"></a><span data-ttu-id="ab909-152">升級 AD FS 配接器</span><span class="sxs-lookup"><span data-stu-id="ab909-152">Upgrade the AD FS Adapters</span></span>


### <a name="if-mfa-runs-on-different-servers-than-ad-fs"></a><span data-ttu-id="ab909-153">如果 MFA 與 AD FS 不是在同一部伺服器上執行</span><span class="sxs-lookup"><span data-stu-id="ab909-153">If MFA runs on different servers than AD FS</span></span>

<span data-ttu-id="ab909-154">只有當您將 Multi-Factor Authentication Server 與您的 AD FS 伺服器分開執行時，才適用這些指示。</span><span class="sxs-lookup"><span data-stu-id="ab909-154">These instructions only apply if you run Multi-Factor Authentication Server separately from your AD FS servers.</span></span> <span data-ttu-id="ab909-155">如果這兩個服務在相同的伺服器上執行，請略過本節，並移至安裝步驟。</span><span class="sxs-lookup"><span data-stu-id="ab909-155">If both services run on the same servers, skip this section and go to the installation steps.</span></span> 

1. <span data-ttu-id="ab909-156">儲存已在 AD FS 中註冊的 MultiFactorAuthenticationAdfsAdapter.config 複本，或者使用下列 PowerShell 命令來將組態匯出：`Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`。</span><span class="sxs-lookup"><span data-stu-id="ab909-156">Save a copy of the MultiFactorAuthenticationAdfsAdapter.config file that was registered in AD FS, or export the configuration using the following PowerShell command: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span></span> <span data-ttu-id="ab909-157">根據先前安裝的版本，配接器名稱可以是 "WindowsAzureMultiFactorAuthentication" 或 "AzureMfaServerAuthentication"。</span><span class="sxs-lookup"><span data-stu-id="ab909-157">The adapter name is either "WindowsAzureMultiFactorAuthentication" or "AzureMfaServerAuthentication" depending on the version previously installed.</span></span>
2. <span data-ttu-id="ab909-158">將下列檔案從 MFA Server 安裝位置複製到 AD FS 伺服器：</span><span class="sxs-lookup"><span data-stu-id="ab909-158">Copy the following files from the MFA Server installation location to the AD FS servers:</span></span>

  - <span data-ttu-id="ab909-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="ab909-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
  - <span data-ttu-id="ab909-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="ab909-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="ab909-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="ab909-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="ab909-162">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="ab909-162">MultiFactorAuthenticationAdfsAdapter.config</span></span>

3. <span data-ttu-id="ab909-163">編輯 Register-MultiFactorAuthenticationAdfsAdapter.ps1 指令碼，作法是在 `Register-AdfsAuthenticationProvider` 命令的結尾加上 `-ConfigurationFilePath [path]`。</span><span class="sxs-lookup"><span data-stu-id="ab909-163">Edit the Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding `-ConfigurationFilePath [path]` to the end of the `Register-AdfsAuthenticationProvider` command.</span></span> <span data-ttu-id="ab909-164">以 MultiFactorAuthenticationAdfsAdapter.config 檔案或上一步中匯出的組態檔之完整路徑取代 *[path]*。</span><span class="sxs-lookup"><span data-stu-id="ab909-164">Replace *[path]* with the full path to the MultiFactorAuthenticationAdfsAdapter.config file or the configuration file exported in the previous step.</span></span> 

  <span data-ttu-id="ab909-165">在新的 MultiFactorAuthenticationAdfsAdapter.config 中檢查屬性，以查看它們是否相符舊的組態檔。</span><span class="sxs-lookup"><span data-stu-id="ab909-165">Check the attributes in the new MultiFactorAuthenticationAdfsAdapter.config to see if they match the old config file.</span></span> <span data-ttu-id="ab909-166">如果已在新版本中加入或移除任何屬性，可將屬性值從舊的組態檔複製到新的組態檔，或是修改舊的組態檔以使其相符。</span><span class="sxs-lookup"><span data-stu-id="ab909-166">If any attributes were added or removed in the new version, copy the attribute values from the old configuration file to the new one or modify the old configuration file to match.</span></span>

### <a name="install-new-ad-fs-adapters"></a><span data-ttu-id="ab909-167">安裝新的 AD FS 配接器</span><span class="sxs-lookup"><span data-stu-id="ab909-167">Install new AD FS adapters</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="ab909-168">您的使用者在本節的步驟 3-8 期間，將不需執行雙步驟驗證。</span><span class="sxs-lookup"><span data-stu-id="ab909-168">Your users will not be required to perform two-step verification during steps 3-8 of this section.</span></span> <span data-ttu-id="ab909-169">如果您在多個叢集中設定了 AD FS，您可以在伺服器陣列中個別移除、升級和還原每一個叢集，而不會影響其他叢集，以避免產生停機時間。</span><span class="sxs-lookup"><span data-stu-id="ab909-169">If you have AD FS configured in multiple clusters, you can remove, upgrade, and restore each cluster in the farm independently of the other clusters to avoid downtime.</span></span>

1. <span data-ttu-id="ab909-170">從伺服器陣列中移除某些 AD FS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="ab909-170">Remove some AD FS servers from the farm.</span></span> <span data-ttu-id="ab909-171">當其他伺服器仍在執行時，更新這些伺服器。</span><span class="sxs-lookup"><span data-stu-id="ab909-171">Update these servers while the others are still running.</span></span>
2. <span data-ttu-id="ab909-172">在已從 AD FS 伺服器陣列中移除的每部伺服器上安裝新的 AD FS 配接器。</span><span class="sxs-lookup"><span data-stu-id="ab909-172">Install the new AD FS adapter on each server removed from the AD FS farm.</span></span> <span data-ttu-id="ab909-173">如果在每部 AD FS 伺服器上安裝 MFA Server，您可以透過 MFA Server 系統管理 UX 來更新。</span><span class="sxs-lookup"><span data-stu-id="ab909-173">If the MFA Server is installed on each AD FS server, you can update through the MFA Server admin UX.</span></span> <span data-ttu-id="ab909-174">否則，可透過執行 MultiFactorAuthenticationAdfsAdapterSetup64.msi 來更新。</span><span class="sxs-lookup"><span data-stu-id="ab909-174">Otherwise, update by running MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span></span> 

  <span data-ttu-id="ab909-175">如果發生錯誤並指出「需要 Microsoft Visual C++ 2015 可轉散發套件更新 1 或更新版本」，可從[Microsoft 下載中心](https://www.microsoft.com/download/)下載並安裝最新的更新套件。</span><span class="sxs-lookup"><span data-stu-id="ab909-175">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="ab909-176">同時安裝 x86 和 x64 版本。</span><span class="sxs-lookup"><span data-stu-id="ab909-176">Install both the x86 and x64 versions.</span></span>

3. <span data-ttu-id="ab909-177">移至 [AD FS] > [驗證原則] > [編輯全域多重要素驗證原則]。</span><span class="sxs-lookup"><span data-stu-id="ab909-177">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="ab909-178">取消勾選 **[WindowsAzureMultiFactorAuthentication]** 或 **[AzureMFAServerAuthentication]** \(根據目前安裝的版本而定)。</span><span class="sxs-lookup"><span data-stu-id="ab909-178">Uncheck **WindowsAzureMultiFactorAuthentication** or **AzureMFAServerAuthentication** (depending on the current version installed).</span></span> 

  <span data-ttu-id="ab909-179">完成此步驟之後，您必須先完成步驟 8，才能在此 AD FS 叢集中透過 MFA Server 進行雙步驟驗證。</span><span class="sxs-lookup"><span data-stu-id="ab909-179">Once this step is complete, two-step verification through MFA Server is not available in this AD FS cluster until you complete step 8.</span></span>

4. <span data-ttu-id="ab909-180">執行 Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell 指令碼來取消註冊舊版的 AD FS 配接器。</span><span class="sxs-lookup"><span data-stu-id="ab909-180">Unregister the older version of the AD FS adapter by running the Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="ab909-181">確認 *-Name* 參數 (可以是 “WindowsAzureMultiFactorAuthentication” 或 "AzureMFAServerAuthentication") 符合步驟 3 中顯示的名稱。</span><span class="sxs-lookup"><span data-stu-id="ab909-181">Ensure that the *-Name* parameter (either “WindowsAzureMultiFactorAuthentication” or "AzureMFAServerAuthentication") matches the name that was displayed in step 3.</span></span> <span data-ttu-id="ab909-182">這適用於相同 AD FS 叢集中的所有伺服器，因為有一個中央組態。</span><span class="sxs-lookup"><span data-stu-id="ab909-182">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
5. <span data-ttu-id="ab909-183">執行 Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell 指令碼來註冊新的 AD FS 配接器。</span><span class="sxs-lookup"><span data-stu-id="ab909-183">Register the new AD FS adapter by running the Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="ab909-184">這適用於相同 AD FS 叢集中的所有伺服器，因為有一個中央組態。</span><span class="sxs-lookup"><span data-stu-id="ab909-184">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
6. <span data-ttu-id="ab909-185">在已從 AD FS 伺服器陣列中移除的每部伺服器上重新啟動 AD FS 服務。</span><span class="sxs-lookup"><span data-stu-id="ab909-185">Restart the AD FS service on each server removed from the AD FS farm.</span></span>
7. <span data-ttu-id="ab909-186">將更新的伺服器加回 AD FS 伺服器陣列，並從該伺服器陣列中移除其他伺服器。</span><span class="sxs-lookup"><span data-stu-id="ab909-186">Add the updated servers back to the AD FS farm and remove the other servers from the farm.</span></span>
8. <span data-ttu-id="ab909-187">移至 [AD FS] > [驗證原則] > [編輯全域多重要素驗證原則]。</span><span class="sxs-lookup"><span data-stu-id="ab909-187">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="ab909-188">勾選 [AzureMfaServerAuthentication]。</span><span class="sxs-lookup"><span data-stu-id="ab909-188">Check **AzureMfaServerAuthentication**.</span></span>
9. <span data-ttu-id="ab909-189">重複執行步驟 2 來更新現在已從 AD FS 伺服器陣列中移除的伺服器，然後在這些伺服器上重新啟動 AD FS 服務。</span><span class="sxs-lookup"><span data-stu-id="ab909-189">Repeat step 2 to update the servers now removed from the AD FS farm and restart the AD FS service on those servers.</span></span>
10. <span data-ttu-id="ab909-190">將這些伺服器加回 AD FS 伺服器陣列。</span><span class="sxs-lookup"><span data-stu-id="ab909-190">Add those servers back into the AD FS farm.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ab909-191">後續步驟</span><span class="sxs-lookup"><span data-stu-id="ab909-191">Next steps</span></span>

- <span data-ttu-id="ab909-192">取得[使用 Azure Multi-Factor Authentication 與協力廠商 VPN 的進階案例](multi-factor-authentication-advanced-vpn-configurations.md)的範例</span><span class="sxs-lookup"><span data-stu-id="ab909-192">Get examples of [Advanced scenarios with Azure Multi-Factor Authentication and third-party VPNs](multi-factor-authentication-advanced-vpn-configurations.md)</span></span>

- [<span data-ttu-id="ab909-193">將 MFA Server 與 Windows Server Active Directory 同步處理</span><span class="sxs-lookup"><span data-stu-id="ab909-193">Synchronize MFA Server with Windows Server Active Directory</span></span>](multi-factor-authentication-get-started-server-dirint.md)

- <span data-ttu-id="ab909-194">為您的應用程式[設定 Windows 驗證](multi-factor-authentication-get-started-server-windows.md)</span><span class="sxs-lookup"><span data-stu-id="ab909-194">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications</span></span>
