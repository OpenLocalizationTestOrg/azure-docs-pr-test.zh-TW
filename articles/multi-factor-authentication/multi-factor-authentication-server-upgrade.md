---
title: "aaaAzure MFA Server 升級 |Microsoft 文件"
description: "步驟和指引 tooupgrade hello Azure Multi-factor Authentication Server tooa 較新版本。"
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 50bb8ac3-5559-4d8b-a96a-799a74978b14
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: aaa8d400e0e5f1c6be3a6d22cde6dd893ef4d546
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="upgrade-toohello-latest-azure-multi-factor-authentication-server"></a><span data-ttu-id="3a12e-103">升級 toohello 最新的 Azure Multi-factor Authentication Server</span><span class="sxs-lookup"><span data-stu-id="3a12e-103">Upgrade toohello latest Azure Multi-Factor Authentication Server</span></span>

<span data-ttu-id="3a12e-104">本文將引導您完成 hello 處理升級 Azure Multi-factor Authentication (MFA) Server v6.0 或更高版本。</span><span class="sxs-lookup"><span data-stu-id="3a12e-104">This article walks you through hello process of upgrading Azure Multi-Factor Authentication (MFA) Server v6.0 or higher.</span></span> <span data-ttu-id="3a12e-105">如果您需要 tooupgrade hello PhoneFactor 代理程式的舊版本，請參閱太[升級 hello PhoneFactor Agent tooAzure Multi-factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md)。</span><span class="sxs-lookup"><span data-stu-id="3a12e-105">If you need tooupgrade an old version of hello PhoneFactor Agent, refer too[Upgrade hello PhoneFactor Agent tooAzure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md).</span></span>

<span data-ttu-id="3a12e-106">如果您是從 v6.x 或較舊的 toov7.x 升級或更新版本時，所有元件會從.NET 2.0 too.NET 4.5 都變更。</span><span class="sxs-lookup"><span data-stu-id="3a12e-106">If you're upgrading from v6.x or older toov7.x or newer, all components change from .NET 2.0 too.NET 4.5.</span></span> <span data-ttu-id="3a12e-107">所有元件也都需要 Microsoft Visual C++ 2015 可轉散發套件更新 1 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="3a12e-107">All components also require Microsoft Visual C++ 2015 Redistributable Update 1 or higher.</span></span> <span data-ttu-id="3a12e-108">如果未安裝，hello MFA Server 安裝程式會安裝這些元件的兩個 hello x86 和 x64 版本。</span><span class="sxs-lookup"><span data-stu-id="3a12e-108">hello MFA Server installer installs both hello x86 and x64 versions of these components if they aren't already installed.</span></span> <span data-ttu-id="3a12e-109">如果不同伺服器上執行 hello 使用者入口網站和行動裝置應用程式 Web 服務，您需要 tooinstall 這些封裝之前升級這些元件。</span><span class="sxs-lookup"><span data-stu-id="3a12e-109">If hello User Portal and Mobile App Web Service run on separate servers, you need tooinstall those packages before upgrading those components.</span></span> <span data-ttu-id="3a12e-110">您可以搜尋 hello 最新版 Microsoft Visual c + + 2015年可轉散發的 update 上 hello [Microsoft Download Center](https://www.microsoft.com/en-us/download/)。</span><span class="sxs-lookup"><span data-stu-id="3a12e-110">You can search for hello latest Microsoft Visual C++ 2015 Redistributable update on hello [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span></span> 

## <a name="install-hello-latest-version-of-azure-mfa-server"></a><span data-ttu-id="3a12e-111">安裝 Azure MFA Server hello 最新版本</span><span class="sxs-lookup"><span data-stu-id="3a12e-111">Install hello latest version of Azure MFA Server</span></span>

1. <span data-ttu-id="3a12e-112">使用中的 hello 指示[下載 hello Azure Multi-factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) tooget hello 最新版本的 Azure MFA Server hello。</span><span class="sxs-lookup"><span data-stu-id="3a12e-112">Use hello instructions in [Download hello Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) tooget hello latest version of hello Azure MFA Server.</span></span>
2. <span data-ttu-id="3a12e-113">製作 hello MFA Server 資料檔案位於 C:\Program files\multi-factor Authentication 驗證 Server\Data\PhoneFactor.pfdata 主要的 MFA 伺服器上 （假設 hello 預設安裝位置） 的備份。</span><span class="sxs-lookup"><span data-stu-id="3a12e-113">Make a backup of hello MFA Server data file located at C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (assuming hello default install location) on your master MFA Server.</span></span>
3. <span data-ttu-id="3a12e-114">如果您執行的高可用性的多部伺服器，變更 hello 驗證 toohello MFA Server，好讓它們停止將流量傳送 toohello 伺服器要升級的用戶端系統。</span><span class="sxs-lookup"><span data-stu-id="3a12e-114">If you run multiple servers for high availability, change hello client systems that authenticate toohello MFA Server so that they stop sending traffic toohello servers that are upgrading.</span></span> <span data-ttu-id="3a12e-115">如果您使用的負載平衡器，MFA Server 移除 hello 負載平衡器、 執行 hello 升級，然後再加入 hello 伺服器回 hello 伺服陣列。</span><span class="sxs-lookup"><span data-stu-id="3a12e-115">If you use a load balancer, remove a MFA Server from hello load balancer, do hello upgrade, and then add hello server back into hello farm.</span></span>
4. <span data-ttu-id="3a12e-116">MFA 的每部伺服器上執行 hello 新的安裝程式。</span><span class="sxs-lookup"><span data-stu-id="3a12e-116">Run hello new installer on each MFA Server.</span></span> <span data-ttu-id="3a12e-117">第一次升級次級伺服器，因為他們可以讀取 hello 所複寫的 hello master 舊資料檔案。</span><span class="sxs-lookup"><span data-stu-id="3a12e-117">Upgrade subordinate servers first because they can read hello old data file being replicated by hello master.</span></span> 

  <span data-ttu-id="3a12e-118">您不需要 toouninstall 目前的 MFA 伺服器之前執行 hello 安裝程式。</span><span class="sxs-lookup"><span data-stu-id="3a12e-118">You do not need toouninstall your current MFA Server before running hello installer.</span></span> <span data-ttu-id="3a12e-119">hello 安裝程式會執行就地升級。</span><span class="sxs-lookup"><span data-stu-id="3a12e-119">hello installer performs an in-place upgrade.</span></span> <span data-ttu-id="3a12e-120">hello 安裝路徑從挑選 hello 登錄從 hello 先前的安裝，因此它會安裝在 hello 相同位置 (例如 C:\Program files\multi-factor Authentication Server)。</span><span class="sxs-lookup"><span data-stu-id="3a12e-120">hello installation path is picked up from hello registry from hello previous installation, so it installs in hello same location (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> 
  
5. <span data-ttu-id="3a12e-121">如果您是提示的 tooinstall Microsoft Visual c + + 2015年可轉散發套件的更新套件，接受 hello 提示。</span><span class="sxs-lookup"><span data-stu-id="3a12e-121">If you're prompted tooinstall a Microsoft Visual C++ 2015 Redistributable update package, accept hello prompt.</span></span> <span data-ttu-id="3a12e-122">這兩個 hello x86 和 x64 版本的 hello 封裝會安裝。</span><span class="sxs-lookup"><span data-stu-id="3a12e-122">Both hello x86 and x64 versions of hello package are installed.</span></span>
5. <span data-ttu-id="3a12e-123">如果您使用 hello Web 服務 SDK，系統會提示您 tooinstall hello 新的 Web 服務 SDK。</span><span class="sxs-lookup"><span data-stu-id="3a12e-123">If you use hello Web Service SDK, you are prompted tooinstall hello new Web Service SDK.</span></span> <span data-ttu-id="3a12e-124">當您安裝 hello 新的 Web 服務 SDK，請確定該 hello 虛擬目錄名稱符合 hello 先前安裝的虛擬目錄 (例如，MultiFactorAuthWebServiceSdk)。</span><span class="sxs-lookup"><span data-stu-id="3a12e-124">When you install hello new Web Service SDK, make sure that hello virtual directory name matches hello previously installed virtual directory (for example, MultiFactorAuthWebServiceSdk).</span></span>
6. <span data-ttu-id="3a12e-125">Hello 上重複步驟的所有次級伺服器。</span><span class="sxs-lookup"><span data-stu-id="3a12e-125">Repeat hello steps on all subordinate servers.</span></span> <span data-ttu-id="3a12e-126">升級 hello 部屬 toobe hello 新主機，然後升級 hello 舊的主要伺服器的其中一個。</span><span class="sxs-lookup"><span data-stu-id="3a12e-126">Promote one of hello subordinates toobe hello new master, then upgrade hello old master server.</span></span> 

## <a name="upgrade-hello-user-portal"></a><span data-ttu-id="3a12e-127">升級 hello 使用者入口網站</span><span class="sxs-lookup"><span data-stu-id="3a12e-127">Upgrade hello User Portal</span></span>

1. <span data-ttu-id="3a12e-128">請 hello 的 hello 使用者入口網站安裝位置 (例如 C:\inetpub\wwwroot\MultiFactorAuth) 的虛擬目錄中的 hello web.config 檔案的備份。</span><span class="sxs-lookup"><span data-stu-id="3a12e-128">Make a backup of hello web.config file that is in hello virtual directory of hello User Portal installation location (for example, C:\inetpub\wwwroot\MultiFactorAuth).</span></span> <span data-ttu-id="3a12e-129">如果任何變更時 toohello 預設佈景主題，請製作 hello App_Themes\Default 資料夾的備份。</span><span class="sxs-lookup"><span data-stu-id="3a12e-129">If any changes were made toohello default theme, make a backup of hello App_Themes\Default folder as well.</span></span> <span data-ttu-id="3a12e-130">它是較佳的 toocreate hello 預設資料夾的複本，並建立新的佈景主題，比 toochange hello 預設佈景主題。</span><span class="sxs-lookup"><span data-stu-id="3a12e-130">It is better toocreate a copy of hello Default folder and create a new theme than toochange hello Default theme.</span></span>
2. <span data-ttu-id="3a12e-131">如果在同一部伺服器 hello 其他 MFA Server 元件，因為 hello 的 hello 執行 hello 使用者入口網站 MFA Server 安裝會提示您 tooupdate hello 使用者入口網站。</span><span class="sxs-lookup"><span data-stu-id="3a12e-131">If hello User Portal runs on hello same server as hello other MFA Server components, hello MFA Server installation prompts you tooupdate hello User Portal.</span></span> <span data-ttu-id="3a12e-132">接受 hello 提示，並安裝 hello 使用者入口網站更新。</span><span class="sxs-lookup"><span data-stu-id="3a12e-132">Accept hello prompt and install hello User Portal update.</span></span> <span data-ttu-id="3a12e-133">檢查該 hello 虛擬目錄名稱符合先前安裝的 hello 虛擬目錄 (例如，MultiFactorAuth)。</span><span class="sxs-lookup"><span data-stu-id="3a12e-133">Check that hello virtual directory name matches hello previously installed virtual directory (for example, MultiFactorAuth).</span></span>
3. <span data-ttu-id="3a12e-134">如果 hello 使用者入口網站是在自己的伺服器上，複製 hello MultiFactorAuthenticationUserPortalSetup64.msi 檔案從 hello 安裝其中一個 hello MFA 伺服器的位置，並將它放置到 hello 使用者入口網站 web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="3a12e-134">If hello User Portal is on its own server, copy hello MultiFactorAuthenticationUserPortalSetup64.msi file from hello install location of one of hello MFA Servers and put it onto hello User Portal web server.</span></span> <span data-ttu-id="3a12e-135">執行 hello 安裝程式。</span><span class="sxs-lookup"><span data-stu-id="3a12e-135">Run hello installer.</span></span> 

  <span data-ttu-id="3a12e-136">如果發生錯誤指出，"Microsoft Visual c + + 2015年可轉散發套件 Update 1 或更新版本為必要項，「 從下載並安裝 hello 最新的更新套件 hello [Microsoft Download Center](https://www.microsoft.com/download/)。</span><span class="sxs-lookup"><span data-stu-id="3a12e-136">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install hello latest update package from hello [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="3a12e-137">安裝這兩個 hello x86 和 x64 版本。</span><span class="sxs-lookup"><span data-stu-id="3a12e-137">Install both hello x86 and x64 versions.</span></span>

4. <span data-ttu-id="3a12e-138">Hello 更新已安裝軟體的使用者入口網站之後，比較您在步驟 1 與 hello 新的 web.config 檔案中所做的 hello web.config 備份。</span><span class="sxs-lookup"><span data-stu-id="3a12e-138">After hello updated User Portal software is installed, compare hello web.config backup you made in step 1 with hello new web.config file.</span></span> <span data-ttu-id="3a12e-139">如果新的屬性不存在 hello 新 web.config 中，複製 hello 虛擬目錄 toooverwrite hello 新備份 web.config。</span><span class="sxs-lookup"><span data-stu-id="3a12e-139">If no new attributes exist in hello new web.config, copy your backup web.config into hello virtual directory toooverwrite hello new one.</span></span> <span data-ttu-id="3a12e-140">另一個選項是 toocopy/貼上 hello appSettings 值和 hello hello 備份 hello 新的 web.config 檔中的 Web 服務 SDK URL。</span><span class="sxs-lookup"><span data-stu-id="3a12e-140">Another option is toocopy/paste hello appSettings values and hello Web Service SDK URL from hello backup file into hello new web.config.</span></span>

<span data-ttu-id="3a12e-141">如果您有多部伺服器上的 hello 使用者入口網站時，重複在 hello 安裝。</span><span class="sxs-lookup"><span data-stu-id="3a12e-141">If you have hello User Portal on multiple servers, repeat hello installation on all of them.</span></span> 


## <a name="upgrade-hello-mobile-app-web-service"></a><span data-ttu-id="3a12e-142">升級 hello Mobile App Web Service</span><span class="sxs-lookup"><span data-stu-id="3a12e-142">Upgrade hello Mobile App Web Service</span></span>

1. <span data-ttu-id="3a12e-143">請 hello Mobile App Web Service 安裝位置 （例如，C:\inetpub\wwwroot\app 或 C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService） 處於 hello hello 虛擬目錄的 web.config 檔案的備份。</span><span class="sxs-lookup"><span data-stu-id="3a12e-143">Make a backup of hello web.config file that is in hello virtual directory of hello Mobile App Web Service installation location (for example, C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span></span>
2. <span data-ttu-id="3a12e-144">從 hello 複製 hello MultiFactorAuthenticationMobileAppWebServiceSetup64.msi 檔案安裝的 hello MFA 伺服器的位置，並將它放置到 hello 行動裝置應用程式註冊的 web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="3a12e-144">Copy hello MultiFactorAuthenticationMobileAppWebServiceSetup64.msi file from hello install location of hello MFA Servers and put it onto hello Mobile App registration web server.</span></span>
3. <span data-ttu-id="3a12e-145">執行 hello 安裝程式。</span><span class="sxs-lookup"><span data-stu-id="3a12e-145">Run hello installer.</span></span> 

  <span data-ttu-id="3a12e-146">如果發生錯誤，指出需要 Microsoft Visual c + + 2015年可轉散發套件 Update 1 或更新版本的下載並安裝 hello 最新的更新封裝從 hello [Microsoft Download Center](https://www.microsoft.com/download/)。</span><span class="sxs-lookup"><span data-stu-id="3a12e-146">If an error occurs stating that Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required, download and install hello latest update package from hello [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="3a12e-147">安裝這兩個 hello x86 和 x64 版本。</span><span class="sxs-lookup"><span data-stu-id="3a12e-147">Install both hello x86 and x64 versions.</span></span>

4. <span data-ttu-id="3a12e-148">Hello 更新 Mobile App Web Service 軟體安裝之後，比較備份在步驟 1 與 hello 新的 web.config 檔案中的 hello web.config 檔案。</span><span class="sxs-lookup"><span data-stu-id="3a12e-148">After hello updated Mobile App Web Service software installs, compare hello web.config file that was backed up in step 1 with hello new web.config file.</span></span> <span data-ttu-id="3a12e-149">如果新的屬性不存在 hello 新 web.config 中，您可以將已儲存的 web.config 複製回 hello 虛擬目錄，並覆寫 hello 新。</span><span class="sxs-lookup"><span data-stu-id="3a12e-149">If no new attributes exist in hello new web.config, you can copy your saved web.config back into hello virtual directory and overwrite hello new one.</span></span> <span data-ttu-id="3a12e-150">另一個選項是 toocopy/貼上 hello appSettings 值和 hello hello 備份 hello 新的 web.config 檔中的 Web 服務 SDK URL。</span><span class="sxs-lookup"><span data-stu-id="3a12e-150">Another option is toocopy/paste hello appSettings values and hello Web Service SDK URL from hello backup file into hello new web.config.</span></span>

<span data-ttu-id="3a12e-151">如果您有多部伺服器上的 hello Mobile App Web Service 時，重複在 hello 安裝。</span><span class="sxs-lookup"><span data-stu-id="3a12e-151">If you have hello Mobile App Web Service on multiple servers, repeat hello installation on all of them.</span></span> 

## <a name="upgrade-hello-ad-fs-adapters"></a><span data-ttu-id="3a12e-152">升級 hello AD FS 配接器</span><span class="sxs-lookup"><span data-stu-id="3a12e-152">Upgrade hello AD FS Adapters</span></span>


### <a name="if-mfa-runs-on-different-servers-than-ad-fs"></a><span data-ttu-id="3a12e-153">如果 MFA 與 AD FS 不是在同一部伺服器上執行</span><span class="sxs-lookup"><span data-stu-id="3a12e-153">If MFA runs on different servers than AD FS</span></span>

<span data-ttu-id="3a12e-154">只有當您將 Multi-Factor Authentication Server 與您的 AD FS 伺服器分開執行時，才適用這些指示。</span><span class="sxs-lookup"><span data-stu-id="3a12e-154">These instructions only apply if you run Multi-Factor Authentication Server separately from your AD FS servers.</span></span> <span data-ttu-id="3a12e-155">如果這兩項服務上執行 hello 相同的伺服器，請略過本節並移 toohello 安裝步驟。</span><span class="sxs-lookup"><span data-stu-id="3a12e-155">If both services run on hello same servers, skip this section and go toohello installation steps.</span></span> 

1. <span data-ttu-id="3a12e-156">儲存已註冊於 AD FS 中的 hello MultiFactorAuthenticationAdfsAdapter.config 檔案的複本或匯出 hello 設定使用下列 PowerShell 命令的 hello: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path tooconfig file]`。</span><span class="sxs-lookup"><span data-stu-id="3a12e-156">Save a copy of hello MultiFactorAuthenticationAdfsAdapter.config file that was registered in AD FS, or export hello configuration using hello following PowerShell command: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path tooconfig file]`.</span></span> <span data-ttu-id="3a12e-157">hello 配接器名稱會是"WindowsAzureMultiFactorAuthentication"或"AzureMfaServerAuthentication"視 hello 先前安裝的版本而定。</span><span class="sxs-lookup"><span data-stu-id="3a12e-157">hello adapter name is either "WindowsAzureMultiFactorAuthentication" or "AzureMfaServerAuthentication" depending on hello version previously installed.</span></span>
2. <span data-ttu-id="3a12e-158">複製下列檔案從 hello MFA Server 安裝位置 toohello AD FS 伺服器 hello:</span><span class="sxs-lookup"><span data-stu-id="3a12e-158">Copy hello following files from hello MFA Server installation location toohello AD FS servers:</span></span>

  - <span data-ttu-id="3a12e-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="3a12e-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
  - <span data-ttu-id="3a12e-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="3a12e-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="3a12e-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="3a12e-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="3a12e-162">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="3a12e-162">MultiFactorAuthenticationAdfsAdapter.config</span></span>

3. <span data-ttu-id="3a12e-163">編輯 hello Register-multifactorauthenticationadfsadapter.ps1 指令碼，藉由新增`-ConfigurationFilePath [path]`toohello 結尾 hello`Register-AdfsAuthenticationProvider`命令。</span><span class="sxs-lookup"><span data-stu-id="3a12e-163">Edit hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding `-ConfigurationFilePath [path]` toohello end of hello `Register-AdfsAuthenticationProvider` command.</span></span> <span data-ttu-id="3a12e-164">取代*[path]* hello 完整路徑 toohello MultiFactorAuthenticationAdfsAdapter.config 檔案或 hello 設定檔匯出 hello 上一個步驟中。</span><span class="sxs-lookup"><span data-stu-id="3a12e-164">Replace *[path]* with hello full path toohello MultiFactorAuthenticationAdfsAdapter.config file or hello configuration file exported in hello previous step.</span></span> 

  <span data-ttu-id="3a12e-165">如果兩者相符 hello 舊組態檔，請檢查新 MultiFactorAuthenticationAdfsAdapter.config toosee hello 中的 hello 屬性。</span><span class="sxs-lookup"><span data-stu-id="3a12e-165">Check hello attributes in hello new MultiFactorAuthenticationAdfsAdapter.config toosee if they match hello old config file.</span></span> <span data-ttu-id="3a12e-166">如果任何屬性已加入或移除 hello 新版本中，將從舊組態檔案 toohello hello 新複製 hello 屬性值或修改 hello 舊組態檔案 toomatch。</span><span class="sxs-lookup"><span data-stu-id="3a12e-166">If any attributes were added or removed in hello new version, copy hello attribute values from hello old configuration file toohello new one or modify hello old configuration file toomatch.</span></span>

### <a name="install-new-ad-fs-adapters"></a><span data-ttu-id="3a12e-167">安裝新的 AD FS 配接器</span><span class="sxs-lookup"><span data-stu-id="3a12e-167">Install new AD FS adapters</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="3a12e-168">您的使用者將無法在步驟 3-8 的這個區段的必要的 tooperform 雙步驟驗證。</span><span class="sxs-lookup"><span data-stu-id="3a12e-168">Your users will not be required tooperform two-step verification during steps 3-8 of this section.</span></span> <span data-ttu-id="3a12e-169">如果您有 AD FS 中設定多個叢集，您可以移除，升級和還原 hello 中的每個叢集伺服器陣列之外，獨立 hello 其他叢集 tooavoid 停機時間。</span><span class="sxs-lookup"><span data-stu-id="3a12e-169">If you have AD FS configured in multiple clusters, you can remove, upgrade, and restore each cluster in hello farm independently of hello other clusters tooavoid downtime.</span></span>

1. <span data-ttu-id="3a12e-170">移除 hello 伺服陣列中的某些 AD FS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="3a12e-170">Remove some AD FS servers from hello farm.</span></span> <span data-ttu-id="3a12e-171">更新這些伺服器 hello 其他人仍在執行時。</span><span class="sxs-lookup"><span data-stu-id="3a12e-171">Update these servers while hello others are still running.</span></span>
2. <span data-ttu-id="3a12e-172">從 hello AD FS 伺服器陣列移除每個伺服器上安裝 hello 新 AD FS 配接器。</span><span class="sxs-lookup"><span data-stu-id="3a12e-172">Install hello new AD FS adapter on each server removed from hello AD FS farm.</span></span> <span data-ttu-id="3a12e-173">如果每個 AD FS 伺服器上安裝 MFA Server hello，您可以更新透過 hello MFA Server 管理經驗</span><span class="sxs-lookup"><span data-stu-id="3a12e-173">If hello MFA Server is installed on each AD FS server, you can update through hello MFA Server admin UX.</span></span> <span data-ttu-id="3a12e-174">否則，可透過執行 MultiFactorAuthenticationAdfsAdapterSetup64.msi 來更新。</span><span class="sxs-lookup"><span data-stu-id="3a12e-174">Otherwise, update by running MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span></span> 

  <span data-ttu-id="3a12e-175">如果發生錯誤指出，"Microsoft Visual c + + 2015年可轉散發套件 Update 1 或更新版本為必要項，「 從下載並安裝 hello 最新的更新套件 hello [Microsoft Download Center](https://www.microsoft.com/download/)。</span><span class="sxs-lookup"><span data-stu-id="3a12e-175">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install hello latest update package from hello [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="3a12e-176">安裝這兩個 hello x86 和 x64 版本。</span><span class="sxs-lookup"><span data-stu-id="3a12e-176">Install both hello x86 and x64 versions.</span></span>

3. <span data-ttu-id="3a12e-177">跳過**AD FS** > **驗證原則** > **編輯全域的多重要素驗證原則**。</span><span class="sxs-lookup"><span data-stu-id="3a12e-177">Go too**AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="3a12e-178">取消核取**WindowsAzureMultiFactorAuthentication**或**AzureMFAServerAuthentication** （取決於 hello 安裝目前的版本）。</span><span class="sxs-lookup"><span data-stu-id="3a12e-178">Uncheck **WindowsAzureMultiFactorAuthentication** or **AzureMFAServerAuthentication** (depending on hello current version installed).</span></span> 

  <span data-ttu-id="3a12e-179">完成此步驟之後，您必須先完成步驟 8，才能在此 AD FS 叢集中透過 MFA Server 進行雙步驟驗證。</span><span class="sxs-lookup"><span data-stu-id="3a12e-179">Once this step is complete, two-step verification through MFA Server is not available in this AD FS cluster until you complete step 8.</span></span>

4. <span data-ttu-id="3a12e-180">取消註冊 hello 舊版的 hello AD FS 配接器執行 hello Unregister-multifactorauthenticationadfsadapter.ps1 PowerShell 指令碼。</span><span class="sxs-lookup"><span data-stu-id="3a12e-180">Unregister hello older version of hello AD FS adapter by running hello Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="3a12e-181">請確定該 hello *-名稱*（「 WindowsAzureMultiFactorAuthentication"或"AzureMFAServerAuthentication"） 的參數符合在步驟 3 中所顯示的 hello 名稱。</span><span class="sxs-lookup"><span data-stu-id="3a12e-181">Ensure that hello *-Name* parameter (either “WindowsAzureMultiFactorAuthentication” or "AzureMFAServerAuthentication") matches hello name that was displayed in step 3.</span></span> <span data-ttu-id="3a12e-182">這適用於 tooall hello 相同 AD FS 叢集中的伺服器，因為沒有集中式組態。</span><span class="sxs-lookup"><span data-stu-id="3a12e-182">This applies tooall servers in hello same AD FS cluster since there is a central configuration.</span></span>
5. <span data-ttu-id="3a12e-183">執行 hello Register-multifactorauthenticationadfsadapter.ps1 PowerShell 指令碼，以註冊 hello 新 AD FS 配接器。</span><span class="sxs-lookup"><span data-stu-id="3a12e-183">Register hello new AD FS adapter by running hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="3a12e-184">這適用於 tooall hello 相同 AD FS 叢集中的伺服器，因為沒有集中式組態。</span><span class="sxs-lookup"><span data-stu-id="3a12e-184">This applies tooall servers in hello same AD FS cluster since there is a central configuration.</span></span>
6. <span data-ttu-id="3a12e-185">重新啟動 hello 從 hello AD FS 伺服器陣列移除每個伺服器上的 AD FS 服務。</span><span class="sxs-lookup"><span data-stu-id="3a12e-185">Restart hello AD FS service on each server removed from hello AD FS farm.</span></span>
7. <span data-ttu-id="3a12e-186">新增更新的 hello 伺服器備份 toohello AD FS 伺服器陣列，並移除 hello hello 伺服陣列中的其他伺服器。</span><span class="sxs-lookup"><span data-stu-id="3a12e-186">Add hello updated servers back toohello AD FS farm and remove hello other servers from hello farm.</span></span>
8. <span data-ttu-id="3a12e-187">跳過**AD FS** > **驗證原則** > **編輯全域的多重要素驗證原則**。</span><span class="sxs-lookup"><span data-stu-id="3a12e-187">Go too**AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="3a12e-188">勾選 [AzureMfaServerAuthentication]。</span><span class="sxs-lookup"><span data-stu-id="3a12e-188">Check **AzureMfaServerAuthentication**.</span></span>
9. <span data-ttu-id="3a12e-189">重複步驟 2 tooupdate hello 伺服器，而現在從 hello AD FS 伺服器陣列中移除，並重新啟動這些伺服器上的 hello AD FS 服務。</span><span class="sxs-lookup"><span data-stu-id="3a12e-189">Repeat step 2 tooupdate hello servers now removed from hello AD FS farm and restart hello AD FS service on those servers.</span></span>
10. <span data-ttu-id="3a12e-190">這些伺服器將重新加入至 hello AD FS 伺服器陣列。</span><span class="sxs-lookup"><span data-stu-id="3a12e-190">Add those servers back into hello AD FS farm.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3a12e-191">後續步驟</span><span class="sxs-lookup"><span data-stu-id="3a12e-191">Next steps</span></span>

- <span data-ttu-id="3a12e-192">取得[使用 Azure Multi-Factor Authentication 與協力廠商 VPN 的進階案例](multi-factor-authentication-advanced-vpn-configurations.md)的範例</span><span class="sxs-lookup"><span data-stu-id="3a12e-192">Get examples of [Advanced scenarios with Azure Multi-Factor Authentication and third-party VPNs](multi-factor-authentication-advanced-vpn-configurations.md)</span></span>

- [<span data-ttu-id="3a12e-193">將 MFA Server 與 Windows Server Active Directory 同步處理</span><span class="sxs-lookup"><span data-stu-id="3a12e-193">Synchronize MFA Server with Windows Server Active Directory</span></span>](multi-factor-authentication-get-started-server-dirint.md)

- <span data-ttu-id="3a12e-194">為您的應用程式[設定 Windows 驗證](multi-factor-authentication-get-started-server-windows.md)</span><span class="sxs-lookup"><span data-stu-id="3a12e-194">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications</span></span>
