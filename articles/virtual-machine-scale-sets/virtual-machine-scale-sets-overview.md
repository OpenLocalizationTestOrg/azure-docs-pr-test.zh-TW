---
title: "Azure 虛擬機器擴展集概觀 | Microsoft Docs"
description: "深入了解 Azure 虛擬機器擴展集"
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 76ac7fd7-2e05-4762-88ca-3b499e87906e
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 07/03/2017
ms.author: guybo
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 8b2fbc230faf01797109114d6ebdffe5ec50e48b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="what-are-virtual-machine-scale-sets-in-azure"></a><span data-ttu-id="fda8c-103">什麼是 Azure 中的虛擬機器擴展集？</span><span class="sxs-lookup"><span data-stu-id="fda8c-103">What are virtual machine scale sets in Azure?</span></span>
<span data-ttu-id="fda8c-104">虛擬機器擴展集是一個您可以用來部署和管理一組相同 VM 的 Azure 計算資源。</span><span class="sxs-lookup"><span data-stu-id="fda8c-104">Virtual machine scale sets are an Azure compute resource that you can use to deploy and manage a set of identical VMs.</span></span> <span data-ttu-id="fda8c-105">所有的 VM 設定相同，擴展集是設計來支援 true 的自動調整，而不需要預先佈建 VM。</span><span class="sxs-lookup"><span data-stu-id="fda8c-105">With all VMs configured the same, scale sets are designed to support true autoscale, and no pre-provisioning of VMs is required.</span></span> <span data-ttu-id="fda8c-106">您可以更輕鬆地針對大量計算、巨量資料和容器化工作負載，建置大規模服務。</span><span class="sxs-lookup"><span data-stu-id="fda8c-106">So it's easier to build large-scale services that target big compute, big data, and containerized workloads.</span></span>

<span data-ttu-id="fda8c-107">對於需要相應放大計算資源的應用程式，調整作業會隱含地平衡分散到容錯網域和更新網域。</span><span class="sxs-lookup"><span data-stu-id="fda8c-107">For applications that need to scale compute resources out and in, scale operations are implicitly balanced across fault and update domains.</span></span> <span data-ttu-id="fda8c-108">如需擴展集的進一步介紹，請參閱 [Azure 部落格通知](https://azure.microsoft.com/blog/azure-virtual-machine-scale-sets-ga/)。</span><span class="sxs-lookup"><span data-stu-id="fda8c-108">For a further introduction to scale sets, refer to the [Azure blog announcement](https://azure.microsoft.com/blog/azure-virtual-machine-scale-sets-ga/).</span></span>

<span data-ttu-id="fda8c-109">如需擴展集的詳細資訊，請觀看下列影片：</span><span class="sxs-lookup"><span data-stu-id="fda8c-109">For more information about scale sets, watch these videos:</span></span>

* [<span data-ttu-id="fda8c-110">Mark Russinovich 講述 Azure 擴展集</span><span class="sxs-lookup"><span data-stu-id="fda8c-110">Mark Russinovich talks Azure scale sets</span></span>](https://channel9.msdn.com/Blogs/Regular-IT-Guy/Mark-Russinovich-Talks-Azure-Scale-Sets/)  
* [<span data-ttu-id="fda8c-111">Guy Bowerman 與虛擬機器擴展集</span><span class="sxs-lookup"><span data-stu-id="fda8c-111">Virtual Machine Scale Sets with Guy Bowerman</span></span>](https://channel9.msdn.com/Shows/Cloud+Cover/Episode-191-Virtual-Machine-Scale-Sets-with-Guy-Bowerman)

## <a name="creating-and-managing-scale-sets"></a><span data-ttu-id="fda8c-112">建立和管理擴展集</span><span class="sxs-lookup"><span data-stu-id="fda8c-112">Creating and managing scale sets</span></span>
<span data-ttu-id="fda8c-113">您可以在 [Azure 入口網站](https://portal.azure.com)中選取 [新增]，並在搜尋列中輸入 **scale** 來建立擴展集。</span><span class="sxs-lookup"><span data-stu-id="fda8c-113">You can create a scale set in the [Azure portal](https://portal.azure.com) by selecting **new** and typing **scale** on the search bar.</span></span> <span data-ttu-id="fda8c-114">**虛擬機器擴展集**會列在結果中。</span><span class="sxs-lookup"><span data-stu-id="fda8c-114">**Virtual machine scale set** is listed in the results.</span></span> <span data-ttu-id="fda8c-115">您可以在這裡填寫必要的欄位，以自訂和部署您的擴展集。</span><span class="sxs-lookup"><span data-stu-id="fda8c-115">From there, you can fill in the required fields to customize and deploy your scale set.</span></span> <span data-ttu-id="fda8c-116">您在入口網站中也有可根據 CPU 使用量設定基本自動調整規則的選項。</span><span class="sxs-lookup"><span data-stu-id="fda8c-116">You also have options to set up basic autoscale rules based on CPU usage in the portal.</span></span>

<span data-ttu-id="fda8c-117">您可以使用 JSON 範本和 [REST API](https://msdn.microsoft.com/library/mt589023.aspx) 來定義和部署擴展集，如同個別的 Azure Resource Manager VM 一樣。</span><span class="sxs-lookup"><span data-stu-id="fda8c-117">You can define and deploy scale sets by using JSON templates and [REST APIs](https://msdn.microsoft.com/library/mt589023.aspx), just like individual Azure Resource Manager VMs.</span></span> <span data-ttu-id="fda8c-118">因此，您可以使用任何標準 Azure Resource Manager 部署方法。</span><span class="sxs-lookup"><span data-stu-id="fda8c-118">Therefore, you can use any standard Azure Resource Manager deployment methods.</span></span> <span data-ttu-id="fda8c-119">如需範本的詳細資訊，請參閱 [編寫 Azure Resource Manager 範本](../azure-resource-manager/resource-group-authoring-templates.md)。</span><span class="sxs-lookup"><span data-stu-id="fda8c-119">For more information about templates, see [Authoring Azure Resource Manager templates](../azure-resource-manager/resource-group-authoring-templates.md).</span></span>

<span data-ttu-id="fda8c-120">您可以在 [Azure 快速入門範本 GitHub 存放庫](https://github.com/Azure/azure-quickstart-templates)中找到虛擬機器擴展集的範例範本集。</span><span class="sxs-lookup"><span data-stu-id="fda8c-120">You can find a set of example templates for virtual machine scale sets in the [Azure Quickstart templates GitHub repository](https://github.com/Azure/azure-quickstart-templates).</span></span> <span data-ttu-id="fda8c-121">(尋找標題中包含 **vmss** 的範本)</span><span class="sxs-lookup"><span data-stu-id="fda8c-121">(Look for templates with **vmss** in the title.)</span></span>

<span data-ttu-id="fda8c-122">以快速入門範本為例，在每個範本的讀我檔案上，[部署至 Azure] 按鈕可連結至入口網站部署功能。</span><span class="sxs-lookup"><span data-stu-id="fda8c-122">For the Quickstart template examples, a "Deploy to Azure" button in the readme for each template links to the portal deployment feature.</span></span> <span data-ttu-id="fda8c-123">若要部署擴展集，請按一下該按鈕，然後在入口網站中填入所需的任何參數。</span><span class="sxs-lookup"><span data-stu-id="fda8c-123">To deploy the scale set, click the button and then fill in any parameters that are required in the portal.</span></span> 

## <a name="scaling-a-scale-set-out-and-in"></a><span data-ttu-id="fda8c-124">相應放大和相應縮小擴展集</span><span class="sxs-lookup"><span data-stu-id="fda8c-124">Scaling a scale set out and in</span></span>
<span data-ttu-id="fda8c-125">您可以在 Azure 入口網站中按一下 [設定] 底下的 [調整] 區段，來變更擴展集的容量。</span><span class="sxs-lookup"><span data-stu-id="fda8c-125">You can change the capacity of a scale set in the Azure portal by clicking the **Scaling** section under **Settings**.</span></span> 

<span data-ttu-id="fda8c-126">若要在命令列上變更擴展集容量，請在 [Azure CLI](https://github.com/Azure/azure-cli) 中使用 **scale** 命令。</span><span class="sxs-lookup"><span data-stu-id="fda8c-126">To change scale set capacity on the command line, use the **scale** command in [Azure CLI](https://github.com/Azure/azure-cli).</span></span> <span data-ttu-id="fda8c-127">例如，使用此命令將擴展集設定為 10 部 VM 的容量：</span><span class="sxs-lookup"><span data-stu-id="fda8c-127">For example, use this command to set a scale set to a capacity of 10 VMs:</span></span>

```bash
az vmss scale -g resourcegroupname -n scalesetname --new-capacity 10 
```

<span data-ttu-id="fda8c-128">若要使用 PowerShell 設定擴展集內的 VM 數量，請使用 **Update-AzureRmVmss** 命令︰</span><span class="sxs-lookup"><span data-stu-id="fda8c-128">To set the number of VMs in a scale set by using PowerShell, use the **Update-AzureRmVmss** command:</span></span>

```PowerShell
$vmss = Get-AzureRmVmss -ResourceGroupName resourcegroupname -VMScaleSetName scalesetname  
$vmss.Sku.Capacity = 10
Update-AzureRmVmss -ResourceGroupName resourcegroupname -Name scalesetname -VirtualMachineScaleSet $vmss
```

<span data-ttu-id="fda8c-129">若要使用 Azure Resource Manager 範本增加或減少擴展集內的虛擬機器數目，請變更 capacity 屬性並重新部署範本。</span><span class="sxs-lookup"><span data-stu-id="fda8c-129">To increase or decrease the number of virtual machines in a scale set by using an Azure Resource Manager template, change the **capacity** property and redeploy the template.</span></span> <span data-ttu-id="fda8c-130">此簡化程序可讓您在需要定義 Azure 自動調整不支援的自訂調整事件時，輕易地整合擴展集與 Azure 自動調整，或撰寫自己的自訂調整層。</span><span class="sxs-lookup"><span data-stu-id="fda8c-130">This simplicity makes it easy to integrate scale sets with Azure Autoscale, or to write your own custom scaling layer if you need to define custom scale events that Azure Autoscale does not support.</span></span> 

<span data-ttu-id="fda8c-131">如果您想要重新部署 Azure Resource Manager 範本以變更容量，可以定義較小的範本，使其僅包含 **SKU** 屬性套件和更新的容量。</span><span class="sxs-lookup"><span data-stu-id="fda8c-131">If you are redeploying an Azure Resource Manager template to change the capacity, you can define a much smaller template that includes only the **SKU** property packet with the updated capacity.</span></span> <span data-ttu-id="fda8c-132">[以下是範例](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing)。</span><span class="sxs-lookup"><span data-stu-id="fda8c-132">[Here's an example](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing).</span></span>

## <a name="autoscale"></a><span data-ttu-id="fda8c-133">Autoscale</span><span class="sxs-lookup"><span data-stu-id="fda8c-133">Autoscale</span></span>

<span data-ttu-id="fda8c-134">擴展集若建立於 Azure 入口網站中，則可選擇性地設定自動調整設定。</span><span class="sxs-lookup"><span data-stu-id="fda8c-134">A scale set can be optionally configured with autoscale settings when it's created in the Azure portal.</span></span> <span data-ttu-id="fda8c-135">以便根據平均 CPU 使用量來增加或減少 VM 數目。</span><span class="sxs-lookup"><span data-stu-id="fda8c-135">The number of VMs can then be increased or decreased based on average CPU usage.</span></span> 

<span data-ttu-id="fda8c-136">[Azure 快速入門範本](https://github.com/Azure/azure-quickstart-templates)中有許多擴展集範本都定義了自動調整設定。</span><span class="sxs-lookup"><span data-stu-id="fda8c-136">Many of the scale set templates in the [Azure Quickstart templates](https://github.com/Azure/azure-quickstart-templates) define autoscale settings.</span></span> <span data-ttu-id="fda8c-137">您也可以在現有擴展集新增自動調整設定。</span><span class="sxs-lookup"><span data-stu-id="fda8c-137">You can also add autoscale settings to an existing scale set.</span></span> <span data-ttu-id="fda8c-138">例如，此 Azure PowerShell 指令碼可在擴展集內新增以 CPU 為基礎的自動調整︰</span><span class="sxs-lookup"><span data-stu-id="fda8c-138">For example, this Azure PowerShell script adds CPU-based autoscale to a scale set:</span></span>

```PowerShell

$subid = "yoursubscriptionid"
$rgname = "yourresourcegroup"
$vmssname = "yourscalesetname"
$location = "yourlocation" # e.g. southcentralus

$rule1 = New-AzureRmAutoscaleRule -MetricName "Percentage CPU" -MetricResourceId /subscriptions/$subid/resourceGroups/$rgname/providers/Microsoft.Compute/virtualMachineScaleSets/$vmssname -Operator GreaterThan -MetricStatistic Average -Threshold 60 -TimeGrain 00:01:00 -TimeWindow 00:05:00 -ScaleActionCooldown 00:05:00 -ScaleActionDirection Increase -ScaleActionValue 1
$rule2 = New-AzureRmAutoscaleRule -MetricName "Percentage CPU" -MetricResourceId /subscriptions/$subid/resourceGroups/$rgname/providers/Microsoft.Compute/virtualMachineScaleSets/$vmssname -Operator LessThan -MetricStatistic Average -Threshold 30 -TimeGrain 00:01:00 -TimeWindow 00:05:00 -ScaleActionCooldown 00:05:00 -ScaleActionDirection Decrease -ScaleActionValue 1
$profile1 = New-AzureRmAutoscaleProfile -DefaultCapacity 2 -MaximumCapacity 10 -MinimumCapacity 2 -Rules $rule1,$rule2 -Name "autoprofile1"
Add-AzureRmAutoscaleSetting -Location $location -Name "autosetting1" -ResourceGroup $rgname -TargetResourceId /subscriptions/$subid/resourceGroups/$rgname/providers/Microsoft.Compute/virtualMachineScaleSets/$vmssname -AutoscaleProfiles $profile1
```

<span data-ttu-id="fda8c-139">您可以在下列位置找到可調整的有效度量清單︰"Microsoft.Compute/virtualMachineScaleSets" 標題下的[支援 Azure 監視器的度量](../monitoring-and-diagnostics/monitoring-supported-metrics.md)。</span><span class="sxs-lookup"><span data-stu-id="fda8c-139">You can find a list of valid metrics to scale on in [Supported metrics with Azure Monitor](../monitoring-and-diagnostics/monitoring-supported-metrics.md) under the heading "Microsoft.Compute/virtualMachineScaleSets."</span></span> <span data-ttu-id="fda8c-140">另外還有更多可用的進階自動調整選項，包括以排程為基礎的自動調整，以及使用 Webhook 來與警示系統整合。</span><span class="sxs-lookup"><span data-stu-id="fda8c-140">More advanced autoscale options are also available, including schedule-based autoscale and using webhooks to integrate with alert systems.</span></span>

## <a name="monitoring-your-scale-set"></a><span data-ttu-id="fda8c-141">監視擴展集</span><span class="sxs-lookup"><span data-stu-id="fda8c-141">Monitoring your scale set</span></span>
<span data-ttu-id="fda8c-142">[Azure 入口網站](https://portal.azure.com)會列出擴展集並顯示其屬性。</span><span class="sxs-lookup"><span data-stu-id="fda8c-142">The [Azure portal](https://portal.azure.com) lists scale sets and shows their properties.</span></span> <span data-ttu-id="fda8c-143">入口網站也支援管理作業。</span><span class="sxs-lookup"><span data-stu-id="fda8c-143">The portal also supports management operations.</span></span> <span data-ttu-id="fda8c-144">您可以同時針對擴展集和擴展集內的個別 VM 執行管理作業。</span><span class="sxs-lookup"><span data-stu-id="fda8c-144">You can perform management operations on both scale sets and individual VMs within a scale set.</span></span> <span data-ttu-id="fda8c-145">入口網站也提供可自訂的資源使用量圖表。</span><span class="sxs-lookup"><span data-stu-id="fda8c-145">The portal also provides a customizable resource usage graph.</span></span> 

<span data-ttu-id="fda8c-146">如果您需要檢視或編輯 Azure 資源的基礎 JSON 定義，您也可以使用 [Azure 資源總管](https://resources.azure.com)。</span><span class="sxs-lookup"><span data-stu-id="fda8c-146">If you need to see or edit the underlying JSON definition of an Azure resource, you can also use [Azure Resource Explorer](https://resources.azure.com).</span></span> <span data-ttu-id="fda8c-147">擴展集是 Microsoft.Compute Azure 資源提供者之下的一項資源。</span><span class="sxs-lookup"><span data-stu-id="fda8c-147">Scale sets are a resource under the Microsoft.Compute Azure resource provider.</span></span> <span data-ttu-id="fda8c-148">從這個網站，您可以展開下列連結加以檢視：</span><span class="sxs-lookup"><span data-stu-id="fda8c-148">From this site, you can see them by expanding the following links:</span></span>

<span data-ttu-id="fda8c-149">訂用帳戶 > 您的訂用帳戶 > resourceGroups > 提供者 > Microsoft.Compute > virtualMachineScaleSets > 您的擴展集 > 等等</span><span class="sxs-lookup"><span data-stu-id="fda8c-149">**Subscriptions** > **your subscription** > **resourceGroups** > **providers** > **Microsoft.Compute** > **virtualMachineScaleSets** > **your scale set** > etc.</span></span>

## <a name="scale-set-scenarios"></a><span data-ttu-id="fda8c-150">擴展集案例</span><span class="sxs-lookup"><span data-stu-id="fda8c-150">Scale set scenarios</span></span>
<span data-ttu-id="fda8c-151">本節列出一些典型的擴展集案例。</span><span class="sxs-lookup"><span data-stu-id="fda8c-151">This section lists some typical scale set scenarios.</span></span> <span data-ttu-id="fda8c-152">某些較高階的 Azure 服務 (例如 Batch、Service Fabric 和 Container Service) 會使用這些案例。</span><span class="sxs-lookup"><span data-stu-id="fda8c-152">Some higher-level Azure services (like Batch, Service Fabric, and Container Service) use these scenarios.</span></span>

* <span data-ttu-id="fda8c-153">**使用 RDP 或 SSH 連線至擴展集執行個體**：擴展集會建立於虛擬網路內，且預設不會為擴展集中的個別 VM 配置公用 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="fda8c-153">**Use RDP or SSH to connect to scale set instances**: A scale set is created inside a virtual network, and individual VMs in the scale set are not allocated public IP addresses by default.</span></span> <span data-ttu-id="fda8c-154">此原則可避免因為要對計算方格中的所有節點配置個別公用 IP 位址而產生的支出與管理負擔。</span><span class="sxs-lookup"><span data-stu-id="fda8c-154">This policy avoids the expense and management overhead of allocating separate public IP addresses to all the nodes in your compute grid.</span></span> <span data-ttu-id="fda8c-155">如果您需要與擴展集 VM 建立直接外部連線，可以將擴展集設定為自動指派公用 IP 位址給新的 VM。</span><span class="sxs-lookup"><span data-stu-id="fda8c-155">If you do need direct external connections to scale set VMs, you can configure a scale set to automatically assign public IP addresses to new VMs.</span></span> <span data-ttu-id="fda8c-156">或是，您可以從虛擬網路中可配置公用 IP 位址的其他資源連線至 VM，例如負載平衡器和獨立虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="fda8c-156">Alternatively you can connect to VMs from other resources in your virtual network that can be allocated public IP addresses, for example, load balancers and standalone virtual machines.</span></span> 
* <span data-ttu-id="fda8c-157">**使用 NAT 規則連線至 VM**：您可以建立一個公用 IP 位址、將它指派給負載平衡器，然後定義輸入 NAT 集區。</span><span class="sxs-lookup"><span data-stu-id="fda8c-157">**Connect to VMs by using NAT rules**: You can create a public IP address, assign it to a load balancer, and define an inbound NAT pool.</span></span> <span data-ttu-id="fda8c-158">這些動作會將 IP 位址的連接埠對應至擴展集中某部 VM 的連接埠。</span><span class="sxs-lookup"><span data-stu-id="fda8c-158">These actions map ports on the IP address to a port on a VM in the scale set.</span></span> <span data-ttu-id="fda8c-159">例如：</span><span class="sxs-lookup"><span data-stu-id="fda8c-159">For example:</span></span>
  
  | <span data-ttu-id="fda8c-160">來源</span><span class="sxs-lookup"><span data-stu-id="fda8c-160">Source</span></span> | <span data-ttu-id="fda8c-161">來源連接埠</span><span class="sxs-lookup"><span data-stu-id="fda8c-161">Source port</span></span> | <span data-ttu-id="fda8c-162">目的地</span><span class="sxs-lookup"><span data-stu-id="fda8c-162">Destination</span></span> | <span data-ttu-id="fda8c-163">目的地連接埠</span><span class="sxs-lookup"><span data-stu-id="fda8c-163">Destination port</span></span> |
  | --- | --- | --- | --- |
  |  <span data-ttu-id="fda8c-164">公用 IP</span><span class="sxs-lookup"><span data-stu-id="fda8c-164">Public IP</span></span> |<span data-ttu-id="fda8c-165">連接埠 50000</span><span class="sxs-lookup"><span data-stu-id="fda8c-165">Port 50000</span></span> |<span data-ttu-id="fda8c-166">vmss\_0</span><span class="sxs-lookup"><span data-stu-id="fda8c-166">vmss\_0</span></span> |<span data-ttu-id="fda8c-167">連接埠 22</span><span class="sxs-lookup"><span data-stu-id="fda8c-167">Port 22</span></span> |
  |  <span data-ttu-id="fda8c-168">公用 IP</span><span class="sxs-lookup"><span data-stu-id="fda8c-168">Public IP</span></span> |<span data-ttu-id="fda8c-169">連接埠 50001</span><span class="sxs-lookup"><span data-stu-id="fda8c-169">Port 50001</span></span> |<span data-ttu-id="fda8c-170">vmss\_1</span><span class="sxs-lookup"><span data-stu-id="fda8c-170">vmss\_1</span></span> |<span data-ttu-id="fda8c-171">連接埠 22</span><span class="sxs-lookup"><span data-stu-id="fda8c-171">Port 22</span></span> |
  |  <span data-ttu-id="fda8c-172">公用 IP</span><span class="sxs-lookup"><span data-stu-id="fda8c-172">Public IP</span></span> |<span data-ttu-id="fda8c-173">連接埠 50002</span><span class="sxs-lookup"><span data-stu-id="fda8c-173">Port 50002</span></span> |<span data-ttu-id="fda8c-174">vmss\_2</span><span class="sxs-lookup"><span data-stu-id="fda8c-174">vmss\_2</span></span> |<span data-ttu-id="fda8c-175">連接埠 22</span><span class="sxs-lookup"><span data-stu-id="fda8c-175">Port 22</span></span> |
  
   <span data-ttu-id="fda8c-176">[此範例](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-nat)會定義 NAT 規則，以便能使用單一公用 IP 位址，對擴展集內的每部 VM 進行 SSH 連線。</span><span class="sxs-lookup"><span data-stu-id="fda8c-176">In [this example](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-nat), NAT rules are defined to enable an SSH connection to every VM in a scale set, by using a single public IP address.</span></span>
  
   <span data-ttu-id="fda8c-177">[此範例](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-nat)同樣適用於 RDP 和 Windows。</span><span class="sxs-lookup"><span data-stu-id="fda8c-177">[This example](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-nat) does the same with RDP and Windows.</span></span>
* <span data-ttu-id="fda8c-178">**使用 "jumpbox" 連線至 VM**：如果您在相同的虛擬網路中建立擴展集和獨立 VM，則獨立 VM 與擴展集 VM 可使用虛擬網路或子網路為它們定義的內部 IP 位址彼此連線。</span><span class="sxs-lookup"><span data-stu-id="fda8c-178">**Connect to VMs by using a "jumpbox"**: If you create a scale set and a standalone VM in the same virtual network, the standalone VM and the scale set VM can connect to one another by using their internal IP addresses, as defined by the virtual network or subnet.</span></span> <span data-ttu-id="fda8c-179">如果您建立公用 IP 位址，並將它指派給獨立 VM，您可以使用 RDP 或 SSH 連線至獨立 VM。</span><span class="sxs-lookup"><span data-stu-id="fda8c-179">If you create a public IP address and assign it to the standalone VM, you can use RDP or SSH to connect to the standalone VM.</span></span> <span data-ttu-id="fda8c-180">您可以接著從該部機器連線到擴展集執行個體。</span><span class="sxs-lookup"><span data-stu-id="fda8c-180">You can then connect from that machine to your scale set instances.</span></span> <span data-ttu-id="fda8c-181">此時您可能會發現，簡易擴展集在本質上比在預設組態中設定了公用 IP 位址的獨立 VM 來得安全。</span><span class="sxs-lookup"><span data-stu-id="fda8c-181">You might notice at this point that a simple scale set is inherently more secure than a simple standalone VM with a public IP address in its default configuration.</span></span>
  
   <span data-ttu-id="fda8c-182">例如，[此範本](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-jumpbox)會部署具有一部獨立 VM 的簡單擴展集。</span><span class="sxs-lookup"><span data-stu-id="fda8c-182">For example, [this template](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-jumpbox) deploys a simple scale set with a standalone VM.</span></span> 
* <span data-ttu-id="fda8c-183">**對擴展集執行個體進行負載平衡**：如果您想要使用「循環配置資源」方法來將工作傳送到 VM 的計算叢集，您可以使用第 4 層負載平衡規則據以設定 Azure Load Balancer。</span><span class="sxs-lookup"><span data-stu-id="fda8c-183">**Load balancing to scale set instances**: If you want to deliver work to a compute cluster of VMs by using a round-robin approach, you can configure an Azure load balancer with layer-4 load-balancing rules accordingly.</span></span> <span data-ttu-id="fda8c-184">您可以定義探查，藉由使用指定的通訊協定、間隔和要求路徑對連接埠執行 ping，以驗證您的應用程式正在執行中。</span><span class="sxs-lookup"><span data-stu-id="fda8c-184">You can define probes to verify that your application is running by pinging ports with a specified protocol, interval, and request path.</span></span> <span data-ttu-id="fda8c-185">[Azure 應用程式閘道](https://azure.microsoft.com/services/application-gateway/)也支援擴展集，以及第 7 層和更複雜的負載平衡案例。</span><span class="sxs-lookup"><span data-stu-id="fda8c-185">[Azure Application Gateway](https://azure.microsoft.com/services/application-gateway/) also supports scale sets, along with layer-7 and more sophisticated load-balancing scenarios.</span></span>
  
   <span data-ttu-id="fda8c-186">[此範例](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-ubuntu-web-ssl)會建立執行 Apache Web 伺服器的擴展集，並使用負載平衡器來平衡每部 VM 收到的負載。</span><span class="sxs-lookup"><span data-stu-id="fda8c-186">[This example](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-ubuntu-web-ssl) creates a scale set that runs Apache web servers, and it uses a load balancer to balance the load that each VM receives.</span></span> <span data-ttu-id="fda8c-187">(請查看 Microsoft.Network/loadBalancers 資源類型，以及 virtualMachineScaleSet 中的 networkProfile 和 extensionProfile。)</span><span class="sxs-lookup"><span data-stu-id="fda8c-187">(Look at the Microsoft.Network/loadBalancers resource type and networkProfile and extensionProfile in virtualMachineScaleSet.)</span></span>

   <span data-ttu-id="fda8c-188">[此 Linux 範例](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-ubuntu-app-gateway)和[此 Windows 範例](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-app-gateway)均使用應用程式閘道。</span><span class="sxs-lookup"><span data-stu-id="fda8c-188">[This Linux example](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-ubuntu-app-gateway) and [this Windows example](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-app-gateway) use Application Gateway.</span></span>  

* <span data-ttu-id="fda8c-189">**在 PaaS 叢集管理員中，將擴展集部署為計算叢集**：擴展集有時會被稱為新一代的背景工作角色。</span><span class="sxs-lookup"><span data-stu-id="fda8c-189">**Deploying a scale set as a compute cluster in a PaaS cluster manager**: Scale sets are sometimes described as a next-generation worker role.</span></span> <span data-ttu-id="fda8c-190">雖然是有效的說明，但這可能會導致擴展集功能與 Azure 雲端服務功能發生混淆。</span><span class="sxs-lookup"><span data-stu-id="fda8c-190">Though a valid description, it does run the risk of confusing scale set features with Azure Cloud Services features.</span></span> <span data-ttu-id="fda8c-191">就某方面來說，擴展集提供了真正的背景工作角色或背景工作資源。</span><span class="sxs-lookup"><span data-stu-id="fda8c-191">In a sense, scale sets provide a true worker role or worker resource.</span></span> <span data-ttu-id="fda8c-192">因為它們是不會隨平台/執行階段而改變、可自訂且整合至 Azure Resource Manager IaaS 的一般化計算資源。</span><span class="sxs-lookup"><span data-stu-id="fda8c-192">They are a generalized compute resource that is platform/runtime independent, is customizable, and integrates into Azure Resource Manager IaaS.</span></span>
  
   <span data-ttu-id="fda8c-193">雲端服務背景工作角色的平台/執行階段支援有限 (僅限 Windows 平台映像)。</span><span class="sxs-lookup"><span data-stu-id="fda8c-193">A Cloud Services worker role is limited in terms of platform/runtime support (Windows platform images only).</span></span> <span data-ttu-id="fda8c-194">但它也包含一些服務，例如 VIP 交換、可設定的升級設定，以及執行階段/應用程式部署特定設定。</span><span class="sxs-lookup"><span data-stu-id="fda8c-194">But it also includes services such as VIP swap, configurable upgrade settings, and runtime/app deployment-specific settings.</span></span> <span data-ttu-id="fda8c-195">這些服務「尚未」在擴展集中提供，或由其他較高層級的 PaaS 服務 (例如 Azure Service Fabric) 傳遞。</span><span class="sxs-lookup"><span data-stu-id="fda8c-195">These services are not *yet* available in scale sets, or they're delivered by other higher-level PaaS services like Azure Service Fabric.</span></span> <span data-ttu-id="fda8c-196">您可以將擴展集視為可支援 PaaS 的基礎結構。</span><span class="sxs-lookup"><span data-stu-id="fda8c-196">You can look at scale sets as an infrastructure that supports PaaS.</span></span> <span data-ttu-id="fda8c-197">[Service Fabric](https://azure.microsoft.com/services/service-fabric/) 之類的 PaaS 解決方案會建置在這個基礎結構上。</span><span class="sxs-lookup"><span data-stu-id="fda8c-197">PaaS solutions like [Service Fabric](https://azure.microsoft.com/services/service-fabric/) build on this infrastructure.</span></span>
  
   <span data-ttu-id="fda8c-198">在這個方法的[此範例](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-dcos)中，[Azure Container Service](https://azure.microsoft.com/services/container-service/) 會根據具有容器協調器的擴展集來部署叢集。</span><span class="sxs-lookup"><span data-stu-id="fda8c-198">In [this example](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-dcos) of this approach, [Azure Container Service](https://azure.microsoft.com/services/container-service/) deploys a cluster based on scale sets with a container orchestrator.</span></span>

## <a name="scale-set-performance-and-scale-guidance"></a><span data-ttu-id="fda8c-199">擴展集的效能和調整指南</span><span class="sxs-lookup"><span data-stu-id="fda8c-199">Scale set performance and scale guidance</span></span>
* <span data-ttu-id="fda8c-200">一個擴展集可支援多達 1,000 部 VM。</span><span class="sxs-lookup"><span data-stu-id="fda8c-200">A scale set supports up to 1,000 VMs.</span></span> <span data-ttu-id="fda8c-201">如果您建立並上傳自己的自訂 VM 映像，則限制為 100 個。</span><span class="sxs-lookup"><span data-stu-id="fda8c-201">If you create and upload your own custom VM images, the limit is 100.</span></span> <span data-ttu-id="fda8c-202">如需大型擴展集的使用考量，請參閱[使用大型的虛擬機器擴展集](virtual-machine-scale-sets-placement-groups.md)。</span><span class="sxs-lookup"><span data-stu-id="fda8c-202">For considerations in using large scale sets, see [Working with large virtual machine scale sets](virtual-machine-scale-sets-placement-groups.md).</span></span>
* <span data-ttu-id="fda8c-203">您不必預先建立 Azure 儲存體帳戶就能使用擴展集。</span><span class="sxs-lookup"><span data-stu-id="fda8c-203">You do not have to pre-create Azure storage accounts to use scale sets.</span></span> <span data-ttu-id="fda8c-204">擴展集支援 Azure 受控磁碟，能打消關於每個儲存體帳戶之磁碟數目的效能疑慮。</span><span class="sxs-lookup"><span data-stu-id="fda8c-204">Scale sets support Azure managed disks, which negate performance concerns about the number of disks per storage account.</span></span> <span data-ttu-id="fda8c-205">如需詳細資訊，請參閱 [Azure 虛擬機器擴展集和受控磁碟](virtual-machine-scale-sets-managed-disks.md)。</span><span class="sxs-lookup"><span data-stu-id="fda8c-205">For more information, see [Azure virtual machine scale sets and managed disks](virtual-machine-scale-sets-managed-disks.md).</span></span>
* <span data-ttu-id="fda8c-206">請考慮使用 Azure 進階儲存體而非 Azure 儲存體，來提升 VM 佈建時間的速度和可預測性，並改善 IO 效能。</span><span class="sxs-lookup"><span data-stu-id="fda8c-206">Consider using Azure Premium Storage instead of Azure Storage for faster, more predictable VM provisioning times and improved I/O performance.</span></span>
* <span data-ttu-id="fda8c-207">您正在部署之區域的核心配額會限制您可以建立的 VM 數目。</span><span class="sxs-lookup"><span data-stu-id="fda8c-207">The core quota in the region in which you are deploying limits the number of VMs you can create.</span></span> <span data-ttu-id="fda8c-208">您可能需要連絡客戶支援人員，以提高您的計算配額限制，即使您目前用於 Azure 雲端服務的核心已具有較高的上限亦然。</span><span class="sxs-lookup"><span data-stu-id="fda8c-208">You might need to contact Customer Support to increase your compute quota limit, even if you have a high limit of cores for use with Azure Cloud Services today.</span></span> <span data-ttu-id="fda8c-209">若要查詢您的配額，請執行此 Azure CLI 命令︰`azure vm list-usage`。</span><span class="sxs-lookup"><span data-stu-id="fda8c-209">To query your quota, run this Azure CLI command: `azure vm list-usage`.</span></span> <span data-ttu-id="fda8c-210">或者，執行此 PowerShell 命令︰`Get-AzureRmVMUsage`。</span><span class="sxs-lookup"><span data-stu-id="fda8c-210">Or, run this PowerShell command: `Get-AzureRmVMUsage`.</span></span>

## <a name="frequently-asked-questions-for-scale-sets"></a><span data-ttu-id="fda8c-211">擴展集的常見問題集</span><span class="sxs-lookup"><span data-stu-id="fda8c-211">Frequently asked questions for scale sets</span></span>
<span data-ttu-id="fda8c-212">**問：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-212">**Q.**</span></span> <span data-ttu-id="fda8c-213">擴展集內可以有多少部 VM？</span><span class="sxs-lookup"><span data-stu-id="fda8c-213">How many VMs can I have in a scale set?</span></span>

<span data-ttu-id="fda8c-214">**答：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-214">**A.**</span></span> <span data-ttu-id="fda8c-215">擴展集可以有 0 到 1,000 部以平台映像為基礎的 VM，或 0-100 部以自訂映像為基礎的 VM。</span><span class="sxs-lookup"><span data-stu-id="fda8c-215">A scale set can have 0 to 1,000 VMs based on platform images, or 0 to 100 VMs based on custom images.</span></span> 

<span data-ttu-id="fda8c-216">**問：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-216">**Q.**</span></span> <span data-ttu-id="fda8c-217">在擴展集內是否支援資料磁碟？</span><span class="sxs-lookup"><span data-stu-id="fda8c-217">Are data disks supported within scale sets?</span></span>

<span data-ttu-id="fda8c-218">**答：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-218">**A.**</span></span> <span data-ttu-id="fda8c-219">是。</span><span class="sxs-lookup"><span data-stu-id="fda8c-219">Yes.</span></span> <span data-ttu-id="fda8c-220">擴展集可以定義套用至集合中所有 VM 的連結資料磁碟組態。</span><span class="sxs-lookup"><span data-stu-id="fda8c-220">A scale set can define an attached data disks configuration that applies to all VMs in the set.</span></span> <span data-ttu-id="fda8c-221">如需詳細資訊，請參閱 [Azure 擴展集和連結的資料磁碟](virtual-machine-scale-sets-attached-disks.md)。</span><span class="sxs-lookup"><span data-stu-id="fda8c-221">For more information, see [Azure scale sets and attached data disks](virtual-machine-scale-sets-attached-disks.md).</span></span> <span data-ttu-id="fda8c-222">其他用於儲存資料的選項包括：</span><span class="sxs-lookup"><span data-stu-id="fda8c-222">Other options for storing data include:</span></span>

* <span data-ttu-id="fda8c-223">Azure 檔案 (SMB 共用磁碟機)</span><span class="sxs-lookup"><span data-stu-id="fda8c-223">Azure files (SMB shared drives)</span></span>
* <span data-ttu-id="fda8c-224">OS 磁碟機</span><span class="sxs-lookup"><span data-stu-id="fda8c-224">OS drive</span></span>
* <span data-ttu-id="fda8c-225">暫存磁碟機 (本機，未受 Azure 儲存體支援)</span><span class="sxs-lookup"><span data-stu-id="fda8c-225">Temp drive (local, not backed by Azure Storage)</span></span>
* <span data-ttu-id="fda8c-226">Azure 資料服務 (例如 Azure 資料表、Azure Blob)</span><span class="sxs-lookup"><span data-stu-id="fda8c-226">Azure data service (for example, Azure tables, Azure blobs)</span></span>
* <span data-ttu-id="fda8c-227">外部資料服務 (例如遠端資料庫)</span><span class="sxs-lookup"><span data-stu-id="fda8c-227">External data service (for example, remote database)</span></span>

<span data-ttu-id="fda8c-228">**問：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-228">**Q.**</span></span> <span data-ttu-id="fda8c-229">哪些 Azure 區域支援擴展集？</span><span class="sxs-lookup"><span data-stu-id="fda8c-229">Which Azure regions support scale sets?</span></span>

<span data-ttu-id="fda8c-230">**答：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-230">**A.**</span></span> <span data-ttu-id="fda8c-231">所有區域都支援擴展集。</span><span class="sxs-lookup"><span data-stu-id="fda8c-231">All regions support scale sets.</span></span>

<span data-ttu-id="fda8c-232">**問：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-232">**Q.**</span></span> <span data-ttu-id="fda8c-233">如何使用自訂映像建立擴展集？</span><span class="sxs-lookup"><span data-stu-id="fda8c-233">How do I create a scale set by using a custom image?</span></span>

<span data-ttu-id="fda8c-234">**答：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-234">**A.**</span></span> <span data-ttu-id="fda8c-235">根據自訂映像 VHD 建立受控磁碟，並在擴展集範本中參考它。</span><span class="sxs-lookup"><span data-stu-id="fda8c-235">Create a managed disk based on your custom image VHD and reference it in your scale set template.</span></span> <span data-ttu-id="fda8c-236">[以下是範例](https://github.com/chagarw/MDPP/tree/master/101-vmss-custom-os)。</span><span class="sxs-lookup"><span data-stu-id="fda8c-236">[Here's an example](https://github.com/chagarw/MDPP/tree/master/101-vmss-custom-os).</span></span>

<span data-ttu-id="fda8c-237">**問：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-237">**Q.**</span></span> <span data-ttu-id="fda8c-238">如果我將擴展集容量從 20 減少為 15，哪些 VM 會被移除？</span><span class="sxs-lookup"><span data-stu-id="fda8c-238">If I reduce my scale set capacity from 20 to 15, which VMs are removed?</span></span>

<span data-ttu-id="fda8c-239">**答：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-239">**A.**</span></span> <span data-ttu-id="fda8c-240">虛擬機器會跨更新網域和容錯網域從擴展集平均地移除，以達到最大的可用性。</span><span class="sxs-lookup"><span data-stu-id="fda8c-240">Virtual machines are removed from the scale set evenly across update domains and fault domains to maximize availability.</span></span> <span data-ttu-id="fda8c-241">系統會先移除具有最高識別碼的 VM。</span><span class="sxs-lookup"><span data-stu-id="fda8c-241">VMs with the highest IDs are removed first.</span></span>

<span data-ttu-id="fda8c-242">**問：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-242">**Q.**</span></span> <span data-ttu-id="fda8c-243">如果我後續又將容量從 15 增加到 18 呢？</span><span class="sxs-lookup"><span data-stu-id="fda8c-243">What if I then increase the capacity from 15 to 18?</span></span>

<span data-ttu-id="fda8c-244">**答：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-244">**A.**</span></span> <span data-ttu-id="fda8c-245">如果您將容量增加到 18，則會建立 3 個新的 VM。</span><span class="sxs-lookup"><span data-stu-id="fda8c-245">If you increase capacity to 18, then 3 new VMs are created.</span></span> <span data-ttu-id="fda8c-246">每次 VM 執行個體識別碼都會從上一個最高值遞增 (例如 20、21、22)。</span><span class="sxs-lookup"><span data-stu-id="fda8c-246">Each time, the VM instance ID is incremented from the previous highest value (for example, 20, 21, 22).</span></span> <span data-ttu-id="fda8c-247">VM 會平衡分散到容錯網域和更新網域。</span><span class="sxs-lookup"><span data-stu-id="fda8c-247">VMs are balanced across fault domains and update domains.</span></span>

<span data-ttu-id="fda8c-248">**問：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-248">**Q.**</span></span> <span data-ttu-id="fda8c-249">在擴展集內使用多個延伸模組時，是否可以強制執行「執行順序」？</span><span class="sxs-lookup"><span data-stu-id="fda8c-249">When I'm using multiple extensions in a scale set, can I enforce an execution sequence?</span></span>

<span data-ttu-id="fda8c-250">**答：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-250">**A.**</span></span> <span data-ttu-id="fda8c-251">不是直接，但針對 customScript 擴充，您的指令碼可以等候另一個擴充完成。</span><span class="sxs-lookup"><span data-stu-id="fda8c-251">Not directly, but for the customScript extension, your script can wait for another extension to finish.</span></span> <span data-ttu-id="fda8c-252">您可以在部落格文章︰ [Extension Sequencing in Azure VM Scale Sets (Azure VM 擴展集中的擴充排序)](https://msftstack.wordpress.com/2016/05/12/extension-sequencing-in-azure-vm-scale-sets/) 中取得有關擴充排序的其他指導方針。</span><span class="sxs-lookup"><span data-stu-id="fda8c-252">You can get additional guidance on extension sequencing in the blog post [Extension Sequencing in Azure VM Scale Sets](https://msftstack.wordpress.com/2016/05/12/extension-sequencing-in-azure-vm-scale-sets/).</span></span>

<span data-ttu-id="fda8c-253">**問：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-253">**Q.**</span></span> <span data-ttu-id="fda8c-254">擴展集是否可與 Azure 可用性設定組組搭配使用？</span><span class="sxs-lookup"><span data-stu-id="fda8c-254">Do scale sets work with Azure availability sets?</span></span>

<span data-ttu-id="fda8c-255">**答：**</span><span class="sxs-lookup"><span data-stu-id="fda8c-255">**A.**</span></span> <span data-ttu-id="fda8c-256">是。</span><span class="sxs-lookup"><span data-stu-id="fda8c-256">Yes.</span></span> <span data-ttu-id="fda8c-257">擴展集是隱含的可用性設定組，具有 5 個容錯網域和 5 個更新網域。</span><span class="sxs-lookup"><span data-stu-id="fda8c-257">A scale set is an implicit availability set with 5 fault domains and 5 update domains.</span></span> <span data-ttu-id="fda8c-258">超過 100 個 VM 的擴展集橫跨多個「放置群組」，這相當於多個可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="fda8c-258">Scale sets of more than 100 VMs span multiple *placement groups*, which are equivalent to multiple availability sets.</span></span> <span data-ttu-id="fda8c-259">如需放置群組的詳細資訊，請參閱[使用大型的虛擬機器擴展集](virtual-machine-scale-sets-placement-groups.md)。</span><span class="sxs-lookup"><span data-stu-id="fda8c-259">For more information about placement groups, see [Working with large virtual machine scale sets](virtual-machine-scale-sets-placement-groups.md).</span></span> <span data-ttu-id="fda8c-260">VM 的可用性設定組可以存在於與 VM 擴展集相同的虛擬網路中。</span><span class="sxs-lookup"><span data-stu-id="fda8c-260">An availability set of VMs can exist in the same virtual network as a scale set of VMs.</span></span> <span data-ttu-id="fda8c-261">常見組態是在可用性設定組中放入控制節點 VM (其通常需要唯一組態)，以及在擴展集中放入資料節點。</span><span class="sxs-lookup"><span data-stu-id="fda8c-261">A common configuration is to put control node VMs (which often require unique configuration) in an availability set and put data nodes in the scale set.</span></span>

<span data-ttu-id="fda8c-262">您可以在 [Azure 虛擬機器擴展集常見問題集](virtual-machine-scale-sets-faq.md)中找到更多擴展集相關問題的答案。</span><span class="sxs-lookup"><span data-stu-id="fda8c-262">You can find more answers to questions about scale sets in the [Azure virtual machine scale sets FAQ](virtual-machine-scale-sets-faq.md).</span></span>
