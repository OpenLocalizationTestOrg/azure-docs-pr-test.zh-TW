---
title: "Service Fabric 應用程式的容量規劃 | Microsoft Docs"
description: "描述如何識別 Service Fabric 應用程式所需的計算節點的數目"
services: service-fabric
documentationcenter: .net
author: mani-ramaswamy
manager: markfuss
editor: 
ms.assetid: 9fa47be0-50a2-4a51-84a5-20992af94bea
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 8/9/2017
ms.author: subramar
ms.openlocfilehash: fc98bdd8b3597810b0c07563af507e93c611f769
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/18/2017
---
# <a name="capacity-planning-for-service-fabric-applications"></a><span data-ttu-id="1b77d-103">Service Fabric 應用程式的容量規劃</span><span class="sxs-lookup"><span data-stu-id="1b77d-103">Capacity planning for Service Fabric applications</span></span>
<span data-ttu-id="1b77d-104">本文將說明您如何估計執行 Azure Service Fabric 應用程式所需的資源量 (CPU、RAM、磁碟儲存空間)。</span><span class="sxs-lookup"><span data-stu-id="1b77d-104">This document teaches you how to estimate the amount of resources (CPUs, RAM, disk storage) you need to run your Azure Service Fabric applications.</span></span> <span data-ttu-id="1b77d-105">資源需求隨著時間改變是很常見的。</span><span class="sxs-lookup"><span data-stu-id="1b77d-105">It is common for your resource requirements to change over time.</span></span> <span data-ttu-id="1b77d-106">開發/測試您的服務時通常需要少數資源，之後進入生產環境且您的應用程式受歡迎度增長時會需要更多資源。</span><span class="sxs-lookup"><span data-stu-id="1b77d-106">You typically require few resources as you develop/test your service, and then require more resources as you go into production and your application grows in popularity.</span></span> <span data-ttu-id="1b77d-107">設計您的應用程式時，請考慮長期需求，並且選擇可讓您調整以符合高度客戶需求的服務。</span><span class="sxs-lookup"><span data-stu-id="1b77d-107">When you design your application, think through the long-term requirements and make choices that allow your service to scale to meet high customer demand.</span></span>

 <span data-ttu-id="1b77d-108">建立 Service Fabric 叢集時，您要決定組成叢集的虛擬機器 (VM) 類型。</span><span class="sxs-lookup"><span data-stu-id="1b77d-108">When you create a Service Fabric cluster, you decide what kinds of virtual machines (VMs) make up the cluster.</span></span> <span data-ttu-id="1b77d-109">每個 VM 會以 CPU (核心和速度)、網路頻寬、RAM 和磁碟儲存空間的形式隨附有限數量的資源。</span><span class="sxs-lookup"><span data-stu-id="1b77d-109">Each VM comes with a limited amount of resources in the form of CPUs (cores and speed), network bandwidth, RAM, and disk storage.</span></span> <span data-ttu-id="1b77d-110">當您的服務隨著時間成長時，可以升級為可提供更大量資源的 VM 和/或加入更多 VM 至您的叢集。</span><span class="sxs-lookup"><span data-stu-id="1b77d-110">As your service grows over time, you can upgrade to VMs that offer greater resources and/or add more VMs to your cluster.</span></span> <span data-ttu-id="1b77d-111">若要執行後者，您必須一開始就架構您的服務，讓服務可以利用新 VM 動態加入叢集的優點。</span><span class="sxs-lookup"><span data-stu-id="1b77d-111">To do the latter, you must architect your service initially so it can take advantage of new VMs that get dynamically added to the cluster.</span></span>

<span data-ttu-id="1b77d-112">部分服務本身可管理 VM 上的少數資料或皆不管理。</span><span class="sxs-lookup"><span data-stu-id="1b77d-112">Some services manage little to no data on the VMs themselves.</span></span> <span data-ttu-id="1b77d-113">因此，這些服務的容量規劃應主要著重在效能，這表示要選取適當的 VM CPU (核心和速度)。</span><span class="sxs-lookup"><span data-stu-id="1b77d-113">Therefore, capacity planning for these services should focus primarily on performance, which means selecting the appropriate CPUs (cores and speed) of the VMs.</span></span> <span data-ttu-id="1b77d-114">此外，您應該考慮網路頻寬，包括發生網路傳輸的頻率特別以及要傳送的資料量。</span><span class="sxs-lookup"><span data-stu-id="1b77d-114">In addition, you should consider network bandwidth, including how frequently network transfers are occurring and how much data is being transferred.</span></span> <span data-ttu-id="1b77d-115">如果隨著服務使用量增加時，您的服務需要執行良好，您可以加入更多 VM 到叢集，並跨所有 VM 將網路要求負載平衡。</span><span class="sxs-lookup"><span data-stu-id="1b77d-115">If your service needs to perform well as service usage increases, you can add more VMs to the cluster and load balance the network requests across all the VMs.</span></span>

<span data-ttu-id="1b77d-116">如果是管理 VM 上大量資料的服務，容量規劃應主要著重在大小。</span><span class="sxs-lookup"><span data-stu-id="1b77d-116">For services that manage large amounts of data on the VMs, capacity planning should focus primarily on size.</span></span> <span data-ttu-id="1b77d-117">因此，您應該仔細地考量 VM 的 RAM 和磁碟儲存空間容量。</span><span class="sxs-lookup"><span data-stu-id="1b77d-117">Thus, you should carefully consider the capacity of the VM's RAM and disk storage.</span></span> <span data-ttu-id="1b77d-118">Windows 中的虛擬記憶體管理系統可讓應用程式程式碼將磁碟空間做為 RAM 使用。</span><span class="sxs-lookup"><span data-stu-id="1b77d-118">The virtual memory management system in Windows makes disk space look like RAM to application code.</span></span> <span data-ttu-id="1b77d-119">此外，Service Fabric 執行階段提供智慧型分頁處理，只將熱資料保留在記憶體，而將冷資料移到磁碟。</span><span class="sxs-lookup"><span data-stu-id="1b77d-119">In addition, the Service Fabric runtime provides smart paging keeping only hot data in memory and moving the cold data to disk.</span></span> <span data-ttu-id="1b77d-120">因此應用程式就可以使用比 VM 上實際可用還多的記憶體。</span><span class="sxs-lookup"><span data-stu-id="1b77d-120">Applications can thus use more memory than is physically available on the VM.</span></span> <span data-ttu-id="1b77d-121">有更多 RAM 可完全增加效能，因為 VM 可以在 RAM 中保留更多磁碟儲存空間。</span><span class="sxs-lookup"><span data-stu-id="1b77d-121">Having more RAM simply increases performance, since the VM can keep more disk storage in RAM.</span></span> <span data-ttu-id="1b77d-122">您選取的 VM 要有夠大的磁碟空間來儲存您想要放在 VM 上的資料。</span><span class="sxs-lookup"><span data-stu-id="1b77d-122">The VM you select should have a disk large enough to store the data that you want on the VM.</span></span> <span data-ttu-id="1b77d-123">同樣地，VM 也要有足夠的 RAM，提供您想要的效能。</span><span class="sxs-lookup"><span data-stu-id="1b77d-123">Similarly, the VM should have enough RAM to provide you with the performance you desire.</span></span> <span data-ttu-id="1b77d-124">如果您的服務隨著時間成長，您可以加入更多 VM 到叢集，並跨所有 VM 分割資料。</span><span class="sxs-lookup"><span data-stu-id="1b77d-124">If your service's data grows over time, you can add more VMs to the cluster and partition the data across all the VMs.</span></span>

## <a name="determine-how-many-nodes-you-need"></a><span data-ttu-id="1b77d-125">決定您需要多少個節點</span><span class="sxs-lookup"><span data-stu-id="1b77d-125">Determine how many nodes you need</span></span>
<span data-ttu-id="1b77d-126">將您的服務進行分割，可讓您相應放大您的服務資料。</span><span class="sxs-lookup"><span data-stu-id="1b77d-126">Partitioning your service allows you to scale out your service's data.</span></span> <span data-ttu-id="1b77d-127">如需有關分割的詳細資訊，請參閱 [分割 Service Fabric](service-fabric-concepts-partitioning.md)。</span><span class="sxs-lookup"><span data-stu-id="1b77d-127">For more information on partitioning, see [Partitioning Service Fabric](service-fabric-concepts-partitioning.md).</span></span> <span data-ttu-id="1b77d-128">必須將每個資料分割納入單一 VM，但是可以將多個 (小型) 資料分割放在單一 VM 上。</span><span class="sxs-lookup"><span data-stu-id="1b77d-128">Each partition must fit within a single VM, but multiple (small) partitions can be placed on a single VM.</span></span> <span data-ttu-id="1b77d-129">因此，如果有比較多的小型資料分割，比起有比較少的大型資料分割，可提供您更大的彈性。</span><span class="sxs-lookup"><span data-stu-id="1b77d-129">So, having more small partitions gives you greater flexibility than having a few larger partitions.</span></span> <span data-ttu-id="1b77d-130">缺點是有很多資料分割會增加 Service Fabric 的負擔，並且您無法跨資料分割執行交易的作業。</span><span class="sxs-lookup"><span data-stu-id="1b77d-130">The trade-off is that having lots of partitions increases Service Fabric overhead and you cannot perform transacted operations across partitions.</span></span> <span data-ttu-id="1b77d-131">如果您的服務程式碼經常需要存取位於不同的資料分割的資料片段，也會產生更多潛在的網路流量。</span><span class="sxs-lookup"><span data-stu-id="1b77d-131">There is also more potential network traffic if your service code frequently needs to access pieces of data that live in different partitions.</span></span> <span data-ttu-id="1b77d-132">設計您的服務時，應該仔細考慮這些優缺點，以達成有效的資料分割策略。</span><span class="sxs-lookup"><span data-stu-id="1b77d-132">When designing your service, you should carefully consider these pros and cons to arrive at an effective partitioning strategy.</span></span>

<span data-ttu-id="1b77d-133">假設您的應用程式有單一可設定狀態服務，其具有您預期一年會成長到 DB_Size GB 的存放區大小。</span><span class="sxs-lookup"><span data-stu-id="1b77d-133">Let's assume your application has a single stateful service that has a store size that you expect to grow to DB_Size GB in a year.</span></span> <span data-ttu-id="1b77d-134">您願意在經歷該年的成長以外加入更多應用程式 (與資料分割)。</span><span class="sxs-lookup"><span data-stu-id="1b77d-134">You are willing to add more applications (and partitions) as you experience growth beyond that year.</span></span>  <span data-ttu-id="1b77d-135">複寫因素 (RF) 決定影響總計 DB_Size 的服務複本數目。</span><span class="sxs-lookup"><span data-stu-id="1b77d-135">The replication factor (RF), which determines the number of replicas for your service impacts the total DB_Size.</span></span> <span data-ttu-id="1b77d-136">所有複本的總計 DB_Size 是複寫因素乘以 DB_Size。</span><span class="sxs-lookup"><span data-stu-id="1b77d-136">The total DB_Size across all replicas is the Replication Factor multiplied by DB_Size.</span></span>  <span data-ttu-id="1b77d-137">Node_Size 表示您想要用於服務的每一節點磁碟空間/RAM。</span><span class="sxs-lookup"><span data-stu-id="1b77d-137">Node_Size represents the disk space/RAM per node you want to use for your service.</span></span> <span data-ttu-id="1b77d-138">為了達到最佳效能，DB_Size 應符合整個叢集的記憶體，並且選擇接近 VM RAM 的 Node_Size。</span><span class="sxs-lookup"><span data-stu-id="1b77d-138">For best performance, the DB_Size should fit into memory across the cluster, and a Node_Size that is around the RAM of the VM should be chosen.</span></span> <span data-ttu-id="1b77d-139">如果配置大於 RAM 容量的 Node_Size，您就會依賴 Service Fabric 執行階段提供的分頁處理。</span><span class="sxs-lookup"><span data-stu-id="1b77d-139">By allocating a Node_Size that is larger than the RAM capacity, you are relying on the paging provided by the Service Fabric runtime.</span></span> <span data-ttu-id="1b77d-140">因此，如果整個資料都被視為熱資料 (因為從那時起資料會進入分頁/移出分頁)，您的效能就可能無法達到最佳。</span><span class="sxs-lookup"><span data-stu-id="1b77d-140">Thus, your performance may not be optimal if your entire data is considered to be hot (since then the data is paged in/out).</span></span> <span data-ttu-id="1b77d-141">不過，對只有一部分資料是熱資料的許多服務來說，還是比較具成本效益。</span><span class="sxs-lookup"><span data-stu-id="1b77d-141">However, for many services where only a fraction of the data is hot, it is more cost-effective.</span></span>

<span data-ttu-id="1b77d-142">為了獲得最大效能所需的節點數目，可以依以下方式計算：</span><span class="sxs-lookup"><span data-stu-id="1b77d-142">The number of nodes required for maximum performance can be computed as follows:</span></span>

```
Number of Nodes = (DB_Size * RF)/Node_Size

```


## <a name="account-for-growth"></a><span data-ttu-id="1b77d-143">考慮成長</span><span class="sxs-lookup"><span data-stu-id="1b77d-143">Account for growth</span></span>
<span data-ttu-id="1b77d-144">除了開始使用的 DB_Size，您可能想要根據您預期服務成長的 DB_Size 來計算節點數目。</span><span class="sxs-lookup"><span data-stu-id="1b77d-144">You may want to compute the number of nodes based on the DB_Size that you expect your service to grow to, in addition to the DB_Size that you began with.</span></span> <span data-ttu-id="1b77d-145">然後，隨著服務的成長而讓節點數目成長，使得您不會過度佈建節點數目</span><span class="sxs-lookup"><span data-stu-id="1b77d-145">Then, grow the number of nodes as your service grows so that you are not over-provisioning the number of nodes.</span></span> <span data-ttu-id="1b77d-146">但是，資料分割數目應該基於以最大成長執行您的服務時所需的節點數。</span><span class="sxs-lookup"><span data-stu-id="1b77d-146">But the number of partitions should be based on the number of nodes that are needed when you're running your service at maximum growth.</span></span>

<span data-ttu-id="1b77d-147">最好有一些額外的電腦隨時可用，以便您可以處理任何預期外的尖峰或失敗 (例如有少數 VM 停機)。</span><span class="sxs-lookup"><span data-stu-id="1b77d-147">It is good to have some extra machines available at any time so that you can handle any unexpected spikes or failure (for example, if a few VMs go down).</span></span>  <span data-ttu-id="1b77d-148">雖然這個額外容量要使用您預期的尖峰來決定，但一開始可以多保留幾個 VM (多 5-10%)。</span><span class="sxs-lookup"><span data-stu-id="1b77d-148">While the extra capacity should be determined by using your expected spikes, a starting point is to reserve a few extra VMs (5-10 percent extra).</span></span>

<span data-ttu-id="1b77d-149">以上假設使用單一的具狀態服務。</span><span class="sxs-lookup"><span data-stu-id="1b77d-149">The preceding assumes a single stateful service.</span></span> <span data-ttu-id="1b77d-150">如果您有多個具狀態服務，則必須將與其他服務相關聯的 DB_Size 加入方程式。</span><span class="sxs-lookup"><span data-stu-id="1b77d-150">If you have more than one stateful service, you have to add the DB_Size associated with the other services into the equation.</span></span> <span data-ttu-id="1b77d-151">或者，您可以分別為每個具狀態服務計算節點數目。</span><span class="sxs-lookup"><span data-stu-id="1b77d-151">Alternatively, you can compute the number of nodes separately for each stateful service.</span></span>  <span data-ttu-id="1b77d-152">您的服務的複本或資料分割可能不平衡。</span><span class="sxs-lookup"><span data-stu-id="1b77d-152">Your service may have replicas or partitions that aren't balanced.</span></span> <span data-ttu-id="1b77d-153">請記住，有些資料分割的資料可能比其他資料分割還多。</span><span class="sxs-lookup"><span data-stu-id="1b77d-153">Keep in mind that partitions may also have more data than others.</span></span> <span data-ttu-id="1b77d-154">如需有關分割的詳細資訊，請參閱 [最佳作法的分割文章](service-fabric-concepts-partitioning.md)。</span><span class="sxs-lookup"><span data-stu-id="1b77d-154">For more information on partitioning, see [partitioning article on best practices](service-fabric-concepts-partitioning.md).</span></span> <span data-ttu-id="1b77d-155">不過，上述方程式不受資料分割或複本影響，因為 Service Fabric 會確保複本以最佳化方式分散在節點之間。</span><span class="sxs-lookup"><span data-stu-id="1b77d-155">However, the preceding equation is partition and replica agnostic, because Service Fabric ensures that the replicas are spread out among the nodes in an optimized manner.</span></span>

## <a name="use-a-spreadsheet-for-cost-calculation"></a><span data-ttu-id="1b77d-156">使用試算表進行成本計算</span><span class="sxs-lookup"><span data-stu-id="1b77d-156">Use a spreadsheet for cost calculation</span></span>
<span data-ttu-id="1b77d-157">現在，讓我們在公式中放入一些實際的數字。</span><span class="sxs-lookup"><span data-stu-id="1b77d-157">Now let's put some real numbers in the formula.</span></span> <span data-ttu-id="1b77d-158">[範例試算表](https://servicefabricsdkstorage.blob.core.windows.net/publicrelease/SF%20VM%20Cost%20calculator-NEW.xlsx) 示範如何規劃包含三種資料物件類型的應用程式的容量。</span><span class="sxs-lookup"><span data-stu-id="1b77d-158">An [example spreadsheet](https://servicefabricsdkstorage.blob.core.windows.net/publicrelease/SF%20VM%20Cost%20calculator-NEW.xlsx) shows how to plan the capacity for an application that contains three types of data objects.</span></span> <span data-ttu-id="1b77d-159">針對每個物件，我們會估計其大小以及我們預計具有的物件數。</span><span class="sxs-lookup"><span data-stu-id="1b77d-159">For each object, we approximate its size and how many objects we expect to have.</span></span> <span data-ttu-id="1b77d-160">我們也選取對每個物件類型我們想要的複本數。</span><span class="sxs-lookup"><span data-stu-id="1b77d-160">We also select how many replicas we want of each object type.</span></span> <span data-ttu-id="1b77d-161">試算表會計算要在叢集中儲存的記憶體數量總計。</span><span class="sxs-lookup"><span data-stu-id="1b77d-161">The spreadsheet calculates the total amount of memory to be stored in the cluster.</span></span>

<span data-ttu-id="1b77d-162">然後，我們輸入 VM 大小和每月成本。</span><span class="sxs-lookup"><span data-stu-id="1b77d-162">Then we enter a VM size and monthly cost.</span></span> <span data-ttu-id="1b77d-163">根據 VM 大小，試算表會告訴您必須用來將資料分割的最少分割數量，以實際上納入節點。</span><span class="sxs-lookup"><span data-stu-id="1b77d-163">Based on the VM size, the spreadsheet tells you the minimum number of partitions you must use to split your data to physically fit on the nodes.</span></span> <span data-ttu-id="1b77d-164">您可能想要較大量的資料分割以配合您的應用程式特定的計算和網路流量需求。</span><span class="sxs-lookup"><span data-stu-id="1b77d-164">You may desire a larger number of partitions to accommodate your application's specific computation and network traffic needs.</span></span> <span data-ttu-id="1b77d-165">試算表顯示目前管理使用者設定檔物件的資料分割數目已從 1 增加到 6。</span><span class="sxs-lookup"><span data-stu-id="1b77d-165">The spreadsheet shows the number of partitions that are managing the user profile objects has increased from one to six.</span></span>

<span data-ttu-id="1b77d-166">現在，根據這所有資訊，試算表會顯示您可以實際上取得在具有 26 個節點的叢集上所需的資料分割和複本的所有資料。</span><span class="sxs-lookup"><span data-stu-id="1b77d-166">Now, based on all this information, the spreadsheet shows that you could physically get all the data with the desired partitions and replicas on a 26-node cluster.</span></span> <span data-ttu-id="1b77d-167">不過，此叢集會密集壓縮，因此您可能會想要一些其他節點來容納節點失敗和升級。</span><span class="sxs-lookup"><span data-stu-id="1b77d-167">However, this cluster would be densely packed, so you may want some additional nodes to accommodate node failures and upgrades.</span></span> <span data-ttu-id="1b77d-168">試算表也顯示具有超過 57 個節點不會提供任何額外的值，因為您會有空白節點。</span><span class="sxs-lookup"><span data-stu-id="1b77d-168">The spreadsheet also shows that having more than 57 nodes provides no additional value because you would have empty nodes.</span></span> <span data-ttu-id="1b77d-169">同樣地，您可能想要有超過 57 節點以容納節點失敗和升級。</span><span class="sxs-lookup"><span data-stu-id="1b77d-169">Again, you may want to go above 57 nodes anyway to accommodate node failures and upgrades.</span></span> <span data-ttu-id="1b77d-170">您可以調整試算表以符合應用程式的特定需求。</span><span class="sxs-lookup"><span data-stu-id="1b77d-170">You can tweak the spreadsheet to match your application's specific needs.</span></span>   

![成本計算的試算表][Image1]

## <a name="next-steps"></a><span data-ttu-id="1b77d-172">後續步驟</span><span class="sxs-lookup"><span data-stu-id="1b77d-172">Next steps</span></span>
<span data-ttu-id="1b77d-173">查看[分割 Service Fabric 服務][10]來深入了解分割您的服務。</span><span class="sxs-lookup"><span data-stu-id="1b77d-173">Check out [Partitioning Service Fabric services][10] to learn more about partitioning your service.</span></span>

<!--Image references-->
[Image1]: ./media/SF-Cost.png

<!--Link references--In actual articles, you only need a single period before the slash-->
[10]: service-fabric-concepts-partitioning.md
