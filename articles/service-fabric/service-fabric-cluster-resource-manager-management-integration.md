---
title: "aaaService 網狀架構叢集資源管理員的管理整合 |Microsoft 文件"
description: "Hello 整合點之間 hello 叢集資源管理員和服務網狀架構管理的概觀。"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 956cd0b8-b6e3-4436-a224-8766320e8cd7
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 9a24c9de121fbe2e8e5e8e4d117e64686918936a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="cluster-resource-manager-integration-with-service-fabric-cluster-management"></a><span data-ttu-id="f5fde-103">叢集資源管理員與 Service Fabric 叢集管理整合</span><span class="sxs-lookup"><span data-stu-id="f5fde-103">Cluster resource manager integration with Service Fabric cluster management</span></span>
<span data-ttu-id="f5fde-104">hello Service Fabric 叢集資源管理員不中的磁碟機升級服務的網狀架構，但它與。</span><span class="sxs-lookup"><span data-stu-id="f5fde-104">hello Service Fabric Cluster Resource Manager doesn't drive upgrades in Service Fabric, but it is involved.</span></span> <span data-ttu-id="f5fde-105">hello hello 叢集資源管理員可協助管理是由追蹤 hello 的第一種方法所需的 hello 叢集和內文中的 hello 服務狀態。</span><span class="sxs-lookup"><span data-stu-id="f5fde-105">hello first way that hello Cluster Resource Manager helps with management is by tracking hello desired state of hello cluster and hello services inside it.</span></span> <span data-ttu-id="f5fde-106">它不能放 hello 所需的組態中的 hello 叢集時，健全狀況報表會傳送 hello 叢集資源管理員。</span><span class="sxs-lookup"><span data-stu-id="f5fde-106">hello Cluster Resource Manager sends out health reports when it cannot put hello cluster into hello desired configuration.</span></span> <span data-ttu-id="f5fde-107">例如，如果沒有足夠容量 hello 叢集資源管理員會送出健全狀況警告和指出 hello 發生問題的錯誤。</span><span class="sxs-lookup"><span data-stu-id="f5fde-107">For example, if there is insufficient capacity hello Cluster Resource Manager sends out health warnings and errors indicating hello problem.</span></span> <span data-ttu-id="f5fde-108">整合的其他片段都有 toodo 與升級的運作方式。</span><span class="sxs-lookup"><span data-stu-id="f5fde-108">Another piece of integration has toodo with how upgrades work.</span></span> <span data-ttu-id="f5fde-109">hello 叢集資源管理員會在升級期間稍微變更其行為。</span><span class="sxs-lookup"><span data-stu-id="f5fde-109">hello Cluster Resource Manager alters its behavior slightly during upgrades.</span></span>  

## <a name="health-integration"></a><span data-ttu-id="f5fde-110">健康狀態整合</span><span class="sxs-lookup"><span data-stu-id="f5fde-110">Health integration</span></span>
<span data-ttu-id="f5fde-111">hello 叢集資源管理員經常會追蹤 hello 規則中所定義的放置您的服務。</span><span class="sxs-lookup"><span data-stu-id="f5fde-111">hello Cluster Resource Manager constantly tracks hello rules you have defined for placing your services.</span></span> <span data-ttu-id="f5fde-112">它也會追蹤 hello 剩餘整體容量 hello 節點 hello 叢集中，以及上 hello 叢集中的每個度量。</span><span class="sxs-lookup"><span data-stu-id="f5fde-112">It also tracks hello remaining capacity for each metric on hello nodes and in hello cluster and in hello cluster as a whole.</span></span> <span data-ttu-id="f5fde-113">如果無法滿足這些規則，或容量不足，則會發出健康情況警告和錯誤。</span><span class="sxs-lookup"><span data-stu-id="f5fde-113">If it can't satisfy those rules or if there is insufficient capacity, health warnings and errors are emitted.</span></span> <span data-ttu-id="f5fde-114">例如，如果節點是透過容量和 hello 叢集資源管理員會嘗試 toofix hello 情況移動服務。</span><span class="sxs-lookup"><span data-stu-id="f5fde-114">For example, if a node is over capacity and hello Cluster Resource Manager will try toofix hello situation by moving services.</span></span> <span data-ttu-id="f5fde-115">如果它不能更正 hello 情況發出健全狀況警告指出哪一個節點透過容量，以及哪些度量。</span><span class="sxs-lookup"><span data-stu-id="f5fde-115">If it can't correct hello situation it emits a health warning indicating which node is over capacity, and for which metrics.</span></span>

<span data-ttu-id="f5fde-116">Hello 資源管理員的健全狀況警告的另一個範例是放置條件約束違規。</span><span class="sxs-lookup"><span data-stu-id="f5fde-116">Another example of hello Resource Manager's health warnings is violations of placement constraints.</span></span> <span data-ttu-id="f5fde-117">例如，如果您已定義位置條件約束 (例如`“NodeColor == Blue”`) 和 hello 資源管理員偵測到該條件約束的違規情形，請發出健全狀況警告。</span><span class="sxs-lookup"><span data-stu-id="f5fde-117">For example, if you have defined a placement constraint (such as `“NodeColor == Blue”`) and hello Resource Manager detects a violation of that constraint, it emits a health warning.</span></span> <span data-ttu-id="f5fde-118">這是自訂的條件約束和 hello 預設條件約束 （例如 hello 容錯網域和升級網域的條件約束），則為 true。</span><span class="sxs-lookup"><span data-stu-id="f5fde-118">This is true for custom constraints and hello default constraints (like hello Fault Domain and Upgrade Domain constraints).</span></span>

<span data-ttu-id="f5fde-119">以下是這類健康狀態報告的範例。</span><span class="sxs-lookup"><span data-stu-id="f5fde-119">Here’s an example of one such health report.</span></span> <span data-ttu-id="f5fde-120">在此情況下，hello 健全狀況報表是一個 hello 系統服務的資料分割。</span><span class="sxs-lookup"><span data-stu-id="f5fde-120">In this case, hello health report is for one of hello system service’s partitions.</span></span> <span data-ttu-id="f5fde-121">hello 健全狀況訊息會指出的 hello 該分割的複本會暫時封裝為太少的 「 升級 」 網域。</span><span class="sxs-lookup"><span data-stu-id="f5fde-121">hello health message indicates hello replicas of that partition are temporarily packed into too few Upgrade Domains.</span></span>

```posh
PS C:\Users\User > Get-WindowsFabricPartitionHealth -PartitionId '00000000-0000-0000-0000-000000000001'


PartitionId           : 00000000-0000-0000-0000-000000000001
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='System.PLB', Property='ReplicaConstraintViolation_UpgradeDomain', HealthState='Warning', ConsiderWarningAsError=false.

ReplicaHealthStates   :
                        ReplicaId             : 130766528804733380
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528804577821
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528854889931
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528804577822
                        AggregatedHealthState : Ok

                        ReplicaId             : 130837073190680024
                        AggregatedHealthState : Ok

HealthEvents          :
                        SourceId              : System.PLB
                        Property              : ReplicaConstraintViolation_UpgradeDomain
                        HealthState           : Warning
                        SequenceNumber        : 130837100116930204
                        SentAt                : 8/10/2015 7:53:31 PM
                        ReceivedAt            : 8/10/2015 7:53:33 PM
                        TTL                   : 00:01:05
                        Description           : hello Load Balancer has detected a Constraint Violation for this Replica: fabric:/System/FailoverManagerService Secondary Partition 00000000-0000-0000-0000-000000000001 is
                        violating hello Constraint: UpgradeDomain Details: UpgradeDomain ID -- 4, Replica on NodeName -- Node.8 Currently Upgrading -- false Distribution Policy -- Packing
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : Ok->Warning = 8/10/2015 7:13:02 PM, LastError = 1/1/0001 12:00:00 AM
```

<span data-ttu-id="f5fde-122">以下是此健康狀態訊息要告訴我們的事情︰</span><span class="sxs-lookup"><span data-stu-id="f5fde-122">Here's what this health message is telling us is:</span></span>

1. <span data-ttu-id="f5fde-123">所有的 hello 複本本身都是狀況良好： 每個都有 AggregatedHealthState: [確定]</span><span class="sxs-lookup"><span data-stu-id="f5fde-123">All hello replicas themselves are healthy: Each has AggregatedHealthState : Ok</span></span>
2. <span data-ttu-id="f5fde-124">目前違反 hello 升級網域散發條件約束。</span><span class="sxs-lookup"><span data-stu-id="f5fde-124">hello Upgrade Domain distribution constraint is currently being violated.</span></span> <span data-ttu-id="f5fde-125">這表示特定升級網域擁有這個磁碟的過多分割複本。</span><span class="sxs-lookup"><span data-stu-id="f5fde-125">This means a particular Upgrade Domain has more replicas from this partition than it should.</span></span>
3. <span data-ttu-id="f5fde-126">哪些節點包含 hello 複本導致 hello 違規。</span><span class="sxs-lookup"><span data-stu-id="f5fde-126">Which node contains hello replica causing hello violation.</span></span> <span data-ttu-id="f5fde-127">在此情況下是 hello 名稱"Node.8"hello 節點</span><span class="sxs-lookup"><span data-stu-id="f5fde-127">In this case it's hello node with hello name "Node.8"</span></span>
4. <span data-ttu-id="f5fde-128">無論此分割區是否正在升級 (「Currently Upgrading -- false」)</span><span class="sxs-lookup"><span data-stu-id="f5fde-128">Whether an upgrade is currently happening for this partition ("Currently Upgrading -- false")</span></span>
5. <span data-ttu-id="f5fde-129">hello 散發原則針對此服務: 「 發佈原則--封裝 」。</span><span class="sxs-lookup"><span data-stu-id="f5fde-129">hello distribution policy for this service: "Distribution Policy -- Packing".</span></span> <span data-ttu-id="f5fde-130">這由 hello `RequireDomainDistribution` [位置原則](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing)。</span><span class="sxs-lookup"><span data-stu-id="f5fde-130">This is governed by hello `RequireDomainDistribution` [placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span></span> <span data-ttu-id="f5fde-131">「封裝」表示在此情況下_不_需要 DomainDistribution，因此可知道並未替該服務指定放置原則。</span><span class="sxs-lookup"><span data-stu-id="f5fde-131">"Packing" indicates that in this case DomainDistribution was _not_ required, so we know that placement policy was not specified for this service.</span></span> 
6. <span data-ttu-id="f5fde-132">Hello 報表何時發生-2015 年 8 月 10 日下午 7:13:02</span><span class="sxs-lookup"><span data-stu-id="f5fde-132">When hello report happened - 8/10/2015 7:13:02 PM</span></span>

<span data-ttu-id="f5fde-133">資訊在實際執行 toolet 您知道某項目有任何錯誤，而且也會引發用 toodetect 這次方警示等停止不正確的升級。</span><span class="sxs-lookup"><span data-stu-id="f5fde-133">Information like this powers alerts that fire in production toolet you know something has gone wrong and is also used toodetect and halt bad upgrades.</span></span> <span data-ttu-id="f5fde-134">在此情況下，我們可能會想 toosee，如果我們可以找出 hello 資源管理員必須 toopack hello 複本到 hello 升級網域的原因。</span><span class="sxs-lookup"><span data-stu-id="f5fde-134">In this case, we’d want toosee if we can figure out why hello Resource Manager had toopack hello replicas into hello Upgrade Domain.</span></span> <span data-ttu-id="f5fde-135">通常封裝是暫時性的因為在 hello hello 節點其他升級網域已關閉，例如。</span><span class="sxs-lookup"><span data-stu-id="f5fde-135">Usually packing is transient because hello nodes in hello other Upgrade Domains were down, for example.</span></span>

<span data-ttu-id="f5fde-136">假設 hello 叢集資源管理員正在嘗試 tooplace 某些服務，但是沒有任何工作的解決方案。</span><span class="sxs-lookup"><span data-stu-id="f5fde-136">Let’s say hello Cluster Resource Manager is trying tooplace some services, but there aren't any solutions that work.</span></span> <span data-ttu-id="f5fde-137">當服務不放時，通常是其中一個 hello 下列原因：</span><span class="sxs-lookup"><span data-stu-id="f5fde-137">When services can't be placed, it is usually for one of hello following reasons:</span></span>

1. <span data-ttu-id="f5fde-138">某些暫時性的狀況，變成無法 tooplace 此服務執行個體或複本正確</span><span class="sxs-lookup"><span data-stu-id="f5fde-138">Some transient condition has made it impossible tooplace this service instance or replica correctly</span></span>
2. <span data-ttu-id="f5fde-139">hello 服務位置需求是 unsatisfiable。</span><span class="sxs-lookup"><span data-stu-id="f5fde-139">hello service’s placement requirements are unsatisfiable.</span></span>

<span data-ttu-id="f5fde-140">在這些情況下，從 hello 叢集資源管理員的健康情況報告協助您判斷為什麼無法放置 hello 服務。</span><span class="sxs-lookup"><span data-stu-id="f5fde-140">In these cases, health reports from hello Cluster Resource Manager help you determine why hello service can’t be placed.</span></span> <span data-ttu-id="f5fde-141">我們會呼叫此處理序 hello 條件約束刪除順序。</span><span class="sxs-lookup"><span data-stu-id="f5fde-141">We call this process hello constraint elimination sequence.</span></span> <span data-ttu-id="f5fde-142">期間，hello 系統會查核透過影響 hello 服務和記錄它們不需要設定 hello 條件約束。</span><span class="sxs-lookup"><span data-stu-id="f5fde-142">During it, hello system walks through hello configured constraints affecting hello service and records what they eliminate.</span></span> <span data-ttu-id="f5fde-143">如此一來，當服務不能 toobe 用來放置，您可以看到也消除了哪些節點和原因。</span><span class="sxs-lookup"><span data-stu-id="f5fde-143">This way when services aren’t able toobe placed, you can see which nodes were eliminated and why.</span></span>

## <a name="constraint-types"></a><span data-ttu-id="f5fde-144">條件約束類型</span><span class="sxs-lookup"><span data-stu-id="f5fde-144">Constraint types</span></span>
<span data-ttu-id="f5fde-145">我們要討論每一個 hello 這些健康情況報告中的不同條件約束。</span><span class="sxs-lookup"><span data-stu-id="f5fde-145">Let’s talk about each of hello different constraints in these health reports.</span></span> <span data-ttu-id="f5fde-146">當複本不能放時，您會看到健全狀況的訊息相關的 toothese 條件約束。</span><span class="sxs-lookup"><span data-stu-id="f5fde-146">You will see health messages related toothese constraints when replicas can't be placed.</span></span>

* <span data-ttu-id="f5fde-147">**ReplicaExclusionStatic**和**ReplicaExclusionDynamic**： 這些條件約束表示方案遭到拒絕，因為兩個服務物件，從 hello 相同的資料分割會有 toobe 置於 hello 相同節點。</span><span class="sxs-lookup"><span data-stu-id="f5fde-147">**ReplicaExclusionStatic** and **ReplicaExclusionDynamic**: These constraints indicates that a solution was rejected because two service objects from hello same partition would have toobe placed on hello same node.</span></span> <span data-ttu-id="f5fde-148">不允許這麼做是因為該節點的失敗會過度影響該分割區。</span><span class="sxs-lookup"><span data-stu-id="f5fde-148">This isn’t allowed because then failure of that node would overly impact that partition.</span></span> <span data-ttu-id="f5fde-149">ReplicaExclusionStatic 和 ReplicaExclusionDynamic 是幾乎相同的規則和 hello 差異無關緊要的 hello。</span><span class="sxs-lookup"><span data-stu-id="f5fde-149">ReplicaExclusionStatic and ReplicaExclusionDynamic are almost hello same rule and hello differences don't really matter.</span></span> <span data-ttu-id="f5fde-150">如果您會看到包含任一 hello ReplicaExclusionStatic 或 ReplicaExclusionDynamic 條件約束，hello 叢集資源管理員條件約束刪除順序認為沒有足夠的節點。</span><span class="sxs-lookup"><span data-stu-id="f5fde-150">If you are seeing a constraint elimination sequence containing either hello ReplicaExclusionStatic or ReplicaExclusionDynamic constraint, hello Cluster Resource Manager thinks that there aren’t enough nodes.</span></span> <span data-ttu-id="f5fde-151">這需要剩餘解決方案 toouse 這些無效的位置，這不被允許。</span><span class="sxs-lookup"><span data-stu-id="f5fde-151">This requires remaining solutions toouse these invalid placements which are disallowed.</span></span> <span data-ttu-id="f5fde-152">hello hello 序列中的其他條件約束通常告訴為什麼節點會被排除在 hello 第一個位置。</span><span class="sxs-lookup"><span data-stu-id="f5fde-152">hello other constraints in hello sequence will usually tell us why nodes are being eliminated in hello first place.</span></span>
* <span data-ttu-id="f5fde-153">**PlacementConstraint**： 如果您看到此訊息，表示我們刪除某些節點，因為它們不符合 hello 服務位置條件約束。</span><span class="sxs-lookup"><span data-stu-id="f5fde-153">**PlacementConstraint**: If you see this message, it means that we eliminated some nodes because they didn’t match hello service’s placement constraints.</span></span> <span data-ttu-id="f5fde-154">我們目前設定的 hello 位置條件約束時追蹤此訊息的一部分。</span><span class="sxs-lookup"><span data-stu-id="f5fde-154">We trace out hello currently configured placement constraints as a part of this message.</span></span> <span data-ttu-id="f5fde-155">如果您已定義放置條件約束，則這是正常情形。</span><span class="sxs-lookup"><span data-stu-id="f5fde-155">This is normal if you have a placement constraint defined.</span></span> <span data-ttu-id="f5fde-156">不過，如果位置條件約束不正確造成太多節點 toobe 消除這是如何您會注意到。</span><span class="sxs-lookup"><span data-stu-id="f5fde-156">However, if placement constraint is incorrectly causing too many nodes toobe eliminated this is how you would notice.</span></span>
* <span data-ttu-id="f5fde-157">**NodeCapacity**： 這個條件約束表示叢集資源管理員無法將 hello 複本放在該 hello hello 指示節點，因為，會將它們放低於產能。</span><span class="sxs-lookup"><span data-stu-id="f5fde-157">**NodeCapacity**: This constraint means that hello Cluster Resource Manager couldn’t place hello replicas on hello indicated nodes because that would put them over capacity.</span></span>
* <span data-ttu-id="f5fde-158">**同質**： 這個條件約束表示我們無法 hello 複本放在受影響的 hello 節點上因為它會導致 hello 親和性條件約束違規。</span><span class="sxs-lookup"><span data-stu-id="f5fde-158">**Affinity**: This constraint indicates that we couldn’t place hello replica on hello affected nodes since it would cause a violation of hello affinity constraint.</span></span> <span data-ttu-id="f5fde-159">如需同質性的詳細資訊，請參閱[這篇文章](service-fabric-cluster-resource-manager-advanced-placement-rules-affinity.md)</span><span class="sxs-lookup"><span data-stu-id="f5fde-159">More information on affinity is in [this article](service-fabric-cluster-resource-manager-advanced-placement-rules-affinity.md)</span></span>
* <span data-ttu-id="f5fde-160">**FaultDomain**和**UpgradeDomain**： 這個條件約束排除節點，如果在 hello 放 hello 複本指示節點會造成特定的錯誤或升級網域中的封裝。</span><span class="sxs-lookup"><span data-stu-id="f5fde-160">**FaultDomain** and **UpgradeDomain**: This constraint eliminates nodes if placing hello replica on hello indicated nodes would cause packing in a particular fault or upgrade domain.</span></span> <span data-ttu-id="f5fde-161">討論這個條件約束的數個範例會出現在 hello 主題[容錯和升級網域條件約束和產生的行為](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="f5fde-161">Several examples discussing this constraint are presented in hello topic on [fault and upgrade domain constraints and resulting behavior](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
* <span data-ttu-id="f5fde-162">**PreferredLocation**： 通常不應該看到從 hello 方案移除節點，因為最佳化預設會執行這個條件約束。</span><span class="sxs-lookup"><span data-stu-id="f5fde-162">**PreferredLocation**: You shouldn’t normally see this constraint removing nodes from hello solution since it runs as an optimization by default.</span></span> <span data-ttu-id="f5fde-163">hello 慣用位置限制式也會出現在升級期間。</span><span class="sxs-lookup"><span data-stu-id="f5fde-163">hello preferred location constraint is also present during upgrades.</span></span> <span data-ttu-id="f5fde-164">在升級期間是使用的 toomove 服務後 toowhere hello 升級啟動。</span><span class="sxs-lookup"><span data-stu-id="f5fde-164">During upgrade it is used toomove services back toowhere they were when hello upgrade started.</span></span>

## <a name="blocklisting-nodes"></a><span data-ttu-id="f5fde-165">封鎖節點</span><span class="sxs-lookup"><span data-stu-id="f5fde-165">Blocklisting Nodes</span></span>
<span data-ttu-id="f5fde-166">另一個健全狀況訊息 hello 叢集資源管理員報告時，節點是 blocklisted。</span><span class="sxs-lookup"><span data-stu-id="f5fde-166">Another health message hello Cluster Resource Manager reports is when nodes are blocklisted.</span></span> <span data-ttu-id="f5fde-167">您可以將封鎖視為自動套用的暫時性條件約束。</span><span class="sxs-lookup"><span data-stu-id="f5fde-167">You can think of blocklisting as a temporary constraint that is automatically applied for you.</span></span> <span data-ttu-id="f5fde-168">啟動該服務類型的執行個體時，發生重複失敗的節點會遭封鎖。</span><span class="sxs-lookup"><span data-stu-id="f5fde-168">Nodes get blocklisted when they experience repeated failures when launching instances of that service type.</span></span> <span data-ttu-id="f5fde-169">節點是依照服務類型來封鎖。</span><span class="sxs-lookup"><span data-stu-id="f5fde-169">Nodes are blocklisted on a per-service-type basis.</span></span> <span data-ttu-id="f5fde-170">某個服務類型的節點可能會被封鎖，另一個服務類型的節點則未被封鎖。</span><span class="sxs-lookup"><span data-stu-id="f5fde-170">A node may be blocklisted for one service type but not another.</span></span> 

<span data-ttu-id="f5fde-171">您會看到 blocklisting 通常在開發期間啟用： 在啟動時導致您的服務主機 toocrash 的一些錯誤。</span><span class="sxs-lookup"><span data-stu-id="f5fde-171">You'll see blocklisting kick in often during development: some bug causes your service host toocrash on startup.</span></span> <span data-ttu-id="f5fde-172">Service Fabric toocreate hello 服務主機嘗試幾次，並 hello 失敗持續發生。</span><span class="sxs-lookup"><span data-stu-id="f5fde-172">Service Fabric tries toocreate hello service host a few times, and hello failure keeps occurring.</span></span> <span data-ttu-id="f5fde-173">在少數的嘗試後 hello 節點取得 blocklisted，及 hello 叢集資源管理員會嘗試其他地方 toocreate hello 服務。</span><span class="sxs-lookup"><span data-stu-id="f5fde-173">After a few attempts, hello node gets blocklisted, and hello Cluster Resource Manager will try toocreate hello service elsewhere.</span></span> <span data-ttu-id="f5fde-174">如果該失敗情況持續發生多個節點上，很可能所有 hello 有效節點在 hello 叢集最後會封鎖。</span><span class="sxs-lookup"><span data-stu-id="f5fde-174">If that failure keeps happening on multiple nodes, it's possible that all of hello valid nodes in hello cluster end up blocked.</span></span> <span data-ttu-id="f5fde-175">Blocklisting 也可以移除，不足，所以無法成功啟動 hello 服務 toomeet hello 預期規模太多節點。</span><span class="sxs-lookup"><span data-stu-id="f5fde-175">Blocklisting cna also remove so many nodes that not enough can successfully launch hello service toomeet hello desired scale.</span></span> <span data-ttu-id="f5fde-176">您通常會看到其他錯誤或警告 hello hello 服務低於 hello 的複本或執行個體計數，以及健全狀況的訊息，指出哪一個 hello 失敗表示叢集資源管理員時，會導致 toohelloblocklisting hello 第一個位置中。</span><span class="sxs-lookup"><span data-stu-id="f5fde-176">You'll typically see additional errors or warnings from hello Cluster Resource Manager indicating that hello service is below hello desired replica or instance count, as well as health messages indicating what hello failure is that's leading toohello blocklisting in hello first place.</span></span>

<span data-ttu-id="f5fde-177">封鎖不是永久情況。</span><span class="sxs-lookup"><span data-stu-id="f5fde-177">Blocklisting is not a permanent condition.</span></span> <span data-ttu-id="f5fde-178">請稍候幾分鐘 hello 節點移除 hello 封鎖清單和服務網狀架構可能會重新啟動該節點上的 hello 服務。</span><span class="sxs-lookup"><span data-stu-id="f5fde-178">After a few minutes, hello node is removed from hello blocklist and Service Fabric may activate hello services on that node again.</span></span> <span data-ttu-id="f5fde-179">如果服務繼續 toofail，hello 節點再次成為 blocklisted 該服務類型。</span><span class="sxs-lookup"><span data-stu-id="f5fde-179">If services continue toofail, hello node is blocklisted for that service type again.</span></span> 

### <a name="constraint-priorities"></a><span data-ttu-id="f5fde-180">條件約束優先順序</span><span class="sxs-lookup"><span data-stu-id="f5fde-180">Constraint priorities</span></span>

> [!WARNING]
> <span data-ttu-id="f5fde-181">不建議變更條件約束優先順序，因為可能對叢集造成顯著的負面影響。</span><span class="sxs-lookup"><span data-stu-id="f5fde-181">Changing constraint priorities is not recommended and may have significant adverse effects on your cluster.</span></span> <span data-ttu-id="f5fde-182">hello 以下資訊供參考的 hello 預設條件約束的優先權，且其行為。</span><span class="sxs-lookup"><span data-stu-id="f5fde-182">hello below information is provided for reference of hello default constraint priorities and their behavior.</span></span> 
>

<span data-ttu-id="f5fde-183">所有這些條件約束，您可能有已考慮"Hi – 我認為容錯網域條件約束是 hello 最重要的是，我的系統中。</span><span class="sxs-lookup"><span data-stu-id="f5fde-183">With all of these constraints, you may have been thinking “Hey – I think that fault domain constraints are hello most important thing in my system.</span></span> <span data-ttu-id="f5fde-184">在訂單 tooensure hello 容錯網域違反條件約束不是，我願意 tooviolate 其他條件約束。 」</span><span class="sxs-lookup"><span data-stu-id="f5fde-184">In order tooensure hello fault domain constraint isn't violated, I’m willing tooviolate other constraints.”</span></span>

<span data-ttu-id="f5fde-185">可以使用不同的優先順序等級來設定條件約束。</span><span class="sxs-lookup"><span data-stu-id="f5fde-185">Constraints can be configured with different priority levels.</span></span> <span data-ttu-id="f5fde-186">它們是：</span><span class="sxs-lookup"><span data-stu-id="f5fde-186">These are:</span></span>

   - <span data-ttu-id="f5fde-187">「硬性」(0)</span><span class="sxs-lookup"><span data-stu-id="f5fde-187">“hard” (0)</span></span>
   - <span data-ttu-id="f5fde-188">「彈性」(1)</span><span class="sxs-lookup"><span data-stu-id="f5fde-188">“soft” (1)</span></span>
   - <span data-ttu-id="f5fde-189">「最佳化」(2)</span><span class="sxs-lookup"><span data-stu-id="f5fde-189">“optimization” (2)</span></span>
   - <span data-ttu-id="f5fde-190">「關閉」(-1)。</span><span class="sxs-lookup"><span data-stu-id="f5fde-190">“off” (-1).</span></span> 
   
<span data-ttu-id="f5fde-191">根據預設，大部分的 hello 條件約束會設定為硬式條件約束。</span><span class="sxs-lookup"><span data-stu-id="f5fde-191">Most of hello constraints are configured as hard constraints by default.</span></span>

<span data-ttu-id="f5fde-192">變更 hello 優先順序條件約束是常見的。</span><span class="sxs-lookup"><span data-stu-id="f5fde-192">Changing hello priority of constraints is uncommon.</span></span> <span data-ttu-id="f5fde-193">有好幾次 toochange，通常是其他 bug 或已影響 hello 環境的行為周圍 toowork 優先順序條件約束所需。</span><span class="sxs-lookup"><span data-stu-id="f5fde-193">There have been times where constraint priorities needed toochange, usually toowork around some other bug or behavior that was impacting hello environment.</span></span> <span data-ttu-id="f5fde-194">通常 hello hello 條件約束優先順序的基礎結構的彈性，曾很好，但通常不需要。</span><span class="sxs-lookup"><span data-stu-id="f5fde-194">Generally hello flexibility of hello constraint priority infrastructure has worked very well, but it isn't needed often.</span></span> <span data-ttu-id="f5fde-195">大部分的 hello 時間的所有項目會位於其預設優先權。</span><span class="sxs-lookup"><span data-stu-id="f5fde-195">Most of hello time everything sits at their default priorities.</span></span> 

<span data-ttu-id="f5fde-196">hello 優先權等級不表示指定的條件約束_將_違反，也不一定會符合。</span><span class="sxs-lookup"><span data-stu-id="f5fde-196">hello priority levels don't mean that a given constraint _will_ be violated, nor that it will always be met.</span></span> <span data-ttu-id="f5fde-197">條件約束優先順序會定義強制執行條件約束的順序。</span><span class="sxs-lookup"><span data-stu-id="f5fde-197">Constraint priorities define an order in which constraints are enforced.</span></span> <span data-ttu-id="f5fde-198">優先權會定義 hello 權衡取捨時，它不可能 toosatisfy 所有條件約束。</span><span class="sxs-lookup"><span data-stu-id="f5fde-198">Priorities define hello tradeoffs when it is impossible toosatisfy all constraints.</span></span> <span data-ttu-id="f5fde-199">通常除非沒有其他進行 hello 環境中的項目，可以滿足所有 hello 條件約束。</span><span class="sxs-lookup"><span data-stu-id="f5fde-199">Usually all hello constraints can be satisfied unless there's something else going on in hello environment.</span></span> <span data-ttu-id="f5fde-200">就會導致 tooconstraint 違規案例的一些範例包括衝突的條件約束，或大量的並行失敗。</span><span class="sxs-lookup"><span data-stu-id="f5fde-200">Some examples of scenarios that will lead tooconstraint violations are conflicting constraints, or large numbers of concurrent failures.</span></span>

<span data-ttu-id="f5fde-201">在進階的情況下，您可以變更 hello 的優先順序條件約束。</span><span class="sxs-lookup"><span data-stu-id="f5fde-201">In advanced situations, you can change hello constraint priorities.</span></span> <span data-ttu-id="f5fde-202">例如，假設您想要 tooensure 必要 toosolve 節點容量發出時，一律會違反親和性。</span><span class="sxs-lookup"><span data-stu-id="f5fde-202">For example, say you wanted tooensure that affinity would always be violated when necessary toosolve node capacity issues.</span></span> <span data-ttu-id="f5fde-203">tooachieve，您無法設定 hello hello 親和性條件約束太 「 軟性 」 (1) 的優先順序和離開 hello 容量限制設定太 「 硬式 」 (0)。</span><span class="sxs-lookup"><span data-stu-id="f5fde-203">tooachieve this, you could set hello priority of hello affinity constraint too“soft” (1) and leave hello capacity constraint set too“hard” (0).</span></span>

<span data-ttu-id="f5fde-204">hello hello 不同的條件約束的預設優先權值會指定 hello 下列組態：</span><span class="sxs-lookup"><span data-stu-id="f5fde-204">hello default priority values for hello different constraints are specified in hello following config:</span></span>

<span data-ttu-id="f5fde-205">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="f5fde-205">ClusterManifest.xml</span></span>

```xml
        <Section Name="PlacementAndLoadBalancing">
            <Parameter Name="PlacementConstraintPriority" Value="0" />
            <Parameter Name="CapacityConstraintPriority" Value="0" />
            <Parameter Name="AffinityConstraintPriority" Value="0" />
            <Parameter Name="FaultDomainConstraintPriority" Value="0" />
            <Parameter Name="UpgradeDomainConstraintPriority" Value="1" />
            <Parameter Name="PreferredLocationConstraintPriority" Value="2" />
        </Section>
```

<span data-ttu-id="f5fde-206">獨立部署透過 ClusterConfig.json，Azure 託管叢集透過 Template.json：</span><span class="sxs-lookup"><span data-stu-id="f5fde-206">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "PlacementAndLoadBalancing",
    "parameters": [
      {
          "name": "PlacementConstraintPriority",
          "value": "0"
      },
      {
          "name": "CapacityConstraintPriority",
          "value": "0"
      },
      {
          "name": "AffinityConstraintPriority",
          "value": "0"
      },
      {
          "name": "FaultDomainConstraintPriority",
          "value": "0"
      },
      {
          "name": "UpgradeDomainConstraintPriority",
          "value": "1"
      },
      {
          "name": "PreferredLocationConstraintPriority",
          "value": "2"
      }
    ]
  }
]
```

## <a name="fault-domain-and-upgrade-domain-constraints"></a><span data-ttu-id="f5fde-207">容錯網域和升級網域的條件約束</span><span class="sxs-lookup"><span data-stu-id="f5fde-207">Fault domain and upgrade domain constraints</span></span>
<span data-ttu-id="f5fde-208">hello 叢集資源管理員會希望 tookeep 遍佈容錯和升級網域的服務。</span><span class="sxs-lookup"><span data-stu-id="f5fde-208">hello Cluster Resource Manager wants tookeep services spread out among fault and upgrade domains.</span></span> <span data-ttu-id="f5fde-209">它的模型做為條件約束 hello 叢集資源管理員的引擎內。</span><span class="sxs-lookup"><span data-stu-id="f5fde-209">It models this as a constraint inside hello Cluster Resource Manager’s engine.</span></span> <span data-ttu-id="f5fde-210">如需使用方式的詳細資訊和其特定的行為，請參閱 hello 發行項上[叢集設定](service-fabric-cluster-resource-manager-cluster-description.md#fault-and-upgrade-domain-constraints-and-resulting-behavior)。</span><span class="sxs-lookup"><span data-stu-id="f5fde-210">For more information on how they are used and their specific behavior, check out hello article on [cluster configuration](service-fabric-cluster-resource-manager-cluster-description.md#fault-and-upgrade-domain-constraints-and-resulting-behavior).</span></span>

<span data-ttu-id="f5fde-211">hello 叢集資源管理員可能需要 toopack 一些複本至中順序 toodeal 與升級、 失敗或其他條件約束違規的升級網域。</span><span class="sxs-lookup"><span data-stu-id="f5fde-211">hello Cluster Resource Manager may need toopack a couple replicas into an upgrade domain in order toodeal with upgrades, failures, or other constraint violations.</span></span> <span data-ttu-id="f5fde-212">通常壓縮成錯誤或升級網域，會發生時，才有一些失敗或其他變換導致無法正確放置 hello 系統中。</span><span class="sxs-lookup"><span data-stu-id="f5fde-212">Packing into fault or upgrade domains normally happens only when there are several failures or other churn in hello system preventing correct placement.</span></span> <span data-ttu-id="f5fde-213">如果您想 tooprevent 壓縮，即使在這些情況下，您可以利用 hello `RequireDomainDistribution` [位置原則](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing)。</span><span class="sxs-lookup"><span data-stu-id="f5fde-213">If you wish tooprevent packing even during these situations, you can utilize hello `RequireDomainDistribution` [placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span></span> <span data-ttu-id="f5fde-214">請注意，這可能會產生影響服務可用性和可靠性的副作用，請審慎考慮。</span><span class="sxs-lookup"><span data-stu-id="f5fde-214">Note that this may affect service availability and reliability as a side effect, so consider it carefully.</span></span>

<span data-ttu-id="f5fde-215">Hello 環境已正確設定，如果所有條件約束必須確實遵守，即使在升級期間。</span><span class="sxs-lookup"><span data-stu-id="f5fde-215">If hello environment is configured correctly, all constraints are fully respected, even during upgrades.</span></span> <span data-ttu-id="f5fde-216">hello 的重點為叢集資源管理員，會為您的條件約束觀賞該 hello。</span><span class="sxs-lookup"><span data-stu-id="f5fde-216">hello key thing is that hello Cluster Resource Manager is watching out for your constraints.</span></span> <span data-ttu-id="f5fde-217">偵測到違規時，它立即將它報告，並嘗試 toocorrect hello 問題。</span><span class="sxs-lookup"><span data-stu-id="f5fde-217">When it detects a violation it immediately reports it and tries toocorrect hello issue.</span></span>

## <a name="hello-preferred-location-constraint"></a><span data-ttu-id="f5fde-218">hello 慣用的位置限制式</span><span class="sxs-lookup"><span data-stu-id="f5fde-218">hello preferred location constraint</span></span>
<span data-ttu-id="f5fde-219">hello PreferredLocation 條件約束是有點不同，它有兩個不同的用途。</span><span class="sxs-lookup"><span data-stu-id="f5fde-219">hello PreferredLocation constraint is a little different, as it has two different uses.</span></span> <span data-ttu-id="f5fde-220">這個條件約束的其中一種用法是在應用程式升級期間。</span><span class="sxs-lookup"><span data-stu-id="f5fde-220">One use of this constraint is during application upgrades.</span></span> <span data-ttu-id="f5fde-221">hello 叢集資源管理員會在升級期間，自動管理這個條件約束。</span><span class="sxs-lookup"><span data-stu-id="f5fde-221">hello Cluster Resource Manager automatically manages this constraint during upgrades.</span></span> <span data-ttu-id="f5fde-222">它是使用的 tooensure，當升級已完成複本傳回 tootheir 初始位置。</span><span class="sxs-lookup"><span data-stu-id="f5fde-222">It is used tooensure that when upgrades are complete that replicas return tootheir initial locations.</span></span> <span data-ttu-id="f5fde-223">hello hello PreferredLocation 條件約束的其他用途為 hello [ `PreferredPrimaryDomain`位置原則](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md)。</span><span class="sxs-lookup"><span data-stu-id="f5fde-223">hello other use of hello PreferredLocation constraint is for hello [`PreferredPrimaryDomain` placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md).</span></span> <span data-ttu-id="f5fde-224">這兩種最佳化，而且因此 hello PreferredLocation 條件約束，是設定得 hello 唯一條件約束是預設的 「 最佳化 」。</span><span class="sxs-lookup"><span data-stu-id="f5fde-224">Both of these are optimizations, and hence hello PreferredLocation constraint is hello only constraint set too"Optimization" by default.</span></span>

## <a name="upgrades"></a><span data-ttu-id="f5fde-225">升級</span><span class="sxs-lookup"><span data-stu-id="f5fde-225">Upgrades</span></span>
<span data-ttu-id="f5fde-226">hello 叢集資源管理員也可協助應用程式和其兩個工作的叢集升級期間：</span><span class="sxs-lookup"><span data-stu-id="f5fde-226">hello Cluster Resource Manager also helps during application and cluster upgrades, during which it has two jobs:</span></span>

* <span data-ttu-id="f5fde-227">確保不會影響 hello 叢集的 hello 規則</span><span class="sxs-lookup"><span data-stu-id="f5fde-227">ensure that hello rules of hello cluster are not compromised</span></span>
* <span data-ttu-id="f5fde-228">順暢地嘗試 toohelp hello 升級到</span><span class="sxs-lookup"><span data-stu-id="f5fde-228">try toohelp hello upgrade go smoothly</span></span>

### <a name="keep-enforcing-hello-rules"></a><span data-ttu-id="f5fde-229">保留強制 hello 規則</span><span class="sxs-lookup"><span data-stu-id="f5fde-229">Keep enforcing hello rules</span></span>
<span data-ttu-id="f5fde-230">hello 留意的重點 toobe 是 hello 規則 – hello 嚴格的條件約束類似放置條件約束和容量-仍會在升級期間強制執行。</span><span class="sxs-lookup"><span data-stu-id="f5fde-230">hello main thing toobe aware of is that hello rules – hello strict constraints like placement constraints and capacities - are still enforced during upgrades.</span></span> <span data-ttu-id="f5fde-231">放置條件約束可確保工作負載只在允許的位置執行，即在升級期間也一樣。</span><span class="sxs-lookup"><span data-stu-id="f5fde-231">Placement constraints ensure that your workloads only run where they are allowed to, even during upgrades.</span></span> <span data-ttu-id="f5fde-232">服務受到極大的條件約束時，升級可能需要較長的時間。</span><span class="sxs-lookup"><span data-stu-id="f5fde-232">When services are highly constrained, upgrades can take longer.</span></span> <span data-ttu-id="f5fde-233">Hello 服務或 hello 節點執行時是關閉，可能會有幾個選項，它可用的更新。</span><span class="sxs-lookup"><span data-stu-id="f5fde-233">When hello service or hello node it is running on is brought down for an update there may be few options for where it can go.</span></span>

### <a name="smart-replacements"></a><span data-ttu-id="f5fde-234">聰明取代</span><span class="sxs-lookup"><span data-stu-id="f5fde-234">Smart replacements</span></span>
<span data-ttu-id="f5fde-235">升級啟動時，資源管理員 hello 的快照 hello 叢集的 hello 目前的排列方式。</span><span class="sxs-lookup"><span data-stu-id="f5fde-235">When an upgrade starts, hello Resource Manager takes a snapshot of hello current arrangement of hello cluster.</span></span> <span data-ttu-id="f5fde-236">每個升級網域完成時，它會嘗試 tooreturn hello 服務，該升級網域 tootheir 原始排列方式。</span><span class="sxs-lookup"><span data-stu-id="f5fde-236">As each Upgrade Domain completes, it attempts tooreturn hello services that were in that Upgrade Domain tootheir original arrangement.</span></span> <span data-ttu-id="f5fde-237">這種方式有最多兩個轉換服務 hello 升級期間。</span><span class="sxs-lookup"><span data-stu-id="f5fde-237">This way there are at most two transitions for a service during hello upgrade.</span></span> <span data-ttu-id="f5fde-238">有一個移出受影響的 hello 節點，而且其中一個向後移。</span><span class="sxs-lookup"><span data-stu-id="f5fde-238">There is one move out of hello affected node and one move back in.</span></span> <span data-ttu-id="f5fde-239">傳回 hello 叢集或服務 toohow hello 升級也可確保 hello 升級之前不會影響 hello 叢集的 hello 版面配置。</span><span class="sxs-lookup"><span data-stu-id="f5fde-239">Returning hello cluster or service toohow it was before hello upgrade also ensures hello upgrade doesn’t impact hello layout of hello cluster.</span></span> 

### <a name="reduced-churn"></a><span data-ttu-id="f5fde-240">減少流失</span><span class="sxs-lookup"><span data-stu-id="f5fde-240">Reduced churn</span></span>
<span data-ttu-id="f5fde-241">在升級期間，會發生情況的另一項為叢集資源管理員會關閉平衡該 hello。</span><span class="sxs-lookup"><span data-stu-id="f5fde-241">Another thing that happens during upgrades is that hello Cluster Resource Manager turns off balancing.</span></span> <span data-ttu-id="f5fde-242">防止平衡可避免不必要的反應 toohello 升級本身，例如將服務移到清空 hello 升級的節點。</span><span class="sxs-lookup"><span data-stu-id="f5fde-242">Preventing balancing prevents unnecessary reactions toohello upgrade itself, like moving services into nodes that were emptied for hello upgrade.</span></span> <span data-ttu-id="f5fde-243">如果有問題的 hello 升級叢集升級，然後 hello 整個叢集不平衡 hello 升級期間。</span><span class="sxs-lookup"><span data-stu-id="f5fde-243">If hello upgrade in question is a Cluster upgrade, then hello entire cluster is not balanced during hello upgrade.</span></span> <span data-ttu-id="f5fde-244">條件約束檢查會持續作用，只有移動根據 hello 主動平衡的計量已停用。</span><span class="sxs-lookup"><span data-stu-id="f5fde-244">Constraint checks stay active, only movement based on hello proactive balancing of metrics is disabled.</span></span>

### <a name="buffered-capacity--upgrade"></a><span data-ttu-id="f5fde-245">緩衝處理的容量和升級</span><span class="sxs-lookup"><span data-stu-id="f5fde-245">Buffered Capacity & Upgrade</span></span>
<span data-ttu-id="f5fde-246">通常您希望 hello 升級 toocomplete 即使 hello 叢集條件約束或關閉 toofull。</span><span class="sxs-lookup"><span data-stu-id="f5fde-246">Generally you want hello upgrade toocomplete even if hello cluster is constrained or close toofull.</span></span> <span data-ttu-id="f5fde-247">Hello 叢集的 hello 容量的管理會更重要在升級期間比平常。</span><span class="sxs-lookup"><span data-stu-id="f5fde-247">Managing hello capacity of hello cluster is even more important during upgrades than usual.</span></span> <span data-ttu-id="f5fde-248">根據 hello 必須為 hello 升級彙透過 hello 叢集移轉介於 5 到 20%的容量的升級網域數目。</span><span class="sxs-lookup"><span data-stu-id="f5fde-248">Depending on hello number of upgrade domains, between 5 and 20 percent of capacity must be migrated as hello upgrade rolls through hello cluster.</span></span> <span data-ttu-id="f5fde-249">該工作有 toogo 的某處。</span><span class="sxs-lookup"><span data-stu-id="f5fde-249">That work has toogo somewhere.</span></span> <span data-ttu-id="f5fde-250">這是其中 hello 概念[緩衝處理容量](service-fabric-cluster-resource-manager-cluster-description.md#buffered-capacity)很有用。</span><span class="sxs-lookup"><span data-stu-id="f5fde-250">This is where hello notion of [buffered capacities](service-fabric-cluster-resource-manager-cluster-description.md#buffered-capacity) is useful.</span></span> <span data-ttu-id="f5fde-251">在正常作業期間，系統會採用緩衝處理的容量。</span><span class="sxs-lookup"><span data-stu-id="f5fde-251">Buffered capacity is respected during normal operation.</span></span> <span data-ttu-id="f5fde-252">hello 叢集資源管理員可能會在必要時升級期間，填滿向上 tootheir 總容量 （使用 hello 緩衝區） 的節點。</span><span class="sxs-lookup"><span data-stu-id="f5fde-252">hello Cluster Resource Manager may fill nodes up tootheir total capacity (consuming hello buffer) during upgrades if necessary.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f5fde-253">後續步驟</span><span class="sxs-lookup"><span data-stu-id="f5fde-253">Next steps</span></span>
* <span data-ttu-id="f5fde-254">Hello 從頭開始並[取得簡介 toohello Service Fabric 叢集資源管理員](service-fabric-cluster-resource-manager-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="f5fde-254">Start from hello beginning and [get an Introduction toohello Service Fabric Cluster Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span></span>
