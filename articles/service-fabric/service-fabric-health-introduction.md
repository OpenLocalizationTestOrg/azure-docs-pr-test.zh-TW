---
title: "服務網狀架構監視 aaaHealth |Microsoft 文件"
description: "簡介 toohello Azure Service Fabric 健康監視提供監視 hello 叢集與應用程式及服務的模型。"
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 1d979210-b1eb-4022-be24-799fd9d8e003
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: 904f36374ca6ca7e4caa1d43c92584e7e4c50087
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="introduction-tooservice-fabric-health-monitoring"></a><span data-ttu-id="07682-103">簡介 tooService 網狀架構健全狀況監視</span><span class="sxs-lookup"><span data-stu-id="07682-103">Introduction tooService Fabric health monitoring</span></span>
<span data-ttu-id="07682-104">Azure Service Fabric 導入了健康狀態模型，提供豐富、彈性且可延伸的健康狀態評估與報告。</span><span class="sxs-lookup"><span data-stu-id="07682-104">Azure Service Fabric introduces a health model that provides rich, flexible, and extensible health evaluation and reporting.</span></span> <span data-ttu-id="07682-105">hello 模型允許接近即時監視 hello hello 叢集和執行中的 hello 服務的狀態。</span><span class="sxs-lookup"><span data-stu-id="07682-105">hello model allows near-real-time monitoring of hello state of hello cluster and hello services running in it.</span></span> <span data-ttu-id="07682-106">您可以輕鬆地取得健康狀態資訊，並在潛在問題引起連鎖反應和造成大規模中斷之前，予以更正。</span><span class="sxs-lookup"><span data-stu-id="07682-106">You can easily obtain health information and correct potential issues before they cascade and cause massive outages.</span></span> <span data-ttu-id="07682-107">在 hello 一般模型中，服務會傳送其本機檢視中，為基礎的報表，資訊都會彙總以及 tooprovide 整體叢集層級檢視。</span><span class="sxs-lookup"><span data-stu-id="07682-107">In hello typical model, services send reports based on their local views, and that information is aggregated tooprovide an overall cluster-level view.</span></span>

<span data-ttu-id="07682-108">Service Fabric 元件會使用這個豐富的健全狀況模型 tooreport 及其目前狀態。</span><span class="sxs-lookup"><span data-stu-id="07682-108">Service Fabric components use this rich health model tooreport their current state.</span></span> <span data-ttu-id="07682-109">您可以使用 hello 從您的應用程式的相同機制 tooreport 健全狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-109">You can use hello same mechanism tooreport health from your applications.</span></span> <span data-ttu-id="07682-110">只要投入時間規劃高品質的健康狀態報告來擷取您的自訂條件，就能更輕鬆地偵測並修正執行中應用程式的問題。</span><span class="sxs-lookup"><span data-stu-id="07682-110">If you invest in high-quality health reporting that captures your custom conditions, you can detect and fix issues for your running application much more easily.</span></span>

<span data-ttu-id="07682-111">下列 Microsoft Virtual Academy 視訊也會描述 hello 服務網狀架構健全狀況模型，以及如何使用 hello:<center><a target="_blank" href="https://mva.microsoft.com/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=tevZw56yC_1906218965">
<img src="./media/service-fabric-health-introduction/HealthIntroVid.png" WIDTH="360" HEIGHT="244">
</a></center></span><span class="sxs-lookup"><span data-stu-id="07682-111">hello following Microsoft Virtual Academy video also describes hello Service Fabric health model and how it's used: <center><a target="_blank" href="https://mva.microsoft.com/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=tevZw56yC_1906218965">
<img src="./media/service-fabric-health-introduction/HealthIntroVid.png" WIDTH="360" HEIGHT="244">
</a></center></span></span>

> [!NOTE]
> <span data-ttu-id="07682-112">我們已開始 hello 健全狀況子系統 tooaddress 受監視的升級需求。</span><span class="sxs-lookup"><span data-stu-id="07682-112">We started hello health subsystem tooaddress a need for monitored upgrades.</span></span> <span data-ttu-id="07682-113">Service Fabric 提供受監視應用程式和叢集的升級，可確保完整的可用性、 沒有停機時間及 toono 最少使用者介入。</span><span class="sxs-lookup"><span data-stu-id="07682-113">Service Fabric provides monitored application and cluster upgrades that ensure full availability, no downtime and minimal toono user intervention.</span></span> <span data-ttu-id="07682-114">這些目標，hello 升級檢查健全狀況根據的 tooachieve 設定升級的原則。</span><span class="sxs-lookup"><span data-stu-id="07682-114">tooachieve these goals, hello upgrade checks health based on configured upgrade policies.</span></span> <span data-ttu-id="07682-115">只有在健康情況達到所需的臨界值時，才可繼續進行升級。</span><span class="sxs-lookup"><span data-stu-id="07682-115">An upgrade can proceed only when health respects desired thresholds.</span></span> <span data-ttu-id="07682-116">否則，hello 升級可能會自動回復或暫停 toogive 系統管理員有機會 toofix hello 問題。</span><span class="sxs-lookup"><span data-stu-id="07682-116">Otherwise, hello upgrade is either automatically rolled back or paused toogive administrators a chance toofix hello issues.</span></span> <span data-ttu-id="07682-117">toolearn 深入了解應用程式升級，請參閱[本文](service-fabric-application-upgrade.md)。</span><span class="sxs-lookup"><span data-stu-id="07682-117">toolearn more about application upgrades, see [this article](service-fabric-application-upgrade.md).</span></span>
> 
> 

## <a name="health-store"></a><span data-ttu-id="07682-118">健康狀態資料存放區</span><span class="sxs-lookup"><span data-stu-id="07682-118">Health store</span></span>
<span data-ttu-id="07682-119">hello 健全狀況存放區會保留實體健全狀況相關資訊，以方便擷取和評估 hello 叢集中。</span><span class="sxs-lookup"><span data-stu-id="07682-119">hello health store keeps health-related information about entities in hello cluster for easy retrieval and evaluation.</span></span> <span data-ttu-id="07682-120">它被實作 Service Fabric 保存具狀態服務 tooensure 高可用性和延展性。</span><span class="sxs-lookup"><span data-stu-id="07682-120">It is implemented as a Service Fabric persisted stateful service tooensure high availability and scalability.</span></span> <span data-ttu-id="07682-121">hello 健全狀況存放區屬於 hello **fabric: / System**應用程式，而且這是可用時 hello 叢集已啟動且正在執行。</span><span class="sxs-lookup"><span data-stu-id="07682-121">hello health store is part of hello **fabric:/System** application, and it is available when hello cluster is up and running.</span></span>

## <a name="health-entities-and-hierarchy"></a><span data-ttu-id="07682-122">健康狀態實體和階層</span><span class="sxs-lookup"><span data-stu-id="07682-122">Health entities and hierarchy</span></span>
<span data-ttu-id="07682-123">hello 健康實體被按照邏輯階層架構中擷取的互動和不同實體之間的相依性。</span><span class="sxs-lookup"><span data-stu-id="07682-123">hello health entities are organized in a logical hierarchy that captures interactions and dependencies among different entities.</span></span> <span data-ttu-id="07682-124">健康實體和階層，根據從 Service Fabric 元件所收到的報表，自動建置 hello 健全狀況存放區。</span><span class="sxs-lookup"><span data-stu-id="07682-124">hello health store automatically builds health entities and hierarchy based on reports received from Service Fabric components.</span></span>

<span data-ttu-id="07682-125">hello 健康實體鏡像 hello Service Fabric 實體。</span><span class="sxs-lookup"><span data-stu-id="07682-125">hello health entities mirror hello Service Fabric entities.</span></span> <span data-ttu-id="07682-126">(比方說，**健全狀況應用程式的實體**符合應用程式執行個體 hello 叢集中部署，而**健全狀況節點實體**符合 Service Fabric 叢集節點。) 擷取 hello 健全狀況階層hello 與之間的互動 hello 系統實體，它是進階的健全狀況評估 hello 基礎。</span><span class="sxs-lookup"><span data-stu-id="07682-126">(For example, **health application entity** matches an application instance deployed in hello cluster, while **health node entity** matches a Service Fabric cluster node.) hello health hierarchy captures hello interactions of hello system entities, and it is hello basis for advanced health evaluation.</span></span> <span data-ttu-id="07682-127">您可以在 [Service Fabric 技術概觀](service-fabric-technical-overview.md)中了解重要的 Service Fabric 概念。</span><span class="sxs-lookup"><span data-stu-id="07682-127">You can learn about key Service Fabric concepts in [Service Fabric technical overview](service-fabric-technical-overview.md).</span></span> <span data-ttu-id="07682-128">如需應用程式的詳細資訊，請參閱 [Service Fabric 應用程式模型](service-fabric-application-model.md)。</span><span class="sxs-lookup"><span data-stu-id="07682-128">For more on application, see [Service Fabric application model](service-fabric-application-model.md).</span></span>

<span data-ttu-id="07682-129">hello 健康實體和階層可讓 hello 叢集和應用程式 toobe 有效報告、 偵錯和監視。</span><span class="sxs-lookup"><span data-stu-id="07682-129">hello health entities and hierarchy allow hello cluster and applications toobe effectively reported, debugged, and monitored.</span></span> <span data-ttu-id="07682-130">hello 健全狀況模型會提供正確的*細微*hello 健全狀況的表示法 hello hello 叢集中的許多移動片段。</span><span class="sxs-lookup"><span data-stu-id="07682-130">hello health model provides an accurate, *granular* representation of hello health of hello many moving pieces in hello cluster.</span></span>

<span data-ttu-id="07682-131">![健康狀態實體][1]。</span><span class="sxs-lookup"><span data-stu-id="07682-131">![Health entities.][1]</span></span>
<span data-ttu-id="07682-132">hello 健全狀況的實體，組織中的父子式關聯性為基礎的階層。</span><span class="sxs-lookup"><span data-stu-id="07682-132">hello health entities, organized in a hierarchy based on parent-child relationships.</span></span>

[1]: ./media/service-fabric-health-introduction/servicefabric-health-hierarchy.png

<span data-ttu-id="07682-133">hello 健康實體包括：</span><span class="sxs-lookup"><span data-stu-id="07682-133">hello health entities are:</span></span>

* <span data-ttu-id="07682-134">**叢集**。</span><span class="sxs-lookup"><span data-stu-id="07682-134">**Cluster**.</span></span> <span data-ttu-id="07682-135">代表 hello Service Fabric 叢集健全狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-135">Represents hello health of a Service Fabric cluster.</span></span> <span data-ttu-id="07682-136">叢集健全狀況報表描述影響 hello 整個叢集的條件。</span><span class="sxs-lookup"><span data-stu-id="07682-136">Cluster health reports describe conditions that affect hello entire cluster.</span></span> <span data-ttu-id="07682-137">這些條件會影響 hello 叢集或本身 hello 叢集中的多個實體。</span><span class="sxs-lookup"><span data-stu-id="07682-137">These conditions affect multiple entities in hello cluster or hello cluster itself.</span></span> <span data-ttu-id="07682-138">根據 hello 條件，hello 報告無法縮小 hello 問題向下 tooone 或多個狀況不良的子系。</span><span class="sxs-lookup"><span data-stu-id="07682-138">Based on hello condition, hello reporter can't narrow hello issue down tooone or more unhealthy children.</span></span> <span data-ttu-id="07682-139">範例包括 hello 叢集分割到期 toonetwork 分割或通訊問題的 hello 大腦。</span><span class="sxs-lookup"><span data-stu-id="07682-139">Examples include hello brain of hello cluster splitting due toonetwork partitioning or communication issues.</span></span>
* <span data-ttu-id="07682-140">**節點**。</span><span class="sxs-lookup"><span data-stu-id="07682-140">**Node**.</span></span> <span data-ttu-id="07682-141">代表 hello Service Fabric 節點健全狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-141">Represents hello health of a Service Fabric node.</span></span> <span data-ttu-id="07682-142">節點健全狀況報告說明影響 hello 節點 」 功能的條件。</span><span class="sxs-lookup"><span data-stu-id="07682-142">Node health reports describe conditions that affect hello node functionality.</span></span> <span data-ttu-id="07682-143">它們通常會影響在其上執行的所有部署的 hello 實體。</span><span class="sxs-lookup"><span data-stu-id="07682-143">They typically affect all hello deployed entities running on it.</span></span> <span data-ttu-id="07682-144">範例包括節點的磁碟空間不足 (或其他電腦全域屬性，例如記憶體、連線) 以及節點已關閉時。</span><span class="sxs-lookup"><span data-stu-id="07682-144">Examples include node out of disk space (or other machine-wide properties, such as memory, connections) and when a node is down.</span></span> <span data-ttu-id="07682-145">hello 節點實體識別 hello 節點名稱 （字串）。</span><span class="sxs-lookup"><span data-stu-id="07682-145">hello node entity is identified by hello node name (string).</span></span>
* <span data-ttu-id="07682-146">**應用程式**。</span><span class="sxs-lookup"><span data-stu-id="07682-146">**Application**.</span></span> <span data-ttu-id="07682-147">代表 hello hello 叢集中執行的應用程式執行個體健全狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-147">Represents hello health of an application instance running in hello cluster.</span></span> <span data-ttu-id="07682-148">應用程式健康情況報告的描述會影響 hello 的條件 hello 應用程式的整體健全狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-148">Application health reports describe conditions that affect hello overall health of hello application.</span></span> <span data-ttu-id="07682-149">它們無法縮小 tooindividual 子系 （服務或部署的應用程式）。</span><span class="sxs-lookup"><span data-stu-id="07682-149">They can't be narrowed down tooindividual children (services or deployed applications).</span></span> <span data-ttu-id="07682-150">範例包括 hello 應用程式中的 hello 在不同的服務之間的端對端互動。</span><span class="sxs-lookup"><span data-stu-id="07682-150">Examples include hello end-to-end interaction among different services in hello application.</span></span> <span data-ttu-id="07682-151">hello 應用程式名稱 (URI) 來識別 hello 應用程式的實體。</span><span class="sxs-lookup"><span data-stu-id="07682-151">hello application entity is identified by hello application name (URI).</span></span>
* <span data-ttu-id="07682-152">**服務**。</span><span class="sxs-lookup"><span data-stu-id="07682-152">**Service**.</span></span> <span data-ttu-id="07682-153">代表 hello hello 叢集中執行之服務的健全狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-153">Represents hello health of a service running in hello cluster.</span></span> <span data-ttu-id="07682-154">服務健全狀況報告描述影響 hello 的條件 hello 服務的整體健全狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-154">Service health reports describe conditions that affect hello overall health of hello service.</span></span> <span data-ttu-id="07682-155">hello 報告無法縮小 hello 問題 tooan 狀況不良資料分割或複本。</span><span class="sxs-lookup"><span data-stu-id="07682-155">hello reporter can't narrow down hello issue tooan unhealthy partition or replica.</span></span> <span data-ttu-id="07682-156">範例包括造成所有分割區發生問題的服務組態 (例如，連接埠或外部檔案共用)。</span><span class="sxs-lookup"><span data-stu-id="07682-156">Examples include a service configuration (such as port or external file share) that is causing issues for all partitions.</span></span> <span data-ttu-id="07682-157">hello 服務實體識別 hello 服務名稱 (URI)。</span><span class="sxs-lookup"><span data-stu-id="07682-157">hello service entity is identified by hello service name (URI).</span></span>
* <span data-ttu-id="07682-158">**資料分割**。</span><span class="sxs-lookup"><span data-stu-id="07682-158">**Partition**.</span></span> <span data-ttu-id="07682-159">代表 hello 健全狀況服務資料分割。</span><span class="sxs-lookup"><span data-stu-id="07682-159">Represents hello health of a service partition.</span></span> <span data-ttu-id="07682-160">資料分割健全狀況報表描述影響 hello 整個複本集的條件。</span><span class="sxs-lookup"><span data-stu-id="07682-160">Partition health reports describe conditions that affect hello entire replica set.</span></span> <span data-ttu-id="07682-161">範例包括 hello 複本數目低於目標計數時，以及資料分割是在仲裁遺失。</span><span class="sxs-lookup"><span data-stu-id="07682-161">Examples include when hello number of replicas is below target count and when a partition is in quorum loss.</span></span> <span data-ttu-id="07682-162">hello 磁碟分割實體識別 hello 資料分割識別碼 (GUID)。</span><span class="sxs-lookup"><span data-stu-id="07682-162">hello partition entity is identified by hello partition ID (GUID).</span></span>
* <span data-ttu-id="07682-163">**複本**。</span><span class="sxs-lookup"><span data-stu-id="07682-163">**Replica**.</span></span> <span data-ttu-id="07682-164">代表 hello 健全狀況狀態的服務複本或無狀態服務執行個體。</span><span class="sxs-lookup"><span data-stu-id="07682-164">Represents hello health of a stateful service replica or a stateless service instance.</span></span> <span data-ttu-id="07682-165">hello 複本是 hello watchdogs 與系統元件可報告的應用程式的最小單位。</span><span class="sxs-lookup"><span data-stu-id="07682-165">hello replica is hello smallest unit that watchdogs and system components can report on for an application.</span></span> <span data-ttu-id="07682-166">可設定狀態的服務的範例包括作業 toosecondaries 和速度緩慢的複寫無法複寫的主要複本。</span><span class="sxs-lookup"><span data-stu-id="07682-166">For stateful services, examples include a primary replica that can't replicate operations toosecondaries and slow replication.</span></span> <span data-ttu-id="07682-167">此外，若無狀態的執行個體在執行時資源不足或發生連線問題，則其會進行報告。</span><span class="sxs-lookup"><span data-stu-id="07682-167">Also, a stateless instance can report when it is running out of resources or has connectivity issues.</span></span> <span data-ttu-id="07682-168">hello 複本實體識別 hello 分割區識別碼 (GUID) 和 hello 複本或執行個體識別碼 （長整數）。</span><span class="sxs-lookup"><span data-stu-id="07682-168">hello replica entity is identified by hello partition ID (GUID) and hello replica or instance ID (long).</span></span>
* <span data-ttu-id="07682-169">**已部署應用程式**。</span><span class="sxs-lookup"><span data-stu-id="07682-169">**DeployedApplication**.</span></span> <span data-ttu-id="07682-170">代表 hello 的健全狀況*節點上執行的應用程式*。</span><span class="sxs-lookup"><span data-stu-id="07682-170">Represents hello health of an *application running on a node*.</span></span> <span data-ttu-id="07682-171">部署的應用程式健康情況報告描述條件特定 toohello 應用程式上無法縮小 tooservice 套件 hello 上部署的 hello 節點相同的節點。</span><span class="sxs-lookup"><span data-stu-id="07682-171">Deployed application health reports describe conditions specific toohello application on hello node that can't be narrowed down tooservice packages deployed on hello same node.</span></span> <span data-ttu-id="07682-172">範例包括錯誤時無法在該節點上下載應用程式套件和應用程式的安全性主體 hello 節點上所設定的問題。</span><span class="sxs-lookup"><span data-stu-id="07682-172">Examples include errors when application package can't be downloaded on that node and issues setting up application security principals on hello node.</span></span> <span data-ttu-id="07682-173">部署的 hello 應用程式識別應用程式名稱 (URI) 和節點名稱 （字串）。</span><span class="sxs-lookup"><span data-stu-id="07682-173">hello deployed application is identified by application name (URI) and node name (string).</span></span>
* <span data-ttu-id="07682-174">**已部署服務封裝**。</span><span class="sxs-lookup"><span data-stu-id="07682-174">**DeployedServicePackage**.</span></span> <span data-ttu-id="07682-175">代表 hello hello 叢集中的節點上執行的服務封裝健全狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-175">Represents hello health of a service package running on a node in hello cluster.</span></span> <span data-ttu-id="07682-176">它描述條件特定 tooa 服務封裝不會影響 hello 其他服務封裝上 hello hello 的相同節點相同的應用程式。</span><span class="sxs-lookup"><span data-stu-id="07682-176">It describes conditions specific tooa service package that do not affect hello other service packages on hello same node for hello same application.</span></span> <span data-ttu-id="07682-177">範例包括 hello 無法啟動的服務封裝和組態的封裝無法讀取程式碼封裝。</span><span class="sxs-lookup"><span data-stu-id="07682-177">Examples include a code package in hello service package that cannot be started and a configuration package that cannot be read.</span></span> <span data-ttu-id="07682-178">識別部署的 hello 服務封裝應用程式名稱 (URI)、 節點名稱 （字串）、 服務資訊清單的名稱 （字串） 和服務套件啟用識別碼 （字串）。</span><span class="sxs-lookup"><span data-stu-id="07682-178">hello deployed service package is identified by application name (URI), node name (string), service manifest name (string), and service package activation ID (string).</span></span>

<span data-ttu-id="07682-179">hello 資料粒度的 hello 健全狀況模型可讓您輕鬆 toodetect 和修正問題。</span><span class="sxs-lookup"><span data-stu-id="07682-179">hello granularity of hello health model makes it easy toodetect and correct issues.</span></span> <span data-ttu-id="07682-180">例如，如果服務沒有回應，它是可行 hello 應用程式執行個體的 tooreport 會處於狀況不良。</span><span class="sxs-lookup"><span data-stu-id="07682-180">For example, if a service is not responding, it is feasible tooreport that hello application instance is unhealthy.</span></span> <span data-ttu-id="07682-181">報告在層級不理想的做法，不過，因為 hello 問題可能不會影響所有 hello 服務該應用程式中。</span><span class="sxs-lookup"><span data-stu-id="07682-181">Reporting at that level is not ideal, however, because hello issue might not be affecting all hello services within that application.</span></span> <span data-ttu-id="07682-182">hello 報表應該在套用的 toohello 狀況不良的服務或 tooa 特定的子資料分割，如果更多資訊點 toothat 磁碟分割。</span><span class="sxs-lookup"><span data-stu-id="07682-182">hello report should be applied toohello unhealthy service or tooa specific child partition, if more information points toothat partition.</span></span> <span data-ttu-id="07682-183">hello 自動透過 hello 階層的介面和狀況不良的資料分割也會看到資料服務和應用程式層級。</span><span class="sxs-lookup"><span data-stu-id="07682-183">hello data automatically surfaces through hello hierarchy, and an unhealthy partition is made visible at service and application levels.</span></span> <span data-ttu-id="07682-184">此彙總有助於 toopinpoint，並更快速地解決 hello hello 問題根本原因。</span><span class="sxs-lookup"><span data-stu-id="07682-184">This aggregation helps toopinpoint and resolve hello root cause of hello issue more quickly.</span></span>

<span data-ttu-id="07682-185">hello 健全狀況階層是父子式關聯性所組成。</span><span class="sxs-lookup"><span data-stu-id="07682-185">hello health hierarchy is composed of parent-child relationships.</span></span> <span data-ttu-id="07682-186">叢集是由節點和應用程式所組成。</span><span class="sxs-lookup"><span data-stu-id="07682-186">A cluster is composed of nodes and applications.</span></span> <span data-ttu-id="07682-187">應用程式包含服務和已部署的應用程式。</span><span class="sxs-lookup"><span data-stu-id="07682-187">Applications have services and deployed applications.</span></span> <span data-ttu-id="07682-188">已部署的應用程式包含已部署的服務封裝。</span><span class="sxs-lookup"><span data-stu-id="07682-188">Deployed applications have deployed service packages.</span></span> <span data-ttu-id="07682-189">服務包含資料分割，且每個資料分割包含一個或多個複本。</span><span class="sxs-lookup"><span data-stu-id="07682-189">Services have partitions, and each partition has one or more replicas.</span></span> <span data-ttu-id="07682-190">節點和已部署實體之間具有特殊關聯性。</span><span class="sxs-lookup"><span data-stu-id="07682-190">There is a special relationship between nodes and deployed entities.</span></span> <span data-ttu-id="07682-191">狀況不良的節點回報其授權單位系統元件 hello Failover Manager service 會影響部署的 hello 應用程式、 服務套件，以及在其上部署的複本。</span><span class="sxs-lookup"><span data-stu-id="07682-191">An unhealthy node as reported by its authority system component, hello Failover Manager service, affects hello deployed applications, service packages, and replicas deployed on it.</span></span>

<span data-ttu-id="07682-192">hello 健全狀況階層代表 hello hello 系統根據了 hello 最新的健康情況報告，幾乎即時的資訊最新狀態。</span><span class="sxs-lookup"><span data-stu-id="07682-192">hello health hierarchy represents hello latest state of hello system based on hello latest health reports, which is almost real-time information.</span></span>
<span data-ttu-id="07682-193">內部和外部 watchdogs 可以報告在 hello 相同的實體會根據特定應用程式邏輯或自訂受監視的狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-193">Internal and external watchdogs can report on hello same entities based on application-specific logic or custom monitored conditions.</span></span> <span data-ttu-id="07682-194">使用者報告共存 hello 系統報告。</span><span class="sxs-lookup"><span data-stu-id="07682-194">User reports coexist with hello system reports.</span></span>

<span data-ttu-id="07682-195">規劃 tooinvest tooreport 和回應期間 hello toohealth 如何設計大型的雲端服務中。</span><span class="sxs-lookup"><span data-stu-id="07682-195">Plan tooinvest in how tooreport and respond toohealth during hello design of a large cloud service.</span></span> <span data-ttu-id="07682-196">此預付 investement 讓 hello 服務更容易 toodebug，監控和操作。</span><span class="sxs-lookup"><span data-stu-id="07682-196">This up-front investement makes hello service easier toodebug, monitor, and operate.</span></span>

## <a name="health-states"></a><span data-ttu-id="07682-197">健康狀態</span><span class="sxs-lookup"><span data-stu-id="07682-197">Health states</span></span>
<span data-ttu-id="07682-198">Service Fabric 實體是否狀況良好，或不會使用三種健全狀況狀態 toodescribe: [確定]，警告和錯誤。</span><span class="sxs-lookup"><span data-stu-id="07682-198">Service Fabric uses three health states toodescribe whether an entity is healthy or not: OK, warning, and error.</span></span> <span data-ttu-id="07682-199">所傳送的任何報告 toohello 健全狀況存放區都必須指定其中一種狀態。</span><span class="sxs-lookup"><span data-stu-id="07682-199">Any report sent toohello health store must specify one of these states.</span></span> <span data-ttu-id="07682-200">hello 健全狀況評估結果為其中一種狀態。</span><span class="sxs-lookup"><span data-stu-id="07682-200">hello health evaluation result is one of these states.</span></span>

<span data-ttu-id="07682-201">hello 可能[健全狀況狀態](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthstate)是：</span><span class="sxs-lookup"><span data-stu-id="07682-201">hello possible [health states](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthstate) are:</span></span>

* <span data-ttu-id="07682-202">**OK**。</span><span class="sxs-lookup"><span data-stu-id="07682-202">**OK**.</span></span> <span data-ttu-id="07682-203">hello 實體是狀況良好。</span><span class="sxs-lookup"><span data-stu-id="07682-203">hello entity is healthy.</span></span> <span data-ttu-id="07682-204">報告實體本身或其子系 (適用時) 沒有已知問題。</span><span class="sxs-lookup"><span data-stu-id="07682-204">There are no known issues reported on it or its children (when applicable).</span></span>
* <span data-ttu-id="07682-205">**Warning**。</span><span class="sxs-lookup"><span data-stu-id="07682-205">**Warning**.</span></span> <span data-ttu-id="07682-206">hello 實體有一些問題，但它仍然可以正常運作。</span><span class="sxs-lookup"><span data-stu-id="07682-206">hello entity has some issues, but it can still function correctly.</span></span> <span data-ttu-id="07682-207">例如，發生延遲，但尚未造成任何功能上的問題。</span><span class="sxs-lookup"><span data-stu-id="07682-207">For example, there are delays, but they do not cause any functional issues yet.</span></span> <span data-ttu-id="07682-208">在某些情況下，hello 警告狀況可能可以解決本身不需要外部介入。</span><span class="sxs-lookup"><span data-stu-id="07682-208">In some cases, hello warning condition may fix itself without external intervention.</span></span> <span data-ttu-id="07682-209">在這些情況下，健康情況報告會引起關注，並提供後續狀況的可見性。</span><span class="sxs-lookup"><span data-stu-id="07682-209">In these cases, health reports raise awareness and provide visibility into what is going on.</span></span> <span data-ttu-id="07682-210">在其他情況下，可能會降低不需要使用者介入的嚴重問題的 hello 警告狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-210">In other cases, hello warning condition may degrade into a severe problem without user intervention.</span></span>
* <span data-ttu-id="07682-211">**Error**。</span><span class="sxs-lookup"><span data-stu-id="07682-211">**Error**.</span></span> <span data-ttu-id="07682-212">hello 實體會處於狀況不良。</span><span class="sxs-lookup"><span data-stu-id="07682-212">hello entity is unhealthy.</span></span> <span data-ttu-id="07682-213">應採取動作 toofix hello 狀態 hello 實體，因為無法正確運作。</span><span class="sxs-lookup"><span data-stu-id="07682-213">Action should be taken toofix hello state of hello entity, because it can't function properly.</span></span>
* <span data-ttu-id="07682-214">**Unknown**。</span><span class="sxs-lookup"><span data-stu-id="07682-214">**Unknown**.</span></span> <span data-ttu-id="07682-215">hello 實體不存在 hello health store 中。</span><span class="sxs-lookup"><span data-stu-id="07682-215">hello entity doesn't exist in hello health store.</span></span> <span data-ttu-id="07682-216">此結果可取得 hello 分散式查詢，使多個元件的結果合併。</span><span class="sxs-lookup"><span data-stu-id="07682-216">This result can be obtained from hello distributed queries that merge results from multiple components.</span></span> <span data-ttu-id="07682-217">比方說，hello 取得節點清單的查詢會太**FailoverManager**， **ClusterManager**，和**HealthManager**; 取得應用程式清單查詢會太**ClusterManager**和**HealthManager**。</span><span class="sxs-lookup"><span data-stu-id="07682-217">For example, hello get node list query goes too**FailoverManager**, **ClusterManager**, and **HealthManager**; get application list query goes too**ClusterManager** and **HealthManager**.</span></span> <span data-ttu-id="07682-218">這些查詢會合併來自多個系統元件的結果。</span><span class="sxs-lookup"><span data-stu-id="07682-218">These queries merge results from multiple system components.</span></span> <span data-ttu-id="07682-219">如果另一個系統元件傳回 health store 中所沒有的實體，hello 合併的結果具有未知健全狀況狀態。</span><span class="sxs-lookup"><span data-stu-id="07682-219">If another system component returns an entity that is not present in health store, hello merged result has unknown health state.</span></span> <span data-ttu-id="07682-220">實體不在存放區因為健康情況報告尚未處理或 hello 實體已被清除之後刪除。</span><span class="sxs-lookup"><span data-stu-id="07682-220">An entity is not in store because health reports have not yet been processed or hello entity has been cleaned up after deletion.</span></span>

## <a name="health-policies"></a><span data-ttu-id="07682-221">健康狀態原則</span><span class="sxs-lookup"><span data-stu-id="07682-221">Health policies</span></span>
<span data-ttu-id="07682-222">hello 健全狀況的儲存區適用於健全狀況原則 toodetermine，實體是否狀況良好的報表和子系為基礎。</span><span class="sxs-lookup"><span data-stu-id="07682-222">hello health store applies health policies toodetermine whether an entity is healthy based on its reports and its children.</span></span>

> [!NOTE]
> <span data-ttu-id="07682-223">Hello （適用於叢集和節點的健全狀況評估） 的叢集資訊清單中，或在 hello （適用於應用程式評估和任何子系） 的應用程式資訊清單中，可以指定健康情況原則。</span><span class="sxs-lookup"><span data-stu-id="07682-223">Health policies can be specified in hello cluster manifest (for cluster and node health evaluation) or in hello application manifest (for application evaluation and any of its children).</span></span> <span data-ttu-id="07682-224">健康情況評估要求也可傳入僅用於該評估的自訂健康情況評估原則。</span><span class="sxs-lookup"><span data-stu-id="07682-224">Health evaluation requests can also pass in custom health evaluation policies, which are used only for that evaluation.</span></span>
> 
> 

<span data-ttu-id="07682-225">根據預設，Service Fabric 適用於嚴格的規則 （所有項目必須是狀況良好） hello 父子式階層式關聯性。</span><span class="sxs-lookup"><span data-stu-id="07682-225">By default, Service Fabric applies strict rules (everything must be healthy) for hello parent-child hierarchical relationship.</span></span> <span data-ttu-id="07682-226">如果即使其中一個 hello 系有一個狀況不良事件，hello 父系會被視為狀況不良。</span><span class="sxs-lookup"><span data-stu-id="07682-226">If even one of hello children has one unhealthy event, hello parent is considered unhealthy.</span></span>

### <a name="cluster-health-policy"></a><span data-ttu-id="07682-227">叢集健康狀態原則</span><span class="sxs-lookup"><span data-stu-id="07682-227">Cluster health policy</span></span>
<span data-ttu-id="07682-228">hello[叢集健全狀況原則](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy)是使用的 tooevaluate hello 叢集健全狀況狀態和節點的健全狀況狀態。</span><span class="sxs-lookup"><span data-stu-id="07682-228">hello [cluster health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy) is used tooevaluate hello cluster health state and node health states.</span></span> <span data-ttu-id="07682-229">hello 原則可以定義在 hello 叢集資訊清單。</span><span class="sxs-lookup"><span data-stu-id="07682-229">hello policy can be defined in hello cluster manifest.</span></span> <span data-ttu-id="07682-230">如果不存在，則會使用 hello 預設原則 （零容許失敗）。</span><span class="sxs-lookup"><span data-stu-id="07682-230">If it is not present, hello default policy (zero tolerated failures) is used.</span></span>
<span data-ttu-id="07682-231">hello 叢集健全狀況原則包含：</span><span class="sxs-lookup"><span data-stu-id="07682-231">hello cluster health policy contains:</span></span>

* <span data-ttu-id="07682-232">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.considerwarningaserror)。</span><span class="sxs-lookup"><span data-stu-id="07682-232">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.considerwarningaserror).</span></span> <span data-ttu-id="07682-233">指定健康情況評估期間是否 tootreat 警告健康情況報告為錯誤。</span><span class="sxs-lookup"><span data-stu-id="07682-233">Specifies whether tootreat warning health reports as errors during health evaluation.</span></span> <span data-ttu-id="07682-234">預設：false。</span><span class="sxs-lookup"><span data-stu-id="07682-234">Default: false.</span></span>
* <span data-ttu-id="07682-235">[MaxPercentUnhealthyApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthyapplications)。</span><span class="sxs-lookup"><span data-stu-id="07682-235">[MaxPercentUnhealthyApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthyapplications).</span></span> <span data-ttu-id="07682-236">指定 hello 的最大容許的百分比之前，會處於狀況不良 hello 叢集會被視為錯誤的應用程式。</span><span class="sxs-lookup"><span data-stu-id="07682-236">Specifies hello maximum tolerated percentage of applications that can be unhealthy before hello cluster is considered in error.</span></span>
* <span data-ttu-id="07682-237">[MaxPercentUnhealthyNodes](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthynodes)。</span><span class="sxs-lookup"><span data-stu-id="07682-237">[MaxPercentUnhealthyNodes](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthynodes).</span></span> <span data-ttu-id="07682-238">指定 hello 最大容許的百分比之前 hello 叢集會被視為錯誤則可以為狀況不良的節點。</span><span class="sxs-lookup"><span data-stu-id="07682-238">Specifies hello maximum tolerated percentage of nodes that can be unhealthy before hello cluster is considered in error.</span></span> <span data-ttu-id="07682-239">在大型叢集，有些節點永遠都是向下或出修復，所以此百分比應該是設定的 tootolerate 的。</span><span class="sxs-lookup"><span data-stu-id="07682-239">In large clusters, some nodes are always down or out for repairs, so this percentage should be configured tootolerate that.</span></span>
* <span data-ttu-id="07682-240">[ApplicationTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.applicationtypehealthpolicymap)。</span><span class="sxs-lookup"><span data-stu-id="07682-240">[ApplicationTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.applicationtypehealthpolicymap).</span></span> <span data-ttu-id="07682-241">hello 應用程式類型的健全狀況原則對應可以用於叢集健全狀況評估 toodescribe 特殊應用程式類型。</span><span class="sxs-lookup"><span data-stu-id="07682-241">hello application type health policy map can be used during cluster health evaluation toodescribe special application types.</span></span> <span data-ttu-id="07682-242">根據預設，所有的應用程式都會放入集區，並使用 MaxPercentUnhealthyApplications 加以評估。</span><span class="sxs-lookup"><span data-stu-id="07682-242">By default, all applications are put into a pool and evaluated with MaxPercentUnhealthyApplications.</span></span> <span data-ttu-id="07682-243">如果某些應用程式類型應該以不同的方式來處理，他們可以超出 hello 全域集區。</span><span class="sxs-lookup"><span data-stu-id="07682-243">If some application types should be treated differently, they can be taken out of hello global pool.</span></span> <span data-ttu-id="07682-244">相反地，它們可以對其 hello 對應中的應用程式類型名稱與相關聯的 hello 百分比。</span><span class="sxs-lookup"><span data-stu-id="07682-244">Instead, they are evaluated against hello percentages associated with their application type name in hello map.</span></span> <span data-ttu-id="07682-245">例如，在叢集中，有數千個不同類型的應用程式，以及某個特殊應用程式類型的數個控制應用程式執行個體。</span><span class="sxs-lookup"><span data-stu-id="07682-245">For example, in a cluster there are thousands of applications of different types, and a few control application instances of a special application type.</span></span> <span data-ttu-id="07682-246">hello 控制應用程式應該不會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="07682-246">hello control applications should never be in error.</span></span> <span data-ttu-id="07682-247">您可以指定全域 MaxPercentUnhealthyApplications too20 %tootolerate 某些失敗，但應用程式類型 」 ControlApplicationType"hello 設定 hello MaxPercentUnhealthyApplications too0。</span><span class="sxs-lookup"><span data-stu-id="07682-247">You can specify global MaxPercentUnhealthyApplications too20% tootolerate some failures, but for hello application type "ControlApplicationType" set hello MaxPercentUnhealthyApplications too0.</span></span> <span data-ttu-id="07682-248">如此一來，如果某些 hello 許多應用程式的狀況不良，但是低於 hello 全域的狀況不良百分比，就會產生 hello 叢集評估 tooWarning。</span><span class="sxs-lookup"><span data-stu-id="07682-248">This way, if some of hello many applications are unhealthy, but below hello global unhealthy percentage, hello cluster would be evaluated tooWarning.</span></span> <span data-ttu-id="07682-249">Warning 健康狀態並不會影響叢集升級或由 Error 健康狀態觸發的其他監視。</span><span class="sxs-lookup"><span data-stu-id="07682-249">A warning health state does not impact cluster upgrade or other monitoring triggered by Error health state.</span></span> <span data-ttu-id="07682-250">不過，即使一個控制應用程式中錯誤會使叢集狀況不良，觸發程序回復或暫停 hello 叢集升級時，視 hello 升級組態而定。</span><span class="sxs-lookup"><span data-stu-id="07682-250">But even one control application in error would make cluster unhealthy, which triggers roll back or pauses hello cluster upgrade, depending on hello upgrade configuration.</span></span>
  <span data-ttu-id="07682-251">Hello hello 對應中所定義的應用程式類型，所有的應用程式執行個體帶離 hello 全域集區的應用程式。</span><span class="sxs-lookup"><span data-stu-id="07682-251">For hello application types defined in hello map, all application instances are taken out of hello global pool of applications.</span></span> <span data-ttu-id="07682-252">它們可以根據 hello 總數 hello 應用程式類型的應用程式，使用 hello hello 從特定 MaxPercentUnhealthyApplications 對應。</span><span class="sxs-lookup"><span data-stu-id="07682-252">They are evaluated based on hello total number of applications of hello application type, using hello specific MaxPercentUnhealthyApplications from hello map.</span></span> <span data-ttu-id="07682-253">所有的 hello 其餘的 hello 應用程式仍會 hello 全域集區，並利用 MaxPercentUnhealthyApplications 來評估。</span><span class="sxs-lookup"><span data-stu-id="07682-253">All hello rest of hello applications remain in hello global pool and are evaluated with MaxPercentUnhealthyApplications.</span></span>

<span data-ttu-id="07682-254">下列範例中的 hello 是摘錄自叢集資訊清單。</span><span class="sxs-lookup"><span data-stu-id="07682-254">hello following example is an excerpt from a cluster manifest.</span></span> <span data-ttu-id="07682-255">toodefine hello 應用程式中的項目型別對應，以 「 ApplicationTypeMaxPercentUnhealthyApplications-」，後面接著 hello 應用程式類型名稱的前置詞 hello 參數名稱。</span><span class="sxs-lookup"><span data-stu-id="07682-255">toodefine entries in hello application type map, prefix hello parameter name with "ApplicationTypeMaxPercentUnhealthyApplications-", followed by hello application type name.</span></span>

```xml
<FabricSettings>
  <Section Name="HealthManager/ClusterHealthPolicy">
    <Parameter Name="ConsiderWarningAsError" Value="False" />
    <Parameter Name="MaxPercentUnhealthyApplications" Value="20" />
    <Parameter Name="MaxPercentUnhealthyNodes" Value="20" />
    <Parameter Name="ApplicationTypeMaxPercentUnhealthyApplications-ControlApplicationType" Value="0" />
  </Section>
</FabricSettings>
```

### <a name="application-health-policy"></a><span data-ttu-id="07682-256">應用程式健康狀態原則</span><span class="sxs-lookup"><span data-stu-id="07682-256">Application health policy</span></span>
<span data-ttu-id="07682-257">hello[應用程式健全狀況原則](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy)描述的事件和子狀態的彙總的 hello 評估應用程式和其子系的進行方式。</span><span class="sxs-lookup"><span data-stu-id="07682-257">hello [application health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy) describes how hello evaluation of events and child-states aggregation is done for applications and their children.</span></span> <span data-ttu-id="07682-258">它可以在 hello 應用程式資訊清單中定義**ApplicationManifest.xml**，hello 應用程式封裝中。</span><span class="sxs-lookup"><span data-stu-id="07682-258">It can be defined in hello application manifest, **ApplicationManifest.xml**, in hello application package.</span></span> <span data-ttu-id="07682-259">如果未不指定任何原則，Service Fabric 假設 hello 實體會處於狀況不良，如果它在 hello 警告或錯誤健全狀況狀態會有健全狀況報表或子系。</span><span class="sxs-lookup"><span data-stu-id="07682-259">If no policies are specified, Service Fabric assumes that hello entity is unhealthy if it has a health report or a child at hello warning or error health state.</span></span>
<span data-ttu-id="07682-260">hello 可設定的原則包括：</span><span class="sxs-lookup"><span data-stu-id="07682-260">hello configurable policies are:</span></span>

* <span data-ttu-id="07682-261">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.considerwarningaserror.aspx)。</span><span class="sxs-lookup"><span data-stu-id="07682-261">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.considerwarningaserror.aspx).</span></span> <span data-ttu-id="07682-262">指定健康情況評估期間是否 tootreat 警告健康情況報告為錯誤。</span><span class="sxs-lookup"><span data-stu-id="07682-262">Specifies whether tootreat warning health reports as errors during health evaluation.</span></span> <span data-ttu-id="07682-263">預設：false。</span><span class="sxs-lookup"><span data-stu-id="07682-263">Default: false.</span></span>
* <span data-ttu-id="07682-264">[MaxPercentUnhealthyDeployedApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.maxpercentunhealthydeployedapplications)。</span><span class="sxs-lookup"><span data-stu-id="07682-264">[MaxPercentUnhealthyDeployedApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.maxpercentunhealthydeployedapplications).</span></span> <span data-ttu-id="07682-265">指定已部署的應用程式可能會處於狀況不良之前 hello 應用程式會被視為錯誤的 hello 所容許之最大百分比。</span><span class="sxs-lookup"><span data-stu-id="07682-265">Specifies hello maximum tolerated percentage of deployed applications that can be unhealthy before hello application is considered in error.</span></span> <span data-ttu-id="07682-266">此百分比會計算除以 hello 數目狀況不良的已部署應用程式透過 hello hello 應用程式目前部署於 hello 叢集中的節點數目。</span><span class="sxs-lookup"><span data-stu-id="07682-266">This percentage is calculated by dividing hello number of unhealthy deployed applications over hello number of nodes that hello applications are currently deployed on in hello cluster.</span></span> <span data-ttu-id="07682-267">hello 計算進位 tootolerate 小的數字的節點上一次失敗。</span><span class="sxs-lookup"><span data-stu-id="07682-267">hello computation rounds up tootolerate one failure on small numbers of nodes.</span></span> <span data-ttu-id="07682-268">預設百分比：零。</span><span class="sxs-lookup"><span data-stu-id="07682-268">Default percentage: zero.</span></span>
* <span data-ttu-id="07682-269">[DefaultServiceTypeHealthPolicy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.defaultservicetypehealthpolicy)。</span><span class="sxs-lookup"><span data-stu-id="07682-269">[DefaultServiceTypeHealthPolicy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.defaultservicetypehealthpolicy).</span></span> <span data-ttu-id="07682-270">指定 hello 預設服務類型健全狀況原則，可取代 hello hello 應用程式中的所有服務類型的預設健全狀況原則。</span><span class="sxs-lookup"><span data-stu-id="07682-270">Specifies hello default service type health policy, which replaces hello default health policy for all service types in hello application.</span></span>
* <span data-ttu-id="07682-271">[ServiceTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.servicetypehealthpolicymap)。</span><span class="sxs-lookup"><span data-stu-id="07682-271">[ServiceTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.servicetypehealthpolicymap).</span></span> <span data-ttu-id="07682-272">針對每個服務類型提供服務健康狀態原則的對應。</span><span class="sxs-lookup"><span data-stu-id="07682-272">Provides a map of service health policies per service type.</span></span> <span data-ttu-id="07682-273">這些原則會取代 hello 預設服務類型健康原則的每個指定的服務類型。</span><span class="sxs-lookup"><span data-stu-id="07682-273">These policies replace hello default service type health policies for each specified service type.</span></span> <span data-ttu-id="07682-274">例如，如果某個應用程式的無狀態的閘道服務型別和可設定狀態的引擎服務類型，您可以以不同的方式設定其評估 hello 健康情況原則。</span><span class="sxs-lookup"><span data-stu-id="07682-274">For example, if an application has a stateless gateway service type and a stateful engine service type, you can configure hello health policies for their evaluation differently.</span></span> <span data-ttu-id="07682-275">當您指定每個服務類型的原則時，您可以更細微的控制權 hello hello 服務健全狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-275">When you specify policy per service type, you can gain more granular control of hello health of hello service.</span></span>

### <a name="service-type-health-policy"></a><span data-ttu-id="07682-276">服務類型健康狀態原則</span><span class="sxs-lookup"><span data-stu-id="07682-276">Service type health policy</span></span>
<span data-ttu-id="07682-277">hello[服務類型的健全狀況原則](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy)指定如何 tooevaluate 和彙總 hello 服務以及 hello 服務的子系。</span><span class="sxs-lookup"><span data-stu-id="07682-277">hello [service type health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy) specifies how tooevaluate and aggregate hello services and hello children of services.</span></span> <span data-ttu-id="07682-278">hello 原則包含：</span><span class="sxs-lookup"><span data-stu-id="07682-278">hello policy contains:</span></span>

* <span data-ttu-id="07682-279">[MaxPercentUnhealthyPartitionsPerService](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthypartitionsperservice)。</span><span class="sxs-lookup"><span data-stu-id="07682-279">[MaxPercentUnhealthyPartitionsPerService](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthypartitionsperservice).</span></span> <span data-ttu-id="07682-280">服務視為狀況不良之前，請指定狀況不良的資料分割的 hello 所容許之最大的百分比。</span><span class="sxs-lookup"><span data-stu-id="07682-280">Specifies hello maximum tolerated percentage of unhealthy partitions before a service is considered unhealthy.</span></span> <span data-ttu-id="07682-281">預設百分比：零。</span><span class="sxs-lookup"><span data-stu-id="07682-281">Default percentage: zero.</span></span>
* <span data-ttu-id="07682-282">[MaxPercentUnhealthyReplicasPerPartition](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyreplicasperpartition)。</span><span class="sxs-lookup"><span data-stu-id="07682-282">[MaxPercentUnhealthyReplicasPerPartition](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyreplicasperpartition).</span></span> <span data-ttu-id="07682-283">分割區視為狀況不良之前，請指定 hello 最大容許之百分比的狀況不良的複本。</span><span class="sxs-lookup"><span data-stu-id="07682-283">Specifies hello maximum tolerated percentage of unhealthy replicas before a partition is considered unhealthy.</span></span> <span data-ttu-id="07682-284">預設百分比：零。</span><span class="sxs-lookup"><span data-stu-id="07682-284">Default percentage: zero.</span></span>
* <span data-ttu-id="07682-285">[MaxPercentUnhealthyServices](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyservices)。</span><span class="sxs-lookup"><span data-stu-id="07682-285">[MaxPercentUnhealthyServices](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyservices).</span></span> <span data-ttu-id="07682-286">Hello 應用程式視為狀況不良之前，請指定 hello 所容許之最大狀況不良服務百分比。</span><span class="sxs-lookup"><span data-stu-id="07682-286">Specifies hello maximum tolerated percentage of unhealthy services before hello application is considered unhealthy.</span></span> <span data-ttu-id="07682-287">預設百分比：零。</span><span class="sxs-lookup"><span data-stu-id="07682-287">Default percentage: zero.</span></span>

<span data-ttu-id="07682-288">下列範例中的 hello 是摘錄自應用程式資訊清單：</span><span class="sxs-lookup"><span data-stu-id="07682-288">hello following example is an excerpt from an application manifest:</span></span>

```xml
    <Policies>
        <HealthPolicy ConsiderWarningAsError="true" MaxPercentUnhealthyDeployedApplications="20">
            <DefaultServiceTypeHealthPolicy
                   MaxPercentUnhealthyServices="0"
                   MaxPercentUnhealthyPartitionsPerService="10"
                   MaxPercentUnhealthyReplicasPerPartition="0"/>
            <ServiceTypeHealthPolicy ServiceTypeName="FrontEndServiceType"
                   MaxPercentUnhealthyServices="0"
                   MaxPercentUnhealthyPartitionsPerService="20"
                   MaxPercentUnhealthyReplicasPerPartition="0"/>
            <ServiceTypeHealthPolicy ServiceTypeName="BackEndServiceType"
                   MaxPercentUnhealthyServices="20"
                   MaxPercentUnhealthyPartitionsPerService="0"
                   MaxPercentUnhealthyReplicasPerPartition="0">
            </ServiceTypeHealthPolicy>
        </HealthPolicy>
    </Policies>
```

## <a name="health-evaluation"></a><span data-ttu-id="07682-289">健康狀態評估</span><span class="sxs-lookup"><span data-stu-id="07682-289">Health evaluation</span></span>
<span data-ttu-id="07682-290">使用者和自動化服務可以隨時評估任何實體的健康狀態。</span><span class="sxs-lookup"><span data-stu-id="07682-290">Users and automated services can evaluate health for any entity at any time.</span></span> <span data-ttu-id="07682-291">tooevaluate 實體健全狀況、 hello 健全狀況存放區的彙總所有健全狀況報告 hello 實體上，並評估所有子系 （如果適用的話）。</span><span class="sxs-lookup"><span data-stu-id="07682-291">tooevaluate an entity's health, hello health store aggregates all health reports on hello entity and evaluates all its children (when applicable).</span></span> <span data-ttu-id="07682-292">hello 健全狀況彙總演算法會使用健全狀況原則，以指定 tooevaluate 健全狀況的報告方式及如何 tooaggregate 子健全狀況狀態 （如果適用的話）。</span><span class="sxs-lookup"><span data-stu-id="07682-292">hello health aggregation algorithm uses health policies that specify how tooevaluate health reports and how tooaggregate child health states (when applicable).</span></span>

### <a name="health-report-aggregation"></a><span data-ttu-id="07682-293">健康狀態報告彙總</span><span class="sxs-lookup"><span data-stu-id="07682-293">Health report aggregation</span></span>
<span data-ttu-id="07682-294">一個實體可以具有由不同回報者針對不同屬性 (系統元件或看門狗) 所傳送的多個健康狀態報告。</span><span class="sxs-lookup"><span data-stu-id="07682-294">One entity can have multiple health reports sent by different reporters (system components or watchdogs) on different properties.</span></span> <span data-ttu-id="07682-295">hello 彙總使用 hello 關聯的健全狀況原則、 特別 hello ConsiderWarningAsError 成員的應用程式，或叢集健全狀況原則。</span><span class="sxs-lookup"><span data-stu-id="07682-295">hello aggregation uses hello associated health policies, in particular hello ConsiderWarningAsError member of application or cluster health policy.</span></span> <span data-ttu-id="07682-296">指定的 ConsiderWarningAsError 如何 tooevaluate 警告。</span><span class="sxs-lookup"><span data-stu-id="07682-296">ConsiderWarningAsError specifies how tooevaluate warnings.</span></span>

<span data-ttu-id="07682-297">hello 彙總健全狀況狀態由觸發 hello*最差*hello 實體上的健康情況報告。</span><span class="sxs-lookup"><span data-stu-id="07682-297">hello aggregated health state is triggered by hello *worst* health reports on hello entity.</span></span> <span data-ttu-id="07682-298">如果沒有至少一個錯誤健康情況報告，hello 彙總健全狀況狀態會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="07682-298">If there is at least one error health report, hello aggregated health state is an error.</span></span>

![健康狀態報告彙總，包含「Error」報告。][2]

<span data-ttu-id="07682-300">有一或多個錯誤健康狀態報告的健康狀態實體會評估為「錯誤」。</span><span class="sxs-lookup"><span data-stu-id="07682-300">A health entity that has one or more error health reports is evaluated as Error.</span></span> <span data-ttu-id="07682-301">hello 也適用於已過期的健康情況報告，不論其健全狀況狀態。</span><span class="sxs-lookup"><span data-stu-id="07682-301">hello same is true for an expired health report, regardless of its health state.</span></span>

[2]: ./media/service-fabric-health-introduction/servicefabric-health-report-eval-error.png

<span data-ttu-id="07682-302">如果有任何錯誤報告和一或多個警告，hello 彙總健全狀況狀態是警告或錯誤時，根據 hello ConsiderWarningAsError 原則旗標。</span><span class="sxs-lookup"><span data-stu-id="07682-302">If there are no error reports and one or more warnings, hello aggregated health state is either warning or error, depending on hello ConsiderWarningAsError policy flag.</span></span>

![健康狀態報告彙總，包含「Warning」報告和已設為 false 的 ConsiderWarningAsError。][3]

<span data-ttu-id="07682-304">健全狀況報表的彙總警告報表與 ConsiderWarningAsError 設定 toofalse （預設值）。</span><span class="sxs-lookup"><span data-stu-id="07682-304">Health report aggregation with warning report and ConsiderWarningAsError set toofalse (default).</span></span>

[3]: ./media/service-fabric-health-introduction/servicefabric-health-report-eval-warning.png

### <a name="child-health-aggregation"></a><span data-ttu-id="07682-305">子系健康狀態彙總</span><span class="sxs-lookup"><span data-stu-id="07682-305">Child health aggregation</span></span>
<span data-ttu-id="07682-306">hello 實體的彙總健全狀況狀態反映 hello 子健全狀況狀態 （如果適用的話）。</span><span class="sxs-lookup"><span data-stu-id="07682-306">hello aggregated health state of an entity reflects hello child health states (when applicable).</span></span> <span data-ttu-id="07682-307">彙總子健全狀況狀態的 hello 演算法使用 hello 健全狀況所適用的原則根據 hello 實體類型。</span><span class="sxs-lookup"><span data-stu-id="07682-307">hello algorithm for aggregating child health states uses hello health policies applicable based on hello entity type.</span></span>

![子系實體健康狀態彙總。][4]

<span data-ttu-id="07682-309">以健康狀態原則為基礎的子系彙總。</span><span class="sxs-lookup"><span data-stu-id="07682-309">Child aggregation based on health policies.</span></span>

[4]: ./media/service-fabric-health-introduction/servicefabric-health-hierarchy-eval.png

<span data-ttu-id="07682-310">Hello 健全狀況存放區評估 hello 的所有子系之後，它將彙總其健全狀況狀態，根據設定的 hello 的狀況不良的子系的最大百分比。</span><span class="sxs-lookup"><span data-stu-id="07682-310">After hello health store has evaluated all hello children, it aggregates their health states based on hello configured maximum percentage of unhealthy children.</span></span> <span data-ttu-id="07682-311">此百分比是取自 hello 原則根據 hello 實體和子類型。</span><span class="sxs-lookup"><span data-stu-id="07682-311">This percentage is taken from hello policy based on hello entity and child type.</span></span>

* <span data-ttu-id="07682-312">如果所有子系的 [確定] 狀態，hello 子彙總健全狀況狀態是 [確定]。</span><span class="sxs-lookup"><span data-stu-id="07682-312">If all children have OK states, hello child aggregated health state is OK.</span></span>
* <span data-ttu-id="07682-313">如果子系 [確定] 和警告狀態，hello 子彙總健全狀況狀態為警告。</span><span class="sxs-lookup"><span data-stu-id="07682-313">If children have both OK and warning states, hello child aggregated health state is warning.</span></span>
* <span data-ttu-id="07682-314">如果沒有子系不會採用 hello 允許的狀況不良的子系百分比的最大值的錯誤狀態，hello 彙總健全狀況狀態會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="07682-314">If there are children with error states that do not respect hello maximum allowed percentage of unhealthy children, hello aggregated health state is an error.</span></span>
* <span data-ttu-id="07682-315">如果以錯誤狀態尊重 hello 最大的 hello 子系所允許的狀況不良的子系的百分比 hello 彙總健全狀況狀態為警告。</span><span class="sxs-lookup"><span data-stu-id="07682-315">If hello children with error states respect hello maximum allowed percentage of unhealthy children, hello aggregated health state is warning.</span></span>

## <a name="health-reporting"></a><span data-ttu-id="07682-316">健康狀態報告</span><span class="sxs-lookup"><span data-stu-id="07682-316">Health reporting</span></span>
<span data-ttu-id="07682-317">系統元件、System Fabric 應用程式和內部/外部看門狗可以報告 Service Fabric 實體。</span><span class="sxs-lookup"><span data-stu-id="07682-317">System components, System Fabric applications, and internal/external watchdogs can report against Service Fabric entities.</span></span> <span data-ttu-id="07682-318">hello reporters 進行*本機*hello 根據 hello 條件所監視的受監視的 hello 實體健全狀況的決定。</span><span class="sxs-lookup"><span data-stu-id="07682-318">hello reporters make *local* determinations of hello health of hello monitored entities, based on hello conditions they are monitoring.</span></span> <span data-ttu-id="07682-319">它們不需要 toolook 任何全域狀態或彙總資料。</span><span class="sxs-lookup"><span data-stu-id="07682-319">They don't need toolook at any global state or aggregate data.</span></span> <span data-ttu-id="07682-320">hello 所需的行為是 toohave 簡單正常值，並不複雜的生態需要在許多事情 tooinfer toolook 何種資訊 toosend。</span><span class="sxs-lookup"><span data-stu-id="07682-320">hello desired behavior is toohave simple reporters, and not complex organisms that need toolook at many things tooinfer what information toosend.</span></span>

<span data-ttu-id="07682-321">toosend 健全狀況資料 toohello 健全狀況存放區，報告需要 tooidentify hello 影響實體並建立健康情況報告。</span><span class="sxs-lookup"><span data-stu-id="07682-321">toosend health data toohello health store, a reporter needs tooidentify hello affected entity and create a health report.</span></span> <span data-ttu-id="07682-322">toosend hello 報表，請使用 hello [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API，應用程式開發介面公開在 hello 回報健全狀況`Partition`或`CodePackageActivationContext`物件、 PowerShell cmdlet 或 REST。</span><span class="sxs-lookup"><span data-stu-id="07682-322">toosend hello report, use hello [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API, report health APIs exposed on hello `Partition` or `CodePackageActivationContext` objects, PowerShell cmdlets, or REST.</span></span>

### <a name="health-reports"></a><span data-ttu-id="07682-323">健康狀態報告</span><span class="sxs-lookup"><span data-stu-id="07682-323">Health reports</span></span>
<span data-ttu-id="07682-324">hello[健康情況報告](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthreport)hello 實體 hello 叢集中的每個包含 hello 下列資訊：</span><span class="sxs-lookup"><span data-stu-id="07682-324">hello [health reports](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthreport) for each of hello entities in hello cluster contain hello following information:</span></span>

* <span data-ttu-id="07682-325">**SourceId**。</span><span class="sxs-lookup"><span data-stu-id="07682-325">**SourceId**.</span></span> <span data-ttu-id="07682-326">可唯一識別 hello reporter hello 健全狀況事件的字串。</span><span class="sxs-lookup"><span data-stu-id="07682-326">A string that uniquely identifies hello reporter of hello health event.</span></span>
* <span data-ttu-id="07682-327">**實體識別碼**。</span><span class="sxs-lookup"><span data-stu-id="07682-327">**Entity identifier**.</span></span> <span data-ttu-id="07682-328">識別 hello 實體套用 hello 報表的位置。</span><span class="sxs-lookup"><span data-stu-id="07682-328">Identifies hello entity where hello report is applied.</span></span> <span data-ttu-id="07682-329">異 hello[實體類型](service-fabric-health-introduction.md#health-entities-and-hierarchy):</span><span class="sxs-lookup"><span data-stu-id="07682-329">It differs based on hello [entity type](service-fabric-health-introduction.md#health-entities-and-hierarchy):</span></span>
  
  * <span data-ttu-id="07682-330">叢集。</span><span class="sxs-lookup"><span data-stu-id="07682-330">Cluster.</span></span> <span data-ttu-id="07682-331">無。</span><span class="sxs-lookup"><span data-stu-id="07682-331">None.</span></span>
  * <span data-ttu-id="07682-332">節點。</span><span class="sxs-lookup"><span data-stu-id="07682-332">Node.</span></span> <span data-ttu-id="07682-333">節點名稱 (字串)。</span><span class="sxs-lookup"><span data-stu-id="07682-333">Node name  (string).</span></span>
  * <span data-ttu-id="07682-334">應用程式。</span><span class="sxs-lookup"><span data-stu-id="07682-334">Application.</span></span> <span data-ttu-id="07682-335">應用程式名稱 (URI)。</span><span class="sxs-lookup"><span data-stu-id="07682-335">Application name (URI).</span></span> <span data-ttu-id="07682-336">代表 hello hello 叢集中部署的 hello 應用程式執行個體名稱。</span><span class="sxs-lookup"><span data-stu-id="07682-336">Represents hello name of hello application instance deployed in hello cluster.</span></span>
  * <span data-ttu-id="07682-337">服務。</span><span class="sxs-lookup"><span data-stu-id="07682-337">Service.</span></span> <span data-ttu-id="07682-338">服務名稱 (URI)。</span><span class="sxs-lookup"><span data-stu-id="07682-338">Service name (URI).</span></span> <span data-ttu-id="07682-339">代表 hello hello 叢集中部署的 hello 服務執行個體名稱。</span><span class="sxs-lookup"><span data-stu-id="07682-339">Represents hello name of hello service instance deployed in hello cluster.</span></span>
  * <span data-ttu-id="07682-340">分割區。</span><span class="sxs-lookup"><span data-stu-id="07682-340">Partition.</span></span> <span data-ttu-id="07682-341">分割識別碼 (GUID)。</span><span class="sxs-lookup"><span data-stu-id="07682-341">Partition ID (GUID).</span></span> <span data-ttu-id="07682-342">代表 hello 資料分割的唯一識別碼。</span><span class="sxs-lookup"><span data-stu-id="07682-342">Represents hello partition unique identifier.</span></span>
  * <span data-ttu-id="07682-343">複本。</span><span class="sxs-lookup"><span data-stu-id="07682-343">Replica.</span></span> <span data-ttu-id="07682-344">hello 可設定狀態的服務複本識別碼或 hello 無狀態服務執行個體識別碼 (INT64)。</span><span class="sxs-lookup"><span data-stu-id="07682-344">hello stateful service replica ID or hello stateless service instance ID (INT64).</span></span>
  * <span data-ttu-id="07682-345">DeployedApplication。</span><span class="sxs-lookup"><span data-stu-id="07682-345">DeployedApplication.</span></span> <span data-ttu-id="07682-346">應用程式名稱 (URI) 和節點名稱 (字串)。</span><span class="sxs-lookup"><span data-stu-id="07682-346">Application name (URI) and node name (string).</span></span>
  * <span data-ttu-id="07682-347">DeployedServicePackage。</span><span class="sxs-lookup"><span data-stu-id="07682-347">DeployedServicePackage.</span></span> <span data-ttu-id="07682-348">應用程式名稱 (URI)、節點名稱 (字串) 和服務資訊清單名稱 (字串)。</span><span class="sxs-lookup"><span data-stu-id="07682-348">Application name (URI), node name (string), and service manifest name (string).</span></span>
* <span data-ttu-id="07682-349">**Property**。</span><span class="sxs-lookup"><span data-stu-id="07682-349">**Property**.</span></span> <span data-ttu-id="07682-350">A*字串*（不固定的列舉），可讓 hello reporter toocategorize hello 健全狀況事件的 hello 實體特定屬性。</span><span class="sxs-lookup"><span data-stu-id="07682-350">A *string* (not a fixed enumeration) that allows hello reporter toocategorize hello health event for a specific property of hello entity.</span></span> <span data-ttu-id="07682-351">例如，報告程式的可報告的 hello Node01"Storage"屬性的 hello 健全狀況，而且 reporter B 報告 hello Node01"連接性 」 屬性的 hello 健全狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-351">For example, reporter A can report hello health of hello Node01 "Storage" property and reporter B can report hello health of hello Node01 "Connectivity" property.</span></span> <span data-ttu-id="07682-352">Hello 健全狀況存放區中，這些報表會被視為個別的健全狀況事件 hello Node01 實體。</span><span class="sxs-lookup"><span data-stu-id="07682-352">In hello health store, these reports are treated as separate health events for hello Node01 entity.</span></span>
* <span data-ttu-id="07682-353">**Description**。</span><span class="sxs-lookup"><span data-stu-id="07682-353">**Description**.</span></span> <span data-ttu-id="07682-354">字串，可讓報告 tooprovide 詳細 hello 健全狀況事件的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="07682-354">A string that allows a reporter tooprovide detailed information about hello health event.</span></span> <span data-ttu-id="07682-355">**SourceId**，**屬性**，和**HealthState**應該完整描述 hello 報表。</span><span class="sxs-lookup"><span data-stu-id="07682-355">**SourceId**, **Property**, and **HealthState** should fully describe hello report.</span></span> <span data-ttu-id="07682-356">hello 描述新增 hello 報表人類看得懂的資訊。</span><span class="sxs-lookup"><span data-stu-id="07682-356">hello description adds human-readable information about hello report.</span></span> <span data-ttu-id="07682-357">hello 文字，方便系統管理員和使用者 toounderstand hello 健康情況報告。</span><span class="sxs-lookup"><span data-stu-id="07682-357">hello text makes it easier for administrators and users toounderstand hello health report.</span></span>
* <span data-ttu-id="07682-358">**HealthState**。</span><span class="sxs-lookup"><span data-stu-id="07682-358">**HealthState**.</span></span> <span data-ttu-id="07682-359">[列舉](service-fabric-health-introduction.md#health-states)描述 hello 報表 hello 健全狀況狀態。</span><span class="sxs-lookup"><span data-stu-id="07682-359">An [enumeration](service-fabric-health-introduction.md#health-states) that describes hello health state of hello report.</span></span> <span data-ttu-id="07682-360">hello 接受的值為 [確定]、 警告和錯誤。</span><span class="sxs-lookup"><span data-stu-id="07682-360">hello accepted values are OK, Warning, and Error.</span></span>
* <span data-ttu-id="07682-361">**TimeToLive**。</span><span class="sxs-lookup"><span data-stu-id="07682-361">**TimeToLive**.</span></span> <span data-ttu-id="07682-362">表示多久 hello 健全狀況報表時間範圍無效。</span><span class="sxs-lookup"><span data-stu-id="07682-362">A timespan that indicates how long hello health report is valid.</span></span> <span data-ttu-id="07682-363">搭配**RemoveWhenExpired**，它可讓知道如何 tooevaluate 過期事件 hello 健全狀況存放區。</span><span class="sxs-lookup"><span data-stu-id="07682-363">Coupled with **RemoveWhenExpired**, it lets hello health store know how tooevaluate expired events.</span></span> <span data-ttu-id="07682-364">根據預設，hello 值是無限的而且 hello 報表是永遠有效。</span><span class="sxs-lookup"><span data-stu-id="07682-364">By default, hello value is infinite, and hello report is valid forever.</span></span>
* <span data-ttu-id="07682-365">**RemoveWhenExpired**。</span><span class="sxs-lookup"><span data-stu-id="07682-365">**RemoveWhenExpired**.</span></span> <span data-ttu-id="07682-366">布林值。</span><span class="sxs-lookup"><span data-stu-id="07682-366">A Boolean.</span></span> <span data-ttu-id="07682-367">如果設定 tootrue，hello 過期的健全狀況報表會自動移除 hello 健全狀況存放區，並 hello 報表不會影響實體健全狀況評估。</span><span class="sxs-lookup"><span data-stu-id="07682-367">If set tootrue, hello expired health report is automatically removed from hello health store, and hello report doesn't impact entity health evaluation.</span></span> <span data-ttu-id="07682-368">Hello 報表有效期為一段指定時間，與 hello 報告時，使用不需要 tooexplicitly 清除它。它也使用從 hello health store toodelete 報表 （例如，可變更和停止傳送與先前的來源和屬性的報表監視）。</span><span class="sxs-lookup"><span data-stu-id="07682-368">Used when hello report is valid for a specified period of time only, and hello reporter doesn't need tooexplicitly clear it out. It's also used toodelete reports from hello health store (for example, a watchdog is changed and stops sending reports with previous source and property).</span></span> <span data-ttu-id="07682-369">可傳送簡短 TimeToLive RemoveWhenExpired tooclear 以及具有報表從 hello health store 任何先前的狀態。</span><span class="sxs-lookup"><span data-stu-id="07682-369">It can send a report with a brief TimeToLive along with RemoveWhenExpired tooclear up any previous state from hello health store.</span></span> <span data-ttu-id="07682-370">如果設定 hello 值 toofalse，hello 過期的報表會被視為 hello 健全狀況評估錯誤。</span><span class="sxs-lookup"><span data-stu-id="07682-370">If hello value is set toofalse, hello expired report is treated as an error on hello health evaluation.</span></span> <span data-ttu-id="07682-371">hello false 值表示 toohello 健全狀況存放區，該 hello 來源應該定期報告，這個屬性上。</span><span class="sxs-lookup"><span data-stu-id="07682-371">hello false value signals toohello health store that hello source should report periodically on this property.</span></span> <span data-ttu-id="07682-372">如果沒有，則有必須 hello 監視問題。</span><span class="sxs-lookup"><span data-stu-id="07682-372">If it doesn't, then there must be something wrong with hello watchdog.</span></span> <span data-ttu-id="07682-373">考慮為錯誤的 hello 事件擷取 hello 監視健全狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-373">hello watchdog's health is captured by considering hello event as an error.</span></span>
* <span data-ttu-id="07682-374">**SequenceNumber**。</span><span class="sxs-lookup"><span data-stu-id="07682-374">**SequenceNumber**.</span></span> <span data-ttu-id="07682-375">正整數，這個值需要 toobe 不斷增加，它代表 hello 報表 hello 順序。</span><span class="sxs-lookup"><span data-stu-id="07682-375">A positive integer that needs toobe ever-increasing, it represents hello order of hello reports.</span></span> <span data-ttu-id="07682-376">它會使用 hello 健康狀態存放區 toodetect 過時報表晚期會收到是因為網路延遲或其他問題。</span><span class="sxs-lookup"><span data-stu-id="07682-376">It is used by hello health store toodetect stale reports that are received late because of network delays or other issues.</span></span> <span data-ttu-id="07682-377">報表會拒絕 hello 序號是否小於或等於 toohello 最近套用號碼 hello 相同的實體、 來源和屬性。</span><span class="sxs-lookup"><span data-stu-id="07682-377">A report is rejected if hello sequence number is less than or equal toohello most recently applied number for hello same entity, source, and property.</span></span> <span data-ttu-id="07682-378">如果未指定，會自動產生 hello 序號。</span><span class="sxs-lookup"><span data-stu-id="07682-378">If it is not specified, hello sequence number is generated automatically.</span></span> <span data-ttu-id="07682-379">報告的狀態轉換時，才是必要 tooput hello 的序號。</span><span class="sxs-lookup"><span data-stu-id="07682-379">It is necessary tooput in hello sequence number only when reporting on state transitions.</span></span> <span data-ttu-id="07682-380">在此情況下，hello 來源必須的 tooremember 哪些報表它傳送，並記下進行復原的 hello 資訊在容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="07682-380">In this situation, hello source needs tooremember which reports it sent and keep hello information for recovery on failover.</span></span>

<span data-ttu-id="07682-381">每個健康狀態報告都需要四種資訊 (SourceId、實體識別碼、Property 和 HealthState)。</span><span class="sxs-lookup"><span data-stu-id="07682-381">These four pieces of information--SourceId, entity identifier, Property, and HealthState--are required for every health report.</span></span> <span data-ttu-id="07682-382">hello SourceId 字串不允許 toostart hello 前置詞"**系統**"，這保留供系統報告。</span><span class="sxs-lookup"><span data-stu-id="07682-382">hello SourceId string is not allowed toostart with hello prefix "**System.**", which is reserved for system reports.</span></span> <span data-ttu-id="07682-383">Hello 相同的實體沒有 hello 只能有一個報表相同的來源和屬性。</span><span class="sxs-lookup"><span data-stu-id="07682-383">For hello same entity, there is only one report for hello same source and property.</span></span> <span data-ttu-id="07682-384">多個報表 hello 相同的來源和屬性覆寫彼此 hello 的健全狀況用戶端 （如果不批次處理） 或 hello 健全狀況存放區端。</span><span class="sxs-lookup"><span data-stu-id="07682-384">Multiple reports for hello same source and property override each other, either on hello health client side (if they are batched) or on hello health store side.</span></span> <span data-ttu-id="07682-385">hello 取代為基礎的序號。（具有更高的序號） 較新的報表會取代較舊的報表。</span><span class="sxs-lookup"><span data-stu-id="07682-385">hello replacement is based on sequence numbers; newer reports (with higher sequence numbers) replace older reports.</span></span>

### <a name="health-events"></a><span data-ttu-id="07682-386">健康狀態事件</span><span class="sxs-lookup"><span data-stu-id="07682-386">Health events</span></span>
<span data-ttu-id="07682-387">就內部而言，hello 健全狀況存放區會保留[健全狀況事件](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthevent)，其中包含所有 hello 資訊 hello 報表和其他中繼資料。</span><span class="sxs-lookup"><span data-stu-id="07682-387">Internally, hello health store keeps [health events](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthevent), which contain all hello information from hello reports, and additional metadata.</span></span> <span data-ttu-id="07682-388">hello 中繼資料包括 hello 報表有 toohello 健全狀況的用戶端 hello 時間和 hello 伺服器端修改它的 hello 時間。</span><span class="sxs-lookup"><span data-stu-id="07682-388">hello metadata includes hello time hello report was given toohello health client and hello time it was modified on hello server side.</span></span> <span data-ttu-id="07682-389">hello 健全狀況事件都會傳回到由[健康狀態查詢](service-fabric-view-entities-aggregated-health.md#health-queries)。</span><span class="sxs-lookup"><span data-stu-id="07682-389">hello health events are returned by [health queries](service-fabric-view-entities-aggregated-health.md#health-queries).</span></span>

<span data-ttu-id="07682-390">hello 加入中繼資料包含：</span><span class="sxs-lookup"><span data-stu-id="07682-390">hello added metadata contains:</span></span>

* <span data-ttu-id="07682-391">**SourceUtcTimestamp**。</span><span class="sxs-lookup"><span data-stu-id="07682-391">**SourceUtcTimestamp**.</span></span> <span data-ttu-id="07682-392">hello hello 報表有 toohello 健全狀況用戶端 （國際標準時間）。</span><span class="sxs-lookup"><span data-stu-id="07682-392">hello time hello report was given toohello health client (Coordinated Universal Time).</span></span>
* <span data-ttu-id="07682-393">**LastModifiedUtcTimestamp**。</span><span class="sxs-lookup"><span data-stu-id="07682-393">**LastModifiedUtcTimestamp**.</span></span> <span data-ttu-id="07682-394">hello hello 報表上次修改 hello 伺服器端 （國際標準時間）。</span><span class="sxs-lookup"><span data-stu-id="07682-394">hello time hello report was last modified on hello server side (Coordinated Universal Time).</span></span>
* <span data-ttu-id="07682-395">**IsExpired**。</span><span class="sxs-lookup"><span data-stu-id="07682-395">**IsExpired**.</span></span> <span data-ttu-id="07682-396">旗標 tooindicate 是否 hello 報表已過期時 hello 查詢由 hello 健全狀況存放區中執行。</span><span class="sxs-lookup"><span data-stu-id="07682-396">A flag tooindicate whether hello report was expired when hello query was executed by hello health store.</span></span> <span data-ttu-id="07682-397">只有當 RemoveWhenExpired 為 False，事件才會過期。</span><span class="sxs-lookup"><span data-stu-id="07682-397">An event can be expired only if RemoveWhenExpired is false.</span></span> <span data-ttu-id="07682-398">否則，hello 事件不會由查詢傳回，並移除從 hello 存放區。</span><span class="sxs-lookup"><span data-stu-id="07682-398">Otherwise, hello event is not returned by query and is removed from hello store.</span></span>
* <span data-ttu-id="07682-399">**LastOkTransitionAt**、**LastWarningTransitionAt**、**LastErrorTransitionAt**。</span><span class="sxs-lookup"><span data-stu-id="07682-399">**LastOkTransitionAt**, **LastWarningTransitionAt**, **LastErrorTransitionAt**.</span></span> <span data-ttu-id="07682-400">hello 最後一次 [確定] / 警告/錯誤轉換的時間。</span><span class="sxs-lookup"><span data-stu-id="07682-400">hello last time for OK/warning/error transitions.</span></span> <span data-ttu-id="07682-401">這些欄位會提供 hello hello 健全狀況狀態轉換為 hello 事件的歷程記錄。</span><span class="sxs-lookup"><span data-stu-id="07682-401">These fields give hello history of hello health state transitions for hello event.</span></span>

<span data-ttu-id="07682-402">hello 狀態轉換欄位可用於更聰明的警示或 「 歷程記錄 」 的健全狀況事件的資訊。</span><span class="sxs-lookup"><span data-stu-id="07682-402">hello state transition fields can be used for smarter alerts or "historical" health event information.</span></span> <span data-ttu-id="07682-403">所適用的案例如下：</span><span class="sxs-lookup"><span data-stu-id="07682-403">They enable scenarios such as:</span></span>

* <span data-ttu-id="07682-404">當屬性處於「Warning/Error」狀態持續超過 X 分鐘時發出警示。</span><span class="sxs-lookup"><span data-stu-id="07682-404">Alert when a property has been at warning/error for more than X minutes.</span></span> <span data-ttu-id="07682-405">檢查一段時間的 hello 條件，可避免暫時狀況的警示。</span><span class="sxs-lookup"><span data-stu-id="07682-405">Checking hello condition for a period of time avoids alerts on temporary conditions.</span></span> <span data-ttu-id="07682-406">例如，如果會在發出警告超過五分鐘 hello 健康狀態警示可以轉譯成 (HealthState = 警告和現在-LastWarningTransitionTime = > 5 分鐘)。</span><span class="sxs-lookup"><span data-stu-id="07682-406">For example, an alert if hello health state has been warning for more than five minutes can be translated into (HealthState == Warning and Now - LastWarningTransitionTime > 5 minutes).</span></span>
* <span data-ttu-id="07682-407">警示只在上次 X 分鐘 hello 中已經變更的條件。</span><span class="sxs-lookup"><span data-stu-id="07682-407">Alert only on conditions that have changed in hello last X minutes.</span></span> <span data-ttu-id="07682-408">如果報表已在錯誤發生時 hello 指定時間之前，它可以被忽略，因為它信號便已存在之前。</span><span class="sxs-lookup"><span data-stu-id="07682-408">If a report was already at error before hello specified time, it can be ignored because it was already signaled previously.</span></span>
* <span data-ttu-id="07682-409">若屬性交叉出現警告和錯誤，請判斷狀況不良 (亦即不是 OK) 已持續多久。</span><span class="sxs-lookup"><span data-stu-id="07682-409">If a property is toggling between warning and error, determine how long it has been unhealthy (that is, not OK).</span></span> <span data-ttu-id="07682-410">比方說，如果 hello 屬性尚未不良的狀態已超過五分鐘警示可以轉譯成 (HealthState ！ = [確定] 並立即-LastOkTransitionTime > 5 分鐘)。</span><span class="sxs-lookup"><span data-stu-id="07682-410">For example, an alert if hello property hasn't been healthy for more than five minutes can be translated into (HealthState != Ok and Now - LastOkTransitionTime > 5 minutes).</span></span>

## <a name="example-report-and-evaluate-application-health"></a><span data-ttu-id="07682-411">範例：報告和評估應用程式健康狀態</span><span class="sxs-lookup"><span data-stu-id="07682-411">Example: Report and evaluate application health</span></span>
<span data-ttu-id="07682-412">hello 下列範例會傳送 hello 應用程式透過 PowerShell 健康情況報告**fabric: / WordCount** hello 來源**MyWatchdog**。</span><span class="sxs-lookup"><span data-stu-id="07682-412">hello following example sends a health report through PowerShell on hello application **fabric:/WordCount** from hello source **MyWatchdog**.</span></span> <span data-ttu-id="07682-413">hello 健康情況報告包含 hello 健全狀況屬性中的錯誤健全狀況狀態，具有無限 TimeToLive 的 「 可用性 」 的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="07682-413">hello health report contains information about hello health property "availability" in an error health state, with infinite TimeToLive.</span></span> <span data-ttu-id="07682-414">然後它會查詢 hello 應用程式健全狀況，並傳回彙總健全狀況狀態錯誤和 hello 回報的健全狀況事件的 hello 清單中的健全狀況事件。</span><span class="sxs-lookup"><span data-stu-id="07682-414">Then it queries hello application health, which returns aggregated health state errors and hello reported health events in hello list of health events.</span></span>

```powershell
PS C:\> Send-ServiceFabricApplicationHealthReport –ApplicationName fabric:/WordCount –SourceId "MyWatchdog" –HealthProperty "Availability" –HealthState Error

PS C:\> Get-ServiceFabricApplicationHealth fabric:/WordCount -ExcludeHealthStatistics


ApplicationName                 : fabric:/WordCount
AggregatedHealthState           : Error
UnhealthyEvaluations            :
                                  Error event: SourceId='MyWatchdog', Property='Availability'.

ServiceHealthStates             :
                                  ServiceName           : fabric:/WordCount/WordCountService
                                  AggregatedHealthState : Error

                                  ServiceName           : fabric:/WordCount/WordCountWebService
                                  AggregatedHealthState : Ok

DeployedApplicationHealthStates :
                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_0
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_2
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_3
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_4
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_1
                                  AggregatedHealthState : Ok

HealthEvents                    :
                                  SourceId              : System.CM
                                  Property              : State
                                  HealthState           : Ok
                                  SequenceNumber        : 360
                                  SentAt                : 3/22/2016 7:56:53 PM
                                  ReceivedAt            : 3/22/2016 7:56:53 PM
                                  TTL                   : Infinite
                                  Description           : Application has been created.
                                  RemoveWhenExpired     : False
                                  IsExpired             : False
                                  Transitions           : Error->Ok = 3/22/2016 7:56:53 PM, LastWarning = 1/1/0001 12:00:00 AM

                                  SourceId              : MyWatchdog
                                  Property              : Availability
                                  HealthState           : Error
                                  SequenceNumber        : 131032204762818013
                                  SentAt                : 3/23/2016 3:27:56 PM
                                  ReceivedAt            : 3/23/2016 3:27:56 PM
                                  TTL                   : Infinite
                                  Description           :
                                  RemoveWhenExpired     : False
                                  IsExpired             : False
                                  Transitions           : Ok->Error = 3/23/2016 3:27:56 PM, LastWarning = 1/1/0001 12:00:00 AM
```

## <a name="health-model-usage"></a><span data-ttu-id="07682-415">健康狀態模型使用方式</span><span class="sxs-lookup"><span data-stu-id="07682-415">Health model usage</span></span>
<span data-ttu-id="07682-416">hello 健全狀況模型可讓雲端服務和基礎 Service Fabric 平台 tooscale hello，因為監視與健全狀況判斷分散 hello hello 叢集內不同的監視器。</span><span class="sxs-lookup"><span data-stu-id="07682-416">hello health model allows cloud services and hello underlying Service Fabric platform tooscale, because monitoring and health determinations are distributed among hello different monitors within hello cluster.</span></span>
<span data-ttu-id="07682-417">其他系統在剖析所有 hello hello 叢集層級有單一且集中式服務*潛在*服務所發出的有用資訊。</span><span class="sxs-lookup"><span data-stu-id="07682-417">Other systems have a single, centralized service at hello cluster level that parses all hello *potentially* useful information emitted by services.</span></span> <span data-ttu-id="07682-418">這個方法會防礙其延展性。</span><span class="sxs-lookup"><span data-stu-id="07682-418">This approach hinders their scalability.</span></span> <span data-ttu-id="07682-419">它也不允許它們 toocollect toohelp 識別為盡可能關閉 toohello 根本原因的問題以及潛在問題的特定資訊。</span><span class="sxs-lookup"><span data-stu-id="07682-419">It also doesn't allow them toocollect specific information toohelp identify issues and potential issues as close toohello root cause as possible.</span></span>

<span data-ttu-id="07682-420">監視與診斷、 評估叢集和應用程式的健全狀況，以及受監視的升級，是大量使用 hello 健全狀況模型。</span><span class="sxs-lookup"><span data-stu-id="07682-420">hello health model is used heavily for monitoring and diagnosis, for evaluating cluster and application health, and for monitored upgrades.</span></span> <span data-ttu-id="07682-421">其他服務使用健全狀況資料 tooperform 自動修復，建置叢集健全狀況歷程記錄，並發出警示，在某些狀況。</span><span class="sxs-lookup"><span data-stu-id="07682-421">Other services use health data tooperform automatic repairs, build cluster health history, and issue alerts on certain conditions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="07682-422">後續步驟</span><span class="sxs-lookup"><span data-stu-id="07682-422">Next steps</span></span>
[<span data-ttu-id="07682-423">檢視 Service Fabric 健康狀態報告</span><span class="sxs-lookup"><span data-stu-id="07682-423">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="07682-424">使用系統健康狀態報告進行疑難排解</span><span class="sxs-lookup"><span data-stu-id="07682-424">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="07682-425">Tooreport 並檢查服務健全狀況</span><span class="sxs-lookup"><span data-stu-id="07682-425">How tooreport and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="07682-426">新增自訂 Service Fabric 健康狀態報告</span><span class="sxs-lookup"><span data-stu-id="07682-426">Add custom Service Fabric health reports</span></span>](service-fabric-report-health.md)

[<span data-ttu-id="07682-427">在本機上監視及診斷服務</span><span class="sxs-lookup"><span data-stu-id="07682-427">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="07682-428">Service Fabric 應用程式升級</span><span class="sxs-lookup"><span data-stu-id="07682-428">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)

