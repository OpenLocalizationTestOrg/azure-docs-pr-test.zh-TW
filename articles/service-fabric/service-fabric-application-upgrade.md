---
title: "aaaService Fabric 應用程式升級 |Microsoft 文件"
description: "本文章提供簡介 tooupgrading Service Fabric 應用程式，包括選擇升級模式和執行健全狀況檢查。"
services: service-fabric
documentationcenter: .net
author: mani-ramaswamy
manager: timlt
editor: 
ms.assetid: 803c9c63-373a-4d6a-8ef2-ea97e16e88dd
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 8/9/2017
ms.author: subramar
ms.openlocfilehash: 6f649ef4a5c0afab682522bcba7d2d66a4268ead
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="service-fabric-application-upgrade"></a><span data-ttu-id="1d6b0-103">Service Fabric 應用程式升級</span><span class="sxs-lookup"><span data-stu-id="1d6b0-103">Service Fabric application upgrade</span></span>
<span data-ttu-id="1d6b0-104">Azure Service Fabric 應用程式是服務集合。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-104">An Azure Service Fabric application is a collection of services.</span></span> <span data-ttu-id="1d6b0-105">在升級期間，Service Fabric 比較新的 hello[應用程式資訊清單](service-fabric-application-model.md#describe-an-application)的 hello 舊版本，並判斷哪些服務 hello 應用程式中的需要更新。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-105">During an upgrade, Service Fabric compares hello new [application manifest](service-fabric-application-model.md#describe-an-application) with hello previous version and determines which services in hello application require updates.</span></span> <span data-ttu-id="1d6b0-106">Service Fabric 比較 hello 版本 hello 服務中的數字資訊清單與 hello hello 前一版中的版本號碼。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-106">Service Fabric compares hello version numbers in hello service manifests with hello version numbers in hello previous version.</span></span> <span data-ttu-id="1d6b0-107">如果服務未變更，則該服務不會升級。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-107">If a service has not changed, that service is not upgraded.</span></span>

## <a name="rolling-upgrades-overview"></a><span data-ttu-id="1d6b0-108">輪流升級概觀</span><span class="sxs-lookup"><span data-stu-id="1d6b0-108">Rolling upgrades overview</span></span>
<span data-ttu-id="1d6b0-109">在循環的應用程式升級中，分階段執行 hello 升級。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-109">In a rolling application upgrade, hello upgrade is performed in stages.</span></span> <span data-ttu-id="1d6b0-110">在每個階段中，hello 升級已套用的 tooa hello 叢集中稱為更新網域的節點子集。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-110">At each stage, hello upgrade is applied tooa subset of nodes in hello cluster, called an update domain.</span></span> <span data-ttu-id="1d6b0-111">如此一來，hello 應用程式仍可在整個 hello 升級。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-111">As a result, hello application remains available throughout hello upgrade.</span></span> <span data-ttu-id="1d6b0-112">Hello 在升級期間，hello 叢集可能包含混合的 hello 舊的和新的版本。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-112">During hello upgrade, hello cluster may contain a mix of hello old and new versions.</span></span>

<span data-ttu-id="1d6b0-113">基於這個原因，hello 兩個版本必須向前和向後相容。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-113">For that reason, hello two versions must be forward and backward compatible.</span></span> <span data-ttu-id="1d6b0-114">如果不相容，hello 應用程式系統管理員是負責執行多個階段升級 toomaintain 可用性。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-114">If they are not compatible, hello application administrator is responsible for staging a multiple-phase upgrade toomaintain availability.</span></span> <span data-ttu-id="1d6b0-115">在多個階段升級中，hello 第一個步驟 tooan hello 與 hello 舊版本相容的應用程式的中繼版本升級。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-115">In a multiple-phase upgrade, hello first step is upgrading tooan intermediate version of hello application that is compatible with hello previous version.</span></span> <span data-ttu-id="1d6b0-116">hello 第二個步驟就是 tooupgrade hello 最終版本會中斷與 hello 更新前版本，相容性，但與 hello 中繼版本相容。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-116">hello second step is tooupgrade hello final version that breaks compatibility with hello pre-update version, but is compatible with hello intermediate version.</span></span>

<span data-ttu-id="1d6b0-117">當您設定 hello 叢集 hello 叢集資訊清單中指定更新網域。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-117">Update domains are specified in hello cluster manifest when you configure hello cluster.</span></span> <span data-ttu-id="1d6b0-118">更新網域不會以特定順序收到更新。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-118">Update domains do not receive updates in a particular order.</span></span> <span data-ttu-id="1d6b0-119">更新網域是應用程式的部署邏輯單元。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-119">An update domain is a logical unit of deployment for an application.</span></span> <span data-ttu-id="1d6b0-120">更新網域允許 hello 服務 tooremain 高可用性時，在升級期間。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-120">Update domains allow hello services tooremain at high availability during an upgrade.</span></span>

<span data-ttu-id="1d6b0-121">如果 hello 升級套用的 tooall hello 叢集中節點，也就是 hello 案例 hello 應用程式必須只有一個更新網域時，非輪流升級可能會。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-121">Non-rolling upgrades are possible if hello upgrade is applied tooall nodes in hello cluster, which is hello case when hello application has only one update domain.</span></span> <span data-ttu-id="1d6b0-122">不建議這種方法，因為 hello 服務中斷，且在升級 hello 時無法使用。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-122">This approach is not recommended, since hello service goes down and isn't available at hello time of upgrade.</span></span> <span data-ttu-id="1d6b0-123">此外，當叢集僅以一個更新網域進行設定時，Azure 不提供任何保證。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-123">Additionally, Azure doesn't provide any guarantees when a cluster is set up with only one update domain.</span></span>

## <a name="health-checks-during-upgrades"></a><span data-ttu-id="1d6b0-124">升級期間的健康狀態檢查</span><span class="sxs-lookup"><span data-stu-id="1d6b0-124">Health checks during upgrades</span></span>
<span data-ttu-id="1d6b0-125">進行升級時，健全狀況原則已設定的 toobe （或可能會使用預設值）。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-125">For an upgrade, health policies have toobe set (or default values may be used).</span></span> <span data-ttu-id="1d6b0-126">升級稱為成功時將所有更新網域都升級 hello 內指定逾時、 且時所有更新網域會被視為狀況良好。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-126">An upgrade is termed successful when all update domains are upgraded within hello specified time-outs, and when all update domains are deemed healthy.</span></span>  <span data-ttu-id="1d6b0-127">狀況良好的更新網域會表示該 hello 更新網域傳送 hello 健康原則中指定的所有 hello 健康情況檢查。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-127">A healthy update domain means that hello update domain passed all hello health checks specified in hello health policy.</span></span> <span data-ttu-id="1d6b0-128">例如，健康狀態原則可能會要求應用程式執行個體中的所有服務都必須 *健康狀態良好*，如 Service Fabric 定義的健康狀況。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-128">For example, a health policy may mandate that all services within an application instance must be *healthy*, as health is defined by Service Fabric.</span></span>

<span data-ttu-id="1d6b0-129">Service Fabric 在升級期間進行的健康狀態原則以及檢查不限於服務和應用程式。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-129">Health policies and checks during upgrade by Service Fabric are service and application agnostic.</span></span> <span data-ttu-id="1d6b0-130">也就是說，不會完成任何服務專屬的測試。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-130">That is, no service-specific tests are done.</span></span>  <span data-ttu-id="1d6b0-131">例如，您的服務可能會有的輸送量需求，但服務網狀架構並沒有 hello 資訊 toocheck 輸送量。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-131">For example, your service might have a throughput requirement, but Service Fabric does not have hello information toocheck throughput.</span></span> <span data-ttu-id="1d6b0-132">請參閱 toohello[健全狀況的發行項](service-fabric-health-introduction.md)的 hello 所執行的檢查。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-132">Refer toohello [health articles](service-fabric-health-introduction.md) for hello checks that are performed.</span></span> <span data-ttu-id="1d6b0-133">hello 檢查是否已啟動 hello 執行個體，可能發生的 hello 應用程式套件是否正確，複製升級包含測試，依此類推。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-133">hello checks that happen during an upgrade include tests for whether hello application package was copied correctly, whether hello instance was started, and so on.</span></span>

<span data-ttu-id="1d6b0-134">hello 應用程式健全狀況是彙總的 hello 子實體的 hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-134">hello application health is an aggregation of hello child entities of hello application.</span></span> <span data-ttu-id="1d6b0-135">簡單地說，Service Fabric 評估 hello hello 透過 hello 健全狀況所報告的 hello 應用程式的應用程式的健全狀況。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-135">In short, Service Fabric evaluates hello health of hello application through hello health that is reported on hello application.</span></span> <span data-ttu-id="1d6b0-136">它也會評估 hello hello 應用程式的所有 hello 服務的健全狀況這種方式。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-136">It also evaluates hello health of all hello services for hello application this way.</span></span> <span data-ttu-id="1d6b0-137">Service Fabric 進一步評估 hello 應用程式服務的 hello 健全狀況及其子系，例如 hello 服務複本 hello 健全狀況彙總。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-137">Service Fabric further evaluates hello health of hello application services by aggregating hello health of their children, such as hello service replica.</span></span> <span data-ttu-id="1d6b0-138">一旦符合 hello 應用程式健全狀況原則，hello 升級可以繼續。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-138">Once hello application health policy is satisfied, hello upgrade can proceed.</span></span> <span data-ttu-id="1d6b0-139">如果違反 hello 健全狀況原則，hello 應用程式升級失敗。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-139">If hello health policy is violated, hello application upgrade fails.</span></span>

## <a name="upgrade-modes"></a><span data-ttu-id="1d6b0-140">升級模式</span><span class="sxs-lookup"><span data-stu-id="1d6b0-140">Upgrade modes</span></span>
<span data-ttu-id="1d6b0-141">我們建議您針對應用程式升級的 hello 模式是 hello 監視模式，也就是 hello 常用的模式。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-141">hello mode that we recommend for application upgrade is hello monitored mode, which is hello commonly used mode.</span></span> <span data-ttu-id="1d6b0-142">受監視的模式執行 hello 升級一個更新網域上，如果所有健康情況檢查通過 （每個指定 hello 原則），自動將移 toohello 下一個更新網域上。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-142">Monitored mode performs hello upgrade on one update domain, and if all health checks pass (per hello policy specified), moves on toohello next update domain automatically.</span></span>  <span data-ttu-id="1d6b0-143">如果健全狀況檢查失敗且/或達到逾時，hello 升級或是回復 hello 更新網域，或 hello 模式為 已變更的 toounmonitored 手動。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-143">If health checks fail and/or time-outs are reached, hello upgrade is either rolled back for hello update domain, or hello mode is changed toounmonitored manual.</span></span> <span data-ttu-id="1d6b0-144">您可以設定 hello 升級 toochoose 失敗升級這些兩種模式之一。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-144">You can configure hello upgrade toochoose one of those two modes for failed upgrades.</span></span> 

<span data-ttu-id="1d6b0-145">未受監視的手動模式會在每個更新網域上的升級、 tookick 關閉 hello hello 下一個更新網域升級之後需要手動介入。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-145">Unmonitored manual mode needs manual intervention after every upgrade on an update domain, tookick off hello upgrade on hello next update domain.</span></span> <span data-ttu-id="1d6b0-146">系統不會執行任何 Service Fabric 健康狀態檢查。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-146">No Service Fabric health checks are performed.</span></span> <span data-ttu-id="1d6b0-147">hello 系統管理員會執行開始 hello 下一個更新網域中的 hello 升級之前的 hello 健全狀況或狀態檢查。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-147">hello administrator performs hello health or status checks before starting hello upgrade in hello next update domain.</span></span>

## <a name="upgrade-default-services"></a><span data-ttu-id="1d6b0-148">升級預設服務</span><span class="sxs-lookup"><span data-stu-id="1d6b0-148">Upgrade default services</span></span>
<span data-ttu-id="1d6b0-149">Hello 應用程式的升級程序期間，您可以升級 Service Fabric 應用程式中的預設服務。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-149">Default services within Service Fabric application can be upgraded during hello upgrade process of an application.</span></span> <span data-ttu-id="1d6b0-150">預設的服務定義中 hello[應用程式資訊清單](service-fabric-application-model.md#describe-an-application)。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-150">Default services are defined in hello [application manifest](service-fabric-application-model.md#describe-an-application).</span></span> <span data-ttu-id="1d6b0-151">升級預設服務的 hello 標準規則如下：</span><span class="sxs-lookup"><span data-stu-id="1d6b0-151">hello standard rules of upgrading default services are:</span></span>

1. <span data-ttu-id="1d6b0-152">預設服務在新的 hello[應用程式資訊清單](service-fabric-application-model.md#describe-an-application)hello 叢集中不存在，會建立。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-152">Default services in hello new [application manifest](service-fabric-application-model.md#describe-an-application) that do not exist in hello cluster are created.</span></span>
> [!TIP]
> <span data-ttu-id="1d6b0-153">[EnableDefaultServicesUpgrade](service-fabric-cluster-fabric-settings.md#fabric-settings-that-you-can-customize) toobe 需要設定下列規則 tootrue tooenable hello。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-153">[EnableDefaultServicesUpgrade](service-fabric-cluster-fabric-settings.md#fabric-settings-that-you-can-customize) needs toobe set tootrue tooenable hello following rules.</span></span> <span data-ttu-id="1d6b0-154">從 v5.5 可支援此功能。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-154">This feature is supported from v5.5.</span></span>

2. <span data-ttu-id="1d6b0-155">會更新在上一個[應用程式資訊清單](service-fabric-application-model.md#describe-an-application)及新版本中的預設服務。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-155">Default services existing in both previous [application manifest](service-fabric-application-model.md#describe-an-application) and new version are updated.</span></span> <span data-ttu-id="1d6b0-156">在 hello 新版本的服務描述會覆寫已經在 hello 叢集。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-156">Service descriptions in hello new version would overwrite those already in hello cluster.</span></span> <span data-ttu-id="1d6b0-157">在更新預設服務失敗時，應用程式升級會自動回復。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-157">Application upgrade would rollback automatically upon updating default service failure.</span></span>
3. <span data-ttu-id="1d6b0-158">預設服務在上一個 hello[應用程式資訊清單](service-fabric-application-model.md#describe-an-application)但是會刪除不在 hello 新版本。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-158">Default services in hello previous [application manifest](service-fabric-application-model.md#describe-an-application) but not in hello new version are deleted.</span></span> <span data-ttu-id="1d6b0-159">**請注意，無法還原此刪除預設服務。**</span><span class="sxs-lookup"><span data-stu-id="1d6b0-159">**Note that this deleting default services can not be reverted.**</span></span>

<span data-ttu-id="1d6b0-160">如果應用程式的升級回復，預設服務開始升級之前，就會是還原的 toohello 狀態。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-160">In case of an application upgrade is rolled back, default services are reverted toohello status before upgrade started.</span></span> <span data-ttu-id="1d6b0-161">但永遠無法建立已刪除的服務。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-161">But deleted services can never be created.</span></span>

## <a name="application-upgrade-flowchart"></a><span data-ttu-id="1d6b0-162">應用程式升級流程圖</span><span class="sxs-lookup"><span data-stu-id="1d6b0-162">Application upgrade flowchart</span></span>
<span data-ttu-id="1d6b0-163">遵循本段 hello 流程圖可協助您了解 hello Service Fabric 應用程式的升級程序。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-163">hello flowchart following this paragraph can help you understand hello upgrade process of a Service Fabric application.</span></span> <span data-ttu-id="1d6b0-164">Hello 流程特別的是，描述如何 hello 逾時、 包括*HealthCheckStableDuration*， *HealthCheckRetryTimeout*，和*UpgradeHealthCheckInterval*，當一個更新網域中的 hello 升級被視為成功或失敗時，協助控制。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-164">In particular, hello flow describes how hello time-outs, including *HealthCheckStableDuration*, *HealthCheckRetryTimeout*, and *UpgradeHealthCheckInterval*, help control when hello upgrade in one update domain is considered a success or a failure.</span></span>

![hello Service Fabric 應用程式的升級程序][image]

## <a name="next-steps"></a><span data-ttu-id="1d6b0-166">後續步驟</span><span class="sxs-lookup"><span data-stu-id="1d6b0-166">Next steps</span></span>
<span data-ttu-id="1d6b0-167">[使用 Visual Studio 升級您的應用程式](service-fabric-application-upgrade-tutorial.md) 將引導您完成使用 Visual Studio 進行應用程式升級的步驟。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-167">[Upgrading your Application Using Visual Studio](service-fabric-application-upgrade-tutorial.md) walks you through an application upgrade using Visual Studio.</span></span>

<span data-ttu-id="1d6b0-168">[使用 PowerShell 升級您的應用程式](service-fabric-application-upgrade-tutorial-powershell.md) 將引導您完成使用 PowerShell 進行應用程式升級的步驟。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-168">[Upgrading your Application Using Powershell](service-fabric-application-upgrade-tutorial-powershell.md) walks you through an application upgrade using PowerShell.</span></span>

<span data-ttu-id="1d6b0-169">使用 [升級參數](service-fabric-application-upgrade-parameters.md)來控制您應用程式的升級方式。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-169">Control how your application upgrades by using [Upgrade Parameters](service-fabric-application-upgrade-parameters.md).</span></span>

<span data-ttu-id="1d6b0-170">讓應用程式升級相容所學習如何 toouse[資料序列化](service-fabric-application-upgrade-data-serialization.md)。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-170">Make your application upgrades compatible by learning how toouse [Data Serialization](service-fabric-application-upgrade-data-serialization.md).</span></span>

<span data-ttu-id="1d6b0-171">了解 toouse 把太升級您的應用程式時所進階的功能[進階主題](service-fabric-application-upgrade-advanced.md)。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-171">Learn how toouse advanced functionality while upgrading your application by referring too[Advanced Topics](service-fabric-application-upgrade-advanced.md).</span></span>

<span data-ttu-id="1d6b0-172">藉由參考 toohello 步驟中的修正應用程式升級的一般問題[疑難排解應用程式升級](service-fabric-application-upgrade-troubleshooting.md)。</span><span class="sxs-lookup"><span data-stu-id="1d6b0-172">Fix common problems in application upgrades by referring toohello steps in [Troubleshooting Application Upgrades](service-fabric-application-upgrade-troubleshooting.md).</span></span>

[image]: media/service-fabric-application-upgrade/service-fabric-application-upgrade-flowchart.png
