---
title: "自訂服務網狀架構健全狀況報表 aaaAdd |Microsoft 文件"
description: "描述 toosend 自訂健全狀況報告 tooAzure Service Fabric 健康實體的方式。 提供設計和實作高品質健康狀態報告的建議。"
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 0a00a7d2-510e-47d0-8aa8-24c851ea847f
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: 12c9f664e2a457b4e1e8f340873ca60ebcefb097
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="add-custom-service-fabric-health-reports"></a><span data-ttu-id="d5f59-104">新增自訂 Service Fabric 健康狀態報告</span><span class="sxs-lookup"><span data-stu-id="d5f59-104">Add custom Service Fabric health reports</span></span>
<span data-ttu-id="d5f59-105">Azure Service Fabric 導入了[健全狀況模型](service-fabric-health-introduction.md)設計 tooflag 狀況不良的叢集，並在特定實體的應用程式狀況。</span><span class="sxs-lookup"><span data-stu-id="d5f59-105">Azure Service Fabric introduces a [health model](service-fabric-health-introduction.md) designed tooflag unhealthy cluster and application conditions on specific entities.</span></span> <span data-ttu-id="d5f59-106">hello 健全狀況模型使用**健全狀況 reporters** （系統元件和 watchdogs）。</span><span class="sxs-lookup"><span data-stu-id="d5f59-106">hello health model uses **health reporters** (system components and watchdogs).</span></span> <span data-ttu-id="d5f59-107">hello 目標是簡單、 快速地診斷並修復。</span><span class="sxs-lookup"><span data-stu-id="d5f59-107">hello goal is easy and fast diagnosis and repair.</span></span> <span data-ttu-id="d5f59-108">服務寫入器需要 toothink 預先關於健全狀況。</span><span class="sxs-lookup"><span data-stu-id="d5f59-108">Service writers need toothink upfront about health.</span></span> <span data-ttu-id="d5f59-109">應該報告可能會影響健全狀況的任何條件，尤其是它可以幫助旗標關閉 toohello 根本的問題。</span><span class="sxs-lookup"><span data-stu-id="d5f59-109">Any condition that can impact health should be reported on, especially if it can help flag problems close toohello root.</span></span> <span data-ttu-id="d5f59-110">hello 健全狀況資訊可以在偵錯及調查，節省時間與精力。</span><span class="sxs-lookup"><span data-stu-id="d5f59-110">hello health information can save time and effort on debugging and investigation.</span></span> <span data-ttu-id="d5f59-111">hello 效益是特別明顯一旦 hello 服務已啟動並執行 hello 雲端中大規模 （私人或 Azure）。</span><span class="sxs-lookup"><span data-stu-id="d5f59-111">hello usefulness is especially clear once hello service is up and running at scale in hello cloud (private or Azure).</span></span>

<span data-ttu-id="d5f59-112">感興趣的條件來識別 hello Service Fabric reporters 監視器。</span><span class="sxs-lookup"><span data-stu-id="d5f59-112">hello Service Fabric reporters monitor identified conditions of interest.</span></span> <span data-ttu-id="d5f59-113">它們會依據其本機檢視回報這些條件。</span><span class="sxs-lookup"><span data-stu-id="d5f59-113">They report on those conditions based on their local view.</span></span> <span data-ttu-id="d5f59-114">hello[健全狀況存放區](service-fabric-health-introduction.md#health-store)彙總健全狀況資料傳送所有 reporters toodetermine 是否實體的全域狀況良好。</span><span class="sxs-lookup"><span data-stu-id="d5f59-114">hello [health store](service-fabric-health-introduction.md#health-store) aggregates health data sent by all reporters toodetermine whether entities are globally healthy.</span></span> <span data-ttu-id="d5f59-115">預定的 toobe 豐富、 彈性且容易 toouse hello 模型。</span><span class="sxs-lookup"><span data-stu-id="d5f59-115">hello model is intended toobe rich, flexible, and easy toouse.</span></span> <span data-ttu-id="d5f59-116">hello 健康情況報告的 hello 品質決定 hello 精確度的 hello hello 叢集健全狀況檢視。</span><span class="sxs-lookup"><span data-stu-id="d5f59-116">hello quality of hello health reports determines hello accuracy of hello health view of hello cluster.</span></span> <span data-ttu-id="d5f59-117">不正確顯示出健康不良的問題之誤報，會對升級或其他使用健康狀態資料的服務產生負面影響。</span><span class="sxs-lookup"><span data-stu-id="d5f59-117">False positives that wrongly show unhealthy issues can negatively impact upgrades or other services that use health data.</span></span> <span data-ttu-id="d5f59-118">這類服務的範例包括修復服務和警示機制。</span><span class="sxs-lookup"><span data-stu-id="d5f59-118">Examples of such services are repair services and alerting mechanisms.</span></span> <span data-ttu-id="d5f59-119">因此，思考是擷取感興趣 hello 條件的所需的 tooprovide 報告的最佳可能方式。</span><span class="sxs-lookup"><span data-stu-id="d5f59-119">Therefore, some thought is needed tooprovide reports that capture conditions of interest in hello best possible way.</span></span>

<span data-ttu-id="d5f59-120">toodesign 和實作健全狀況報告、 watchdogs 和系統元件必須：</span><span class="sxs-lookup"><span data-stu-id="d5f59-120">toodesign and implement health reporting, watchdogs and system components must:</span></span>

* <span data-ttu-id="d5f59-121">定義感興趣的 hello 條件、 hello 方式會受到監控，與 hello 影響 hello 叢集或應用程式的功能。</span><span class="sxs-lookup"><span data-stu-id="d5f59-121">Define hello condition they are interested in, hello way it is monitored, and hello impact on hello cluster or application functionality.</span></span> <span data-ttu-id="d5f59-122">根據這項資訊，決定 hello 健全狀況報表的屬性和健全狀況狀態。</span><span class="sxs-lookup"><span data-stu-id="d5f59-122">Based on this information, decide on hello health report property and health state.</span></span>
* <span data-ttu-id="d5f59-123">判斷 hello[實體](service-fabric-health-introduction.md#health-entities-and-hierarchy)hello 報表套用至。</span><span class="sxs-lookup"><span data-stu-id="d5f59-123">Determine hello [entity](service-fabric-health-introduction.md#health-entities-and-hierarchy) that hello report applies to.</span></span>
* <span data-ttu-id="d5f59-124">從 hello 服務，或從內部或外部的監視，請決定其中完成 hello 報告。</span><span class="sxs-lookup"><span data-stu-id="d5f59-124">Determine where hello reporting is done, from within hello service or from an internal or external watchdog.</span></span>
* <span data-ttu-id="d5f59-125">定義使用來源 tooidentify hello 報告。</span><span class="sxs-lookup"><span data-stu-id="d5f59-125">Define a source used tooidentify hello reporter.</span></span>
* <span data-ttu-id="d5f59-126">選擇報告策略是定期或是轉換時。</span><span class="sxs-lookup"><span data-stu-id="d5f59-126">Choose a reporting strategy, either periodically or on transitions.</span></span> <span data-ttu-id="d5f59-127">hello 建議方式是定期，因為它需要更簡單的程式碼，而是較不容易出錯的 tooerrors。</span><span class="sxs-lookup"><span data-stu-id="d5f59-127">hello recommended way is periodically, as it requires simpler code and is less prone tooerrors.</span></span>
* <span data-ttu-id="d5f59-128">決定多久 hello 報表，針對狀況不良的條件應該保持 hello health store 中以及應該清除。</span><span class="sxs-lookup"><span data-stu-id="d5f59-128">Determine how long hello report for unhealthy conditions should stay in hello health store and how it should be cleared.</span></span> <span data-ttu-id="d5f59-129">使用這項資訊，決定 hello 報表階段 toolive 並移除上到期行為。</span><span class="sxs-lookup"><span data-stu-id="d5f59-129">Using this information, decide hello report's time toolive and remove-on-expiration behavior.</span></span>

<span data-ttu-id="d5f59-130">如前所述，報告可以從以下項目完成：</span><span class="sxs-lookup"><span data-stu-id="d5f59-130">As mentioned, reporting can be done from:</span></span>

* <span data-ttu-id="d5f59-131">hello 監視 Service Fabric 服務複本。</span><span class="sxs-lookup"><span data-stu-id="d5f59-131">hello monitored Service Fabric service replica.</span></span>
* <span data-ttu-id="d5f59-132">內部監視程式會部署為 Service Fabric 服務 (例如，可監視條件和問題報告的 Service Fabric 無狀態服務)。</span><span class="sxs-lookup"><span data-stu-id="d5f59-132">Internal watchdogs deployed as a Service Fabric service (for example, a Service Fabric stateless service that monitors conditions and issues reports).</span></span> <span data-ttu-id="d5f59-133">可以是 hello watchdogs 部署所有的節點，或可以是相關的 toohello 監視的服務。</span><span class="sxs-lookup"><span data-stu-id="d5f59-133">hello watchdogs can be deployed an all nodes or can be affinitized toohello monitored service.</span></span>
* <span data-ttu-id="d5f59-134">內部 watchdogs hello Service Fabric 節點上執行但*不*實作為 Service Fabric 服務。</span><span class="sxs-lookup"><span data-stu-id="d5f59-134">Internal watchdogs that run on hello Service Fabric nodes but are *not* implemented as Service Fabric services.</span></span>
* <span data-ttu-id="d5f59-135">外部 watchdogs 從該探查 hello 資源*外*hello Service Fabric 叢集 （例如，像是 Gomez 監視服務）。</span><span class="sxs-lookup"><span data-stu-id="d5f59-135">External watchdogs that probe hello resource from *outside* hello Service Fabric cluster (for example, monitoring service like Gomez).</span></span>

> [!NOTE]
> <span data-ttu-id="d5f59-136">Hello 現成 hello 叢集會填入傳送嗨系統元件的健康情況報告。</span><span class="sxs-lookup"><span data-stu-id="d5f59-136">Out of hello box, hello cluster is populated with health reports sent by hello system components.</span></span> <span data-ttu-id="d5f59-137">在此閱讀更多 [使用系統健康狀態報告進行疑難排解](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="d5f59-137">Read more at [Using system health reports for troubleshooting](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span></span> <span data-ttu-id="d5f59-138">hello 使用者必須將報表傳送[健康實體](service-fabric-health-introduction.md#health-entities-and-hierarchy)，已經建立 hello 系統。</span><span class="sxs-lookup"><span data-stu-id="d5f59-138">hello user reports must be sent on [health entities](service-fabric-health-introduction.md#health-entities-and-hierarchy) that have already been created by hello system.</span></span>
> 
> 

<span data-ttu-id="d5f59-139">一次 hello 健全狀況報表的設計已取消選取，可以輕鬆地傳送健康情況報告。</span><span class="sxs-lookup"><span data-stu-id="d5f59-139">Once hello health reporting design is clear, health reports can be sent easily.</span></span> <span data-ttu-id="d5f59-140">您可以使用[FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport 健全狀況，如果不是 hello 叢集[安全](service-fabric-cluster-security.md)或 hello 網狀架構用戶端是否為系統管理員權限。</span><span class="sxs-lookup"><span data-stu-id="d5f59-140">You can use [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport health if hello cluster is not [secure](service-fabric-cluster-security.md) or if hello fabric client has admin privileges.</span></span> <span data-ttu-id="d5f59-141">報告可以透過 hello API 所使用[FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth)、 PowerShell 或 REST。</span><span class="sxs-lookup"><span data-stu-id="d5f59-141">Reporting can be done through hello API by using [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), through PowerShell, or through REST.</span></span> <span data-ttu-id="d5f59-142">組態旋鈕批次報告可提升效能。</span><span class="sxs-lookup"><span data-stu-id="d5f59-142">Configuration knobs batch reports for improved performance.</span></span>

> [!NOTE]
> <span data-ttu-id="d5f59-143">回報健全狀況是同步的並顯示只有 hello 驗證工作 hello 用戶端。</span><span class="sxs-lookup"><span data-stu-id="d5f59-143">Report health is synchronous, and it represents only hello validation work on hello client side.</span></span> <span data-ttu-id="d5f59-144">hello hello 報表的事實是 hello 健全狀況的用戶端或接受 hello`Partition`或`CodePackageActivationContext`物件並不表示套用 hello 存放區中。</span><span class="sxs-lookup"><span data-stu-id="d5f59-144">hello fact that hello report is accepted by hello health client or hello `Partition` or `CodePackageActivationContext` objects doesn't mean that it is applied in hello store.</span></span> <span data-ttu-id="d5f59-145">它會以非同步方式傳送並可能與其他報告進行批次處理。</span><span class="sxs-lookup"><span data-stu-id="d5f59-145">It is sent asynchronously and possibly batched with other reports.</span></span> <span data-ttu-id="d5f59-146">hello hello 伺服器上處理仍然可能會失敗： hello 序號可能會過期，必須套用報表在哪個 hello hello 實體已被刪除，等等。</span><span class="sxs-lookup"><span data-stu-id="d5f59-146">hello processing on hello server may still fail: hello sequence number could be stale, hello entity on which hello report must be applied has been deleted, etc.</span></span>
> 
> 

## <a name="health-client"></a><span data-ttu-id="d5f59-147">健康狀態用戶端</span><span class="sxs-lookup"><span data-stu-id="d5f59-147">Health client</span></span>
<span data-ttu-id="d5f59-148">hello 健全狀況報表會傳送 toohello 透過內部 hello 網狀架構用戶端的健全狀況用戶端的健全狀況存放區。</span><span class="sxs-lookup"><span data-stu-id="d5f59-148">hello health reports are sent toohello health store through a health client, which lives inside hello fabric client.</span></span> <span data-ttu-id="d5f59-149">hello 健全狀況的用戶端可以設定以 hello 下列設定：</span><span class="sxs-lookup"><span data-stu-id="d5f59-149">hello health client can be configured with hello following settings:</span></span>

* <span data-ttu-id="d5f59-150">**HealthReportSendInterval**: hello hello hello 報表之間的延遲是加入的 toohello 用戶端與 hello 時間傳送 toohello 健全狀況存放區。</span><span class="sxs-lookup"><span data-stu-id="d5f59-150">**HealthReportSendInterval**: hello delay between hello time hello report is added toohello client and hello time it is sent toohello health store.</span></span> <span data-ttu-id="d5f59-151">使用的 toobatch 到單一訊息，而不是傳送一個訊息，每個報表的報表。</span><span class="sxs-lookup"><span data-stu-id="d5f59-151">Used toobatch reports into a single message, rather than sending one message for each report.</span></span> <span data-ttu-id="d5f59-152">hello 批次處理可改善效能。</span><span class="sxs-lookup"><span data-stu-id="d5f59-152">hello batching improves performance.</span></span> <span data-ttu-id="d5f59-153">預設值：30 秒。</span><span class="sxs-lookup"><span data-stu-id="d5f59-153">Default: 30 seconds.</span></span>
* <span data-ttu-id="d5f59-154">**HealthReportRetrySendInterval**: hello 間隔在哪一個 hello 健全狀況的用戶端重新傳送累積健全狀況報告 toohello 健全狀況存放區。</span><span class="sxs-lookup"><span data-stu-id="d5f59-154">**HealthReportRetrySendInterval**: hello interval at which hello health client resends accumulated health reports toohello health store.</span></span> <span data-ttu-id="d5f59-155">預設值：30 秒。</span><span class="sxs-lookup"><span data-stu-id="d5f59-155">Default: 30 seconds.</span></span>
* <span data-ttu-id="d5f59-156">**HealthOperationTimeout**: hello 逾時期限報告訊息傳送 toohello 健全狀況存放區。</span><span class="sxs-lookup"><span data-stu-id="d5f59-156">**HealthOperationTimeout**: hello timeout period for a report message sent toohello health store.</span></span> <span data-ttu-id="d5f59-157">如果訊息逾時，hello 健全狀況的用戶端重試它之前 hello 健全狀況存放區確認已處理 hello 報表。</span><span class="sxs-lookup"><span data-stu-id="d5f59-157">If a message times out, hello health client retries it until hello health store confirms that hello report has been processed.</span></span> <span data-ttu-id="d5f59-158">預設值：兩分鐘。</span><span class="sxs-lookup"><span data-stu-id="d5f59-158">Default: two minutes.</span></span>

> [!NOTE]
> <span data-ttu-id="d5f59-159">當 hello 報表會批次處理時，必須保持 hello 網狀架構用戶端運作的至少 hello HealthReportSendInterval tooensure，才會傳送它們。</span><span class="sxs-lookup"><span data-stu-id="d5f59-159">When hello reports are batched, hello fabric client must be kept alive for at least hello HealthReportSendInterval tooensure that they are sent.</span></span> <span data-ttu-id="d5f59-160">Hello 網狀架構用戶端 hello 訊息就會遺失或 hello 健全狀況存放區無法將其套用 tootransient 錯誤原因，如果必須保持運作的長 toogive 它機會 tooretry。</span><span class="sxs-lookup"><span data-stu-id="d5f59-160">If hello message is lost or hello health store cannot apply them due tootransient errors, hello fabric client must be kept alive longer toogive it a chance tooretry.</span></span>
> 
> 

<span data-ttu-id="d5f59-161">hello 緩衝 hello 用戶端上會列入考量的 hello 唯一性的 hello 報表。</span><span class="sxs-lookup"><span data-stu-id="d5f59-161">hello buffering on hello client takes hello uniqueness of hello reports into consideration.</span></span> <span data-ttu-id="d5f59-162">例如，如果特定的錯誤報告 reporting 100 會報告每秒 hello 上相同的 hello 屬性相同的實體，報表會取代 hello 最後一個版本的 hello。</span><span class="sxs-lookup"><span data-stu-id="d5f59-162">For example, if a particular bad reporter is reporting 100 reports per second on hello same property of hello same entity, hello reports are replaced with hello last version.</span></span> <span data-ttu-id="d5f59-163">最多一個這類報表存在 hello 用戶端佇列中。</span><span class="sxs-lookup"><span data-stu-id="d5f59-163">At most one such report exists in hello client queue.</span></span> <span data-ttu-id="d5f59-164">如果批次處理設定，報表的 hello 數目傳送 toohello 健全狀況存放區只是每個傳送間隔。</span><span class="sxs-lookup"><span data-stu-id="d5f59-164">If batching is configured, hello number of reports sent toohello health store is just one per send interval.</span></span> <span data-ttu-id="d5f59-165">此報表為 hello 最新加入的報表，反映 hello hello 實體最新狀態。</span><span class="sxs-lookup"><span data-stu-id="d5f59-165">This report is hello last added report, which reflects hello most current state of hello entity.</span></span>
<span data-ttu-id="d5f59-166">指定組態參數時`FabricClient`由傳遞[FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) hello 與預期的健全狀況的相關項目值。</span><span class="sxs-lookup"><span data-stu-id="d5f59-166">Specify configuration parameters when `FabricClient` is created by passing [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) with hello desired values for health-related entries.</span></span>

<span data-ttu-id="d5f59-167">hello 下列範例會建立網狀架構用戶端並指定 hello 報表應該在加入時加以傳送。</span><span class="sxs-lookup"><span data-stu-id="d5f59-167">hello following example creates a fabric client and specifies that hello reports should be sent when they are added.</span></span> <span data-ttu-id="d5f59-168">在可重試的錯誤或逾時發生時，會每 40 秒重試一次。</span><span class="sxs-lookup"><span data-stu-id="d5f59-168">On timeouts and errors that can be retried, retries happen every 40 seconds.</span></span>

```csharp
var clientSettings = new FabricClientSettings()
{
    HealthOperationTimeout = TimeSpan.FromSeconds(120),
    HealthReportSendInterval = TimeSpan.FromSeconds(0),
    HealthReportRetrySendInterval = TimeSpan.FromSeconds(40),
};
var fabricClient = new FabricClient(clientSettings);
```

<span data-ttu-id="d5f59-169">我們建議您保持 hello 預設網狀架構用戶端設定，設定`HealthReportSendInterval`too30 秒。</span><span class="sxs-lookup"><span data-stu-id="d5f59-169">We recommend keeping hello default fabric client settings, which set `HealthReportSendInterval` too30 seconds.</span></span> <span data-ttu-id="d5f59-170">此設定可確保獲得最佳效能到期 toobatching。</span><span class="sxs-lookup"><span data-stu-id="d5f59-170">This setting ensures optimal performance due toobatching.</span></span> <span data-ttu-id="d5f59-171">對於必須儘速傳送的重要報告，在 [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API 中使用 `HealthReportSendOptions` 且 Immediate 為 `true`。</span><span class="sxs-lookup"><span data-stu-id="d5f59-171">For critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true` in [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span></span> <span data-ttu-id="d5f59-172">立即報表略過 hello 批次處理間隔。</span><span class="sxs-lookup"><span data-stu-id="d5f59-172">Immediate reports bypass hello batching interval.</span></span> <span data-ttu-id="d5f59-173">請小心; 使用這個旗標我們想要 tootake hello 健全狀況的用戶端批次處理盡可能利用。</span><span class="sxs-lookup"><span data-stu-id="d5f59-173">Use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span> <span data-ttu-id="d5f59-174">立即傳送時也很有用 hello 網狀架構用戶端正在關閉 （例如，可判定狀態無效和需要向 tooprevent 副作用 tooshut hello 程序）。</span><span class="sxs-lookup"><span data-stu-id="d5f59-174">Immediate send is also useful when hello fabric client is closing (for example, hello process has determined invalid state and needs tooshut down tooprevent side effects).</span></span> <span data-ttu-id="d5f59-175">它會確保 hello 累積報告的最佳方式傳送。</span><span class="sxs-lookup"><span data-stu-id="d5f59-175">It ensures a best-effort send of hello accumulated reports.</span></span> <span data-ttu-id="d5f59-176">一份報表加入時立即旗標，則 hello 健全狀況的用戶端批次處理自最後一個傳送 hello 累積的所有報表。</span><span class="sxs-lookup"><span data-stu-id="d5f59-176">When one report is added with Immediate flag, hello health client batches all hello accumulated reports since last send.</span></span>

<span data-ttu-id="d5f59-177">透過 PowerShell 建立連線 tooa 叢集時，可以指定相同的參數。</span><span class="sxs-lookup"><span data-stu-id="d5f59-177">Same parameters can be specified when a connection tooa cluster is created through PowerShell.</span></span> <span data-ttu-id="d5f59-178">下列範例中的 hello 啟動連線 tooa 本機叢集：</span><span class="sxs-lookup"><span data-stu-id="d5f59-178">hello following example starts a connection tooa local cluster:</span></span>

```powershell
PS C:\> Connect-ServiceFabricCluster -HealthOperationTimeoutInSec 120 -HealthReportSendIntervalInSec 0 -HealthReportRetrySendIntervalInSec 40
True

ConnectionEndpoint   :
FabricClientSettings : {
                       ClientFriendlyName                   : PowerShell-1944858a-4c6d-465f-89c7-9021c12ac0bb
                       PartitionLocationCacheLimit          : 100000
                       PartitionLocationCacheBucketCount    : 1024
                       ServiceChangePollInterval            : 00:02:00
                       ConnectionInitializationTimeout      : 00:00:02
                       KeepAliveInterval                    : 00:00:20
                       HealthOperationTimeout               : 00:02:00
                       HealthReportSendInterval             : 00:00:00
                       HealthReportRetrySendInterval        : 00:00:40
                       NotificationGatewayConnectionTimeout : 00:00:00
                       NotificationCacheUpdateTimeout       : 00:00:00
                       }
GatewayInformation   : {
                       NodeAddress                          : localhost:19000
                       NodeId                               : 1880ec88a3187766a6da323399721f53
                       NodeInstanceId                       : 130729063464981219
                       NodeName                             : Node.1
                       }
```

<span data-ttu-id="d5f59-179">同樣地 tooAPI，可以將報表傳送使用`-Immediate`切換 toobe 不論 hello 立即傳送`HealthReportSendInterval`值。</span><span class="sxs-lookup"><span data-stu-id="d5f59-179">Similarly tooAPI, reports can be sent using `-Immediate` switch toobe sent immediately, regardless of hello `HealthReportSendInterval` value.</span></span>

<span data-ttu-id="d5f59-180">為 rest，hello 報表會傳送 toohello Service Fabric 閘道有內部的網狀架構用戶端。</span><span class="sxs-lookup"><span data-stu-id="d5f59-180">For REST, hello reports are sent toohello Service Fabric gateway, which has an internal fabric client.</span></span> <span data-ttu-id="d5f59-181">依預設，此用戶端為設定的 toosend 批次處理每隔 30 秒。</span><span class="sxs-lookup"><span data-stu-id="d5f59-181">By default, this client is configured toosend reports batched every 30 seconds.</span></span> <span data-ttu-id="d5f59-182">您可以使用 hello 叢集組態設定變更 hello 批次間隔`HttpGatewayHealthReportSendInterval`上`HttpGateway`。</span><span class="sxs-lookup"><span data-stu-id="d5f59-182">You can change hello batch interval with hello cluster configuration setting `HttpGatewayHealthReportSendInterval` on `HttpGateway`.</span></span> <span data-ttu-id="d5f59-183">如所述，更好的選項是使用 toosend hello 報表`Immediate`，則為 true。</span><span class="sxs-lookup"><span data-stu-id="d5f59-183">As mentioned, a better option is toosend hello reports with `Immediate` true.</span></span> 

> [!NOTE]
> <span data-ttu-id="d5f59-184">未授權的服務 tooensure 無法報告健全狀況 hello hello 叢集中的實體，針對設定只能從受保護的用戶端 hello 伺服器 tooaccept 要求。</span><span class="sxs-lookup"><span data-stu-id="d5f59-184">tooensure that unauthorized services can't report health against hello entities in hello cluster, configure hello server tooaccept requests only from secured clients.</span></span> <span data-ttu-id="d5f59-185">hello`FabricClient`用於報表必須已啟用安全性 toobe 無法 toocommunicate 與 hello 叢集 （例如，使用 Kerberos 或憑證驗證）。</span><span class="sxs-lookup"><span data-stu-id="d5f59-185">hello `FabricClient` used for reporting must have security enabled toobe able toocommunicate with hello cluster (for example, with Kerberos or certificate authentication).</span></span> <span data-ttu-id="d5f59-186">深入了解 [叢集安全性](service-fabric-cluster-security.md)。</span><span class="sxs-lookup"><span data-stu-id="d5f59-186">Read more about [cluster security](service-fabric-cluster-security.md).</span></span>
> 
> 

## <a name="report-from-within-low-privilege-services"></a><span data-ttu-id="d5f59-187">在低權限的服務內進行報告</span><span class="sxs-lookup"><span data-stu-id="d5f59-187">Report from within low privilege services</span></span>
<span data-ttu-id="d5f59-188">如果 Service Fabric 服務沒有系統管理員存取 toohello 叢集，您可以在 hello 透過目前的內容來自實體上報告健全狀況`Partition`或`CodePackageActivationContext`。</span><span class="sxs-lookup"><span data-stu-id="d5f59-188">If Service Fabric services do not have admin access toohello cluster, you can report health on entities from hello current context through `Partition` or `CodePackageActivationContext`.</span></span>

* <span data-ttu-id="d5f59-189">針對無狀態服務，使用[IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport hello 目前服務執行個體上的。</span><span class="sxs-lookup"><span data-stu-id="d5f59-189">For stateless services, use [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport on hello current service instance.</span></span>
* <span data-ttu-id="d5f59-190">可設定狀態服務，使用[IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport 上目前的複本。</span><span class="sxs-lookup"><span data-stu-id="d5f59-190">For stateful services, use [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport on current replica.</span></span>
* <span data-ttu-id="d5f59-191">使用[IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport hello 目前磁碟分割實體上的。</span><span class="sxs-lookup"><span data-stu-id="d5f59-191">Use [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport on hello current partition entity.</span></span>
* <span data-ttu-id="d5f59-192">使用[CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport 上目前的應用程式。</span><span class="sxs-lookup"><span data-stu-id="d5f59-192">Use [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport on current application.</span></span>
* <span data-ttu-id="d5f59-193">使用[CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport hello 目前節點上部署的 hello 目前應用程式上。</span><span class="sxs-lookup"><span data-stu-id="d5f59-193">Use [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport on hello current application deployed on hello current node.</span></span>
* <span data-ttu-id="d5f59-194">使用[CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport hello 目前節點上部署的 hello 應用程式的服務封裝上。</span><span class="sxs-lookup"><span data-stu-id="d5f59-194">Use [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport on a service package for hello application deployed on hello current node.</span></span>

> [!NOTE]
> <span data-ttu-id="d5f59-195">就內部而言，hello`Partition`和 hello`CodePackageActivationContext`保存設定預設設定的健全狀況用戶端。</span><span class="sxs-lookup"><span data-stu-id="d5f59-195">Internally, hello `Partition` and hello `CodePackageActivationContext` hold a health client configured with default settings.</span></span> <span data-ttu-id="d5f59-196">所述的 hello[健全狀況的用戶端](service-fabric-report-health.md#health-client)，報表會批次處理並傳送的計時器。</span><span class="sxs-lookup"><span data-stu-id="d5f59-196">As explained for hello [health client](service-fabric-report-health.md#health-client), reports are batched and sent on a timer.</span></span> <span data-ttu-id="d5f59-197">hello 物件應該保持運作 toohave 機會 toosend hello 報表。</span><span class="sxs-lookup"><span data-stu-id="d5f59-197">hello objects should be kept alive toohave a chance toosend hello report.</span></span>
> 
> 

<span data-ttu-id="d5f59-198">您可以在透過 `Partition` 和 `CodePackageActivationContext` 健康情況 API 傳送報告時指定 `HealthReportSendOptions`。</span><span class="sxs-lookup"><span data-stu-id="d5f59-198">You can specify `HealthReportSendOptions` when sending reports through `Partition` and `CodePackageActivationContext` health APIs.</span></span> <span data-ttu-id="d5f59-199">如果您有必須儘速傳送的重要報表，請使用`HealthReportSendOptions` 且 Immediate 為 `true`。</span><span class="sxs-lookup"><span data-stu-id="d5f59-199">If you have critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true`.</span></span> <span data-ttu-id="d5f59-200">立即報表略過 hello 批次處理間隔可用 hello 內部的健全狀況的用戶端。</span><span class="sxs-lookup"><span data-stu-id="d5f59-200">Immediate reports bypass hello batching interval of hello internal health client.</span></span> <span data-ttu-id="d5f59-201">如前所述，請小心; 使用這個旗標我們想要 tootake hello 健全狀況的用戶端批次處理盡可能利用。</span><span class="sxs-lookup"><span data-stu-id="d5f59-201">As mentioned before, use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span>

## <a name="design-health-reporting"></a><span data-ttu-id="d5f59-202">設計健康狀態報告</span><span class="sxs-lookup"><span data-stu-id="d5f59-202">Design health reporting</span></span>
<span data-ttu-id="d5f59-203">hello 產生高品質的報表中的第一個步驟識別可能會影響 hello hello 服務健全狀況的 hello 條件。</span><span class="sxs-lookup"><span data-stu-id="d5f59-203">hello first step in generating high-quality reports is identifying hello conditions that can impact hello health of hello service.</span></span> <span data-ttu-id="d5f59-204">任何條件，可協助 hello 服務或叢集中的旗標問題，當它啟動-，或甚至更好且問題發生之前-可能會儲存數十億個 （美元）。</span><span class="sxs-lookup"><span data-stu-id="d5f59-204">Any condition that can help flag problems in hello service or cluster when it starts--or even better, before a problem happens--can potentially save billions of dollars.</span></span> <span data-ttu-id="d5f59-205">hello 優點包括小於停機時間，較少的系統會在晚上小時所花費的調查，並修復問題，以及更高的客戶滿意度。</span><span class="sxs-lookup"><span data-stu-id="d5f59-205">hello benefits include less down time, fewer night hours spent investigating and repairing issues, and higher customer satisfaction.</span></span>

<span data-ttu-id="d5f59-206">一旦識別出 hello 條件，監視寫入器需要出 hello 的負擔與可用性之間取得平衡最佳方式 toomonitor toofigure。</span><span class="sxs-lookup"><span data-stu-id="d5f59-206">Once hello conditions are identified, watchdog writers need toofigure out hello best way toomonitor them for balance between overhead and usefulness.</span></span> <span data-ttu-id="d5f59-207">例如，考慮可使用共用上的一些暫存檔案進行複雜計算的服務。</span><span class="sxs-lookup"><span data-stu-id="d5f59-207">For example, consider a service that does complex calculations that use some temporary files on a share.</span></span> <span data-ttu-id="d5f59-208">監視無法監視 hello 共用 tooensure 有足夠空間。</span><span class="sxs-lookup"><span data-stu-id="d5f59-208">A watchdog could monitor hello share tooensure that enough space is available.</span></span> <span data-ttu-id="d5f59-209">它可以接聽檔案或目錄變更的通知。</span><span class="sxs-lookup"><span data-stu-id="d5f59-209">It could listen for notifications of file or directory changes.</span></span> <span data-ttu-id="d5f59-210">如果前方的臨界值會達到，而且如果 hello 共用已滿時報告錯誤，也無法報告警告。</span><span class="sxs-lookup"><span data-stu-id="d5f59-210">It could report a warning if an upfront threshold is reached, and report an error if hello share is full.</span></span> <span data-ttu-id="d5f59-211">上一則警告，修復系統可以開始清除較舊 hello 共用上的檔案。</span><span class="sxs-lookup"><span data-stu-id="d5f59-211">On a warning, a repair system could start cleaning up older files on hello share.</span></span> <span data-ttu-id="d5f59-212">發生錯誤時，修復系統無法移動 hello 服務複本 tooanother 節點。</span><span class="sxs-lookup"><span data-stu-id="d5f59-212">On an error, a repair system could move hello service replica tooanother node.</span></span> <span data-ttu-id="d5f59-213">請注意如何 hello 條件的狀態詳述健全狀況方面： hello hello 可視為狀況良好 （確定） 的條件或狀況不良 （警告或錯誤） 的狀態。</span><span class="sxs-lookup"><span data-stu-id="d5f59-213">Note how hello condition states are described in terms of health: hello state of hello condition that can be considered healthy (ok) or unhealthy (warning or error).</span></span>

<span data-ttu-id="d5f59-214">一旦設定 hello 監視詳細資料之後，監視寫入器需要 toofigure 出 tooimplement hello 監視的方式。</span><span class="sxs-lookup"><span data-stu-id="d5f59-214">Once hello monitoring details are set, a watchdog writer needs toofigure out how tooimplement hello watchdog.</span></span> <span data-ttu-id="d5f59-215">如果 hello 條件可由 hello 服務內，hello 監視可以是本身 hello 監視服務的一部分。</span><span class="sxs-lookup"><span data-stu-id="d5f59-215">If hello conditions can be determined from within hello service, hello watchdog can be part of hello monitored service itself.</span></span> <span data-ttu-id="d5f59-216">例如，hello 服務程式碼可以檢查 hello 共用使用量，並每次嘗試 toowrite 檔案，然後報告。</span><span class="sxs-lookup"><span data-stu-id="d5f59-216">For example, hello service code can check hello share usage, and then report every time it tries toowrite a file.</span></span> <span data-ttu-id="d5f59-217">hello 這種方法的優點是 reporting 很簡單。</span><span class="sxs-lookup"><span data-stu-id="d5f59-217">hello advantage of this approach is that reporting is simple.</span></span> <span data-ttu-id="d5f59-218">必須小心 tooprevent 監視 bug hello 服務功能造成影響。</span><span class="sxs-lookup"><span data-stu-id="d5f59-218">Care must be taken tooprevent watchdog bugs from impacting hello service functionality.</span></span>

<span data-ttu-id="d5f59-219">Hello 監視服務中的報告不一定選項。</span><span class="sxs-lookup"><span data-stu-id="d5f59-219">Reporting from within hello monitored service is not always an option.</span></span> <span data-ttu-id="d5f59-220">Hello 服務中的監視可能不是能 toodetect hello 條件。</span><span class="sxs-lookup"><span data-stu-id="d5f59-220">A watchdog within hello service may not be able toodetect hello conditions.</span></span> <span data-ttu-id="d5f59-221">它沒有 hello 邏輯或資料項目 toomake hello 判斷。</span><span class="sxs-lookup"><span data-stu-id="d5f59-221">It may not have hello logic or data toomake hello determination.</span></span> <span data-ttu-id="d5f59-222">hello 的監視 hello 條件的額外負荷很高。</span><span class="sxs-lookup"><span data-stu-id="d5f59-222">hello overhead of monitoring hello conditions may be high.</span></span> <span data-ttu-id="d5f59-223">hello 條件也可能不是特定 tooa 服務，但而影響服務之間的互動。</span><span class="sxs-lookup"><span data-stu-id="d5f59-223">hello conditions also may not be specific tooa service, but instead affect interactions between services.</span></span> <span data-ttu-id="d5f59-224">另一個選項是 toohave watchdogs hello 叢集中做為個別的處理序。</span><span class="sxs-lookup"><span data-stu-id="d5f59-224">Another option is toohave watchdogs in hello cluster as separate processes.</span></span> <span data-ttu-id="d5f59-225">hello watchdogs 監視 hello 條件和報表，而不會影響 hello 主要服務，以任何方式。</span><span class="sxs-lookup"><span data-stu-id="d5f59-225">hello watchdogs monitor hello conditions and report, without affecting hello main services in any way.</span></span> <span data-ttu-id="d5f59-226">例如，無法實作這些 watchdogs hello 無狀態服務的身分部署 hello 或所有節點上的相同應用程式為 hello 服務的相同節點。</span><span class="sxs-lookup"><span data-stu-id="d5f59-226">For example, these watchdogs could be implemented as stateless services in hello same application, deployed on all nodes or on hello same nodes as hello service.</span></span>

<span data-ttu-id="d5f59-227">有時候，hello 叢集中執行的監視也不選項可以。</span><span class="sxs-lookup"><span data-stu-id="d5f59-227">Sometimes, a watchdog running in hello cluster is not an option either.</span></span> <span data-ttu-id="d5f59-228">如果受監視的 hello 條件 hello 可用性或 hello 服務的功能為使用者看到的樣子，，是最佳 toohave hello watchdogs hello 相同放置為 hello 使用者用戶端中。</span><span class="sxs-lookup"><span data-stu-id="d5f59-228">If hello monitored condition is hello availability or functionality of hello service as users see it, it's best toohave hello watchdogs in hello same place as hello user clients.</span></span> <span data-ttu-id="d5f59-229">那里，它們可以在此測試 hello 作業 hello 中相同的方式使用者呼叫它們。</span><span class="sxs-lookup"><span data-stu-id="d5f59-229">There, they can test hello operations in hello same way users call them.</span></span> <span data-ttu-id="d5f59-230">例如，您可以監視居住 hello 叢集外，toohello 服務發出要求，並檢查 hello 延遲和 hello 結果的正確性。</span><span class="sxs-lookup"><span data-stu-id="d5f59-230">For example, you can have a watchdog that lives outside hello cluster, issues requests toohello service, and checks hello latency and correctness of hello result.</span></span> <span data-ttu-id="d5f59-231">(例如在計算機服務中，2+2 是否會在合理的時間內傳回 4？)</span><span class="sxs-lookup"><span data-stu-id="d5f59-231">(For a calculator service, for example, does 2+2 return 4 in a reasonable amount of time?)</span></span>

<span data-ttu-id="d5f59-232">一旦最終處理 hello 監視詳細資料，您應該決定來源識別碼可唯一識別它。</span><span class="sxs-lookup"><span data-stu-id="d5f59-232">Once hello watchdog details have been finalized, you should decide on a source ID that uniquely identifies it.</span></span> <span data-ttu-id="d5f59-233">如果多個相同的型別會住在 hello 的 watchdogs hello 叢集，它們必須不同的實體上的報表或者，如果它們報告 hello 相同的實體、 使用不同的來源識別碼或屬性。</span><span class="sxs-lookup"><span data-stu-id="d5f59-233">If multiple watchdogs of hello same type are living in hello cluster, they must report on different entities, or, if they report on hello same entity, use different source ID or property.</span></span> <span data-ttu-id="d5f59-234">如此一來，其報告才可並存。</span><span class="sxs-lookup"><span data-stu-id="d5f59-234">This way, their reports can coexist.</span></span> <span data-ttu-id="d5f59-235">hello hello 健康情況報告 屬性應擷取 hello 監視條件。</span><span class="sxs-lookup"><span data-stu-id="d5f59-235">hello property of hello health report should capture hello monitored condition.</span></span> <span data-ttu-id="d5f59-236">(如 hello 上述範例中，可能是 hello 屬性**ShareSize**。)如果多個報表套用 toohello 相同條件，hello 屬性應該包含一些可讓報表 toocoexist 的動態資訊。</span><span class="sxs-lookup"><span data-stu-id="d5f59-236">(For hello example above, hello property could be **ShareSize**.) If multiple reports apply toohello same condition, hello property should contain some dynamic information that allows reports toocoexist.</span></span> <span data-ttu-id="d5f59-237">例如，如果多個共用需要監視 toobe，hello 屬性名稱可以是**ShareSize sharename**。</span><span class="sxs-lookup"><span data-stu-id="d5f59-237">For example, if multiple shares need toobe monitored, hello property name can be **ShareSize-sharename**.</span></span>

> [!NOTE]
> <span data-ttu-id="d5f59-238">請勿*不*使用 hello 健康情況存放區 tookeep 狀態資訊。</span><span class="sxs-lookup"><span data-stu-id="d5f59-238">Do *not* use hello health store tookeep status information.</span></span> <span data-ttu-id="d5f59-239">只能與健全狀況相關的資訊應該報告為健康情況，為此資訊會影響 hello 健全狀況評估的實體。</span><span class="sxs-lookup"><span data-stu-id="d5f59-239">Only health-related information should be reported as health, as this information impacts hello health evaluation of an entity.</span></span> <span data-ttu-id="d5f59-240">hello 健全狀況存放區的設計無法做為一般用途存放區。</span><span class="sxs-lookup"><span data-stu-id="d5f59-240">hello health store was not designed as a general-purpose store.</span></span> <span data-ttu-id="d5f59-241">它會使用健全狀況評估邏輯 tooaggregate 所有資料到 hello 健全狀況狀態。</span><span class="sxs-lookup"><span data-stu-id="d5f59-241">It uses health evaluation logic tooaggregate all data into hello health state.</span></span> <span data-ttu-id="d5f59-242">傳送的資訊 （如 reporting 健全狀況狀態為 [確定] 狀態) 的不相關的 toohealth 不會影響 hello 彙總健全狀況狀態，但它效能造成負面影響 hello hello 健全狀況存放區。</span><span class="sxs-lookup"><span data-stu-id="d5f59-242">Sending information unrelated toohealth (like reporting status with a health state of OK) doesn't impact hello aggregated health state, but it can negatively affect hello performance of hello health store.</span></span>
> 
> 

<span data-ttu-id="d5f59-243">hello 下一個決策點所在的實體 tooreport。</span><span class="sxs-lookup"><span data-stu-id="d5f59-243">hello next decision point is which entity tooreport on.</span></span> <span data-ttu-id="d5f59-244">大部分的 hello 時間，hello 條件 idetifies 清楚 hello 實體。</span><span class="sxs-lookup"><span data-stu-id="d5f59-244">Most of hello time, hello condition clearly idetifies hello entity.</span></span> <span data-ttu-id="d5f59-245">選擇最佳的可能資料粒度的 hello 實體。</span><span class="sxs-lookup"><span data-stu-id="d5f59-245">Choose hello entity with best possible granularity.</span></span> <span data-ttu-id="d5f59-246">如果條件，將會影響資料分割中的所有複本，報告 hello 的磁碟分割，不是在 hello 服務。</span><span class="sxs-lookup"><span data-stu-id="d5f59-246">If a condition impacts all replicas in a partition, report on hello partition, not on hello service.</span></span> <span data-ttu-id="d5f59-247">以下為需要仔細考量的極端例子。</span><span class="sxs-lookup"><span data-stu-id="d5f59-247">There are corner cases where more thought is needed, though.</span></span> <span data-ttu-id="d5f59-248">如果 hello 條件影響實體，例如複本，但 hello desire 是 toohave hello 條件標示為多個複本生命 hello 持續時間應 hello 磁碟分割上。</span><span class="sxs-lookup"><span data-stu-id="d5f59-248">If hello condition impacts an entity, such as a replica, but hello desire is toohave hello condition flagged for more than hello duration of replica life, then it should be reported on hello partition.</span></span> <span data-ttu-id="d5f59-249">否則，請刪除 hello 複本時，hello 健全狀況存放區就會清除所有其報表。</span><span class="sxs-lookup"><span data-stu-id="d5f59-249">Otherwise, when hello replica is deleted, hello health store cleans up all its reports.</span></span> <span data-ttu-id="d5f59-250">監視程式撰寫者必須思考 hello 存留期 hello 實體與 hello 報表。</span><span class="sxs-lookup"><span data-stu-id="d5f59-250">Watchdog writers must think about hello lifetimes of hello entity and hello report.</span></span> <span data-ttu-id="d5f59-251">報告需從存放區中清除的時間點必須清楚說明 (例如，當實體上回報的錯誤不再適用時)。</span><span class="sxs-lookup"><span data-stu-id="d5f59-251">It must be clear when a report should be cleaned up from a store (for example, when an error reported on an entity no longer applies).</span></span>

<span data-ttu-id="d5f59-252">讓我們看看將放在一起所述的 hello 點的範例。</span><span class="sxs-lookup"><span data-stu-id="d5f59-252">Let's look at an example that puts together hello points I described.</span></span> <span data-ttu-id="d5f59-253">假設有一個由主要具狀態保存服務和所有節點上部署的次要無狀態服務所組成的 Service Fabric 應用程式 (每種工作類型有一個次要服務類型)。</span><span class="sxs-lookup"><span data-stu-id="d5f59-253">Consider a Service Fabric application composed of a master stateful persistent service and secondary stateless services deployed on all nodes (one secondary service type for each type of task).</span></span> <span data-ttu-id="d5f59-254">hello 主機具有包含次要資料庫所執行的命令 toobe 處理佇列。</span><span class="sxs-lookup"><span data-stu-id="d5f59-254">hello master has a processing queue that contains commands toobe executed by secondaries.</span></span> <span data-ttu-id="d5f59-255">hello 的次要複本執行 hello 連入要求，並傳送後認可信號。</span><span class="sxs-lookup"><span data-stu-id="d5f59-255">hello secondaries execute hello incoming requests and send back acknowledgement signals.</span></span> <span data-ttu-id="d5f59-256">無法監視的一個條件是 hello hello 主要處理佇列長度。</span><span class="sxs-lookup"><span data-stu-id="d5f59-256">One condition that could be monitored is hello length of hello master processing queue.</span></span> <span data-ttu-id="d5f59-257">如果 hello 主要佇列長度達到臨界值時，會報告警告。</span><span class="sxs-lookup"><span data-stu-id="d5f59-257">If hello master queue length reaches a threshold, a warning is reported.</span></span> <span data-ttu-id="d5f59-258">hello 警告表示 hello 的次要複本無法處理 hello 負載。</span><span class="sxs-lookup"><span data-stu-id="d5f59-258">hello warning indicates that hello secondaries can't handle hello load.</span></span> <span data-ttu-id="d5f59-259">如果 hello 佇列到達 hello 最大長度，並卸除命令，則會報告錯誤，為 hello 服務將無法復原。</span><span class="sxs-lookup"><span data-stu-id="d5f59-259">If hello queue reaches hello maximum length and commands are dropped, an error is reported, as hello service can't recover.</span></span> <span data-ttu-id="d5f59-260">hello 報表可以在 hello 屬性**QueueStatus**。</span><span class="sxs-lookup"><span data-stu-id="d5f59-260">hello reports can be on hello property **QueueStatus**.</span></span> <span data-ttu-id="d5f59-261">hello 監視居住 hello 服務內，它會定期傳送嗨主控主要複本上。</span><span class="sxs-lookup"><span data-stu-id="d5f59-261">hello watchdog lives inside hello service, and it's sent periodically on hello master primary replica.</span></span> <span data-ttu-id="d5f59-262">hello 時間 toolive 兩分鐘，而且它會傳送定期每隔 30 秒。</span><span class="sxs-lookup"><span data-stu-id="d5f59-262">hello time toolive is two minutes, and it's sent periodically every 30 seconds.</span></span> <span data-ttu-id="d5f59-263">如果主要 hello 當機時，hello 報表會自動清除從存放區。</span><span class="sxs-lookup"><span data-stu-id="d5f59-263">If hello primary goes down, hello report is cleaned up automatically from store.</span></span> <span data-ttu-id="d5f59-264">如果 hello 服務複本已啟動，但它將會鎖死或發生其他問題，hello 報表到期 hello health store 中。</span><span class="sxs-lookup"><span data-stu-id="d5f59-264">If hello service replica is up, but it is deadlocked or having other issues, hello report expires in hello health store.</span></span> <span data-ttu-id="d5f59-265">在此情況下，會在錯誤發生時加以評估 hello 實體。</span><span class="sxs-lookup"><span data-stu-id="d5f59-265">In this case, hello entity is evaluated at error.</span></span>

<span data-ttu-id="d5f59-266">其他可監視的條件為工作執行時間。</span><span class="sxs-lookup"><span data-stu-id="d5f59-266">Another condition that can be monitored is task execution time.</span></span> <span data-ttu-id="d5f59-267">hello master 散發工作 toohello 次要根據 hello 工作類型。</span><span class="sxs-lookup"><span data-stu-id="d5f59-267">hello master distributes tasks toohello secondaries based on hello task type.</span></span> <span data-ttu-id="d5f59-268">根據 hello 設計 hello master 無法輪詢 hello 次要複本，以工作狀態。</span><span class="sxs-lookup"><span data-stu-id="d5f59-268">Depending on hello design, hello master could poll hello secondaries for task status.</span></span> <span data-ttu-id="d5f59-269">它也無法等候次要複本 toosend 回復通知訊號，當他們完成時。</span><span class="sxs-lookup"><span data-stu-id="d5f59-269">It could also wait for secondaries toosend back acknowledgement signals when they are done.</span></span> <span data-ttu-id="d5f59-270">在 hello 第二個情況下，必須小心 toodetect 次要無效或訊息的遺失的情況。</span><span class="sxs-lookup"><span data-stu-id="d5f59-270">In hello second case, care must be taken toodetect situations where secondaries die or messages are lost.</span></span> <span data-ttu-id="d5f59-271">其中一個選項是為 hello 主要 toosend ping 要求 toohello 相同次要，將其狀態傳送回。</span><span class="sxs-lookup"><span data-stu-id="d5f59-271">One option is for hello master toosend a ping request toohello same secondary, which sends back its status.</span></span> <span data-ttu-id="d5f59-272">如果仍不收到任何狀態，hello master 將其視為失敗，和 hello 工作會重新排定。</span><span class="sxs-lookup"><span data-stu-id="d5f59-272">If no status is received, hello master considers it a failure and reschedules hello task.</span></span> <span data-ttu-id="d5f59-273">此行為是假設 hello 工作是等冪。</span><span class="sxs-lookup"><span data-stu-id="d5f59-273">This behavior assumes that hello tasks are idempotent.</span></span>

<span data-ttu-id="d5f59-274">hello 監視條件可以轉譯為警告，如果 hello 工作不是在一段時間 (**t1**，例如 10 分鐘)。</span><span class="sxs-lookup"><span data-stu-id="d5f59-274">hello monitored condition can be translated as a warning if hello task is not done in a certain time (**t1**, for example 10 minutes).</span></span> <span data-ttu-id="d5f59-275">如果 hello 工作未完成的時間 (**t2**，例如 20 分鐘)，監視的 hello 條件可以轉譯為錯誤。</span><span class="sxs-lookup"><span data-stu-id="d5f59-275">If hello task is not completed in time (**t2**, for example 20 minutes), hello monitored condition can be translated as Error.</span></span> <span data-ttu-id="d5f59-276">此報告可以多種方式完成：</span><span class="sxs-lookup"><span data-stu-id="d5f59-276">This reporting can be done in multiple ways:</span></span>

* <span data-ttu-id="d5f59-277">定期 hello 主控主要複本會報告於本身。</span><span class="sxs-lookup"><span data-stu-id="d5f59-277">hello master primary replica reports on itself periodically.</span></span> <span data-ttu-id="d5f59-278">您可以 hello 佇列中有一個屬性的所有暫止的工作。</span><span class="sxs-lookup"><span data-stu-id="d5f59-278">You can have one property for all pending tasks in hello queue.</span></span> <span data-ttu-id="d5f59-279">如果至少一個工作所花費的時間，hello 狀態報告 hello 屬性**PendingTasks**警告或錯誤，適當地。</span><span class="sxs-lookup"><span data-stu-id="d5f59-279">If at least one task takes longer, hello report status on hello property **PendingTasks** is a warning or error, as appropriate.</span></span> <span data-ttu-id="d5f59-280">如果沒有暫止的工作或所有工作都開始執行，hello 報告狀態為 [確定]。</span><span class="sxs-lookup"><span data-stu-id="d5f59-280">If there are no pending tasks or all tasks started execution, hello report status is OK.</span></span> <span data-ttu-id="d5f59-281">hello 工作是永續性。</span><span class="sxs-lookup"><span data-stu-id="d5f59-281">hello tasks are persistent.</span></span> <span data-ttu-id="d5f59-282">如果主要 hello 關閉時，最近更新的 hello 主要可以正確繼續 tooreport。</span><span class="sxs-lookup"><span data-stu-id="d5f59-282">If hello primary goes down, hello newly promoted primary can continue tooreport properly.</span></span>
* <span data-ttu-id="d5f59-283">（在 hello 雲端或外部） 的另一個監視處理序會檢查 hello 工作 （從外部，根據預期的 hello 工作結果） toosee 如果，便會完成。</span><span class="sxs-lookup"><span data-stu-id="d5f59-283">Another watchdog process (in hello cloud or external) checks hello tasks (from outside, based on hello desired task result) toosee if they are completed.</span></span> <span data-ttu-id="d5f59-284">如果它們不會採用 hello 臨界值，報表會傳送 hello 主要服務上。</span><span class="sxs-lookup"><span data-stu-id="d5f59-284">If they do not respect hello thresholds, a report is sent on hello master service.</span></span> <span data-ttu-id="d5f59-285">報表也會傳送包含 hello 工作識別碼，例如每個工作上**PendingTask + taskId**。</span><span class="sxs-lookup"><span data-stu-id="d5f59-285">A report is also sent on each task that includes hello task identifier, like **PendingTask+taskId**.</span></span> <span data-ttu-id="d5f59-286">只有在狀況不良的狀態才需傳送報告。</span><span class="sxs-lookup"><span data-stu-id="d5f59-286">Reports should be sent only on unhealthy states.</span></span> <span data-ttu-id="d5f59-287">設定時間 toolive tooa 幾分鐘的時間，並將標示 hello 報表 toobe 移除到期 tooensure 清除。</span><span class="sxs-lookup"><span data-stu-id="d5f59-287">Set time toolive tooa few minutes, and mark hello reports toobe removed when they expire tooensure cleanup.</span></span>
* <span data-ttu-id="d5f59-288">它會將長度超過預期 toorun 它時，就會回報 hello 次要正在執行工作。</span><span class="sxs-lookup"><span data-stu-id="d5f59-288">hello secondary that is executing a task reports when it takes longer than expected toorun it.</span></span> <span data-ttu-id="d5f59-289">它會報告 hello hello 屬性上的服務執行個體上**PendingTasks**。</span><span class="sxs-lookup"><span data-stu-id="d5f59-289">It reports on hello service instance on hello property **PendingTasks**.</span></span> <span data-ttu-id="d5f59-290">hello 報告指出有問題，hello 服務執行個體，但它不擷取 hello 情況 hello 執行個體中斷的位置。</span><span class="sxs-lookup"><span data-stu-id="d5f59-290">hello report pinpoints hello service instance that has issues, but it doesn't capture hello situation where hello instance dies.</span></span> <span data-ttu-id="d5f59-291">hello 報表會再清除。</span><span class="sxs-lookup"><span data-stu-id="d5f59-291">hello reports are cleaned up then.</span></span> <span data-ttu-id="d5f59-292">它無法報告 hello 次要服務上。</span><span class="sxs-lookup"><span data-stu-id="d5f59-292">It could report on hello secondary service.</span></span> <span data-ttu-id="d5f59-293">如果次要 hello 完成 hello 工作時，hello 次要執行個體就會清除 hello hello 存放區中的報表。</span><span class="sxs-lookup"><span data-stu-id="d5f59-293">If hello secondary completes hello task, hello secondary instance clears hello report from hello store.</span></span> <span data-ttu-id="d5f59-294">hello 報表不會擷取 hello 收條訊息就會遺失，和 hello 工作未完成從 hello 為主版頁面的觀點來看的 hello 情況。</span><span class="sxs-lookup"><span data-stu-id="d5f59-294">hello report doesn't capture hello situation where hello acknowledgement message is lost and hello task is not finished from hello master's point of view.</span></span>

<span data-ttu-id="d5f59-295">Hello 報告在 hello 上面所述的情況下完成，不過 hello 報表中所擷取應用程式健全狀況評估健全狀況時。</span><span class="sxs-lookup"><span data-stu-id="d5f59-295">However hello reporting is done in hello cases described above, hello reports are captured in application health when health is evaluated.</span></span>

## <a name="report-periodically-vs-on-transition"></a><span data-ttu-id="d5f59-296">定期報告與轉換時報告</span><span class="sxs-lookup"><span data-stu-id="d5f59-296">Report periodically vs. on transition</span></span>
<span data-ttu-id="d5f59-297">藉由使用 hello 健全狀況報表模型，watchdogs 可以定期或受制於傳送報告。</span><span class="sxs-lookup"><span data-stu-id="d5f59-297">By using hello health reporting model, watchdogs can send reports periodically or on transitions.</span></span> <span data-ttu-id="d5f59-298">hello 監視報告的方式被建議定期，因為 hello 的程式碼更簡單且較不容易出錯 tooerrors。</span><span class="sxs-lookup"><span data-stu-id="d5f59-298">hello recommended way for watchdog reporting is periodically, because hello code is much simpler and less prone tooerrors.</span></span> <span data-ttu-id="d5f59-299">hello watchdogs 必須盡可能 toobe 越簡單越可能 tooavoid bug 觸發回報不正確。</span><span class="sxs-lookup"><span data-stu-id="d5f59-299">hello watchdogs must strive toobe as simple as possible tooavoid bugs that trigger incorrect reports.</span></span> <span data-ttu-id="d5f59-300">不正確的狀況不良  報告將會影響健康狀態評估以及需依據健康狀態的情況，包括升級。</span><span class="sxs-lookup"><span data-stu-id="d5f59-300">Incorrect *unhealthy* reports impact health evaluations and scenarios based on health, including upgrades.</span></span> <span data-ttu-id="d5f59-301">不正確*狀況良好*報表隱藏 hello 叢集中不想要使用的問題。</span><span class="sxs-lookup"><span data-stu-id="d5f59-301">Incorrect *healthy* reports hide issues in hello cluster, which is not desired.</span></span>

<span data-ttu-id="d5f59-302">如需定期的報表，hello 監視可實作以計時器。</span><span class="sxs-lookup"><span data-stu-id="d5f59-302">For periodic reporting, hello watchdog can be implemented with a timer.</span></span> <span data-ttu-id="d5f59-303">計時器回呼，在 hello 監視可檢查 hello 狀態，並傳送嗨目前狀態為基礎的報表。</span><span class="sxs-lookup"><span data-stu-id="d5f59-303">On a timer callback, hello watchdog can check hello state and send a report based on hello current state.</span></span> <span data-ttu-id="d5f59-304">沒有任何需要 toosee 報表先前傳送或任何方面傳訊的最佳化。</span><span class="sxs-lookup"><span data-stu-id="d5f59-304">There is no need toosee which report was sent previously or make any optimizations in terms of messaging.</span></span> <span data-ttu-id="d5f59-305">hello 健全狀況的用戶端已批次處理邏輯 toohelp 與效能。</span><span class="sxs-lookup"><span data-stu-id="d5f59-305">hello health client has batching logic toohelp with performance.</span></span> <span data-ttu-id="d5f59-306">Hello 健全狀況的用戶端就會保持運作，而在重試內部 hello 報表已認可 hello 健全狀況存放區或 hello 監視會產生較新的報告，以 hello 之前相同的實體、 屬性和來源。</span><span class="sxs-lookup"><span data-stu-id="d5f59-306">While hello health client is kept alive, it retries internally until hello report is acknowledged by hello health store or hello watchdog generates a newer report with hello same entity, property, and source.</span></span>

<span data-ttu-id="d5f59-307">轉換時的回報需要注意狀態處理。</span><span class="sxs-lookup"><span data-stu-id="d5f59-307">Reporting on transitions requires careful handling of state.</span></span> <span data-ttu-id="d5f59-308">hello 監視會監視某些條件，並回報僅 hello 條件變更時。</span><span class="sxs-lookup"><span data-stu-id="d5f59-308">hello watchdog monitors some conditions and reports only when hello conditions change.</span></span> <span data-ttu-id="d5f59-309">hello upside 這種方法是較少的報表所需。</span><span class="sxs-lookup"><span data-stu-id="d5f59-309">hello upside of this approach is that fewer reports are needed.</span></span> <span data-ttu-id="d5f59-310">hello 缺點是的 hello 看門狗的 hello 邏輯相當複雜。</span><span class="sxs-lookup"><span data-stu-id="d5f59-310">hello downside is that hello logic of hello watchdog is complex.</span></span> <span data-ttu-id="d5f59-311">hello 監視必須維護 hello 條件或 hello 報表，以便它們可檢查的 toodetermine 狀態變更。</span><span class="sxs-lookup"><span data-stu-id="d5f59-311">hello watchdog must maintain hello conditions or hello reports, so that they can be inspected toodetermine state changes.</span></span> <span data-ttu-id="d5f59-312">在容錯移轉時，必須小心新增，但尚未傳送 toohello 健全狀況存放區的報表。</span><span class="sxs-lookup"><span data-stu-id="d5f59-312">On failover, care must be taken with reports added, but not yet sent toohello health store.</span></span> <span data-ttu-id="d5f59-313">hello 序號必須不斷增加。</span><span class="sxs-lookup"><span data-stu-id="d5f59-313">hello sequence number must be ever-increasing.</span></span> <span data-ttu-id="d5f59-314">如果沒有，hello 報表將會拒絕為過時。</span><span class="sxs-lookup"><span data-stu-id="d5f59-314">If not, hello reports are rejected as stale.</span></span> <span data-ttu-id="d5f59-315">在 hello 造成資料遺失其中少數的情況，則可能需要 hello hello 報告狀態與 hello hello 健全狀況的儲存區狀態之間的同步處理。</span><span class="sxs-lookup"><span data-stu-id="d5f59-315">In hello rare cases where data loss is incurred, synchronization may be needed between hello state of hello reporter and hello state of hello health store.</span></span>

<span data-ttu-id="d5f59-316">透過 `Partition` 或 `CodePackageActivationContext` 進行轉換報告，對服務自行報告而言較為合理。</span><span class="sxs-lookup"><span data-stu-id="d5f59-316">Reporting on transitions makes sense for services reporting on themselves, through `Partition` or `CodePackageActivationContext`.</span></span> <span data-ttu-id="d5f59-317">當 hello 本機物件 (複本或部署的服務封裝 / 部署應用程式) 會移除其所有的報表也會移除。</span><span class="sxs-lookup"><span data-stu-id="d5f59-317">When hello local object (replica or deployed service package / deployed application) is removed, all its reports are also removed.</span></span> <span data-ttu-id="d5f59-318">此自動清除會放寬 hello 需要報告和健全狀況存放區之間的同步處理。</span><span class="sxs-lookup"><span data-stu-id="d5f59-318">This automatic cleanup relaxes hello need for synchronization between reporter and health store.</span></span> <span data-ttu-id="d5f59-319">如果 hello 報表是針對父磁碟分割或父應用程式，必須小心 hello health store 中容錯移轉 tooavoid 過時報表上。</span><span class="sxs-lookup"><span data-stu-id="d5f59-319">If hello report is for parent partition or parent application, care must be taken on failover tooavoid stale reports in hello health store.</span></span> <span data-ttu-id="d5f59-320">必須將邏輯加入 toomaintain hello 正確的狀態並清除 hello 報表從存放區不需要再時。</span><span class="sxs-lookup"><span data-stu-id="d5f59-320">Logic must be added toomaintain hello correct state and clear hello report from store when not needed anymore.</span></span>

## <a name="implement-health-reporting"></a><span data-ttu-id="d5f59-321">實作健康狀態報告</span><span class="sxs-lookup"><span data-stu-id="d5f59-321">Implement health reporting</span></span>
<span data-ttu-id="d5f59-322">一旦 hello 實體和報表的詳細資料清除，傳送健康情況報告可以透過 hello API、 PowerShell 或 REST。</span><span class="sxs-lookup"><span data-stu-id="d5f59-322">Once hello entity and report details are clear, sending health reports can be done through hello API, PowerShell, or REST.</span></span>

### <a name="api"></a><span data-ttu-id="d5f59-323">API</span><span class="sxs-lookup"><span data-stu-id="d5f59-323">API</span></span>
<span data-ttu-id="d5f59-324">tooreport 透過 hello API，您需要 toocreate 他們想 tooreport 的健全狀況報表特定 toohello 實體類型。</span><span class="sxs-lookup"><span data-stu-id="d5f59-324">tooreport through hello API, you need toocreate a health report specific toohello entity type they want tooreport on.</span></span> <span data-ttu-id="d5f59-325">給予 hello 報表 tooa 健全狀況的用戶端。</span><span class="sxs-lookup"><span data-stu-id="d5f59-325">Give hello report tooa health client.</span></span> <span data-ttu-id="d5f59-326">或者，建立健全狀況資訊，並將它傳遞 toocorrect 報告方法上`Partition`或`CodePackageActivationContext`tooreport 上目前的實體。</span><span class="sxs-lookup"><span data-stu-id="d5f59-326">Alternatively, create a health information and pass it toocorrect reporting methods on `Partition` or `CodePackageActivationContext` tooreport on current entities.</span></span>

<span data-ttu-id="d5f59-327">hello 下列範例示範定期監視 hello 叢集內的報告。</span><span class="sxs-lookup"><span data-stu-id="d5f59-327">hello following example shows periodic reporting from a watchdog within hello cluster.</span></span> <span data-ttu-id="d5f59-328">hello 監視會檢查是否可以外部資源的存取節點內。</span><span class="sxs-lookup"><span data-stu-id="d5f59-328">hello watchdog checks whether an external resource can be accessed from within a node.</span></span> <span data-ttu-id="d5f59-329">hello 資源需要 hello 應用程式中的服務資訊清單。</span><span class="sxs-lookup"><span data-stu-id="d5f59-329">hello resource is needed by a service manifest within hello application.</span></span> <span data-ttu-id="d5f59-330">如果 hello 資源無法使用，hello hello 應用程式的其他服務可以仍正常運作。</span><span class="sxs-lookup"><span data-stu-id="d5f59-330">If hello resource is unavailable, hello other services within hello application can still function properly.</span></span> <span data-ttu-id="d5f59-331">因此，hello 報表會傳送 hello 部署服務套件實體上每隔 30 秒。</span><span class="sxs-lookup"><span data-stu-id="d5f59-331">Therefore, hello report is sent on hello deployed service package entity every 30 seconds.</span></span>

```csharp
private static Uri ApplicationName = new Uri("fabric:/WordCount");
private static string ServiceManifestName = "WordCount.Service";
private static string NodeName = FabricRuntime.GetNodeContext().NodeName;
private static Timer ReportTimer = new Timer(new TimerCallback(SendReport), null, 30 * 1000, 30 * 1000);
private static FabricClient Client = new FabricClient(new FabricClientSettings() { HealthReportSendInterval = TimeSpan.FromSeconds(0) });

public static void SendReport(object obj)
{
    // Test whether hello resource can be accessed from hello node
    HealthState healthState = this.TestConnectivityToExternalResource();

    // Send report on deployed service package, as hello connectivity is needed by hello specific service manifest
    // and can be different on different nodes
    var deployedServicePackageHealthReport = new DeployedServicePackageHealthReport(
        ApplicationName,
        ServiceManifestName,
        NodeName,
        new HealthInformation("ExternalSourceWatcher", "Connectivity", healthState));

    // TODO: handle exception. Code omitted for snippet brevity.
    // Possible exceptions: FabricException with error codes
    // FabricHealthStaleReport (non-retryable, hello report is already queued on hello health client),
    // FabricHealthMaxReportsReached (retryable; user should retry with exponential delay until hello report is accepted).
    Client.HealthManager.ReportHealth(deployedServicePackageHealthReport);
}
```

### <a name="powershell"></a><span data-ttu-id="d5f59-332">PowerShell</span><span class="sxs-lookup"><span data-stu-id="d5f59-332">PowerShell</span></span>
<span data-ttu-id="d5f59-333">使用 **Send-ServiceFabric*EntityType*HealthReport** 傳送健康狀態報告。</span><span class="sxs-lookup"><span data-stu-id="d5f59-333">Send health reports with **Send-ServiceFabric*EntityType*HealthReport**.</span></span>

<span data-ttu-id="d5f59-334">hello 下列範例示範定期報告 CPU 節點上的值。</span><span class="sxs-lookup"><span data-stu-id="d5f59-334">hello following example shows periodic reporting on CPU values on a node.</span></span> <span data-ttu-id="d5f59-335">每隔 30 秒，應該傳送 hello 回報，而且必須 toolive 兩分鐘的時間。</span><span class="sxs-lookup"><span data-stu-id="d5f59-335">hello reports should be sent every 30 seconds, and they have a time toolive of two minutes.</span></span> <span data-ttu-id="d5f59-336">如果過期，hello reporter 會有問題，因此 hello 節點會在錯誤發生時評估。</span><span class="sxs-lookup"><span data-stu-id="d5f59-336">If they expire, hello reporter has issues, so hello node is evaluated at error.</span></span> <span data-ttu-id="d5f59-337">Hello CPU 臨界值時，hello 報表就會有警告的健全狀況狀態。</span><span class="sxs-lookup"><span data-stu-id="d5f59-337">When hello CPU is above a threshold, hello report has a health state of warning.</span></span> <span data-ttu-id="d5f59-338">當 hello CPU 保持 hello 設定時間已超過臨界值時，它會回報為錯誤。</span><span class="sxs-lookup"><span data-stu-id="d5f59-338">When hello CPU remains above a threshold for more than hello configured time, it's reported as an error.</span></span> <span data-ttu-id="d5f59-339">否則，hello reporter 傳送健全狀態為 [確定]。</span><span class="sxs-lookup"><span data-stu-id="d5f59-339">Otherwise, hello reporter sends a health state of OK.</span></span>

```powershell
PS C:\> Send-ServiceFabricNodeHealthReport -NodeName Node.1 -HealthState Warning -SourceId PowershellWatcher -HealthProperty CPU -Description "CPU is above 80% threshold" -TimeToLiveSec 120

PS C:\> Get-ServiceFabricNodeHealth -NodeName Node.1
NodeName              : Node.1
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='CPU', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.FM
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 5
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Fabric node is up.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : CPU
                        HealthState           : Warning
                        SequenceNumber        : 130741236814913394
                        SentAt                : 4/21/2015 9:01:21 PM
                        ReceivedAt            : 4/21/2015 9:01:21 PM
                        TTL                   : 00:02:00
                        Description           : CPU is above 80% threshold
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:01:21 PM
```

<span data-ttu-id="d5f59-340">hello 下列範例會報告暫時性警告複本。</span><span class="sxs-lookup"><span data-stu-id="d5f59-340">hello following example reports a transient warning on a replica.</span></span> <span data-ttu-id="d5f59-341">它會先取得 hello 分割區識別碼，並接著 hello 它感興趣的 hello 服務複本識別碼。</span><span class="sxs-lookup"><span data-stu-id="d5f59-341">It first gets hello partition ID and then hello replica ID for hello service it is interested in.</span></span> <span data-ttu-id="d5f59-342">然後將傳送來自報表**PowershellWatcher** hello 屬性**ResourceDependency**。</span><span class="sxs-lookup"><span data-stu-id="d5f59-342">It then sends a report from **PowershellWatcher** on hello property **ResourceDependency**.</span></span> <span data-ttu-id="d5f59-343">hello 報表感興趣的兩分鐘，並自動移除從 hello 存放區。</span><span class="sxs-lookup"><span data-stu-id="d5f59-343">hello report is of interest for only two minutes, and it is removed from hello store automatically.</span></span>

```powershell
PS C:\> $partitionId = (Get-ServiceFabricPartition -ServiceName fabric:/WordCount/WordCount.Service).PartitionId

PS C:\> $replicaId = (Get-ServiceFabricReplica -PartitionId $partitionId | where {$_.ReplicaRole -eq "Primary"}).ReplicaId

PS C:\> Send-ServiceFabricReplicaHealthReport -PartitionId $partitionId -ReplicaId $replicaId -HealthState Warning -SourceId PowershellWatcher -HealthProperty ResourceDependency -Description "hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes." -TimeToLiveSec 120 -RemoveWhenExpired

PS C:\> Get-ServiceFabricReplicaHealth  -PartitionId $partitionId -ReplicaOrInstanceId $replicaId


PartitionId           : 8f82daff-eb68-4fd9-b631-7a37629e08c0
ReplicaId             : 130740415594605869
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='ResourceDependency', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.RA
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 130740768777734943
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Replica has been created.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : ResourceDependency
                        HealthState           : Warning
                        SequenceNumber        : 130741243777723555
                        SentAt                : 4/21/2015 9:12:57 PM
                        ReceivedAt            : 4/21/2015 9:12:57 PM
                        TTL                   : 00:02:00
                        Description           : hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes.
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:12:32 PM
```

### <a name="rest"></a><span data-ttu-id="d5f59-344">REST</span><span class="sxs-lookup"><span data-stu-id="d5f59-344">REST</span></span>
<span data-ttu-id="d5f59-345">傳送與 POST 要求到 toohello 預期實體和 hello 主體 hello 健全狀況報表描述中有使用 REST 的健康情況報告。</span><span class="sxs-lookup"><span data-stu-id="d5f59-345">Send health reports using REST with POST requests that go toohello desired entity and have in hello body hello health report description.</span></span> <span data-ttu-id="d5f59-346">例如，請參閱如何 toosend REST[叢集健全狀況報表](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster)或[服務健康情況報告](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service)。</span><span class="sxs-lookup"><span data-stu-id="d5f59-346">For example, see how toosend REST [cluster health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) or [service health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span></span> <span data-ttu-id="d5f59-347">支援所有實體。</span><span class="sxs-lookup"><span data-stu-id="d5f59-347">All entities are supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d5f59-348">後續步驟</span><span class="sxs-lookup"><span data-stu-id="d5f59-348">Next steps</span></span>
<span data-ttu-id="d5f59-349">根據 hello 健全狀況資料，服務寫入器和叢集/應用程式系統管理員可以將方式 tooconsume hello 資訊。</span><span class="sxs-lookup"><span data-stu-id="d5f59-349">Based on hello health data, service writers and cluster/application administrators can think of ways tooconsume hello information.</span></span> <span data-ttu-id="d5f59-350">比方說，他們可以設定在引發中斷之前，根據健全狀況狀態 toocatch 嚴重問題的警示。</span><span class="sxs-lookup"><span data-stu-id="d5f59-350">For example, they can set up alerts based on health status toocatch severe issues before they provoke outages.</span></span> <span data-ttu-id="d5f59-351">系統管理員也可以設定修復系統 toofix 問題自動。</span><span class="sxs-lookup"><span data-stu-id="d5f59-351">Administrators can also set up repair systems toofix issues automatically.</span></span>

[<span data-ttu-id="d5f59-352">簡介 tooService 網狀架構健全狀況監視</span><span class="sxs-lookup"><span data-stu-id="d5f59-352">Introduction tooService Fabric health Monitoring</span></span>](service-fabric-health-introduction.md)

[<span data-ttu-id="d5f59-353">檢視 Service Fabric 健康狀態報告</span><span class="sxs-lookup"><span data-stu-id="d5f59-353">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="d5f59-354">Tooreport 並檢查服務健全狀況</span><span class="sxs-lookup"><span data-stu-id="d5f59-354">How tooreport and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="d5f59-355">使用系統健康狀態報告進行疑難排解</span><span class="sxs-lookup"><span data-stu-id="d5f59-355">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="d5f59-356">在本機上監視及診斷服務</span><span class="sxs-lookup"><span data-stu-id="d5f59-356">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="d5f59-357">Service Fabric 應用程式升級</span><span class="sxs-lookup"><span data-stu-id="d5f59-357">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)

