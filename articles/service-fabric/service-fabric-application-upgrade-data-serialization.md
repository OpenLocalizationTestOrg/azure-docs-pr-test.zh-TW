---
title: "應用程式升級：資料序列化 | Microsoft Docs"
description: "資料序列化的最佳作法，以及它如何影響應用程式輪流升級。"
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: a5f36366-a2ab-4ae3-bb08-bc2f9533bc5a
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: 1b65dfd3813423550631490640a81953864f58e3
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="how-data-serialization-affects-an-application-upgrade"></a><span data-ttu-id="f3689-103">資料序列化如何影響應用程式升級</span><span class="sxs-lookup"><span data-stu-id="f3689-103">How data serialization affects an application upgrade</span></span>
<span data-ttu-id="f3689-104">在[復原應用程式升級](service-fabric-application-upgrade.md)，hello 升級已套用的 tooa 節點的子集，一次一個升級網域。</span><span class="sxs-lookup"><span data-stu-id="f3689-104">In a [rolling application upgrade](service-fabric-application-upgrade.md), hello upgrade is applied tooa subset of nodes, one upgrade domain at a time.</span></span> <span data-ttu-id="f3689-105">在此過程中，某些升級網域 hello 較新版本的應用程式，而某些升級網域上 hello 較舊版本的應用程式。</span><span class="sxs-lookup"><span data-stu-id="f3689-105">During this process, some upgrade domains are on hello newer version of your application, and some upgrade domains are on hello older version of your application.</span></span> <span data-ttu-id="f3689-106">Hello 首展期間 hello 新版本的應用程式必須是能夠 tooread hello 舊版本的資料，而且 hello 舊版本的應用程式必須能夠 tooread hello 新版本的資料。</span><span class="sxs-lookup"><span data-stu-id="f3689-106">During hello rollout, hello new version of your application must be able tooread hello old version of your data, and hello old version of your application must be able tooread hello new version of your data.</span></span> <span data-ttu-id="f3689-107">如果 hello 資料格式不是向前和向後相容，hello 升級可能會失敗，或更糟的是，資料可能遺失或損毀。</span><span class="sxs-lookup"><span data-stu-id="f3689-107">If hello data format is not forward and backward compatible, hello upgrade may fail, or worse, data may be lost or corrupted.</span></span> <span data-ttu-id="f3689-108">本文將討論您資料格式的構成項目並提供最佳作法，以確保您的資料向前及向後相容。</span><span class="sxs-lookup"><span data-stu-id="f3689-108">This article discusses what constitutes your data format and offers best practices for ensuring that your data is forward and backward compatible.</span></span>

## <a name="what-makes-up-your-data-format"></a><span data-ttu-id="f3689-109">資料格式的構成項目？</span><span class="sxs-lookup"><span data-stu-id="f3689-109">What makes up your data format?</span></span>
<span data-ttu-id="f3689-110">在 Azure Service Fabric，hello 資料，可保存和複寫來自 C# 類別。</span><span class="sxs-lookup"><span data-stu-id="f3689-110">In Azure Service Fabric, hello data that is persisted and replicated comes from your C# classes.</span></span> <span data-ttu-id="f3689-111">使用的應用程式[可靠集合](service-fabric-reliable-services-reliable-collections.md)，資料是 hello hello 可靠字典與佇列中的物件。</span><span class="sxs-lookup"><span data-stu-id="f3689-111">For applications that use [Reliable Collections](service-fabric-reliable-services-reliable-collections.md), that data is hello objects in hello reliable dictionaries and queues.</span></span> <span data-ttu-id="f3689-112">使用的應用程式[Reliable Actors](service-fabric-reliable-actors-introduction.md)，也就是支援的 hello 動作項目狀態的 hello。</span><span class="sxs-lookup"><span data-stu-id="f3689-112">For applications that use [Reliable Actors](service-fabric-reliable-actors-introduction.md), that is hello backing state for hello actor.</span></span> <span data-ttu-id="f3689-113">下列 C# 類別必須是可序列化 toobe 保存和複寫。</span><span class="sxs-lookup"><span data-stu-id="f3689-113">These C# classes must be serializable toobe persisted and replicated.</span></span> <span data-ttu-id="f3689-114">因此，由 hello 欄位和屬性進行序列化，以及如何它們會序列化定義 hello 資料格式。</span><span class="sxs-lookup"><span data-stu-id="f3689-114">Therefore, hello data format is defined by hello fields and properties that are serialized, as well as how they are serialized.</span></span> <span data-ttu-id="f3689-115">例如，在`IReliableDictionary<int, MyClass>`hello 資料會序列化`int`和序列化`MyClass`。</span><span class="sxs-lookup"><span data-stu-id="f3689-115">For example, in an `IReliableDictionary<int, MyClass>` hello data is a serialized `int` and a serialized `MyClass`.</span></span>

### <a name="code-changes-that-result-in-a-data-format-change"></a><span data-ttu-id="f3689-116">程式碼變更造成資料格式變更</span><span class="sxs-lookup"><span data-stu-id="f3689-116">Code changes that result in a data format change</span></span>
<span data-ttu-id="f3689-117">Hello 資料格式由 C# 類別，因為變更 toohello 類別可能會導致資料格式變更。</span><span class="sxs-lookup"><span data-stu-id="f3689-117">Since hello data format is determined by C# classes, changes toohello classes may cause a data format change.</span></span> <span data-ttu-id="f3689-118">必須小心，輪流升級可處理 tooensure hello 資料格式變更。</span><span class="sxs-lookup"><span data-stu-id="f3689-118">Care must be taken tooensure that a rolling upgrade can handle hello data format change.</span></span> <span data-ttu-id="f3689-119">可能會造成資料格式變更的範例：</span><span class="sxs-lookup"><span data-stu-id="f3689-119">Examples that may cause data format changes:</span></span>

* <span data-ttu-id="f3689-120">新增或移除欄位或屬性</span><span class="sxs-lookup"><span data-stu-id="f3689-120">Adding or removing fields or properties</span></span>
* <span data-ttu-id="f3689-121">重新命名欄位或屬性</span><span class="sxs-lookup"><span data-stu-id="f3689-121">Renaming fields or properties</span></span>
* <span data-ttu-id="f3689-122">變更 hello 類型的欄位或屬性</span><span class="sxs-lookup"><span data-stu-id="f3689-122">Changing hello types of fields or properties</span></span>
* <span data-ttu-id="f3689-123">變更 hello 類別名稱或命名空間</span><span class="sxs-lookup"><span data-stu-id="f3689-123">Changing hello class name or namespace</span></span>

### <a name="data-contract-as-hello-default-serializer"></a><span data-ttu-id="f3689-124">資料合約，如 hello 預設序列化程式</span><span class="sxs-lookup"><span data-stu-id="f3689-124">Data Contract as hello default serializer</span></span>
<span data-ttu-id="f3689-125">hello 序列化程式通常需負責讀取 hello 資料和還原序列化成 hello 新版本，即使 hello 資料是在較舊或*較新*版本。</span><span class="sxs-lookup"><span data-stu-id="f3689-125">hello serializer is generally responsible for reading hello data and deserializing it into hello current version, even if hello data is in an older or *newer* version.</span></span> <span data-ttu-id="f3689-126">hello 預設序列化程式為 hello[資料合約序列化程式](https://msdn.microsoft.com/library/ms733127.aspx)，其具有妥善定義的版本控制規則。</span><span class="sxs-lookup"><span data-stu-id="f3689-126">hello default serializer is hello [Data Contract serializer](https://msdn.microsoft.com/library/ms733127.aspx), which has well-defined versioning rules.</span></span> <span data-ttu-id="f3689-127">集合允許 hello 序列化程式 toobe 覆寫，但 Reliable Actors 目前並不可靠。</span><span class="sxs-lookup"><span data-stu-id="f3689-127">Reliable Collections allow hello serializer toobe overridden, but Reliable Actors currently do not.</span></span> <span data-ttu-id="f3689-128">hello 資料序列化程式扮演重要角色啟用輪流升級。</span><span class="sxs-lookup"><span data-stu-id="f3689-128">hello data serializer plays an important role in enabling rolling upgrades.</span></span> <span data-ttu-id="f3689-129">hello 資料合約序列化程式是我們建議您針對 Service Fabric 應用程式的 hello 序列化程式。</span><span class="sxs-lookup"><span data-stu-id="f3689-129">hello Data Contract serializer is hello serializer that we recommend for Service Fabric applications.</span></span>

## <a name="how-hello-data-format-affects-a-rolling-upgrade"></a><span data-ttu-id="f3689-130">Hello 資料格式會輪流升級的影響</span><span class="sxs-lookup"><span data-stu-id="f3689-130">How hello data format affects a rolling upgrade</span></span>
<span data-ttu-id="f3689-131">輪流升級時，有兩個 hello 序列化程式可能會遇到較舊的主要案例或*較新*資料的版本：</span><span class="sxs-lookup"><span data-stu-id="f3689-131">During a rolling upgrade, there are two main scenarios where hello serializer may encounter an older or *newer* version of your data:</span></span>

1. <span data-ttu-id="f3689-132">節點會升級，並重新啟動之後，hello 新的序列化程式會載入已保存的 toodisk hello 舊版本的 hello 資料。</span><span class="sxs-lookup"><span data-stu-id="f3689-132">After a node is upgraded and starts back up, hello new serializer will load hello data that was persisted toodisk by hello old version.</span></span>
2. <span data-ttu-id="f3689-133">期間 hello 輪流升級，hello 叢集會包含程式碼的 hello 舊的和新版本的混合。</span><span class="sxs-lookup"><span data-stu-id="f3689-133">During hello rolling upgrade, hello cluster will contain a mix of hello old and new versions of your code.</span></span> <span data-ttu-id="f3689-134">因為複本可能會放置於不同的升級網域，而且複本會將傳送資料 tooeach 其他 hello 新及/或舊版本的資料可能會遇到 hello 新及/或舊版本的序列化程式。</span><span class="sxs-lookup"><span data-stu-id="f3689-134">Since replicas may be placed in different upgrade domains, and replicas send data tooeach other, hello new and/or old version of your data may be encountered by hello new and/or old version of your serializer.</span></span>

> [!NOTE]
> <span data-ttu-id="f3689-135">「 新的版本 」 和 「 舊的版本 」 hello 這裡參照 toohello 版本您正在執行的程式碼。</span><span class="sxs-lookup"><span data-stu-id="f3689-135">hello "new version" and "old version" here refer toohello version of your code that is running.</span></span> <span data-ttu-id="f3689-136">hello 「 新的序列化程式 」 是指在 hello 新版本的應用程式正在執行的 toohello 序列化程式程式碼。</span><span class="sxs-lookup"><span data-stu-id="f3689-136">hello "new serializer" refers toohello serializer code that is executing in hello new version of your application.</span></span> <span data-ttu-id="f3689-137">hello 「 新的資料 」 指的是應用的序列化 toohello C# 類別從 hello 新版本程式。</span><span class="sxs-lookup"><span data-stu-id="f3689-137">hello "new data" refers toohello serialized C# class from hello new version of your application.</span></span>
> 
> 

<span data-ttu-id="f3689-138">hello 兩個版本的程式碼和資料格式必須是向前和向後相容。</span><span class="sxs-lookup"><span data-stu-id="f3689-138">hello two versions of code and data format must be both forward and backward compatible.</span></span> <span data-ttu-id="f3689-139">如果不相容，hello 輪流升級可能會失敗，或可能會遺失資料。</span><span class="sxs-lookup"><span data-stu-id="f3689-139">If they are not compatible, hello rolling upgrade may fail or data may be lost.</span></span> <span data-ttu-id="f3689-140">hello 輪流升級可能會失敗，因為 hello 程式碼或序列化程式可能會擲回例外狀況或錯誤時遇到 hello 另一個版本。</span><span class="sxs-lookup"><span data-stu-id="f3689-140">hello rolling upgrade may fail because hello code or serializer may throw exceptions or a fault when it encounters hello other version.</span></span> <span data-ttu-id="f3689-141">如果，例如，已加入新屬性，但 hello 舊的序列化程式會捨棄它在還原序列化期間，可能會遺失資料。</span><span class="sxs-lookup"><span data-stu-id="f3689-141">Data may be lost if, for example, a new property was added but hello old serializer discards it during deserialization.</span></span>

<span data-ttu-id="f3689-142">資料合約為建議的解決方案，可確保您的資料相容的 hello。</span><span class="sxs-lookup"><span data-stu-id="f3689-142">Data Contract is hello recommended solution for ensuring that your data is compatible.</span></span> <span data-ttu-id="f3689-143">它有新增、移除及變更欄位的定義完善版本控制規則。</span><span class="sxs-lookup"><span data-stu-id="f3689-143">It has well-defined versioning rules for adding, removing, and changing fields.</span></span> <span data-ttu-id="f3689-144">它也有支援處理具有未知的欄位、 攔截到 hello 序列化和還原序列化程序，和處理的類別繼承。</span><span class="sxs-lookup"><span data-stu-id="f3689-144">It also has support for dealing with unknown fields, hooking into hello serialization and deserialization process, and dealing with class inheritance.</span></span> <span data-ttu-id="f3689-145">如需詳細資訊，請參閱 [使用資料合約](https://msdn.microsoft.com/library/ms733127.aspx)。</span><span class="sxs-lookup"><span data-stu-id="f3689-145">For more information, see [Using Data Contract](https://msdn.microsoft.com/library/ms733127.aspx).</span></span>

## <a name="next-steps"></a><span data-ttu-id="f3689-146">後續步驟</span><span class="sxs-lookup"><span data-stu-id="f3689-146">Next steps</span></span>
<span data-ttu-id="f3689-147">[使用 Visual Studio 升級您的應用程式](service-fabric-application-upgrade-tutorial.md) 將引導您完成使用 Visual Studio 進行應用程式升級的步驟。</span><span class="sxs-lookup"><span data-stu-id="f3689-147">[Upgrading your Application Using Visual Studio](service-fabric-application-upgrade-tutorial.md) walks you through an application upgrade using Visual Studio.</span></span>

<span data-ttu-id="f3689-148">[使用 PowerShell 升級您的應用程式](service-fabric-application-upgrade-tutorial-powershell.md) 將引導您完成使用 PowerShell 進行應用程式升級的步驟。</span><span class="sxs-lookup"><span data-stu-id="f3689-148">[Upgrading your Application Using Powershell](service-fabric-application-upgrade-tutorial-powershell.md) walks you through an application upgrade using PowerShell.</span></span>

<span data-ttu-id="f3689-149">使用 [升級參數](service-fabric-application-upgrade-parameters.md)來控制您應用程式的升級方式。</span><span class="sxs-lookup"><span data-stu-id="f3689-149">Control how your application upgrades by using [Upgrade Parameters](service-fabric-application-upgrade-parameters.md).</span></span>

<span data-ttu-id="f3689-150">了解 toouse 把太升級您的應用程式時所進階的功能[進階主題](service-fabric-application-upgrade-advanced.md)。</span><span class="sxs-lookup"><span data-stu-id="f3689-150">Learn how toouse advanced functionality while upgrading your application by referring too[Advanced Topics](service-fabric-application-upgrade-advanced.md).</span></span>

<span data-ttu-id="f3689-151">藉由參考 toohello 步驟中的修正應用程式升級的一般問題[疑難排解應用程式升級](service-fabric-application-upgrade-troubleshooting.md)。</span><span class="sxs-lookup"><span data-stu-id="f3689-151">Fix common problems in application upgrades by referring toohello steps in [Troubleshooting Application Upgrades ](service-fabric-application-upgrade-troubleshooting.md).</span></span>

