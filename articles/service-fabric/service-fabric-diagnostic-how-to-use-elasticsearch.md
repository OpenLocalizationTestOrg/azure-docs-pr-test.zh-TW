---
title: "aaaUsing Elasticsearch 做為 Service Fabric 應用程式追蹤存放區 |Microsoft 文件"
description: "說明 Service Fabric 應用程式可以如何使用 Elasticsearch 和 Kibana toostore、 索引和搜尋應用程式追蹤 （記錄檔）"
services: service-fabric
documentationcenter: .net
author: karolz-ms
manager: adegeo
editor: 
ms.assetid: e59b0c39-e468-4d9e-b453-d5f2a8ad20d8
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: karolz@microsoft.com
redirect_url: /azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow
ms.openlocfilehash: b5977c54e69319e3caa376e44a02f971b66a3254
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a><span data-ttu-id="a68ce-103">把 Elasticsearch 當做 Service Fabric 應用程式追蹤存放區來使用</span><span class="sxs-lookup"><span data-stu-id="a68ce-103">Use Elasticsearch as a Service Fabric application trace store</span></span>
## <a name="introduction"></a><span data-ttu-id="a68ce-104">簡介</span><span class="sxs-lookup"><span data-stu-id="a68ce-104">Introduction</span></span>
<span data-ttu-id="a68ce-105">本文將說明 [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) 應用程式如何使用 **Elasticsearch** 和 **Kibana** 來儲存、檢索和搜尋應用程式追蹤。</span><span class="sxs-lookup"><span data-stu-id="a68ce-105">This article describes how [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) applications can use **Elasticsearch** and **Kibana** for application trace storage, indexing, and search.</span></span> <span data-ttu-id="a68ce-106">[Elasticsarch](https://www.elastic.co/guide/index.html) 是開放原始碼、分散式和可調整的即時搜尋和分析引擎，很適合執行這項工作。</span><span class="sxs-lookup"><span data-stu-id="a68ce-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is an open-source, distributed, and scalable real-time search and analytics engine that is well-suited for this task.</span></span> <span data-ttu-id="a68ce-107">它可以安裝在 Microsoft Azure 中執行的 Windows 和 Linux 虛擬機器上。</span><span class="sxs-lookup"><span data-stu-id="a68ce-107">It can be installed on Windows and Linux virtual machines running in Microsoft Azure.</span></span> <span data-ttu-id="a68ce-108">Elasticsearch 可有效率地處理使用 **Windows 事件追蹤 (ETW)** 之類的技術所產生的「結構化」追蹤。</span><span class="sxs-lookup"><span data-stu-id="a68ce-108">Elasticsearch can efficiently process *structured* traces produced using technologies such as **Event Tracing for Windows (ETW)**.</span></span>

<span data-ttu-id="a68ce-109">ETW 會使用 Service Fabric 執行階段 toosource 診斷資訊 （追蹤）。</span><span class="sxs-lookup"><span data-stu-id="a68ce-109">ETW is used by Service Fabric runtime toosource diagnostic information (traces).</span></span> <span data-ttu-id="a68ce-110">它是 hello 建議 Service Fabric 應用程式 toosource 方法其診斷資訊，太。</span><span class="sxs-lookup"><span data-stu-id="a68ce-110">It is hello recommended method for Service Fabric applications toosource their diagnostic information, too.</span></span> <span data-ttu-id="a68ce-111">使用相同的機制可讓執行階段提供，且應用程式所提供的追蹤和疑難排解更加容易讓之間的相互關聯的 hello。</span><span class="sxs-lookup"><span data-stu-id="a68ce-111">Using hello same mechanism allows for correlation between runtime-supplied and application-supplied traces and makes troubleshooting easier.</span></span> <span data-ttu-id="a68ce-112">在 Visual Studio 中的 Service Fabric 專案範本包含記錄的應用程式開發介面 (根據 hello.NET **EventSource**類別)，預設會發出 ETW 追蹤。</span><span class="sxs-lookup"><span data-stu-id="a68ce-112">Service Fabric project templates in Visual Studio include a logging API (based on hello .NET **EventSource** class) that emits ETW traces by default.</span></span> <span data-ttu-id="a68ce-113">如需使用 ETW 的 Service Fabric 應用程式追蹤的一般概觀，請參閱 [監視和診斷本機開發設定中的服務](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)。</span><span class="sxs-lookup"><span data-stu-id="a68ce-113">For a general overview of Service Fabric application tracing using ETW, see [Monitoring and diagnosing services in a local machine development setup](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span></span>

<span data-ttu-id="a68ce-114">Hello 追蹤 tooshow 向上 Elasticsearch 中，它們需要 toobe 擷取的即時 hello Service Fabric 叢集節點 （在 hello 應用程式正在執行） 並傳送 tooan Elasticsearch 端點。</span><span class="sxs-lookup"><span data-stu-id="a68ce-114">For hello traces tooshow up in Elasticsearch, they need toobe captured at hello Service Fabric cluster nodes in real time (while hello application is running) and sent tooan Elasticsearch endpoint.</span></span> <span data-ttu-id="a68ce-115">追蹤擷取有兩個主要選項：</span><span class="sxs-lookup"><span data-stu-id="a68ce-115">There are two major options for trace capturing:</span></span>

* <span data-ttu-id="a68ce-116">**同處理序追蹤擷取**</span><span class="sxs-lookup"><span data-stu-id="a68ce-116">**In-process trace capturing**</span></span>  
  <span data-ttu-id="a68ce-117">hello 應用程式或更精確地說，服務處理程序，負責傳送嗨診斷資料 toohello 追蹤存放區 (Elasticsearch)。</span><span class="sxs-lookup"><span data-stu-id="a68ce-117">hello application, or more precisely, service process, is responsible for sending out hello diagnostic data toohello trace store (Elasticsearch).</span></span>
* <span data-ttu-id="a68ce-118">**跨處理序追蹤擷取**</span><span class="sxs-lookup"><span data-stu-id="a68ce-118">**Out-of-process trace capturing**</span></span>  
  <span data-ttu-id="a68ce-119">獨立的代理程式會擷取從 hello 服務處理程序或處理程序的追蹤，然後將它們傳送 toohello 追蹤存放區。</span><span class="sxs-lookup"><span data-stu-id="a68ce-119">A separate agent is capturing traces from hello service process or processes and sending them toohello trace store.</span></span>

<span data-ttu-id="a68ce-120">以下，我們將描述如何註冊在 Azure 上、 Elasticsearch tooset 討論 hello 專業人員和優缺點比較兩個擷取選項，並說明如何 tooconfigure Service Fabric 服務 toosend 資料 tooElasticsearch。</span><span class="sxs-lookup"><span data-stu-id="a68ce-120">Below, we describe how tooset up Elasticsearch on Azure, discuss hello pros and cons for both capture options, and explain how tooconfigure a Service Fabric service toosend data tooElasticsearch.</span></span>

## <a name="set-up-elasticsearch-on-azure"></a><span data-ttu-id="a68ce-121">在 Azure 上設定 Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="a68ce-121">Set up Elasticsearch on Azure</span></span>
<span data-ttu-id="a68ce-122">hello hello Elasticsearch 服務在 Azure 上的最直接的方式 tooset 是透過[ **Azure 資源管理員範本**](../azure-resource-manager/resource-group-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="a68ce-122">hello most straightforward way tooset up hello Elasticsearch service on Azure is through [**Azure Resource Manager templates**](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="a68ce-123">Azure 快速入門範本儲存機制提供完整的 [Elasticsearch 快速入門 Azure 資源管理員範本](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) 。</span><span class="sxs-lookup"><span data-stu-id="a68ce-123">A comprehensive [Quickstart Azure Resource Manager template for Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is available from Azure Quickstart templates repository.</span></span> <span data-ttu-id="a68ce-124">這個範本會針對縮放單位使用不同的儲存體帳戶 (節點群組)。</span><span class="sxs-lookup"><span data-stu-id="a68ce-124">This template uses separate storage accounts for scale units (groups of nodes).</span></span> <span data-ttu-id="a68ce-125">它也可以佈建具有不同組態和連接各種數量的資料磁碟的個別用戶端與伺服器節點。</span><span class="sxs-lookup"><span data-stu-id="a68ce-125">It can also provision separate client and server nodes with different configurations and various numbers of data disks attached.</span></span>

<span data-ttu-id="a68ce-126">在此，我們使用另一個範本，呼叫**ES MultiNode**從 hello [Azure 診斷工具儲存機制](https://github.com/Azure/azure-diagnostics-tools)。</span><span class="sxs-lookup"><span data-stu-id="a68ce-126">Here, we use another template, called **ES-MultiNode** from hello [Azure diagnostic tools repository](https://github.com/Azure/azure-diagnostics-tools).</span></span> <span data-ttu-id="a68ce-127">此範本是更容易 toouse，而且它會建立 HTTP 基本驗證所保護的 Elasticsearch 叢集。</span><span class="sxs-lookup"><span data-stu-id="a68ce-127">This template is easier toouse, and it creates an Elasticsearch cluster protected by HTTP basic authentication.</span></span> <span data-ttu-id="a68ce-128">在繼續之前，請從 GitHub tooyour 電腦下載 hello 儲存機制 （由複製 hello 儲存機制或下載 zip 檔案）。</span><span class="sxs-lookup"><span data-stu-id="a68ce-128">Before you proceed, download hello repository from GitHub tooyour machine (by either cloning hello repository or downloading a zip file).</span></span> <span data-ttu-id="a68ce-129">hello ES MultiNode 範本位於 hello 與 hello 資料夾中相同的名稱。</span><span class="sxs-lookup"><span data-stu-id="a68ce-129">hello ES-MultiNode template is located in hello folder with hello same name.</span></span>

### <a name="prepare-a-machine-toorun-elasticsearch-installation-scripts"></a><span data-ttu-id="a68ce-130">準備電腦 toorun Elasticsearch 安裝指令碼</span><span class="sxs-lookup"><span data-stu-id="a68ce-130">Prepare a machine toorun Elasticsearch installation scripts</span></span>
<span data-ttu-id="a68ce-131">hello 最簡單的方式 toouse hello ES MultiNode 範本都是透過提供的 Azure PowerShell 指令碼，呼叫`CreateElasticSearchCluster`。</span><span class="sxs-lookup"><span data-stu-id="a68ce-131">hello easiest way toouse hello ES-MultiNode template is through a provided Azure PowerShell script called `CreateElasticSearchCluster`.</span></span> <span data-ttu-id="a68ce-132">toouse 此指令碼，您需要 tooinstall PowerShell 模組和一個工具，稱為**openssl**。</span><span class="sxs-lookup"><span data-stu-id="a68ce-132">toouse this script, you need tooinstall PowerShell modules and a tool called **openssl**.</span></span> <span data-ttu-id="a68ce-133">hello 後者是從遠端建立 SSH 金鑰，它可以是使用的 tooadminister Elasticsearch 叢集所需。</span><span class="sxs-lookup"><span data-stu-id="a68ce-133">hello latter is needed for creating an SSH key that can be used tooadminister your Elasticsearch cluster remotely.</span></span>

<span data-ttu-id="a68ce-134">`CreateElasticSearchCluster`指令碼被設計的易用性 hello ES MultiNode 範本，從 Windows 電腦。</span><span class="sxs-lookup"><span data-stu-id="a68ce-134">`CreateElasticSearchCluster` script is designed for ease of use with hello ES-MultiNode template from a Windows machine.</span></span> <span data-ttu-id="a68ce-135">它是在非 Windows 的電腦，可能 toouse hello 範本，但這種情況下已超出本文 hello 範圍。</span><span class="sxs-lookup"><span data-stu-id="a68ce-135">It is possible toouse hello template on a non-Windows machine, but that scenario is beyond hello scope of this article.</span></span>

1. <span data-ttu-id="a68ce-136">如果您尚未安裝它們，請安裝 [**Azure PowerShell 模組**](http://aka.ms/webpi-azps)。</span><span class="sxs-lookup"><span data-stu-id="a68ce-136">If you haven't installed them already, install [**Azure PowerShell modules**](http://aka.ms/webpi-azps).</span></span> <span data-ttu-id="a68ce-137">出現提示時，請按一下 [執行]，然後按一下 [安裝]。</span><span class="sxs-lookup"><span data-stu-id="a68ce-137">When prompted, click **Run**, then **Install**.</span></span> <span data-ttu-id="a68ce-138">需要 Azure PowerShell 1.3 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="a68ce-138">Azure PowerShell 1.3 or newer is required.</span></span>
2. <span data-ttu-id="a68ce-139">hello **openssl**工具隨附於的 hello 分佈[ **Git for Windows**](http://www.git-scm.com/downloads)。</span><span class="sxs-lookup"><span data-stu-id="a68ce-139">hello **openssl** tool is included in hello distribution of [**Git for Windows**](http://www.git-scm.com/downloads).</span></span> <span data-ttu-id="a68ce-140">如果您尚未安裝，請立即安裝 [Git for Windows](http://www.git-scm.com/downloads) 。</span><span class="sxs-lookup"><span data-stu-id="a68ce-140">If you have not done so already, install [Git for Windows](http://www.git-scm.com/downloads) now.</span></span> <span data-ttu-id="a68ce-141">（hello 預設安裝選項是 [確定]）。</span><span class="sxs-lookup"><span data-stu-id="a68ce-141">(hello default installation options are OK.)</span></span>
3. <span data-ttu-id="a68ce-142">假設 Git 已安裝但不是包含在 hello 系統路徑中，開啟 Microsoft Azure PowerShell 視窗，然後執行下列命令的 hello:</span><span class="sxs-lookup"><span data-stu-id="a68ce-142">Assuming that Git has been installed but not included in hello system path, open a Microsoft Azure PowerShell window and run hello following commands:</span></span>
   
    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```
   
    <span data-ttu-id="a68ce-143">取代 hello `<Git installation folder>` hello Git 位置，在您的電腦; 上 hello 預設值是**"C:\Program Files\Git"**。</span><span class="sxs-lookup"><span data-stu-id="a68ce-143">Replace hello `<Git installation folder>` with hello Git location on your machine; hello default is **"C:\Program Files\Git"**.</span></span> <span data-ttu-id="a68ce-144">請注意在 hello 開頭 hello 第一個路徑的 hello 分號字元。</span><span class="sxs-lookup"><span data-stu-id="a68ce-144">Note hello semicolon character at hello beginning of hello first path.</span></span>
4. <span data-ttu-id="a68ce-145">確認您已登入 tooAzure (透過[ `Add-AzureRmAccount` ](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet)，您已選取 hello 訂用帳戶，應該使用 toocreate 彈性的搜尋叢集。</span><span class="sxs-lookup"><span data-stu-id="a68ce-145">Ensure that you are logged on tooAzure (via [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) and that you have selected hello subscription that should be used toocreate your Elastic Search cluster.</span></span> <span data-ttu-id="a68ce-146">您可以使用 `Get-AzureRmContext` 和 `Get-AzureRmSubscription` Cmdlet，確認選取的是正確的訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="a68ce-146">You can verify that correct subscription is selected using `Get-AzureRmContext` and `Get-AzureRmSubscription` cmdlets.</span></span>
5. <span data-ttu-id="a68ce-147">如果您尚未這樣做，請變更 hello 目前目錄 toohello ES MultiNode 資料夾。</span><span class="sxs-lookup"><span data-stu-id="a68ce-147">If you haven't done so already, change hello current directory toohello ES-MultiNode folder.</span></span>

### <a name="run-hello-createelasticsearchcluster-script"></a><span data-ttu-id="a68ce-148">執行 hello CreateElasticSearchCluster 指令碼</span><span class="sxs-lookup"><span data-stu-id="a68ce-148">Run hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="a68ce-149">執行 hello 指令碼之前，請開啟 hello`azuredeploy-parameters.json`檔案，並確認或提供 hello 指令碼參數的值。</span><span class="sxs-lookup"><span data-stu-id="a68ce-149">Before you run hello script, open hello `azuredeploy-parameters.json` file and verify or provide values for hello script parameters.</span></span> <span data-ttu-id="a68ce-150">提供下列參數的 hello:</span><span class="sxs-lookup"><span data-stu-id="a68ce-150">hello following parameters are provided:</span></span>

| <span data-ttu-id="a68ce-151">參數名稱</span><span class="sxs-lookup"><span data-stu-id="a68ce-151">Parameter Name</span></span> | <span data-ttu-id="a68ce-152">說明</span><span class="sxs-lookup"><span data-stu-id="a68ce-152">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a68ce-153">dnsNameForLoadBalancerIP</span><span class="sxs-lookup"><span data-stu-id="a68ce-153">dnsNameForLoadBalancerIP</span></span> |<span data-ttu-id="a68ce-154">hello 是使用的 toocreate hello 公開可見的 DNS 名稱 hello 彈性的搜尋叢集 （藉由附加 hello Azure 地區網域 toohello 提供名稱） 的名稱。</span><span class="sxs-lookup"><span data-stu-id="a68ce-154">hello name that is used toocreate hello publicly visible DNS name for hello Elastic Search cluster (by appending hello Azure region domain toohello provided name).</span></span> <span data-ttu-id="a68ce-155">例如，如果此參數值是"myBigCluster"hello 選擇 Azure 地區為美國西部，hello 叢集 hello 產生 DNS 名稱會是 myBigCluster.westus.cloudapp.azure.com。</span><span class="sxs-lookup"><span data-stu-id="a68ce-155">For example, if this parameter value is "myBigCluster" and hello chosen Azure region is West US, hello resulting DNS name for hello cluster is myBigCluster.westus.cloudapp.azure.com.</span></span> <br /><br /><span data-ttu-id="a68ce-156">此名稱也可做為許多成品 hello 彈性的搜尋叢集中，例如資料節點名稱與相關聯的根名稱。</span><span class="sxs-lookup"><span data-stu-id="a68ce-156">This name also serves as a root name for many artifacts associated with hello Elastic Search cluster, such as data node names.</span></span> |
| <span data-ttu-id="a68ce-157">adminUsername</span><span class="sxs-lookup"><span data-stu-id="a68ce-157">adminUsername</span></span> |<span data-ttu-id="a68ce-158">hello hello 系統管理員帳戶名稱管理 hello 彈性的搜尋叢集 （自動產生對應的 SSH 金鑰）。</span><span class="sxs-lookup"><span data-stu-id="a68ce-158">hello name of hello administrator account for managing hello Elastic Search cluster (corresponding SSH keys are generated automatically).</span></span> |
| <span data-ttu-id="a68ce-159">dataNodeCount</span><span class="sxs-lookup"><span data-stu-id="a68ce-159">dataNodeCount</span></span> |<span data-ttu-id="a68ce-160">hello hello 彈性的搜尋叢集中的節點數目。</span><span class="sxs-lookup"><span data-stu-id="a68ce-160">hello number of nodes in hello Elastic Search cluster.</span></span> <span data-ttu-id="a68ce-161">hello hello 指令碼的目前版本不會區分資料與查詢節點。所有的節點會播放這兩個角色。</span><span class="sxs-lookup"><span data-stu-id="a68ce-161">hello current version of hello script does not distinguish between data and query nodes; all nodes play both roles.</span></span> <span data-ttu-id="a68ce-162">預設值 too3 節點。</span><span class="sxs-lookup"><span data-stu-id="a68ce-162">Defaults too3 nodes.</span></span> |
| <span data-ttu-id="a68ce-163">dataDiskSize</span><span class="sxs-lookup"><span data-stu-id="a68ce-163">dataDiskSize</span></span> |<span data-ttu-id="a68ce-164">hello 的大小 （以 gb 為單位） 的資料磁碟配置的每個資料節點。</span><span class="sxs-lookup"><span data-stu-id="a68ce-164">hello size of data disks (in GB) that is allocated for each data node.</span></span> <span data-ttu-id="a68ce-165">每個節點會接收 4 個資料磁碟，以獨佔方式專用 tooElastic 搜尋服務。</span><span class="sxs-lookup"><span data-stu-id="a68ce-165">Each node receives 4 data disks, exclusively dedicated tooElastic Search service.</span></span> |
| <span data-ttu-id="a68ce-166">region</span><span class="sxs-lookup"><span data-stu-id="a68ce-166">region</span></span> |<span data-ttu-id="a68ce-167">hello 應該位於 hello 彈性的搜尋叢集的 Azure 區域名稱。</span><span class="sxs-lookup"><span data-stu-id="a68ce-167">hello name of Azure region where hello Elastic Search cluster should be located.</span></span> |
| <span data-ttu-id="a68ce-168">esUserName</span><span class="sxs-lookup"><span data-stu-id="a68ce-168">esUserName</span></span> |<span data-ttu-id="a68ce-169">hello hello 為使用者的使用者名稱設定 toohave 存取 tooES 叢集 （主旨 tooHTTP 基本驗證）。</span><span class="sxs-lookup"><span data-stu-id="a68ce-169">hello user name of hello user that is configured toohave access tooES cluster (subject tooHTTP basic authentication).</span></span> <span data-ttu-id="a68ce-170">hello 密碼不是參數檔案的一部分，必須提供何時`CreateElasticSearchCluster`指令碼會叫用。</span><span class="sxs-lookup"><span data-stu-id="a68ce-170">hello password is not part of parameters file and must be provided when `CreateElasticSearchCluster` script is invoked.</span></span> |
| <span data-ttu-id="a68ce-171">vmSizeDataNodes</span><span class="sxs-lookup"><span data-stu-id="a68ce-171">vmSizeDataNodes</span></span> |<span data-ttu-id="a68ce-172">hello 彈性的搜尋叢集節點的 Azure 虛擬機器大小。</span><span class="sxs-lookup"><span data-stu-id="a68ce-172">hello Azure virtual machine size for Elastic Search cluster nodes.</span></span> <span data-ttu-id="a68ce-173">預設值 tooStandard_D2。</span><span class="sxs-lookup"><span data-stu-id="a68ce-173">Defaults tooStandard_D2.</span></span> |

<span data-ttu-id="a68ce-174">現在您已準備好 toorun hello 指令碼。</span><span class="sxs-lookup"><span data-stu-id="a68ce-174">Now you are ready toorun hello script.</span></span> <span data-ttu-id="a68ce-175">發出下列命令的 hello:</span><span class="sxs-lookup"><span data-stu-id="a68ce-175">Issue hello following command:</span></span>

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

<span data-ttu-id="a68ce-176">其中</span><span class="sxs-lookup"><span data-stu-id="a68ce-176">where</span></span> 

| <span data-ttu-id="a68ce-177">指令碼參數名稱</span><span class="sxs-lookup"><span data-stu-id="a68ce-177">Script Parameter Name</span></span> | <span data-ttu-id="a68ce-178">說明</span><span class="sxs-lookup"><span data-stu-id="a68ce-178">Description</span></span> |
| --- | --- |
| `<es-group-name>` |<span data-ttu-id="a68ce-179">hello hello Azure 資源群組的名稱將會包含所有的彈性的搜尋叢集資源。</span><span class="sxs-lookup"><span data-stu-id="a68ce-179">hello name of hello Azure resource group that will contain all Elastic Search cluster resources.</span></span> |
| `<azure-region>` |<span data-ttu-id="a68ce-180">hello hello Azure hello 彈性的搜尋叢集建立所在的區域名稱。</span><span class="sxs-lookup"><span data-stu-id="a68ce-180">hello name of hello Azure region where hello Elastic Search cluster should be created.</span></span> |
| `<es-password>` |<span data-ttu-id="a68ce-181">hello hello 彈性的搜尋使用者密碼。</span><span class="sxs-lookup"><span data-stu-id="a68ce-181">hello password for hello Elastic Search user.</span></span> |

> [!NOTE]
> <span data-ttu-id="a68ce-182">如果您從 hello 測試 AzureResourceGroup cmdlet 取得 NullReferenceException，忘記 toolog tooAzure 上的 (`Add-AzureRmAccount`)。</span><span class="sxs-lookup"><span data-stu-id="a68ce-182">If you get a NullReferenceException from hello Test-AzureResourceGroup cmdlet, you have forgotten toolog on tooAzure (`Add-AzureRmAccount`).</span></span>
> 
> 

<span data-ttu-id="a68ce-183">如果您收到執行 hello 指令碼錯誤，且您判斷 hello 錯誤因錯誤的範本參數值，請更正 hello 參數檔案，然後再次執行 hello 指令碼，以不同的資源群組名稱。</span><span class="sxs-lookup"><span data-stu-id="a68ce-183">If you get an error from running hello script and you determine that hello error was caused by a wrong template parameter value, correct hello parameter file and run hello script again with a different resource group name.</span></span> <span data-ttu-id="a68ce-184">您也可以重複使用 hello 相同資源群組名稱，而且有 hello 清除 hello 舊的指令碼，藉由新增 hello`-RemoveExistingResourceGroup`參數 toohello 指令碼引動過程。</span><span class="sxs-lookup"><span data-stu-id="a68ce-184">You can also reuse hello same resource group name and have hello script clean up hello old one by adding hello `-RemoveExistingResourceGroup` parameter toohello script invocation.</span></span>

### <a name="result-of-running-hello-createelasticsearchcluster-script"></a><span data-ttu-id="a68ce-185">執行 hello CreateElasticSearchCluster 指令碼的結果</span><span class="sxs-lookup"><span data-stu-id="a68ce-185">Result of running hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="a68ce-186">執行 hello 之後`CreateElasticSearchCluster`指令碼，將建立下列主要成品的 hello。</span><span class="sxs-lookup"><span data-stu-id="a68ce-186">After you run hello `CreateElasticSearchCluster` script, hello following main artifacts will be created.</span></span> <span data-ttu-id="a68ce-187">此範例中，我們假設您使用的是 「 myBigCluster"做為 hello hello 值`dnsNameForLoadBalancerIP`參數與您用來建立 hello 叢集該 hello 地區為美國西部。</span><span class="sxs-lookup"><span data-stu-id="a68ce-187">For this example we assume that you have used "myBigCluster" as hello value of hello `dnsNameForLoadBalancerIP` parameter and that hello region where you created hello cluster is West US.</span></span>

| <span data-ttu-id="a68ce-188">構件</span><span class="sxs-lookup"><span data-stu-id="a68ce-188">Artifact</span></span> | <span data-ttu-id="a68ce-189">名稱、位置及備註</span><span class="sxs-lookup"><span data-stu-id="a68ce-189">Name, location, and remarks</span></span> |
| --- | --- |
| <span data-ttu-id="a68ce-190">用於遠端系統管理的 SSH 金鑰</span><span class="sxs-lookup"><span data-stu-id="a68ce-190">SSH key for remote administration</span></span> |<span data-ttu-id="a68ce-191">myBigCluster.key 檔 （在已執行哪些 hello CreateElasticSearchCluster 的 hello 目錄）。</span><span class="sxs-lookup"><span data-stu-id="a68ce-191">myBigCluster.key file (in hello directory from which hello CreateElasticSearchCluster was run).</span></span> <br /><br /><span data-ttu-id="a68ce-192">此金鑰檔，可以是使用的 tooconnect toohello 管理節點及 （透過 hello 管理節點） toodata hello 叢集中的節點。</span><span class="sxs-lookup"><span data-stu-id="a68ce-192">This key file can be used tooconnect toohello admin node and (through hello admin node) toodata nodes in hello cluster.</span></span> |
| <span data-ttu-id="a68ce-193">管理節點</span><span class="sxs-lookup"><span data-stu-id="a68ce-193">Admin node</span></span> |<span data-ttu-id="a68ce-194">myBigCluster-admin.westus.cloudapp.azure.com </span><span class="sxs-lookup"><span data-stu-id="a68ce-194">myBigCluster-admin.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="a68ce-195">專用的 VM 的遠端 Elasticsearch 叢集系統管理-hello 只有一個，可讓外部 SSH 連線。</span><span class="sxs-lookup"><span data-stu-id="a68ce-195">A dedicated VM for remote Elasticsearch cluster administration--hello only one that allows external SSH connections.</span></span> <span data-ttu-id="a68ce-196">在 hello 相同的虛擬網路，為所有的 hello Elasticsearch 叢集節點，但未執行任何 Elasticsearch 服務上執行。</span><span class="sxs-lookup"><span data-stu-id="a68ce-196">It runs on hello same virtual network as all hello Elasticsearch cluster nodes, but it does not run any Elasticsearch services.</span></span> |
| <span data-ttu-id="a68ce-197">資料節點</span><span class="sxs-lookup"><span data-stu-id="a68ce-197">Data nodes</span></span> |<span data-ttu-id="a68ce-198">myBigCluster1 …</span><span class="sxs-lookup"><span data-stu-id="a68ce-198">myBigCluster1 …</span></span> <span data-ttu-id="a68ce-199">myBigCluster*N*</span><span class="sxs-lookup"><span data-stu-id="a68ce-199">myBigCluster*N*</span></span> <br /><br /><span data-ttu-id="a68ce-200">執行 Elasticsearch 和 Kibana 服務的資料節點。</span><span class="sxs-lookup"><span data-stu-id="a68ce-200">Data nodes that are running Elasticsearch and Kibana services.</span></span> <span data-ttu-id="a68ce-201">您可以連接透過 SSH tooeach 節點，但只能透過 hello 管理節點。</span><span class="sxs-lookup"><span data-stu-id="a68ce-201">You can connect via SSH tooeach node, but only via hello admin node.</span></span> |
| <span data-ttu-id="a68ce-202">Elasticsearch 叢集</span><span class="sxs-lookup"><span data-stu-id="a68ce-202">Elasticsearch cluster</span></span> |<span data-ttu-id="a68ce-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span><span class="sxs-lookup"><span data-stu-id="a68ce-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span></span> <br /><br /><span data-ttu-id="a68ce-204">hello hello Elasticsearch 叢集 （請注意 hello /es 尾碼） 的主要端點。</span><span class="sxs-lookup"><span data-stu-id="a68ce-204">hello primary endpoint for hello Elasticsearch cluster (note hello /es suffix).</span></span> <span data-ttu-id="a68ce-205">受到基本 HTTP 驗證 （hello 認證 hello 指定 esUserName/esPassword hello ES MultiNode 範本參數）。</span><span class="sxs-lookup"><span data-stu-id="a68ce-205">It is protected by basic HTTP authentication (hello credentials were hello specified esUserName/esPassword parameters of hello ES-MultiNode template).</span></span> <span data-ttu-id="a68ce-206">hello 叢集也有基本的叢集管理 hello head 外掛程式安裝 (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head)。</span><span class="sxs-lookup"><span data-stu-id="a68ce-206">hello cluster has also hello head plug-in installed (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) for basic cluster administration.</span></span> |
| <span data-ttu-id="a68ce-207">Kibana 服務</span><span class="sxs-lookup"><span data-stu-id="a68ce-207">Kibana service</span></span> |<span data-ttu-id="a68ce-208">http://myBigCluster.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="a68ce-208">http://myBigCluster.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="a68ce-209">hello Kibana 服務設定 tooshow 資料中，從建立 Elasticsearch 叢集 hello。</span><span class="sxs-lookup"><span data-stu-id="a68ce-209">hello Kibana service is set up tooshow data from hello created Elasticsearch cluster.</span></span> <span data-ttu-id="a68ce-210">受到 hello hello 與相同的驗證認證叢集本身。</span><span class="sxs-lookup"><span data-stu-id="a68ce-210">It is protected by hello same authentication credentials as hello cluster itself.</span></span> |

## <a name="in-process-versus-out-of-process-trace-capturing"></a><span data-ttu-id="a68ce-211">同處理序與跨處理序追蹤擷取</span><span class="sxs-lookup"><span data-stu-id="a68ce-211">In-process versus out-of-process trace capturing</span></span>
<span data-ttu-id="a68ce-212">在 hello 的簡介，我們曾提及收集診斷資料的兩個基本的方式： 同處理序和跨處理序。</span><span class="sxs-lookup"><span data-stu-id="a68ce-212">In hello introduction, we mentioned two fundamental ways of collecting diagnostic data: in-process and out-of-process.</span></span> <span data-ttu-id="a68ce-213">各有優缺點。</span><span class="sxs-lookup"><span data-stu-id="a68ce-213">Each has strengths and weaknesses.</span></span>

<span data-ttu-id="a68ce-214">Hello 的優點**同處理序追蹤擷取**包括：</span><span class="sxs-lookup"><span data-stu-id="a68ce-214">Advantages of hello **in-process trace capturing** include:</span></span>

1. <span data-ttu-id="a68ce-215">*輕鬆設定及部署*</span><span class="sxs-lookup"><span data-stu-id="a68ce-215">*Easy configuration and deployment*</span></span>
   
   * <span data-ttu-id="a68ce-216">診斷資料收集的 hello 組態只是 hello 應用程式組態的一部分。</span><span class="sxs-lookup"><span data-stu-id="a68ce-216">hello configuration of diagnostic data collection is just part of hello application configuration.</span></span> <span data-ttu-id="a68ce-217">它是簡單 tooalways 保持其 「 同步 」 以 hello 其餘部分的 hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="a68ce-217">It is easy tooalways keep it "in sync" with hello rest of hello application.</span></span>
   * <span data-ttu-id="a68ce-218">輕鬆就可達成個別應用程式或個別服務的組態。</span><span class="sxs-lookup"><span data-stu-id="a68ce-218">Per-application or per-service configuration is easily achievable.</span></span>
   * <span data-ttu-id="a68ce-219">跨處理序追蹤擷取通常需要不同的部署和 hello 診斷代理程式的設定，這是額外的管理工作和錯誤的潛在來源。</span><span class="sxs-lookup"><span data-stu-id="a68ce-219">Out-of-process trace capturing usually requires a separate deployment and configuration of hello diagnostic agent, which is an extra administrative task and a potential source of errors.</span></span> <span data-ttu-id="a68ce-220">hello 特定代理程式的技術通常可讓每個虛擬機器 （節點） 的 hello 代理程式只有一個執行個體。</span><span class="sxs-lookup"><span data-stu-id="a68ce-220">hello particular agent technology often allows only one instance of hello agent per virtual machine (node).</span></span> <span data-ttu-id="a68ce-221">這表示該組態的所有應用程式之間共用的 hello 診斷組態的 hello 集合，該節點上執行的服務。</span><span class="sxs-lookup"><span data-stu-id="a68ce-221">This means that configuration for hello collection of hello diagnostic configuration is shared among all applications and services running on that node.</span></span>
2. <span data-ttu-id="a68ce-222">*彈性*</span><span class="sxs-lookup"><span data-stu-id="a68ce-222">*Flexibility*</span></span>
   
   * <span data-ttu-id="a68ce-223">hello 應用程式可以傳送 hello 資料每當需要 toogo，只要用戶端程式庫支援 hello 目標資料儲存系統。</span><span class="sxs-lookup"><span data-stu-id="a68ce-223">hello application can send hello data wherever it needs toogo, as long as there is a client library that supports hello targeted data storage system.</span></span> <span data-ttu-id="a68ce-224">可以依需要加入新的來源。</span><span class="sxs-lookup"><span data-stu-id="a68ce-224">New sinks can be added as desired.</span></span>
   * <span data-ttu-id="a68ce-225">可以實作複雜的擷取、篩選和資料彙總規則。</span><span class="sxs-lookup"><span data-stu-id="a68ce-225">Complex capture, filtering, and data-aggregation rules can be implemented.</span></span>
   * <span data-ttu-id="a68ce-226">跨處理序追蹤擷取通常受限於 hello 代理程式支援的 hello 資料接收器。</span><span class="sxs-lookup"><span data-stu-id="a68ce-226">An out-of-process trace capturing is often limited by hello data sinks that hello agent supports.</span></span> <span data-ttu-id="a68ce-227">有些代理程式是可擴充的。</span><span class="sxs-lookup"><span data-stu-id="a68ce-227">Some agents are extensible.</span></span>
3. <span data-ttu-id="a68ce-228">*存取 toointernal 應用程式資料和內容*</span><span class="sxs-lookup"><span data-stu-id="a68ce-228">*Access toointernal application data and context*</span></span>
   
   * <span data-ttu-id="a68ce-229">hello hello 應用程式/服務處理序內執行的診斷子系統可以輕鬆地擴大 hello 與內容資訊的追蹤。</span><span class="sxs-lookup"><span data-stu-id="a68ce-229">hello diagnostic subsystem running inside hello application/service process can easily augment hello traces with contextual information.</span></span>
   * <span data-ttu-id="a68ce-230">在 hello 跨處理序的方法，hello 資料必須傳送 tooan 代理程式，透過某種處理序間通訊機制，例如 Windows 事件追蹤。</span><span class="sxs-lookup"><span data-stu-id="a68ce-230">In hello out-of-process approach, hello data must be sent tooan agent via some inter-process communication mechanism, such as Event Tracing for Windows.</span></span> <span data-ttu-id="a68ce-231">此機制可能會造成額外的限制。</span><span class="sxs-lookup"><span data-stu-id="a68ce-231">This mechanism could impose additional limitations.</span></span>

<span data-ttu-id="a68ce-232">Hello 的優點**跨處理序追蹤擷取**包括：</span><span class="sxs-lookup"><span data-stu-id="a68ce-232">Advantages of hello **out-of-process trace capturing** include:</span></span>

1. <span data-ttu-id="a68ce-233">*hello 能力 toomonitor hello 應用程式並收集損毀傾印*</span><span class="sxs-lookup"><span data-stu-id="a68ce-233">*hello ability toomonitor hello application and collect crash dumps*</span></span>
   
   * <span data-ttu-id="a68ce-234">同處理序追蹤擷取可能會失敗，如果失敗 toostart hello 應用程式，或當機。</span><span class="sxs-lookup"><span data-stu-id="a68ce-234">In-process trace capturing may be unsuccessful if hello application fails toostart or crashes.</span></span> <span data-ttu-id="a68ce-235">獨立代理程式有更好的機會可擷取重要的疑難排解資訊。</span><span class="sxs-lookup"><span data-stu-id="a68ce-235">An independent agent has a much better chance of capturing crucial troubleshooting information.</span></span><br /><br />
2. <span data-ttu-id="a68ce-236">*成熟度、穩健性和已證實的效能*</span><span class="sxs-lookup"><span data-stu-id="a68ce-236">*Maturity, robustness, and proven performance*</span></span>
   
   * <span data-ttu-id="a68ce-237">平台供應商 （例如 Microsoft Azure 診斷代理程式） 所開發的代理程式已主旨 toorigorous 測試和戰鬥強化。</span><span class="sxs-lookup"><span data-stu-id="a68ce-237">An agent developed by a platform vendor (such as a Microsoft Azure Diagnostics agent) has been subject toorigorous testing and battle-hardening.</span></span>
   * <span data-ttu-id="a68ce-238">使用同處理序擷取的追蹤，必須小心 tooensure hello 活動的應用程式處理序從傳送診斷資料不會不干擾 hello 應用程式的主要工作或引入計時或效能問題。</span><span class="sxs-lookup"><span data-stu-id="a68ce-238">With in-process trace capturing, care must be taken tooensure that hello activity of sending diagnostic data from an application process does not interfere with hello application's main tasks or introduce timing or performance problems.</span></span> <span data-ttu-id="a68ce-239">獨立執行的代理程式是較不容易出錯的 toothese 問題，特別設計的 toolimit 它 hello 系統上的影響。</span><span class="sxs-lookup"><span data-stu-id="a68ce-239">An independently running agent is less prone toothese issues and is specifically designed toolimit its impact on hello system.</span></span>

<span data-ttu-id="a68ce-240">它也可能 toocombine 這兩種方法而獲益。</span><span class="sxs-lookup"><span data-stu-id="a68ce-240">It is possible toocombine and benefit from both approaches.</span></span> <span data-ttu-id="a68ce-241">事實上，它可能 hello 對於許多應用程式的最佳解決方案。</span><span class="sxs-lookup"><span data-stu-id="a68ce-241">Indeed, it might be hello best solution for many applications.</span></span>

<span data-ttu-id="a68ce-242">在此，我們使用 hello **Microsoft.Diagnostic.Listeners 文件庫**和 hello 同處理序追蹤擷取 toosend 從 Service Fabric 應用程式 tooan Elasticsearch 叢集中的資料。</span><span class="sxs-lookup"><span data-stu-id="a68ce-242">Here, we use hello **Microsoft.Diagnostic.Listeners library** and hello in-process trace capturing toosend data from a Service Fabric application tooan Elasticsearch cluster.</span></span>

## <a name="use-hello-listeners-library-toosend-diagnostic-data-tooelasticsearch"></a><span data-ttu-id="a68ce-243">使用 hello 接聽程式文件庫 toosend 診斷資料 tooElasticsearch</span><span class="sxs-lookup"><span data-stu-id="a68ce-243">Use hello Listeners library toosend diagnostic data tooElasticsearch</span></span>
<span data-ttu-id="a68ce-244">hello Microsoft.Diagnostic.Listeners 程式庫是 PartyCluster 範例 Service Fabric 應用程式的一部分。</span><span class="sxs-lookup"><span data-stu-id="a68ce-244">hello Microsoft.Diagnostic.Listeners library is part of PartyCluster sample Service Fabric application.</span></span> <span data-ttu-id="a68ce-245">toouse 它：</span><span class="sxs-lookup"><span data-stu-id="a68ce-245">toouse it:</span></span>

1. <span data-ttu-id="a68ce-246">下載[hello PartyCluster 範例](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster)從 GitHub。</span><span class="sxs-lookup"><span data-stu-id="a68ce-246">Download [hello PartyCluster sample](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) from GitHub.</span></span>
2. <span data-ttu-id="a68ce-247">Hello Microsoft.Diagnostics.Listeners 和 Microsoft.Diagnostics.Listeners.Fabric 專案 （整個資料夾） 從 hello PartyCluster 範例目錄 toohello 方案資料夾複製了應該 toosend hello 資料 tooElasticsearch hello 應用程式.</span><span class="sxs-lookup"><span data-stu-id="a68ce-247">Copy hello Microsoft.Diagnostics.Listeners and Microsoft.Diagnostics.Listeners.Fabric projects (whole folders) from hello PartyCluster sample directory toohello solution folder of hello application that is supposed toosend hello data tooElasticsearch.</span></span>
3. <span data-ttu-id="a68ce-248">開啟 hello 目標方案，以滑鼠右鍵按一下 hello 方案總管] 中的 hello 方案節點，然後選擇 [**加入現有專案**。</span><span class="sxs-lookup"><span data-stu-id="a68ce-248">Open hello target solution, right-click hello solution node in hello Solution Explorer, and choose **Add Existing Project**.</span></span> <span data-ttu-id="a68ce-249">新增 hello Microsoft.Diagnostics.Listeners 專案 toohello 方案。</span><span class="sxs-lookup"><span data-stu-id="a68ce-249">Add hello Microsoft.Diagnostics.Listeners project toohello solution.</span></span> <span data-ttu-id="a68ce-250">重複 hello 相同 hello Microsoft.Diagnostics.Listeners.Fabric 專案。</span><span class="sxs-lookup"><span data-stu-id="a68ce-250">Repeat hello same for hello Microsoft.Diagnostics.Listeners.Fabric project.</span></span>
4. <span data-ttu-id="a68ce-251">將專案參考加入您的服務專案 toohello 兩個已加入專案。</span><span class="sxs-lookup"><span data-stu-id="a68ce-251">Add a project reference from your service project(s) toohello two added projects.</span></span> <span data-ttu-id="a68ce-252">（應該 toosend 資料 tooElasticsearch 每個服務應參考 Microsoft.Diagnostics.EventListeners 和 Microsoft.Diagnostics.EventListeners.Fabric。）</span><span class="sxs-lookup"><span data-stu-id="a68ce-252">(Each service that is supposed toosend data tooElasticsearch should reference Microsoft.Diagnostics.EventListeners and Microsoft.Diagnostics.EventListeners.Fabric).</span></span>
   
    ![專案參考 tooMicrosoft.Diagnostics.EventListeners 和 Microsoft.Diagnostics.EventListeners.Fabric 文件庫][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a><span data-ttu-id="a68ce-254">Service Fabric 公開上市版本和 Microsoft.Diagnostics.Tracing Nuget 封裝</span><span class="sxs-lookup"><span data-stu-id="a68ce-254">Service Fabric General Availability release and Microsoft.Diagnostics.Tracing Nuget package</span></span>
<span data-ttu-id="a68ce-255">以 Service Fabric 公開上市版本 (2.0.135，2016 年 3 月 31 日發行) 建置的應用程式會以 **.NET Framework 4.5.2**為目標。</span><span class="sxs-lookup"><span data-stu-id="a68ce-255">Applications built with Service Fabric General Availability release (2.0.135, released March 31, 2016) target **.NET Framework 4.5.2**.</span></span> <span data-ttu-id="a68ce-256">這個版本是 hello hello Azure 支援在 hello 階段 hello GA 版本的.NET Framework 最高版本。</span><span class="sxs-lookup"><span data-stu-id="a68ce-256">This version is hello highest version of hello .NET Framework supported by Azure at hello time of hello GA release.</span></span> <span data-ttu-id="a68ce-257">不幸的是，這個版本的 hello framework 缺少某些 EventListener Api 該 hello Microsoft.Diagnostics.Listeners 需要程式庫。</span><span class="sxs-lookup"><span data-stu-id="a68ce-257">Unfortunately, this version of hello framework lacks certain EventListener APIs that hello Microsoft.Diagnostics.Listeners library needs.</span></span> <span data-ttu-id="a68ce-258">EventSource （form hello 基礎網狀架構應用程式中的記錄 Api hello 元件） 和 EventListener 會緊密結合的因為每個使用 hello Microsoft.Diagnostics.Listeners 程式庫的專案必須使用替代的實作EventSource。</span><span class="sxs-lookup"><span data-stu-id="a68ce-258">Because EventSource (hello component that forms hello basis of logging APIs in Fabric applications) and EventListener are tightly coupled, every project that uses hello Microsoft.Diagnostics.Listeners library must use an alternative implementation of EventSource.</span></span> <span data-ttu-id="a68ce-259">這個實作由 hello **Microsoft.Diagnostics.Tracing Nuget 封裝**、 由 Microsoft 所撰寫。</span><span class="sxs-lookup"><span data-stu-id="a68ce-259">This implementation is provided by hello **Microsoft.Diagnostics.Tracing Nuget package**, authored by Microsoft.</span></span> <span data-ttu-id="a68ce-260">hello 封裝是包含在 hello 架構，所以變更任何程式碼不不需要參考命名空間變更以外的 EventSource 完全與舊版相容。</span><span class="sxs-lookup"><span data-stu-id="a68ce-260">hello package is fully backward-compatible with EventSource included in hello framework, so no code changes should be necessary other than referenced namespace changes.</span></span>

<span data-ttu-id="a68ce-261">toostart 使用 hello Microsoft.Diagnostics.Tracing 實作 hello EventSource 類別，請遵循下列步驟，針對每個需要 toosend 資料 tooElasticsearch 的服務專案：</span><span class="sxs-lookup"><span data-stu-id="a68ce-261">toostart using hello Microsoft.Diagnostics.Tracing implementation of hello EventSource class, follow these steps for each service project that needs toosend data tooElasticsearch:</span></span>

1. <span data-ttu-id="a68ce-262">Hello 服務專案上按一下滑鼠右鍵，然後選擇 **管理 Nuget 封裝**。</span><span class="sxs-lookup"><span data-stu-id="a68ce-262">Right-click on hello service project and choose **Manage Nuget Packages**.</span></span>
2. <span data-ttu-id="a68ce-263">切換 toohello nuget.org 封裝來源 （如果尚未選取），並搜尋"**Microsoft.Diagnostics.Tracing**"。</span><span class="sxs-lookup"><span data-stu-id="a68ce-263">Switch toohello nuget.org package source (if it is not already selected) and search for "**Microsoft.Diagnostics.Tracing**".</span></span>
3. <span data-ttu-id="a68ce-264">安裝 hello`Microsoft.Diagnostics.Tracing.EventSource`封裝 （和其相依性）。</span><span class="sxs-lookup"><span data-stu-id="a68ce-264">Install hello `Microsoft.Diagnostics.Tracing.EventSource` package (and its dependencies).</span></span>
4. <span data-ttu-id="a68ce-265">開啟 hello **ServiceEventSource.cs**或**ActorEventSource.cs**服務專案中的檔案，並將 hello`using System.Diagnostics.Tracing`指示詞在 hello 與 hello 檔案頂端`using Microsoft.Diagnostics.Tracing`指示詞。</span><span class="sxs-lookup"><span data-stu-id="a68ce-265">Open hello **ServiceEventSource.cs** or **ActorEventSource.cs** file in your service project and replace hello `using System.Diagnostics.Tracing` directive on top of hello file with hello `using Microsoft.Diagnostics.Tracing` directive.</span></span>

<span data-ttu-id="a68ce-266">這些步驟不是必要的一次 hello **.NET Framework 4.6** Microsoft Azure 支援。</span><span class="sxs-lookup"><span data-stu-id="a68ce-266">These steps will not be necessary once hello **.NET Framework 4.6** is supported by Microsoft Azure.</span></span>

### <a name="elasticsearch-listener-instantiation-and-configuration"></a><span data-ttu-id="a68ce-267">Elasticsearch 接聽程式具現化和組態</span><span class="sxs-lookup"><span data-stu-id="a68ce-267">Elasticsearch listener instantiation and configuration</span></span>
<span data-ttu-id="a68ce-268">hello 傳送診斷資料 tooElasticsearch 的最後一個步驟是 toocreate 的執行個體`ElasticSearchListener`並設定 Elasticsearch 連線資料。</span><span class="sxs-lookup"><span data-stu-id="a68ce-268">hello final step for sending diagnostic data tooElasticsearch is toocreate an instance of `ElasticSearchListener` and configure it with Elasticsearch connection data.</span></span> <span data-ttu-id="a68ce-269">hello 接聽程式會自動擷取所有透過 hello 服務專案中定義的 EventSource 類別所引發的事件。</span><span class="sxs-lookup"><span data-stu-id="a68ce-269">hello listener automatically captures all events raised via EventSource classes defined in hello service project.</span></span> <span data-ttu-id="a68ce-270">它需要 toobe hello hello 服務存留期間保持運作以便 hello 最佳放置的 toocreate 處於 hello 服務初始化程式碼。</span><span class="sxs-lookup"><span data-stu-id="a68ce-270">It needs toobe alive during hello lifetime of hello service, so hello best place toocreate it is in hello service initialization code.</span></span> <span data-ttu-id="a68ce-271">以下是無狀態服務的 hello 初始化程式碼無法樣子 hello 必要變更後 (新增項目開頭的註解中指出`****`):</span><span class="sxs-lookup"><span data-stu-id="a68ce-271">Here is how hello initialization code for a stateless service could look after hello necessary changes (additions pointed out in comments starting with `****`):</span></span>

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add hello following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is hello entry point of hello service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider, new FabricHealthReporter("ElasticSearchEventListener"));
                }

                // hello ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name tooa .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of hello class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that hello ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

<span data-ttu-id="a68ce-272">Elasticsearch 連線資料都應該放在不同的區段 hello 服務組態檔中 (**PackageRoot\Config\Settings.xml**)。</span><span class="sxs-lookup"><span data-stu-id="a68ce-272">Elasticsearch connection data should be put in a separate section in hello service configuration file (**PackageRoot\Config\Settings.xml**).</span></span> <span data-ttu-id="a68ce-273">hello hello 區段名稱必須對應傳遞 toohello toohello 值`FabricConfigurationProvider`建構函式，例如：</span><span class="sxs-lookup"><span data-stu-id="a68ce-273">hello name of hello section must correspond toohello value passed toohello `FabricConfigurationProvider` constructor, for example:</span></span>

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
<span data-ttu-id="a68ce-274">hello 值`serviceUri`，`userName`和`password`參數 toohello Elasticsearch 叢集端點位址、 Elasticsearch 使用者名稱和密碼，分別對應。</span><span class="sxs-lookup"><span data-stu-id="a68ce-274">hello values of `serviceUri`, `userName` and `password` parameters correspond toohello Elasticsearch cluster endpoint address, Elasticsearch user name, and password, respectively.</span></span> <span data-ttu-id="a68ce-275">`indexNamePrefix`是 hello Elasticsearch 索引; 前置詞hello Microsoft.Diagnostics.Listeners 程式庫會每天建立新的索引，其資料。</span><span class="sxs-lookup"><span data-stu-id="a68ce-275">`indexNamePrefix` is hello prefix for Elasticsearch indexes; hello Microsoft.Diagnostics.Listeners library creates a new index for its data daily.</span></span>

### <a name="verification"></a><span data-ttu-id="a68ce-276">驗證</span><span class="sxs-lookup"><span data-stu-id="a68ce-276">Verification</span></span>
<span data-ttu-id="a68ce-277">就這麼簡單！</span><span class="sxs-lookup"><span data-stu-id="a68ce-277">That's it!</span></span> <span data-ttu-id="a68ce-278">現在，每次執行 hello 服務時，它會開始傳送嗨組態中指定的追蹤 toohello Elasticsearch 服務。</span><span class="sxs-lookup"><span data-stu-id="a68ce-278">Now, whenever hello service is run, it starts sending traces toohello Elasticsearch service specified in hello configuration.</span></span> <span data-ttu-id="a68ce-279">您可以驗證，請開啟 hello Kibana UI hello 目標 Elasticsearch 執行個體相關聯。</span><span class="sxs-lookup"><span data-stu-id="a68ce-279">You can verify this by opening hello Kibana UI associated with hello target Elasticsearch instance.</span></span> <span data-ttu-id="a68ce-280">在本例中，hello 網址是 http://myBigCluster.westus.cloudapp.azure.com/。</span><span class="sxs-lookup"><span data-stu-id="a68ce-280">In our example, hello page address is http://myBigCluster.westus.cloudapp.azure.com/.</span></span> <span data-ttu-id="a68ce-281">選擇 hello 名稱前置詞索引的核取`ElasticSearchListener`確實已建立並填入資料執行個體。</span><span class="sxs-lookup"><span data-stu-id="a68ce-281">Check that indexes with hello name prefix chosen for hello `ElasticSearchListener` instance have indeed been created and populated with data.</span></span>

![顯示 PartyCluster 應用程式事件的 Kibana][2]

## <a name="next-steps"></a><span data-ttu-id="a68ce-283">後續步驟</span><span class="sxs-lookup"><span data-stu-id="a68ce-283">Next steps</span></span>
* [<span data-ttu-id="a68ce-284">深入了解診斷和監視 Service Fabric 服務</span><span class="sxs-lookup"><span data-stu-id="a68ce-284">Learn more about diagnosing and monitoring a Service Fabric service</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png
