---
title: "Microsoft Azure Service Fabric 的相關常見問題 | Microsoft Docs"
description: "和 Service Fabric 有關的常見問題集和解答"
services: service-fabric
documentationcenter: .net
author: chackdan
manager: timlt
editor: 
ms.assetid: 5a179703-ff0c-4b8e-98cd-377253295d12
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/18/2017
ms.author: chackdan
ms.openlocfilehash: ee1fe4e83ce796fd50b779c0880701b9dfcefff7
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/18/2017
---
# <a name="commonly-asked-service-fabric-questions"></a><span data-ttu-id="7d30c-103">Service Fabric 的常見問題</span><span class="sxs-lookup"><span data-stu-id="7d30c-103">Commonly asked Service Fabric questions</span></span>

<span data-ttu-id="7d30c-104">和 Service Fabric 的功能及使用方式有關的常見問題很多。</span><span class="sxs-lookup"><span data-stu-id="7d30c-104">There are many commonly asked questions about what Service Fabric can do and how it should be used.</span></span> <span data-ttu-id="7d30c-105">本文件涵蓋許多這類問題和解答。</span><span class="sxs-lookup"><span data-stu-id="7d30c-105">This document covers many of those common questions and their answers.</span></span>

## <a name="cluster-setup-and-management"></a><span data-ttu-id="7d30c-106">叢集設定和管理</span><span class="sxs-lookup"><span data-stu-id="7d30c-106">Cluster setup and management</span></span>

### <a name="can-i-create-a-cluster-that-spans-multiple-azure-regions-or-my-own-datacenters"></a><span data-ttu-id="7d30c-107">我能否建立跨多個 Azure 區域或自有資料中心的叢集？</span><span class="sxs-lookup"><span data-stu-id="7d30c-107">Can I create a cluster that spans multiple Azure regions or my own datacenters?</span></span>

<span data-ttu-id="7d30c-108">是。</span><span class="sxs-lookup"><span data-stu-id="7d30c-108">Yes.</span></span> 

<span data-ttu-id="7d30c-109">核心的 Service Fabric 叢集技術可用來結合在世界各地執行的機器，只要它們彼此間有網路連線即可。</span><span class="sxs-lookup"><span data-stu-id="7d30c-109">The core Service Fabric clustering technology can be used to combine machines running anywhere in the world, so long as they have network connectivity to each other.</span></span> <span data-ttu-id="7d30c-110">不過，建置和執行這類叢集的程序很複雜。</span><span class="sxs-lookup"><span data-stu-id="7d30c-110">However, building and running such a cluster can be complicated.</span></span>

<span data-ttu-id="7d30c-111">如果您對於這個案例有興趣，建議您透過 [Service Fabric Github 問題清單](https://github.com/azure/service-fabric-issues)或透過您的支援代表來進行聯繫，以取得其他指引。</span><span class="sxs-lookup"><span data-stu-id="7d30c-111">If you are interested in this scenario, we encourage you to get in contact either through the [Service Fabric Github Issues List](https://github.com/azure/service-fabric-issues) or through your support representative in order to obtain additional guidance.</span></span> <span data-ttu-id="7d30c-112">Service Fabric 小組正在針對這個案例著手提供其他清楚說明、指引和建議。</span><span class="sxs-lookup"><span data-stu-id="7d30c-112">The Service Fabric team is working to provide additional clarity, guidance, and recommendations for this scenario.</span></span> 

<span data-ttu-id="7d30c-113">需考量的事項：</span><span class="sxs-lookup"><span data-stu-id="7d30c-113">Some things to consider:</span></span> 

1. <span data-ttu-id="7d30c-114">目前在 Azure 中的 Service Fabric 叢集資源是地區性的，據以建置叢集的虛擬機器擴展集也是。</span><span class="sxs-lookup"><span data-stu-id="7d30c-114">The Service Fabric cluster resource in Azure is regional today, as are the virtual machine scale sets that the cluster is built on.</span></span> <span data-ttu-id="7d30c-115">這表示在發生區域失敗時，您可能就無法透過 Azure Resource Manager 或 Azure 入口網站來管理叢集。</span><span class="sxs-lookup"><span data-stu-id="7d30c-115">This means that in the event of a regional failure you may lose the ability to manage the cluster via the Azure Resource Manager or the Azure Portal.</span></span> <span data-ttu-id="7d30c-116">即使叢集仍在執行，而且您可以直接與其進行互動，還是可能發生此情況。</span><span class="sxs-lookup"><span data-stu-id="7d30c-116">This can happen even though the cluster remains running and you'd be able to interact with it directly.</span></span> <span data-ttu-id="7d30c-117">此外，Azure 目前並無法讓您擁有可跨區域使用的單一虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="7d30c-117">In addition, Azure today does not offer the ability to have a single virtual network that is usable across regions.</span></span> <span data-ttu-id="7d30c-118">這表示如果您想在 Azure 中擁有多區域叢集，就需要 [VM 擴展集中每個 VM 的公用 IP 位址](../virtual-machine-scale-sets/virtual-machine-scale-sets-networking.md#public-ipv4-per-virtual-machine)或 [Azure VPN 閘道](../vpn-gateway/vpn-gateway-about-vpngateways.md)。</span><span class="sxs-lookup"><span data-stu-id="7d30c-118">This means that a multi-region cluster in Azure requires either [Public IP Addresses for each VM in the VM Scale Sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-networking.md#public-ipv4-per-virtual-machine) or [Azure VPN Gateways](../vpn-gateway/vpn-gateway-about-vpngateways.md).</span></span> <span data-ttu-id="7d30c-119">這些網路選擇對於成本、效能以及某種程度的應用程式設計會有不同的影響，因此請先謹慎地分析和規劃，再建立這樣的環境。</span><span class="sxs-lookup"><span data-stu-id="7d30c-119">These networking choices have different impacts on costs, performance, and to some degree application design, so careful analysis and planning is required before standing up such an environment.</span></span>
2. <span data-ttu-id="7d30c-120">維護、管理和監視這些機器的程序可能會變得複雜，特別是在跨_數種類型_的環境時，例如在不同雲端提供者之間或在內部部署資源和 Azure 之間。</span><span class="sxs-lookup"><span data-stu-id="7d30c-120">The maintenance, management, and monitoring of these machines can become complicated, especially when spanned across _types_ of environments, such as between different cloud providers or between on-premises resources and Azure.</span></span> <span data-ttu-id="7d30c-121">請務必謹慎，確保您已了解叢集和應用程式的升級、監視、管理和診斷方式，再於這類環境中執行生產工作負載。</span><span class="sxs-lookup"><span data-stu-id="7d30c-121">Care must be taken to ensure that upgrades, monitoring, management, and diagnostics are understood for both the cluster and the applications before running production workloads in such an environment.</span></span> <span data-ttu-id="7d30c-122">如果您對於在 Azure 或您自己的資料中心內解決這些問題已有豐富經驗，則在建置或執行 Service Fabric 叢集時或許也可以套用同樣的一套解決方案。</span><span class="sxs-lookup"><span data-stu-id="7d30c-122">If you already have lots of experience solving these problems in Azure or within your own datacenters, then it is likely that those same solutions can be applied when building out or running your Service Fabric cluster.</span></span> 

### <a name="do-service-fabric-nodes-automatically-receive-os-updates"></a><span data-ttu-id="7d30c-123">Service Fabric 節點是否會自動接收作業系統更新？</span><span class="sxs-lookup"><span data-stu-id="7d30c-123">Do Service Fabric nodes automatically receive OS updates?</span></span>

<span data-ttu-id="7d30c-124">目前不行，但這是常見的要求，Azure 有打算提供這項功能。</span><span class="sxs-lookup"><span data-stu-id="7d30c-124">Not today, but this is also a common request that Azure intends to deliver.</span></span>

<span data-ttu-id="7d30c-125">在過渡期間，我們[提供了一個應用程式](service-fabric-patch-orchestration-application.md)，您的 Service Fabric 節點下的作業系統會持續修補並保持最新狀態。</span><span class="sxs-lookup"><span data-stu-id="7d30c-125">In the interim, we have [provided an application](service-fabric-patch-orchestration-application.md) that the operating systems underneath your Service Fabric nodes stay patched and up to date.</span></span>

<span data-ttu-id="7d30c-126">作業系統更新的挑戰是它們通常需要重新啟動機器，這會造成暫時失去可用性。</span><span class="sxs-lookup"><span data-stu-id="7d30c-126">The challenge with OS updates is that they typically require a reboot of the machine, which results in temporary availability loss.</span></span> <span data-ttu-id="7d30c-127">就其本身來說並不是問題，因為 Service Fabric 會自動將那些服務的流量重新導向至其他節點。</span><span class="sxs-lookup"><span data-stu-id="7d30c-127">By itself, that is not a problem, since Service Fabric will automatically redirect traffic for those services to other nodes.</span></span> <span data-ttu-id="7d30c-128">不過，如果作業系統更新不會跨叢集協調，則有可能讓多個節點同時停機。</span><span class="sxs-lookup"><span data-stu-id="7d30c-128">However, if OS updates are not coordinated across the cluster, there is the potential that many nodes go down at once.</span></span> <span data-ttu-id="7d30c-129">這類同時重新啟動會造成服務，或至少造成某個特定分割 (如果為具狀態服務) 完全失去可用性。</span><span class="sxs-lookup"><span data-stu-id="7d30c-129">Such simultaneous reboots can cause complete availability loss for a service, or at least for a specific partition (for a stateful service).</span></span>

<span data-ttu-id="7d30c-130">未來，我們計劃支援在所有更新網域中完全自動化且協調化的作業系統更新原則，確保在發生重新開機或其他非預期失敗的情況下，都能夠維持可用性。</span><span class="sxs-lookup"><span data-stu-id="7d30c-130">In the future, we plan to support an OS update policy that is fully automated and coordinated across update domains, ensuring that availability is maintained despite reboots and other unexpected failures.</span></span>

### <a name="can-i-use-large-virtual-machine-scale-sets-in-my-sf-cluster"></a><span data-ttu-id="7d30c-131">我可以在 SF 叢集中使用大型虛擬機器擴展集嗎？</span><span class="sxs-lookup"><span data-stu-id="7d30c-131">Can I use Large Virtual Machine Scale Sets in my SF cluster?</span></span> 

<span data-ttu-id="7d30c-132">**簡短回答** - 否。</span><span class="sxs-lookup"><span data-stu-id="7d30c-132">**Short answer** - No.</span></span> 

<span data-ttu-id="7d30c-133">**完整回答** - 雖然大型虛擬機器擴展集最多可讓您將虛擬機器擴展集調整到 1000 個 VM 執行個體，不過這是藉由使用放置群組 (PG) 來達成的。</span><span class="sxs-lookup"><span data-stu-id="7d30c-133">**Long Answer** - Although the Large Virtual Machine Scale Sets allow you to scale a virtual machine scale set upto 1000 VM instances, it does so by the use of Placement Groups (PGs).</span></span> <span data-ttu-id="7d30c-134">容錯網域 (FD) 和升級網域 (UD) 只會在使用 FD 和 UD 以決定服務複本/服務執行個體放置位置的放置群組 Service Fabric 內保持一致。</span><span class="sxs-lookup"><span data-stu-id="7d30c-134">Fault domains (FDs) and upgrade domains (UDs) are only consistent within a placement group Service fabric uses FDs and UDs to make placement decisions of your service replicas/Service instances.</span></span> <span data-ttu-id="7d30c-135">由於 FD 和 UD 只能在放置群組內比較，所以 SF 無法使用它。</span><span class="sxs-lookup"><span data-stu-id="7d30c-135">Since the FDs  and UDs are comparable only within a placement group SF cannot use it.</span></span> <span data-ttu-id="7d30c-136">例如，如果 PG1 中的 VM1 具有 FD=0 的拓撲，且 PG2 中的 VM9 具有 FD=4 的拓撲，此情況並不代表 VM1 和 VM2 位於兩個不同的硬體機架上，因此在此情況下，SF 無法使用 FD 值來決定放置位置。</span><span class="sxs-lookup"><span data-stu-id="7d30c-136">For example, If VM1 in PG1 has a topology of FD=0 and VM9 in PG2 has a topology of FD=4 , it does not mean that VM1 and VM2 are on two different Hardware Racks, hence SF cannot use the FD values in this case to make placement decisions.</span></span>

<span data-ttu-id="7d30c-137">大型虛擬機器擴展集目前有其他問題，像是缺乏層級 4 的負載平衡支援。</span><span class="sxs-lookup"><span data-stu-id="7d30c-137">There are other issues with Large virtual machine scale sets currently, like the lack of level-4 Load balancing support.</span></span> <span data-ttu-id="7d30c-138">如需詳細資訊，請參閱[大型擴展集詳細資料](../virtual-machine-scale-sets/virtual-machine-scale-sets-placement-groups.md)</span><span class="sxs-lookup"><span data-stu-id="7d30c-138">Refer to for [details on Large scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-placement-groups.md)</span></span>



### <a name="what-is-the-minimum-size-of-a-service-fabric-cluster-why-cant-it-be-smaller"></a><span data-ttu-id="7d30c-139">Service Fabric 叢集的大小下限為何？</span><span class="sxs-lookup"><span data-stu-id="7d30c-139">What is the minimum size of a Service Fabric cluster?</span></span> <span data-ttu-id="7d30c-140">為什麼無法更小？</span><span class="sxs-lookup"><span data-stu-id="7d30c-140">Why can't it be smaller?</span></span>

<span data-ttu-id="7d30c-141">執行生產工作負載的 Service Fabric 叢集所支援的大小下限為五個節點。</span><span class="sxs-lookup"><span data-stu-id="7d30c-141">The minimum supported size for a Service Fabric cluster running production workloads is five nodes.</span></span> <span data-ttu-id="7d30c-142">針對開發/測試案例，我們支援三個節點的叢集。</span><span class="sxs-lookup"><span data-stu-id="7d30c-142">For dev/test scenarios, we support three node clusters.</span></span>

<span data-ttu-id="7d30c-143">之所以會有這些最低限制，是因為 Service Fabric 叢集會執行一組可設定狀態的系統服務，包括命名服務及容錯移轉管理員。</span><span class="sxs-lookup"><span data-stu-id="7d30c-143">These minimums exist because the Service Fabric cluster runs a set of stateful system services, including the naming service and the failover manager.</span></span> <span data-ttu-id="7d30c-144">這些服務會根據強式一致性，追蹤哪些服務已經部署至叢集，以及它們目前的裝載位置。</span><span class="sxs-lookup"><span data-stu-id="7d30c-144">These services, which track what services have been deployed to the cluster and where they're currently hosted, depend on strong consistency.</span></span> <span data-ttu-id="7d30c-145">該強式一致性接著會根據取得「仲裁」的能力，提供任何指定的更新給那些服務的狀態，其中仲裁代表指定之服務的特定多數複本 (N/2 + 1)。</span><span class="sxs-lookup"><span data-stu-id="7d30c-145">That strong consistency, in turn, depends on the ability to acquire a *quorum* for any given update to the state of those services, where a quorum represents a strict majority of the replicas (N/2 +1) for a given service.</span></span>

<span data-ttu-id="7d30c-146">了解該背景後，讓我們來檢查一些可能的叢集組態：</span><span class="sxs-lookup"><span data-stu-id="7d30c-146">With that background, let's examine some possible cluster configurations:</span></span>

<span data-ttu-id="7d30c-147">**一個節點**：這個選項不提供高可用性，因為任何原因造成的單一節點遺失都會導致整個叢集遺失。</span><span class="sxs-lookup"><span data-stu-id="7d30c-147">**One node**: this option does not provide high availability since the loss of the single node for any reason means the loss of the entire cluster.</span></span>

<span data-ttu-id="7d30c-148">**兩個節點**︰跨兩個節點 (N = 2) 部署的服務，仲裁為 2 (2/2 + 1 = 2)。</span><span class="sxs-lookup"><span data-stu-id="7d30c-148">**Two nodes**: a quorum for a service deployed across two nodes (N = 2) is 2 (2/2 + 1 = 2).</span></span> <span data-ttu-id="7d30c-149">當單一複本遺失時，就無法建立仲裁。</span><span class="sxs-lookup"><span data-stu-id="7d30c-149">When a single replica is lost, it is impossible to create a quorum.</span></span> <span data-ttu-id="7d30c-150">由於執行服務升級時需要暫時關閉複本，因此這不是有用的組態。</span><span class="sxs-lookup"><span data-stu-id="7d30c-150">Since performing a service upgrade requires temporarily taking down a replica, this is not a useful configuration.</span></span>

<span data-ttu-id="7d30c-151">**三個節點**︰使用三個節點 (N=3)，建立仲裁的需求仍然是兩個節點 (3/2 + 1 = 2)。</span><span class="sxs-lookup"><span data-stu-id="7d30c-151">**Three nodes**: with three nodes (N=3), the requirement to create a quorum is still two nodes (3/2 + 1 = 2).</span></span> <span data-ttu-id="7d30c-152">這表示您可以遺失一個單一節點，並且仍維持仲裁。</span><span class="sxs-lookup"><span data-stu-id="7d30c-152">This means that you can lose an individual node and still maintain quorum.</span></span>

<span data-ttu-id="7d30c-153">開發/測試可支援三節點叢集組態，因為您可以安全地執行更新，而且只要那些節點不要同時發生失敗，就能在個別節點失敗時維持叢集。</span><span class="sxs-lookup"><span data-stu-id="7d30c-153">The three node cluster configuration is supported for dev/test because you can safely perform upgrades and survive individual node failures, as long as they don't happen simultaneously.</span></span> <span data-ttu-id="7d30c-154">針對生產工作負載，您必須能夠從這類同時失敗復原，因此必須有五個節點。</span><span class="sxs-lookup"><span data-stu-id="7d30c-154">For production workloads, you must be resilient to such a simultaneous failure, so five nodes are required.</span></span>

### <a name="can-i-turn-off-my-cluster-at-nightweekends-to-save-costs"></a><span data-ttu-id="7d30c-155">我能否在晚上/週末關閉叢集以節省成本？</span><span class="sxs-lookup"><span data-stu-id="7d30c-155">Can I turn off my cluster at night/weekends to save costs?</span></span>

<span data-ttu-id="7d30c-156">一般而言不行。</span><span class="sxs-lookup"><span data-stu-id="7d30c-156">In general, no.</span></span> <span data-ttu-id="7d30c-157">Service Fabric 會將狀態儲存在本機的暫時磁碟上，這表示如果虛擬機器移至不同的主機，資料將不會隨之移動。</span><span class="sxs-lookup"><span data-stu-id="7d30c-157">Service Fabric stores state on local, ephemeral disks, meaning that if the virtual machine is moved to a different host, the data does not move with it.</span></span> <span data-ttu-id="7d30c-158">在一般的作業中，因為新節點會透過其他節點保持在最新狀態，所以這不會是問題。</span><span class="sxs-lookup"><span data-stu-id="7d30c-158">In normal operation, that is not a problem as the new node is brought up to date by other nodes.</span></span> <span data-ttu-id="7d30c-159">不過，如果您停止所有節點並在稍後重新啟動它們，則很有可能讓大部分的節點在新的主機上啟動，而使系統無法復原。</span><span class="sxs-lookup"><span data-stu-id="7d30c-159">However, if you stop all nodes and restart them later, there is a significant possibility that most of the nodes start on new hosts and make the system unable to recover.</span></span>

<span data-ttu-id="7d30c-160">如果您要建立叢集以在部署應用程式之前測試應用程式，建議您在[持續整合/持續部署管線](service-fabric-set-up-continuous-integration.md)中動態建立那些叢集。</span><span class="sxs-lookup"><span data-stu-id="7d30c-160">If you would like to create clusters for testing your application before it is deployed, we recommend that you dynamically create those clusters as part of your [continuous integration/continuous deployment pipeline](service-fabric-set-up-continuous-integration.md).</span></span>


### <a name="how-do-i-upgrade-my-operating-system-for-example-from-windows-server-2012-to-windows-server-2016"></a><span data-ttu-id="7d30c-161">如何升級我的作業系統 (例如從 Windows Server 2012 升級到 Windows Server 2016)？</span><span class="sxs-lookup"><span data-stu-id="7d30c-161">How do I upgrade my Operating System (for example from Windows Server 2012 to Windows Server 2016)?</span></span>

<span data-ttu-id="7d30c-162">在我們努力改善體驗時，您的責任是升級。</span><span class="sxs-lookup"><span data-stu-id="7d30c-162">While we're working on an improved experience, today, you are responsible for the upgrade.</span></span> <span data-ttu-id="7d30c-163">您必須升級叢集的虛擬機器上的作業系統映像，一次一部 VM。</span><span class="sxs-lookup"><span data-stu-id="7d30c-163">You must upgrade the OS image on the virtual machines of the cluster one VM at a time.</span></span> 

## <a name="container-support"></a><span data-ttu-id="7d30c-164">容器支援</span><span class="sxs-lookup"><span data-stu-id="7d30c-164">Container Support</span></span>

### <a name="why-are-my-containers-that-are-deployed-to-sf-unable-to-resolve-dns-addresses"></a><span data-ttu-id="7d30c-165">為何部署到 SF 的容器無法解析 DNS 位址？</span><span class="sxs-lookup"><span data-stu-id="7d30c-165">Why are my containers that are deployed to SF unable to resolve DNS addresses?</span></span>

<span data-ttu-id="7d30c-166">已有人針對 5.6.204.9494 版的叢集回報這個問題</span><span class="sxs-lookup"><span data-stu-id="7d30c-166">This issue has been reported on clusters that are on 5.6.204.9494 version</span></span> 

<span data-ttu-id="7d30c-167">**緩和**︰請遵循[這份文件](service-fabric-dnsservice.md)，以便在叢集中啟用 DNS Service Fabric 服務。</span><span class="sxs-lookup"><span data-stu-id="7d30c-167">**Mitigation** :  Follow [this document](service-fabric-dnsservice.md) to enable the DNS service fabric service in your cluster.</span></span>

<span data-ttu-id="7d30c-168">**修正**：升級至 5.6.204.9494 以上的支援叢集版本 (當推出時)。</span><span class="sxs-lookup"><span data-stu-id="7d30c-168">**Fix** :  Upgrade to a supported cluster version that is higher than 5.6.204.9494, when it is available.</span></span> <span data-ttu-id="7d30c-169">如果您的叢集設定為自動升級，則叢集將會自動升級為已修正此問題的版本。</span><span class="sxs-lookup"><span data-stu-id="7d30c-169">If your cluster is set to automatic upgrades, then the cluster will automatically upgrade to the version that has this issue fixed.</span></span>

  
## <a name="application-design"></a><span data-ttu-id="7d30c-170">應用程式設計</span><span class="sxs-lookup"><span data-stu-id="7d30c-170">Application Design</span></span>

### <a name="whats-the-best-way-to-query-data-across-partitions-of-a-reliable-collection"></a><span data-ttu-id="7d30c-171">在可靠集合的所有分割中查詢資料的最佳方式為何？</span><span class="sxs-lookup"><span data-stu-id="7d30c-171">What's the best way to query data across partitions of a Reliable Collection?</span></span>

<span data-ttu-id="7d30c-172">可靠的集合通常[經過分割](service-fabric-concepts-partitioning.md)以使用相應放大來提供更好的效能及輸送量。</span><span class="sxs-lookup"><span data-stu-id="7d30c-172">Reliable collections are typically [partitioned](service-fabric-concepts-partitioning.md) to enable scale out for greater performance and throughput.</span></span> <span data-ttu-id="7d30c-173">這表示指定服務的狀態可能跨越 10 部或 100 部機器。</span><span class="sxs-lookup"><span data-stu-id="7d30c-173">That means that the state for a given service may be spread across 10s or 100s of machines.</span></span> <span data-ttu-id="7d30c-174">若要在完整的資料集上執行作業，您有幾個選項：</span><span class="sxs-lookup"><span data-stu-id="7d30c-174">To perform operations over that full data set, you have a few options:</span></span>

- <span data-ttu-id="7d30c-175">建立會查詢另一個服務所有分割的服務，以提取所需資料。</span><span class="sxs-lookup"><span data-stu-id="7d30c-175">Create a service that queries all partitions of another service to pull in the required data.</span></span>
- <span data-ttu-id="7d30c-176">建立可接收來自另一個服務所有分割之資料的服務。</span><span class="sxs-lookup"><span data-stu-id="7d30c-176">Create a service that can receive data from all partitions of another service.</span></span>
- <span data-ttu-id="7d30c-177">定期從每個服務將資料推送至外部存放區。</span><span class="sxs-lookup"><span data-stu-id="7d30c-177">Periodically push data from each service to an external store.</span></span> <span data-ttu-id="7d30c-178">只有在您要執行的查詢不是核心商業邏輯的一部分時，才適用此方法。</span><span class="sxs-lookup"><span data-stu-id="7d30c-178">This approach is only appropriate if the queries you're performing are not part of your core business logic.</span></span>


### <a name="whats-the-best-way-to-query-data-across-my-actors"></a><span data-ttu-id="7d30c-179">在所有動作項目查詢資料的最佳方式為何？</span><span class="sxs-lookup"><span data-stu-id="7d30c-179">What's the best way to query data across my actors?</span></span>

<span data-ttu-id="7d30c-180">動作項目是設計為獨立的狀態與計算單位，因此不建議在執行階段執行動作項目狀態的各種查詢。</span><span class="sxs-lookup"><span data-stu-id="7d30c-180">Actors are designed to be independent units of state and compute, so it is not recommended to perform broad queries of actor state at runtime.</span></span> <span data-ttu-id="7d30c-181">如果您有必要查詢完整的動作項目狀態集合，您也應該考慮：</span><span class="sxs-lookup"><span data-stu-id="7d30c-181">If you have a need to query across the full set of actor state, you should consider either:</span></span>

- <span data-ttu-id="7d30c-182">以可設定狀態的可靠服務取代動作項目服務，例如收集從動作項目數目到服務中分割數目之所有資料的網路要求的數目。</span><span class="sxs-lookup"><span data-stu-id="7d30c-182">Replacing your actor services with stateful reliable services, such that the number of network requests to gather all data from the number of actors to the number of partitions in your service.</span></span>
- <span data-ttu-id="7d30c-183">設計您的動作項目，定期將其狀態推送至外部存放區以便能夠更容易地查詢。</span><span class="sxs-lookup"><span data-stu-id="7d30c-183">Designing your actors to periodically push their state to an external store for easier querying.</span></span> <span data-ttu-id="7d30c-184">如上所述，只有在您執行的查詢並非執行階段行為的必要項目時，才適用此方法。</span><span class="sxs-lookup"><span data-stu-id="7d30c-184">As above, this approach is only viable if the queries you're performing are not required for your runtime behavior.</span></span>

### <a name="how-much-data-can-i-store-in-a-reliable-collection"></a><span data-ttu-id="7d30c-185">可靠的集合中能夠儲存多少資料？</span><span class="sxs-lookup"><span data-stu-id="7d30c-185">How much data can I store in a Reliable Collection?</span></span>

<span data-ttu-id="7d30c-186">可靠的服務通常經過分割，因此您可以儲存的資料量僅受限於叢集中您擁有的機器數量，以及那些機器提供的記憶體數量。</span><span class="sxs-lookup"><span data-stu-id="7d30c-186">Reliable services are typically partitioned, so the amount you can store is only limited by the number of machines you have in the cluster, and the amount of memory available on those machines.</span></span>

<span data-ttu-id="7d30c-187">例如，假設您在服務中擁有的可靠集合含有 100 個分割及 3 個複本，儲存的物件大小平均為 1kb。</span><span class="sxs-lookup"><span data-stu-id="7d30c-187">As an example, suppose that you have a reliable collection in a service with 100 partitions and 3 replicas, storing objects that average 1kb in size.</span></span> <span data-ttu-id="7d30c-188">現在，假設您有 10 部機器的叢集，每部機器均含有 16GB 記憶體。</span><span class="sxs-lookup"><span data-stu-id="7d30c-188">Now suppose that you have a 10 machine cluster with 16gb of memory per machine.</span></span> <span data-ttu-id="7d30c-189">為了簡單與謹慎起見，假設作業系統及系統服務 (Service Fabric 執行階段以及您的服務) 會使用 6GB 的記憶體，並在每部機器上保留 10GB 以供使用，或是為該叢集保留 100GB 記憶體以供使用。</span><span class="sxs-lookup"><span data-stu-id="7d30c-189">For simplicity and to be very conservative, assume that the operating system and system services, the Service Fabric runtime, and your services consume 6gb of that, leaving 10gb available per machine, or 100gb for the cluster.</span></span>

<span data-ttu-id="7d30c-190">請記住，每個物件必須儲存三次 (一次主要，兩次複本)，在以完整容量運作的情況下，您會有足夠的記憶體提供您集合中大約 3500 萬個物件使用。</span><span class="sxs-lookup"><span data-stu-id="7d30c-190">Keeping in mind that each object must be stored three times (one primary and two replicas), you would have sufficient memory for approximately 35 million objects in your collection when operating at full capacity.</span></span> <span data-ttu-id="7d30c-191">不過，我們建議您要能夠從失敗網域以及升級網域同時遺失情況下還原，這代表約 1/3 的容量，而物件數目會減至約 2300 萬。</span><span class="sxs-lookup"><span data-stu-id="7d30c-191">However, we recommend being resilient to the simultaneous loss of a failure domain and an upgrade domain, which represents about 1/3 of capacity, and would reduce the number to roughly 23 million.</span></span>

<span data-ttu-id="7d30c-192">請注意，這項計算也假設：</span><span class="sxs-lookup"><span data-stu-id="7d30c-192">Note that this calculation also assumes:</span></span>

- <span data-ttu-id="7d30c-193">資料在所有分割上的分佈大致上是平均的，或您會對叢集資源管理員報告負載計量。</span><span class="sxs-lookup"><span data-stu-id="7d30c-193">That the distribution of data across the partitions is roughly uniform or that you're reporting load metrics to the Cluster Resource Manager.</span></span> <span data-ttu-id="7d30c-194">根據預設，Service Fabric 會根據複本數量進行負載平衡。</span><span class="sxs-lookup"><span data-stu-id="7d30c-194">By default, Service Fabric will load balance based on replica count.</span></span> <span data-ttu-id="7d30c-195">在我們的上述範例中，會在叢集中的每個節點上放置 10 個主要複本以及 20 個次要複本。</span><span class="sxs-lookup"><span data-stu-id="7d30c-195">In our example above, that would put 10 primary replicas and 20 secondary replicas on each node in the cluster.</span></span> <span data-ttu-id="7d30c-196">這適用於平均分佈於所有分割的負載。</span><span class="sxs-lookup"><span data-stu-id="7d30c-196">That works well for load that is evenly distributed across the partitions.</span></span> <span data-ttu-id="7d30c-197">如果負載不平均，您必須報告負載，以便資源管理員可以將較小的複本封裝在一起，讓較大的複本可以使用個別節點上較多的記憶體。</span><span class="sxs-lookup"><span data-stu-id="7d30c-197">If load is not even, you must report load so that the Resource Manager can pack smaller replicas together and allow larger replicas to consume more memory on an individual node.</span></span>

- <span data-ttu-id="7d30c-198">發生問題的可靠服務為叢集中唯一的儲存狀態。</span><span class="sxs-lookup"><span data-stu-id="7d30c-198">That the reliable service in question is the only one storing state in the cluster.</span></span> <span data-ttu-id="7d30c-199">由於您可以部署多個服務到叢集因此您您必須留意每個服務在執行及管理其狀態時所需的資源。</span><span class="sxs-lookup"><span data-stu-id="7d30c-199">Since you can deploy multiple services to a cluster, you need to be mindful of the resources that each will need to run and manage its state.</span></span>

- <span data-ttu-id="7d30c-200">叢集本身不會擴大或縮小。</span><span class="sxs-lookup"><span data-stu-id="7d30c-200">That the cluster itself is not growing or shrinking.</span></span> <span data-ttu-id="7d30c-201">如果您新增更多機器，Service Fabric 將會重新平衡您的複本以利用額外的容量，直到機器數量超出服務中的分割數量為止，因為個別複本無法跨越機器。</span><span class="sxs-lookup"><span data-stu-id="7d30c-201">If you add more machines, Service Fabric will rebalance your replicas to leverage the additional capacity until the number of machines surpasses the number of partitions in your service, since an individual replica cannot span machines.</span></span> <span data-ttu-id="7d30c-202">反之，如果您移除機器以縮小叢集大小，您的複本將會更緊密地封裝，並縮小整體容量。</span><span class="sxs-lookup"><span data-stu-id="7d30c-202">By contrast, if you reduce the size of the cluster by removing machines, your replicas will be packed more tightly and have less overall capacity.</span></span>

### <a name="how-much-data-can-i-store-in-an-actor"></a><span data-ttu-id="7d30c-203">動作項目中可儲存多少資料？</span><span class="sxs-lookup"><span data-stu-id="7d30c-203">How much data can I store in an actor?</span></span>

<span data-ttu-id="7d30c-204">正如同可靠的服務，您可以在動作項目服務中儲存的資料量僅受限於叢集中所有節點可用的整體磁碟空間以及記憶體。</span><span class="sxs-lookup"><span data-stu-id="7d30c-204">As with reliable services, the amount of data that you can store in an actor service is only limited by the total disk space and memory available across the nodes in your cluster.</span></span> <span data-ttu-id="7d30c-205">不過，個別的動作項目在用來封裝少量的狀態以及相關聯商務邏輯時最為有效。</span><span class="sxs-lookup"><span data-stu-id="7d30c-205">However, individual actors are most effective when they are used to encapsulate a small amount of state and associated business logic.</span></span> <span data-ttu-id="7d30c-206">一般而言，個別的動作項目應該會有以 kb 為單位所測量的狀態。</span><span class="sxs-lookup"><span data-stu-id="7d30c-206">As a general rule, an individual actor should have state that is measured in kilobytes.</span></span>

## <a name="other-questions"></a><span data-ttu-id="7d30c-207">其他問題</span><span class="sxs-lookup"><span data-stu-id="7d30c-207">Other questions</span></span>

### <a name="how-does-service-fabric-relate-to-containers"></a><span data-ttu-id="7d30c-208">Service Fabric 如何與容器相關聯？</span><span class="sxs-lookup"><span data-stu-id="7d30c-208">How does Service Fabric relate to containers?</span></span>

<span data-ttu-id="7d30c-209">容器會提供簡單的方式來封裝服務及其相依性，使它們可以在所有環境中一致地執行，並且可在單一機器上以隔離的方式運作。</span><span class="sxs-lookup"><span data-stu-id="7d30c-209">Containers offer a simple way to package services and their dependencies such that they run consistently in all environments and can operate in an isolated fashion on a single machine.</span></span> <span data-ttu-id="7d30c-210">Service Fabric 提供部署與管理服務的方式，包括[已經包裝於容器中的服務](service-fabric-containers-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="7d30c-210">Service Fabric offers a way to deploy and manage services, including [services that have been packaged in a container](service-fabric-containers-overview.md).</span></span>

### <a name="are-you-planning-to-open-source-service-fabric"></a><span data-ttu-id="7d30c-211">您打算開放 Service Fabric 原始碼嗎？</span><span class="sxs-lookup"><span data-stu-id="7d30c-211">Are you planning to open source Service Fabric?</span></span>

<span data-ttu-id="7d30c-212">我們打算在 GitHub 上開放 Reliable Services 和 Reliable Actors 架構的原始碼，並將接受社群參與這些專案。</span><span class="sxs-lookup"><span data-stu-id="7d30c-212">We intend to open source the reliable services and reliable actors frameworks on GitHub and will accept community contributions to those projects.</span></span> <span data-ttu-id="7d30c-213">請關注 [Service Fabric 部落格](https://blogs.msdn.microsoft.com/azureservicefabric/)，以便在公告更多詳細資料時進行了解。</span><span class="sxs-lookup"><span data-stu-id="7d30c-213">Please follow the [Service Fabric blog](https://blogs.msdn.microsoft.com/azureservicefabric/) for more details as they're announced.</span></span>

<span data-ttu-id="7d30c-214">目前並無任何開放 Service Fabric 執行階段原始碼的計畫。</span><span class="sxs-lookup"><span data-stu-id="7d30c-214">The are currently no plans to open source the Service Fabric runtime.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7d30c-215">後續步驟</span><span class="sxs-lookup"><span data-stu-id="7d30c-215">Next steps</span></span>

- [<span data-ttu-id="7d30c-216">深入了解核心 Service Fabric 概念和最佳做法 (英文)</span><span class="sxs-lookup"><span data-stu-id="7d30c-216">Learn about core Service Fabric concepts and best practices</span></span>](https://mva.microsoft.com/en-us/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=tbuZM46yC_5206218965)
