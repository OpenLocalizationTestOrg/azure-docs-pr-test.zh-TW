---
title: "設定 Azure 微服務的連續整合 |Microsoft Docs"
description: "取得如何使用 Visual Studio Team Services (VSTS) 設定 Service Fabric 應用程式之持續整合和部署的概觀。"
services: service-fabric
documentationcenter: na
author: mthalman-msft
manager: timlt
editor: 
ms.assetid: 3e8c2290-9e7a-456a-9b2c-db44d1b3988d
ms.service: multiple
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: multiple
ms.date: 12/06/2016
ms.author: mthalman;mikhegn
ms.openlocfilehash: 76a1e013e824910c7a489e345b6563ae3951378f
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="set-up-service-fabric-continuous-integration-and-deployment-with-visual-studio-team-services"></a><span data-ttu-id="d31c7-103">使用 Visual Studio Team Services 設定 Service Fabric 連續整合和部署</span><span class="sxs-lookup"><span data-stu-id="d31c7-103">Set up Service Fabric continuous integration and deployment with Visual Studio Team Services</span></span>
<span data-ttu-id="d31c7-104">本文說明使用 Visual Studio Team Services (VSTS) 設定 Azure Service Fabric 應用程式之持續整合和部署的步驟。</span><span class="sxs-lookup"><span data-stu-id="d31c7-104">This article describes the steps to set up continuous integration and deployment for an Azure Service Fabric application by using Visual Studio Team Services (VSTS).</span></span>

<span data-ttu-id="d31c7-105">這份文件反映目前的程序，而且應該隨著時間而改變。</span><span class="sxs-lookup"><span data-stu-id="d31c7-105">This document reflects the current procedure and is expected to change over time.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="d31c7-106">必要條件</span><span class="sxs-lookup"><span data-stu-id="d31c7-106">Prerequisites</span></span>
<span data-ttu-id="d31c7-107">若要開始，請遵循下列步驟︰</span><span class="sxs-lookup"><span data-stu-id="d31c7-107">To get started, follow these steps:</span></span>

1. <span data-ttu-id="d31c7-108">確定您有 Team Services 帳戶的存取權或 [建立一個](https://www.visualstudio.com/docs/setup-admin/team-services/sign-up-for-visual-studio-team-services) 。</span><span class="sxs-lookup"><span data-stu-id="d31c7-108">Ensure that you have access to a Team Services account or [create one](https://www.visualstudio.com/docs/setup-admin/team-services/sign-up-for-visual-studio-team-services) yourself.</span></span>
2. <span data-ttu-id="d31c7-109">確定您有 Team Services 小組專案的存取權或 [建立一個](https://www.visualstudio.com/docs/setup-admin/create-team-project) 。</span><span class="sxs-lookup"><span data-stu-id="d31c7-109">Ensure that you have access to a Team Services team project or [create one](https://www.visualstudio.com/docs/setup-admin/create-team-project) yourself.</span></span>
3. <span data-ttu-id="d31c7-110">確定您擁有可部署應用程式的 Service Fabric 叢集，或使用 [Azure 入口網站](service-fabric-cluster-creation-via-portal.md)、[Azure Resource Manager 範本](service-fabric-cluster-creation-via-arm.md)或 [Visual Studio](service-fabric-cluster-creation-via-visual-studio.md) 建立一個。</span><span class="sxs-lookup"><span data-stu-id="d31c7-110">Ensure that you have a Service Fabric cluster to which you can deploy your application or create one using the [Azure portal](service-fabric-cluster-creation-via-portal.md), an [Azure Resource Manager template](service-fabric-cluster-creation-via-arm.md), or [Visual Studio](service-fabric-cluster-creation-via-visual-studio.md).</span></span>
4. <span data-ttu-id="d31c7-111">確定您已經建立 Service Fabric 應用程式 (.sfproj) 專案。</span><span class="sxs-lookup"><span data-stu-id="d31c7-111">Ensure that you have already created a Service Fabric Application (.sfproj) project.</span></span> <span data-ttu-id="d31c7-112">您必須具有使用 Service Fabric SDK 2.1 或更新版本建立或升級的專案 (.sfproj 檔案須包含 1.1 或更高的 ProjectVersion 屬性值)。</span><span class="sxs-lookup"><span data-stu-id="d31c7-112">You must have a project that was created or upgraded with Service Fabric SDK 2.1 or higher (the .sfproj file should contain a ProjectVersion property value of 1.1 or higher).</span></span>

> [!NOTE]
> <span data-ttu-id="d31c7-113">自訂組建代理程式已不再需要。</span><span class="sxs-lookup"><span data-stu-id="d31c7-113">Custom build agents are no longer required.</span></span> <span data-ttu-id="d31c7-114">Team Services 裝載的代理程式現在都預先安裝 Service Fabric 叢集管理軟體，可讓您直接從這些代理程式部署應用程式。</span><span class="sxs-lookup"><span data-stu-id="d31c7-114">Team Services hosted agents now come pre-installed with Service Fabric cluster management software, allowing for deployment of your applications directly from those agents.</span></span>
> 
> 

## <a name="configure-and-share-your-source-files"></a><span data-ttu-id="d31c7-115">設定和共用來源檔案</span><span class="sxs-lookup"><span data-stu-id="d31c7-115">Configure and share your source files</span></span>
<span data-ttu-id="d31c7-116">您想要執行的第一步是準備部署程序使用的發行設定檔 (於 Team Services 內執行)。</span><span class="sxs-lookup"><span data-stu-id="d31c7-116">The first thing you want to do is prepare a publish profile for use by the deployment process that executes within Team Services.</span></span>  <span data-ttu-id="d31c7-117">發行設定檔應設定為以先前準備的叢集為目標。</span><span class="sxs-lookup"><span data-stu-id="d31c7-117">The publish profile should be configured to target the cluster that you've previously prepared:</span></span>

1. <span data-ttu-id="d31c7-118">在您的應用程式專案內選擇您想要使用於持續整合工作流程的發行設定檔。</span><span class="sxs-lookup"><span data-stu-id="d31c7-118">Choose a publish profile within your Application project that you want to use for your continuous integration workflow.</span></span> <span data-ttu-id="d31c7-119">遵循如何將應用程式發佈至遠端叢集的[發佈指示](service-fabric-publish-app-remote-cluster.md)。</span><span class="sxs-lookup"><span data-stu-id="d31c7-119">Follow the [publish instructions](service-fabric-publish-app-remote-cluster.md) on how to publish an application to a remote cluster.</span></span> <span data-ttu-id="d31c7-120">但是，實際上您不需要發佈應用程式。</span><span class="sxs-lookup"><span data-stu-id="d31c7-120">You don't actually need to publish your application though.</span></span> <span data-ttu-id="d31c7-121">適當地設定各項後，即可按一下 [發佈] 對話方塊中的 [儲存] 超連結。</span><span class="sxs-lookup"><span data-stu-id="d31c7-121">You can click the **Save** hyperlink in the publish dialog once you have configured things appropriately.</span></span>
2. <span data-ttu-id="d31c7-122">如果您想針對 Team Services 中的每個部署升級應用程式，您可以設定發行設定檔以啟用升級。</span><span class="sxs-lookup"><span data-stu-id="d31c7-122">If you want your application to be upgraded for each deployment that occurs within Team Services, you want to configure the publish profile to enable upgrade.</span></span> <span data-ttu-id="d31c7-123">在步驟 1 使用的同一個 [發行] 對話方塊中，確認已核取 [升級應用程式]  核取方塊。</span><span class="sxs-lookup"><span data-stu-id="d31c7-123">In the same publish dialog used in step 1, ensure that the **Upgrade the Application** checkbox is checked.</span></span>  <span data-ttu-id="d31c7-124">深入了解 [設定其他升級設定](service-fabric-visualstudio-configure-upgrade.md)。</span><span class="sxs-lookup"><span data-stu-id="d31c7-124">Learn more about [configuring additional upgrade settings](service-fabric-visualstudio-configure-upgrade.md).</span></span> <span data-ttu-id="d31c7-125">按一下 [儲存]  超連結，將設定儲存至發行設定檔。</span><span class="sxs-lookup"><span data-stu-id="d31c7-125">Click the **Save** hyperlink to save the settings to the publish profile.</span></span>
3. <span data-ttu-id="d31c7-126">確定您已將變更儲存至發行設定檔，並取消 [發行] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="d31c7-126">Ensure that you've saved your changes to the publish profile and cancel the publish dialog.</span></span>
4. <span data-ttu-id="d31c7-127">現在是時候與 Team Services [共用應用程式專案來源檔案](https://www.visualstudio.com/docs/setup-admin/team-services/connect-to-visual-studio-team-services#vs) 。</span><span class="sxs-lookup"><span data-stu-id="d31c7-127">Now it's time to [share your Application project source files](https://www.visualstudio.com/docs/setup-admin/team-services/connect-to-visual-studio-team-services#vs) with Team Services.</span></span> <span data-ttu-id="d31c7-128">當您的來源檔案可以在 Team Services 中存取之後，就可以繼續產生組建的下一個步驟。</span><span class="sxs-lookup"><span data-stu-id="d31c7-128">Once your source files are accessible in Team Services, you can now move on to the next step of generating builds.</span></span> 

## <a name="create-a-build-definition"></a><span data-ttu-id="d31c7-129">建立組建定義</span><span class="sxs-lookup"><span data-stu-id="d31c7-129">Create a build definition</span></span>
<span data-ttu-id="d31c7-130">Team Services 組建定義描述由一組循序執行的組建步驟所組成的工作流程。</span><span class="sxs-lookup"><span data-stu-id="d31c7-130">A Team Services build definition describes a workflow that is composed of a set of build steps that are executed sequentially.</span></span> <span data-ttu-id="d31c7-131">建立組建定義的目的是要產生 Service Fabric 應用程式套件，以及可用於部署應用程式的其他構件。</span><span class="sxs-lookup"><span data-stu-id="d31c7-131">The goal of the build definition that you are creating is to produce a Service Fabric application package, and other artifacts, that can be used to deploy the application.</span></span> <span data-ttu-id="d31c7-132">深入了解 Team Services [組建定義](https://www.visualstudio.com/docs/build/define/create)。</span><span class="sxs-lookup"><span data-stu-id="d31c7-132">Learn more about Team Services [build definitions](https://www.visualstudio.com/docs/build/define/create).</span></span>

### <a name="create-a-definition-from-the-build-template"></a><span data-ttu-id="d31c7-133">從組建範本建立定義</span><span class="sxs-lookup"><span data-stu-id="d31c7-133">Create a definition from the build template</span></span>
1. <span data-ttu-id="d31c7-134">在 Visual Studio Team Services 中開啟您的小組專案。</span><span class="sxs-lookup"><span data-stu-id="d31c7-134">Open your team project in Visual Studio Team Services.</span></span>
2. <span data-ttu-id="d31c7-135">選取 [組建]  索引標籤。</span><span class="sxs-lookup"><span data-stu-id="d31c7-135">Select the **Build** tab.</span></span>
3. <span data-ttu-id="d31c7-136">選取綠色 **+** 符號以建立新的組建定義。</span><span class="sxs-lookup"><span data-stu-id="d31c7-136">Select the green **+** sign to create a new build definition.</span></span>
4. <span data-ttu-id="d31c7-137">在開啟的對話方塊中，選取 [組建] 範本類別中的 [Azure Service Fabric 應用程式]。</span><span class="sxs-lookup"><span data-stu-id="d31c7-137">In the dialog that opens, select **Azure Service Fabric Application** within the **Build** template category.</span></span>
5. <span data-ttu-id="d31c7-138">選取 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="d31c7-138">Select **Next**.</span></span>
6. <span data-ttu-id="d31c7-139">選取和您的 Service Fabric 應用程式關聯的儲存機制和分支 。</span><span class="sxs-lookup"><span data-stu-id="d31c7-139">Select the repository and branch associated with your Service Fabric application.</span></span>
7. <span data-ttu-id="d31c7-140">選取您想要使用的代理程式佇列。</span><span class="sxs-lookup"><span data-stu-id="d31c7-140">Select the agent queue you wish to use.</span></span> <span data-ttu-id="d31c7-141">支援裝載的代理程式。</span><span class="sxs-lookup"><span data-stu-id="d31c7-141">Hosted agents are supported.</span></span>
8. <span data-ttu-id="d31c7-142">選取 [ **建立**]。</span><span class="sxs-lookup"><span data-stu-id="d31c7-142">Select **Create**.</span></span>
9. <span data-ttu-id="d31c7-143">儲存組建定義並提供名稱。</span><span class="sxs-lookup"><span data-stu-id="d31c7-143">Save the build definition and provide a name.</span></span>
10. <span data-ttu-id="d31c7-144">下一段是範本所產生之組建步驟的說明︰</span><span class="sxs-lookup"><span data-stu-id="d31c7-144">The following paragraph is a description of the build steps generated by the template:</span></span>

| <span data-ttu-id="d31c7-145">組建步驟</span><span class="sxs-lookup"><span data-stu-id="d31c7-145">Build step</span></span> | <span data-ttu-id="d31c7-146">說明</span><span class="sxs-lookup"><span data-stu-id="d31c7-146">Description</span></span> |
| --- | --- |
| <span data-ttu-id="d31c7-147">NuGet 還原</span><span class="sxs-lookup"><span data-stu-id="d31c7-147">NuGet restore</span></span> |<span data-ttu-id="d31c7-148">還原方案的 NuGet 套件。</span><span class="sxs-lookup"><span data-stu-id="d31c7-148">Restores the NuGet packages for the solution.</span></span> |
| <span data-ttu-id="d31c7-149">組建方案 \*.sln</span><span class="sxs-lookup"><span data-stu-id="d31c7-149">Build solution \*.sln</span></span> |<span data-ttu-id="d31c7-150">組建整個方案。</span><span class="sxs-lookup"><span data-stu-id="d31c7-150">Builds the entire solution.</span></span> |
| <span data-ttu-id="d31c7-151">組建方案 \*.sfproj</span><span class="sxs-lookup"><span data-stu-id="d31c7-151">Build solution \*.sfproj</span></span> |<span data-ttu-id="d31c7-152">產生用來部署應用程式的 Service Fabric 應用程式套件。</span><span class="sxs-lookup"><span data-stu-id="d31c7-152">Generates the Service Fabric application package that is used to deploy the application.</span></span> <span data-ttu-id="d31c7-153">應用程式套件位置會指定為組建的構件目錄內。</span><span class="sxs-lookup"><span data-stu-id="d31c7-153">The application package location is specified to be within the build's artifact directory.</span></span> |
| <span data-ttu-id="d31c7-154">更新 Service Fabric 應用程式版本</span><span class="sxs-lookup"><span data-stu-id="d31c7-154">Update Service Fabric App Versions</span></span> |<span data-ttu-id="d31c7-155">更新應用程式套件資訊清單檔案中包含的版本值以提供升級支援。</span><span class="sxs-lookup"><span data-stu-id="d31c7-155">Updates the version values contained in the application package's manifest files to allow for upgrade support.</span></span> <span data-ttu-id="d31c7-156">如需詳細資訊，請參閱 [工作文件頁面](https://go.microsoft.com/fwlink/?LinkId=820529) 。</span><span class="sxs-lookup"><span data-stu-id="d31c7-156">See the [task documentation page](https://go.microsoft.com/fwlink/?LinkId=820529) for more information.</span></span> |
| <span data-ttu-id="d31c7-157">複製檔案</span><span class="sxs-lookup"><span data-stu-id="d31c7-157">Copy Files</span></span> |<span data-ttu-id="d31c7-158">將發行設定檔和應用程式參數檔案複製到組建的構件，以供部署取用。</span><span class="sxs-lookup"><span data-stu-id="d31c7-158">Copies the publish profile and application parameters files to the build's artifacts to be consumed for deployment.</span></span> |
| <span data-ttu-id="d31c7-159">發行構件</span><span class="sxs-lookup"><span data-stu-id="d31c7-159">Publish Artifact</span></span> |<span data-ttu-id="d31c7-160">發行組建的構件。</span><span class="sxs-lookup"><span data-stu-id="d31c7-160">Publishes the build's artifacts.</span></span> <span data-ttu-id="d31c7-161">可讓發行定義取用組建的構件。</span><span class="sxs-lookup"><span data-stu-id="d31c7-161">Allows a release definition to consume the build's artifacts.</span></span> |

### <a name="verify-the-default-set-of-tasks"></a><span data-ttu-id="d31c7-162">確認預設工作集</span><span class="sxs-lookup"><span data-stu-id="d31c7-162">Verify the default set of tasks</span></span>
1. <span data-ttu-id="d31c7-163">確認 [NuGet 還原] 的 [方案]輸入欄位和 [組建方案] 組建步驟。</span><span class="sxs-lookup"><span data-stu-id="d31c7-163">Verify the **Solution** input field for the **NuGet restore** and **Build solution** build steps.</span></span>  <span data-ttu-id="d31c7-164">根據預設，這些組建步驟會針對相關儲存機制中包含的所有方案檔案執行。</span><span class="sxs-lookup"><span data-stu-id="d31c7-164">By default, these build steps execute upon all solution files that are contained in the associated repository.</span></span>  <span data-ttu-id="d31c7-165">如果您只想在這些方案檔案的其中之一執行組建定義，您需要明確地更新該檔案的路徑。</span><span class="sxs-lookup"><span data-stu-id="d31c7-165">If you only want the build definition to operate on one of those solution files, you need to explicitly update the path to that file.</span></span>
2. <span data-ttu-id="d31c7-166">確認 [封裝應用程式] 組建步驟的 [方案] 輸入欄位。</span><span class="sxs-lookup"><span data-stu-id="d31c7-166">Verify the **Solution** input field for the **Package application** build step.</span></span>  <span data-ttu-id="d31c7-167">根據預設，這個組建步驟會假設儲存機制中只有一個 Service Fabric 應用程式專案 (.sfproj)。</span><span class="sxs-lookup"><span data-stu-id="d31c7-167">By default, this build step assumes only one Service Fabric Application project (.sfproj) exists in the repository.</span></span>  <span data-ttu-id="d31c7-168">如果您的儲存機制中有多個這類檔案，並只想以其中之一作為此組建定義的目標，您需要明確地更新該檔案的路徑。</span><span class="sxs-lookup"><span data-stu-id="d31c7-168">If you have multiple such files in your repository and want to target only one of them for this build definition, you need to explicitly update the path to that file.</span></span>  <span data-ttu-id="d31c7-169">如果您想將多個應用程式專案封裝在您的儲存機制中，您需要在組建定義中建立分別以一個應用程式專案為目標的額外 **Visual Studio 組建**步驟。</span><span class="sxs-lookup"><span data-stu-id="d31c7-169">If you want to package multiple Application projects in your repository, you need to create additional **Visual Studio Build** steps in the build definition that each target an Application project.</span></span>  <span data-ttu-id="d31c7-170">您也需要更新這些組建步驟的 [MSBuild 引數] 欄位，讓它們各自擁有唯一的封裝位置。</span><span class="sxs-lookup"><span data-stu-id="d31c7-170">You would then also need to update the **MSBuild Arguments** field for each of those build steps so that the package location is unique for each of them.</span></span>
3. <span data-ttu-id="d31c7-171">確認 **更新 Service Fabric 應用程式版本** 組建步驟中定義的版本控制行為。</span><span class="sxs-lookup"><span data-stu-id="d31c7-171">Verify the versioning behavior defined in the **Update Service Fabric App Versions** build step.</span></span>  <span data-ttu-id="d31c7-172">根據預設，這個組建步驟會將組建編號附加至應用程式套件資訊清單檔案中的所有版本值。</span><span class="sxs-lookup"><span data-stu-id="d31c7-172">By default, this build step appends the build number to all version values in the application package's manifest files.</span></span> <span data-ttu-id="d31c7-173">如需詳細資訊，請參閱 [工作文件頁面](https://go.microsoft.com/fwlink/?LinkId=820529) 。</span><span class="sxs-lookup"><span data-stu-id="d31c7-173">See the [task documentation page](https://go.microsoft.com/fwlink/?LinkId=820529) for more information.</span></span> <span data-ttu-id="d31c7-174">這有助於支援您的應用程式的升級，因為每個升級部署需要的版本值不同於先前的部署。</span><span class="sxs-lookup"><span data-stu-id="d31c7-174">This is useful for supporting upgrade of your application since each upgrade deployment requires different version values from the previous deployment.</span></span> <span data-ttu-id="d31c7-175">如果您不想在工作流程中使用應用程式升級，您可以考慮停用這個組建步驟。</span><span class="sxs-lookup"><span data-stu-id="d31c7-175">If you're not intending to use application upgrade in your workflow, you may consider disabling this build step.</span></span> <span data-ttu-id="d31c7-176">如果您打算產生可用來覆寫現有 Service Fabric 應用程式的組建，則必須予以停用。</span><span class="sxs-lookup"><span data-stu-id="d31c7-176">It must be disabled if your intention is to produce a build that can be used to overwrite an existing Service Fabric application.</span></span> <span data-ttu-id="d31c7-177">如果組建所產生的應用程式版本與叢集中的應用程式版本不相符，則會部署失敗。</span><span class="sxs-lookup"><span data-stu-id="d31c7-177">The deployment fails if the version of the application produced by the build does not match the version of the application in the cluster.</span></span>
4. <span data-ttu-id="d31c7-178">如果您的方案包含 .NET Core 專案，則必須確定您的組建定義包含還原相依性的組建步驟：</span><span class="sxs-lookup"><span data-stu-id="d31c7-178">If your solution contains a .NET Core project, you must ensure that your build definition contains a build step that restores the dependencies:</span></span>
   1. <span data-ttu-id="d31c7-179">選取 [新增組件步驟...] 。</span><span class="sxs-lookup"><span data-stu-id="d31c7-179">Select **Add build step...**.</span></span>
   2. <span data-ttu-id="d31c7-180">找出 [公用程式] 索引標籤內的 [命令列] 工作，並按一下其 [新增] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="d31c7-180">Locate the **Command-Line** task within the Utility tab and click its Add button.</span></span>
   3. <span data-ttu-id="d31c7-181">對於工作的輸入欄位，請使用下列值︰</span><span class="sxs-lookup"><span data-stu-id="d31c7-181">For the task's input fields, use the following values:</span></span>
   4. <span data-ttu-id="d31c7-182">工具︰dotnet</span><span class="sxs-lookup"><span data-stu-id="d31c7-182">Tool: dotnet</span></span>
   5. <span data-ttu-id="d31c7-183">引數︰restore</span><span class="sxs-lookup"><span data-stu-id="d31c7-183">Arguments: restore</span></span>
   6. <span data-ttu-id="d31c7-184">拖曳工作，將它就放在 [NuGet 還原]  步驟之後。</span><span class="sxs-lookup"><span data-stu-id="d31c7-184">Drag the task so that it is immediately after the **NuGet restore** step.</span></span>
5. <span data-ttu-id="d31c7-185">儲存對組建定義所做的任何變更。</span><span class="sxs-lookup"><span data-stu-id="d31c7-185">Save any changes you've made to the build definition.</span></span>

### <a name="try-it"></a><span data-ttu-id="d31c7-186">試試看</span><span class="sxs-lookup"><span data-stu-id="d31c7-186">Try it</span></span>
<span data-ttu-id="d31c7-187">選取 [佇列組建]  以手動啟動組建。</span><span class="sxs-lookup"><span data-stu-id="d31c7-187">Select **Queue Build** to manually start a build.</span></span> <span data-ttu-id="d31c7-188">推送或簽入時也會觸發組建。</span><span class="sxs-lookup"><span data-stu-id="d31c7-188">Builds also triggers upon push or check-in.</span></span> <span data-ttu-id="d31c7-189">一旦您確認組建順利執行後，就可以繼續定義可將應用程式部署至叢集的發行定義。</span><span class="sxs-lookup"><span data-stu-id="d31c7-189">Once you've verified that the build is executing successfully, you can now move on to defining a release definition that deploys your application to a cluster.</span></span>

## <a name="create-a-release-definition"></a><span data-ttu-id="d31c7-190">建立發行定義</span><span class="sxs-lookup"><span data-stu-id="d31c7-190">Create a release definition</span></span>
<span data-ttu-id="d31c7-191">Team Services 發行定義描述由一組循序執行的工作所組成的工作流程。</span><span class="sxs-lookup"><span data-stu-id="d31c7-191">A Team Services release definition describes a workflow that is composed of a set of tasks that are executed sequentially.</span></span> <span data-ttu-id="d31c7-192">建立發行定義的目的是取得應用程式套件，並將它部署至叢集。</span><span class="sxs-lookup"><span data-stu-id="d31c7-192">The goal of the release definition that you are creating is to take an application package and deploy it to a cluster.</span></span> <span data-ttu-id="d31c7-193">一起使用時，組建定義和發行定義可以執行整個工作流程，從來源檔案開始，並以叢集中的執行中應用程式結束。</span><span class="sxs-lookup"><span data-stu-id="d31c7-193">When used together, the build definition and release definition can execute the entire workflow from starting with source files to ending with a running application in your cluster.</span></span> <span data-ttu-id="d31c7-194">深入了解 Team Services [發行定義](https://www.visualstudio.com/docs/release/author-release-definition/more-release-definition)。</span><span class="sxs-lookup"><span data-stu-id="d31c7-194">Learn more about Team Services [release definitions](https://www.visualstudio.com/docs/release/author-release-definition/more-release-definition).</span></span>

### <a name="create-a-definition-from-the-release-template"></a><span data-ttu-id="d31c7-195">從發行範本建立定義</span><span class="sxs-lookup"><span data-stu-id="d31c7-195">Create a definition from the release template</span></span>
1. <span data-ttu-id="d31c7-196">在 Visual Studio Team Services 中開啟您的專案。</span><span class="sxs-lookup"><span data-stu-id="d31c7-196">Open your project in Visual Studio Team Services.</span></span>
2. <span data-ttu-id="d31c7-197">選取 [發行]  索引標籤。</span><span class="sxs-lookup"><span data-stu-id="d31c7-197">Select the **Release** tab.</span></span>
3. <span data-ttu-id="d31c7-198">選取綠色 **+** 符號以建立新的發行定義，並選取功能表中的 [建立發行定義]。</span><span class="sxs-lookup"><span data-stu-id="d31c7-198">Select the green **+** sign to create a new release definition and select **Create release definition** in the menu.</span></span>
4. <span data-ttu-id="d31c7-199">在開啟的對話方塊中，選取 [部署] 範本類別中的 [Azure Service Fabric 部署]。</span><span class="sxs-lookup"><span data-stu-id="d31c7-199">In the dialog that opens, select **Azure Service Fabric Deployment** within the **Deployment** template category.</span></span>
5. <span data-ttu-id="d31c7-200">選取 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="d31c7-200">Select **Next**.</span></span>
6. <span data-ttu-id="d31c7-201">選取做為這個發行定義的來源的組建定義。</span><span class="sxs-lookup"><span data-stu-id="d31c7-201">Select the build definition you want to use as the source of this release definition.</span></span>  <span data-ttu-id="d31c7-202">發行定義會參考所選組建定義所產生的構件。</span><span class="sxs-lookup"><span data-stu-id="d31c7-202">The release definition references the artifacts that were produced by the selected build definition.</span></span>
7. <span data-ttu-id="d31c7-203">如果您想要讓 Team Services 在每次組建完成時自動建立新的發行並部署 Service Fabric 應用程式，請核取 [連續部署]  核取方塊。</span><span class="sxs-lookup"><span data-stu-id="d31c7-203">Check the **Continuous deployment** check box if you wish to have Team Services automatically create a new release and deploy the Service Fabric application whenever a build completes.</span></span>
8. <span data-ttu-id="d31c7-204">選取您想要使用的代理程式佇列。</span><span class="sxs-lookup"><span data-stu-id="d31c7-204">Select the agent queue you wish to use.</span></span> <span data-ttu-id="d31c7-205">支援裝載的代理程式。</span><span class="sxs-lookup"><span data-stu-id="d31c7-205">Hosted agents are supported.</span></span>
9. <span data-ttu-id="d31c7-206">選取 [ **建立**]。</span><span class="sxs-lookup"><span data-stu-id="d31c7-206">Select **Create**.</span></span>
10. <span data-ttu-id="d31c7-207">按一下頁面頂端的鉛筆圖示以編輯定義名稱。</span><span class="sxs-lookup"><span data-stu-id="d31c7-207">Edit the definition name by clicking the pencil icon at the top of the page.</span></span>
11. <span data-ttu-id="d31c7-208">從工作的 [叢集連線]  輸入欄位中，選取您的應用程式應部署到哪個叢集。</span><span class="sxs-lookup"><span data-stu-id="d31c7-208">Select the cluster to which your application should be deployed from the **Cluster Connection** input field of the task.</span></span> <span data-ttu-id="d31c7-209">叢集連線提供讓部署工作連線到叢集所需的資訊。</span><span class="sxs-lookup"><span data-stu-id="d31c7-209">The cluster connection provides the necessary information that allows the deployment task to connect to the cluster.</span></span> <span data-ttu-id="d31c7-210">如果您的叢集還沒有叢集連線，請選取欄位旁的 [管理]  超連結新增一個。</span><span class="sxs-lookup"><span data-stu-id="d31c7-210">If you do not yet have a cluster connection for your cluster, select the **Manage** hyperlink next to the field to add one.</span></span> <span data-ttu-id="d31c7-211">在開啟的頁面上執行下列步驟：</span><span class="sxs-lookup"><span data-stu-id="d31c7-211">On the page that opens, perform the following steps:</span></span>
    1. <span data-ttu-id="d31c7-212">選取 [新增服務端點]，然後從功能表中選取 [Azure Service Fabric]。</span><span class="sxs-lookup"><span data-stu-id="d31c7-212">Select **New Service Endpoint** and then select **Azure Service Fabric** from the menu.</span></span>
    2. <span data-ttu-id="d31c7-213">選取此端點的目標叢集所使用的驗證類型。</span><span class="sxs-lookup"><span data-stu-id="d31c7-213">Select the type of authentication being used by the cluster targeted by this endpoint.</span></span>
    3. <span data-ttu-id="d31c7-214">在 [連線名稱]  欄位中定義連線的名稱。</span><span class="sxs-lookup"><span data-stu-id="d31c7-214">Define a name for your connection in the **Connection Name** field.</span></span>  <span data-ttu-id="d31c7-215">一般而言，您可使用您的叢集名稱。</span><span class="sxs-lookup"><span data-stu-id="d31c7-215">Typically, you would use the name of your cluster.</span></span>
    4. <span data-ttu-id="d31c7-216">在 [叢集端點]  欄位中，定義用戶端連線端點 URL。</span><span class="sxs-lookup"><span data-stu-id="d31c7-216">Define the client connection endpoint URL in the **Cluster Endpoint** field.</span></span>  <span data-ttu-id="d31c7-217">範例︰tcp://contoso.westus.cloudapp.azure.com:19000。</span><span class="sxs-lookup"><span data-stu-id="d31c7-217">Example: tcp://contoso.westus.cloudapp.azure.com:19000.</span></span>
    5. <span data-ttu-id="d31c7-218">對於 Azure Active Directory 認證，請在 [使用者名稱] 和 [密碼] 欄位中定義連線到叢集所需的認證。</span><span class="sxs-lookup"><span data-stu-id="d31c7-218">For Azure Active Directory credentials, define the credentials you want to use to connect to the cluster in the **Username** and **Password** fields.</span></span>
    6. <span data-ttu-id="d31c7-219">對於憑證式驗證，請在 [用戶端憑證]  欄位中定義用戶端憑證檔案的 Base64 編碼。</span><span class="sxs-lookup"><span data-stu-id="d31c7-219">For Certificate Based authentication, define the Base64 encoding of the client certificate file in the **Client Certificate** field.</span></span>  <span data-ttu-id="d31c7-220">如需如何取得該值的資訊，請參閱該欄位的說明快顯。</span><span class="sxs-lookup"><span data-stu-id="d31c7-220">See the help pop-up on that field for info on how to get that value.</span></span>  <span data-ttu-id="d31c7-221">如果您的憑證受密碼保護，請在 [密碼]  欄位中定義密碼。</span><span class="sxs-lookup"><span data-stu-id="d31c7-221">If your certificate is password-protected, define the password in the **Password** field.</span></span>
    7. <span data-ttu-id="d31c7-222">按一下 [確定] 確認變更。</span><span class="sxs-lookup"><span data-stu-id="d31c7-222">Confirm your changes by clicking **OK**.</span></span> <span data-ttu-id="d31c7-223">回到發行定義後，按一下 [叢集連線]  欄位上的重新整理圖示以查看您剛才新增的端點。</span><span class="sxs-lookup"><span data-stu-id="d31c7-223">After navigating back to your release definition, click the refresh icon on the **Cluster Connection** field to see the endpoint you just added.</span></span>
12. <span data-ttu-id="d31c7-224">儲存發行定義。</span><span class="sxs-lookup"><span data-stu-id="d31c7-224">Save the release definition.</span></span>

> [!NOTE]
> <span data-ttu-id="d31c7-225">Microsoft 帳戶 (例如，@hotmail.com 或 @outlook.com) 不支援 Azure Active Directory 驗證。</span><span class="sxs-lookup"><span data-stu-id="d31c7-225">Microsoft Accounts (for example, @hotmail.com or @outlook.com) are not supported with Azure Active Directory authentication.</span></span>
> 
> 

<span data-ttu-id="d31c7-226">建立的定義包含一項工作類型 **Service Fabric 應用程式部署**。</span><span class="sxs-lookup"><span data-stu-id="d31c7-226">The definition that is created consists of one task of type **Service Fabric Application Deployment**.</span></span> <span data-ttu-id="d31c7-227">如需此工作的詳細資訊，請參閱 [工作文件頁面](https://go.microsoft.com/fwlink/?LinkId=820528) 。</span><span class="sxs-lookup"><span data-stu-id="d31c7-227">See the [task documentation page](https://go.microsoft.com/fwlink/?LinkId=820528) for more information about this task.</span></span>

### <a name="verify-the-template-defaults"></a><span data-ttu-id="d31c7-228">確認範本預設值</span><span class="sxs-lookup"><span data-stu-id="d31c7-228">Verify the template defaults</span></span>
1. <span data-ttu-id="d31c7-229">確認 [部署 Service Fabric 應用程式] 工作的 [發行設定檔] 輸入欄位。</span><span class="sxs-lookup"><span data-stu-id="d31c7-229">Verify the **Publish Profile** input field for the **Deploy Service Fabric Application** task.</span></span> <span data-ttu-id="d31c7-230">根據預設，此欄位會參考組建的構件中包含的發行設定檔 (名為 Cloud.xml)。</span><span class="sxs-lookup"><span data-stu-id="d31c7-230">By default, this field references a publish profile named Cloud.xml contained in the build's artifacts.</span></span> <span data-ttu-id="d31c7-231">如果您想要參考不同的發行設定檔，或如果組建的構件中包含多個應用程式套件，您必須適當地更新路徑。</span><span class="sxs-lookup"><span data-stu-id="d31c7-231">If you want to reference a different publish profile or if the build contains multiple application packages in its artifacts, you need to update the path appropriately.</span></span>
2. <span data-ttu-id="d31c7-232">確認 [部署 Service Fabric 應用程式] 工作的 [應用程式套件] 輸入欄位。</span><span class="sxs-lookup"><span data-stu-id="d31c7-232">Verify the **Application Package** input field for the **Deploy Service Fabric Application** task.</span></span> <span data-ttu-id="d31c7-233">根據預設，此欄位會參考組建定義範本中使用的預設應用程式套件路徑。</span><span class="sxs-lookup"><span data-stu-id="d31c7-233">By default, this field references the default application package path used in the build definition template.</span></span>  <span data-ttu-id="d31c7-234">如果您已經修改組建定義中的預設應用程式套件路徑，您也必須在此適當地更新路徑。</span><span class="sxs-lookup"><span data-stu-id="d31c7-234">If you've modified the default application package path in the build definition, you need to update the path appropriately here as well.</span></span>

### <a name="try-it"></a><span data-ttu-id="d31c7-235">試試看</span><span class="sxs-lookup"><span data-stu-id="d31c7-235">Try it</span></span>
<span data-ttu-id="d31c7-236">從 [發行] 按鈕功能表上選取 [建立發行] 以手動建立發行。</span><span class="sxs-lookup"><span data-stu-id="d31c7-236">Select **Create Release** from the **Release** button menu to manually create a release.</span></span> <span data-ttu-id="d31c7-237">在開啟的對話方塊中，選取做為發行基準的組建，然後按一下 [建立] 。</span><span class="sxs-lookup"><span data-stu-id="d31c7-237">In the dialog that opens, select the build that you want to base the release on and then click **Create**.</span></span> <span data-ttu-id="d31c7-238">如果您啟用連續部署，當關聯的組建定義完成組建時，便會自動建立發行。</span><span class="sxs-lookup"><span data-stu-id="d31c7-238">If you enabled continuous deployment, releases will be created automatically when the associated build definition completes a build.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d31c7-239">後續步驟</span><span class="sxs-lookup"><span data-stu-id="d31c7-239">Next steps</span></span>
<span data-ttu-id="d31c7-240">若要深入了解與 Service Fabric 應用程式的連續整合，請閱讀下列文章：</span><span class="sxs-lookup"><span data-stu-id="d31c7-240">To learn more about continuous integration with Service Fabric applications, read the following articles:</span></span>

* [<span data-ttu-id="d31c7-241">Team Services 文件首頁</span><span class="sxs-lookup"><span data-stu-id="d31c7-241">Team Services documentation home</span></span>](https://www.visualstudio.com/docs/overview)
* [<span data-ttu-id="d31c7-242">Team Services 中的組建管理</span><span class="sxs-lookup"><span data-stu-id="d31c7-242">Build management in Team Services</span></span>](https://www.visualstudio.com/docs/build/overview)
* [<span data-ttu-id="d31c7-243">Team Services 中的發行管理</span><span class="sxs-lookup"><span data-stu-id="d31c7-243">Release management in Team Services</span></span>](https://www.visualstudio.com/docs/release/overview)

