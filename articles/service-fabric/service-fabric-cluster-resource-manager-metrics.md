---
title: "使用度量 aaaManage Azure 的微服務負載 |Microsoft 文件"
description: "深入了解如何 Service Fabric toomanage tooconfigure 和使用計量服務資源耗用量。"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 0d622ea6-a7c7-4bef-886b-06e6b85a97fb
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 592dc749ce30683a1e439a702b7d0dc0a638276f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="managing-resource-consumption-and-load-in-service-fabric-with-metrics"></a><span data-ttu-id="f116c-103">在 Service Fabric 中使用度量管理資源耗用量和負載</span><span class="sxs-lookup"><span data-stu-id="f116c-103">Managing resource consumption and load in Service Fabric with metrics</span></span>
<span data-ttu-id="f116c-104">*度量*hello hello 叢集中的節點提供您服務在意和其中的 hello 資源。</span><span class="sxs-lookup"><span data-stu-id="f116c-104">*Metrics* are hello resources that your services care about and which are provided by hello nodes in hello cluster.</span></span> <span data-ttu-id="f116c-105">度量是您想要在您的服務順序 tooimprove 或監視器 hello 效能 toomanage 的任何項目。</span><span class="sxs-lookup"><span data-stu-id="f116c-105">A metric is anything that you want toomanage in order tooimprove or monitor hello performance of your services.</span></span> <span data-ttu-id="f116c-106">例如，您可能會監看記憶體耗用量 tooknow 如果您的服務多載。</span><span class="sxs-lookup"><span data-stu-id="f116c-106">For example, you might watch memory consumption tooknow if your service is overloaded.</span></span> <span data-ttu-id="f116c-107">另一個用途是 toofigure 出是否 hello 服務無法移動其中的記憶體是小於順序 tooget 較佳的效能受到限制的其他位置。</span><span class="sxs-lookup"><span data-stu-id="f116c-107">Another use is toofigure out whether hello service could move elsewhere where memory is less constrained in order tooget better performance.</span></span>

<span data-ttu-id="f116c-108">像記憶體、磁碟 及 CPU 使用率等項目都是計量的範例。</span><span class="sxs-lookup"><span data-stu-id="f116c-108">Things like Memory, Disk, and CPU usage are examples of metrics.</span></span> <span data-ttu-id="f116c-109">這些度量資訊是實體的度量，對應 toophysical hello 需要 toobe 受管理的節點上的資源的資源。</span><span class="sxs-lookup"><span data-stu-id="f116c-109">These metrics are physical metrics, resources that correspond toophysical resources on hello node that need toobe managed.</span></span> <span data-ttu-id="f116c-110">計量也可以是 (且通常是) 邏輯計量。</span><span class="sxs-lookup"><span data-stu-id="f116c-110">Metrics can also be (and commonly are) logical metrics.</span></span> <span data-ttu-id="f116c-111">邏輯計量的範例是 “MyWorkQueueDepth”、"MessagesToProcess" 或 "TotalRecords" 之類的項目。</span><span class="sxs-lookup"><span data-stu-id="f116c-111">Logical metrics are things like “MyWorkQueueDepth” or "MessagesToProcess" or "TotalRecords".</span></span> <span data-ttu-id="f116c-112">邏輯度量是應用程式定義並間接對應 toosome 實體資源耗用量。</span><span class="sxs-lookup"><span data-stu-id="f116c-112">Logical metrics are application-defined and indirectly correspond toosome physical resource consumption.</span></span> <span data-ttu-id="f116c-113">邏輯度量資訊是常見的因為很難 toomeasure 和報表的每個服務為基礎的實體資源的耗用量。</span><span class="sxs-lookup"><span data-stu-id="f116c-113">Logical metrics are common because it can be hard toomeasure and report consumption of physical resources on a per-service basis.</span></span> <span data-ttu-id="f116c-114">hello 複雜度測量與報告自己實體度量也是為什麼 Service Fabric 提供某些預設度量資訊。</span><span class="sxs-lookup"><span data-stu-id="f116c-114">hello complexity of measuring and reporting your own physical metrics is also why Service Fabric provides some default metrics.</span></span>

## <a name="default-metrics"></a><span data-ttu-id="f116c-115">預設度量</span><span class="sxs-lookup"><span data-stu-id="f116c-115">Default metrics</span></span>
<span data-ttu-id="f116c-116">假設您想 tooget 啟動撰寫和部署您的服務。</span><span class="sxs-lookup"><span data-stu-id="f116c-116">Let’s say that you want tooget started writing and deploying your service.</span></span> <span data-ttu-id="f116c-117">此時，您不知道它會取用哪些實體或邏輯資源。</span><span class="sxs-lookup"><span data-stu-id="f116c-117">At this point you don’t know what physical or logical resources it consumes.</span></span> <span data-ttu-id="f116c-118">沒關係！</span><span class="sxs-lookup"><span data-stu-id="f116c-118">That’s fine!</span></span> <span data-ttu-id="f116c-119">hello Service Fabric 叢集資源管理員時指定其他度量資訊，請使用某些預設度量資訊。</span><span class="sxs-lookup"><span data-stu-id="f116c-119">hello Service Fabric Cluster Resource Manager uses some default metrics when no other metrics are specified.</span></span> <span data-ttu-id="f116c-120">如下：</span><span class="sxs-lookup"><span data-stu-id="f116c-120">They are:</span></span>

  - <span data-ttu-id="f116c-121">PrimaryCount-hello 節點上的主要複本的計數</span><span class="sxs-lookup"><span data-stu-id="f116c-121">PrimaryCount - count of Primary replicas on hello node</span></span> 
  - <span data-ttu-id="f116c-122">ReplicaCount-hello 節點上可設定狀態的複本總數的計數</span><span class="sxs-lookup"><span data-stu-id="f116c-122">ReplicaCount - count of total stateful replicas on hello node</span></span>
  - <span data-ttu-id="f116c-123">計數-所有服務上的物件 （無狀態與可設定狀態） hello 節點計數</span><span class="sxs-lookup"><span data-stu-id="f116c-123">Count - count of all service objects (stateless and stateful) on hello node</span></span>

| <span data-ttu-id="f116c-124">計量</span><span class="sxs-lookup"><span data-stu-id="f116c-124">Metric</span></span> | <span data-ttu-id="f116c-125">無狀態執行個體負載</span><span class="sxs-lookup"><span data-stu-id="f116c-125">Stateless Instance Load</span></span> | <span data-ttu-id="f116c-126">具狀態次要負載</span><span class="sxs-lookup"><span data-stu-id="f116c-126">Stateful Secondary Load</span></span> | <span data-ttu-id="f116c-127">具狀態主要負載</span><span class="sxs-lookup"><span data-stu-id="f116c-127">Stateful Primary Load</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="f116c-128">PrimaryCount</span><span class="sxs-lookup"><span data-stu-id="f116c-128">PrimaryCount</span></span> |<span data-ttu-id="f116c-129">0</span><span class="sxs-lookup"><span data-stu-id="f116c-129">0</span></span> |<span data-ttu-id="f116c-130">0</span><span class="sxs-lookup"><span data-stu-id="f116c-130">0</span></span> |<span data-ttu-id="f116c-131">1</span><span class="sxs-lookup"><span data-stu-id="f116c-131">1</span></span> |
| <span data-ttu-id="f116c-132">ReplicaCount</span><span class="sxs-lookup"><span data-stu-id="f116c-132">ReplicaCount</span></span> |<span data-ttu-id="f116c-133">0</span><span class="sxs-lookup"><span data-stu-id="f116c-133">0</span></span> |<span data-ttu-id="f116c-134">1</span><span class="sxs-lookup"><span data-stu-id="f116c-134">1</span></span> |<span data-ttu-id="f116c-135">1</span><span class="sxs-lookup"><span data-stu-id="f116c-135">1</span></span> |
| <span data-ttu-id="f116c-136">Count</span><span class="sxs-lookup"><span data-stu-id="f116c-136">Count</span></span> |<span data-ttu-id="f116c-137">1</span><span class="sxs-lookup"><span data-stu-id="f116c-137">1</span></span> |<span data-ttu-id="f116c-138">1</span><span class="sxs-lookup"><span data-stu-id="f116c-138">1</span></span> |<span data-ttu-id="f116c-139">1</span><span class="sxs-lookup"><span data-stu-id="f116c-139">1</span></span> |

<span data-ttu-id="f116c-140">針對基本的工作負載，hello 預設度量會提供工作 hello 叢集中的不錯分佈。</span><span class="sxs-lookup"><span data-stu-id="f116c-140">For basic workloads, hello default metrics provide a decent distribution of work in hello cluster.</span></span> <span data-ttu-id="f116c-141">在下列範例的 hello，我們來看看當我們建立兩個服務，並依賴 hello 預設度量平衡時，會發生什麼事。</span><span class="sxs-lookup"><span data-stu-id="f116c-141">In hello following example, let’s see what happens when we create two services and rely on hello default metrics for balancing.</span></span> <span data-ttu-id="f116c-142">hello 第一個服務具有三個資料分割的可設定狀態服務，目標複本集大小的三個。</span><span class="sxs-lookup"><span data-stu-id="f116c-142">hello first service is a stateful service with three partitions and a target replica set size of three.</span></span> <span data-ttu-id="f116c-143">hello 第二個服務是無狀態服務具有一個資料分割和三個執行個體計數。</span><span class="sxs-lookup"><span data-stu-id="f116c-143">hello second service is a stateless service with one partition and an instance count of three.</span></span>

<span data-ttu-id="f116c-144">以下是您將看到的情況：</span><span class="sxs-lookup"><span data-stu-id="f116c-144">Here's what you get:</span></span>

<span data-ttu-id="f116c-145"><center>
![使用預設計量的叢集配置][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="f116c-145"><center>
![Cluster Layout with Default Metrics][Image1]
</center></span></span>

<span data-ttu-id="f116c-146">某些事項 toonote:</span><span class="sxs-lookup"><span data-stu-id="f116c-146">Some things toonote:</span></span>
  - <span data-ttu-id="f116c-147">Hello 可設定狀態服務的主要複本會分散到數個節點</span><span class="sxs-lookup"><span data-stu-id="f116c-147">Primary replicas for hello stateful service are distributed across several nodes</span></span>
  - <span data-ttu-id="f116c-148">Hello 不同節點是相同的資料分割的複本</span><span class="sxs-lookup"><span data-stu-id="f116c-148">Replicas for hello same partition are on different nodes</span></span>
  - <span data-ttu-id="f116c-149">hello 叢集中發佈的主要複本會與次要複本的 hello 總數</span><span class="sxs-lookup"><span data-stu-id="f116c-149">hello total number of primaries and secondaries is distributed in hello cluster</span></span>
  - <span data-ttu-id="f116c-150">平均每個節點上配置的服務物件的 hello 總數</span><span class="sxs-lookup"><span data-stu-id="f116c-150">hello total number of service objects are evenly allocated on each node</span></span>

<span data-ttu-id="f116c-151">很好！</span><span class="sxs-lookup"><span data-stu-id="f116c-151">Good!</span></span>

<span data-ttu-id="f116c-152">hello 預設計量很大，是個起點。</span><span class="sxs-lookup"><span data-stu-id="f116c-152">hello default metrics work great as a start.</span></span> <span data-ttu-id="f116c-153">不過，hello 預設計量將只執行您到目前為止。</span><span class="sxs-lookup"><span data-stu-id="f116c-153">However, hello default metrics will only carry you so far.</span></span> <span data-ttu-id="f116c-154">例如： 中完全甚至使用率何謂 hello 可能性 hello 資料分割配置您挑選的結果的所有磁碟分割？</span><span class="sxs-lookup"><span data-stu-id="f116c-154">For example: What's hello likelihood that hello partitioning scheme you picked results in perfectly even utilization by all partitions?</span></span> <span data-ttu-id="f116c-155">何謂 hello 負載指定服務的 hello 機率經過一段時間，是常數，或甚至只 hello 相同跨多個分割區現在嗎？</span><span class="sxs-lookup"><span data-stu-id="f116c-155">What’s hello chance that hello load for a given service is constant over time, or even just hello same across multiple partitions right now?</span></span>

<span data-ttu-id="f116c-156">您可以執行包含只 hello 預設度量。</span><span class="sxs-lookup"><span data-stu-id="f116c-156">You could run with just hello default metrics.</span></span> <span data-ttu-id="f116c-157">不過，這樣通常表示叢集使用率較低，比您想要的更不平均。</span><span class="sxs-lookup"><span data-stu-id="f116c-157">However, doing so usually means that your cluster utilization is lower and more uneven than you’d like.</span></span> <span data-ttu-id="f116c-158">這是因為 hello 預設計量不是自動調整，以及假設所有項目相當。</span><span class="sxs-lookup"><span data-stu-id="f116c-158">This is because hello default metrics aren't adaptive and presume everything is equivalent.</span></span> <span data-ttu-id="f116c-159">例如，忙線中的主要複本，另一個則不是這兩個參與"1"toohello PrimaryCount 度量。</span><span class="sxs-lookup"><span data-stu-id="f116c-159">For example, a Primary that is busy and one that is not both contribute "1" toohello PrimaryCount metric.</span></span> <span data-ttu-id="f116c-160">Hello 最壞的情況下，使用 hello 預設度量也造成效能問題所導致的 overscheduled 節點。</span><span class="sxs-lookup"><span data-stu-id="f116c-160">In hello worst case, using only hello default metrics can also result in overscheduled nodes resulting in performance issues.</span></span> <span data-ttu-id="f116c-161">如果您想要以取得 hello 大部分超出您的叢集，並避免效能問題，您需要 toouse 自訂計量與動態載入報表。</span><span class="sxs-lookup"><span data-stu-id="f116c-161">If you're interested in getting hello most out of your cluster and avoiding performance issues, you need toouse custom metrics and dynamic load reporting.</span></span>

## <a name="custom-metrics"></a><span data-ttu-id="f116c-162">自訂度量</span><span class="sxs-lookup"><span data-stu-id="f116c-162">Custom metrics</span></span>
<span data-ttu-id="f116c-163">度量資訊會在您要建立 hello 服務時，設定個別具名-服務-執行個體為基礎。</span><span class="sxs-lookup"><span data-stu-id="f116c-163">Metrics are configured on a per-named-service-instance basis when you’re creating hello service.</span></span>

<span data-ttu-id="f116c-164">任何計量都有一些描述它的屬性：名稱、權數及預設負載。</span><span class="sxs-lookup"><span data-stu-id="f116c-164">Any metric has some properties that describe it: a name, a weight, and a default load.</span></span>

* <span data-ttu-id="f116c-165">度量名稱： hello hello 度量名稱。</span><span class="sxs-lookup"><span data-stu-id="f116c-165">Metric Name: hello name of hello metric.</span></span> <span data-ttu-id="f116c-166">hello 衡量標準名稱是從 hello 資源管理員的觀點來看 hello 叢集內的 hello 度量的唯一識別碼。</span><span class="sxs-lookup"><span data-stu-id="f116c-166">hello metric name is a unique identifier for hello metric within hello cluster from hello Resource Manager’s perspective.</span></span>
* <span data-ttu-id="f116c-167">加權： 重要性此計量會相對 toohello 衡量標準權數定義此服務的其他度量資訊。</span><span class="sxs-lookup"><span data-stu-id="f116c-167">Weight: Metric weight defines how important this metric is relative toohello other metrics for this service.</span></span>
* <span data-ttu-id="f116c-168">預設值載入： hello 預設負載的表示方式會根據 hello 服務是無狀態或可設定狀態。</span><span class="sxs-lookup"><span data-stu-id="f116c-168">Default Load: hello default load is represented differently depending on whether hello service is stateless or stateful.</span></span>
  * <span data-ttu-id="f116c-169">就無狀態服務而言，每個計量都有名為 DefaultLoad 的單一屬性</span><span class="sxs-lookup"><span data-stu-id="f116c-169">For stateless services, each metric has a single property named DefaultLoad</span></span>
  * <span data-ttu-id="f116c-170">針對具狀態服務，您需定義：</span><span class="sxs-lookup"><span data-stu-id="f116c-170">For stateful services you define:</span></span>
    * <span data-ttu-id="f116c-171">此服務使用時，它主要這個標準的 primaryDefaultLoad: hello 預設量</span><span class="sxs-lookup"><span data-stu-id="f116c-171">PrimaryDefaultLoad: hello default amount of this metric this service consumes when it is a Primary</span></span>
    * <span data-ttu-id="f116c-172">此服務使用次要複本時此標準的 secondaryDefaultLoad: hello 預設數量</span><span class="sxs-lookup"><span data-stu-id="f116c-172">SecondaryDefaultLoad: hello default amount of this metric this service consumes when it is a Secondary</span></span>

> [!NOTE]
> <span data-ttu-id="f116c-173">如果您定義自訂的度量，而您想 too_also_ 使用 hello 預設度量，您需要 too_explicitly_ 新增 hello 預設計量備份，並為其定義加權和值。</span><span class="sxs-lookup"><span data-stu-id="f116c-173">If you define custom metrics and you want too_also_ use hello default metrics, you need too_explicitly_ add hello default metrics back and define weights and values for them.</span></span> <span data-ttu-id="f116c-174">這是因為您必須定義 hello hello 預設計量和自訂的度量之間的關聯性。</span><span class="sxs-lookup"><span data-stu-id="f116c-174">This is because you must define hello relationship between hello default metrics and your custom metrics.</span></span> <span data-ttu-id="f116c-175">例如，也許您會在意 ConnectionCount 或 WorkQueueDepth 更甚於主要分配。</span><span class="sxs-lookup"><span data-stu-id="f116c-175">For example, maybe you care about ConnectionCount or WorkQueueDepth more than Primary distribution.</span></span> <span data-ttu-id="f116c-176">依預設 hello 權數的 hello PrimaryCount 度量是高，所以您想 tooreduce 它 tooMedium 時新增這些對應優先您其他度量 tooensure。</span><span class="sxs-lookup"><span data-stu-id="f116c-176">By default hello weight of hello PrimaryCount metric is High, so you want tooreduce it tooMedium when you add your other metrics tooensure they take precedence.</span></span>
>

### <a name="defining-metrics-for-your-service---an-example"></a><span data-ttu-id="f116c-177">為您的服務定義計量 - 範例</span><span class="sxs-lookup"><span data-stu-id="f116c-177">Defining metrics for your service - an example</span></span>
<span data-ttu-id="f116c-178">例如，假設您想 hello 下列組態：</span><span class="sxs-lookup"><span data-stu-id="f116c-178">Let’s say you want hello following configuration:</span></span>

  - <span data-ttu-id="f116c-179">您的服務報告名為 "ConnectionCount” 的計量</span><span class="sxs-lookup"><span data-stu-id="f116c-179">Your service reports a metric named "ConnectionCount”</span></span>
  - <span data-ttu-id="f116c-180">您也想 toouse hello 預設計量</span><span class="sxs-lookup"><span data-stu-id="f116c-180">You also want toouse hello default metrics</span></span> 
  - <span data-ttu-id="f116c-181">您已經完成一些測量，而知道該服務的主要複本通常佔用 20 單位的 "ConnectionCount"。</span><span class="sxs-lookup"><span data-stu-id="f116c-181">You’ve done some measurements and know that normally a Primary replica of that service takes up 20 units of "ConnectionCount"</span></span>
  - <span data-ttu-id="f116c-182">而次要複本則佔用 5 單位的 "ConnectionCount"</span><span class="sxs-lookup"><span data-stu-id="f116c-182">Secondaries use 5 units of "ConnectionCount"</span></span>
  - <span data-ttu-id="f116c-183">您知道"ConnectionCount 」 是 hello 以管理此特定服務的 hello 效能最重要的度量</span><span class="sxs-lookup"><span data-stu-id="f116c-183">You know that "ConnectionCount" is hello most important metric in terms of managing hello performance of this particular service</span></span>
  - <span data-ttu-id="f116c-184">但您仍然希望主要複本達到平衡。</span><span class="sxs-lookup"><span data-stu-id="f116c-184">You still want Primary replicas balanced.</span></span> <span data-ttu-id="f116c-185">無論如何，平衡主要複本通常是個不錯的主意。</span><span class="sxs-lookup"><span data-stu-id="f116c-185">Balancing primary replicas is generally a good idea no matter what.</span></span> <span data-ttu-id="f116c-186">這有助於防止 hello 遺失某些節點或容錯網域的影響以及它的主要複本的多數。</span><span class="sxs-lookup"><span data-stu-id="f116c-186">This helps prevent hello loss of some node or fault domain from impacting a majority of primary replicas along with it.</span></span> 
  - <span data-ttu-id="f116c-187">否則，hello 預設計量是正常</span><span class="sxs-lookup"><span data-stu-id="f116c-187">Otherwise, hello default metrics are fine</span></span>

<span data-ttu-id="f116c-188">Hello 程式碼，您會撰寫 toocreate 服務與該度量的組態如下：</span><span class="sxs-lookup"><span data-stu-id="f116c-188">Here’s hello code that you would write toocreate a service with that metric configuration:</span></span>

<span data-ttu-id="f116c-189">程式碼：</span><span class="sxs-lookup"><span data-stu-id="f116c-189">Code:</span></span>

```csharp
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
StatefulServiceLoadMetricDescription connectionMetric = new StatefulServiceLoadMetricDescription();
connectionMetric.Name = "ConnectionCount";
connectionMetric.PrimaryDefaultLoad = 20;
connectionMetric.SecondaryDefaultLoad = 5;
connectionMetric.Weight = ServiceLoadMetricWeight.High;

StatefulServiceLoadMetricDescription primaryCountMetric = new StatefulServiceLoadMetricDescription();
primaryCountMetric.Name = "PrimaryCount";
primaryCountMetric.PrimaryDefaultLoad = 1;
primaryCountMetric.SecondaryDefaultLoad = 0;
primaryCountMetric.Weight = ServiceLoadMetricWeight.Medium;

StatefulServiceLoadMetricDescription replicaCountMetric = new StatefulServiceLoadMetricDescription();
replicaCountMetric.Name = "ReplicaCount";
replicaCountMetric.PrimaryDefaultLoad = 1;
replicaCountMetric.SecondaryDefaultLoad = 1;
replicaCountMetric.Weight = ServiceLoadMetricWeight.Low;

StatefulServiceLoadMetricDescription totalCountMetric = new StatefulServiceLoadMetricDescription();
totalCountMetric.Name = "Count";
totalCountMetric.PrimaryDefaultLoad = 1;
totalCountMetric.SecondaryDefaultLoad = 1;
totalCountMetric.Weight = ServiceLoadMetricWeight.Low;

serviceDescription.Metrics.Add(connectionMetric);
serviceDescription.Metrics.Add(primaryCountMetric);
serviceDescription.Metrics.Add(replicaCountMetric);
serviceDescription.Metrics.Add(totalCountMetric);

await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="f116c-190">PowerShell：</span><span class="sxs-lookup"><span data-stu-id="f116c-190">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName –Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton –Metric @("ConnectionCount,High,20,5”,"PrimaryCount,Medium,1,0”,"ReplicaCount,Low,1,1”,"Count,Low,1,1”)
```

> [!NOTE]
> <span data-ttu-id="f116c-191">hello 上述範例與 hello 本文的其餘部分將描述管理度量上名為-針對服務。</span><span class="sxs-lookup"><span data-stu-id="f116c-191">hello above examples and hello rest of this document describe managing metrics on a per-named-service basis.</span></span> <span data-ttu-id="f116c-192">它也是您在 hello 服務的服務可能 toodefine 度量_類型_層級。</span><span class="sxs-lookup"><span data-stu-id="f116c-192">It is also possible toodefine metrics for your services at hello service _type_ level.</span></span> <span data-ttu-id="f116c-193">這會透過在您的服務資訊清單中指定它們來完成。</span><span class="sxs-lookup"><span data-stu-id="f116c-193">This is accomplished by specifying them in your service manifests.</span></span> <span data-ttu-id="f116c-194">不建議定義類型層級度量有幾個原因。</span><span class="sxs-lookup"><span data-stu-id="f116c-194">Defining type level metrics is not recommended for several reasons.</span></span> <span data-ttu-id="f116c-195">hello 第一個原因是，度量名稱要經常特定的環境。</span><span class="sxs-lookup"><span data-stu-id="f116c-195">hello first reason is that metric names are frequently environment-specific.</span></span> <span data-ttu-id="f116c-196">除非就地確實的合約，就無法確定在一個環境中的 hello 度量"核心"不在其他"MiliCores 」 或 「 核心"。</span><span class="sxs-lookup"><span data-stu-id="f116c-196">Unless there is a firm contract in place, you cannot be sure that hello metric "Cores" in one environment isn't "MiliCores" or "CoReS" in others.</span></span> <span data-ttu-id="f116c-197">如果您的度量定義資訊清單中您會需要 toocreate 每個環境的新資訊清單。</span><span class="sxs-lookup"><span data-stu-id="f116c-197">If your metrics are defined in your manifest you need toocreate new manifests per environment.</span></span> <span data-ttu-id="f116c-198">這讓 tooa 激增不同的資訊清單有只有些許差異，這可能會導致 toomanagement 困難。</span><span class="sxs-lookup"><span data-stu-id="f116c-198">This usually leads tooa proliferation of different manifests with only minor differences, which can lead toomanagement difficulties.</span></span>  
>
> <span data-ttu-id="f116c-199">計量負載通常會為每個具名服務執行個體指派。</span><span class="sxs-lookup"><span data-stu-id="f116c-199">Metric loads are commonly assigned on a per-named-service-instance basis.</span></span> <span data-ttu-id="f116c-200">例如，假設您建立一個執行個體的 hello 服務人員計劃 toouse CustomerA 它根本很少。</span><span class="sxs-lookup"><span data-stu-id="f116c-200">For example, let's say you create one instance of hello service for CustomerA who plans toouse it only lightly.</span></span> <span data-ttu-id="f116c-201">同時假設您為 CustomerB 建立另一個執行個體，該客戶有更大的工作負載。</span><span class="sxs-lookup"><span data-stu-id="f116c-201">Let's also say you create another for CustomerB who has a larger workload.</span></span> <span data-ttu-id="f116c-202">在此情況下，您可能會想 tootweak hello 預設載入這些服務。</span><span class="sxs-lookup"><span data-stu-id="f116c-202">In this case, you'd probably want tootweak hello default loads for those services.</span></span> <span data-ttu-id="f116c-203">如果您有度量，並定義資訊清單，然後透過載入想 toosupport 這種情況下，它可以針對每個客戶需要不同的應用程式和服務類型。</span><span class="sxs-lookup"><span data-stu-id="f116c-203">If you have metrics and loads defined via manifests and you want toosupport this scenario, it requires different application and service types for each customer.</span></span> <span data-ttu-id="f116c-204">在服務建立時定義的 hello 值會覆寫在 hello 資訊清單中定義，因此您可以使用該 tooset hello 特定預設值。</span><span class="sxs-lookup"><span data-stu-id="f116c-204">hello values defined at service creation time override those defined in hello manifest, so you could use that tooset hello specific defaults.</span></span> <span data-ttu-id="f116c-205">不過，這樣會導致 hello hello 資訊清單 toonot 這些 hello 服務實際上會以執行的相符項目中所宣告的值。</span><span class="sxs-lookup"><span data-stu-id="f116c-205">However, doing that causes hello values declared in hello manifests toonot match those hello service actually runs with.</span></span> <span data-ttu-id="f116c-206">這可能會導致 tooconfusion。</span><span class="sxs-lookup"><span data-stu-id="f116c-206">This can lead tooconfusion.</span></span> 
>

<span data-ttu-id="f116c-207">提醒： 如果您只想 toouse hello 預設度量，不需要 tootouch hello 度量收集或建立您的服務時執行任何特殊的動作。</span><span class="sxs-lookup"><span data-stu-id="f116c-207">As a reminder: if you just want toouse hello default metrics, you don’t need tootouch hello metrics collection at all or do anything special when creating your service.</span></span> <span data-ttu-id="f116c-208">當沒有其他已定義時，取得會自動使用 hello 預設計量。</span><span class="sxs-lookup"><span data-stu-id="f116c-208">hello default metrics get used automatically when no others are defined.</span></span> 

<span data-ttu-id="f116c-209">現在，我們再逐行更詳細的這些設定，並討論有關它所影響的 hello 行為延伸模組。</span><span class="sxs-lookup"><span data-stu-id="f116c-209">Now, let's go through each of these settings in more detail and talk about hello behavior that it influences.</span></span>

## <a name="load"></a><span data-ttu-id="f116c-210">載入</span><span class="sxs-lookup"><span data-stu-id="f116c-210">Load</span></span>
<span data-ttu-id="f116c-211">hello 定義度量的重點是 toorepresent 一些負荷。</span><span class="sxs-lookup"><span data-stu-id="f116c-211">hello whole point of defining metrics is toorepresent some load.</span></span> <span data-ttu-id="f116c-212">「負載」係指特定節點上的某個服務執行個體或複本取用的特定計量數量。</span><span class="sxs-lookup"><span data-stu-id="f116c-212">*Load* is how much of a given metric is consumed by some service instance or replica on a given node.</span></span> <span data-ttu-id="f116c-213">隨時可以設定負載。</span><span class="sxs-lookup"><span data-stu-id="f116c-213">Load can be configured at almost any point.</span></span> <span data-ttu-id="f116c-214">例如：</span><span class="sxs-lookup"><span data-stu-id="f116c-214">For example:</span></span>

  - <span data-ttu-id="f116c-215">建立服務時，可以定義負載。</span><span class="sxs-lookup"><span data-stu-id="f116c-215">Load can be defined when a service is created.</span></span> <span data-ttu-id="f116c-216">這稱為_預設負載_。</span><span class="sxs-lookup"><span data-stu-id="f116c-216">This is called _default load_.</span></span>
  - <span data-ttu-id="f116c-217">建立 hello 服務之後，可以更新服務載入 hello 度量資訊，包括預設值。</span><span class="sxs-lookup"><span data-stu-id="f116c-217">hello metric information, including default loads, for a service can updated after hello service is created.</span></span> <span data-ttu-id="f116c-218">這稱為_更新服務_。</span><span class="sxs-lookup"><span data-stu-id="f116c-218">This is called _updating a service_.</span></span> 
  - <span data-ttu-id="f116c-219">hello 載入給定資料分割可以重設 toohello 預設值，該服務。</span><span class="sxs-lookup"><span data-stu-id="f116c-219">hello loads for a given partition can be reset toohello default values for that service.</span></span> <span data-ttu-id="f116c-220">這稱為_重設資料分割負載_。</span><span class="sxs-lookup"><span data-stu-id="f116c-220">This is called _resetting partition load_.</span></span>
  - <span data-ttu-id="f116c-221">負載可以每個服務物件為基礎，在執行階段以動態方式報告。</span><span class="sxs-lookup"><span data-stu-id="f116c-221">Load can be reported on a per service object basis dynamically during runtime.</span></span> <span data-ttu-id="f116c-222">這稱為_報告負載_。</span><span class="sxs-lookup"><span data-stu-id="f116c-222">This is called _reporting load_.</span></span> 
  
<span data-ttu-id="f116c-223">所有這些策略可用於其存留期相同服務的 hello。</span><span class="sxs-lookup"><span data-stu-id="f116c-223">All of these strategies can be used within hello same service over its lifetime.</span></span> 

## <a name="default-load"></a><span data-ttu-id="f116c-224">預設負載</span><span class="sxs-lookup"><span data-stu-id="f116c-224">Default load</span></span>
<span data-ttu-id="f116c-225">*預設負載*多少 hello 度量取用此服務每個服務物件 （無狀態的執行個體或可設定狀態的複本）。</span><span class="sxs-lookup"><span data-stu-id="f116c-225">*Default load* is how much of hello metric each service object (stateless instance or stateful replica) of this service consumes.</span></span> <span data-ttu-id="f116c-226">hello 叢集資源管理員會使用這個數字 hello 服務物件的 hello 負載，直到其接收到的其他資訊，例如動態載入報表。</span><span class="sxs-lookup"><span data-stu-id="f116c-226">hello Cluster Resource Manager uses this number for hello load of hello service object until it receives other information, such as a dynamic load report.</span></span> <span data-ttu-id="f116c-227">針對簡單服務，hello 預設負載會是靜態的定義。</span><span class="sxs-lookup"><span data-stu-id="f116c-227">For simpler services, hello default load is a static definition.</span></span> <span data-ttu-id="f116c-228">hello 預設載入不會再更新，並用於 hello hello 服務存留期間。</span><span class="sxs-lookup"><span data-stu-id="f116c-228">hello default load is never updated and is used for hello lifetime of hello service.</span></span> <span data-ttu-id="f116c-229">預設值載入簡單的容量規劃特定資源數量是專用的 toodifferent 工作負載，而不會變更的效果很好。</span><span class="sxs-lookup"><span data-stu-id="f116c-229">Default loads works great for simple capacity planning scenarios where certain amounts of resources are dedicated toodifferent workloads and do not change.</span></span>

> [!NOTE]
> <span data-ttu-id="f116c-230">如需有關容量管理和叢集中定義 hello 節點容量的詳細資訊，請參閱[本文](service-fabric-cluster-resource-manager-cluster-description.md#capacity)。</span><span class="sxs-lookup"><span data-stu-id="f116c-230">For more information on capacity management and defining capacities for hello nodes in your cluster, please see [this article](service-fabric-cluster-resource-manager-cluster-description.md#capacity).</span></span>
> 

<span data-ttu-id="f116c-231">hello 叢集資源管理員可讓您可設定狀態服務 toospecify 不同的預設載入其主要複本會與次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="f116c-231">hello Cluster Resource Manager allows stateful services toospecify a different default load for their Primaries and Secondaries.</span></span> <span data-ttu-id="f116c-232">無狀態服務只能指定一個適用於 tooall 執行個體的值。</span><span class="sxs-lookup"><span data-stu-id="f116c-232">Stateless services can only specify one value that applies tooall instances.</span></span> <span data-ttu-id="f116c-233">可設定狀態服務，主要和次要複本的 hello 預設負載是工作的通常不同，因為複本執行不同類型的每個角色中。</span><span class="sxs-lookup"><span data-stu-id="f116c-233">For stateful services, hello default load for Primary and Secondary replicas are typically different since replicas do different kinds of work in each role.</span></span> <span data-ttu-id="f116c-234">例如，主要複本會通常讀取和寫入，而處理大部分的 hello 計算負擔，但不需要次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="f116c-234">For example, Primaries usually serve both reads and writes, and handle most of hello computational burden, while secondaries do not.</span></span> <span data-ttu-id="f116c-235">通常是主要複本的 hello 預設負載高於 hello 預設負載的次要複本。</span><span class="sxs-lookup"><span data-stu-id="f116c-235">Usually hello default load for a primary replica is higher than hello default load for secondary replicas.</span></span> <span data-ttu-id="f116c-236">hello 實際數字應該取決於您自己的量值。</span><span class="sxs-lookup"><span data-stu-id="f116c-236">hello real numbers should depend on your own measurements.</span></span>

## <a name="dynamic-load"></a><span data-ttu-id="f116c-237">動態負載</span><span class="sxs-lookup"><span data-stu-id="f116c-237">Dynamic load</span></span>
<span data-ttu-id="f116c-238">假設您已經執行服務達一段時間。</span><span class="sxs-lookup"><span data-stu-id="f116c-238">Let’s say that you’ve been running your service for a while.</span></span> <span data-ttu-id="f116c-239">藉由一些監視，您已注意到：</span><span class="sxs-lookup"><span data-stu-id="f116c-239">With some monitoring, you’ve noticed that:</span></span>

1. <span data-ttu-id="f116c-240">所指定服務的某些資料分割或執行個體比其他資料分割或執行個體耗用更多資源</span><span class="sxs-lookup"><span data-stu-id="f116c-240">Some partitions or instances of a given service consume more resources than others</span></span>
2. <span data-ttu-id="f116c-241">某些服務的負載會隨著時間改變。</span><span class="sxs-lookup"><span data-stu-id="f116c-241">Some services have load that varies over time.</span></span>

<span data-ttu-id="f116c-242">有很多原因可能造成這些類型的負載變動。</span><span class="sxs-lookup"><span data-stu-id="f116c-242">There's lots of things that could cause these types of load fluctuations.</span></span> <span data-ttu-id="f116c-243">例如，不同的服務或資料分割會與具有不同需求的不同客戶相關聯。</span><span class="sxs-lookup"><span data-stu-id="f116c-243">For example, different services or partitions are associated with different customers with different requirements.</span></span> <span data-ttu-id="f116c-244">由於工作 hello 服務的 hello 數量並隨著 hello 課程 hello 每日，也可以變更負載。</span><span class="sxs-lookup"><span data-stu-id="f116c-244">Load could also change because hello amount of work hello service does varies over hello course of hello day.</span></span> <span data-ttu-id="f116c-245">不論 hello 原因，所以通常沒有您可以使用預設的單一數字。</span><span class="sxs-lookup"><span data-stu-id="f116c-245">Regardless of hello reason, there’s usually no single number that you can use for default.</span></span> <span data-ttu-id="f116c-246">特別是如果您想 tooget hello 移出 hello 叢集的大部分使用率。</span><span class="sxs-lookup"><span data-stu-id="f116c-246">This is especially true if you want tooget hello most utilization out of hello cluster.</span></span> <span data-ttu-id="f116c-247">您挑選為預設負載錯誤 hello 時間部分的任何值。</span><span class="sxs-lookup"><span data-stu-id="f116c-247">Any value you pick for default load is wrong some of hello time.</span></span> <span data-ttu-id="f116c-248">不正確的預設載入 hello 叢集資源管理員透過或下配置資源中的結果。</span><span class="sxs-lookup"><span data-stu-id="f116c-248">Incorrect default loads result in hello Cluster Resource Manager either over or under allocating resources.</span></span> <span data-ttu-id="f116c-249">如此一來，您有高於或低於利用即使 hello 叢集資源管理員認為平衡 hello 叢集的節點。</span><span class="sxs-lookup"><span data-stu-id="f116c-249">As a result, you have nodes that are over or under utilized even though hello Cluster Resource Manager thinks hello cluster is balanced.</span></span> <span data-ttu-id="f116c-250">由於預設負載提供初始放置的某些資訊，因此它們仍有其實用性，但是它們並無法反映實際工作負載的完整面貌。</span><span class="sxs-lookup"><span data-stu-id="f116c-250">Default loads are still good since they provide some information for initial placement, but they're not a complete story for real workloads.</span></span> <span data-ttu-id="f116c-251">tooaccurately 擷取變更的資源需求，hello 叢集資源管理員可在執行階段期間每個服務物件 tooupdate 它自己的負載。</span><span class="sxs-lookup"><span data-stu-id="f116c-251">tooaccurately capture changing resource requirements, hello Cluster Resource Manager allows each service object tooupdate its own load during runtime.</span></span> <span data-ttu-id="f116c-252">這稱為動態負載報告功能。</span><span class="sxs-lookup"><span data-stu-id="f116c-252">This is called dynamic load reporting.</span></span>

<span data-ttu-id="f116c-253">動態負載報告允許複本或執行個體 tooadjust 其配置/報告負載度量的超過存留期。</span><span class="sxs-lookup"><span data-stu-id="f116c-253">Dynamic load reports allow replicas or instances tooadjust their allocation/reported load of metrics over their lifetime.</span></span> <span data-ttu-id="f116c-254">閒置且未執行任何工作的服務複本或執行個體通常會回報使用少量的指定計量。</span><span class="sxs-lookup"><span data-stu-id="f116c-254">A service replica or instance that was cold and not doing any work would usually report that it was using low amounts of a given metric.</span></span> <span data-ttu-id="f116c-255">忙碌的複本或執行個體則會回報使用較多的資源。</span><span class="sxs-lookup"><span data-stu-id="f116c-255">A busy replica or instance would report that they are using more.</span></span>

<span data-ttu-id="f116c-256">報告每個複本或執行個體的負載可讓叢集資源管理員 tooreorganize hello hello 個別的服務物件 hello 叢集中。</span><span class="sxs-lookup"><span data-stu-id="f116c-256">Reporting load per replica or instance allows hello Cluster Resource Manager tooreorganize hello individual service objects in hello cluster.</span></span> <span data-ttu-id="f116c-257">重新組織 hello 服務，可協助確保他們取得所需要的 hello 資源。</span><span class="sxs-lookup"><span data-stu-id="f116c-257">Reorganizing hello services helps ensure that they get hello resources they require.</span></span> <span data-ttu-id="f116c-258">服務忙碌中有效地取得太"回收 」 從其他的複本或正在冷或執行較少工作的執行個體的資源。</span><span class="sxs-lookup"><span data-stu-id="f116c-258">Busy services effectively get too"reclaim" resources from other replicas or instances that are currently cold or doing less work.</span></span>

<span data-ttu-id="f116c-259">在可靠的服務，hello 程式碼 tooreport 載入以動態方式看起來像這樣：</span><span class="sxs-lookup"><span data-stu-id="f116c-259">Within Reliable Services, hello code tooreport load dynamically looks like this:</span></span>

<span data-ttu-id="f116c-260">程式碼：</span><span class="sxs-lookup"><span data-stu-id="f116c-260">Code:</span></span>

```csharp
this.Partition.ReportLoad(new List<LoadMetric> { new LoadMetric("CurrentConnectionCount", 1234), new LoadMetric("metric1", 42) });
```

<span data-ttu-id="f116c-261">服務可以報告在任何在建立時定義為它的 hello 計量。</span><span class="sxs-lookup"><span data-stu-id="f116c-261">A service can report on any of hello metrics defined for it at creation time.</span></span> <span data-ttu-id="f116c-262">如果服務報表，而不是為度量設定負載 toouse，Service Fabric 會忽略該報表。</span><span class="sxs-lookup"><span data-stu-id="f116c-262">If a service reports load for a metric that it is not configured toouse, Service Fabric ignores that report.</span></span> <span data-ttu-id="f116c-263">如果有其他度量報告在 hello 相同有效，這些報告所接受的時間。</span><span class="sxs-lookup"><span data-stu-id="f116c-263">If there are other metrics reported at hello same time that are valid, those reports are accepted.</span></span> <span data-ttu-id="f116c-264">服務程式碼可以測量並報告所有 hello 的度量它知道如何使用，而且運算子可以指定 hello 度量組態 toouse 而不需要 toochange hello 服務程式碼。</span><span class="sxs-lookup"><span data-stu-id="f116c-264">Service code can measure and report all hello metrics it knows how to, and operators can specify hello metric configuration toouse without having toochange hello service code.</span></span> 

### <a name="updating-a-services-metric-configuration"></a><span data-ttu-id="f116c-265">更新服務的計量設定</span><span class="sxs-lookup"><span data-stu-id="f116c-265">Updating a service's metric configuration</span></span>
<span data-ttu-id="f116c-266">與 hello 服務相關聯的度量的 hello 清單和即時 hello 服務時的這些度量的 hello 屬性也可以動態更新。</span><span class="sxs-lookup"><span data-stu-id="f116c-266">hello list of metrics associated with hello service, and hello properties of those metrics can be updated dynamically while hello service is live.</span></span> <span data-ttu-id="f116c-267">這樣可以進行實驗並具有彈性。</span><span class="sxs-lookup"><span data-stu-id="f116c-267">This allows for experimentation and flexibility.</span></span> <span data-ttu-id="f116c-268">非常有用的某些範例為：</span><span class="sxs-lookup"><span data-stu-id="f116c-268">Some examples of when this is useful are:</span></span>

  - <span data-ttu-id="f116c-269">針對特定服務停用具有錯誤報告的計量</span><span class="sxs-lookup"><span data-stu-id="f116c-269">disabling a metric with a buggy report for a particular service</span></span>
  - <span data-ttu-id="f116c-270">重新設定 hello 加權度量根據想要的行為</span><span class="sxs-lookup"><span data-stu-id="f116c-270">reconfiguring hello weights of metrics based on desired behavior</span></span>
  - <span data-ttu-id="f116c-271">hello 程式碼已經部署並透過其他機制進行驗證時，才可以啟用新的度量</span><span class="sxs-lookup"><span data-stu-id="f116c-271">enabling a new metric only after hello code has already been deployed and validated via other mechanisms</span></span>
  - <span data-ttu-id="f116c-272">變更服務，根據觀察到的行為和耗用量的 hello 預設負載</span><span class="sxs-lookup"><span data-stu-id="f116c-272">changing hello default load for a service based on observed behavior and consumption</span></span>

<span data-ttu-id="f116c-273">hello 主應用程式開發介面變更度量的組態是`FabricClient.ServiceManagementClient.UpdateServiceAsync`在 C# 和`Update-ServiceFabricService`在 PowerShell 中。</span><span class="sxs-lookup"><span data-stu-id="f116c-273">hello main APIs for changing metric configuration are `FabricClient.ServiceManagementClient.UpdateServiceAsync` in C# and `Update-ServiceFabricService` in PowerShell.</span></span> <span data-ttu-id="f116c-274">您指定使用這些 Api 的任何資訊會立即取代 hello 現有度量 hello 服務資訊。</span><span class="sxs-lookup"><span data-stu-id="f116c-274">Whatever information you specify with these APIs replaces hello existing metric information for hello service immediately.</span></span> 

## <a name="mixing-default-load-values-and-dynamic-load-reports"></a><span data-ttu-id="f116c-275">混用預設負載值和動態負載報告</span><span class="sxs-lookup"><span data-stu-id="f116c-275">Mixing default load values and dynamic load reports</span></span>
<span data-ttu-id="f116c-276">預設負載及動態負載可以用於 hello 相同的服務。</span><span class="sxs-lookup"><span data-stu-id="f116c-276">Default load and dynamic loads can be used for hello same service.</span></span> <span data-ttu-id="f116c-277">當服務利用預設負載和動態負載報告時，預設負載會作為預估值，直到動態報告出現為止。</span><span class="sxs-lookup"><span data-stu-id="f116c-277">When a service utilizes both default load and dynamic load reports, default load serves as an estimate until dynamic reports show up.</span></span> <span data-ttu-id="f116c-278">預設負載適合，因為它讓 hello 叢集資源管理員項目與 toowork。</span><span class="sxs-lookup"><span data-stu-id="f116c-278">Default load is good because it gives hello Cluster Resource Manager something toowork with.</span></span> <span data-ttu-id="f116c-279">hello 預設負載在建立時，允許 hello 叢集資源管理員 tooplace hello 良好的位置中的服務物件。</span><span class="sxs-lookup"><span data-stu-id="f116c-279">hello default load allows hello Cluster Resource Manager tooplace hello service objects in good locations when they are created.</span></span> <span data-ttu-id="f116c-280">如果未提供任何預設負載資訊，就會以隨機方式有效率地放置服務。</span><span class="sxs-lookup"><span data-stu-id="f116c-280">If no default load information is provided, placement of services is effectively random.</span></span> <span data-ttu-id="f116c-281">載入報表稍後到達時 hello 初始的隨機位置通常是錯誤且 hello 叢集資源管理員 toomove 服務。</span><span class="sxs-lookup"><span data-stu-id="f116c-281">When load reports arrive later hello initial random placement is often wrong and hello Cluster Resource Manager has toomove services.</span></span>

<span data-ttu-id="f116c-282">讓我們採用先前的範例，看看當我們加入一些自訂負載和動態負載報告功能時會發生什麼狀況。</span><span class="sxs-lookup"><span data-stu-id="f116c-282">Let’s take our previous example and see what happens when we add some custom metrics and dynamic load reporting.</span></span> <span data-ttu-id="f116c-283">在此範例中，我們使用 “MemoryInMb” 作為範例計量。</span><span class="sxs-lookup"><span data-stu-id="f116c-283">In this example, we use “MemoryInMb” as an example metric.</span></span>

> [!NOTE]
> <span data-ttu-id="f116c-284">記憶體是其中一個 hello 系統度量，Service Fabric 可以[資源控管](service-fabric-resource-governance.md)，並報告它是通常很困難。</span><span class="sxs-lookup"><span data-stu-id="f116c-284">Memory is one of hello system metrics that Service Fabric can [resource govern](service-fabric-resource-governance.md), and reporting it yourself is typically difficult.</span></span> <span data-ttu-id="f116c-285">我們不實際期待您 tooreport 記憶體耗用量。使用的記憶體為 hello hello 叢集資源管理員功能的相關協助 toolearning。</span><span class="sxs-lookup"><span data-stu-id="f116c-285">We don't actually expect you tooreport on Memory consumption; Memory is used here as an aid toolearning about hello capabilities of hello Cluster Resource Manager.</span></span>
>

<span data-ttu-id="f116c-286">讓我們假設為我們一開始建立 hello 具狀態服務以 hello 下列命令：</span><span class="sxs-lookup"><span data-stu-id="f116c-286">Let’s presume that we initially created hello stateful service with hello following command:</span></span>

<span data-ttu-id="f116c-287">PowerShell：</span><span class="sxs-lookup"><span data-stu-id="f116c-287">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName –Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton –Metric @("MemoryInMb,High,21,11”,"PrimaryCount,Medium,1,0”,"ReplicaCount,Low,1,1”,"Count,Low,1,1”)
```

<span data-ttu-id="f116c-288">提醒您，此語法是 ("MetricName, MetricWeight, PrimaryDefaultLoad, SecondaryDefaultLoad")。</span><span class="sxs-lookup"><span data-stu-id="f116c-288">As a reminder, this syntax is ("MetricName, MetricWeight, PrimaryDefaultLoad, SecondaryDefaultLoad").</span></span>

<span data-ttu-id="f116c-289">讓我們看看可能的叢集配置看起來如何︰</span><span class="sxs-lookup"><span data-stu-id="f116c-289">Let's see what one possible cluster layout could look like:</span></span>

<span data-ttu-id="f116c-290"><center>
![使用預設和自訂計量平衡的叢集][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="f116c-290"><center>
![Cluster Balanced with both Default and Custom metrics][Image2]
</center></span></span>

<span data-ttu-id="f116c-291">有幾件事值得一提：</span><span class="sxs-lookup"><span data-stu-id="f116c-291">Some things that are worth noting:</span></span>

* <span data-ttu-id="f116c-292">資料分割內的次要複本可以有自己的負載</span><span class="sxs-lookup"><span data-stu-id="f116c-292">Secondary replicas within a partition can each have their own load</span></span>
* <span data-ttu-id="f116c-293">整體 hello 度量尋找平衡。</span><span class="sxs-lookup"><span data-stu-id="f116c-293">Overall hello metrics look balanced.</span></span> <span data-ttu-id="f116c-294">記憶體 hello hello 最大值之間的比率，且最小的負載 1.75 (hello 節點以 hello 大部分負載 N3，hello 至少是 N2 和 28/16 = 1.75)。</span><span class="sxs-lookup"><span data-stu-id="f116c-294">For Memory, hello ratio between hello maximum and minimum load is 1.75 (hello node with hello most load is N3, hello least is N2, and 28/16 = 1.75).</span></span>

<span data-ttu-id="f116c-295">我們仍需要 tooexplain 事項錯誤：</span><span class="sxs-lookup"><span data-stu-id="f116c-295">There are some things that we still need tooexplain:</span></span>

* <span data-ttu-id="f116c-296">何者決定 1.75 的比率是否合理？</span><span class="sxs-lookup"><span data-stu-id="f116c-296">What determined whether a ratio of 1.75 was reasonable or not?</span></span> <span data-ttu-id="f116c-297">如何 hello 叢集資源管理員知道，是否夠好，或者如果沒有更多工作 toodo？</span><span class="sxs-lookup"><span data-stu-id="f116c-297">How does hello Cluster Resource Manager know if that’s good enough or if there is more work toodo?</span></span>
* <span data-ttu-id="f116c-298">何時發生平衡？</span><span class="sxs-lookup"><span data-stu-id="f116c-298">When does balancing happen?</span></span>
* <span data-ttu-id="f116c-299">記憶體的權數「很高」是什麼意思？</span><span class="sxs-lookup"><span data-stu-id="f116c-299">What does it mean that Memory was weighted “High”?</span></span>

## <a name="metric-weights"></a><span data-ttu-id="f116c-300">度量權數</span><span class="sxs-lookup"><span data-stu-id="f116c-300">Metric weights</span></span>
<span data-ttu-id="f116c-301">追蹤 hello 相同度量資訊，在不同的服務是很重要。</span><span class="sxs-lookup"><span data-stu-id="f116c-301">Tracking hello same metrics across different services is important.</span></span> <span data-ttu-id="f116c-302">全域檢視是允許 hello hello 叢集中的叢集資源管理員 tootrack 耗用量，節點平均分配耗用量，並確認節點不超過容量。</span><span class="sxs-lookup"><span data-stu-id="f116c-302">That global view is what allows hello Cluster Resource Manager tootrack consumption in hello cluster, balance consumption across nodes, and ensure that nodes don’t go over capacity.</span></span> <span data-ttu-id="f116c-303">不過，服務可能會有不同的檢視為 toohello 重要性的 hello 相同的度量。</span><span class="sxs-lookup"><span data-stu-id="f116c-303">However, services may have different views as toohello importance of hello same metric.</span></span> <span data-ttu-id="f116c-304">此外，在具有許多計量和許多服務的叢集中，可能並非所有計量都有完美平衡的解決方案。</span><span class="sxs-lookup"><span data-stu-id="f116c-304">Also, in a cluster with many metrics and lots of services, perfectly balanced solutions may not exist for all metrics.</span></span> <span data-ttu-id="f116c-305">Hello 叢集資源管理員如何處理這些情況？</span><span class="sxs-lookup"><span data-stu-id="f116c-305">How should hello Cluster Resource Manager handle these situations?</span></span>

<span data-ttu-id="f116c-306">衡量標準權數允許 hello 叢集資源管理員 toodecide toobalance hello 叢集化不完整的回應時。</span><span class="sxs-lookup"><span data-stu-id="f116c-306">Metric weights allow hello Cluster Resource Manager toodecide how toobalance hello cluster when there’s no perfect answer.</span></span> <span data-ttu-id="f116c-307">衡量標準權數也可讓叢集資源管理員 toobalance hello 特定服務以不同的方式。</span><span class="sxs-lookup"><span data-stu-id="f116c-307">Metric weights also allow hello Cluster Resource Manager toobalance specific services differently.</span></span> <span data-ttu-id="f116c-308">度量可以有四個不同的權數層級︰零、低、中和高。</span><span class="sxs-lookup"><span data-stu-id="f116c-308">Metrics can have four different weight levels: Zero, Low, Medium, and High.</span></span> <span data-ttu-id="f116c-309">在考量項目是否平衡時，權數為「零」的計量並沒有任何貢獻。</span><span class="sxs-lookup"><span data-stu-id="f116c-309">A metric with a weight of Zero contributes nothing when considering whether things are balanced or not.</span></span> <span data-ttu-id="f116c-310">不過，其負載仍參與 toocapacity 管理。</span><span class="sxs-lookup"><span data-stu-id="f116c-310">However, its load does still contribute toocapacity management.</span></span> <span data-ttu-id="f116c-311">具有「零」權數的計量仍然相當有用，並且經常作為服務行為和效能監視的一部分。</span><span class="sxs-lookup"><span data-stu-id="f116c-311">Metrics with Zero weight are still useful and are frequently used as a part of service behavior and performance monitoring.</span></span> <span data-ttu-id="f116c-312">[這篇文章](service-fabric-diagnostics-event-generation-infra.md)提供的監視度量的 hello 使用與您的服務診斷的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="f116c-312">[This article](service-fabric-diagnostics-event-generation-infra.md) provides more information on hello use of metrics for monitoring and diagnostics of your services.</span></span> 

<span data-ttu-id="f116c-313">hello 的不同度量的加權 hello 叢集中的實際影響是該 hello 叢集資源管理員會產生不同的解決方案。</span><span class="sxs-lookup"><span data-stu-id="f116c-313">hello real impact of different metric weights in hello cluster is that hello Cluster Resource Manager generates different solutions.</span></span> <span data-ttu-id="f116c-314">衡量標準權數告訴 hello 叢集資源管理員，某些度量資訊會比其他更重要。</span><span class="sxs-lookup"><span data-stu-id="f116c-314">Metric weights tell hello Cluster Resource Manager that certain metrics are more important than others.</span></span> <span data-ttu-id="f116c-315">當沒有任何完美的解決方案 hello 時，叢集資源管理員可以偏好平衡 hello 高加權的度量更好的解決方案。</span><span class="sxs-lookup"><span data-stu-id="f116c-315">When there's no perfect solution hello Cluster Resource Manager can prefer solutions which balance hello higher weighted metrics better.</span></span> <span data-ttu-id="f116c-316">如果服務認為特定計量不重要，它可能會發現對該計量的使用不平衡。</span><span class="sxs-lookup"><span data-stu-id="f116c-316">If a service thinks a particular metric is unimportant, it may find their use of that metric imbalanced.</span></span> <span data-ttu-id="f116c-317">這可讓另一個服務 tooget 某些度量資訊會是重要的 tooit 平均分配。</span><span class="sxs-lookup"><span data-stu-id="f116c-317">This allows another service tooget an even distribution of some metric that is important tooit.</span></span>

<span data-ttu-id="f116c-318">讓我們看看一些負載報告和不同的度量的範例加權 hello 叢集中不同的配置中的結果。</span><span class="sxs-lookup"><span data-stu-id="f116c-318">Let’s look at an example of some load reports and how different metric weights results in different allocations in hello cluster.</span></span> <span data-ttu-id="f116c-319">在此範例中，我們看到，切換 hello hello 度量相對權數會使叢集資源管理員 toocreate hello 的服務不同的排列方式。</span><span class="sxs-lookup"><span data-stu-id="f116c-319">In this example, we see that switching hello relative weight of hello metrics causes hello Cluster Resource Manager toocreate different arrangements of services.</span></span>

<span data-ttu-id="f116c-320"><center>
![計量權數範例及其對平衡解決方案的影響][Image3]
</center></span><span class="sxs-lookup"><span data-stu-id="f116c-320"><center>
![Metric Weight Example and Its Impact on Balancing Solutions][Image3]
</center></span></span>

<span data-ttu-id="f116c-321">在此範例中，有四個不同的服務，它們都針對兩個不同計量 (MetricA 和 MetricB) 報告不同值。</span><span class="sxs-lookup"><span data-stu-id="f116c-321">In this example, there are four different services, all reporting different values for two different metrics, MetricA and MetricB.</span></span> <span data-ttu-id="f116c-322">在其中一個案例中，所有的 hello 服務定義 MetricA 為 hello 最重要的 (加權 = 高) 和 MetricB 做並不重要 (加權 = 低)。</span><span class="sxs-lookup"><span data-stu-id="f116c-322">In one case, all hello services define MetricA is hello most important one (Weight = High) and MetricB as unimportant (Weight = Low).</span></span> <span data-ttu-id="f116c-323">如此一來，我們會看到該 hello 叢集資源管理員會將 hello 服務以便 MetricA 就是進一步比 MetricB 平衡。</span><span class="sxs-lookup"><span data-stu-id="f116c-323">As a result, we see that hello Cluster Resource Manager places hello services so that MetricA is better balanced than MetricB.</span></span> <span data-ttu-id="f116c-324">「更加平衡」表示 MetricA 具有比 MetricB 較低的標準差。</span><span class="sxs-lookup"><span data-stu-id="f116c-324">"Better balanced" means that MetricA has a lower has a lower standard deviation than MetricB.</span></span> <span data-ttu-id="f116c-325">在 hello 第二個案例中，我們會反轉 hello 衡量標準權數。</span><span class="sxs-lookup"><span data-stu-id="f116c-325">In hello second case, we reverse hello metric weights.</span></span> <span data-ttu-id="f116c-326">如此一來，hello 叢集資源管理員交換服務 A 和 B toocome 向上其中 MetricB 是更好比 MetricA 平衡配置。</span><span class="sxs-lookup"><span data-stu-id="f116c-326">As a result, hello Cluster Resource Manager swaps services A and B toocome up with an allocation where MetricB is better balanced than MetricA.</span></span>

> [!NOTE]
> <span data-ttu-id="f116c-327">衡量標準權數判斷如何應平衡 hello 叢集資源管理員，但不是時平衡應該發生。</span><span class="sxs-lookup"><span data-stu-id="f116c-327">Metric weights determine how hello Cluster Resource Manager should balance, but not when balancing should happen.</span></span> <span data-ttu-id="f116c-328">如需有關平衡的詳細資訊，請參閱[這篇文章](service-fabric-cluster-resource-manager-balancing.md)</span><span class="sxs-lookup"><span data-stu-id="f116c-328">For more information on balancing, check out [this article](service-fabric-cluster-resource-manager-balancing.md)</span></span>
>

### <a name="global-metric-weights"></a><span data-ttu-id="f116c-329">全域度量權數</span><span class="sxs-lookup"><span data-stu-id="f116c-329">Global metric weights</span></span>
<span data-ttu-id="f116c-330">讓我們假設 Services 定義 MetricA 加權高，因為並 ServiceB 設定 hello 加權 MetricA tooLow 則為零。</span><span class="sxs-lookup"><span data-stu-id="f116c-330">Let's say ServiceA defines MetricA as weight High, and ServiceB sets hello weight for MetricA tooLow or Zero.</span></span> <span data-ttu-id="f116c-331">Hello 最後會取得使用的實際權數是什麼？</span><span class="sxs-lookup"><span data-stu-id="f116c-331">What’s hello actual weight that ends up getting used?</span></span>

<span data-ttu-id="f116c-332">針對每個計量都會追蹤多個權數。</span><span class="sxs-lookup"><span data-stu-id="f116c-332">There are multiple weights that are tracked for every metric.</span></span> <span data-ttu-id="f116c-333">hello 第一個寬度為 hello 建立 hello 服務時，為 hello 度量定義一個。</span><span class="sxs-lookup"><span data-stu-id="f116c-333">hello first weight is hello one defined for hello metric when hello service is created.</span></span> <span data-ttu-id="f116c-334">hello 其他加權值是全域的加權，自動計算。</span><span class="sxs-lookup"><span data-stu-id="f116c-334">hello other weight is a global weight, which is computed automatically.</span></span> <span data-ttu-id="f116c-335">hello 叢集資源管理員評分解決方案時，會使用這些的加權。</span><span class="sxs-lookup"><span data-stu-id="f116c-335">hello Cluster Resource Manager uses both these weights when scoring solutions.</span></span> <span data-ttu-id="f116c-336">將這兩個權數列入考量很重要。</span><span class="sxs-lookup"><span data-stu-id="f116c-336">Taking both weights into account is important.</span></span> <span data-ttu-id="f116c-337">這可讓叢集資源管理員 toobalance hello 相應 tooits 擁有優先權，並為整個正確已配置，此外也請確認該 hello 叢集中每個服務。</span><span class="sxs-lookup"><span data-stu-id="f116c-337">This allows hello Cluster Resource Manager toobalance each service according tooits own priorities, and also ensure that hello cluster as a whole is allocated correctly.</span></span>

<span data-ttu-id="f116c-338">如果 hello 叢集資源管理員不在意全域和本機的平衡，會發生什麼事？</span><span class="sxs-lookup"><span data-stu-id="f116c-338">What would happen if hello Cluster Resource Manager didn’t care about both global and local balance?</span></span> <span data-ttu-id="f116c-339">這就是輕鬆 tooconstruct 解決方案的全域平衡，但這會導致不佳的資源平衡個別服務。</span><span class="sxs-lookup"><span data-stu-id="f116c-339">Well, it’s easy tooconstruct solutions that are globally balanced, but which result in poor resource balance for individual services.</span></span> <span data-ttu-id="f116c-340">在下列範例的 hello，讓我們看一下剛才 hello 預設計量，以設定服務，並查看 當被視為只有全域平衡時，會發生什麼情況：</span><span class="sxs-lookup"><span data-stu-id="f116c-340">In hello following example, let’s look at a service configured with just hello default metrics, and see what happens when only global balance is considered:</span></span>

<span data-ttu-id="f116c-341"><center>
![hello 只有全域方案的影響][Image4]
</center></span><span class="sxs-lookup"><span data-stu-id="f116c-341"><center>
![hello Impact of a Global Only Solution][Image4]
</center></span></span>

<span data-ttu-id="f116c-342">在 hello 上方範例中只會根據通用的平衡，確實平衡 hello 為整個叢集。</span><span class="sxs-lookup"><span data-stu-id="f116c-342">In hello top example based only on global balance, hello cluster as a whole is indeed balanced.</span></span> <span data-ttu-id="f116c-343">所有節點都有相同的主要複本會計算並 hello 相同的 hello 數字的複本總數。</span><span class="sxs-lookup"><span data-stu-id="f116c-343">All nodes have hello same count of primaries and hello same number total replicas.</span></span> <span data-ttu-id="f116c-344">不過，如果您看一下這個配置的 hello 實際影響它不是很理想： hello 遺失的任何節點將會影響特定工作負載不適當，因為它會接受所有其主要複本會。</span><span class="sxs-lookup"><span data-stu-id="f116c-344">However, if you look at hello actual impact of this allocation it’s not so good: hello loss of any node impacts a particular workload disproportionately, because it takes out all of its primaries.</span></span> <span data-ttu-id="f116c-345">比方說，如果 hello 第一個節點失敗 hello hello 三個不同資料分割的 hello 圓形服務的三個主要複本會將所有會遺失。</span><span class="sxs-lookup"><span data-stu-id="f116c-345">For example, if hello first node fails hello three primaries for hello three different partitions of hello Circle service would all be lost.</span></span> <span data-ttu-id="f116c-346">相反地，hello 三角形及六邊形服務有遺失的複本及其資料分割。</span><span class="sxs-lookup"><span data-stu-id="f116c-346">Conversely, hello Triangle and Hexagon services have their partitions lose a replica.</span></span> <span data-ttu-id="f116c-347">這會導致以外具有 toorecover hello 向複本的任何干擾。</span><span class="sxs-lookup"><span data-stu-id="f116c-347">This causes no disruption, other than having toorecover hello down replica.</span></span>

<span data-ttu-id="f116c-348">在 hello 下方範例中，hello 叢集資源管理員卻散發 hello 複本根據這兩個 hello 全域和每個服務的平衡。</span><span class="sxs-lookup"><span data-stu-id="f116c-348">In hello bottom example, hello Cluster Resource Manager has distributed hello replicas based on both hello global and per-service balance.</span></span> <span data-ttu-id="f116c-349">計算 hello 分數的 hello 方案時它會提供大部分的 hello 加權 toohello 全域方案，以及 （設定） 的部分 tooindividual 服務。</span><span class="sxs-lookup"><span data-stu-id="f116c-349">When calculating hello score of hello solution it gives most of hello weight toohello global solution, and a (configurable) portion tooindividual services.</span></span> <span data-ttu-id="f116c-350">全域平衡標準是根據每個服務的 hello 衡量標準權數的 hello 平均計算。</span><span class="sxs-lookup"><span data-stu-id="f116c-350">Global balance for a metric is calculated based on hello average of hello metric weights from each service.</span></span> <span data-ttu-id="f116c-351">每個服務平衡相應 tooits 自己定義衡量標準權數。</span><span class="sxs-lookup"><span data-stu-id="f116c-351">Each service is balanced according tooits own defined metric weights.</span></span> <span data-ttu-id="f116c-352">這可確保 hello 服務的平衡本身根據 tootheir 自己的需求。</span><span class="sxs-lookup"><span data-stu-id="f116c-352">This ensures that hello services are balanced within themselves according tootheir own needs.</span></span> <span data-ttu-id="f116c-353">如此一來，如果 hello 相同的第一個節點失敗 hello 失敗，都會分散到所有服務的所有資料分割中。</span><span class="sxs-lookup"><span data-stu-id="f116c-353">As a result, if hello same first node fails hello failure is distributed across all partitions of all services.</span></span> <span data-ttu-id="f116c-354">hello 影響 tooeach 是 hello 相同。</span><span class="sxs-lookup"><span data-stu-id="f116c-354">hello impact tooeach is hello same.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f116c-355">後續步驟</span><span class="sxs-lookup"><span data-stu-id="f116c-355">Next steps</span></span>
- <span data-ttu-id="f116c-356">如需有關設定服務的詳細資訊，請參閱[深入了解設定服務](service-fabric-cluster-resource-manager-configure-services.md)(service-fabric-cluster-resource-manager-configure-services.md)</span><span class="sxs-lookup"><span data-stu-id="f116c-356">For more information on configuring services, [Learn about configuring Services](service-fabric-cluster-resource-manager-configure-services.md)(service-fabric-cluster-resource-manager-configure-services.md)</span></span>
- <span data-ttu-id="f116c-357">定義磁碟重組度量資訊是其中一種方式 tooconsolidate 負載，而不是分配的節點上。toolearn 如何 tooconfigure 磁碟重組，請參閱太[這篇文章](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="f116c-357">Defining Defragmentation Metrics is one way tooconsolidate load on nodes instead of spreading it out. toolearn how tooconfigure defragmentation, refer too[this article](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span></span>
- <span data-ttu-id="f116c-358">toofind 出 hello 叢集資源管理員如何管理和 hello 叢集中的負載平衡簽出 hello 發行項上[平衡負載](service-fabric-cluster-resource-manager-balancing.md)</span><span class="sxs-lookup"><span data-stu-id="f116c-358">toofind out about how hello Cluster Resource Manager manages and balances load in hello cluster, check out hello article on [balancing load](service-fabric-cluster-resource-manager-balancing.md)</span></span>
- <span data-ttu-id="f116c-359">Hello 從頭開始並[取得簡介 toohello Service Fabric 叢集資源管理員](service-fabric-cluster-resource-manager-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="f116c-359">Start from hello beginning and [get an Introduction toohello Service Fabric Cluster Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span></span>
- <span data-ttu-id="f116c-360">移動成本是訊號某些服務會比其他更耗費資源 toomove toohello 叢集資源管理員的一種方式。</span><span class="sxs-lookup"><span data-stu-id="f116c-360">Movement Cost is one way of signaling toohello Cluster Resource Manager that certain services are more expensive toomove than others.</span></span> <span data-ttu-id="f116c-361">深入了解移動成本 toolearn 參照太[這篇文章](service-fabric-cluster-resource-manager-movement-cost.md)</span><span class="sxs-lookup"><span data-stu-id="f116c-361">toolearn more about movement cost, refer too[this article](service-fabric-cluster-resource-manager-movement-cost.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-metrics/cluster-resource-manager-cluster-layout-with-default-metrics.png
[Image2]:./media/service-fabric-cluster-resource-manager-metrics/Service-Fabric-Resource-Manager-Dynamic-Load-Reports.png
[Image3]:./media/service-fabric-cluster-resource-manager-metrics/cluster-resource-manager-metric-weights-impact.png
[Image4]:./media/service-fabric-cluster-resource-manager-metrics/cluster-resource-manager-global-vs-local-balancing.png
