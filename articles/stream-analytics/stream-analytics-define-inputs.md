---
title: "資料連線：來自事件資料流的資料流輸入 | Microsoft Docs"
description: "了解如何設定通往串流分析的資料連線 (也就是「輸入」)。 輸入包括來自事件的資料流，以及參考資料。"
keywords: "資料流, 資料連線, 事件資料流"
services: stream-analytics
documentationcenter: 
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 8155823c-9dd8-4a6b-8393-34452d299b68
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 07/05/2017
ms.author: samacha
ms.openlocfilehash: 6f7f01165c0f0d6f8478a8c53d74d3ce32c5df9f
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="data-connection-learn-about-data-stream-inputs-from-events-to-stream-analytics"></a><span data-ttu-id="4b263-105">資料連線：了解資料從事件到串流分析的資料流輸入</span><span class="sxs-lookup"><span data-stu-id="4b263-105">Data connection: Learn about data stream inputs from events to Stream Analytics</span></span>
<span data-ttu-id="4b263-106">串流分析作業的資料連線是來自資料來源的事件資料流，稱為作業的「輸入」。</span><span class="sxs-lookup"><span data-stu-id="4b263-106">The data connection to a Stream Analytics job is a stream of events from a data source, which is referred to as the job's *input*.</span></span> <span data-ttu-id="4b263-107">串流分析與 Azure 資料流來源的整合性極佳，來源包括 [Azure 事件中樞](https://azure.microsoft.com/services/event-hubs/)、[Azure IoT 中樞](https://azure.microsoft.com/services/iot-hub/)和 [Azure Blob 儲存體](https://azure.microsoft.com/services/storage/blobs/)。</span><span class="sxs-lookup"><span data-stu-id="4b263-107">Stream Analytics has first-class integration with Azure data stream sources, including [Azure Event Hubs](https://azure.microsoft.com/services/event-hubs/), [Azure IoT Hub](https://azure.microsoft.com/services/iot-hub/), and [Azure Blob storage](https://azure.microsoft.com/services/storage/blobs/).</span></span> <span data-ttu-id="4b263-108">這些輸入來源可以來自與分析作業相同的 Azure 訂用帳戶，或來自不同的訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="4b263-108">These input sources can be from the same Azure subscription as your analytics job, or from a different subscription.</span></span>

## <a name="data-input-types-data-stream-and-reference-data"></a><span data-ttu-id="4b263-109">資料輸入類型：資料流和參考資料</span><span class="sxs-lookup"><span data-stu-id="4b263-109">Data input types: Data stream and reference data</span></span>
<span data-ttu-id="4b263-110">當資料發送到資料來源時，串流分析作業會即時取用並處理該資料。</span><span class="sxs-lookup"><span data-stu-id="4b263-110">As data is pushed to a data source, it's consumed by the Stream Analytics job and processed in real time.</span></span> <span data-ttu-id="4b263-111">輸入分為兩種類型：資料流輸入和參考資料輸入。</span><span class="sxs-lookup"><span data-stu-id="4b263-111">Inputs are divided into two types: data stream inputs and reference data inputs.</span></span>

### <a name="data-stream-inputs"></a><span data-ttu-id="4b263-112">資料流輸入</span><span class="sxs-lookup"><span data-stu-id="4b263-112">Data stream inputs</span></span>
<span data-ttu-id="4b263-113">資料流是一段時間內發生的無限制事件序列。</span><span class="sxs-lookup"><span data-stu-id="4b263-113">A data stream is an unbounded sequence of events over time.</span></span> <span data-ttu-id="4b263-114">串流分析作業必須包含至少一個資料流輸入。</span><span class="sxs-lookup"><span data-stu-id="4b263-114">Stream Analytics jobs must include at least one data stream input.</span></span> <span data-ttu-id="4b263-115">支援將事件中樞、IoT 中樞和 Blob 儲存體當成資料流輸入來源。</span><span class="sxs-lookup"><span data-stu-id="4b263-115">Event Hubs, IoT Hub, and Blob storage are supported as data stream input sources.</span></span> <span data-ttu-id="4b263-116">事件中樞用於從多個裝置和服務收集事件資料流。</span><span class="sxs-lookup"><span data-stu-id="4b263-116">Event hubs are used to collect event streams from multiple devices and services.</span></span> <span data-ttu-id="4b263-117">這些資料流可能包括社交媒體活動摘要、股票交易資訊或來自感應器的資料。</span><span class="sxs-lookup"><span data-stu-id="4b263-117">These streams might include social media activity feeds, stock trade information, or data from sensors.</span></span> <span data-ttu-id="4b263-118">IoT 中樞經過最佳化，最適合從物聯網 (IoT) 情節中連接的裝置收集資料。</span><span class="sxs-lookup"><span data-stu-id="4b263-118">IoT hubs are optimized to collect data from connected devices in Internet of Things (IoT) scenarios.</span></span>  <span data-ttu-id="4b263-119">Blob 儲存體可作為輸入來源，將大量資料內嵌為資料流，例如記錄檔。</span><span class="sxs-lookup"><span data-stu-id="4b263-119">Blob storage can be used as an input source for ingesting bulk data as a stream, such as log files.</span></span>  

### <a name="reference-data"></a><span data-ttu-id="4b263-120">參考資料</span><span class="sxs-lookup"><span data-stu-id="4b263-120">Reference data</span></span>
<span data-ttu-id="4b263-121">串流分析也支援稱為「參考資料」的輸入。</span><span class="sxs-lookup"><span data-stu-id="4b263-121">Stream Analytics also supports input known as *reference data*.</span></span> <span data-ttu-id="4b263-122">這是靜態或緩慢變更的輔助資料。</span><span class="sxs-lookup"><span data-stu-id="4b263-122">This is auxiliary data that is either static or that changes slowly.</span></span> <span data-ttu-id="4b263-123">通常用來執行相互關聯和查閱。</span><span class="sxs-lookup"><span data-stu-id="4b263-123">It's typically used for performing correlation and lookups.</span></span> <span data-ttu-id="4b263-124">比方說，您可能會將資料流輸入中的資料聯結至參考資料中的資料，很像是執行 SQL 聯結來查詢靜態值。</span><span class="sxs-lookup"><span data-stu-id="4b263-124">For example, you might join data in the data stream input to data in the reference data, much as you would perform a SQL join to look up static values.</span></span> <span data-ttu-id="4b263-125">在預覽版本中，Azure Blob 儲存體是目前唯一支援當成參考資料的輸入來源。</span><span class="sxs-lookup"><span data-stu-id="4b263-125">Azure Blob storage is currently the only supported input source for reference data.</span></span> <span data-ttu-id="4b263-126">參考資料來源 Blob 的大小以 100 MB 為限。</span><span class="sxs-lookup"><span data-stu-id="4b263-126">Reference data source blobs are limited to 100 MB in size.</span></span>

<span data-ttu-id="4b263-127">若要了解如何建立參考資料輸入，請參閱[使用參考資料](stream-analytics-use-reference-data.md)。</span><span class="sxs-lookup"><span data-stu-id="4b263-127">To learn how to create reference data inputs, see [Use Reference Data](stream-analytics-use-reference-data.md).</span></span>  

## <a name="create-data-stream-input-from-event-hubs"></a><span data-ttu-id="4b263-128">從事件中樞建立資料流輸入</span><span class="sxs-lookup"><span data-stu-id="4b263-128">Create data stream input from Event Hubs</span></span>

<span data-ttu-id="4b263-129">Azure 事件中樞提供高延展性的發佈-訂閱事件擷取器。</span><span class="sxs-lookup"><span data-stu-id="4b263-129">Azure Event Hubs provides highly scalable publish-subscribe event ingestors.</span></span> <span data-ttu-id="4b263-130">事件中樞每秒可收集數百萬個事件，可讓您處理和分析連接的裝置和應用程式所產生的大量資料。</span><span class="sxs-lookup"><span data-stu-id="4b263-130">An event hub can collect millions of events per second, so that you can process and analyze the massive amounts of data produced by your connected devices and applications.</span></span> <span data-ttu-id="4b263-131">事件中樞搭配串流分析，一起為您提供端對端解決方案來分析即時資料 -- 事件中樞可讓您即時將事件傳送到 Azure，而 Stream Analytics 作業可以即時處理這些事件。</span><span class="sxs-lookup"><span data-stu-id="4b263-131">Event Hubs and Stream Analytics together provide you with an end-to-end solution for real-time analytics—Event Hubs let you feed events into Azure in real time, and Stream Analytics jobs can process those events in real time.</span></span> <span data-ttu-id="4b263-132">例如，您可以將網頁點擊、感應器讀數或線上記錄事件傳送至事件中樞。</span><span class="sxs-lookup"><span data-stu-id="4b263-132">For example, you can send web clicks, sensor readings, or online log events to Event Hubs.</span></span> <span data-ttu-id="4b263-133">然後，您可以建立串流分析作業，將事件中樞當作輸入資料流來即時篩選、彙總和相互關聯。</span><span class="sxs-lookup"><span data-stu-id="4b263-133">You can then create Stream Analytics jobs to use Event Hubs as the input data streams for real-time filtering, aggregating, and correlation.</span></span>

<span data-ttu-id="4b263-134">在串流分析中，來自事件中樞的事件預設時間戳記是事件抵達事件中樞的時間戳記，也就是 `EventEnqueuedUtcTime`。</span><span class="sxs-lookup"><span data-stu-id="4b263-134">The default timestamp of events coming from Event Hubs in Stream Analytics is the timestamp that the event arrived in the event hub, which is `EventEnqueuedUtcTime`.</span></span> <span data-ttu-id="4b263-135">若要使用事件裝載中的時間戳記，將資料當作資料流處理，您必須使用 [TIMESTAMP BY](https://msdn.microsoft.com/library/azure/dn834998.aspx) 關鍵字。</span><span class="sxs-lookup"><span data-stu-id="4b263-135">To process the data as a stream using a timestamp in the event payload, you must use the [TIMESTAMP BY](https://msdn.microsoft.com/library/azure/dn834998.aspx) keyword.</span></span>

### <a name="consumer-groups"></a><span data-ttu-id="4b263-136">用戶群組</span><span class="sxs-lookup"><span data-stu-id="4b263-136">Consumer groups</span></span>
<span data-ttu-id="4b263-137">您應該將每一個串流分析事件中樞輸入設定為有自己的取用者群組。</span><span class="sxs-lookup"><span data-stu-id="4b263-137">You should configure each Stream Analytics event hub input to have its own consumer group.</span></span> <span data-ttu-id="4b263-138">當作業包含自我聯結或有多個輸入時，某些輸入可能由下游的多個讀取器所讀取。</span><span class="sxs-lookup"><span data-stu-id="4b263-138">When a job contains a self-join or when it has multiple inputs, some input might be read by more than one reader downstream.</span></span> <span data-ttu-id="4b263-139">這種情況會影響單一取用者群組中的讀取器數目。</span><span class="sxs-lookup"><span data-stu-id="4b263-139">This situation impacts the number of readers in a single consumer group.</span></span> <span data-ttu-id="4b263-140">若要避免超出每個分割區的每個取用者群組最多有 5 個讀取器的事件中樞限制，最好為每個串流分析作業指定取用者群組。</span><span class="sxs-lookup"><span data-stu-id="4b263-140">To avoid exceeding the Event Hubs limit of five readers per consumer group per partition, it's a best practice to designate a consumer group for each Stream Analytics job.</span></span> <span data-ttu-id="4b263-141">另外也限制每一個事件中樞最多有 20 個取用者群組。</span><span class="sxs-lookup"><span data-stu-id="4b263-141">There is also a limit of 20 consumer groups per event hub.</span></span> <span data-ttu-id="4b263-142">如需詳細資訊，請參閱[事件中樞程式設計指南](../event-hubs/event-hubs-programming-guide.md)。</span><span class="sxs-lookup"><span data-stu-id="4b263-142">For more information, see [Event Hubs Programming Guide](../event-hubs/event-hubs-programming-guide.md).</span></span>

### <a name="configure-an-event-hub-as-a-data-stream-input"></a><span data-ttu-id="4b263-143">將事件中樞設定為資料流輸入</span><span class="sxs-lookup"><span data-stu-id="4b263-143">Configure an event hub as a data stream input</span></span>
<span data-ttu-id="4b263-144">下表說明在 Azure 入口網站中將事件中樞設定為輸入時，[新的輸入] 刀鋒視窗中的每一個屬性。</span><span class="sxs-lookup"><span data-stu-id="4b263-144">The following table explains each property in the **New input** blade in the Azure portal when you configure an event hub as input.</span></span>

| <span data-ttu-id="4b263-145">屬性</span><span class="sxs-lookup"><span data-stu-id="4b263-145">Property</span></span> | <span data-ttu-id="4b263-146">說明</span><span class="sxs-lookup"><span data-stu-id="4b263-146">Description</span></span> |
| --- | --- |
| <span data-ttu-id="4b263-147">**輸入別名**</span><span class="sxs-lookup"><span data-stu-id="4b263-147">**Input alias**</span></span> |<span data-ttu-id="4b263-148">在作業查詢中用來參考這個輸入的易記名稱。</span><span class="sxs-lookup"><span data-stu-id="4b263-148">A friendly name that you use in the job's query to reference this input.</span></span> |
| <span data-ttu-id="4b263-149">**服務匯流排命名空間**</span><span class="sxs-lookup"><span data-stu-id="4b263-149">**Service bus namespace**</span></span> |<span data-ttu-id="4b263-150">Azure 服務匯流排命名空間，是一組訊息實體的容器。</span><span class="sxs-lookup"><span data-stu-id="4b263-150">An Azure Service Bus namespace, which is a container for a set of messaging entities.</span></span> <span data-ttu-id="4b263-151">建立新的事件中樞時，也會建立服務匯流排命名空間。</span><span class="sxs-lookup"><span data-stu-id="4b263-151">When you create a new event hub, you also create a Service Bus namespace.</span></span> |
| <span data-ttu-id="4b263-152">**事件中樞名稱**</span><span class="sxs-lookup"><span data-stu-id="4b263-152">**Event hub name**</span></span> |<span data-ttu-id="4b263-153">作為輸入的事件中樞名稱。</span><span class="sxs-lookup"><span data-stu-id="4b263-153">The name of the event hub to use as input.</span></span> |
| <span data-ttu-id="4b263-154">**事件中樞原則名稱**</span><span class="sxs-lookup"><span data-stu-id="4b263-154">**Event hub policy name**</span></span> |<span data-ttu-id="4b263-155">支援存取事件中樞的共用存取原則。</span><span class="sxs-lookup"><span data-stu-id="4b263-155">The shared access policy that provides access to the event hub.</span></span> <span data-ttu-id="4b263-156">每一個共用存取原則都會有名稱、權限 (由您設定) 和存取金鑰。</span><span class="sxs-lookup"><span data-stu-id="4b263-156">Each shared access policy has a name, permissions that you set, and access keys.</span></span> |
| <span data-ttu-id="4b263-157">**事件中樞取用者群組** (選用)</span><span class="sxs-lookup"><span data-stu-id="4b263-157">**Event hub consumer group** (optional)</span></span> |<span data-ttu-id="4b263-158">用來從事件中樞內嵌資料的取用者群組。</span><span class="sxs-lookup"><span data-stu-id="4b263-158">The consumer group to use to ingest data from the event hub.</span></span> <span data-ttu-id="4b263-159">如果未指定取用者群組，串流分析作業會使用預設取用者群組。</span><span class="sxs-lookup"><span data-stu-id="4b263-159">If no consumer group is specified, the Stream Analytics job uses the default consumer group.</span></span> <span data-ttu-id="4b263-160">建議讓每一個串流分析作業使用不同的取用者群組。</span><span class="sxs-lookup"><span data-stu-id="4b263-160">We recommend that you use a distinct consumer group for each Stream Analytics job.</span></span> |
| <span data-ttu-id="4b263-161">**事件序列化格式**</span><span class="sxs-lookup"><span data-stu-id="4b263-161">**Event serialization format**</span></span> |<span data-ttu-id="4b263-162">傳入資料流的序列化格式 (JSON、CSV 或 Avro)。</span><span class="sxs-lookup"><span data-stu-id="4b263-162">The serialization format (JSON, CSV, or Avro) of the incoming data stream.</span></span> |
| <span data-ttu-id="4b263-163">**編碼**</span><span class="sxs-lookup"><span data-stu-id="4b263-163">**Encoding**</span></span> | <span data-ttu-id="4b263-164">UTF-8 是目前唯一支援的編碼格式。</span><span class="sxs-lookup"><span data-stu-id="4b263-164">UTF-8 is currently the only supported encoding format.</span></span> |

<span data-ttu-id="4b263-165">當您的資料來自事件中樞時，您可以在串流分析查詢中存取下列中繼資料欄位：</span><span class="sxs-lookup"><span data-stu-id="4b263-165">When your data comes from an event hub, you have access to the following metadata fields in your Stream Analytics query:</span></span>

| <span data-ttu-id="4b263-166">屬性</span><span class="sxs-lookup"><span data-stu-id="4b263-166">Property</span></span> | <span data-ttu-id="4b263-167">說明</span><span class="sxs-lookup"><span data-stu-id="4b263-167">Description</span></span> |
| --- | --- |
| <span data-ttu-id="4b263-168">**EventProcessedUtcTime**</span><span class="sxs-lookup"><span data-stu-id="4b263-168">**EventProcessedUtcTime**</span></span> |<span data-ttu-id="4b263-169">資料流分析處理事件的日期與時間。</span><span class="sxs-lookup"><span data-stu-id="4b263-169">The date and time that the event was processed by Stream Analytics.</span></span> |
| <span data-ttu-id="4b263-170">**EventEnqueuedUtcTime**</span><span class="sxs-lookup"><span data-stu-id="4b263-170">**EventEnqueuedUtcTime**</span></span> |<span data-ttu-id="4b263-171">事件中樞收到事件的日期與時間。</span><span class="sxs-lookup"><span data-stu-id="4b263-171">The date and time that the event was received by Event Hubs.</span></span> |
| <span data-ttu-id="4b263-172">**PartitionId**</span><span class="sxs-lookup"><span data-stu-id="4b263-172">**PartitionId**</span></span> |<span data-ttu-id="4b263-173">輸入配接器以零起始的資料分割識別碼。</span><span class="sxs-lookup"><span data-stu-id="4b263-173">The zero-based partition ID for the input adapter.</span></span> |

<span data-ttu-id="4b263-174">例如，您可以使用這些欄位來撰寫類似下列範例的查詢：</span><span class="sxs-lookup"><span data-stu-id="4b263-174">For example, using these fields, you can write a query like the following example:</span></span>

````
SELECT
    EventProcessedUtcTime,
    EventEnqueuedUtcTime,
    PartitionId
FROM Input
````

## <a name="create-data-stream-input-from-iot-hub"></a><span data-ttu-id="4b263-175">從 IoT 中樞建立資料流輸入</span><span class="sxs-lookup"><span data-stu-id="4b263-175">Create data stream input from IoT Hub</span></span>
<span data-ttu-id="4b263-176">Azure IoT 中樞是已針對 IoT 案例最佳化的高延展性發佈/訂閱事件擷取器。</span><span class="sxs-lookup"><span data-stu-id="4b263-176">Azure Iot Hub is a highly scalable publish-subscribe event ingestor optimized for IoT scenarios.</span></span>

<span data-ttu-id="4b263-177">在串流分析中，來自 IoT 中樞的事件預設時間戳記是事件抵達 IoT 中樞的時間戳記，也就是 `EventEnqueuedUtcTime`。</span><span class="sxs-lookup"><span data-stu-id="4b263-177">The default timestamp of events coming from an IoT hub in Stream Analytics is the timestamp that the event arrived in the IoT hub, which is `EventEnqueuedUtcTime`.</span></span> <span data-ttu-id="4b263-178">若要使用事件裝載中的時間戳記，將資料當作資料流處理，您必須使用 [TIMESTAMP BY](https://msdn.microsoft.com/library/azure/dn834998.aspx) 關鍵字。</span><span class="sxs-lookup"><span data-stu-id="4b263-178">To process the data as a stream using a timestamp in the event payload, you must use the [TIMESTAMP BY](https://msdn.microsoft.com/library/azure/dn834998.aspx) keyword.</span></span>

> [!NOTE]
> <span data-ttu-id="4b263-179">傳送的訊息必須附上 `DeviceClient` 屬性才能處理。</span><span class="sxs-lookup"><span data-stu-id="4b263-179">Only messages sent with a `DeviceClient` property can be processed.</span></span>
> 
> 

### <a name="consumer-groups"></a><span data-ttu-id="4b263-180">用戶群組</span><span class="sxs-lookup"><span data-stu-id="4b263-180">Consumer groups</span></span>
<span data-ttu-id="4b263-181">您應該將每一個串流分析 IoT 中樞輸入設定為有自己的取用者群組。</span><span class="sxs-lookup"><span data-stu-id="4b263-181">You should configure each Stream Analytics IoT hub input to have its own consumer group.</span></span> <span data-ttu-id="4b263-182">當作業包含自我聯結或有多個輸入時，某些輸入可能由下游的多個讀取器所讀取。</span><span class="sxs-lookup"><span data-stu-id="4b263-182">When a job contains a self-join or when it has multiple inputs, some input might be read by more than one reader downstream.</span></span> <span data-ttu-id="4b263-183">這種情況會影響單一取用者群組中的讀取器數目。</span><span class="sxs-lookup"><span data-stu-id="4b263-183">This situation impacts the number of readers in a single consumer group.</span></span> <span data-ttu-id="4b263-184">若要避免超出每個分割區的每個取用者群組最多有 5 個讀取器的 Azure IoT 中樞限制，最好為每個串流分析作業指定取用者群組。</span><span class="sxs-lookup"><span data-stu-id="4b263-184">To avoid exceeding the Azure IoT Hub limit of five readers per consumer group per partition, it's a best practice to designate a consumer group for each Stream Analytics job.</span></span>

### <a name="configure-an-iot-hub-as-a-data-stream-input"></a><span data-ttu-id="4b263-185">將 IoT 中樞設定為資料流輸入</span><span class="sxs-lookup"><span data-stu-id="4b263-185">Configure an IoT hub as a data stream input</span></span>
<span data-ttu-id="4b263-186">下表說明在 Azure 入口網站中將 IoT 中樞設定為輸入時，[新的輸入] 刀鋒視窗中的每一個屬性。</span><span class="sxs-lookup"><span data-stu-id="4b263-186">The following table explains each property in the **New input** blade in the Azure portal when you configure an IoT hub as input.</span></span>

| <span data-ttu-id="4b263-187">屬性</span><span class="sxs-lookup"><span data-stu-id="4b263-187">Property</span></span> | <span data-ttu-id="4b263-188">說明</span><span class="sxs-lookup"><span data-stu-id="4b263-188">Description</span></span> |
| --- | --- |
| <span data-ttu-id="4b263-189">**輸入別名**</span><span class="sxs-lookup"><span data-stu-id="4b263-189">**Input alias**</span></span> |<span data-ttu-id="4b263-190">在作業查詢中用來參考這個輸入的易記名稱。</span><span class="sxs-lookup"><span data-stu-id="4b263-190">A friendly name that you use in the job's query to reference this input.</span></span>|
| <span data-ttu-id="4b263-191">**IoT 中樞**</span><span class="sxs-lookup"><span data-stu-id="4b263-191">**IoT hub**</span></span> |<span data-ttu-id="4b263-192">作為輸入的 IoT 中樞名稱。</span><span class="sxs-lookup"><span data-stu-id="4b263-192">The name of the IoT hub to use as input.</span></span> |
| <span data-ttu-id="4b263-193">**端點**</span><span class="sxs-lookup"><span data-stu-id="4b263-193">**Endpoint**</span></span> |<span data-ttu-id="4b263-194">IoT 中樞的端點。</span><span class="sxs-lookup"><span data-stu-id="4b263-194">The endpoint for the IoT hub.</span></span>|
| <span data-ttu-id="4b263-195">**共用存取原則名稱**</span><span class="sxs-lookup"><span data-stu-id="4b263-195">**Shared access policy name**</span></span> |<span data-ttu-id="4b263-196">支援存取 IoT 中樞的共用存取原則。</span><span class="sxs-lookup"><span data-stu-id="4b263-196">The shared access policy that provides access to the IoT hub.</span></span> <span data-ttu-id="4b263-197">每一個共用存取原則都會有名稱、權限 (由您設定) 和存取金鑰。</span><span class="sxs-lookup"><span data-stu-id="4b263-197">Each shared access policy has a name, permissions that you set, and access keys.</span></span> |
| <span data-ttu-id="4b263-198">**共用存取原則金鑰**</span><span class="sxs-lookup"><span data-stu-id="4b263-198">**Shared access policy key**</span></span> |<span data-ttu-id="4b263-199">用來授權 IoT 中樞存取權的共用存取金鑰。</span><span class="sxs-lookup"><span data-stu-id="4b263-199">The shared access key used to authorize access to the IoT hub.</span></span> |
| <span data-ttu-id="4b263-200">**取用者群組** (選用)</span><span class="sxs-lookup"><span data-stu-id="4b263-200">**Consumer group** (optional)</span></span> |<span data-ttu-id="4b263-201">用來從 IoT 中樞內嵌資料的取用者群組。</span><span class="sxs-lookup"><span data-stu-id="4b263-201">The consumer group to use to ingest data from the IoT hub.</span></span> <span data-ttu-id="4b263-202">如果未指定取用者群組，串流分析作業會使用預設取用者群組。</span><span class="sxs-lookup"><span data-stu-id="4b263-202">If no consumer group is specified, a Stream Analytics job uses the default consumer group.</span></span> <span data-ttu-id="4b263-203">建議讓每一個串流分析作業使用不同的取用者群組。</span><span class="sxs-lookup"><span data-stu-id="4b263-203">We recommend that you use a different consumer group for each Stream Analytics job.</span></span> |
| <span data-ttu-id="4b263-204">**事件序列化格式**</span><span class="sxs-lookup"><span data-stu-id="4b263-204">**Event serialization format**</span></span> |<span data-ttu-id="4b263-205">傳入資料流的序列化格式 (JSON、CSV 或 Avro)。</span><span class="sxs-lookup"><span data-stu-id="4b263-205">The serialization format (JSON, CSV, or Avro) of the incoming data stream.</span></span> |
| <span data-ttu-id="4b263-206">**編碼**</span><span class="sxs-lookup"><span data-stu-id="4b263-206">**Encoding**</span></span> |<span data-ttu-id="4b263-207">UTF-8 是目前唯一支援的編碼格式。</span><span class="sxs-lookup"><span data-stu-id="4b263-207">UTF-8 is currently the only supported encoding format.</span></span> |

<span data-ttu-id="4b263-208">當您的資料來自 IoT 中樞時，您可以在串流分析查詢中存取下列中繼資料欄位：</span><span class="sxs-lookup"><span data-stu-id="4b263-208">When your data comes from an IoT hub, you have access to the following metadata fields in your Stream Analytics query:</span></span>

| <span data-ttu-id="4b263-209">屬性</span><span class="sxs-lookup"><span data-stu-id="4b263-209">Property</span></span> | <span data-ttu-id="4b263-210">說明</span><span class="sxs-lookup"><span data-stu-id="4b263-210">Description</span></span> |
| --- | --- |
| <span data-ttu-id="4b263-211">**EventProcessedUtcTime**</span><span class="sxs-lookup"><span data-stu-id="4b263-211">**EventProcessedUtcTime**</span></span> |<span data-ttu-id="4b263-212">處理事件的日期與時間。</span><span class="sxs-lookup"><span data-stu-id="4b263-212">The date and time that the event was processed.</span></span> |
| <span data-ttu-id="4b263-213">**EventEnqueuedUtcTime**</span><span class="sxs-lookup"><span data-stu-id="4b263-213">**EventEnqueuedUtcTime**</span></span> |<span data-ttu-id="4b263-214">IoT 中樞收到事件的日期與時間。</span><span class="sxs-lookup"><span data-stu-id="4b263-214">The date and time that the event was received by the IoT hub.</span></span> |
| <span data-ttu-id="4b263-215">**PartitionId**</span><span class="sxs-lookup"><span data-stu-id="4b263-215">**PartitionId**</span></span> |<span data-ttu-id="4b263-216">輸入配接器以零起始的資料分割識別碼。</span><span class="sxs-lookup"><span data-stu-id="4b263-216">The zero-based partition ID for the input adapter.</span></span> |
| <span data-ttu-id="4b263-217">**IoTHub.MessageId**</span><span class="sxs-lookup"><span data-stu-id="4b263-217">**IoTHub.MessageId**</span></span> | <span data-ttu-id="4b263-218">IoT 中樞內用於雙向通訊相互關聯的識別碼。</span><span class="sxs-lookup"><span data-stu-id="4b263-218">An ID that's used to correlate two-way communication in IoT hub.</span></span> |
| <span data-ttu-id="4b263-219">**IoTHub.CorrelationId**</span><span class="sxs-lookup"><span data-stu-id="4b263-219">**IoTHub.CorrelationId**</span></span> |<span data-ttu-id="4b263-220">IoT 中樞內用於訊息回應和回饋的識別碼。</span><span class="sxs-lookup"><span data-stu-id="4b263-220">An ID that's used in message responses and feedback in IoT hub.</span></span> |
| <span data-ttu-id="4b263-221">**IoTHub.ConnectionDeviceId**</span><span class="sxs-lookup"><span data-stu-id="4b263-221">**IoTHub.ConnectionDeviceId**</span></span> |<span data-ttu-id="4b263-222">用來傳送此訊息的驗證識別碼。</span><span class="sxs-lookup"><span data-stu-id="4b263-222">The authentication ID used to send this message.</span></span> <span data-ttu-id="4b263-223">IoT 中樞會將服務繫結訊息標上此值。</span><span class="sxs-lookup"><span data-stu-id="4b263-223">This value is stamped on servicebound messages by the IoT hub.</span></span> |
| <span data-ttu-id="4b263-224">**IoTHub.ConnectionDeviceGenerationId**</span><span class="sxs-lookup"><span data-stu-id="4b263-224">**IoTHub.ConnectionDeviceGenerationId**</span></span> |<span data-ttu-id="4b263-225">用來傳送此訊息之已驗證裝置的世代識別碼。</span><span class="sxs-lookup"><span data-stu-id="4b263-225">The generation ID of the authenticated device that was used to send this message.</span></span> <span data-ttu-id="4b263-226">IoT 中樞會將服務繫結訊息標上此值。</span><span class="sxs-lookup"><span data-stu-id="4b263-226">This value is stamped on servicebound messages by the IoT hub.</span></span> |
| <span data-ttu-id="4b263-227">**IoTHub.EnqueuedTime**</span><span class="sxs-lookup"><span data-stu-id="4b263-227">**IoTHub.EnqueuedTime**</span></span> |<span data-ttu-id="4b263-228">IoT 中樞收到訊息的時間。</span><span class="sxs-lookup"><span data-stu-id="4b263-228">The time when the message was received by the IoT hub.</span></span> |
| <span data-ttu-id="4b263-229">**IoTHub.StreamId**</span><span class="sxs-lookup"><span data-stu-id="4b263-229">**IoTHub.StreamId**</span></span> |<span data-ttu-id="4b263-230">傳送者裝置所新增的自訂事件屬性。</span><span class="sxs-lookup"><span data-stu-id="4b263-230">A custom event property added by the sender device.</span></span> |


## <a name="create-data-stream-input-from-blob-storage"></a><span data-ttu-id="4b263-231">從 Blob 儲存體建立資料流輸入</span><span class="sxs-lookup"><span data-stu-id="4b263-231">Create data stream input from Blob storage</span></span>
<span data-ttu-id="4b263-232">在要於雲端中儲存大量非結構化資料的情節中，Azure Blob 儲存體提供具有成本效益且可擴充的解決方案。</span><span class="sxs-lookup"><span data-stu-id="4b263-232">For scenarios with large quantities of unstructured data to store in the cloud, Azure Blob storage offers a cost-effective and scalable solution.</span></span> <span data-ttu-id="4b263-233">Blob 儲存體中的資料通常被視為待用資料。</span><span class="sxs-lookup"><span data-stu-id="4b263-233">Data in Blob storage is usually considered data at rest.</span></span> <span data-ttu-id="4b263-234">但可以由串流分析當作資料流來處理。</span><span class="sxs-lookup"><span data-stu-id="4b263-234">However, it can be processed as a data stream by Stream Analytics.</span></span> <span data-ttu-id="4b263-235">記錄處理是透過串流分析來處理 Blob 儲存體輸入的常見情節。</span><span class="sxs-lookup"><span data-stu-id="4b263-235">A typical scenario for Blob storage inputs with Stream Analytics is log processing.</span></span> <span data-ttu-id="4b263-236">在此情節中，從系統擷取遙測資料之後，需要剖析和處理，才能得到有意義的資料。</span><span class="sxs-lookup"><span data-stu-id="4b263-236">In this scenario, telemetry data has been captured from a system and needs to be parsed and processed to extract meaningful data.</span></span>

<span data-ttu-id="4b263-237">在串流分析中，Blob 儲存體事件的預設時間戳記是上次修改 blob 的時間戳記，也就是 `BlobLastModifiedUtcTime`。</span><span class="sxs-lookup"><span data-stu-id="4b263-237">The default timestamp of Blob storage events in Stream Analytics is the timestamp that the blob was last modified, which is `BlobLastModifiedUtcTime`.</span></span> <span data-ttu-id="4b263-238">若要使用事件裝載中的時間戳記，將資料當作資料流處理，您必須使用 [TIMESTAMP BY](https://msdn.microsoft.com/library/azure/dn834998.aspx) 關鍵字。</span><span class="sxs-lookup"><span data-stu-id="4b263-238">To process the data as a stream using a timestamp in the event payload, you must use the [TIMESTAMP BY](https://msdn.microsoft.com/library/azure/dn834998.aspx) keyword.</span></span>

<span data-ttu-id="4b263-239">CSV 格式的輸入「需要」標題列來定義資料集的欄位。</span><span class="sxs-lookup"><span data-stu-id="4b263-239">CSV-formatted inputs *require* a header row to define fields for the data set.</span></span> <span data-ttu-id="4b263-240">此外，所有標題列欄位都必須是唯一的。</span><span class="sxs-lookup"><span data-stu-id="4b263-240">In addition, all header row fields must be unique.</span></span>

> [!NOTE]
> <span data-ttu-id="4b263-241">串流分析不支援將內容加入現有的 blob。</span><span class="sxs-lookup"><span data-stu-id="4b263-241">Stream Analytics does not support adding content to an existing blob.</span></span> <span data-ttu-id="4b263-242">串流分析只會檢視一次 blob，在作業讀取資料之後，blob 中發生的任何變更就不處理。</span><span class="sxs-lookup"><span data-stu-id="4b263-242">Stream Analytics will view a blob only once, and any changes that occur in the blob after the job has read the data are not processed.</span></span> <span data-ttu-id="4b263-243">最佳做法是一次上傳所有資料，然後就不要將事件新增至該 blob 存放區。</span><span class="sxs-lookup"><span data-stu-id="4b263-243">A best practice is to upload all the data once and then not add events to that blob store.</span></span>
> 

### <a name="configure-blob-storage-as-a-data-stream-input"></a><span data-ttu-id="4b263-244">將 Blob 儲存體設定為資料流輸入</span><span class="sxs-lookup"><span data-stu-id="4b263-244">Configure Blob storage as a data stream input</span></span>

<span data-ttu-id="4b263-245">下表說明在 Azure 入口網站中將 Blob 儲存體設定為輸入時，[新的輸入] 刀鋒視窗中的每一個屬性。</span><span class="sxs-lookup"><span data-stu-id="4b263-245">The following table explains each property in the **New input** blade in the Azure portal when you configure Blob storage as input.</span></span>

| <span data-ttu-id="4b263-246">屬性</span><span class="sxs-lookup"><span data-stu-id="4b263-246">Property</span></span> | <span data-ttu-id="4b263-247">說明</span><span class="sxs-lookup"><span data-stu-id="4b263-247">Description</span></span> |
| --- | --- |
| <span data-ttu-id="4b263-248">**輸入別名**</span><span class="sxs-lookup"><span data-stu-id="4b263-248">**Input alias**</span></span> | <span data-ttu-id="4b263-249">在作業查詢中用來參考這個輸入的易記名稱。</span><span class="sxs-lookup"><span data-stu-id="4b263-249">A friendly name that you use in the job's query to reference this input.</span></span> |
| <span data-ttu-id="4b263-250">**儲存體帳戶**</span><span class="sxs-lookup"><span data-stu-id="4b263-250">**Storage account**</span></span> | <span data-ttu-id="4b263-251">Blob 檔案所在的儲存體帳戶名稱。</span><span class="sxs-lookup"><span data-stu-id="4b263-251">The name of the storage account where the blob files are located.</span></span> |
| <span data-ttu-id="4b263-252">**儲存體帳戶金鑰**</span><span class="sxs-lookup"><span data-stu-id="4b263-252">**Storage account key**</span></span> | <span data-ttu-id="4b263-253">與儲存體帳戶相關聯的密碼金鑰。</span><span class="sxs-lookup"><span data-stu-id="4b263-253">The secret key associated with the storage account.</span></span> |
| <span data-ttu-id="4b263-254">**容器**</span><span class="sxs-lookup"><span data-stu-id="4b263-254">**Container**</span></span> | <span data-ttu-id="4b263-255">Blob 輸入的容器。</span><span class="sxs-lookup"><span data-stu-id="4b263-255">The container for the blob input.</span></span> <span data-ttu-id="4b263-256">容器提供邏輯分組給儲存在 Microsoft Azure Blob 服務中的 blob。</span><span class="sxs-lookup"><span data-stu-id="4b263-256">Containers provide a logical grouping for blobs stored in the Microsoft Azure Blob service.</span></span> <span data-ttu-id="4b263-257">將 blob 上傳至 Azure Blob 儲存體服務時，您必須指定該 blob 的容器。</span><span class="sxs-lookup"><span data-stu-id="4b263-257">When you upload a blob to the Azure Blob storage service, you must specify a container for that blob.</span></span> |
| <span data-ttu-id="4b263-258">**路徑模式** (選用)</span><span class="sxs-lookup"><span data-stu-id="4b263-258">**Path pattern** (optional)</span></span> | <span data-ttu-id="4b263-259">用來在指定的容器中找出 blob 的檔案路徑。</span><span class="sxs-lookup"><span data-stu-id="4b263-259">The file path used to locate the blobs within the specified container.</span></span> <span data-ttu-id="4b263-260">在該路徑內，您可以指定下列三個變數的一個或多個執行個體：`{date}`、`{time}` 或 `{partition}`</span><span class="sxs-lookup"><span data-stu-id="4b263-260">Within the path, you can specify one or more instances of the following three variables: `{date}`, `{time}`, or `{partition}`</span></span><br/><br/><span data-ttu-id="4b263-261">範例 1：`cluster1/logs/{date}/{time}/{partition}`</span><span class="sxs-lookup"><span data-stu-id="4b263-261">Example 1: `cluster1/logs/{date}/{time}/{partition}`</span></span><br/><br/><span data-ttu-id="4b263-262">範例 2：`cluster1/logs/{date}`</span><span class="sxs-lookup"><span data-stu-id="4b263-262">Example 2: `cluster1/logs/{date}`</span></span><br/><br/><span data-ttu-id="4b263-263">`*` 字元不是路徑前置詞允許的值。</span><span class="sxs-lookup"><span data-stu-id="4b263-263">The `*` character is not an allowed value for the path prefix.</span></span> <span data-ttu-id="4b263-264">僅允許有效的 <a HREF="https://msdn.microsoft.com/library/azure/dd135715.aspx">Azure blob 字元</a>。</span><span class="sxs-lookup"><span data-stu-id="4b263-264">Only valid <a HREF="https://msdn.microsoft.com/library/azure/dd135715.aspx">Azure blob characters</a> are allowed.</span></span> |
| <span data-ttu-id="4b263-265">**日期格式** (選用)</span><span class="sxs-lookup"><span data-stu-id="4b263-265">**Date format** (optional)</span></span> | <span data-ttu-id="4b263-266">在路徑中使用日期變數時，用來組織檔案的日期格式。</span><span class="sxs-lookup"><span data-stu-id="4b263-266">If you use the date variable in the path, the date format in which the files are organized.</span></span> <span data-ttu-id="4b263-267">範例：`YYYY/MM/DD`</span><span class="sxs-lookup"><span data-stu-id="4b263-267">Example: `YYYY/MM/DD`</span></span> |
| <span data-ttu-id="4b263-268">**時間格式** (選用)</span><span class="sxs-lookup"><span data-stu-id="4b263-268">**Time format** (optional)</span></span> |  <span data-ttu-id="4b263-269">在路徑中使用時間變數時，用來組織檔案的時間格式。</span><span class="sxs-lookup"><span data-stu-id="4b263-269">If you use the time variable in the path, the time format in which the files are organized.</span></span> <span data-ttu-id="4b263-270">目前唯一支援的值為 `HH`。</span><span class="sxs-lookup"><span data-stu-id="4b263-270">Currently the only supported value is `HH`.</span></span> |
| <span data-ttu-id="4b263-271">**事件序列化格式**</span><span class="sxs-lookup"><span data-stu-id="4b263-271">**Event serialization format**</span></span> | <span data-ttu-id="4b263-272">傳入資料流的序列化格式 (JSON、CSV 或 Avro)。</span><span class="sxs-lookup"><span data-stu-id="4b263-272">The serialization format (JSON, CSV, or Avro) for incoming data streams.</span></span> |
| <span data-ttu-id="4b263-273">**編碼**</span><span class="sxs-lookup"><span data-stu-id="4b263-273">**Encoding**</span></span> | <span data-ttu-id="4b263-274">對於 CSV 和 JSON 而言，UTF-8 是目前唯一支援的編碼格式。</span><span class="sxs-lookup"><span data-stu-id="4b263-274">For CSV and JSON, UTF-8 is currently the only supported encoding format.</span></span> |

<span data-ttu-id="4b263-275">當您的資料來自 Blob 儲存體來源時，您可以在串流分析查詢中存取下列中繼資料欄位：</span><span class="sxs-lookup"><span data-stu-id="4b263-275">When your data comes from a Blob storage source, you have access to the following metadata fields in your Stream Analytics query:</span></span>

| <span data-ttu-id="4b263-276">屬性</span><span class="sxs-lookup"><span data-stu-id="4b263-276">Property</span></span> | <span data-ttu-id="4b263-277">說明</span><span class="sxs-lookup"><span data-stu-id="4b263-277">Description</span></span> |
| --- | --- |
| <span data-ttu-id="4b263-278">**BlobName**</span><span class="sxs-lookup"><span data-stu-id="4b263-278">**BlobName**</span></span> |<span data-ttu-id="4b263-279">事件來源的輸入 Blob 名稱。</span><span class="sxs-lookup"><span data-stu-id="4b263-279">The name of the input blob that the event came from.</span></span> |
| <span data-ttu-id="4b263-280">**EventProcessedUtcTime**</span><span class="sxs-lookup"><span data-stu-id="4b263-280">**EventProcessedUtcTime**</span></span> |<span data-ttu-id="4b263-281">資料流分析處理事件的日期與時間。</span><span class="sxs-lookup"><span data-stu-id="4b263-281">The date and time that the event was processed by Stream Analytics.</span></span> |
| <span data-ttu-id="4b263-282">**BlobLastModifiedUtcTime**</span><span class="sxs-lookup"><span data-stu-id="4b263-282">**BlobLastModifiedUtcTime**</span></span> |<span data-ttu-id="4b263-283">上次修改 Blob 的時間與日期。</span><span class="sxs-lookup"><span data-stu-id="4b263-283">The date and time that the blob was last modified.</span></span> |
| <span data-ttu-id="4b263-284">**PartitionId**</span><span class="sxs-lookup"><span data-stu-id="4b263-284">**PartitionId**</span></span> |<span data-ttu-id="4b263-285">輸入配接器以零起始的資料分割識別碼。</span><span class="sxs-lookup"><span data-stu-id="4b263-285">The zero-based partition ID for the input adapter.</span></span> |

<span data-ttu-id="4b263-286">例如，您可以使用這些欄位來撰寫類似下列範例的查詢：</span><span class="sxs-lookup"><span data-stu-id="4b263-286">For example, using these fields, you can write a query like the following example:</span></span>

````
SELECT
    BlobName,
    EventProcessedUtcTime,
    BlobLastModifiedUtcTime
FROM Input
````

## <a name="get-help"></a><span data-ttu-id="4b263-287">取得說明</span><span class="sxs-lookup"><span data-stu-id="4b263-287">Get help</span></span>
<span data-ttu-id="4b263-288">如需進一步的協助，請參閱我們的 [Azure Stream Analytics 論壇](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics)。</span><span class="sxs-lookup"><span data-stu-id="4b263-288">For further assistance, try our [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).</span></span>

## <a name="next-steps"></a><span data-ttu-id="4b263-289">後續步驟</span><span class="sxs-lookup"><span data-stu-id="4b263-289">Next steps</span></span>
<span data-ttu-id="4b263-290">您已經了解自己串流分析工作的資料連線選項。</span><span class="sxs-lookup"><span data-stu-id="4b263-290">You've learned about data connection options in Azure for your Stream Analytics jobs.</span></span> <span data-ttu-id="4b263-291">若要深入了解串流分析，請參閱：</span><span class="sxs-lookup"><span data-stu-id="4b263-291">To learn more about Stream Analytics, see:</span></span>

* [<span data-ttu-id="4b263-292">開始使用 Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="4b263-292">Get started using Azure Stream Analytics</span></span>](stream-analytics-real-time-fraud-detection.md)
* [<span data-ttu-id="4b263-293">調整 Azure Stream Analytics 工作</span><span class="sxs-lookup"><span data-stu-id="4b263-293">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="4b263-294">Azure Stream Analytics 查詢語言參考</span><span class="sxs-lookup"><span data-stu-id="4b263-294">Azure Stream Analytics Query Language Reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="4b263-295">Azure 串流分析管理 REST API 參考</span><span class="sxs-lookup"><span data-stu-id="4b263-295">Azure Stream Analytics Management REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)

<!--Link references-->
[stream.analytics.developer.guide]: ../stream-analytics-developer-guide.md
[stream.analytics.scale.jobs]: stream-analytics-scale-jobs.md
[stream.analytics.introduction]: stream-analytics-introduction.md
[stream.analytics.get.started]: stream-analytics-real-time-fraud-detection.md
[stream.analytics.query.language.reference]: http://go.microsoft.com/fwlink/?LinkID=513299
[stream.analytics.rest.api.reference]: http://go.microsoft.com/fwlink/?LinkId=517301
