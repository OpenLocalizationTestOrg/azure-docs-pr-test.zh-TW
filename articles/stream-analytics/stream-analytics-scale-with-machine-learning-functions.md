---
title: "調整 Azure Stream Analytics & AzureML 函式的 aaaJob |Microsoft 文件"
description: "了解如何 tooproperly 調整串流分析工作 （資料分割、 SU 數量等等） 時使用 Azure Machine Learning 函式。"
keywords: 
documentationcenter: 
services: stream-analytics
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 47ce7c5e-1de1-41ca-9a26-b5ecce814743
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: jeffstok
ms.openlocfilehash: 3fbdfaf7e8e86896c56f1d18bbde3a10bd3dca04
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="scale-your-stream-analytics-job-with-azure-machine-learning-functions"></a><span data-ttu-id="f1242-103">使用 Azure Machine Learning 函式調整串流分析作業</span><span class="sxs-lookup"><span data-stu-id="f1242-103">Scale your Stream Analytics job with Azure Machine Learning functions</span></span>
<span data-ttu-id="f1242-104">它通常是相當簡單 tooset 組成資料流分析工作，並透過它來執行一些範例資料。</span><span class="sxs-lookup"><span data-stu-id="f1242-104">It is often quite easy tooset up an Stream Analytics job and run some sample data through it.</span></span> <span data-ttu-id="f1242-105">我們該怎麼當我們需要 toorun hello 相同作業且較高的資料磁碟區？</span><span class="sxs-lookup"><span data-stu-id="f1242-105">What should we do when we need toorun hello same job with higher data volume?</span></span> <span data-ttu-id="f1242-106">我們必須的 toounderstand tooconfigure hello 資料流分析工作，讓它將擴充的方式。</span><span class="sxs-lookup"><span data-stu-id="f1242-106">It requires us toounderstand how tooconfigure hello Stream Analytics job so that it will scale.</span></span> <span data-ttu-id="f1242-107">在本文件中，我們將著重在 hello 特殊層面調整資料流分析機器學習服務函式的作業。</span><span class="sxs-lookup"><span data-stu-id="f1242-107">In this document, we will focus on hello special aspects of scaling Stream Analytics jobs with Machine Learning functions.</span></span> <span data-ttu-id="f1242-108">如需有關如何 tooscale 串流分析工作的一般請參閱 hello 發行項詳細[工作調整](stream-analytics-scale-jobs.md)。</span><span class="sxs-lookup"><span data-stu-id="f1242-108">For information on how tooscale Stream Analytics jobs in general see hello article [Scaling jobs](stream-analytics-scale-jobs.md).</span></span>

## <a name="what-is-an-azure-machine-learning-function-in-stream-analytics"></a><span data-ttu-id="f1242-109">什麼是串流分析中的 Azure Machine Learning 函式？</span><span class="sxs-lookup"><span data-stu-id="f1242-109">What is an Azure Machine Learning function in Stream Analytics?</span></span>
<span data-ttu-id="f1242-110">在 Stream Analytics 中的機器學習服務函式可以當成一般函式中呼叫 hello 串流分析查詢語言。</span><span class="sxs-lookup"><span data-stu-id="f1242-110">A Machine Learning function in Stream Analytics can be used like a regular function call in hello Stream Analytics query language.</span></span> <span data-ttu-id="f1242-111">不過，後面 hello 場景 hello 函式呼叫會實際 Azure Machine Learning Web 服務要求。</span><span class="sxs-lookup"><span data-stu-id="f1242-111">However, behind hello scene, hello function calls are actually Azure Machine Learning Web Service requests.</span></span> <span data-ttu-id="f1242-112">機器學習 web 服務支援 「 批次處理 「 多個資料列，也就所謂的迷你批次、 在 hello 相同 web 服務應用程式開發介面呼叫，tooimprove 整體輸送量。</span><span class="sxs-lookup"><span data-stu-id="f1242-112">Machine Learning web services support “batching” multiple rows, which is called mini-batch, in hello same web service API call, tooimprove overall throughput.</span></span> <span data-ttu-id="f1242-113">請參閱下列文章中的更多詳細資料; hello[Azure Machine Learning 函式在 Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/)和[Azure 機器學習 Web 服務](../machine-learning/machine-learning-consume-web-services.md)。</span><span class="sxs-lookup"><span data-stu-id="f1242-113">Please see hello following articles for more details; [Azure Machine Learning functions in Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) and [Azure Machine Learning Web Services](../machine-learning/machine-learning-consume-web-services.md).</span></span>

## <a name="configure-a-stream-analytics-job-with-machine-learning-functions"></a><span data-ttu-id="f1242-114">使用 Machine Learning 函式設定串流分析作業</span><span class="sxs-lookup"><span data-stu-id="f1242-114">Configure a Stream Analytics job with Machine Learning functions</span></span>
<span data-ttu-id="f1242-115">在設定資料流分析工作的機器學習服務函式時，有兩個參數 tooconsider、 hello 批次大小 hello 機器學習服務函式呼叫，以及資料流單位 (SUs) 佈建的 hello 資料流分析工作的 hello。</span><span class="sxs-lookup"><span data-stu-id="f1242-115">When configuring a Machine Learning function for Stream Analytics job, there are two parameters tooconsider, hello batch size of hello Machine Learning function calls, and hello streaming units (SUs) provisioned for hello Stream Analytics job.</span></span> <span data-ttu-id="f1242-116">toodetermine hello 適當的值為這些第一次必須決定之間延遲和輸送量，也就是延遲 hello 資料流分析作業，以及每個 SU 的輸送量。</span><span class="sxs-lookup"><span data-stu-id="f1242-116">toodetermine hello appropriate values for these, first a decision must be made between latency and throughput, that is, latency of hello Stream Analytics job, and throughput of each SU.</span></span> <span data-ttu-id="f1242-117">SUs 可能都必須加入 tooa 作業 tooincrease 輸送量妥善分割資料流分析查詢時，雖然其他 SUs 增加執行中的 hello 作業 hello 成本。</span><span class="sxs-lookup"><span data-stu-id="f1242-117">SUs may always be added tooa job tooincrease throughput of a well partitioned Stream Analytics query, although additional SUs increases hello cost of running hello job.</span></span>

<span data-ttu-id="f1242-118">因此是很重要的 toodetermine hello*容錯*的中執行資料流分析工作的延遲。</span><span class="sxs-lookup"><span data-stu-id="f1242-118">Therefore it is important toodetermine hello *tolerance* of latency in running a Stream Analytics job.</span></span> <span data-ttu-id="f1242-119">從執行中的 Azure 機器學習服務要求額外的延遲時間自然會以批次大小，將複合 hello hello 資料流分析作業的延遲增加。</span><span class="sxs-lookup"><span data-stu-id="f1242-119">Additional latency from running Azure Machine Learning service requests will naturally increase with batch size, which will compound hello latency of hello Stream Analytics job.</span></span> <span data-ttu-id="f1242-120">Hello 換句話說，批次的大小增加可讓 hello 資料流分析工作 tooprocess * 更多的事件，以 hello*相同號碼*機器學習 web 服務要求。</span><span class="sxs-lookup"><span data-stu-id="f1242-120">On hello other hand, increasing batch size allows hello Stream Analytics job tooprocess *more events with hello *same number* of Machine Learning web service requests.</span></span> <span data-ttu-id="f1242-121">通常 hello 增加的機器學習 web 服務延遲是子線性 toohello 批次大小增加，因此很重要的 tooconsider hello 最符合成本效益的批次大小在任何給定的情況下的機器學習 web 服務。</span><span class="sxs-lookup"><span data-stu-id="f1242-121">Often hello increase of Machine Learning web service latency is sub-linear toohello increase of batch size so it is important tooconsider hello most cost-efficient batch size for a Machine Learning web service in any given situation.</span></span> <span data-ttu-id="f1242-122">hello 預設批次大小 hello web 服務要求是 1000年，而且可能會修改使用 hello[資料流分析 REST API](https://msdn.microsoft.com/library/mt653706.aspx "資料流分析 REST API")或 hello [PowerShell 用戶端串流分析的](stream-analytics-monitor-and-manage-jobs-use-powershell.md "PowerShell 用戶端的資料流分析")。</span><span class="sxs-lookup"><span data-stu-id="f1242-122">hello default batch size for hello web service requests is 1000 and may be modified either by using hello [Stream Analytics REST API](https://msdn.microsoft.com/library/mt653706.aspx "Stream Analytics REST API") or hello [PowerShell client for Stream Analytics](stream-analytics-monitor-and-manage-jobs-use-powershell.md "PowerShell client for Stream Analytics").</span></span>

<span data-ttu-id="f1242-123">尚未決定批次大小，一旦 hello 的數量資料流處理單位 (SUs) 可以是決定，取決於 hello 事件數目 hello 函式需要每秒 tooprocess。</span><span class="sxs-lookup"><span data-stu-id="f1242-123">Once a batch size has been determined, hello amount of streaming units (SUs) can be determined, based on hello number of events that hello function needs tooprocess per second.</span></span> <span data-ttu-id="f1242-124">如需串流單位的詳細資訊，請參閱[串流分析調整作業](stream-analytics-scale-jobs.md)。</span><span class="sxs-lookup"><span data-stu-id="f1242-124">For more information about streaming units, see [Stream Analytics scale jobs](stream-analytics-scale-jobs.md).</span></span>

<span data-ttu-id="f1242-125">一般情況下，有 20 個並行連線 toohello 機器學習 web 服務，每隔 6 sus，不同之處在於 1 SU 工作 3 SU 作業會取得和 20 個並行連線也。</span><span class="sxs-lookup"><span data-stu-id="f1242-125">In general, there are 20 concurrent connections toohello Machine Learning web service for every 6 SUs, except that 1 SU jobs and 3 SU jobs will get 20 concurrent connections also.</span></span>  <span data-ttu-id="f1242-126">比方說，如果 hello 輸入的資料速率是每秒 200,000 事件，並保留 hello 批次大小 1000 hello 產生 web 服務延遲與 1000年事件迷你批次 toohello 預設會是 200 毫秒。</span><span class="sxs-lookup"><span data-stu-id="f1242-126">For example, if hello input data rate is 200,000 events per second and hello batch size is left toohello default of 1000 hello resulting web service latency with 1000 events mini-batch is 200ms.</span></span> <span data-ttu-id="f1242-127">這表示每個連接可以提出 5 toohello 機器學習 web 服務的每秒。</span><span class="sxs-lookup"><span data-stu-id="f1242-127">This means every connection can make 5 requests toohello Machine Learning web service in a second.</span></span> <span data-ttu-id="f1242-128">有 20 個連接，hello 資料流分析工作可以處理 20000 事件，在 200 毫秒，因此 100,000 事件每秒。</span><span class="sxs-lookup"><span data-stu-id="f1242-128">With 20 connections, hello Stream Analytics job can process 20,000 events in 200ms  and therefore 100,000 events in a second.</span></span> <span data-ttu-id="f1242-129">因此每秒 tooprocess 200,000 事件，hello 資料流分析工作需要 40 的並行連線，推出 too12 SUs。</span><span class="sxs-lookup"><span data-stu-id="f1242-129">So tooprocess 200,000 events per second, hello Stream Analytics job needs 40 concurrent connections, which comes out too12 SUs.</span></span> <span data-ttu-id="f1242-130">hello 圖說明從 hello 資料流分析工作 toohello 機器學習 web 服務端點的 hello 要求 – 每隔 6 SUs 在最大值有 20 的並行連線 tooMachine Learning web 服務。</span><span class="sxs-lookup"><span data-stu-id="f1242-130">hello diagram below illustrates hello requests from hello Stream Analytics job toohello Machine Learning web service endpoint – Every 6 SUs has 20 concurrent connections tooMachine Learning web service at max.</span></span>

<span data-ttu-id="f1242-131">![使用 Machine Learning 函式 2 作業範例調整串流分析](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "使用 Machine Learning 函式 2 作業範例調整串流分析")</span><span class="sxs-lookup"><span data-stu-id="f1242-131">![Scale Stream Analytics with Machine Learning Functions 2 job example](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Scale Stream Analytics with Machine Learning Functions 2 job example")</span></span>

<span data-ttu-id="f1242-132">一般情況下， ***B***批次大小***L*** hello web 服務以毫秒為單位的批次大小 B 延遲，如 hello 與資料流分析作業的輸送量***N*** SUs 是：</span><span class="sxs-lookup"><span data-stu-id="f1242-132">In general, ***B*** for batch size, ***L*** for hello web service latency at batch size B in milliseconds, hello throughput of an Stream Analytics job with ***N*** SUs is:</span></span>

<span data-ttu-id="f1242-133">![使用 Machine Learning 函式公式調整串流分析](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "使用 Machine Learning 函式公式調整串流分析")</span><span class="sxs-lookup"><span data-stu-id="f1242-133">![Scale Stream Analytics with Machine Learning Functions Formula](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Scale Stream Analytics with Machine Learning Functions Formula")</span></span>

<span data-ttu-id="f1242-134">其他考量可能 hello 'max concurrent calls 5d hello 機器學習 web 服務端上的，建議您 tooset 此 toohello 最大值 (目前 200)。</span><span class="sxs-lookup"><span data-stu-id="f1242-134">An additional consideration may be hello 'max concurrent calls' on hello Machine Learning web service side, it’s recommended tooset this toohello maximum value (200 currently).</span></span>

<span data-ttu-id="f1242-135">如需此設定的詳細資訊請參閱 hello[調整文件以取得機器學習 Web 服務](../machine-learning/machine-learning-scaling-webservice.md)。</span><span class="sxs-lookup"><span data-stu-id="f1242-135">For more information on this setting please review hello [Scaling article for Machine Learning Web Services](../machine-learning/machine-learning-scaling-webservice.md).</span></span>

## <a name="example--sentiment-analysis"></a><span data-ttu-id="f1242-136">範例 – 情感分析</span><span class="sxs-lookup"><span data-stu-id="f1242-136">Example – Sentiment Analysis</span></span>
<span data-ttu-id="f1242-137">hello 下列範例包含 hello 情緒分析機器學習服務函數，以資料流分析工作 hello 中所述[資料流分析機器學習整合教學課程](stream-analytics-machine-learning-integration-tutorial.md)。</span><span class="sxs-lookup"><span data-stu-id="f1242-137">hello following example includes a Stream Analytics job with hello sentiment analysis Machine Learning function, as described in hello [Stream Analytics Machine Learning integration tutorial](stream-analytics-machine-learning-integration-tutorial.md).</span></span>

<span data-ttu-id="f1242-138">hello 查詢是簡單完全分割的查詢，後面接著 hello**人氣**函式，如下所示：</span><span class="sxs-lookup"><span data-stu-id="f1242-138">hello query is a simple fully partitioned query followed by hello **sentiment** function, as shown below:</span></span>

    WITH subquery AS (
        SELECT text, sentiment(text) as result from input
    )

    Select text, result.[Score]
    Into output
    From subquery

<span data-ttu-id="f1242-139">請考慮下列案例; hello輸送量為每秒的 10,000 推文資料流分析工作必須先建立 tooperform 情緒分析的 hello 推文 （事件）。</span><span class="sxs-lookup"><span data-stu-id="f1242-139">Consider hello following scenario; with a throughput of 10,000 tweets per second a Stream Analytics job must be created tooperform sentiment analysis of hello tweets (events).</span></span> <span data-ttu-id="f1242-140">使用 1 SU，這個資料流分析工作可能無法 toohandle hello 流量？</span><span class="sxs-lookup"><span data-stu-id="f1242-140">Using 1 SU, could this Stream Analytics job be able toohandle hello traffic?</span></span> <span data-ttu-id="f1242-141">使用 hello 預設批次大小 1000 hello 作業應該能夠 tookeep 向上 hello 輸入。</span><span class="sxs-lookup"><span data-stu-id="f1242-141">Using hello default batch size of 1000 hello job should be able tookeep up with hello input.</span></span> <span data-ttu-id="f1242-142">進一步 hello 新增機器學習服務函數應該產生不超過延遲，也就是 hello 一般預設延遲 hello 情緒分析機器學習 web 服務 （與預設批次大小 1000年） 的第二個。</span><span class="sxs-lookup"><span data-stu-id="f1242-142">Further hello added Machine Learning function should generate no more than a second of latency, which is hello general default latency of hello sentiment analysis Machine Learning web service (with a default batch size of 1000).</span></span> <span data-ttu-id="f1242-143">hello 資料流分析工作的**整體**或端對端延遲通常會是幾秒鐘的時間。</span><span class="sxs-lookup"><span data-stu-id="f1242-143">hello Stream Analytics job’s **overall** or end-to-end latency would typically be a few seconds.</span></span> <span data-ttu-id="f1242-144">納入這個資料流分析工作，更詳細地介紹*特別*hello 機器學習服務函式呼叫。</span><span class="sxs-lookup"><span data-stu-id="f1242-144">Take a more detailed look into this Stream Analytics job, *especially* hello Machine Learning function calls.</span></span> <span data-ttu-id="f1242-145">具有 hello 批次大小為 1000年，10,000 個事件的處理能力需要大約 10 個要求 tooweb 服務。</span><span class="sxs-lookup"><span data-stu-id="f1242-145">Having hello batch size as 1000, a throughput of 10,000 events will take about 10 requests tooweb service.</span></span> <span data-ttu-id="f1242-146">即使有 1 SU，有足夠的並行連線 tooaccommodate 這個輸入流量。</span><span class="sxs-lookup"><span data-stu-id="f1242-146">Even with 1 SU, there are enough concurrent connections tooaccommodate this input traffic.</span></span>

<span data-ttu-id="f1242-147">但如果 hello 輸入的事件速率會增加 100 倍，現在 hello 資料流分析工作需要每秒的 tooprocess 1000000 推文嗎？</span><span class="sxs-lookup"><span data-stu-id="f1242-147">But what if hello input event rate increases by 100x and now hello Stream Analytics job needs tooprocess 1,000,000 tweets per second?</span></span> <span data-ttu-id="f1242-148">有兩個選項：</span><span class="sxs-lookup"><span data-stu-id="f1242-148">There are two options:</span></span>

1. <span data-ttu-id="f1242-149">增加 hello 批次大小，或</span><span class="sxs-lookup"><span data-stu-id="f1242-149">Increase hello batch size, or</span></span>
2. <span data-ttu-id="f1242-150">資料分割 hello 輸入資料流 tooprocess hello 事件以平行方式</span><span class="sxs-lookup"><span data-stu-id="f1242-150">Partition hello input stream tooprocess hello events in parallel</span></span>

<span data-ttu-id="f1242-151">Hello 第一個選項，與 hello 作業**延遲**會增加。</span><span class="sxs-lookup"><span data-stu-id="f1242-151">With hello first option, hello job **latency** will increase.</span></span>

<span data-ttu-id="f1242-152">Hello 第二個選項，就需要 toobe 佈建，因此產生更多的並行的機器學習 web 服務要求詳細 SUs。</span><span class="sxs-lookup"><span data-stu-id="f1242-152">With hello second option, more SUs would need toobe provisioned and therefore generate more concurrent Machine Learning web service requests.</span></span> <span data-ttu-id="f1242-153">這表示 hello 作業**成本**會增加。</span><span class="sxs-lookup"><span data-stu-id="f1242-153">This means hello job **cost** will increase.</span></span>

<span data-ttu-id="f1242-154">假設的 hello 情緒分析機器學習 web 服務的 hello 延遲是 200 毫秒 1000年事件批次或下面 250ms 5000 事件批次，300ms 10000 事件批次或 25000 事件批次的 500ms年。</span><span class="sxs-lookup"><span data-stu-id="f1242-154">Assume hello latency of hello sentiment analysis Machine Learning web service is 200ms for 1000-event batches or below, 250ms for 5,000-event batches, 300ms for 10,000-event batches or 500ms for 25,000-event batches.</span></span>

1. <span data-ttu-id="f1242-155">使用 hello 第一個選項 (**不**佈建更多的 SUs)，可以增加 hello 批次大小太**25000**。</span><span class="sxs-lookup"><span data-stu-id="f1242-155">Using hello first option, (**not** provisioning more SUs), hello batch size could be increased too**25,000**.</span></span> <span data-ttu-id="f1242-156">這又會使 hello 作業 tooprocess 1000000 事件與 20 個並行連線 toohello 機器學習 web 服務 （以每個呼叫 500 毫秒的延遲）。</span><span class="sxs-lookup"><span data-stu-id="f1242-156">This in turn would allow hello job tooprocess 1,000,000 events with 20 concurrent connections toohello Machine Learning web service (with a latency of 500ms per call).</span></span> <span data-ttu-id="f1242-157">因此 hello hello 資料流分析作業，因為對機器學習 web 服務要求會增加從 hello toohello 人氣函式要求額外的延遲時間**200 毫秒**太**500ms年**。</span><span class="sxs-lookup"><span data-stu-id="f1242-157">So hello additional latency of hello Stream Analytics job due toohello sentiment function requests against hello Machine Learning web service requests would be increased from **200ms** too**500ms**.</span></span> <span data-ttu-id="f1242-158">不過請注意，批次大小**無法**hello Machine Learning web 服務需要的要求中的 hello 承載大小無限增加為 4 MB 或較小 web 服務要求逾時後 100 秒的作業。</span><span class="sxs-lookup"><span data-stu-id="f1242-158">However, note that batch size **cannot** be increased infinitely as hello Machine Learning web services requires hello payload size of a request be 4MB or smaller web service requests timeout after 100 seconds of operation.</span></span>
2. <span data-ttu-id="f1242-159">使用 hello 第二個選項，hello 批次大小就會留在 1000、 以 web 服務 200 毫秒的延遲表示，每 20 個並行連線 toohello web 服務會是能 tooprocess 1000 * 20 * 5 的事件 = 每秒 100,000。</span><span class="sxs-lookup"><span data-stu-id="f1242-159">Using hello second option, hello batch size is left at 1000, with 200ms web service latency, every 20 concurrent connections toohello web service would be able tooprocess 1000 * 20 * 5 events = 100,000 per second.</span></span> <span data-ttu-id="f1242-160">因此每個第二個，hello 作業 tooprocess 1000000 事件需要 60 SUs。</span><span class="sxs-lookup"><span data-stu-id="f1242-160">So tooprocess 1,000,000 events per second, hello job would need 60 SUs.</span></span> <span data-ttu-id="f1242-161">比較的 toohello 第一個選項，資料流分析工作會讓更多 web 服務的批次要求，接著產生增加的成本。</span><span class="sxs-lookup"><span data-stu-id="f1242-161">Compared toohello first option, Stream Analytics job would make more web service batch requests, in turn generating an increased cost.</span></span>

<span data-ttu-id="f1242-162">以下是 hello 輸送量 hello 資料流分析作業的資料表不同 SUs 和批次大小 （以每秒事件數目）。</span><span class="sxs-lookup"><span data-stu-id="f1242-162">Below is a table for hello throughput of hello Stream Analytics job for different SUs and batch sizes (in number of events per second).</span></span>

| <span data-ttu-id="f1242-163">批次大小 (ML 延遲)</span><span class="sxs-lookup"><span data-stu-id="f1242-163">batch size (ML latency)</span></span> | <span data-ttu-id="f1242-164">500 (200 毫秒)</span><span class="sxs-lookup"><span data-stu-id="f1242-164">500 (200ms)</span></span> | <span data-ttu-id="f1242-165">1,000 (200 毫秒)</span><span class="sxs-lookup"><span data-stu-id="f1242-165">1,000 (200ms)</span></span> | <span data-ttu-id="f1242-166">5,000 (250 毫秒)</span><span class="sxs-lookup"><span data-stu-id="f1242-166">5,000 (250ms)</span></span> | <span data-ttu-id="f1242-167">10,000 (300 毫秒)</span><span class="sxs-lookup"><span data-stu-id="f1242-167">10,000 (300ms)</span></span> | <span data-ttu-id="f1242-168">25,000 (500 毫秒)</span><span class="sxs-lookup"><span data-stu-id="f1242-168">25,000 (500ms)</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="f1242-169">**1 SU**</span><span class="sxs-lookup"><span data-stu-id="f1242-169">**1 SU**</span></span> |<span data-ttu-id="f1242-170">2,500</span><span class="sxs-lookup"><span data-stu-id="f1242-170">2,500</span></span> |<span data-ttu-id="f1242-171">5,000</span><span class="sxs-lookup"><span data-stu-id="f1242-171">5,000</span></span> |<span data-ttu-id="f1242-172">20,000</span><span class="sxs-lookup"><span data-stu-id="f1242-172">20,000</span></span> |<span data-ttu-id="f1242-173">30,000</span><span class="sxs-lookup"><span data-stu-id="f1242-173">30,000</span></span> |<span data-ttu-id="f1242-174">50,000</span><span class="sxs-lookup"><span data-stu-id="f1242-174">50,000</span></span> |
| <span data-ttu-id="f1242-175">**3 SU**</span><span class="sxs-lookup"><span data-stu-id="f1242-175">**3 SUs**</span></span> |<span data-ttu-id="f1242-176">2,500</span><span class="sxs-lookup"><span data-stu-id="f1242-176">2,500</span></span> |<span data-ttu-id="f1242-177">5,000</span><span class="sxs-lookup"><span data-stu-id="f1242-177">5,000</span></span> |<span data-ttu-id="f1242-178">20,000</span><span class="sxs-lookup"><span data-stu-id="f1242-178">20,000</span></span> |<span data-ttu-id="f1242-179">30,000</span><span class="sxs-lookup"><span data-stu-id="f1242-179">30,000</span></span> |<span data-ttu-id="f1242-180">50,000</span><span class="sxs-lookup"><span data-stu-id="f1242-180">50,000</span></span> |
| <span data-ttu-id="f1242-181">**6 SU**</span><span class="sxs-lookup"><span data-stu-id="f1242-181">**6 SUs**</span></span> |<span data-ttu-id="f1242-182">2,500</span><span class="sxs-lookup"><span data-stu-id="f1242-182">2,500</span></span> |<span data-ttu-id="f1242-183">5,000</span><span class="sxs-lookup"><span data-stu-id="f1242-183">5,000</span></span> |<span data-ttu-id="f1242-184">20,000</span><span class="sxs-lookup"><span data-stu-id="f1242-184">20,000</span></span> |<span data-ttu-id="f1242-185">30,000</span><span class="sxs-lookup"><span data-stu-id="f1242-185">30,000</span></span> |<span data-ttu-id="f1242-186">50,000</span><span class="sxs-lookup"><span data-stu-id="f1242-186">50,000</span></span> |
| <span data-ttu-id="f1242-187">**12 SU**</span><span class="sxs-lookup"><span data-stu-id="f1242-187">**12 SUs**</span></span> |<span data-ttu-id="f1242-188">5,000</span><span class="sxs-lookup"><span data-stu-id="f1242-188">5,000</span></span> |<span data-ttu-id="f1242-189">10,000</span><span class="sxs-lookup"><span data-stu-id="f1242-189">10,000</span></span> |<span data-ttu-id="f1242-190">40,000</span><span class="sxs-lookup"><span data-stu-id="f1242-190">40,000</span></span> |<span data-ttu-id="f1242-191">60,000</span><span class="sxs-lookup"><span data-stu-id="f1242-191">60,000</span></span> |<span data-ttu-id="f1242-192">100,000</span><span class="sxs-lookup"><span data-stu-id="f1242-192">100,000</span></span> |
| <span data-ttu-id="f1242-193">**18 SU**</span><span class="sxs-lookup"><span data-stu-id="f1242-193">**18 SUs**</span></span> |<span data-ttu-id="f1242-194">7,500</span><span class="sxs-lookup"><span data-stu-id="f1242-194">7,500</span></span> |<span data-ttu-id="f1242-195">15,000</span><span class="sxs-lookup"><span data-stu-id="f1242-195">15,000</span></span> |<span data-ttu-id="f1242-196">60,000</span><span class="sxs-lookup"><span data-stu-id="f1242-196">60,000</span></span> |<span data-ttu-id="f1242-197">90,000</span><span class="sxs-lookup"><span data-stu-id="f1242-197">90,000</span></span> |<span data-ttu-id="f1242-198">150,000</span><span class="sxs-lookup"><span data-stu-id="f1242-198">150,000</span></span> |
| <span data-ttu-id="f1242-199">**24 SU**</span><span class="sxs-lookup"><span data-stu-id="f1242-199">**24 SUs**</span></span> |<span data-ttu-id="f1242-200">10,000</span><span class="sxs-lookup"><span data-stu-id="f1242-200">10,000</span></span> |<span data-ttu-id="f1242-201">20,000</span><span class="sxs-lookup"><span data-stu-id="f1242-201">20,000</span></span> |<span data-ttu-id="f1242-202">80,000</span><span class="sxs-lookup"><span data-stu-id="f1242-202">80,000</span></span> |<span data-ttu-id="f1242-203">120,000</span><span class="sxs-lookup"><span data-stu-id="f1242-203">120,000</span></span> |<span data-ttu-id="f1242-204">200,000</span><span class="sxs-lookup"><span data-stu-id="f1242-204">200,000</span></span> |
| <span data-ttu-id="f1242-205">**…**</span><span class="sxs-lookup"><span data-stu-id="f1242-205">**…**</span></span> |<span data-ttu-id="f1242-206">…</span><span class="sxs-lookup"><span data-stu-id="f1242-206">…</span></span> |<span data-ttu-id="f1242-207">…</span><span class="sxs-lookup"><span data-stu-id="f1242-207">…</span></span> |<span data-ttu-id="f1242-208">…</span><span class="sxs-lookup"><span data-stu-id="f1242-208">…</span></span> |<span data-ttu-id="f1242-209">…</span><span class="sxs-lookup"><span data-stu-id="f1242-209">…</span></span> |<span data-ttu-id="f1242-210">…</span><span class="sxs-lookup"><span data-stu-id="f1242-210">…</span></span> |
| <span data-ttu-id="f1242-211">**60 SU**</span><span class="sxs-lookup"><span data-stu-id="f1242-211">**60 SUs**</span></span> |<span data-ttu-id="f1242-212">25,000</span><span class="sxs-lookup"><span data-stu-id="f1242-212">25,000</span></span> |<span data-ttu-id="f1242-213">50,000</span><span class="sxs-lookup"><span data-stu-id="f1242-213">50,000</span></span> |<span data-ttu-id="f1242-214">200,000</span><span class="sxs-lookup"><span data-stu-id="f1242-214">200,000</span></span> |<span data-ttu-id="f1242-215">300,000</span><span class="sxs-lookup"><span data-stu-id="f1242-215">300,000</span></span> |<span data-ttu-id="f1242-216">500,000</span><span class="sxs-lookup"><span data-stu-id="f1242-216">500,000</span></span> |

<span data-ttu-id="f1242-217">現在，您應該已充分了解串流分析中 Machine Learning 函式的運作方式。</span><span class="sxs-lookup"><span data-stu-id="f1242-217">By now, you should already have a good understanding of how Machine Learning functions in Stream Analytics work.</span></span> <span data-ttu-id="f1242-218">您可能也了解從資料來源和 「 提取 」 的 「 提取 」 資料就會傳回批次的事件資料流分析工作 hello 資料流分析工作 tooprocess。</span><span class="sxs-lookup"><span data-stu-id="f1242-218">You likely also understand that Stream Analytics jobs “pull” data from data sources and each “pull” returns a batch of events for hello Stream Analytics job tooprocess.</span></span> <span data-ttu-id="f1242-219">提取模式如何影響 hello 機器學習 web 服務要求？</span><span class="sxs-lookup"><span data-stu-id="f1242-219">How does this pull model impact hello Machine Learning web service requests?</span></span>

<span data-ttu-id="f1242-220">一般來說，hello 批次大小，我們設定機器學習服務函式將完全無法整除 hello 傳回每個資料流分析工作 「 提取 」 的事件數目。</span><span class="sxs-lookup"><span data-stu-id="f1242-220">Normally, hello batch size we set for Machine Learning functions won’t exactly be divisible by hello number of events returned by each Stream Analytics job “pull”.</span></span> <span data-ttu-id="f1242-221">當發生這種情況 hello 機器學習 web 服務用來呼叫 「 部分 」 的批次。</span><span class="sxs-lookup"><span data-stu-id="f1242-221">When this occurs hello Machine Learning web service will be called with “partial” batches.</span></span> <span data-ttu-id="f1242-222">這是 toonot 帶來額外負荷中從提取 toopull 聯合事件的其他作業延遲。</span><span class="sxs-lookup"><span data-stu-id="f1242-222">This is done toonot incur additional job latency overhead in coalescing events from pull toopull.</span></span>

## <a name="new-function-related-monitoring-metrics"></a><span data-ttu-id="f1242-223">新的函式相關監視計量</span><span class="sxs-lookup"><span data-stu-id="f1242-223">New function-related monitoring metrics</span></span>
<span data-ttu-id="f1242-224">Hello 監視區域中的資料流分析工作，在已經加入三個額外的函式相關度量。</span><span class="sxs-lookup"><span data-stu-id="f1242-224">In hello Monitor area of a Stream Analytics job, three additional function-related metrics have been added.</span></span> <span data-ttu-id="f1242-225">它們是函式的要求、 函式的事件和失敗函式的要求下 hello 圖所示。</span><span class="sxs-lookup"><span data-stu-id="f1242-225">They are FUNCTION REQUESTS, FUNCTION EVENTS and FAILED FUNCTION REQUESTS, as shown in hello graphic below.</span></span>

<span data-ttu-id="f1242-226">![使用 Machine Learning 函式計量調整串流分析](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "使用 Machine Learning 函式計量調整串流分析")</span><span class="sxs-lookup"><span data-stu-id="f1242-226">![Scale Stream Analytics with Machine Learning Functions Metrics](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Scale Stream Analytics with Machine Learning Functions Metrics")</span></span>

<span data-ttu-id="f1242-227">hello 的定義方式如下：</span><span class="sxs-lookup"><span data-stu-id="f1242-227">hello are defined as follows:</span></span>

<span data-ttu-id="f1242-228">**函式要求**: hello 函式的要求數目。</span><span class="sxs-lookup"><span data-stu-id="f1242-228">**FUNCTION REQUESTS**: hello number of function requests.</span></span>

<span data-ttu-id="f1242-229">**函式事件**: hello 中的事件數 hello 函式要求。</span><span class="sxs-lookup"><span data-stu-id="f1242-229">**FUNCTION EVENTS**: hello number events in hello function requests.</span></span>

<span data-ttu-id="f1242-230">**失敗函式要求**: hello 的失敗函式要求數目。</span><span class="sxs-lookup"><span data-stu-id="f1242-230">**FAILED FUNCTION REQUESTS**: hello number of failed function requests.</span></span>

## <a name="key-takeaways"></a><span data-ttu-id="f1242-231">重要心得</span><span class="sxs-lookup"><span data-stu-id="f1242-231">Key Takeaways</span></span>
<span data-ttu-id="f1242-232">toosummarize hello 重點，順序 tooscale 機器學習服務函式，資料流分析工作 hello 下列項目，必須考量：</span><span class="sxs-lookup"><span data-stu-id="f1242-232">toosummarize hello main points, in order tooscale an Stream Analytics job with Machine Learning functions, hello following items must be considered:</span></span>

1. <span data-ttu-id="f1242-233">hello 輸入的事件速率</span><span class="sxs-lookup"><span data-stu-id="f1242-233">hello input event rate</span></span>
2. <span data-ttu-id="f1242-234">hello，所容許之 hello 執行資料流分析工作的延遲 （並因此 hello 批次大小 hello 機器學習 web 服務的要求）</span><span class="sxs-lookup"><span data-stu-id="f1242-234">hello tolerated latency for hello running Stream Analytics job (and thus hello batch size of hello Machine Learning web service requests)</span></span>
3. <span data-ttu-id="f1242-235">hello 佈建資料流分析 SUs 和機器學習 web 服務要求 （hello 額外的函式相關費用） 的 hello 數目</span><span class="sxs-lookup"><span data-stu-id="f1242-235">hello provisioned Stream Analytics SUs and hello number of Machine Learning web service requests (hello additional function-related costs)</span></span>

<span data-ttu-id="f1242-236">以完全分割的串流分析查詢為例。</span><span class="sxs-lookup"><span data-stu-id="f1242-236">A fully partitioned Stream Analytics query was used as an example.</span></span> <span data-ttu-id="f1242-237">如果需要更複雜的查詢 hello [Azure 資料流分析論壇](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics)是取得 hello Stream Analytics 團隊的其他協助的最佳資源。</span><span class="sxs-lookup"><span data-stu-id="f1242-237">If a more complex query is needed hello [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) is a great resource for getting additional help from hello Stream Analytics team.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f1242-238">後續步驟</span><span class="sxs-lookup"><span data-stu-id="f1242-238">Next steps</span></span>
<span data-ttu-id="f1242-239">toolearn 有關資料流分析的詳細資訊，請參閱：</span><span class="sxs-lookup"><span data-stu-id="f1242-239">toolearn more about Stream Analytics, see:</span></span>

* [<span data-ttu-id="f1242-240">開始使用 Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="f1242-240">Get started using Azure Stream Analytics</span></span>](stream-analytics-real-time-fraud-detection.md)
* [<span data-ttu-id="f1242-241">調整 Azure Stream Analytics 工作</span><span class="sxs-lookup"><span data-stu-id="f1242-241">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="f1242-242">Azure Stream Analytics 查詢語言參考</span><span class="sxs-lookup"><span data-stu-id="f1242-242">Azure Stream Analytics Query Language Reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="f1242-243">Azure 串流分析管理 REST API 參考</span><span class="sxs-lookup"><span data-stu-id="f1242-243">Azure Stream Analytics Management REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)
