---
title: "使用 Azure 串流分析與 AzureML 函式調整作業 | Microsoft Docs"
description: "了解如何在使用 Azure Machine Learning 函式時適當地調整串流分析作業 (資料分割、SU 數量等)。"
keywords: 
documentationcenter: 
services: stream-analytics
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 47ce7c5e-1de1-41ca-9a26-b5ecce814743
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: jeffstok
ms.openlocfilehash: 5e07e4efcd14cd8c12124cb34058ef6c345f7f47
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="scale-your-stream-analytics-job-with-azure-machine-learning-functions"></a><span data-ttu-id="56ce1-103">使用 Azure Machine Learning 函式調整串流分析作業</span><span class="sxs-lookup"><span data-stu-id="56ce1-103">Scale your Stream Analytics job with Azure Machine Learning functions</span></span>
<span data-ttu-id="56ce1-104">設定串流分析作業並透過它執行一些範例資料通常是很容易。</span><span class="sxs-lookup"><span data-stu-id="56ce1-104">It is often quite easy to set up an Stream Analytics job and run some sample data through it.</span></span> <span data-ttu-id="56ce1-105">當我們需要以較高的資料量來執行相同的作業時，我們該怎麼辦？</span><span class="sxs-lookup"><span data-stu-id="56ce1-105">What should we do when we need to run the same job with higher data volume?</span></span> <span data-ttu-id="56ce1-106">我們必須了解如何設定串流分析作業，以便進行調整。</span><span class="sxs-lookup"><span data-stu-id="56ce1-106">It requires us to understand how to configure the Stream Analytics job so that it will scale.</span></span> <span data-ttu-id="56ce1-107">本文件的重點在於使用 Machine Learning 函式調整串流分析作業的特殊層面。</span><span class="sxs-lookup"><span data-stu-id="56ce1-107">In this document, we will focus on the special aspects of scaling Stream Analytics jobs with Machine Learning functions.</span></span> <span data-ttu-id="56ce1-108">如需有關如何調整串流分析作業的一般資訊，請參閱 [調整作業](stream-analytics-scale-jobs.md)文章。</span><span class="sxs-lookup"><span data-stu-id="56ce1-108">For information on how to scale Stream Analytics jobs in general see the article [Scaling jobs](stream-analytics-scale-jobs.md).</span></span>

## <a name="what-is-an-azure-machine-learning-function-in-stream-analytics"></a><span data-ttu-id="56ce1-109">什麼是串流分析中的 Azure Machine Learning 函式？</span><span class="sxs-lookup"><span data-stu-id="56ce1-109">What is an Azure Machine Learning function in Stream Analytics?</span></span>
<span data-ttu-id="56ce1-110">串流分析中的 Machine Learning 函式可如同一般函式呼叫使用於串流分析查詢語言中。</span><span class="sxs-lookup"><span data-stu-id="56ce1-110">A Machine Learning function in Stream Analytics can be used like a regular function call in the Stream Analytics query language.</span></span> <span data-ttu-id="56ce1-111">不過，在幕後，函式呼叫實際上是 Azure Machine Learning Web 服務要求。</span><span class="sxs-lookup"><span data-stu-id="56ce1-111">However, behind the scene, the function calls are actually Azure Machine Learning Web Service requests.</span></span> <span data-ttu-id="56ce1-112">Machine Learning Web 服務在相同的 Web 服務 API 呼叫中支援「批次處理」多個資料列 (稱之為迷你批次)，以改善整體輸送量。</span><span class="sxs-lookup"><span data-stu-id="56ce1-112">Machine Learning web services support “batching” multiple rows, which is called mini-batch, in the same web service API call, to improve overall throughput.</span></span> <span data-ttu-id="56ce1-113">如需詳細資訊，請參閱下列文章：[串流分析中的 Azure Machine Learning 函式](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/)和 [Azure Machine Learning Web 服務](../machine-learning/machine-learning-consume-web-services.md)。</span><span class="sxs-lookup"><span data-stu-id="56ce1-113">Please see the following articles for more details; [Azure Machine Learning functions in Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) and [Azure Machine Learning Web Services](../machine-learning/machine-learning-consume-web-services.md).</span></span>

## <a name="configure-a-stream-analytics-job-with-machine-learning-functions"></a><span data-ttu-id="56ce1-114">使用 Machine Learning 函式設定串流分析作業</span><span class="sxs-lookup"><span data-stu-id="56ce1-114">Configure a Stream Analytics job with Machine Learning functions</span></span>
<span data-ttu-id="56ce1-115">設定串流分析作業的 Machine Learning 函式時，需要考量兩個參數：Machine Learning 函式呼叫的批次大小，以及針對串流分析作業所佈建的串流單元 (SU)。</span><span class="sxs-lookup"><span data-stu-id="56ce1-115">When configuring a Machine Learning function for Stream Analytics job, there are two parameters to consider, the batch size of the Machine Learning function calls, and the streaming units (SUs) provisioned for the Stream Analytics job.</span></span> <span data-ttu-id="56ce1-116">若要決定這些參數的適當值，必須先決定延遲與輸送量，也就是串流分析作業的延遲，以及每個 SU 的輸送量。</span><span class="sxs-lookup"><span data-stu-id="56ce1-116">To determine the appropriate values for these, first a decision must be made between latency and throughput, that is, latency of the Stream Analytics job, and throughput of each SU.</span></span> <span data-ttu-id="56ce1-117">雖然額外的 SU 會增加執行作業的成本，但 SU 一律會新增至作業，以提高妥善分割之串流分析查詢的輸送量。</span><span class="sxs-lookup"><span data-stu-id="56ce1-117">SUs may always be added to a job to increase throughput of a well partitioned Stream Analytics query, although additional SUs increases the cost of running the job.</span></span>

<span data-ttu-id="56ce1-118">因此，請務必決定執行串流分析作業的延遲 *容錯* 。</span><span class="sxs-lookup"><span data-stu-id="56ce1-118">Therefore it is important to determine the *tolerance* of latency in running a Stream Analytics job.</span></span> <span data-ttu-id="56ce1-119">執行 Azure Machine Learning 服務要求所產生的額外延遲會自然地隨著批次大小增加，其將複合串流分析作業的延遲。</span><span class="sxs-lookup"><span data-stu-id="56ce1-119">Additional latency from running Azure Machine Learning service requests will naturally increase with batch size, which will compound the latency of the Stream Analytics job.</span></span> <span data-ttu-id="56ce1-120">另一方面，增加批次大小可讓串流分析作業處理更多具有*與 Machine Learning Web 服務要求*數量相同*的事件。</span><span class="sxs-lookup"><span data-stu-id="56ce1-120">On the other hand, increasing batch size allows the Stream Analytics job to process *more events with the *same number* of Machine Learning web service requests.</span></span> <span data-ttu-id="56ce1-121">Machine Learning Web 服務延遲增加通常是批次大小增加的次線性，因此在任何特定情況下，請務必針對 Machine Learning Web 服務考慮最符合成本效益的批次大小。</span><span class="sxs-lookup"><span data-stu-id="56ce1-121">Often the increase of Machine Learning web service latency is sub-linear to the increase of batch size so it is important to consider the most cost-efficient batch size for a Machine Learning web service in any given situation.</span></span> <span data-ttu-id="56ce1-122">Web 服務要求的預設批次大小是 1000，可以使用[串流分析 REST API](https://msdn.microsoft.com/library/mt653706.aspx "串流分析 REST API") 或[適用於串流分析的 PowerShell 用戶端](stream-analytics-monitor-and-manage-jobs-use-powershell.md "適用於串流分析的 PowerShell 用戶端")進行修改。</span><span class="sxs-lookup"><span data-stu-id="56ce1-122">The default batch size for the web service requests is 1000 and may be modified either by using the [Stream Analytics REST API](https://msdn.microsoft.com/library/mt653706.aspx "Stream Analytics REST API") or the [PowerShell client for Stream Analytics](stream-analytics-monitor-and-manage-jobs-use-powershell.md "PowerShell client for Stream Analytics").</span></span>

<span data-ttu-id="56ce1-123">決定批次大小後，即可根據函式每秒需要處理的事件數目，決定串流單元 (SU) 的數量。</span><span class="sxs-lookup"><span data-stu-id="56ce1-123">Once a batch size has been determined, the amount of streaming units (SUs) can be determined, based on the number of events that the function needs to process per second.</span></span> <span data-ttu-id="56ce1-124">如需串流單位的詳細資訊，請參閱[串流分析調整作業](stream-analytics-scale-jobs.md)。</span><span class="sxs-lookup"><span data-stu-id="56ce1-124">For more information about streaming units, see [Stream Analytics scale jobs](stream-analytics-scale-jobs.md).</span></span>

<span data-ttu-id="56ce1-125">一般而言，每 6 個 SU 有 20 個對 Machine Learning Web 服務的同時連線，但是 1 SU 作業和 3 SU 作業也會取得 20 個同時連線。</span><span class="sxs-lookup"><span data-stu-id="56ce1-125">In general, there are 20 concurrent connections to the Machine Learning web service for every 6 SUs, except that 1 SU jobs and 3 SU jobs will get 20 concurrent connections also.</span></span>  <span data-ttu-id="56ce1-126">例如，如果輸入資料速率是每秒 200,000 個事件，且批次大小保留為預設值 1000，則 1000 個事件迷你批次產生的 Web 服務延遲是 200 毫秒。</span><span class="sxs-lookup"><span data-stu-id="56ce1-126">For example, if the input data rate is 200,000 events per second and the batch size is left to the default of 1000 the resulting web service latency with 1000 events mini-batch is 200ms.</span></span> <span data-ttu-id="56ce1-127">這表示每個連線可以在 1 秒內向 Machine Learning Web 服務提出 5 個要求。</span><span class="sxs-lookup"><span data-stu-id="56ce1-127">This means every connection can make 5 requests to the Machine Learning web service in a second.</span></span> <span data-ttu-id="56ce1-128">透過 20 個連線，串流分析作業可以在 200 毫秒內處理 20,000 個事件，因此在 1 秒內可處理 100,000 個事件。</span><span class="sxs-lookup"><span data-stu-id="56ce1-128">With 20 connections, the Stream Analytics job can process 20,000 events in 200ms  and therefore 100,000 events in a second.</span></span> <span data-ttu-id="56ce1-129">所以若要每秒處理 200,000 個事件，串流分析作業需要 40 個同時連線，結果出現 12 個 SU。</span><span class="sxs-lookup"><span data-stu-id="56ce1-129">So to process 200,000 events per second, the Stream Analytics job needs 40 concurrent connections, which comes out to 12 SUs.</span></span> <span data-ttu-id="56ce1-130">下圖說明串流分析作業向 Machine Learning Web 服務端點提出的要求︰每 6 個 SU 最多有 20 個對 Machine Learning Web 服務的同時連線。</span><span class="sxs-lookup"><span data-stu-id="56ce1-130">The diagram below illustrates the requests from the Stream Analytics job to the Machine Learning web service endpoint – Every 6 SUs has 20 concurrent connections to Machine Learning web service at max.</span></span>

<span data-ttu-id="56ce1-131">![使用 Machine Learning 函式 2 作業範例調整串流分析](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "使用 Machine Learning 函式 2 作業範例調整串流分析")</span><span class="sxs-lookup"><span data-stu-id="56ce1-131">![Scale Stream Analytics with Machine Learning Functions 2 job example](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Scale Stream Analytics with Machine Learning Functions 2 job example")</span></span>

<span data-ttu-id="56ce1-132">一般而言，***B*** 代表批次大小，***L*** 代表批次大小 B 的 Web 服務延遲 (以毫秒為單位)，而具有 ***N*** 個 SU 的串流分析作業的輸送量為：</span><span class="sxs-lookup"><span data-stu-id="56ce1-132">In general, ***B*** for batch size, ***L*** for the web service latency at batch size B in milliseconds, the throughput of an Stream Analytics job with ***N*** SUs is:</span></span>

<span data-ttu-id="56ce1-133">![使用 Machine Learning 函式公式調整串流分析](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "使用 Machine Learning 函式公式調整串流分析")</span><span class="sxs-lookup"><span data-stu-id="56ce1-133">![Scale Stream Analytics with Machine Learning Functions Formula](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Scale Stream Analytics with Machine Learning Functions Formula")</span></span>

<span data-ttu-id="56ce1-134">另一項考量可能是 Machine Learning web 服務端上的「最大同時呼叫」，建議將此值設定為最大值 (目前為 200)。</span><span class="sxs-lookup"><span data-stu-id="56ce1-134">An additional consideration may be the 'max concurrent calls' on the Machine Learning web service side, it’s recommended to set this to the maximum value (200 currently).</span></span>

<span data-ttu-id="56ce1-135">如需此設定的詳細資訊，請參閱 [Machine Learning Web 服務的調整文章](../machine-learning/machine-learning-scaling-webservice.md)。</span><span class="sxs-lookup"><span data-stu-id="56ce1-135">For more information on this setting please review the [Scaling article for Machine Learning Web Services](../machine-learning/machine-learning-scaling-webservice.md).</span></span>

## <a name="example--sentiment-analysis"></a><span data-ttu-id="56ce1-136">範例 – 情感分析</span><span class="sxs-lookup"><span data-stu-id="56ce1-136">Example – Sentiment Analysis</span></span>
<span data-ttu-id="56ce1-137">以下範例包含具有情感分析 Machine Learning 函式的串流分析作業，如 [串流分析 Machine Learning 整合教學課程](stream-analytics-machine-learning-integration-tutorial.md)所述。</span><span class="sxs-lookup"><span data-stu-id="56ce1-137">The following example includes a Stream Analytics job with the sentiment analysis Machine Learning function, as described in the [Stream Analytics Machine Learning integration tutorial](stream-analytics-machine-learning-integration-tutorial.md).</span></span>

<span data-ttu-id="56ce1-138">此查詢是一個簡單的完全分割查詢，其後接著 **sentiment** 函式，如下所示︰</span><span class="sxs-lookup"><span data-stu-id="56ce1-138">The query is a simple fully partitioned query followed by the **sentiment** function, as shown below:</span></span>

    WITH subquery AS (
        SELECT text, sentiment(text) as result from input
    )

    Select text, result.[Score]
    Into output
    From subquery

<span data-ttu-id="56ce1-139">請考慮下列案例：如果有每秒 10,000 則推文的輸送量，則必須建立串流分析作業才能執行推文 (事件) 的情緒分析。</span><span class="sxs-lookup"><span data-stu-id="56ce1-139">Consider the following scenario; with a throughput of 10,000 tweets per second a Stream Analytics job must be created to perform sentiment analysis of the tweets (events).</span></span> <span data-ttu-id="56ce1-140">使用 1 個 SU，此串流分析作業是否能夠處理此流量？</span><span class="sxs-lookup"><span data-stu-id="56ce1-140">Using 1 SU, could this Stream Analytics job be able to handle the traffic?</span></span> <span data-ttu-id="56ce1-141">使用預設批次大小 1000，此作業應該能夠跟上輸入的速度。</span><span class="sxs-lookup"><span data-stu-id="56ce1-141">Using the default batch size of 1000 the job should be able to keep up with the input.</span></span> <span data-ttu-id="56ce1-142">此外，新增的 Machine Learning 函式應產生低於一秒的延遲，也就是情感分析 Machine Learning Web 服務的一般預設延遲 (預設批次大小為 1000)。</span><span class="sxs-lookup"><span data-stu-id="56ce1-142">Further the added Machine Learning function should generate no more than a second of latency, which is the general default latency of the sentiment analysis Machine Learning web service (with a default batch size of 1000).</span></span> <span data-ttu-id="56ce1-143">串流分析作業的 **整體** 或端對端延遲通常是幾秒鐘的時間。</span><span class="sxs-lookup"><span data-stu-id="56ce1-143">The Stream Analytics job’s **overall** or end-to-end latency would typically be a few seconds.</span></span> <span data-ttu-id="56ce1-144">更深入了解此串流分析作業，尤其是  Machine Learning 函式呼叫。</span><span class="sxs-lookup"><span data-stu-id="56ce1-144">Take a more detailed look into this Stream Analytics job, *especially* the Machine Learning function calls.</span></span> <span data-ttu-id="56ce1-145">如果批次大小為 1000，則 10,000 個事件的輸送量大約會取用對 Web 服務的 10 個要求。</span><span class="sxs-lookup"><span data-stu-id="56ce1-145">Having the batch size as 1000, a throughput of 10,000 events will take about 10 requests to web service.</span></span> <span data-ttu-id="56ce1-146">即使是 1 個 SU，也有足夠的同時連線可容納此輸入流量。</span><span class="sxs-lookup"><span data-stu-id="56ce1-146">Even with 1 SU, there are enough concurrent connections to accommodate this input traffic.</span></span>

<span data-ttu-id="56ce1-147">但如果輸入事件速率漸次增加 100x，而串流分析作業現在每秒需要處理 1,000,000 則推文，該怎麼辦？</span><span class="sxs-lookup"><span data-stu-id="56ce1-147">But what if the input event rate increases by 100x and now the Stream Analytics job needs to process 1,000,000 tweets per second?</span></span> <span data-ttu-id="56ce1-148">有兩個選項：</span><span class="sxs-lookup"><span data-stu-id="56ce1-148">There are two options:</span></span>

1. <span data-ttu-id="56ce1-149">增加批次大小，或</span><span class="sxs-lookup"><span data-stu-id="56ce1-149">Increase the batch size, or</span></span>
2. <span data-ttu-id="56ce1-150">分割輸入串流以平行方式處理事件</span><span class="sxs-lookup"><span data-stu-id="56ce1-150">Partition the input stream to process the events in parallel</span></span>

<span data-ttu-id="56ce1-151">使用第一個選項時，會增加作業 **延遲** 。</span><span class="sxs-lookup"><span data-stu-id="56ce1-151">With the first option, the job **latency** will increase.</span></span>

<span data-ttu-id="56ce1-152">使用第二個選項時，需要佈建更多 SU，因而產生更多同時 Machine Learning Web 服務要求。</span><span class="sxs-lookup"><span data-stu-id="56ce1-152">With the second option, more SUs would need to be provisioned and therefore generate more concurrent Machine Learning web service requests.</span></span> <span data-ttu-id="56ce1-153">這表示作業 **成本** 會增加。</span><span class="sxs-lookup"><span data-stu-id="56ce1-153">This means the job **cost** will increase.</span></span>

<span data-ttu-id="56ce1-154">假設情感分析 Machine Learning Web 服務的延遲如下：1000 個事件或以下的批次延遲 200 毫秒、5000 個事件的批次延遲 250 毫秒、10,000 個事件的批次延遲 300 毫秒，或 25,000 個事件的批次延遲 500 毫秒。</span><span class="sxs-lookup"><span data-stu-id="56ce1-154">Assume the latency of the sentiment analysis Machine Learning web service is 200ms for 1000-event batches or below, 250ms for 5,000-event batches, 300ms for 10,000-event batches or 500ms for 25,000-event batches.</span></span>

1. <span data-ttu-id="56ce1-155">使用第一個選項 (**不要**佈建更多 SU)，批次大小可以增加到 **25,000**。</span><span class="sxs-lookup"><span data-stu-id="56ce1-155">Using the first option, (**not** provisioning more SUs), the batch size could be increased to **25,000**.</span></span> <span data-ttu-id="56ce1-156">然而，這可讓作業利用對 Machine Learning Web 服務的 20 個同時連線來處理 1,000,000 個事件 (每次呼叫的延遲為 500 毫秒)。</span><span class="sxs-lookup"><span data-stu-id="56ce1-156">This in turn would allow the job to process 1,000,000 events with 20 concurrent connections to the Machine Learning web service (with a latency of 500ms per call).</span></span> <span data-ttu-id="56ce1-157">所以因為對 Machine Learning Web 服務要求的情感函式要求而產生的額外串流分析作業延遲會從 **200 毫秒**增加至 **500 毫秒**。</span><span class="sxs-lookup"><span data-stu-id="56ce1-157">So the additional latency of the Stream Analytics job due to the sentiment function requests against the Machine Learning web service requests would be increased from **200ms** to **500ms**.</span></span> <span data-ttu-id="56ce1-158">不過請注意，批次大小 **無法** 無限增加，因為 Machine Learning Web 服務所需的要求承載大小是 4MB，否則較小的 Web 服務要求會作業 100 秒後逾時。</span><span class="sxs-lookup"><span data-stu-id="56ce1-158">However, note that batch size **cannot** be increased infinitely as the Machine Learning web services requires the payload size of a request be 4MB or smaller web service requests timeout after 100 seconds of operation.</span></span>
2. <span data-ttu-id="56ce1-159">使用第二個選項，批次大小會保留為 1000、Web 服務延遲為 200 毫秒，則每 20 個對 Web 服務的同時連線就能夠處理 1000 * 20 * 5 個事件 = 每秒 100,000。</span><span class="sxs-lookup"><span data-stu-id="56ce1-159">Using the second option, the batch size is left at 1000, with 200ms web service latency, every 20 concurrent connections to the web service would be able to process 1000 * 20 * 5 events = 100,000 per second.</span></span> <span data-ttu-id="56ce1-160">因此若要每秒處理 1,000,000 個事件，作業會需要 60 SU。</span><span class="sxs-lookup"><span data-stu-id="56ce1-160">So to process 1,000,000 events per second, the job would need 60 SUs.</span></span> <span data-ttu-id="56ce1-161">相較於第一個選項，串流分析作業會產生更多 Web 服務批次要求，進而使成本提高。</span><span class="sxs-lookup"><span data-stu-id="56ce1-161">Compared to the first option, Stream Analytics job would make more web service batch requests, in turn generating an increased cost.</span></span>

<span data-ttu-id="56ce1-162">下表是不同 SU 和批次大小的串流分析作業輸送量 (以每秒的事件數目表示)。</span><span class="sxs-lookup"><span data-stu-id="56ce1-162">Below is a table for the throughput of the Stream Analytics job for different SUs and batch sizes (in number of events per second).</span></span>

| <span data-ttu-id="56ce1-163">批次大小 (ML 延遲)</span><span class="sxs-lookup"><span data-stu-id="56ce1-163">batch size (ML latency)</span></span> | <span data-ttu-id="56ce1-164">500 (200 毫秒)</span><span class="sxs-lookup"><span data-stu-id="56ce1-164">500 (200ms)</span></span> | <span data-ttu-id="56ce1-165">1,000 (200 毫秒)</span><span class="sxs-lookup"><span data-stu-id="56ce1-165">1,000 (200ms)</span></span> | <span data-ttu-id="56ce1-166">5,000 (250 毫秒)</span><span class="sxs-lookup"><span data-stu-id="56ce1-166">5,000 (250ms)</span></span> | <span data-ttu-id="56ce1-167">10,000 (300 毫秒)</span><span class="sxs-lookup"><span data-stu-id="56ce1-167">10,000 (300ms)</span></span> | <span data-ttu-id="56ce1-168">25,000 (500 毫秒)</span><span class="sxs-lookup"><span data-stu-id="56ce1-168">25,000 (500ms)</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="56ce1-169">**1 SU**</span><span class="sxs-lookup"><span data-stu-id="56ce1-169">**1 SU**</span></span> |<span data-ttu-id="56ce1-170">2,500</span><span class="sxs-lookup"><span data-stu-id="56ce1-170">2,500</span></span> |<span data-ttu-id="56ce1-171">5,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-171">5,000</span></span> |<span data-ttu-id="56ce1-172">20,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-172">20,000</span></span> |<span data-ttu-id="56ce1-173">30,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-173">30,000</span></span> |<span data-ttu-id="56ce1-174">50,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-174">50,000</span></span> |
| <span data-ttu-id="56ce1-175">**3 SU**</span><span class="sxs-lookup"><span data-stu-id="56ce1-175">**3 SUs**</span></span> |<span data-ttu-id="56ce1-176">2,500</span><span class="sxs-lookup"><span data-stu-id="56ce1-176">2,500</span></span> |<span data-ttu-id="56ce1-177">5,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-177">5,000</span></span> |<span data-ttu-id="56ce1-178">20,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-178">20,000</span></span> |<span data-ttu-id="56ce1-179">30,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-179">30,000</span></span> |<span data-ttu-id="56ce1-180">50,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-180">50,000</span></span> |
| <span data-ttu-id="56ce1-181">**6 SU**</span><span class="sxs-lookup"><span data-stu-id="56ce1-181">**6 SUs**</span></span> |<span data-ttu-id="56ce1-182">2,500</span><span class="sxs-lookup"><span data-stu-id="56ce1-182">2,500</span></span> |<span data-ttu-id="56ce1-183">5,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-183">5,000</span></span> |<span data-ttu-id="56ce1-184">20,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-184">20,000</span></span> |<span data-ttu-id="56ce1-185">30,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-185">30,000</span></span> |<span data-ttu-id="56ce1-186">50,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-186">50,000</span></span> |
| <span data-ttu-id="56ce1-187">**12 SU**</span><span class="sxs-lookup"><span data-stu-id="56ce1-187">**12 SUs**</span></span> |<span data-ttu-id="56ce1-188">5,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-188">5,000</span></span> |<span data-ttu-id="56ce1-189">10,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-189">10,000</span></span> |<span data-ttu-id="56ce1-190">40,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-190">40,000</span></span> |<span data-ttu-id="56ce1-191">60,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-191">60,000</span></span> |<span data-ttu-id="56ce1-192">100,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-192">100,000</span></span> |
| <span data-ttu-id="56ce1-193">**18 SU**</span><span class="sxs-lookup"><span data-stu-id="56ce1-193">**18 SUs**</span></span> |<span data-ttu-id="56ce1-194">7,500</span><span class="sxs-lookup"><span data-stu-id="56ce1-194">7,500</span></span> |<span data-ttu-id="56ce1-195">15,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-195">15,000</span></span> |<span data-ttu-id="56ce1-196">60,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-196">60,000</span></span> |<span data-ttu-id="56ce1-197">90,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-197">90,000</span></span> |<span data-ttu-id="56ce1-198">150,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-198">150,000</span></span> |
| <span data-ttu-id="56ce1-199">**24 SU**</span><span class="sxs-lookup"><span data-stu-id="56ce1-199">**24 SUs**</span></span> |<span data-ttu-id="56ce1-200">10,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-200">10,000</span></span> |<span data-ttu-id="56ce1-201">20,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-201">20,000</span></span> |<span data-ttu-id="56ce1-202">80,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-202">80,000</span></span> |<span data-ttu-id="56ce1-203">120,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-203">120,000</span></span> |<span data-ttu-id="56ce1-204">200,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-204">200,000</span></span> |
| <span data-ttu-id="56ce1-205">**…**</span><span class="sxs-lookup"><span data-stu-id="56ce1-205">**…**</span></span> |<span data-ttu-id="56ce1-206">…</span><span class="sxs-lookup"><span data-stu-id="56ce1-206">…</span></span> |<span data-ttu-id="56ce1-207">…</span><span class="sxs-lookup"><span data-stu-id="56ce1-207">…</span></span> |<span data-ttu-id="56ce1-208">…</span><span class="sxs-lookup"><span data-stu-id="56ce1-208">…</span></span> |<span data-ttu-id="56ce1-209">…</span><span class="sxs-lookup"><span data-stu-id="56ce1-209">…</span></span> |<span data-ttu-id="56ce1-210">…</span><span class="sxs-lookup"><span data-stu-id="56ce1-210">…</span></span> |
| <span data-ttu-id="56ce1-211">**60 SU**</span><span class="sxs-lookup"><span data-stu-id="56ce1-211">**60 SUs**</span></span> |<span data-ttu-id="56ce1-212">25,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-212">25,000</span></span> |<span data-ttu-id="56ce1-213">50,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-213">50,000</span></span> |<span data-ttu-id="56ce1-214">200,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-214">200,000</span></span> |<span data-ttu-id="56ce1-215">300,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-215">300,000</span></span> |<span data-ttu-id="56ce1-216">500,000</span><span class="sxs-lookup"><span data-stu-id="56ce1-216">500,000</span></span> |

<span data-ttu-id="56ce1-217">現在，您應該已充分了解串流分析中 Machine Learning 函式的運作方式。</span><span class="sxs-lookup"><span data-stu-id="56ce1-217">By now, you should already have a good understanding of how Machine Learning functions in Stream Analytics work.</span></span> <span data-ttu-id="56ce1-218">您可能也了解串流分析作業會從資料來源「提取」資料，而且每次「提取」會傳回一批事件以供串流分析作業處理。</span><span class="sxs-lookup"><span data-stu-id="56ce1-218">You likely also understand that Stream Analytics jobs “pull” data from data sources and each “pull” returns a batch of events for the Stream Analytics job to process.</span></span> <span data-ttu-id="56ce1-219">此提取模型如何影響 Machine Learning Web 服務要求？</span><span class="sxs-lookup"><span data-stu-id="56ce1-219">How does this pull model impact the Machine Learning web service requests?</span></span>

<span data-ttu-id="56ce1-220">一般來說，我們為 Machine Learning 函式設定的批次大小不會正好可被每次串流分析作業「提取」所傳回的事件數目除盡。</span><span class="sxs-lookup"><span data-stu-id="56ce1-220">Normally, the batch size we set for Machine Learning functions won’t exactly be divisible by the number of events returned by each Stream Analytics job “pull”.</span></span> <span data-ttu-id="56ce1-221">發生此狀況時，將會以「部分」的批次呼叫 Machine Learning Web 服務。</span><span class="sxs-lookup"><span data-stu-id="56ce1-221">When this occurs the Machine Learning web service will be called with “partial” batches.</span></span> <span data-ttu-id="56ce1-222">這麼做是為了不會在結合各提取的事件時，導致額外的作業延遲負擔。</span><span class="sxs-lookup"><span data-stu-id="56ce1-222">This is done to not incur additional job latency overhead in coalescing events from pull to pull.</span></span>

## <a name="new-function-related-monitoring-metrics"></a><span data-ttu-id="56ce1-223">新的函式相關監視計量</span><span class="sxs-lookup"><span data-stu-id="56ce1-223">New function-related monitoring metrics</span></span>
<span data-ttu-id="56ce1-224">在串流分析作業的 [監視] 區域中，已加入三個額外的函式相關計量。</span><span class="sxs-lookup"><span data-stu-id="56ce1-224">In the Monitor area of a Stream Analytics job, three additional function-related metrics have been added.</span></span> <span data-ttu-id="56ce1-225">分別是 [函式要求]、[函式事件] 和 [失敗的函式要求]，如下圖所示。</span><span class="sxs-lookup"><span data-stu-id="56ce1-225">They are FUNCTION REQUESTS, FUNCTION EVENTS and FAILED FUNCTION REQUESTS, as shown in the graphic below.</span></span>

<span data-ttu-id="56ce1-226">![使用 Machine Learning 函式計量調整串流分析](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "使用 Machine Learning 函式計量調整串流分析")</span><span class="sxs-lookup"><span data-stu-id="56ce1-226">![Scale Stream Analytics with Machine Learning Functions Metrics](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Scale Stream Analytics with Machine Learning Functions Metrics")</span></span>

<span data-ttu-id="56ce1-227">其定義如下：</span><span class="sxs-lookup"><span data-stu-id="56ce1-227">The are defined as follows:</span></span>

<span data-ttu-id="56ce1-228">**函式要求**︰函式要求的數目。</span><span class="sxs-lookup"><span data-stu-id="56ce1-228">**FUNCTION REQUESTS**: The number of function requests.</span></span>

<span data-ttu-id="56ce1-229">**函式事件**︰函式要求中的事件數目。</span><span class="sxs-lookup"><span data-stu-id="56ce1-229">**FUNCTION EVENTS**: The number events in the function requests.</span></span>

<span data-ttu-id="56ce1-230">**失敗的函式要求**︰失敗的函式要求數目。</span><span class="sxs-lookup"><span data-stu-id="56ce1-230">**FAILED FUNCTION REQUESTS**: The number of failed function requests.</span></span>

## <a name="key-takeaways"></a><span data-ttu-id="56ce1-231">重要心得</span><span class="sxs-lookup"><span data-stu-id="56ce1-231">Key Takeaways</span></span>
<span data-ttu-id="56ce1-232">若要彙整重點，以便使用 Machine Learning 函式調整串流分析作業，必須考量下列項目︰</span><span class="sxs-lookup"><span data-stu-id="56ce1-232">To summarize the main points, in order to scale an Stream Analytics job with Machine Learning functions, the following items must be considered:</span></span>

1. <span data-ttu-id="56ce1-233">輸入事件速率</span><span class="sxs-lookup"><span data-stu-id="56ce1-233">The input event rate</span></span>
2. <span data-ttu-id="56ce1-234">執行中串流分析作業容許的延遲 (和 Machine Learning Web 服務要求的批次大小)</span><span class="sxs-lookup"><span data-stu-id="56ce1-234">The tolerated latency for the running Stream Analytics job (and thus the batch size of the Machine Learning web service requests)</span></span>
3. <span data-ttu-id="56ce1-235">佈建的串流分析 SU 和 Machine Learning Web 服務要求數目 (額外的函式相關成本)</span><span class="sxs-lookup"><span data-stu-id="56ce1-235">The provisioned Stream Analytics SUs and the number of Machine Learning web service requests (the additional function-related costs)</span></span>

<span data-ttu-id="56ce1-236">以完全分割的串流分析查詢為例。</span><span class="sxs-lookup"><span data-stu-id="56ce1-236">A fully partitioned Stream Analytics query was used as an example.</span></span> <span data-ttu-id="56ce1-237">如果需要更複雜的查詢， [Azure Stream Analytics forum (Azure 串流分析論壇)](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) 是可向串流分析小組取得其他協助的絕佳資源。</span><span class="sxs-lookup"><span data-stu-id="56ce1-237">If a more complex query is needed the [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) is a great resource for getting additional help from the Stream Analytics team.</span></span>

## <a name="next-steps"></a><span data-ttu-id="56ce1-238">後續步驟</span><span class="sxs-lookup"><span data-stu-id="56ce1-238">Next steps</span></span>
<span data-ttu-id="56ce1-239">若要深入了解串流分析，請參閱：</span><span class="sxs-lookup"><span data-stu-id="56ce1-239">To learn more about Stream Analytics, see:</span></span>

* [<span data-ttu-id="56ce1-240">開始使用 Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="56ce1-240">Get started using Azure Stream Analytics</span></span>](stream-analytics-real-time-fraud-detection.md)
* [<span data-ttu-id="56ce1-241">調整 Azure Stream Analytics 工作</span><span class="sxs-lookup"><span data-stu-id="56ce1-241">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="56ce1-242">Azure Stream Analytics 查詢語言參考</span><span class="sxs-lookup"><span data-stu-id="56ce1-242">Azure Stream Analytics Query Language Reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="56ce1-243">Azure 串流分析管理 REST API 參考</span><span class="sxs-lookup"><span data-stu-id="56ce1-243">Azure Stream Analytics Management REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)
