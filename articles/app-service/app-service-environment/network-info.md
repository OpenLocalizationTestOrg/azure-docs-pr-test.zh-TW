---
title: "Azure App Service 環境 aaaNetworking 考量"
description: "說明 hello ASE 網路流量以及 tooset Nsg 和 UDRs 與您 ASE"
services: app-service
documentationcenter: na
author: ccompy
manager: stefsch
ms.assetid: 955a4d84-94ca-418d-aa79-b57a5eb8cb85
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/08/2017
ms.author: ccompy
ms.openlocfilehash: d4d3000f4d4d75814b1e6d47079d967334eb1a3b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="networking-considerations-for-an-app-service-environment"></a><span data-ttu-id="06238-103">App Service Environment 的網路考量</span><span class="sxs-lookup"><span data-stu-id="06238-103">Networking considerations for an App Service environment</span></span> #

## <a name="overview"></a><span data-ttu-id="06238-104">概觀</span><span class="sxs-lookup"><span data-stu-id="06238-104">Overview</span></span> ##

 <span data-ttu-id="06238-105">Azure [App Service Environment][Intro] 是將 Azure App Service 部署到您 Azure 虛擬網路 (VNet) 中子網路的一種部署。</span><span class="sxs-lookup"><span data-stu-id="06238-105">Azure [App Service Environment][Intro] is a deployment of Azure App Service into a subnet in your Azure virtual network (VNet).</span></span> <span data-ttu-id="06238-106">App Service Environment (ASE) 有二種部署類型：</span><span class="sxs-lookup"><span data-stu-id="06238-106">There are two deployment types for an App Service environment (ASE):</span></span>

- <span data-ttu-id="06238-107">**外部 ASE**： 公開 hello ASE 裝載應用程式的可存取網際網路的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="06238-107">**External ASE**: Exposes hello ASE-hosted apps on an internet-accessible IP address.</span></span> <span data-ttu-id="06238-108">如需詳細資訊，請參閱[建立外部 ASE][MakeExternalASE]。</span><span class="sxs-lookup"><span data-stu-id="06238-108">For more information, see [Create an External ASE][MakeExternalASE].</span></span>
- <span data-ttu-id="06238-109">**ILB ASE**： 公開 hello ASE 裝載您的 VNet 內的 IP 位址上的應用程式。</span><span class="sxs-lookup"><span data-stu-id="06238-109">**ILB ASE**: Exposes hello ASE-hosted apps on an IP address inside your VNet.</span></span> <span data-ttu-id="06238-110">內部負載平衡器 (ILB)，這就是為什麼它稱為 ILB ASE hello 內部端點。</span><span class="sxs-lookup"><span data-stu-id="06238-110">hello internal endpoint is an internal load balancer (ILB), which is why it's called an ILB ASE.</span></span> <span data-ttu-id="06238-111">如需詳細資訊，請參閱[建立和使用 ILB ASE][MakeILBASE]。</span><span class="sxs-lookup"><span data-stu-id="06238-111">For more information, see [Create and use an ILB ASE][MakeILBASE].</span></span>

<span data-ttu-id="06238-112">App Service Environment 現在有兩個版本：ASEv1 和 ASEv2。</span><span class="sxs-lookup"><span data-stu-id="06238-112">There are now two versions of App Service Environment: ASEv1 and ASEv2.</span></span> <span data-ttu-id="06238-113">如需 ASEv1 資訊，請參閱[簡介 tooApp Service 環境 v1][ASEv1Intro]。</span><span class="sxs-lookup"><span data-stu-id="06238-113">For information on ASEv1, see [Introduction tooApp Service Environment v1][ASEv1Intro].</span></span> <span data-ttu-id="06238-114">ASEv1 可以部署至傳統或 Resource Manager VNet 中。</span><span class="sxs-lookup"><span data-stu-id="06238-114">ASEv1 can be deployed in a classic or Resource Manager VNet.</span></span> <span data-ttu-id="06238-115">ASEv2 只能部署至 Resource Manager VNet 中。</span><span class="sxs-lookup"><span data-stu-id="06238-115">ASEv2 can only be deployed into a Resource Manager VNet.</span></span>

<span data-ttu-id="06238-116">從 ase 中移 toohello 的所有呼叫網際網路都離開 hello VNet 透過 hello ASE 指派的 VIP。</span><span class="sxs-lookup"><span data-stu-id="06238-116">All calls from an ASE that go toohello internet leave hello VNet through a VIP assigned for hello ASE.</span></span> <span data-ttu-id="06238-117">hello 此 VIP 的公用 IP 然後 hello 的來源 IP 是從 hello ASE 移 toohello 的所有呼叫網際網路。</span><span class="sxs-lookup"><span data-stu-id="06238-117">hello public IP of this VIP is then hello source IP for all calls from hello ASE that go toohello internet.</span></span> <span data-ttu-id="06238-118">如果您 ASE 中的 hello 應用程式進行呼叫 tooresources VNet 中或透過 VPN，hello 來源 IP 是 hello 的由您 ASE hello 子網路中 Ip 的其中一個。</span><span class="sxs-lookup"><span data-stu-id="06238-118">If hello apps in your ASE make calls tooresources in your VNet or across a VPN, hello source IP is one of hello IPs in hello subnet used by your ASE.</span></span> <span data-ttu-id="06238-119">因為 hello ASE hello VNet 內，它也可以存取 hello VNet，而不需要任何額外的設定中的資源。</span><span class="sxs-lookup"><span data-stu-id="06238-119">Because hello ASE is within hello VNet, it can also access resources within hello VNet without any additional configuration.</span></span> <span data-ttu-id="06238-120">如果 hello VNet 連接的 tooyour 在內部部署網路，您 ASE 中的應用程式也那里可以存取 tooresources。</span><span class="sxs-lookup"><span data-stu-id="06238-120">If hello VNet is connected tooyour on-premises network, apps in your ASE also have access tooresources there.</span></span> <span data-ttu-id="06238-121">您不需要 tooconfigure hello ASE 或您的應用程式任何進一步。</span><span class="sxs-lookup"><span data-stu-id="06238-121">You don't need tooconfigure hello ASE or your app any further.</span></span>

![外部 ASE][1] 

<span data-ttu-id="06238-123">如果您有外部 ASE，hello 公用 VIP 也是 ASE 應用程式解決 toofor hello 端點：</span><span class="sxs-lookup"><span data-stu-id="06238-123">If you have an External ASE, hello public VIP is also hello endpoint that your ASE apps resolve toofor:</span></span>

* <span data-ttu-id="06238-124">HTTP/S。</span><span class="sxs-lookup"><span data-stu-id="06238-124">HTTP/S.</span></span> 
* <span data-ttu-id="06238-125">FTP/S。</span><span class="sxs-lookup"><span data-stu-id="06238-125">FTP/S.</span></span> 
* <span data-ttu-id="06238-126">Web 部署。</span><span class="sxs-lookup"><span data-stu-id="06238-126">Web deployment.</span></span>
* <span data-ttu-id="06238-127">遠端偵錯。</span><span class="sxs-lookup"><span data-stu-id="06238-127">Remote debugging.</span></span>

![ILB ASE][2]

<span data-ttu-id="06238-129">如果您有 ILB ASE，hello ILB 的 IP 位址會是 hello 的 HTTP/S、 FTP/S、 web 部署和遠端偵錯的 hello 端點。</span><span class="sxs-lookup"><span data-stu-id="06238-129">If you have an ILB ASE, hello IP address of hello ILB is hello endpoint for HTTP/S, FTP/S, web deployment, and remote debugging.</span></span>

<span data-ttu-id="06238-130">hello 一般應用程式存取連接埠是：</span><span class="sxs-lookup"><span data-stu-id="06238-130">hello normal app access ports are:</span></span>

| <span data-ttu-id="06238-131">使用</span><span class="sxs-lookup"><span data-stu-id="06238-131">Use</span></span> | <span data-ttu-id="06238-132">從</span><span class="sxs-lookup"><span data-stu-id="06238-132">From</span></span> | <span data-ttu-id="06238-133">太</span><span class="sxs-lookup"><span data-stu-id="06238-133">too</span></span>|
|----------|---------|-------------|
|  <span data-ttu-id="06238-134">HTTP/HTTPS</span><span class="sxs-lookup"><span data-stu-id="06238-134">HTTP/HTTPS</span></span>  | <span data-ttu-id="06238-135">可由使用者設定</span><span class="sxs-lookup"><span data-stu-id="06238-135">User configurable</span></span> |  <span data-ttu-id="06238-136">80、443</span><span class="sxs-lookup"><span data-stu-id="06238-136">80, 443</span></span> |
|  <span data-ttu-id="06238-137">FTP/FTPS</span><span class="sxs-lookup"><span data-stu-id="06238-137">FTP/FTPS</span></span>    | <span data-ttu-id="06238-138">可由使用者設定</span><span class="sxs-lookup"><span data-stu-id="06238-138">User configurable</span></span> |  <span data-ttu-id="06238-139">21、990、10001-10020</span><span class="sxs-lookup"><span data-stu-id="06238-139">21, 990, 10001-10020</span></span> |
|  <span data-ttu-id="06238-140">Visual Studio 遠端偵錯</span><span class="sxs-lookup"><span data-stu-id="06238-140">Visual Studio remote debugging</span></span>  |  <span data-ttu-id="06238-141">可由使用者設定</span><span class="sxs-lookup"><span data-stu-id="06238-141">User configurable</span></span> |  <span data-ttu-id="06238-142">4016、4018、4020、4022</span><span class="sxs-lookup"><span data-stu-id="06238-142">4016, 4018, 4020, 4022</span></span> |

<span data-ttu-id="06238-143">這適用於您位於外部 ASE 或 ILB ASE 上的情況。</span><span class="sxs-lookup"><span data-stu-id="06238-143">This is true if you're on an External ASE or on an ILB ASE.</span></span> <span data-ttu-id="06238-144">如果您在外部 ase 中，您會遇到 hello 公用 VIP 的這些通訊埠。</span><span class="sxs-lookup"><span data-stu-id="06238-144">If you're on an External ASE, you hit those ports on hello public VIP.</span></span> <span data-ttu-id="06238-145">如果您在 ILB ase 中，您會遇到 hello ILB 這些通訊埠。</span><span class="sxs-lookup"><span data-stu-id="06238-145">If you're on an ILB ASE, you hit those ports on hello ILB.</span></span> <span data-ttu-id="06238-146">若您鎖定連接埠 443，則可能會影響某些 hello 入口網站中公開的功能。</span><span class="sxs-lookup"><span data-stu-id="06238-146">If you lock down port 443, there can be an effect on some features exposed in hello portal.</span></span> <span data-ttu-id="06238-147">如需詳細資訊，請參閱[入口網站相依性](#portaldep)。</span><span class="sxs-lookup"><span data-stu-id="06238-147">For more information, see [Portal dependencies](#portaldep).</span></span>

## <a name="ase-dependencies"></a><span data-ttu-id="06238-148">ASE 相依性</span><span class="sxs-lookup"><span data-stu-id="06238-148">ASE dependencies</span></span> ##

<span data-ttu-id="06238-149">ASE 輸入存取相依性為：</span><span class="sxs-lookup"><span data-stu-id="06238-149">An ASE inbound access dependency is:</span></span>

| <span data-ttu-id="06238-150">使用</span><span class="sxs-lookup"><span data-stu-id="06238-150">Use</span></span> | <span data-ttu-id="06238-151">從</span><span class="sxs-lookup"><span data-stu-id="06238-151">From</span></span> | <span data-ttu-id="06238-152">太</span><span class="sxs-lookup"><span data-stu-id="06238-152">too</span></span>|
|-----|------|----|
| <span data-ttu-id="06238-153">管理</span><span class="sxs-lookup"><span data-stu-id="06238-153">Management</span></span> | <span data-ttu-id="06238-154">App Service 管理位址</span><span class="sxs-lookup"><span data-stu-id="06238-154">App Service management addresses</span></span> | <span data-ttu-id="06238-155">ASE 子網路：454、455</span><span class="sxs-lookup"><span data-stu-id="06238-155">ASE subnet: 454, 455</span></span> |
|  <span data-ttu-id="06238-156">ASE 內部通訊</span><span class="sxs-lookup"><span data-stu-id="06238-156">ASE internal communication</span></span> | <span data-ttu-id="06238-157">ASE 子網路：所有連接埠</span><span class="sxs-lookup"><span data-stu-id="06238-157">ASE subnet: All ports</span></span> | <span data-ttu-id="06238-158">ASE 子網路：所有連接埠</span><span class="sxs-lookup"><span data-stu-id="06238-158">ASE subnet: All ports</span></span>
|  <span data-ttu-id="06238-159">允許 Azure Load Balancer 輸入</span><span class="sxs-lookup"><span data-stu-id="06238-159">Allow Azure load balancer inbound</span></span> | <span data-ttu-id="06238-160">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="06238-160">Azure load balancer</span></span> | <span data-ttu-id="06238-161">ASE 子網路：所有連接埠</span><span class="sxs-lookup"><span data-stu-id="06238-161">ASE subnet: All ports</span></span>
|  <span data-ttu-id="06238-162">應用程式指派的 IP 位址</span><span class="sxs-lookup"><span data-stu-id="06238-162">App assigned IP addresses</span></span> | <span data-ttu-id="06238-163">應用程式指派的位址</span><span class="sxs-lookup"><span data-stu-id="06238-163">App assigned addresses</span></span> | <span data-ttu-id="06238-164">ASE 子網路：所有連接埠</span><span class="sxs-lookup"><span data-stu-id="06238-164">ASE subnet: All ports</span></span>

<span data-ttu-id="06238-165">hello 輸入的流量提供命令和控制的 hello ASE 中新增 toosystem 監視。</span><span class="sxs-lookup"><span data-stu-id="06238-165">hello inbound traffic provides command and control of hello ASE in addition toosystem monitoring.</span></span> <span data-ttu-id="06238-166">此流量的 hello 來源 Ip 會列在 hello [ASE 管理位址][ ASEManagement]文件。</span><span class="sxs-lookup"><span data-stu-id="06238-166">hello source IPs for this traffic are listed in hello [ASE Management addresses][ASEManagement] document.</span></span> <span data-ttu-id="06238-167">hello 網路安全性設定必須從所有 Ip 連接埠 454 和 455 上 tooallow 存取。</span><span class="sxs-lookup"><span data-stu-id="06238-167">hello network security configuration needs tooallow access from all IPs on ports 454 and 455.</span></span>

<span data-ttu-id="06238-168">Hello ASE 子網路有許多連接埠所使用的內部元件通訊，以及他們可以變更。</span><span class="sxs-lookup"><span data-stu-id="06238-168">Within hello ASE subnet there are many ports used for internal component communication and they can change.</span></span>  <span data-ttu-id="06238-169">這需要所有的 hello hello ASE 子網路 toobe 存取從 hello ASE 子網路中的連接埠。</span><span class="sxs-lookup"><span data-stu-id="06238-169">This requires all of hello ports in hello ASE subnet toobe accessible from hello ASE subnet.</span></span> 

<span data-ttu-id="06238-170">Hello 和之間的通訊 hello Azure 負載平衡器 hello ASE 子網路 hello 最小連接埠開啟該需要 toobe 為 454、 455 和 16001。</span><span class="sxs-lookup"><span data-stu-id="06238-170">For hello communication between hello Azure load balancer and hello ASE subnet hello minimum ports that need toobe open are 454, 455 and 16001.</span></span> <span data-ttu-id="06238-171">保持運作流量 hello 負載平衡器與 hello ASE 之間會使用 hello 16001 連接埠。</span><span class="sxs-lookup"><span data-stu-id="06238-171">hello 16001 port is used for keep alive traffic between hello load balancer and hello ASE.</span></span> <span data-ttu-id="06238-172">如果您使用 ILB ase 中，您可以鎖定下 toojust hello 454，455，16001 連接埠的流量。</span><span class="sxs-lookup"><span data-stu-id="06238-172">If you are using an ILB ASE then you can lock traffic down toojust hello 454, 455, 16001 ports.</span></span>  <span data-ttu-id="06238-173">如果您使用外部 ase 中則需要 tootake 到帳戶 hello 一般應用程式存取連接埠。</span><span class="sxs-lookup"><span data-stu-id="06238-173">If you are using an External ASE then you need tootake into account hello normal app access ports.</span></span>  <span data-ttu-id="06238-174">如果您使用的指派的應用程式位址則需要 tooopen 它 tooall 連接埠。</span><span class="sxs-lookup"><span data-stu-id="06238-174">If you are using app assigned addresses you need tooopen it tooall ports.</span></span>  <span data-ttu-id="06238-175">將位址指派 tooa 特定的應用程式，然後 hello 負載平衡器將會使用預先 toosend HTTP 和 HTTPS 流量 toohello ASE 未知的連接埠。</span><span class="sxs-lookup"><span data-stu-id="06238-175">When an address is assigned tooa specific app, then hello load balancer will use ports that are not known of in advance toosend HTTP and HTTPS traffic toohello ASE.</span></span>

<span data-ttu-id="06238-176">如果您使用指派的應用程式的 IP 位址則需要 tooallow hello Ip 指派 tooyour 應用程式 toohello ASE 子網路流量。</span><span class="sxs-lookup"><span data-stu-id="06238-176">If you are using app assigned IP addresses you need tooallow traffic from hello IPs assigned tooyour apps toohello ASE subnet.</span></span>

<span data-ttu-id="06238-177">對於輸出存取，ASE 取決於多個外部系統。</span><span class="sxs-lookup"><span data-stu-id="06238-177">For outbound access, an ASE depends on multiple external systems.</span></span> <span data-ttu-id="06238-178">這些系統相依性所定義的 DNS 名稱，而不要對應 tooa 固定的一組 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="06238-178">Those system dependencies are defined with DNS names and don't map tooa fixed set of IP addresses.</span></span> <span data-ttu-id="06238-179">因此，hello ASE 必須能夠存取外部 hello ASE 子網路 tooall 從各種不同的連接埠上的外部 Ip。</span><span class="sxs-lookup"><span data-stu-id="06238-179">Thus, hello ASE requires outbound access from hello ASE subnet tooall external IPs across a variety of ports.</span></span> <span data-ttu-id="06238-180">Ase 中具有下列輸出相依性的 hello:</span><span class="sxs-lookup"><span data-stu-id="06238-180">An ASE has hello following outbound dependencies:</span></span>

| <span data-ttu-id="06238-181">使用</span><span class="sxs-lookup"><span data-stu-id="06238-181">Use</span></span> | <span data-ttu-id="06238-182">從</span><span class="sxs-lookup"><span data-stu-id="06238-182">From</span></span> | <span data-ttu-id="06238-183">太</span><span class="sxs-lookup"><span data-stu-id="06238-183">too</span></span>|
|-----|------|----|
| <span data-ttu-id="06238-184">Azure 儲存體</span><span class="sxs-lookup"><span data-stu-id="06238-184">Azure Storage</span></span> | <span data-ttu-id="06238-185">ASE 子網路</span><span class="sxs-lookup"><span data-stu-id="06238-185">ASE subnet</span></span> | <span data-ttu-id="06238-186">table.core.windows.net、blob.core.windows.net、queue.core.windows.net、file.core.windows.net：80、443、445 (只有 ASEv1 才需要 445)</span><span class="sxs-lookup"><span data-stu-id="06238-186">table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net: 80, 443, 445 (445 is only needed for ASEv1.)</span></span> |
| <span data-ttu-id="06238-187">Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="06238-187">Azure SQL Database</span></span> | <span data-ttu-id="06238-188">ASE 子網路</span><span class="sxs-lookup"><span data-stu-id="06238-188">ASE subnet</span></span> | <span data-ttu-id="06238-189">database.windows.net：1433、11000-11999、14000-14999 (如需詳細資訊，請參閱 [SQL Database V12 連接埠用法](../../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md))</span><span class="sxs-lookup"><span data-stu-id="06238-189">database.windows.net: 1433, 11000-11999, 14000-14999 (For more information, see [SQL Database V12 port usage](../../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).)</span></span>|
| <span data-ttu-id="06238-190">Azure 管理</span><span class="sxs-lookup"><span data-stu-id="06238-190">Azure management</span></span> | <span data-ttu-id="06238-191">ASE 子網路</span><span class="sxs-lookup"><span data-stu-id="06238-191">ASE subnet</span></span> | <span data-ttu-id="06238-192">management.core.windows.net、management.azure.com：443</span><span class="sxs-lookup"><span data-stu-id="06238-192">management.core.windows.net, management.azure.com: 443</span></span> 
| <span data-ttu-id="06238-193">SSL 憑證驗證</span><span class="sxs-lookup"><span data-stu-id="06238-193">SSL certificate verification</span></span> |  <span data-ttu-id="06238-194">ASE 子網路</span><span class="sxs-lookup"><span data-stu-id="06238-194">ASE subnet</span></span>            |  <span data-ttu-id="06238-195">ocsp.msocsp.com、mscrl.microsoft.com、crl.microsoft.com：443</span><span class="sxs-lookup"><span data-stu-id="06238-195">ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com: 443</span></span>
| <span data-ttu-id="06238-196">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="06238-196">Azure Active Directory</span></span>        | <span data-ttu-id="06238-197">ASE 子網路</span><span class="sxs-lookup"><span data-stu-id="06238-197">ASE subnet</span></span>            |  <span data-ttu-id="06238-198">網際網路：443</span><span class="sxs-lookup"><span data-stu-id="06238-198">Internet: 443</span></span>
| <span data-ttu-id="06238-199">App Service 管理</span><span class="sxs-lookup"><span data-stu-id="06238-199">App Service management</span></span>        | <span data-ttu-id="06238-200">ASE 子網路</span><span class="sxs-lookup"><span data-stu-id="06238-200">ASE subnet</span></span>            |  <span data-ttu-id="06238-201">網際網路：443</span><span class="sxs-lookup"><span data-stu-id="06238-201">Internet: 443</span></span>
| <span data-ttu-id="06238-202">Azure DNS</span><span class="sxs-lookup"><span data-stu-id="06238-202">Azure DNS</span></span>                     | <span data-ttu-id="06238-203">ASE 子網路</span><span class="sxs-lookup"><span data-stu-id="06238-203">ASE subnet</span></span>            |  <span data-ttu-id="06238-204">網際網路：53</span><span class="sxs-lookup"><span data-stu-id="06238-204">Internet: 53</span></span>
| <span data-ttu-id="06238-205">ASE 內部通訊</span><span class="sxs-lookup"><span data-stu-id="06238-205">ASE internal communication</span></span>    | <span data-ttu-id="06238-206">ASE 子網路：所有連接埠</span><span class="sxs-lookup"><span data-stu-id="06238-206">ASE subnet: All ports</span></span> |  <span data-ttu-id="06238-207">ASE 子網路：所有連接埠</span><span class="sxs-lookup"><span data-stu-id="06238-207">ASE subnet: All ports</span></span>

<span data-ttu-id="06238-208">如果 hello ASE 失去存取 toothese 相依性，它會停止運作。</span><span class="sxs-lookup"><span data-stu-id="06238-208">If hello ASE loses access toothese dependencies, it stops working.</span></span> <span data-ttu-id="06238-209">發生的長時間不夠，hello ASE 已暫停。</span><span class="sxs-lookup"><span data-stu-id="06238-209">When that happens long enough, hello ASE is suspended.</span></span>

### <a name="customer-dns"></a><span data-ttu-id="06238-210">客戶 DNS</span><span class="sxs-lookup"><span data-stu-id="06238-210">Customer DNS</span></span> ###

<span data-ttu-id="06238-211">如果 hello 的 VNet 設定的客戶定義的 DNS 伺服器，hello 租用戶工作負載會使用它。</span><span class="sxs-lookup"><span data-stu-id="06238-211">If hello VNet is configured with a customer-defined DNS server, hello tenant workloads use it.</span></span> <span data-ttu-id="06238-212">hello ASE 仍然需要使用 Azure DNS toocommunicate 進行管理。</span><span class="sxs-lookup"><span data-stu-id="06238-212">hello ASE still needs toocommunicate with Azure DNS for management purposes.</span></span> 

<span data-ttu-id="06238-213">如果 hello 的 VNet 設定的 DNS 客戶上 hello VPN 的另一端，hello DNS 伺服器必須是包含 hello ASE hello 子網路觸達。</span><span class="sxs-lookup"><span data-stu-id="06238-213">If hello VNet is configured with a customer DNS on hello other side of a VPN, hello DNS server must be reachable from hello subnet that contains hello ASE.</span></span>

<a name="portaldep"></a>

## <a name="portal-dependencies"></a><span data-ttu-id="06238-214">入口網站相依性</span><span class="sxs-lookup"><span data-stu-id="06238-214">Portal dependencies</span></span> ##

<span data-ttu-id="06238-215">在加法 toohello ASE 功能相依性，有幾個額外的項目相關的 toohello 入口網站體驗。</span><span class="sxs-lookup"><span data-stu-id="06238-215">In addition toohello ASE functional dependencies, there are a few extra items related toohello portal experience.</span></span> <span data-ttu-id="06238-216">部份 hello Azure 入口網站中的 hello 功能取決於直接存取 too_SCM site_。</span><span class="sxs-lookup"><span data-stu-id="06238-216">Some of hello capabilities in hello Azure portal depend on direct access too_SCM site_.</span></span> <span data-ttu-id="06238-217">Azure App Service 中的每個應用程式都有兩個 URL。</span><span class="sxs-lookup"><span data-stu-id="06238-217">For every app in Azure App Service, there are two URLs.</span></span> <span data-ttu-id="06238-218">hello 第一個 URL 是 tooaccess 您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="06238-218">hello first URL is tooaccess your app.</span></span> <span data-ttu-id="06238-219">hello 第二個 URL 是 tooaccess hello SCM 站台，這也稱為 hello _Kudu 主控台_。</span><span class="sxs-lookup"><span data-stu-id="06238-219">hello second URL is tooaccess hello SCM site, which is also called hello _Kudu console_.</span></span> <span data-ttu-id="06238-220">使用 hello SCM 站台的功能包括：</span><span class="sxs-lookup"><span data-stu-id="06238-220">Features that use hello SCM site include:</span></span>

-   <span data-ttu-id="06238-221">Web Job</span><span class="sxs-lookup"><span data-stu-id="06238-221">Web jobs</span></span>
-   <span data-ttu-id="06238-222">Functions</span><span class="sxs-lookup"><span data-stu-id="06238-222">Functions</span></span>
-   <span data-ttu-id="06238-223">記錄串流</span><span class="sxs-lookup"><span data-stu-id="06238-223">Log streaming</span></span>
-   <span data-ttu-id="06238-224">Kudu</span><span class="sxs-lookup"><span data-stu-id="06238-224">Kudu</span></span>
-   <span data-ttu-id="06238-225">擴充功能</span><span class="sxs-lookup"><span data-stu-id="06238-225">Extensions</span></span>
-   <span data-ttu-id="06238-226">處理序總管</span><span class="sxs-lookup"><span data-stu-id="06238-226">Process Explorer</span></span>
-   <span data-ttu-id="06238-227">主控台</span><span class="sxs-lookup"><span data-stu-id="06238-227">Console</span></span>

<span data-ttu-id="06238-228">當您使用 ILB ASE 時，hello SCM 站台不是從 hello VNet 之外存取網際網路。</span><span class="sxs-lookup"><span data-stu-id="06238-228">When you use an ILB ASE, hello SCM site isn't internet accessible from outside hello VNet.</span></span> <span data-ttu-id="06238-229">當您的應用程式裝載於 ILB ase 中時，某些功能將無法運作，從 hello 入口網站。</span><span class="sxs-lookup"><span data-stu-id="06238-229">When your app is hosted on an ILB ASE, some capabilities will not work from hello portal.</span></span>  

<span data-ttu-id="06238-230">許多相依於 hello SCM 站台的這些功能也會提供直接在 hello Kudu 主控台中。</span><span class="sxs-lookup"><span data-stu-id="06238-230">Many of those capabilities that depend upon hello SCM site are also available directly in hello Kudu console.</span></span> <span data-ttu-id="06238-231">您可以連接 tooit 直接而不是使用 hello 入口網站。</span><span class="sxs-lookup"><span data-stu-id="06238-231">You can connect tooit directly rather than by using hello portal.</span></span> <span data-ttu-id="06238-232">如果您的應用程式裝載在 ILB ase 中，使用在您發行認證 toosign。</span><span class="sxs-lookup"><span data-stu-id="06238-232">If your app is hosted in an ILB ASE, use your publishing credentials toosign in.</span></span> <span data-ttu-id="06238-233">hello URL tooaccess hello SCM 的站台在 ILB ase 中裝載的應用程式具有下列格式的 hello:</span><span class="sxs-lookup"><span data-stu-id="06238-233">hello URL tooaccess hello SCM site of an app hosted in an ILB ASE has hello following format:</span></span> 

```
<appname>.scm.<domain name hello ILB ASE was created with> 
```

<span data-ttu-id="06238-234">如果 ILB ASE hello 網域名稱*contoso.net*和您的應用程式名稱是*testapp*，hello 應用程式已達*testapp.contoso.net*。</span><span class="sxs-lookup"><span data-stu-id="06238-234">If your ILB ASE is hello domain name *contoso.net* and your app name is *testapp*, hello app is reached at *testapp.contoso.net*.</span></span> <span data-ttu-id="06238-235">hello SCM 站台，它會在達到*testapp.scm.contoso.net*。</span><span class="sxs-lookup"><span data-stu-id="06238-235">hello SCM site that goes with it is reached at *testapp.scm.contoso.net*.</span></span>

### <a name="functions-and-web-jobs"></a><span data-ttu-id="06238-236">函式和 Web 工作</span><span class="sxs-lookup"><span data-stu-id="06238-236">Functions and Web jobs</span></span> ###

<span data-ttu-id="06238-237">函式和 Web 工作相依於 hello SCM 站台，但即使您的應用程式中 ILB ase 中，只要您的瀏覽器可以到達 hello SCM 站台支援在 hello 入口網站使用。</span><span class="sxs-lookup"><span data-stu-id="06238-237">Both Functions and Web jobs depend on hello SCM site but are supported for use in hello portal, even if your apps are in an ILB ASE, so long as your browser can reach hello SCM site.</span></span>  <span data-ttu-id="06238-238">如果您使用 ILB ASE 使用自我簽署的憑證，您將需要 tooenable 憑證您瀏覽器 tootrust。</span><span class="sxs-lookup"><span data-stu-id="06238-238">If you are using a self-signed certificate with your ILB ASE, you will need tooenable your browser tootrust that certificate.</span></span>  <span data-ttu-id="06238-239">IE 與表示 hello 憑證的邊緣具有 toobe 在 hello 電腦信任存放區。</span><span class="sxs-lookup"><span data-stu-id="06238-239">For IE and Edge that means hello certificate has toobe in hello computer trust store.</span></span>  <span data-ttu-id="06238-240">如果您使用 Chrome，則這表示您接受 hello 瀏覽器中的 hello 憑證稍早假定直接叫用 hello scm 站台。</span><span class="sxs-lookup"><span data-stu-id="06238-240">If you are using Chrome then that means you accepted hello certificate in hello browser earlier by presumably hitting hello scm site directly.</span></span>  <span data-ttu-id="06238-241">hello 最好的解決方案是 toouse hello 瀏覽器信任鏈結中的商業憑證。</span><span class="sxs-lookup"><span data-stu-id="06238-241">hello best solution is toouse a commercial certificate that is in hello browser chain of trust.</span></span>  

## <a name="ase-ip-addresses"></a><span data-ttu-id="06238-242">ASE IP 位址</span><span class="sxs-lookup"><span data-stu-id="06238-242">ASE IP addresses</span></span> ##

<span data-ttu-id="06238-243">Ase 中有幾個 IP 位址 toobe 留意。</span><span class="sxs-lookup"><span data-stu-id="06238-243">An ASE has a few IP addresses toobe aware of.</span></span> <span data-ttu-id="06238-244">如下：</span><span class="sxs-lookup"><span data-stu-id="06238-244">They are:</span></span>

- <span data-ttu-id="06238-245">**公用輸入 IP 位址**：用於外部 ASE 中的應用程式流量，以及外部 ASE 和 ILB ASE 中的管理流量。</span><span class="sxs-lookup"><span data-stu-id="06238-245">**Public inbound IP address**: Used for app traffic in an External ASE, and management traffic in both an External ASE and an ILB ASE.</span></span>
- <span data-ttu-id="06238-246">**輸出的公用 IP**： 做為 hello"from"IP hello ASE 傳出連線該保持 hello VNet，這不 VPN 下路由傳送。</span><span class="sxs-lookup"><span data-stu-id="06238-246">**Outbound public IP**: Used as hello "from" IP for outbound connections from hello ASE that leave hello VNet, which aren't routed down a VPN.</span></span>
- <span data-ttu-id="06238-247">**ILB IP 位址**：如果您是使用 ILB ASE。</span><span class="sxs-lookup"><span data-stu-id="06238-247">**ILB IP address**: If you use an ILB ASE.</span></span>
- <span data-ttu-id="06238-248">**應用程式指派之以 IP 為主的 SSL 位址**：只有在使用外部 ASE 並已設定以 IP 為主的 SSL 時才能使用。</span><span class="sxs-lookup"><span data-stu-id="06238-248">**App-assigned IP-based SSL addresses**: Only possible with an External ASE and when IP-based SSL is configured.</span></span>

<span data-ttu-id="06238-249">所有這些 IP 位址會輕鬆地顯示在 ASEv2 hello Azure 入口網站中從 hello ASE UI。</span><span class="sxs-lookup"><span data-stu-id="06238-249">All these IP addresses are easily visible in an ASEv2 in hello Azure portal from hello ASE UI.</span></span> <span data-ttu-id="06238-250">如果您有 ILB ase 中時，會列出 hello hello ILB 的 IP。</span><span class="sxs-lookup"><span data-stu-id="06238-250">If you have an ILB ASE, hello IP for hello ILB is listed.</span></span>

![IP 位址][3]

### <a name="app-assigned-ip-addresses"></a><span data-ttu-id="06238-252">應用程式指派的 IP 位址</span><span class="sxs-lookup"><span data-stu-id="06238-252">App-assigned IP addresses</span></span> ###

<span data-ttu-id="06238-253">使用外部 ase 中，您可以指派 IP 位址 tooindividual 應用程式。</span><span class="sxs-lookup"><span data-stu-id="06238-253">With an External ASE, you can assign IP addresses tooindividual apps.</span></span> <span data-ttu-id="06238-254">您無法在 ILB ASE 的情況下那樣做。</span><span class="sxs-lookup"><span data-stu-id="06238-254">You can't do that with an ILB ASE.</span></span> <span data-ttu-id="06238-255">如需有關如何 tooconfigure 應用程式 toohave 它自己的 IP 位址，請參閱[繫結現有自訂 SSL 憑證 tooAzure web 應用程式](../../app-service-web/app-service-web-tutorial-custom-ssl.md)。</span><span class="sxs-lookup"><span data-stu-id="06238-255">For more information on how tooconfigure your app toohave its own IP address, see [Bind an existing custom SSL certificate tooAzure web apps](../../app-service-web/app-service-web-tutorial-custom-ssl.md).</span></span>

<span data-ttu-id="06238-256">當應用程式有它自己的 IP SSL 位址時，hello ASE 會保留兩個連接埠 toomap toothat IP 位址。</span><span class="sxs-lookup"><span data-stu-id="06238-256">When an app has its own IP-based SSL address, hello ASE reserves two ports toomap toothat IP address.</span></span> <span data-ttu-id="06238-257">一個連接埠是 HTTP 流量，hello 其他連接埠是 https。</span><span class="sxs-lookup"><span data-stu-id="06238-257">One port is for HTTP traffic, and hello other port is for HTTPS.</span></span> <span data-ttu-id="06238-258">這些連接埠會列在 hello ASE hello IP 位址區段中的 UI。</span><span class="sxs-lookup"><span data-stu-id="06238-258">Those ports are listed in hello ASE UI in hello IP addresses section.</span></span> <span data-ttu-id="06238-259">流量必須是能夠 tooreach 這些連接埠的 hello VIP 或 hello 應用程式都無法存取。</span><span class="sxs-lookup"><span data-stu-id="06238-259">Traffic must be able tooreach those ports from hello VIP or hello apps are inaccessible.</span></span> <span data-ttu-id="06238-260">這項需求是重要 tooremember，當您設定網路安全性群組 (Nsg)。</span><span class="sxs-lookup"><span data-stu-id="06238-260">This requirement is important tooremember when you configure Network Security Groups (NSGs).</span></span>

## <a name="network-security-groups"></a><span data-ttu-id="06238-261">網路安全性群組</span><span class="sxs-lookup"><span data-stu-id="06238-261">Network Security Groups</span></span> ##

<span data-ttu-id="06238-262">[網路安全性群組][ NSGs]提供 hello 能力 toocontrol VNet 中的網路存取。</span><span class="sxs-lookup"><span data-stu-id="06238-262">[Network Security Groups][NSGs] provide hello ability toocontrol network access within a VNet.</span></span> <span data-ttu-id="06238-263">當您使用 hello 入口網站時，就會隱含拒絕規則在 hello 最低優先順序 toodeny 的所有項目。</span><span class="sxs-lookup"><span data-stu-id="06238-263">When you use hello portal, there's an implicit deny rule at hello lowest priority toodeny everything.</span></span> <span data-ttu-id="06238-264">您所建立的是您的允許規則。</span><span class="sxs-lookup"><span data-stu-id="06238-264">What you build are your allow rules.</span></span>

<span data-ttu-id="06238-265">在 ase 中，您不需要存取 toohello Vm 使用 toohost hello ASE 本身。</span><span class="sxs-lookup"><span data-stu-id="06238-265">In an ASE, you don't have access toohello VMs used toohost hello ASE itself.</span></span> <span data-ttu-id="06238-266">它們處於由 Microsoft 管理的訂用帳戶之中。</span><span class="sxs-lookup"><span data-stu-id="06238-266">They're in a Microsoft-managed subscription.</span></span> <span data-ttu-id="06238-267">如果您想在 hello ASE toorestrict 存取 toohello 應用程式，設定 Nsg hello ASE 子網路上。</span><span class="sxs-lookup"><span data-stu-id="06238-267">If you want toorestrict access toohello apps on hello ASE, set NSGs on hello ASE subnet.</span></span> <span data-ttu-id="06238-268">這樣做，請特別注意 toohello ASE 相依性。</span><span class="sxs-lookup"><span data-stu-id="06238-268">In doing so, pay careful attention toohello ASE dependencies.</span></span> <span data-ttu-id="06238-269">如果您封鎖任何相依性，hello ASE 會停止運作。</span><span class="sxs-lookup"><span data-stu-id="06238-269">If you block any dependencies, hello ASE stops working.</span></span>

<span data-ttu-id="06238-270">透過 hello Azure 入口網站或 PowerShell，可以設定 Nsg。</span><span class="sxs-lookup"><span data-stu-id="06238-270">NSGs can be configured through hello Azure portal or via PowerShell.</span></span> <span data-ttu-id="06238-271">這裡 hello 資訊會顯示 hello Azure 入口網站。</span><span class="sxs-lookup"><span data-stu-id="06238-271">hello information here shows hello Azure portal.</span></span> <span data-ttu-id="06238-272">您建立和管理 Nsg hello 入口網站中，為受到最上層資源**網路**。</span><span class="sxs-lookup"><span data-stu-id="06238-272">You create and manage NSGs in hello portal as a top-level resource under **Networking**.</span></span>

<span data-ttu-id="06238-273">當 hello 輸入和輸出需求會納入考量時，hello Nsg 看起來應該類似這個範例所示的 toohello Nsg。</span><span class="sxs-lookup"><span data-stu-id="06238-273">When hello inbound and outbound requirements are taken into account, hello NSGs should look similar toohello NSGs shown in this example.</span></span> <span data-ttu-id="06238-274">hello VNet 位址範圍是_192.168.250.0/16_，而且 hello 子網路中的 hello ASE _192.168.251.128/25_。</span><span class="sxs-lookup"><span data-stu-id="06238-274">hello VNet address range is _192.168.250.0/16_, and hello subnet that hello ASE is in is _192.168.251.128/25_.</span></span>

<span data-ttu-id="06238-275">hello 前兩個輸入的需求 hello ASE toofunction 會顯示在 hello 在此範例中的 hello 清單最上方。</span><span class="sxs-lookup"><span data-stu-id="06238-275">hello first two inbound requirements for hello ASE toofunction are shown at hello top of hello list in this example.</span></span> <span data-ttu-id="06238-276">它們啟用 ASE 管理，並允許 hello ASE toocommunicate 與其本身。</span><span class="sxs-lookup"><span data-stu-id="06238-276">They enable ASE management and allow hello ASE toocommunicate with itself.</span></span> <span data-ttu-id="06238-277">hello 其他項目可設定的所有租用戶都與可控制網路存取 toohello ASE 裝載應用程式。</span><span class="sxs-lookup"><span data-stu-id="06238-277">hello other entries are all tenant configurable and can govern network access toohello ASE-hosted applications.</span></span> 

![輸入安全性規則][4]

<span data-ttu-id="06238-279">預設規則可讓 hello VNet tootalk toohello ASE 子網路中的 hello Ip。</span><span class="sxs-lookup"><span data-stu-id="06238-279">A default rule enables hello IPs in hello VNet tootalk toohello ASE subnet.</span></span> <span data-ttu-id="06238-280">另一個預設規則可讓 hello 負載平衡器，也稱為 hello 公用 VIP，以 hello ASE toocommunicate。</span><span class="sxs-lookup"><span data-stu-id="06238-280">Another default rule enables hello load balancer, also known as hello public VIP, toocommunicate with hello ASE.</span></span> <span data-ttu-id="06238-281">toosee hello 預設規則，選取**預設規則**下一步 toohello**新增**圖示。</span><span class="sxs-lookup"><span data-stu-id="06238-281">toosee hello default rules, select **Default rules** next toohello **Add** icon.</span></span> <span data-ttu-id="06238-282">如果您將的拒絕所有其他項目規則 hello NSG 規則顯示之後，您可以防止 hello VIP 與 hello ASE 之間的流量。</span><span class="sxs-lookup"><span data-stu-id="06238-282">If you put a deny everything else rule after hello NSG rules shown, you prevent traffic between hello VIP and hello ASE.</span></span> <span data-ttu-id="06238-283">tooprevent 流量從內部 hello VNet，新增您自己的規則 tooallow 輸入。</span><span class="sxs-lookup"><span data-stu-id="06238-283">tooprevent traffic coming from inside hello VNet, add your own rule tooallow inbound.</span></span> <span data-ttu-id="06238-284">來源相等 tooAzureLoadBalancer 用於目的地為**任何**，而且連接埠範圍為 **\*** 。</span><span class="sxs-lookup"><span data-stu-id="06238-284">Use a source equal tooAzureLoadBalancer with a destination of **Any** and a port range of **\***.</span></span> <span data-ttu-id="06238-285">Hello NSG 規則是套用的 toohello ASE 子網路，因為您不需要 toobe 特定 hello 目的地中。</span><span class="sxs-lookup"><span data-stu-id="06238-285">Because hello NSG rule is applied toohello ASE subnet, you don't need toobe specific in hello destination.</span></span>

<span data-ttu-id="06238-286">如果您指派的 IP 位址 tooyour 應用程式，請確定您開啟的連接埠的 hello。</span><span class="sxs-lookup"><span data-stu-id="06238-286">If you assigned an IP address tooyour app, make sure you keep hello ports open.</span></span> <span data-ttu-id="06238-287">toosee hello 連接埠，選取**App Service 環境** > **IP 位址**。</span><span class="sxs-lookup"><span data-stu-id="06238-287">toosee hello ports, select **App Service Environment** > **IP addresses**.</span></span>  

<span data-ttu-id="06238-288">需要所有 hello 遵循規則的輸出所示的 hello 項目，除了 hello 最後一個項目。</span><span class="sxs-lookup"><span data-stu-id="06238-288">All hello items shown in hello following outbound rules are needed, except for hello last item.</span></span> <span data-ttu-id="06238-289">它們可讓網路存取 toohello ASE 相依性已依照本文稍早記下。</span><span class="sxs-lookup"><span data-stu-id="06238-289">They enable network access toohello ASE dependencies that were noted earlier in this article.</span></span> <span data-ttu-id="06238-290">如果封鎖它們任何一項，ASE 會停止運作。</span><span class="sxs-lookup"><span data-stu-id="06238-290">If you block any of them, your ASE stops working.</span></span> <span data-ttu-id="06238-291">hello hello 清單中的最後一個項目可讓您 ASE toocommunicate，與您的 VNet 中的其他資源。</span><span class="sxs-lookup"><span data-stu-id="06238-291">hello last item in hello list enables your ASE toocommunicate with other resources in your VNet.</span></span>

![輸出安全性規則][5]

<span data-ttu-id="06238-293">Nsg 定義後，請將它們指派您 ASE 所在 toohello 子網路。</span><span class="sxs-lookup"><span data-stu-id="06238-293">After your NSGs are defined, assign them toohello subnet that your ASE is on.</span></span> <span data-ttu-id="06238-294">如果您不記得 hello ASE VNet 或子網路，您可以從 hello ASE 管理入口網站中看到它。</span><span class="sxs-lookup"><span data-stu-id="06238-294">If you don’t remember hello ASE VNet or subnet, you can see it from hello ASE management portal.</span></span> <span data-ttu-id="06238-295">tooassign hello NSG tooyour 子網路 toohello 子網路 UI，請選取 hello NSG。</span><span class="sxs-lookup"><span data-stu-id="06238-295">tooassign hello NSG tooyour subnet, go toohello subnet UI and select hello NSG.</span></span>

## <a name="routes"></a><span data-ttu-id="06238-296">路由</span><span class="sxs-lookup"><span data-stu-id="06238-296">Routes</span></span> ##

<span data-ttu-id="06238-297">路由最常在您使用 Azure ExpressRoute 設定 VNet 時造成問題。</span><span class="sxs-lookup"><span data-stu-id="06238-297">Routes become problematic most commonly when you configure your VNet with Azure ExpressRoute.</span></span> <span data-ttu-id="06238-298">VNet 中有三種類型的路由：</span><span class="sxs-lookup"><span data-stu-id="06238-298">There are three types of routes in a VNet:</span></span>

-   <span data-ttu-id="06238-299">系統路由</span><span class="sxs-lookup"><span data-stu-id="06238-299">System routes</span></span>
-   <span data-ttu-id="06238-300">BGP 路由</span><span class="sxs-lookup"><span data-stu-id="06238-300">BGP routes</span></span>
-   <span data-ttu-id="06238-301">使用者定義的路由 (UDR)</span><span class="sxs-lookup"><span data-stu-id="06238-301">User-defined routes (UDRs)</span></span>

<span data-ttu-id="06238-302">BGP 路由會覆寫系統路由。</span><span class="sxs-lookup"><span data-stu-id="06238-302">BGP routes override system routes.</span></span> <span data-ttu-id="06238-303">UDR 會覆寫 BGP 路由。</span><span class="sxs-lookup"><span data-stu-id="06238-303">UDRs override BGP routes.</span></span> <span data-ttu-id="06238-304">如需 Azure 虛擬網路中關於路由的詳細資訊，請參閱[使用者定義路由概觀][UDRs]。</span><span class="sxs-lookup"><span data-stu-id="06238-304">For more information about routes in Azure virtual networks, see [User-defined routes overview][UDRs].</span></span>

<span data-ttu-id="06238-305">hello Azure SQL database hello ASE 使用 toomanage hello 系統有防火牆。</span><span class="sxs-lookup"><span data-stu-id="06238-305">hello Azure SQL database that hello ASE uses toomanage hello system has a firewall.</span></span> <span data-ttu-id="06238-306">它需要從 hello ASE 公用 VIP 通訊 toooriginate。</span><span class="sxs-lookup"><span data-stu-id="06238-306">It requires communication toooriginate from hello ASE public VIP.</span></span> <span data-ttu-id="06238-307">如果他們傳送 hello ExpressRoute 連接並查詢其他 IP 位址，將會拒絕從 hello ASE 連線 toohello SQL 資料庫。</span><span class="sxs-lookup"><span data-stu-id="06238-307">Connections toohello SQL database from hello ASE will be denied if they are sent down hello ExpressRoute connection and out another IP address.</span></span>

<span data-ttu-id="06238-308">如果回覆 tooincoming 管理要求會傳送 hello ExpressRoute，hello 回覆地址是 hello 原始目的地不同。</span><span class="sxs-lookup"><span data-stu-id="06238-308">If replies tooincoming management requests are sent down hello ExpressRoute, hello reply address is different than hello original destination.</span></span> <span data-ttu-id="06238-309">不符的情形會中斷 hello TCP 通訊。</span><span class="sxs-lookup"><span data-stu-id="06238-309">This mismatch breaks hello TCP communication.</span></span>

<span data-ttu-id="06238-310">針對 ASE toowork 時透過 ExpressRoute，您的 VNet 設定 hello 最簡單的事 toodo 是：</span><span class="sxs-lookup"><span data-stu-id="06238-310">For your ASE toowork while your VNet is configured with an ExpressRoute, hello easiest thing toodo is:</span></span>

-   <span data-ttu-id="06238-311">設定 ExpressRoute tooadvertise _0.0.0.0/0_。</span><span class="sxs-lookup"><span data-stu-id="06238-311">Configure ExpressRoute tooadvertise _0.0.0.0/0_.</span></span> <span data-ttu-id="06238-312">根據預設，它會使用強制通道將所有輸出流量傳送至內部部署網路。</span><span class="sxs-lookup"><span data-stu-id="06238-312">By default, it force tunnels all outbound traffic on-premises.</span></span>
-   <span data-ttu-id="06238-313">建立 UDR。</span><span class="sxs-lookup"><span data-stu-id="06238-313">Create a UDR.</span></span> <span data-ttu-id="06238-314">將它套用 toohello 子網路，其中包含的位址前置詞的 hello ASE _0.0.0.0/0_和下個躍點類型_網際網路_。</span><span class="sxs-lookup"><span data-stu-id="06238-314">Apply it toohello subnet that contains hello ASE with an address prefix of _0.0.0.0/0_ and a next hop type of _Internet_.</span></span>

<span data-ttu-id="06238-315">如果您進行這兩個變更時，源自 hello ASE 子網路的網際網路目的地流量運作不下 hello ExpressRoute 和 hello ASE 來強制。</span><span class="sxs-lookup"><span data-stu-id="06238-315">If you make these two changes, internet-destined traffic that originates from hello ASE subnet isn't forced down hello ExpressRoute and hello ASE works.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="06238-316">hello UDR 中定義的路由必須夠特定 tootake 優先順序透過通告 hello ExpressRoute 組態的任何路由。</span><span class="sxs-lookup"><span data-stu-id="06238-316">hello routes defined in a UDR must be specific enough tootake precedence over any routes advertised by hello ExpressRoute configuration.</span></span> <span data-ttu-id="06238-317">hello 前述範例使用 hello 廣泛 0.0.0.0/0 位址範圍。</span><span class="sxs-lookup"><span data-stu-id="06238-317">hello preceding example uses hello broad 0.0.0.0/0 address range.</span></span> <span data-ttu-id="06238-318">因此有可能會不小心由使用更明確位址範圍的路由通告所覆寫。</span><span class="sxs-lookup"><span data-stu-id="06238-318">It can potentially be accidentally overridden by route advertisements that use more specific address ranges.</span></span>
>
> <span data-ttu-id="06238-319">ASEs 不支援跨通告從 hello 公用互連路徑 toohello 私用對等互連路徑的路由的 ExpressRoute 組態。</span><span class="sxs-lookup"><span data-stu-id="06238-319">ASEs aren't supported with ExpressRoute configurations that cross-advertise routes from hello public-peering path toohello private-peering path.</span></span> <span data-ttu-id="06238-320">已設定公用對等互連的 ExpressRoute 設定，會收到來自 Microsoft 的路由通告。</span><span class="sxs-lookup"><span data-stu-id="06238-320">ExpressRoute configurations with public peering configured receive route advertisements from Microsoft.</span></span> <span data-ttu-id="06238-321">hello 公告包含 Microsoft Azure IP 位址範圍的大型集合。</span><span class="sxs-lookup"><span data-stu-id="06238-321">hello advertisements contain a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="06238-322">如果 hello 位址範圍是跨通告 hello 私用對等互連路徑上，從 hello ASE 的子網路的所有輸出網路封包將會強制通道的 tooa 客戶的內部部署網路基礎結構。</span><span class="sxs-lookup"><span data-stu-id="06238-322">If hello address ranges are cross-advertised on hello private-peering path, all outbound network packets from hello ASE's subnet are force tunneled tooa customer's on-premises network infrastructure.</span></span> <span data-ttu-id="06238-323">ASE 目前不支援這個網路流量。</span><span class="sxs-lookup"><span data-stu-id="06238-323">This network flow is currently not supported with ASEs.</span></span> <span data-ttu-id="06238-324">一個方案 toothis 問題就是從 hello 公用互連路徑 toohello 私用對等互連路徑 toostop 跨廣告路由。</span><span class="sxs-lookup"><span data-stu-id="06238-324">One solution toothis problem is toostop cross-advertising routes from hello public-peering path toohello private-peering path.</span></span>

<span data-ttu-id="06238-325">toocreate UDR，請遵循下列步驟：</span><span class="sxs-lookup"><span data-stu-id="06238-325">toocreate a UDR, follow these steps:</span></span>

1. <span data-ttu-id="06238-326">移 toohello Azure 入口網站。</span><span class="sxs-lookup"><span data-stu-id="06238-326">Go toohello Azure portal.</span></span> <span data-ttu-id="06238-327">選取 [網路] > [路由表]。</span><span class="sxs-lookup"><span data-stu-id="06238-327">Select **Networking** > **Route Tables**.</span></span>

2. <span data-ttu-id="06238-328">在 hello 中建立新的路由表相同的區域 VNet。</span><span class="sxs-lookup"><span data-stu-id="06238-328">Create a new route table in hello same region as your VNet.</span></span>

3. <span data-ttu-id="06238-329">從您的路由表 UI 內，選取 [路由] > [新增]。</span><span class="sxs-lookup"><span data-stu-id="06238-329">From within your route table UI, select **Routes** > **Add**.</span></span>

4. <span data-ttu-id="06238-330">設定 hello**下個躍點類型**太**網際網路**和 hello**位址首碼**太**0.0.0.0/0**。</span><span class="sxs-lookup"><span data-stu-id="06238-330">Set hello **Next hop type** too**Internet** and hello **Address prefix** too**0.0.0.0/0**.</span></span> <span data-ttu-id="06238-331">選取 [ **儲存**]。</span><span class="sxs-lookup"><span data-stu-id="06238-331">Select **Save**.</span></span>

    <span data-ttu-id="06238-332">接著您看到類似下列 hello:</span><span class="sxs-lookup"><span data-stu-id="06238-332">You then see something like hello following:</span></span>

    ![功能性路由][6]

5. <span data-ttu-id="06238-334">建立 hello 新的路由表之後，請包含您 ASE toohello 子網路。</span><span class="sxs-lookup"><span data-stu-id="06238-334">After you create hello new route table, go toohello subnet that contains your ASE.</span></span> <span data-ttu-id="06238-335">從 hello 入口網站中的 hello 清單中選取路由表。</span><span class="sxs-lookup"><span data-stu-id="06238-335">Select your route table from hello list in hello portal.</span></span> <span data-ttu-id="06238-336">儲存 hello 變更之後，您應該看見 hello Nsg 以及記下與您的子網路的路由。</span><span class="sxs-lookup"><span data-stu-id="06238-336">After you save hello change, you should then see hello NSGs and routes noted with your subnet.</span></span>

    ![NSG 和路由][7]

### <a name="deploy-into-existing-azure-virtual-networks-that-are-integrated-with-expressroute"></a><span data-ttu-id="06238-338">部署到與 ExpressRoute 整合的現有 Azure 虛擬網路</span><span class="sxs-lookup"><span data-stu-id="06238-338">Deploy into existing Azure virtual networks that are integrated with ExpressRoute</span></span> ###

<span data-ttu-id="06238-339">toodeploy VNet 與 ExpressRoute，整合到您 ASE 預先設定您想要部署的 hello ASE hello 子網路。</span><span class="sxs-lookup"><span data-stu-id="06238-339">toodeploy your ASE into a VNet that's integrated with ExpressRoute, preconfigure hello subnet where you want hello ASE deployed.</span></span> <span data-ttu-id="06238-340">然後使用 資源管理員範本 toodeploy 它。</span><span class="sxs-lookup"><span data-stu-id="06238-340">Then use a Resource Manager template toodeploy it.</span></span> <span data-ttu-id="06238-341">在 VNet 中的 toocreate ase 中已經有設定 ExpressRoute:</span><span class="sxs-lookup"><span data-stu-id="06238-341">toocreate an ASE in a VNet that already has ExpressRoute configured:</span></span>

- <span data-ttu-id="06238-342">建立子網路 toohost hello ASE。</span><span class="sxs-lookup"><span data-stu-id="06238-342">Create a subnet toohost hello ASE.</span></span>

    > [!NOTE]
    > <span data-ttu-id="06238-343">沒有其他可以在 hello 子網路但 hello ASE 中。</span><span class="sxs-lookup"><span data-stu-id="06238-343">Nothing else can be in hello subnet but hello ASE.</span></span> <span data-ttu-id="06238-344">為確定 toochoose 容許未來成長的位址空間。</span><span class="sxs-lookup"><span data-stu-id="06238-344">Be sure toochoose an address space that allows for future growth.</span></span> <span data-ttu-id="06238-345">您之後無法變更此設定。</span><span class="sxs-lookup"><span data-stu-id="06238-345">You can't change this setting later.</span></span> <span data-ttu-id="06238-346">我們建議使用包含 128 個位址的 `/25` 大小。</span><span class="sxs-lookup"><span data-stu-id="06238-346">We recommend a size of `/25` with 128 addresses.</span></span>

- <span data-ttu-id="06238-347">稍早所述，建立 UDRs （例如，路由表），並將其設定 hello 子網路上。</span><span class="sxs-lookup"><span data-stu-id="06238-347">Create UDRs (for example, route tables) as described earlier, and set that on hello subnet.</span></span>
- <span data-ttu-id="06238-348">使用資源管理員範本中所述建立 hello ASE[建立 ase 中使用資源管理員範本][MakeASEfromTemplate]。</span><span class="sxs-lookup"><span data-stu-id="06238-348">Create hello ASE by using a Resource Manager template as described in [Create an ASE by using a Resource Manager template][MakeASEfromTemplate].</span></span>

<!--Image references-->
[1]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow.png
[2]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow2.png
[3]: ./media/network_considerations_with_an_app_service_environment/networkase-ipaddresses.png
[4]: ./media/network_considerations_with_an_app_service_environment/networkase-inboundnsg.png
[5]: ./media/network_considerations_with_an_app_service_environment/networkase-outboundnsg.png
[6]: ./media/network_considerations_with_an_app_service_environment/networkase-udr.png
[7]: ./media/network_considerations_with_an_app_service_environment/networkase-subnet.png

<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[ASEReadme]: ./readme.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/virtual-networks-nsg.md
[ConfigureASEv1]: ../../app-service-web/app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: ../../app-service-web/app-service-app-service-environment-intro.md
[webapps]: ../../app-service-web/app-service-web-overview.md
[mobileapps]: ../../app-service-mobile/app-service-mobile-value-prop.md
[APIapps]: ../../app-service-api/app-service-api-apps-why-best-platform.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: http://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/resource-group-overview.md
[ConfigureSSL]: ../../app-service-web/web-sites-purchase-ssl-web-site.md
[Kudu]: http://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../../app-service-web/web-sites-deploy.md
[ASEWAF]: ../../app-service-web/app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md
[ASEManagement]: ./management-addresses.md
