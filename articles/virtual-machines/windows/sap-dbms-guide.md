---
title: "Azure VM 上的 SAP NetWeaver - DBMS 部署指南 | Microsoft Docs"
description: "Azure 虛擬機器 (VM) 上的 SAP NetWeaver - DBMS 部署指南"
services: virtual-machines-windows,virtual-network,storage
documentationcenter: 
author: MSSedusch
manager: timlt
editor: 
tags: azure-resource-manager
keywords: 
ms.assetid: e0e05b5e-47aa-4c1e-bf83-0d62ee8f614e
ms.service: virtual-machines-windows
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure-services
ms.date: 11/08/2016
ms.author: sedusch
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: cc7c85382d8f8183ef3eb3cc7496b012808148e5
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="sap-netweaver-on-azure-windows-virtual-machines-vms--dbms-deployment-guide"></a><span data-ttu-id="7458b-103">Azure Windows 虛擬機器 (VM) 上的 SAP NetWeaver - DBMS 部署指南</span><span class="sxs-lookup"><span data-stu-id="7458b-103">SAP NetWeaver on Azure Windows Virtual Machines (VMs) – DBMS Deployment Guide</span></span>
<span data-ttu-id="7458b-104">[767598]:https://launchpad.support.sap.com/#/notes/767598</span><span class="sxs-lookup"><span data-stu-id="7458b-104">[767598]:https://launchpad.support.sap.com/#/notes/767598</span></span>
<span data-ttu-id="7458b-105">[773830]:https://launchpad.support.sap.com/#/notes/773830</span><span class="sxs-lookup"><span data-stu-id="7458b-105">[773830]:https://launchpad.support.sap.com/#/notes/773830</span></span>
<span data-ttu-id="7458b-106">[826037]:https://launchpad.support.sap.com/#/notes/826037</span><span class="sxs-lookup"><span data-stu-id="7458b-106">[826037]:https://launchpad.support.sap.com/#/notes/826037</span></span>
<span data-ttu-id="7458b-107">[965908]:https://launchpad.support.sap.com/#/notes/965908</span><span class="sxs-lookup"><span data-stu-id="7458b-107">[965908]:https://launchpad.support.sap.com/#/notes/965908</span></span>
[1031096]:https://launchpad.support.sap.com/#/notes/1031096
<span data-ttu-id="7458b-108">[1139904]:https://launchpad.support.sap.com/#/notes/1139904</span><span class="sxs-lookup"><span data-stu-id="7458b-108">[1139904]:https://launchpad.support.sap.com/#/notes/1139904</span></span>
<span data-ttu-id="7458b-109">[1173395]:https://launchpad.support.sap.com/#/notes/1173395</span><span class="sxs-lookup"><span data-stu-id="7458b-109">[1173395]:https://launchpad.support.sap.com/#/notes/1173395</span></span>
<span data-ttu-id="7458b-110">[1245200]:https://launchpad.support.sap.com/#/notes/1245200</span><span class="sxs-lookup"><span data-stu-id="7458b-110">[1245200]:https://launchpad.support.sap.com/#/notes/1245200</span></span>
<span data-ttu-id="7458b-111">[1409604]:https://launchpad.support.sap.com/#/notes/1409604</span><span class="sxs-lookup"><span data-stu-id="7458b-111">[1409604]:https://launchpad.support.sap.com/#/notes/1409604</span></span>
<span data-ttu-id="7458b-112">[1558958]:https://launchpad.support.sap.com/#/notes/1558958</span><span class="sxs-lookup"><span data-stu-id="7458b-112">[1558958]:https://launchpad.support.sap.com/#/notes/1558958</span></span>
<span data-ttu-id="7458b-113">[1585981]:https://launchpad.support.sap.com/#/notes/1585981</span><span class="sxs-lookup"><span data-stu-id="7458b-113">[1585981]:https://launchpad.support.sap.com/#/notes/1585981</span></span>
<span data-ttu-id="7458b-114">[1588316]:https://launchpad.support.sap.com/#/notes/1588316</span><span class="sxs-lookup"><span data-stu-id="7458b-114">[1588316]:https://launchpad.support.sap.com/#/notes/1588316</span></span>
<span data-ttu-id="7458b-115">[1590719]:https://launchpad.support.sap.com/#/notes/1590719</span><span class="sxs-lookup"><span data-stu-id="7458b-115">[1590719]:https://launchpad.support.sap.com/#/notes/1590719</span></span>
[1597355]:https://launchpad.support.sap.com/#/notes/1597355
<span data-ttu-id="7458b-116">[1605680]:https://launchpad.support.sap.com/#/notes/1605680</span><span class="sxs-lookup"><span data-stu-id="7458b-116">[1605680]:https://launchpad.support.sap.com/#/notes/1605680</span></span>
<span data-ttu-id="7458b-117">[1619720]:https://launchpad.support.sap.com/#/notes/1619720</span><span class="sxs-lookup"><span data-stu-id="7458b-117">[1619720]:https://launchpad.support.sap.com/#/notes/1619720</span></span>
<span data-ttu-id="7458b-118">[1619726]:https://launchpad.support.sap.com/#/notes/1619726</span><span class="sxs-lookup"><span data-stu-id="7458b-118">[1619726]:https://launchpad.support.sap.com/#/notes/1619726</span></span>
<span data-ttu-id="7458b-119">[1619967]:https://launchpad.support.sap.com/#/notes/1619967</span><span class="sxs-lookup"><span data-stu-id="7458b-119">[1619967]:https://launchpad.support.sap.com/#/notes/1619967</span></span>
<span data-ttu-id="7458b-120">[1750510]:https://launchpad.support.sap.com/#/notes/1750510</span><span class="sxs-lookup"><span data-stu-id="7458b-120">[1750510]:https://launchpad.support.sap.com/#/notes/1750510</span></span>
<span data-ttu-id="7458b-121">[1752266]:https://launchpad.support.sap.com/#/notes/1752266</span><span class="sxs-lookup"><span data-stu-id="7458b-121">[1752266]:https://launchpad.support.sap.com/#/notes/1752266</span></span>
<span data-ttu-id="7458b-122">[1757924]:https://launchpad.support.sap.com/#/notes/1757924</span><span class="sxs-lookup"><span data-stu-id="7458b-122">[1757924]:https://launchpad.support.sap.com/#/notes/1757924</span></span>
<span data-ttu-id="7458b-123">[1757928]:https://launchpad.support.sap.com/#/notes/1757928</span><span class="sxs-lookup"><span data-stu-id="7458b-123">[1757928]:https://launchpad.support.sap.com/#/notes/1757928</span></span>
<span data-ttu-id="7458b-124">[1758182]:https://launchpad.support.sap.com/#/notes/1758182</span><span class="sxs-lookup"><span data-stu-id="7458b-124">[1758182]:https://launchpad.support.sap.com/#/notes/1758182</span></span>
<span data-ttu-id="7458b-125">[1758496]:https://launchpad.support.sap.com/#/notes/1758496</span><span class="sxs-lookup"><span data-stu-id="7458b-125">[1758496]:https://launchpad.support.sap.com/#/notes/1758496</span></span>
<span data-ttu-id="7458b-126">[1772688]:https://launchpad.support.sap.com/#/notes/1772688</span><span class="sxs-lookup"><span data-stu-id="7458b-126">[1772688]:https://launchpad.support.sap.com/#/notes/1772688</span></span>
<span data-ttu-id="7458b-127">[1814258]:https://launchpad.support.sap.com/#/notes/1814258</span><span class="sxs-lookup"><span data-stu-id="7458b-127">[1814258]:https://launchpad.support.sap.com/#/notes/1814258</span></span>
<span data-ttu-id="7458b-128">[1882376]:https://launchpad.support.sap.com/#/notes/1882376</span><span class="sxs-lookup"><span data-stu-id="7458b-128">[1882376]:https://launchpad.support.sap.com/#/notes/1882376</span></span>
[1909114]:https://launchpad.support.sap.com/#/notes/1909114
<span data-ttu-id="7458b-129">[1922555]:https://launchpad.support.sap.com/#/notes/1922555</span><span class="sxs-lookup"><span data-stu-id="7458b-129">[1922555]:https://launchpad.support.sap.com/#/notes/1922555</span></span>
<span data-ttu-id="7458b-130">[1928533]:https://launchpad.support.sap.com/#/notes/1928533</span><span class="sxs-lookup"><span data-stu-id="7458b-130">[1928533]:https://launchpad.support.sap.com/#/notes/1928533</span></span>
<span data-ttu-id="7458b-131">[1941500]:https://launchpad.support.sap.com/#/notes/1941500</span><span class="sxs-lookup"><span data-stu-id="7458b-131">[1941500]:https://launchpad.support.sap.com/#/notes/1941500</span></span>
<span data-ttu-id="7458b-132">[1956005]:https://launchpad.support.sap.com/#/notes/1956005</span><span class="sxs-lookup"><span data-stu-id="7458b-132">[1956005]:https://launchpad.support.sap.com/#/notes/1956005</span></span>
<span data-ttu-id="7458b-133">[1973241]:https://launchpad.support.sap.com/#/notes/1973241</span><span class="sxs-lookup"><span data-stu-id="7458b-133">[1973241]:https://launchpad.support.sap.com/#/notes/1973241</span></span>
<span data-ttu-id="7458b-134">[1984787]:https://launchpad.support.sap.com/#/notes/1984787</span><span class="sxs-lookup"><span data-stu-id="7458b-134">[1984787]:https://launchpad.support.sap.com/#/notes/1984787</span></span>
<span data-ttu-id="7458b-135">[1999351]:https://launchpad.support.sap.com/#/notes/1999351</span><span class="sxs-lookup"><span data-stu-id="7458b-135">[1999351]:https://launchpad.support.sap.com/#/notes/1999351</span></span>
<span data-ttu-id="7458b-136">[2002167]:https://launchpad.support.sap.com/#/notes/2002167</span><span class="sxs-lookup"><span data-stu-id="7458b-136">[2002167]:https://launchpad.support.sap.com/#/notes/2002167</span></span>
<span data-ttu-id="7458b-137">[2015553]:https://launchpad.support.sap.com/#/notes/2015553</span><span class="sxs-lookup"><span data-stu-id="7458b-137">[2015553]:https://launchpad.support.sap.com/#/notes/2015553</span></span>
<span data-ttu-id="7458b-138">[2039619]:https://launchpad.support.sap.com/#/notes/2039619</span><span class="sxs-lookup"><span data-stu-id="7458b-138">[2039619]:https://launchpad.support.sap.com/#/notes/2039619</span></span>
<span data-ttu-id="7458b-139">[2121797]:https://launchpad.support.sap.com/#/notes/2121797</span><span class="sxs-lookup"><span data-stu-id="7458b-139">[2121797]:https://launchpad.support.sap.com/#/notes/2121797</span></span>
<span data-ttu-id="7458b-140">[2134316]:https://launchpad.support.sap.com/#/notes/2134316</span><span class="sxs-lookup"><span data-stu-id="7458b-140">[2134316]:https://launchpad.support.sap.com/#/notes/2134316</span></span>
<span data-ttu-id="7458b-141">[2178632]:https://launchpad.support.sap.com/#/notes/2178632</span><span class="sxs-lookup"><span data-stu-id="7458b-141">[2178632]:https://launchpad.support.sap.com/#/notes/2178632</span></span>
<span data-ttu-id="7458b-142">[2191498]:https://launchpad.support.sap.com/#/notes/2191498</span><span class="sxs-lookup"><span data-stu-id="7458b-142">[2191498]:https://launchpad.support.sap.com/#/notes/2191498</span></span>
<span data-ttu-id="7458b-143">[2233094]:https://launchpad.support.sap.com/#/notes/2233094</span><span class="sxs-lookup"><span data-stu-id="7458b-143">[2233094]:https://launchpad.support.sap.com/#/notes/2233094</span></span>
<span data-ttu-id="7458b-144">[2243692]:https://launchpad.support.sap.com/#/notes/2243692</span><span class="sxs-lookup"><span data-stu-id="7458b-144">[2243692]:https://launchpad.support.sap.com/#/notes/2243692</span></span>

[azure-cli]:../../cli-install-nodejs.md
[azure-portal]:https://portal.azure.com
[azure-ps]:/powershell/azureps-cmdlets-docs
[azure-quickstart-templates-github]:https://github.com/Azure/azure-quickstart-templates
[azure-script-ps]:https://go.microsoft.com/fwlink/p/?LinkID=395017
[azure-subscription-service-limits]:../../azure-subscription-service-limits.md
[azure-subscription-service-limits-subscription]:../../azure-subscription-service-limits.md#subscription-limits

[dbms-guide]:sap-dbms-guide.md 
[dbms-guide-2.1]:#c7abf1f0-c927-4a7c-9c1d-c7b5b3b7212f 
[dbms-guide-2.2]:#c8e566f9-21b7-4457-9f7f-126036971a91 
[dbms-guide-2.3]:#10b041ef-c177-498a-93ed-44b3441ab152 
[dbms-guide-2]:#65fa79d6-a85f-47ee-890b-22e794f51a64 
[dbms-guide-3]:#871dfc27-e509-4222-9370-ab1de77021c3 
[dbms-guide-5.5.1]:#0fef0e79-d3fe-4ae2-85af-73666a6f7268 
[dbms-guide-5.5.2]:#f9071eff-9d72-4f47-9da4-1852d782087b 
[dbms-guide-5.6]:#1b353e38-21b3-4310-aeb6-a77e7c8e81c8 
[dbms-guide-5.8]:#9053f720-6f3b-4483-904d-15dc54141e30 
[dbms-guide-5]:#3264829e-075e-4d25-966e-a49dad878737 
[dbms-guide-8.4.1]:#b48cfe3b-48e9-4f5b-a783-1d29155bd573 
[dbms-guide-8.4.2]:#23c78d3b-ca5a-4e72-8a24-645d141a3f5d 
[dbms-guide-8.4.3]:#77cd2fbb-307e-4cbf-a65f-745553f72d2c 
[dbms-guide-8.4.4]:#f77c1436-9ad8-44fb-a331-8671342de818 
[dbms-guide-900-sap-cache-server-on-premises]:#642f746c-e4d4-489d-bf63-73e80177a0a8

[dbms-guide-figure-100]:./media/virtual-machines-shared-sap-dbms-guide/100_storage_account_types.png
[dbms-guide-figure-200]:./media/virtual-machines-shared-sap-dbms-guide/200-ha-set-for-dbms-ha.png
[dbms-guide-figure-300]:./media/virtual-machines-shared-sap-dbms-guide/300-reference-config-iaas.png
[dbms-guide-figure-400]:./media/virtual-machines-shared-sap-dbms-guide/400-sql-2012-backup-to-blob-storage.png
[dbms-guide-figure-500]:./media/virtual-machines-shared-sap-dbms-guide/500-sql-2012-backup-to-blob-storage-different-containers.png
[dbms-guide-figure-600]:./media/virtual-machines-shared-sap-dbms-guide/600-iaas-maxdb.png
[dbms-guide-figure-700]:./media/virtual-machines-shared-sap-dbms-guide/700-livecach-prod.png
[dbms-guide-figure-800]:./media/virtual-machines-shared-sap-dbms-guide/800-azure-vm-sap-content-server.png
[dbms-guide-figure-900]:./media/virtual-machines-shared-sap-dbms-guide/900-sap-cache-server-on-premises.png

[deployment-guide]:sap-deployment-guide.md 
[deployment-guide-2.2]:sap-deployment-guide.md#42ee2bdb-1efc-4ec7-ab31-fe4c22769b94 
[deployment-guide-3.1.2]:sap-deployment-guide.md#3688666f-281f-425b-a312-a77e7db2dfab 
[deployment-guide-3.2]:sap-deployment-guide.md#db477013-9060-4602-9ad4-b0316f8bb281 
[deployment-guide-3.3]:sap-deployment-guide.md#54a1fc6d-24fd-4feb-9c57-ac588a55dff2 
[deployment-guide-3.4]:sap-deployment-guide.md#a9a60133-a763-4de8-8986-ac0fa33aa8c1
[deployment-guide-3]:sap-deployment-guide.md#b3253ee3-d63b-4d74-a49b-185e76c4088e 
[deployment-guide-4.1]:sap-deployment-guide.md#604bcec2-8b6e-48d2-a944-61b0f5dee2f7 
[deployment-guide-4.2]:sap-deployment-guide.md#7ccf6c3e-97ae-4a7a-9c75-e82c37beb18e
[deployment-guide-4.3]:sap-deployment-guide.md#31d9ecd6-b136-4c73-b61e-da4a29bbc9cc 
[deployment-guide-4.4.2]:sap-deployment-guide.md#6889ff12-eaaf-4f3c-97e1-7c9edc7f7542 
[deployment-guide-4.4]:sap-deployment-guide.md#c7cbb0dc-52a4-49db-8e03-83e7edc2927d 
[deployment-guide-4.5.1]:sap-deployment-guide.md#987cf279-d713-4b4c-8143-6b11589bb9d4 
[deployment-guide-4.5.2]:sap-deployment-guide.md#408f3779-f422-4413-82f8-c57a23b4fc2f 
[deployment-guide-4.5]:sap-deployment-guide.md#d98edcd3-f2a1-49f7-b26a-07448ceb60ca 
[deployment-guide-5.1]:sap-deployment-guide.md#bb61ce92-8c5c-461f-8c53-39f5e5ed91f2 
[deployment-guide-5.2]:sap-deployment-guide.md#e2d592ff-b4ea-4a53-a91a-e5521edb6cd1 
[deployment-guide-5.3]:sap-deployment-guide.md#fe25a7da-4e4e-4388-8907-8abc2d33cfd8 

[deployment-guide-configure-monitoring-scenario-1]:sap-deployment-guide.md#ec323ac3-1de9-4c3a-b770-4ff701def65b 
[deployment-guide-configure-proxy]:sap-deployment-guide.md#baccae00-6f79-4307-ade4-40292ce4e02d 
[deployment-guide-figure-100]:./media/virtual-machines-shared-sap-deployment-guide/100-deploy-vm-image.png
[deployment-guide-figure-1000]:./media/virtual-machines-shared-sap-deployment-guide/1000-service-properties.png
[deployment-guide-figure-11]:sap-deployment-guide.md#figure-11
[deployment-guide-figure-1100]:./media/virtual-machines-shared-sap-deployment-guide/1100-azperflib.png
[deployment-guide-figure-1200]:./media/virtual-machines-shared-sap-deployment-guide/1200-cmd-test-login.png
[deployment-guide-figure-1300]:./media/virtual-machines-shared-sap-deployment-guide/1300-cmd-test-executed.png
[deployment-guide-figure-14]:sap-deployment-guide.md#figure-14
[deployment-guide-figure-1400]:./media/virtual-machines-shared-sap-deployment-guide/1400-azperflib-error-servicenotstarted.png
[deployment-guide-figure-300]:./media/virtual-machines-shared-sap-deployment-guide/300-deploy-private-image.png
[deployment-guide-figure-400]:./media/virtual-machines-shared-sap-deployment-guide/400-deploy-using-disk.png
[deployment-guide-figure-5]:sap-deployment-guide.md#figure-5
[deployment-guide-figure-50]:./media/virtual-machines-shared-sap-deployment-guide/50-forced-tunneling-suse.png
[deployment-guide-figure-500]:./media/virtual-machines-shared-sap-deployment-guide/500-install-powershell.png
[deployment-guide-figure-6]:sap-deployment-guide.md#figure-6
[deployment-guide-figure-600]:./media/virtual-machines-shared-sap-deployment-guide/600-powershell-version.png
[deployment-guide-figure-7]:sap-deployment-guide.md#figure-7
[deployment-guide-figure-700]:./media/virtual-machines-shared-sap-deployment-guide/700-install-powershell-installed.png
[deployment-guide-figure-760]:./media/virtual-machines-shared-sap-deployment-guide/760-azure-cli-version.png
[deployment-guide-figure-900]:./media/virtual-machines-shared-sap-deployment-guide/900-cmd-update-executed.png
[deployment-guide-figure-azure-cli-installed]:sap-deployment-guide.md#402488e5-f9bb-4b29-8063-1c5f52a892d0
[deployment-guide-figure-azure-cli-version]:sap-deployment-guide.md#0ad010e6-f9b5-4c21-9c09-bb2e5efb3fda
[deployment-guide-install-vm-agent-windows]:sap-deployment-guide.md#b2db5c9a-a076-42c6-9835-16945868e866
[deployment-guide-troubleshooting-chapter]:sap-deployment-guide.md#564adb4f-5c95-4041-9616-6635e83a810b 

[deploy-template-cli]:../../resource-group-template-deploy-cli.md
[deploy-template-portal]:../../resource-group-template-deploy-portal.md
[deploy-template-powershell]:../../resource-group-template-deploy.md

[dr-guide-classic]:http://go.microsoft.com/fwlink/?LinkID=521971

[getting-started]:sap-get-started.md
[getting-started-dbms]:sap-get-started.md#1343ffe1-8021-4ce6-a08d-3a1553a4db82
[getting-started-deployment]:sap-get-started.md#6aadadd2-76b5-46d8-8713-e8d63630e955
[getting-started-planning]:sap-get-started.md#3da0389e-708b-4e82-b2a2-e92f132df89c

[getting-started-windows-classic]:../virtual-machines-windows-classic-sap-get-started.md
[getting-started-windows-classic-dbms]:../virtual-machines-windows-classic-sap-get-started.md#c5b77a14-f6b4-44e9-acab-4d28ff72a930
[getting-started-windows-classic-deployment]:../virtual-machines-windows-classic-sap-get-started.md#f84ea6ce-bbb4-41f7-9965-34d31b0098ea
[getting-started-windows-classic-dr]:../virtual-machines-windows-classic-sap-get-started.md#cff10b4a-01a5-4dc3-94b6-afb8e55757d3
[getting-started-windows-classic-ha-sios]:../virtual-machines-windows-classic-sap-get-started.md#4bb7512c-0fa0-4227-9853-4004281b1037
[getting-started-windows-classic-planning]:../virtual-machines-windows-classic-sap-get-started.md#f2a5e9d8-49e4-419e-9900-af783173481c

[ha-guide-classic]:http://go.microsoft.com/fwlink/?LinkId=613056

[ha-guide]:sap-high-availability-guide.md

[install-extension-cli]:virtual-machines-linux-enable-aem.md

[Logo_Linux]:./media/virtual-machines-shared-sap-shared/Linux.png
[Logo_Windows]:./media/virtual-machines-shared-sap-shared/Windows.png

[msdn-set-azurermvmaemextension]:https://msdn.microsoft.com/library/azure/mt670598.aspx

[planning-guide]:sap-planning-guide.md  
[planning-guide-1.2]:sap-planning-guide.md#e55d1e22-c2c8-460b-9897-64622a34fdff 
[planning-guide-11]:sap-planning-guide.md#7cf991a1-badd-40a9-944e-7baae842a058 
[planning-guide-11.4.1]:sap-planning-guide.md#5d9d36f9-9058-435d-8367-5ad05f00de77 
[planning-guide-11.5]:sap-planning-guide.md#4e165b58-74ca-474f-a7f4-5e695a93204f 
[planning-guide-2.1]:sap-planning-guide.md#1625df66-4cc6-4d60-9202-de8a0b77f803 
[planning-guide-2.2]:sap-planning-guide.md#f5b3b18c-302c-4bd8-9ab2-c388f1ab3d10
[planning-guide-3.1]:sap-planning-guide.md#be80d1b9-a463-4845-bd35-f4cebdb5424a 
[planning-guide-3.2.1]:sap-planning-guide.md#df49dc09-141b-4f34-a4a2-990913b30358 
[planning-guide-3.2.2]:sap-planning-guide.md#fc1ac8b2-e54a-487c-8581-d3cc6625e560 
[planning-guide-3.2.3]:sap-planning-guide.md#18810088-f9be-4c97-958a-27996255c665 
[planning-guide-3.2]:sap-planning-guide.md#8d8ad4b8-6093-4b91-ac36-ea56d80dbf77 
[planning-guide-3.3.2]:sap-planning-guide.md#ff5ad0f9-f7f4-4022-9102-af07aef3bc92 
[planning-guide-5.1.1]:sap-planning-guide.md#4d175f1b-7353-4137-9d2f-817683c26e53 
[planning-guide-5.1.2]:sap-planning-guide.md#e18f7839-c0e2-4385-b1e6-4538453a285c 
[planning-guide-5.2.1]:sap-planning-guide.md#1b287330-944b-495d-9ea7-94b83aff73ef 
[planning-guide-5.2.2]:sap-planning-guide.md#57f32b1c-0cba-4e57-ab6e-c39fe22b6ec3 
[planning-guide-5.2]:sap-planning-guide.md#6ffb9f41-a292-40bf-9e70-8204448559e7 
[planning-guide-5.3.1]:sap-planning-guide.md#6e835de8-40b1-4b71-9f18-d45b20959b79 
[planning-guide-5.3.2]:sap-planning-guide.md#a43e40e6-1acc-4633-9816-8f095d5a7b6a 
[planning-guide-5.4.2]:sap-planning-guide.md#9789b076-2011-4afa-b2fe-b07a8aba58a1 
[planning-guide-5.5.1]:sap-planning-guide.md#4efec401-91e0-40c0-8e64-f2dceadff646 
[planning-guide-5.5.3]:sap-planning-guide.md#17e0d543-7e8c-4160-a7da-dd7117a1ad9d 
[planning-guide-7.1]:sap-planning-guide.md#3e9c3690-da67-421a-bc3f-12c520d99a30 
[planning-guide-7]:sap-planning-guide.md#96a77628-a05e-475d-9df3-fb82217e8f14 
[planning-guide-9.1]:sap-planning-guide.md#6f0a47f3-a289-4090-a053-2521618a28c3 
[planning-guide-azure-premium-storage]:sap-planning-guide.md#ff5ad0f9-f7f4-4022-9102-af07aef3bc92 

[planning-guide-figure-100]:./media/virtual-machines-shared-sap-planning-guide/100-single-vm-in-azure.png
[planning-guide-figure-1300]:./media/virtual-machines-shared-sap-planning-guide/1300-ref-config-iaas-for-sap.png
[planning-guide-figure-1400]:./media/virtual-machines-shared-sap-planning-guide/1400-attach-detach-disks.png
[planning-guide-figure-1600]:./media/virtual-machines-shared-sap-planning-guide/1600-firewall-port-rule.png
[planning-guide-figure-1700]:./media/virtual-machines-shared-sap-planning-guide/1700-single-vm-demo.png
[planning-guide-figure-1900]:./media/virtual-machines-shared-sap-planning-guide/1900-vm-set-vnet.png
[planning-guide-figure-200]:./media/virtual-machines-shared-sap-planning-guide/200-multiple-vms-in-azure.png
[planning-guide-figure-2100]:./media/virtual-machines-shared-sap-planning-guide/2100-s2s.png
[planning-guide-figure-2200]:./media/virtual-machines-shared-sap-planning-guide/2200-network-printing.png
[planning-guide-figure-2300]:./media/virtual-machines-shared-sap-planning-guide/2300-sapgui-stms.png
[planning-guide-figure-2400]:./media/virtual-machines-shared-sap-planning-guide/2400-vm-extension-overview.png
[planning-guide-figure-2500]:./media/virtual-machines-shared-sap-planning-guide/2500-vm-extension-details.png
[planning-guide-figure-2600]:./media/virtual-machines-shared-sap-planning-guide/2600-sap-router-connection.png
[planning-guide-figure-2700]:./media/virtual-machines-shared-sap-planning-guide/2700-exposed-sap-portal.png
[planning-guide-figure-2800]:./media/virtual-machines-shared-sap-planning-guide/2800-endpoint-config.png
[planning-guide-figure-2900]:./media/virtual-machines-shared-sap-planning-guide/2900-azure-ha-sap-ha.png
[planning-guide-figure-300]:./media/virtual-machines-shared-sap-planning-guide/300-vpn-s2s.png
[planning-guide-figure-3000]:./media/virtual-machines-shared-sap-planning-guide/3000-sap-ha-on-azure.png
[planning-guide-figure-3200]:./media/virtual-machines-shared-sap-planning-guide/3200-sap-ha-with-sql.png
[planning-guide-figure-400]:./media/virtual-machines-shared-sap-planning-guide/400-vm-services.png
[planning-guide-figure-600]:./media/virtual-machines-shared-sap-planning-guide/600-s2s-details.png
[planning-guide-figure-700]:./media/virtual-machines-shared-sap-planning-guide/700-decision-tree-deploy-to-azure.png
[planning-guide-figure-800]:./media/virtual-machines-shared-sap-planning-guide/800-portal-vm-overview.png
[planning-guide-microsoft-azure-networking]:sap-planning-guide.md#61678387-8868-435d-9f8c-450b2424f5bd 
[planning-guide-storage-microsoft-azure-storage-and-data-disks]:sap-planning-guide.md#a72afa26-4bf4-4a25-8cf7-855d6032157f 

[powershell-install-configure]:/powershell/azureps-cmdlets-docs
[resource-group-authoring-templates]:../../resource-group-authoring-templates.md
[resource-group-overview]:../../azure-resource-manager/resource-group-overview.md
[resource-groups-networking]:../../virtual-network/resource-groups-networking.md
[sap-pam]:https://support.sap.com/pam 
[sap-templates-2-tier-marketplace-image]:https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2Fsap-2-tier-marketplace-image%2Fazuredeploy.json
[sap-templates-2-tier-os-disk]:https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2Fsap-2-tier-user-disk%2Fazuredeploy.json
[sap-templates-2-tier-user-image]:https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2Fsap-2-tier-user-image%2Fazuredeploy.json
[sap-templates-3-tier-marketplace-image]:https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2Fsap-3-tier-marketplace-image%2Fazuredeploy.json
[sap-templates-3-tier-user-image]:https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2Fsap-3-tier-user-image%2Fazuredeploy.json
[storage-azure-cli]:../../storage/storage-azure-cli.md
[storage-azure-cli-copy-blobs]:../../storage/storage-azure-cli.md#copy-blobs
[storage-introduction]:../../storage/storage-introduction.md
[storage-powershell-guide-full-copy-vhd]:../../storage/storage-powershell-guide-full.md#how-to-copy-blobs-from-one-storage-container-to-another
[storage-premium-storage-preview-portal]:../../storage/storage-premium-storage.md
[storage-redundancy]:../../storage/storage-redundancy.md
[storage-scalability-targets]:../../storage/storage-scalability-targets.md
[storage-use-azcopy]:../../storage/storage-use-azcopy.md
[template-201-vm-from-specialized-vhd]:https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-from-specialized-vhd
[templates-101-simple-windows-vm]:https://github.com/Azure/azure-quickstart-templates/tree/master/101-simple-windows-vm
[templates-101-vm-from-user-image]:https://github.com/Azure/azure-quickstart-templates/tree/master/101-vm-from-user-image
[virtual-machines-linux-attach-disk-portal]:../linux/attach-disk-portal.md
[virtual-machines-azure-resource-manager-architecture]:../../resource-manager-deployment-model.md
[virtual-machines-azurerm-versus-azuresm]:../../resource-manager-deployment-model.md
[virtual-machines-windows-classic-configure-oracle-data-guard]:../virtual-machines-windows-classic-configure-oracle-data-guard.md
[virtual-machines-linux-cli-deploy-templates]:../linux/cli-deploy-templates.md (Deploy and manage virtual machines by using Azure Resource Manager templates and the Azure CLI)
[virtual-machines-deploy-rmtemplates-powershell]:../virtual-machines-windows-ps-manage.md (Manage virtual machines using Azure Resource Manager and PowerShell)
[virtual-machines-linux-agent-user-guide]:../linux/agent-user-guide.md
[virtual-machines-linux-agent-user-guide-command-line-options]:../linux/agent-user-guide.md#command-line-options
[virtual-machines-linux-capture-image]:../linux/capture-image.md
[virtual-machines-linux-capture-image-resource-manager]:../linux/capture-image.md
[virtual-machines-linux-capture-image-resource-manager-capture]:../linux/capture-image.md#step-2-capture-the-vm
[virtual-machines-linux-configure-lvm]:../linux/configure-lvm.md
[virtual-machines-linux-configure-raid]:../linux/configure-raid.md
[virtual-machines-linux-classic-create-upload-vhd-step-1]:../virtual-machines-linux-classic-create-upload-vhd.md#step-1-prepare-the-image-to-be-uploaded
[virtual-machines-linux-create-upload-vhd-suse]:../linux/suse-create-upload-vhd.md
[virtual-machines-linux-redhat-create-upload-vhd]:../linux/redhat-create-upload-vhd.md
[virtual-machines-linux-how-to-attach-disk]:../linux/add-disk.md
[virtual-machines-linux-how-to-attach-disk-how-to-initialize-a-new-data-disk-in-linux]:../linux/add-disk.md#connect-to-the-linux-vm-to-mount-the-new-disk
[virtual-machines-linux-tutorial]:../linux/quick-create-cli.md
[virtual-machines-linux-update-agent]:../linux/update-agent.md
[virtual-machines-manage-availability]:../virtual-machines-windows-manage-availability.md
[virtual-machines-ps-create-preconfigure-windows-resource-manager-vms]:../virtual-machines-windows-ps-create.md
[virtual-machines-sizes]:sizes.md
[virtual-machines-windows-classic-ps-sql-alwayson-availability-groups]:classic/ps-sql-alwayson-availability-groups.md
[virtual-machines-windows-classic-ps-sql-int-listener]:classic/ps-sql-int-listener.md
[virtual-machines-sql-server-high-availability-and-disaster-recovery-solutions]:./sql/virtual-machines-windows-sql-high-availability-dr.md
[virtual-machines-sql-server-infrastructure-services]:./sql/virtual-machines-windows-sql-server-iaas-overview.md
[virtual-machines-sql-server-performance-best-practices]:./sql/virtual-machines-windows-sql-performance.md
[virtual-machines-upload-image-windows-resource-manager]:upload-image.md
[virtual-machines-windows-tutorial]:../virtual-machines-windows-hero-tutorial.md
[virtual-machines-workload-template-sql-alwayson]:https://azure.microsoft.com/documentation/templates/sql-server-2014-alwayson-dsc/
[virtual-network-deploy-multinic-arm-cli]:../../virtual-network/virtual-network-deploy-multinic-arm-cli.md
[virtual-network-deploy-multinic-arm-ps]:../../virtual-network/virtual-network-deploy-multinic-arm-ps.md
[virtual-network-deploy-multinic-arm-template]:../../virtual-network/virtual-network-deploy-multinic-arm-template.md
[virtual-networks-configure-vnet-to-vnet-connection]:../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md
[virtual-networks-create-vnet-arm-pportal]:../../virtual-network/virtual-networks-create-vnet-arm-pportal.md
[virtual-networks-manage-dns-in-vnet]:../../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md
[virtual-networks-multiple-nics]:../../virtual-network/virtual-networks-multiple-nics.md
[virtual-networks-nsg]:../../virtual-network/virtual-networks-nsg.md
[virtual-networks-reserved-private-ip]:../../virtual-network/virtual-networks-static-private-ip-arm-ps.md
[virtual-networks-static-private-ip-arm-pportal]:../../virtual-network/virtual-networks-static-private-ip-arm-pportal.md
[virtual-networks-udr-overview]:../../virtual-network/virtual-networks-udr-overview.md
[vpn-gateway-about-vpn-devices]:../../vpn-gateway/vpn-gateway-about-vpn-devices.md
[vpn-gateway-create-site-to-site-rm-powershell]:../../vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md
[vpn-gateway-cross-premises-options]:../../vpn-gateway/vpn-gateway-plan-design.md
[vpn-gateway-site-to-site-create]:../../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal.md
[vpn-gateway-vpn-faq]:../../vpn-gateway/vpn-gateway-vpn-faq.md
[xplat-cli]:../../cli-install-nodejs.md
[xplat-cli-azure-resource-manager]:../../xplat-cli-azure-resource-manager.md

<span data-ttu-id="7458b-145">本指南是在 Microsoft Azure 上實作和部署 SAP 軟體之文件的一部分。</span><span class="sxs-lookup"><span data-stu-id="7458b-145">This guide is part of the documentation on implementing and deploying the SAP software on Microsoft Azure.</span></span> <span data-ttu-id="7458b-146">閱讀本指南之前，請先閱讀[規劃和實作指南][planning-guide]。</span><span class="sxs-lookup"><span data-stu-id="7458b-146">Before reading this guide, please read the [Planning and Implementation Guide][planning-guide].</span></span> <span data-ttu-id="7458b-147">本文說明如何在 Microsoft Azure 虛擬機器 (VM) 上，使用 Azure 基礎結構即服務 (IaaS) 功能搭配 SAP，來部署各種關聯式資料庫管理系統 (RDBMS) 及相關產品。</span><span class="sxs-lookup"><span data-stu-id="7458b-147">This document covers the deployment of various Relational Database Management Systems (RDBMS) and related products in combination with SAP on Microsoft Azure Virtual Machines (VMs) using the Azure Infrastructure as a Service (IaaS) capabilities.</span></span>

<span data-ttu-id="7458b-148">本白皮書會對 SAP 安裝文件和 SAP 附註進行補充說明，指出用來在指定平台上安裝和部署 SAP 軟體的主要資源。</span><span class="sxs-lookup"><span data-stu-id="7458b-148">The paper complements the SAP Installation Documentation and SAP Notes which represent the primary resources for installations and deployments of SAP software on given platforms</span></span>

## <a name="general-considerations"></a><span data-ttu-id="7458b-149">一般考量</span><span class="sxs-lookup"><span data-stu-id="7458b-149">General considerations</span></span>
<span data-ttu-id="7458b-150">本章將說明在 Azure VM 中執行 SAP 相關 DBMS 系統的考量。</span><span class="sxs-lookup"><span data-stu-id="7458b-150">In this chapter, considerations of running SAP related DBMS systems in Azure VMs are introduced.</span></span> <span data-ttu-id="7458b-151">有數個對於本章中特定 DBMS 系統的參考資料。</span><span class="sxs-lookup"><span data-stu-id="7458b-151">There are few references to specific DBMS systems in this chapter.</span></span> <span data-ttu-id="7458b-152">在本白皮書內，改為在本章之後討論特定的 DBMS 系統。</span><span class="sxs-lookup"><span data-stu-id="7458b-152">Instead the specific DBMS systems are handled within this paper, after this chapter.</span></span>

### <a name="definitions-upfront"></a><span data-ttu-id="7458b-153">預先定義</span><span class="sxs-lookup"><span data-stu-id="7458b-153">Definitions upfront</span></span>
<span data-ttu-id="7458b-154">我們將在本文件中使用下列詞彙︰</span><span class="sxs-lookup"><span data-stu-id="7458b-154">Throughout the document we will use the following terms:</span></span>

* <span data-ttu-id="7458b-155">IaaS：基礎結構即服務。</span><span class="sxs-lookup"><span data-stu-id="7458b-155">IaaS: Infrastructure as a Service.</span></span>
* <span data-ttu-id="7458b-156">PaaS：平台即服務。</span><span class="sxs-lookup"><span data-stu-id="7458b-156">PaaS: Platform as a Service.</span></span>
* <span data-ttu-id="7458b-157">SaaS：軟體即服務。</span><span class="sxs-lookup"><span data-stu-id="7458b-157">SaaS: Software as a Service.</span></span>
* <span data-ttu-id="7458b-158">SAP 元件︰個別的 SAP 應用程式，例如 ECC、BW、Solution Manager 或 EP。</span><span class="sxs-lookup"><span data-stu-id="7458b-158">SAP Component: an individual SAP application such as ECC, BW, Solution Manager or EP.</span></span>  <span data-ttu-id="7458b-159">SAP 元件可以傳統 ABAP 或 Java 技術為基礎，或以非 NetWeaver 應用程式 (例如商務物件) 為基礎。</span><span class="sxs-lookup"><span data-stu-id="7458b-159">SAP components can be based on traditional ABAP or Java technologies or a non-NetWeaver based application such as Business Objects.</span></span>
* <span data-ttu-id="7458b-160">SAP 環境 (SAP Environment)︰一或多個以邏輯方式分組的 SAP 元件，可執行像是開發、QAS、訓練、DR 或生產等商務功能。</span><span class="sxs-lookup"><span data-stu-id="7458b-160">SAP Environment: one or more SAP components logically grouped to perform a business function such as Development, QAS, Training, DR or Production.</span></span>
* <span data-ttu-id="7458b-161">SAP 架構 (SAP Landscape)︰這是指客戶 IP 環境中的整個 SAP 資產。</span><span class="sxs-lookup"><span data-stu-id="7458b-161">SAP Landscape: This refers to the entire SAP assets in a customer’s IT landscape.</span></span> <span data-ttu-id="7458b-162">SAP 架構包含所有生產和非生產的環境。</span><span class="sxs-lookup"><span data-stu-id="7458b-162">The SAP landscape includes all production and non-production environments.</span></span>
* <span data-ttu-id="7458b-163">SAP 系統︰DBMS 層和應用程式層的組合，例如，SAP ERP 開發系統、SAP BW 測試系統、SAP CRM 生產系統等。在 Azure 部署中，不支援在內部部署與 Azure 之間分割這兩種層級。</span><span class="sxs-lookup"><span data-stu-id="7458b-163">SAP System: The combination of DBMS layer and application layer of e.g. an SAP ERP development system, SAP BW test system, SAP CRM production system, etc. In Azure deployments it is not supported to divide these two layers between on-premises and Azure.</span></span> <span data-ttu-id="7458b-164">這表示 SAP 系統可在內部部署或在 Azure 部署。</span><span class="sxs-lookup"><span data-stu-id="7458b-164">This means an SAP system is either deployed on-premises or it is deployed in Azure.</span></span> <span data-ttu-id="7458b-165">不過，您可以將具 SAP 結構的不同系統部署於 Azure 或內部部署。</span><span class="sxs-lookup"><span data-stu-id="7458b-165">However, you can deploy the different systems of an SAP landscape in Azure or on-premises.</span></span> <span data-ttu-id="7458b-166">例如，您可以在 Azure 部署 SAP CRM 開發和測試系統，但在內部部署 SAP CRM 生產系統。</span><span class="sxs-lookup"><span data-stu-id="7458b-166">For example, you could deploy the SAP CRM development and test systems in Azure but the SAP CRM production system on-premises.</span></span>
* <span data-ttu-id="7458b-167">僅限雲端的部署︰在此部署中，Azure 訂用帳戶並未透過站對站或 ExpressRoute 連線，連接到內部部署網路基礎結構。</span><span class="sxs-lookup"><span data-stu-id="7458b-167">Cloud-Only deployment: A deployment where the Azure subscription is not connected via a site-to-site or ExpressRoute connection to the on-premises network infrastructure.</span></span> <span data-ttu-id="7458b-168">在一般 Azure 文件中，這類部署也會描述為「僅限雲端」的部署。</span><span class="sxs-lookup"><span data-stu-id="7458b-168">In common Azure documentation these kinds of deployments are also described as ‘Cloud-Only’ deployments.</span></span> <span data-ttu-id="7458b-169">以此方法部署的虛擬機器可透過網際網路和指派給 Azure 中 VM 的公用網際網路端點來存取。</span><span class="sxs-lookup"><span data-stu-id="7458b-169">Virtual Machines deployed with this method are accessed through the Internet and public Internet endpoints assigned to the VMs in Azure.</span></span> <span data-ttu-id="7458b-170">內部部署 Active Directory (AD) 和 DNS 不會在這些部署類型中擴充到 Azure。</span><span class="sxs-lookup"><span data-stu-id="7458b-170">The on-premises Active Directory (AD) and DNS is not extended to Azure in these types of deployments.</span></span> <span data-ttu-id="7458b-171">因此，VM 不是內部部署 Active Directory 的一部分。</span><span class="sxs-lookup"><span data-stu-id="7458b-171">Hence the VMs are not part of the on-premises Active Directory.</span></span> <span data-ttu-id="7458b-172">附註：僅限雲端的部署在本文中定義為在 Azure 中以獨佔方式執行的完整 SAP 架構，不會將 Active Directory 或名稱解析從內部部署擴充到公用雲端。</span><span class="sxs-lookup"><span data-stu-id="7458b-172">Note: Cloud-Only deployments in this document are defined as complete SAP landscapes which are running exclusively in Azure without extension of Active Directory or name resolution from on-premises into public cloud.</span></span> <span data-ttu-id="7458b-173">在 Azure 上裝載的 SAP 系統與位於內部部署的資源之間必須使用 SAP STMS 或其他內部部署資源的情況下，SAP 生產系統或組態不支援僅限雲端的組態</span><span class="sxs-lookup"><span data-stu-id="7458b-173">Cloud-Only configurations are not supported for production SAP systems or configurations where SAP STMS or other on-premises resources need to be used between SAP systems hosted on Azure and resources residing on-premises.</span></span>
* <span data-ttu-id="7458b-174">跨單位：描述將 VM 部署到 Azure 訂用帳戶的案例，該訂用帳戶在內部部署資料中心與 Azure 之間具有站對站、多站台或 ExpressRoute 連線能力。</span><span class="sxs-lookup"><span data-stu-id="7458b-174">Cross-Premises: Describes a scenario where VMs are deployed to an Azure subscription that has site-to-site, multi-site or ExpressRoute connectivity between the on-premises datacenter(s) and Azure.</span></span> <span data-ttu-id="7458b-175">在一般 Azure 文件中，這類部署也會描述為「跨單位」案例。</span><span class="sxs-lookup"><span data-stu-id="7458b-175">In common Azure documentation, these kinds of deployments are also described as Cross-Premises scenarios.</span></span> <span data-ttu-id="7458b-176">連線的原因是為了將內部部署網域、內部部署 Active Directory 和內部部署 DNS 擴充到 Azure。</span><span class="sxs-lookup"><span data-stu-id="7458b-176">The reason for the connection is to extend on-premises domains, on-premises Active Directory and on-premises DNS into Azure.</span></span> <span data-ttu-id="7458b-177">內部部署的架構會擴充到訂用帳戶的 Azure 資產。</span><span class="sxs-lookup"><span data-stu-id="7458b-177">The on-premises landscape is extended to the Azure assets of the subscription.</span></span> <span data-ttu-id="7458b-178">在此擴充下，VM 可以是內部部署網域的一部分。</span><span class="sxs-lookup"><span data-stu-id="7458b-178">Having this extension, the VMs can be part of the on-premises domain.</span></span> <span data-ttu-id="7458b-179">內部部署網域的網域使用者可以存取伺服器，並且可在這些 VM 上執行服務 (例如 DBMS 服務)。</span><span class="sxs-lookup"><span data-stu-id="7458b-179">Domain users of the on-premises domain can access the servers and can run services on those VMs (like DBMS services).</span></span> <span data-ttu-id="7458b-180">您可以在內部部署的 VM 與 Azure 中部署的 VM 之間進行通訊與名稱解析。</span><span class="sxs-lookup"><span data-stu-id="7458b-180">Communication and name resolution between VMs deployed on-premises and VMs deployed in Azure is possible.</span></span> <span data-ttu-id="7458b-181">我們預期這是在 Azure 上部署 SAP 資產最常見的案例。</span><span class="sxs-lookup"><span data-stu-id="7458b-181">We expect this to be the most common scenario for deploying SAP assets on Azure.</span></span> <span data-ttu-id="7458b-182">如需詳細資訊，請參閱[這篇文章][vpn-gateway-cross-premises-options]和[這個主題][vpn-gateway-site-to-site-create]。</span><span class="sxs-lookup"><span data-stu-id="7458b-182">See [this][vpn-gateway-cross-premises-options] article and [this][vpn-gateway-site-to-site-create] for more information.</span></span>

> [!NOTE]
> <span data-ttu-id="7458b-183">SAP 生產系統支援跨單位部署 SAP 系統，其中執行 SAP 系統的 Azure 虛擬機器是內部部署網域的成員。</span><span class="sxs-lookup"><span data-stu-id="7458b-183">Cross-Premises deployments of SAP systems where Azure Virtual Machines running SAP systems are members of an on-premises domain are supported for production SAP systems.</span></span> <span data-ttu-id="7458b-184">支援跨單位組態，以便將部分或完整的 SAP 架構部署到 Azure。</span><span class="sxs-lookup"><span data-stu-id="7458b-184">Cross-Premises configurations are supported for deploying parts or complete SAP landscapes into Azure.</span></span> <span data-ttu-id="7458b-185">即使在 Azure 中執行完整的 SAP 架構，也會要求這些 VM 隸屬於內部部署網域和 ADS。</span><span class="sxs-lookup"><span data-stu-id="7458b-185">Even running the complete SAP landscape in Azure requires having those VMs being part of on-premises domain and ADS.</span></span> <span data-ttu-id="7458b-186">在本文件的先前版本中，我們曾談到混合式 IT 案例，其中「混合式」一詞基本上是指內部部署與 Azure 之間有跨單位連線能力。</span><span class="sxs-lookup"><span data-stu-id="7458b-186">In former versions of the documentation we talked about Hybrid-IT scenarios, where the term ‘Hybrid’ is rooted in the fact that there is a cross-premises connectivity between on-premises and Azure.</span></span> <span data-ttu-id="7458b-187">在此案例中，「混合式」也表示 Azure 中的 VM 是內部部署 Active Directory 的一部分。</span><span class="sxs-lookup"><span data-stu-id="7458b-187">In this case ‘Hybrid’ also means that the VMs in Azure are part of the on-premises Active Directory.</span></span>
>
>

<span data-ttu-id="7458b-188">有些 Microsoft 文件描述跨單位案例的方式稍有不同，尤其是 DBMS HA 組態。</span><span class="sxs-lookup"><span data-stu-id="7458b-188">Some Microsoft documentation describes Cross-Premises scenarios a bit differently, especially for DBMS HA configurations.</span></span> <span data-ttu-id="7458b-189">在 SAP 相關的文件中，跨單位案例會直接縮減為站對站或私人 (ExpressRoute) 連線能力，以及實際上 SAP 架構會分散至內部部署與 Azure 之間。</span><span class="sxs-lookup"><span data-stu-id="7458b-189">In the case of the SAP related documents, the Cross-Premises scenario just boils down to having a site-to-site or private (ExpressRoute) connectivity and to the fact that the SAP landscape is distributed between on-premises and Azure.</span></span>

### <a name="resources"></a><span data-ttu-id="7458b-190">資源</span><span class="sxs-lookup"><span data-stu-id="7458b-190">Resources</span></span>
<span data-ttu-id="7458b-191">針對在 Azure 上部署 SAP 的主題，以下是可用的指南︰</span><span class="sxs-lookup"><span data-stu-id="7458b-191">The following guides are available for the topic of SAP deployments on Azure:</span></span>

* <span data-ttu-id="7458b-192">[Azure 虛擬機器 (VM) 上的 SAP NetWeaver - 規劃和實作指南][planning-guide]</span><span class="sxs-lookup"><span data-stu-id="7458b-192">[SAP NetWeaver on Azure Virtual Machines (VMs) – Planning and Implementation Guide][planning-guide]</span></span>
* <span data-ttu-id="7458b-193">[Azure 虛擬機器 (VM) 上的 SAP NetWeaver - 部署指南][deployment-guide]</span><span class="sxs-lookup"><span data-stu-id="7458b-193">[SAP NetWeaver on Azure Virtual Machines (VMs) – Deployment Guide][deployment-guide]</span></span>
* <span data-ttu-id="7458b-194">[Azure 虛擬機器 (VM) 上的 SAP NetWeaver - DBMS 部署指南 (本文件)][dbms-guide]</span><span class="sxs-lookup"><span data-stu-id="7458b-194">[SAP NetWeaver on Azure Virtual Machines (VMs) – DBMS Deployment Guide (this document)][dbms-guide]</span></span>
* <span data-ttu-id="7458b-195">[Azure 虛擬機器 (VM) 上的 SAP NetWeaver - 高可用性部署指南][ha-guide]</span><span class="sxs-lookup"><span data-stu-id="7458b-195">[SAP NetWeaver on Azure Virtual Machines (VMs) – High Availability Deployment Guide][ha-guide]</span></span>

<span data-ttu-id="7458b-196">下列 SAP 附註與 Azure 上的 SAP 主題相關︰</span><span class="sxs-lookup"><span data-stu-id="7458b-196">The following SAP Notes are related to the topic of SAP on Azure:</span></span>

| <span data-ttu-id="7458b-197">附註編號</span><span class="sxs-lookup"><span data-stu-id="7458b-197">Note number</span></span> | <span data-ttu-id="7458b-198">課程名稱</span><span class="sxs-lookup"><span data-stu-id="7458b-198">Title</span></span> |
| --- | --- |
| <span data-ttu-id="7458b-199">[1928533]</span><span class="sxs-lookup"><span data-stu-id="7458b-199">[1928533]</span></span> |<span data-ttu-id="7458b-200">Azure 上的 SAP 應用程式︰支援的產品和 Azure VM 類型</span><span class="sxs-lookup"><span data-stu-id="7458b-200">SAP Applications on Azure: Supported Products and Azure VM types</span></span> |
| <span data-ttu-id="7458b-201">[2015553]</span><span class="sxs-lookup"><span data-stu-id="7458b-201">[2015553]</span></span> |<span data-ttu-id="7458b-202">Microsoft Azure 上的 SAP：支援的必要條件</span><span class="sxs-lookup"><span data-stu-id="7458b-202">SAP on Microsoft Azure: Support Prerequisites</span></span> |
| <span data-ttu-id="7458b-203">[1999351]</span><span class="sxs-lookup"><span data-stu-id="7458b-203">[1999351]</span></span> |<span data-ttu-id="7458b-204">疑難排解適用於 SAP 且已強化的 Azure 監視功能</span><span class="sxs-lookup"><span data-stu-id="7458b-204">Troubleshooting Enhanced Azure Monitoring for SAP</span></span> |
| <span data-ttu-id="7458b-205">[2178632]</span><span class="sxs-lookup"><span data-stu-id="7458b-205">[2178632]</span></span> |<span data-ttu-id="7458b-206">Microsoft Azure 上的 SAP 主要監視度量</span><span class="sxs-lookup"><span data-stu-id="7458b-206">Key Monitoring Metrics for SAP on Microsoft Azure</span></span> |
| <span data-ttu-id="7458b-207">[1409604]</span><span class="sxs-lookup"><span data-stu-id="7458b-207">[1409604]</span></span> |<span data-ttu-id="7458b-208">Windows 上的虛擬化︰增強型監視功能</span><span class="sxs-lookup"><span data-stu-id="7458b-208">Virtualization on Windows: Enhanced Monitoring</span></span> |
| <span data-ttu-id="7458b-209">[2191498]</span><span class="sxs-lookup"><span data-stu-id="7458b-209">[2191498]</span></span> |<span data-ttu-id="7458b-210">Linux 和 Azure 上的 SAP：增強型監視功能</span><span class="sxs-lookup"><span data-stu-id="7458b-210">SAP on Linux with Azure: Enhanced Monitoring</span></span> |
| <span data-ttu-id="7458b-211">[2039619]</span><span class="sxs-lookup"><span data-stu-id="7458b-211">[2039619]</span></span> |<span data-ttu-id="7458b-212">Microsoft Azure 上使用 Oracle 資料庫的 SAP 應用程式︰支援的產品和版本</span><span class="sxs-lookup"><span data-stu-id="7458b-212">SAP Applications on Microsoft Azure using the Oracle Database: Supported Products and Versions</span></span> |
| <span data-ttu-id="7458b-213">[2233094]</span><span class="sxs-lookup"><span data-stu-id="7458b-213">[2233094]</span></span> |<span data-ttu-id="7458b-214">DB6︰Azure 上使用 IBM DB2 for Linux, UNIX, and Windows 的應用程式 - 其他資訊</span><span class="sxs-lookup"><span data-stu-id="7458b-214">DB6: SAP Applications on Azure Using IBM DB2 for Linux, UNIX, and Windows - Additional Information</span></span> |
| <span data-ttu-id="7458b-215">[2243692]</span><span class="sxs-lookup"><span data-stu-id="7458b-215">[2243692]</span></span> |<span data-ttu-id="7458b-216">Microsoft Azure (IaaS) VM 上的 Linux：SAP 授權問題</span><span class="sxs-lookup"><span data-stu-id="7458b-216">Linux on Microsoft Azure (IaaS) VM: SAP license issues</span></span> |
| <span data-ttu-id="7458b-217">[1984787]</span><span class="sxs-lookup"><span data-stu-id="7458b-217">[1984787]</span></span> |<span data-ttu-id="7458b-218">SUSE LINUX Enterprise Server 12：安裝注意事項</span><span class="sxs-lookup"><span data-stu-id="7458b-218">SUSE LINUX Enterprise Server 12: Installation notes</span></span> |
| <span data-ttu-id="7458b-219">[2002167]</span><span class="sxs-lookup"><span data-stu-id="7458b-219">[2002167]</span></span> |<span data-ttu-id="7458b-220">Red Hat Enterprise Linux 7.x：安裝和升級</span><span class="sxs-lookup"><span data-stu-id="7458b-220">Red Hat Enterprise Linux 7.x: Installation and Upgrade</span></span> |

<span data-ttu-id="7458b-221">另請閱讀 [SCN Wiki](https://wiki.scn.sap.com/wiki/display/HOME/SAPonLinuxNotes) ，其中包含適用於 Linux 的所有 SAP 附註。</span><span class="sxs-lookup"><span data-stu-id="7458b-221">Please also read the [SCN Wiki](https://wiki.scn.sap.com/wiki/display/HOME/SAPonLinuxNotes) that contains all SAP Notes for Linux.</span></span>

<span data-ttu-id="7458b-222">您應該具備有關 Microsoft Azure 架構以及如何部署和操作 Microsoft Azure 虛擬機器的有效知識。</span><span class="sxs-lookup"><span data-stu-id="7458b-222">You should have a working knowledge about the Microsoft Azure Architecture and how Microsoft Azure Virtual Machines are deployed and operated.</span></span> <span data-ttu-id="7458b-223">您可以在以下位置找到更多資訊：<https://azure.microsoft.com/documentation/></span><span class="sxs-lookup"><span data-stu-id="7458b-223">You can find more information here <https://azure.microsoft.com/documentation/></span></span>

> [!NOTE]
> <span data-ttu-id="7458b-224">我們將「不」討論「Microsoft Azure 平台」的「Microsoft Azure 平台即服務」(PaaS) 產品。</span><span class="sxs-lookup"><span data-stu-id="7458b-224">We are **not** discussing Microsoft Azure Platform as a Service (PaaS) offerings of the Microsoft Azure Platform.</span></span> <span data-ttu-id="7458b-225">本白皮書的內容是關於如何在 Microsoft Azure 虛擬機器 (IaaS) 上執行資料庫管理系統 (DBMS)，就像在內部部署環境中執行 DBMS 一樣。</span><span class="sxs-lookup"><span data-stu-id="7458b-225">This paper is about running a database management system (DBMS) in Microsoft Azure Virtual Machines (IaaS) just as you would run the DBMS in your on-premises environment.</span></span> <span data-ttu-id="7458b-226">這兩個產品之間所提供的資料庫性能與功能差異極大，不應混用彼此。</span><span class="sxs-lookup"><span data-stu-id="7458b-226">Database capabilities and functionalities between these two offers are very different and should not be mixed up with each other.</span></span> <span data-ttu-id="7458b-227">另請參閱︰<https://azure.microsoft.com/services/sql-database/></span><span class="sxs-lookup"><span data-stu-id="7458b-227">See also: <https://azure.microsoft.com/services/sql-database/></span></span>
>
>

<span data-ttu-id="7458b-228">由於我們所討論的是 IaaS，因此，一般而言，Windows、Linux 和 DBMS 的安裝和組態基本上與您要安裝內部部署的任何虛擬機器或裸機機器相同。</span><span class="sxs-lookup"><span data-stu-id="7458b-228">Since we are discussing IaaS, in general the Windows, Linux and DBMS installation and configuration are essentially the same as any virtual machine or bare metal machine you would install on-premises.</span></span> <span data-ttu-id="7458b-229">不過，有一些架構和系統管理實作決策會與使用 IaaS 時的不同。</span><span class="sxs-lookup"><span data-stu-id="7458b-229">However, there are some architecture and system management implementation decisions which will be different when utilizing IaaS.</span></span> <span data-ttu-id="7458b-230">本文件的目的是說明您在使用 IaaS 時必須備妥的特定架構和系統管理差異。</span><span class="sxs-lookup"><span data-stu-id="7458b-230">The purpose of this document is to explain the specific architectural and system management differences that you must be prepared for when using IaaS.</span></span>

<span data-ttu-id="7458b-231">一般而言，本白皮書將討論的整體差異範圍如下：</span><span class="sxs-lookup"><span data-stu-id="7458b-231">In general, the overall areas of difference that this paper will discuss are:</span></span>

* <span data-ttu-id="7458b-232">為 SAP 系統規劃適當的 VM/VHD 配置，以確保您會有適當的資料檔案配置，而且可達到足夠的 IOPS 供您的工作負載使用。</span><span class="sxs-lookup"><span data-stu-id="7458b-232">Planning the proper VM/VHD layout of SAP systems to ensure you have the proper data file layout and can achieve enough IOPS for your workload.</span></span>
* <span data-ttu-id="7458b-233">使用 IaaS 時的網路功能考量。</span><span class="sxs-lookup"><span data-stu-id="7458b-233">Networking considerations when using IaaS.</span></span>
* <span data-ttu-id="7458b-234">用來最佳化資料庫配置的特定資料庫功能。</span><span class="sxs-lookup"><span data-stu-id="7458b-234">Specific database features to use in order to optimize the database layout.</span></span>
* <span data-ttu-id="7458b-235">IaaS 的備份和還原考量。</span><span class="sxs-lookup"><span data-stu-id="7458b-235">Backup and restore considerations in IaaS.</span></span>
* <span data-ttu-id="7458b-236">使用不同類型的映像進行部署。</span><span class="sxs-lookup"><span data-stu-id="7458b-236">Utilizing different types of images for deployment.</span></span>
* <span data-ttu-id="7458b-237">Azure IaaS 中的高可用性。</span><span class="sxs-lookup"><span data-stu-id="7458b-237">High Availability in Azure IaaS.</span></span>

## <span data-ttu-id="7458b-238"><a name="65fa79d6-a85f-47ee-890b-22e794f51a64"></a>RDBMS 部署結構</span><span class="sxs-lookup"><span data-stu-id="7458b-238"><a name="65fa79d6-a85f-47ee-890b-22e794f51a64"></a>Structure of a RDBMS Deployment</span></span>
<span data-ttu-id="7458b-239">為了依循本章內容，必須了解[部署指南][deployment-guide]的[這個][deployment-guide-3]章節所提供的內容。</span><span class="sxs-lookup"><span data-stu-id="7458b-239">In order follow this chapter, it is necessary to understand what was presented in [this][deployment-guide-3] chapter of the [Deployment Guide][deployment-guide].</span></span> <span data-ttu-id="7458b-240">閱讀本章之前，必須先了解並熟悉有關不同的 VM 系列及其差異，以及 Azure 標準和進階儲存體之差異的知識。</span><span class="sxs-lookup"><span data-stu-id="7458b-240">Knowledge about the different VM-Series and their differences and differences of Azure Standard and Premium Storage should be understood and known before reading this chapter.</span></span>

<span data-ttu-id="7458b-241">在 2015 年 3 月之前，包含作業系統的 Azure VHD 大小限制為 127 GB。</span><span class="sxs-lookup"><span data-stu-id="7458b-241">Until March 2015, Azure VHDs which contain an operating system were limited to 127 GB in size.</span></span> <span data-ttu-id="7458b-242">這項限制在 2015 年 3 月解除 (如需詳細資訊，請參閱 <https://azure.microsoft.com/blog/2015/03/25/azure-vm-os-drive-limit-octupled/>)。</span><span class="sxs-lookup"><span data-stu-id="7458b-242">This limitation got lifted in March 2015 (for more information check <https://azure.microsoft.com/blog/2015/03/25/azure-vm-os-drive-limit-octupled/> ).</span></span> <span data-ttu-id="7458b-243">從那時起，在包含作業系統的 VHD 上，其大小就與任何其他 VHD 一樣。</span><span class="sxs-lookup"><span data-stu-id="7458b-243">From there on VHDs containing the operating system can have the same size as any other VHD.</span></span> <span data-ttu-id="7458b-244">不過，我們仍然偏好部署的結構如下：作業系統、DBMS 和最終的 SAP 二進位檔會與資料庫檔案分隔開來。</span><span class="sxs-lookup"><span data-stu-id="7458b-244">Nevertheless, we still prefer a structure of deployment where the operating system, DBMS and eventual SAP binaries are separate from the database files.</span></span> <span data-ttu-id="7458b-245">因此，我們預期在 Azure 虛擬機器上執行的 SAP 系統將會使用作業系統、資料庫管理系統可執行檔和 SAP 可執行檔來安裝基底 VM (或 VHD)。</span><span class="sxs-lookup"><span data-stu-id="7458b-245">Therefore, we expect SAP systems running in Azure Virtual Machines will have the base VM (or VHD) installed with the operating system, database management system executables and SAP executables.</span></span> <span data-ttu-id="7458b-246">DBMS 資料和記錄檔將儲存於 Azure 儲存體 (標準或進階儲存體)，並以邏輯磁碟形式連接到原始的 Azure 作業系統映像 VM。</span><span class="sxs-lookup"><span data-stu-id="7458b-246">The DBMS data and log files will be stored in Azure Storage (Standard or Premium Storage) in separate VHD files and attached as logical disks to the original Azure operating system image VM.</span></span>

<span data-ttu-id="7458b-247">根據利用的是「Azure 標準儲存體」還是「進階儲存體」(例如，使用 DS 系列或 GS 系列的 VM) 而定，Azure 中還有其他的配額 (請參閱[這裡][virtual-machines-sizes]的記載)。</span><span class="sxs-lookup"><span data-stu-id="7458b-247">Dependent on leveraging Azure Standard or Premium Storage (e.g. by using the DS-series or GS-series VMs) there are other quotas in Azure which are documented [here][virtual-machines-sizes].</span></span> <span data-ttu-id="7458b-248">規劃 Azure VHD 時，您必須找到適用於下列各項的配額最佳平衡︰</span><span class="sxs-lookup"><span data-stu-id="7458b-248">When planning your Azure VHDs, you’ll need to find the best balance of the quotas for the following:</span></span>

* <span data-ttu-id="7458b-249">資料檔案數量。</span><span class="sxs-lookup"><span data-stu-id="7458b-249">The number of data files.</span></span>
* <span data-ttu-id="7458b-250">包含檔案的 VHD 數目。</span><span class="sxs-lookup"><span data-stu-id="7458b-250">The number of VHDs which contain the files.</span></span>
* <span data-ttu-id="7458b-251">單一 VHD 的 IOPS 配額。</span><span class="sxs-lookup"><span data-stu-id="7458b-251">The IOPS quotas of a single VHD.</span></span>
* <span data-ttu-id="7458b-252">每個 VHD 的資料輸送量。</span><span class="sxs-lookup"><span data-stu-id="7458b-252">The data throughput per VHD.</span></span>
* <span data-ttu-id="7458b-253">每個 VM 大小可能的額外 VHD 數目。</span><span class="sxs-lookup"><span data-stu-id="7458b-253">The number of additional VHDs possible per VM size.</span></span>
* <span data-ttu-id="7458b-254">VM 可提供的整體儲存體輸送量。</span><span class="sxs-lookup"><span data-stu-id="7458b-254">The overall storage throughput a VM can provide.</span></span>

<span data-ttu-id="7458b-255">Azure 將針對每個 VHD 磁碟機強制執行 IOPS 配額。</span><span class="sxs-lookup"><span data-stu-id="7458b-255">Azure will enforce an IOPS quota per VHD drive.</span></span> <span data-ttu-id="7458b-256">這些配額與 Azure 標準儲存體和進階儲存體上裝載的 VHD 不同。</span><span class="sxs-lookup"><span data-stu-id="7458b-256">These quotas are different for VHDs hosted on Azure Standard Storage and Premium Storage.</span></span> <span data-ttu-id="7458b-257">在這兩個進階儲存體傳遞因素比 I/O 延遲更好的儲存體類型之間，I/O 延遲也很不一樣。</span><span class="sxs-lookup"><span data-stu-id="7458b-257">I/O latencies will also be very different between the two storage types with Premium Storage delivering factors better I/O latencies.</span></span> <span data-ttu-id="7458b-258">不同 VM 類型的每一個可提供來讓您連接的 VHD 數目有限。</span><span class="sxs-lookup"><span data-stu-id="7458b-258">Each of the different VM types have a limited number of VHDs that you are able to attach.</span></span> <span data-ttu-id="7458b-259">另一個限制是只有特定的 VM 類型可以利用 Azure 進階儲存體。</span><span class="sxs-lookup"><span data-stu-id="7458b-259">Another restriction is that only certain VM types can leverage Azure Premium Storage.</span></span> <span data-ttu-id="7458b-260">這表示適用於特定 VM 類型的決策可能不只受到 CPU 和記憶體需求影響，而且也會受到 IOPS、延遲及磁碟輸送量需求影響，這些需求通常是利用 VHD 數目或進階儲存體磁碟的類型來調整。</span><span class="sxs-lookup"><span data-stu-id="7458b-260">This means the decision for a certain VM type might not only be driven by the CPU and memory requirements, but also by the IOPS, latency and disk throughput requirements that usually are scaled with the number of VHDs or the type of Premium Storage disks.</span></span> <span data-ttu-id="7458b-261">特別是進階儲存體，VHD 的大小可能也會受到每個 VHD 需要到達的 IOPS 數目和輸送量所支配。</span><span class="sxs-lookup"><span data-stu-id="7458b-261">Especially with Premium Storage the size of a VHD also might be dictated by the number of IOPS and throughput that needs to be achieved by each VHD.</span></span>

<span data-ttu-id="7458b-262">實際將整體 IOPS 速率、掛接的 VHD 數目及 VM 大小全都綁在一起，可能導致 SAP 系統的 Azure 組態與其內部部署產生差異。</span><span class="sxs-lookup"><span data-stu-id="7458b-262">The fact that the overall IOPS rate, the number of VHDs mounted, and the size of the VM are all tied together, might cause an Azure configuration of an SAP system to be different than its on-premises deployment.</span></span> <span data-ttu-id="7458b-263">每個 LUN 的 IOPS 限制通常可在內部部署中加以設定。</span><span class="sxs-lookup"><span data-stu-id="7458b-263">The IOPS limits per LUN are usually configurable in on-premises deployments.</span></span> <span data-ttu-id="7458b-264">然而使用 Azure 儲存體時，根據磁碟類型而定，這些限制可以是固定的，或者與進階儲存體相同。</span><span class="sxs-lookup"><span data-stu-id="7458b-264">Whereas with Azure Storage those limits are fixed or as in Premium Storage dependent on the disk type.</span></span> <span data-ttu-id="7458b-265">因此在內部部署中，我們看到資料庫伺服器的客戶組態會針對特定的可執行檔 (例如 SAP 和 DBMS) 使用許多不同的磁碟區，或者針對暫存資料庫或資料表空間使用特定的磁碟區。</span><span class="sxs-lookup"><span data-stu-id="7458b-265">So with on-premises deployments we see customer configurations of database servers which are using many different volumes for special executables like SAP and the DBMS or special volumes for temporary databases or table spaces.</span></span> <span data-ttu-id="7458b-266">將這類內部部署系統移至 Azure 時，可能會因為針對未執行任何或沒有很多 IOPS 的可執行檔或資料庫浪費了一個 VHD，因而可能產生 IOPS 頻寬的浪費。</span><span class="sxs-lookup"><span data-stu-id="7458b-266">When such an on-premises system is moved to Azure it might lead to a waste of potential IOPS bandwidth by wasting a VHD for executables or databases which do not perform any or not a lot of IOPS.</span></span> <span data-ttu-id="7458b-267">所以，在 Azure VM 中，我們建議盡可能將 DBMS 和 SAP 的可執行檔安裝於作業系統磁碟上。</span><span class="sxs-lookup"><span data-stu-id="7458b-267">Therefore, in Azure VMs we recommend that the DBMS and SAP executables be installed on the OS disk if possible.</span></span>

<span data-ttu-id="7458b-268">資料庫檔案和記錄檔的位置以及所使用的 Azure 儲存體類型應該依據 IOPS、延遲和輸送量需求來定義。</span><span class="sxs-lookup"><span data-stu-id="7458b-268">The placement of the database files and log files and the type of Azure Storage used, should be defined by IOPS, latency and throughput requirements.</span></span> <span data-ttu-id="7458b-269">為了有足夠的 IOPS 可供交易記錄使用，您可能被迫針對交易記錄檔利用多個 VHD 或使用更大的進階儲存體磁碟。</span><span class="sxs-lookup"><span data-stu-id="7458b-269">In order to have enough IOPS for the transaction log, you might be forced to leverage multiple VHDs for the transaction log file or use a larger Premium Storage disk.</span></span> <span data-ttu-id="7458b-270">在這種情況下，只需使用將包含交易記錄的 VHD 來建置軟體 RAID (例如，如果是 Windows，即為「Windows 儲存集區」，或如果是 Linux，則為 MDADM 和 LVM (邏輯磁碟區管理員)) 即可。</span><span class="sxs-lookup"><span data-stu-id="7458b-270">In such a case one would simply build a software RAID (e.g. Windows Storage Pool for Windows or MDADM and LVM (Logical Volume Manager) for Linux) with the VHDs which will contain the transaction log.</span></span>

- - -
> ![Windows][Logo_Windows] <span data-ttu-id="7458b-272">Windows</span><span class="sxs-lookup"><span data-stu-id="7458b-272">Windows</span></span>
>
> <span data-ttu-id="7458b-273">Azure VM 中的磁碟機 D:\ 不是永續性磁碟機，而是由 Azure 計算節點上的一些本機磁碟所組成。</span><span class="sxs-lookup"><span data-stu-id="7458b-273">Drive D:\ in an Azure VM is a non-persisted drive which is backed by some local disks on the Azure compute node.</span></span> <span data-ttu-id="7458b-274">由於它不是永續性的，這表示當 VM 重新開機時，即會遺失對 D:\ 磁碟機的內容所做的任何變更。</span><span class="sxs-lookup"><span data-stu-id="7458b-274">Because it is non-persisted, this means that any changes made to the content on the D:\ drive is lost when the VM is rebooted.</span></span> <span data-ttu-id="7458b-275">「任何變更」的意思是已儲存的檔案、已建立的目錄、已安裝的應用程式等。</span><span class="sxs-lookup"><span data-stu-id="7458b-275">By "any changes", we mean saved files, directories created, applications installed, etc.</span></span>
>
> ![Linux][Logo_Linux] <span data-ttu-id="7458b-277">Linux</span><span class="sxs-lookup"><span data-stu-id="7458b-277">Linux</span></span>
>
> <span data-ttu-id="7458b-278">Linux Azure VM 會在 /mnt/resource 上自動掛接磁碟機，這個非永續性磁碟機會利用 Azure 計算節點上的本機磁碟來備份。</span><span class="sxs-lookup"><span data-stu-id="7458b-278">Linux Azure VMs automatically mount a drive at /mnt/resource which is a non-persisted drive backed by local disks on the Azure compute node.</span></span> <span data-ttu-id="7458b-279">由於它不是永續性的，這表示當 VM 重新開機時，會遺失對 /mnt/resource 的內容所做的任何變更。</span><span class="sxs-lookup"><span data-stu-id="7458b-279">Because it is non-persisted, this means that any changes made to content in /mnt/resource is lost when the VM is rebooted.</span></span> <span data-ttu-id="7458b-280">「任何變更」的意思是已儲存的檔案、已建立的目錄、已安裝的應用程式等。</span><span class="sxs-lookup"><span data-stu-id="7458b-280">By any changes, we mean files saved, directories created, applications installed, etc.</span></span>
>
>

- - -
<span data-ttu-id="7458b-281">根據 Azure VM 系列而定，計算節點上的本機磁碟會顯示可以如下方式分類的不同效能：</span><span class="sxs-lookup"><span data-stu-id="7458b-281">Dependent on the Azure VM-series, the local disks on the compute node show different performance which can be categorized like:</span></span>

* <span data-ttu-id="7458b-282">A0-A7︰非常有限的效能。</span><span class="sxs-lookup"><span data-stu-id="7458b-282">A0-A7: Very limited performance.</span></span> <span data-ttu-id="7458b-283">無法使用 Windows 分頁檔以外的項目</span><span class="sxs-lookup"><span data-stu-id="7458b-283">Not usable for anything beyond windows page file</span></span>
* <span data-ttu-id="7458b-284">A8-A11︰效能特性非常良好，有數萬個 IOPS 和 > 1 GB/秒的輸送量</span><span class="sxs-lookup"><span data-stu-id="7458b-284">A8-A11: Very good performance characteristics with some ten thousand IOPS and >1GB/sec throughput</span></span>
* <span data-ttu-id="7458b-285">D 系列︰效能特性非常良好，有數萬個 IOPS 和 > 1 GB/秒的輸送量</span><span class="sxs-lookup"><span data-stu-id="7458b-285">D-Series: Very good performance characteristics with some ten thousand IOPS and >1GB/sec throughput</span></span>
* <span data-ttu-id="7458b-286">DS 系列︰效能特性非常良好，有數萬個 IOPS 和 > 1 GB/秒的輸送量</span><span class="sxs-lookup"><span data-stu-id="7458b-286">DS-Series: Very good performance characteristics with some ten thousand IOPS and >1GB/sec throughput</span></span>
* <span data-ttu-id="7458b-287">G 系列︰效能特性非常良好，有數萬個 IOPS 和 > 1 GB/秒的輸送量</span><span class="sxs-lookup"><span data-stu-id="7458b-287">G-Series: Very good performance characteristics with some ten thousand IOPS and >1GB/sec throughput</span></span>
* <span data-ttu-id="7458b-288">GS 系列︰效能特性非常良好，有數萬個 IOPS 和 > 1 GB/秒的輸送量</span><span class="sxs-lookup"><span data-stu-id="7458b-288">GS-Series: Very good performance characteristics with some ten thousand IOPS and >1GB/sec throughput</span></span>

<span data-ttu-id="7458b-289">以上陳述均適用於通過 SAP 認證的 VM 類型。</span><span class="sxs-lookup"><span data-stu-id="7458b-289">Statements above are applying to the VM types that are certified with SAP.</span></span> <span data-ttu-id="7458b-290">具有絕佳 IOPS 和輸送量的 VM 系列符合某些 DBMS 功能的使用資格，例如，tempdb 或暫存資料表空間。</span><span class="sxs-lookup"><span data-stu-id="7458b-290">The VM-series with excellent IOPS and throughput qualify for leverage by some DBMS features, like tempdb or temporary table space.</span></span>

### <span data-ttu-id="7458b-291"><a name="c7abf1f0-c927-4a7c-9c1d-c7b5b3b7212f"></a>VM 和 VHD 的快取</span><span class="sxs-lookup"><span data-stu-id="7458b-291"><a name="c7abf1f0-c927-4a7c-9c1d-c7b5b3b7212f"></a>Caching for VMs and VHDs</span></span>
<span data-ttu-id="7458b-292">當我們透過入口網站建立這些磁碟/VHD，或在將上傳的 VHD 掛接到 VM 時，可以選擇是否要快取在 VM 和位於 Azure 儲存體之 VHD 間的 I/O 流量。</span><span class="sxs-lookup"><span data-stu-id="7458b-292">When we create those disks/VHDs through the portal or when we mount uploaded VHDs to VMs, we can choose whether the I/O traffic between the VM and those VHDs located in Azure storage are cached.</span></span> <span data-ttu-id="7458b-293">Azure 標準和進階儲存體會針對這種快取類型使用兩種不同技術。</span><span class="sxs-lookup"><span data-stu-id="7458b-293">Azure Standard and Premium Storage use two different technologies for this type of cache.</span></span> <span data-ttu-id="7458b-294">在這兩個案例中，快取本身會在 VM 的暫存磁碟 (Windows 上的 D:\ 或 Linux 上的 /mnt/resource) 所使用的同一個磁碟機上進行磁碟備份。</span><span class="sxs-lookup"><span data-stu-id="7458b-294">In both cases the cache itself would be disk backed on the same drives used by the temporary disk (D:\ on Windows or /mnt/resource on Linux) of the VM.</span></span>

<span data-ttu-id="7458b-295">針對 Azure 標準儲存體，可能的快取類型如下︰</span><span class="sxs-lookup"><span data-stu-id="7458b-295">For Azure Standard Storage the possible cache types are:</span></span>

* <span data-ttu-id="7458b-296">無快取</span><span class="sxs-lookup"><span data-stu-id="7458b-296">No caching</span></span>
* <span data-ttu-id="7458b-297">讀取快取</span><span class="sxs-lookup"><span data-stu-id="7458b-297">Read caching</span></span>
* <span data-ttu-id="7458b-298">讀取和寫入快取</span><span class="sxs-lookup"><span data-stu-id="7458b-298">Read and Write caching</span></span>

<span data-ttu-id="7458b-299">為了取得一致且具決定性的效能，您應該在「Azure 標準儲存體」上，針對包含 **DBMS 相關資料檔、記錄檔和資料表空間的所有 VHD，將快取設定為「無」**。</span><span class="sxs-lookup"><span data-stu-id="7458b-299">In order to get consistent and deterministic performance, you should set the caching on Azure Standard Storage for all VHDs containing **DBMS related data files, log files and table space to 'NONE'**.</span></span> <span data-ttu-id="7458b-300">VM 的快取可以保留預設值。</span><span class="sxs-lookup"><span data-stu-id="7458b-300">The caching of the VM can remain with the default.</span></span>

<span data-ttu-id="7458b-301">針對 Azure 進階儲存體，提供下列快取選項︰</span><span class="sxs-lookup"><span data-stu-id="7458b-301">For Azure Premium Storage the following caching options exist:</span></span>

* <span data-ttu-id="7458b-302">無快取</span><span class="sxs-lookup"><span data-stu-id="7458b-302">No caching</span></span>
* <span data-ttu-id="7458b-303">讀取快取</span><span class="sxs-lookup"><span data-stu-id="7458b-303">Read caching</span></span>

<span data-ttu-id="7458b-304">對於「Azure 進階儲存體」的建議是利用 SAP 資料庫的「資料檔案讀取快取」，並選擇「不對記錄檔的 VHD 進行快取」。</span><span class="sxs-lookup"><span data-stu-id="7458b-304">Recommendation for Azure Premium Storage is to leverage **Read caching for data files** of the SAP database and chose **No caching for the VHD(s) of log file(s)**.</span></span>

### <span data-ttu-id="7458b-305"><a name="c8e566f9-21b7-4457-9f7f-126036971a91"></a>軟體 RAID</span><span class="sxs-lookup"><span data-stu-id="7458b-305"><a name="c8e566f9-21b7-4457-9f7f-126036971a91"></a>Software RAID</span></span>
<span data-ttu-id="7458b-306">如上所述，您需要在可設定 VHD 數目，以及 Azure VM 將針對每個 VHD 或進階儲存體磁碟類型提供的最大 IOPS 數目之間，平衡資料檔所需的 IOPS 數目。</span><span class="sxs-lookup"><span data-stu-id="7458b-306">As already stated above, you will need to balance the number of IOPS needed for the database files across the number of VHDs you can configure and the maximum IOPS an Azure VM will provide per VHD or Premium Storage disk type.</span></span> <span data-ttu-id="7458b-307">處理 VHD 上 IOPS 負載的最簡單方式是在不同的 VHD 上建置軟體 RAID。</span><span class="sxs-lookup"><span data-stu-id="7458b-307">Easiest way to deal with the IOPS load over VHDs is to build a software RAID over the different VHDs.</span></span> <span data-ttu-id="7458b-308">然後在劃分出軟體 RAID 的 LUN 上放置多個 SAP DBMS 的資料檔。</span><span class="sxs-lookup"><span data-stu-id="7458b-308">Then place a number of data files of the SAP DBMS on the LUNS carved out of the software RAID.</span></span> <span data-ttu-id="7458b-309">根據需求，因為這三個不同進階儲存體磁碟的其中兩個會提供比以標準儲存體為基礎的 VHD 更高的 IOPS 配額，所以您可能也要考慮使用進階儲存體。</span><span class="sxs-lookup"><span data-stu-id="7458b-309">Dependent on the requirements you might want to consider the usage of Premium Storage as well since two of the three different Premium Storage disks provide higher IOPS quota than VHDs based on Standard Storage.</span></span> <span data-ttu-id="7458b-310">除了明顯變好之外，Azure 進階儲存體還提供 I/O 延遲。</span><span class="sxs-lookup"><span data-stu-id="7458b-310">Besides the significant better I/O latency provided by Azure Premium Storage.</span></span>

<span data-ttu-id="7458b-311">同樣適用於不同 DBMS 系統的交易記錄檔。</span><span class="sxs-lookup"><span data-stu-id="7458b-311">Same applies to the transaction log of the different DBMS systems.</span></span> <span data-ttu-id="7458b-312">大量使用它們，由於 DBMS 系統一次只會寫入其中一個檔案，因此只新增更多 Tlog 檔案是毫無助益的。</span><span class="sxs-lookup"><span data-stu-id="7458b-312">With a lot of them just adding more Tlog files does not help since the DBMS systems write into one of the files at a time only.</span></span> <span data-ttu-id="7458b-313">如果需要的 IOPS 速率比以單一標準儲存體為基礎的 VHD 可提供的速率更高，您可以等量劃分多個標準儲存體 VHD，或者可以使用遠超過 IOPS 速率的更大型進階儲存體磁碟類型，其也可以將降低寫入 I/O 延遲的因素傳遞至交易記錄。</span><span class="sxs-lookup"><span data-stu-id="7458b-313">If higher IOPS rates are needed than a single Standard Storage based VHD can deliver, you can stripe over multiple Standard Storage VHDs or you can use a larger Premium Storage disk type that beyond higher IOPS rates also delivers factors lower latency for the write I/Os into the transaction log.</span></span>

<span data-ttu-id="7458b-314">以下是在 Azure 部署中使用優先軟體 RAID 時所遇到的情況：</span><span class="sxs-lookup"><span data-stu-id="7458b-314">Situations experienced in Azure deployments which would favor using a software RAID are:</span></span>

* <span data-ttu-id="7458b-315">交易記錄/重做記錄需要的 IOPS 數目比 Azure 針對單一 VHD 所提供的還多。</span><span class="sxs-lookup"><span data-stu-id="7458b-315">Transaction Log/Redo Log require more IOPS than Azure provides for a single VHD.</span></span> <span data-ttu-id="7458b-316">如前所述，解決此問題的方式是在多個 VHD上使用軟體 RAID 來建置 LUN。</span><span class="sxs-lookup"><span data-stu-id="7458b-316">As mentioned above this can be solved by building a LUN over multiple VHDs using a software RAID.</span></span>
* <span data-ttu-id="7458b-317">在 SAP 資料庫的不同資料檔之間 I/O 工作負載分配不平均。</span><span class="sxs-lookup"><span data-stu-id="7458b-317">Uneven I/O workload distribution over the different data files of the SAP database.</span></span> <span data-ttu-id="7458b-318">在這種情況下，會遇到某個資料檔到達配額的頻率比平常更高的狀況。</span><span class="sxs-lookup"><span data-stu-id="7458b-318">In such cases one can experience one data file hitting the quota rather often.</span></span> <span data-ttu-id="7458b-319">而其他資料檔甚至還未接近單一 VHD 的 IOPS 配額。</span><span class="sxs-lookup"><span data-stu-id="7458b-319">Whereas other data files are not even getting close to the IOPS quota of a single VHD.</span></span> <span data-ttu-id="7458b-320">在這種情況下，最簡單的解決方案是在多個 VHD 上使用軟體 RAID 來建置一個 LUN。</span><span class="sxs-lookup"><span data-stu-id="7458b-320">In such cases the easiest solution is to build one LUN over multiple VHDs using a software RAID.</span></span>
* <span data-ttu-id="7458b-321">您不知道每個資料檔確切的 I/O 工作負載，大約只知道以 DBMS 為根據的整體 IOPS 工作負載。</span><span class="sxs-lookup"><span data-stu-id="7458b-321">You don’t know what the exact I/O workload per data file is and only roughly know what the overall IOPS workload against the DBMS is.</span></span> <span data-ttu-id="7458b-322">執行此動作的最簡單方式是透過軟體 RAID 的協助來建置一個 LUN。</span><span class="sxs-lookup"><span data-stu-id="7458b-322">Easiest to do is to build one LUN with the help of a software RAID.</span></span> <span data-ttu-id="7458b-323">之後，位於這個 LUN 後方的多個 VHD 配額總和應可滿足已知的 IOPS 速率。</span><span class="sxs-lookup"><span data-stu-id="7458b-323">The sum of quotas of multiple VHDs behind this LUN should then fulfill the known IOPS rate.</span></span>

- - -
> ![Windows][Logo_Windows] <span data-ttu-id="7458b-325">Windows</span><span class="sxs-lookup"><span data-stu-id="7458b-325">Windows</span></span>
>
> <span data-ttu-id="7458b-326">最好使用 Windows Server 2012 或更高的儲存空間，因為它比舊版 Windows 的 Windows 等量更有效率。</span><span class="sxs-lookup"><span data-stu-id="7458b-326">Usage of Windows Server 2012 or higher Storage Spaces is preferable since it is more efficient than Windows Striping of earlier Windows versions.</span></span> <span data-ttu-id="7458b-327">請留意，當您使用 Windows Server 2012 做為作業系統時，可能需要透過 PowerShell 命令來建立 Windows 儲存體集區和儲存空間。</span><span class="sxs-lookup"><span data-stu-id="7458b-327">Please be aware that you might need to create the Windows Storage Pools and Storage Spaces by PowerShell commands when using Windows Server 2012 as Operating System.</span></span> <span data-ttu-id="7458b-328">PowerShell 命令可以在以下位置找到：<https://technet.microsoft.com/library/jj851254.aspx></span><span class="sxs-lookup"><span data-stu-id="7458b-328">The PowerShell commands can be found here <https://technet.microsoft.com/library/jj851254.aspx></span></span>
>
> ![Linux][Logo_Linux] <span data-ttu-id="7458b-330">Linux</span><span class="sxs-lookup"><span data-stu-id="7458b-330">Linux</span></span>
>
> <span data-ttu-id="7458b-331">只支援使用 MDADM 和 LVM (邏輯磁碟區管理員) 在 Linux 上建立軟體 RAID。</span><span class="sxs-lookup"><span data-stu-id="7458b-331">Only MDADM and LVM (Logical Volume Manager) are supported to build a software RAID on Linux.</span></span> <span data-ttu-id="7458b-332">如需詳細資訊，請參閱下列文章：</span><span class="sxs-lookup"><span data-stu-id="7458b-332">For more information, read the following articles:</span></span>
>
> * <span data-ttu-id="7458b-333">[在 Linux 上設定軟體 RAID][virtual-machines-linux-configure-raid] (適用於 MDADM)</span><span class="sxs-lookup"><span data-stu-id="7458b-333">[Configure Software RAID on Linux][virtual-machines-linux-configure-raid] (for MDADM)</span></span>
> * <span data-ttu-id="7458b-334">[在 Azure 中的 Linux VM 上設定 LVM][virtual-machines-linux-configure-lvm]</span><span class="sxs-lookup"><span data-stu-id="7458b-334">[Configure LVM on a Linux VM in Azure][virtual-machines-linux-configure-lvm]</span></span>
>
>

- - -
<span data-ttu-id="7458b-335">利用 VM 系列 (這些系列通常能夠與 Azure 進階儲存體搭配使用) 的考量如下︰</span><span class="sxs-lookup"><span data-stu-id="7458b-335">Considerations for leveraging VM-series which are able to work with Azure Premium Storage usually are:</span></span>

* <span data-ttu-id="7458b-336">要接近 SAN/NAS 裝置所傳遞的 I/O 延遲需求。</span><span class="sxs-lookup"><span data-stu-id="7458b-336">Demands for I/O latencies that are close to what SAN/NAS devices deliver.</span></span>
* <span data-ttu-id="7458b-337">比 Azure 標準儲存體可傳遞的 I/O 延遲更好的因素需求。</span><span class="sxs-lookup"><span data-stu-id="7458b-337">Demand for factors better I/O latency than Azure Standard Storage can deliver.</span></span>
* <span data-ttu-id="7458b-338">對於可根據特定 VM 類型使用多個標準儲存體 VHD 來達成的每個 VM 提供更高的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="7458b-338">Higher IOPS per VM than what could be achieved with multiple Standard Storage VHDs against a certain VM type.</span></span>

<span data-ttu-id="7458b-339">由於基礎的 Azure 儲存體會將每個 VHD 複寫到至少三個儲存體節點，因此可以使用簡單的 RAID 0 等量。</span><span class="sxs-lookup"><span data-stu-id="7458b-339">Since the underlying Azure Storage replicates each VHD to at least three storage nodes, simple RAID 0 striping can be used.</span></span> <span data-ttu-id="7458b-340">不需要實作 RAID5 或 RAID1。</span><span class="sxs-lookup"><span data-stu-id="7458b-340">There is no need to implement RAID5 or RAID1.</span></span>

### <span data-ttu-id="7458b-341"><a name="10b041ef-c177-498a-93ed-44b3441ab152"></a>Microsoft Azure 儲存體</span><span class="sxs-lookup"><span data-stu-id="7458b-341"><a name="10b041ef-c177-498a-93ed-44b3441ab152"></a>Microsoft Azure Storage</span></span>
<span data-ttu-id="7458b-342">Microsoft Azure 儲存體會將基底 VM (含作業系統) 以及 VHD 或 BLOB 儲存到至少 3 個不同的儲存體節點。</span><span class="sxs-lookup"><span data-stu-id="7458b-342">Microsoft Azure Storage will store the base VM (with OS) and VHDs or BLOBs to at least 3 separate storage nodes.</span></span> <span data-ttu-id="7458b-343">建立儲存體帳戶時，有一個保護選項，如下所示：</span><span class="sxs-lookup"><span data-stu-id="7458b-343">When creating a storage account, there is a choice of protection as shown here:</span></span>

![針對 Azure 儲存體帳戶啟用異地複寫][dbms-guide-figure-100]

<span data-ttu-id="7458b-345">Azure 儲存體本機複寫 (本地備援) 會根據因為少數客戶提供來部署的基礎結構失敗而導致的資料遺失來提供保護層級。</span><span class="sxs-lookup"><span data-stu-id="7458b-345">Azure Storage Local Replication (Locally Redundant) provides levels of protection against data loss due to infrastructure failure that few customers could afford to deploy.</span></span> <span data-ttu-id="7458b-346">如上所示，有 4 個不同的選項，第 5 個則是前三個其中之一的變化。</span><span class="sxs-lookup"><span data-stu-id="7458b-346">As shown above there are 4 different options with a fifth being a variation of one of the first three.</span></span> <span data-ttu-id="7458b-347">仔細查看我們區分它們的方式︰</span><span class="sxs-lookup"><span data-stu-id="7458b-347">Looking closer at them we can distinguish:</span></span>

* <span data-ttu-id="7458b-348">**進階本地備援儲存體 (LRS)**：針對執行需要大量 I/O 之工作負載的虛擬機器，「Azure 進階儲存體」提供高效能、低延遲的磁碟支援。</span><span class="sxs-lookup"><span data-stu-id="7458b-348">**Premium Locally Redundant Storage (LRS)**: Azure Premium Storage delivers high-performance, low-latency disk support for virtual machines running I/O-intensive workloads.</span></span> <span data-ttu-id="7458b-349">在 Azure 區域的同一個 Azure 資料中心內有 3 個資料複本。</span><span class="sxs-lookup"><span data-stu-id="7458b-349">There are 3 replicas of the data within the same Azure datacenter of an Azure region.</span></span> <span data-ttu-id="7458b-350">複本將位於不同的「容錯網域」和「升級網域」中 (如需相關概念，請參閱[規劃指南][planning-guide]中的[這個][planning-guide-3.2]章節)。</span><span class="sxs-lookup"><span data-stu-id="7458b-350">The copies will be in different Fault and Upgrade Domains (for concepts see [this][planning-guide-3.2] chapter in the [Planning Guide][planning-guide]).</span></span> <span data-ttu-id="7458b-351">萬一資料複本因為儲存體節點失敗或磁碟失敗而停止服務，即會自動產生新的複本。</span><span class="sxs-lookup"><span data-stu-id="7458b-351">In case of a replica of the data going out of service due to a storage node failure or disk failure, a new replica is generated automatically.</span></span>
* <span data-ttu-id="7458b-352">**本地備援儲存體 (LRS)**：在此案例中，在 Azure 區域的同一個 Azure 資料中心內會有 3 個資料複本。</span><span class="sxs-lookup"><span data-stu-id="7458b-352">**Locally Redundant Storage (LRS)**: In this case there are 3 replicas of the data within the same Azure datacenter of an Azure region.</span></span> <span data-ttu-id="7458b-353">複本將位於不同的「容錯網域」和「升級網域」中 (如需相關概念，請參閱[規劃指南][planning-guide]中的[這個][planning-guide-3.2]章節)。</span><span class="sxs-lookup"><span data-stu-id="7458b-353">The copies will be in different Fault and Upgrade Domains (for concepts see [this][planning-guide-3.2] chapter in the [Planning Guide][planning-guide]).</span></span> <span data-ttu-id="7458b-354">萬一資料複本因為儲存體節點失敗或磁碟失敗而停止服務，即會自動產生新的複本。</span><span class="sxs-lookup"><span data-stu-id="7458b-354">In case of a replica of the data going out of service due to a storage node failure or disk failure, a new replica is generated automatically.</span></span>
* <span data-ttu-id="7458b-355">**異地備援儲存體 (GRS)**︰在此案例中，會有一個非同步複寫，此複寫會在另一個 Azure 區域中饋送額外 3 個資料複本，而在大部分情況下，此區域會在同一個地理區域內 (例如，北歐和西歐)。</span><span class="sxs-lookup"><span data-stu-id="7458b-355">**Geo Redundant Storage (GRS)**: In this case there is an asynchronous replication that will feed an additional 3 replicas of the data in another Azure Region which is in most of the cases in the same geographical region (like North Europe and West Europe).</span></span> <span data-ttu-id="7458b-356">這將會產生 3 個額外的複本，因此總共有 6 個複本。</span><span class="sxs-lookup"><span data-stu-id="7458b-356">This will result in 3 additional replicas, so that there are 6 replicas in sum.</span></span> <span data-ttu-id="7458b-357">這個變化讓您能夠基於讀取目的來使用異地複寫之 Azure 區域中的資料 (讀取權限異地備援)。</span><span class="sxs-lookup"><span data-stu-id="7458b-357">A variation of this is an addition where the data in the geo replicated Azure region can be used for read purposes (Read-Access Geo-Redundant).</span></span>
* <span data-ttu-id="7458b-358">**區域備援儲存體 (ZRS)**︰在此案例中，3 個資料複本會保留於同一個 Azure 區域中。</span><span class="sxs-lookup"><span data-stu-id="7458b-358">**Zone Redundant Storage (ZRS)**: In this case the 3 replicas of the data remain in the same Azure Region.</span></span> <span data-ttu-id="7458b-359">如[規劃指南][planning-guide]的[這個][planning-guide-3.1]章節所述，一個 Azure 區域可以是相近的一些資料中心。</span><span class="sxs-lookup"><span data-stu-id="7458b-359">As explained in [this][planning-guide-3.1] chapter of the [Planning Guide][planning-guide] an Azure region can be a number of datacenters in close proximity.</span></span> <span data-ttu-id="7458b-360">在 LRS 的案例中，複本可以分散至組成一個 Azure 區域的不同資料中心。</span><span class="sxs-lookup"><span data-stu-id="7458b-360">In the case of LRS the replicas would be distributed over the different datacenters that make one Azure region.</span></span>

<span data-ttu-id="7458b-361">如需詳細資訊，請參閱[這裡][storage-redundancy]。</span><span class="sxs-lookup"><span data-stu-id="7458b-361">More information can be found [here][storage-redundancy].</span></span>

> [!NOTE]
> <span data-ttu-id="7458b-362">針對 DBMS 部署，不建議使用異地備援儲存體</span><span class="sxs-lookup"><span data-stu-id="7458b-362">For DBMS deployments, the usage of Geo Redundant Storage is not recommended</span></span>
>
> <span data-ttu-id="7458b-363">Azure 儲存體異地複寫是非同步的。</span><span class="sxs-lookup"><span data-stu-id="7458b-363">Azure Storage Geo-Replication is asynchronous.</span></span> <span data-ttu-id="7458b-364">複寫已掛接到單一 VM 的個別 VHD，不會在鎖定步驟中進行同步處理。</span><span class="sxs-lookup"><span data-stu-id="7458b-364">Replication of individual VHDs mounted to a single VM are not synchronized in lock step.</span></span> <span data-ttu-id="7458b-365">因此，不適合複寫已分散至不同 VHD 的 DBMS 檔案，或者根據以不同 VHD 為基礎的軟體 RAID 來部署的 DBMS 檔案。</span><span class="sxs-lookup"><span data-stu-id="7458b-365">Therefore, it is not suitable to replicate DBMS files that are distributed over different VHDs or deployed against a software RAID based on multiple VHDs.</span></span> <span data-ttu-id="7458b-366">DBMS 軟體要求永續性磁碟儲存體在不同的 LUN 和基礎磁碟/VHD/磁針上準確地進行同步處理。</span><span class="sxs-lookup"><span data-stu-id="7458b-366">DBMS software requires that the persistent disk storage is precisely synchronized across different LUNs and underlying disks/VHDs/spindles.</span></span> <span data-ttu-id="7458b-367">DBMS 軟體會使用各種適用於 IO 寫入活動順序的機制，即使有幾毫秒的變化，DBMS 都將報告複寫的目標磁碟儲存體已損毀。</span><span class="sxs-lookup"><span data-stu-id="7458b-367">DBMS software uses various mechanisms to sequence IO write activities and a DBMS will report that the disk storage targeted by the replication is corrupted if these vary even by a few milliseconds.</span></span> <span data-ttu-id="7458b-368">因此，如果您真的想要讓資料庫組態中的其中一個資料庫延展到多個異地複寫的 VHD，則需要使用資料庫方法和功能來執行這類複寫。</span><span class="sxs-lookup"><span data-stu-id="7458b-368">Hence if one really wants a database configuration with a database stretched across multiple VHDs geo-replicated, such a replication needs to be performed with database means and functionality.</span></span> <span data-ttu-id="7458b-369">您不應該依賴 Azure 儲存體異地複寫來執行此工作。</span><span class="sxs-lookup"><span data-stu-id="7458b-369">One should not rely on Azure Storage Geo-Replication to perform this job.</span></span>
>
> <span data-ttu-id="7458b-370">最簡單的方式是使用範例系統來說明此問題。</span><span class="sxs-lookup"><span data-stu-id="7458b-370">The problem is simplest to explain with an example system.</span></span> <span data-ttu-id="7458b-371">假設您已將 SAP 系統上傳至 Azure，其中有 8 個 VHD 包含 DBMS 的資料檔，加上一個包含交易記錄檔的 VHD。</span><span class="sxs-lookup"><span data-stu-id="7458b-371">Let’s assume you have an SAP system uploaded into Azure which has 8 VHDs containing data files of the DBMS plus one VHD containing the transaction log file.</span></span> <span data-ttu-id="7458b-372">在這 9 個 VHD 中，不論資料是否要寫入資料檔或交易記錄檔，每一個 VHD 都會根據 DBMS，以一致性方式將資料寫入其中。</span><span class="sxs-lookup"><span data-stu-id="7458b-372">Each one of these 9 VHDs will have data written to them in a consistent method according to the DBMS, whether the data is being written to the data or transaction log files.</span></span>
>
> <span data-ttu-id="7458b-373">若要針對資料正確地進行異地複寫並維護一致的資料庫映像，這九個 VHD 的內容全都必須以 I/O 作業根據這九個不同 VHD 執行的正確順序進行異地複寫。</span><span class="sxs-lookup"><span data-stu-id="7458b-373">In order to properly geo-replicate the data and maintain a consistent database image, the content of all nine VHDs would have to be geo-replicated in the exact order the I/O operations were executed against the nine different VHDs.</span></span> <span data-ttu-id="7458b-374">不過，Azure 儲存體異地複寫不允許宣告 VHD 之間的相依性。</span><span class="sxs-lookup"><span data-stu-id="7458b-374">However, Azure Storage geo-replication does not allow to declare dependencies between VHDs.</span></span> <span data-ttu-id="7458b-375">這表示 Microsoft Azure 儲存體異地複寫不會知道這九個不同 VHD 中的內容是彼此相關的，而且只有在複寫是以 I/O 作業在這 9 個 VHD 上發生的順序進行時，資料變更才會是一致的。</span><span class="sxs-lookup"><span data-stu-id="7458b-375">This means Microsoft Azure Storage geo-replication doesn’t know about the fact that the content in these nine different VHDs are related to each other and that the data changes are consistent only when replicating in the order the I/O operations happened across all the 9 VHDs.</span></span>
>
> <span data-ttu-id="7458b-376">除了案例中的異地複寫映像不會提供一致的資料庫映像的可能性很高，還會有效能負面影響，這是透過可嚴重影響效能的異地備援儲存體來顯示。</span><span class="sxs-lookup"><span data-stu-id="7458b-376">Besides chances being high that the geo-replicated images in the scenario do not provide a consistent database image, there also is a performance penalty that shows up with geo redundant storage that can severely impact performance.</span></span> <span data-ttu-id="7458b-377">總之，請勿針對 DBMS 類型的工作負載使用這個類型的儲存體備援。</span><span class="sxs-lookup"><span data-stu-id="7458b-377">In summary do not use this type of storage redundancy for DBMS type workloads.</span></span>
>
>

#### <a name="mapping-vhds-into-azure-virtual-machine-service-storage-accounts"></a><span data-ttu-id="7458b-378">將 VHD 對應至 Azure 虛擬機器服務儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="7458b-378">Mapping VHDs into Azure Virtual Machine Service Storage Accounts</span></span>
<span data-ttu-id="7458b-379">Azure 儲存體帳戶不只是一個系統管理的建構，而且還是限制的緣由。</span><span class="sxs-lookup"><span data-stu-id="7458b-379">An Azure Storage Account is not only an administrative construct, but also a subject of limitations.</span></span> <span data-ttu-id="7458b-380">然而，限制會根據我們討論的是 Azure 標準儲存體或 Azure 進階儲存體帳戶而有所不同。</span><span class="sxs-lookup"><span data-stu-id="7458b-380">Whereas the limitations vary on whether we talk about an Azure Standard Storage Account or an Azure Premium Storage Account.</span></span> <span data-ttu-id="7458b-381">如需了解確切的功能和限制，請參閱[這裡][storage-scalability-targets]</span><span class="sxs-lookup"><span data-stu-id="7458b-381">The exact capabilities and limitations are listed [here][storage-scalability-targets]</span></span>

<span data-ttu-id="7458b-382">因此，就「Azure 標準儲存體」而言，要特別注意每個儲存體帳戶都有 IOPS 限制 ([這篇文章][storage-scalability-targets]中包含「總要求率」的資料列)。</span><span class="sxs-lookup"><span data-stu-id="7458b-382">So for Azure Standard Storage it is important to note there is a limit on the IOPS per storage account (Row containing ‘Total Request Rate’ in [the article][storage-scalability-targets]).</span></span> <span data-ttu-id="7458b-383">此外，每個 Azure 訂用帳戶的「儲存體帳戶」初始限制為 100 個 (自 2015 年 7 月起)。</span><span class="sxs-lookup"><span data-stu-id="7458b-383">In addition, there is an initial limit of 100 Storage Accounts per Azure subscription (as of July 2015).</span></span> <span data-ttu-id="7458b-384">因此，建議在使用 Azure 標準儲存體時，平衡多個儲存體帳戶之間 VM 的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="7458b-384">Therefore, it is recommended to balance IOPS of VMs between multiple storage accounts when using Azure Standard Storage.</span></span> <span data-ttu-id="7458b-385">另一方面，單一 VM 最好盡可能使用一個儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7458b-385">Whereas a single VM ideally uses one storage account if possible.</span></span> <span data-ttu-id="7458b-386">因此，如果我們談到 DBMS 部署，其中每個裝載於 Azure 標準儲存體的 VHD 會到達其配額限制時，您應該只針對每個使用 Azure 標準儲存體的 Azure 儲存體帳戶部署 30-40 個 VHD。</span><span class="sxs-lookup"><span data-stu-id="7458b-386">So if we talk about DBMS deployments where each VHD that is hosted on Azure Standard Storage could reach its quota limit, you should only deploy 30-40 VHDs per Azure Storage Account that uses Azure Standard Storage.</span></span> <span data-ttu-id="7458b-387">相反地，如果您利用 Azure 進階儲存體，並且想要儲存大型資料庫磁碟區，您在 IOPS 方面可能不會遇到問題。</span><span class="sxs-lookup"><span data-stu-id="7458b-387">On the other hand, if you leverage Azure Premium Storage and want to store large database volumes, you might be fine in terms of IOPS.</span></span> <span data-ttu-id="7458b-388">但是，Azure 進階儲存體帳戶在資料磁碟區方面會比 Azure 標準儲存體帳戶更嚴格。</span><span class="sxs-lookup"><span data-stu-id="7458b-388">But an Azure Premium Storage Account is way more restrictive in data volume than an Azure Standard Storage Account.</span></span> <span data-ttu-id="7458b-389">因此，在到達資料磁碟區限制之前，您只能在 Azure 進階儲存體帳戶內部署有限的 VHD 數目。</span><span class="sxs-lookup"><span data-stu-id="7458b-389">As a result, you can only deploy a limited number of VHDs within an Azure Premium Storage Account before hitting the data volume limit.</span></span> <span data-ttu-id="7458b-390">最後，將 Azure 儲存體帳戶想像為「虛擬 SAN」，其在 IOPS 和/或容量中的功能有限。</span><span class="sxs-lookup"><span data-stu-id="7458b-390">At the end think of an Azure Storage Account as a “Virtual SAN” that has limited capabilities in IOPS and/or capacity.</span></span> <span data-ttu-id="7458b-391">因此，工作將會保留 (如同在內部部署中)，以便在不同的「虛構 SAN 裝置」或 Azure 儲存體帳戶上定義不同 SAP 系統的 VHD 配置。</span><span class="sxs-lookup"><span data-stu-id="7458b-391">As a result, the task remains, as in on-premises deployments, to define the layout of the VHDs of the different SAP systems over the different ‘imaginary SAN devices’ or Azure Storage Accounts.</span></span>

<span data-ttu-id="7458b-392">就「Azure 標準儲存體」而言，建議儘量不要對單一 VM 呈現來自不同儲存體帳戶的儲存體。</span><span class="sxs-lookup"><span data-stu-id="7458b-392">For Azure Standard Storage it is not recommended to present storage from different storage accounts to a single VM if possible.</span></span>

<span data-ttu-id="7458b-393">不過，使用 DS 或 GS 系列的 Azure VM 時，則可以掛接來自「Azure 標準儲存體帳戶」和「進階儲存體帳戶」的 VHD。</span><span class="sxs-lookup"><span data-stu-id="7458b-393">Whereas using the DS or GS-series of Azure VMs it is possible to mount VHDs out of Azure Standard Storage Accounts and Premium Storage Accounts.</span></span> <span data-ttu-id="7458b-394">像是將備份寫入標準儲存體備份的 VHD，使其在進階儲存體上具有 DBMS 資料和記錄檔的使用案例，會在腦海中浮現可在何處利用這類異質儲存體的想法。</span><span class="sxs-lookup"><span data-stu-id="7458b-394">Use cases like writing backups into Standard Storage backed VHDs whereas having DBMS data and log files on Premium Storage come to mind where such heterogeneous storage could be leveraged.</span></span>

<span data-ttu-id="7458b-395">根據客戶部署和測試，大約可在單一 Azure 標準儲存體帳戶上，利用可接受的效能來佈建 30 到 40 個含有資料庫資料檔和記錄檔的 VHD。</span><span class="sxs-lookup"><span data-stu-id="7458b-395">Based on customer deployments and testing around 30 to 40 VHDs containing database data files and log files can be provisioned on a single Azure Standard Storage Account with acceptable performance.</span></span> <span data-ttu-id="7458b-396">如先前所述，Azure 進階儲存體帳戶的限制很可能是它可持有的資料容量，而不是 IOPS。</span><span class="sxs-lookup"><span data-stu-id="7458b-396">As mentioned earlier, the limitation of an Azure Premium Storage Account is likely to be the data capacity it can hold and not IOPS.</span></span>

<span data-ttu-id="7458b-397">使用內部部署的 SAN 裝置，共用需要一些監視，以便最終能夠偵測到 Azure 儲存體帳戶上的瓶頸。</span><span class="sxs-lookup"><span data-stu-id="7458b-397">As with SAN devices on-premises, sharing requires some monitoring in order to eventually detect bottlenecks on an Azure Storage Account.</span></span> <span data-ttu-id="7458b-398">適用於 SAP 的 Azure 監視擴充功能和 Azure 入口網站等工具可用來偵測可能提供次佳 IO 效能的忙碌 Azure 儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7458b-398">The Azure Monitoring Extension for SAP and the Azure Portal are tools that can be used to detect busy Azure Storage Accounts that may be delivering suboptimal IO performance.</span></span>  <span data-ttu-id="7458b-399">如果偵測到這種情況，則建議將忙碌的 VM 移到另一個 Azure 儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7458b-399">If this situation is detected it is recommended to move busy VMs to another Azure Storage Account.</span></span> <span data-ttu-id="7458b-400">如需有關如何啟用 SAP 主機監視功能的詳細資訊，請參閱[部署指南][deployment-guide]。</span><span class="sxs-lookup"><span data-stu-id="7458b-400">Please refer to the [Deployment Guide][deployment-guide] for details on how to activate the SAP host monitoring capabilities.</span></span>

<span data-ttu-id="7458b-401">您可以在下列網址中，找到另一篇摘要說明「Azure 標準儲存體」和「Azure 標準儲存體帳戶」最佳做法的文章：<https://blogs.msdn.com/b/mast/archive/2014/10/14/configuring-azure-virtual-machines-for-optimal-storage-performance.aspx></span><span class="sxs-lookup"><span data-stu-id="7458b-401">Another article summarizing best practices around Azure Standard Storage and Azure Standard Storage Accounts can be found here <https://blogs.msdn.com/b/mast/archive/2014/10/14/configuring-azure-virtual-machines-for-optimal-storage-performance.aspx></span></span>

#### <a name="moving-deployed-dbms-vms-from-azure-standard-storage-to-azure-premium-storage"></a><span data-ttu-id="7458b-402">將部署的 DBMS VM 從 Azure 標準儲存體移至 Azure 進階儲存體</span><span class="sxs-lookup"><span data-stu-id="7458b-402">Moving deployed DBMS VMs from Azure Standard Storage to Azure Premium Storage</span></span>
<span data-ttu-id="7458b-403">我們遇到了相當多客戶想要將部署的 VM 從 Azure 標準儲存體移至 Azure 進階儲存體的案例。</span><span class="sxs-lookup"><span data-stu-id="7458b-403">We encounter quite some scenarios where you as customer want to move a deployed VM from Azure Standard Storage into Azure Premium Storage.</span></span> <span data-ttu-id="7458b-404">這不可能在沒有實際移動資料的情況下完成。</span><span class="sxs-lookup"><span data-stu-id="7458b-404">This is not possible without physically moving the data.</span></span> <span data-ttu-id="7458b-405">有數種方法能夠達成此目標：</span><span class="sxs-lookup"><span data-stu-id="7458b-405">There are several ways to achieve the goal:</span></span>

* <span data-ttu-id="7458b-406">您只需將所有的 VHD、基底 VHD 以及資料 VHD 複製到新的 Azure 進階儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7458b-406">You could simply copy all VHDs, base VHD as well as data VHDs into a new Azure Premium Storage Account.</span></span> <span data-ttu-id="7458b-407">很多時候，您在 Azure 標準儲存體中選擇 VHD 數目不是因為您需要資料磁碟區。</span><span class="sxs-lookup"><span data-stu-id="7458b-407">Very often you chose the number of VHDs in Azure Standard Storage not because of the fact that you needed the data volume.</span></span> <span data-ttu-id="7458b-408">但是，您需要這麼多 VHD 是因為 IOPS 的緣故。</span><span class="sxs-lookup"><span data-stu-id="7458b-408">But you needed that many VHDs because of the IOPS.</span></span> <span data-ttu-id="7458b-409">現在，您移至 Azure 進階儲存體，您可以採用較少 VHD 數目的方式來達到某些 IOPS 輸送量。</span><span class="sxs-lookup"><span data-stu-id="7458b-409">Now that you move to Azure Premium Storage you could go with way less VHDs to achieve the some IOPS throughput.</span></span> <span data-ttu-id="7458b-410">事實上，在 Azure 標準儲存體中，您是針對使用的資料而不是名義上的磁碟大小來付費，因此，VHD 的數目真的與成本無關。</span><span class="sxs-lookup"><span data-stu-id="7458b-410">Given the fact that in Azure Standard Storage you pay for the used data and not the nominal disk size, the number of VHDs did not really matter in terms of costs.</span></span> <span data-ttu-id="7458b-411">不過，使用 Azure 進階儲存體，您就要支付名義上的磁碟大小。</span><span class="sxs-lookup"><span data-stu-id="7458b-411">However, with Azure Premium Storage, you would pay for the nominal disk size.</span></span> <span data-ttu-id="7458b-412">因此，大部分的客戶嘗試將進階儲存體中 Azure VHD 的數目保留為達到 IOPS 輸送量所需的數目。</span><span class="sxs-lookup"><span data-stu-id="7458b-412">Therefore, most of the customer try to keep the number of Azure VHDs in Premium Storage at the number needed to achieve the IOPS throughput necessary.</span></span> <span data-ttu-id="7458b-413">所以，大多數客戶會根據簡單的 1:1 複製方式進行決策。</span><span class="sxs-lookup"><span data-stu-id="7458b-413">So, most customers decide against the way of a simple 1:1 copy.</span></span>
* <span data-ttu-id="7458b-414">如果尚未掛接，您要掛接單一 VHD，其中可包含 SAP 資料庫的資料庫備份。</span><span class="sxs-lookup"><span data-stu-id="7458b-414">If not yet mounted, you mount a single VHD that can contain a database backup of your SAP database.</span></span> <span data-ttu-id="7458b-415">備份之後，您要取消掛接所有包括含有備份之 VHD 的 VHD，以及將基底 VHD 和含有備份的 VHD 複製到 Azure 進階儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7458b-415">After the backup, you unmount all VHDs including the VHD containing the backup and copy the base VHD and the VHD with the backup into an Azure Premium Storage account.</span></span> <span data-ttu-id="7458b-416">然後根據基底 VHD 部署 VM，並掛接含有備份的 VHD。</span><span class="sxs-lookup"><span data-stu-id="7458b-416">You would then deploy the VM based on the base VHD and mount the VHD with the backup.</span></span> <span data-ttu-id="7458b-417">現在您可以針對用來還原資料庫的目標 VM，建立額外的空白進階儲存體磁碟。</span><span class="sxs-lookup"><span data-stu-id="7458b-417">Now you create additional empty Premium Storage Disks for the VM that are used to restore the database into.</span></span> <span data-ttu-id="7458b-418">這會假設 DBMS 可讓您變更資料和記錄檔的路徑，以做為還原程序的一部分。</span><span class="sxs-lookup"><span data-stu-id="7458b-418">This assumes that the DBMS allows you to change paths to the data and log files as part of the restore process.</span></span>
* <span data-ttu-id="7458b-419">另一個可能性是先前程序的變化，您只會將備份 VHD 複製到 Azure 進階儲存體，然後根據您最新部署與安裝的 VM 來連接它。</span><span class="sxs-lookup"><span data-stu-id="7458b-419">Another possibility is a variation of the former process, where you just copy the backup VHD into Azure Premium Storage and attach it against a VM that you newly deployed and installed.</span></span>
* <span data-ttu-id="7458b-420">當您需要變更資料庫的資料檔數目時，會選擇第四個可能性。</span><span class="sxs-lookup"><span data-stu-id="7458b-420">The fourth possibility you would choose when you are in need to change the number of data files of your database.</span></span> <span data-ttu-id="7458b-421">在這種情況下，您會使用匯出/匯入來執行 SAP 同質性系統複製。</span><span class="sxs-lookup"><span data-stu-id="7458b-421">In such a case you would perform a SAP homogenous system copy using export/import.</span></span> <span data-ttu-id="7458b-422">將這些匯出檔案放到 VHD (已複製到 Azure 進階儲存體帳戶)，然後將它連接到您用來執行匯入程序的 VM。</span><span class="sxs-lookup"><span data-stu-id="7458b-422">Put those export files into a VHD that is copied into an Azure Premium Storage Account and attach it to a VM that you use to run the import processes.</span></span> <span data-ttu-id="7458b-423">主要是在客戶想要減少資料檔數目時，才會使用這個可能性。</span><span class="sxs-lookup"><span data-stu-id="7458b-423">Customers use this possibility mainly when they want to decrease the number of data files.</span></span>

### <a name="deployment-of-vms-for-sap-in-azure"></a><span data-ttu-id="7458b-424">在 Azure 中部署適用於 SAP 的 VM</span><span class="sxs-lookup"><span data-stu-id="7458b-424">Deployment of VMs for SAP in Azure</span></span>
<span data-ttu-id="7458b-425">Microsoft Azure 提供多種方法來部署 VM 和相關聯的磁碟。</span><span class="sxs-lookup"><span data-stu-id="7458b-425">Microsoft Azure offers multiple ways to deploy VMs and associated disks.</span></span> <span data-ttu-id="7458b-426">因此，請務必了解這些差異，因為 VM 的準備工作可能會因部署方法而異。</span><span class="sxs-lookup"><span data-stu-id="7458b-426">Thereby it is very important to understand the differences since preparations of the VMs might differ dependent on the way of deployment.</span></span> <span data-ttu-id="7458b-427">我們通常會查看下列章節中所描述的案例。</span><span class="sxs-lookup"><span data-stu-id="7458b-427">In general, we look into the scenarios described in the following chapters.</span></span>

#### <a name="deploying-a-vm-from-the-azure-marketplace"></a><span data-ttu-id="7458b-428">從 Azure Marketplace 部署 VM</span><span class="sxs-lookup"><span data-stu-id="7458b-428">Deploying a VM from the Azure Marketplace</span></span>
<span data-ttu-id="7458b-429">您想要從 Azure Marketplace 使用 Microsoft 或協力廠商提供的映像來部署 VM。</span><span class="sxs-lookup"><span data-stu-id="7458b-429">You like to take a Microsoft or 3rd party provided image from the Azure Marketplace to deploy your VM.</span></span> <span data-ttu-id="7458b-430">在 Azure 中部署您的 VM 之後，您可以遵循相同的指導方針和工具在 VM 中安裝 SAP 軟體，就像在內部部署環境中所做的一樣。</span><span class="sxs-lookup"><span data-stu-id="7458b-430">After you deployed your VM in Azure, you follow the same guidelines and tools to install the SAP software inside your VM as you would do in an on-premises environment.</span></span> <span data-ttu-id="7458b-431">若要在 Azure VM 中安裝 SAP 軟體，SAP 和 Microsoft 建議將 SAP 安裝媒體上傳並儲存到 Azure VHD，或建立做為「檔案伺服器」並包含所有必要 SAP 安裝媒體的 Azure VM。</span><span class="sxs-lookup"><span data-stu-id="7458b-431">For installing the SAP software inside the Azure VM, SAP and Microsoft recommend to upload and store the SAP installation media in Azure VHDs or to create an Azure VM working as a ‘File server’ which contains all the necessary SAP installation media.</span></span>

#### <a name="deploying-a-vm-with-a-customer-specific-generalized-image"></a><span data-ttu-id="7458b-432">使用客戶特定的一般化映像部署 VM</span><span class="sxs-lookup"><span data-stu-id="7458b-432">Deploying a VM with a customer specific generalized image</span></span>
<span data-ttu-id="7458b-433">因為您的作業系統或 DBMS 版本的相關特定修補程式需求，所以 Azure Marketplace 中提供的映像可能不符合您的需求。</span><span class="sxs-lookup"><span data-stu-id="7458b-433">Due to specific patch requirements in regards to your OS or DBMS version, the provided images in the Azure Marketplace might not fit your needs.</span></span> <span data-ttu-id="7458b-434">因此，您可能必須使用自己「私人」的 OS/DBMS VM 映像建立 VM，之後即可多次部署此映像。</span><span class="sxs-lookup"><span data-stu-id="7458b-434">Therefore, you might need to create a VM using your own ‘private’ OS/DBMS VM image which can be deployed several times afterwards.</span></span> <span data-ttu-id="7458b-435">若要準備這類「私人」映像以供複製，您必須在內部部署 VM 上將作業系統一般化。</span><span class="sxs-lookup"><span data-stu-id="7458b-435">To prepare such a ‘private’ image for duplication, the OS must be generalized on the on-premises VM.</span></span> <span data-ttu-id="7458b-436">如需有關如何將 VM 一般化的詳細資訊，請參閱[部署指南][deployment-guide]。</span><span class="sxs-lookup"><span data-stu-id="7458b-436">Please refer to the [Deployment Guide][deployment-guide] for details on how to generalize a VM.</span></span>

<span data-ttu-id="7458b-437">如果您已在內部部署 VM (特別是針對 2 層系統) 中安裝 SAP 內容，您可以在部署 Azure VM 之後，透過 SAP Software Provisioning Manager 支援的執行個體重新命名程序來調整 SAP 系統設定 (SAP 附註 [1619720])。</span><span class="sxs-lookup"><span data-stu-id="7458b-437">If you have already installed SAP content in your on-premises VM (especially for 2-Tier systems), you can adapt the SAP system settings after the deployment of the Azure VM through the instance rename procedure supported by the SAP Software Provisioning Manager (SAP Note [1619720]).</span></span> <span data-ttu-id="7458b-438">否則，您稍後可以在部署 Azure VM 之後安裝 SAP 軟體。</span><span class="sxs-lookup"><span data-stu-id="7458b-438">Otherwise you can install the SAP software later after the deployment of the Azure VM.</span></span>

<span data-ttu-id="7458b-439">正如 SAP 應用程式所使用的資料庫內容，您可以透過 SAP 安裝產生全新的內容，或者可以使用 VHD 搭配 DBMS 資料庫備份，或是利用 DBMS 的功能直接備份至 Microsoft Azure 儲存體，來將內容匯入 Azure。</span><span class="sxs-lookup"><span data-stu-id="7458b-439">As of the database content used by the SAP application, you can either generate the content freshly by an SAP installation or you can import your content into Azure by using a VHD with a DBMS database backup or by leveraging capabilities of the DBMS to directly backup into Microsoft Azure Storage.</span></span> <span data-ttu-id="7458b-440">在此情況下，您可以也備妥 VHD 以及內部部署的 DBMS 資料檔和記錄檔，然後將它們當成磁碟匯入 Azure。</span><span class="sxs-lookup"><span data-stu-id="7458b-440">In this case, you could also prepare VHDs with the DBMS data and log files on-premises and then import those as Disks into Azure.</span></span> <span data-ttu-id="7458b-441">但是，傳輸從內部部署載入 Azure 的 DBMS 資料，會在需要於內部部署中備妥的 VHD 磁碟上運作。</span><span class="sxs-lookup"><span data-stu-id="7458b-441">But the transfer of DBMS data which is getting loaded from on-premises to Azure would work over VHD disks that need to be prepared on-premises.</span></span>

#### <a name="moving-a-vm-from-on-premises-to-azure-with-a-non-generalized-disk"></a><span data-ttu-id="7458b-442">使用非一般化磁碟將 VM 從內部部署移至 Azure</span><span class="sxs-lookup"><span data-stu-id="7458b-442">Moving a VM from on-premises to Azure with a non-generalized disk</span></span>
<span data-ttu-id="7458b-443">您打算將特定的 SAP 系統從內部部署移至 Azure (提升與轉變)。</span><span class="sxs-lookup"><span data-stu-id="7458b-443">You plan to move a specific SAP system from on-premises to Azure (lift and shift).</span></span> <span data-ttu-id="7458b-444">這可藉由將包含作業系統、SAP 二進位檔和最終 DBMS 二進位檔的 VHD，以及包含 DBMS 資料和記錄檔的 VHD 上傳至 Azure 來完成。</span><span class="sxs-lookup"><span data-stu-id="7458b-444">This can be done by uploading the VHD which contains the OS, the SAP binaries and eventual DBMS binaries plus the VHDs with the data and log files of the DBMS to Azure.</span></span> <span data-ttu-id="7458b-445">相對於上述的案例 2，您可以在 Azure VM 中保留主機名稱、SAP SID 和 SAP 使用者帳戶，因為這些項目已設定於內部部署環境中。</span><span class="sxs-lookup"><span data-stu-id="7458b-445">In opposite to scenario #2 above, you keep the hostname, SAP SID and SAP user accounts in the Azure VM as they were configured in the on-premises environment.</span></span> <span data-ttu-id="7458b-446">因此，不需要將映像一般化。</span><span class="sxs-lookup"><span data-stu-id="7458b-446">Therefore, generalizing the image is not necessary.</span></span> <span data-ttu-id="7458b-447">此情況最適用於跨單位案例，其中 SAP 架構的一部分是在內部部署執行，其餘部分則在 Azure 上執行。</span><span class="sxs-lookup"><span data-stu-id="7458b-447">This case will mostly apply for Cross-Premises scenarios where a part of the SAP landscape is run on-premises and parts on Azure.</span></span>

## <span data-ttu-id="7458b-448"><a name="871dfc27-e509-4222-9370-ab1de77021c3"></a>Azure VM 的相關高可用性和災害復原</span><span class="sxs-lookup"><span data-stu-id="7458b-448"><a name="871dfc27-e509-4222-9370-ab1de77021c3"></a>High Availability and Disaster Recovery with Azure VMs</span></span>
<span data-ttu-id="7458b-449">Azure 提供下列高可用性 (HA) 和災害復原 (DR) 功能，這些功能可以套用至我們用來進行 SAP 和 DBMS 部署的不同元件</span><span class="sxs-lookup"><span data-stu-id="7458b-449">Azure offers the following High Availability (HA) and Disaster Recovery (DR) functionalities which apply to different components we would use for SAP and DBMS deployments</span></span>

### <a name="vms-deployed-on-azure-nodes"></a><span data-ttu-id="7458b-450">部署於 Azure 節點上的 VM</span><span class="sxs-lookup"><span data-stu-id="7458b-450">VMs deployed on Azure Nodes</span></span>
<span data-ttu-id="7458b-451">Azure 平台不會針對部署的 VM 提供像是即時移轉等功能。</span><span class="sxs-lookup"><span data-stu-id="7458b-451">The Azure Platform does not offer features such as Live Migration for deployed VMs.</span></span> <span data-ttu-id="7458b-452">這表示，如果部署 VM 的伺服器叢集上需要維護，該 VM 就必須停止並重新啟動。</span><span class="sxs-lookup"><span data-stu-id="7458b-452">This means if there is maintenance necessary on a server cluster on which a VM is deployed, the VM needs to get stopped and restarted.</span></span> <span data-ttu-id="7458b-453">Azure 中的維護作業是在伺服器叢集內使用升級網域來執行。</span><span class="sxs-lookup"><span data-stu-id="7458b-453">Maintenance in Azure is performed using so called Upgrade Domains within clusters of servers.</span></span> <span data-ttu-id="7458b-454">一次只會維護一個升級網域。</span><span class="sxs-lookup"><span data-stu-id="7458b-454">Only one Upgrade Domain at a time is being maintained.</span></span> <span data-ttu-id="7458b-455">在執行這類重新啟動期間，當 VM 關閉、執行維護，以及 VM 重新啟動時，服務將會中斷。</span><span class="sxs-lookup"><span data-stu-id="7458b-455">During such a restart there will be an interruption of service while the VM is shut down, maintenance is performed and VM restarted.</span></span> <span data-ttu-id="7458b-456">不過，大部分的 DBMS 廠商都不會提供高可用性和災害復原功能，此功能將會在主要節點無法使用時，在另一個節點上快速重新啟動 DBMS 服務。</span><span class="sxs-lookup"><span data-stu-id="7458b-456">Most DBMS vendors however provide High Availability and Disaster Recovery functionality that will quickly restart the DBMS services on another node if the primary node is unavailable.</span></span> <span data-ttu-id="7458b-457">Azure 平台提供將 VM、儲存體及其他 Azure 服務分散到升級網域的功能，以確保預計的維護或基礎結構故障只會影響一小部分的 VM 或服務。</span><span class="sxs-lookup"><span data-stu-id="7458b-457">The Azure Platform offers functionality to distribute VMs, Storage and other Azure services across Upgrade Domains to ensure that planned maintenance or infrastructure failures would only impact a small subset of VMs or services.</span></span>  <span data-ttu-id="7458b-458">透過謹慎的規劃，就可以達到相當於內部部署基礎結構的可用性層級。</span><span class="sxs-lookup"><span data-stu-id="7458b-458">With careful planning it is possible to achieve availability levels comparable to on-premises infrastructures.</span></span>

<span data-ttu-id="7458b-459">「Microsoft Azure 可用性設定組」是 VM 或「服務」的邏輯群組，可確保 VM 和其他服務會分散到叢集內不同的「容錯網域」和「升級網域」，使得在任何時間點都只有一個節點會被關閉 (如需更多詳細資料，請參閱[這篇][virtual-machines-manage-availability]文章)。</span><span class="sxs-lookup"><span data-stu-id="7458b-459">Microsoft Azure Availability Sets are a logical grouping of VMs or Services that ensures VMs and other services are distributed to different Fault and Upgrade Domains within a cluster such that there would only be one node shutdown at any one point in time (read [this][virtual-machines-manage-availability] article for more details).</span></span>

<span data-ttu-id="7458b-460">推出 VM 時，必須依用途來設定，如下所示：</span><span class="sxs-lookup"><span data-stu-id="7458b-460">It needs to be configured by purpose when rolling out VMs as seen here:</span></span>

![適用於 DBMS HA 組態的可用性設定組定義][dbms-guide-figure-200]

<span data-ttu-id="7458b-462">如果想要建立 DBMS 部署的高可用性組態 (而不是個別使用 DBMS HA 功能)，則 DBMS VM 需要︰</span><span class="sxs-lookup"><span data-stu-id="7458b-462">If we want to create highly available configurations of DBMS deployments (independent of the individual DBMS HA functionality used), the DBMS VMs would need to:</span></span>

* <span data-ttu-id="7458b-463">將 VM 新增至相同的 Azure 虛擬網路 (<https://azure.microsoft.com/documentation/services/virtual-network/>)</span><span class="sxs-lookup"><span data-stu-id="7458b-463">Add the VMs to the same Azure Virtual Network (<https://azure.microsoft.com/documentation/services/virtual-network/>)</span></span>
* <span data-ttu-id="7458b-464">HA 組態的 VM 也應該位於相同的子網路中。</span><span class="sxs-lookup"><span data-stu-id="7458b-464">The VMs of the HA configuration should also be in the same subnet.</span></span> <span data-ttu-id="7458b-465">不同子網路之間的名稱解析無法在僅限雲端的部署中運作，只有 IP 解析才能正常運作。</span><span class="sxs-lookup"><span data-stu-id="7458b-465">Name resolution between the different subnets is not possible in Cloud-Only deployments, only IP resolution will work.</span></span> <span data-ttu-id="7458b-466">針對跨單位部署使用站對站或 ExpressRoute 連線能力，就已經建立了至少含有一個子網路的網路。</span><span class="sxs-lookup"><span data-stu-id="7458b-466">Using site-to-site or ExpressRoute connectivity for Cross-Premises deployments, a network with at least one subnet will be already established.</span></span> <span data-ttu-id="7458b-467">名稱解析是根據內部部署 AD 原則和網路基礎結構來完成。</span><span class="sxs-lookup"><span data-stu-id="7458b-467">Name resolution will be done according to the on-premises AD policies and network infrastructure.</span></span>

<span data-ttu-id="7458b-468">[comment]: <> (MSSedusch TODO 測試在 ARM 中是否仍為 true)</span><span class="sxs-lookup"><span data-stu-id="7458b-468">[comment]: <> (MSSedusch TODO Test if still true in ARM)</span></span>

#### <a name="ip-addresses"></a><span data-ttu-id="7458b-469">IP 位址</span><span class="sxs-lookup"><span data-stu-id="7458b-469">IP Addresses</span></span>
<span data-ttu-id="7458b-470">強烈建議使用彈性方式來設定 HA 組態的 VM。</span><span class="sxs-lookup"><span data-stu-id="7458b-470">It is highly recommended to setup the VMs for HA configurations in a resilient way.</span></span> <span data-ttu-id="7458b-471">除非使用靜態 IP 位址，否則，在 Azure 中依賴 IP 位址來處理 HA 組態內的 HA 夥伴並不可靠。</span><span class="sxs-lookup"><span data-stu-id="7458b-471">Relying on IP addresses to address the HA partner(s) within the HA configuration is not reliable in Azure unless static IP addresses are used.</span></span> <span data-ttu-id="7458b-472">Azure 中有兩種「關閉」概念︰</span><span class="sxs-lookup"><span data-stu-id="7458b-472">There are two “Shutdown” concepts in Azure:</span></span>

* <span data-ttu-id="7458b-473">透過 Azure 入口網站或 Azure PowerShell Cmdlet Stop-AzureRmVM 來關閉︰在此情況下，會關閉虛擬機器並取消配置。</span><span class="sxs-lookup"><span data-stu-id="7458b-473">Shut down through Azure Portal or Azure PowerShell cmdlet Stop-AzureRmVM: In this case the Virtual Machine gets shutdown and de-allocated.</span></span> <span data-ttu-id="7458b-474">之後將不會在針對此 VM 向您的 Azure 帳戶收取費用，因此，只有在使用儲存體時才會向您收費。</span><span class="sxs-lookup"><span data-stu-id="7458b-474">Your Azure account will no longer be charged for this VM so the only charges that will incur are for the storage used.</span></span> <span data-ttu-id="7458b-475">不過，如果網路介面的私人 IP 位址不是靜態的，即會發行該 IP 位址，但不保證在重新啟動 VM 之後，會再次將舊的 IP 位址指派給網路介面。</span><span class="sxs-lookup"><span data-stu-id="7458b-475">However, if the private IP address of the network interface was not static, the IP address is released and it is not guaranteed that the network interface gets the old IP address assigned again after a restart of the VM.</span></span> <span data-ttu-id="7458b-476">透過 Azure 入口網站或透過呼叫 Stop-AzureRmVM 來執行關閉，將會自動取消配置。</span><span class="sxs-lookup"><span data-stu-id="7458b-476">Performing the shut down through the Azure Portal or by calling Stop-AzureRmVM will automatically cause de-allocation.</span></span> <span data-ttu-id="7458b-477">如果您不希望使用 Stop-AzureRmVM -StayProvisioned 取消配置該機器</span><span class="sxs-lookup"><span data-stu-id="7458b-477">If you do not want to deallocat the machine use Stop-AzureRmVM -StayProvisioned</span></span>
* <span data-ttu-id="7458b-478">如果您從作業系統層級關閉 VM，該 VM 即會關閉且不會取消配置。</span><span class="sxs-lookup"><span data-stu-id="7458b-478">If you shut down the VM from an OS level, the VM gets shut down and NOT de-allocated.</span></span> <span data-ttu-id="7458b-479">不過，在此情況下，仍會向您的 Azure 帳戶收取 VM 的費用，儘管它已經關閉也一樣。</span><span class="sxs-lookup"><span data-stu-id="7458b-479">However, in this case, your Azure account will still be charged for the VM, despite the fact that it is shutdown.</span></span> <span data-ttu-id="7458b-480">在這種情況下，將 IP 位址指派給停止運作的 VM 仍將維持不變。</span><span class="sxs-lookup"><span data-stu-id="7458b-480">In such a case, the assignment of the IP address to a stopped VM will remain intact.</span></span> <span data-ttu-id="7458b-481">從中關閉 VM 將不會自動強制取消配置。</span><span class="sxs-lookup"><span data-stu-id="7458b-481">Shutting down the VM from within will not automatically force de-allocation.</span></span>

<span data-ttu-id="7458b-482">實際上對於跨內部部署案例而言，關閉和取消配置預設都表示要從 VM 中取消 IP 位址的指派，即使 DHCP 設定中的內部部署原則不同也一樣。</span><span class="sxs-lookup"><span data-stu-id="7458b-482">Even for Cross-Premises scenarios, by default a shutdown and de-allocation will mean de-assignment of the IP addresses from the VM, even if on-premises policies in DHCP settings are different.</span></span>

* <span data-ttu-id="7458b-483">有一個例外狀況，就是如果您如[這裡][virtual-networks-reserved-private-ip]所述，將靜態 IP 位址指派給網路介面。</span><span class="sxs-lookup"><span data-stu-id="7458b-483">The exception is if one assigns a static IP address to a network interface as described [here][virtual-networks-reserved-private-ip].</span></span>
* <span data-ttu-id="7458b-484">在這種情況下，只要網路介面未遭到刪除，IP 位址就會保持固定。</span><span class="sxs-lookup"><span data-stu-id="7458b-484">In such a case the IP address remains fixed as long as the network interface is not deleted.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7458b-485">為了讓整個部署保持簡單且容易管理，明確的建議是在 Azure 的 DBMS HA 或 DR 組態中設定 VM 合夥，方法是在所涉及的不同 VM 之間提供正常運作的名稱解析。</span><span class="sxs-lookup"><span data-stu-id="7458b-485">In order to keep the whole deployment simple and manageable, the clear recommendation is to setup the VMs partnering in a DBMS HA or DR configuration within Azure in a way that there is a functioning name resolution between the different VMs involved.</span></span>
>
>

## <a name="deployment-of-host-monitoring"></a><span data-ttu-id="7458b-486">部署主機監視功能</span><span class="sxs-lookup"><span data-stu-id="7458b-486">Deployment of Host Monitoring</span></span>
<span data-ttu-id="7458b-487">若要使 Azure 虛擬機器中的 SAP 應用程式以具生產力的方式運作，SAP 需要能夠從執行 Azure 虛擬機器的實際主機取得主機監視資料。</span><span class="sxs-lookup"><span data-stu-id="7458b-487">For productive usage of SAP Applications in Azure Virtual Machines, SAP requires the ability to get host monitoring data from the physical hosts running the Azure Virtual Machines.</span></span> <span data-ttu-id="7458b-488">需要有特定的 SAP HostAgent 修補程式等級，才能在 SAPOSCOL 和 SAP HostAgent 中啟用此功能。</span><span class="sxs-lookup"><span data-stu-id="7458b-488">A specific SAP HostAgent patch level will be required that enables this capability in SAPOSCOL and SAP HostAgent.</span></span> <span data-ttu-id="7458b-489">確切的修補程式等級記載於 SAP 附註 [1409604]。</span><span class="sxs-lookup"><span data-stu-id="7458b-489">The exact patch level is documented in SAP Note [1409604].</span></span>

<span data-ttu-id="7458b-490">如需了解如何部署將主機資料傳遞給 SAPOSCOL 和 SAPHostAgent 的元件及這些元件的生命週期管理，請參閱[部署指南][deployment-guide]</span><span class="sxs-lookup"><span data-stu-id="7458b-490">For the details regarding deployment of components that deliver host data to SAPOSCOL and SAPHostAgent and the lifecycle management of those components, please refer to the [Deployment Guide][deployment-guide]</span></span>

## <span data-ttu-id="7458b-491"><a name="3264829e-075e-4d25-966e-a49dad878737"></a>Microsoft SQL Server 專屬的詳細資料</span><span class="sxs-lookup"><span data-stu-id="7458b-491"><a name="3264829e-075e-4d25-966e-a49dad878737"></a>Specifics to Microsoft SQL Server</span></span>
### <a name="sql-server-iaas"></a><span data-ttu-id="7458b-492">SQL Server IaaS</span><span class="sxs-lookup"><span data-stu-id="7458b-492">SQL Server IaaS</span></span>
<span data-ttu-id="7458b-493">從 Microsoft Azure 開始，您就能輕易地將建置於 Windows Server 平台上現有的 SQL Server 應用程式移轉至 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="7458b-493">Starting with Microsoft Azure, you can easily migrate your existing SQL Server applications built on Windows Server platform to Azure Virtual Machines.</span></span> <span data-ttu-id="7458b-494">虛擬機器中的 SQL Server 可讓您輕鬆地將這些應用程式移轉到 Microsoft Azure，藉以減少部署、管理和維護企業級應用程式的擁有權總成本。</span><span class="sxs-lookup"><span data-stu-id="7458b-494">SQL Server in a Virtual Machine enables you to reduce the total cost of ownership of deployment, management and maintenance of enterprise breadth applications by easily migrating these applications to Microsoft Azure.</span></span> <span data-ttu-id="7458b-495">透過 Azure 虛擬機器中的 SQL Server，系統管理員和開發人員仍然可以使用可在內部部署使用的相同開發和管理工具。</span><span class="sxs-lookup"><span data-stu-id="7458b-495">With SQL Server in an Azure Virtual Machine, administrators and developers can still use the same development and administration tools that are available on-premises.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7458b-496">請注意，我們不討論 Microsoft Azure SQL Database，此為 Microsoft Azure 平台的「平台即服務」產品。</span><span class="sxs-lookup"><span data-stu-id="7458b-496">Please note we are not discussing Microsoft Azure SQL Database which is a Platform as a Service offer of the Microsoft Azure Platform.</span></span> <span data-ttu-id="7458b-497">本白皮書中討論的是如何執行 SQL Server 產品 (已知適用於 Azure 虛擬機器中的內部部署)，以及如何運用 Azure 的「基礎架構即為服務」功能。</span><span class="sxs-lookup"><span data-stu-id="7458b-497">The discussion in this paper is about running the SQL Server product as it is known for on-premises deployments in Azure Virtual Machines, leveraging the Infrastructure as a Service capability of Azure.</span></span> <span data-ttu-id="7458b-498">這兩個產品之間所提供的資料庫性能與功能並不相同，不應混用彼此。</span><span class="sxs-lookup"><span data-stu-id="7458b-498">Database capabilities and functionalities between these two offers are different and should not be mixed up with each other.</span></span> <span data-ttu-id="7458b-499">另請參閱︰<https://azure.microsoft.com/services/sql-database/></span><span class="sxs-lookup"><span data-stu-id="7458b-499">See also: <https://azure.microsoft.com/services/sql-database/></span></span>
>
>

<span data-ttu-id="7458b-500">強烈建議您先檢閱[這份][virtual-machines-sql-server-infrastructure-services]文件之後再繼續。</span><span class="sxs-lookup"><span data-stu-id="7458b-500">It is strongly recommended to review [this][virtual-machines-sql-server-infrastructure-services] documentation before continuing.</span></span>

<span data-ttu-id="7458b-501">在下列章節中，將會彙總並提及上述連結下方之文件的某些部分。</span><span class="sxs-lookup"><span data-stu-id="7458b-501">In the following sections pieces of parts of the documentation under the link above will be aggregated and mentioned.</span></span> <span data-ttu-id="7458b-502">也會提到 SAP 專屬的詳細資料，並更深入說明一些概念。</span><span class="sxs-lookup"><span data-stu-id="7458b-502">Specifics around SAP are mentioned as well and some concepts are described in more detail.</span></span> <span data-ttu-id="7458b-503">不過，強烈建議您完整閱讀該文件，然後再閱讀 SQL Server 專屬的文件。</span><span class="sxs-lookup"><span data-stu-id="7458b-503">However, it is highly recommended to work through the documentation above first before reading the SQL Server specific documentation.</span></span>

<span data-ttu-id="7458b-504">繼續之前，您應該先了解一些 IaaS 中 SQL Server 專屬的資訊：</span><span class="sxs-lookup"><span data-stu-id="7458b-504">There is some SQL Server in IaaS specific information you should know before continuing:</span></span>

* <span data-ttu-id="7458b-505">**虛擬機器 SLA**：如需適用於在 Azure 中執行之「虛擬機器」的 SLA，請參閱：<https://azure.microsoft.com/support/legal/sla/></span><span class="sxs-lookup"><span data-stu-id="7458b-505">**Virtual Machine SLA**: There is an SLA for Virtual Machines running in Azure which can be found here: <https://azure.microsoft.com/support/legal/sla/></span></span>  
* <span data-ttu-id="7458b-506">**SQL 版本支援**︰針對 SAP 客戶，我們在「Microsoft Azure 虛擬機器」上支援 SQL Server 2008 R2 和更新版本。</span><span class="sxs-lookup"><span data-stu-id="7458b-506">**SQL Version Support**: For SAP customers, we support SQL Server 2008 R2 and higher on Microsoft Azure Virtual Machine.</span></span> <span data-ttu-id="7458b-507">不支援舊版。</span><span class="sxs-lookup"><span data-stu-id="7458b-507">Earlier editions are not supported.</span></span> <span data-ttu-id="7458b-508">如需更多詳細資料，請檢閱這份通用的 [支援聲明](https://support.microsoft.com/kb/956893) 。</span><span class="sxs-lookup"><span data-stu-id="7458b-508">Review this general [Support Statement](https://support.microsoft.com/kb/956893) for more details.</span></span> <span data-ttu-id="7458b-509">請注意，Microsoft 通常也支援 SQL Server 2008。</span><span class="sxs-lookup"><span data-stu-id="7458b-509">Please note that in general SQL Server 2008 is supported by Microsoft as well.</span></span> <span data-ttu-id="7458b-510">不過，由於適用於 SAP 的重大功能是透過 SQL Server 2008 R2 所引進，因此 SQL Server 2008 R2 是適用於 SAP 的最低版本。</span><span class="sxs-lookup"><span data-stu-id="7458b-510">However due to significant functionality for SAP which was introduced with SQL Server 2008 R2, SQL Server 2008 R2 is the minimum release for SAP.</span></span> <span data-ttu-id="7458b-511">請記住，SQL Server 2012 和 2014 已擴充來與 IaaS 案例進行更深入整合 (例如，直接對 Azure 儲存體進行備份)。</span><span class="sxs-lookup"><span data-stu-id="7458b-511">Keep in mind that SQL Server 2012 and 2014 got extended with deeper integration into the IaaS scenario (like backing up directly against Azure Storage).</span></span> <span data-ttu-id="7458b-512">因此，我們將本白皮書範圍限制為 SQL Server 2012 和 2014 及其適用於 Azure 的最新修補程式等級。</span><span class="sxs-lookup"><span data-stu-id="7458b-512">Therefore, we restrict this paper to SQL Server 2012 and 2014 with its latest patch level for Azure.</span></span>
* <span data-ttu-id="7458b-513">**SQL 功能支援**︰「Microsoft Azure 虛擬機器」上支援大部分的 SQL Server 功能，但有一些例外。</span><span class="sxs-lookup"><span data-stu-id="7458b-513">**SQL Feature Support**: Most SQL Server features are supported on Microsoft Azure Virtual Machines with some exceptions.</span></span> <span data-ttu-id="7458b-514">**不支援使用共用磁碟的 SQL Server 容錯移轉叢集**。</span><span class="sxs-lookup"><span data-stu-id="7458b-514">**SQL Server Failover Clustering using Shared Disks is not supported**.</span></span>  <span data-ttu-id="7458b-515">單一 Azure 區域內支援分散式技術 (例如，資料庫鏡像、AlwaysOn 可用性群組、複寫、記錄傳送，以及 Service Broker)。</span><span class="sxs-lookup"><span data-stu-id="7458b-515">Distributed technologies like Database Mirroring, AlwaysOn Availability Groups, Replication, Log Shipping and Service Broker are supported within a single Azure Region.</span></span> <span data-ttu-id="7458b-516">SQL Server AlwaysOn 也在不同 Azure 區域之間受到支援，如以下文件所述︰<https://blogs.technet.com/b/dataplatforminsider/archive/2014/06/19/sql-server-alwayson-availability-groups-supported-between-microsoft-azure-regions.aspx>。</span><span class="sxs-lookup"><span data-stu-id="7458b-516">SQL Server AlwaysOn also is supported between different Azure Regions as documented here:  <https://blogs.technet.com/b/dataplatforminsider/archive/2014/06/19/sql-server-alwayson-availability-groups-supported-between-microsoft-azure-regions.aspx>.</span></span>  <span data-ttu-id="7458b-517">如需更多詳細資料，請檢閱這份 [支援聲明](https://support.microsoft.com/kb/956893) 。</span><span class="sxs-lookup"><span data-stu-id="7458b-517">Review the [Support Statement](https://support.microsoft.com/kb/956893) for more details.</span></span> <span data-ttu-id="7458b-518">如需有關如何部署 AlwaysOn 組態的範例，請參閱[這篇][virtual-machines-workload-template-sql-alwayson]文章。</span><span class="sxs-lookup"><span data-stu-id="7458b-518">An example on how to deploy an AlwaysOn configuration is shown in [this][virtual-machines-workload-template-sql-alwayson] article.</span></span> <span data-ttu-id="7458b-519">此外，也請參閱[這裡][virtual-machines-sql-server-infrastructure-services]所記載的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="7458b-519">Also, check out the Best Practices documented [here][virtual-machines-sql-server-infrastructure-services]</span></span>
* <span data-ttu-id="7458b-520">**SQL 效能**︰相較於其他公用雲端虛擬化產品，我們確信 Microsoft Azure 裝載的「虛擬機器」會有非常好的表現，但個別結果可能有所不同。</span><span class="sxs-lookup"><span data-stu-id="7458b-520">**SQL Performance**: We are confident that Microsoft Azure hosted Virtual Machines will perform very well in comparison to other public cloud virtualization offerings, but individual results may vary.</span></span> <span data-ttu-id="7458b-521">請參閱[這篇][virtual-machines-sql-server-performance-best-practices]文章。</span><span class="sxs-lookup"><span data-stu-id="7458b-521">Check out [this][virtual-machines-sql-server-performance-best-practices] article.</span></span>
* <span data-ttu-id="7458b-522">**使用來自 Azure Marketplace 的映像**︰部署新 Microsoft Azure VM 的最快方式就是使用來自 Azure Marketplace 的映像。</span><span class="sxs-lookup"><span data-stu-id="7458b-522">**Using Images from Azure Marketplace**: The fastest way to deploy a new Microsoft Azure VM is to use an image from the Azure Marketplace.</span></span> <span data-ttu-id="7458b-523">Azure Marketplace 中提供包含 SQL Server 的映像。</span><span class="sxs-lookup"><span data-stu-id="7458b-523">There are images in the Azure Marketplace which contain SQL Server.</span></span> <span data-ttu-id="7458b-524">已經安裝 SQL Server 的映像不能立即用於 SAP NetWeaver 應用程式。</span><span class="sxs-lookup"><span data-stu-id="7458b-524">The images where SQL Server already is installed can’t be immediately used for SAP NetWeaver applications.</span></span> <span data-ttu-id="7458b-525">原因是預設的 SQL Server 定序是安裝於這些映像內，而不是 SAP NetWeaver 系統所需的定序。</span><span class="sxs-lookup"><span data-stu-id="7458b-525">The reason is the default SQL Server collation is installed within those images and not the collation required by SAP NetWeaver systems.</span></span> <span data-ttu-id="7458b-526">若要使用這類映像，請參閱[使用來自 Microsoft Azure Marketplace 的 SQL Server 映像][dbms-guide-5.6]一章中記載的步驟。</span><span class="sxs-lookup"><span data-stu-id="7458b-526">In order to use such images, please check the steps documented in chapter [Using a SQL Server images out of the Microsoft Azure Marketplace][dbms-guide-5.6].</span></span>
* <span data-ttu-id="7458b-527">如需詳細資訊，請參閱 [定價詳細資料](https://azure.microsoft.com/pricing/) 。</span><span class="sxs-lookup"><span data-stu-id="7458b-527">Check out [Pricing Details](https://azure.microsoft.com/pricing/) for more information.</span></span> <span data-ttu-id="7458b-528">[SQL Server 2012 授權指南](https://download.microsoft.com/download/7/3/C/73CAD4E0-D0B5-4BE5-AB49-D5B886A5AE00/SQL_Server_2012_Licensing_Reference_Guide.pdf)和 [SQL Server 2014 授權指南](https://download.microsoft.com/download/B/4/E/B4E604D9-9D38-4BBA-A927-56E4C872E41C/SQL_Server_2014_Licensing_Guide.pdf)也是相當重要的資源。</span><span class="sxs-lookup"><span data-stu-id="7458b-528">The [SQL Server 2012 Licensing Guide](https://download.microsoft.com/download/7/3/C/73CAD4E0-D0B5-4BE5-AB49-D5B886A5AE00/SQL_Server_2012_Licensing_Reference_Guide.pdf) and [SQL Server 2014 Licensing Guide](https://download.microsoft.com/download/B/4/E/B4E604D9-9D38-4BBA-A927-56E4C872E41C/SQL_Server_2014_Licensing_Guide.pdf) are also an important resource.</span></span>

### <a name="sql-server-configuration-guidelines-for-sap-related-sql-server-installations-in-azure-vms"></a><span data-ttu-id="7458b-529">在 Azure VM 中安裝 SAP 相關之 SQL Server 的 SQL Server 組態指導方針</span><span class="sxs-lookup"><span data-stu-id="7458b-529">SQL Server configuration guidelines for SAP related SQL Server installations in Azure VMs</span></span>
#### <a name="recommendations-on-vmvhd-structure-for-sap-related-sql-server-deployments"></a><span data-ttu-id="7458b-530">適用於 SAP 相關之 SQL Server 部署的 VM/VHD 結構建議</span><span class="sxs-lookup"><span data-stu-id="7458b-530">Recommendations on VM/VHD structure for SAP related SQL Server deployments</span></span>
<span data-ttu-id="7458b-531">根據一般的描述，SQL Server 可執行檔應該位於或安裝於 VM 基底 VHD 的系統磁碟機 (磁碟機 C:\))。</span><span class="sxs-lookup"><span data-stu-id="7458b-531">In accordance with the general description, SQL Server executables should be located or installed into the system drive of the VM’s base VHD (drive C:\).</span></span>  <span data-ttu-id="7458b-532">一般而言，依照 SAP NetWeaver 工作負載，大部分的 SQL Server 系統資料庫都不會在高等級中使用。</span><span class="sxs-lookup"><span data-stu-id="7458b-532">Typically, most of the SQL Server system databases are not utilized at a high level by SAP NetWeaver workload.</span></span> <span data-ttu-id="7458b-533">因此，SQL Server 的系統資料庫 (master、msdb 和 model) 也可以保留於 C:\ 磁碟機。</span><span class="sxs-lookup"><span data-stu-id="7458b-533">Hence the system databases of SQL Server (master, msdb, and model) can remain on the C:\ drive as well.</span></span> <span data-ttu-id="7458b-534">有一個例外狀況是 tempdb，在某些 SAP ERP 和所有 BW 工作負載中，可能需要較高的資料量或 I/O 作業量，以致於不適合放在原始 VM 中。</span><span class="sxs-lookup"><span data-stu-id="7458b-534">An exception could be tempdb, which in the case of some SAP ERP and all BW workloads, might require either higher data volume or I/O operations volume which can’t fit into the original VM.</span></span> <span data-ttu-id="7458b-535">針對這類系統，應該執行下列步驟︰</span><span class="sxs-lookup"><span data-stu-id="7458b-535">For such systems, the following steps should be performed:</span></span>

* <span data-ttu-id="7458b-536">將主要 tempdb 資料檔移至與 SAP 資料庫的主要資料檔相同的邏輯磁碟機。</span><span class="sxs-lookup"><span data-stu-id="7458b-536">Move the primary tempdb data file(s) to the same logical drive as the primary data file(s) of the SAP database.</span></span>
* <span data-ttu-id="7458b-537">將任何其他 tempdb 資料檔新增到其他包含 SAP 使用者資料庫之資料檔的邏輯磁碟區。</span><span class="sxs-lookup"><span data-stu-id="7458b-537">Add any additional tempdb data files to each of the other logical drives containing a data file of the SAP user database.</span></span>
* <span data-ttu-id="7458b-538">將 tempdb 記錄檔新增到包含使用者資料庫記錄檔的邏輯磁碟機。</span><span class="sxs-lookup"><span data-stu-id="7458b-538">Add the tempdb logfile to the logical drive which contains the user database’s log file.</span></span>
* <span data-ttu-id="7458b-539">**(僅適用於計算節點上使用本機 SSD 的 VM 類型)** tempdb 資料檔和記錄檔可以放在 D:\ 磁碟機上。</span><span class="sxs-lookup"><span data-stu-id="7458b-539">**Exclusively for VM types that use local SSDs** on the compute node tempdb data and log files might be placed on the D:\ drive.</span></span> <span data-ttu-id="7458b-540">不過，可能會建議使用多個 tempdb 資料檔。</span><span class="sxs-lookup"><span data-stu-id="7458b-540">Nevertheless, it might be recommended to use multiple tempdb data files.</span></span> <span data-ttu-id="7458b-541">請注意，D:\ 磁碟機磁碟區會根據 VM 類型而不同。</span><span class="sxs-lookup"><span data-stu-id="7458b-541">Be aware D:\ drive volumes are different based on the VM type.</span></span>

<span data-ttu-id="7458b-542">這些組態讓 tempdb 所耗用的空間比系統磁碟機能夠提供的還多。</span><span class="sxs-lookup"><span data-stu-id="7458b-542">These configurations enable tempdb to consume more space than the system drive is able to provide.</span></span> <span data-ttu-id="7458b-543">若要判斷正確的 tempdb 大小，使用者可以在內部部署中執行的現有系統上檢查 tempdb 大小。</span><span class="sxs-lookup"><span data-stu-id="7458b-543">In order to determine the proper tempdb size, one can check the tempdb sizes on existing systems which run on-premises.</span></span> <span data-ttu-id="7458b-544">此外，這類組態可針對無法使用系統磁碟機來提供的 tempdb 啟用 IOPS 數目。</span><span class="sxs-lookup"><span data-stu-id="7458b-544">In addition, such a configuration would enable IOPS numbers against tempdb which cannot be provided with the system drive.</span></span> <span data-ttu-id="7458b-545">同樣地，在內部部署執行的系統可用於監視 tempdb 的 I/O 工作負載，讓您可以衍生出預期要在 tempdb 上看到的 IOPS 數目。</span><span class="sxs-lookup"><span data-stu-id="7458b-545">Again, systems that are running on-premises can be used to monitor I/O workload against tempdb so that you can derive the IOPS numbers you expect to see on your tempdb.</span></span>

<span data-ttu-id="7458b-546">執行含有 SAP 資料庫的 SQL Server 且 tempdb 資料和 tempdb 記錄檔放置於 D:\ 磁碟機的 VM 組態應該像這樣︰</span><span class="sxs-lookup"><span data-stu-id="7458b-546">A VM configuration which runs SQL Server with a SAP database and where tempdb data and tempdb logfile are placed on the D:\ drive would look like:</span></span>

![適用於 SAP 之 Azure IaaS VM 的參考組態][dbms-guide-figure-300]

<span data-ttu-id="7458b-548">請注意，根據 VM 類型而定，D:\ 磁碟機會有不同的大小。</span><span class="sxs-lookup"><span data-stu-id="7458b-548">Be aware that the D:\ drive has different sizes dependent on the VM type.</span></span> <span data-ttu-id="7458b-549">根據 tempdb 的大小需求而定，萬一 D:\ 磁碟機太小，可能要強制您將 tempdb 資料和記錄檔與 SAP 資料庫資料和記錄檔進行配對。</span><span class="sxs-lookup"><span data-stu-id="7458b-549">Dependent on the size requirement of tempdb you might be forced to pair tempdb data and log files with the SAP database data and log files in cases where D:\ drive is too small.</span></span>

#### <a name="formatting-the-vhds"></a><span data-ttu-id="7458b-550">格式化 VHD</span><span class="sxs-lookup"><span data-stu-id="7458b-550">Formatting the VHDs</span></span>
<span data-ttu-id="7458b-551">針對 SQL Server，適用於包含 SQL Server 資料和記錄檔的 NTFS 區塊大小應該是 64 K。</span><span class="sxs-lookup"><span data-stu-id="7458b-551">For SQL Server the NTFS block size for VHDs containing SQL Server data and log files should be 64K.</span></span> <span data-ttu-id="7458b-552">不需要將 D:\ 磁碟機格式化。</span><span class="sxs-lookup"><span data-stu-id="7458b-552">There is no need to format the D:\ drive.</span></span> <span data-ttu-id="7458b-553">此磁碟機已預先格式化。</span><span class="sxs-lookup"><span data-stu-id="7458b-553">This drive comes pre-formatted.</span></span>

<span data-ttu-id="7458b-554">若要確定還原或建立資料庫不會藉由清空檔案的內容來初始化資料檔，您應該確定 SQL Server 服務執行所在的使用者內容具有特定的權限。</span><span class="sxs-lookup"><span data-stu-id="7458b-554">In order to make sure that the restore or creation of databases is not initializing the data files by zeroing the content of the files, one should make sure that the user context the SQL Server service is running in has a certain permission.</span></span> <span data-ttu-id="7458b-555">通常，Windows 系統管理員群組中的使用者會擁有這些權限。</span><span class="sxs-lookup"><span data-stu-id="7458b-555">Usually users in the Windows Administrator group have these permissions.</span></span> <span data-ttu-id="7458b-556">在非 Windows 系統管理員使用者的使用者內容中執行 SQL Server 服務時，您需要為該使用者指派「執行磁碟區維護工作」的使用者權限。</span><span class="sxs-lookup"><span data-stu-id="7458b-556">If the SQL Server service is run in the user context of non-Windows Administrator user, you need to assign that user the User Right ‘Perform volume maintenance tasks’.</span></span>  <span data-ttu-id="7458b-557">請參閱這篇「Microsoft 知識庫文章」中的詳細資料︰<https://support.microsoft.com/kb/2574695></span><span class="sxs-lookup"><span data-stu-id="7458b-557">See the details in this Microsoft Knowledge Base Article: <https://support.microsoft.com/kb/2574695></span></span>

#### <a name="impact-of-database-compression"></a><span data-ttu-id="7458b-558">資料庫壓縮的影響</span><span class="sxs-lookup"><span data-stu-id="7458b-558">Impact of database compression</span></span>
<span data-ttu-id="7458b-559">在 I/O 頻寬可能變成限制因素的組態中，減少 IOPS 的每個量值可能都有助於延展您可以在類似 Azure 的 IaaS 案例中執行的工作負載。</span><span class="sxs-lookup"><span data-stu-id="7458b-559">In configurations where I/O bandwidth can become a limiting factor, every measure which reduces IOPS might help to stretch the workload one can run in an IaaS scenario like Azure.</span></span> <span data-ttu-id="7458b-560">因此，如果尚未這麼做，SAP 和 Microsoft 強烈建議您套用 SQL Server 頁面壓縮，然後再將現有的 SAP 資料庫上傳至 Azure。</span><span class="sxs-lookup"><span data-stu-id="7458b-560">Therefore, if not yet done, applying SQL Server PAGE compression is strongly recommended by both SAP and Microsoft before uploading an existing SAP databases to Azure.</span></span>

<span data-ttu-id="7458b-561">在上傳至 Azure 之前執行資料庫壓縮的建議是出自下列兩項因素︰</span><span class="sxs-lookup"><span data-stu-id="7458b-561">The recommendation to perform Database Compression before uploading to Azure is given out of two reasons:</span></span>

* <span data-ttu-id="7458b-562">降低要上傳的資料量。</span><span class="sxs-lookup"><span data-stu-id="7458b-562">The amount of data to be uploaded is lower.</span></span>
* <span data-ttu-id="7458b-563">假設您可以使用功能更強大的硬體，其在內部部署中使用更多 CPU 或更高 I/O 頻寬或更少 I/O 延遲，則執行壓縮的持續時間較短。</span><span class="sxs-lookup"><span data-stu-id="7458b-563">The duration of the compression execution is shorter assuming that one can use stronger hardware with more CPUs or higher I/O bandwidth or less I/O latency on-premises.</span></span>
* <span data-ttu-id="7458b-564">較小的資料庫大小可能會使磁碟配置的成本降低</span><span class="sxs-lookup"><span data-stu-id="7458b-564">Smaller database sizes might lead to less costs for disk allocation</span></span>

<span data-ttu-id="7458b-565">資料庫壓縮也可以在 Azure 虛擬機器中運作，如同它在內部部署中的運作方式。</span><span class="sxs-lookup"><span data-stu-id="7458b-565">Database compression works as well in an Azure Virtual Machines as it does on-premises.</span></span> <span data-ttu-id="7458b-566">如需有關如何壓縮現有 SAP SQL Server 資料庫的更多詳細資料，請參閱︰<https://blogs.msdn.com/b/saponsqlserver/archive/2010/10/08/compressing-an-sap-database-using-report-msscompress.aspx></span><span class="sxs-lookup"><span data-stu-id="7458b-566">For more details on how to compress an existing SAP SQL Server database please check here: <https://blogs.msdn.com/b/saponsqlserver/archive/2010/10/08/compressing-an-sap-database-using-report-msscompress.aspx></span></span>

### <a name="sql-server-2014--storing-database-files-directly-on-azure-blog-storage"></a><span data-ttu-id="7458b-567">SQL Server 2014 – 將資料庫檔案直接儲存於 Azure Blog 儲存體上</span><span class="sxs-lookup"><span data-stu-id="7458b-567">SQL Server 2014 – Storing Database Files directly on Azure Blog Storage</span></span>
<span data-ttu-id="7458b-568">SQL Server 2014 開放將資料庫檔案直接儲存於 Azure Blob 儲存體上的可能性，而不需在其周圍使用 VHD 的「包裝函式」。</span><span class="sxs-lookup"><span data-stu-id="7458b-568">SQL Server 2014 opens the possibility to store database files directly on Azure Blob Store without the ‘wrapper’ of a VHD around them.</span></span> <span data-ttu-id="7458b-569">特別是在使用標準 Azure 儲存體或較小的 VM 類型時，這讓您可以在其中克服 IOPS 的限制，此限制是透過可以掛接到某些較小型 VM 類型的有限 VHD 數目來強制執行。</span><span class="sxs-lookup"><span data-stu-id="7458b-569">Especially with using Standard Azure Storage or smaller VM types this enables scenarios where you can overcome the limits of IOPS that would be enforced by a limited number of VHDs that can be mounted to some smaller VM types.</span></span> <span data-ttu-id="7458b-570">不過，這適用於 SQL Server 的使用者資料庫，而不適用於系統資料庫。</span><span class="sxs-lookup"><span data-stu-id="7458b-570">This works for user databases however not for system databases of SQL Server.</span></span> <span data-ttu-id="7458b-571">這也適用於 SQL server 的資料和記錄檔。</span><span class="sxs-lookup"><span data-stu-id="7458b-571">It also works for data and log files of SQL Server.</span></span> <span data-ttu-id="7458b-572">如果您想要使用此方式部署 SAP SQL Server 資料庫，而不是將它「包裝」到 VHD，請記住下列資訊︰</span><span class="sxs-lookup"><span data-stu-id="7458b-572">If you’d like to deploy a SAP SQL Server database this way instead of ‘wrapping’ it into VHDs, please keep the following in mind:</span></span>

* <span data-ttu-id="7458b-573">所使用之儲存體帳戶所在的 Azure 區域必須與用來部署 SQL Server 執行所在之 VM 的相同。</span><span class="sxs-lookup"><span data-stu-id="7458b-573">The Storage Account used needs to be in the same Azure Region as the one that is used to deploy the VM SQL Server is running in.</span></span>
* <span data-ttu-id="7458b-574">稍早列出關於將 VHD 分散到不同 Azure 儲存體帳戶的考量也適用於這種部署方法。</span><span class="sxs-lookup"><span data-stu-id="7458b-574">Considerations listed earlier in regards to distribute VHDs over different Azure Storage Accounts apply for this method of deployments as well.</span></span> <span data-ttu-id="7458b-575">表示對 Azure 儲存體帳戶限制的 I/O 作業計數。</span><span class="sxs-lookup"><span data-stu-id="7458b-575">Means the I/O operations count against the limits of the Azure Storage Account.</span></span>

<span data-ttu-id="7458b-576">[comment]: <> (MSSedusch TODO 但這將會使用網路頻寬而非儲存體頻寬，不是嗎？)</span><span class="sxs-lookup"><span data-stu-id="7458b-576">[comment]: <> (MSSedusch TODO But this will use network bandwith and not storage bandwith, doesn't it?)</span></span>

<span data-ttu-id="7458b-577">這種部署類型的詳細資料如下︰<https://msdn.microsoft.com/library/dn385720.aspx></span><span class="sxs-lookup"><span data-stu-id="7458b-577">Details about this type of deployment are listed here: <https://msdn.microsoft.com/library/dn385720.aspx></span></span>

<span data-ttu-id="7458b-578">若要將 SQL Server 資料檔直接儲存在「Azure 進階儲存體」上，您必須具備下列網址所記載的最基本 SQL Server 2014 修補程式版本： <https://support.microsoft.com/kb/3063054>。</span><span class="sxs-lookup"><span data-stu-id="7458b-578">In order to store SQL Server data files directly on Azure Premium Storage, you need to have a minimum SQL Server 2014 patch release which is documented here: <https://support.microsoft.com/kb/3063054>.</span></span> <span data-ttu-id="7458b-579">將 SQL Server 資料檔儲存於 Azure 標準儲存體上，利用 SQL Server 2014 的發行版本來運作。</span><span class="sxs-lookup"><span data-stu-id="7458b-579">Storing SQL Server data files on Azure Standard Storage does work with the released version of SQL Server 2014.</span></span> <span data-ttu-id="7458b-580">不過，相同的修補程式包含另一個系列的修正程式，其可以更可靠的方式針對 SQL Server 資料檔和備份使用 Azure Blob 儲存體。</span><span class="sxs-lookup"><span data-stu-id="7458b-580">However, the very same patches contain another series of fixes which make the direct usage of Azure Blob Storage for SQL Server data files and backups more reliable.</span></span> <span data-ttu-id="7458b-581">因此，我們通常建議使用這些修補程式。</span><span class="sxs-lookup"><span data-stu-id="7458b-581">Therefore we recommend to use these patches in general.</span></span>

### <a name="sql-server-2014-buffer-pool-extension"></a><span data-ttu-id="7458b-582">SQL Server 2014 緩衝集區延伸模組</span><span class="sxs-lookup"><span data-stu-id="7458b-582">SQL Server 2014 Buffer Pool Extension</span></span>
<span data-ttu-id="7458b-583">SQL Server 2014 引進的新功能，稱為「緩衝集區延伸模組」。</span><span class="sxs-lookup"><span data-stu-id="7458b-583">SQL Server 2014 introduced a new feature which is called Buffer Pool Extension.</span></span> <span data-ttu-id="7458b-584">此功能會延伸 SQL Server 的緩衝集區，使用第二層快取將其保留於記憶體中，此快取是透過伺服器或 VM 的本機 SSD 來支援。</span><span class="sxs-lookup"><span data-stu-id="7458b-584">This functionality extends the buffer pool of SQL Server which is kept in memory with a second level cache that is backed by local SSDs of a server or VM.</span></span> <span data-ttu-id="7458b-585">這可在「記憶體內部」保留更大型的資料工作集。</span><span class="sxs-lookup"><span data-stu-id="7458b-585">This enables to keep a larger working set of data ‘in memory’.</span></span> <span data-ttu-id="7458b-586">相較於存取 Azure 標準儲存體，基於許多因素，存取儲存於 Azure VM 之本機 SSD 上的緩衝集區延伸模組的速度更快。</span><span class="sxs-lookup"><span data-stu-id="7458b-586">Compared to accessing Azure Standard Storage the access into the extension of the buffer pool which is stored on local SSDs of an Azure VM is many factors faster.</span></span>  <span data-ttu-id="7458b-587">因此，利用具有絕佳 IOPS 和輸送量之 VM 類型的本機 D:\ 磁碟機可能是一個非常合理的方式，可降低對於 Azure 儲存體的 IOPS 負載，並大幅提升查詢的回應時間。</span><span class="sxs-lookup"><span data-stu-id="7458b-587">Therefore, leveraging the local D:\ drive of the VM types that have excellent IOPS and throughput could be a very reasonable way to reduce the IOPS load against Azure Storage and improve response times of queries dramatically.</span></span> <span data-ttu-id="7458b-588">這特別適用於未使用進階儲存體時。</span><span class="sxs-lookup"><span data-stu-id="7458b-588">This applies especially when not using Premium Storage.</span></span> <span data-ttu-id="7458b-589">在進階儲存體以及使用計算節點上的進階 Azure 讀取快取中，對於資料檔的建議，和預期的沒有太大差異。</span><span class="sxs-lookup"><span data-stu-id="7458b-589">In case of Premium Storage and the usage of the Premium Azure Read Cache on the compute node, as recommended for data files, no big differences are expected.</span></span> <span data-ttu-id="7458b-590">原因在於這兩個快取 (SQL Server 緩衝集區延伸模組和進階儲存體讀取快取) 都是使用計算節點的本機磁碟。</span><span class="sxs-lookup"><span data-stu-id="7458b-590">Reason is that both caches (SQL Server Buffer Pool Extension and Premium Storage Read Cache) are using the local disks of the compute nodes.</span></span>
<span data-ttu-id="7458b-591">如需有關此功能的更多詳細資料，請參閱這份文件︰<https://msdn.microsoft.com/library/dn133176.aspx></span><span class="sxs-lookup"><span data-stu-id="7458b-591">For more details about this functionality, please check this documentation: <https://msdn.microsoft.com/library/dn133176.aspx></span></span>

### <a name="backuprecovery-considerations-for-sql-server"></a><span data-ttu-id="7458b-592">SQL Server 的備份/復原考量</span><span class="sxs-lookup"><span data-stu-id="7458b-592">Backup/Recovery considerations for SQL Server</span></span>
<span data-ttu-id="7458b-593">將 SQL Server 部署至 Azure 時，必須檢閱您的備份方法。</span><span class="sxs-lookup"><span data-stu-id="7458b-593">When deploying SQL Server into Azure your backup methodology must be reviewed.</span></span> <span data-ttu-id="7458b-594">即使系統不是生產系統，還是必須定期備份 SQL Server 所裝載的 SAP 資料庫。</span><span class="sxs-lookup"><span data-stu-id="7458b-594">Even if the system is not a productive system, the SAP database hosted by SQL Server must be backed up periodically.</span></span> <span data-ttu-id="7458b-595">由於 Azure 儲存體會保留三個映像，因此在補償儲存體損毀方面，備份現在已變得較不重要。</span><span class="sxs-lookup"><span data-stu-id="7458b-595">Since Azure Storage keeps three images, a backup is now less important in respect to compensating a storage crash.</span></span> <span data-ttu-id="7458b-596">優先維護適當備份和復原方案的原因是，您可以藉由提供時間點復原功能來補償邏輯/手動錯誤。</span><span class="sxs-lookup"><span data-stu-id="7458b-596">The priority reason for maintaining a proper backup and recovery plan is more that you can compensate for logical/manual errors by providing point in time recovery capabilities.</span></span> <span data-ttu-id="7458b-597">因此，目標是使用備份來將資料庫還原回到某個時間點，或者藉由複製現有的資料庫，在 Azure 中使用備份來植入另一個系統。</span><span class="sxs-lookup"><span data-stu-id="7458b-597">So the goal is to either use backups to restore the database back to a certain point in time or to use the backups in Azure to seed another system by copying the existing database.</span></span> <span data-ttu-id="7458b-598">例如，您可以藉由還原備份，從 2 層 SAP 組態轉移到同一個系統的 3 層系統設定。</span><span class="sxs-lookup"><span data-stu-id="7458b-598">For example, you could transfer from a 2-Tier SAP configuration to a 3-Tier system setup of the same system by restoring a backup.</span></span>

<span data-ttu-id="7458b-599">有三種不同方式可將 SQL Server 備份至 Azure 儲存體︰</span><span class="sxs-lookup"><span data-stu-id="7458b-599">There are three different ways to backup SQL Server to Azure Storage:</span></span>

1. <span data-ttu-id="7458b-600">SQL Server 2012 CU4 和更新版本可以原生方式將資料庫備份至 URL。</span><span class="sxs-lookup"><span data-stu-id="7458b-600">SQL Server 2012 CU4 and higher can natively backup databases to a URL.</span></span> <span data-ttu-id="7458b-601">下列部落格有詳細說明： [New functionality in SQL Server 2014 – Part 5 – Backup/Restore Enhancements (SQL Server 2014 的新功能 – 第 5 部分 – 備份/還原增強功能)](https://blogs.msdn.com/b/saponsqlserver/archive/2014/02/15/new-functionality-in-sql-server-2014-part-5-backup-restore-enhancements.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7458b-601">This is detailed in the blog [New functionality in SQL Server 2014 – Part 5 – Backup/Restore Enhancements](https://blogs.msdn.com/b/saponsqlserver/archive/2014/02/15/new-functionality-in-sql-server-2014-part-5-backup-restore-enhancements.aspx).</span></span> <span data-ttu-id="7458b-602">請參閱 [SQL Server 2012 SP1 CU4 和更新版本][dbms-guide-5.5.1]一章。</span><span class="sxs-lookup"><span data-stu-id="7458b-602">See chapter [SQL Server 2012 SP1 CU4 and later][dbms-guide-5.5.1].</span></span>
2. <span data-ttu-id="7458b-603">SQL 2012 CU4 之前的 SQL Server 版本可以使用重新導向功能來備份到 VHD，而且寫入串流基本上會流向已設定的 Azure 儲存體位置。</span><span class="sxs-lookup"><span data-stu-id="7458b-603">SQL Server releases prior to SQL 2012 CU4 can use a redirection functionality to backup to a VHD and basically move the write stream towards an Azure Storage location that has been configured.</span></span> <span data-ttu-id="7458b-604">請參閱 [SQL Server 2012 SP1 CU3 和舊版][dbms-guide-5.5.2]一章。</span><span class="sxs-lookup"><span data-stu-id="7458b-604">See chapter [SQL Server 2012 SP1 CU3 and earlier releases][dbms-guide-5.5.2].</span></span>
3. <span data-ttu-id="7458b-605">最後一個方法是在 VHD 磁碟裝置上執行傳統 SQL Server 備份到磁碟的命令。</span><span class="sxs-lookup"><span data-stu-id="7458b-605">The final method is to perform a conventional SQL Server backup to disk command onto a VHD disk device.</span></span>  <span data-ttu-id="7458b-606">這與內部部署模式完全相同，但不會在本文中詳細討論。</span><span class="sxs-lookup"><span data-stu-id="7458b-606">This is identical to the on-premises deployment pattern and is not discussed in detail in this document.</span></span>

#### <span data-ttu-id="7458b-607"><a name="0fef0e79-d3fe-4ae2-85af-73666a6f7268"></a>SQL Server 2012 SP1 CU4 和更新版本</span><span class="sxs-lookup"><span data-stu-id="7458b-607"><a name="0fef0e79-d3fe-4ae2-85af-73666a6f7268"></a>SQL Server 2012 SP1 CU4 and later</span></span>
<span data-ttu-id="7458b-608">此功能可讓您直接備份到 Azure BLOB 儲存體。</span><span class="sxs-lookup"><span data-stu-id="7458b-608">This functionality allows you to directly backup to Azure BLOB storage.</span></span> <span data-ttu-id="7458b-609">如果沒有這個方法，您必須備份到其他 Azure VHD，因而會耗用 VHD 和 IOPS 容量。</span><span class="sxs-lookup"><span data-stu-id="7458b-609">Without this method, you must backup to other Azure VHDs which would consume VHD and IOPS capacity.</span></span> <span data-ttu-id="7458b-610">以下為基本概念：</span><span class="sxs-lookup"><span data-stu-id="7458b-610">The idea is basically this:</span></span>

 ![使用 SQL Server 2012 備份至 Microsoft Azure 儲存體 BLOB][dbms-guide-figure-400]

<span data-ttu-id="7458b-612">此案例的優點是您不需要耗用 VHD 來儲存 SQL Server 備份。</span><span class="sxs-lookup"><span data-stu-id="7458b-612">The advantage in this case is that one doesn’t need to spend VHDs to store SQL Server backups on.</span></span> <span data-ttu-id="7458b-613">因此，所配置的 VHD 較少，而且可以針對資料和記錄檔使用 VHD IOPS 的整個頻寬。</span><span class="sxs-lookup"><span data-stu-id="7458b-613">So you have fewer VHDs allocated and the whole bandwidth of VHD IOPS can be used for data and log files.</span></span> <span data-ttu-id="7458b-614">請注意，如下列文章的＜限制＞一節所記載，備份的大小上限是 1 TB︰<https://msdn.microsoft.com/library/dn435916.aspx#limitations>。</span><span class="sxs-lookup"><span data-stu-id="7458b-614">Please note that the maximum size of a backup is limited to a maximum of 1 TB as documented in the section ‘Limitations’ in this article: <https://msdn.microsoft.com/library/dn435916.aspx#limitations>.</span></span> <span data-ttu-id="7458b-615">如果在使用「SQL Server 備份」壓縮的情況下，備份大小仍然會超過 1 TB，就需要使用本文件的 [SQL Server 2012 SP1 CU3 和舊版][dbms-guide-5.5.2]一章中所述的功能。</span><span class="sxs-lookup"><span data-stu-id="7458b-615">If the backup size, despite using SQL Server Backup compression would exceed 1 TB in size, the functionality described in chapter [SQL Server 2012 SP1 CU3 and earlier releases][dbms-guide-5.5.2] in this document needs to be used.</span></span>

<span data-ttu-id="7458b-616">描述從「Azure Blob 存放區」之備份還原資料庫的[相關文件](https://msdn.microsoft.com/library/dn449492.aspx)建議在備份大於 25 GB 的情況下，不要直接從 Azure BLOB 存放區還原。</span><span class="sxs-lookup"><span data-stu-id="7458b-616">[Related documentation](https://msdn.microsoft.com/library/dn449492.aspx) describing the restore of databases from backups against Azure Blob Store recommend not to restore directly from Azure BLOB store if the backups is >25GB.</span></span> <span data-ttu-id="7458b-617">本文中的建議只以效能考量為依據，並未將功能限制納入考量。</span><span class="sxs-lookup"><span data-stu-id="7458b-617">The recommendation in this article is simply based on performance considerations and not due to functional restrictions.</span></span> <span data-ttu-id="7458b-618">因此，隨著案例的不同，可能會發生不同的狀況。</span><span class="sxs-lookup"><span data-stu-id="7458b-618">Therefore, different conditions may apply on a case by case basis.</span></span>

<span data-ttu-id="7458b-619">如需有關如何設定和利用此備份類型的說明，請參閱 [這個](https://msdn.microsoft.com/library/dn466438.aspx) 教學課程</span><span class="sxs-lookup"><span data-stu-id="7458b-619">Documentation on how this type of backup is set up and leveraged can be found in [this](https://msdn.microsoft.com/library/dn466438.aspx) tutorial</span></span>

<span data-ttu-id="7458b-620">您可以在 [這裡](https://msdn.microsoft.com/library/dn435916.aspx)找到一系列步驟的範例。</span><span class="sxs-lookup"><span data-stu-id="7458b-620">An example of the sequence of steps can be read [here](https://msdn.microsoft.com/library/dn435916.aspx).</span></span>

<span data-ttu-id="7458b-621">自動備份，最重要的就是確定每個備份的 BLOB 都是以不同方式命名。</span><span class="sxs-lookup"><span data-stu-id="7458b-621">Automating backups, it is of highest importance to make sure that the BLOBs for each backup are named differently.</span></span> <span data-ttu-id="7458b-622">否則，它們將遭到覆寫且還原鏈會中斷。</span><span class="sxs-lookup"><span data-stu-id="7458b-622">Otherwise they will be overwritten and the restore chain is broken.</span></span>

<span data-ttu-id="7458b-623">為了避免混用這 3 種不同的備份類型，建議您在用來備份的儲存體帳戶底下建立不同的容器。</span><span class="sxs-lookup"><span data-stu-id="7458b-623">In order not to mix up things between the 3 different types of backups, it is advisable to create different containers underneath the storage account used for backups.</span></span> <span data-ttu-id="7458b-624">容器可以僅供 VM 使用，也可以供 VM 和備份類型使用。</span><span class="sxs-lookup"><span data-stu-id="7458b-624">The containers could be by VM only or by VM and Backup type.</span></span> <span data-ttu-id="7458b-625">結構描述看起來如下︰</span><span class="sxs-lookup"><span data-stu-id="7458b-625">The schema could look like:</span></span>

 ![使用 SQL Server 2012 備份至 Microsoft Azure 儲存體 BLOB – 個別儲存體帳戶中的不同容器][dbms-guide-figure-500]

<span data-ttu-id="7458b-627">在上述範例中，備份不會執行到部署 VM 的相同儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7458b-627">In the example above, the backups would not be performed into the same storage account where the VMs are deployed.</span></span> <span data-ttu-id="7458b-628">有專用於備份的新儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7458b-628">There would be a new storage account specifically for the backups.</span></span> <span data-ttu-id="7458b-629">在儲存體帳戶內，會有使用備份類型和 VM 名稱的組合所建立的不同容器。</span><span class="sxs-lookup"><span data-stu-id="7458b-629">Within the storage accounts, there would be different containers created with a matrix of the type of backup and the VM name.</span></span> <span data-ttu-id="7458b-630">這種細分方式將可讓您輕鬆地管理不同 VM 的備份。</span><span class="sxs-lookup"><span data-stu-id="7458b-630">Such segmentation will make it easier to administrate the backups of the different VMs.</span></span>

<span data-ttu-id="7458b-631">直接寫入備份的 BLOB，不會納入 VM 的 VHD 計數。</span><span class="sxs-lookup"><span data-stu-id="7458b-631">The BLOBs one directly writes the backups to, are not adding to the count of the VHDs of a VM.</span></span> <span data-ttu-id="7458b-632">因此，您可以將適用於資料和交易記錄檔之特定 VM SKU 且已掛接的 VHD 數目上限最大化，並且仍能針對儲存體容器執行備份。</span><span class="sxs-lookup"><span data-stu-id="7458b-632">Hence one could maximize the maximum of VHDs mounted of the specific VM SKU for the data and transaction log file and still execute a backup against a storage container.</span></span>

#### <span data-ttu-id="7458b-633"><a name="f9071eff-9d72-4f47-9da4-1852d782087b"></a>SQL Server 2012 SP1 CU3 和舊版</span><span class="sxs-lookup"><span data-stu-id="7458b-633"><a name="f9071eff-9d72-4f47-9da4-1852d782087b"></a>SQL Server 2012 SP1 CU3 and earlier releases</span></span>
<span data-ttu-id="7458b-634">若要直接封存「Azure 儲存體」的備份，您必須執行的第一個步驟就是下載連結到 [這篇](https://www.microsoft.com/download/details.aspx?id=40740) KBA 文章的 msi。</span><span class="sxs-lookup"><span data-stu-id="7458b-634">The first step you must perform in order to achieve a backup directly against Azure Storage would be to download the msi which is linked to [this](https://www.microsoft.com/download/details.aspx?id=40740) KBA article.</span></span>

<span data-ttu-id="7458b-635">下載 x64 安裝檔案和文件。</span><span class="sxs-lookup"><span data-stu-id="7458b-635">Download the x64 installation file and the documentation.</span></span> <span data-ttu-id="7458b-636">此檔案將會安裝下列程式：‘Microsoft SQL Server Backup to Microsoft Azure Tool’。</span><span class="sxs-lookup"><span data-stu-id="7458b-636">The file will install a program called: ‘Microsoft SQL Server Backup to Microsoft Azure Tool’.</span></span> <span data-ttu-id="7458b-637">請仔細閱讀產品文件。</span><span class="sxs-lookup"><span data-stu-id="7458b-637">Read the documentation of the product thoroughly.</span></span>  <span data-ttu-id="7458b-638">此工具基本上會以下列方式運作︰</span><span class="sxs-lookup"><span data-stu-id="7458b-638">The tool basically works in the following way:</span></span>

* <span data-ttu-id="7458b-639">從 SQL Server 端，定義 SQL Server 備份的磁碟位置 (請勿針對此工具使用 D:\ 磁碟機)。</span><span class="sxs-lookup"><span data-stu-id="7458b-639">From the SQL Server side, a disk location for the SQL Server backup is defined (don’t use the D:\ drive for this).</span></span>
* <span data-ttu-id="7458b-640">此工具將可讓您定義可用來將不同備份類型導向至不同 Azure 儲存體容器的規則。</span><span class="sxs-lookup"><span data-stu-id="7458b-640">The tool will allow you to define rules which can be used to direct different types of backups to different Azure Storage containers.</span></span>
* <span data-ttu-id="7458b-641">一旦規則準備就緒，此工具就會將備份的寫入串流重新導向至稍早定義之 Azure 儲存體位置的其中一個 VHD/磁碟。</span><span class="sxs-lookup"><span data-stu-id="7458b-641">Once the rules are in place, the tool will redirect the write stream of the backup to one of the VHDs/disks to the Azure Storage location which was defined earlier.</span></span>
* <span data-ttu-id="7458b-642">此工具將會在針對 SQL Server 備份定義的 VHD/磁碟上，保留數個 KB 大小的小型 stub 檔案。</span><span class="sxs-lookup"><span data-stu-id="7458b-642">The tool will leave a small stub file of a few KB size on the VHD/Disk which was defined for the SQL Server backup.</span></span> <span data-ttu-id="7458b-643">**此檔案應該保留在儲存體位置上，因為它需要再次從 Azure 儲存體還原。**</span><span class="sxs-lookup"><span data-stu-id="7458b-643">**This file should be left on the storage location since it is required to restore again from Azure Storage.**</span></span>
  * <span data-ttu-id="7458b-644">如果您遺失了 stub 檔案 (例如，因為遺失了包含 stub 檔案的儲存媒體)，而您選擇了備份到 Microsoft Azure 儲存體帳戶，則您可能會透過 Microsoft Azure 儲存體，從放置 stub 檔案的儲存體容器中下載它，藉以復原該檔案。</span><span class="sxs-lookup"><span data-stu-id="7458b-644">If you have lost the stub file (e.g. through loss of the storage media that contained the stub file) and you have chosen the option of backing up to a Microsoft Azure Storage account, you may recover the stub file through Microsoft Azure Storage by downloading it from the storage container in which it was placed.</span></span> <span data-ttu-id="7458b-645">接著，如果加密會與原始規則搭配使用，則您應該將 stub 檔案放置於本機電腦上的資料夾中，並已在其中設定此工具，使用相同的加密密碼來偵測並上傳至同一個容器。</span><span class="sxs-lookup"><span data-stu-id="7458b-645">You should then place the stub file into a folder on the local machine where the Tool is configured to detect and upload to the same container with the same encryption password if encryption was used with the original rule.</span></span>

<span data-ttu-id="7458b-646">這表示上述適用於較新版 SQL Server 的結構描述也適用於不允許直接處理 Azure 儲存體位置的 SQL Server 版本。</span><span class="sxs-lookup"><span data-stu-id="7458b-646">This means the schema as described above for more recent releases of SQL Server can be put in place as well for SQL Server releases which are not allowing direct address an Azure Storage location.</span></span>

<span data-ttu-id="7458b-647">此方法不應與較新版的 SQL Server 搭配使用，這些版本支援以原生方式備份 Azure 儲存體。</span><span class="sxs-lookup"><span data-stu-id="7458b-647">This method should not be used with more recent SQL Server releases which support backing up natively against Azure Storage.</span></span> <span data-ttu-id="7458b-648">例外狀況是對 Azure 的原生備份限制會封鎖對 Azure 執行原生備份。</span><span class="sxs-lookup"><span data-stu-id="7458b-648">Exceptions are where limitations of the native backup into Azure are blocking native backup execution into Azure.</span></span>

#### <a name="other-possibilities-to-backup-sql-server-databases"></a><span data-ttu-id="7458b-649">備份 SQL Server 資料庫的其他可能性</span><span class="sxs-lookup"><span data-stu-id="7458b-649">Other possibilities to backup SQL Server databases</span></span>
<span data-ttu-id="7458b-650">備份資料庫的其他可能性是將其他 VHD 連結到您用來儲存備份的 VM。</span><span class="sxs-lookup"><span data-stu-id="7458b-650">Other possibilities to backup databases is to attach additional VHDs to a VM that you use to store backups on.</span></span> <span data-ttu-id="7458b-651">在這種情況下，您必須確認 VHD 並未完整執行。</span><span class="sxs-lookup"><span data-stu-id="7458b-651">In such a case you would need to make sure that the VHDs are not running full.</span></span> <span data-ttu-id="7458b-652">如果是這種情況，您必須取消掛接 VHD，也就是所謂的「封存」它，然後使用新的空白 VHD 來取代它。</span><span class="sxs-lookup"><span data-stu-id="7458b-652">If that is the case, you would need to unmount the VHD and so to speak ‘archive’ it and replace it with a new empty VHD.</span></span> <span data-ttu-id="7458b-653">如果您執行此動作，就會想要將這些 VHD 保留於個別的 Azure 儲存體帳戶中 (不同於具有含資料庫檔案之 VHD 的帳戶)。</span><span class="sxs-lookup"><span data-stu-id="7458b-653">If you go down that path, you want to keep these VHDs in separate Azure Storage Accounts from the ones that the VHDs with the database files.</span></span>

<span data-ttu-id="7458b-654">第二種可能性是使用可以連接許多 VHD 的大型 VM。</span><span class="sxs-lookup"><span data-stu-id="7458b-654">A second possibility is to use a large VM that can have many VHDs attached.</span></span> <span data-ttu-id="7458b-655">例如</span><span class="sxs-lookup"><span data-stu-id="7458b-655">E.g.</span></span> <span data-ttu-id="7458b-656">有 32 個 VHD 的 D14。</span><span class="sxs-lookup"><span data-stu-id="7458b-656">D14 with 32VHDs.</span></span> <span data-ttu-id="7458b-657">使用儲存空間來建立有彈性的環境，您可以在其中建置共用，之後用來做為不同 DBMS 伺服器的備份目標。</span><span class="sxs-lookup"><span data-stu-id="7458b-657">Use Storage Spaces to build a flexible environment where you could build shares that are used then as backup targets for the different DBMS servers.</span></span>

<span data-ttu-id="7458b-658">[這裡](https://blogs.msdn.com/b/sqlcat/archive/2015/02/26/large-sql-server-database-backup-on-an-azure-vm-and-archiving.aspx) 也記載了一些最佳做法。</span><span class="sxs-lookup"><span data-stu-id="7458b-658">Some best practices got documented [here](https://blogs.msdn.com/b/sqlcat/archive/2015/02/26/large-sql-server-database-backup-on-an-azure-vm-and-archiving.aspx) as well.</span></span>

#### <a name="performance-considerations-for-backupsrestores"></a><span data-ttu-id="7458b-659">備份/還原的效能考量</span><span class="sxs-lookup"><span data-stu-id="7458b-659">Performance considerations for backups/restores</span></span>
<span data-ttu-id="7458b-660">如同裸機部署，備份/還原效能取決於可以平行讀取的磁碟區數目，以及這些磁碟區可能的輸送量。</span><span class="sxs-lookup"><span data-stu-id="7458b-660">As in bare-metal deployments, backup/restore performance is dependent on how many volumes can be read in parallel and what the throughput of those volumes might be.</span></span> <span data-ttu-id="7458b-661">此外，備份壓縮所使用的 CPU 耗用量可能會在最多只有 8 個 CPU 執行緒的 VM 上扮演重要的角色。</span><span class="sxs-lookup"><span data-stu-id="7458b-661">In addition, the CPU consumption used by backup compression may play a significant role on VMs with just up to 8 CPU threads.</span></span> <span data-ttu-id="7458b-662">因此，您可以假設︰</span><span class="sxs-lookup"><span data-stu-id="7458b-662">Therefore, one can assume:</span></span>

* <span data-ttu-id="7458b-663">用來儲存資料檔的 VHD 數目越少，讀取的整體輸送量就越小。</span><span class="sxs-lookup"><span data-stu-id="7458b-663">The fewer the number of VHDs used to store the data files, the smaller the overall throughput in reading.</span></span>
* <span data-ttu-id="7458b-664">VM 中 CPU 執行緒數目越小，備份壓縮的影響就越嚴重。</span><span class="sxs-lookup"><span data-stu-id="7458b-664">The smaller the number of CPU threads in the VM, the more severe the impact of backup compression.</span></span>
* <span data-ttu-id="7458b-665">要寫入備份的目標 (BLOB 或 VHD) 越少，輸送量就越低。</span><span class="sxs-lookup"><span data-stu-id="7458b-665">The fewer targets (BLOBs or VHDs) to write the backup to, the lesser the throughput.</span></span>
* <span data-ttu-id="7458b-666">VM 大小越小，從 Azure 儲存體寫入和讀取的儲存體輸送量配額就越小。</span><span class="sxs-lookup"><span data-stu-id="7458b-666">The smaller the VM size, the smaller the storage throughput quota writing and reading from Azure Storage.</span></span> <span data-ttu-id="7458b-667">無關於是否要將備份直接儲存於 Azure Blob 上，或者是否要將它們儲存在再次儲存於 Azure Blob 的 VHD 上。</span><span class="sxs-lookup"><span data-stu-id="7458b-667">Independent of whether the backups are directly stored on Azure Blob or whether they are stored in VHDs that again are stored in Azure Blobs.</span></span>

<span data-ttu-id="7458b-668">在較新版本中使用 Microsoft Azure 儲存體 BLOB 做為備份目標時，您就只能針對每個特定備份指定一個 URL 目標。</span><span class="sxs-lookup"><span data-stu-id="7458b-668">When using a Microsoft Azure Storage BLOB as the backup target in more recent releases, you are restricted to designating only one URL target for each specific backup.</span></span>

<span data-ttu-id="7458b-669">但是，在舊版中使用 ‘Microsoft SQL Server Backup to Microsoft Azure Tool’ 時，您可以定義多個檔案目標。</span><span class="sxs-lookup"><span data-stu-id="7458b-669">But when using the ‘Microsoft SQL Server Backup to Microsoft Azure Tool’ in older releases, you can define more than one file target.</span></span> <span data-ttu-id="7458b-670">使用多個目標，就可以調整備份且備份的輸送量會更高。</span><span class="sxs-lookup"><span data-stu-id="7458b-670">With more than one target, the backup can scale and the throughput of the backup is higher.</span></span> <span data-ttu-id="7458b-671">這接著也會在 Azure 儲存體帳戶中產生多個檔案。</span><span class="sxs-lookup"><span data-stu-id="7458b-671">This would result then in multiple files as well in the Azure Storage account.</span></span> <span data-ttu-id="7458b-672">在我們的測試中，使用多個檔案目的地，絕對可以達到輸送量，而您可以藉由從 SQL Server 2012 SP1 CU4 實作備份延伸模組來達成。</span><span class="sxs-lookup"><span data-stu-id="7458b-672">In our testing, using multiple file destinations one can definitely achieve the throughput which one could achieve with the backup extensions implemented in from SQL Server 2012 SP1 CU4 on.</span></span> <span data-ttu-id="7458b-673">您也不會遭到 1 TB 限制所封鎖，就像在 Azure 的原生備份一樣。</span><span class="sxs-lookup"><span data-stu-id="7458b-673">You also are not blocked by the 1TB limit as in the native backup into Azure.</span></span>

<span data-ttu-id="7458b-674">不過，請記住，輸送量也會取決於您用來備份的 Azure 儲存體帳戶位置。</span><span class="sxs-lookup"><span data-stu-id="7458b-674">However, keep in mind, the throughput also is dependent on the location of the Azure Storage Account you use for the backup.</span></span> <span data-ttu-id="7458b-675">最好是將儲存體帳戶放置於執行 VM 以外的不同區域中。</span><span class="sxs-lookup"><span data-stu-id="7458b-675">An idea might be to locate the storage account in a different region than the VMs are running in.</span></span> <span data-ttu-id="7458b-676">例如</span><span class="sxs-lookup"><span data-stu-id="7458b-676">E.g.</span></span> <span data-ttu-id="7458b-677">您在西歐執行 VM 組態，但將您用來備份的儲存體帳戶放在北歐。</span><span class="sxs-lookup"><span data-stu-id="7458b-677">you would run the VM configuration in West-Europe, but put the Storage Account that you use to back up against in North-Europe.</span></span> <span data-ttu-id="7458b-678">這當然會對備份輸送量產生影響，而且很可能不會產生每秒 150MB 的輸送量，因為看似會發生目標儲存體和 VM在同一個區域資料中心內執行的情況。</span><span class="sxs-lookup"><span data-stu-id="7458b-678">That certainly will have impact on the backup throughput and is not likely to generate a throughput of 150MB/sec as it seems to be possible in cases where the target storage and the VMs are running in the same regional datacenter.</span></span>

#### <a name="managing-backup-blobs"></a><span data-ttu-id="7458b-679">管理備份 BLOB</span><span class="sxs-lookup"><span data-stu-id="7458b-679">Managing Backup BLOBs</span></span>
<span data-ttu-id="7458b-680">若要自行管理備份，有一個需求。</span><span class="sxs-lookup"><span data-stu-id="7458b-680">There is a requirement to manage the backups on your own.</span></span> <span data-ttu-id="7458b-681">由於經常執行交易記錄備份將會建立多個 Blob 是預期狀況，所以，這些 Blob 的系統管理員很容易就會使 Azure 入口網站過度負載。</span><span class="sxs-lookup"><span data-stu-id="7458b-681">Since the expectation is that many blobs will be created by executing frequent transaction log backups, administration of those blobs easily can overburden the Azure Portal.</span></span> <span data-ttu-id="7458b-682">因此，建議使用 Azure 儲存體總管。</span><span class="sxs-lookup"><span data-stu-id="7458b-682">Therefore, it is recommendable to leverage a Azure Storage Explorer.</span></span> <span data-ttu-id="7458b-683">有數個好工具可用來協助管理 Azure 儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="7458b-683">There are several good ones available which can help to manage an Azure storage account</span></span>

* <span data-ttu-id="7458b-684">安裝 Azure SDK 的 Microsoft Visual Studio (<https://azure.microsoft.com/downloads/>)</span><span class="sxs-lookup"><span data-stu-id="7458b-684">Microsoft Visual Studio with Azure SDK installed (<https://azure.microsoft.com/downloads/>)</span></span>
* <span data-ttu-id="7458b-685">Microsoft Azure 儲存體總管 (<https://azure.microsoft.com/downloads/>)</span><span class="sxs-lookup"><span data-stu-id="7458b-685">Microsoft Azure Storage Explorer (<https://azure.microsoft.com/downloads/>)</span></span>
* <span data-ttu-id="7458b-686">協力廠商工具</span><span class="sxs-lookup"><span data-stu-id="7458b-686">3rd party tools</span></span>

<span data-ttu-id="7458b-687">[comment]: <> (在 ARM 上尚不支援)</span><span class="sxs-lookup"><span data-stu-id="7458b-687">[comment]: <> (Not yet supported on ARM)</span></span>
<span data-ttu-id="7458b-688">[comment]: <> (#### Azure VM 備份)</span><span class="sxs-lookup"><span data-stu-id="7458b-688">[comment]: <> (#### Azure VM backup)</span></span>
<span data-ttu-id="7458b-689">[comment]: <> (SAP 系統內的 VM 可以使用「Azure 虛擬機器備份」功能來進行備份。Azure 虛擬機器備份是在 2015 年初所引進，也就是目前在 Azure 中備份完整 VM 的標準方法。「Azure 備份」會將備份儲存在 Azure 中，並允許再次還原 VM。)</span><span class="sxs-lookup"><span data-stu-id="7458b-689">[comment]: <> (VMs within the SAP system can be backed up using Azure Virtual Machine Backup functionality. Azure Virtual Machine Backup got introduced early in the year 2015 and meanwhile is a standard method to backup a complete VM in Azure. Azure Backup stores the backups in Azure and allows a restore of a VM again.)</span></span>
<span data-ttu-id="7458b-690">[comment]: <> (如果 DBMS 系統支援 Windows VSS (磁碟區陰影複製) 服務 <https://msdn.microsoft.com/library/windows/desktop/bb968832.aspx> 就像 SQL Server 一樣，則也可以用一致的方式備份執行資料庫的 VM。因此，使用 Azure VM 備份，可能是取得 SAP 資料庫可還原備份的方法。不過請注意，您無法以資料庫的 Azure VM 備份還原時間點為基礎。因此，建議您使用 DBMS 功能來執行資料庫的備份，而不要依賴「Azure VM 備份」。)</span><span class="sxs-lookup"><span data-stu-id="7458b-690">[comment]: <> (VMs that run databases can be backed up in a consistent manner as well if the DBMS systems supports the Windows VSS Volume Shadow Copy Service <https://msdn.microsoft.com/library/windows/desktop/bb968832.aspx> as SQL Server does. So using Azure VM backup could be a way to get to a restorable backup of a SAP database. However, be aware that based on Azure VM backups point-in-time restores of databases is not possible. Therefore, the recommendation is to perform backups of databases with DBMS functionality instead of relying on Azure VM Backup.)</span></span>
<span data-ttu-id="7458b-691">[comment]: <> (若要熟悉「Azure 虛擬機器備份」，請從這裡開始著手：<https://azure.microsoft.com/documentation/services/backup/>)</span><span class="sxs-lookup"><span data-stu-id="7458b-691">[comment]: <> (To get familiar with Azure Virtual Machine Backup please start here <https://azure.microsoft.com/documentation/services/backup/>)</span></span>

### <span data-ttu-id="7458b-692"><a name="1b353e38-21b3-4310-aeb6-a77e7c8e81c8"></a>使用來自 Microsoft Azure Marketplace 的 SQL Server 映像</span><span class="sxs-lookup"><span data-stu-id="7458b-692"><a name="1b353e38-21b3-4310-aeb6-a77e7c8e81c8"></a>Using a SQL Server images out of the Microsoft Azure Marketplace</span></span>
<span data-ttu-id="7458b-693">Microsoft 在 Azure Marketplace 中提供已經包含 SQL Server 版本的 VM。</span><span class="sxs-lookup"><span data-stu-id="7458b-693">Microsoft offers VMs in the Azure Marketplace which already contain versions of SQL Server.</span></span> <span data-ttu-id="7458b-694">對於需要 SQL Server 和 Windows 授權的 SAP 客戶，這可能是透過組織已安裝 SQL Server 的 VM，大致涵蓋授權需求的機會。</span><span class="sxs-lookup"><span data-stu-id="7458b-694">For SAP customers who require licenses for SQL Server and Windows, this might be an opportunity to basically cover the need for licenses by spinning up VMs with SQL Server already installed.</span></span> <span data-ttu-id="7458b-695">若要針對 SAP 使用這類映像，必須進行下列考量︰</span><span class="sxs-lookup"><span data-stu-id="7458b-695">In order to use such images for SAP, the following considerations need to be made:</span></span>

* <span data-ttu-id="7458b-696">SQL Server 非評估版本的取得成本高於只從 Azure Marketplace 部署的「僅限 Windows」VM。</span><span class="sxs-lookup"><span data-stu-id="7458b-696">The SQL Server non-Evaluation versions acquire higher costs than just a ‘Windows-only’ VM deployed from Azure Marketplace.</span></span> <span data-ttu-id="7458b-697">請參閱下列文章來比較價格︰<https://azure.microsoft.com/pricing/details/virtual-machines/> 和 <https://azure.microsoft.com/pricing/details/virtual-machines/#Sql>。</span><span class="sxs-lookup"><span data-stu-id="7458b-697">Please see these articles to compare prices: <https://azure.microsoft.com/pricing/details/virtual-machines/> and <https://azure.microsoft.com/pricing/details/virtual-machines/#Sql>.</span></span>
* <span data-ttu-id="7458b-698">您只能使用 SAP 支援的 SQL Server 版本，例如 SQL Server 2012。</span><span class="sxs-lookup"><span data-stu-id="7458b-698">You only can use SQL Server releases which are supported by SAP, like SQL Server 2012.</span></span>
* <span data-ttu-id="7458b-699">安裝於 Azure Marketplace 中提供之 VM 上的 SQL Server 執行個體定序，並不是 SAP NetWeaver 要求執行之 SQL Server 執行個體的定序。</span><span class="sxs-lookup"><span data-stu-id="7458b-699">The collation of the SQL Server instance which is installed in the VMs offered in the Azure Marketplace is not the collation SAP NetWeaver requires the SQL Server instance to run.</span></span> <span data-ttu-id="7458b-700">不過您可以利用下一節的指示來變更定序。</span><span class="sxs-lookup"><span data-stu-id="7458b-700">You can change the collation though with the directions in the following section.</span></span>

#### <a name="changing-the-sql-server-collation-of-a-microsoft-windowssql-server-vm"></a><span data-ttu-id="7458b-701">變更 Microsoft Windows/SQL Server VM 的 SQL Server 定序</span><span class="sxs-lookup"><span data-stu-id="7458b-701">Changing the SQL Server Collation of a Microsoft Windows/SQL Server VM</span></span>
<span data-ttu-id="7458b-702">因為 Azure Marketplace 中的 SQL Server 映像不是設定來使用 SAP NetWeaver 應用程式所需的定序，所以需要在部署之後立即變更。</span><span class="sxs-lookup"><span data-stu-id="7458b-702">Since the SQL Server images in the Azure Marketplace are not set up to use the collation which is required by SAP NetWeaver applications, it needs to be changed immediately after the deployment.</span></span> <span data-ttu-id="7458b-703">針對 SQL Server 2012，一旦部署 VM 且系統管理員能夠登入已部署的 VM 之後，就能夠使用下列步驟來完成此動作：</span><span class="sxs-lookup"><span data-stu-id="7458b-703">For SQL Server 2012, this can be done with the following steps as soon as the VM has been deployed and an administrator is able to log into the deployed VM:</span></span>

* <span data-ttu-id="7458b-704">以「系統管理員身分」開啟 Windows 命令視窗。</span><span class="sxs-lookup"><span data-stu-id="7458b-704">Open a Windows Command Window ‘as administrator’.</span></span>
* <span data-ttu-id="7458b-705">將目錄變更為 C:\Program Files\Microsoft SQL Server\110\Setup Bootstrap\SQLServer2012。</span><span class="sxs-lookup"><span data-stu-id="7458b-705">Change the directory to C:\Program Files\Microsoft SQL Server\110\Setup Bootstrap\SQLServer2012.</span></span>
* <span data-ttu-id="7458b-706">執行命令︰Setup.exe /QUIET /ACTION=REBUILDDATABASE /INSTANCENAME=MSSQLSERVER /SQLSYSADMINACCOUNTS=`<local_admin_account_name`> /SQLCOLLATION=SQL_Latin1_General_Cp850_BIN2</span><span class="sxs-lookup"><span data-stu-id="7458b-706">Execute the command: Setup.exe /QUIET /ACTION=REBUILDDATABASE /INSTANCENAME=MSSQLSERVER /SQLSYSADMINACCOUNTS=`<local_admin_account_name`> /SQLCOLLATION=SQL_Latin1_General_Cp850_BIN2</span></span>   
  * <span data-ttu-id="7458b-707">`<local_admin_account_name`> 是第一次透過資源庫部署 VM 時定義為系統管理員帳戶的帳戶。</span><span class="sxs-lookup"><span data-stu-id="7458b-707">`<local_admin_account_name`> is the account which was defined as the administrator account when deploying the VM for the first time through the gallery.</span></span>

<span data-ttu-id="7458b-708">此程序應該只需要幾分鐘的時間。</span><span class="sxs-lookup"><span data-stu-id="7458b-708">The process should only take a few minutes.</span></span> <span data-ttu-id="7458b-709">若要確定此步驟最終是否會有正確的結果，請執行下列步驟：</span><span class="sxs-lookup"><span data-stu-id="7458b-709">In order to make sure whether the step ended up with the correct result, please perform the following steps:</span></span>

* <span data-ttu-id="7458b-710">開啟 SQL Server Management Studio。</span><span class="sxs-lookup"><span data-stu-id="7458b-710">Open SQL Server Management Studio.</span></span>
* <span data-ttu-id="7458b-711">開啟查詢視窗。</span><span class="sxs-lookup"><span data-stu-id="7458b-711">Open a Query Window.</span></span>
* <span data-ttu-id="7458b-712">在 SQL Server master 資料庫中，執行 sp_helpsort 命令。</span><span class="sxs-lookup"><span data-stu-id="7458b-712">Execute the command sp_helpsort in the SQL Server master database.</span></span>

<span data-ttu-id="7458b-713">所需的結果應該看起來如下：</span><span class="sxs-lookup"><span data-stu-id="7458b-713">The desired result should look like:</span></span>

    Latin1-General, binary code point comparison sort for Unicode Data, SQL Server Sort Order 40 on Code Page 850 for non-Unicode Data

<span data-ttu-id="7458b-714">如果這不是結果，請停止部署 SAP，並調查為什麼安裝命令並未如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="7458b-714">If this is not the result, STOP deploying SAP and investigate why the setup command did not work as expected.</span></span> <span data-ttu-id="7458b-715">「不」  支援將 SAP NetWeaver 應用程式部署到 SQL Server 字碼頁與上述提及之字碼頁不同的 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="7458b-715">Deployment of SAP NetWeaver applications onto SQL Server instance with different SQL Server codepages than the one mentioned above is **NOT** supported.</span></span>

### <a name="sql-server-high-availability-for-sap-in-azure"></a><span data-ttu-id="7458b-716">SQL Server 在 Azure 中適用於 SAP 的高可用性</span><span class="sxs-lookup"><span data-stu-id="7458b-716">SQL Server High-Availability for SAP in Azure</span></span>
<span data-ttu-id="7458b-717">如本文稍早所述，您無法建立使用最舊 SQL Server 高可用性功能所需的共用儲存體。</span><span class="sxs-lookup"><span data-stu-id="7458b-717">As mentioned earlier in this paper, there is no possibility to create shared storage which is necessary for the usage of the oldest SQL Server high availability functionality.</span></span> <span data-ttu-id="7458b-718">此功能會在 Windows Server 容錯移轉叢集 (WSFC) 中針對使用者資料庫 (以及最終的 tempdb) 使用共用磁碟，來安裝兩個以上的 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="7458b-718">This functionality would install two or more SQL Server instances in a Windows Server Failover Cluster (WSFC) using a shared disk for the user databases (and eventually tempdb).</span></span> <span data-ttu-id="7458b-719">這是 SAP 也支援的長期標準高可用性方法。</span><span class="sxs-lookup"><span data-stu-id="7458b-719">This is the long time standard high availability method which also is supported by SAP.</span></span> <span data-ttu-id="7458b-720">由於 Azure 不支援共用儲存體，所以無法實現具有共用磁碟叢集組態的 SQL Server 高可用性組態。</span><span class="sxs-lookup"><span data-stu-id="7458b-720">Because Azure doesn’t support shared storage, SQL Server high availability configurations with a shared disk cluster configuration cannot be realized.</span></span> <span data-ttu-id="7458b-721">不過，仍有許多其他高可用性方法，如下列各節所述。</span><span class="sxs-lookup"><span data-stu-id="7458b-721">However, many other high availability methods are still possible and are described in the following sections.</span></span>

<span data-ttu-id="7458b-722">[comment]: <> (文件仍然是與 ASM 相關)</span><span class="sxs-lookup"><span data-stu-id="7458b-722">[comment]: <> (Article is still refering to ASM)</span></span>
<span data-ttu-id="7458b-723">[comment]: <> (閱讀可針對 Azure 中 SQL Server 使用的各種不同特定高可用性技術之前，[這裡][virtual-machines-sql-server-high-availability-and-disaster-recovery-solutions]有一份非常好的文件，當中提供更多的詳細資料和指標)</span><span class="sxs-lookup"><span data-stu-id="7458b-723">[comment]: <> (Before reading the different specific high availability technologies usable for SQL Server in Azure, there is a very good document which gives more details and pointers [here][virtual-machines-sql-server-high-availability-and-disaster-recovery-solutions])</span></span>

#### <a name="sql-server-log-shipping"></a><span data-ttu-id="7458b-724">SQL Server 記錄傳送</span><span class="sxs-lookup"><span data-stu-id="7458b-724">SQL Server Log Shipping</span></span>
<span data-ttu-id="7458b-725">高可用性 (HA) 的方法之一是 SQL Server 記錄傳送。</span><span class="sxs-lookup"><span data-stu-id="7458b-725">One of the methods of high availability (HA) is SQL Server Log Shipping.</span></span> <span data-ttu-id="7458b-726">如果參與 HA 組態的 VM 具有運作中的名稱解析，就不會發生問題，而 Azure 中的設定與內部部署中完成的任何設定並無任何差別。</span><span class="sxs-lookup"><span data-stu-id="7458b-726">If the VMs participating in the HA configuration have working name resolution, there is no problem and the setup in Azure will not differ from any setup that is done on-premises.</span></span> <span data-ttu-id="7458b-727">不建議只依賴 IP 解析。</span><span class="sxs-lookup"><span data-stu-id="7458b-727">It is not recommended to rely on IP resolution only.</span></span> <span data-ttu-id="7458b-728">如需設定記錄傳送和記錄傳送原則的相關事宜，請參閱這份文件︰</span><span class="sxs-lookup"><span data-stu-id="7458b-728">In regards to setting up Log Shipping and the principles around Log Shipping please check this documentation:</span></span>

<span data-ttu-id="7458b-729"><https://technet.microsoft.com/library/ms187103.aspx></span><span class="sxs-lookup"><span data-stu-id="7458b-729"><https://technet.microsoft.com/library/ms187103.aspx></span></span>

<span data-ttu-id="7458b-730">為了實際達成任何高可用性，您需要部署位於這類記錄傳送組態內的 VM，使其位於相同的 Azure 可用性設定組內。</span><span class="sxs-lookup"><span data-stu-id="7458b-730">In order to really achieve any high availability, one needs to deploy the VMs which are within such a Log Shipping configuration to be within the same Azure Availability Set.</span></span>

#### <a name="database-mirroring"></a><span data-ttu-id="7458b-731">資料庫鏡像</span><span class="sxs-lookup"><span data-stu-id="7458b-731">Database Mirroring</span></span>
<span data-ttu-id="7458b-732">SAP 支援的「資料庫鏡像」(請參閱 SAP 附註 [965908]) 有賴於在 SAP 連接字串中定義容錯移轉夥伴。</span><span class="sxs-lookup"><span data-stu-id="7458b-732">Database Mirroring as supported by SAP (see SAP Note [965908]) relies on defining a failover partner in the SAP connection string.</span></span> <span data-ttu-id="7458b-733">針對跨單位案例，我們假設這兩個 VM 位於相同網域，且這兩個 SQL Server 執行個體執行所在的使用者內容也是網域使用者，而且在所涉及的這兩個 SQL Server 執行個體中具備足夠的權限。</span><span class="sxs-lookup"><span data-stu-id="7458b-733">For the Cross-Premises cases, we assume that the two VMs are in the same domain and that the user context the two SQL Server instances are running under are domain users as well and have sufficient privileges in the two SQL Server instances involved.</span></span> <span data-ttu-id="7458b-734">因此，在 Azure 中設定資料庫鏡像，在一般內部部署設定/組態之間並無任何差別。</span><span class="sxs-lookup"><span data-stu-id="7458b-734">Therefore, the setup of Database Mirroring in Azure does not differ between a typical on-premises setup/configuration.</span></span>

<span data-ttu-id="7458b-735">至於僅限雲端的部署，最簡單的方式是在 Azure 中設定另一個網域，以便讓這些 DBMS VM (最好專屬於 SAP VM) 位於一個網域。</span><span class="sxs-lookup"><span data-stu-id="7458b-735">As of Cloud-Only deployments, the easiest method is to have another domain setup in Azure to have those DBMS VMs (and ideally dedicated SAP VMs) within one domain.</span></span>

<span data-ttu-id="7458b-736">如果網域不可行，您也可以如以下網址所述，針對資料庫鏡像端點使用憑證︰<https://technet.microsoft.com/library/ms191477.aspx></span><span class="sxs-lookup"><span data-stu-id="7458b-736">If a domain is not possible, one can also use certificates for the database mirroring endpoints as described here: <https://technet.microsoft.com/library/ms191477.aspx></span></span>

<span data-ttu-id="7458b-737">在 Azure 中設定資料庫鏡像的教學課程可在下列網址中找到︰<https://technet.microsoft.com/library/ms189852.aspx></span><span class="sxs-lookup"><span data-stu-id="7458b-737">A tutorial to set-up Database Mirroring in Azure can be found here: <https://technet.microsoft.com/library/ms189852.aspx></span></span>

#### <a name="alwayson"></a><span data-ttu-id="7458b-738">AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="7458b-738">AlwaysOn</span></span>
<span data-ttu-id="7458b-739">由於針對內部部署的 SAP 支援 AlwaysOn (請參閱 SAP 附註 [1772688])，因此支援將它與 Azure 中的 SAP 搭配使用。</span><span class="sxs-lookup"><span data-stu-id="7458b-739">As AlwaysOn is supported for SAP on-premises (see SAP Note [1772688]), it is supported to be used in combination with SAP in Azure.</span></span> <span data-ttu-id="7458b-740">事實上，您無法在 Azure 中建立共用磁碟，但這不表示您無法在不同 VM 之間建立 AlwaysOn Windows Server 容錯移轉叢集 (WSFC) 組態。</span><span class="sxs-lookup"><span data-stu-id="7458b-740">The fact that you are not able to create shared disks in Azure doesn’t mean that one can’t create an AlwaysOn Windows Server Failover Cluster (WSFC) configuration between different VMs.</span></span> <span data-ttu-id="7458b-741">這只表示您不能在叢集組態中使用共用磁碟做為仲裁。</span><span class="sxs-lookup"><span data-stu-id="7458b-741">It only means that you do not have the possibility to use a shared disk as a quorum in the cluster configuration.</span></span> <span data-ttu-id="7458b-742">因此您可以在 Azure 中建置 AlwaysOn WSFC 組態，而且不需選取利用共用磁碟的仲裁類型。</span><span class="sxs-lookup"><span data-stu-id="7458b-742">Hence you can build an AlwaysOn WSFC configuration in Azure and simply not select the quorum type that utilizes shared disk.</span></span> <span data-ttu-id="7458b-743">部署這些 VM 的 Azure 環境應該會依名稱解析 VM，而 VM 應該位於同一個網域。</span><span class="sxs-lookup"><span data-stu-id="7458b-743">The Azure environment those VMs are deployed in should resolve the VMs by name and the VMs should be in the same domain.</span></span> <span data-ttu-id="7458b-744">這適用於僅限 Azure 和跨單位部署。</span><span class="sxs-lookup"><span data-stu-id="7458b-744">This is true for Azure only and Cross-Premises deployments.</span></span> <span data-ttu-id="7458b-745">有一些關於 SQL Server 可用性群組接聽程式 (請勿與 Azure 可用性設定組混淆) 的特殊考量，因為 Azure 可能在內部部署中，所以目前不允許只建立 AD/DNS 物件。</span><span class="sxs-lookup"><span data-stu-id="7458b-745">There are some special considerations around deploying the SQL Server Availability Group Listener (not to be confused with the Azure Availability Set) since Azure at this point in time does not allow to simply create an AD/DNS object as it is possible on-premises.</span></span> <span data-ttu-id="7458b-746">因此，需要有一些不同的安裝步驟來克服 Azure 的特定行為。</span><span class="sxs-lookup"><span data-stu-id="7458b-746">Therefore, some different installation steps are necessary to overcome the specific behavior of Azure.</span></span>

<span data-ttu-id="7458b-747">以下是使用可用性群組接聽程式的一些考量︰</span><span class="sxs-lookup"><span data-stu-id="7458b-747">Some considerations using an Availability Group Listener are:</span></span>

* <span data-ttu-id="7458b-748">使用可用性群組接聽程式，只能使用 Windows Server 2012 或 Windows Server 2012 R2 做為 VM 的客體作業系統。</span><span class="sxs-lookup"><span data-stu-id="7458b-748">Using an Availability Group Listener is only possible with Windows Server 2012 or Windows Server 2012 R2 as guest OS of the VM.</span></span> <span data-ttu-id="7458b-749">針對 Windows Server 2012，您必須確定套用這個修補程式︰<https://support.microsoft.com/kb/2854082></span><span class="sxs-lookup"><span data-stu-id="7458b-749">For Windows Server 2012 you need to make sure that this patch is applied: <https://support.microsoft.com/kb/2854082></span></span>
* <span data-ttu-id="7458b-750">針對 Windows Server 2008 R2，則沒有這個修補程式，必須以和使用「資料庫鏡像」相同的方式使用 AlwaysOn，方法是在連接字串中指定容錯移轉夥伴 (透過 SAP default.pfl 參數 dbs/mss/server 來完成 – 請參閱 SAP 附註 [965908])。</span><span class="sxs-lookup"><span data-stu-id="7458b-750">For Windows Server 2008 R2 this patch does not exist and AlwaysOn would need to be used in the same manner as Database Mirroring by specifying a failover partner in the connections string (done through the SAP default.pfl parameter dbs/mss/server – see SAP Note [965908]).</span></span>
* <span data-ttu-id="7458b-751">使用可用性群組接聽程式時，資料庫 VM 需要連接到專用的負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="7458b-751">When using an Availability Group Listener, the Database VMs need to be connected to a dedicated Load Balancer.</span></span> <span data-ttu-id="7458b-752">僅限雲端部署中的名稱解析可能會要求 SAP 系統的所有 VM (應用程式伺服器、DBMS 伺服器及 (A)SCS 伺服器) 位於同一個虛擬網路，或者從 SAP 應用程式層要求維護 etc\host 檔案，以解析 SQL Server VM 的 VM 名稱。</span><span class="sxs-lookup"><span data-stu-id="7458b-752">Name resolution in Cloud-Only deployments would either require all VMs of an SAP system (application servers, DBMS server and (A)SCS server) are in the same virtual network or would require from an SAP application layer the maintenance of the etc\host file in order to get the VM names of the SQL Server VMs resolved.</span></span> <span data-ttu-id="7458b-753">為了避免 Azure 在這兩個 VM 意外關閉的情況下指派新的 IP 位址，您應該在 AlwaysOn 組態中為這些 VM 的網路介面指派靜態 IP 位址 (如需了解如何定義靜態 IP 位址，請參閱[這篇][virtual-networks-reserved-private-ip]文章)</span><span class="sxs-lookup"><span data-stu-id="7458b-753">In order to avoid that Azure is assigning new IP addresses in cases where both VMs incidentally are shutdown, one should assign static IP addresses to the network interfaces of those VMs in the AlwaysOn configuration (defining a static IP address is described in [this][virtual-networks-reserved-private-ip] article)</span></span>

<span data-ttu-id="7458b-754">[comment]: <> (舊部落格)</span><span class="sxs-lookup"><span data-stu-id="7458b-754">[comment]: <> (Old blogs)</span></span>
<span data-ttu-id="7458b-755">[comment]: <> (<https://blogs.msdn.com/b/alwaysonpro/archive/2014/08/29/recommendations-and-best-practices-when-deploying-sql-server-alwayson-availability-groups-in-windows-azure-iaas.aspx>, <https://blogs.technet.com/b/rmilne/archive/2015/07/27/how-to-set-static-ip-on-azure-vm.aspx>)</span><span class="sxs-lookup"><span data-stu-id="7458b-755">[comment]: <> (<https://blogs.msdn.com/b/alwaysonpro/archive/2014/08/29/recommendations-and-best-practices-when-deploying-sql-server-alwayson-availability-groups-in-windows-azure-iaas.aspx>, <https://blogs.technet.com/b/rmilne/archive/2015/07/27/how-to-set-static-ip-on-azure-vm.aspx>)</span></span>
* <span data-ttu-id="7458b-756">建置叢集需要指派特定 IP 位址的 WSFC 叢集組態時需要特殊的步驟，因為具有其目前功能的 Azure 會為叢集名稱指派與叢集建立所在的節點相同的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="7458b-756">There are special steps required when building the WSFC cluster configuration where the cluster needs a special IP address assigned, because Azure with its current functionality would assign the cluster name the same IP address as the node the cluster is created on.</span></span> <span data-ttu-id="7458b-757">這表示必須執行手動步驟，為叢集指派不同的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="7458b-757">This means a manual step must be performed to assign a different IP address to the cluster.</span></span>
* <span data-ttu-id="7458b-758">可用性群組接聽程式將建立於具備 TCP/IP 端點的 Azure 中，這些端點會指派給執行可用性群組之主要和次要複本的 VM。</span><span class="sxs-lookup"><span data-stu-id="7458b-758">The Availability Group Listener is going to be created in Azure with TCP/IP endpoints which are assigned to the VMs running the primary and secondary replicas of the Availability group.</span></span>
* <span data-ttu-id="7458b-759">可能需要使用 ACL 保護這些端點。</span><span class="sxs-lookup"><span data-stu-id="7458b-759">There might be a need to secure these endpoints with ACLs.</span></span>

<span data-ttu-id="7458b-760">[comment]: <> (TODO 舊部落格)</span><span class="sxs-lookup"><span data-stu-id="7458b-760">[comment]: <> (TODO old blog)</span></span>
<span data-ttu-id="7458b-761">[comment]: <> (若要了解在 Azure 上安裝 AlwaysOn 組態的詳細步驟和必要條件，最佳體驗方式就是逐步完成[這裡][virtual-machines-windows-classic-ps-sql-alwayson-availability-groups]提供的教學課程)</span><span class="sxs-lookup"><span data-stu-id="7458b-761">[comment]: <> (The detailed steps and necessities of installing an AlwaysOn configuration on Azure are best experienced when walking through the tutorial available [here][virtual-machines-windows-classic-ps-sql-alwayson-availability-groups])</span></span>
<span data-ttu-id="7458b-762">[comment]: <> (透過 Azure 資源庫 <https://blogs.technet.com/b/dataplatforminsider/archive/2014/08/25/sql-server-alwayson-offering-in-microsoft-azure-portal-gallery.aspx> 執行之預先設定的 AlwaysOn 設定)</span><span class="sxs-lookup"><span data-stu-id="7458b-762">[comment]: <> (Preconfigured AlwaysOn setup via the Azure gallery <https://blogs.technet.com/b/dataplatforminsider/archive/2014/08/25/sql-server-alwayson-offering-in-microsoft-azure-portal-gallery.aspx>)</span></span>
<span data-ttu-id="7458b-763">[comment]: <> ([這個][virtual-machines-windows-classic-ps-sql-int-listener] 教學課程提供建立「可用性群組接聽程式」的最佳說明)</span><span class="sxs-lookup"><span data-stu-id="7458b-763">[comment]: <> (Creating an Availability Group Listener is best described in [this][virtual-machines-windows-classic-ps-sql-int-listener] tutorial)</span></span>
<span data-ttu-id="7458b-764">[comment]: <> (以下提供使用 ACL 來保護網路端點的最佳說明：)</span><span class="sxs-lookup"><span data-stu-id="7458b-764">[comment]: <> (Securing network endpoints with ACLs are explained best here:)</span></span>
<span data-ttu-id="7458b-765">[comment]: <> (*    <https://michaelwasham.com/windows-azure-powershell-reference-guide/network-access-control-list-capability-in-windows-azure-powershell/>)</span><span class="sxs-lookup"><span data-stu-id="7458b-765">[comment]: <> (*    <https://michaelwasham.com/windows-azure-powershell-reference-guide/network-access-control-list-capability-in-windows-azure-powershell/>)</span></span>
<span data-ttu-id="7458b-766">[comment]: <> (*    <https://blogs.technet.com/b/heyscriptingguy/archive/2013/08/31/weekend-scripter-creating-acls-for-windows-azure-endpoints-part-1-of-2.aspx> )</span><span class="sxs-lookup"><span data-stu-id="7458b-766">[comment]: <> (*    <https://blogs.technet.com/b/heyscriptingguy/archive/2013/08/31/weekend-scripter-creating-acls-for-windows-azure-endpoints-part-1-of-2.aspx> )</span></span>
<span data-ttu-id="7458b-767">[comment]: <> (*    <https://blogs.technet.com/b/heyscriptingguy/archive/2013/09/01/weekend-scripter-creating-acls-for-windows-azure-endpoints-part-2-of-2.aspx>)  </span><span class="sxs-lookup"><span data-stu-id="7458b-767">[comment]: <> (*    <https://blogs.technet.com/b/heyscriptingguy/archive/2013/09/01/weekend-scripter-creating-acls-for-windows-azure-endpoints-part-2-of-2.aspx>)  </span></span>
<span data-ttu-id="7458b-768">[comment]: <> (*    <https://blogs.technet.com/b/heyscriptingguy/archive/2013/09/18/creating-acls-for-windows-azure-endpoints.aspx>)</span><span class="sxs-lookup"><span data-stu-id="7458b-768">[comment]: <> (*    <https://blogs.technet.com/b/heyscriptingguy/archive/2013/09/18/creating-acls-for-windows-azure-endpoints.aspx>)</span></span>

<span data-ttu-id="7458b-769">您也可以在不同的 Azure 區域上部署 SQL Server AlwaysOn 可用性群組。</span><span class="sxs-lookup"><span data-stu-id="7458b-769">It is possible to deploy a SQL Server AlwaysOn Availability Group over different Azure Regions as well.</span></span> <span data-ttu-id="7458b-770">此功能會利用 Azure VNet 對 Vnet 連接 ([更多詳細資料][virtual-networks-configure-vnet-to-vnet-connection])。</span><span class="sxs-lookup"><span data-stu-id="7458b-770">This functionality will leverage the Azure VNet-to-Vnet connectivity ([more details][virtual-networks-configure-vnet-to-vnet-connection]).</span></span>

<span data-ttu-id="7458b-771">[comment]: <> (TODO 舊部落格)</span><span class="sxs-lookup"><span data-stu-id="7458b-771">[comment]: <> (TODO old blog)</span></span>
<span data-ttu-id="7458b-772">[comment]: <> (以下提供在這類案例中設定「SQL Server AlwaysOn 可用性群組」的說明：<https://blogs.technet.com/b/dataplatforminsider/archive/2014/06/19/sql-server-alwayson-availability-groups-supported-between-microsoft-azure-regions.aspx>。)</span><span class="sxs-lookup"><span data-stu-id="7458b-772">[comment]: <> (The setup of SQL Server AlwaysOn Availability Groups in such a scenario is described here: <https://blogs.technet.com/b/dataplatforminsider/archive/2014/06/19/sql-server-alwayson-availability-groups-supported-between-microsoft-azure-regions.aspx>.)</span></span>

#### <a name="summary-on-sql-server-high-availability-in-azure"></a><span data-ttu-id="7458b-773">Azure 中 SQL Server 高可用性的摘要</span><span class="sxs-lookup"><span data-stu-id="7458b-773">Summary on SQL Server High Availability in Azure</span></span>
<span data-ttu-id="7458b-774">由於 Azure 儲存體會保護內容，因此沒有理由堅持要有熱待命映像。</span><span class="sxs-lookup"><span data-stu-id="7458b-774">Given the fact that Azure Storage is protecting the content, there is one less reason to insist on a hot-standby image.</span></span> <span data-ttu-id="7458b-775">這表示您的高可用性案例只需要在下列情況中提供保護：</span><span class="sxs-lookup"><span data-stu-id="7458b-775">This means your High Availability scenario needs to only protect against the following cases:</span></span>

* <span data-ttu-id="7458b-776">因為在 Azure 的伺服器叢集上進行維護或其他理由而導致 VM 完全無法使用</span><span class="sxs-lookup"><span data-stu-id="7458b-776">Unavailability of the VM as a whole due to maintenance on the server cluster in Azure or other reasons</span></span>
* <span data-ttu-id="7458b-777">SQL Server 執行個體中的軟體問題</span><span class="sxs-lookup"><span data-stu-id="7458b-777">Software issues in the SQL Server instance</span></span>
* <span data-ttu-id="7458b-778">防止發生資料遭到刪除而需要進行時間點復原的手動錯誤</span><span class="sxs-lookup"><span data-stu-id="7458b-778">Protecting from manual error where data gets deleted and point-in-time recovery is needed</span></span>

<span data-ttu-id="7458b-779">尋找相符的技術，您可能認為前兩個案例可以使用資料庫鏡像或 AlwaysOn 來解決，但第三個案例僅能使用記錄傳送來解決。</span><span class="sxs-lookup"><span data-stu-id="7458b-779">Looking at matching technologies one can argue that the first two cases can be covered by Database Mirroring or AlwaysOn, whereas the third case only can be covered by Log-Shipping.</span></span>

<span data-ttu-id="7458b-780">相較於資料庫鏡像，您必須利用 AlwaysOn 來平衡更複雜的 AlwaysOn 設定。</span><span class="sxs-lookup"><span data-stu-id="7458b-780">You will need to balance the more complex setup of AlwaysOn, compared to Database Mirroring, with the advantages of AlwaysOn.</span></span> <span data-ttu-id="7458b-781">以下列出這些優點︰</span><span class="sxs-lookup"><span data-stu-id="7458b-781">Those advantages can be listed like:</span></span>

* <span data-ttu-id="7458b-782">可讀取的次要複本。</span><span class="sxs-lookup"><span data-stu-id="7458b-782">Readable secondary replicas.</span></span>
* <span data-ttu-id="7458b-783">來自次要複本的備份。</span><span class="sxs-lookup"><span data-stu-id="7458b-783">Backups from secondary replicas.</span></span>
* <span data-ttu-id="7458b-784">延展性較佳。</span><span class="sxs-lookup"><span data-stu-id="7458b-784">Better scalability.</span></span>
* <span data-ttu-id="7458b-785">一個以上的次要複本。</span><span class="sxs-lookup"><span data-stu-id="7458b-785">More than one secondary replicas.</span></span>

### <span data-ttu-id="7458b-786"><a name="9053f720-6f3b-4483-904d-15dc54141e30"></a>適用於 Azure 上 SAP 的一般 SQL Server 摘要</span><span class="sxs-lookup"><span data-stu-id="7458b-786"><a name="9053f720-6f3b-4483-904d-15dc54141e30"></a>General SQL Server for SAP on Azure Summary</span></span>
<span data-ttu-id="7458b-787">本指南中提供許多建議，而我們建議您在規劃 Azure 部署之前，多次閱讀本指南。</span><span class="sxs-lookup"><span data-stu-id="7458b-787">There are many recommendations in this guide and we recommend you read it more than once before planning your Azure deployment.</span></span> <span data-ttu-id="7458b-788">但是，一般而言，請務必在 Azure 特定點上遵循前十個一般的 DBMS︰</span><span class="sxs-lookup"><span data-stu-id="7458b-788">In general, though, be sure to follow the top ten general DBMS on Azure specific points:</span></span>

<span data-ttu-id="7458b-789">[comment]: <> (2.3 輸送量比什麼更高？比一個 VHD 高？)</span><span class="sxs-lookup"><span data-stu-id="7458b-789">[comment]: <> (2.3 higher throughput than what? Than one VHD?)</span></span>
1. <span data-ttu-id="7458b-790">使用最新的 DBMS 版本 (例如 SQL Server 2014) ，其在 Azure 中最具優勢。</span><span class="sxs-lookup"><span data-stu-id="7458b-790">Use the latest DBMS release, like SQL Server 2014, that has the most advantages in Azure.</span></span> <span data-ttu-id="7458b-791">針對 SQL Server，這是 SQL Server 2012 SP1 CU4，其中包含對 Azure 儲存體進行備份的功能。</span><span class="sxs-lookup"><span data-stu-id="7458b-791">For SQL Server, this is SQL Server 2012 SP1 CU4 which would include the feature of backing up against Azure Storage.</span></span> <span data-ttu-id="7458b-792">不過，若要與 SAP 合併，我們建議至少要有 SQL Server 2014 SP1 CU1 或 SQL Server 2012 SP2 和最新的 CU。</span><span class="sxs-lookup"><span data-stu-id="7458b-792">However, in conjunction with SAP we would recommend at least SQL Server 2014 SP1 CU1 or SQL Server 2012 SP2 and the latest CU.</span></span>
2. <span data-ttu-id="7458b-793">在 Azure 中仔細規劃您的 SAP 系統架構，以平衡資料檔案配置和 Azure 限制︰</span><span class="sxs-lookup"><span data-stu-id="7458b-793">Carefully plan your SAP system landscape in Azure to balance the data file layout and Azure restrictions:</span></span>
   * <span data-ttu-id="7458b-794">不要有太多 VHD，但必須足以確保您可以連線到所需的 IOPS。</span><span class="sxs-lookup"><span data-stu-id="7458b-794">Don’t have too many VHDs, but have enough to ensure you can reach your required IOPS.</span></span>
   * <span data-ttu-id="7458b-795">請記住，每個「Azure 儲存體帳戶」也都有 IOPS 限制，而且「儲存體帳戶」在每個 Azure 訂用帳戶內是有限的 ([更多詳細資料][azure-subscription-service-limits])。</span><span class="sxs-lookup"><span data-stu-id="7458b-795">Remember that IOPS are also limited per Azure Storage Account and that Storage Accounts are limited within each Azure subscription ([more details][azure-subscription-service-limits]).</span></span>
   * <span data-ttu-id="7458b-796">只有在您需要達到更高的輸送量時，才需在 VHD 上劃分等量磁碟區。</span><span class="sxs-lookup"><span data-stu-id="7458b-796">Only stripe across VHDs if you need to achieve a higher throughput.</span></span>
3. <span data-ttu-id="7458b-797">永遠不要在 D:\ 磁碟機上安裝軟體或放置任何需要永久保留的檔案，因為它不是永久性的，此磁碟機上的一切會在 Windows 重新開機時遺失。</span><span class="sxs-lookup"><span data-stu-id="7458b-797">Never install software or put any files that require persistence on the D:\ drive as it is non-permanent and anything on this drive will be lost at a Windows reboot.</span></span>
4. <span data-ttu-id="7458b-798">不要針對 Azure 標準儲存體使用 Azure VHD 快取。</span><span class="sxs-lookup"><span data-stu-id="7458b-798">Don’t use Azure VHD caching for Azure Standard Storage.</span></span>
5. <span data-ttu-id="7458b-799">不要使用 Azure 異地備援的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="7458b-799">Don’t use Azure geo-replicated Storage Accounts.</span></span>  <span data-ttu-id="7458b-800">針對 DBMS 工作負載使用本機備援。</span><span class="sxs-lookup"><span data-stu-id="7458b-800">Use Locally Redundant for DBMS workloads.</span></span>
6. <span data-ttu-id="7458b-801">使用 DBMS 廠商的 HA/DR 解決方案來複寫資料庫資料。</span><span class="sxs-lookup"><span data-stu-id="7458b-801">Use your DBMS vendor’s HA/DR solution to replicate database data.</span></span>
7. <span data-ttu-id="7458b-802">一律使用名稱解析，不要依賴 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="7458b-802">Always use Name Resolution, don’t rely on IP addresses.</span></span>
8. <span data-ttu-id="7458b-803">盡可能使用最高度的資料庫壓縮。</span><span class="sxs-lookup"><span data-stu-id="7458b-803">Use the highest database compression possible.</span></span> <span data-ttu-id="7458b-804">針對 SQL Server 而言，此為頁面壓縮。</span><span class="sxs-lookup"><span data-stu-id="7458b-804">For SQL Server this is page compression.</span></span>
9. <span data-ttu-id="7458b-805">請務必謹慎使用來自 Azure Marketplace 的 SQL Server 映像。</span><span class="sxs-lookup"><span data-stu-id="7458b-805">Be careful using SQL Server images from the Azure Marketplace.</span></span> <span data-ttu-id="7458b-806">如果您使用 SQL Server 的映像，就必須變更執行個體定序，才能在其上安裝任何 SAP NetWeaver 系統。</span><span class="sxs-lookup"><span data-stu-id="7458b-806">If you use the SQL Server one, you must change the instance collation before installing any SAP NetWeaver system on it.</span></span>
10. <span data-ttu-id="7458b-807">依照[部署指南][deployment-guide]所述，安裝並設定適用於 Azure 的 SAP 主機監視功能。</span><span class="sxs-lookup"><span data-stu-id="7458b-807">Install and configure the SAP Host Monitoring for Azure as described in [Deployment Guide][deployment-guide].</span></span>

## <a name="specifics-to-sap-ase-on-windows"></a><span data-ttu-id="7458b-808">Windows 上 SAP ASE 專屬的詳細資料</span><span class="sxs-lookup"><span data-stu-id="7458b-808">Specifics to SAP ASE on Windows</span></span>
<span data-ttu-id="7458b-809">從 Microsoft Azure 開始，您就能輕易地將現有的 SAP ASE 應用程式移轉至 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="7458b-809">Starting with Microsoft Azure, you can easily migrate your existing SAP ASE applications to Azure Virtual Machines.</span></span> <span data-ttu-id="7458b-810">虛擬機器中的 SAP ASE 可讓您輕鬆地將這些應用程式移轉到 Microsoft Azure，藉以減少部署、管理和維護企業級應用程式的擁有權總成本。</span><span class="sxs-lookup"><span data-stu-id="7458b-810">SAP ASE in a Virtual Machine enables you to reduce the total cost of ownership of deployment, management and maintenance of enterprise breadth applications by easily migrating these applications to Microsoft Azure.</span></span> <span data-ttu-id="7458b-811">透過 Azure 虛擬機器中的 SAP ASE，系統管理員和開發人員仍然可以使用可在內部部署使用的相同開發和管理工具。</span><span class="sxs-lookup"><span data-stu-id="7458b-811">With SAP ASE in an Azure Virtual Machine, administrators and developers can still use the same development and administration tools that are available on-premises.</span></span>

<span data-ttu-id="7458b-812">有 Azure 虛擬機器的 SLA，可以在下列位置中找到：<https://azure.microsoft.com/support/legal/sla></span><span class="sxs-lookup"><span data-stu-id="7458b-812">There is an SLA for the Azure Virtual Machines which can be found here: <https://azure.microsoft.com/support/legal/sla></span></span>

<span data-ttu-id="7458b-813">相較於其他公用雲端虛擬化產品，我們確信 Microsoft Azure 裝載的虛擬機器將執行得非常順利，但產生的個別結果可能不同。</span><span class="sxs-lookup"><span data-stu-id="7458b-813">We are confident that Microsoft Azure hosted Virtual Machines will perform very well in comparison to other public cloud virtualization offerings, but individual results may vary.</span></span> <span data-ttu-id="7458b-814">如需不同 SAP 認證之 VM SKU 的 SAP 大小調整 SAPS 數目，請參閱個別的 SAP 附註 [1928533]。</span><span class="sxs-lookup"><span data-stu-id="7458b-814">SAP sizing SAPS numbers of the different SAP certified VM SKUs will be provided in a separate SAP Note [1928533].</span></span>

<span data-ttu-id="7458b-815">關於 Azure 儲存體使用方式、部署 SAP VM 或 SAP 監視的陳述與建議適用於搭配 SAP 應用程式來部署 SAP ASE，如本文件前四章所述。</span><span class="sxs-lookup"><span data-stu-id="7458b-815">Statements and recommendations in regard to the usage of Azure Storage, Deployment of SAP VMs or SAP Monitoring apply to deployments of SAP ASE in conjunction with SAP applications as stated throughout the first four chapters of this document.</span></span>

### <a name="sap-ase-version-support"></a><span data-ttu-id="7458b-816">SAP ASE 版本支援</span><span class="sxs-lookup"><span data-stu-id="7458b-816">SAP ASE Version Support</span></span>
<span data-ttu-id="7458b-817">SAP 目前支援 SAP ASE 版本 16.0，可與 SAP 商務套件產品搭配使用。</span><span class="sxs-lookup"><span data-stu-id="7458b-817">SAP currently supports SAP ASE version 16.0 for use with SAP Business Suite products.</span></span> <span data-ttu-id="7458b-818">不論是適用於 SAP ASE 伺服器的所有更新，還是要與「SAP 商務套件」產品搭配使用的 JDBC 和 ODBC 驅動程式，都只會透過 SAP Service Marketplace 來提供，網址：<https://support.sap.com/swdc>。</span><span class="sxs-lookup"><span data-stu-id="7458b-818">All updates for SAP ASE server, or JDBC and ODBC drivers to be used with SAP Business Suite products are provided solely through the SAP Service Marketplace at: <https://support.sap.com/swdc>.</span></span>

<span data-ttu-id="7458b-819">如同內部部署安裝，不要直接從 Sybase 網站下載適用於 SAP ASE 伺服器或適用於 JDBC 和 ODBC 驅動程式的更新。</span><span class="sxs-lookup"><span data-stu-id="7458b-819">As for installations on-premises, do not download updates for the SAP ASE server, or for the JDBC and ODBC drivers directly from Sybase websites.</span></span> <span data-ttu-id="7458b-820">如需在內部部署和 Azure 虛擬機器中支援與 SAP 商務套件產品搭配使用之修補程式的詳細資訊，請參閱下列 SAP 附註：</span><span class="sxs-lookup"><span data-stu-id="7458b-820">For detailed information on patches which are supported for use with SAP Business Suite products on-premises and in Azure Virtual Machines see the following SAP Notes:</span></span>

* <span data-ttu-id="7458b-821">[1590719]</span><span class="sxs-lookup"><span data-stu-id="7458b-821">[1590719]</span></span>
* <span data-ttu-id="7458b-822">[1973241]</span><span class="sxs-lookup"><span data-stu-id="7458b-822">[1973241]</span></span>

<span data-ttu-id="7458b-823">如需有關在 SAP ASE 上執行「SAP 商務套件」的一般資訊，請參閱 [SCN](https://scn.sap.com/community/ase)</span><span class="sxs-lookup"><span data-stu-id="7458b-823">General information on running SAP Business Suite on SAP ASE can be found in the [SCN](https://scn.sap.com/community/ase)</span></span>

### <a name="sap-ase-configuration-guidelines-for-sap-related-sap-ase-installations-in-azure-vms"></a><span data-ttu-id="7458b-824">在 Azure VM 中安裝 SAP 相關之 SAP ASE 的 SAP ASE 組態指導方針</span><span class="sxs-lookup"><span data-stu-id="7458b-824">SAP ASE Configuration Guidelines for SAP related SAP ASE Installations in Azure VMs</span></span>
#### <a name="structure-of-the-sap-ase-deployment"></a><span data-ttu-id="7458b-825">SAP ASE 部署結構</span><span class="sxs-lookup"><span data-stu-id="7458b-825">Structure of the SAP ASE Deployment</span></span>
<span data-ttu-id="7458b-826">根據一般的描述，SAP ASE 可執行檔應該位於或安裝於 VM 基底 VHD 的系統磁碟機 (磁碟機 c:\)。</span><span class="sxs-lookup"><span data-stu-id="7458b-826">In accordance with the general description, SAP ASE executables should be located or installed into the system drive of the VM’s base VHD (drive c:\).</span></span> <span data-ttu-id="7458b-827">通常，SAP NetWeaver 工作負載在運用大部分的 SAP ASE 系統和工具資料庫時並不會很費力。</span><span class="sxs-lookup"><span data-stu-id="7458b-827">Typically, most of the SAP ASE system and tools databases are not really leveraged hard by SAP NetWeaver workload.</span></span> <span data-ttu-id="7458b-828">因此，系統和工具資料庫 (master、model、saptools、sybmgmtdb、sybsystemdb) 也可以保留於 C:\ 磁碟機上。</span><span class="sxs-lookup"><span data-stu-id="7458b-828">Hence the system and tools databases (master, model, saptools, sybmgmtdb, sybsystemdb) can remain on the C:\drive as well.</span></span>

<span data-ttu-id="7458b-829">有一個例外狀況可能是暫存資料庫包含 SAP ASE 建立的所有工作資料表和暫存資料表，萬一某些 SAP ERP 和所有 BW 工作負載可能要求更高的資料量或 I/O 作業量，而其無法符合原始 VM 的基底 VH (磁碟機 c:\)，就會發生此情況。</span><span class="sxs-lookup"><span data-stu-id="7458b-829">An exception could be the temporary database containing all work tables and temporary tables created by SAP ASE, which in case of some SAP ERP and all BW workloads might require either higher data volume or I/O operations volume which can’t fit into the original VM’s base VHD (drive c:\).</span></span>

<span data-ttu-id="7458b-830">根據用來安裝系統的 SAPInst/SWPM 版本，資料庫可能包含︰</span><span class="sxs-lookup"><span data-stu-id="7458b-830">Depending on the version of SAPInst/SWPM used to install the system, the database might contain:</span></span>

* <span data-ttu-id="7458b-831">安裝 SAP ASE 時建立單一的 SAP ASE tempdb</span><span class="sxs-lookup"><span data-stu-id="7458b-831">A single SAP ASE tempdb which is created when installing SAP ASE</span></span>
* <span data-ttu-id="7458b-832">安裝 SAP ASE 時建立的 SAP ASE tempdb，以及 SAP 安裝常式所建立的其他 saptempdb</span><span class="sxs-lookup"><span data-stu-id="7458b-832">An SAP ASE tempdb created by installing SAP ASE and an additional saptempdb created by the SAP installation routine</span></span>
* <span data-ttu-id="7458b-833">透過安裝 SAP ASE 來建立的 SAP ASE tempdb，以及手動建立 (例如依照 SAP 附註 [1752266]) 來符合 ERP/BW 特定 tempdb 需求的其他 tempdb</span><span class="sxs-lookup"><span data-stu-id="7458b-833">An SAP ASE tempdb created by installing SAP ASE and an additional tempdb that has been created manually (e.g. following SAP Note [1752266]) to meet ERP/BW specific tempdb requirements</span></span>

<span data-ttu-id="7458b-834">特定的 ERP 或所有 BW 工作量 native-push，則很合理，方面將 tempdb 的裝置 （SWPM 或手動） 此外建立 tempdb 以外 C:\ 磁碟機上的效能。</span><span class="sxs-lookup"><span data-stu-id="7458b-834">In case of specific ERP or all BW workloads it makes sense, in regard to performance, to keep the tempdb devices of the additionally created tempdb (by SWPM or manually) on a drive other than C:\.</span></span> <span data-ttu-id="7458b-835">如果沒有其他 tempdb 存在，則建議您建立一個 (SAP 附註 [1752266])。</span><span class="sxs-lookup"><span data-stu-id="7458b-835">If no additional tempdb exists it is recommended to create one (SAP Note [1752266]).</span></span>

<span data-ttu-id="7458b-836">針對這類系統，應該針對另外建立的 tempdb 執行下列步驟︰</span><span class="sxs-lookup"><span data-stu-id="7458b-836">For such systems the following steps should be performed for the additionally created tempdb:</span></span>

* <span data-ttu-id="7458b-837">將第一個 tempdb 裝置移至 SAP 資料庫的第一個裝置</span><span class="sxs-lookup"><span data-stu-id="7458b-837">Move the first tempdb device to the first device of the SAP database</span></span>
* <span data-ttu-id="7458b-838">將 tempdb 裝置新增至每個包含 SAP 資料庫裝置的 VHD</span><span class="sxs-lookup"><span data-stu-id="7458b-838">Add tempdb devices to each of the VHDs containing a devices of the SAP database</span></span>

<span data-ttu-id="7458b-839">這個組態讓 tempdb 所耗用的空間比系統磁碟機能夠提供的還多。</span><span class="sxs-lookup"><span data-stu-id="7458b-839">This configuration enables tempdb to either consume more space than the system drive is able to provide.</span></span> <span data-ttu-id="7458b-840">做為參考，您可以在內部部署執行的現有系統上檢查 tempdb 裝置的大小。</span><span class="sxs-lookup"><span data-stu-id="7458b-840">As a reference one can check the tempdb device sizes on existing systems which run on-premises.</span></span> <span data-ttu-id="7458b-841">或者，這類組態可針對無法使用系統磁碟機來提供的 tempdb 啟用 IOPS 數目。</span><span class="sxs-lookup"><span data-stu-id="7458b-841">Or such a configuration would enable IOPS numbers against tempdb which cannot be provided with the system drive.</span></span> <span data-ttu-id="7458b-842">再次提醒，內部部署執行的系統可以用來監視 tempdb 的 I/O 工作負載。</span><span class="sxs-lookup"><span data-stu-id="7458b-842">Again systems that are running on-premises can be used to monitor I/O workload against tempdb.</span></span>

<span data-ttu-id="7458b-843">永遠不要將任何 SAP ASE 裝置放入 VM 的 D:\ 磁碟機。</span><span class="sxs-lookup"><span data-stu-id="7458b-843">Never put any SAP ASE devices onto the D:\ drive of the VM.</span></span> <span data-ttu-id="7458b-844">這也適用於 tempdb，即使 tempdb 中保留的物件只是暫時性的。</span><span class="sxs-lookup"><span data-stu-id="7458b-844">This also applies to the tempdb, even if the objects kept in the tempdb are only temporary.</span></span>

#### <a name="impact-of-database-compression"></a><span data-ttu-id="7458b-845">資料庫壓縮的影響</span><span class="sxs-lookup"><span data-stu-id="7458b-845">Impact of Database Compression</span></span>
<span data-ttu-id="7458b-846">在 I/O 頻寬可能變成限制因素的組態中，減少 IOPS 的每個量值可能都有助於延展您可以在類似 Azure 的 IaaS 案例中執行的工作負載。</span><span class="sxs-lookup"><span data-stu-id="7458b-846">In configurations where I/O bandwidth can become a limiting factor, every measure which reduces IOPS might help to stretch the workload one can run in an IaaS scenario like Azure.</span></span> <span data-ttu-id="7458b-847">因此，強烈建議您在將現有的 SAP 資料庫上傳至 Azure 之前，確定已使用 SAP ASE 壓縮。</span><span class="sxs-lookup"><span data-stu-id="7458b-847">Therefore, it is strongly recommended to make sure that SAP ASE compression is used before uploading an existing SAP database to Azure.</span></span>

<span data-ttu-id="7458b-848">建議在上傳至 Azure 之前執行壓縮，如果尚未實作，可能是因為下列數種因素所導致：</span><span class="sxs-lookup"><span data-stu-id="7458b-848">The recommendation to perform compression before uploading to Azure if it is not already implemented is given out of several reasons:</span></span>

* <span data-ttu-id="7458b-849">降低要上傳至 Azure 的資料量</span><span class="sxs-lookup"><span data-stu-id="7458b-849">The amount of data to be uploaded to Azure is lower</span></span>
* <span data-ttu-id="7458b-850">假設您可以使用功能更強大的硬體，其在內部部署中使用更多 CPU 或更高 I/O 頻寬或更少 I/O 延遲，則執行壓縮的持續時間較短</span><span class="sxs-lookup"><span data-stu-id="7458b-850">The duration of the compression execution is shorter assuming that one can use stronger hardware with more CPUs or higher I/O bandwidth or less I/O latency on-premises</span></span>
* <span data-ttu-id="7458b-851">較小的資料庫大小可能會使磁碟配置的成本降低</span><span class="sxs-lookup"><span data-stu-id="7458b-851">Smaller database sizes might lead to less costs for disk allocation</span></span>

<span data-ttu-id="7458b-852">資料壓縮和 LOB 壓縮可以在 Azure 虛擬機器上裝載的 VM 中運作，如同它在內部部署中的運作方式。</span><span class="sxs-lookup"><span data-stu-id="7458b-852">Data- and LOB-Compression work in a VM hosted in Azure Virtual Machines as it does on-premises.</span></span> <span data-ttu-id="7458b-853">如需有關如何檢查在現有 SAP ASE 資料庫中是否已經使用壓縮的更多詳細資料，請參閱 SAP 附註 [1750510]。</span><span class="sxs-lookup"><span data-stu-id="7458b-853">For more details on how to check if compression is already in use in an existing SAP ASE database please check SAP Note [1750510].</span></span>

#### <a name="using-dbacockpit-to-monitor-database-instances"></a><span data-ttu-id="7458b-854">使用 DBACockpit 監視資料庫執行個體</span><span class="sxs-lookup"><span data-stu-id="7458b-854">Using DBACockpit to monitor Database Instances</span></span>
<span data-ttu-id="7458b-855">針對使用 SAP ASE 做為資料庫平台的 SAP 系統，可以存取 DBACockpit 做為交易 DBACockpit 中內嵌的瀏覽器視窗或做為 Webdynpro。</span><span class="sxs-lookup"><span data-stu-id="7458b-855">For SAP systems which are using SAP ASE as database platform, the DBACockpit is accessible as embedded browser windows in transaction DBACockpit or as Webdynpro.</span></span> <span data-ttu-id="7458b-856">不過，監視和管理資料庫的完整功能只能在 DBACockpit 的 Webdynpro 實作中取得。</span><span class="sxs-lookup"><span data-stu-id="7458b-856">However the full functionality for monitoring and administering the database is available in the Webdynpro implementation of the DBACockpit only.</span></span>

<span data-ttu-id="7458b-857">做為內部部署系統，需要使用數個步驟，才能啟用 DBACockpit 之 Webdynpro 實作所使用的所有 SAP NetWeaver 功能。</span><span class="sxs-lookup"><span data-stu-id="7458b-857">As with on-premises systems several steps are required to enable all SAP NetWeaver functionality used by the Webdynpro implementation of the DBACockpit.</span></span> <span data-ttu-id="7458b-858">請依照 SAP 附註 [1245200] 來啟用 Webdynpro 的使用，以及產生所需的 Webdynpro。</span><span class="sxs-lookup"><span data-stu-id="7458b-858">Please follow SAP Note [1245200] to enable the usage of webdynpros and generate the required ones.</span></span> <span data-ttu-id="7458b-859">遵循上述附註中的指示時，您也可以設定網際網路通訊管理員 (icm) 以及針對 http 和 https 連線所使用的連接埠。</span><span class="sxs-lookup"><span data-stu-id="7458b-859">When following the instructions in the above notes you will also configure the Internet Communication Manager (icm) along with the ports to be used for http and https connections.</span></span> <span data-ttu-id="7458b-860">Http 的預設設定看起來如下︰</span><span class="sxs-lookup"><span data-stu-id="7458b-860">The default setting for http looks like this:</span></span>

> <span data-ttu-id="7458b-861">icm/server_port_0 = PROT=HTTP,PORT=8000,PROCTIMEOUT=600,TIMEOUT=600</span><span class="sxs-lookup"><span data-stu-id="7458b-861">icm/server_port_0 = PROT=HTTP,PORT=8000,PROCTIMEOUT=600,TIMEOUT=600</span></span>
>
> <span data-ttu-id="7458b-862">icm/server_port_1 = PROT=HTTPS,PORT=443$$,PROCTIMEOUT=600,TIMEOUT=600</span><span class="sxs-lookup"><span data-stu-id="7458b-862">icm/server_port_1 = PROT=HTTPS,PORT=443$$,PROCTIMEOUT=600,TIMEOUT=600</span></span>
>
>

<span data-ttu-id="7458b-863">而且在交易 DBACockpit 中產生的連結看起來如下︰</span><span class="sxs-lookup"><span data-stu-id="7458b-863">and the links generated in transaction DBACockpit will look similar to this:</span></span>

> <span data-ttu-id="7458b-864">https://`<fullyqualifiedhostname`>:44300/sap/bc/webdynpro/sap/dba_cockpit</span><span class="sxs-lookup"><span data-stu-id="7458b-864">https://`<fullyqualifiedhostname`>:44300/sap/bc/webdynpro/sap/dba_cockpit</span></span>
>
> <span data-ttu-id="7458b-865">http://`<fullyqualifiedhostname`>:8000/sap/bc/webdynpro/sap/dba_cockpit</span><span class="sxs-lookup"><span data-stu-id="7458b-865">http://`<fullyqualifiedhostname`>:8000/sap/bc/webdynpro/sap/dba_cockpit</span></span>
>
>

<span data-ttu-id="7458b-866">取決於裝載 SAP 系統的 Azure 虛擬機器是否以及如何透過站對站、多重網站或 ExpressRoute (跨單位部署) 來連接，您需要確定 ICM 會使用完整的主機名稱，此名稱可在您嘗試從中開啟 DBACockpit 的電腦上加以解析。</span><span class="sxs-lookup"><span data-stu-id="7458b-866">Depending on if and how the Azure Virtual Machine hosting the SAP system is connected via site-to-site, multi-site or ExpressRoute (Cross-Premises deployment) you need to make sure that ICM is using a fully qualified hostname that can be resolved on the machine where you are trying to open the DBACockpit from.</span></span> <span data-ttu-id="7458b-867">請參閱 SAP 附註 [773830] 以了解 ICM 如何根據設定檔參數決定完整的主機名稱，並於必要時明確設定 icm/host_name_full 參數。</span><span class="sxs-lookup"><span data-stu-id="7458b-867">Please see SAP Note [773830] to understand how ICM determines the fully qualified host name depending on profile parameters and set parameter icm/host_name_full explicitly if required.</span></span>

<span data-ttu-id="7458b-868">如果您在僅限雲端的案例中部署 VM，而不需要在內部部署與 Azure 之間跨單位的連線能力，您需要定義一個公用 IP 位址和一個 domainlabel。</span><span class="sxs-lookup"><span data-stu-id="7458b-868">If you deployed the VM in a Cloud-Only scenario without cross-premises connectivity between on-premises and Azure, you need to define a public IP address and a domainlabel.</span></span> <span data-ttu-id="7458b-869">然後 VM 的公用 DNS 名稱格式將看起來如下︰</span><span class="sxs-lookup"><span data-stu-id="7458b-869">The format of the public DNS name of the VM will then look like this :</span></span>

> <span data-ttu-id="7458b-870">`<custom domainlabel`>.`<azure region`>.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="7458b-870">`<custom domainlabel`>.`<azure region`>.cloudapp.azure.com</span></span>
>
>

<span data-ttu-id="7458b-871">如需有關 DNS 名稱的更多詳細資料，請參閱[這裡][virtual-machines-azurerm-versus-azuresm]。</span><span class="sxs-lookup"><span data-stu-id="7458b-871">More details related to the DNS name can be found [here][virtual-machines-azurerm-versus-azuresm].</span></span>

<span data-ttu-id="7458b-872">將 SAP 設定檔參數 icm/host_name_full 設定為 Azure VM 的 DNS 名稱，其連結看起來可能如下︰</span><span class="sxs-lookup"><span data-stu-id="7458b-872">Setting the SAP profile parameter icm/host_name_full to the DNS name of the Azure VM the link might look similar to:</span></span>

> <span data-ttu-id="7458b-873">https://mydomainlabel.westeurope.cloudapp.net:44300/sap/bc/webdynpro/sap/dba_cockpit</span><span class="sxs-lookup"><span data-stu-id="7458b-873">https://mydomainlabel.westeurope.cloudapp.net:44300/sap/bc/webdynpro/sap/dba_cockpit</span></span>
>
> <span data-ttu-id="7458b-874">http://mydomainlabel.westeurope.cloudapp.net:8000/sap/bc/webdynpro/sap/dba_cockpit</span><span class="sxs-lookup"><span data-stu-id="7458b-874">http://mydomainlabel.westeurope.cloudapp.net:8000/sap/bc/webdynpro/sap/dba_cockpit</span></span>
>
>

<span data-ttu-id="7458b-875">在此情況下，您需要確定︰</span><span class="sxs-lookup"><span data-stu-id="7458b-875">In this case you need to make sure to:</span></span>

* <span data-ttu-id="7458b-876">在 Azure 入口網站中，針對用來與 ICM 通訊的 TCP/IP 連接埠，將輸入規則新增至網路安全性群組</span><span class="sxs-lookup"><span data-stu-id="7458b-876">Add Inbound rules to the Network Security Group in the Azure Portal for the TCP/IP ports used to communicate with ICM</span></span>
* <span data-ttu-id="7458b-877">針對用來與 ICM 通訊的 TCP/IP 連接埠，將輸入規則新增至 Windows 防火牆組態</span><span class="sxs-lookup"><span data-stu-id="7458b-877">Add Inbound rules to the Windows Firewall configuration for the TCP/IP ports used to communicate with the ICM</span></span>

<span data-ttu-id="7458b-878">針對自動匯入所有可用修正的功能，建議定期套用適用於您 SAP 版本的修正集合 SAP 附註︰</span><span class="sxs-lookup"><span data-stu-id="7458b-878">For an automated imported of all corrections available, it is recommended to periodically apply the correction collection SAP Note applicable to your SAP version:</span></span>

* <span data-ttu-id="7458b-879">[1558958]</span><span class="sxs-lookup"><span data-stu-id="7458b-879">[1558958]</span></span>
* <span data-ttu-id="7458b-880">[1619967]</span><span class="sxs-lookup"><span data-stu-id="7458b-880">[1619967]</span></span>
* <span data-ttu-id="7458b-881">[1882376]</span><span class="sxs-lookup"><span data-stu-id="7458b-881">[1882376]</span></span>

<span data-ttu-id="7458b-882">您可以在下列 SAP 附註中找到適用於 SAP ASE 之 DBA Cockpit 的進一步資訊︰</span><span class="sxs-lookup"><span data-stu-id="7458b-882">Further information about DBA Cockpit for SAP ASE can be found in the following SAP Notes:</span></span>

* <span data-ttu-id="7458b-883">[1605680]</span><span class="sxs-lookup"><span data-stu-id="7458b-883">[1605680]</span></span>
* <span data-ttu-id="7458b-884">[1757924]</span><span class="sxs-lookup"><span data-stu-id="7458b-884">[1757924]</span></span>
* <span data-ttu-id="7458b-885">[1757928]</span><span class="sxs-lookup"><span data-stu-id="7458b-885">[1757928]</span></span>
* <span data-ttu-id="7458b-886">[1758182]</span><span class="sxs-lookup"><span data-stu-id="7458b-886">[1758182]</span></span>
* <span data-ttu-id="7458b-887">[1758496]</span><span class="sxs-lookup"><span data-stu-id="7458b-887">[1758496]</span></span>    
* <span data-ttu-id="7458b-888">[1814258]</span><span class="sxs-lookup"><span data-stu-id="7458b-888">[1814258]</span></span>
* <span data-ttu-id="7458b-889">[1922555]</span><span class="sxs-lookup"><span data-stu-id="7458b-889">[1922555]</span></span>
* <span data-ttu-id="7458b-890">[1956005]</span><span class="sxs-lookup"><span data-stu-id="7458b-890">[1956005]</span></span>

#### <a name="backuprecovery-considerations-for-sap-ase"></a><span data-ttu-id="7458b-891">SAP ASE 的備份/復原考量</span><span class="sxs-lookup"><span data-stu-id="7458b-891">Backup/Recovery Considerations for SAP ASE</span></span>
<span data-ttu-id="7458b-892">將 SAP ASE 部署至 Azure 時，必須檢閱您的備份方法。</span><span class="sxs-lookup"><span data-stu-id="7458b-892">When deploying SAP ASE into Azure your backup methodology must be reviewed.</span></span> <span data-ttu-id="7458b-893">即使系統不是生產系統，還是必須定期備份 SAP ASE 所裝載的 SAP 資料庫。</span><span class="sxs-lookup"><span data-stu-id="7458b-893">Even if the system is not a productive system, the SAP database hosted by SAP ASE must be backed up periodically.</span></span> <span data-ttu-id="7458b-894">由於 Azure 儲存體會保留三個映像，因此在補償儲存體損毀方面，備份現在已變得較不重要。</span><span class="sxs-lookup"><span data-stu-id="7458b-894">Since Azure Storage keeps three images, a backup is now less important in respect to compensating a storage crash.</span></span> <span data-ttu-id="7458b-895">維護適當備份和還原方案的主要原因是，您可以藉由提供時間點復原功能來補償邏輯/手動錯誤。</span><span class="sxs-lookup"><span data-stu-id="7458b-895">The primary reason for maintaining a proper backup and restore plan is more that you can compensate for logical/manual errors by providing point in time recovery capabilities.</span></span> <span data-ttu-id="7458b-896">因此，目標是使用備份來將資料庫還原回到某個時間點，或者藉由複製現有的資料庫，在 Azure 中使用備份來植入另一個系統。</span><span class="sxs-lookup"><span data-stu-id="7458b-896">So the goal is to either use backups to restore the database back to a certain point in time or to use the backups in Azure to seed another system by copying the existing database.</span></span> <span data-ttu-id="7458b-897">例如，您可以藉由還原備份，從 2 層 SAP 組態轉移到同一個系統的 3 層系統設定。</span><span class="sxs-lookup"><span data-stu-id="7458b-897">For example, you could transfer from a 2-Tier SAP configuration to a 3-Tier system setup of the same system by restoring a backup.</span></span>

<span data-ttu-id="7458b-898">在 Azure 中備份和還原資料庫的運作方式，與內部部署中的運作方式一樣。</span><span class="sxs-lookup"><span data-stu-id="7458b-898">Backing up and restoring a database in Azure works the same way as it does on-premises.</span></span> <span data-ttu-id="7458b-899">請參閱 SAP 附註︰</span><span class="sxs-lookup"><span data-stu-id="7458b-899">Please see SAP Notes:</span></span>

* <span data-ttu-id="7458b-900">[1588316]</span><span class="sxs-lookup"><span data-stu-id="7458b-900">[1588316]</span></span>
* <span data-ttu-id="7458b-901">[1585981]</span><span class="sxs-lookup"><span data-stu-id="7458b-901">[1585981]</span></span>

<span data-ttu-id="7458b-902">以取得建立傾印組態和排程備份的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="7458b-902">for details on creating dump configurations and scheduling backups.</span></span> <span data-ttu-id="7458b-903">根據您的策略和需求，您可以在其中一個現有的 VHD 上將資料庫和記錄傾印設定至磁碟，或者新增其他 VHD 以供備份使用。</span><span class="sxs-lookup"><span data-stu-id="7458b-903">Depending on your strategy and needs you can configure database and log dumps to disk onto one of the existing VHDs or add an additional VHD for the backup.</span></span>  <span data-ttu-id="7458b-904">為了減少在發生錯誤時產生資料遺失的風險，建議使用 VHD (不會有任何資料庫裝置位於其中)。</span><span class="sxs-lookup"><span data-stu-id="7458b-904">To reduce the danger of data loss in case of an error it is recommended to use a VHD where no database device is located.</span></span>

<span data-ttu-id="7458b-905">除了資料壓縮與 LOB 壓縮之外，SAP ASE 也會提供備份壓縮。</span><span class="sxs-lookup"><span data-stu-id="7458b-905">Besides data- and LOB compression SAP ASE also offers backup compression.</span></span> <span data-ttu-id="7458b-906">若要讓資料庫和記錄傾印佔用較少的空間，建議使用備份壓縮。</span><span class="sxs-lookup"><span data-stu-id="7458b-906">To occupy less space with the database and log dumps it is recommended to use backup compression.</span></span> <span data-ttu-id="7458b-907">如需詳細資訊，請參閱 SAP 附註 [1588316] 。</span><span class="sxs-lookup"><span data-stu-id="7458b-907">Please see SAP Note [1588316] for more information.</span></span> <span data-ttu-id="7458b-908">如果您打算從 Azure 虛擬機器將備份或包含備份傾印的 VHD 下載至內部部署，則壓縮備份對於降低要傳輸的資料量來說也很重要。</span><span class="sxs-lookup"><span data-stu-id="7458b-908">Compressing the backup is also crucial to reduce the amount of data to be transferred if you plan to download backups or VHDs containing backup dumps from the Azure Virtual Machine to on-premises.</span></span>

<span data-ttu-id="7458b-909">請勿使用磁碟機 D:\ 做為資料庫或記錄傾印目的地。</span><span class="sxs-lookup"><span data-stu-id="7458b-909">Do not use drive D:\ as database or log dump destination.</span></span>

#### <a name="performance-considerations-for-backupsrestores"></a><span data-ttu-id="7458b-910">備份/還原的效能考量</span><span class="sxs-lookup"><span data-stu-id="7458b-910">Performance Considerations for Backups/Restores</span></span>
<span data-ttu-id="7458b-911">如同裸機部署，備份/還原效能取決於可以平行讀取的磁碟區數目，以及這些磁碟區可能的輸送量。</span><span class="sxs-lookup"><span data-stu-id="7458b-911">As in bare-metal deployments, backup/restore performance is dependent on how many volumes can be read in parallel and what the throughput of those volumes might be.</span></span> <span data-ttu-id="7458b-912">此外，備份壓縮所使用的 CPU 耗用量可能會在最多只有 8 個 CPU 執行緒的 VM 上扮演重要的角色。</span><span class="sxs-lookup"><span data-stu-id="7458b-912">In addition, the CPU consumption used by backup compression may play a significant role on VMs with just up to 8 CPU threads.</span></span> <span data-ttu-id="7458b-913">因此，您可以假設︰</span><span class="sxs-lookup"><span data-stu-id="7458b-913">Therefore, one can assume:</span></span>

* <span data-ttu-id="7458b-914">用來儲存資料庫裝置的 VHD 數目越少，讀取的整體輸送量就越小</span><span class="sxs-lookup"><span data-stu-id="7458b-914">The fewer the number of VHDs used to store the database devices, the smaller the overall throughput in reading</span></span>
* <span data-ttu-id="7458b-915">VM 中 CPU 執行緒數目越小，備份壓縮的影響就越嚴重</span><span class="sxs-lookup"><span data-stu-id="7458b-915">The smaller the number of CPU threads in the VM, the more severe the impact of backup compression</span></span>
* <span data-ttu-id="7458b-916">要寫入備份的目標 (等量目錄、VHD) 越少，輸送量就越低</span><span class="sxs-lookup"><span data-stu-id="7458b-916">The fewer targets (Stripe Directories, VHDs) to write the backup to, the lesser the throughput</span></span>

<span data-ttu-id="7458b-917">若要增加要寫入的目標數目，根據您的需求，有兩個選項可以使用/相結合：</span><span class="sxs-lookup"><span data-stu-id="7458b-917">To increase the number of targets to write to there are two options which can be used/combined depending on your needs:</span></span>

* <span data-ttu-id="7458b-918">在多個掛接的 VHD 上等量劃分備份目標磁碟區，以改善該等量磁碟區上的 IOPS 輸送量</span><span class="sxs-lookup"><span data-stu-id="7458b-918">Striping the backup target volume over multiple mounted VHDs in order to improve the IOPS throughput on that striped volume</span></span>
* <span data-ttu-id="7458b-919">在 SAP ASE 層級上建立傾印組態，該層級會使用一個以上的目標目錄來寫入傾印</span><span class="sxs-lookup"><span data-stu-id="7458b-919">Creating a dump configuration on SAP ASE level which uses more than one target directory to write the dump to</span></span>

<span data-ttu-id="7458b-920">本指南的先前內容中已討論過在多個掛接的 VHD 上等量劃分磁碟區的方式。</span><span class="sxs-lookup"><span data-stu-id="7458b-920">Striping a volume over multiple mounted VHDs has been discussed earlier in this guide.</span></span> <span data-ttu-id="7458b-921">如需有關在 SAP ASE 傾印組態中使用多個目錄的詳細資訊，請參閱 sp_config_dump 預存程序的相關文件，此預存程序可用來在 [Sybase Infocenter](http://infocenter.sybase.com/help/index.jsp) 上建立傾印組態。</span><span class="sxs-lookup"><span data-stu-id="7458b-921">For more information on using multiple directories in the SAP ASE dump configuration please refer to the documentation on Stored Procedure sp_config_dump which is used to create the dump configuration on the [Sybase Infocenter](http://infocenter.sybase.com/help/index.jsp).</span></span>

### <a name="disaster-recovery-with-azure-vms"></a><span data-ttu-id="7458b-922">使用 Azure VM 的災害復原</span><span class="sxs-lookup"><span data-stu-id="7458b-922">Disaster Recovery with Azure VMs</span></span>
#### <a name="data-replication-with-sap-sybase-replication-server"></a><span data-ttu-id="7458b-923">利用 SAP Sybase 複寫伺服器的資料複寫</span><span class="sxs-lookup"><span data-stu-id="7458b-923">Data Replication with SAP Sybase Replication Server</span></span>
<span data-ttu-id="7458b-924">利用 SAP Sybase 複寫伺服器 (SRS)，SAP ASE 可提供暖待命的解決方案，以非同步方式將資料庫交易傳輸到遠端位置。</span><span class="sxs-lookup"><span data-stu-id="7458b-924">With the SAP Sybase Replication Server (SRS) SAP ASE provides a warm standby solution to transfer database transactions to a distant location asynchronously.</span></span>

<span data-ttu-id="7458b-925">安裝及操作 SRS 也可以在 Azure 虛擬機器中裝載的 VM 上運作，就像它在內部部署的運作方式。</span><span class="sxs-lookup"><span data-stu-id="7458b-925">The installation and operation of SRS works as well functionally in a VM hosted in Azure Virtual Machine Services as it does on-premises.</span></span>

<span data-ttu-id="7458b-926">預計未來會發行透過 SAP 複寫伺服器的 ASE HADR 版本。</span><span class="sxs-lookup"><span data-stu-id="7458b-926">ASE HADR via SAP Replication Server is planned with a future release.</span></span> <span data-ttu-id="7458b-927">一旦該版本可供使用之後，就會立即進行測試並針對 Microsoft Azure 平台加以發行。</span><span class="sxs-lookup"><span data-stu-id="7458b-927">It will be tested with and released for Microsoft Azure platforms as soon as it is available.</span></span>

## <a name="specifics-to-sap-ase-on-linux"></a><span data-ttu-id="7458b-928">Linux 上 SAP ASE 專屬的詳細資料</span><span class="sxs-lookup"><span data-stu-id="7458b-928">Specifics to SAP ASE on Linux</span></span>
<span data-ttu-id="7458b-929">從 Microsoft Azure 開始，您就能輕易地將現有的 SAP ASE 應用程式移轉至 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="7458b-929">Starting with Microsoft Azure, you can easily migrate your existing SAP ASE applications to Azure Virtual Machines.</span></span> <span data-ttu-id="7458b-930">虛擬機器中的 SAP ASE 可讓您輕鬆地將這些應用程式移轉到 Microsoft Azure，藉以減少部署、管理和維護企業級應用程式的擁有權總成本。</span><span class="sxs-lookup"><span data-stu-id="7458b-930">SAP ASE in a Virtual Machine enables you to reduce the total cost of ownership of deployment, management and maintenance of enterprise breadth applications by easily migrating these applications to Microsoft Azure.</span></span> <span data-ttu-id="7458b-931">透過 Azure 虛擬機器中的 SAP ASE，系統管理員和開發人員仍然可以使用可在內部部署使用的相同開發和管理工具。</span><span class="sxs-lookup"><span data-stu-id="7458b-931">With SAP ASE in an Azure Virtual Machine, administrators and developers can still use the same development and administration tools that are available on-premises.</span></span>

<span data-ttu-id="7458b-932">若要部署 Azure VM，請務必了解官方 SLA，請參閱 <https://azure.microsoft.com/support/legal/sla></span><span class="sxs-lookup"><span data-stu-id="7458b-932">For deploying Azure VMs it's important to know the official SLAs which can be found here : <https://azure.microsoft.com/support/legal/sla></span></span>

<span data-ttu-id="7458b-933">SAP 附註 [1928533]將會提供 SAP 大小調整資訊和 SAP 認證的 VM SKU 清單。</span><span class="sxs-lookup"><span data-stu-id="7458b-933">SAP sizing information and a list of SAP certified VM SKUs will be provided in SAP Note [1928533].</span></span> <span data-ttu-id="7458b-934">Azure 虛擬機器的額外 SAP 調整大小文件可以在下列網址中找到：<http://blogs.msdn.com/b/saponsqlserver/archive/2015/06/19/how-to-size-sap-systems-running-on-azure-vms.aspx> 和 <http://blogs.msdn.com/b/saponsqlserver/archive/2015/12/01/new-white-paper-on-sizing-sap-solutions-on-azure-public-cloud.aspx></span><span class="sxs-lookup"><span data-stu-id="7458b-934">Additional SAP sizing documents for Azure Virtual machines can be found here <http://blogs.msdn.com/b/saponsqlserver/archive/2015/06/19/how-to-size-sap-systems-running-on-azure-vms.aspx> and here <http://blogs.msdn.com/b/saponsqlserver/archive/2015/12/01/new-white-paper-on-sizing-sap-solutions-on-azure-public-cloud.aspx></span></span>

<span data-ttu-id="7458b-935">關於 Azure 儲存體使用方式、部署 SAP VM 或 SAP 監視的陳述與建議適用於搭配 SAP 應用程式來部署 SAP ASE，如本文件前四章所述。</span><span class="sxs-lookup"><span data-stu-id="7458b-935">Statements and recommendations in regard to the usage of Azure Storage, Deployment of SAP VMs or SAP Monitoring apply to deployments of SAP ASE in conjunction with SAP applications as stated throughout the first four chapters of this document.</span></span>

<span data-ttu-id="7458b-936">下列這兩個 SAP 附註會提供有關 Linux 上的 ASE 以及雲端中 ASE 的通用資訊：</span><span class="sxs-lookup"><span data-stu-id="7458b-936">The following two SAP Notes include general information about ASE on Linux and ASE in the Cloud :</span></span>

* <span data-ttu-id="7458b-937">[2134316]</span><span class="sxs-lookup"><span data-stu-id="7458b-937">[2134316]</span></span>
* <span data-ttu-id="7458b-938">[1941500]</span><span class="sxs-lookup"><span data-stu-id="7458b-938">[1941500]</span></span>

### <a name="sap-ase-version-support"></a><span data-ttu-id="7458b-939">SAP ASE 版本支援</span><span class="sxs-lookup"><span data-stu-id="7458b-939">SAP ASE Version Support</span></span>
<span data-ttu-id="7458b-940">SAP 目前支援 SAP ASE 版本 16.0，可與 SAP 商務套件產品搭配使用。</span><span class="sxs-lookup"><span data-stu-id="7458b-940">SAP currently supports SAP ASE version 16.0 for use with SAP Business Suite products.</span></span> <span data-ttu-id="7458b-941">不論是適用於 SAP ASE 伺服器的所有更新，還是要與「SAP 商務套件」產品搭配使用的 JDBC 和 ODBC 驅動程式，都只會透過 SAP Service Marketplace 來提供，網址：<https://support.sap.com/swdc>。</span><span class="sxs-lookup"><span data-stu-id="7458b-941">All updates for SAP ASE server, or JDBC and ODBC drivers to be used with SAP Business Suite products are provided solely through the SAP Service Marketplace at: <https://support.sap.com/swdc>.</span></span>

<span data-ttu-id="7458b-942">如同內部部署安裝，不要直接從 Sybase 網站下載適用於 SAP ASE 伺服器或適用於 JDBC 和 ODBC 驅動程式的更新。</span><span class="sxs-lookup"><span data-stu-id="7458b-942">As for installations on-premises, do not download updates for the SAP ASE server, or for the JDBC and ODBC drivers directly from Sybase websites.</span></span> <span data-ttu-id="7458b-943">如需在內部部署和 Azure 虛擬機器中支援與 SAP 商務套件產品搭配使用之修補程式的詳細資訊，請參閱下列 SAP 附註：</span><span class="sxs-lookup"><span data-stu-id="7458b-943">For detailed information on patches which are supported for use with SAP Business Suite products on-premises and in Azure Virtual Machines see the following SAP Notes:</span></span>

* <span data-ttu-id="7458b-944">[1590719]</span><span class="sxs-lookup"><span data-stu-id="7458b-944">[1590719]</span></span>
* <span data-ttu-id="7458b-945">[1973241]</span><span class="sxs-lookup"><span data-stu-id="7458b-945">[1973241]</span></span>

<span data-ttu-id="7458b-946">如需有關在 SAP ASE 上執行「SAP 商務套件」的一般資訊，請參閱 [SCN](https://scn.sap.com/community/ase)</span><span class="sxs-lookup"><span data-stu-id="7458b-946">General information on running SAP Business Suite on SAP ASE can be found in the [SCN](https://scn.sap.com/community/ase)</span></span>

### <a name="sap-ase-configuration-guidelines-for-sap-related-sap-ase-installations-in-azure-vms"></a><span data-ttu-id="7458b-947">在 Azure VM 中安裝 SAP 相關之 SAP ASE 的 SAP ASE 組態指導方針</span><span class="sxs-lookup"><span data-stu-id="7458b-947">SAP ASE Configuration Guidelines for SAP related SAP ASE Installations in Azure VMs</span></span>
#### <a name="structure-of-the-sap-ase-deployment"></a><span data-ttu-id="7458b-948">SAP ASE 部署結構</span><span class="sxs-lookup"><span data-stu-id="7458b-948">Structure of the SAP ASE Deployment</span></span>
<span data-ttu-id="7458b-949">根據一般的描述，SAP ASE 可執行檔應該位於或安裝於 VM 的根檔案系統 ( /sybase ) 上。</span><span class="sxs-lookup"><span data-stu-id="7458b-949">In accordance with the general description, SAP ASE executables should be located or installed into the root file system of the VM ( /sybase ).</span></span> <span data-ttu-id="7458b-950">通常，SAP NetWeaver 工作負載在運用大部分的 SAP ASE 系統和工具資料庫時並不會很費力。</span><span class="sxs-lookup"><span data-stu-id="7458b-950">Typically, most of the SAP ASE system and tools databases are not really leveraged hard by SAP NetWeaver workload.</span></span> <span data-ttu-id="7458b-951">因此，系統和工具資料庫 (master、model、saptools、sybmgmtdb、sybsystemdb) 也可以保留於根檔案系統上。</span><span class="sxs-lookup"><span data-stu-id="7458b-951">Hence the system and tools databases (master, model, saptools, sybmgmtdb, sybsystemdb) can remain on the root file system as well.</span></span>

<span data-ttu-id="7458b-952">有一個例外狀況可能是暫存資料庫包含 SAP ASE 建立的所有工作資料表和暫存資料表，萬一某些 SAP ERP 和所有 BW 工作負載可能要求更高的資料量或 I/O 作業量，而其無法符合原始 VM 的作業系統磁碟，就會發生此情況。</span><span class="sxs-lookup"><span data-stu-id="7458b-952">An exception could be the temporary database containing all work tables and temporary tables created by SAP ASE, which in case of some SAP ERP and all BW workloads might require either higher data volume or I/O operations volume which can’t fit into the original VM’s OS disk.</span></span>

<span data-ttu-id="7458b-953">根據用來安裝系統的 SAPInst/SWPM 版本，資料庫可能包含︰</span><span class="sxs-lookup"><span data-stu-id="7458b-953">Depending on the version of SAPInst/SWPM used to install the system, the database might contain:</span></span>

* <span data-ttu-id="7458b-954">安裝 SAP ASE 時建立單一的 SAP ASE tempdb</span><span class="sxs-lookup"><span data-stu-id="7458b-954">A single SAP ASE tempdb which is created when installing SAP ASE</span></span>
* <span data-ttu-id="7458b-955">安裝 SAP ASE 時建立的 SAP ASE tempdb，以及 SAP 安裝常式所建立的其他 saptempdb</span><span class="sxs-lookup"><span data-stu-id="7458b-955">An SAP ASE tempdb created by installing SAP ASE and an additional saptempdb created by the SAP installation routine</span></span>
* <span data-ttu-id="7458b-956">透過安裝 SAP ASE 來建立的 SAP ASE tempdb，以及手動建立 (例如依照 SAP 附註 [1752266]) 來符合 ERP/BW 特定 tempdb 需求的其他 tempdb</span><span class="sxs-lookup"><span data-stu-id="7458b-956">An SAP ASE tempdb created by installing SAP ASE and an additional tempdb that has been created manually (e.g. following SAP Note [1752266]) to meet ERP/BW specific tempdb requirements</span></span>

<span data-ttu-id="7458b-957">萬一發生特定的 ERP 或所有 BW 工作負載，就能基於效能因素，在個別的檔案系統上保留另外建立之 tempdb (透過 SWPM 或手動) 的 tempdb 裝置，該檔案系統可以利用單一 Azure 資料磁碟或橫跨多個 Azure 資料磁碟的 Linux RAID 來表示。</span><span class="sxs-lookup"><span data-stu-id="7458b-957">In case of specific ERP or all BW workloads it makes sense, in regard to performance, to keep the tempdb devices of the additionally created tempdb (by SWPM or manually) on a separate file system which can be represented by a single Azure data disk or a Linux RAID spanning multiple Azure data disks.</span></span> <span data-ttu-id="7458b-958">如果沒有其他 tempdb 存在，則建議您建立一個 (SAP 附註 [1752266])。</span><span class="sxs-lookup"><span data-stu-id="7458b-958">If no additional tempdb exists it is recommended to create one (SAP Note [1752266]).</span></span>

<span data-ttu-id="7458b-959">針對這類系統，應該針對另外建立的 tempdb 執行下列步驟︰</span><span class="sxs-lookup"><span data-stu-id="7458b-959">For such systems the following steps should be performed for the additionally created tempdb:</span></span>

* <span data-ttu-id="7458b-960">將第一個 tempdb 目錄移至 SAP 資料庫的第一個檔案系統</span><span class="sxs-lookup"><span data-stu-id="7458b-960">Move the first tempdb directory to the first file system of the SAP database</span></span>
* <span data-ttu-id="7458b-961">將 tempdb 目錄新增至每個包含 SAP 資料庫檔案系統的 VHD</span><span class="sxs-lookup"><span data-stu-id="7458b-961">Add tempdb directories to each of the VHDs containing a filesystem of the SAP database</span></span>

<span data-ttu-id="7458b-962">這個組態讓 tempdb 所耗用的空間比系統磁碟機能夠提供的還多。</span><span class="sxs-lookup"><span data-stu-id="7458b-962">This configuration enables tempdb to either consume more space than the system drive is able to provide.</span></span> <span data-ttu-id="7458b-963">做為參考，您可以在內部部署執行的現有系統上檢查 tempdb 目錄的大小。</span><span class="sxs-lookup"><span data-stu-id="7458b-963">As a reference one can check the tempdb directory sizes on existing systems which run on-premises.</span></span> <span data-ttu-id="7458b-964">或者，這類組態可針對無法使用系統磁碟機來提供的 tempdb 啟用 IOPS 數目。</span><span class="sxs-lookup"><span data-stu-id="7458b-964">Or such a configuration would enable IOPS numbers against tempdb which cannot be provided with the system drive.</span></span> <span data-ttu-id="7458b-965">再次提醒，內部部署執行的系統可以用來監視 tempdb 的 I/O 工作負載。</span><span class="sxs-lookup"><span data-stu-id="7458b-965">Again systems that are running on-premises can be used to monitor I/O workload against tempdb.</span></span>

<span data-ttu-id="7458b-966">永遠不要將任何 SAP ASE 目錄放置於 VM 的 /mnt 或 /mnt/resource 上。</span><span class="sxs-lookup"><span data-stu-id="7458b-966">Never put any SAP ASE directories onto /mnt or /mnt/resource of the VM.</span></span> <span data-ttu-id="7458b-967">這也適用於 tempdb，即使保留於 tempdb 中的物件只是暫時性的也一樣，因為 /mnt 或 /mnt/resource 是非永續性的預設 Azure VM 暫存空間。</span><span class="sxs-lookup"><span data-stu-id="7458b-967">This also applies to the tempdb, even if the objects kept in the tempdb are only temporary because /mnt or /mnt/resource is a default Azure VM temp space which is not persistent.</span></span> <span data-ttu-id="7458b-968">如需有關 Azure VM 暫存空間的更多詳細資料，請參閱[這篇文章][virtual-machines-linux-how-to-attach-disk]</span><span class="sxs-lookup"><span data-stu-id="7458b-968">More details about the Azure VM temp space can be found in [this article][virtual-machines-linux-how-to-attach-disk]</span></span>

#### <a name="impact-of-database-compression"></a><span data-ttu-id="7458b-969">資料庫壓縮的影響</span><span class="sxs-lookup"><span data-stu-id="7458b-969">Impact of Database Compression</span></span>
<span data-ttu-id="7458b-970">在 I/O 頻寬可能變成限制因素的組態中，減少 IOPS 的每個量值可能都有助於延展您可以在類似 Azure 的 IaaS 案例中執行的工作負載。</span><span class="sxs-lookup"><span data-stu-id="7458b-970">In configurations where I/O bandwidth can become a limiting factor, every measure which reduces IOPS might help to stretch the workload one can run in an IaaS scenario like Azure.</span></span> <span data-ttu-id="7458b-971">因此，強烈建議您在將現有的 SAP 資料庫上傳至 Azure 之前，確定已使用 SAP ASE 壓縮。</span><span class="sxs-lookup"><span data-stu-id="7458b-971">Therefore, it is strongly recommended to make sure that SAP ASE compression is used before uploading an existing SAP database to Azure.</span></span>

<span data-ttu-id="7458b-972">建議在上傳至 Azure 之前執行壓縮，如果尚未實作，可能是因為下列數種因素所導致：</span><span class="sxs-lookup"><span data-stu-id="7458b-972">The recommendation to perform compression before uploading to Azure if it is not already implemented is given out of several reasons:</span></span>

* <span data-ttu-id="7458b-973">降低要上傳至 Azure 的資料量</span><span class="sxs-lookup"><span data-stu-id="7458b-973">The amount of data to be uploaded to Azure is lower</span></span>
* <span data-ttu-id="7458b-974">假設您可以使用功能更強大的硬體，其在內部部署中使用更多 CPU 或更高 I/O 頻寬或更少 I/O 延遲，則執行壓縮的持續時間較短</span><span class="sxs-lookup"><span data-stu-id="7458b-974">The duration of the compression execution is shorter assuming that one can use stronger hardware with more CPUs or higher I/O bandwidth or less I/O latency on-premises</span></span>
* <span data-ttu-id="7458b-975">較小的資料庫大小可能會使磁碟配置的成本降低</span><span class="sxs-lookup"><span data-stu-id="7458b-975">Smaller database sizes might lead to less costs for disk allocation</span></span>

<span data-ttu-id="7458b-976">資料壓縮和 LOB 壓縮可以在 Azure 虛擬機器上裝載的 VM 中運作，如同它在內部部署中的運作方式。</span><span class="sxs-lookup"><span data-stu-id="7458b-976">Data- and LOB-Compression work in a VM hosted in Azure Virtual Machines as it does on-premises.</span></span> <span data-ttu-id="7458b-977">如需有關如何檢查在現有 SAP ASE 資料庫中是否已經使用壓縮的更多詳細資料，請參閱 SAP 附註 [1750510]。</span><span class="sxs-lookup"><span data-stu-id="7458b-977">For more details on how to check if compression is already in use in an existing SAP ASE database please check SAP Note [1750510].</span></span> <span data-ttu-id="7458b-978">另請參閱 SAP 附註 [2121797] ，以取得有關資料庫壓縮的其他資訊。</span><span class="sxs-lookup"><span data-stu-id="7458b-978">Also see SAP Note [2121797] for additional information regarding database compression.</span></span>

#### <a name="using-dbacockpit-to-monitor-database-instances"></a><span data-ttu-id="7458b-979">使用 DBACockpit 監視資料庫執行個體</span><span class="sxs-lookup"><span data-stu-id="7458b-979">Using DBACockpit to monitor Database Instances</span></span>
<span data-ttu-id="7458b-980">針對使用 SAP ASE 做為資料庫平台的 SAP 系統，可以存取 DBACockpit 做為交易 DBACockpit 中內嵌的瀏覽器視窗或做為 Webdynpro。</span><span class="sxs-lookup"><span data-stu-id="7458b-980">For SAP systems which are using SAP ASE as database platform, the DBACockpit is accessible as embedded browser windows in transaction DBACockpit or as Webdynpro.</span></span> <span data-ttu-id="7458b-981">不過，監視和管理資料庫的完整功能只能在 DBACockpit 的 Webdynpro 實作中取得。</span><span class="sxs-lookup"><span data-stu-id="7458b-981">However the full functionality for monitoring and administering the database is available in the Webdynpro implementation of the DBACockpit only.</span></span>

<span data-ttu-id="7458b-982">做為內部部署系統，需要使用數個步驟，才能啟用 DBACockpit 之 Webdynpro 實作所使用的所有 SAP NetWeaver 功能。</span><span class="sxs-lookup"><span data-stu-id="7458b-982">As with on-premises systems several steps are required to enable all SAP NetWeaver functionality used by the Webdynpro implementation of the DBACockpit.</span></span> <span data-ttu-id="7458b-983">請依照 SAP 附註 [1245200] 來啟用 Webdynpro 的使用，以及產生所需的 Webdynpro。</span><span class="sxs-lookup"><span data-stu-id="7458b-983">Please follow SAP Note [1245200] to enable the usage of webdynpros and generate the required ones.</span></span> <span data-ttu-id="7458b-984">遵循上述附註中的指示時，您也可以設定網際網路通訊管理員 (icm) 以及針對 http 和 https 連線所使用的連接埠。</span><span class="sxs-lookup"><span data-stu-id="7458b-984">When following the instructions in the above notes you will also configure the Internet Communication Manager (icm) along with the ports to be used for http and https connections.</span></span> <span data-ttu-id="7458b-985">Http 的預設設定看起來如下︰</span><span class="sxs-lookup"><span data-stu-id="7458b-985">The default setting for http looks like this:</span></span>

> <span data-ttu-id="7458b-986">icm/server_port_0 = PROT=HTTP,PORT=8000,PROCTIMEOUT=600,TIMEOUT=600</span><span class="sxs-lookup"><span data-stu-id="7458b-986">icm/server_port_0 = PROT=HTTP,PORT=8000,PROCTIMEOUT=600,TIMEOUT=600</span></span>
>
> <span data-ttu-id="7458b-987">icm/server_port_1 = PROT=HTTPS,PORT=443$$,PROCTIMEOUT=600,TIMEOUT=600</span><span class="sxs-lookup"><span data-stu-id="7458b-987">icm/server_port_1 = PROT=HTTPS,PORT=443$$,PROCTIMEOUT=600,TIMEOUT=600</span></span>
>
>

<span data-ttu-id="7458b-988">而且在交易 DBACockpit 中產生的連結看起來如下︰</span><span class="sxs-lookup"><span data-stu-id="7458b-988">and the links generated in transaction DBACockpit will look similar to this:</span></span>

> <span data-ttu-id="7458b-989">https://`<fullyqualifiedhostname`>:44300/sap/bc/webdynpro/sap/dba_cockpit</span><span class="sxs-lookup"><span data-stu-id="7458b-989">https://`<fullyqualifiedhostname`>:44300/sap/bc/webdynpro/sap/dba_cockpit</span></span>
>
> <span data-ttu-id="7458b-990">http://`<fullyqualifiedhostname`>:8000/sap/bc/webdynpro/sap/dba_cockpit</span><span class="sxs-lookup"><span data-stu-id="7458b-990">http://`<fullyqualifiedhostname`>:8000/sap/bc/webdynpro/sap/dba_cockpit</span></span>
>
>

<span data-ttu-id="7458b-991">取決於裝載 SAP 系統的 Azure 虛擬機器是否以及如何透過站對站、多重網站或 ExpressRoute (跨單位部署) 來連接，您需要確定 ICM 會使用完整的主機名稱，此名稱可在您嘗試從中開啟 DBACockpit 的電腦上加以解析。</span><span class="sxs-lookup"><span data-stu-id="7458b-991">Depending on if and how the Azure Virtual Machine hosting the SAP system is connected via site-to-site, multi-site or ExpressRoute (Cross-Premises deployment) you need to make sure that ICM is using a fully qualified hostname that can be resolved on the machine where you are trying to open the DBACockpit from.</span></span> <span data-ttu-id="7458b-992">請參閱 SAP 附註 [773830] 以了解 ICM 如何根據設定檔參數決定完整的主機名稱，並於必要時明確設定 icm/host_name_full 參數。</span><span class="sxs-lookup"><span data-stu-id="7458b-992">Please see SAP Note [773830] to understand how ICM determines the fully qualified host name depending on profile parameters and set parameter icm/host_name_full explicitly if required.</span></span>

<span data-ttu-id="7458b-993">如果您在僅限雲端的案例中部署 VM，而不需要在內部部署與 Azure 之間跨單位的連線能力，您需要定義一個公用 IP 位址和一個 domainlabel。</span><span class="sxs-lookup"><span data-stu-id="7458b-993">If you deployed the VM in a Cloud-Only scenario without cross-premises connectivity between on-premises and Azure, you need to define a public IP address and a domainlabel.</span></span> <span data-ttu-id="7458b-994">然後 VM 的公用 DNS 名稱格式將看起來如下︰</span><span class="sxs-lookup"><span data-stu-id="7458b-994">The format of the public DNS name of the VM will then look like this :</span></span>

> <span data-ttu-id="7458b-995">`<custom domainlabel`>.`<azure region`>.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="7458b-995">`<custom domainlabel`>.`<azure region`>.cloudapp.azure.com</span></span>
>
>

<span data-ttu-id="7458b-996">如需有關 DNS 名稱的更多詳細資料，請參閱[這裡][virtual-machines-azurerm-versus-azuresm]。</span><span class="sxs-lookup"><span data-stu-id="7458b-996">More details related to the DNS name can be found [here][virtual-machines-azurerm-versus-azuresm].</span></span>

<span data-ttu-id="7458b-997">將 SAP 設定檔參數 icm/host_name_full 設定為 Azure VM 的 DNS 名稱，其連結看起來可能如下︰</span><span class="sxs-lookup"><span data-stu-id="7458b-997">Setting the SAP profile parameter icm/host_name_full to the DNS name of the Azure VM the link might look similar to:</span></span>

> <span data-ttu-id="7458b-998">https://mydomainlabel.westeurope.cloudapp.net:44300/sap/bc/webdynpro/sap/dba_cockpit</span><span class="sxs-lookup"><span data-stu-id="7458b-998">https://mydomainlabel.westeurope.cloudapp.net:44300/sap/bc/webdynpro/sap/dba_cockpit</span></span>
>
> <span data-ttu-id="7458b-999">http://mydomainlabel.westeurope.cloudapp.net:8000/sap/bc/webdynpro/sap/dba_cockpit</span><span class="sxs-lookup"><span data-stu-id="7458b-999">http://mydomainlabel.westeurope.cloudapp.net:8000/sap/bc/webdynpro/sap/dba_cockpit</span></span>
>
>

<span data-ttu-id="7458b-1000">在此情況下，您需要確定︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1000">In this case you need to make sure to:</span></span>

* <span data-ttu-id="7458b-1001">在 Azure 入口網站中，針對用來與 ICM 通訊的 TCP/IP 連接埠，將輸入規則新增至網路安全性群組</span><span class="sxs-lookup"><span data-stu-id="7458b-1001">Add Inbound rules to the Network Security Group in the Azure Portal for the TCP/IP ports used to communicate with ICM</span></span>
* <span data-ttu-id="7458b-1002">針對用來與 ICM 通訊的 TCP/IP 連接埠，將輸入規則新增至 Windows 防火牆組態</span><span class="sxs-lookup"><span data-stu-id="7458b-1002">Add Inbound rules to the Windows Firewall configuration for the TCP/IP ports used to communicate with the ICM</span></span>

<span data-ttu-id="7458b-1003">針對自動匯入所有可用修正的功能，建議定期套用適用於您 SAP 版本的修正集合 SAP 附註︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1003">For an automated imported of all corrections available, it is recommended to periodically apply the correction collection SAP Note applicable to your SAP version:</span></span>

* <span data-ttu-id="7458b-1004">[1558958]</span><span class="sxs-lookup"><span data-stu-id="7458b-1004">[1558958]</span></span>
* <span data-ttu-id="7458b-1005">[1619967]</span><span class="sxs-lookup"><span data-stu-id="7458b-1005">[1619967]</span></span>
* <span data-ttu-id="7458b-1006">[1882376]</span><span class="sxs-lookup"><span data-stu-id="7458b-1006">[1882376]</span></span>

<span data-ttu-id="7458b-1007">您可以在下列 SAP 附註中找到適用於 SAP ASE 之 DBA Cockpit 的進一步資訊︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1007">Further information about DBA Cockpit for SAP ASE can be found in the following SAP Notes:</span></span>

* <span data-ttu-id="7458b-1008">[1605680]</span><span class="sxs-lookup"><span data-stu-id="7458b-1008">[1605680]</span></span>
* <span data-ttu-id="7458b-1009">[1757924]</span><span class="sxs-lookup"><span data-stu-id="7458b-1009">[1757924]</span></span>
* <span data-ttu-id="7458b-1010">[1757928]</span><span class="sxs-lookup"><span data-stu-id="7458b-1010">[1757928]</span></span>
* <span data-ttu-id="7458b-1011">[1758182]</span><span class="sxs-lookup"><span data-stu-id="7458b-1011">[1758182]</span></span>
* <span data-ttu-id="7458b-1012">[1758496]</span><span class="sxs-lookup"><span data-stu-id="7458b-1012">[1758496]</span></span>    
* <span data-ttu-id="7458b-1013">[1814258]</span><span class="sxs-lookup"><span data-stu-id="7458b-1013">[1814258]</span></span>
* <span data-ttu-id="7458b-1014">[1922555]</span><span class="sxs-lookup"><span data-stu-id="7458b-1014">[1922555]</span></span>
* <span data-ttu-id="7458b-1015">[1956005]</span><span class="sxs-lookup"><span data-stu-id="7458b-1015">[1956005]</span></span>

#### <a name="backuprecovery-considerations-for-sap-ase"></a><span data-ttu-id="7458b-1016">SAP ASE 的備份/復原考量</span><span class="sxs-lookup"><span data-stu-id="7458b-1016">Backup/Recovery Considerations for SAP ASE</span></span>
<span data-ttu-id="7458b-1017">將 SAP ASE 部署至 Azure 時，必須檢閱您的備份方法。</span><span class="sxs-lookup"><span data-stu-id="7458b-1017">When deploying SAP ASE into Azure your backup methodology must be reviewed.</span></span> <span data-ttu-id="7458b-1018">即使系統不是生產系統，還是必須定期備份 SAP ASE 所裝載的 SAP 資料庫。</span><span class="sxs-lookup"><span data-stu-id="7458b-1018">Even if the system is not a productive system, the SAP database hosted by SAP ASE must be backed up periodically.</span></span> <span data-ttu-id="7458b-1019">由於 Azure 儲存體會保留三個映像，因此在補償儲存體損毀方面，備份現在已變得較不重要。</span><span class="sxs-lookup"><span data-stu-id="7458b-1019">Since Azure Storage keeps three images, a backup is now less important in respect to compensating a storage crash.</span></span> <span data-ttu-id="7458b-1020">維護適當備份和還原方案的主要原因是，您可以藉由提供時間點復原功能來補償邏輯/手動錯誤。</span><span class="sxs-lookup"><span data-stu-id="7458b-1020">The primary reason for maintaining a proper backup and restore plan is more that you can compensate for logical/manual errors by providing point in time recovery capabilities.</span></span> <span data-ttu-id="7458b-1021">因此，目標是使用備份來將資料庫還原回到某個時間點，或者藉由複製現有的資料庫，在 Azure 中使用備份來植入另一個系統。</span><span class="sxs-lookup"><span data-stu-id="7458b-1021">So the goal is to either use backups to restore the database back to a certain point in time or to use the backups in Azure to seed another system by copying the existing database.</span></span> <span data-ttu-id="7458b-1022">例如，您可以藉由還原備份，從 2 層 SAP 組態轉移到同一個系統的 3 層系統設定。</span><span class="sxs-lookup"><span data-stu-id="7458b-1022">For example, you could transfer from a 2-Tier SAP configuration to a 3-Tier system setup of the same system by restoring a backup.</span></span>

<span data-ttu-id="7458b-1023">在 Azure 中備份和還原資料庫的運作方式，與內部部署中的運作方式一樣。</span><span class="sxs-lookup"><span data-stu-id="7458b-1023">Backing up and restoring a database in Azure works the same way as it does on-premises.</span></span> <span data-ttu-id="7458b-1024">請參閱 SAP 附註︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1024">Please see SAP Notes:</span></span>

* <span data-ttu-id="7458b-1025">[1588316]</span><span class="sxs-lookup"><span data-stu-id="7458b-1025">[1588316]</span></span>
* <span data-ttu-id="7458b-1026">[1585981]</span><span class="sxs-lookup"><span data-stu-id="7458b-1026">[1585981]</span></span>

<span data-ttu-id="7458b-1027">以取得建立傾印組態和排程備份的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="7458b-1027">for details on creating dump configurations and scheduling backups.</span></span> <span data-ttu-id="7458b-1028">根據您的策略和需求，您可以在其中一個現有的 VHD 上將資料庫和記錄傾印設定至磁碟，或者新增其他 VHD 以供備份使用。</span><span class="sxs-lookup"><span data-stu-id="7458b-1028">Depending on your strategy and needs you can configure database and log dumps to disk onto one of the existing VHDs or add an additional VHD for the backup.</span></span>  <span data-ttu-id="7458b-1029">為了減少在發生錯誤時產生資料遺失的風險，建議使用 VHD (不會有任何資料庫目錄/檔案位於其中)。</span><span class="sxs-lookup"><span data-stu-id="7458b-1029">To reduce the danger of data loss in case of an error it is recommended to use a VHD where no database directory/file is located.</span></span>

<span data-ttu-id="7458b-1030">除了資料壓縮與 LOB 壓縮之外，SAP ASE 也會提供備份壓縮。</span><span class="sxs-lookup"><span data-stu-id="7458b-1030">Besides data- and LOB compression SAP ASE also offers backup compression.</span></span> <span data-ttu-id="7458b-1031">若要讓資料庫和記錄傾印佔用較少的空間，建議使用備份壓縮。</span><span class="sxs-lookup"><span data-stu-id="7458b-1031">To occupy less space with the database and log dumps it is recommended to use backup compression.</span></span> <span data-ttu-id="7458b-1032">如需詳細資訊，請參閱 SAP 附註 [1588316] 。</span><span class="sxs-lookup"><span data-stu-id="7458b-1032">Please see SAP Note [1588316] for more information.</span></span> <span data-ttu-id="7458b-1033">如果您打算從 Azure 虛擬機器將備份或包含備份傾印的 VHD 下載至內部部署，則壓縮備份對於降低要傳輸的資料量來說也很重要。</span><span class="sxs-lookup"><span data-stu-id="7458b-1033">Compressing the backup is also crucial to reduce the amount of data to be transferred if you plan to download backups or VHDs containing backup dumps from the Azure Virtual Machine to on-premises.</span></span>

<span data-ttu-id="7458b-1034">不要使用 Azure VM 暫存空間 /mnt 或 /mnt/resource 做為資料庫或記錄傾印目的地。</span><span class="sxs-lookup"><span data-stu-id="7458b-1034">Do not use the Azure VM temp space /mnt or /mnt/resource as database or log dump destination.</span></span>

#### <a name="performance-considerations-for-backupsrestores"></a><span data-ttu-id="7458b-1035">備份/還原的效能考量</span><span class="sxs-lookup"><span data-stu-id="7458b-1035">Performance Considerations for Backups/Restores</span></span>
<span data-ttu-id="7458b-1036">如同裸機部署，備份/還原效能取決於可以平行讀取的磁碟區數目，以及這些磁碟區可能的輸送量。</span><span class="sxs-lookup"><span data-stu-id="7458b-1036">As in bare-metal deployments, backup/restore performance is dependent on how many volumes can be read in parallel and what the throughput of those volumes might be.</span></span> <span data-ttu-id="7458b-1037">此外，備份壓縮所使用的 CPU 耗用量可能會在最多只有 8 個 CPU 執行緒的 VM 上扮演重要的角色。</span><span class="sxs-lookup"><span data-stu-id="7458b-1037">In addition, the CPU consumption used by backup compression may play a significant role on VMs with just up to 8 CPU threads.</span></span> <span data-ttu-id="7458b-1038">因此，您可以假設︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1038">Therefore, one can assume:</span></span>

* <span data-ttu-id="7458b-1039">用來儲存資料庫裝置的 VHD 數目越少，讀取的整體輸送量就越小</span><span class="sxs-lookup"><span data-stu-id="7458b-1039">The fewer the number of VHDs used to store the database devices, the smaller the overall throughput in reading</span></span>
* <span data-ttu-id="7458b-1040">VM 中 CPU 執行緒數目越小，備份壓縮的影響就越嚴重</span><span class="sxs-lookup"><span data-stu-id="7458b-1040">The smaller the number of CPU threads in the VM, the more severe the impact of backup compression</span></span>
* <span data-ttu-id="7458b-1041">要寫入備份的目標 (Linux 軟體 RAID、VHD) 越少，輸送量就越低</span><span class="sxs-lookup"><span data-stu-id="7458b-1041">The fewer targets ( Linux software RAID, VHDs) to write the backup to, the lesser the throughput</span></span>

<span data-ttu-id="7458b-1042">若要增加要寫入的目標數目，根據您的需求，有兩個選項可以使用/相結合：</span><span class="sxs-lookup"><span data-stu-id="7458b-1042">To increase the number of targets to write to there are two options which can be used/combined depending on your needs:</span></span>

* <span data-ttu-id="7458b-1043">在多個掛接的 VHD 上等量劃分備份目標磁碟區，以改善該等量磁碟區上的 IOPS 輸送量</span><span class="sxs-lookup"><span data-stu-id="7458b-1043">Striping the backup target volume over multiple mounted VHDs in order to improve the IOPS throughput on that striped volume</span></span>
* <span data-ttu-id="7458b-1044">在 SAP ASE 層級上建立傾印組態，該層級會使用一個以上的目標目錄來寫入傾印</span><span class="sxs-lookup"><span data-stu-id="7458b-1044">Creating a dump configuration on SAP ASE level which uses more than one target directory to write the dump to</span></span>

<span data-ttu-id="7458b-1045">本指南的先前內容中已討論過在多個掛接的 VHD 上等量劃分磁碟區的方式。</span><span class="sxs-lookup"><span data-stu-id="7458b-1045">Striping a volume over multiple mounted VHDs has been discussed earlier in this guide.</span></span> <span data-ttu-id="7458b-1046">如需有關在 SAP ASE 傾印組態中使用多個目錄的詳細資訊，請參閱 sp_config_dump 預存程序的相關文件，此預存程序可用來在 [Sybase Infocenter](http://infocenter.sybase.com/help/index.jsp) 上建立傾印組態。</span><span class="sxs-lookup"><span data-stu-id="7458b-1046">For more information on using multiple directories in the SAP ASE dump configuration please refer to the documentation on Stored Procedure sp_config_dump which is used to create the dump configuration on the [Sybase Infocenter](http://infocenter.sybase.com/help/index.jsp).</span></span>

### <a name="disaster-recovery-with-azure-vms"></a><span data-ttu-id="7458b-1047">使用 Azure VM 的災害復原</span><span class="sxs-lookup"><span data-stu-id="7458b-1047">Disaster Recovery with Azure VMs</span></span>
#### <a name="data-replication-with-sap-sybase-replication-server"></a><span data-ttu-id="7458b-1048">利用 SAP Sybase 複寫伺服器的資料複寫</span><span class="sxs-lookup"><span data-stu-id="7458b-1048">Data Replication with SAP Sybase Replication Server</span></span>
<span data-ttu-id="7458b-1049">利用 SAP Sybase 複寫伺服器 (SRS)，SAP ASE 可提供暖待命的解決方案，以非同步方式將資料庫交易傳輸到遠端位置。</span><span class="sxs-lookup"><span data-stu-id="7458b-1049">With the SAP Sybase Replication Server (SRS) SAP ASE provides a warm standby solution to transfer database transactions to a distant location asynchronously.</span></span>

<span data-ttu-id="7458b-1050">安裝及操作 SRS 也可以在 Azure 虛擬機器中裝載的 VM 上運作，就像它在內部部署的運作方式。</span><span class="sxs-lookup"><span data-stu-id="7458b-1050">The installation and operation of SRS works as well functionally in a VM hosted in Azure Virtual Machine Services as it does on-premises.</span></span>

<span data-ttu-id="7458b-1051">目前不支援透過 SAP 複寫伺服器的 ASE HADR。</span><span class="sxs-lookup"><span data-stu-id="7458b-1051">ASE HADR via SAP Replication Server is NOT supported at this point in time.</span></span> <span data-ttu-id="7458b-1052">未來可能會進行測試並針對 Microsoft Azure 平台加以發行。</span><span class="sxs-lookup"><span data-stu-id="7458b-1052">It might be tested with and released for Microsoft Azure platforms in the future.</span></span>

## <a name="specifics-to-oracle-database-on-windows"></a><span data-ttu-id="7458b-1053">Windows 上 Oracle 資料庫專屬的詳細資料</span><span class="sxs-lookup"><span data-stu-id="7458b-1053">Specifics to Oracle Database on Windows</span></span>
<span data-ttu-id="7458b-1054">自 2013 年中開始，Oracle 支援 Oracle 軟體可在 Microsoft Windows HYPER-V 和 Azure 上執行。</span><span class="sxs-lookup"><span data-stu-id="7458b-1054">Since midyear 2013, Oracle software is supported by Oracle to run on Microsoft Windows Hyper-V and Azure.</span></span> <span data-ttu-id="7458b-1055">請閱讀下列文章，以取得有關 Oracle 所提供之 Windows Hyper-V 和 Azure 一般支援的更多詳細資料︰<https://blogs.oracle.com/cloud/entry/oracle_and_microsoft_join_forces></span><span class="sxs-lookup"><span data-stu-id="7458b-1055">Please read this article to get more details on the general support of Windows Hyper-V and Azure by Oracle: <https://blogs.oracle.com/cloud/entry/oracle_and_microsoft_join_forces></span></span>

<span data-ttu-id="7458b-1056">遵循一般支援，也支援利用 Oracle 資料庫的 SAP 應用程式特定案例。</span><span class="sxs-lookup"><span data-stu-id="7458b-1056">Following the general support, the specific scenario of SAP applications leveraging Oracle Databases is supported as well.</span></span> <span data-ttu-id="7458b-1057">詳細資料已在文件的這個部分中命名。</span><span class="sxs-lookup"><span data-stu-id="7458b-1057">Details are named in this part of the document.</span></span>

### <a name="oracle-version-support"></a><span data-ttu-id="7458b-1058">Oracle 版本支援</span><span class="sxs-lookup"><span data-stu-id="7458b-1058">Oracle Version Support</span></span>
<span data-ttu-id="7458b-1059">如需有關在「Azure 虛擬機器」上的 Oracle 執行 SAP 時，所支援的 Oracle 版本及對應之作業系統版本的所有詳細資料，請參閱下列 SAP 附註： [2039619]</span><span class="sxs-lookup"><span data-stu-id="7458b-1059">All details about Oracle versions and corresponding OS versions which are supported for running SAP on Oracle on Azure Virtual Machines can be found in the following SAP Note [2039619]</span></span>

<span data-ttu-id="7458b-1060">如需有關在 Oracle 上執行「SAP 商務套件」的一般資訊，請參閱 SCN：<https://scn.sap.com/community/oracle></span><span class="sxs-lookup"><span data-stu-id="7458b-1060">General information about running SAP Business Suite on Oracle can be found on SCN: <https://scn.sap.com/community/oracle></span></span>

### <a name="oracle-configuration-guidelines-for-sap-installations-in-azure-vms"></a><span data-ttu-id="7458b-1061">在 Azure VM 中安裝 SAP 的 Oracle 組態指導方針</span><span class="sxs-lookup"><span data-stu-id="7458b-1061">Oracle Configuration Guidelines for SAP Installations in Azure VMs</span></span>
#### <a name="storage-configuration"></a><span data-ttu-id="7458b-1062">儲存體組態</span><span class="sxs-lookup"><span data-stu-id="7458b-1062">Storage configuration</span></span>
<span data-ttu-id="7458b-1063">只支援 Oracle 使用 NTFS 格式化磁碟的單一執行個體。</span><span class="sxs-lookup"><span data-stu-id="7458b-1063">Only single instance Oracle using NTFS formatted disks is supported.</span></span> <span data-ttu-id="7458b-1064">所有的資料庫檔案都必須儲存於以 VHD 磁碟為基礎的 NTFS 檔案系統上。</span><span class="sxs-lookup"><span data-stu-id="7458b-1064">All database files must be stored on the NTFS file system based on VHD disks.</span></span> <span data-ttu-id="7458b-1065">這些 VHD 掛接到 Azure VM，並且根據 Azure 分頁 Blob 儲存體 (<https://msdn.microsoft.com/library/azure/ee691964.aspx>)。</span><span class="sxs-lookup"><span data-stu-id="7458b-1065">These VHDs are mounted to the Azure VM and are based on Azure Page BLOB Storage (<https://msdn.microsoft.com/library/azure/ee691964.aspx>).</span></span>
<span data-ttu-id="7458b-1066">任何類型的網路磁碟機或遠端共用 (例如 Azure 檔案服務)：</span><span class="sxs-lookup"><span data-stu-id="7458b-1066">Any kind of network drives or remote shares like Azure file services:</span></span>

* <span data-ttu-id="7458b-1067"><https://blogs.msdn.com/b/windowsazurestorage/archive/2014/05/12/introducing-microsoft-azure-file-service.aspx></span><span class="sxs-lookup"><span data-stu-id="7458b-1067"><https://blogs.msdn.com/b/windowsazurestorage/archive/2014/05/12/introducing-microsoft-azure-file-service.aspx></span></span>
* <span data-ttu-id="7458b-1068"><https://blogs.msdn.com/b/windowsazurestorage/archive/2014/05/27/persisting-connections-to-microsoft-azure-files.aspx></span><span class="sxs-lookup"><span data-stu-id="7458b-1068"><https://blogs.msdn.com/b/windowsazurestorage/archive/2014/05/27/persisting-connections-to-microsoft-azure-files.aspx></span></span>

<span data-ttu-id="7458b-1069">就 Oracle 資料庫檔案而言，都「不」  支援使用！</span><span class="sxs-lookup"><span data-stu-id="7458b-1069">are **NOT** supported for Oracle database files!</span></span>

<span data-ttu-id="7458b-1070">根據「Azure 分頁 BLOB 儲存體」使用 Azure VHD 時，本文件的 [VM 和 VHD 的快取][dbms-guide-2.1]及 [Microsoft Azure 儲存體][dbms-guide-2.3]章節中所做的陳述也適用於利用 Oracle 資料庫所做的部署。</span><span class="sxs-lookup"><span data-stu-id="7458b-1070">Using Azure VHDs based on Azure Page BLOB Storage, the statements made in this document in chapter [Caching for VMs and VHDs][dbms-guide-2.1] and [Microsoft Azure Storage][dbms-guide-2.3] apply to deployments with the Oracle Database as well.</span></span>

<span data-ttu-id="7458b-1071">如同先前在文件通用部分中所述，適用於 Azure VHD 的 IOPS 輸送量上有配額存在。</span><span class="sxs-lookup"><span data-stu-id="7458b-1071">As explained earlier in the general part of the document, quotas on IOPS throughput for Azure VHDs exist.</span></span> <span data-ttu-id="7458b-1072">確切的配額會根據使用的 VM 類型而定。</span><span class="sxs-lookup"><span data-stu-id="7458b-1072">The exact quotas are depending on the VM type used.</span></span> <span data-ttu-id="7458b-1073">如需 VM 類型及其配額的清單，請參閱[這裡][virtual-machines-sizes]</span><span class="sxs-lookup"><span data-stu-id="7458b-1073">A list of VM types with their quotas can be found [here][virtual-machines-sizes]</span></span>

<span data-ttu-id="7458b-1074">若要找出支援的 Azure VM 類型，請參閱 SAP 附註 [1928533]</span><span class="sxs-lookup"><span data-stu-id="7458b-1074">To identify the supported Azure VM types, please refer to SAP note [1928533]</span></span>

<span data-ttu-id="7458b-1075">只要每個磁碟上目前的 IOPS 配額能滿足需求，就可以將所有 DB 檔案儲存於單一已掛接的 Azure VHD 上。</span><span class="sxs-lookup"><span data-stu-id="7458b-1075">As long as the current IOPS quota per disk satisfies the requirements, it is possible to store all the DB files on one single mounted Azure VHD.</span></span>

<span data-ttu-id="7458b-1076">如果需要更多 IOPS，強烈建議使用 Windows 儲存集區 (僅適用於 Windows Server 2012 和更新版本) 或適用於 Windows 2008 R2 的 Windows 等量，透過多個已掛接的 VHD 磁碟來建立一個大型邏輯裝置。</span><span class="sxs-lookup"><span data-stu-id="7458b-1076">If more IOPS are required, it is strongly recommended to use Window Storage Pools (only available in Windows Server 2012 and higher) or Windows striping for Windows 2008 R2 to create one big logical device over multiple mounted VHD disks.</span></span> <span data-ttu-id="7458b-1077">另請參閱本文件的[軟體 RAID][dbms-guide-2.2] 一章。</span><span class="sxs-lookup"><span data-stu-id="7458b-1077">See also chapter [Software RAID][dbms-guide-2.2] of this document.</span></span> <span data-ttu-id="7458b-1078">這種方法可以簡化系統管理負荷來管理磁碟空間，並避免將檔案手動分散到多個已掛接的 VHD。</span><span class="sxs-lookup"><span data-stu-id="7458b-1078">This approach simplifies the administration overhead to manage the disk space and avoids the effort to manually distribute files across multiple mounted VHDs.</span></span>

#### <a name="backup--restore"></a><span data-ttu-id="7458b-1079">備份 / 還原</span><span class="sxs-lookup"><span data-stu-id="7458b-1079">Backup / Restore</span></span>
<span data-ttu-id="7458b-1080">針對備份 / 還原功能，利用與標準 Windows Server 作業系統和 Hyper-V 上所做的相同方式來支援 SAP BR*Tools for Oracle。</span><span class="sxs-lookup"><span data-stu-id="7458b-1080">For backup / restore functionality, the SAP BR*Tools for Oracle are supported in the same way as on standard Windows Server Operating Systems and Hyper-V.</span></span> <span data-ttu-id="7458b-1081">Oracle 復原管理員 (RMAN) 也支援備份至磁碟，以及從磁碟還原。</span><span class="sxs-lookup"><span data-stu-id="7458b-1081">Oracle Recovery Manager (RMAN) is also supported for backups to disk and restore from disk.</span></span>

#### <a name="high-availability"></a><span data-ttu-id="7458b-1082">高可用性</span><span class="sxs-lookup"><span data-stu-id="7458b-1082">High Availability</span></span>
<span data-ttu-id="7458b-1083">[comment]: <> (連結是與 ASM 相關)</span><span class="sxs-lookup"><span data-stu-id="7458b-1083">[comment]: <> (link refers to ASM)</span></span>
<span data-ttu-id="7458b-1084">基於高可用性和災害復原目的支援 Oracle Data Guard。</span><span class="sxs-lookup"><span data-stu-id="7458b-1084">Oracle Data Guard is supported for high availability and disaster recovery purposes.</span></span> <span data-ttu-id="7458b-1085">如需詳細資料，請參閱[這份][virtual-machines-windows-classic-configure-oracle-data-guard]文件。</span><span class="sxs-lookup"><span data-stu-id="7458b-1085">Details can be found in [this][virtual-machines-windows-classic-configure-oracle-data-guard] documentation.</span></span>

#### <a name="other"></a><span data-ttu-id="7458b-1086">其他</span><span class="sxs-lookup"><span data-stu-id="7458b-1086">Other</span></span>
<span data-ttu-id="7458b-1087">所有其他一般主題 (例如「Azure 可用性設定組」或 SAP 監視) 也適用於使用 Oracle 資料庫來部署 VM 的情況，如本文件的前三章中所述。</span><span class="sxs-lookup"><span data-stu-id="7458b-1087">All other general topics like Azure Availability Sets or SAP monitoring apply as described in the first three chapters of this document for deployments of VMs with the Oracle Database as well.</span></span>

## <a name="specifics-for-the-sap-maxdb-database-on-windows"></a><span data-ttu-id="7458b-1088">Windows 上 SAP MaxDB 資料庫專屬的詳細資料</span><span class="sxs-lookup"><span data-stu-id="7458b-1088">Specifics for the SAP MaxDB Database on Windows</span></span>
### <a name="sap-maxdb-version-support"></a><span data-ttu-id="7458b-1089">SAP MaxDB 版本支援</span><span class="sxs-lookup"><span data-stu-id="7458b-1089">SAP MaxDB Version Support</span></span>
<span data-ttu-id="7458b-1090">SAP 目前支援 SAP MaxDB 版本 7.9，以便與 Azure 中 SAP NetWeaver 架構的產品搭配使用。</span><span class="sxs-lookup"><span data-stu-id="7458b-1090">SAP currently supports SAP MaxDB version 7.9 for use with SAP NetWeaver-based products in Azure.</span></span> <span data-ttu-id="7458b-1091">不論是適用於 SAP MaxDB 伺服器的所有更新，還是要與 SAP NetWeaver 架構的產品搭配使用的 JDBC 和 ODBC 驅動程式，都只會透過 SAP Service Marketplace 來提供，網址：<https://support.sap.com/swdc>。</span><span class="sxs-lookup"><span data-stu-id="7458b-1091">All updates for SAP MaxDB server, or JDBC and ODBC drivers to be used with SAP NetWeaver-based products are provided solely through the SAP Service Marketplace at <https://support.sap.com/swdc>.</span></span>
<span data-ttu-id="7458b-1092">如需有關在 SAP MaxDB 上執行 SAP NetWeaver 的一般資訊，請參閱 <https://scn.sap.com/community/maxdb>。</span><span class="sxs-lookup"><span data-stu-id="7458b-1092">General information on running SAP NetWeaver on SAP MaxDB can be found at <https://scn.sap.com/community/maxdb>.</span></span>

### <a name="supported-microsoft-windows-versions-and-azure-vm-types-for-sap-maxdb-dbms"></a><span data-ttu-id="7458b-1093">針對 SAP MaxDB DBMS 支援的 Microsoft Windows 版本和 Azure VM 類型</span><span class="sxs-lookup"><span data-stu-id="7458b-1093">Supported Microsoft Windows Versions and Azure VM types for SAP MaxDB DBMS</span></span>
<span data-ttu-id="7458b-1094">若要尋找在 Azure 上支援 SAP MaxDB DBMS 的 Microsoft Windows 版本，請參閱︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1094">To find the supported Microsoft Windows version for SAP MaxDB DBMS on Azure, see:</span></span>

* <span data-ttu-id="7458b-1095">[SAP 產品可用性對照表 (PAM)][sap-pam]</span><span class="sxs-lookup"><span data-stu-id="7458b-1095">[SAP Product Availability Matrix (PAM)][sap-pam]</span></span>
* <span data-ttu-id="7458b-1096">SAP 附註 [1928533]</span><span class="sxs-lookup"><span data-stu-id="7458b-1096">SAP Note [1928533]</span></span>

<span data-ttu-id="7458b-1097">強烈建議使用最新版本的作業系統 Microsoft Windows，也就是 Microsoft Windows 2012 R2。</span><span class="sxs-lookup"><span data-stu-id="7458b-1097">It is highly recommended to use the newest version of the operating system Microsoft Windows, which is Microsoft Windows 2012 R2.</span></span>

### <a name="available-sap-maxdb-documentation"></a><span data-ttu-id="7458b-1098">可用的 SAP MaxDB 文件</span><span class="sxs-lookup"><span data-stu-id="7458b-1098">Available SAP MaxDB Documentation</span></span>
<span data-ttu-id="7458b-1099">您可以在下列 SAP 附註中找到已更新的 SAP MaxDB 文件清單： [767598]</span><span class="sxs-lookup"><span data-stu-id="7458b-1099">You can find the updated list of SAP MaxDB documentation in the following SAP Note [767598]</span></span>

### <a name="sap-maxdb-configuration-guidelines-for-sap-installations-in-azure-vms"></a><span data-ttu-id="7458b-1100">在 Azure VM 中安裝 SAP 的 SAP MaxDB 組態指導方針</span><span class="sxs-lookup"><span data-stu-id="7458b-1100">SAP MaxDB Configuration Guidelines for SAP Installations in Azure VMs</span></span>
#### <span data-ttu-id="7458b-1101"><a name="b48cfe3b-48e9-4f5b-a783-1d29155bd573"></a>儲存體組態</span><span class="sxs-lookup"><span data-stu-id="7458b-1101"><a name="b48cfe3b-48e9-4f5b-a783-1d29155bd573"></a>Storage configuration</span></span>
<span data-ttu-id="7458b-1102">適用於 SAP MaxDB 的 Azure 儲存體最佳做法是依照 [RDBMS 部署結構][dbms-guide-2]一章中所提到的一般建議。</span><span class="sxs-lookup"><span data-stu-id="7458b-1102">Azure storage best practices for SAP MaxDB follow the general recommendations mentioned in chapter [Structure of a RDBMS Deployment][dbms-guide-2].</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7458b-1103">如同其他資料庫，SAP MaxDB 也有資料和記錄檔。</span><span class="sxs-lookup"><span data-stu-id="7458b-1103">Like other databases, SAP MaxDB also has data and log files.</span></span> <span data-ttu-id="7458b-1104">不過，在 SAP MaxDB 術語中，正確的詞彙是「磁碟區」(不是「檔案」)。</span><span class="sxs-lookup"><span data-stu-id="7458b-1104">However, in SAP MaxDB terminology the correct term is “volume” (not “file”).</span></span> <span data-ttu-id="7458b-1105">例如，有 SAP MaxDB 資料磁碟區和記錄磁碟區。</span><span class="sxs-lookup"><span data-stu-id="7458b-1105">For example, there are SAP MaxDB data volumes and log volumes.</span></span> <span data-ttu-id="7458b-1106">請勿與作業系統磁碟區混淆。</span><span class="sxs-lookup"><span data-stu-id="7458b-1106">Do not confuse these with OS disk volumes.</span></span>
>
>

<span data-ttu-id="7458b-1107">簡單地說，您必須︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1107">In short you have to:</span></span>

* <span data-ttu-id="7458b-1108">如 [Microsoft Azure 儲存體][dbms-guide-2.3]一章所指定，將保有 SAP MaxDB 資料和記錄磁碟區 (也就是檔案) 的 Azure 儲存體帳戶設定為 [本機備援儲存體 (LRS)]。</span><span class="sxs-lookup"><span data-stu-id="7458b-1108">Set the Azure storage account that holds the SAP MaxDB data and log volumes (i.e. files) to **Local Redundant Storage (LRS)** as specified in chapter [Microsoft Azure Storage][dbms-guide-2.3].</span></span>
* <span data-ttu-id="7458b-1109">將 SAP MaxDB 資料磁碟區 (也就是檔案) 的 IO 路徑，與記錄磁碟區 (也就是檔案) 的 IO 路徑分隔開來。</span><span class="sxs-lookup"><span data-stu-id="7458b-1109">Separate the IO path for SAP MaxDB data volumes (i.e. files) from the IO path for log volumes (i.e. files).</span></span> <span data-ttu-id="7458b-1110">這表示 SAP MaxDB 資料磁碟區 (也就是檔案) 必須安裝於一個邏輯磁碟機上，而 SAP MaxDB 記錄磁碟區 (也就是檔案) 必須安裝於另一個邏輯磁碟機上。</span><span class="sxs-lookup"><span data-stu-id="7458b-1110">This means that SAP MaxDB data volumes (i.e. files) have to be installed on one logical drive and SAP MaxDB log volumes (i.e. files) have to be installed on another logical drive.</span></span>
* <span data-ttu-id="7458b-1111">如 [VM 的快取][dbms-guide-2.1]一章所述，根據您是要針對 SAP MaxDB 資料還是記錄磁碟區 (也就是檔案) 使用檔案快取，以及您使用的是「Azure 標準儲存體」還是「Azure 進階儲存體」而定，為每個 Azure Blob 設定適當的檔案快取。</span><span class="sxs-lookup"><span data-stu-id="7458b-1111">Set the proper file caching for each Azure blob, depending on whether you use it for SAP MaxDB data or log volumes (i.e. files), and whether you use Azure Standard or Azure Premium Storage, as described in chapter [Caching for VMs][dbms-guide-2.1].</span></span>
* <span data-ttu-id="7458b-1112">只要每個磁碟上目前的 IOPS 配額可滿足需求，就能夠將所有資料磁碟區儲存於單一掛接的 Azure VHD 上，而且也會將所有資料庫記錄磁碟區儲存於另一個單一掛接的 Azure VHD 上。</span><span class="sxs-lookup"><span data-stu-id="7458b-1112">As long as the current IOPS quota per disk satisfies the requirements, it is possible to store all the data volumes on a single mounted Azure VHD, and also store all database log volumes on another single mounted Azure VHD.</span></span>
* <span data-ttu-id="7458b-1113">如果需要更多 IOPS 和/或空間，強烈建議使用 Microsoft Windows 儲存集區 (僅適用於 Microsoft Windows Server 2012 和更新版本) 或適用於 Microsoft Windows 2008 R2 的 Microsoft Windows 等量，透過多個已掛接的 VHD 磁碟來建立一個大型邏輯裝置。</span><span class="sxs-lookup"><span data-stu-id="7458b-1113">If more IOPS and/or space are required, it is strongly recommended to use Microsoft Window Storage Pools (only available in Microsoft Windows Server 2012 and higher) or Microsoft Windows striping for Microsoft Windows 2008 R2 to create one large logical device over multiple mounted VHD disks.</span></span> <span data-ttu-id="7458b-1114">另請參閱本文件的[軟體 RAID][dbms-guide-2.2] 一章。</span><span class="sxs-lookup"><span data-stu-id="7458b-1114">See also chapter [Software RAID][dbms-guide-2.2] of this document.</span></span> <span data-ttu-id="7458b-1115">這種方法可以簡化系統管理負荷來管理磁碟空間，並避免將檔案手動分散到多個掛接的 VHD。</span><span class="sxs-lookup"><span data-stu-id="7458b-1115">This approach simplifies the administration overhead to manage the disk space and avoids the effort of manually distributing files across multiple mounted VHDs.</span></span>
* <span data-ttu-id="7458b-1116">針對最高的 IOPS 需求，您可以使用 Azure 進階儲存體，這可以在 DS 系列和 GS 系列 VM 上使用。</span><span class="sxs-lookup"><span data-stu-id="7458b-1116">For the highest IOPS requirements, you can use Azure Premium Storage, which is available on DS-series and GS-series VMs.</span></span>

![適用於 SAP MaxDB DBMS 之 Azure IaaS VM 的參考組態][dbms-guide-figure-600]

#### <span data-ttu-id="7458b-1118"><a name="23c78d3b-ca5a-4e72-8a24-645d141a3f5d"></a>備份與還原</span><span class="sxs-lookup"><span data-stu-id="7458b-1118"><a name="23c78d3b-ca5a-4e72-8a24-645d141a3f5d"></a>Backup and Restore</span></span>
<span data-ttu-id="7458b-1119">將 SAP MaxDB 部署至 Azure 時，您必須檢閱備份方法。</span><span class="sxs-lookup"><span data-stu-id="7458b-1119">When deploying SAP MaxDB into Azure, you must review your backup methodology.</span></span> <span data-ttu-id="7458b-1120">即使系統不是生產系統，還是必須定期備份 SAP MaxDB 所裝載的 SAP 資料庫。</span><span class="sxs-lookup"><span data-stu-id="7458b-1120">Even if the system is not a productive system, the SAP database hosted by SAP MaxDB must be backed up periodically.</span></span> <span data-ttu-id="7458b-1121">由於 Azure 儲存體會保留三個映像，因此在保護系統以免發生儲存體失敗以及更重要的操作或系統管理失敗方面，備份現在已變得較不重要。</span><span class="sxs-lookup"><span data-stu-id="7458b-1121">Since Azure Storage keeps three images, a backup is now less important in terms of protecting your system against storage failure and more important operational or administrative failures.</span></span> <span data-ttu-id="7458b-1122">維護適當備份和還原方案的主要原因是，讓您可以藉由提供時間點復原功能來補償邏輯/手動錯誤。</span><span class="sxs-lookup"><span data-stu-id="7458b-1122">The primary reason for maintaining a proper backup and restore plan is so that you can compensate for logical or manual errors by providing point-in-time recovery capabilities.</span></span> <span data-ttu-id="7458b-1123">因此，目標是使用備份來將資料庫還原到某個時間點，或者藉由複製現有的資料庫，在 Azure 中使用備份來植入另一個系統。</span><span class="sxs-lookup"><span data-stu-id="7458b-1123">So the goal is to either use backups to restore the database to a certain point in time or to use the backups in Azure to seed another system by copying the existing database.</span></span> <span data-ttu-id="7458b-1124">例如，您可以藉由還原備份，從 2 層 SAP 組態轉移到同一個系統的 3 層系統設定。</span><span class="sxs-lookup"><span data-stu-id="7458b-1124">For example, you could transfer from a 2-tier SAP configuration to a 3-tier system setup of the same system by restoring a backup.</span></span>

<span data-ttu-id="7458b-1125">在 Azure 中備份和還原資料庫的運作方式與針對內部部署系統所做的一樣，因此您可以使用標準的 SAP MaxDB 備份/還原工具，這些工具的說明位於 SAP 附註 [767598]中所列的其中一份 SAP MaxDB 文件內。</span><span class="sxs-lookup"><span data-stu-id="7458b-1125">Backing up and restoring a database in Azure works the same way as it does for on-premises systems, so you can use standard SAP MaxDB backup/restore tools, which are described in one of the SAP MaxDB documentation documents listed in SAP Note [767598].</span></span>

#### <span data-ttu-id="7458b-1126"><a name="77cd2fbb-307e-4cbf-a65f-745553f72d2c"></a>備份與還原的效能考量</span><span class="sxs-lookup"><span data-stu-id="7458b-1126"><a name="77cd2fbb-307e-4cbf-a65f-745553f72d2c"></a>Performance Considerations for Backup and Restore</span></span>
<span data-ttu-id="7458b-1127">如同裸機部署，備份和還原效能取決於可以平行讀取的磁碟區數目，以及這些磁碟區的輸送量。</span><span class="sxs-lookup"><span data-stu-id="7458b-1127">As in bare-metal deployments, backup and restore performance is dependent on how many volumes can be read in parallel and the throughput of those volumes.</span></span> <span data-ttu-id="7458b-1128">此外，備份壓縮所使用的 CPU 耗用量在最多有 8 個 CPU 執行緒的 VM 上扮演重要的角色。</span><span class="sxs-lookup"><span data-stu-id="7458b-1128">In addition, the CPU consumption used by backup compression can play a significant role on VMs with up to 8 CPU threads.</span></span> <span data-ttu-id="7458b-1129">因此，您可以假設︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1129">Therefore, one can assume:</span></span>

* <span data-ttu-id="7458b-1130">用來儲存資料庫裝置的 VHD 數目越少，整體的讀取輸送量就越小</span><span class="sxs-lookup"><span data-stu-id="7458b-1130">The fewer the number of VHDs used to store the database devices, the lower the overall read throughput</span></span>
* <span data-ttu-id="7458b-1131">VM 中 CPU 執行緒數目越小，備份壓縮的影響就越嚴重</span><span class="sxs-lookup"><span data-stu-id="7458b-1131">The smaller the number of CPU threads in the VM, the more severe the impact of backup compression</span></span>
* <span data-ttu-id="7458b-1132">要寫入備份的目標 (等量目錄、VHD) 越少，輸送量就越低</span><span class="sxs-lookup"><span data-stu-id="7458b-1132">The fewer targets (Stripe Directories, VHDs) to write the backup to, the lower the throughput</span></span>

<span data-ttu-id="7458b-1133">若要增加要寫入的目標數目，根據您的需求，有兩個選項可以使用 (可能是在組合中)：</span><span class="sxs-lookup"><span data-stu-id="7458b-1133">To increase the number of targets to write to, there are two options that you can use, possibly in combination, depending on your needs:</span></span>

* <span data-ttu-id="7458b-1134">專門用來備份的個別磁碟區</span><span class="sxs-lookup"><span data-stu-id="7458b-1134">Dedicating separate volumes for backup</span></span>
* <span data-ttu-id="7458b-1135">在多個掛接的 VHD 上等量劃分備份目標磁碟區，以改善該等量磁碟區上的 IOPS 輸送量</span><span class="sxs-lookup"><span data-stu-id="7458b-1135">Striping the backup target volume over multiple mounted VHDs in order to improve the IOPS throughput on that striped disk volume</span></span>
* <span data-ttu-id="7458b-1136">有適用於下列各項的個別專用邏輯磁碟裝置︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1136">Having separate dedicated logical disk devices for:</span></span>
  * <span data-ttu-id="7458b-1137">SAP MaxDB 備份磁碟區 (也就是檔案)</span><span class="sxs-lookup"><span data-stu-id="7458b-1137">SAP MaxDB backup volumes (i.e. files)</span></span>
  * <span data-ttu-id="7458b-1138">SAP MaxDB 資料磁碟區 (也就是檔案)</span><span class="sxs-lookup"><span data-stu-id="7458b-1138">SAP MaxDB data volumes ( i.e. files)</span></span>
  * <span data-ttu-id="7458b-1139">SAP MaxDB 記錄磁碟區 (也就是檔案)</span><span class="sxs-lookup"><span data-stu-id="7458b-1139">SAP MaxDB log volumes ( i.e. files)</span></span>

<span data-ttu-id="7458b-1140">關於在多個掛接的 VHD 上等量劃分磁碟區，先前在本文件的[軟體 RAID][dbms-guide-2.2] 一章中已討論過。</span><span class="sxs-lookup"><span data-stu-id="7458b-1140">Striping a volume over multiple mounted VHDs has been discussed earlier in chapter [Software RAID][dbms-guide-2.2] of this document.</span></span>

#### <span data-ttu-id="7458b-1141"><a name="f77c1436-9ad8-44fb-a331-8671342de818"></a>其他</span><span class="sxs-lookup"><span data-stu-id="7458b-1141"><a name="f77c1436-9ad8-44fb-a331-8671342de818"></a>Other</span></span>
<span data-ttu-id="7458b-1142">所有其他一般主題 (例如「Azure 可用性設定組」或 SAP 監視) 也適用於使用 SAP MaxDB 資料庫來部署 VM 的情況，如本文件的前三章中所述。</span><span class="sxs-lookup"><span data-stu-id="7458b-1142">All other general topics such as Azure Availability Sets or SAP monitoring also apply as described in the first three chapters of this document for deployments of VMs with the SAP MaxDB database.</span></span>
<span data-ttu-id="7458b-1143">其他 SAP MaxDB 特定設定對 Azure VM 而言是在背景運作的，在 SAP 附註 [767598] 及下列 SAP 附註所列的不同文件中，都有提供這些設定的說明︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1143">Other SAP MaxDB-specific settings are transparent to Azure VMs and are described in different documents listed in SAP Note [767598] and in these SAP notes:</span></span>

* <span data-ttu-id="7458b-1144">[826037]</span><span class="sxs-lookup"><span data-stu-id="7458b-1144">[826037]</span></span>
* <span data-ttu-id="7458b-1145">[1139904]</span><span class="sxs-lookup"><span data-stu-id="7458b-1145">[1139904]</span></span>
* <span data-ttu-id="7458b-1146">[1173395]</span><span class="sxs-lookup"><span data-stu-id="7458b-1146">[1173395]</span></span>

## <a name="specifics-for-sap-livecache-on-windows"></a><span data-ttu-id="7458b-1147">Windows 上 SAP liveCache 專屬的詳細資料</span><span class="sxs-lookup"><span data-stu-id="7458b-1147">Specifics for SAP liveCache on Windows</span></span>
### <a name="sap-livecache-version-support"></a><span data-ttu-id="7458b-1148">SAP liveCache 版本支援</span><span class="sxs-lookup"><span data-stu-id="7458b-1148">SAP liveCache Version Support</span></span>
<span data-ttu-id="7458b-1149">「Azure 虛擬機器」中支援的 SAP liveCache 最低版本是針對 **EhP 2 for SAP SCM 7.0** 和更新版本發行的 **SAP LC/LCAPPS 10.0 SP 25** (包括 **liveCache 7.9.08.31** 和 **LCA-Build 25**)。</span><span class="sxs-lookup"><span data-stu-id="7458b-1149">Minimal version of SAP liveCache supported in Azure Virtual Machines is **SAP LC/LCAPPS 10.0 SP 25** including **liveCache 7.9.08.31** and **LCA-Build 25**, released for **EhP 2 for SAP SCM 7.0** and higher.</span></span>

### <a name="supported-microsoft-windows-versions-and-azure-vm-types-for-sap-livecache-dbms"></a><span data-ttu-id="7458b-1150">針對 SAP liveCache DBMS 支援的 Microsoft Windows 版本和 Azure VM 類型</span><span class="sxs-lookup"><span data-stu-id="7458b-1150">Supported Microsoft Windows Versions and Azure VM types for SAP liveCache DBMS</span></span>
<span data-ttu-id="7458b-1151">若要尋找在 Azure 上支援 SAP liveCache 的 Microsoft Windows 版本，請參閱︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1151">To find the supported Microsoft Windows version for SAP liveCache on Azure, see:</span></span>

* <span data-ttu-id="7458b-1152">[SAP 產品可用性對照表 (PAM)][sap-pam]</span><span class="sxs-lookup"><span data-stu-id="7458b-1152">[SAP Product Availability Matrix (PAM)][sap-pam]</span></span>
* <span data-ttu-id="7458b-1153">SAP 附註 [1928533]</span><span class="sxs-lookup"><span data-stu-id="7458b-1153">SAP Note [1928533]</span></span>

<span data-ttu-id="7458b-1154">強烈建議使用最新版本的作業系統 Microsoft Windows，也就是 Microsoft Windows 2012 R2。</span><span class="sxs-lookup"><span data-stu-id="7458b-1154">It is highly recommended to use the newest version of the operating system Microsoft Windows, which is Microsoft Windows 2012 R2.</span></span>

### <a name="sap-livecache-configuration-guidelines-for-sap-installations-in-azure-vms"></a><span data-ttu-id="7458b-1155">在 Azure VM 中安裝 SAP 的 SAP liveCache 組態指導方針</span><span class="sxs-lookup"><span data-stu-id="7458b-1155">SAP liveCache Configuration Guidelines for SAP Installations in Azure VMs</span></span>
#### <a name="recommended-azure-vm-types"></a><span data-ttu-id="7458b-1156">建議的 Azure VM 類型</span><span class="sxs-lookup"><span data-stu-id="7458b-1156">Recommended Azure VM Types</span></span>
<span data-ttu-id="7458b-1157">因為 SAP liveCache 是執行大量計算的應用程式，所以 RAM 與 CPU 的數量和速度會對 SAP liveCache 效能產生主要影響。</span><span class="sxs-lookup"><span data-stu-id="7458b-1157">As SAP liveCache is an application that performs huge calculations, the amount and speed of RAM and CPU has a major influence on SAP liveCache performance.</span></span>

<span data-ttu-id="7458b-1158">以 SAP 所支援的 Azure VM 類型 (SAP 附註 [1928533]) 來說，配置給 VM 的所有虛擬 CPU 資源都是以 Hypervisor 的專用實體 CPU 資源為後盾。</span><span class="sxs-lookup"><span data-stu-id="7458b-1158">For the Azure VM types supported by SAP (SAP Note [1928533]), all virtual CPU resources allocated to the VM are backed by dedicated physical CPU resources of the hypervisor.</span></span> <span data-ttu-id="7458b-1159">不會產生過度佈建 (因此不會產生 CPU 資源競爭)。</span><span class="sxs-lookup"><span data-stu-id="7458b-1159">No overprovisioning (and therefore no competition for CPU resources) takes place.</span></span>

<span data-ttu-id="7458b-1160">同樣地，針對 SAP 支援的所有 Azure VM 執行個體類型，VM 記憶體會完全對應到實體記憶體 – 例如，不會使用過度佈建 (過度使用)。</span><span class="sxs-lookup"><span data-stu-id="7458b-1160">Similarly, for all Azure VM instance types supported by SAP, the VM memory is 100 % mapped to the physical memory – overprovisioning (over-commitment), for example, is not used.</span></span>

<span data-ttu-id="7458b-1161">從這個觀點來看，強烈建議使用新的 D 系列或 DS 系列 (搭配 Azure 進階儲存體) 的 Azure VM 類型，因為它們所擁有的處理器速度比 A 系列快上 60 %。</span><span class="sxs-lookup"><span data-stu-id="7458b-1161">From this perspective it is highly recommended to use the new D- series or DS-series (in combination with Azure Premium Storage) Azure VM type, as they have 60 % faster processors than the A-series.</span></span> <span data-ttu-id="7458b-1162">針對最高的 RAM 與 CPU 負載，您可以使用 G 系列和 GS 系列 (搭配 Azure 進階儲存體) 的 VM，其中配備最新的 Intel® Xeon® 處理器 E5 v3 系列，具有兩倍的記憶體以及四倍的 D/DS 系列固態硬碟儲存體 (SSD)。</span><span class="sxs-lookup"><span data-stu-id="7458b-1162">For the highest RAM and CPU load, you can use G-series and GS-series (in combination with Azure Premium Storage) VMs with the latest Intel® Xeon® processor E5 v3 family, which have twice the memory and four times the solid state drive storage (SSDs) of the D/DS-series.</span></span>

#### <a name="storage-configuration"></a><span data-ttu-id="7458b-1163">儲存體組態</span><span class="sxs-lookup"><span data-stu-id="7458b-1163">Storage Configuration</span></span>
<span data-ttu-id="7458b-1164">由於 SAP liveCache 是以 SAP MaxDB 技術為基礎，因此[儲存體組態][dbms-guide-8.4.1]一章中針對 SAP MaxDB 提到的所有 Azure 儲存體最佳做法建議也適用於 SAP liveCache。</span><span class="sxs-lookup"><span data-stu-id="7458b-1164">As SAP liveCache is based on SAP MaxDB technology, all the Azure storage best practice recommendations mentioned for SAP MaxDB in chapter [Storage configuration][dbms-guide-8.4.1] are also valid for SAP liveCache.</span></span>

#### <a name="dedicated-azure-vm-for-livecache"></a><span data-ttu-id="7458b-1165">liveCache 專用的 Azure VM</span><span class="sxs-lookup"><span data-stu-id="7458b-1165">Dedicated Azure VM for liveCache</span></span>
<span data-ttu-id="7458b-1166">因為 SAP liveCache 會密集使用運算能力，所以針對可提高生產力的使用方式，強烈建議部署於專用的 Azure 虛擬機器上。</span><span class="sxs-lookup"><span data-stu-id="7458b-1166">As SAP liveCache intensively uses computational power, for productive usage it is highly recommended to deploy on a dedicated Azure Virtual Machine.</span></span>

![適用於具生產力使用案例的 liveCache 專用的 Azure VM][dbms-guide-figure-700]

#### <a name="backup-and-restore"></a><span data-ttu-id="7458b-1168">備份與還原</span><span class="sxs-lookup"><span data-stu-id="7458b-1168">Backup and Restore</span></span>
<span data-ttu-id="7458b-1169">備份與還原 (包括效能考量) 已經在相關的 SAP MaxDB 章節[備份與還原][dbms-guide-8.4.2]和[備份與還原的效能考量][dbms-guide-8.4.3]中做過說明。</span><span class="sxs-lookup"><span data-stu-id="7458b-1169">Backup and restore, including performance considerations, are already described in the relevant SAP MaxDB chapters [Backup and Restore][dbms-guide-8.4.2] and [Performance Considerations for Backup and Restore][dbms-guide-8.4.3].</span></span>

#### <a name="other"></a><span data-ttu-id="7458b-1170">其他</span><span class="sxs-lookup"><span data-stu-id="7458b-1170">Other</span></span>
<span data-ttu-id="7458b-1171">所有其他一般主題已經在[這個][dbms-guide-8.4.4]相關的 SAP MaxDB 章節中做過說明。</span><span class="sxs-lookup"><span data-stu-id="7458b-1171">All other general topics are already described in the relevant SAP MaxDB [this][dbms-guide-8.4.4] chapter.</span></span>

## <a name="specifics-for-the-sap-content-server-on-windows"></a><span data-ttu-id="7458b-1172">Windows 上 SAP 內容伺服器專用的詳細資料</span><span class="sxs-lookup"><span data-stu-id="7458b-1172">Specifics for the SAP Content Server on Windows</span></span>
<span data-ttu-id="7458b-1173">SAP 內容伺服器是個別的伺服器架構元件，可以不同格式儲存內容，例如電子文件。</span><span class="sxs-lookup"><span data-stu-id="7458b-1173">The SAP Content Server is a separate, server-based component to store content such as electronic documents in different formats.</span></span> <span data-ttu-id="7458b-1174">SAP 內容伺服器是透過技術開發來提供，可針對任何 SAP 應用程式跨應用程式加以使用。</span><span class="sxs-lookup"><span data-stu-id="7458b-1174">The SAP Content Server is provided by development of technology and is to be used cross-application for any SAP applications.</span></span> <span data-ttu-id="7458b-1175">它會安裝於不同的系統上。</span><span class="sxs-lookup"><span data-stu-id="7458b-1175">It is installed on a separate system.</span></span> <span data-ttu-id="7458b-1176">典型的內容是來自 Knowledge Warehouse 的訓練材料和文件，或者源自 mySAP PLM 文件管理系統的技術繪圖。</span><span class="sxs-lookup"><span data-stu-id="7458b-1176">Typical content is training material and documentation from Knowledge Warehouse or technical drawings originating from the mySAP PLM Document Management System.</span></span>

### <a name="sap-content-server-version-support"></a><span data-ttu-id="7458b-1177">SAP 內容伺服器版本支援</span><span class="sxs-lookup"><span data-stu-id="7458b-1177">SAP Content Server Version Support</span></span>
<span data-ttu-id="7458b-1178">SAP 目前支援：</span><span class="sxs-lookup"><span data-stu-id="7458b-1178">SAP currently supports:</span></span>

* <span data-ttu-id="7458b-1179">**SAP 內容伺服器**版本 **6.50 (和更新版本)**</span><span class="sxs-lookup"><span data-stu-id="7458b-1179">**SAP Content Server** with version **6.50 (and higher)**</span></span>
* <span data-ttu-id="7458b-1180">**SAP MaxDB 版本 7.9**</span><span class="sxs-lookup"><span data-stu-id="7458b-1180">**SAP MaxDB version 7.9**</span></span>
* <span data-ttu-id="7458b-1181">**Microsoft IIS (網際網路資訊伺服器) 版本 8.0 (和更新版本)**</span><span class="sxs-lookup"><span data-stu-id="7458b-1181">**Microsoft IIS (Internet Information Server) version 8.0 (and higher)**</span></span>

<span data-ttu-id="7458b-1182">強烈建議使用最新版的「SAP 內容伺服器」(在撰寫本文件時為 **6.50 SP4**)，以及最新版的 **Microsoft IIS 8.5**。</span><span class="sxs-lookup"><span data-stu-id="7458b-1182">It is highly recommended to use the newest version of SAP Content Server, which at the time of writing this document is **6.50 SP4**, and the newest version of **Microsoft IIS 8.5**.</span></span>

<span data-ttu-id="7458b-1183">請從 [SAP 產品可用性對照表 (PAM)][sap-pam] 中，查看支援的 SAP Content Server 與 Microsoft IIS 最新版本。</span><span class="sxs-lookup"><span data-stu-id="7458b-1183">Check the latest supported versions of SAP Content Server and Microsoft IIS in the [SAP Product Availability Matrix (PAM)][sap-pam].</span></span>

### <a name="supported-microsoft-windows-and-azure-vm-types-for-sap-content-server"></a><span data-ttu-id="7458b-1184">針對 SAP 內容伺服器支援的 Microsoft Windows 和 Azure VM 類型</span><span class="sxs-lookup"><span data-stu-id="7458b-1184">Supported Microsoft Windows and Azure VM types for SAP Content Server</span></span>
<span data-ttu-id="7458b-1185">若要找出在 Azure 上支援 SAP 內容伺服器的 Windows 版本，請參閱︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1185">To find out supported Windows version for SAP Content Server on Azure, see:</span></span>

* <span data-ttu-id="7458b-1186">[SAP 產品可用性對照表 (PAM)][sap-pam]</span><span class="sxs-lookup"><span data-stu-id="7458b-1186">[SAP Product Availability Matrix (PAM)][sap-pam]</span></span>
* <span data-ttu-id="7458b-1187">SAP 附註 [1928533]</span><span class="sxs-lookup"><span data-stu-id="7458b-1187">SAP Note [1928533]</span></span>

<span data-ttu-id="7458b-1188">強烈建議使用最新版的 Microsoft Windows (在撰寫本文件時為 **Windows Server 2012 R2**)。</span><span class="sxs-lookup"><span data-stu-id="7458b-1188">It is highly recommended to use the newest version of Microsoft Windows, which at the time of writing this document is **Windows Server 2012 R2**.</span></span>

### <a name="sap-content-server-configuration-guidelines-for-sap-installations-in-azure-vms"></a><span data-ttu-id="7458b-1189">在 Azure VM 中安裝 SAP 的 SAP 內容伺服器組態指導方針</span><span class="sxs-lookup"><span data-stu-id="7458b-1189">SAP Content Server Configuration Guidelines for SAP Installations in Azure VMs</span></span>
#### <a name="storage-configuration"></a><span data-ttu-id="7458b-1190">儲存體組態</span><span class="sxs-lookup"><span data-stu-id="7458b-1190">Storage Configuration</span></span>
<span data-ttu-id="7458b-1191">如果您將「SAP 內容伺服器」設定成將檔案儲存在 SAP MaxDB 資料庫中，則[儲存體組態][dbms-guide-8.4.1]一章中針對 SAP MaxDB 提到的所有 Azure 儲存體最佳做法建議也適用於「SAP 內容伺服器」案例。</span><span class="sxs-lookup"><span data-stu-id="7458b-1191">If you configure SAP Content Server to store files in the SAP MaxDB database, all Azure storage best practices recommendation mentioned for SAP MaxDB in chapter [Storage Configuration][dbms-guide-8.4.1] are also valid for the SAP Content Server scenario.</span></span>

<span data-ttu-id="7458b-1192">如果您設定 SAP 內容伺服器來將檔案儲存於檔案系統中，建議使用專用的邏輯磁碟機。</span><span class="sxs-lookup"><span data-stu-id="7458b-1192">If you configure SAP Content Server to store files in the file system, it is recommended to use a dedicated logical drive.</span></span> <span data-ttu-id="7458b-1193">使用儲存空間可讓您一併增加邏輯磁碟大小和 IOPS 輸送量，如[軟體 RAID][dbms-guide-2.2] 一章所述。</span><span class="sxs-lookup"><span data-stu-id="7458b-1193">Using storage spaces enables you to also increase logical disk size and IOPS throughput, as described in in chapter [Software RAID][dbms-guide-2.2].</span></span>

#### <a name="sap-content-server-location"></a><span data-ttu-id="7458b-1194">SAP 內容伺服器位置</span><span class="sxs-lookup"><span data-stu-id="7458b-1194">SAP Content Server Location</span></span>
<span data-ttu-id="7458b-1195">SAP 內容伺服器必須部署於部署 SAP 系統的相同 Azure 區域和 Azure VNET 中。</span><span class="sxs-lookup"><span data-stu-id="7458b-1195">SAP Content Server has to be deployed in the same Azure region and Azure VNET where the SAP system is deployed.</span></span> <span data-ttu-id="7458b-1196">您可以自行決定是否要在專用的 Azure VM 上或 SAP 系統執行所在的相同 VM 上部署 SAP 內容伺服器元件。</span><span class="sxs-lookup"><span data-stu-id="7458b-1196">You are free to decide whether you want to deploy SAP Content Server components on a dedicated Azure VM or on the same VM where the SAP system is running.</span></span>

![SAP 內容伺服器專用的 Azure VM][dbms-guide-figure-800]

#### <a name="sap-cache-server-location"></a><span data-ttu-id="7458b-1198">SAP 快取伺服器位置</span><span class="sxs-lookup"><span data-stu-id="7458b-1198">SAP Cache Server Location</span></span>
<span data-ttu-id="7458b-1199">SAP 快取伺服器是一個額外的伺服器架構元件，可提供在本機存取 (快取) 文件的權限。</span><span class="sxs-lookup"><span data-stu-id="7458b-1199">The SAP Cache Server is an additional server-based component to provide access to (cached) documents locally.</span></span> <span data-ttu-id="7458b-1200">SAP 快取伺服器會快取 SAP 內容伺服器的文件。</span><span class="sxs-lookup"><span data-stu-id="7458b-1200">The SAP Cache Server caches the documents of a SAP Content Server.</span></span> <span data-ttu-id="7458b-1201">如果必須從不同位置擷取文件一次以上，這樣可將網路流量最佳化。</span><span class="sxs-lookup"><span data-stu-id="7458b-1201">This is to optimize network traffic if documents have to be retrieved more than once from different locations.</span></span> <span data-ttu-id="7458b-1202">一般規則是 SAP 快取伺服器實際上必須接近可存取 SAP 快取伺服器的用戶端。</span><span class="sxs-lookup"><span data-stu-id="7458b-1202">The general rule is that the SAP Cache Server has to be physically close to the client that accesses the SAP Cache Server.</span></span>

<span data-ttu-id="7458b-1203">您有兩個選擇：</span><span class="sxs-lookup"><span data-stu-id="7458b-1203">Here you have two options:</span></span>

1. <span data-ttu-id="7458b-1204">**用戶端是後端 SAP 系統** - 如果已設定後端 SAP 系統來存取「SAP 內容伺服器」，則該 SAP 系統就是用戶端。</span><span class="sxs-lookup"><span data-stu-id="7458b-1204">**Client is a backend SAP system** If a backend SAP system is configured to access SAP Content Server, that SAP system is a client.</span></span> <span data-ttu-id="7458b-1205">由於 SAP 系統和 SAP 內容伺服器都會部署於同一個 Azure 區域 (在相同的 Azure 資料中心)，所以它們實際上是彼此接近的。</span><span class="sxs-lookup"><span data-stu-id="7458b-1205">As both SAP system and SAP Content Server are deployed in the same Azure region – in the same Azure datacenter – they are physically close to each other.</span></span> <span data-ttu-id="7458b-1206">因此，不需要有專用的 SAP 快取伺服器。</span><span class="sxs-lookup"><span data-stu-id="7458b-1206">Therefore, there is no need to have a dedicated SAP Cache Server.</span></span> <span data-ttu-id="7458b-1207">SAP UI 用戶端 (SAP GUI 或 Web 瀏覽器) 可直接存取 SAP 系統，而 SAP 系統會從 SAP 內容伺服器擷取文件。</span><span class="sxs-lookup"><span data-stu-id="7458b-1207">SAP UI clients (SAP GUI or web browser) access the SAP system directly, and the SAP system retrieves documents from the SAP Content Server.</span></span>
2. <span data-ttu-id="7458b-1208">**用戶端是內部部署的 Web 瀏覽器** - 可以將「SAP 內容伺服器」設定成供 Web 瀏覽器直接存取。</span><span class="sxs-lookup"><span data-stu-id="7458b-1208">**Client is an on-premises web browser** The SAP Content Server can be configured to be accessed directly by the web browser.</span></span> <span data-ttu-id="7458b-1209">在此情況下，在內部部署執行的 Web 瀏覽器就是 SAP 內容伺服器的用戶端。</span><span class="sxs-lookup"><span data-stu-id="7458b-1209">In this case, a web browser running on–premises is a client of the SAP Content Server.</span></span> <span data-ttu-id="7458b-1210">內部部署的資料中心與 Azure 資料中心位於不同的實體位置 (最好彼此接近)。</span><span class="sxs-lookup"><span data-stu-id="7458b-1210">On-premises datacenter and Azure datacenter are placed in different physical locations (ideally close to each other).</span></span> <span data-ttu-id="7458b-1211">您的內部部署資料中心是透過 Azure 站對站 VPN 或 ExpressRoute 連接到 Azure。</span><span class="sxs-lookup"><span data-stu-id="7458b-1211">Your on-premises datacenter is connected to Azure via Azure Site-to-Site VPN or ExpressRoute.</span></span> <span data-ttu-id="7458b-1212">雖然這兩個選項提供安全的 VPN 網路連線至 Azure，但站對站網路連接不會在內部部署的資料中心與 Azure 資料中心之間提供網路頻寬和延遲 SLA。</span><span class="sxs-lookup"><span data-stu-id="7458b-1212">Although both options offer secure VPN network connection to Azure, site-to-site network connection does not offer a network bandwidth and latency SLA between the on-premises datacenter and the Azure datacenter.</span></span> <span data-ttu-id="7458b-1213">若要加快文件的存取，您可以執行下列其中一項︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1213">To speed up access to documents, you can do one of the following:</span></span>
   1. <span data-ttu-id="7458b-1214">安裝內部部署的「SAP 快取伺服器」，使其靠近內部部署的 Web 瀏覽器 ([這張][dbms-guide-900-sap-cache-server-on-premises]圖中的選項)</span><span class="sxs-lookup"><span data-stu-id="7458b-1214">Install SAP Cache Server on-premises, close to the on-premises web browser (option on [this][dbms-guide-900-sap-cache-server-on-premises] Figure)</span></span>
   2. <span data-ttu-id="7458b-1215">設定 Azure ExpressRoute，提供內部部署的資料中心與 Azure 資料中心之間高速且低延遲的專用網路連接。</span><span class="sxs-lookup"><span data-stu-id="7458b-1215">Configure Azure ExpressRoute, which offers a high-speed and low-latency dedicated network connection between on-premises datacenter and Azure datacenter.</span></span>

<span data-ttu-id="7458b-1216">![安裝內部部署 SAP 快取伺服器的選項][dbms-guide-figure-900]
<a name="642f746c-e4d4-489d-bf63-73e80177a0a8"></a></span><span class="sxs-lookup"><span data-stu-id="7458b-1216">![Option to install SAP Cache Server on-premises][dbms-guide-figure-900]
<a name="642f746c-e4d4-489d-bf63-73e80177a0a8"></a></span></span>

#### <a name="backup--restore"></a><span data-ttu-id="7458b-1217">備份 / 還原</span><span class="sxs-lookup"><span data-stu-id="7458b-1217">Backup / Restore</span></span>
<span data-ttu-id="7458b-1218">如果您將「SAP 內容伺服器」設定成將檔案儲存在 SAP MaxDB 資料庫中，請參閱 SAP MaxDB 的[備份與還原][dbms-guide-8.4.2]一章及[備份與還原的效能考量][dbms-guide-8.4.3]一章中已提供的備份/還原程序和效能考量。</span><span class="sxs-lookup"><span data-stu-id="7458b-1218">If you configure the SAP Content Server to store files in the SAP MaxDB database, the backup/restore procedure and performance considerations are already described in SAP MaxDB chapter [Backup and Restore][dbms-guide-8.4.2] and chapter [Performance Considerations for Backup and Restore][dbms-guide-8.4.3].</span></span>

<span data-ttu-id="7458b-1219">如果您設定 SAP 內容伺服器來將檔案儲存於檔案系統中，有一個選項是針對文件所在的整個檔案結構執行手動備份/還原。</span><span class="sxs-lookup"><span data-stu-id="7458b-1219">If you configure the SAP Content Server to store files in the file system, one option is to execute manual backup/restore of the whole file structure where the documents are located.</span></span> <span data-ttu-id="7458b-1220">與 SAP MaxDB 備份/還原類似，基於備份目的，建議要有專用的磁碟區。</span><span class="sxs-lookup"><span data-stu-id="7458b-1220">Similar to SAP MaxDB backup/restore, it is recommended to have a dedicated disk volume for backup purpose.</span></span>

#### <a name="other"></a><span data-ttu-id="7458b-1221">其他</span><span class="sxs-lookup"><span data-stu-id="7458b-1221">Other</span></span>
<span data-ttu-id="7458b-1222">其他 SAP 內容伺服器特定的設定對於 Azure VM 是顯而易見的，相關說明請見各種文件和 SAP 附註︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1222">Other SAP Content Server specific settings are transparent to Azure VMs and are described in various documents and SAP Notes:</span></span>

* <span data-ttu-id="7458b-1223"><https://service.sap.com/contentserver></span><span class="sxs-lookup"><span data-stu-id="7458b-1223"><https://service.sap.com/contentserver></span></span>
* <span data-ttu-id="7458b-1224">SAP 附註 [1619726]</span><span class="sxs-lookup"><span data-stu-id="7458b-1224">SAP Note [1619726]</span></span>  

## <a name="specifics-to-ibm-db2-for-luw-on-windows"></a><span data-ttu-id="7458b-1225">Windows 上 IBM DB2 for LUW 專屬的詳細資料</span><span class="sxs-lookup"><span data-stu-id="7458b-1225">Specifics to IBM DB2 for LUW on Windows</span></span>
<span data-ttu-id="7458b-1226">使用 Microsoft Azure，您可以輕鬆地將目前在 IBM DB2 for Linux、UNIX 及 Windows (LUW) 上執行的 SAP 應用程式移轉至 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="7458b-1226">With Microsoft Azure, you can easily migrate your existing SAP application running on IBM DB2 for Linux, UNIX, and Windows (LUW) to Azure virtual machines.</span></span> <span data-ttu-id="7458b-1227">透過 IBM DB2 for LUW 上的 SAP，系統管理員和開發人員仍然可以使用可在內部部署使用的相同開發和管理工具。</span><span class="sxs-lookup"><span data-stu-id="7458b-1227">With SAP on IBM DB2 for LUW, administrators and developers can still use the same development and administration tools which are available on-premises.</span></span>
<span data-ttu-id="7458b-1228">如需有關在 IBM DB2 for LUW 上執行「SAP 商務套件」的一般資訊，請參閱「SAP 社群網路」(SCN)，網址：<https://scn.sap.com/community/db2-for-linux-unix-windows>。</span><span class="sxs-lookup"><span data-stu-id="7458b-1228">General information about running SAP Business Suite on IBM DB2 for LUW can be found in the SAP Community Network (SCN) at <https://scn.sap.com/community/db2-for-linux-unix-windows>.</span></span>

<span data-ttu-id="7458b-1229">如需有關 Azure 中 DB2 for LUW 上 SAP 的其他資訊和更新，請參閱 SAP 附註 [2233094]。</span><span class="sxs-lookup"><span data-stu-id="7458b-1229">For additional information and updates about SAP on DB2 for LUW on Azure, see SAP Note [2233094].</span></span>

### <a name="ibm-db2-for-linux-unix-and-windows-version-support"></a><span data-ttu-id="7458b-1230">IBM DB2 for Linux, UNIX, and Windows 支援版本</span><span class="sxs-lookup"><span data-stu-id="7458b-1230">IBM DB2 for Linux, UNIX, and Windows Version Support</span></span>
<span data-ttu-id="7458b-1231">當 DB2 版本為 10.5 時，支援 Microsoft Azure 虛擬機器中 IBM DB2 for LUW 上的 SAP。</span><span class="sxs-lookup"><span data-stu-id="7458b-1231">SAP on IBM DB2 for LUW on Microsoft Azure Virtual Machine Services is supported as of DB2 version 10.5.</span></span>

<span data-ttu-id="7458b-1232">如需有關支援之 SAP 產品和 Azure VM 類型的資訊，請參閱 SAP 附註 [1928533]。</span><span class="sxs-lookup"><span data-stu-id="7458b-1232">For information about supported SAP products and Azure VM types, please refer to SAP Note [1928533].</span></span>

### <a name="ibm-db2-for-linux-unix-and-windows-configuration-guidelines-for-sap-installations-in-azure-vms"></a><span data-ttu-id="7458b-1233">在 Azure VM 中安裝 SAP 的 IBM DB2 for Linux, UNIX, and Windows 組態指導方針</span><span class="sxs-lookup"><span data-stu-id="7458b-1233">IBM DB2 for Linux, UNIX, and Windows Configuration Guidelines for SAP Installations in Azure VMs</span></span>
#### <a name="storage-configuration"></a><span data-ttu-id="7458b-1234">儲存體組態</span><span class="sxs-lookup"><span data-stu-id="7458b-1234">Storage Configuration</span></span>
<span data-ttu-id="7458b-1235">所有的資料庫檔案都必須儲存於以 VHD 磁碟為基礎的 NTFS 檔案系統上。</span><span class="sxs-lookup"><span data-stu-id="7458b-1235">All database files must be stored on the NTFS file system based on VHD disks.</span></span> <span data-ttu-id="7458b-1236">這些 VHD 掛接到 Azure VM，並且根據 Azure 分頁 Blob 儲存體 (<https://msdn.microsoft.com/library/azure/ee691964.aspx>)。</span><span class="sxs-lookup"><span data-stu-id="7458b-1236">These VHDs are mounted to the Azure VM and are based in Azure Page BLOB Storage (<https://msdn.microsoft.com/library/azure/ee691964.aspx>).</span></span>
<span data-ttu-id="7458b-1237">針對資料庫檔案，「不」  支援任何類型的網路磁碟機或遠端共用 (例如下列的 Azure 檔案服務)︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1237">Any kind of network drives or remote shares like the following Azure file services are **NOT** supported for database files:</span></span>

* <span data-ttu-id="7458b-1238"><https://blogs.msdn.com/b/windowsazurestorage/archive/2014/05/12/introducing-microsoft-azure-file-service.aspx></span><span class="sxs-lookup"><span data-stu-id="7458b-1238"><https://blogs.msdn.com/b/windowsazurestorage/archive/2014/05/12/introducing-microsoft-azure-file-service.aspx></span></span>
* <span data-ttu-id="7458b-1239"><https://blogs.msdn.com/b/windowsazurestorage/archive/2014/05/27/persisting-connections-to-microsoft-azure-files.aspx></span><span class="sxs-lookup"><span data-stu-id="7458b-1239"><https://blogs.msdn.com/b/windowsazurestorage/archive/2014/05/27/persisting-connections-to-microsoft-azure-files.aspx></span></span>

<span data-ttu-id="7458b-1240">如果您是根據「Azure 分頁 BLOB 儲存體」使用 Azure VHD，則本文件的 [RDBMS 部署結構][dbms-guide-2]一章中所做的陳述也適用於利用「IBM DB2 for LUW 資料庫」所做的部署。</span><span class="sxs-lookup"><span data-stu-id="7458b-1240">If you are using Azure VHDs based on Azure Page BLOB Storage, the statements made in this document in chapter [Structure of a RDBMS Deployment][dbms-guide-2] also apply to deployments with the IBM DB2 for LUW Database.</span></span>

<span data-ttu-id="7458b-1241">如同先前在文件通用部分中所述，適用於 Azure VHD 的 IOPS 輸送量上有配額存在。</span><span class="sxs-lookup"><span data-stu-id="7458b-1241">As explained earlier in the general part of the document, quotas on IOPS throughput for Azure VHDs exist.</span></span> <span data-ttu-id="7458b-1242">確切的配額會根據使用的 VM 類型而定。</span><span class="sxs-lookup"><span data-stu-id="7458b-1242">The exact quotas depend on the VM type used.</span></span> <span data-ttu-id="7458b-1243">如需 VM 類型及其配額的清單，請參閱[這裡][virtual-machines-sizes]</span><span class="sxs-lookup"><span data-stu-id="7458b-1243">A list of VM types with their quotas can be found [here][virtual-machines-sizes]</span></span>

<span data-ttu-id="7458b-1244">只要每個磁碟上目前有足夠的 IOPS 配額，就可以將所有資料庫檔案儲存於單一已掛接的 Azure VHD 上。</span><span class="sxs-lookup"><span data-stu-id="7458b-1244">As long as the current IOPS quota per disk is sufficient, it is possible to store all the database files on one single mounted Azure VHD.</span></span>

<span data-ttu-id="7458b-1245">針對效能考量，也請參閱 SAP 安裝指南中的＜適用於資料庫目錄的資料安全性和效能考量＞章節。</span><span class="sxs-lookup"><span data-stu-id="7458b-1245">For performance considerations also refer to chapter “Data Safety and Performance Considerations for Database Directories” in SAP installation guides.</span></span>

<span data-ttu-id="7458b-1246">或者，您也可以使用「Windows 儲存集區」(僅適用於 Windows Server 2012 和更新版本) 或適用於 Windows 2008 R2 的 Windows 等量分割 (如本文件的[軟體 RAID][dbms-guide-2.2] 一章所述)，在多個已掛接的 VHD 磁碟上建立一個大型邏輯裝置。</span><span class="sxs-lookup"><span data-stu-id="7458b-1246">Alternatively, you can use Windows Storage Pools (only available in Windows Server 2012 and higher) or Windows striping for Windows 2008 R2 as described in chapter [Software RAID][dbms-guide-2.2] of this document to create one big logical device over multiple mounted VHD disks.</span></span>
<span data-ttu-id="7458b-1247">如果磁碟包含適用於您 sapdata 和 saptmp 目錄的 DB2 儲存路徑，您必須將實體磁碟磁區大小指定為 512 KB。</span><span class="sxs-lookup"><span data-stu-id="7458b-1247">For the disks containing the DB2 storage paths for your sapdata and saptmp directories, you must specify a physical disk sector size of 512 KB.</span></span> <span data-ttu-id="7458b-1248">使用 Windows 儲存集區時，您必須透過命令列介面，使用參數 „-LogicalSectorSizeDefault“，以手動方式建立儲存集區。</span><span class="sxs-lookup"><span data-stu-id="7458b-1248">When using Windows Storage Pools, you must create the storage pools  manually via command line interface using the parameter „-LogicalSectorSizeDefault“.</span></span> <span data-ttu-id="7458b-1249">如需詳細資訊，請參閱 <https://technet.microsoft.com/library/hh848689.aspx>。</span><span class="sxs-lookup"><span data-stu-id="7458b-1249">For details see <https://technet.microsoft.com/library/hh848689.aspx>.</span></span>

#### <a name="backuprestore"></a><span data-ttu-id="7458b-1250">備份/還原</span><span class="sxs-lookup"><span data-stu-id="7458b-1250">Backup/Restore</span></span>
<span data-ttu-id="7458b-1251">針對 IBM DB2 for LUW 的備份/還原功能，是利用與標準 Windows Server 作業系統和 Hyper-V 上所做的相同方式來支援。</span><span class="sxs-lookup"><span data-stu-id="7458b-1251">The backup/restore functionality for IBM DB2 for LUW is supported in the same way as on standard Windows Server Operating Systems and Hyper-V.</span></span>

<span data-ttu-id="7458b-1252">您必須確定您擁有恰當且有效的資料庫備份策略。</span><span class="sxs-lookup"><span data-stu-id="7458b-1252">You must make sure that you have a valid database backup strategy in place.</span></span>

<span data-ttu-id="7458b-1253">如同裸機部署，備份/還原效能取決於可以平行讀取的磁碟區數目，以及這些磁碟區可能的輸送量。</span><span class="sxs-lookup"><span data-stu-id="7458b-1253">As in bare-metal deployments, backup/restore performance depends on how many volumes can be read in parallel and what the throughput of those volumes might be.</span></span> <span data-ttu-id="7458b-1254">此外，備份壓縮所使用的 CPU 耗用量可能會在最多只有 8 個 CPU 執行緒的 VM 上扮演重要的角色。</span><span class="sxs-lookup"><span data-stu-id="7458b-1254">In addition, the CPU consumption used by backup compression may play a significant role on VMs with just up to 8 CPU threads.</span></span> <span data-ttu-id="7458b-1255">因此，您可以假設︰</span><span class="sxs-lookup"><span data-stu-id="7458b-1255">Therefore, one can assume:</span></span>

* <span data-ttu-id="7458b-1256">用來儲存資料庫裝置的 VHD 數目越少，讀取的整體輸送量就越小</span><span class="sxs-lookup"><span data-stu-id="7458b-1256">The fewer the number of VHDs used to store the database devices, the smaller the overall throughput in reading</span></span>
* <span data-ttu-id="7458b-1257">VM 中 CPU 執行緒數目越小，備份壓縮的影響就越嚴重</span><span class="sxs-lookup"><span data-stu-id="7458b-1257">The smaller the number of CPU threads in the VM, the more severe the impact of backup compression</span></span>
* <span data-ttu-id="7458b-1258">要寫入備份的目標 (等量目錄、VHD) 越少，輸送量就越低</span><span class="sxs-lookup"><span data-stu-id="7458b-1258">The fewer targets (Stripe Directories, VHDs) to write the backup to, the lower the throughput</span></span>

<span data-ttu-id="7458b-1259">若要增加要寫入的目標數目，根據您的需求，有兩個選項可以使用/相結合：</span><span class="sxs-lookup"><span data-stu-id="7458b-1259">To increase the number of targets to write to, two options can be used/combined depending on your needs:</span></span>

* <span data-ttu-id="7458b-1260">在多個掛接的 VHD 上等量劃分備份目標磁碟區，以改善該等量磁碟區上的 IOPS 輸送量</span><span class="sxs-lookup"><span data-stu-id="7458b-1260">Striping the backup target volume over multiple mounted VHDs in order to improve the IOPS throughput on that striped volume</span></span>
* <span data-ttu-id="7458b-1261">使用一個以上的目標目錄來寫入備份</span><span class="sxs-lookup"><span data-stu-id="7458b-1261">Using more than one target directory to write the backup to</span></span>

#### <a name="high-availability-and-disaster-recovery"></a><span data-ttu-id="7458b-1262">高可用性和災害復原</span><span class="sxs-lookup"><span data-stu-id="7458b-1262">High Availability and Disaster Recovery</span></span>
<span data-ttu-id="7458b-1263">不支援 Microsoft Cluster Server (MSCS)。</span><span class="sxs-lookup"><span data-stu-id="7458b-1263">Microsoft Cluster Server (MSCS) is not supported.</span></span>

<span data-ttu-id="7458b-1264">支援 DB2 高可用性災害復原 (HADR)。</span><span class="sxs-lookup"><span data-stu-id="7458b-1264">DB2 high availability disaster recovery (HADR) is supported.</span></span> <span data-ttu-id="7458b-1265">如果 HA 組態的虛擬機器具有運作中的名稱解析，則 Azure 中的設定與內部部署中完成的任何設定並無任何差別。</span><span class="sxs-lookup"><span data-stu-id="7458b-1265">If the virtual machines of the HA configuration have working name resolution, the setup in Azure will not differ from any setup that is done on-premises.</span></span> <span data-ttu-id="7458b-1266">不建議只依賴 IP 解析。</span><span class="sxs-lookup"><span data-stu-id="7458b-1266">It is not recommended to rely on IP resolution only.</span></span>

<span data-ttu-id="7458b-1267">請勿使用 Azure 市集異地複寫。</span><span class="sxs-lookup"><span data-stu-id="7458b-1267">Do not use Azure Store Geo-Replication.</span></span> <span data-ttu-id="7458b-1268">如需進一步的資訊，請參閱 [Microsoft Azure 儲存體][dbms-guide-2.3]一章和 [Azure VM 的相關高可用性和災害復原][dbms-guide-3]一章。</span><span class="sxs-lookup"><span data-stu-id="7458b-1268">For further information, refer to chapter [Microsoft Azure Storage][dbms-guide-2.3] and chapter [High Availability and Disaster Recovery with Azure VMs][dbms-guide-3].</span></span>

#### <a name="other"></a><span data-ttu-id="7458b-1269">其他</span><span class="sxs-lookup"><span data-stu-id="7458b-1269">Other</span></span>
<span data-ttu-id="7458b-1270">所有其他一般主題 (例如「Azure 可用性設定組」或 SAP 監視) 也適用於使用 IBM DB2 for LUW 來部署 VM 的情況，如本文件的前三章中所述。</span><span class="sxs-lookup"><span data-stu-id="7458b-1270">All other general topics like Azure Availability Sets or SAP monitoring apply as described in the first three chapters of this document for deployments of VMs with IBM DB2 for LUW as well.</span></span>

<span data-ttu-id="7458b-1271">另請參閱[適用於 Azure 上 SAP 的一般 SQL Server 摘要][dbms-guide-5.8]。</span><span class="sxs-lookup"><span data-stu-id="7458b-1271">Also refer to chapter [General SQL Server for SAP on Azure Summary][dbms-guide-5.8].</span></span>
