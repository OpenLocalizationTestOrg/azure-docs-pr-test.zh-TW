---
title: "設定 Azure 虛擬機器中的 Always On 可用性群組 (傳統) | Microsoft Docs"
description: "使用 Azure 虛擬機器建立 Always On 可用性群組。 本教學課程主要是透過使用者介面作業，而非編寫指令碼。"
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: 8d48a3d2-79f8-4ab0-9327-2f30ee0b2ff1
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 03/17/2017
ms.author: mikeray
ms.openlocfilehash: b360fe9f28eeb9b10c82fce729165b1b572ac3c6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="configure-always-on-availability-group-in-azure-virtual-machines-classic"></a><span data-ttu-id="faa08-104">設定 Azure 虛擬機器中的 Always On 可用性群組 (傳統)</span><span class="sxs-lookup"><span data-stu-id="faa08-104">Configure Always On availability group in Azure Virtual Machines (classic)</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="faa08-105">傳統：UI</span><span class="sxs-lookup"><span data-stu-id="faa08-105">Classic: UI</span></span>](../classic/portal-sql-alwayson-availability-groups.md)
> * <span data-ttu-id="faa08-106">[傳統：PowerShell](../classic/ps-sql-alwayson-availability-groups.md)
</span><span class="sxs-lookup"><span data-stu-id="faa08-106">[Classic: PowerShell](../classic/ps-sql-alwayson-availability-groups.md)
</span></span><br/>

<span data-ttu-id="faa08-107">請在開始之前仔細思考一下，您現在已經可以在 Azure Resource Manager 模型中完成這項工作。</span><span class="sxs-lookup"><span data-stu-id="faa08-107">Before you begin, consider that you can now complete this task in Azure Resource Manager model.</span></span> <span data-ttu-id="faa08-108">我們建議新的部署採用 Azure Resource Manager 模型。</span><span class="sxs-lookup"><span data-stu-id="faa08-108">We recommend Azure Resource Manager model for new deployments.</span></span> <span data-ttu-id="faa08-109">請參閱 [Azure 虛擬機器上的 SQL Server Always On 可用性群組](../sql/virtual-machines-windows-portal-sql-availability-group-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="faa08-109">See [SQL Server Always On availability groups on Azure virtual machines](../sql/virtual-machines-windows-portal-sql-availability-group-overview.md).</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="faa08-110">Microsoft 建議讓大部分的新部署使用資源管理員模式。</span><span class="sxs-lookup"><span data-stu-id="faa08-110">Microsoft recommends that most new deployments use the Resource Manager model.</span></span> <span data-ttu-id="faa08-111">Azure 建立和處理資源的部署模型有二種：[Resource Manager 和傳統](../../../azure-resource-manager/resource-manager-deployment-model.md)。</span><span class="sxs-lookup"><span data-stu-id="faa08-111">Azure has two different deployment models to create and work with resources: [Resource Manager and classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="faa08-112">本文說明如何使用傳統部署模型。</span><span class="sxs-lookup"><span data-stu-id="faa08-112">This article explains how to use the classic deployment model.</span></span> 

<span data-ttu-id="faa08-113">若要使用 Azure Resource Manager 模型來完成這項工作，請參閱 [Azure 虛擬機器上的 SQL Server Always On 可用性群組](../sql/virtual-machines-windows-portal-sql-availability-group-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="faa08-113">To complete this task with the Azure Resource Manager model, see [SQL Server Always On availability groups on Azure virtual machines](../sql/virtual-machines-windows-portal-sql-availability-group-overview.md).</span></span>

<span data-ttu-id="faa08-114">本端對端教學課程將示範如何透過在 Azure 虛擬機器上執行的 SQL Server Always On 實作可用性群組。</span><span class="sxs-lookup"><span data-stu-id="faa08-114">This end-to-end tutorial shows you how to implement availability groups by using SQL Server Always On running on Azure Virtual Machines.</span></span>

<span data-ttu-id="faa08-115">在本教學課程結束時，您 Azure 中的 SQL Server Always On 解決方案將包含下列項目：</span><span class="sxs-lookup"><span data-stu-id="faa08-115">At the end of the tutorial, your SQL Server Always On solution in Azure will consist of the following elements:</span></span>

* <span data-ttu-id="faa08-116">包含多個子網路並包括前端和後端子網路的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="faa08-116">A virtual network that contains multiple subnets and includes a frontend and a backend subnet</span></span>
* <span data-ttu-id="faa08-117">具有 Active Directory (Azure AD) 網域的網域控制站</span><span class="sxs-lookup"><span data-stu-id="faa08-117">A domain controller with an Active Directory (Azure AD) domain</span></span>
* <span data-ttu-id="faa08-118">執行 SQL Server 的兩部虛擬機器已部署至後端子網路並加入 Azure AD 網域</span><span class="sxs-lookup"><span data-stu-id="faa08-118">Two virtual machines that run SQL Server and are deployed to the backend subnet and joined to the Azure AD domain</span></span>
* <span data-ttu-id="faa08-119">具有節點多數仲裁模型的 3 節點容錯移轉叢集</span><span class="sxs-lookup"><span data-stu-id="faa08-119">A three-node failover cluster with the Node Majority quorum model</span></span>
* <span data-ttu-id="faa08-120">具有兩份可用性資料庫同步認可複本的可用性群組</span><span class="sxs-lookup"><span data-stu-id="faa08-120">An availability group that has two synchronous-commit replicas of an availability database</span></span>

<span data-ttu-id="faa08-121">下圖將解決方案以圖形呈現。</span><span class="sxs-lookup"><span data-stu-id="faa08-121">The following illustration is a graphical representation of the solution.</span></span>

![Azure 中可用性群組的測試實驗室架構](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC791912.png)

<span data-ttu-id="faa08-123">請注意以下這是一個可用的組態。</span><span class="sxs-lookup"><span data-stu-id="faa08-123">Note that this is one possible configuration.</span></span> <span data-ttu-id="faa08-124">例如，您可以盡量減少兩個複本的可用性群組的虛擬機器數目。</span><span class="sxs-lookup"><span data-stu-id="faa08-124">For example, you can minimize the number of virtual machines for a two-replica availability group.</span></span> <span data-ttu-id="faa08-125">此設定使用網域控制器作為兩個節點叢集中的仲裁檔案共用見證，以節省 Azure 中的計算時數。</span><span class="sxs-lookup"><span data-stu-id="faa08-125">This configuration saves on compute hours in Azure by using the domain controller as the quorum file share witness in a two-node cluster.</span></span> <span data-ttu-id="faa08-126">這個方法可讓設定圖例中虛擬機器數目減少一個。</span><span class="sxs-lookup"><span data-stu-id="faa08-126">This method reduces the virtual machine count by one from the illustrated configuration.</span></span>

<span data-ttu-id="faa08-127">本教學課程假設您已句備下列條件：</span><span class="sxs-lookup"><span data-stu-id="faa08-127">This tutorial assumes the following:</span></span>

* <span data-ttu-id="faa08-128">您已經有 Azure 帳戶。</span><span class="sxs-lookup"><span data-stu-id="faa08-128">You already have an Azure account.</span></span>
* <span data-ttu-id="faa08-129">您已經知道如何在虛擬機器資源庫中使用 GUI，以佈建執行 SQL Server 的傳統虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="faa08-129">You already know how to use the GUI in the virtual machine gallery to provision a classic virtual machine that runs SQL Server.</span></span>
* <span data-ttu-id="faa08-130">您已非常熟悉 Always On 可用性群組的功能。</span><span class="sxs-lookup"><span data-stu-id="faa08-130">You already have a solid understanding of Always On availability groups.</span></span> <span data-ttu-id="faa08-131">如需詳細資訊，請參閱 [Always On 可用性群組 (SQL Server)](https://msdn.microsoft.com/library/hh510230.aspx)。</span><span class="sxs-lookup"><span data-stu-id="faa08-131">For more information, see [Always On Availability Groups (SQL Server)](https://msdn.microsoft.com/library/hh510230.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="faa08-132">如想將 Always On 可用性群組與 SharePoint 搭配使用，另請參閱[為 SharePoint 2013 設定 SQL Server 2012 Always On 可用性群組](https://technet.microsoft.com/library/jj715261.aspx)。</span><span class="sxs-lookup"><span data-stu-id="faa08-132">If you are interested in using Always On availability groups with SharePoint, also see [Configure SQL Server 2012 Always On Availability Groups for SharePoint 2013](https://technet.microsoft.com/library/jj715261.aspx).</span></span>
> 
> 

## <a name="create-the-virtual-network-and-domain-controller-server"></a><span data-ttu-id="faa08-133">建立虛擬網路和網域控制站伺服器</span><span class="sxs-lookup"><span data-stu-id="faa08-133">Create the virtual network and domain controller server</span></span>
<span data-ttu-id="faa08-134">一開始先建立新的 Azure 試用帳戶。</span><span class="sxs-lookup"><span data-stu-id="faa08-134">You begin with a new Azure trial account.</span></span> <span data-ttu-id="faa08-135">設定您的帳戶後，系統會將您導向 Azure 傳統入口網站的主畫面。</span><span class="sxs-lookup"><span data-stu-id="faa08-135">After you set up your account, you should be on the home screen of the Azure classic portal.</span></span>

1. <span data-ttu-id="faa08-136">按一下頁面左下角的 [新增]  按鈕，如下列螢幕擷取畫面所示。</span><span class="sxs-lookup"><span data-stu-id="faa08-136">Click the **New** button at the left corner of the bottom of the page, as shown in the following screenshot.</span></span>
   
    ![在入口網站中按一下 [新增]](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665511.gif)
2. <span data-ttu-id="faa08-138">依序按一下 [新增]  >  [網絡服務]  >  [虛擬網路]  [自訂建立]，如下列螢幕擷取畫面所示。</span><span class="sxs-lookup"><span data-stu-id="faa08-138">Click **Network Services** > **Virtual Network** > **Custom Create**, as shown in the following screenshot.</span></span>
   
    ![建立虛擬網路](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665512.gif)
3. <span data-ttu-id="faa08-140">在 [建立虛擬網路]  對話方塊中，透過套用下表設定以通過精靈中的頁面，來建立新的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="faa08-140">In the **CREATE A VIRTUAL NETWORK** dialog box, create a new virtual network by stepping through the pages and using the settings in the following table.</span></span> 
   
   | <span data-ttu-id="faa08-141">Page</span><span class="sxs-lookup"><span data-stu-id="faa08-141">Page</span></span> | <span data-ttu-id="faa08-142">設定</span><span class="sxs-lookup"><span data-stu-id="faa08-142">Settings</span></span> |
   | --- | --- |
   | <span data-ttu-id="faa08-143">虛擬網路詳細資料</span><span class="sxs-lookup"><span data-stu-id="faa08-143">Virtual Network Details</span></span> |<span data-ttu-id="faa08-144">**名稱 = ContosoNET**</span><span class="sxs-lookup"><span data-stu-id="faa08-144">**NAME = ContosoNET**</span></span><br/><span data-ttu-id="faa08-145">**地區 = 美國西部**</span><span class="sxs-lookup"><span data-stu-id="faa08-145">**REGION = West US**</span></span> |
   | <span data-ttu-id="faa08-146">DNS 伺服器和 VPN 連線能力</span><span class="sxs-lookup"><span data-stu-id="faa08-146">DNS Servers and VPN Connectivity</span></span> |<span data-ttu-id="faa08-147">None</span><span class="sxs-lookup"><span data-stu-id="faa08-147">None</span></span> |
   | <span data-ttu-id="faa08-148">虛擬網路位址空間</span><span class="sxs-lookup"><span data-stu-id="faa08-148">Virtual Network Address Spaces</span></span> |<span data-ttu-id="faa08-149">設定如下列螢幕擷取畫面所示：</span><span class="sxs-lookup"><span data-stu-id="faa08-149">Settings are shown in the following screenshot:</span></span> ![建立虛擬網路](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784620.png) |
4. <span data-ttu-id="faa08-151">建立要做為網域控制站 (DC) 的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="faa08-151">Create the virtual machine that you will use as the domain controller (DC).</span></span> <span data-ttu-id="faa08-152">依序按一下 [新增] >  [計算]  >  [虛擬機器]  >  [從資源庫] ，如下列螢幕擷取畫面所示。</span><span class="sxs-lookup"><span data-stu-id="faa08-152">Click **New** > **Compute** > **Virtual Machine** > **From Gallery**, as shown in the following screenshot.</span></span>
   
    ![建立虛擬機器](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784621.png)
5. <span data-ttu-id="faa08-154">在 [建立虛擬網路]  對話方塊中，透過套用下表設定以通過精靈中的頁面，來設定新的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="faa08-154">In the **CREATE A VIRTUAL MACHINE** dialog box, configure a new virtual machine by stepping through the pages and using the settings in the following table.</span></span> 
   
   | <span data-ttu-id="faa08-155">Page</span><span class="sxs-lookup"><span data-stu-id="faa08-155">Page</span></span> | <span data-ttu-id="faa08-156">設定</span><span class="sxs-lookup"><span data-stu-id="faa08-156">Settings</span></span> |
   | --- | --- |
   | <span data-ttu-id="faa08-157">選取虛擬機器作業系統</span><span class="sxs-lookup"><span data-stu-id="faa08-157">Select the virtual machine operating system</span></span> |<span data-ttu-id="faa08-158">Windows Server 2012 R2 Datacenter</span><span class="sxs-lookup"><span data-stu-id="faa08-158">Windows Server 2012 R2 Datacenter</span></span> |
   | <span data-ttu-id="faa08-159">虛擬機器組態</span><span class="sxs-lookup"><span data-stu-id="faa08-159">Virtual machine configuration</span></span> |<span data-ttu-id="faa08-160">**版本發行日期** = (最新版本)</span><span class="sxs-lookup"><span data-stu-id="faa08-160">**VERSION RELEASE DATE** = (latest)</span></span><br/><span data-ttu-id="faa08-161">**虛擬機器名稱** = ContosoDC</span><span class="sxs-lookup"><span data-stu-id="faa08-161">**VIRTUAL MACHINE NAME** = ContosoDC</span></span><br/><span data-ttu-id="faa08-162">**層** = 標準</span><span class="sxs-lookup"><span data-stu-id="faa08-162">**TIER** = STANDARD</span></span><br/><span data-ttu-id="faa08-163">**大小** = A2 (2 核心)</span><span class="sxs-lookup"><span data-stu-id="faa08-163">**SIZE** = A2 (2 cores)</span></span><br/><span data-ttu-id="faa08-164">**新使用者名稱** = AzureAdmin</span><span class="sxs-lookup"><span data-stu-id="faa08-164">**NEW USER NAME** = AzureAdmin</span></span><br/><span data-ttu-id="faa08-165">**新密碼** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="faa08-165">**NEW PASSWORD** = Contoso!000</span></span><br/><span data-ttu-id="faa08-166">**確認** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="faa08-166">**CONFIRM** = Contoso!000</span></span> |
   | <span data-ttu-id="faa08-167">虛擬機器組態</span><span class="sxs-lookup"><span data-stu-id="faa08-167">Virtual machine configuration</span></span> |<span data-ttu-id="faa08-168">**雲端服務** = 建立新的雲端服務</span><span class="sxs-lookup"><span data-stu-id="faa08-168">**CLOUD SERVICE** = Create a new cloud service</span></span><br/><span data-ttu-id="faa08-169">**雲端服務 DNS 名稱** = 唯一的雲端服務名稱</span><span class="sxs-lookup"><span data-stu-id="faa08-169">**CLOUD SERVICE DNS NAME** = A unique cloud service name</span></span><br/><span data-ttu-id="faa08-170">**DNS 名稱** = 唯一的名稱 (例如：ContosoDC123)</span><span class="sxs-lookup"><span data-stu-id="faa08-170">**DNS NAME** = A unique name (ex: ContosoDC123)</span></span><br/><span data-ttu-id="faa08-171">**區域/同質群組/虛擬網路** = ContosoNET</span><span class="sxs-lookup"><span data-stu-id="faa08-171">**REGION/AFFINITY GROUP/VIRTUAL NETWORK** = ContosoNET</span></span><br/><span data-ttu-id="faa08-172">**虛擬網路子網路** = Back(10.10.2.0/24)</span><span class="sxs-lookup"><span data-stu-id="faa08-172">**VIRTUAL NETWORK SUBNETS** = Back(10.10.2.0/24)</span></span><br/><span data-ttu-id="faa08-173">**儲存體帳戶** = 使用自動產生的儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="faa08-173">**STORAGE ACCOUNT** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="faa08-174">**可用性設定組** = (無)</span><span class="sxs-lookup"><span data-stu-id="faa08-174">**AVAILABILITY SET** = (None)</span></span> |
   | <span data-ttu-id="faa08-175">虛擬機器選項</span><span class="sxs-lookup"><span data-stu-id="faa08-175">Virtual machine options</span></span> |<span data-ttu-id="faa08-176">使用預設值</span><span class="sxs-lookup"><span data-stu-id="faa08-176">Use defaults</span></span> |

<span data-ttu-id="faa08-177">您設定新的虛擬機器之後，請等候虛擬機器佈建完成。</span><span class="sxs-lookup"><span data-stu-id="faa08-177">After you configure the new virtual machine, wait for the virtual machine to be provsioned.</span></span> <span data-ttu-id="faa08-178">這個程序需要一些時間才能完成。</span><span class="sxs-lookup"><span data-stu-id="faa08-178">This process takes some time to finish.</span></span> <span data-ttu-id="faa08-179">此程序需要一些時間才能完成，如果您按一下 Azure 傳統入口網站中的 [虛擬機器] 索引標籤，您會看到 ContosoDC 的循環狀態從 [啟動中 (佈建中)] 變成 [停止]、[啟動中]、[執行中 (佈建中)]，最後 [執行中]。</span><span class="sxs-lookup"><span data-stu-id="faa08-179">If you click the **Virtual Machine** tab in the Azure classic portal, you can see ContosoDC cycling states from **Starting (Provisioning)** to **Stopped**, **Starting**, **Running (Provisioning)**, and finally **Running**.</span></span>

<span data-ttu-id="faa08-180">現在已成功佈建 DC 伺服器。</span><span class="sxs-lookup"><span data-stu-id="faa08-180">The DC server is now successfully provisioned.</span></span> <span data-ttu-id="faa08-181">接下來，您將在這個 DC 伺服器上設定 Active Directory 網域。</span><span class="sxs-lookup"><span data-stu-id="faa08-181">Next, you will configure the Active Directory domain on this DC server.</span></span>

## <a name="configure-the-domain-controller"></a><span data-ttu-id="faa08-182">設定網域控制站</span><span class="sxs-lookup"><span data-stu-id="faa08-182">Configure the domain controller</span></span>
<span data-ttu-id="faa08-183">下列步驟將帶您把 ContosoDC 電腦設定為 corp.contoso.com 的網域控制站。</span><span class="sxs-lookup"><span data-stu-id="faa08-183">In the following steps, you configure the ContosoDC machine as a domain controller for corp.contoso.com.</span></span>

1. <span data-ttu-id="faa08-184">在入口網站中，選取 [ContosoDC]  電腦。</span><span class="sxs-lookup"><span data-stu-id="faa08-184">In the portal, select the **ContosoDC** machine.</span></span> <span data-ttu-id="faa08-185">在 [儀表板]  索引標籤上按一下 [連接] ，開啟遠端桌面存取的遠端桌面 (RDP) 檔案。</span><span class="sxs-lookup"><span data-stu-id="faa08-185">On the **Dashboard** tab, click **Connect** to open a remote desktop (RDP) file for remote desktop access.</span></span>
   
    ![連接至虛擬機器](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784622.png)
2. <span data-ttu-id="faa08-187">以所設定的系統管理員帳戶 (**\AzureAdmin**) 和密碼 (**Contoso!000**) 登入。</span><span class="sxs-lookup"><span data-stu-id="faa08-187">Sign in with your configured administrator account (**\AzureAdmin**) and password (**Contoso!000**).</span></span>
3. <span data-ttu-id="faa08-188">根據預設，應會顯示 [伺服器管理員]  儀表板。</span><span class="sxs-lookup"><span data-stu-id="faa08-188">By default, the **Server Manager** dashboard should be displayed.</span></span>
4. <span data-ttu-id="faa08-189">按一下儀表板上的 [新增角色與功能]  連結。</span><span class="sxs-lookup"><span data-stu-id="faa08-189">Click the **Add roles and features** link on the dashboard.</span></span>
   
    ![透過 [伺服器總管] 新增角色](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784623.png)
5. <span data-ttu-id="faa08-191">按一下 [下一步] ，直到進入 [伺服器角色]  區段。</span><span class="sxs-lookup"><span data-stu-id="faa08-191">Click **Next** until you get to the **Server Roles** section.</span></span>
6. <span data-ttu-id="faa08-192">選取 [Active Directory Domain Services] 和 [DNS 伺服器] 角色。</span><span class="sxs-lookup"><span data-stu-id="faa08-192">Select the **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="faa08-193">出現提示時，新增這些角色需要的更多功能。</span><span class="sxs-lookup"><span data-stu-id="faa08-193">When prompted, add more features that these roles require.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="faa08-194">螢幕會顯示無靜態 IP 位址的驗證警告。</span><span class="sxs-lookup"><span data-stu-id="faa08-194">You will get a validation warning that there is no static IP address.</span></span> <span data-ttu-id="faa08-195">如果您是要測試組態，請按一下 [繼續] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-195">If you are testing the configuration, click **Continue**.</span></span> <span data-ttu-id="faa08-196">實際操作時，請 [使用 PowerShell 設定網域控制站電腦的靜態 IP 位址](../../../virtual-network/virtual-networks-reserved-private-ip.md)。</span><span class="sxs-lookup"><span data-stu-id="faa08-196">For production scenarios [use PowerShell to set the static IP address of the domain controller machine](../../../virtual-network/virtual-networks-reserved-private-ip.md).</span></span>
   > 
   > 
   
    ![新增角色對話方塊](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784624.png)
7. <span data-ttu-id="faa08-198">連續按 [下一步] 直到到達 [確認] 區段。</span><span class="sxs-lookup"><span data-stu-id="faa08-198">Click **Next** until you reach the **Confirmation** section.</span></span> <span data-ttu-id="faa08-199">選取 [必要時自動重新啟動目的地伺服器] 核取方塊。</span><span class="sxs-lookup"><span data-stu-id="faa08-199">Select the **Restart the destination server automatically if required** check box.</span></span>
8. <span data-ttu-id="faa08-200">按一下 [Install] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-200">Click **Install**.</span></span>
9. <span data-ttu-id="faa08-201">功能安裝完畢後，請回到 [伺服器管理員]  儀表板。</span><span class="sxs-lookup"><span data-stu-id="faa08-201">After the features are installed, return to the **Server Manager** dashboard.</span></span>
10. <span data-ttu-id="faa08-202">在左側窗格中選取新的 [AD DS]  選項。</span><span class="sxs-lookup"><span data-stu-id="faa08-202">Select the new **AD DS** option on the left pane.</span></span>
11. <span data-ttu-id="faa08-203">按一下黃色警告列上的 [更多]  連結。</span><span class="sxs-lookup"><span data-stu-id="faa08-203">Click the **More** link on the yellow warning bar.</span></span>
    
     ![DNS 伺服器虛擬機器上的 AS DS 對話方塊](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784625.png)
12. <span data-ttu-id="faa08-205">在 [所有伺服器工作詳細資料]  對話方塊的 [動作]  欄中，按一下 [將此伺服器升級為網域控制站]。</span><span class="sxs-lookup"><span data-stu-id="faa08-205">In the **Action** column of the **All Server Task Details** dialog box, click **Promote this server to a domain controller**.</span></span>
13. <span data-ttu-id="faa08-206">在 **Active Directory 網域服務組態精靈**中，使用下列值：</span><span class="sxs-lookup"><span data-stu-id="faa08-206">In the **Active Directory Domain Services Configuration Wizard**, use the following values:</span></span>
    
    | <span data-ttu-id="faa08-207">Page</span><span class="sxs-lookup"><span data-stu-id="faa08-207">Page</span></span> | <span data-ttu-id="faa08-208">設定</span><span class="sxs-lookup"><span data-stu-id="faa08-208">Setting</span></span> |
    | --- | --- |
    | <span data-ttu-id="faa08-209">部署組態</span><span class="sxs-lookup"><span data-stu-id="faa08-209">Deployment Configuration</span></span> |<span data-ttu-id="faa08-210">**新增樹系** = 已選取</span><span class="sxs-lookup"><span data-stu-id="faa08-210">**Add a new forest** = Selected</span></span><br/><span data-ttu-id="faa08-211">**根網域名稱** = corp.contoso.com</span><span class="sxs-lookup"><span data-stu-id="faa08-211">**Root domain name** = corp.contoso.com</span></span> |
    | <span data-ttu-id="faa08-212">網域控制站選項</span><span class="sxs-lookup"><span data-stu-id="faa08-212">Domain Controller Options</span></span> |<span data-ttu-id="faa08-213">**密碼** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="faa08-213">**Password** = Contoso!000</span></span><br/><span data-ttu-id="faa08-214">**確認密碼** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="faa08-214">**Confirm Password** = Contoso!000</span></span> |
14. <span data-ttu-id="faa08-215">按 [下一步]，以通過精靈中的其他頁面。</span><span class="sxs-lookup"><span data-stu-id="faa08-215">Click **Next** to go through the other pages in the wizard.</span></span> <span data-ttu-id="faa08-216">在 [檢查先決條件] 頁面上，確認是否出現下列訊息：**已順利通過所有先決條件檢查**。</span><span class="sxs-lookup"><span data-stu-id="faa08-216">On the **Prerequisites Check** page, verify that you see the following message: **All prerequisite checks passed successfully**.</span></span> <span data-ttu-id="faa08-217">請注意，務必要檢閱所有適用您情況的警告訊息，但是仍可以繼續進行安裝。</span><span class="sxs-lookup"><span data-stu-id="faa08-217">Note that you should review all applicable warning messages, but it is possible to continue with the installation.</span></span>
15. <span data-ttu-id="faa08-218">按一下 [Install] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-218">Click **Install**.</span></span> <span data-ttu-id="faa08-219">**ContosoDC** 虛擬機器便會自動重新開機。</span><span class="sxs-lookup"><span data-stu-id="faa08-219">The **ContosoDC** virtual machine will automatically reboot.</span></span>

## <a name="configure-domain-accounts"></a><span data-ttu-id="faa08-220">設定網域帳戶</span><span class="sxs-lookup"><span data-stu-id="faa08-220">Configure domain accounts</span></span>
<span data-ttu-id="faa08-221">接下來的步驟，將帶您設定 Active Directory 帳戶，以供之後使用。</span><span class="sxs-lookup"><span data-stu-id="faa08-221">The next steps configure the Active Directory accounts for later use.</span></span>

1. <span data-ttu-id="faa08-222">重新登入 **ContosoDC** 電腦。</span><span class="sxs-lookup"><span data-stu-id="faa08-222">Sign back in to the **ContosoDC** machine.</span></span>
2. <span data-ttu-id="faa08-223">在 [伺服器管理員]  中，按一下 [工具]  >  [Active Directory 管理中心] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-223">In **Server Manager**, click **Tools** > **Active Directory Administrative Center**.</span></span>
   
    ![Active Directory 管理中心](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784626.png)
3. <span data-ttu-id="faa08-225">在 [Active Directory 管理中心] 中，選取左窗格中的 [企業 (本機)]。</span><span class="sxs-lookup"><span data-stu-id="faa08-225">In the **Active Directory Administrative Center**, select **corp (local)** in the left pane.</span></span>
4. <span data-ttu-id="faa08-226">在右 [工作]  窗格中，按一下 [新增]  >  [使用者] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-226">On the right **Tasks** pane, click **New** > **User**.</span></span> <span data-ttu-id="faa08-227">套用下列設定：</span><span class="sxs-lookup"><span data-stu-id="faa08-227">Use the following settings:</span></span>
   
   | <span data-ttu-id="faa08-228">設定</span><span class="sxs-lookup"><span data-stu-id="faa08-228">Setting</span></span> | <span data-ttu-id="faa08-229">值</span><span class="sxs-lookup"><span data-stu-id="faa08-229">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="faa08-230">**名字**</span><span class="sxs-lookup"><span data-stu-id="faa08-230">**First Name**</span></span> |<span data-ttu-id="faa08-231">Install</span><span class="sxs-lookup"><span data-stu-id="faa08-231">Install</span></span> |
   | <span data-ttu-id="faa08-232">**使用者 SamAccountName**</span><span class="sxs-lookup"><span data-stu-id="faa08-232">**User SamAccountName**</span></span> |<span data-ttu-id="faa08-233">Install</span><span class="sxs-lookup"><span data-stu-id="faa08-233">Install</span></span> |
   | <span data-ttu-id="faa08-234">**密碼**</span><span class="sxs-lookup"><span data-stu-id="faa08-234">**Password**</span></span> |<span data-ttu-id="faa08-235">Contoso! 000</span><span class="sxs-lookup"><span data-stu-id="faa08-235">Contoso!000</span></span> |
   | <span data-ttu-id="faa08-236">**確認密碼**</span><span class="sxs-lookup"><span data-stu-id="faa08-236">**Confirm password**</span></span> |<span data-ttu-id="faa08-237">Contoso! 000</span><span class="sxs-lookup"><span data-stu-id="faa08-237">Contoso!000</span></span> |
   | <span data-ttu-id="faa08-238">**其他密碼選項**</span><span class="sxs-lookup"><span data-stu-id="faa08-238">**Other password options**</span></span> |<span data-ttu-id="faa08-239">已選取</span><span class="sxs-lookup"><span data-stu-id="faa08-239">Selected</span></span> |
   | <span data-ttu-id="faa08-240">**密碼永久有效**</span><span class="sxs-lookup"><span data-stu-id="faa08-240">**Password never expires**</span></span> |<span data-ttu-id="faa08-241">已檢查</span><span class="sxs-lookup"><span data-stu-id="faa08-241">Checked</span></span> |
5. <span data-ttu-id="faa08-242">按一下 [確定]，以建立**安裝**使用者。</span><span class="sxs-lookup"><span data-stu-id="faa08-242">Click **OK** to create the **Install** user.</span></span> <span data-ttu-id="faa08-243">此帳戶將用來設定容錯移轉叢集和可用性群組。</span><span class="sxs-lookup"><span data-stu-id="faa08-243">This account will be used to configure the failover cluster and the availability group.</span></span>
6. <span data-ttu-id="faa08-244">透過相同的步驟建立兩個額外的使用者：**CORP\SQLSvc1** 和 **CORP\SQLSvc2**。</span><span class="sxs-lookup"><span data-stu-id="faa08-244">Create two additional users, **CORP\SQLSvc1** and **CORP\SQLSvc2**, with the same steps.</span></span> <span data-ttu-id="faa08-245">這些帳戶將用於 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="faa08-245">These accounts will be used for the SQL Server instances.</span></span> <span data-ttu-id="faa08-246">接著，您需要為 **CORP\Install** 提供必要的權限，以設定 Windows 容錯移轉叢集。</span><span class="sxs-lookup"><span data-stu-id="faa08-246">Next, you need to give **CORP\Install** the necessary permissions to configure Windows failover clustering.</span></span>
7. <span data-ttu-id="faa08-247">在 [Active Directory 管理中心]  中，選取左窗格中的 [企業 (本機)] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-247">In the **Active Directory Administrative Center**, click **corp (local)** in the left pane.</span></span> <span data-ttu-id="faa08-248">在 [工作]  窗格中，按一下 [屬性] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-248">In the **Tasks** pane, click **Properties**.</span></span>
   
    ![企業使用者內容](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784627.png)
8. <span data-ttu-id="faa08-250">選取 [延伸模組]，然後按一下 [安全性] 索引標籤上的 [進階] 按鈕 。</span><span class="sxs-lookup"><span data-stu-id="faa08-250">Select **Extensions**, and then click the **Advanced** button on the **Security** tab.</span></span>
9. <span data-ttu-id="faa08-251">在 [企業的進階安全性設定]  對話方塊上，按一下 [新增] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-251">In the **Advanced Security Settings for corp** dialog box, click **Add**.</span></span>
10. <span data-ttu-id="faa08-252">按一下 [選取主體] 、搜尋 [CORP\Install] ，然後按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-252">Click **Select a principal**, search for **CORP\Install**, and then click **OK**.</span></span>
11. <span data-ttu-id="faa08-253">選取 [讀取所有內容] 和 [建立電腦物件] 權限。</span><span class="sxs-lookup"><span data-stu-id="faa08-253">Select the **Read all properties** and **Create Computer objects** permissions.</span></span>
    
     ![企業使用者權限](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784628.png)
12. <span data-ttu-id="faa08-255">按一下 [確定]，再按一下 [確定]。</span><span class="sxs-lookup"><span data-stu-id="faa08-255">Click **OK**, and then click **OK** again.</span></span> <span data-ttu-id="faa08-256">關閉 [企業內容] 視窗。</span><span class="sxs-lookup"><span data-stu-id="faa08-256">Close the corp properties window.</span></span>

<span data-ttu-id="faa08-257">現在 Active Directory 和使用者物件已設定完畢，請建立三個 SQL Server 虛擬機器，並將這些虛擬機器加入此網域。</span><span class="sxs-lookup"><span data-stu-id="faa08-257">Now that you configured Active Directory and the user objects, you will create three SQL Server virtual machines and join them to this domain.</span></span>

## <a name="create-the-sql-server-virtual-machines"></a><span data-ttu-id="faa08-258">建立 SQL Server 虛擬機器</span><span class="sxs-lookup"><span data-stu-id="faa08-258">Create the SQL Server virtual machines</span></span>
<span data-ttu-id="faa08-259">建立三個虛擬機器</span><span class="sxs-lookup"><span data-stu-id="faa08-259">Create three virtual machines.</span></span> <span data-ttu-id="faa08-260">一個節點用於叢集節點，兩個節點用於 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="faa08-260">One is for a cluster node and two are for SQL Server.</span></span> <span data-ttu-id="faa08-261">為了逐一建立每個虛擬機器，請回到 Azure 傳統入口網站，依序按一下 [新增]  >  [計算]  >  [虛擬機器]  >  [從資源庫] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-261">To create each of the virtual machines, go back to the Azure classic portal, click **New** > **Compute** > **Virtual Machine** > **From Gallery**.</span></span> <span data-ttu-id="faa08-262">然後使用下表中的範本建立虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="faa08-262">Then, use the templates in the following table to help you create the virtual machines.</span></span>

| <span data-ttu-id="faa08-263">Page</span><span class="sxs-lookup"><span data-stu-id="faa08-263">Page</span></span> | <span data-ttu-id="faa08-264">VM1</span><span class="sxs-lookup"><span data-stu-id="faa08-264">VM1</span></span> | <span data-ttu-id="faa08-265">VM2</span><span class="sxs-lookup"><span data-stu-id="faa08-265">VM2</span></span> | <span data-ttu-id="faa08-266">VM3</span><span class="sxs-lookup"><span data-stu-id="faa08-266">VM3</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="faa08-267">選取虛擬機器作業系統</span><span class="sxs-lookup"><span data-stu-id="faa08-267">Select the virtual machine operating system</span></span> |<span data-ttu-id="faa08-268">**Windows Server 2012 R2 Datacenter**</span><span class="sxs-lookup"><span data-stu-id="faa08-268">**Windows Server 2012 R2 Datacenter**</span></span> |<span data-ttu-id="faa08-269">**SQL Server 2014 RTM Enterprise**</span><span class="sxs-lookup"><span data-stu-id="faa08-269">**SQL Server 2014 RTM Enterprise**</span></span> |<span data-ttu-id="faa08-270">**SQL Server 2014 RTM Enterprise**</span><span class="sxs-lookup"><span data-stu-id="faa08-270">**SQL Server 2014 RTM Enterprise**</span></span> |
| <span data-ttu-id="faa08-271">虛擬機器組態</span><span class="sxs-lookup"><span data-stu-id="faa08-271">Virtual machine configuration</span></span> |<span data-ttu-id="faa08-272">**版本發行日期** = (最新版本)</span><span class="sxs-lookup"><span data-stu-id="faa08-272">**VERSION RELEASE DATE** = (latest)</span></span><br/><span data-ttu-id="faa08-273">**虛擬機器名稱** = ContosoWSFCNode</span><span class="sxs-lookup"><span data-stu-id="faa08-273">**VIRTUAL MACHINE NAME** = ContosoWSFCNode</span></span><br/><span data-ttu-id="faa08-274">**層** = 標準</span><span class="sxs-lookup"><span data-stu-id="faa08-274">**TIER** = STANDARD</span></span><br/><span data-ttu-id="faa08-275">**大小** = A2 (2 核心)</span><span class="sxs-lookup"><span data-stu-id="faa08-275">**SIZE** = A2 (2 cores)</span></span><br/><span data-ttu-id="faa08-276">**新使用者名稱** = AzureAdmin</span><span class="sxs-lookup"><span data-stu-id="faa08-276">**NEW USER NAME** = AzureAdmin</span></span><br/><span data-ttu-id="faa08-277">**新密碼** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="faa08-277">**NEW PASSWORD** = Contoso!000</span></span><br/><span data-ttu-id="faa08-278">**確認** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="faa08-278">**CONFIRM** = Contoso!000</span></span> |<span data-ttu-id="faa08-279">**版本發行日期** = (最新版本)</span><span class="sxs-lookup"><span data-stu-id="faa08-279">**VERSION RELEASE DATE** = (latest)</span></span><br/><span data-ttu-id="faa08-280">**虛擬機器名稱** = ContosoSQL1</span><span class="sxs-lookup"><span data-stu-id="faa08-280">**VIRTUAL MACHINE NAME** = ContosoSQL1</span></span><br/><span data-ttu-id="faa08-281">**層** = 標準</span><span class="sxs-lookup"><span data-stu-id="faa08-281">**TIER** = STANDARD</span></span><br/><span data-ttu-id="faa08-282">**大小** = A3 (4 核心)</span><span class="sxs-lookup"><span data-stu-id="faa08-282">**SIZE** = A3 (4 cores)</span></span><br/><span data-ttu-id="faa08-283">**新使用者名稱** = AzureAdmin</span><span class="sxs-lookup"><span data-stu-id="faa08-283">**NEW USER NAME** = AzureAdmin</span></span><br/><span data-ttu-id="faa08-284">**新密碼** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="faa08-284">**NEW PASSWORD** = Contoso!000</span></span><br/><span data-ttu-id="faa08-285">**確認** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="faa08-285">**CONFIRM** = Contoso!000</span></span> |<span data-ttu-id="faa08-286">**版本發行日期** = (最新版本)</span><span class="sxs-lookup"><span data-stu-id="faa08-286">**VERSION RELEASE DATE** = (latest)</span></span><br/><span data-ttu-id="faa08-287">**虛擬機器名稱** = ContosoSQL2</span><span class="sxs-lookup"><span data-stu-id="faa08-287">**VIRTUAL MACHINE NAME** = ContosoSQL2</span></span><br/><span data-ttu-id="faa08-288">**層** = 標準</span><span class="sxs-lookup"><span data-stu-id="faa08-288">**TIER** = STANDARD</span></span><br/><span data-ttu-id="faa08-289">**大小** = A3 (4 核心)</span><span class="sxs-lookup"><span data-stu-id="faa08-289">**SIZE** = A3 (4 cores)</span></span><br/><span data-ttu-id="faa08-290">**新使用者名稱** = AzureAdmin</span><span class="sxs-lookup"><span data-stu-id="faa08-290">**NEW USER NAME** = AzureAdmin</span></span><br/><span data-ttu-id="faa08-291">**新密碼** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="faa08-291">**NEW PASSWORD** = Contoso!000</span></span><br/><span data-ttu-id="faa08-292">**確認** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="faa08-292">**CONFIRM** = Contoso!000</span></span> |
| <span data-ttu-id="faa08-293">虛擬機器組態</span><span class="sxs-lookup"><span data-stu-id="faa08-293">Virtual machine configuration</span></span> |<span data-ttu-id="faa08-294">**雲端服務** = 先前建立的唯一雲端服務 DNS 名稱 (例如︰ContosoDC123)</span><span class="sxs-lookup"><span data-stu-id="faa08-294">**CLOUD SERVICE** = Previously Created Unique Cloud Service DNS Name (ex: ContosoDC123)</span></span><br/><span data-ttu-id="faa08-295">**區域/同質群組/虛擬網路** = ContosoNET</span><span class="sxs-lookup"><span data-stu-id="faa08-295">**REGION/AFFINITY GROUP/VIRTUAL NETWORK** = ContosoNET</span></span><br/><span data-ttu-id="faa08-296">**虛擬網路子網路** = Back(10.10.2.0/24)</span><span class="sxs-lookup"><span data-stu-id="faa08-296">**VIRTUAL NETWORK SUBNETS** = Back(10.10.2.0/24)</span></span><br/><span data-ttu-id="faa08-297">**儲存體帳戶** = 使用自動產生的儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="faa08-297">**STORAGE ACCOUNT** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="faa08-298">**可用性設定組** = 建立可用性設定組</span><span class="sxs-lookup"><span data-stu-id="faa08-298">**AVAILABILITY SET** = Create an availability set</span></span><br/><span data-ttu-id="faa08-299">**可用性設定組名稱** = SQLHADR</span><span class="sxs-lookup"><span data-stu-id="faa08-299">**AVAILABILITY SET NAME** = SQLHADR</span></span> |<span data-ttu-id="faa08-300">**雲端服務** = 先前建立的唯一雲端服務 DNS 名稱 (例如︰ContosoDC123)</span><span class="sxs-lookup"><span data-stu-id="faa08-300">**CLOUD SERVICE** = Previously Created Unique Cloud Service DNS Name (ex: ContosoDC123)</span></span><br/><span data-ttu-id="faa08-301">**區域/同質群組/虛擬網路** = ContosoNET</span><span class="sxs-lookup"><span data-stu-id="faa08-301">**REGION/AFFINITY GROUP/VIRTUAL NETWORK** = ContosoNET</span></span><br/><span data-ttu-id="faa08-302">**虛擬網路子網路** = Back(10.10.2.0/24)</span><span class="sxs-lookup"><span data-stu-id="faa08-302">**VIRTUAL NETWORK SUBNETS** = Back(10.10.2.0/24)</span></span><br/><span data-ttu-id="faa08-303">**儲存體帳戶** = 使用自動產生的儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="faa08-303">**STORAGE ACCOUNT** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="faa08-304">**可用性設定組** = SQLHADR (也可以在虛擬機器建立後，再設定可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="faa08-304">**AVAILABILITY SET** = SQLHADR (You can also configure the availability set after the machine has been created.</span></span> <span data-ttu-id="faa08-305">三部虛擬機器都必須指派至 SQLHADR 可用性集合)。</span><span class="sxs-lookup"><span data-stu-id="faa08-305">All three machines should be assigned to the SQLHADR availability set.)</span></span> |<span data-ttu-id="faa08-306">**雲端服務** = 先前建立的唯一雲端服務 DNS 名稱 (例如︰ContosoDC123)</span><span class="sxs-lookup"><span data-stu-id="faa08-306">**CLOUD SERVICE** = Previously Created Unique Cloud Service DNS Name (ex: ContosoDC123)</span></span><br/><span data-ttu-id="faa08-307">**區域/同質群組/虛擬網路** = ContosoNET</span><span class="sxs-lookup"><span data-stu-id="faa08-307">**REGION/AFFINITY GROUP/VIRTUAL NETWORK** = ContosoNET</span></span><br/><span data-ttu-id="faa08-308">**虛擬網路子網路** = Back(10.10.2.0/24)</span><span class="sxs-lookup"><span data-stu-id="faa08-308">**VIRTUAL NETWORK SUBNETS** = Back(10.10.2.0/24)</span></span><br/><span data-ttu-id="faa08-309">**儲存體帳戶** = 使用自動產生的儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="faa08-309">**STORAGE ACCOUNT** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="faa08-310">**可用性設定組** = SQLHADR (也可以在虛擬機器建立後，再設定可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="faa08-310">**AVAILABILITY SET** = SQLHADR (You can also configure the availability set after the machine has been created.</span></span> <span data-ttu-id="faa08-311">三部虛擬機器都必須指派至 SQLHADR 可用性集合)。</span><span class="sxs-lookup"><span data-stu-id="faa08-311">All three machines should be assigned to the SQLHADR availability set.)</span></span> |
| <span data-ttu-id="faa08-312">虛擬機器選項</span><span class="sxs-lookup"><span data-stu-id="faa08-312">Virtual machine options</span></span> |<span data-ttu-id="faa08-313">使用預設值</span><span class="sxs-lookup"><span data-stu-id="faa08-313">Use defaults</span></span> |<span data-ttu-id="faa08-314">使用預設值</span><span class="sxs-lookup"><span data-stu-id="faa08-314">Use defaults</span></span> |<span data-ttu-id="faa08-315">使用預設值</span><span class="sxs-lookup"><span data-stu-id="faa08-315">Use defaults</span></span> |

<br/>

> [!NOTE]
> <span data-ttu-id="faa08-316">先前的設定建議標準層虛擬機器，因為基本層機器不支援負載平衡端點。</span><span class="sxs-lookup"><span data-stu-id="faa08-316">The previous configuration suggests STANDARD tier virtual machines, because BASIC tier machines do not support load-balanced endpoints.</span></span> <span data-ttu-id="faa08-317">您稍後才需要負載平衡端點，以建立可用性群組接聽程式。</span><span class="sxs-lookup"><span data-stu-id="faa08-317">You need load-balanced endpoints later to create an availability group listener.</span></span> <span data-ttu-id="faa08-318">此外，此處建議的機器大小是為了在 Azure 虛擬機器中測試可用性群組。</span><span class="sxs-lookup"><span data-stu-id="faa08-318">Also, the machine sizes that are suggested here are meant for testing availability groups in Azure Virtual Machines.</span></span> <span data-ttu-id="faa08-319">為獲得生產工作負載的最佳效能，請參閱 [Azure 虛擬機器中的 SQL Server 效能最佳作法](../sql/virtual-machines-windows-sql-performance.md)中關於 SQL Server 機器大小和組態的建議。</span><span class="sxs-lookup"><span data-stu-id="faa08-319">For the best performance on production workloads, see the recommendations for SQL Server machine sizes and configuration in [Performance best practices for SQL Server in Azure Virtual Machines](../sql/virtual-machines-windows-sql-performance.md).</span></span>
> 
> 

<span data-ttu-id="faa08-320">完整佈建三個虛擬機器後，您必須將它們加入 **corp.contoso.com** 網域，並將 CORP\Install 管理權限授與給這些虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="faa08-320">After the three virtual machines are fully provisioned, you need to join them to the **corp.contoso.com** domain and grant CORP\Install administrative rights to the machines.</span></span> <span data-ttu-id="faa08-321">若要這樣做，請針對每個虛擬機器執行下列步驟。</span><span class="sxs-lookup"><span data-stu-id="faa08-321">To do this, use the following steps for each of the three virtual machines.</span></span>

1. <span data-ttu-id="faa08-322">首先，變更慣用的 DNS 伺服器位址。</span><span class="sxs-lookup"><span data-stu-id="faa08-322">First, change the preferred DNS server address.</span></span> <span data-ttu-id="faa08-323">在清單中選取虛擬機器，並按一下 [連接]  按鈕，將每個虛擬機器的 RDP 檔案下載至您的本機目錄。</span><span class="sxs-lookup"><span data-stu-id="faa08-323">Download each virtual machine's RDP file to your local directory by selecting the virtual machine in the list and clicking the **Connect** button.</span></span> <span data-ttu-id="faa08-324">若要選取虛擬機器，按一下任何一處 (資料列中的第一個資料格除外)，如下列螢幕擷取畫面所示。</span><span class="sxs-lookup"><span data-stu-id="faa08-324">To select a virtual machine, click anywhere but the first cell in the row, as shown in the following screenshot.</span></span>
   
    ![下載 RDP 檔案](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC664953.jpg)
2. <span data-ttu-id="faa08-326">開啟您所下載的 RDP 檔案，並使用所設定的系統管理員帳戶 (**BUILTIN\AzureAdmin**) 和密碼 (**Contoso!000**) 登入虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="faa08-326">Open the RDP file that you downloaded, and sign in to the virtual machine by using your configured administrator account (**BUILTIN\AzureAdmin**) and password (**Contoso!000**).</span></span>
3. <span data-ttu-id="faa08-327">登入後，會顯示 [伺服器管理員]  儀表板。</span><span class="sxs-lookup"><span data-stu-id="faa08-327">After you sign in, you should see the **Server Manager** dashboard.</span></span> <span data-ttu-id="faa08-328">按一下左窗格中的 [本機伺服器]  。</span><span class="sxs-lookup"><span data-stu-id="faa08-328">Click **Local Server** in the left pane.</span></span>
4. <span data-ttu-id="faa08-329">按一下 [DHCP 指派的 IPv4 位址，支援 IPv6]  連結。</span><span class="sxs-lookup"><span data-stu-id="faa08-329">Click the **IPv4 address assigned by DHCP, IPv6 enabled** link.</span></span>
5. <span data-ttu-id="faa08-330">在 [網路連接]  對話方塊中，按一下網路圖示。</span><span class="sxs-lookup"><span data-stu-id="faa08-330">In the **Network Connections** dialog box, click the network icon.</span></span>
   
    ![變更虛擬機器的慣用 DNS 伺服器](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784629.png)
6. <span data-ttu-id="faa08-332">在命令列中，按一下 [變更此連線的設定]。</span><span class="sxs-lookup"><span data-stu-id="faa08-332">On the command bar, click **Change the settings of this connection**.</span></span> <span data-ttu-id="faa08-333">(視您的視窗大小而定，可能需按一下雙向右箭頭才能看到此命令)。</span><span class="sxs-lookup"><span data-stu-id="faa08-333">(Depending on the size of your window, you might have to click the double right arrow to see this command).</span></span>
7. <span data-ttu-id="faa08-334">選取 [網際網路通訊協定第 4 版 (TCP/IPv4)] ，然後按一下 [內容] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-334">Select **Internet Protocol Version 4 (TCP/IPv4)**, and then click **Properties**.</span></span>
8. <span data-ttu-id="faa08-335">選取 [使用下列的 DNS 伺服器位址] ，然後指定 [慣用 DNS 伺服器]  中的 [10.10.2.4] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-335">Select **Use the following DNS server addresses** and then specify **10.10.2.4** in **Preferred DNS server**.</span></span>
9. <span data-ttu-id="faa08-336">**10.10.2.4** 位址是指派給 Azure 虛擬網路的 10.10.2.0/24 子網路中的虛擬機器的位址。</span><span class="sxs-lookup"><span data-stu-id="faa08-336">The **10.10.2.4** address is the address that's assigned to a virtual machine in the 10.10.2.0/24 subnet in an Azure virtual network.</span></span> <span data-ttu-id="faa08-337">虛擬機器是 **ContosoDC**。</span><span class="sxs-lookup"><span data-stu-id="faa08-337">That virtual machine is **ContosoDC**.</span></span> <span data-ttu-id="faa08-338">若要確認 **ContosoDC** 的 IP 位址，請如下列螢幕擷取畫面所示，在命令提示字元視窗中加入 **nslookup contosodc**。</span><span class="sxs-lookup"><span data-stu-id="faa08-338">To verify **ContosoDC**'s IP address, use **nslookup contosodc** in the command prompt window, as shown in the following screenshot.</span></span>
   
    ![使用 NSLOOKUP 尋找網域控制站的 IP 位址](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC664954.jpg)
10. <span data-ttu-id="faa08-340">依序按一下 [確定]  >  [關閉]  以認可變更。</span><span class="sxs-lookup"><span data-stu-id="faa08-340">Click **OK** > **Close** to commit the changes.</span></span> <span data-ttu-id="faa08-341">您現在可以將虛擬機器加入 **corp.contoso.com**。</span><span class="sxs-lookup"><span data-stu-id="faa08-341">You can now join the virtual machine to **corp.contoso.com**.</span></span>
11. <span data-ttu-id="faa08-342">回到 [本機伺服器] 視窗中，按一下 [工作群組] 連結。</span><span class="sxs-lookup"><span data-stu-id="faa08-342">Back in the **Local Server** window, click the **WORKGROUP** link.</span></span>
12. <span data-ttu-id="faa08-343">在 [電腦名稱] 區段中，按一下 [變更]。</span><span class="sxs-lookup"><span data-stu-id="faa08-343">In the **Computer Name** section, click **Change**.</span></span>
13. <span data-ttu-id="faa08-344">選取 [網域]  核取方塊、在文字方塊中輸入 **corp.contoso.com**，然後按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-344">Select the **Domain** check box, type **corp.contoso.com** in the text box, and then click **OK**.</span></span>
14. <span data-ttu-id="faa08-345">在 [Windows 安全性]  對話方塊中，指定預設網域的系統管理員帳戶 (**CORP\AzureAdmin**) 和密碼 (**Contoso!000**) 的認證。</span><span class="sxs-lookup"><span data-stu-id="faa08-345">In the **Windows Security** dialog box, specify the credentials for the default domain administrator account (**CORP\AzureAdmin**) and the password (**Contoso!000**).</span></span>
15. <span data-ttu-id="faa08-346">出現「歡迎使用 corp.contoso.com 網域」的訊息時，請按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-346">When you see the "Welcome to the corp.contoso.com domain" message, click **OK**.</span></span>
16. <span data-ttu-id="faa08-347">依序按一下對話方塊中的 [關閉]  >  [立即重新啟動] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-347">Click **Close** > **Restart Now** in the dialog box.</span></span>

### <a name="add-the-corpinstall-user-as-an-administrator-on-each-virtual-machine"></a><span data-ttu-id="faa08-348">將 Corp\Install 使用者新增為每個虛擬機器的系統管理員</span><span class="sxs-lookup"><span data-stu-id="faa08-348">Add the Corp\Install user as an administrator on each virtual machine</span></span>
1. <span data-ttu-id="faa08-349">等到虛擬機器重新啟動時，再次開啟 RDP 檔案，以使用 **BUILTIN\AzureAdmin** 帳戶登入虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="faa08-349">Wait until the virtual machine restarts, and then open the RDP file again to sign in to the virtual machine by using the **BUILTIN\AzureAdmin** account.</span></span>
2. <span data-ttu-id="faa08-350">在**伺服器管理員**按一下**工具** > **電腦管理**。</span><span class="sxs-lookup"><span data-stu-id="faa08-350">In **Server Manager** click **Tools** > **Computer Management**.</span></span>
   
    ![電腦管理](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784630.png)
3. <span data-ttu-id="faa08-352">在 [電腦管理 ] 對話方塊中，展開 [本機使用者和群組] ，然後按一下 [群組] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-352">In the **Computer Management** dialog box, expand **Local Users and Groups**, and then click **Groups**.</span></span>
4. <span data-ttu-id="faa08-353">按兩下 [系統管理員]  群組。</span><span class="sxs-lookup"><span data-stu-id="faa08-353">Double-click the **Administrators** group.</span></span>
5. <span data-ttu-id="faa08-354">在 [系統管理員內容]  對話方塊中，按一下 [新增]  按鈕。</span><span class="sxs-lookup"><span data-stu-id="faa08-354">In the **Administrators Properties** dialog box, click the **Add** button.</span></span>
6. <span data-ttu-id="faa08-355">輸入 **CORP\Install** 使用者，然後按一下 [確定]。</span><span class="sxs-lookup"><span data-stu-id="faa08-355">Enter the user **CORP\Install**, and then click **OK**.</span></span> <span data-ttu-id="faa08-356">當系統提示您輸入認證時，請輸入 **AzureAdmin** 帳戶和 **Contoso!000** 密碼。</span><span class="sxs-lookup"><span data-stu-id="faa08-356">When prompted for credentials, use the **AzureAdmin** account with the **Contoso!000** password.</span></span>
7. <span data-ttu-id="faa08-357">按一下 [確定] ，以關閉 [系統管理員內容]  對話方塊。</span><span class="sxs-lookup"><span data-stu-id="faa08-357">Click **OK** to close the **Administrator Properties** dialog box.</span></span>

### <a name="add-the-failover-clustering-feature-to-each-virtual-machine"></a><span data-ttu-id="faa08-358">將容錯移轉叢集功能新增至每部虛擬機器</span><span class="sxs-lookup"><span data-stu-id="faa08-358">Add the Failover Clustering feature to each virtual machine</span></span>
1. <span data-ttu-id="faa08-359">在 [伺服器管理員] 儀表板中按一下 [新增角色及功能]。</span><span class="sxs-lookup"><span data-stu-id="faa08-359">In the **Server Manager** dashboard, click **Add roles and features**.</span></span>
2. <span data-ttu-id="faa08-360">在**新增角色及功能精靈**中，連續按 [下一步] 直到到達 [功能] 頁面。</span><span class="sxs-lookup"><span data-stu-id="faa08-360">In the **Add Roles and Features Wizard**, click **Next** until you get to the **Features** page.</span></span>
3. <span data-ttu-id="faa08-361">選取 [容錯移轉叢集] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-361">Select **Failover Clustering**.</span></span> <span data-ttu-id="faa08-362">出現提示時，請新增其他相依功能。</span><span class="sxs-lookup"><span data-stu-id="faa08-362">When prompted, add other dependent features.</span></span>
   
    ![將容錯移轉叢集功能新增至虛擬機器](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784631.png)
4. <span data-ttu-id="faa08-364">按 [下一步]，然後按一下 [確認] 頁面上的 [安裝]。</span><span class="sxs-lookup"><span data-stu-id="faa08-364">Click **Next**, and then click **Install** on the **Confirmation** page.</span></span>
5. <span data-ttu-id="faa08-365">**容錯移轉叢集** 功能安裝完畢後，按一下 [關閉] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-365">When the **Failover Clustering** feature installation is finished, click **Close**.</span></span>
6. <span data-ttu-id="faa08-366">登出虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="faa08-366">Sign out of the virtual machine.</span></span>
7. <span data-ttu-id="faa08-367">針對三個伺服器：**ContosoWSFCNode**、**ContosoSQL1**，和 **ContosoSQL2** 重複本節中的步驟。</span><span class="sxs-lookup"><span data-stu-id="faa08-367">Repeat the steps in this section for all three servers: **ContosoWSFCNode**, **ContosoSQL1**, and **ContosoSQL2**.</span></span>

<span data-ttu-id="faa08-368">SQL Server 虛擬機器現已佈建完成和執行，但每部虛擬機器都採用 SQL Server 的預設選項。</span><span class="sxs-lookup"><span data-stu-id="faa08-368">The SQL Server virtual machines are now provisioned and running, but each has the default options for SQL Server.</span></span>

## <a name="create-the-failover-cluster"></a><span data-ttu-id="faa08-369">建立容錯移轉叢集</span><span class="sxs-lookup"><span data-stu-id="faa08-369">Create the failover cluster</span></span>
<span data-ttu-id="faa08-370">在本節中，您將會建立容錯移轉叢集，該叢集將裝載您稍後要建立的可用性群組。</span><span class="sxs-lookup"><span data-stu-id="faa08-370">In this section, you create the failover cluster that will host the availability group that you will create later.</span></span> <span data-ttu-id="faa08-371">到目前為止，您應該已針對將用於容錯移轉叢集的三個虛擬機器中的每一個，完成下列作業：</span><span class="sxs-lookup"><span data-stu-id="faa08-371">By now, you should have done the following to each of the three virtual machines that you will use in the failover cluster:</span></span>

* <span data-ttu-id="faa08-372">虛擬機器已在 Azure 中佈建完畢</span><span class="sxs-lookup"><span data-stu-id="faa08-372">Fully provisioned the virtual machine in Azure</span></span>
* <span data-ttu-id="faa08-373">將虛擬機器加入網域</span><span class="sxs-lookup"><span data-stu-id="faa08-373">Joined the virtual machine to the domain</span></span>
* <span data-ttu-id="faa08-374">將 **CORP\Install** 新增至本機系統管理員群組</span><span class="sxs-lookup"><span data-stu-id="faa08-374">Added **CORP\Install** to the local Administrators group</span></span>
* <span data-ttu-id="faa08-375">新增容錯移轉叢集功能</span><span class="sxs-lookup"><span data-stu-id="faa08-375">Added the failover clustering feature</span></span>

<span data-ttu-id="faa08-376">以上都是將虛擬機器加入容錯移轉叢集之前，每個虛擬機器需完成的必要條件。</span><span class="sxs-lookup"><span data-stu-id="faa08-376">All these are prerequisites on each virtual machine before you can join it to the failover cluster.</span></span>

<span data-ttu-id="faa08-377">此外，請注意 Azure 虛擬網路的運作方式和其在內部部署網路中的運作方式不同。</span><span class="sxs-lookup"><span data-stu-id="faa08-377">Also, note that the Azure virtual network does not behave in the same way as an on-premises network.</span></span> <span data-ttu-id="faa08-378">您必須依照下列順序建立叢集：</span><span class="sxs-lookup"><span data-stu-id="faa08-378">You need to create the cluster in the following order:</span></span>

1. <span data-ttu-id="faa08-379">在一個節點上 (**ContosoSQL1**) 建立單一節點叢集。</span><span class="sxs-lookup"><span data-stu-id="faa08-379">Create a single-node cluster on one node (**ContosoSQL1**).</span></span>
2. <span data-ttu-id="faa08-380">將叢集的 IP 位址修改成未使用的 IP 位址 (**10.10.2.101**)。</span><span class="sxs-lookup"><span data-stu-id="faa08-380">Modify the cluster IP address to an unused IP address (**10.10.2.101**).</span></span>
3. <span data-ttu-id="faa08-381">讓叢集名稱上線。</span><span class="sxs-lookup"><span data-stu-id="faa08-381">Bring the cluster name online.</span></span>
4. <span data-ttu-id="faa08-382">新增其他節點 (**ContosoSQL2** 和 **ContosoWSFCNode**)。</span><span class="sxs-lookup"><span data-stu-id="faa08-382">Add the other nodes (**ContosoSQL2** and **ContosoWSFCNode**).</span></span>

<span data-ttu-id="faa08-383">依照下列步驟來完成完整設定叢集的工作。</span><span class="sxs-lookup"><span data-stu-id="faa08-383">Use the following steps to complete the tasks that fully configure the cluster.</span></span>

1. <span data-ttu-id="faa08-384">開啟 **ContosoSQL1** 的 RDP 檔案，並使用網域帳戶 **CORP\Install** 登入。</span><span class="sxs-lookup"><span data-stu-id="faa08-384">Open the RDP file for **ContosoSQL1**, and sign in by using the domain account **CORP\Install**.</span></span>
2. <span data-ttu-id="faa08-385">在 [伺服器管理員]  儀表板中，依序按一下 [工具]  >  [容錯移轉叢集管理員] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-385">In the **Server Manager** dashboard, click **Tools** > **Failover Cluster Manager**.</span></span>
3. <span data-ttu-id="faa08-386">如下列螢幕擷取畫面所示，在左窗格中，以滑鼠右鍵按一下 [容錯移轉叢集管理員] **Failover Cluster Manager**，再按一下 [建立叢集] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-386">In the left pane, right-click **Failover Cluster Manager**, and then click **Create a Cluster**, as shown in the following screenshot.</span></span>
   
    ![建立叢集](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784632.png)
4. <span data-ttu-id="faa08-388">在「建立叢集精靈」中，以下表中的設定逐步完成每個頁面來建立單節點叢集：</span><span class="sxs-lookup"><span data-stu-id="faa08-388">In the Create Cluster Wizard, create a one-node cluster by stepping through the pages and using the settings in the following table:</span></span>
   
   | <span data-ttu-id="faa08-389">Page</span><span class="sxs-lookup"><span data-stu-id="faa08-389">Page</span></span> | <span data-ttu-id="faa08-390">設定</span><span class="sxs-lookup"><span data-stu-id="faa08-390">Settings</span></span> |
   | --- | --- |
   | <span data-ttu-id="faa08-391">開始之前</span><span class="sxs-lookup"><span data-stu-id="faa08-391">Before You Begin</span></span> |<span data-ttu-id="faa08-392">使用預設值</span><span class="sxs-lookup"><span data-stu-id="faa08-392">Use defaults</span></span> |
   | <span data-ttu-id="faa08-393">選取伺服器</span><span class="sxs-lookup"><span data-stu-id="faa08-393">Select Servers</span></span> |<span data-ttu-id="faa08-394">在 [輸入伺服器名稱] 中輸入 **ContosoSQL1**，然後按一下 [新增]</span><span class="sxs-lookup"><span data-stu-id="faa08-394">Type **ContosoSQL1** in **Enter server name** and click **Add**</span></span> |
   | <span data-ttu-id="faa08-395">驗證警告</span><span class="sxs-lookup"><span data-stu-id="faa08-395">Validation Warning</span></span> |<span data-ttu-id="faa08-396">選取 [**否。我不需要 Microsoft 提供此叢集的支援，也不需要執行驗證測試。請在我按一下 [下一步] 後，繼續建立叢集**]。</span><span class="sxs-lookup"><span data-stu-id="faa08-396">Select **No. I do not require support from Microsoft for this cluster, and therefore do not want to run the validation tests. When I click Next, continue creating the cluster**.</span></span> |
   | <span data-ttu-id="faa08-397">用於管理叢集的存取點</span><span class="sxs-lookup"><span data-stu-id="faa08-397">Access Point for Administering the Cluster</span></span> |<span data-ttu-id="faa08-398">在 [叢集名稱] 中輸入 **Cluster1**</span><span class="sxs-lookup"><span data-stu-id="faa08-398">Type **Cluster1** in **Cluster Name**</span></span> |
   | <span data-ttu-id="faa08-399">確認</span><span class="sxs-lookup"><span data-stu-id="faa08-399">Confirmation</span></span> |<span data-ttu-id="faa08-400">除非您使用的是儲存空間，否則請使用預設值。</span><span class="sxs-lookup"><span data-stu-id="faa08-400">Use defaults unless you are using Storage Spaces.</span></span> <span data-ttu-id="faa08-401">請詳閱此表之後的警告。</span><span class="sxs-lookup"><span data-stu-id="faa08-401">See the warning following this table.</span></span> |
   
   > [!WARNING]
   > <span data-ttu-id="faa08-402">如果您使用的是會將多個磁碟組成存放集區的 [儲存空間](https://technet.microsoft.com/library/hh831739)，您就必須在 [確認]  頁面上清除 [新增適合的儲存裝置到叢集]  核取方塊。</span><span class="sxs-lookup"><span data-stu-id="faa08-402">If you are using [Storage Spaces](https://technet.microsoft.com/library/hh831739), which groups multiple disks into storage pools, you must clear the **Add all eligible storage to the cluster** check box on the **Confirmation** page.</span></span> <span data-ttu-id="faa08-403">如果不清除此選項，在群集程序進行期間虛擬磁碟會中斷連結。</span><span class="sxs-lookup"><span data-stu-id="faa08-403">If you do not clear this option, the virtual disks will be detached during the clustering process.</span></span> <span data-ttu-id="faa08-404">因此，虛擬磁碟不會顯示在 [磁碟管理員] 或 [Explorer] 中，直到您將儲存空間從叢集中移除，並使用 PowerShell 重新連接虛擬磁碟。</span><span class="sxs-lookup"><span data-stu-id="faa08-404">As a result, they will also not appear in Disk Manager or Explorer until the storage spaces are removed from the cluster and reattached by using PowerShell.</span></span>
   > 
   > 
5. <span data-ttu-id="faa08-405">在左窗格中，展開 [容錯移轉叢集管理員] ，然後按一下 [Cluster1.corp.contoso.com] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-405">In the left pane, expand **Failover Cluster Manager**, and then click **Cluster1.corp.contoso.com**.</span></span>
6. <span data-ttu-id="faa08-406">在中央窗格中向下捲動至 [叢集核心資源]  區段，並展開 [名稱：Clutser1]  的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="faa08-406">In the center pane, scroll down to the **Cluster Core Resources** section, and expand the **Name: Clutser1** details.</span></span> <span data-ttu-id="faa08-407">在 [失敗] 狀態中，應該會同時出現 [名稱] 和 [IP 位址] 資源 。</span><span class="sxs-lookup"><span data-stu-id="faa08-407">You should see both the **Name** and the **IP Address** resources in the **Failed** state.</span></span> <span data-ttu-id="faa08-408">由於指派給叢集的 IP 位址與虛擬機器的 IP 位址相同，是個重複的位址，因此無法讓該 IP 位址資源上線。</span><span class="sxs-lookup"><span data-stu-id="faa08-408">The IP address resource cannot be brought online because the cluster is assigned the same IP address as the machine itself, which is a duplicate address.</span></span>
7. <span data-ttu-id="faa08-409">以滑鼠右鍵按一下失敗的 [IP 位址] 資源，然後按一下 [內容]。</span><span class="sxs-lookup"><span data-stu-id="faa08-409">Right-click the failed **IP Address** resource, and then click **Properties**.</span></span>
   
    ![叢集屬性](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784633.png)
8. <span data-ttu-id="faa08-411">選取 [靜態 IP 位址]，並在 [位址]  文字方塊中指定 [10.10.2.101] ，然後按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-411">Select **Static IP Address**, specify **10.10.2.101** in the **Address** text box, and then click **OK**.</span></span>
9. <span data-ttu-id="faa08-412">在 [叢集核心資源] 區段中，以滑鼠右鍵按一下 [名稱：Cluster1]，再按一下 [上線]。</span><span class="sxs-lookup"><span data-stu-id="faa08-412">In the **Cluster Core Resources** section, right-click **Name: Cluster1**, and then click **Bring Online**.</span></span> <span data-ttu-id="faa08-413">等待兩個資源上線。</span><span class="sxs-lookup"><span data-stu-id="faa08-413">Wait until both resources are online.</span></span> <span data-ttu-id="faa08-414">叢集名稱資源上線後，會以新的 Active Directory 電腦帳戶更新 DC 伺服器。</span><span class="sxs-lookup"><span data-stu-id="faa08-414">When the cluster name resource comes online, the DC server is updated with a new Active Directory computer account.</span></span> <span data-ttu-id="faa08-415">此 Active Directory 帳戶稍後將用來執行可用性群組叢集服務。</span><span class="sxs-lookup"><span data-stu-id="faa08-415">This Active Directory account will be used to run the availability group clustered service later.</span></span>
10. <span data-ttu-id="faa08-416">將剩餘的節點新增至叢集。</span><span class="sxs-lookup"><span data-stu-id="faa08-416">Add the remaining nodes to the cluster.</span></span> <span data-ttu-id="faa08-417">如下列螢幕擷取畫面所示，在瀏覽器樹狀目錄中以滑鼠右鍵按一下 [Cluster1.corp.contoso.com]，再按一下 [新增節點]。</span><span class="sxs-lookup"><span data-stu-id="faa08-417">In the browser tree, right-click **Cluster1.corp.contoso.com**, and then click **Add Node**, as shown in the following screenshot.</span></span>
    
     ![將節點新增至叢集](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784634.png)
11. <span data-ttu-id="faa08-419">在 [新增節點精靈]  中，按一下 [選取伺服器]  頁面上的 [下一步] ，然後在 [輸入伺服器名稱]  中輸入伺服器名稱，再按一下 [新增] ，將 **ContosoSQL2** 和 **ContosoWSFCNode** 節點新增至清單。</span><span class="sxs-lookup"><span data-stu-id="faa08-419">In the **Add Node Wizard**, click **Next** on the **Select Servers** page, add **ContosoSQL2** and **ContosoWSFCNode** to the list by typing the server name in **Enter server name** and then clicking **Add**.</span></span> <span data-ttu-id="faa08-420">完成之後，按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="faa08-420">When you are done, click **Next**.</span></span>
12. <span data-ttu-id="faa08-421">在 [驗證警告]  頁面上，按一下 [否] ，雖然在實際操作時，您應執行驗證測試。</span><span class="sxs-lookup"><span data-stu-id="faa08-421">On the **Validation Warning** page, click **No**, although in a production scenario, you should perform the validation tests.</span></span> <span data-ttu-id="faa08-422">然後按 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-422">Then, click **Next**.</span></span>
13. <span data-ttu-id="faa08-423">在 [確認]  頁面中按 [下一步] ，以新增節點。</span><span class="sxs-lookup"><span data-stu-id="faa08-423">On the **Confirmation** page, click **Next** to add the nodes.</span></span>
    
    > [!WARNING]
    > <span data-ttu-id="faa08-424">如果您使用的是會將多個磁碟組成存放集區的[儲存空間](https://technet.microsoft.com/library/hh831739)，您就必須清除 [新增適合的儲存裝置到叢集]  核取方塊。</span><span class="sxs-lookup"><span data-stu-id="faa08-424">If you are using [Storage Spaces](https://technet.microsoft.com/library/hh831739), which groups multiple disks into storage pools, you must clear the **Add all eligible storage to the cluster** check box.</span></span> <span data-ttu-id="faa08-425">如果不清除此選項，在群集程序進行期間虛擬磁碟會中斷連結。</span><span class="sxs-lookup"><span data-stu-id="faa08-425">If you do not clear this option, the virtual disks will be detached during the clustering process.</span></span> <span data-ttu-id="faa08-426">因此，虛擬磁碟不會顯示在 [磁碟管理員] 或 [總管] 中，直到您將儲存空間從叢集中移除，並使用 PowerShell 重新連接虛擬磁碟。</span><span class="sxs-lookup"><span data-stu-id="faa08-426">As a result, they will also not appear in Disk Manager or Explorer until the storage spaces are removed from cluster and reattached using PowerShell.</span></span>
    > 
    > 
14. <span data-ttu-id="faa08-427">將節點新增至叢集後，請按一下 [完成] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-427">After the nodes are added to the cluster, click **Finish**.</span></span> <span data-ttu-id="faa08-428">容錯移轉叢集管理員現在應該會顯示您的叢集具有三個節點，並將這些節點列在**節點**容器中。</span><span class="sxs-lookup"><span data-stu-id="faa08-428">Failover Cluster Manager should now show that your cluster has three nodes and list them in the **Nodes** container.</span></span>
15. <span data-ttu-id="faa08-429">登出遠端桌面工作階段。</span><span class="sxs-lookup"><span data-stu-id="faa08-429">Sign out of the remote desktop session.</span></span>

## <a name="prepare-the-sql-server-instances-for-availability-groups"></a><span data-ttu-id="faa08-430">針對可用性群組準備 SQL Server 執行個體</span><span class="sxs-lookup"><span data-stu-id="faa08-430">Prepare the SQL Server instances for availability groups</span></span>
<span data-ttu-id="faa08-431">本節將針對 **ContosoSQL1** 和 **contosoSQL2** 進行下列工作：</span><span class="sxs-lookup"><span data-stu-id="faa08-431">In this section, you will do the following on both **ContosoSQL1** and **contosoSQL2**:</span></span>

* <span data-ttu-id="faa08-432">為具有預設 SQL Server 執行個體必要權限的 **NT AUTHORITY\System** 新增登入</span><span class="sxs-lookup"><span data-stu-id="faa08-432">Add a login for **NT AUTHORITY\System** with necessary permissions set to the default SQL Server instance.</span></span>
* <span data-ttu-id="faa08-433">將 **CORP\Install** 新增為預設 SQL Server 執行個體的系統管理員角色</span><span class="sxs-lookup"><span data-stu-id="faa08-433">Add **CORP\Install** as a sysadmin role to the default SQL Server instance.</span></span>
* <span data-ttu-id="faa08-434">開啟防火牆以供 SQL Server 進行遠端存取。</span><span class="sxs-lookup"><span data-stu-id="faa08-434">Open the firewall for remote access of SQL Server.</span></span>
* <span data-ttu-id="faa08-435">啟用 Always On 可用性群組功能。</span><span class="sxs-lookup"><span data-stu-id="faa08-435">Enable the Always On availability groups feature.</span></span>
* <span data-ttu-id="faa08-436">將 SQL Server 服務帳戶分別變更為 **CORP\SQLSvc1** 和 **CORP\SQLSvc2**。</span><span class="sxs-lookup"><span data-stu-id="faa08-436">Change the SQL Server service account to **CORP\SQLSvc1** and **CORP\SQLSvc2**, respectively.</span></span>

<span data-ttu-id="faa08-437">執行這些動作沒有順序限制。</span><span class="sxs-lookup"><span data-stu-id="faa08-437">These actions can be performed in any order.</span></span> <span data-ttu-id="faa08-438">不過，下列步驟將依順序執行這些動作。</span><span class="sxs-lookup"><span data-stu-id="faa08-438">Nevertheless, the following steps will walk through them in order.</span></span> <span data-ttu-id="faa08-439">針對 **ContosoSQL1** 和 **ContosoSQL2**，依照下列步驟執行：</span><span class="sxs-lookup"><span data-stu-id="faa08-439">Follow the steps for both **ContosoSQL1** and **ContosoSQL2**:</span></span>

1. <span data-ttu-id="faa08-440">如果您尚未將虛擬機器登出遠端桌面工作階段，請現在登出。</span><span class="sxs-lookup"><span data-stu-id="faa08-440">If you have not signed out of the remote desktop session for the virtual machine, do so now.</span></span>
2. <span data-ttu-id="faa08-441">開啟 **ContosoSQL1** 和 **ContosoSQL2** 的 RDP 檔案，並以 **BUILTIN\AzureAdmin** 的身分登入。</span><span class="sxs-lookup"><span data-stu-id="faa08-441">Open the RDP files for **ContosoSQL1** and **ContosoSQL2**, and sign in as **BUILTIN\AzureAdmin**.</span></span>
3. <span data-ttu-id="faa08-442">將 **NT AUTHORITY\System** 和必要權限新增至 SQL Server 登入。</span><span class="sxs-lookup"><span data-stu-id="faa08-442">Add **NT AUTHORITY\System** to the SQL Server logins with necessary permissions.</span></span> <span data-ttu-id="faa08-443">開啟 **SQL Server Management Studio**。</span><span class="sxs-lookup"><span data-stu-id="faa08-443">Open **SQL Server Management Studio**.</span></span>
4. <span data-ttu-id="faa08-444">按一下 [連接]  ，連接至預設 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="faa08-444">Click **Connect** to connect to the default SQL Server instance.</span></span>
5. <span data-ttu-id="faa08-445">在 [物件總管] 中，依序展開 [安全性]、[登入]。</span><span class="sxs-lookup"><span data-stu-id="faa08-445">In **Object Explorer**, expand **Security**, and then expand **Logins**.</span></span>
6. <span data-ttu-id="faa08-446">以滑鼠右鍵按一下 [NT AUTHORITY\System]  登入，然後按一下 [內容]。</span><span class="sxs-lookup"><span data-stu-id="faa08-446">Right-click the **NT AUTHORITY\System** login, and then click **Properties**.</span></span>
7. <span data-ttu-id="faa08-447">在 [安全性實體]  頁面中，對本機伺服器，針對下列權限選取 [授與] ，然後按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-447">On the **Securables** page, for the local server, select **Grant** for the following permissions, and then click **OK**.</span></span>
   
   * <span data-ttu-id="faa08-448">更改所有可用性群組</span><span class="sxs-lookup"><span data-stu-id="faa08-448">Alter any availability group</span></span>
   * <span data-ttu-id="faa08-449">連接 SQL</span><span class="sxs-lookup"><span data-stu-id="faa08-449">Connect SQL</span></span>
   * <span data-ttu-id="faa08-450">檢視伺服器狀態</span><span class="sxs-lookup"><span data-stu-id="faa08-450">View server state</span></span>
8. <span data-ttu-id="faa08-451">將 **CORP\Install** 新增為預設 SQL Server 執行個體的 **系統管理員** 角色</span><span class="sxs-lookup"><span data-stu-id="faa08-451">Add **CORP\Install** as a **sysadmin** role to the default SQL Server instance.</span></span> <span data-ttu-id="faa08-452">在 [物件總管]  中，以滑鼠右鍵按一下 [登入] ，再按一下 [新增登入] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-452">In **Object Explorer**, right-click **Logins**, and then click **New Login**.</span></span>
9. <span data-ttu-id="faa08-453">在 [登入名稱] 中輸入 **CORP\Install**。</span><span class="sxs-lookup"><span data-stu-id="faa08-453">Type **CORP\Install** in **Login name**.</span></span>
10. <span data-ttu-id="faa08-454">在 [伺服器角色] 頁面上，按一下 [sysadmin]，然後按一下 [確定]。 </span><span class="sxs-lookup"><span data-stu-id="faa08-454">On the **Server Roles** page, select **sysadmin**, and then click **OK**.</span></span> <span data-ttu-id="faa08-455">建立登入之後，展開 [物件總管]  中的 [登入]  便可看到該登入。</span><span class="sxs-lookup"><span data-stu-id="faa08-455">After you create the login, you can see it by expanding **Logins** in **Object Explorer**.</span></span>
11. <span data-ttu-id="faa08-456">若要建立 SQL Server 的防火牆規則，請在 [開始]  畫面上，開啟 [具有進階安全性的 Windows 防火牆] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-456">To create a firewall rule for SQL Server, on the **Start** screen, open **Windows Firewall with Advanced Security**.</span></span>
12. <span data-ttu-id="faa08-457">在左側窗格中，選取 [內送規則] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-457">In the left pane, select **Inbound Rules**.</span></span> <span data-ttu-id="faa08-458">在右窗格中，按一下 [新增規則] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-458">In the right pane, click **New Rule**.</span></span>
13. <span data-ttu-id="faa08-459">在 [規則類型]  頁面上，按一下 [程式]  >  [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-459">On the **Rule Type** page, click **Program** > **Next**.</span></span>
14. <span data-ttu-id="faa08-460">在 [程式]  頁面上，選取[此程式路徑] 、在文字方塊中輸入 **%ProgramFiles%\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\Binn\sqlservr.exe**，然後按一下 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-460">On the **Program** page, select **This program path**, type **%ProgramFiles%\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\Binn\sqlservr.exe** in the text box, and then click **Next**.</span></span> <span data-ttu-id="faa08-461">如果正依照這些指示進行，但使用 SQL Server 2012，則 SQL Server 目錄是**MSSQL11.MSSQLSERVER**。</span><span class="sxs-lookup"><span data-stu-id="faa08-461">If you are following these directions but using SQL Server 2012, the SQL Server directory is **MSSQL11.MSSQLSERVER**.</span></span>
15. <span data-ttu-id="faa08-462">在 [動作] 頁面中，保持選取 [允許連接]，然後按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="faa08-462">On the **Action** page, keep **Allow the connection** selected, and then click **Next**.</span></span>
16. <span data-ttu-id="faa08-463">在 [設定檔]  頁面上，接受預設設定，然後按一下 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-463">On the **Profile** page, accept the default settings, and then click **Next**.</span></span>
17. <span data-ttu-id="faa08-464">在 [名稱]  頁面上，指定規則名稱，例如在 [名稱]  文字方塊中指定 [SQL Server (程式規則)] ，然後按一下 [完成] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-464">On the **Name** page, specify a rule name, such as **SQL Server (Program Rule)**, in the **Name** text box, then click **Finish**.</span></span>
18. <span data-ttu-id="faa08-465">若要啟用 **Always On 可用性群組** 功能，請在 [開始]  畫面上，開啟 [SQL Server 組態管理員] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-465">To enable the **Always On Availability Groups** feature, on the **Start** screen, open **SQL Server Configuration Manager**.</span></span>
19. <span data-ttu-id="faa08-466">在瀏覽器樹狀目錄中按一下 [SQL Server 服務] ，然後以滑鼠右鍵按一下 [SQL Server (MSSQLSERVER)]  服務，再按一下 [內容] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-466">In the browser tree, click **SQL Server Services**, right-click the **SQL Server (MSSQLSERVER)** service, and then click **Properties**.</span></span>
20. <span data-ttu-id="faa08-467">如下列螢幕擷取畫面所示，按一下 [AlwaysOn 高可用性]  索引標籤，然後選取 [啟用 AlwaysOn 可用性群組]，再按一下 [套用] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-467">Click the **Always On High Availability** tab, select **Enable Always On Availability Groups**, as shown in the following screenshot, and then click **Apply**.</span></span> <span data-ttu-id="faa08-468">按一下對話方塊中的 [確定] ，先不要關閉 [內容]  對話方塊。</span><span class="sxs-lookup"><span data-stu-id="faa08-468">Click **OK** in the dialog box, and do not close the **Properties** dialog box yet.</span></span> <span data-ttu-id="faa08-469">變更服務帳戶之後，將重新啟動 SQL Server 服務。</span><span class="sxs-lookup"><span data-stu-id="faa08-469">You will restart the SQL Server service after you change the service account.</span></span>
    
     ![啟用 Always On 可用性群組](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665520.gif)
21. <span data-ttu-id="faa08-471">若要變更 SQL Server 服務帳戶，按一下 [登入]  索引標籤，在 [帳戶名稱]  中輸入 **CORP\SQLSvc1** (若為 **ContosoSQL1**)，或 **CORP\SQLSvc2** (若為 **ContosoSQL2**)，填入密碼並加以確認，然後按一下 [確定]。</span><span class="sxs-lookup"><span data-stu-id="faa08-471">To change the SQL Server service account, click the **Log On** tab, type **CORP\SQLSvc1** (for **ContosoSQL1**) or **CORP\SQLSvc2** (for **ContosoSQL2**) in **Account Name**, fill in and confirm the password, and then click **OK**.</span></span>
22. <span data-ttu-id="faa08-472">在對話方塊中按一下 [是]  ，重新啟動 SQL Server 服務。</span><span class="sxs-lookup"><span data-stu-id="faa08-472">In the dialog box that opens, click **Yes** to restart the SQL Server service.</span></span> <span data-ttu-id="faa08-473">SQL Server 服務重新啟動之後，您在 [內容]  對話方塊中所進行的變更便會生效。</span><span class="sxs-lookup"><span data-stu-id="faa08-473">After the SQL Server service restarts, changes that you made in the **Properties** dialog box are effective.</span></span>
23. <span data-ttu-id="faa08-474">登出虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="faa08-474">Sign out of the virtual machines.</span></span>

## <a name="create-the-availability-group"></a><span data-ttu-id="faa08-475">建立可用性群組</span><span class="sxs-lookup"><span data-stu-id="faa08-475">Create the availability group</span></span>
<span data-ttu-id="faa08-476">現在已準備就緒，可以開始設定可用性群組。</span><span class="sxs-lookup"><span data-stu-id="faa08-476">You are now ready to configure an availability group.</span></span> <span data-ttu-id="faa08-477">以下列出需執行的動作：</span><span class="sxs-lookup"><span data-stu-id="faa08-477">Below is an outline of what you will do:</span></span>

* <span data-ttu-id="faa08-478">在 **ContosoSQL1** 上建立新的資料庫 (**MyDB1**)。</span><span class="sxs-lookup"><span data-stu-id="faa08-478">Create a new database (**MyDB1**) on **ContosoSQL1**.</span></span>
* <span data-ttu-id="faa08-479">建立資料庫的完整備份和交易記錄備份。</span><span class="sxs-lookup"><span data-stu-id="faa08-479">Take both a full backup and a transaction log backup of the database.</span></span>
* <span data-ttu-id="faa08-480">透過 [NORECOVERY]  選項將完整備份和記錄備份還原至 **ContosoSQL2**。</span><span class="sxs-lookup"><span data-stu-id="faa08-480">Restore the full and log backups to **ContosoSQL2** with the **NORECOVERY** option.</span></span>
* <span data-ttu-id="faa08-481">藉由同步認可、自動容錯移轉及可讀取的次要複本，建立「可用性群組」(**AG1**)。</span><span class="sxs-lookup"><span data-stu-id="faa08-481">Create the availability group (**AG1**) with synchronous commit, automatic failover, and readable secondary replicas.</span></span>

### <a name="create-the-mydb1-database-on-contososql1"></a><span data-ttu-id="faa08-482">在 ContosoSQL1 上建立 MyDB1 資料庫</span><span class="sxs-lookup"><span data-stu-id="faa08-482">Create the MyDB1 database on ContosoSQL1</span></span>
1. <span data-ttu-id="faa08-483">如果您有您尚未將 **ContosoSQL1** 和 **ContosoSQL2** 登出遠端桌面工作階段，請現在登出。</span><span class="sxs-lookup"><span data-stu-id="faa08-483">If you have not already signed out of the remote desktop sessions for **ContosoSQL1** and **ContosoSQL2**, do so now.</span></span>
2. <span data-ttu-id="faa08-484">開啟 **ContosoSQL1** 的 RDP 檔案，並以 **CORP\Install** 的身分登入。</span><span class="sxs-lookup"><span data-stu-id="faa08-484">Open the RDP file for **ContosoSQL1**, and sign in as **CORP\Install**.</span></span>
3. <span data-ttu-id="faa08-485">在 [檔案總管]  中，於 **\\C:** 磁碟中，建立名為 **備份** 的目錄。</span><span class="sxs-lookup"><span data-stu-id="faa08-485">In **File Explorer**, under **C:\\**, create a directory named **backup**.</span></span> <span data-ttu-id="faa08-486">此目錄將用來備份和還原您的資料庫。</span><span class="sxs-lookup"><span data-stu-id="faa08-486">You will use this directory to back up and restore your database.</span></span>
4. <span data-ttu-id="faa08-487">如下方所示，以滑鼠右鍵按一下新目錄，指向 [共用對象]，然後按一下 [特定人員]。</span><span class="sxs-lookup"><span data-stu-id="faa08-487">Right-click the new directory, point to **Share with**, and then click **Specific people**, as shown in the following screenshot.</span></span>
   
    ![建立備份資料夾](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665521.gif)
5. <span data-ttu-id="faa08-489">新增 **CORP\SQLSvc1**，然後指定 **讀取/寫入** 權限。</span><span class="sxs-lookup"><span data-stu-id="faa08-489">Add **CORP\SQLSvc1**, and then give it the **Read/Write** permission.</span></span> <span data-ttu-id="faa08-490">如下列螢幕擷取畫面所示，新增 **CORP\SQLSvc2**，然後指定 **讀取** 權限，再按一下 [共用] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-490">Add **CORP\SQLSvc2**, and then give it the **Read** permission, as shown in the following screenshot, and then click **Share**.</span></span> <span data-ttu-id="faa08-491">檔案共用程序完成後，按一下 [完成] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-491">After the file-sharing process is finished, click **Done**.</span></span>
   
    ![將權限授與備份資料夾](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665522.gif)
6. <span data-ttu-id="faa08-493">若要建立資料庫，請透過 [開始]  功能表，開啟 **SQL Server Management Studio**，然後按一下 [連接] ，連接至預設的 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="faa08-493">To create the database, from the **Start** menu, open **SQL Server Management Studio**, and then click **Connect** to connect to the default SQL Server instance.</span></span>
7. <span data-ttu-id="faa08-494">在 [物件總管] 中，以滑鼠右鍵按一下 [資料庫] ，然後按一下 [新增資料庫] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-494">In **Object Explorer**, right-click **Databases**, and then click **New Database**.</span></span>
8. <span data-ttu-id="faa08-495">在 [資料庫名稱]  中，輸入 **MyDB1**，然後按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-495">In **Database name**, type **MyDB1**, and then click **OK**.</span></span>

### <a name="make-a-full-backup-of-mydb1-and-restore-it-on-contososql2"></a><span data-ttu-id="faa08-496">建立 MyDB1 的完整備份，然後將其還原至 ContosoSQL2</span><span class="sxs-lookup"><span data-stu-id="faa08-496">Make a full backup of MyDB1 and restore it on ContosoSQL2</span></span>
1. <span data-ttu-id="faa08-497">若要建立完整的資料庫備份，請在 [物件總管]  中，展開 [資料庫] ，以滑鼠右鍵按一下 [MyDB1] ，指向 [工作] ，然後按一下 [備份] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-497">To make a full backup of the database, in **Object Explorer**, expand **Databases**, right-click **MyDB1**, point to **Tasks**, and then click **Back Up**.</span></span>
2. <span data-ttu-id="faa08-498">在 [來源] 區段中，讓 [備份類型] 的設定保持為 [完整]。</span><span class="sxs-lookup"><span data-stu-id="faa08-498">In the **Source** section, keep **Backup type** set to **Full**.</span></span> <span data-ttu-id="faa08-499">在 [目的地] 區段中按一下 [移除]，移除備份檔案的預設檔案路徑。</span><span class="sxs-lookup"><span data-stu-id="faa08-499">In the **Destination** section, click **Remove** to remove the default file path for the backup file.</span></span>
3. <span data-ttu-id="faa08-500">在 [目的地] 區段中，按一下 [新增]。</span><span class="sxs-lookup"><span data-stu-id="faa08-500">In the **Destination** section, click **Add**.</span></span>
4. <span data-ttu-id="faa08-501">在 [檔案名稱]  文字方塊中，輸入 **\\ContosoSQL1\backup\MyDB1.bak**，按一下 [確定] ，然後再按一下 [確定]  來備份資料庫。</span><span class="sxs-lookup"><span data-stu-id="faa08-501">In the **File name** text box, type **\\ContosoSQL1\backup\MyDB1.bak**, click **OK**, and then click **OK** again to back up the database.</span></span> <span data-ttu-id="faa08-502">備份作業完成後，再次按一下 [確定]  ，關閉對話方塊。</span><span class="sxs-lookup"><span data-stu-id="faa08-502">When the backup operation finishes, click **OK** again to close the dialog box.</span></span>
5. <span data-ttu-id="faa08-503">若要建立資料庫的交易記錄備份，請在 [物件總管]  中，展開 [資料庫] ，以滑鼠右鍵按一下 [MyDB1] ，指向 [工作] ，然後按一下 [備份] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-503">To make a transaction log backup of the database, in **Object Explorer**, expand **Databases**, right-click **MyDB1**, point to **Tasks**, and then click **Back Up**.</span></span>
6. <span data-ttu-id="faa08-504">在 [備份類型]  中，選取 [交易記錄] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-504">In **Backup type**, select **Transaction Log**.</span></span> <span data-ttu-id="faa08-505">讓 [目的地]  的檔案路徑設定保持為您稍早指定的路徑，然後按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-505">Keep the **Destination** file path set to the one you specified earlier, and then click **OK**.</span></span> <span data-ttu-id="faa08-506">備份作業完成後，再次按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-506">After the backup operation finishes, click **OK** again.</span></span>
7. <span data-ttu-id="faa08-507">若要還原 **ContosoSQL2** 的完整和交易記錄備份，請開啟 **ContosoSQL2** 的RDP 檔案，並以 **CORP\Install** 的身分登入。</span><span class="sxs-lookup"><span data-stu-id="faa08-507">To restore the full and transaction log backups on **ContosoSQL2**, open the RDP file for **ContosoSQL2**, and sign in as **CORP\Install**.</span></span> <span data-ttu-id="faa08-508">讓 **ContosoSQL1** 的遠端桌面工作階段保持開啟。</span><span class="sxs-lookup"><span data-stu-id="faa08-508">Leave the remote desktop session for **ContosoSQL1** open.</span></span>
8. <span data-ttu-id="faa08-509">透過 [開始]  功能表，啟動 **SQL Server Management Studio**，然後按一下 [連接] ，連接至預設的 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="faa08-509">From the **Start** menu, open **SQL Server Management Studio**, and then click **Connect** to connect to the default SQL Server instance.</span></span>
9. <span data-ttu-id="faa08-510">在 [物件總管]  中，以滑鼠右鍵按一下 [資料庫] ，再按一下 [還原資料庫] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-510">In **Object Explorer**, right-click **Databases**, and then click **Restore Database**.</span></span>
10. <span data-ttu-id="faa08-511">在 [來源]  區段中，選取 [裝置] ，然後按一下 […]  省略符號</span><span class="sxs-lookup"><span data-stu-id="faa08-511">In the **Source** section, select **Device**, and click the ellipsis **…**</span></span> <span data-ttu-id="faa08-512">按鈕。</span><span class="sxs-lookup"><span data-stu-id="faa08-512">button.</span></span>
11. <span data-ttu-id="faa08-513">在 [選取備份裝置] 中按一下 [新增]。</span><span class="sxs-lookup"><span data-stu-id="faa08-513">In **Select backup devices**, click **Add**.</span></span>
12. <span data-ttu-id="faa08-514">在 [備份檔案位置]  中，輸入 **\\ContosoSQL1\backup**，按一下 [重新整理] **Refresh**，選取 **MyDB1.bak**，按一下 [確定] ，然後再按一次 [確定] **OK**。</span><span class="sxs-lookup"><span data-stu-id="faa08-514">In **Backup file location**, type **\\ContosoSQL1\backup**, click **Refresh**, select **MyDB1.bak**, click **OK**, and then click **OK** again.</span></span> <span data-ttu-id="faa08-515">在 [要還原的備份組]  窗格中，現在應會顯示完整備份和記錄備份。</span><span class="sxs-lookup"><span data-stu-id="faa08-515">You should now see the full backup and the log backup in the **Backup sets to restore** pane.</span></span>
13. <span data-ttu-id="faa08-516">移至 [選項]  頁面中，在 [復原狀態]  中選取 [使用 NORECOVERY 還原]，然後按一下 [確定] ，以還原資料庫。</span><span class="sxs-lookup"><span data-stu-id="faa08-516">Go to the **Options** page, select **RESTORE WITH NORECOVERY** in **Recovery state**, and then click **OK** to restore the database.</span></span> <span data-ttu-id="faa08-517">還原作業完成後，按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-517">After the restore operation finishes, click **OK**.</span></span>

### <a name="create-the-availability-group"></a><span data-ttu-id="faa08-518">建立可用性群組</span><span class="sxs-lookup"><span data-stu-id="faa08-518">Create the availability group</span></span>
1. <span data-ttu-id="faa08-519">回到 **ContosoSQL1**的遠端桌面工作階段。</span><span class="sxs-lookup"><span data-stu-id="faa08-519">Go back to the remote desktop session for **ContosoSQL1**.</span></span> <span data-ttu-id="faa08-520">如下列螢幕擷取畫面所示，在 SQL Server Management Studio 的 [物件總管]  中，以滑鼠右鍵按一下 [AlwaysOn 高可用性] ，然後按一下 [新增可用性群組精靈] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-520">In **Object Explorer** in SQL Server Management Studio, right-click **Always On High Availability**, and then click **New Availability Group Wizard**, as shown in the following screenshot.</span></span>
   
    ![啟動新增可用性群組精靈](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665523.gif)
2. <span data-ttu-id="faa08-522">在 [簡介]  頁面上，按一下 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-522">On the **Introduction** page, click **Next**.</span></span> <span data-ttu-id="faa08-523">在 [指定可用性群組名稱]  頁面上，於 [可用性群組名稱]  中輸入 [AG1] ，然後再次按 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-523">On the **Specify Availability Group Name** page, type **AG1** in **Availability group name**, then click **Next** again.</span></span>
   
    ![新增可用性群組精靈，指定可用性群組名稱](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665524.gif)
3. <span data-ttu-id="faa08-525">在 [選取資料庫]  頁面上，選取 [MyDB1] ，然後按 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-525">On the **Select Databases** page, select **MyDB1**, and then click **Next**.</span></span> <span data-ttu-id="faa08-526">由於您已經為預定的主要複本建立了至少一份完整備份，所以現在這些資料庫已符合建立可用性群組的先決條件。</span><span class="sxs-lookup"><span data-stu-id="faa08-526">The database meets the prerequisites for an availability group because you have taken at least one full backup on the intended primary replica.</span></span>
   
    ![新增可用性群組精靈：選取資料庫](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665525.gif)
4. <span data-ttu-id="faa08-528">在 [指定複本]  頁面上，按一下 [新增複本] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-528">on the **Specify Replicas** page, click **Add Replica**.</span></span>
   
    ![新增可用性群組精靈：選取複本](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665526.gif)
5. <span data-ttu-id="faa08-530">在 [連接到伺服器]  對話方塊至中，在 [伺服器名稱]  中輸入 **ContosoSQL2**，然後按一下 [連接] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-530">In the **Connect to Server** dialog box, type **ContosoSQL2** in **Server name**, and then click **Connect**.</span></span>
   
    ![新增可用性群組精靈：連接到伺服器](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665527.gif)
6. <span data-ttu-id="faa08-532">回到 [指定複本]  頁面，現在 [可用複本]  中應會列出 **ContosoSQL2**。</span><span class="sxs-lookup"><span data-stu-id="faa08-532">Back on the **Specify Replicas** page, you should now see **ContosoSQL2** listed in **Available Replicas**.</span></span> <span data-ttu-id="faa08-533">如下列螢幕擷取畫面所示，設定複本。</span><span class="sxs-lookup"><span data-stu-id="faa08-533">Configure the replicas as shown in the following screenshot.</span></span> <span data-ttu-id="faa08-534">完成後，請按 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-534">When you are finished, click **Next**.</span></span>
   
    ![新增可用性群組精靈：選取複本 (完整)](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665528.gif)
7. <span data-ttu-id="faa08-536">在 [選取初始資料同步處理]  頁面上，按一下 [僅聯結] ，然後按 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-536">On the **Select Initial Data Synchronization** page, select **Join only**, and then click **Next**.</span></span> <span data-ttu-id="faa08-537">您在建立 **ContosoSQL1** 的完整備份和交易備份，並將備份還原至 **ContosoSQL2** 時，便已手動執行資料同步處理。</span><span class="sxs-lookup"><span data-stu-id="faa08-537">You already performed data synchronization manually when you made the full and transaction backups on **ContosoSQL1** and restored them on **ContosoSQL2**.</span></span> <span data-ttu-id="faa08-538">您可以改為選擇不在資料庫上執行備份與還原作業，並選取 [完整]  讓新可用性群組精靈為您執行資料同步處理。</span><span class="sxs-lookup"><span data-stu-id="faa08-538">You can choose not to perform the backup and restore operations on your database and instead select **Full** to let the New Availability Group Wizard perform data synchronization for you.</span></span> <span data-ttu-id="faa08-539">不過，我們不建議針對某些企業中的超大型資料庫採用這種選項。</span><span class="sxs-lookup"><span data-stu-id="faa08-539">However, we do not recommend this option for very large databases that are found in some enterprises.</span></span>
   
    ![新增可用性群組精靈：選取初始資料同步處理](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665529.gif)
8. <span data-ttu-id="faa08-541">在 [驗證]  頁面中按 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-541">On the **Validation** page, click **Next**.</span></span> <span data-ttu-id="faa08-542">此頁面應該會看起來如下列螢幕擷取畫面所示：</span><span class="sxs-lookup"><span data-stu-id="faa08-542">This page should look similar to the following screenshot.</span></span> <span data-ttu-id="faa08-543">由於您尚未設定可用性群組接聽程式，所以出現了關於接聽程式組態的警告。</span><span class="sxs-lookup"><span data-stu-id="faa08-543">There is a warning for the listener configuration because you have not configured an availability group listener.</span></span> <span data-ttu-id="faa08-544">您可以忽略此警告，因為本教學課程不會示範設定接聽程式的步驟。</span><span class="sxs-lookup"><span data-stu-id="faa08-544">You can ignore this warning, because this tutorial does not configure a listener.</span></span> <span data-ttu-id="faa08-545">完成此教學課程之後，若要設定接聽程式，請參閱 [設定 Azure 中 AlwaysOn 可用性群組的 ILB 接聽程式](../classic/ps-sql-int-listener.md)。</span><span class="sxs-lookup"><span data-stu-id="faa08-545">To configure the listener after you complete this tutorial, see [Configure an ILB listener for Always On Availability Groups in Azure](../classic/ps-sql-int-listener.md).</span></span>
   
    ![新增可用性群組精靈：驗證](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665530.gif)
9. <span data-ttu-id="faa08-547">在 [摘要]  頁面中，按一下 [完成] ，然後等候精靈設定新的「可用性群組」。</span><span class="sxs-lookup"><span data-stu-id="faa08-547">On the **Summary** page, click **Finish**, and then wait while the wizard configures the new availability group.</span></span> <span data-ttu-id="faa08-548">在 [進度]  頁面中，按一下 [詳細資料]  可檢視詳細的進度。</span><span class="sxs-lookup"><span data-stu-id="faa08-548">On the **Progress** page, you can click **More details** to view the detailed progress.</span></span> <span data-ttu-id="faa08-549">精靈完成後，如下列螢幕擷取畫面所示，檢查 [結果]  頁面，確認是否已成功建立可用性群組，然後按一下 [關閉]  以結束精靈。</span><span class="sxs-lookup"><span data-stu-id="faa08-549">After the wizard finishes, inspect the **Results** page to verify that the availability group is successfully created, as shown in the following screenshot, and then click **Close** to exit the wizard.</span></span>
   
    ![新增可用性群組精靈：結果](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665531.gif)
10. <span data-ttu-id="faa08-551">在 [物件總管]  中，展開 [AlwaysOn 高可用性] ，再展開 [可用性群組] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-551">In **Object Explorer**, expand **Always On High Availability**, and then expand **Availability Groups**.</span></span> <span data-ttu-id="faa08-552">新的可用性群組應會顯示在此容器中。</span><span class="sxs-lookup"><span data-stu-id="faa08-552">You should now see the new availability group in this container.</span></span> <span data-ttu-id="faa08-553">以滑鼠右鍵按一下 [AG1 (主要)] ，再按一下 [顯示儀表板] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-553">Right-click **AG1 (Primary)**, and then click **Show Dashboard**.</span></span>
    
     ![顯示可用性群組儀表板](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665532.gif)
11. <span data-ttu-id="faa08-555">[AlwaysOn 儀表板]  的外觀應類似於下列螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="faa08-555">Your **Always On Dashboard** should look similar to the one in the following screenshot.</span></span> <span data-ttu-id="faa08-556">當中會顯示複本、每個複本的容錯移轉模式和同步處理狀態。</span><span class="sxs-lookup"><span data-stu-id="faa08-556">You can see the replicas, the failover mode of each replica, and the synchronization state.</span></span>
    
     ![可用性群組儀表板](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665533.gif)
12. <span data-ttu-id="faa08-558">回到 [伺服器管理員] ，選取 [工具] ，然後啟動 [容錯移轉叢集管理員] 。</span><span class="sxs-lookup"><span data-stu-id="faa08-558">Return to **Server Manager**, click **Tools**, and then open **Failover Cluster Manager**.</span></span>
13. <span data-ttu-id="faa08-559">展開 [Cluster1.corp.contoso.com]，然後展開 [服務和應用程式]。</span><span class="sxs-lookup"><span data-stu-id="faa08-559">Expand **Cluster1.corp.contoso.com**, and then expand **Services and applications**.</span></span> <span data-ttu-id="faa08-560">選取 [角色]。請注意，先前已建立了 **AG1** 的可用性群組角色。</span><span class="sxs-lookup"><span data-stu-id="faa08-560">Select **Roles** and note that the **AG1** availability group role has been created.</span></span> <span data-ttu-id="faa08-561">請注意，由於您未設定接聽程式，所以 AG1 不具備任何資料庫用戶端可用來連接至可用性群組的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="faa08-561">Note that AG1 does not have an IP address by which database clients can connect to the availability group, because you did not configure a listener.</span></span> <span data-ttu-id="faa08-562">直接連接至主要節點，可進行讀寫作業，連接至次要節點，則可進行唯讀查詢。</span><span class="sxs-lookup"><span data-stu-id="faa08-562">You can connect directly to the primary node for read-write operations and the secondary node for read-only queries.</span></span>
    
     ![容錯移轉叢集管理員中的 AG](./media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665534.gif)

> [!WARNING]
> <span data-ttu-id="faa08-564">請勿嘗試透過容錯移轉叢集管理員，容錯移轉可用性群組。</span><span class="sxs-lookup"><span data-stu-id="faa08-564">Do not try to fail over the availability group from the Failover Cluster Manager.</span></span> <span data-ttu-id="faa08-565">所有容錯移轉作業都應在 SQL Server Management Studio 的 [AlwaysOn 儀表板]  中執行。</span><span class="sxs-lookup"><span data-stu-id="faa08-565">All failover operations should be performed from within **Always On Dashboard** in SQL Server Management Studio.</span></span> <span data-ttu-id="faa08-566">如需詳細資訊，請參閱[容錯移轉叢集管理員與可用性群組一起使用的限制](https://msdn.microsoft.com/library/ff929171.aspx)。</span><span class="sxs-lookup"><span data-stu-id="faa08-566">For more information, see [Restrictions on Using The Failover Cluster Manager with Availability Groups](https://msdn.microsoft.com/library/ff929171.aspx).</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="faa08-567">後續步驟</span><span class="sxs-lookup"><span data-stu-id="faa08-567">Next steps</span></span>
<span data-ttu-id="faa08-568">現在，您已透過在 Azure 中建立可用性群組的方式，成功實作 SQL Server Always On。</span><span class="sxs-lookup"><span data-stu-id="faa08-568">You have now successfully implemented SQL Server Always On by creating an availability group in Azure.</span></span> <span data-ttu-id="faa08-569">若要為此可用性群組設定接聽程式，請參閱 [設定 Azure 中 AlwaysOn 可用性群組的 ILB 接聽程式](../classic/ps-sql-int-listener.md)。</span><span class="sxs-lookup"><span data-stu-id="faa08-569">To configure a listener for this availability group, see [Configure an ILB listener for Always On availability groups in Azure](../classic/ps-sql-int-listener.md).</span></span>

<span data-ttu-id="faa08-570">如需在 Azure 中使用 SQL Server 的其他資訊，請參閱 [Azure 虛擬機器上的 SQL Server](../sql/virtual-machines-windows-sql-server-iaas-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="faa08-570">For other information about using SQL Server in Azure, see [SQL Server on Azure Virtual Machines](../sql/virtual-machines-windows-sql-server-iaas-overview.md).</span></span>

