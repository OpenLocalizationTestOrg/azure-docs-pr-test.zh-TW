---
title: "aaaAdd 監視與診斷 tooan Azure 虛擬機器 |Microsoft 文件"
description: "使用 Azure 診斷擴充功能的 Azure 資源管理員範本 toocreate 新的 Windows 虛擬機器。"
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d8a831421a0f9d38c09d51cf8c2e6dff913c77ff
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="835a9-103">使用 Windows VM 和 Azure Resource Manager 範本的監視和診斷</span><span class="sxs-lookup"><span data-stu-id="835a9-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="835a9-104">hello Azure 診斷擴充功能提供 hello 監視和診斷功能，在 Windows Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="835a9-104">hello Azure Diagnostics Extension provides hello monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="835a9-105">您可以啟用 hello 虛擬機器上的這些功能包括 hello 副檔名 hello azure 資源管理員範本的一部分。</span><span class="sxs-lookup"><span data-stu-id="835a9-105">You can enable these capabilities on hello virtual machine by including hello extension as part of hello azure resource manager template.</span></span> <span data-ttu-id="835a9-106">請參閱 [使用 VM 延伸模組編寫 Azure 資源管理員範本](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) ，以取得將任何延伸模組納入為虛擬機器範本一部分的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="835a9-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="835a9-107">本文說明如何新增 hello Azure 診斷擴充功能 tooa windows 虛擬機器範本。</span><span class="sxs-lookup"><span data-stu-id="835a9-107">This article describes how you can add hello Azure Diagnostics extension tooa windows virtual machine template.</span></span>  

## <a name="add-hello-azure-diagnostics-extension-toohello-vm-resource-definition"></a><span data-ttu-id="835a9-108">新增 hello Azure 診斷擴充功能 toohello VM 資源定義</span><span class="sxs-lookup"><span data-stu-id="835a9-108">Add hello Azure Diagnostics extension toohello VM resource definition</span></span>
<span data-ttu-id="835a9-109">tooenable hello 診斷擴充功能在 Windows 虛擬機器您為 VM 資源中需要 tooadd hello 延伸 hello 資源管理員範本。</span><span class="sxs-lookup"><span data-stu-id="835a9-109">tooenable hello diagnostics extension on a Windows Virtual Machine you need tooadd hello extension as a VM resource in hello Resource manager template.</span></span>

<span data-ttu-id="835a9-110">簡單資源管理員的基礎的虛擬機器加入 hello 延伸模組組態 toohello*資源*hello 虛擬機器的陣列：</span><span class="sxs-lookup"><span data-stu-id="835a9-110">For a simple Resource Manager based Virtual Machine add hello extension configuration toohello *resources* array for hello Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="835a9-111">另一個常見慣例是在 hello 範本，而不是定義在 hello 虛擬機器的資源 節點下的 hello 根資源節點加入 hello 延伸模組組態。</span><span class="sxs-lookup"><span data-stu-id="835a9-111">Another common convention is add hello extension configuration at hello root resources node of hello template instead of defining it under hello virtual machine's resources node.</span></span> <span data-ttu-id="835a9-112">透過這種方式，您有 tooexplicitly hello 延伸模組和 hello 虛擬機器之間的階層式關聯性指定以 hello*名稱*和*類型*值。</span><span class="sxs-lookup"><span data-stu-id="835a9-112">With this approach you have tooexplicitly specify a hierarchical relation between hello extension and hello virtual machine with hello *name* and *type* values.</span></span> <span data-ttu-id="835a9-113">例如：</span><span class="sxs-lookup"><span data-stu-id="835a9-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="835a9-114">hello 延伸永遠都會與 hello 虛擬機器相關聯，您可以直接定義 hello 虛擬機器的資源 節點下直接或定義在 hello 基底層級並使用 hello 階層式命名慣例 tooassociate 它以 hello 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="835a9-114">hello extension is always associated with hello virtual machine, you can either directly define it under hello virtual machine's resource node directly or define it at hello base level and use hello hierarchical naming convention tooassociate it with hello virtual machine.</span></span>

<span data-ttu-id="835a9-115">針對虛擬機器擴展集 hello 延伸模組組態會指定在 hello *extensionProfile*屬性 hello *VirtualMachineProfile*。</span><span class="sxs-lookup"><span data-stu-id="835a9-115">For Virtual Machine Scale Sets hello extensions configuration is specified in hello *extensionProfile* property of hello *VirtualMachineProfile*.</span></span>

<span data-ttu-id="835a9-116">hello*發行者*屬性與 hello 值**Microsoft.Azure.Diagnostics**和 hello*類型*屬性 hello 值是**IaaSDiagnostics**唯一識別 hello Azure 診斷擴充功能。</span><span class="sxs-lookup"><span data-stu-id="835a9-116">hello *publisher* property with hello value of **Microsoft.Azure.Diagnostics** and hello *type* property with hello value of **IaaSDiagnostics** uniquely identify hello Azure Diagnostics extension.</span></span>

<span data-ttu-id="835a9-117">hello 值 hello*名稱*屬性可以是使用的 toorefer toohello 延伸 hello 資源群組中。</span><span class="sxs-lookup"><span data-stu-id="835a9-117">hello value of hello *name* property can be used toorefer toohello extension in hello resource group.</span></span> <span data-ttu-id="835a9-118">將它設定特別太**Microsoft.Insights.VMDiagnosticsSettings**會啟用它 toobe hello Azure 入口網站確保 hello 監視圖表都會顯示正確在 hello Azure 入口網站，輕鬆地識別。</span><span class="sxs-lookup"><span data-stu-id="835a9-118">Setting it specifically too**Microsoft.Insights.VMDiagnosticsSettings** will enable it toobe easily identified by hello Azure portal ensuring that hello monitoring charts show up correctly in hello Azure portal.</span></span>

<span data-ttu-id="835a9-119">hello *typeHandlerVersion*指定 hello 版本 hello 延伸模組，您想要 toouse。</span><span class="sxs-lookup"><span data-stu-id="835a9-119">hello *typeHandlerVersion* specifies hello version of hello extension you would like toouse.</span></span> <span data-ttu-id="835a9-120">設定*autoUpgradeMinorVersion*太次要版本**true**可確保您會收到 hello 最新次要版本所提供的 hello 延伸模組。</span><span class="sxs-lookup"><span data-stu-id="835a9-120">Setting *autoUpgradeMinorVersion* minor version too**true** ensures that you will get hello latest Minor version of hello extension that is available.</span></span> <span data-ttu-id="835a9-121">強烈建議您一律將*autoUpgradeMinorVersion* tooalways 是**true**以便讓您一律取得 toouse hello 最新可用的診斷擴充功能與所有 hello 新功能和 bug修正程式。</span><span class="sxs-lookup"><span data-stu-id="835a9-121">It is highly recommended that you always set *autoUpgradeMinorVersion* tooalways be **true** so that you always get toouse hello latest available diagnostics extension with all hello new features and bug fixes.</span></span> 

<span data-ttu-id="835a9-122">hello*設定*元素包含可設定及讀取來自 hello 擴充功能 （有時參照的 tooas 公用組態） 的 hello 擴充功能的組態屬性。</span><span class="sxs-lookup"><span data-stu-id="835a9-122">hello *settings* element contains configurations properties for hello extension that can be set and read back from hello extension (sometimes referred tooas public configuration).</span></span> <span data-ttu-id="835a9-123">hello *xmlcfg*屬性包含 xml 架構組態 hello 診斷記錄檔、 效能計數器將 hello 診斷代理程式所收集的等等。</span><span class="sxs-lookup"><span data-stu-id="835a9-123">hello *xmlcfg* property contains xml based configuration for hello diagnostics logs, performance counters etc that will be collected by hello diagnostics agent.</span></span> <span data-ttu-id="835a9-124">請參閱[診斷組態結構描述](https://msdn.microsoft.com/library/azure/dn782207.aspx)如需有關 hello xml 結構描述本身。</span><span class="sxs-lookup"><span data-stu-id="835a9-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about hello xml schema itself.</span></span> <span data-ttu-id="835a9-125">常見的作法是 toostore hello 實際的 xml 組態，因為變數在 hello Azure Resource Manager 範本，然後串連和 base64 編碼它們 tooset hello 值*xmlcfg*。</span><span class="sxs-lookup"><span data-stu-id="835a9-125">A common practice is toostore hello actual xml configuration as a variable in hello Azure Resource Manager template and then concatenate and base64 encode them tooset hello value for *xmlcfg*.</span></span> <span data-ttu-id="835a9-126">請參閱 hello 章節[診斷組態變數](#diagnostics-configuration-variables)toounderstand 深入了解如何 toostore hello 變數中的 xml。</span><span class="sxs-lookup"><span data-stu-id="835a9-126">See hello section on [diagnostics configuration variables](#diagnostics-configuration-variables) toounderstand more about how toostore hello xml in variables.</span></span> <span data-ttu-id="835a9-127">hello *storageAccount*屬性會指定將會傳送 hello hello 儲存體帳戶 toowhich 診斷資料的名稱。</span><span class="sxs-lookup"><span data-stu-id="835a9-127">hello *storageAccount* property specifies hello name of hello storage account toowhich diagnostics data will be transferred.</span></span> 

<span data-ttu-id="835a9-128">hello 中的屬性*protectedSettings* （有時參照的 tooas 私用組態） 可以設定，但無法讀取之後設定。</span><span class="sxs-lookup"><span data-stu-id="835a9-128">hello properties in *protectedSettings* (sometimes referred tooas private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="835a9-129">hello 唯寫性質*protectedSettings*方便來儲存機密資料，例如 hello 儲存體帳戶金鑰寫入 hello 診斷資料。</span><span class="sxs-lookup"><span data-stu-id="835a9-129">hello write-only nature of *protectedSettings* makes it useful for storing secrets like hello storage account key where hello diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="835a9-130">將診斷儲存體帳戶指定為參數</span><span class="sxs-lookup"><span data-stu-id="835a9-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="835a9-131">hello 診斷延伸模組 json 片段上述假設兩個參數*existingdiagnosticsStorageAccountName*和*existingdiagnosticsStorageResourceGroup* toospecify hello 診斷儲存診斷資料的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="835a9-131">hello diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="835a9-132">Hello 診斷儲存體帳戶指定為參數可讓您輕鬆 toochange hello 診斷儲存體帳戶跨不同的環境，例如您可能會想 toouse 不同診斷儲存體帳戶進行測試和不同的另一個用於您生產環境部署。</span><span class="sxs-lookup"><span data-stu-id="835a9-132">Specifying hello diagnostics storage account as a parameter makes it easy toochange hello diagnostics storage account across different environments e.g. you may want toouse a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "hello name of an existing storage account toowhich diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "hello resource group for hello storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="835a9-133">它是最佳作法 toospecify 診斷儲存體帳戶位於不同的資源群組的 hello hello 虛擬機器的資源群組。</span><span class="sxs-lookup"><span data-stu-id="835a9-133">It is best practice toospecify a diagnostics storage account in a different resource group than hello resource group for hello virtual machine.</span></span> <span data-ttu-id="835a9-134">資源群組可視為 toobe 部署單位具有自己的存留期、 虛擬機器部署及重新部署新的組態更新進行會 tooit，但是您可能想將 hello 診斷資料儲存在 hello toocontinue 相同儲存體帳戶所有這些虛擬機器部署。</span><span class="sxs-lookup"><span data-stu-id="835a9-134">A resource group can be considered toobe a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it tooit but you may want toocontinue storing hello diagnostics data in hello same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="835a9-135">具有 hello 儲存體帳戶中不同的資源啟用 hello 儲存體帳戶 tooaccept 資料從各種不同的虛擬機器部署，讓您輕鬆 tootroubleshoot 跨問題 hello 各種版本。</span><span class="sxs-lookup"><span data-stu-id="835a9-135">Having hello storage account in a different resource enables hello storage account tooaccept data from various virtual machine deployments making it easy tootroubleshoot issues across hello various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="835a9-136">如果您從 Visual Studio 可能會設定 hello 預設儲存體帳戶中建立 windows 虛擬機器範本 toouse hello hello 虛擬機器 VHD 會上傳所在的相同儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="835a9-136">If you create a windows virtual machine template from Visual Studio hello default storage account might be set toouse hello same storage account where hello virtual machine VHD is uploaded.</span></span> <span data-ttu-id="835a9-137">這是 hello VM toosimplify 初始設定。</span><span class="sxs-lookup"><span data-stu-id="835a9-137">This is toosimplify initial setup of hello VM.</span></span> <span data-ttu-id="835a9-138">您應重新考量因素 hello 範本 toouse 可以做為參數中傳遞不同的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="835a9-138">You should re-factor hello template toouse a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="835a9-139">診斷組態變數</span><span class="sxs-lookup"><span data-stu-id="835a9-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="835a9-140">hello 診斷延伸模組 json 片段上述定義*accountid*變數 toosimplify 取得 hello hello 診斷儲存體的儲存體帳戶金鑰：</span><span class="sxs-lookup"><span data-stu-id="835a9-140">hello diagnostics extension json snippet above defines an *accountid* variable toosimplify getting hello storage account key for hello diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="835a9-141">hello *xmlcfg* hello 診斷延伸模組屬性定義使用串連在一起的多個變數。</span><span class="sxs-lookup"><span data-stu-id="835a9-141">hello *xmlcfg* property for hello diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="835a9-142">hello 這些變數的值是 xml 格式，所以它們需要 toobe 逸出正確地設定 hello json 的變數時。</span><span class="sxs-lookup"><span data-stu-id="835a9-142">hello values of these variables are in xml so they need toobe escaped correctly when setting hello json variables.</span></span>

<span data-ttu-id="835a9-143">hello 以下說明會收集標準系統層級的效能計數器，以及某些 windows 事件記錄檔和診斷基礎結構記錄檔的 hello 診斷組態 xml。</span><span class="sxs-lookup"><span data-stu-id="835a9-143">hello following describes hello diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="835a9-144">尚未逸出和正確格式化，以便 hello 組態可以直接貼到您的範本 hello 變數區段。</span><span class="sxs-lookup"><span data-stu-id="835a9-144">It has been escaped and formatted correctly so that hello configuration can directly be pasted into hello variables section of your template.</span></span> <span data-ttu-id="835a9-145">請參閱 hello[診斷組態結構描述](https://msdn.microsoft.com/library/azure/dn782207.aspx)更人類可讀取 hello 組態 xml 的範例。</span><span class="sxs-lookup"><span data-stu-id="835a9-145">See hello [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of hello configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="835a9-146">hello 度量定義 hello 上述組態中的 xml 節點是重要的設定項目，因為它會定義先前已在中的 hello xml hello 效能計數器的定義方式*PerformanceCounter*節點將會彙總及儲存。</span><span class="sxs-lookup"><span data-stu-id="835a9-146">hello Metrics definition xml node in hello above configuration is an important configuration element as it defines how hello performance counters defined earlier in hello xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="835a9-147">這些度量磁碟機 hello 監視圖表和 hello Azure 入口網站中的警示。</span><span class="sxs-lookup"><span data-stu-id="835a9-147">These metrics drive hello monitoring charts and alerts in hello Azure portal.</span></span>  <span data-ttu-id="835a9-148">hello**度量**節點以 hello *resourceID*和**MetricAggregation**必須包含在 VM 的 hello 診斷組態中，如果您想 toosee hello VM在 hello Azure 入口網站中的監視資料。</span><span class="sxs-lookup"><span data-stu-id="835a9-148">hello **Metrics** node with hello *resourceID* and **MetricAggregation** must be included in hello diagnostics configuration for your VM if you want toosee hello VM monitoring data in hello Azure portal.</span></span> 
> 
> 

<span data-ttu-id="835a9-149">hello 如下的度量定義 hello xml 範例：</span><span class="sxs-lookup"><span data-stu-id="835a9-149">hello following is an example of hello xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="835a9-150">hello *resourceID*屬性可唯一識別您的訂用帳戶中的 hello 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="835a9-150">hello *resourceID* attribute uniquely identifies hello virtual machine in your subscription.</span></span> <span data-ttu-id="835a9-151">請確定 toouse hello subscription() 和 resourceGroup() 函式使 hello 範本會自動更新這些值根據您要部署的 hello 訂用帳戶和資源群組。</span><span class="sxs-lookup"><span data-stu-id="835a9-151">Make sure toouse hello subscription() and resourceGroup() functions so that hello template automatically updates those values based on hello subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="835a9-152">如果您要在迴圈中建立多個虛擬機器，則您必須 toopopulate hello *resourceID* copyIndex() 函式 toocorrectly 值區分每個個別的 VM。</span><span class="sxs-lookup"><span data-stu-id="835a9-152">If you are creating multiple Virtual Machines in a loop then you will have toopopulate hello *resourceID* value with an copyIndex() function toocorrectly differentiate each individual VM.</span></span> <span data-ttu-id="835a9-153">hello *xmlCfg*值可以是更新的 toosupport 這，如下所示：</span><span class="sxs-lookup"><span data-stu-id="835a9-153">hello *xmlCfg* value can be updated toosupport this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="835a9-154">hello MetricAggregation 值*PT1H*和*PT1M*表示彙總一分鐘內，一小時的彙總。</span><span class="sxs-lookup"><span data-stu-id="835a9-154">hello MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="835a9-155">儲存體中的 WADMetrics 資料表</span><span class="sxs-lookup"><span data-stu-id="835a9-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="835a9-156">上述的 hello 度量組態會在診斷儲存體帳戶中產生資料表以 hello 遵循命名慣例：</span><span class="sxs-lookup"><span data-stu-id="835a9-156">hello Metrics configuration above will generate tables in your diagnostics storage account with hello following naming conventions:</span></span>

* <span data-ttu-id="835a9-157">**WADMetrics** ：所有 WADMetrics 資料表的標準前置詞</span><span class="sxs-lookup"><span data-stu-id="835a9-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="835a9-158">**PT1H**或**PT1M** ： 表示該 hello 資料表包含超過 1 小時或 1 分鐘的彙總資料</span><span class="sxs-lookup"><span data-stu-id="835a9-158">**PT1H** or **PT1M** : Signifies that hello table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="835a9-159">**P10D** ： 表示 hello 資料表將包含 10 天從 hello 資料表開始收集資料的資料</span><span class="sxs-lookup"><span data-stu-id="835a9-159">**P10D** : Signifies hello table will contain data for 10 days from when hello table started collecting data</span></span>
* <span data-ttu-id="835a9-160">**V2S** ：字串常數</span><span class="sxs-lookup"><span data-stu-id="835a9-160">**V2S** : String constant</span></span>
* <span data-ttu-id="835a9-161">**yyyymmdd** : hello 的 hello 資料表開始收集資料的日期</span><span class="sxs-lookup"><span data-stu-id="835a9-161">**yyyymmdd** : hello date at which hello table started collecting data</span></span>

<span data-ttu-id="835a9-162">範例： *WADMetricsPT1HP10DV2S20151108* 將包含從 2015 年 11 月 11 日開始 10 天內，所有超過一小時的彙總計量資料</span><span class="sxs-lookup"><span data-stu-id="835a9-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="835a9-163">每個 WADMetrics 資料表將會包含下列資料行的 hello:</span><span class="sxs-lookup"><span data-stu-id="835a9-163">Each WADMetrics table will contain hello following columns:</span></span>

* <span data-ttu-id="835a9-164">**PartitionKey**: hello partitionkey 建構根據 hello *resourceID*值 toouniquely 識別 hello VM 資源。</span><span class="sxs-lookup"><span data-stu-id="835a9-164">**PartitionKey**: hello partitionkey is constructed based on hello *resourceID* value toouniquely identify hello VM resource.</span></span> <span data-ttu-id="835a9-165">例如：002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="835a9-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="835a9-166">**RowKey** ： 如下所示 hello 格式<Descending time tick>:<Performance Counter Name>。</span><span class="sxs-lookup"><span data-stu-id="835a9-166">**RowKey** : Follows hello format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="835a9-167">hello 遞減時間刻度計算是減號 hello hello 彙總期間的 hello 開始時間的最大時間刻度。</span><span class="sxs-lookup"><span data-stu-id="835a9-167">hello descending time tick calculation is max time ticks minus hello time of hello beginning of hello aggregation period.</span></span> <span data-ttu-id="835a9-168">例如</span><span class="sxs-lookup"><span data-stu-id="835a9-168">E.g.</span></span> <span data-ttu-id="835a9-169">如果 hello 取樣期間啟動於 2015 年 11 月 10 日 00:00Hrs UTC 然後 hello 計算就是： DateTime.MaxValue.Ticks-(新 DateTime(2015,11,10,0,0,0,DateTimeKind.Utc)。刻度為單位）。</span><span class="sxs-lookup"><span data-stu-id="835a9-169">if hello sample period started on 10-Nov-2015 and 00:00Hrs UTC then hello calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="835a9-170">針對 hello 記憶體可用位元組數效能計數器 hello 資料列索引鍵看起來像： 2519551871999999999__:005CMemory:005CAvailable:0020 位元組</span><span class="sxs-lookup"><span data-stu-id="835a9-170">For hello memory available bytes performance counter hello row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="835a9-171">**CounterName** : hello hello 效能計數器名稱。</span><span class="sxs-lookup"><span data-stu-id="835a9-171">**CounterName** : Is hello name of hello performance counter.</span></span> <span data-ttu-id="835a9-172">這符合 hello *counterSpecifier* hello xml 組態中定義。</span><span class="sxs-lookup"><span data-stu-id="835a9-172">This matches hello *counterSpecifier* defined in hello xml config.</span></span>
* <span data-ttu-id="835a9-173">**最大**: hello 彙總期間 hello hello 效能計數器的最大值。</span><span class="sxs-lookup"><span data-stu-id="835a9-173">**Maximum** : hello maximum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="835a9-174">**最小**: hello 彙總期間 hello hello 效能計數器的最小值。</span><span class="sxs-lookup"><span data-stu-id="835a9-174">**Minimum** : hello minimum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="835a9-175">**總**: hello 彙總期間報告 hello 總和 hello 效能計數器的所有值。</span><span class="sxs-lookup"><span data-stu-id="835a9-175">**Total** : hello sum of all values of hello performance counter reported over hello aggregation period.</span></span>
* <span data-ttu-id="835a9-176">**計數**: hello 效能計數器回報 hello 值總數。</span><span class="sxs-lookup"><span data-stu-id="835a9-176">**Count** : hello total number of values reported for hello performance counter.</span></span>
* <span data-ttu-id="835a9-177">**平均**: hello 彙總期間 hello hello 效能計數器的平均值 （總計/計數） 值。</span><span class="sxs-lookup"><span data-stu-id="835a9-177">**Average** : hello average (total/count) value of hello performance counter over hello aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="835a9-178">後續步驟</span><span class="sxs-lookup"><span data-stu-id="835a9-178">Next Steps</span></span>
* <span data-ttu-id="835a9-179">如需具有診斷擴充功能之 Windows 虛擬機器的完整範例範本，請參閱 [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span><span class="sxs-lookup"><span data-stu-id="835a9-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="835a9-180">Hello 資源管理員範本使用部署[Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)或[Azure 命令列](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="835a9-180">Deploy hello resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="835a9-181">深入了解 [編寫 Azure 資源管理員範本](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="835a9-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>

