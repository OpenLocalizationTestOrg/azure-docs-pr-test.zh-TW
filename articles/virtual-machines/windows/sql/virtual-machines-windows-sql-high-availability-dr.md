---
title: "aaaHigh 的可用性和災害復原 SQL Server |Microsoft 文件"
description: "討論 hello 各種類型的 HADR 策略為 Azure 虛擬機器中執行的 SQL Server。"
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: 53981f7e-8370-4979-b26a-93a5988d905f
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 06/27/2017
ms.author: mikeray
ms.openlocfilehash: 2b62d8b30520952ba6b7da7177a2c2de95bea8ce
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="high-availability-and-disaster-recovery-for-sql-server-in-azure-virtual-machines"></a><span data-ttu-id="2ba82-103">Azure 虛擬機器中的 SQL Server 高可用性和災害復原</span><span class="sxs-lookup"><span data-stu-id="2ba82-103">High availability and disaster recovery for SQL Server in Azure Virtual Machines</span></span>

<span data-ttu-id="2ba82-104">與 SQL Server 的 Microsoft Azure 虛擬機器 (Vm) 可協助降低高可用性和災害復原 (HADR) 資料庫方案 hello 成本。</span><span class="sxs-lookup"><span data-stu-id="2ba82-104">Microsoft Azure virtual machines (VMs) with SQL Server can help lower hello cost of a high availability and disaster recovery (HADR) database solution.</span></span> <span data-ttu-id="2ba82-105">Azure 虛擬機器中支援大部分的 SQL Server HADR 解決方案 (僅限 Azure 以及混合式解決方案兩種)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-105">Most SQL Server HADR solutions are supported in Azure virtual machines, both as Azure-only and as hybrid solutions.</span></span> <span data-ttu-id="2ba82-106">僅 Azure 」 的方案，整個 HADR 系統 hello 都會在 Azure 中執行。</span><span class="sxs-lookup"><span data-stu-id="2ba82-106">In an Azure-only solution, hello entire HADR system runs in Azure.</span></span> <span data-ttu-id="2ba82-107">在混合式組態中，hello 方案的一部分在 Azure 中執行，並且 hello 其他部分執行內部部署組織中。</span><span class="sxs-lookup"><span data-stu-id="2ba82-107">In a hybrid configuration, part of hello solution runs in Azure and hello other part runs on-premises in your organization.</span></span> <span data-ttu-id="2ba82-108">hello hello Azure 環境的彈性可讓您 toomove 部分或完全 tooAzure toosatisfy hello 預算與 HADR 需求您的 SQL Server 資料庫系統。</span><span class="sxs-lookup"><span data-stu-id="2ba82-108">hello flexibility of hello Azure environment enables you toomove partially or completely tooAzure toosatisfy hello budget and HADR requirements of your SQL Server database systems.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../../includes/learn-about-deployment-models-both-include.md)]

## <a name="understanding-hello-need-for-an-hadr-solution"></a><span data-ttu-id="2ba82-109">了解 hello HADR 方案需要</span><span class="sxs-lookup"><span data-stu-id="2ba82-109">Understanding hello need for an HADR solution</span></span>
<span data-ttu-id="2ba82-110">是由 tooyou tooensure 資料庫系統擁有 hello hello 服務等級協定 (SLA) 需要的 HADR 功能。</span><span class="sxs-lookup"><span data-stu-id="2ba82-110">It is up tooyou tooensure that your database system possesses hello HADR capabilities that hello service-level agreement (SLA) requires.</span></span> <span data-ttu-id="2ba82-111">Azure 提供高可用性機制，例如服務修復後依然存在雲端服務和虛擬機器的失敗復原偵測的 hello 事實不保證能滿足所需的 hello SLA。</span><span class="sxs-lookup"><span data-stu-id="2ba82-111">hello fact that Azure provides high availability mechanisms, such as service healing for cloud services and failure recovery detection for Virtual Machines, does not itself guarantee you can meet hello desired SLA.</span></span> <span data-ttu-id="2ba82-112">這些機制保護 hello 的 hello Vm 的高可用性，但不是 hello 高可用性的 hello Vm 內執行的 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="2ba82-112">These mechanisms protect hello high availability of hello VMs but not hello high availability of SQL Server running inside hello VMs.</span></span> <span data-ttu-id="2ba82-113">它時，可將 hello SQL Server 執行個體 toofail hello VM 在線上且狀況良好。</span><span class="sxs-lookup"><span data-stu-id="2ba82-113">It is possible for hello SQL Server instance toofail while hello VM is online and healthy.</span></span> <span data-ttu-id="2ba82-114">此外，即使 hello Azure 所提供的高可用性機制允許停機時間的 hello Vm 的截止 tooevents 例如從軟體或硬體失敗及作業系統升級的復原。</span><span class="sxs-lookup"><span data-stu-id="2ba82-114">Moreover, even hello high availability mechanisms provided by Azure allow for downtime of hello VMs due tooevents such as recovery from software or hardware failures and operating system upgrades.</span></span>

<span data-ttu-id="2ba82-115">再者，Azure 中的異地備援儲存體 (GRS) (使用名為異地複寫功能進行實作) 對您的資料庫而言，可能不足以當作嚴重損壞修復解決方案使用。</span><span class="sxs-lookup"><span data-stu-id="2ba82-115">In addition, Geo Redundant Storage (GRS) in Azure, which is implemented with a feature called geo-replication, may not be an adequate disaster recovery solution for your databases.</span></span> <span data-ttu-id="2ba82-116">由於地理複寫會以非同步方式傳送資料，因此新的更新可能會遺失的嚴重損壞的 hello 事件中。</span><span class="sxs-lookup"><span data-stu-id="2ba82-116">Because geo-replication sends data asynchronously, recent updates can be lost in hello event of disaster.</span></span> <span data-ttu-id="2ba82-117">Hello 涵蓋更多關於地理複寫限制[地理複寫不支援在不同磁碟上的資料和記錄檔](#geo-replication-support)> 一節。</span><span class="sxs-lookup"><span data-stu-id="2ba82-117">More information regarding geo-replication limitations are covered in hello [Geo-replication not supported for data and log files on separate disks](#geo-replication-support) section.</span></span>

## <a name="hadr-deployment-architectures"></a><span data-ttu-id="2ba82-118">HADR 部署架構</span><span class="sxs-lookup"><span data-stu-id="2ba82-118">HADR deployment architectures</span></span>
<span data-ttu-id="2ba82-119">在 Azure 中支援的 SQL Server HADR 技術包括：</span><span class="sxs-lookup"><span data-stu-id="2ba82-119">SQL Server HADR technologies that are supported in Azure include:</span></span>

* [<span data-ttu-id="2ba82-120">Always On 可用性群組</span><span class="sxs-lookup"><span data-stu-id="2ba82-120">Always On Availability Groups</span></span>](https://technet.microsoft.com/library/hh510230.aspx)
* [<span data-ttu-id="2ba82-121">Always On 容錯移轉叢集執行個體</span><span class="sxs-lookup"><span data-stu-id="2ba82-121">Always On Failover Cluster Instances</span></span>](https://technet.microsoft.com/library/ms189134.aspx)
* [<span data-ttu-id="2ba82-122">記錄傳送</span><span class="sxs-lookup"><span data-stu-id="2ba82-122">Log Shipping</span></span>](https://technet.microsoft.com/library/ms187103.aspx)
* [<span data-ttu-id="2ba82-123">SQL Server 備份及還原與 Azure Blob 儲存體服務</span><span class="sxs-lookup"><span data-stu-id="2ba82-123">SQL Server Backup and Restore with Azure Blob Storage Service</span></span>](https://msdn.microsoft.com/library/jj919148.aspx)
* <span data-ttu-id="2ba82-124">[資料庫鏡像](https://technet.microsoft.com/library/ms189852.aspx) - SQL Server 2016 中已被取代</span><span class="sxs-lookup"><span data-stu-id="2ba82-124">[Database Mirroring](https://technet.microsoft.com/library/ms189852.aspx) - Deprecated in SQL Server 2016</span></span>

<span data-ttu-id="2ba82-125">很可能 toocombine hello 技術一起 tooimplement 具有高可用性和災害復原功能的 SQL Server 方案。</span><span class="sxs-lookup"><span data-stu-id="2ba82-125">It is possible toocombine hello technologies together tooimplement a SQL Server solution that has both high availability and disaster recovery capabilities.</span></span> <span data-ttu-id="2ba82-126">根據您所使用的 hello 技術，混合式部署可能需要以 hello Azure 虛擬網路的 VPN 通道。</span><span class="sxs-lookup"><span data-stu-id="2ba82-126">Depending on hello technology you use, a hybrid deployment may require a VPN tunnel with hello Azure virtual network.</span></span> <span data-ttu-id="2ba82-127">hello 的以下各節會示範一些 hello 範例部署架構。</span><span class="sxs-lookup"><span data-stu-id="2ba82-127">hello sections below show you some of hello example deployment architectures.</span></span>

## <a name="azure-only-high-availability-solutions"></a><span data-ttu-id="2ba82-128">僅限 Azure：高可用性解決方案</span><span class="sxs-lookup"><span data-stu-id="2ba82-128">Azure-only: High availability solutions</span></span>

<span data-ttu-id="2ba82-129">您可以在含有 Always On 可用性群組 (稱為可用性群組) 的資料庫層級，具備適用於 SQL Server 的高可用性解決方案。</span><span class="sxs-lookup"><span data-stu-id="2ba82-129">You can have a high availability solution for SQL Server at a database level with Always On Availability Groups - called availability groups.</span></span> <span data-ttu-id="2ba82-130">您也可以在含有 Always On 容錯移轉叢集執行個體 (容錯移轉叢集執行個體) 的執行個體層級，建立高可用性解決方案。</span><span class="sxs-lookup"><span data-stu-id="2ba82-130">You can also create a high availability solution at an instance level with Always On Failover Cluster Instances - failover cluster instances.</span></span> <span data-ttu-id="2ba82-131">如需額外的備援，您可以藉由在容錯移轉叢集執行個體上建立可用性群組，在這兩個層級上建立備援。</span><span class="sxs-lookup"><span data-stu-id="2ba82-131">For additional redundancy, you can create redundancy at both levels by creating availability groups on failover cluster instances.</span></span> 

| <span data-ttu-id="2ba82-132">Technology</span><span class="sxs-lookup"><span data-stu-id="2ba82-132">Technology</span></span> | <span data-ttu-id="2ba82-133">範例架構</span><span class="sxs-lookup"><span data-stu-id="2ba82-133">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="2ba82-134">**可用性群組**</span><span class="sxs-lookup"><span data-stu-id="2ba82-134">**Availability groups**</span></span> |<span data-ttu-id="2ba82-135">可用性複本執行於 Azure Vm 中 hello 相同區域提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="2ba82-135">Availability replicas running in Azure VMs in hello same region provide high availability.</span></span> <span data-ttu-id="2ba82-136">您需要 tooconfigure 網域控制站 VM，因為 Windows 容錯移轉叢集需要 Active Directory 網域。</span><span class="sxs-lookup"><span data-stu-id="2ba82-136">You need tooconfigure a domain controller VM, because Windows failover clustering requires an Active Directory domain.</span></span><br/> <span data-ttu-id="2ba82-137">![可用性群組](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_ha_always_on.gif)</span><span class="sxs-lookup"><span data-stu-id="2ba82-137">![Availability Groups](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_ha_always_on.gif)</span></span><br/><span data-ttu-id="2ba82-138">如需詳細資訊，請參閱[在 Azure (GUI) 中設定可用性群組](virtual-machines-windows-portal-sql-alwayson-availability-groups.md)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-138">For more information, see [Configure Availability Groups in Azure (GUI)](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span></span> |
| <span data-ttu-id="2ba82-139">**容錯移轉叢集執行個體**</span><span class="sxs-lookup"><span data-stu-id="2ba82-139">**Failover cluster instances**</span></span> |<span data-ttu-id="2ba82-140">有 3 種不同的方式可以建立需要使用共用儲存體的「容錯移轉叢集執行個體」(FCI)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-140">Failover Cluster Instances (FCI), which require shared storage, can be created in 3 different ways.</span></span><br/><br/><span data-ttu-id="2ba82-141">1.使用連接儲存體的 Azure Vm 中執行的雙節點容錯移轉叢集[Windows Server 2016 儲存空間直接存取\(S2D\) ](virtual-machines-windows-portal-sql-create-failover-cluster.md) tooprovide 軟體為基礎的虛擬 SAN。</span><span class="sxs-lookup"><span data-stu-id="2ba82-141">1. A two-node failover cluster running in Azure VMs with attached storage using [Windows Server 2016 Storage Spaces Direct \(S2D\)](virtual-machines-windows-portal-sql-create-failover-cluster.md) tooprovide a software-based virtual SAN.</span></span><br/><br/><span data-ttu-id="2ba82-142">2.在 Azure VM 中執行的雙節點容錯移轉叢集，搭配由協力廠商叢集解決方案支援的儲存體。</span><span class="sxs-lookup"><span data-stu-id="2ba82-142">2. A two-node failover cluster running in Azure VMs with storage supported by a third-party clustering solution.</span></span> <span data-ttu-id="2ba82-143">如需使用 SIOS DataKeeper 的特定範例，請參閱[使用容錯移轉叢集和協力廠商軟體 SIOS DataKeeper 之檔案共用的高可用性](https://azure.microsoft.com/blog/high-availability-for-a-file-share-using-wsfc-ilb-and-3rd-party-software-sios-datakeeper/) \(英文\)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-143">For a specific example that uses SIOS DataKeeper, see [High availability for a file share using failover clustering and 3rd party software SIOS DataKeeper](https://azure.microsoft.com/blog/high-availability-for-a-file-share-using-wsfc-ilb-and-3rd-party-software-sios-datakeeper/).</span></span><br/><br/><span data-ttu-id="2ba82-144">3.在 Azure VM 中執行的雙節點容錯移轉叢集，搭配透過 ExpressRoute 的遠端 iSCSI 目標共用區塊儲存體。</span><span class="sxs-lookup"><span data-stu-id="2ba82-144">3. A two-node failover cluster running in Azure VMs with remote iSCSI Target shared block storage via ExpressRoute.</span></span> <span data-ttu-id="2ba82-145">例如，NetApp 私用儲存體 (NPS) 會公開透過 ExpressRoute Equinix tooAzure Vm 使用 iSCSI 目標。</span><span class="sxs-lookup"><span data-stu-id="2ba82-145">For example, NetApp Private Storage (NPS) exposes an iSCSI target via ExpressRoute with Equinix tooAzure VMs.</span></span><br/><br/><span data-ttu-id="2ba82-146">協力廠商共用存放裝置和資料的複寫解決方案，您應該連絡 hello 廠商的任何問題相關的 tooaccessing 資料，在容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="2ba82-146">For third-party shared storage and data replication solutions, you should contact hello vendor for any issues related tooaccessing data on failover.</span></span><br/><br/><span data-ttu-id="2ba82-147">請注意，在 [Azure 檔案儲存體](https://azure.microsoft.com/services/storage/files/)最上層使用 FCI 尚未支援，因為這個解決方案不使用進階儲存體。</span><span class="sxs-lookup"><span data-stu-id="2ba82-147">Note that using FCI on top of [Azure File storage](https://azure.microsoft.com/services/storage/files/) is not supported yet, because this solution does not utilize Premium Storage.</span></span> <span data-ttu-id="2ba82-148">我們正在 toosupport 這很快。</span><span class="sxs-lookup"><span data-stu-id="2ba82-148">We are working toosupport this soon.</span></span> |

## <a name="azure-only-disaster-recovery-solutions"></a><span data-ttu-id="2ba82-149">僅限 Azure：災害復原解決方案</span><span class="sxs-lookup"><span data-stu-id="2ba82-149">Azure-only: Disaster recovery solutions</span></span>
<span data-ttu-id="2ba82-150">您可以使用可用性群組或資料庫鏡像，為 Azure 中的 SQL Server 資料庫提供災害復原解決方案，或者使用儲存體 Blob 進行備份和還原。</span><span class="sxs-lookup"><span data-stu-id="2ba82-150">You can have a disaster recovery solution for your SQL Server databases in Azure using availability groups, database mirroring, or backup and restore with storage blobs.</span></span>

| <span data-ttu-id="2ba82-151">Technology</span><span class="sxs-lookup"><span data-stu-id="2ba82-151">Technology</span></span> | <span data-ttu-id="2ba82-152">範例架構</span><span class="sxs-lookup"><span data-stu-id="2ba82-152">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="2ba82-153">**可用性群組**</span><span class="sxs-lookup"><span data-stu-id="2ba82-153">**Availability Groups**</span></span> |<span data-ttu-id="2ba82-154">為了進行嚴重損壞修復，可用性複本會在 Azure VM 的多個資料中心執行。</span><span class="sxs-lookup"><span data-stu-id="2ba82-154">Availability replicas running across multiple datacenters in Azure VMs for disaster recovery.</span></span> <span data-ttu-id="2ba82-155">這種跨區域解決方案可防止網站完全中斷。</span><span class="sxs-lookup"><span data-stu-id="2ba82-155">This cross-region solution protects against complete site outage.</span></span> <br/> <span data-ttu-id="2ba82-156">![可用性群組](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_alwayson.png)</span><span class="sxs-lookup"><span data-stu-id="2ba82-156">![Availability Groups](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_alwayson.png)</span></span><br/><span data-ttu-id="2ba82-157">在區域中，所有複本都應位於 hello 相同的雲端服務和 hello 相同的 VNet。</span><span class="sxs-lookup"><span data-stu-id="2ba82-157">Within a region, all replicas should be within hello same cloud service and hello same VNet.</span></span> <span data-ttu-id="2ba82-158">因為每個區域都有個別的 VNet，這些方案需要 VNet tooVNet 連線。</span><span class="sxs-lookup"><span data-stu-id="2ba82-158">Because each region will have a separate VNet, these solutions require VNet tooVNet connectivity.</span></span> <span data-ttu-id="2ba82-159">如需詳細資訊，請參閱[設定 VNet 對 VNet 連線使用 hello Azure 入口網站](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-159">For more information, see [Configure a VNet-to-VNet connection using hello Azure portal](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span></span> <span data-ttu-id="2ba82-160">如需詳細指示，請參閱[在不同區域中的 Azure 虛擬機器上設定 SQL Server 可用性群組](virtual-machines-windows-portal-sql-availability-group-dr.md)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-160">For detailed instructions, see [Configure a SQL Server Availability Group on Azure Virtual Machines in Different Regions](virtual-machines-windows-portal-sql-availability-group-dr.md).</span></span>|
| <span data-ttu-id="2ba82-161">**資料庫鏡像**</span><span class="sxs-lookup"><span data-stu-id="2ba82-161">**Database Mirroring**</span></span> |<span data-ttu-id="2ba82-162">為了進行嚴重損壞修復，主體、鏡像和伺服器會在不同的資料中心內執行。</span><span class="sxs-lookup"><span data-stu-id="2ba82-162">Principal and mirror and servers running in different datacenters for disaster recovery.</span></span> <span data-ttu-id="2ba82-163">由於 Active Directory 網域無法跨多個資料中心，因此您必須使用伺服器憑證進行部署。</span><span class="sxs-lookup"><span data-stu-id="2ba82-163">You must deploy using server certificates because an active directory domain cannot span multiple datacenters.</span></span><br/>![資料庫鏡像](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_dbmirroring.gif) |
| <span data-ttu-id="2ba82-165">**備份及還原與 Azure Blob 儲存體服務**</span><span class="sxs-lookup"><span data-stu-id="2ba82-165">**Backup and Restore with Azure Blob Storage Service**</span></span> |<span data-ttu-id="2ba82-166">生產資料庫直接 tooblob 存放在不同的資料中心針對災害復原備份。</span><span class="sxs-lookup"><span data-stu-id="2ba82-166">Production databases backed up directly tooblob storage in a different datacenter for disaster recovery.</span></span><br/><span data-ttu-id="2ba82-167">![備份與還原](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_backup_restore.gif)</span><span class="sxs-lookup"><span data-stu-id="2ba82-167">![Backup and Restore](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_backup_restore.gif)</span></span><br/><span data-ttu-id="2ba82-168">如需詳細資訊，請參閱 [Azure 虛擬機器中 SQL Server 的備份與還原](virtual-machines-windows-sql-backup-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-168">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-backup-recovery.md).</span></span> |

## <a name="hybrid-it-disaster-recovery-solutions"></a><span data-ttu-id="2ba82-169">混合式 IT：災害復原解決方案</span><span class="sxs-lookup"><span data-stu-id="2ba82-169">Hybrid IT: Disaster recovery solutions</span></span>
<span data-ttu-id="2ba82-170">您可以使用可用性群組、資料庫鏡像及記錄傳送，為混合式 IT 環境中的 SQL Server 資料庫提供災害復原解決方案，以及使用 Azure Blob 儲存體進行備份和還原。</span><span class="sxs-lookup"><span data-stu-id="2ba82-170">You can have a disaster recovery solution for your SQL Server databases in a hybrid-IT environment using availability groups, database mirroring, log shipping, and backup and restore with Azure blog storage.</span></span>

| <span data-ttu-id="2ba82-171">Technology</span><span class="sxs-lookup"><span data-stu-id="2ba82-171">Technology</span></span> | <span data-ttu-id="2ba82-172">範例架構</span><span class="sxs-lookup"><span data-stu-id="2ba82-172">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="2ba82-173">**可用性群組**</span><span class="sxs-lookup"><span data-stu-id="2ba82-173">**Availability Groups**</span></span> |<span data-ttu-id="2ba82-174">為了進行跨網站的嚴重損壞修復，部分可用性複本會在 Azure VM 中執行，而其他複本會在內部部署執行。</span><span class="sxs-lookup"><span data-stu-id="2ba82-174">Some availability replicas running in Azure VMs and other replicas running on-premises for cross-site disaster recovery.</span></span> <span data-ttu-id="2ba82-175">hello 生產網站可以在內部或 Azure 資料中心內。</span><span class="sxs-lookup"><span data-stu-id="2ba82-175">hello production site can be either on-premises or in an Azure datacenter.</span></span><br/>![可用性群組](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_alwayson.gif)<br/><span data-ttu-id="2ba82-177">因為所有可用性複本必須都處於 hello 相同容錯移轉叢集，hello 叢集必須跨越兩個網路 （多重子網路容錯移轉叢集）。</span><span class="sxs-lookup"><span data-stu-id="2ba82-177">Because all availability replicas must be in hello same failover cluster, hello cluster must span both networks (a multi-subnet failover cluster).</span></span> <span data-ttu-id="2ba82-178">此設定需要 Azure 與 hello 在內部部署網路之間的 VPN 連線。</span><span class="sxs-lookup"><span data-stu-id="2ba82-178">This configuration requires a VPN connection between Azure and hello on-premises network.</span></span><br/><br/><span data-ttu-id="2ba82-179">成功的災害復原的資料庫，您也應該安裝在 hello 災害復原站台的複本網域控制站。</span><span class="sxs-lookup"><span data-stu-id="2ba82-179">For successful disaster recovery of your databases, you should also install a replica domain controller at hello disaster recovery site.</span></span><br/><br/><span data-ttu-id="2ba82-180">很可能 toouse hello SSMS tooadd Azure 複本 tooan，現有的 Alwayson 可用性群組中加入複本精靈。</span><span class="sxs-lookup"><span data-stu-id="2ba82-180">It is possible toouse hello Add Replica Wizard in SSMS tooadd an Azure replica tooan existing Always On Availability Group.</span></span> <span data-ttu-id="2ba82-181">如需詳細資訊，請參閱教學課程： 將 Alwayson 可用性群組 tooAzure 延伸。</span><span class="sxs-lookup"><span data-stu-id="2ba82-181">For more information, see Tutorial: Extend your Always On Availability Group tooAzure.</span></span> |
| <span data-ttu-id="2ba82-182">**資料庫鏡像**</span><span class="sxs-lookup"><span data-stu-id="2ba82-182">**Database Mirroring**</span></span> |<span data-ttu-id="2ba82-183">一個夥伴執行於 Azure VM，hello 其他執行於內部使用伺服器憑證的跨網站災害復原。</span><span class="sxs-lookup"><span data-stu-id="2ba82-183">One partner running in an Azure VM and hello other running on-premises for cross-site disaster recovery using server certificates.</span></span> <span data-ttu-id="2ba82-184">夥伴不需要在 toobe hello 相同的 Active Directory 網域，而且需要 VPN 連線。</span><span class="sxs-lookup"><span data-stu-id="2ba82-184">Partners do not need toobe in hello same Active Directory domain, and no VPN connection is required.</span></span><br/><span data-ttu-id="2ba82-185">![資料庫鏡像](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_dbmirroring.gif)</span><span class="sxs-lookup"><span data-stu-id="2ba82-185">![Database Mirroring](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_dbmirroring.gif)</span></span><br/><span data-ttu-id="2ba82-186">另一個資料庫鏡像案例牽涉到一個夥伴執行於 Azure VM 和 hello 其他正在執行的內部部署的 hello 相同 Active Directory 網域，提供跨網站災害復原。</span><span class="sxs-lookup"><span data-stu-id="2ba82-186">Another database mirroring scenario involves one partner running in an Azure VM and hello other running on-premises in hello same Active Directory domain for cross-site disaster recovery.</span></span> <span data-ttu-id="2ba82-187">A [hello Azure 虛擬網路和 hello 內部部署網路之間的 VPN 連線](../../../vpn-gateway/vpn-gateway-site-to-site-create.md)需要。</span><span class="sxs-lookup"><span data-stu-id="2ba82-187">A [VPN connection between hello Azure virtual network and hello on-premises network](../../../vpn-gateway/vpn-gateway-site-to-site-create.md) is required.</span></span><br/><br/><span data-ttu-id="2ba82-188">成功的災害復原的資料庫，您也應該安裝在 hello 災害復原站台的複本網域控制站。</span><span class="sxs-lookup"><span data-stu-id="2ba82-188">For successful disaster recovery of your databases, you should also install a replica domain controller at hello disaster recovery site.</span></span> |
| <span data-ttu-id="2ba82-189">**記錄傳送**</span><span class="sxs-lookup"><span data-stu-id="2ba82-189">**Log Shipping**</span></span> |<span data-ttu-id="2ba82-190">一部伺服器執行於 Azure VM，hello 其他內部部署執行上提供跨網站災害復原。</span><span class="sxs-lookup"><span data-stu-id="2ba82-190">One server running in an Azure VM and hello other running on-premises for cross-site disaster recovery.</span></span> <span data-ttu-id="2ba82-191">記錄傳送依賴 Windows 檔案共用，因此 hello hello Azure 虛擬網路之間的 VPN 連接內部網路是必要。</span><span class="sxs-lookup"><span data-stu-id="2ba82-191">Log shipping depends on Windows file sharing, so a VPN connection between hello Azure virtual network and hello on-premises network is required.</span></span><br/>![記錄傳送](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_log_shipping.gif)<br/><span data-ttu-id="2ba82-193">成功的災害復原的資料庫，您也應該安裝在 hello 災害復原站台的複本網域控制站。</span><span class="sxs-lookup"><span data-stu-id="2ba82-193">For successful disaster recovery of your databases, you should also install a replica domain controller at hello disaster recovery site.</span></span> |
| <span data-ttu-id="2ba82-194">**備份及還原與 Azure Blob 儲存體服務**</span><span class="sxs-lookup"><span data-stu-id="2ba82-194">**Backup and Restore with Azure Blob Storage Service**</span></span> |<span data-ttu-id="2ba82-195">內部部署生產資料庫直接 tooAzure blob 儲存體進行災害復原備份。</span><span class="sxs-lookup"><span data-stu-id="2ba82-195">On-premises production databases backed up directly tooAzure blob storage for disaster recovery.</span></span><br/><span data-ttu-id="2ba82-196">![備份與還原](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_backup_restore.gif)</span><span class="sxs-lookup"><span data-stu-id="2ba82-196">![Backup and Restore](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_backup_restore.gif)</span></span><br/><span data-ttu-id="2ba82-197">如需詳細資訊，請參閱 [Azure 虛擬機器中 SQL Server 的備份與還原](virtual-machines-windows-sql-backup-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-197">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-backup-recovery.md).</span></span> |

## <a name="important-considerations-for-sql-server-hadr-in-azure"></a><span data-ttu-id="2ba82-198">Azure 中 SQL Server HADR 的重要考量</span><span class="sxs-lookup"><span data-stu-id="2ba82-198">Important considerations for SQL Server HADR in Azure</span></span>
<span data-ttu-id="2ba82-199">與內部部署、非虛擬化的 IT 基礎結構相較之下，Azure VM、儲存體和網路各有不同的作業特性。</span><span class="sxs-lookup"><span data-stu-id="2ba82-199">Azure VMs, storage, and networking have different operational characteristics than an on-premises, non-virtualized IT infrastructure.</span></span> <span data-ttu-id="2ba82-200">成功實作 HADR SQL Server 方案，在 Azure 中，您必須了解這些差異和設計解決方案 tooaccommodate 它們。</span><span class="sxs-lookup"><span data-stu-id="2ba82-200">A successful implementation of a HADR SQL Server solution in Azure requires that you understand these differences and design your solution tooaccommodate them.</span></span>

### <a name="high-availability-nodes-in-an-availability-set"></a><span data-ttu-id="2ba82-201">可用性設定組中的高可用性節點</span><span class="sxs-lookup"><span data-stu-id="2ba82-201">High availability nodes in an availability set</span></span>
<span data-ttu-id="2ba82-202">在 Azure 中的可用性設定組可讓您 tooplace hello 高可用性節點到不同容錯網域 (Fd) 和升級網域 (Ud)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-202">Availability sets in Azure enable you tooplace hello high availability nodes into separate Fault Domains (FDs) and Update Domains (UDs).</span></span> <span data-ttu-id="2ba82-203">針對 Azure Vm toobe 置於 hello 相同可用性設定組中，您必須將其部署在 hello 相同雲端服務。</span><span class="sxs-lookup"><span data-stu-id="2ba82-203">For Azure VMs toobe placed in hello same availability set, you must deploy them in hello same cloud service.</span></span> <span data-ttu-id="2ba82-204">只有節點中相同的雲端服務可參與的 hello hello 相同可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="2ba82-204">Only nodes in hello same cloud service can participate in hello same availability set.</span></span> <span data-ttu-id="2ba82-205">如需詳細資訊，請參閱[管理 hello 虛擬機器可用性](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-205">For more information, see [Manage hello Availability of Virtual Machines](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

### <a name="failover-cluster-behavior-in-azure-networking"></a><span data-ttu-id="2ba82-206">Azure 網路中的容錯移轉叢集行為</span><span class="sxs-lookup"><span data-stu-id="2ba82-206">Failover cluster behavior in Azure networking</span></span>
<span data-ttu-id="2ba82-207">hello RFC 相容 DHCP 服務在 Azure 中的可能會導致 hello 建立特定容錯移轉叢集組態 toofail，因為重複的 IP 位址指定給 toohello 叢集網路名稱，例如 hello 相同的 IP 位址做為其中一個 hello 叢集節點。</span><span class="sxs-lookup"><span data-stu-id="2ba82-207">hello non-RFC-compliant DHCP service in Azure can cause hello creation of certain failover cluster configurations toofail, due toohello cluster network name being assigned a duplicate IP address, such as hello same IP address as one of hello cluster nodes.</span></span> <span data-ttu-id="2ba82-208">當您實作取決於 hello Windows 容錯移轉叢集功能的可用性群組時，這會是問題。</span><span class="sxs-lookup"><span data-stu-id="2ba82-208">This is an issue when you implement Availability Groups, which depends on hello Windows failover cluster feature.</span></span>

<span data-ttu-id="2ba82-209">雙節點叢集時建立並上線，請考慮 hello 案例：</span><span class="sxs-lookup"><span data-stu-id="2ba82-209">Consider hello scenario when a two-node cluster is created and brought online:</span></span>

1. <span data-ttu-id="2ba82-210">hello 叢集上線，然後 NODE1 要求 hello 叢集網路名稱的動態指派的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="2ba82-210">hello cluster comes online, then NODE1 requests a dynamically assigned IP address for hello cluster network name.</span></span>
2. <span data-ttu-id="2ba82-211">NODE1 的 IP 位址以外的任何 IP 位址就會提供 hello DHCP 服務，因為 hello DHCP 服務辨識該 hello 要求來自 NODE1 本身。</span><span class="sxs-lookup"><span data-stu-id="2ba82-211">No IP address other than NODE1’s own IP address is given by hello DHCP service, since hello DHCP service recognizes that hello request comes from NODE1 itself.</span></span>
3. <span data-ttu-id="2ba82-212">Windows 會偵測到重複位址指派 tooNODE1 和 toohello 容錯移轉叢集網路名稱，hello 預設叢集群組無法 toocome 線上。</span><span class="sxs-lookup"><span data-stu-id="2ba82-212">Windows detects that a duplicate address is assigned both tooNODE1 and toohello failover cluster network name, and hello default cluster group fails toocome online.</span></span>
4. <span data-ttu-id="2ba82-213">hello 預設叢集群組移 tooNODE2 NODE1 的 IP 位址視為 hello 叢集 IP 位址，並讓 hello 預設叢集群組上線。</span><span class="sxs-lookup"><span data-stu-id="2ba82-213">hello default cluster group moves tooNODE2, which treats NODE1’s IP address as hello cluster IP address and brings hello default cluster group online.</span></span>
5. <span data-ttu-id="2ba82-214">當 NODE2 嘗試 tooestablish 連線與 node1 的連接時，導向 node1 的封包絕不會離開 NODE2，因為它會解析 NODE1 的 IP 位址 tooitself。</span><span class="sxs-lookup"><span data-stu-id="2ba82-214">When NODE2 attempts tooestablish connectivity with NODE1, packets directed at NODE1 never leave NODE2 because it resolves NODE1’s IP address tooitself.</span></span> <span data-ttu-id="2ba82-215">NODE2 無法建立與 node1 的連接，然後失去仲裁並關機 hello 叢集。</span><span class="sxs-lookup"><span data-stu-id="2ba82-215">NODE2 cannot establish connectivity with NODE1, then loses quorum and shuts down hello cluster.</span></span>
6. <span data-ttu-id="2ba82-216">在 hello 同時，NODE1 可以傳送封包 tooNODE2，但是 NODE2 無法回覆。</span><span class="sxs-lookup"><span data-stu-id="2ba82-216">In hello meantime, NODE1 can send packets tooNODE2, but NODE2 cannot reply.</span></span> <span data-ttu-id="2ba82-217">NODE1 失去仲裁並關機 hello 叢集。</span><span class="sxs-lookup"><span data-stu-id="2ba82-217">NODE1 loses quorum and shuts down hello cluster.</span></span>

<span data-ttu-id="2ba82-218">可以避免這種情況下，藉由指派未使用靜態 IP 位址，例如像如 169.254.1.1 指派連結-本機 IP 位址、 toohello 叢集網路名稱在順序 toobring hello 叢集網路名稱上線。</span><span class="sxs-lookup"><span data-stu-id="2ba82-218">This scenario can be avoided by assigning an unused static IP address, such as a link-local IP address like 169.254.1.1, toohello cluster network name in order toobring hello cluster network name online.</span></span> <span data-ttu-id="2ba82-219">toosimplify 此程序，請參閱[設定 Windows 容錯移轉叢集，在 Azure 中的可用性群組](http://social.technet.microsoft.com/wiki/contents/articles/14776.configuring-windows-failover-cluster-in-windows-azure-for-alwayson-availability-groups.aspx)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-219">toosimplify this process, see [Configuring Windows failover cluster in Azure for availability groups](http://social.technet.microsoft.com/wiki/contents/articles/14776.configuring-windows-failover-cluster-in-windows-azure-for-alwayson-availability-groups.aspx).</span></span>

<span data-ttu-id="2ba82-220">如需詳細資訊，請參閱[在 Azure (GUI) 中設定可用性群組](virtual-machines-windows-portal-sql-alwayson-availability-groups.md)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-220">For more information, see [Configure availability groups in Azure (GUI)](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span></span>

### <a name="availability-group-listener-support"></a><span data-ttu-id="2ba82-221">可用性群組接聽程式支援</span><span class="sxs-lookup"><span data-stu-id="2ba82-221">Availability group listener support</span></span>
<span data-ttu-id="2ba82-222">可用性群組接聽程式支援執行 Windows Server 2008 R2、Windows Server 2012、Windows Server 2012 R2 和 Windows Server 2016 的 Azure VM。</span><span class="sxs-lookup"><span data-stu-id="2ba82-222">Availability group listeners are supported on Azure VMs running Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2, and Windows Server 2016.</span></span> <span data-ttu-id="2ba82-223">這項支援即可進行負載平衡的端點，在屬於可用性群組節點 hello Azure Vm 上啟用 hello 使用。</span><span class="sxs-lookup"><span data-stu-id="2ba82-223">This support is made possible by hello use of load-balanced endpoints enabled on hello Azure VMs that are availability group nodes.</span></span> <span data-ttu-id="2ba82-224">您必須依照特殊組態步驟進行 hello 接聽程式 toowork Azure 以及在內部部署中執行這兩個用戶端應用程式。</span><span class="sxs-lookup"><span data-stu-id="2ba82-224">You must follow special configuration steps for hello listeners toowork for both client applications that are running in Azure as well as those running on-premises.</span></span>

<span data-ttu-id="2ba82-225">設定接聽程式有主要兩個選項：外部 (公用) 或內部。</span><span class="sxs-lookup"><span data-stu-id="2ba82-225">There are two main options for setting up your listener: external (public) or internal.</span></span> <span data-ttu-id="2ba82-226">hello 外部 （公用） 接聽程式會使用網際網路的負載平衡器，且相關聯的公用虛擬 IP (VIP) 存取透過 hello 網際網路。</span><span class="sxs-lookup"><span data-stu-id="2ba82-226">hello external (public) listener uses an internet facing load balancer and is associated with a public Virtual IP (VIP) that is accessible over hello internet.</span></span> <span data-ttu-id="2ba82-227">內部的接聽程式使用內部負載平衡器，並內只支援用戶端 hello 相同虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="2ba82-227">An internal listener uses an internal load balancer and only supports clients within hello same Virtual Network.</span></span> <span data-ttu-id="2ba82-228">對於各個負載平衡器類型，您必須啟用「伺服器直接回傳」。</span><span class="sxs-lookup"><span data-stu-id="2ba82-228">For either load balancer type, you must enable Direct Server Return.</span></span> 

<span data-ttu-id="2ba82-229">如果 hello 可用性群組跨越多個 Azure 的子網路 （如跨越 Azure 區域部署），hello 用戶端連接字串必須包含"**MultisubnetFailover = True**"。</span><span class="sxs-lookup"><span data-stu-id="2ba82-229">If hello Availability Group spans multiple Azure subnets (such as a deployment that crosses Azure regions), hello client connection string must include "**MultisubnetFailover=True**".</span></span> <span data-ttu-id="2ba82-230">這會導致平行連接嘗試 toohello 複本 hello 不同子網路中。</span><span class="sxs-lookup"><span data-stu-id="2ba82-230">This results in parallel connection attempts toohello replicas in hello different subnets.</span></span> <span data-ttu-id="2ba82-231">如需有關設定接聽程式的指示，請參閱</span><span class="sxs-lookup"><span data-stu-id="2ba82-231">For instructions on setting up a listener, see</span></span>

* <span data-ttu-id="2ba82-232">[設定 Azure 中可用性群組的 ILB 接聽程式](virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-232">[Configure an ILB listener for availability groups in Azure](virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md).</span></span>
* <span data-ttu-id="2ba82-233">[設定 Azure 中可用性群組的外部接聽程式](../classic/ps-sql-ext-listener.md)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-233">[Configure an external listener for availability groups in Azure](../classic/ps-sql-ext-listener.md).</span></span>

<span data-ttu-id="2ba82-234">您仍然可以藉由直接連接 toohello 服務執行個體分別連接 tooeach 可用性複本。</span><span class="sxs-lookup"><span data-stu-id="2ba82-234">You can still connect tooeach availability replica separately by connecting directly toohello service instance.</span></span> <span data-ttu-id="2ba82-235">此外，由於可用性群組是與資料庫鏡像用戶端的回溯相容，您可以連接 toohello 可用性複本如資料庫鏡像夥伴，只要 hello 複本設定類似 toodatabase 鏡像：</span><span class="sxs-lookup"><span data-stu-id="2ba82-235">Also, since availability groups are backward compatible with database mirroring clients, you can connect toohello availability replicas like database mirroring partners as long as hello replicas are configured similar toodatabase mirroring:</span></span>

* <span data-ttu-id="2ba82-236">一個主要複本與一個次要複本</span><span class="sxs-lookup"><span data-stu-id="2ba82-236">One primary replica and one secondary replica</span></span>
* <span data-ttu-id="2ba82-237">hello 次要複本設定為不可讀取 (**可讀取次要複本**選項設定得**否**)</span><span class="sxs-lookup"><span data-stu-id="2ba82-237">hello secondary replica is configured as non-readable (**Readable Secondary** option set too**No**)</span></span>

<span data-ttu-id="2ba82-238">範例用戶端連接字串對應使用 ADO.NET 或 SQL Server Native Client toothis 資料庫鏡像類似的設定如下：</span><span class="sxs-lookup"><span data-stu-id="2ba82-238">An example client connection string that corresponds toothis database mirroring-like configuration using ADO.NET or SQL Server Native Client is below:</span></span>

    Data Source=ReplicaServer1;Failover Partner=ReplicaServer2;Initial Catalog=AvailabilityDatabase;

<span data-ttu-id="2ba82-239">如需用戶端連線的詳細資訊，請參閱：</span><span class="sxs-lookup"><span data-stu-id="2ba82-239">For more information on client connectivity, see:</span></span>

* [<span data-ttu-id="2ba82-240">搭配 SQL Server Native Client 使用連接字串關鍵字</span><span class="sxs-lookup"><span data-stu-id="2ba82-240">Using Connection String Keywords with SQL Server Native Client</span></span>](https://msdn.microsoft.com/library/ms130822.aspx)
* [<span data-ttu-id="2ba82-241">連接的用戶端 tooa 資料庫鏡像工作階段 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="2ba82-241">Connect Clients tooa Database Mirroring Session (SQL Server)</span></span>](https://technet.microsoft.com/library/ms175484.aspx)
* [<span data-ttu-id="2ba82-242">連接 tooAvailability 混合式 IT 中的群組接聽程式</span><span class="sxs-lookup"><span data-stu-id="2ba82-242">Connecting tooAvailability Group Listener in Hybrid IT</span></span>](http://blogs.msdn.com/b/sqlalwayson/archive/2013/02/14/connecting-to-availability-group-listener-in-hybrid-it.aspx)
* [<span data-ttu-id="2ba82-243">可用性群組接聽程式、用戶端連接及應用程式容錯移轉 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="2ba82-243">Availability Group Listeners, Client Connectivity, and Application Failover (SQL Server)</span></span>](https://technet.microsoft.com/library/hh213417.aspx)
* [<span data-ttu-id="2ba82-244">搭配可用性群組使用資料庫鏡像連接字串</span><span class="sxs-lookup"><span data-stu-id="2ba82-244">Using Database-Mirroring Connection Strings with Availability Groups</span></span>](https://technet.microsoft.com/library/hh213417.aspx)

### <a name="network-latency-in-hybrid-it"></a><span data-ttu-id="2ba82-245">混合式 IT 中的網路延遲</span><span class="sxs-lookup"><span data-stu-id="2ba82-245">Network latency in hybrid IT</span></span>
<span data-ttu-id="2ba82-246">您應該部署 HADR 方案，可能會有一段時間，與您在內部部署網路與 Azure 之間的網路延遲的 hello 假設。</span><span class="sxs-lookup"><span data-stu-id="2ba82-246">You should deploy your HADR solution with hello assumption that there may be periods of time with high network latency between your on-premises network and Azure.</span></span> <span data-ttu-id="2ba82-247">在部署複本 tooAzure 時，您應該使用非同步認可而不是同步認可 hello 同步處理模式。</span><span class="sxs-lookup"><span data-stu-id="2ba82-247">When deploying replicas tooAzure, you should use asynchronous commit instead of synchronous commit for hello synchronization mode.</span></span> <span data-ttu-id="2ba82-248">當部署資料庫鏡像伺服器同時在內部部署並在 Azure 中，使用 hello 高效能模式而非 hello 的高安全性模式。</span><span class="sxs-lookup"><span data-stu-id="2ba82-248">When deploying database mirroring servers both on-premises and in Azure, use hello high-performance mode instead of hello high-safety mode.</span></span>

### <a name="geo-replication-support"></a><span data-ttu-id="2ba82-249">異地複寫支援</span><span class="sxs-lookup"><span data-stu-id="2ba82-249">Geo-replication support</span></span>
<span data-ttu-id="2ba82-250">Azure 磁碟中的地理複寫不支援 hello 資料檔和記錄檔儲存在不同磁碟的相同資料庫 toobe hello。</span><span class="sxs-lookup"><span data-stu-id="2ba82-250">Geo-replication in Azure disks does not support hello data file and log file of hello same database toobe stored on separate disks.</span></span> <span data-ttu-id="2ba82-251">GRS 會在每個磁碟上進行獨立與非同步變更複寫。</span><span class="sxs-lookup"><span data-stu-id="2ba82-251">GRS replicates changes on each disk independently and asynchronously.</span></span> <span data-ttu-id="2ba82-252">這項機制可確保 hello 單一磁碟上 hello 地理複寫副本，但不是會跨多個磁碟進行地理複寫副本的寫入順序。</span><span class="sxs-lookup"><span data-stu-id="2ba82-252">This mechanism guarantees hello write order within a single disk on hello geo-replicated copy, but not across geo-replicated copies of multiple disks.</span></span> <span data-ttu-id="2ba82-253">如果您設定資料庫 toostore，其資料檔案與它在不同磁碟上的記錄檔，hello 復原磁碟損毀可能會包含比 hello 記錄檔，會預先寫入記錄 SQL Server 中的 hello 和 hello ACID hello 資料檔案的最新複本之後交易屬性。</span><span class="sxs-lookup"><span data-stu-id="2ba82-253">If you configure a database toostore its data file and its log file on separate disks, hello recovered disks after a disaster may contain a more up-to-date copy of hello data file than hello log file, which breaks hello write-ahead log in SQL Server and hello ACID properties of transactions.</span></span> <span data-ttu-id="2ba82-254">如果您沒有 hello 儲存體帳戶的 hello 選項 toodisable 地理複寫，您應該保留所有的資料與記錄檔 hello 上所指定資料庫的相同磁碟。</span><span class="sxs-lookup"><span data-stu-id="2ba82-254">If you do not have hello option toodisable geo-replication on hello storage account, you should keep all data and log files for a given database on hello same disk.</span></span> <span data-ttu-id="2ba82-255">如果您必須使用一個以上的磁碟，因為 toohello hello 資料庫大小，您會需要的 toodeploy hello 災害復原解決方案的其中一個上列 tooensure 資料冗餘。</span><span class="sxs-lookup"><span data-stu-id="2ba82-255">If you must use more than one disk due toohello size of hello database, you need toodeploy one of hello disaster recovery solutions listed above tooensure data redundancy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="2ba82-256">後續步驟</span><span class="sxs-lookup"><span data-stu-id="2ba82-256">Next steps</span></span>
<span data-ttu-id="2ba82-257">如果您需要 toocreate Azure 虛擬機器與 SQL Server，請參閱[佈建在 Azure 上的 SQL Server 虛擬機器](virtual-machines-windows-portal-sql-server-provision.md)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-257">If you need toocreate an Azure virtual machine with SQL Server, see [Provisioning a SQL Server Virtual Machine on Azure](virtual-machines-windows-portal-sql-server-provision.md).</span></span>

<span data-ttu-id="2ba82-258">從執行於 Azure VM 中，SQL Server tooget hello 達到最佳效能，請參閱中的 hello 指引[Azure 虛擬機器中 SQL Server 的效能最佳做法](virtual-machines-windows-sql-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-258">tooget hello best performance from SQL Server running on an Azure VM, see hello guidance in [Performance Best Practices for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-performance.md).</span></span>

<span data-ttu-id="2ba82-259">如 toorunning Azure Vm 中的 SQL Server 相關的其他主題，請參閱 < [Azure 虛擬機器上的 SQL Server](virtual-machines-windows-sql-server-iaas-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="2ba82-259">For other topics related toorunning SQL Server in Azure VMs, see [SQL Server on Azure Virtual Machines](virtual-machines-windows-sql-server-iaas-overview.md).</span></span>

### <a name="other-resources"></a><span data-ttu-id="2ba82-260">其他資源</span><span class="sxs-lookup"><span data-stu-id="2ba82-260">Other resources</span></span>
* [<span data-ttu-id="2ba82-261">在 Azure 中安裝新的 Active Directory 樹系</span><span class="sxs-lookup"><span data-stu-id="2ba82-261">Install a new Active Directory forest in Azure</span></span>](../../../active-directory/active-directory-new-forest-virtual-machine.md)
* <span data-ttu-id="2ba82-262">[在 Azure VM 中建立可用性群組的容錯移轉叢集](http://gallery.technet.microsoft.com/scriptcenter/Create-WSFC-Cluster-for-7c207d3a) \(英文\)</span><span class="sxs-lookup"><span data-stu-id="2ba82-262">[Create Failover Cluster for availability groups in Azure VM](http://gallery.technet.microsoft.com/scriptcenter/Create-WSFC-Cluster-for-7c207d3a)</span></span>

