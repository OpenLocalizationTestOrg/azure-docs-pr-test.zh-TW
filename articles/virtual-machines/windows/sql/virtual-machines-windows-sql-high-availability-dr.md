---
title: "SQL Server 高可用性和災害復原 | Microsoft Docs"
description: "討論適用於在「Azure 虛擬機器」中執行之 SQL Server 的各種 HADR 策略。"
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: 53981f7e-8370-4979-b26a-93a5988d905f
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 06/27/2017
ms.author: mikeray
ms.openlocfilehash: 27d05c1681f7d7b3090fc7abd4a6b15d1c030e2c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="high-availability-and-disaster-recovery-for-sql-server-in-azure-virtual-machines"></a><span data-ttu-id="cd91e-103">Azure 虛擬機器中的 SQL Server 高可用性和災害復原</span><span class="sxs-lookup"><span data-stu-id="cd91e-103">High availability and disaster recovery for SQL Server in Azure Virtual Machines</span></span>

<span data-ttu-id="cd91e-104">內含 SQL Server 的 Microsoft Azure 虛擬機器 (VM) 可協助降低高可用性和嚴重損壞修復 (HADR) 資料庫解決方案的成本。</span><span class="sxs-lookup"><span data-stu-id="cd91e-104">Microsoft Azure virtual machines (VMs) with SQL Server can help lower the cost of a high availability and disaster recovery (HADR) database solution.</span></span> <span data-ttu-id="cd91e-105">Azure 虛擬機器中支援大部分的 SQL Server HADR 解決方案 (僅限 Azure 以及混合式解決方案兩種)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-105">Most SQL Server HADR solutions are supported in Azure virtual machines, both as Azure-only and as hybrid solutions.</span></span> <span data-ttu-id="cd91e-106">在僅限 Azure 解決方案中，整個 HADR 系統會在 Azure 中執行。</span><span class="sxs-lookup"><span data-stu-id="cd91e-106">In an Azure-only solution, the entire HADR system runs in Azure.</span></span> <span data-ttu-id="cd91e-107">在混合式組態中，解決方案的一部分會在 Azure 中執行，而其他部分會在組織中的內部部署執行。</span><span class="sxs-lookup"><span data-stu-id="cd91e-107">In a hybrid configuration, part of the solution runs in Azure and the other part runs on-premises in your organization.</span></span> <span data-ttu-id="cd91e-108">Azure 環境的彈性可讓您將解決方案部分或完全移動至 Azure，以滿足 SQL Server 資料庫系統的預算與 HADR 需求。</span><span class="sxs-lookup"><span data-stu-id="cd91e-108">The flexibility of the Azure environment enables you to move partially or completely to Azure to satisfy the budget and HADR requirements of your SQL Server database systems.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../../includes/learn-about-deployment-models-both-include.md)]

## <a name="understanding-the-need-for-an-hadr-solution"></a><span data-ttu-id="cd91e-109">了解 HADR 解決方案的需求</span><span class="sxs-lookup"><span data-stu-id="cd91e-109">Understanding the need for an HADR solution</span></span>
<span data-ttu-id="cd91e-110">您可以決定是否要讓資料庫系統擁有服務等級協定 (SLA) 需要的 HADR 功能。</span><span class="sxs-lookup"><span data-stu-id="cd91e-110">It is up to you to ensure that your database system possesses the HADR capabilities that the service-level agreement (SLA) requires.</span></span> <span data-ttu-id="cd91e-111">即使 Azure 提供高可用性機制 (例如雲端服務的服務修復，以及虛擬機器的失敗修復偵測)，也無法保證您能夠符合需要的 SLA。</span><span class="sxs-lookup"><span data-stu-id="cd91e-111">The fact that Azure provides high availability mechanisms, such as service healing for cloud services and failure recovery detection for Virtual Machines, does not itself guarantee you can meet the desired SLA.</span></span> <span data-ttu-id="cd91e-112">這些機制能保護 VM 的高可用性，但無法保護在 VM 中執行之 SQL Server 的高可用性。</span><span class="sxs-lookup"><span data-stu-id="cd91e-112">These mechanisms protect the high availability of the VMs but not the high availability of SQL Server running inside the VMs.</span></span> <span data-ttu-id="cd91e-113">因此，即使 VM 保持連線且運作正常，SQL Server 執行個體仍可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="cd91e-113">It is possible for the SQL Server instance to fail while the VM is online and healthy.</span></span> <span data-ttu-id="cd91e-114">此外，Azure 提供的高可用性機制甚至會允許因為事件 (例如，從軟體或硬體失敗修復，以及作業系統升級) 導致的 VM 停機。</span><span class="sxs-lookup"><span data-stu-id="cd91e-114">Moreover, even the high availability mechanisms provided by Azure allow for downtime of the VMs due to events such as recovery from software or hardware failures and operating system upgrades.</span></span>

<span data-ttu-id="cd91e-115">再者，Azure 中的異地備援儲存體 (GRS) (使用名為異地複寫功能進行實作) 對您的資料庫而言，可能不足以當作嚴重損壞修復解決方案使用。</span><span class="sxs-lookup"><span data-stu-id="cd91e-115">In addition, Geo Redundant Storage (GRS) in Azure, which is implemented with a feature called geo-replication, may not be an adequate disaster recovery solution for your databases.</span></span> <span data-ttu-id="cd91e-116">由於異地複寫會以非同步方式傳送資料，因此最近的更新可能會在發生嚴重損壞事件時遺失。</span><span class="sxs-lookup"><span data-stu-id="cd91e-116">Because geo-replication sends data asynchronously, recent updates can be lost in the event of disaster.</span></span> <span data-ttu-id="cd91e-117">有關地理複寫限制的詳細資訊，皆記載於 [異地複寫不支援不同磁碟上的資料和記錄檔](#geo-replication-support) 一節。</span><span class="sxs-lookup"><span data-stu-id="cd91e-117">More information regarding geo-replication limitations are covered in the [Geo-replication not supported for data and log files on separate disks](#geo-replication-support) section.</span></span>

## <a name="hadr-deployment-architectures"></a><span data-ttu-id="cd91e-118">HADR 部署架構</span><span class="sxs-lookup"><span data-stu-id="cd91e-118">HADR deployment architectures</span></span>
<span data-ttu-id="cd91e-119">在 Azure 中支援的 SQL Server HADR 技術包括：</span><span class="sxs-lookup"><span data-stu-id="cd91e-119">SQL Server HADR technologies that are supported in Azure include:</span></span>

* [<span data-ttu-id="cd91e-120">Always On 可用性群組</span><span class="sxs-lookup"><span data-stu-id="cd91e-120">Always On Availability Groups</span></span>](https://technet.microsoft.com/library/hh510230.aspx)
* [<span data-ttu-id="cd91e-121">Always On 容錯移轉叢集執行個體</span><span class="sxs-lookup"><span data-stu-id="cd91e-121">Always On Failover Cluster Instances</span></span>](https://technet.microsoft.com/library/ms189134.aspx)
* [<span data-ttu-id="cd91e-122">記錄傳送</span><span class="sxs-lookup"><span data-stu-id="cd91e-122">Log Shipping</span></span>](https://technet.microsoft.com/library/ms187103.aspx)
* [<span data-ttu-id="cd91e-123">SQL Server 備份及還原與 Azure Blob 儲存體服務</span><span class="sxs-lookup"><span data-stu-id="cd91e-123">SQL Server Backup and Restore with Azure Blob Storage Service</span></span>](https://msdn.microsoft.com/library/jj919148.aspx)
* <span data-ttu-id="cd91e-124">[資料庫鏡像](https://technet.microsoft.com/library/ms189852.aspx) - SQL Server 2016 中已被取代</span><span class="sxs-lookup"><span data-stu-id="cd91e-124">[Database Mirroring](https://technet.microsoft.com/library/ms189852.aspx) - Deprecated in SQL Server 2016</span></span>

<span data-ttu-id="cd91e-125">您可以將這些技術合併在一起，以實作同時具有高可用性及嚴重損壞修復功能的 SQL Server 解決方案。</span><span class="sxs-lookup"><span data-stu-id="cd91e-125">It is possible to combine the technologies together to implement a SQL Server solution that has both high availability and disaster recovery capabilities.</span></span> <span data-ttu-id="cd91e-126">根據您使用的技術而定，混合式部署可能會需要使用 Azure 虛擬網路的 VPN 通道。</span><span class="sxs-lookup"><span data-stu-id="cd91e-126">Depending on the technology you use, a hybrid deployment may require a VPN tunnel with the Azure virtual network.</span></span> <span data-ttu-id="cd91e-127">下列各節會說明部分範例部署架構。</span><span class="sxs-lookup"><span data-stu-id="cd91e-127">The sections below show you some of the example deployment architectures.</span></span>

## <a name="azure-only-high-availability-solutions"></a><span data-ttu-id="cd91e-128">僅限 Azure：高可用性解決方案</span><span class="sxs-lookup"><span data-stu-id="cd91e-128">Azure-only: High availability solutions</span></span>

<span data-ttu-id="cd91e-129">您可以在含有 Always On 可用性群組 (稱為可用性群組) 的資料庫層級，具備適用於 SQL Server 的高可用性解決方案。</span><span class="sxs-lookup"><span data-stu-id="cd91e-129">You can have a high availability solution for SQL Server at a database level with Always On Availability Groups - called availability groups.</span></span> <span data-ttu-id="cd91e-130">您也可以在含有 Always On 容錯移轉叢集執行個體 (容錯移轉叢集執行個體) 的執行個體層級，建立高可用性解決方案。</span><span class="sxs-lookup"><span data-stu-id="cd91e-130">You can also create a high availability solution at an instance level with Always On Failover Cluster Instances - failover cluster instances.</span></span> <span data-ttu-id="cd91e-131">如需額外的備援，您可以藉由在容錯移轉叢集執行個體上建立可用性群組，在這兩個層級上建立備援。</span><span class="sxs-lookup"><span data-stu-id="cd91e-131">For additional redundancy, you can create redundancy at both levels by creating availability groups on failover cluster instances.</span></span> 

| <span data-ttu-id="cd91e-132">Technology</span><span class="sxs-lookup"><span data-stu-id="cd91e-132">Technology</span></span> | <span data-ttu-id="cd91e-133">範例架構</span><span class="sxs-lookup"><span data-stu-id="cd91e-133">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="cd91e-134">**可用性群組**</span><span class="sxs-lookup"><span data-stu-id="cd91e-134">**Availability groups**</span></span> |<span data-ttu-id="cd91e-135">在相同區域的 Azure VM 中執行的可用性複本提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="cd91e-135">Availability replicas running in Azure VMs in the same region provide high availability.</span></span> <span data-ttu-id="cd91e-136">由於 Windows 容錯移轉叢集需要使用 Active Directory 網域，因此您需要設定網域控制站 VM。</span><span class="sxs-lookup"><span data-stu-id="cd91e-136">You need to configure a domain controller VM, because Windows failover clustering requires an Active Directory domain.</span></span><br/> <span data-ttu-id="cd91e-137">![可用性群組](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_ha_always_on.gif)</span><span class="sxs-lookup"><span data-stu-id="cd91e-137">![Availability Groups](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_ha_always_on.gif)</span></span><br/><span data-ttu-id="cd91e-138">如需詳細資訊，請參閱[在 Azure (GUI) 中設定可用性群組](virtual-machines-windows-portal-sql-alwayson-availability-groups.md)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-138">For more information, see [Configure Availability Groups in Azure (GUI)](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span></span> |
| <span data-ttu-id="cd91e-139">**容錯移轉叢集執行個體**</span><span class="sxs-lookup"><span data-stu-id="cd91e-139">**Failover cluster instances**</span></span> |<span data-ttu-id="cd91e-140">有 3 種不同的方式可以建立需要使用共用儲存體的「容錯移轉叢集執行個體」(FCI)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-140">Failover Cluster Instances (FCI), which require shared storage, can be created in 3 different ways.</span></span><br/><br/><span data-ttu-id="cd91e-141">1.在 Azure VM 中執行的雙節點容錯移轉叢集，搭配以 [Windows Server 2016 儲存空間直接存取 \(S2D\) ](virtual-machines-windows-portal-sql-create-failover-cluster.md) 連接的儲存體，形成以軟體為基礎的虛擬 SAN。</span><span class="sxs-lookup"><span data-stu-id="cd91e-141">1. A two-node failover cluster running in Azure VMs with attached storage using [Windows Server 2016 Storage Spaces Direct \(S2D\)](virtual-machines-windows-portal-sql-create-failover-cluster.md) to provide a software-based virtual SAN.</span></span><br/><br/><span data-ttu-id="cd91e-142">2.在 Azure VM 中執行的雙節點容錯移轉叢集，搭配由協力廠商叢集解決方案支援的儲存體。</span><span class="sxs-lookup"><span data-stu-id="cd91e-142">2. A two-node failover cluster running in Azure VMs with storage supported by a third-party clustering solution.</span></span> <span data-ttu-id="cd91e-143">如需使用 SIOS DataKeeper 的特定範例，請參閱[使用容錯移轉叢集和協力廠商軟體 SIOS DataKeeper 之檔案共用的高可用性](https://azure.microsoft.com/blog/high-availability-for-a-file-share-using-wsfc-ilb-and-3rd-party-software-sios-datakeeper/) \(英文\)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-143">For a specific example that uses SIOS DataKeeper, see [High availability for a file share using failover clustering and 3rd party software SIOS DataKeeper](https://azure.microsoft.com/blog/high-availability-for-a-file-share-using-wsfc-ilb-and-3rd-party-software-sios-datakeeper/).</span></span><br/><br/><span data-ttu-id="cd91e-144">3.在 Azure VM 中執行的雙節點容錯移轉叢集，搭配透過 ExpressRoute 的遠端 iSCSI 目標共用區塊儲存體。</span><span class="sxs-lookup"><span data-stu-id="cd91e-144">3. A two-node failover cluster running in Azure VMs with remote iSCSI Target shared block storage via ExpressRoute.</span></span> <span data-ttu-id="cd91e-145">例如，NetApp 私用儲存體 (NPS) 會透過 ExpressRoute 使用 Equinix 將 iSCSI 目標公開至 Azure VM。</span><span class="sxs-lookup"><span data-stu-id="cd91e-145">For example, NetApp Private Storage (NPS) exposes an iSCSI target via ExpressRoute with Equinix to Azure VMs.</span></span><br/><br/><span data-ttu-id="cd91e-146">對於協力廠商共用儲存體和資料複寫解決方案，針對有關存取容錯移轉資料的任何問題您應該連絡廠商。</span><span class="sxs-lookup"><span data-stu-id="cd91e-146">For third-party shared storage and data replication solutions, you should contact the vendor for any issues related to accessing data on failover.</span></span><br/><br/><span data-ttu-id="cd91e-147">請注意，在 [Azure 檔案儲存體](https://azure.microsoft.com/services/storage/files/)最上層使用 FCI 尚未支援，因為這個解決方案不使用進階儲存體。</span><span class="sxs-lookup"><span data-stu-id="cd91e-147">Note that using FCI on top of [Azure File storage](https://azure.microsoft.com/services/storage/files/) is not supported yet, because this solution does not utilize Premium Storage.</span></span> <span data-ttu-id="cd91e-148">我們正在努力，很快就會推出這項支援。</span><span class="sxs-lookup"><span data-stu-id="cd91e-148">We are working to support this soon.</span></span> |

## <a name="azure-only-disaster-recovery-solutions"></a><span data-ttu-id="cd91e-149">僅限 Azure：災害復原解決方案</span><span class="sxs-lookup"><span data-stu-id="cd91e-149">Azure-only: Disaster recovery solutions</span></span>
<span data-ttu-id="cd91e-150">您可以使用可用性群組或資料庫鏡像，為 Azure 中的 SQL Server 資料庫提供災害復原解決方案，或者使用儲存體 Blob 進行備份和還原。</span><span class="sxs-lookup"><span data-stu-id="cd91e-150">You can have a disaster recovery solution for your SQL Server databases in Azure using availability groups, database mirroring, or backup and restore with storage blobs.</span></span>

| <span data-ttu-id="cd91e-151">Technology</span><span class="sxs-lookup"><span data-stu-id="cd91e-151">Technology</span></span> | <span data-ttu-id="cd91e-152">範例架構</span><span class="sxs-lookup"><span data-stu-id="cd91e-152">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="cd91e-153">**可用性群組**</span><span class="sxs-lookup"><span data-stu-id="cd91e-153">**Availability Groups**</span></span> |<span data-ttu-id="cd91e-154">為了進行嚴重損壞修復，可用性複本會在 Azure VM 的多個資料中心執行。</span><span class="sxs-lookup"><span data-stu-id="cd91e-154">Availability replicas running across multiple datacenters in Azure VMs for disaster recovery.</span></span> <span data-ttu-id="cd91e-155">這種跨區域解決方案可防止網站完全中斷。</span><span class="sxs-lookup"><span data-stu-id="cd91e-155">This cross-region solution protects against complete site outage.</span></span> <br/> <span data-ttu-id="cd91e-156">![可用性群組](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_alwayson.png)</span><span class="sxs-lookup"><span data-stu-id="cd91e-156">![Availability Groups](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_alwayson.png)</span></span><br/><span data-ttu-id="cd91e-157">在區域內，所有複本都應位於相同的雲端服務與 VNet 中。</span><span class="sxs-lookup"><span data-stu-id="cd91e-157">Within a region, all replicas should be within the same cloud service and the same VNet.</span></span> <span data-ttu-id="cd91e-158">由於每個區域會有不同的 VNet，因此這些解決方案會需要 VNet 對 VNet 連線。</span><span class="sxs-lookup"><span data-stu-id="cd91e-158">Because each region will have a separate VNet, these solutions require VNet to VNet connectivity.</span></span> <span data-ttu-id="cd91e-159">如需詳細資訊，請參閱[使用 Azure 入口網站設定 VNet 對 VNet 連接](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-159">For more information, see [Configure a VNet-to-VNet connection using the Azure portal](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span></span> <span data-ttu-id="cd91e-160">如需詳細指示，請參閱[在不同區域中的 Azure 虛擬機器上設定 SQL Server 可用性群組](virtual-machines-windows-portal-sql-availability-group-dr.md)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-160">For detailed instructions, see [Configure a SQL Server Availability Group on Azure Virtual Machines in Different Regions](virtual-machines-windows-portal-sql-availability-group-dr.md).</span></span>|
| <span data-ttu-id="cd91e-161">**資料庫鏡像**</span><span class="sxs-lookup"><span data-stu-id="cd91e-161">**Database Mirroring**</span></span> |<span data-ttu-id="cd91e-162">為了進行嚴重損壞修復，主體、鏡像和伺服器會在不同的資料中心內執行。</span><span class="sxs-lookup"><span data-stu-id="cd91e-162">Principal and mirror and servers running in different datacenters for disaster recovery.</span></span> <span data-ttu-id="cd91e-163">由於 Active Directory 網域無法跨多個資料中心，因此您必須使用伺服器憑證進行部署。</span><span class="sxs-lookup"><span data-stu-id="cd91e-163">You must deploy using server certificates because an active directory domain cannot span multiple datacenters.</span></span><br/>![資料庫鏡像](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_dbmirroring.gif) |
| <span data-ttu-id="cd91e-165">**備份及還原與 Azure Blob 儲存體服務**</span><span class="sxs-lookup"><span data-stu-id="cd91e-165">**Backup and Restore with Azure Blob Storage Service**</span></span> |<span data-ttu-id="cd91e-166">生產資料庫直接備份到不同資料中心的 blob 儲存體以進行災害復原。</span><span class="sxs-lookup"><span data-stu-id="cd91e-166">Production databases backed up directly to blob storage in a different datacenter for disaster recovery.</span></span><br/><span data-ttu-id="cd91e-167">![備份與還原](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_backup_restore.gif)</span><span class="sxs-lookup"><span data-stu-id="cd91e-167">![Backup and Restore](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_backup_restore.gif)</span></span><br/><span data-ttu-id="cd91e-168">如需詳細資訊，請參閱 [Azure 虛擬機器中 SQL Server 的備份與還原](virtual-machines-windows-sql-backup-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-168">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-backup-recovery.md).</span></span> |

## <a name="hybrid-it-disaster-recovery-solutions"></a><span data-ttu-id="cd91e-169">混合式 IT：災害復原解決方案</span><span class="sxs-lookup"><span data-stu-id="cd91e-169">Hybrid IT: Disaster recovery solutions</span></span>
<span data-ttu-id="cd91e-170">您可以使用可用性群組、資料庫鏡像及記錄傳送，為混合式 IT 環境中的 SQL Server 資料庫提供災害復原解決方案，以及使用 Azure Blob 儲存體進行備份和還原。</span><span class="sxs-lookup"><span data-stu-id="cd91e-170">You can have a disaster recovery solution for your SQL Server databases in a hybrid-IT environment using availability groups, database mirroring, log shipping, and backup and restore with Azure blog storage.</span></span>

| <span data-ttu-id="cd91e-171">Technology</span><span class="sxs-lookup"><span data-stu-id="cd91e-171">Technology</span></span> | <span data-ttu-id="cd91e-172">範例架構</span><span class="sxs-lookup"><span data-stu-id="cd91e-172">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="cd91e-173">**可用性群組**</span><span class="sxs-lookup"><span data-stu-id="cd91e-173">**Availability Groups**</span></span> |<span data-ttu-id="cd91e-174">為了進行跨網站的嚴重損壞修復，部分可用性複本會在 Azure VM 中執行，而其他複本會在內部部署執行。</span><span class="sxs-lookup"><span data-stu-id="cd91e-174">Some availability replicas running in Azure VMs and other replicas running on-premises for cross-site disaster recovery.</span></span> <span data-ttu-id="cd91e-175">生產網站可以是內部部署或是在 Azure 資料中心。</span><span class="sxs-lookup"><span data-stu-id="cd91e-175">The production site can be either on-premises or in an Azure datacenter.</span></span><br/>![可用性群組](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_alwayson.gif)<br/><span data-ttu-id="cd91e-177">由於所有可用性複本都必須位於相同的容錯移轉叢集中，因此該叢集必須同時跨這兩個網路 (多重子網路的容錯移轉叢集)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-177">Because all availability replicas must be in the same failover cluster, the cluster must span both networks (a multi-subnet failover cluster).</span></span> <span data-ttu-id="cd91e-178">此組態需要 Azure 與內部部署網路之間的 VPN 連線。</span><span class="sxs-lookup"><span data-stu-id="cd91e-178">This configuration requires a VPN connection between Azure and the on-premises network.</span></span><br/><br/><span data-ttu-id="cd91e-179">若要成功對資料庫進行災害復原，您也應該在災害復原網站安裝複本網域控制站。</span><span class="sxs-lookup"><span data-stu-id="cd91e-179">For successful disaster recovery of your databases, you should also install a replica domain controller at the disaster recovery site.</span></span><br/><br/><span data-ttu-id="cd91e-180">很可能要在 SSMS 中使用「新增複本精靈」以將 Azure 複本新增至現有 Always On 可用性群組。</span><span class="sxs-lookup"><span data-stu-id="cd91e-180">It is possible to use the Add Replica Wizard in SSMS to add an Azure replica to an existing Always On Availability Group.</span></span> <span data-ttu-id="cd91e-181">如需詳細資訊，請參閱教學課程：將您的 Always On 可用性群組延伸至 Azure。</span><span class="sxs-lookup"><span data-stu-id="cd91e-181">For more information, see Tutorial: Extend your Always On Availability Group to Azure.</span></span> |
| <span data-ttu-id="cd91e-182">**資料庫鏡像**</span><span class="sxs-lookup"><span data-stu-id="cd91e-182">**Database Mirroring**</span></span> |<span data-ttu-id="cd91e-183">為了使用伺服器憑證進行跨網站嚴重損壞修復，一個合作夥伴會在 Azure VM 中執行，而其他合作夥伴會在內部部署中執行。</span><span class="sxs-lookup"><span data-stu-id="cd91e-183">One partner running in an Azure VM and the other running on-premises for cross-site disaster recovery using server certificates.</span></span> <span data-ttu-id="cd91e-184">合作夥伴不需要位於相同的 Active Directory 網域，且不需要 VPN 連線。</span><span class="sxs-lookup"><span data-stu-id="cd91e-184">Partners do not need to be in the same Active Directory domain, and no VPN connection is required.</span></span><br/><span data-ttu-id="cd91e-185">![資料庫鏡像](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_dbmirroring.gif)</span><span class="sxs-lookup"><span data-stu-id="cd91e-185">![Database Mirroring](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_dbmirroring.gif)</span></span><br/><span data-ttu-id="cd91e-186">另一個資料庫鏡像案例，則是為了進行跨網站災害復原復，讓一個合作夥伴在 Azure VM 中執行，並讓其他合作夥伴在相同 Active Directory 網域的內部部署中執行。</span><span class="sxs-lookup"><span data-stu-id="cd91e-186">Another database mirroring scenario involves one partner running in an Azure VM and the other running on-premises in the same Active Directory domain for cross-site disaster recovery.</span></span> <span data-ttu-id="cd91e-187">需要 [Azure 虛擬網路與內部部署之間的 VPN 連線](../../../vpn-gateway/vpn-gateway-site-to-site-create.md)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-187">A [VPN connection between the Azure virtual network and the on-premises network](../../../vpn-gateway/vpn-gateway-site-to-site-create.md) is required.</span></span><br/><br/><span data-ttu-id="cd91e-188">若要成功對資料庫進行災害復原，您也應該在災害復原網站安裝複本網域控制站。</span><span class="sxs-lookup"><span data-stu-id="cd91e-188">For successful disaster recovery of your databases, you should also install a replica domain controller at the disaster recovery site.</span></span> |
| <span data-ttu-id="cd91e-189">**記錄傳送**</span><span class="sxs-lookup"><span data-stu-id="cd91e-189">**Log Shipping**</span></span> |<span data-ttu-id="cd91e-190">為了進行跨網站嚴重損壞修復，一個合作夥伴會在 Azure VM 中執行，而其他合作夥伴會在內部部署中執行。</span><span class="sxs-lookup"><span data-stu-id="cd91e-190">One server running in an Azure VM and the other running on-premises for cross-site disaster recovery.</span></span> <span data-ttu-id="cd91e-191">記錄傳送依賴 Windows 檔案共用，因此需要 Azure 虛擬網路和內部部署網路之間的 VPN 連線。</span><span class="sxs-lookup"><span data-stu-id="cd91e-191">Log shipping depends on Windows file sharing, so a VPN connection between the Azure virtual network and the on-premises network is required.</span></span><br/>![記錄傳送](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_log_shipping.gif)<br/><span data-ttu-id="cd91e-193">若要成功對資料庫進行災害復原，您也應該在災害復原網站安裝複本網域控制站。</span><span class="sxs-lookup"><span data-stu-id="cd91e-193">For successful disaster recovery of your databases, you should also install a replica domain controller at the disaster recovery site.</span></span> |
| <span data-ttu-id="cd91e-194">**備份及還原與 Azure Blob 儲存體服務**</span><span class="sxs-lookup"><span data-stu-id="cd91e-194">**Backup and Restore with Azure Blob Storage Service**</span></span> |<span data-ttu-id="cd91e-195">內部部署生產資料庫直接備份到 Azure blob 儲存體以進行災害復原。</span><span class="sxs-lookup"><span data-stu-id="cd91e-195">On-premises production databases backed up directly to Azure blob storage for disaster recovery.</span></span><br/><span data-ttu-id="cd91e-196">![備份與還原](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_backup_restore.gif)</span><span class="sxs-lookup"><span data-stu-id="cd91e-196">![Backup and Restore](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_backup_restore.gif)</span></span><br/><span data-ttu-id="cd91e-197">如需詳細資訊，請參閱 [Azure 虛擬機器中 SQL Server 的備份與還原](virtual-machines-windows-sql-backup-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-197">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-backup-recovery.md).</span></span> |

## <a name="important-considerations-for-sql-server-hadr-in-azure"></a><span data-ttu-id="cd91e-198">Azure 中 SQL Server HADR 的重要考量</span><span class="sxs-lookup"><span data-stu-id="cd91e-198">Important considerations for SQL Server HADR in Azure</span></span>
<span data-ttu-id="cd91e-199">與內部部署、非虛擬化的 IT 基礎結構相較之下，Azure VM、儲存體和網路各有不同的作業特性。</span><span class="sxs-lookup"><span data-stu-id="cd91e-199">Azure VMs, storage, and networking have different operational characteristics than an on-premises, non-virtualized IT infrastructure.</span></span> <span data-ttu-id="cd91e-200">若要在 Azure 中成功實作 HADR SQL Server 解決方案，您必須了解這些差異，並配合這些差異設計您的解決方案。</span><span class="sxs-lookup"><span data-stu-id="cd91e-200">A successful implementation of a HADR SQL Server solution in Azure requires that you understand these differences and design your solution to accommodate them.</span></span>

### <a name="high-availability-nodes-in-an-availability-set"></a><span data-ttu-id="cd91e-201">可用性設定組中的高可用性節點</span><span class="sxs-lookup"><span data-stu-id="cd91e-201">High availability nodes in an availability set</span></span>
<span data-ttu-id="cd91e-202">Azure 中的可用性設定組可讓您將高可用性節點分別放入容錯網域 (FD) 和更新網域 (UD)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-202">Availability sets in Azure enable you to place the high availability nodes into separate Fault Domains (FDs) and Update Domains (UDs).</span></span> <span data-ttu-id="cd91e-203">若要將 Azure VM 放入相同的可用性設定組中，您必須將其部署至相同的雲端服務中。</span><span class="sxs-lookup"><span data-stu-id="cd91e-203">For Azure VMs to be placed in the same availability set, you must deploy them in the same cloud service.</span></span> <span data-ttu-id="cd91e-204">只有相同雲端服務內的節點可以參與相同的可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="cd91e-204">Only nodes in the same cloud service can participate in the same availability set.</span></span> <span data-ttu-id="cd91e-205">如需詳細資訊，請參閱 [管理虛擬機器的可用性](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-205">For more information, see [Manage the Availability of Virtual Machines](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

### <a name="failover-cluster-behavior-in-azure-networking"></a><span data-ttu-id="cd91e-206">Azure 網路中的容錯移轉叢集行為</span><span class="sxs-lookup"><span data-stu-id="cd91e-206">Failover cluster behavior in Azure networking</span></span>
<span data-ttu-id="cd91e-207">由於您將重複的 IP 位址指派為叢集網路名稱 (例如，將相同的 IP 位址指派為其中一個叢集節點)，因此 Azure 中不符合 RFC 規範的 DHCP 服務可能會導致特定容錯移轉叢集組態的建立作業失敗。</span><span class="sxs-lookup"><span data-stu-id="cd91e-207">The non-RFC-compliant DHCP service in Azure can cause the creation of certain failover cluster configurations to fail, due to the cluster network name being assigned a duplicate IP address, such as the same IP address as one of the cluster nodes.</span></span> <span data-ttu-id="cd91e-208">這是您實作可用性群組 (取決於 Windows 容錯移轉叢集功能) 時會發生的問題。</span><span class="sxs-lookup"><span data-stu-id="cd91e-208">This is an issue when you implement Availability Groups, which depends on the Windows failover cluster feature.</span></span>

<span data-ttu-id="cd91e-209">當雙節點叢集建立且上線時，請考慮以下案例：</span><span class="sxs-lookup"><span data-stu-id="cd91e-209">Consider the scenario when a two-node cluster is created and brought online:</span></span>

1. <span data-ttu-id="cd91e-210">當叢集上線後，NODE1 會要求一個叢集網路名稱的動態指派 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="cd91e-210">The cluster comes online, then NODE1 requests a dynamically assigned IP address for the cluster network name.</span></span>
2. <span data-ttu-id="cd91e-211">由於 DHCP 服務會辨識來自 NODE1 本身的要求，因此除了 NODE1 本身的 IP 位址外，DHCP 服務不會指定任何 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="cd91e-211">No IP address other than NODE1’s own IP address is given by the DHCP service, since the DHCP service recognizes that the request comes from NODE1 itself.</span></span>
3. <span data-ttu-id="cd91e-212">如果 Windows 偵測到同時指派給 NODE1 和容錯移轉叢集網路名稱的重複位址，則預設的叢集群組就會無法上線。</span><span class="sxs-lookup"><span data-stu-id="cd91e-212">Windows detects that a duplicate address is assigned both to NODE1 and to the failover cluster network name, and the default cluster group fails to come online.</span></span>
4. <span data-ttu-id="cd91e-213">此時預設的叢集群組就會移動至 NODE2，而該群組會將 NODE1 的 IP 位址視為叢集 IP 位址，並讓預設叢集群組上線。</span><span class="sxs-lookup"><span data-stu-id="cd91e-213">The default cluster group moves to NODE2, which treats NODE1’s IP address as the cluster IP address and brings the default cluster group online.</span></span>
5. <span data-ttu-id="cd91e-214">當 NODE2 嘗試與 NODE1 建立連線時，於 NODE1 導向的封包不會離開 NODE2，因為它將 NODE1 的 IP 位址解析至其本身。</span><span class="sxs-lookup"><span data-stu-id="cd91e-214">When NODE2 attempts to establish connectivity with NODE1, packets directed at NODE1 never leave NODE2 because it resolves NODE1’s IP address to itself.</span></span> <span data-ttu-id="cd91e-215">NODE2 無法與 NODE1 建立連線，因此會失去仲裁並關閉叢集。</span><span class="sxs-lookup"><span data-stu-id="cd91e-215">NODE2 cannot establish connectivity with NODE1, then loses quorum and shuts down the cluster.</span></span>
6. <span data-ttu-id="cd91e-216">在此同時，NODE1 可以傳送封包至 NODE2，但是 NODE2 無法回覆。</span><span class="sxs-lookup"><span data-stu-id="cd91e-216">In the meantime, NODE1 can send packets to NODE2, but NODE2 cannot reply.</span></span> <span data-ttu-id="cd91e-217">NODE1 會失去仲裁並關閉叢集。</span><span class="sxs-lookup"><span data-stu-id="cd91e-217">NODE1 loses quorum and shuts down the cluster.</span></span>

<span data-ttu-id="cd91e-218">若要避免這種情況，可以將未使用的靜態 IP 位址 (例如，連結本機的 IP 位址為 169.254.1.1) 指派至叢集網路名稱，使叢集網路名稱上線。</span><span class="sxs-lookup"><span data-stu-id="cd91e-218">This scenario can be avoided by assigning an unused static IP address, such as a link-local IP address like 169.254.1.1, to the cluster network name in order to bring the cluster network name online.</span></span> <span data-ttu-id="cd91e-219">若要簡化此程序，請參閱[在 Azure 中為可用性群組設定 Windows 容錯移轉叢集](http://social.technet.microsoft.com/wiki/contents/articles/14776.configuring-windows-failover-cluster-in-windows-azure-for-alwayson-availability-groups.aspx) \(英文\)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-219">To simplify this process, see [Configuring Windows failover cluster in Azure for availability groups](http://social.technet.microsoft.com/wiki/contents/articles/14776.configuring-windows-failover-cluster-in-windows-azure-for-alwayson-availability-groups.aspx).</span></span>

<span data-ttu-id="cd91e-220">如需詳細資訊，請參閱[在 Azure (GUI) 中設定可用性群組](virtual-machines-windows-portal-sql-alwayson-availability-groups.md)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-220">For more information, see [Configure availability groups in Azure (GUI)](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span></span>

### <a name="availability-group-listener-support"></a><span data-ttu-id="cd91e-221">可用性群組接聽程式支援</span><span class="sxs-lookup"><span data-stu-id="cd91e-221">Availability group listener support</span></span>
<span data-ttu-id="cd91e-222">可用性群組接聽程式支援執行 Windows Server 2008 R2、Windows Server 2012、Windows Server 2012 R2 和 Windows Server 2016 的 Azure VM。</span><span class="sxs-lookup"><span data-stu-id="cd91e-222">Availability group listeners are supported on Azure VMs running Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2, and Windows Server 2016.</span></span> <span data-ttu-id="cd91e-223">透過使用在為可用性群組節點的 Azure VM 上啟用的負載平衡端點，即可提供支援。</span><span class="sxs-lookup"><span data-stu-id="cd91e-223">This support is made possible by the use of load-balanced endpoints enabled on the Azure VMs that are availability group nodes.</span></span> <span data-ttu-id="cd91e-224">您必須遵循特殊組態步驟，以便接聽程式在 Azure 中執行的用戶端應用程式，以及在內部部署中執行的用戶端應用程式運作。</span><span class="sxs-lookup"><span data-stu-id="cd91e-224">You must follow special configuration steps for the listeners to work for both client applications that are running in Azure as well as those running on-premises.</span></span>

<span data-ttu-id="cd91e-225">設定接聽程式有主要兩個選項：外部 (公用) 或內部。</span><span class="sxs-lookup"><span data-stu-id="cd91e-225">There are two main options for setting up your listener: external (public) or internal.</span></span> <span data-ttu-id="cd91e-226">外部 (公用) 接聽程式會使用網際網路對應負載平衡器，與可透過網際網路存取的公用虛擬 IP (VIP) 相關聯。</span><span class="sxs-lookup"><span data-stu-id="cd91e-226">The external (public) listener uses an internet facing load balancer and is associated with a public Virtual IP (VIP) that is accessible over the internet.</span></span> <span data-ttu-id="cd91e-227">內部接聽程式會使用內部負載平衡器，只支援位於相同虛擬網路的用戶端。</span><span class="sxs-lookup"><span data-stu-id="cd91e-227">An internal listener uses an internal load balancer and only supports clients within the same Virtual Network.</span></span> <span data-ttu-id="cd91e-228">對於各個負載平衡器類型，您必須啟用「伺服器直接回傳」。</span><span class="sxs-lookup"><span data-stu-id="cd91e-228">For either load balancer type, you must enable Direct Server Return.</span></span> 

<span data-ttu-id="cd91e-229">如果可用性群組跨越多個 Azure 子網路 (例如跨越多個 Azure 區域的部署)，用戶端連接字串就必須包含 "**MultisubnetFailover = True**"。</span><span class="sxs-lookup"><span data-stu-id="cd91e-229">If the Availability Group spans multiple Azure subnets (such as a deployment that crosses Azure regions), the client connection string must include "**MultisubnetFailover=True**".</span></span> <span data-ttu-id="cd91e-230">這會導致對於不同子網路中的複本進行平行連接嘗試。</span><span class="sxs-lookup"><span data-stu-id="cd91e-230">This results in parallel connection attempts to the replicas in the different subnets.</span></span> <span data-ttu-id="cd91e-231">如需有關設定接聽程式的指示，請參閱</span><span class="sxs-lookup"><span data-stu-id="cd91e-231">For instructions on setting up a listener, see</span></span>

* <span data-ttu-id="cd91e-232">[設定 Azure 中可用性群組的 ILB 接聽程式](virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-232">[Configure an ILB listener for availability groups in Azure](virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md).</span></span>
* <span data-ttu-id="cd91e-233">[設定 Azure 中可用性群組的外部接聽程式](../classic/ps-sql-ext-listener.md)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-233">[Configure an external listener for availability groups in Azure](../classic/ps-sql-ext-listener.md).</span></span>

<span data-ttu-id="cd91e-234">您仍可以透過直接連接至服務執行個體，分別連接至各個可用性複本。</span><span class="sxs-lookup"><span data-stu-id="cd91e-234">You can still connect to each availability replica separately by connecting directly to the service instance.</span></span> <span data-ttu-id="cd91e-235">此外，由於可用性群組能與資料庫鏡像用戶端回溯相容，因此只要將可用性複本設定成類似資料庫鏡像，即可連接至這類複本 (例如資料庫鏡像合作夥伴)：</span><span class="sxs-lookup"><span data-stu-id="cd91e-235">Also, since availability groups are backward compatible with database mirroring clients, you can connect to the availability replicas like database mirroring partners as long as the replicas are configured similar to database mirroring:</span></span>

* <span data-ttu-id="cd91e-236">一個主要複本與一個次要複本</span><span class="sxs-lookup"><span data-stu-id="cd91e-236">One primary replica and one secondary replica</span></span>
* <span data-ttu-id="cd91e-237">次要複本被設定為不可讀取 ([可讀取次要] 選項設為 [否])</span><span class="sxs-lookup"><span data-stu-id="cd91e-237">The secondary replica is configured as non-readable (**Readable Secondary** option set to **No**)</span></span>

<span data-ttu-id="cd91e-238">使用 ADO.NET 或 SQL Server Native Client 對應至類似此資料庫鏡像組態的範例用戶端連接字串如下：</span><span class="sxs-lookup"><span data-stu-id="cd91e-238">An example client connection string that corresponds to this database mirroring-like configuration using ADO.NET or SQL Server Native Client is below:</span></span>

    Data Source=ReplicaServer1;Failover Partner=ReplicaServer2;Initial Catalog=AvailabilityDatabase;

<span data-ttu-id="cd91e-239">如需用戶端連線的詳細資訊，請參閱：</span><span class="sxs-lookup"><span data-stu-id="cd91e-239">For more information on client connectivity, see:</span></span>

* [<span data-ttu-id="cd91e-240">搭配 SQL Server Native Client 使用連接字串關鍵字</span><span class="sxs-lookup"><span data-stu-id="cd91e-240">Using Connection String Keywords with SQL Server Native Client</span></span>](https://msdn.microsoft.com/library/ms130822.aspx)
* [<span data-ttu-id="cd91e-241">將用戶端連接至資料庫鏡像工作階段 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="cd91e-241">Connect Clients to a Database Mirroring Session (SQL Server)</span></span>](https://technet.microsoft.com/library/ms175484.aspx)
* [<span data-ttu-id="cd91e-242">連線至混合式 IT 中的可用性群組接聽程式 (英文)</span><span class="sxs-lookup"><span data-stu-id="cd91e-242">Connecting to Availability Group Listener in Hybrid IT</span></span>](http://blogs.msdn.com/b/sqlalwayson/archive/2013/02/14/connecting-to-availability-group-listener-in-hybrid-it.aspx)
* [<span data-ttu-id="cd91e-243">可用性群組接聽程式、用戶端連接及應用程式容錯移轉 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="cd91e-243">Availability Group Listeners, Client Connectivity, and Application Failover (SQL Server)</span></span>](https://technet.microsoft.com/library/hh213417.aspx)
* [<span data-ttu-id="cd91e-244">搭配可用性群組使用資料庫鏡像連接字串</span><span class="sxs-lookup"><span data-stu-id="cd91e-244">Using Database-Mirroring Connection Strings with Availability Groups</span></span>](https://technet.microsoft.com/library/hh213417.aspx)

### <a name="network-latency-in-hybrid-it"></a><span data-ttu-id="cd91e-245">混合式 IT 中的網路延遲</span><span class="sxs-lookup"><span data-stu-id="cd91e-245">Network latency in hybrid IT</span></span>
<span data-ttu-id="cd91e-246">假設內部部署網路與 Azure 之間可能會有一段時間發生嚴重網路延遲，您應該部署 HADR 解決方案。</span><span class="sxs-lookup"><span data-stu-id="cd91e-246">You should deploy your HADR solution with the assumption that there may be periods of time with high network latency between your on-premises network and Azure.</span></span> <span data-ttu-id="cd91e-247">當您將複本部署至 Azure 時，應該使用非同步認可，而不是同步處理模式的同步認可。</span><span class="sxs-lookup"><span data-stu-id="cd91e-247">When deploying replicas to Azure, you should use asynchronous commit instead of synchronous commit for the synchronization mode.</span></span> <span data-ttu-id="cd91e-248">當您將資料庫鏡像伺服器同時部署至內部部署與 Azure 時，請使用高效能模式，而不是高安全性模式。</span><span class="sxs-lookup"><span data-stu-id="cd91e-248">When deploying database mirroring servers both on-premises and in Azure, use the high-performance mode instead of the high-safety mode.</span></span>

### <a name="geo-replication-support"></a><span data-ttu-id="cd91e-249">異地複寫支援</span><span class="sxs-lookup"><span data-stu-id="cd91e-249">Geo-replication support</span></span>
<span data-ttu-id="cd91e-250">Azure 磁碟中的異地複寫不支援將相同資料庫的資料檔與記錄檔儲存在不同的磁碟上。</span><span class="sxs-lookup"><span data-stu-id="cd91e-250">Geo-replication in Azure disks does not support the data file and log file of the same database to be stored on separate disks.</span></span> <span data-ttu-id="cd91e-251">GRS 會在每個磁碟上進行獨立與非同步變更複寫。</span><span class="sxs-lookup"><span data-stu-id="cd91e-251">GRS replicates changes on each disk independently and asynchronously.</span></span> <span data-ttu-id="cd91e-252">此機制能保證異地複寫複本之單一磁碟內的寫入順序，但無法為多個磁碟的跨異地複寫複本保證。</span><span class="sxs-lookup"><span data-stu-id="cd91e-252">This mechanism guarantees the write order within a single disk on the geo-replicated copy, but not across geo-replicated copies of multiple disks.</span></span> <span data-ttu-id="cd91e-253">如果您設定資料庫將其資料檔與記錄檔儲存在不同磁碟中，嚴重損壞後修復的磁碟可能會包含更新的資料檔 (而非記錄檔) 複本，該情形會中斷 SQL Server 與 ACID 屬性交易的預寫記錄。</span><span class="sxs-lookup"><span data-stu-id="cd91e-253">If you configure a database to store its data file and its log file on separate disks, the recovered disks after a disaster may contain a more up-to-date copy of the data file than the log file, which breaks the write-ahead log in SQL Server and the ACID properties of transactions.</span></span> <span data-ttu-id="cd91e-254">如果您沒有可停用儲存體帳戶中異地複寫的選項，則應該將指定資料庫的所有資料和記錄檔保留在相同磁碟上。</span><span class="sxs-lookup"><span data-stu-id="cd91e-254">If you do not have the option to disable geo-replication on the storage account, you should keep all data and log files for a given database on the same disk.</span></span> <span data-ttu-id="cd91e-255">如果因為資料庫大小的緣故，而必須使用一個以上的磁碟，則您需要部署以上列出的其中一個嚴重損壞修復解決方案，以確保能進行資料備援。</span><span class="sxs-lookup"><span data-stu-id="cd91e-255">If you must use more than one disk due to the size of the database, you need to deploy one of the disaster recovery solutions listed above to ensure data redundancy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="cd91e-256">後續步驟</span><span class="sxs-lookup"><span data-stu-id="cd91e-256">Next steps</span></span>
<span data-ttu-id="cd91e-257">如果您需要透過 SQL Server 建立 Azure 虛擬機器，請參閱 [在 Azure 上佈建 SQL Server 虛擬機器](virtual-machines-windows-portal-sql-server-provision.md)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-257">If you need to create an Azure virtual machine with SQL Server, see [Provisioning a SQL Server Virtual Machine on Azure](virtual-machines-windows-portal-sql-server-provision.md).</span></span>

<span data-ttu-id="cd91e-258">若要獲得在 Azure VM 上執行的 SQL Server 的最佳效能，請參閱 [Azure 虛擬機器中 SQL Server 的效能最佳作法](virtual-machines-windows-sql-performance.md)中的指引。</span><span class="sxs-lookup"><span data-stu-id="cd91e-258">To get the best performance from SQL Server running on an Azure VM, see the guidance in [Performance Best Practices for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-performance.md).</span></span>

<span data-ttu-id="cd91e-259">如需在 Azure VM 中執行 SQL Server 的其他相關主題，請參閱 [Azure 虛擬機器上的 SQL Server](virtual-machines-windows-sql-server-iaas-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="cd91e-259">For other topics related to running SQL Server in Azure VMs, see [SQL Server on Azure Virtual Machines](virtual-machines-windows-sql-server-iaas-overview.md).</span></span>

### <a name="other-resources"></a><span data-ttu-id="cd91e-260">其他資源</span><span class="sxs-lookup"><span data-stu-id="cd91e-260">Other resources</span></span>
* [<span data-ttu-id="cd91e-261">在 Azure 中安裝新的 Active Directory 樹系</span><span class="sxs-lookup"><span data-stu-id="cd91e-261">Install a new Active Directory forest in Azure</span></span>](../../../active-directory/active-directory-new-forest-virtual-machine.md)
* <span data-ttu-id="cd91e-262">[在 Azure VM 中建立可用性群組的容錯移轉叢集](http://gallery.technet.microsoft.com/scriptcenter/Create-WSFC-Cluster-for-7c207d3a) \(英文\)</span><span class="sxs-lookup"><span data-stu-id="cd91e-262">[Create Failover Cluster for availability groups in Azure VM](http://gallery.technet.microsoft.com/scriptcenter/Create-WSFC-Cluster-for-7c207d3a)</span></span>

