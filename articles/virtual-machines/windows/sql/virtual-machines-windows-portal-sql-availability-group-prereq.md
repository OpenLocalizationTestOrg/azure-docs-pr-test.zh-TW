---
title: "aaaSQL 伺服器的可用性群組-Azure 虛擬機器必要條件 |Microsoft 文件"
description: "本教學課程會示範如何 tooconfigure hello 必要條件，用於建立 SQL Server Always On 可用性群組在 Azure Vm 上。"
services: virtual-machines
documentationCenter: na
authors: MikeRayMSFT
manager: jhubbard
editor: monicar
tags: azure-service-management
ms.assetid: c492db4c-3faa-4645-849f-5a1a663be55a
ms.service: virtual-machines-sql
ms.devlang: na
ms.custom: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/09/2017
ms.author: mikeray
ms.openlocfilehash: eed0729ead25c7793bb17a04cd7fd996c7dc8c9d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="complete-hello-prerequisites-for-creating-always-on-availability-groups-on-azure-virtual-machines"></a><span data-ttu-id="8ca59-103">完成 hello 建立 Azure 虛擬機器上的 Alwayson 可用性群組的必要條件</span><span class="sxs-lookup"><span data-stu-id="8ca59-103">Complete hello prerequisites for creating Always On availability groups on Azure virtual machines</span></span>

<span data-ttu-id="8ca59-104">本教學課程示範如何 toocomplete hello 建立的必要條件[SQL Server Always On 可用性群組在 Azure 虛擬機器 (Vm) 上的](virtual-machines-windows-portal-sql-availability-group-tutorial.md)。</span><span class="sxs-lookup"><span data-stu-id="8ca59-104">This tutorial shows how toocomplete hello prerequisites for creating a [SQL Server Always On availability group on Azure virtual machines (VMs)](virtual-machines-windows-portal-sql-availability-group-tutorial.md).</span></span> <span data-ttu-id="8ca59-105">完成 hello 必要條件後，您可以在單一資源群組中有網域控制站、 兩個 SQL Server Vm，以及將見證伺服器。</span><span class="sxs-lookup"><span data-stu-id="8ca59-105">When you've finished hello prerequisites, you have a domain controller, two SQL Server VMs, and a witness server in a single resource group.</span></span>

<span data-ttu-id="8ca59-106">**估計時間**： 可能需要數小時 toocomplete hello 必要條件。</span><span class="sxs-lookup"><span data-stu-id="8ca59-106">**Time estimate**: It might take a couple of hours toocomplete hello prerequisites.</span></span> <span data-ttu-id="8ca59-107">這個時間大部分都是花在建立虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="8ca59-107">Much of this time is spent creating virtual machines.</span></span>

<span data-ttu-id="8ca59-108">hello 下列圖表說明您在 hello 教學課程中所建置。</span><span class="sxs-lookup"><span data-stu-id="8ca59-108">hello following diagram illustrates what you build in hello tutorial.</span></span>

![可用性群組](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/00-EndstateSampleNoELB.png)

## <a name="review-availability-group-documentation"></a><span data-ttu-id="8ca59-110">檢閱可用性群組文件</span><span class="sxs-lookup"><span data-stu-id="8ca59-110">Review availability group documentation</span></span>

<span data-ttu-id="8ca59-111">本教學課程假設您對 SQL Server Always On 可用性群組有基本的了解。</span><span class="sxs-lookup"><span data-stu-id="8ca59-111">This tutorial assumes that you have a basic understanding of SQL Server Always On availability groups.</span></span> <span data-ttu-id="8ca59-112">如果您不熟悉這項技術，請參閱 [Always On 可用性群組概觀 (SQL Server)](http://msdn.microsoft.com/library/ff877884.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8ca59-112">If you're not familiar with this technology, see [Overview of Always On Availability Groups (SQL Server)](http://msdn.microsoft.com/library/ff877884.aspx).</span></span>


## <a name="create-an-azure-account"></a><span data-ttu-id="8ca59-113">建立 Azure 帳戶</span><span class="sxs-lookup"><span data-stu-id="8ca59-113">Create an Azure account</span></span>
<span data-ttu-id="8ca59-114">您需要 Azure 帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-114">You need an Azure account.</span></span> <span data-ttu-id="8ca59-115">您可以[申請免費 Azure 帳戶](/pricing/free-trial/?WT.mc_id=A261C142F)或[啟用 Visual Studio 訂閱者權益](/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F)。</span><span class="sxs-lookup"><span data-stu-id="8ca59-115">You can [open a free Azure account](/pricing/free-trial/?WT.mc_id=A261C142F) or [activate Visual Studio subscriber benefits](/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F).</span></span>

## <a name="create-a-resource-group"></a><span data-ttu-id="8ca59-116">建立資源群組</span><span class="sxs-lookup"><span data-stu-id="8ca59-116">Create a resource group</span></span>
1. <span data-ttu-id="8ca59-117">登入 toohello [Azure 入口網站](http://portal.azure.com)。</span><span class="sxs-lookup"><span data-stu-id="8ca59-117">Sign in toohello [Azure portal](http://portal.azure.com).</span></span>
2. <span data-ttu-id="8ca59-118">按一下 **+**  toocreate hello 入口網站中的新物件。</span><span class="sxs-lookup"><span data-stu-id="8ca59-118">Click **+** toocreate a new object in hello portal.</span></span>

   ![新增物件](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-portalplus.png)

3. <span data-ttu-id="8ca59-120">型別**資源群組**在 hello **Marketplace**搜尋 視窗。</span><span class="sxs-lookup"><span data-stu-id="8ca59-120">Type **resource group** in hello **Marketplace** search window.</span></span>

   ![資源群組](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-resourcegroupsymbol.png)
4. <span data-ttu-id="8ca59-122">按一下 [資源群組]。</span><span class="sxs-lookup"><span data-stu-id="8ca59-122">Click **Resource group**.</span></span>
5. <span data-ttu-id="8ca59-123">按一下 [建立] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-123">Click **Create**.</span></span>
6. <span data-ttu-id="8ca59-124">在 hello**資源群組**刀鋒視窗底下**資源群組名稱**，輸入 hello 資源群組的名稱。</span><span class="sxs-lookup"><span data-stu-id="8ca59-124">On hello **Resource group** blade, under **Resource group name**, type a name for hello resource group.</span></span> <span data-ttu-id="8ca59-125">例如，輸入 **sql-ha-rg**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-125">For example, type **sql-ha-rg**.</span></span>
7. <span data-ttu-id="8ca59-126">如果您有多個 Azure 訂用帳戶，請確認 hello 訂閱 hello 想 toocreate hello 可用性群組中的 Azure 訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-126">If you have multiple Azure subscriptions, verify that hello subscription is hello Azure subscription that you want toocreate hello availability group in.</span></span>
8. <span data-ttu-id="8ca59-127">選取位置。</span><span class="sxs-lookup"><span data-stu-id="8ca59-127">Select a location.</span></span> <span data-ttu-id="8ca59-128">hello 位置為 hello 想 toocreate hello 可用性群組的 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="8ca59-128">hello location is hello Azure region where you want toocreate hello availability group.</span></span> <span data-ttu-id="8ca59-129">此教學課程中，我們 toobuild 一個 Azure 位置中的所有資源。</span><span class="sxs-lookup"><span data-stu-id="8ca59-129">For this tutorial, we're going toobuild all resources in one Azure location.</span></span>
9. <span data-ttu-id="8ca59-130">確認**Pin toodashboard**已核取。</span><span class="sxs-lookup"><span data-stu-id="8ca59-130">Verify that **Pin toodashboard** is checked.</span></span> <span data-ttu-id="8ca59-131">這個選擇性的設定放 hello Azure 入口網站的儀表板中的 hello 資源群組的捷徑。</span><span class="sxs-lookup"><span data-stu-id="8ca59-131">This optional setting places a shortcut for hello resource group on hello Azure portal dashboard.</span></span>

   ![資源群組](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-resourcegroup.png)

10. <span data-ttu-id="8ca59-133">按一下**建立**toocreate hello 資源群組。</span><span class="sxs-lookup"><span data-stu-id="8ca59-133">Click **Create** toocreate hello resource group.</span></span>

<span data-ttu-id="8ca59-134">Azure 會建立 hello 資源群組] 和 [pin 捷徑 toohello 資源群組 hello 入口網站中。</span><span class="sxs-lookup"><span data-stu-id="8ca59-134">Azure creates hello resource group and pins a shortcut toohello resource group in hello portal.</span></span>

## <a name="create-hello-network-and-subnets"></a><span data-ttu-id="8ca59-135">建立 hello 網路和子網路</span><span class="sxs-lookup"><span data-stu-id="8ca59-135">Create hello network and subnets</span></span>
<span data-ttu-id="8ca59-136">hello 下一個步驟是 toocreate hello 網路與 hello Azure 資源群組中的子網路。</span><span class="sxs-lookup"><span data-stu-id="8ca59-136">hello next step is toocreate hello networks and subnets in hello Azure resource group.</span></span>

<span data-ttu-id="8ca59-137">hello 方案會使用兩個子網路中的一個虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="8ca59-137">hello solution uses one virtual network with two subnets.</span></span> <span data-ttu-id="8ca59-138">hello[虛擬網路概觀](../../../virtual-network/virtual-networks-overview.md)提供在 Azure 中網路的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="8ca59-138">hello [Virtual network overview](../../../virtual-network/virtual-networks-overview.md) provides more information about networks in Azure.</span></span>

<span data-ttu-id="8ca59-139">toocreate hello 虛擬網路：</span><span class="sxs-lookup"><span data-stu-id="8ca59-139">toocreate hello virtual network:</span></span>

1. <span data-ttu-id="8ca59-140">在 hello Azure 入口網站，在資源群組中，按一下  **+ 加**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-140">In hello Azure portal, in your resource group, click **+ Add**.</span></span> <span data-ttu-id="8ca59-141">Azure 會開啟 hello**一切**刀鋒視窗。</span><span class="sxs-lookup"><span data-stu-id="8ca59-141">Azure opens hello **Everything** blade.</span></span>

   ![新增項目](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/02-newiteminrg.png)
2. <span data-ttu-id="8ca59-143">搜尋 **虛擬網路**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-143">Search for **virtual network**.</span></span>

     ![搜尋虛擬網路](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/04-findvirtualnetwork.png)
3. <span data-ttu-id="8ca59-145">按一下 [虛擬網路] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-145">Click **Virtual network**.</span></span>
4. <span data-ttu-id="8ca59-146">在 hello**虛擬網路**刀鋒視窗中，按一下 hello**資源管理員**部署模型，然後再按一下**建立**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-146">On hello **Virtual network** blade, click hello **Resource Manager** deployment model, and then click **Create**.</span></span>

    <span data-ttu-id="8ca59-147">hello 下表顯示 hello 虛擬網路的 hello 設定：</span><span class="sxs-lookup"><span data-stu-id="8ca59-147">hello following table shows hello settings for hello virtual network:</span></span>

   | <span data-ttu-id="8ca59-148">**欄位**</span><span class="sxs-lookup"><span data-stu-id="8ca59-148">**Field**</span></span> | <span data-ttu-id="8ca59-149">值</span><span class="sxs-lookup"><span data-stu-id="8ca59-149">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="8ca59-150">**名稱**</span><span class="sxs-lookup"><span data-stu-id="8ca59-150">**Name**</span></span> |<span data-ttu-id="8ca59-151">autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="8ca59-151">autoHAVNET</span></span> |
   | <span data-ttu-id="8ca59-152">**位址空間**</span><span class="sxs-lookup"><span data-stu-id="8ca59-152">**Address space**</span></span> |<span data-ttu-id="8ca59-153">10.33.0.0/24</span><span class="sxs-lookup"><span data-stu-id="8ca59-153">10.33.0.0/24</span></span> |
   | <span data-ttu-id="8ca59-154">**子網路名稱**</span><span class="sxs-lookup"><span data-stu-id="8ca59-154">**Subnet name**</span></span> |<span data-ttu-id="8ca59-155">Admin</span><span class="sxs-lookup"><span data-stu-id="8ca59-155">Admin</span></span> |
   | <span data-ttu-id="8ca59-156">**子網路位址範圍**</span><span class="sxs-lookup"><span data-stu-id="8ca59-156">**Subnet address range**</span></span> |<span data-ttu-id="8ca59-157">10.33.0.0/29</span><span class="sxs-lookup"><span data-stu-id="8ca59-157">10.33.0.0/29</span></span> |
   | <span data-ttu-id="8ca59-158">**訂用帳戶**</span><span class="sxs-lookup"><span data-stu-id="8ca59-158">**Subscription**</span></span> |<span data-ttu-id="8ca59-159">指定您想 toouse hello 訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-159">Specify hello subscription that you intend toouse.</span></span> <span data-ttu-id="8ca59-160">如果您只有一個訂用帳戶，則**訂用帳戶**為留白。</span><span class="sxs-lookup"><span data-stu-id="8ca59-160">**Subscription** is blank if you only have one subscription.</span></span> |
   | <span data-ttu-id="8ca59-161">**資源群組**</span><span class="sxs-lookup"><span data-stu-id="8ca59-161">**Resource group**</span></span> |<span data-ttu-id="8ca59-162">選擇**使用現有**並挑選 hello hello 資源群組名稱。</span><span class="sxs-lookup"><span data-stu-id="8ca59-162">Choose **Use existing** and pick hello name of hello resource group.</span></span> |
   | <span data-ttu-id="8ca59-163">**位置**</span><span class="sxs-lookup"><span data-stu-id="8ca59-163">**Location**</span></span> |<span data-ttu-id="8ca59-164">指定 hello Azure 位置。</span><span class="sxs-lookup"><span data-stu-id="8ca59-164">Specify hello Azure location.</span></span> |

   <span data-ttu-id="8ca59-165">位址空間和子網路位址範圍可能從 hello 資料表不同。</span><span class="sxs-lookup"><span data-stu-id="8ca59-165">Your address space and subnet address range might be different from hello table.</span></span> <span data-ttu-id="8ca59-166">根據您的訂閱，hello 入口網站會建議可用的位址空間和對應的子網路位址範圍。</span><span class="sxs-lookup"><span data-stu-id="8ca59-166">Depending on your subscription, hello portal suggests an available address space and corresponding subnet address range.</span></span> <span data-ttu-id="8ca59-167">如果沒有足夠的位址空間可供使用，請使用不同的訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-167">If no sufficient address space is available, use a different subscription.</span></span>

   <span data-ttu-id="8ca59-168">使用 hello 子網路名稱的 hello 範例**Admin**。此子網路是 hello 網域控制站。</span><span class="sxs-lookup"><span data-stu-id="8ca59-168">hello example uses hello subnet name **Admin**. This subnet is for hello domain controllers.</span></span>

5. <span data-ttu-id="8ca59-169">按一下 [建立] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-169">Click **Create**.</span></span>

   ![設定虛擬網路，hello](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/06-configurevirtualnetwork.png)

<span data-ttu-id="8ca59-171">Azure 會讓您返回 toohello 入口網站儀表板，並建立 hello 新網路時通知您。</span><span class="sxs-lookup"><span data-stu-id="8ca59-171">Azure returns you toohello portal dashboard and notifies you when hello new network is created.</span></span>

### <a name="create-a-second-subnet"></a><span data-ttu-id="8ca59-172">建立第二個子網路</span><span class="sxs-lookup"><span data-stu-id="8ca59-172">Create a second subnet</span></span>
<span data-ttu-id="8ca59-173">hello 新的虛擬網路有一個子網路，名為**Admin**。 hello 網域控制站會使用此子網路。</span><span class="sxs-lookup"><span data-stu-id="8ca59-173">hello new virtual network has one subnet, named **Admin**. hello domain controllers use this subnet.</span></span> <span data-ttu-id="8ca59-174">SQL Server Vm hello 使用第二個名為的子網路**SQL**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-174">hello SQL Server VMs use a second subnet named **SQL**.</span></span> <span data-ttu-id="8ca59-175">tooconfigure 此子網路：</span><span class="sxs-lookup"><span data-stu-id="8ca59-175">tooconfigure this subnet:</span></span>

1. <span data-ttu-id="8ca59-176">按一下 儀表板，您所建立的 hello 資源群組**SQL-HA-RG**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-176">On your dashboard, click hello resource group that you created, **SQL-HA-RG**.</span></span> <span data-ttu-id="8ca59-177">找出 hello 下的資源群組中的 hello 網路**資源**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-177">Locate hello network in hello resource group under **Resources**.</span></span>

    <span data-ttu-id="8ca59-178">如果**SQL-HA-RG**看不到，尋找按一下**資源群組**與篩選的 hello 資源群組名稱。</span><span class="sxs-lookup"><span data-stu-id="8ca59-178">If **SQL-HA-RG** isn't visible, find it by clicking **Resource Groups** and filtering by hello resource group name.</span></span>
2. <span data-ttu-id="8ca59-179">按一下**autoHAVNET**上 hello 的資源清單。</span><span class="sxs-lookup"><span data-stu-id="8ca59-179">Click **autoHAVNET** on hello list of resources.</span></span> <span data-ttu-id="8ca59-180">Azure 開啟 hello 網路組態刀鋒視窗。</span><span class="sxs-lookup"><span data-stu-id="8ca59-180">Azure opens hello network configuration blade.</span></span>
3. <span data-ttu-id="8ca59-181">在 [hello **autoHAVNET**虛擬網路] 刀鋒視窗底下**設定**，按一下**子網路**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-181">On hello **autoHAVNET** virtual network blade, under **Settings** , click **Subnets**.</span></span>

    <span data-ttu-id="8ca59-182">請注意，您已經建立 hello 子網路。</span><span class="sxs-lookup"><span data-stu-id="8ca59-182">Note hello subnet that you already created.</span></span>

   ![設定虛擬網路，hello](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/07-addsubnet.png)
5. <span data-ttu-id="8ca59-184">建立第二個子網路。</span><span class="sxs-lookup"><span data-stu-id="8ca59-184">Create a second subnet.</span></span> <span data-ttu-id="8ca59-185">按一下 [+ 子網路] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-185">Click **+ Subnet**.</span></span>
6. <span data-ttu-id="8ca59-186">在 hello**加入子網路**刀鋒視窗中，輸入設定 hello 子網路**sqlsubnet**下**名稱**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-186">On hello **Add subnet** blade, configure hello subnet by typing **sqlsubnet** under **Name**.</span></span> <span data-ttu-id="8ca59-187">Azure 會自動指定有效的 [位址範圍] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-187">Azure automatically specifies a valid **Address range**.</span></span> <span data-ttu-id="8ca59-188">確認此位址範圍中至少有 10 個位址。</span><span class="sxs-lookup"><span data-stu-id="8ca59-188">Verify that this address range has at least 10 addresses in it.</span></span> <span data-ttu-id="8ca59-189">在生產環境中，您可能需要更多位址。</span><span class="sxs-lookup"><span data-stu-id="8ca59-189">In a production environment, you might require more addresses.</span></span>
7. <span data-ttu-id="8ca59-190">按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-190">Click **OK**.</span></span>

    ![設定虛擬網路，hello](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/08-configuresubnet.png)

<span data-ttu-id="8ca59-192">hello 下表摘要說明 hello 網路組態設定：</span><span class="sxs-lookup"><span data-stu-id="8ca59-192">hello following table summarizes hello network configuration settings:</span></span>

| <span data-ttu-id="8ca59-193">**欄位**</span><span class="sxs-lookup"><span data-stu-id="8ca59-193">**Field**</span></span> | <span data-ttu-id="8ca59-194">值</span><span class="sxs-lookup"><span data-stu-id="8ca59-194">Value</span></span> |
| --- | --- |
| <span data-ttu-id="8ca59-195">**名稱**</span><span class="sxs-lookup"><span data-stu-id="8ca59-195">**Name**</span></span> |<span data-ttu-id="8ca59-196">**autoHAVNET**</span><span class="sxs-lookup"><span data-stu-id="8ca59-196">**autoHAVNET**</span></span> |
| <span data-ttu-id="8ca59-197">**位址空間**</span><span class="sxs-lookup"><span data-stu-id="8ca59-197">**Address space**</span></span> |<span data-ttu-id="8ca59-198">這個值取決於您的訂用帳戶中的 hello 可用的位址空間。</span><span class="sxs-lookup"><span data-stu-id="8ca59-198">This value depends on hello available address spaces in your subscription.</span></span> <span data-ttu-id="8ca59-199">一般的值是 10.0.0.0/16。</span><span class="sxs-lookup"><span data-stu-id="8ca59-199">A typical value is 10.0.0.0/16.</span></span> |
| <span data-ttu-id="8ca59-200">**子網路名稱**</span><span class="sxs-lookup"><span data-stu-id="8ca59-200">**Subnet name**</span></span> |<span data-ttu-id="8ca59-201">**admin**</span><span class="sxs-lookup"><span data-stu-id="8ca59-201">**admin**</span></span> |
| <span data-ttu-id="8ca59-202">**子網路位址範圍**</span><span class="sxs-lookup"><span data-stu-id="8ca59-202">**Subnet address range**</span></span> |<span data-ttu-id="8ca59-203">這個值取決於您的訂用帳戶中的 hello 可用的位址範圍。</span><span class="sxs-lookup"><span data-stu-id="8ca59-203">This value depends on hello available address ranges in your subscription.</span></span> <span data-ttu-id="8ca59-204">一般的值是 10.0.0.0/24。</span><span class="sxs-lookup"><span data-stu-id="8ca59-204">A typical value is 10.0.0.0/24.</span></span> |
| <span data-ttu-id="8ca59-205">**子網路名稱**</span><span class="sxs-lookup"><span data-stu-id="8ca59-205">**Subnet name**</span></span> |<span data-ttu-id="8ca59-206">**sqlsubnet**</span><span class="sxs-lookup"><span data-stu-id="8ca59-206">**sqlsubnet**</span></span> |
| <span data-ttu-id="8ca59-207">**子網路位址範圍**</span><span class="sxs-lookup"><span data-stu-id="8ca59-207">**Subnet address range**</span></span> |<span data-ttu-id="8ca59-208">這個值取決於您的訂用帳戶中的 hello 可用的位址範圍。</span><span class="sxs-lookup"><span data-stu-id="8ca59-208">This value depends on hello available address ranges in your subscription.</span></span> <span data-ttu-id="8ca59-209">一般的值是 10.0.1.0/24。</span><span class="sxs-lookup"><span data-stu-id="8ca59-209">A typical value is 10.0.1.0/24.</span></span> |
| <span data-ttu-id="8ca59-210">**訂用帳戶**</span><span class="sxs-lookup"><span data-stu-id="8ca59-210">**Subscription**</span></span> |<span data-ttu-id="8ca59-211">指定您想 toouse hello 訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-211">Specify hello subscription that you intend toouse.</span></span> |
| <span data-ttu-id="8ca59-212">**資源群組**</span><span class="sxs-lookup"><span data-stu-id="8ca59-212">**Resource Group**</span></span> |<span data-ttu-id="8ca59-213">**SQL-HA-RG**</span><span class="sxs-lookup"><span data-stu-id="8ca59-213">**SQL-HA-RG**</span></span> |
| <span data-ttu-id="8ca59-214">**位置**</span><span class="sxs-lookup"><span data-stu-id="8ca59-214">**Location**</span></span> |<span data-ttu-id="8ca59-215">指定 hello 您選擇 hello 資源群組的相同位置。</span><span class="sxs-lookup"><span data-stu-id="8ca59-215">Specify hello same location that you chose for hello resource group.</span></span> |

## <a name="create-availability-sets"></a><span data-ttu-id="8ca59-216">建立可用性設定組</span><span class="sxs-lookup"><span data-stu-id="8ca59-216">Create availability sets</span></span>

<span data-ttu-id="8ca59-217">建立虛擬機器之前，您會需要 toocreate 可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="8ca59-217">Before you create virtual machines, you need toocreate availability sets.</span></span> <span data-ttu-id="8ca59-218">可用性設定組的規劃或未規劃的維護事件 hello 停機時間減少。</span><span class="sxs-lookup"><span data-stu-id="8ca59-218">Availability sets reduce hello downtime for planned or unplanned maintenance events.</span></span> <span data-ttu-id="8ca59-219">Azure 可用性設定組是 Azure 置於實體容錯網域和更新網域上的邏輯資源群組。</span><span class="sxs-lookup"><span data-stu-id="8ca59-219">An Azure availability set is a logical group of resources that Azure places on physical fault domains and update domains.</span></span> <span data-ttu-id="8ca59-220">「 故障 」 網域可確保 hello 可用性設定組的 hello 成員有不同的電源和網路資源。</span><span class="sxs-lookup"><span data-stu-id="8ca59-220">A fault domain ensures that hello members of hello availability set have separate power and network resources.</span></span> <span data-ttu-id="8ca59-221">更新網域可確保，hello 可用性設定組的成員不會導致在 hello 維護相同的時間。</span><span class="sxs-lookup"><span data-stu-id="8ca59-221">An update domain ensures that members of hello availability set aren't brought down for maintenance at hello same time.</span></span> <span data-ttu-id="8ca59-222">如需詳細資訊，請參閱[管理虛擬機器可用性 hello](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)。</span><span class="sxs-lookup"><span data-stu-id="8ca59-222">For more information, see [Manage hello availability of virtual machines](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

<span data-ttu-id="8ca59-223">您需要兩個可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="8ca59-223">You need two availability sets.</span></span> <span data-ttu-id="8ca59-224">其中一個是 hello 網域控制站。</span><span class="sxs-lookup"><span data-stu-id="8ca59-224">One is for hello domain controllers.</span></span> <span data-ttu-id="8ca59-225">hello 第二個是 hello SQL Server Vm。</span><span class="sxs-lookup"><span data-stu-id="8ca59-225">hello second is for hello SQL Server VMs.</span></span>

<span data-ttu-id="8ca59-226">可用性設定 toohello 資源群組，請按一下的 toocreate**新增**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-226">toocreate an availability set, go toohello resource group and click **Add**.</span></span> <span data-ttu-id="8ca59-227">輸入篩選 hello 結果**可用性設定組**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-227">Filter hello results by typing **availability set**.</span></span> <span data-ttu-id="8ca59-228">按一下**可用性設定組**在 hello 結果，然後按一下**建立**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-228">Click **Availability Set** in hello results, and then click **Create**.</span></span>

<span data-ttu-id="8ca59-229">設定根據 toohello 參數 hello 下表中的兩個可用性設定組：</span><span class="sxs-lookup"><span data-stu-id="8ca59-229">Configure two availability sets according toohello parameters in hello following table:</span></span>

| <span data-ttu-id="8ca59-230">**欄位**</span><span class="sxs-lookup"><span data-stu-id="8ca59-230">**Field**</span></span> | <span data-ttu-id="8ca59-231">網域控制站可用性設定組</span><span class="sxs-lookup"><span data-stu-id="8ca59-231">Domain controller availability set</span></span> | <span data-ttu-id="8ca59-232">SQL Server 可用性設定組</span><span class="sxs-lookup"><span data-stu-id="8ca59-232">SQL Server availability set</span></span> |
| --- | --- | --- |
| <span data-ttu-id="8ca59-233">**名稱**</span><span class="sxs-lookup"><span data-stu-id="8ca59-233">**Name**</span></span> |<span data-ttu-id="8ca59-234">adavailabilityset</span><span class="sxs-lookup"><span data-stu-id="8ca59-234">adavailabilityset</span></span> |<span data-ttu-id="8ca59-235">sqlavailabilityset</span><span class="sxs-lookup"><span data-stu-id="8ca59-235">sqlavailabilityset</span></span> |
| <span data-ttu-id="8ca59-236">**資源群組**</span><span class="sxs-lookup"><span data-stu-id="8ca59-236">**Resource group**</span></span> |<span data-ttu-id="8ca59-237">SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="8ca59-237">SQL-HA-RG</span></span> |<span data-ttu-id="8ca59-238">SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="8ca59-238">SQL-HA-RG</span></span> |
| <span data-ttu-id="8ca59-239">**容錯網域**</span><span class="sxs-lookup"><span data-stu-id="8ca59-239">**Fault domains**</span></span> |<span data-ttu-id="8ca59-240">3</span><span class="sxs-lookup"><span data-stu-id="8ca59-240">3</span></span> |<span data-ttu-id="8ca59-241">3</span><span class="sxs-lookup"><span data-stu-id="8ca59-241">3</span></span> |
| <span data-ttu-id="8ca59-242">**更新網域**</span><span class="sxs-lookup"><span data-stu-id="8ca59-242">**Update domains**</span></span> |<span data-ttu-id="8ca59-243">5</span><span class="sxs-lookup"><span data-stu-id="8ca59-243">5</span></span> |<span data-ttu-id="8ca59-244">3</span><span class="sxs-lookup"><span data-stu-id="8ca59-244">3</span></span> |

<span data-ttu-id="8ca59-245">建立 hello 可用性設定組之後，傳回 toohello 資源群組中 hello Azure 入口網站。</span><span class="sxs-lookup"><span data-stu-id="8ca59-245">After you create hello availability sets, return toohello resource group in hello Azure portal.</span></span>

## <a name="create-domain-controllers"></a><span data-ttu-id="8ca59-246">建立網域控制站</span><span class="sxs-lookup"><span data-stu-id="8ca59-246">Create domain controllers</span></span>
<span data-ttu-id="8ca59-247">在您建立 hello 網路、 子網路，可用性設定組及使用網際網路對向負載平衡器後，您準備 toocreate hello hello 網域控制站的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="8ca59-247">After you've created hello network, subnets, availability sets, and an Internet-facing load balancer, you're ready toocreate hello virtual machines for hello domain controllers.</span></span>

### <a name="create-virtual-machines-for-hello-domain-controllers"></a><span data-ttu-id="8ca59-248">建立虛擬機器的 hello 網域控制站</span><span class="sxs-lookup"><span data-stu-id="8ca59-248">Create virtual machines for hello domain controllers</span></span>
<span data-ttu-id="8ca59-249">toocreate 而且設定 hello 網域控制站，則傳回 toohello **SQL-HA-RG**資源群組。</span><span class="sxs-lookup"><span data-stu-id="8ca59-249">toocreate and configure hello domain controllers, return toohello **SQL-HA-RG** resource group.</span></span>

1. <span data-ttu-id="8ca59-250">按一下 [新增] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-250">Click **Add**.</span></span> <span data-ttu-id="8ca59-251">hello**一切**刀鋒視窗隨即開啟。</span><span class="sxs-lookup"><span data-stu-id="8ca59-251">hello **Everything** blade opens.</span></span>
2. <span data-ttu-id="8ca59-252">輸入 **Windows Server 2016 資料中心**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-252">Type **Windows Server 2016 Datacenter**.</span></span>
3. <span data-ttu-id="8ca59-253">按一下 **Windows Server 2016 資料中心**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-253">Click **Windows Server 2016 Datacenter**.</span></span> <span data-ttu-id="8ca59-254">在 hello **Windows Server 2016 Datacenter**刀鋒視窗中，確認該 hello 部署模型**資源管理員**，然後按一下**建立**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-254">In hello **Windows Server 2016 Datacenter** blade, verify that hello deployment model is **Resource Manager**, and then click **Create**.</span></span> <span data-ttu-id="8ca59-255">Azure 會開啟 hello**建立虛擬機器**刀鋒視窗。</span><span class="sxs-lookup"><span data-stu-id="8ca59-255">Azure opens hello **Create virtual machine** blade.</span></span>

<span data-ttu-id="8ca59-256">重複上述步驟 toocreate 兩部虛擬機器的 hello。</span><span class="sxs-lookup"><span data-stu-id="8ca59-256">Repeat hello preceding steps toocreate two virtual machines.</span></span> <span data-ttu-id="8ca59-257">Hello 兩部虛擬機器的名稱：</span><span class="sxs-lookup"><span data-stu-id="8ca59-257">Name hello two virtual machines:</span></span>

* <span data-ttu-id="8ca59-258">ad-primary-dc</span><span class="sxs-lookup"><span data-stu-id="8ca59-258">ad-primary-dc</span></span>
* <span data-ttu-id="8ca59-259">ad-secondary-dc</span><span class="sxs-lookup"><span data-stu-id="8ca59-259">ad-secondary-dc</span></span>

  > [!NOTE]
  > <span data-ttu-id="8ca59-260">hello **ad 次要 dc**虛擬機器是選擇性的 tooprovide 的 Active Directory 網域服務的高可用性。</span><span class="sxs-lookup"><span data-stu-id="8ca59-260">hello **ad-secondary-dc** virtual machine is optional, tooprovide high availability for Active Directory Domain Services.</span></span>
  >
  >

<span data-ttu-id="8ca59-261">hello 下表顯示這兩個機器 hello 設定：</span><span class="sxs-lookup"><span data-stu-id="8ca59-261">hello following table shows hello settings for these two machines:</span></span>

| <span data-ttu-id="8ca59-262">**欄位**</span><span class="sxs-lookup"><span data-stu-id="8ca59-262">**Field**</span></span> | <span data-ttu-id="8ca59-263">值</span><span class="sxs-lookup"><span data-stu-id="8ca59-263">Value</span></span> |
| --- | --- |
| <span data-ttu-id="8ca59-264">**名稱**</span><span class="sxs-lookup"><span data-stu-id="8ca59-264">**Name**</span></span> |<span data-ttu-id="8ca59-265">第一網域控制站：ad-primary-dc。</span><span class="sxs-lookup"><span data-stu-id="8ca59-265">First domain controller: *ad-primary-dc*.</span></span></br><span data-ttu-id="8ca59-266">第二網域控制站：ad-secondary-dc。</span><span class="sxs-lookup"><span data-stu-id="8ca59-266">Second domain controller *ad-secondary-dc*.</span></span> |
| <span data-ttu-id="8ca59-267">**VM 磁碟類型**</span><span class="sxs-lookup"><span data-stu-id="8ca59-267">**VM disk type**</span></span> |<span data-ttu-id="8ca59-268">SSD</span><span class="sxs-lookup"><span data-stu-id="8ca59-268">SSD</span></span> |
| <span data-ttu-id="8ca59-269">**使用者名稱**</span><span class="sxs-lookup"><span data-stu-id="8ca59-269">**User name**</span></span> |<span data-ttu-id="8ca59-270">DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="8ca59-270">DomainAdmin</span></span> |
| <span data-ttu-id="8ca59-271">**密碼**</span><span class="sxs-lookup"><span data-stu-id="8ca59-271">**Password**</span></span> |<span data-ttu-id="8ca59-272">Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="8ca59-272">Contoso!0000</span></span> |
| <span data-ttu-id="8ca59-273">**訂用帳戶**</span><span class="sxs-lookup"><span data-stu-id="8ca59-273">**Subscription**</span></span> |<span data-ttu-id="8ca59-274">*您的訂用帳戶*</span><span class="sxs-lookup"><span data-stu-id="8ca59-274">*Your subscription*</span></span> |
| <span data-ttu-id="8ca59-275">**資源群組**</span><span class="sxs-lookup"><span data-stu-id="8ca59-275">**Resource group**</span></span> |<span data-ttu-id="8ca59-276">SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="8ca59-276">SQL-HA-RG</span></span> |
| <span data-ttu-id="8ca59-277">**位置**</span><span class="sxs-lookup"><span data-stu-id="8ca59-277">**Location**</span></span> |<span data-ttu-id="8ca59-278">*您的位置*</span><span class="sxs-lookup"><span data-stu-id="8ca59-278">*Your location*</span></span> |
| <span data-ttu-id="8ca59-279">**大小**</span><span class="sxs-lookup"><span data-stu-id="8ca59-279">**Size**</span></span> |<span data-ttu-id="8ca59-280">DS1_V2</span><span class="sxs-lookup"><span data-stu-id="8ca59-280">DS1_V2</span></span> |
| <span data-ttu-id="8ca59-281">**儲存體**</span><span class="sxs-lookup"><span data-stu-id="8ca59-281">**Storage**</span></span> | <span data-ttu-id="8ca59-282">[使用受控磁碟] - [是]</span><span class="sxs-lookup"><span data-stu-id="8ca59-282">**Use managed disks** - **Yes**</span></span> |
| <span data-ttu-id="8ca59-283">**虛擬網路**</span><span class="sxs-lookup"><span data-stu-id="8ca59-283">**Virtual network**</span></span> |<span data-ttu-id="8ca59-284">autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="8ca59-284">autoHAVNET</span></span> |
| <span data-ttu-id="8ca59-285">**子網路**</span><span class="sxs-lookup"><span data-stu-id="8ca59-285">**Subnet**</span></span> |<span data-ttu-id="8ca59-286">admin</span><span class="sxs-lookup"><span data-stu-id="8ca59-286">admin</span></span> |
| <span data-ttu-id="8ca59-287">**公用 IP 位址**</span><span class="sxs-lookup"><span data-stu-id="8ca59-287">**Public IP address**</span></span> |<span data-ttu-id="8ca59-288">*Hello VM 相同的名稱*</span><span class="sxs-lookup"><span data-stu-id="8ca59-288">*Same name as hello VM*</span></span> |
| <span data-ttu-id="8ca59-289">**網路安全性群組**</span><span class="sxs-lookup"><span data-stu-id="8ca59-289">**Network security group**</span></span> |<span data-ttu-id="8ca59-290">*Hello VM 相同的名稱*</span><span class="sxs-lookup"><span data-stu-id="8ca59-290">*Same name as hello VM*</span></span> |
| <span data-ttu-id="8ca59-291">**可用性設定組**</span><span class="sxs-lookup"><span data-stu-id="8ca59-291">**Availability set**</span></span> |<span data-ttu-id="8ca59-292">adavailabilityset</span><span class="sxs-lookup"><span data-stu-id="8ca59-292">adavailabilityset</span></span> </br><span data-ttu-id="8ca59-293">**容錯網域**：2</span><span class="sxs-lookup"><span data-stu-id="8ca59-293">**Fault domains**:2</span></span></br><span data-ttu-id="8ca59-294">**更新網域**：2</span><span class="sxs-lookup"><span data-stu-id="8ca59-294">**Update domains**:2</span></span>|
| <span data-ttu-id="8ca59-295">**診斷**</span><span class="sxs-lookup"><span data-stu-id="8ca59-295">**Diagnostics**</span></span> |<span data-ttu-id="8ca59-296">已啟用</span><span class="sxs-lookup"><span data-stu-id="8ca59-296">Enabled</span></span> |
| <span data-ttu-id="8ca59-297">**診斷儲存體帳戶**</span><span class="sxs-lookup"><span data-stu-id="8ca59-297">**Diagnostics storage account**</span></span> |<span data-ttu-id="8ca59-298">*自動建立*</span><span class="sxs-lookup"><span data-stu-id="8ca59-298">*Automatically created*</span></span> |

   >[!IMPORTANT]
   ><span data-ttu-id="8ca59-299">您只可以在建立 VM 時才可將 VM 置於可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="8ca59-299">You can only place a VM in an availability set when you create it.</span></span> <span data-ttu-id="8ca59-300">您無法變更 hello 可用性設定組之後建立的 VM。</span><span class="sxs-lookup"><span data-stu-id="8ca59-300">You can't change hello availability set after a VM is created.</span></span> <span data-ttu-id="8ca59-301">請參閱[管理虛擬機器可用性 hello](../manage-availability.md)。</span><span class="sxs-lookup"><span data-stu-id="8ca59-301">See [Manage hello availability of virtual machines](../manage-availability.md).</span></span>

<span data-ttu-id="8ca59-302">Azure 會建立 hello 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="8ca59-302">Azure creates hello virtual machines.</span></span>

<span data-ttu-id="8ca59-303">建立 hello 虛擬機器之後，設定 hello 網域控制站。</span><span class="sxs-lookup"><span data-stu-id="8ca59-303">After hello virtual machines are created, configure hello domain controller.</span></span>

### <a name="configure-hello-domain-controller"></a><span data-ttu-id="8ca59-304">設定 hello 網域控制站</span><span class="sxs-lookup"><span data-stu-id="8ca59-304">Configure hello domain controller</span></span>
<span data-ttu-id="8ca59-305">在 hello 下列步驟中，設定 hello **ad 主要 dc**為 corp.contoso.com 的網域控制站電腦。</span><span class="sxs-lookup"><span data-stu-id="8ca59-305">In hello following steps, configure hello **ad-primary-dc** machine as a domain controller for corp.contoso.com.</span></span>

1. <span data-ttu-id="8ca59-306">在 hello 入口網站中，開啟 hello **SQL-HA-RG**資源群組和選取 hello **ad 主要 dc**機器。</span><span class="sxs-lookup"><span data-stu-id="8ca59-306">In hello portal, open hello **SQL-HA-RG** resource group and select hello **ad-primary-dc** machine.</span></span> <span data-ttu-id="8ca59-307">在 hello **ad 主要 dc**刀鋒視窗中，按一下**連接**tooopen RDP 檔，以取得遠端桌面的存取。</span><span class="sxs-lookup"><span data-stu-id="8ca59-307">On hello **ad-primary-dc** blade, click **Connect** tooopen an RDP file for remote desktop access.</span></span>

    ![Tooa 虛擬機器連線](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/20-connectrdp.png)
2. <span data-ttu-id="8ca59-309">使用所設定的系統管理員帳戶 (**\DomainAdmin**) 和密碼 (**Contoso!0000**) 來登入。</span><span class="sxs-lookup"><span data-stu-id="8ca59-309">Sign in with your configured administrator account (**\DomainAdmin**) and password (**Contoso!0000**).</span></span>
3. <span data-ttu-id="8ca59-310">根據預設，hello**伺服器管理員**應該顯示儀表板。</span><span class="sxs-lookup"><span data-stu-id="8ca59-310">By default, hello **Server Manager** dashboard should be displayed.</span></span>
4. <span data-ttu-id="8ca59-311">按一下 hello**新增角色及功能**hello 儀表板上的連結。</span><span class="sxs-lookup"><span data-stu-id="8ca59-311">Click hello **Add roles and features** link on hello dashboard.</span></span>

    ![伺服器總管 - 新增角色](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
5. <span data-ttu-id="8ca59-313">選取**下一步**直到 toohello**伺服器角色**> 一節。</span><span class="sxs-lookup"><span data-stu-id="8ca59-313">Select **Next** until you get toohello **Server Roles** section.</span></span>
6. <span data-ttu-id="8ca59-314">選取 hello **Active Directory 網域服務**和**DNS 伺服器**角色。</span><span class="sxs-lookup"><span data-stu-id="8ca59-314">Select hello **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="8ca59-315">出現提示時，請新增這些角色所需的任何其他功能。</span><span class="sxs-lookup"><span data-stu-id="8ca59-315">When you're prompted, add any additional features that are required by these roles.</span></span>

   > [!NOTE]
   > <span data-ttu-id="8ca59-316">Windows 會顯示無靜態 IP 位址的警告。</span><span class="sxs-lookup"><span data-stu-id="8ca59-316">Windows warns you that there is no static IP address.</span></span> <span data-ttu-id="8ca59-317">如果您要測試 hello 組態，按一下**繼續**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-317">If you're testing hello configuration, click **Continue**.</span></span> <span data-ttu-id="8ca59-318">生產案例，請在 hello Azure 入口網站中設定 hello IP 位址 toostatic 或[使用 PowerShell tooset hello 靜態 IP 位址的 hello 網域控制站機器](../../../virtual-network/virtual-networks-reserved-private-ip.md)。</span><span class="sxs-lookup"><span data-stu-id="8ca59-318">For production scenarios, set hello IP address toostatic in hello Azure portal, or [use PowerShell tooset hello static IP address of hello domain controller machine](../../../virtual-network/virtual-networks-reserved-private-ip.md).</span></span>
   >
   >

    ![[新增角色] 對話方塊](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/23-addroles.png)
7. <span data-ttu-id="8ca59-320">按一下**下一步**直到您到達 hello**確認**> 一節。</span><span class="sxs-lookup"><span data-stu-id="8ca59-320">Click **Next** until you reach hello **Confirmation** section.</span></span> <span data-ttu-id="8ca59-321">選取 hello**必要時自動重新啟動 hello 目的地伺服器**核取方塊。</span><span class="sxs-lookup"><span data-stu-id="8ca59-321">Select hello **Restart hello destination server automatically if required** check box.</span></span>
8. <span data-ttu-id="8ca59-322">按一下 [Install] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-322">Click **Install**.</span></span>
9. <span data-ttu-id="8ca59-323">Hello 功能完成安裝，則傳回 toohello 之後**伺服器管理員**儀表板。</span><span class="sxs-lookup"><span data-stu-id="8ca59-323">After hello features finish installing, return toohello **Server Manager** dashboard.</span></span>
10. <span data-ttu-id="8ca59-324">選取新的 hello **AD DS** hello 左側窗格上的選項。</span><span class="sxs-lookup"><span data-stu-id="8ca59-324">Select hello new **AD DS** option on hello left-hand pane.</span></span>
11. <span data-ttu-id="8ca59-325">按一下 hello**詳細**hello 黃色警告列上的連結。</span><span class="sxs-lookup"><span data-stu-id="8ca59-325">Click hello **More** link on hello yellow warning bar.</span></span>

    ![在 hello DNS 伺服器 VM 上的 AD DS 對話方塊](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/24-addsmore.png)
12. <span data-ttu-id="8ca59-327">在 [hello**動作**hello 的資料行**所有伺服器工作詳細資料**] 對話方塊中，按一下**升級此伺服器 tooa 網域控制站**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-327">In hello **Action** column of hello **All Server Task Details** dialog, click **Promote this server tooa domain controller**.</span></span>
13. <span data-ttu-id="8ca59-328">在 hello **Active Directory 網域服務設定精靈**，使用下列值的 hello:</span><span class="sxs-lookup"><span data-stu-id="8ca59-328">In hello **Active Directory Domain Services Configuration Wizard**, use hello following values:</span></span>

    | <span data-ttu-id="8ca59-329">**Page**</span><span class="sxs-lookup"><span data-stu-id="8ca59-329">**Page**</span></span> | <span data-ttu-id="8ca59-330">設定</span><span class="sxs-lookup"><span data-stu-id="8ca59-330">Setting</span></span> |
    | --- | --- |
    | <span data-ttu-id="8ca59-331">**部署組態**</span><span class="sxs-lookup"><span data-stu-id="8ca59-331">**Deployment Configuration**</span></span> |<span data-ttu-id="8ca59-332">**新增樹系**</span><span class="sxs-lookup"><span data-stu-id="8ca59-332">**Add a new forest**</span></span><br/> <span data-ttu-id="8ca59-333">**根網域名稱** = corp.contoso.com</span><span class="sxs-lookup"><span data-stu-id="8ca59-333">**Root domain name** = corp.contoso.com</span></span> |
    | <span data-ttu-id="8ca59-334">**網域控制站選項**</span><span class="sxs-lookup"><span data-stu-id="8ca59-334">**Domain Controller Options**</span></span> |<span data-ttu-id="8ca59-335">**DSRM 密碼** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="8ca59-335">**DSRM Password** = Contoso!0000</span></span><br/><span data-ttu-id="8ca59-336">**確認密碼** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="8ca59-336">**Confirm Password** = Contoso!0000</span></span> |
14. <span data-ttu-id="8ca59-337">按一下**下一步**透過 toogo hello hello 精靈中的其他頁面。</span><span class="sxs-lookup"><span data-stu-id="8ca59-337">Click **Next** toogo through hello other pages in hello wizard.</span></span> <span data-ttu-id="8ca59-338">在 hello**必要條件檢查**頁面上，確認您看到下列訊息的 hello:**順利通過所有先決條件檢查**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-338">On hello **Prerequisites Check** page, verify that you see hello following message: **All prerequisite checks passed successfully**.</span></span> <span data-ttu-id="8ca59-339">您可以檢閱任何適用的警告訊息，但可能 toocontinue hello 安裝。</span><span class="sxs-lookup"><span data-stu-id="8ca59-339">You can review any applicable warning messages, but it's possible toocontinue with hello installation.</span></span>
15. <span data-ttu-id="8ca59-340">按一下 [Install] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-340">Click **Install**.</span></span> <span data-ttu-id="8ca59-341">hello **ad 主要 dc**自動重新啟動虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="8ca59-341">hello **ad-primary-dc** virtual machine automatically reboots.</span></span>

### <a name="note-hello-ip-address-of-hello-primary-domain-controller"></a><span data-ttu-id="8ca59-342">請注意 hello hello 主要網域控制站的 IP 位址</span><span class="sxs-lookup"><span data-stu-id="8ca59-342">Note hello IP address of hello primary domain controller</span></span>

<span data-ttu-id="8ca59-343">使用 hello 主要網域控制站的 DNS。</span><span class="sxs-lookup"><span data-stu-id="8ca59-343">Use hello primary domain controller for DNS.</span></span> <span data-ttu-id="8ca59-344">請注意 hello 主要網域控制站 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="8ca59-344">Note hello primary domain controller IP address.</span></span>

<span data-ttu-id="8ca59-345">其中一種方式 tooget hello 主要網域控制站 IP 位址是透過 hello Azure 入口網站。</span><span class="sxs-lookup"><span data-stu-id="8ca59-345">One way tooget hello primary domain controller IP address is through hello Azure portal.</span></span>

1. <span data-ttu-id="8ca59-346">在 hello Azure 入口網站，開啟 hello 資源群組。</span><span class="sxs-lookup"><span data-stu-id="8ca59-346">On hello Azure portal, open hello resource group.</span></span>

2. <span data-ttu-id="8ca59-347">按一下 hello 主要網域控制站。</span><span class="sxs-lookup"><span data-stu-id="8ca59-347">Click hello primary domain controller.</span></span>

3. <span data-ttu-id="8ca59-348">在 hello 主要網域控制站刀鋒視窗中，按一下 **網路介面**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-348">On hello primary domain controller blade, click **Network interfaces**.</span></span>

![網路介面](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/25-primarydcip.png)

<span data-ttu-id="8ca59-350">請注意此伺服器 hello 私人 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="8ca59-350">Note hello private IP address for this server.</span></span>

### <a name="configure-hello-virtual-network-dns"></a><span data-ttu-id="8ca59-351">設定虛擬網路 DNS hello</span><span class="sxs-lookup"><span data-stu-id="8ca59-351">Configure hello virtual network DNS</span></span>
<span data-ttu-id="8ca59-352">在建立 hello 第一個網域控制站，並啟用 DNS hello 第一部伺服器之後，設定 hello 虛擬網路 toouse 此伺服器的 DNS。</span><span class="sxs-lookup"><span data-stu-id="8ca59-352">After you create hello first domain controller and enable DNS on hello first server, configure hello virtual network toouse this server for DNS.</span></span>

1. <span data-ttu-id="8ca59-353">在 hello Azure 入口網站，按一下 hello 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="8ca59-353">In hello Azure portal, click on hello virtual network.</span></span>

2. <span data-ttu-id="8ca59-354">在 [設定] 下方，按一下 [DNS 伺服器]。</span><span class="sxs-lookup"><span data-stu-id="8ca59-354">Under **Settings**, click **DNS Server**.</span></span>

3. <span data-ttu-id="8ca59-355">按一下**自訂**，然後輸入 hello 主要網域控制站的 hello 私人 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="8ca59-355">Click **Custom**, and type hello private IP address of hello primary domain controller.</span></span>

4. <span data-ttu-id="8ca59-356">按一下 [儲存] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-356">Click **Save**.</span></span>

### <a name="configure-hello-second-domain-controller"></a><span data-ttu-id="8ca59-357">設定 hello 第二個網域控制站</span><span class="sxs-lookup"><span data-stu-id="8ca59-357">Configure hello second domain controller</span></span>
<span data-ttu-id="8ca59-358">Hello 主要網域控制站重新開機之後，您可以設定 hello 第二個網域控制站。</span><span class="sxs-lookup"><span data-stu-id="8ca59-358">After hello primary domain controller reboots, you can configure hello second domain controller.</span></span> <span data-ttu-id="8ca59-359">這個選擇性步驟適用於高可用性。</span><span class="sxs-lookup"><span data-stu-id="8ca59-359">This optional step is for high availability.</span></span> <span data-ttu-id="8ca59-360">請遵循這些步驟 tooconfigure hello 第二個網域控制站：</span><span class="sxs-lookup"><span data-stu-id="8ca59-360">Follow these steps tooconfigure hello second domain controller:</span></span>

1. <span data-ttu-id="8ca59-361">在 hello 入口網站中，開啟 hello **SQL-HA-RG**資源群組和選取 hello **ad 次要 dc**機器。</span><span class="sxs-lookup"><span data-stu-id="8ca59-361">In hello portal, open hello **SQL-HA-RG** resource group and select hello **ad-secondary-dc** machine.</span></span> <span data-ttu-id="8ca59-362">在 hello **ad 次要 dc**刀鋒視窗中，按一下 **連接**tooopen RDP 檔，以取得遠端桌面存取。</span><span class="sxs-lookup"><span data-stu-id="8ca59-362">On hello **ad-secondary-dc** blade, click **Connect** tooopen an RDP file for remote desktop access.</span></span>
2. <span data-ttu-id="8ca59-363">使用設定的管理員帳戶登入 toohello VM (**BUILTIN\DomainAdmin**) 和密碼 (**Contoso ！ 0000**)。</span><span class="sxs-lookup"><span data-stu-id="8ca59-363">Sign in toohello VM by using your configured administrator account (**BUILTIN\DomainAdmin**) and password (**Contoso!0000**).</span></span>
3. <span data-ttu-id="8ca59-364">變更 hello 慣用 DNS 伺服器位址 toohello 位址 hello 網域控制站。</span><span class="sxs-lookup"><span data-stu-id="8ca59-364">Change hello preferred DNS server address toohello address of hello domain controller.</span></span>
4. <span data-ttu-id="8ca59-365">在**網路和共用中心**，按一下 hello 網路介面。</span><span class="sxs-lookup"><span data-stu-id="8ca59-365">In **Network and Sharing Center**, click hello network interface.</span></span>
   <span data-ttu-id="8ca59-366">![網路介面](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/26-networkinterface.png)</span><span class="sxs-lookup"><span data-stu-id="8ca59-366">![Network interface](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/26-networkinterface.png)</span></span>

5. <span data-ttu-id="8ca59-367">按一下 [內容] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-367">Click **Properties**.</span></span>
6. <span data-ttu-id="8ca59-368">選取 [網際網路通訊協定第 4 版 (TCP/IPv4)]，然後按一下 [內容]。</span><span class="sxs-lookup"><span data-stu-id="8ca59-368">Select **Internet Protocol Version 4 (TCP/IPv4)** and click **Properties**.</span></span>
7. <span data-ttu-id="8ca59-369">選取**下列的 DNS 伺服器位址使用 hello**及指定位址中的 hello 主要網域控制站，hello**慣用 DNS 伺服器**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-369">Select **Use hello following DNS server addresses** and specify hello address of hello primary domain controller in **Preferred DNS server**.</span></span>
8. <span data-ttu-id="8ca59-370">按一下**確定**，然後**關閉**toocommit hello 變更。</span><span class="sxs-lookup"><span data-stu-id="8ca59-370">Click **OK**, and then **Close** toocommit hello changes.</span></span> <span data-ttu-id="8ca59-371">現在您已經準備可以 toojoin hello VM 太**corp.contoso.com**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-371">You are now able toojoin hello VM too**corp.contoso.com**.</span></span>

   >[!IMPORTANT]
   ><span data-ttu-id="8ca59-372">如果您遺失 hello 連接 tooyour 遠端桌面變更 hello DNS 設定之後，請移 toohello Azure 入口網站並重新啟動 hello 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="8ca59-372">If you lose hello connection tooyour remote desktop after changing hello DNS setting, go toohello Azure portal and restart hello virtual machine.</span></span>

9. <span data-ttu-id="8ca59-373">從 hello 遠端桌面 toohello 次要網域控制站，開啟**伺服器管理員儀表板**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-373">From hello remote desktop toohello secondary domain controller, open **Server Manager Dashboard**.</span></span>
10. <span data-ttu-id="8ca59-374">按一下 hello**新增角色及功能**hello 儀表板上的連結。</span><span class="sxs-lookup"><span data-stu-id="8ca59-374">Click hello **Add roles and features** link on hello dashboard.</span></span>

    ![伺服器總管 - 新增角色](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
11. <span data-ttu-id="8ca59-376">選取**下一步**直到 toohello**伺服器角色**> 一節。</span><span class="sxs-lookup"><span data-stu-id="8ca59-376">Select **Next** until you get toohello **Server Roles** section.</span></span>
12. <span data-ttu-id="8ca59-377">選取 hello **Active Directory 網域服務**和**DNS 伺服器**角色。</span><span class="sxs-lookup"><span data-stu-id="8ca59-377">Select hello **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="8ca59-378">出現提示時，請新增這些角色所需的任何其他功能。</span><span class="sxs-lookup"><span data-stu-id="8ca59-378">When you're prompted, add any additional features that are required by these roles.</span></span>
13. <span data-ttu-id="8ca59-379">Hello 功能完成安裝，則傳回 toohello 之後**伺服器管理員**儀表板。</span><span class="sxs-lookup"><span data-stu-id="8ca59-379">After hello features finish installing, return toohello **Server Manager** dashboard.</span></span>
14. <span data-ttu-id="8ca59-380">選取新的 hello **AD DS** hello 左側窗格上的選項。</span><span class="sxs-lookup"><span data-stu-id="8ca59-380">Select hello new **AD DS** option on hello left-hand pane.</span></span>
15. <span data-ttu-id="8ca59-381">按一下 hello**詳細**hello 黃色警告列上的連結。</span><span class="sxs-lookup"><span data-stu-id="8ca59-381">Click hello **More** link on hello yellow warning bar.</span></span>
16. <span data-ttu-id="8ca59-382">在 [hello**動作**hello 的資料行**所有伺服器工作詳細資料**] 對話方塊中，按一下**升級此伺服器 tooa 網域控制站**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-382">In hello **Action** column of hello **All Server Task Details** dialog, click **Promote this server tooa domain controller**.</span></span>
17. <span data-ttu-id="8ca59-383">在下**部署組態**，選取**新增網域控制站 tooan 現有網域**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-383">Under **Deployment Configuration**, select **Add a domain controller tooan existing domain**.</span></span>
   <span data-ttu-id="8ca59-384">![部署組態](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/28-deploymentconfig.png)</span><span class="sxs-lookup"><span data-stu-id="8ca59-384">![Deployment configuration](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/28-deploymentconfig.png)</span></span>
18. <span data-ttu-id="8ca59-385">按一下 [選取] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-385">Click **Select**.</span></span>
19. <span data-ttu-id="8ca59-386">連接使用 hello 系統管理員帳戶 (**CORP.CONTOSO.COM\domainadmin**) 和密碼 (**Contoso ！ 0000**)。</span><span class="sxs-lookup"><span data-stu-id="8ca59-386">Connect by using hello administrator account (**CORP.CONTOSO.COM\domainadmin**) and password (**Contoso!0000**).</span></span>
20. <span data-ttu-id="8ca59-387">在**從 hello 樹系中選取網域**，按一下您的網域，然後按一下**確定**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-387">In **Select a domain from hello forest**, click your domain, and then click **OK**.</span></span>
21. <span data-ttu-id="8ca59-388">在**網域控制站選項**、 使用 hello 預設值，以及設定 DSRM 密碼。</span><span class="sxs-lookup"><span data-stu-id="8ca59-388">In **Domain Controller Options**, use hello default values and set a DSRM password.</span></span>

   >[!NOTE]
   ><span data-ttu-id="8ca59-389">hello **DNS 選項**頁面可能會警告您，無法建立此 DNS 伺服器的委派。</span><span class="sxs-lookup"><span data-stu-id="8ca59-389">hello **DNS Options** page might warn you that a delegation for this DNS server can't be created.</span></span> <span data-ttu-id="8ca59-390">您在非生產環境中可以忽略這個警告。</span><span class="sxs-lookup"><span data-stu-id="8ca59-390">You can ignore this warning in non-production environments.</span></span>
22. <span data-ttu-id="8ca59-391">按一下**下一步**直到 hello 對話方塊達到 hello**必要條件**檢查。</span><span class="sxs-lookup"><span data-stu-id="8ca59-391">Click **Next** until hello dialog reaches hello **Prerequisites** check.</span></span> <span data-ttu-id="8ca59-392">然後按一下 [安裝] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-392">Then click **Install**.</span></span>

<span data-ttu-id="8ca59-393">Hello 伺服器完成 hello 組態變更之後，重新啟動伺服器 hello。</span><span class="sxs-lookup"><span data-stu-id="8ca59-393">After hello server finishes hello configuration changes, restart hello server.</span></span>

### <a name="add-hello-private-ip-address-toohello-second-domain-controller-toohello-vpn-dns-server"></a><span data-ttu-id="8ca59-394">新增 hello 私用 IP 位址 toohello 第二個網域控制站 toohello VPN DNS 伺服器</span><span class="sxs-lookup"><span data-stu-id="8ca59-394">Add hello Private IP Address toohello second domain controller toohello VPN DNS Server</span></span>

<span data-ttu-id="8ca59-395">在 hello Azure 入口網站，在 虛擬網路，變更 hello DNS 伺服器 tooinclude hello hello 次要網域控制站 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="8ca59-395">In hello Azure portal, under virtual network, change hello DNS Server tooinclude hello IP address of hello secondary domain controller.</span></span> <span data-ttu-id="8ca59-396">這可讓 hello DNS 服務備援性。</span><span class="sxs-lookup"><span data-stu-id="8ca59-396">This allows hello DNS service redundancy.</span></span>

### <span data-ttu-id="8ca59-397"><a name=DomainAccounts></a>設定 hello 的網域帳戶</span><span class="sxs-lookup"><span data-stu-id="8ca59-397"><a name=DomainAccounts></a> Configure hello domain accounts</span></span>

<span data-ttu-id="8ca59-398">在 hello 下一個步驟中，您可以設定 hello Active Directory 帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-398">In hello next steps, you configure hello Active Directory accounts.</span></span> <span data-ttu-id="8ca59-399">hello 下表顯示 hello 帳戶：</span><span class="sxs-lookup"><span data-stu-id="8ca59-399">hello following table shows hello accounts:</span></span>

| |<span data-ttu-id="8ca59-400">安裝帳戶</span><span class="sxs-lookup"><span data-stu-id="8ca59-400">Installation account</span></span><br/> |<span data-ttu-id="8ca59-401">sqlserver-0</span><span class="sxs-lookup"><span data-stu-id="8ca59-401">sqlserver-0</span></span> <br/><span data-ttu-id="8ca59-402">SQL Server 和 SQL Agent 服務帳戶</span><span class="sxs-lookup"><span data-stu-id="8ca59-402">SQL Server and SQL Agent Service account</span></span> |<span data-ttu-id="8ca59-403">sqlserver-1</span><span class="sxs-lookup"><span data-stu-id="8ca59-403">sqlserver-1</span></span><br/><span data-ttu-id="8ca59-404">SQL Server 和 SQL Agent 服務帳戶</span><span class="sxs-lookup"><span data-stu-id="8ca59-404">SQL Server and SQL Agent Service account</span></span>
| --- | --- | --- | ---
|<span data-ttu-id="8ca59-405">**名字**</span><span class="sxs-lookup"><span data-stu-id="8ca59-405">**First Name**</span></span> |<span data-ttu-id="8ca59-406">Install</span><span class="sxs-lookup"><span data-stu-id="8ca59-406">Install</span></span> |<span data-ttu-id="8ca59-407">SQLSvc1</span><span class="sxs-lookup"><span data-stu-id="8ca59-407">SQLSvc1</span></span> | <span data-ttu-id="8ca59-408">SQLSvc2</span><span class="sxs-lookup"><span data-stu-id="8ca59-408">SQLSvc2</span></span>
|<span data-ttu-id="8ca59-409">**使用者 SamAccountName**</span><span class="sxs-lookup"><span data-stu-id="8ca59-409">**User SamAccountName**</span></span> |<span data-ttu-id="8ca59-410">Install</span><span class="sxs-lookup"><span data-stu-id="8ca59-410">Install</span></span> |<span data-ttu-id="8ca59-411">SQLSvc1</span><span class="sxs-lookup"><span data-stu-id="8ca59-411">SQLSvc1</span></span> | <span data-ttu-id="8ca59-412">SQLSvc2</span><span class="sxs-lookup"><span data-stu-id="8ca59-412">SQLSvc2</span></span>

<span data-ttu-id="8ca59-413">使用下列步驟 toocreate hello 每個帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-413">Use hello following steps toocreate each account.</span></span>

1. <span data-ttu-id="8ca59-414">登入 toohello **ad 主要 dc**機器。</span><span class="sxs-lookup"><span data-stu-id="8ca59-414">Sign in toohello **ad-primary-dc** machine.</span></span>
2. <span data-ttu-id="8ca59-415">在 伺服器管理員 中，選取 工具，然後按一下Active Directory 管理中心。</span><span class="sxs-lookup"><span data-stu-id="8ca59-415">In **Server Manager**, select **Tools**, and then click **Active Directory Administrative Center**.</span></span>   
3. <span data-ttu-id="8ca59-416">選取**corp （本機）** hello 左窗格中。</span><span class="sxs-lookup"><span data-stu-id="8ca59-416">Select **corp (local)** from hello left pane.</span></span>
4. <span data-ttu-id="8ca59-417">在右邊的 hello**工作**窗格中，選取**新增**，然後按一下**使用者**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-417">On hello right **Tasks** pane, select **New**, and then click **User**.</span></span>
   <span data-ttu-id="8ca59-418">![Active Directory 管理中心](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/29-addcnewuser.png)</span><span class="sxs-lookup"><span data-stu-id="8ca59-418">![Active Directory Administrative Center](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/29-addcnewuser.png)</span></span>

   >[!TIP]
   ><span data-ttu-id="8ca59-419">設定每個帳戶的複雜密碼。</span><span class="sxs-lookup"><span data-stu-id="8ca59-419">Set a complex password for each account.</span></span><br/> <span data-ttu-id="8ca59-420">對於非生產環境中，設定 hello 使用者帳戶 toonever 過期。</span><span class="sxs-lookup"><span data-stu-id="8ca59-420">For non-production environments, set hello user account toonever expire.</span></span>

5. <span data-ttu-id="8ca59-421">按一下**確定**toocreate hello 使用者。</span><span class="sxs-lookup"><span data-stu-id="8ca59-421">Click **OK** toocreate hello user.</span></span>
6. <span data-ttu-id="8ca59-422">重複先前 hello 三個帳戶的每個步驟的 hello。</span><span class="sxs-lookup"><span data-stu-id="8ca59-422">Repeat hello preceding steps for each of hello three accounts.</span></span>

### <a name="grant-hello-required-permissions-toohello-installation-account"></a><span data-ttu-id="8ca59-423">Hello 所需的權限授與 toohello 安裝帳戶</span><span class="sxs-lookup"><span data-stu-id="8ca59-423">Grant hello required permissions toohello installation account</span></span>
1. <span data-ttu-id="8ca59-424">在 hello **Active Directory 管理中心**，選取**corp （本機）** hello 左窗格中。</span><span class="sxs-lookup"><span data-stu-id="8ca59-424">In hello **Active Directory Administrative Center**, select **corp (local)** in hello left pane.</span></span> <span data-ttu-id="8ca59-425">接著在右手邊的 hello**工作**] 窗格中，按一下 [**屬性**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-425">Then in hello right-hand **Tasks** pane, click **Properties**.</span></span>

    ![公司使用者內容](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/31-addcproperties.png)
2. <span data-ttu-id="8ca59-427">選取**延伸**，然後按一下hello**進階**按鈕 hello**安全性** 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="8ca59-427">Select **Extensions**, and then click hello **Advanced** button on hello **Security** tab.</span></span>
3. <span data-ttu-id="8ca59-428">在 hello **corp 的進階安全性設定** 對話方塊中，按一下 **新增**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-428">In hello **Advanced Security Settings for corp** dialog, click **Add**.</span></span>
4. <span data-ttu-id="8ca59-429">按一下 選取主體、搜尋 **CORP\Install**，然後按一下確定。</span><span class="sxs-lookup"><span data-stu-id="8ca59-429">Click **Select a principal**, search for **CORP\Install**, and then click **OK**.</span></span>
5. <span data-ttu-id="8ca59-430">選取 hello**讀取全部內容**核取方塊。</span><span class="sxs-lookup"><span data-stu-id="8ca59-430">Select hello **Read all properties** check box.</span></span>

6. <span data-ttu-id="8ca59-431">選取 hello**建立電腦物件**核取方塊。</span><span class="sxs-lookup"><span data-stu-id="8ca59-431">Select hello **Create Computer objects** check box.</span></span>

     ![公司使用者權限](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/33-addpermissions.png)
7. <span data-ttu-id="8ca59-433">按一下 [確定]，再按一下 [確定]。</span><span class="sxs-lookup"><span data-stu-id="8ca59-433">Click **OK**, and then click **OK** again.</span></span> <span data-ttu-id="8ca59-434">關閉 hello **corp**屬性 視窗。</span><span class="sxs-lookup"><span data-stu-id="8ca59-434">Close hello **corp** properties window.</span></span>

<span data-ttu-id="8ca59-435">現在您已完成設定 Active Directory 與 hello 使用者物件，建立兩個 SQL Server Vm 以及將見證伺服器 VM。</span><span class="sxs-lookup"><span data-stu-id="8ca59-435">Now that you've finished configuring Active Directory and hello user objects, create two SQL Server VMs and a witness server VM.</span></span> <span data-ttu-id="8ca59-436">然後聯結所有的三個 toohello 網域。</span><span class="sxs-lookup"><span data-stu-id="8ca59-436">Then join all three toohello domain.</span></span>

## <a name="create-sql-server-vms"></a><span data-ttu-id="8ca59-437">建立 SQL Server VM</span><span class="sxs-lookup"><span data-stu-id="8ca59-437">Create SQL Server VMs</span></span>

<span data-ttu-id="8ca59-438">建立第三部額外的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="8ca59-438">Create three additional virtual machines.</span></span> <span data-ttu-id="8ca59-439">hello 解決方案需要兩部虛擬機器與 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="8ca59-439">hello solution requires two virtual machines with SQL Server instances.</span></span> <span data-ttu-id="8ca59-440">第三虛擬機器的功能為見證。</span><span class="sxs-lookup"><span data-stu-id="8ca59-440">A third virtual machine will function as a witness.</span></span> <span data-ttu-id="8ca59-441">Windows Server 2016 會使用[雲端見證](http://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness)，但為了與舊版作業系統一致，本文件使用虛擬機器作為見證。</span><span class="sxs-lookup"><span data-stu-id="8ca59-441">Windows Server 2016 can use a [cloud witness](http://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness), however for consistency with previous operating systems this document uses a virtual machine for a witness.</span></span>  

<span data-ttu-id="8ca59-442">在繼續之前，請考慮下列 deisign 決策的 hello。</span><span class="sxs-lookup"><span data-stu-id="8ca59-442">Before you proceed consider hello following deisign decisions.</span></span>

* <span data-ttu-id="8ca59-443">**儲存體 - Azure 受控磁碟**</span><span class="sxs-lookup"><span data-stu-id="8ca59-443">**Storage - Azure Managed Disks**</span></span>

   <span data-ttu-id="8ca59-444">Hello 虛擬機器存放裝置，使用 Azure 受管理的磁碟。</span><span class="sxs-lookup"><span data-stu-id="8ca59-444">For hello virtual machine storage, use Azure Managed Disks.</span></span> <span data-ttu-id="8ca59-445">Microsoft 為 SQL Server 虛擬機器建議受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="8ca59-445">Microsoft recommends Managed Disks for SQL Server virtual machines.</span></span> <span data-ttu-id="8ca59-446">管理磁碟 hello 幕後的控制代碼儲存體。</span><span class="sxs-lookup"><span data-stu-id="8ca59-446">Managed Disks handles storage behind hello scenes.</span></span> <span data-ttu-id="8ca59-447">此外，當與受管理磁碟的虛擬機器都處於 hello 相同可用性設定組，Azure 會發佈 hello 存放裝置資源 tooprovide 適當備援。</span><span class="sxs-lookup"><span data-stu-id="8ca59-447">In addition, when virtual machines with Managed Disks are in hello same availability set, Azure distributes hello storage resources tooprovide appropriate redundancy.</span></span> <span data-ttu-id="8ca59-448">如需其他資訊，請參閱 [Azure 受控磁碟概觀 (英文)](../managed-disks-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="8ca59-448">For additional information, see [Azure Managed Disks Overview](../managed-disks-overview.md).</span></span> <span data-ttu-id="8ca59-449">如需可用性設定組中受控磁碟的具體資訊，請參閱[在可用性設定組中使用 VM 的受控磁碟 (英文)](../manage-availability.md#use-managed-disks-for-vms-in-an-availability-set)。</span><span class="sxs-lookup"><span data-stu-id="8ca59-449">For specifics about managed disks in an availability set, see [Use Managed Disks for VMs in an availability set](../manage-availability.md#use-managed-disks-for-vms-in-an-availability-set).</span></span>

* <span data-ttu-id="8ca59-450">**網路 - 生產環境中的私人 IP 位址**</span><span class="sxs-lookup"><span data-stu-id="8ca59-450">**Network - Private IP addresses in production**</span></span>

   <span data-ttu-id="8ca59-451">Hello 虛擬機器，本教學課程會使用公用 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="8ca59-451">For hello virtual machines, this tutorial uses public IP addresses.</span></span> <span data-ttu-id="8ca59-452">這可讓遠端連線，直接 toohello 虛擬機器 hello 網際網路-它容易設定步驟。</span><span class="sxs-lookup"><span data-stu-id="8ca59-452">This enables remote connection directly toohello virtual machine over hello internet - it makes configuration steps easier.</span></span> <span data-ttu-id="8ca59-453">在實際執行環境中，Microsoft 建議僅私人 IP 位址順序 tooreduce hello 弱點使用量 hello SQL Server 執行個體 VM 資源。</span><span class="sxs-lookup"><span data-stu-id="8ca59-453">In production environments, Microsoft recommends only private IP addresses in order tooreduce hello vulnerability footprint of hello SQL Server instance VM resource.</span></span>

### <a name="create-and-configure-hello-sql-server-vms"></a><span data-ttu-id="8ca59-454">建立及設定 hello SQL Server Vm</span><span class="sxs-lookup"><span data-stu-id="8ca59-454">Create and configure hello SQL Server VMs</span></span>
<span data-ttu-id="8ca59-455">接下來，建立三個 VM，亦即兩個 SQL Server VM 和一個適用於其他叢集節點的 VM。</span><span class="sxs-lookup"><span data-stu-id="8ca59-455">Next, create three VMs--two SQL Server VMs and a VM for an additional cluster node.</span></span> <span data-ttu-id="8ca59-456">toocreate 每個 hello Vm，請返回 toohello **SQL-HA-RG**資源群組中，按一下 **新增**、 hello 適當的主機庫項目的搜尋中，按一下**虛擬機器**，然後按一下**從組件庫**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-456">toocreate each of hello VMs, go back toohello **SQL-HA-RG** resource group, click **Add**, search for hello appropriate gallery item, click **Virtual Machine**, and then click **From Gallery**.</span></span> <span data-ttu-id="8ca59-457">在下列資料表 toohelp 建立 hello Vm hello 使用 hello 資訊：</span><span class="sxs-lookup"><span data-stu-id="8ca59-457">Use hello information in hello following table toohelp you create hello VMs:</span></span>


| <span data-ttu-id="8ca59-458">Page</span><span class="sxs-lookup"><span data-stu-id="8ca59-458">Page</span></span> | <span data-ttu-id="8ca59-459">VM1</span><span class="sxs-lookup"><span data-stu-id="8ca59-459">VM1</span></span> | <span data-ttu-id="8ca59-460">VM2</span><span class="sxs-lookup"><span data-stu-id="8ca59-460">VM2</span></span> | <span data-ttu-id="8ca59-461">VM3</span><span class="sxs-lookup"><span data-stu-id="8ca59-461">VM3</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="8ca59-462">選取 hello 適當的主機庫項目</span><span class="sxs-lookup"><span data-stu-id="8ca59-462">Select hello appropriate gallery item</span></span> |<span data-ttu-id="8ca59-463">**Windows Server 2016 Datacenter**</span><span class="sxs-lookup"><span data-stu-id="8ca59-463">**Windows Server 2016 Datacenter**</span></span> |<span data-ttu-id="8ca59-464">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span><span class="sxs-lookup"><span data-stu-id="8ca59-464">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span></span> |<span data-ttu-id="8ca59-465">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span><span class="sxs-lookup"><span data-stu-id="8ca59-465">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span></span> |
| <span data-ttu-id="8ca59-466">虛擬機器組態 **基本**</span><span class="sxs-lookup"><span data-stu-id="8ca59-466">Virtual machine configuration **Basics**</span></span> |<span data-ttu-id="8ca59-467">**名稱** = cluster-fsw</span><span class="sxs-lookup"><span data-stu-id="8ca59-467">**Name** = cluster-fsw</span></span><br/><span data-ttu-id="8ca59-468">**使用者名稱** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="8ca59-468">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="8ca59-469">**密碼** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="8ca59-469">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="8ca59-470">**訂用帳戶** = 您的訂用帳戶</span><span class="sxs-lookup"><span data-stu-id="8ca59-470">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="8ca59-471">**資源群組** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="8ca59-471">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="8ca59-472">**位置** = 您的 Azure 位置</span><span class="sxs-lookup"><span data-stu-id="8ca59-472">**Location** = Your azure location</span></span> |<span data-ttu-id="8ca59-473">**名稱** = sqlserver-0</span><span class="sxs-lookup"><span data-stu-id="8ca59-473">**Name** = sqlserver-0</span></span><br/><span data-ttu-id="8ca59-474">**使用者名稱** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="8ca59-474">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="8ca59-475">**密碼** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="8ca59-475">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="8ca59-476">**訂用帳戶** = 您的訂用帳戶</span><span class="sxs-lookup"><span data-stu-id="8ca59-476">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="8ca59-477">**資源群組** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="8ca59-477">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="8ca59-478">**位置** = 您的 Azure 位置</span><span class="sxs-lookup"><span data-stu-id="8ca59-478">**Location** = Your azure location</span></span> |<span data-ttu-id="8ca59-479">**名稱** = sqlserver-1</span><span class="sxs-lookup"><span data-stu-id="8ca59-479">**Name** = sqlserver-1</span></span><br/><span data-ttu-id="8ca59-480">**使用者名稱** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="8ca59-480">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="8ca59-481">**密碼** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="8ca59-481">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="8ca59-482">**訂用帳戶** = 您的訂用帳戶</span><span class="sxs-lookup"><span data-stu-id="8ca59-482">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="8ca59-483">**資源群組** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="8ca59-483">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="8ca59-484">**位置** = 您的 Azure 位置</span><span class="sxs-lookup"><span data-stu-id="8ca59-484">**Location** = Your azure location</span></span> |
| <span data-ttu-id="8ca59-485">虛擬機器組態 **大小**</span><span class="sxs-lookup"><span data-stu-id="8ca59-485">Virtual machine configuration **Size**</span></span> |<span data-ttu-id="8ca59-486">**大小** = DS1\_V2 (1 個核心，3.5 GB)</span><span class="sxs-lookup"><span data-stu-id="8ca59-486">**SIZE** = DS1\_V2 (1 core, 3.5 GB)</span></span> |<span data-ttu-id="8ca59-487">**大小** = DS2\_V2 (2 個核心，7 GB)</span><span class="sxs-lookup"><span data-stu-id="8ca59-487">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span></span></br><span data-ttu-id="8ca59-488">hello 大小必須支援 SSD 儲存裝置 （Premium 磁碟支援。</span><span class="sxs-lookup"><span data-stu-id="8ca59-488">hello size must support SSD storage (Premium disk support.</span></span> <span data-ttu-id="8ca59-489">))</span><span class="sxs-lookup"><span data-stu-id="8ca59-489">))</span></span> |<span data-ttu-id="8ca59-490">**大小** = DS2\_V2 (2 個核心，7 GB)</span><span class="sxs-lookup"><span data-stu-id="8ca59-490">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span></span> |
| <span data-ttu-id="8ca59-491">虛擬機器組態 **設定**</span><span class="sxs-lookup"><span data-stu-id="8ca59-491">Virtual machine configuration **Settings**</span></span> |<span data-ttu-id="8ca59-492">**儲存體**：使用受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="8ca59-492">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="8ca59-493">**虛擬網路** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="8ca59-493">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="8ca59-494">**子網路** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="8ca59-494">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="8ca59-495">**公用 IP 位址**自動產生。</span><span class="sxs-lookup"><span data-stu-id="8ca59-495">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="8ca59-496">**網路安全性群組** = 無</span><span class="sxs-lookup"><span data-stu-id="8ca59-496">**Network security group** = None</span></span><br/><span data-ttu-id="8ca59-497">**監視診斷** = 啟用</span><span class="sxs-lookup"><span data-stu-id="8ca59-497">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="8ca59-498">**診斷儲存體帳戶** = 使用自動產生的儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="8ca59-498">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="8ca59-499">**可用性設定組** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="8ca59-499">**Availability set** = sqlAvailabilitySet</span></span><br/> |<span data-ttu-id="8ca59-500">**儲存體**：使用受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="8ca59-500">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="8ca59-501">**虛擬網路** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="8ca59-501">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="8ca59-502">**子網路** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="8ca59-502">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="8ca59-503">**公用 IP 位址**自動產生。</span><span class="sxs-lookup"><span data-stu-id="8ca59-503">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="8ca59-504">**網路安全性群組** = 無</span><span class="sxs-lookup"><span data-stu-id="8ca59-504">**Network security group** = None</span></span><br/><span data-ttu-id="8ca59-505">**監視診斷** = 啟用</span><span class="sxs-lookup"><span data-stu-id="8ca59-505">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="8ca59-506">**診斷儲存體帳戶** = 使用自動產生的儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="8ca59-506">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="8ca59-507">**可用性設定組** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="8ca59-507">**Availability set** = sqlAvailabilitySet</span></span><br/> |<span data-ttu-id="8ca59-508">**儲存體**：使用受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="8ca59-508">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="8ca59-509">**虛擬網路** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="8ca59-509">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="8ca59-510">**子網路** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="8ca59-510">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="8ca59-511">**公用 IP 位址**自動產生。</span><span class="sxs-lookup"><span data-stu-id="8ca59-511">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="8ca59-512">**網路安全性群組** = 無</span><span class="sxs-lookup"><span data-stu-id="8ca59-512">**Network security group** = None</span></span><br/><span data-ttu-id="8ca59-513">**監視診斷** = 啟用</span><span class="sxs-lookup"><span data-stu-id="8ca59-513">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="8ca59-514">**診斷儲存體帳戶** = 使用自動產生的儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="8ca59-514">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="8ca59-515">**可用性設定組** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="8ca59-515">**Availability set** = sqlAvailabilitySet</span></span><br/> |
| <span data-ttu-id="8ca59-516">虛擬機器組態 **SQL Server 設定**</span><span class="sxs-lookup"><span data-stu-id="8ca59-516">Virtual machine configuration **SQL Server settings**</span></span> |<span data-ttu-id="8ca59-517">不適用</span><span class="sxs-lookup"><span data-stu-id="8ca59-517">Not applicable</span></span> |<span data-ttu-id="8ca59-518">**SQL 連線** = 私用 (在虛擬網路內)</span><span class="sxs-lookup"><span data-stu-id="8ca59-518">**SQL connectivity** = Private (within Virtual Network)</span></span><br/><span data-ttu-id="8ca59-519">**連接埠** = 1433</span><span class="sxs-lookup"><span data-stu-id="8ca59-519">**Port** = 1433</span></span><br/><span data-ttu-id="8ca59-520">**SQL 驗證** = 停用</span><span class="sxs-lookup"><span data-stu-id="8ca59-520">**SQL Authentication** = Disable</span></span><br/><span data-ttu-id="8ca59-521">**儲存體組態** = 一般</span><span class="sxs-lookup"><span data-stu-id="8ca59-521">**Storage configuration** = General</span></span><br/><span data-ttu-id="8ca59-522">**自動修補** = 星期日 2:00</span><span class="sxs-lookup"><span data-stu-id="8ca59-522">**Automated patching** = Sunday at 2:00</span></span><br/><span data-ttu-id="8ca59-523">**自動備份** = 停用</span><span class="sxs-lookup"><span data-stu-id="8ca59-523">**Automated backup** = Disabled</span></span></br><span data-ttu-id="8ca59-524">**Azure 金鑰保存庫整合** = 已停用</span><span class="sxs-lookup"><span data-stu-id="8ca59-524">**Azure Key Vault integration** = Disabled</span></span> |<span data-ttu-id="8ca59-525">**SQL 連線** = 私用 (在虛擬網路內)</span><span class="sxs-lookup"><span data-stu-id="8ca59-525">**SQL connectivity** = Private (within Virtual Network)</span></span><br/><span data-ttu-id="8ca59-526">**連接埠** = 1433</span><span class="sxs-lookup"><span data-stu-id="8ca59-526">**Port** = 1433</span></span><br/><span data-ttu-id="8ca59-527">**SQL 驗證** = 停用</span><span class="sxs-lookup"><span data-stu-id="8ca59-527">**SQL Authentication** = Disable</span></span><br/><span data-ttu-id="8ca59-528">**儲存體組態** = 一般</span><span class="sxs-lookup"><span data-stu-id="8ca59-528">**Storage configuration** = General</span></span><br/><span data-ttu-id="8ca59-529">**自動修補** = 星期日 2:00</span><span class="sxs-lookup"><span data-stu-id="8ca59-529">**Automated patching** = Sunday at 2:00</span></span><br/><span data-ttu-id="8ca59-530">**自動備份** = 停用</span><span class="sxs-lookup"><span data-stu-id="8ca59-530">**Automated backup** = Disabled</span></span></br><span data-ttu-id="8ca59-531">**Azure 金鑰保存庫整合** = 已停用</span><span class="sxs-lookup"><span data-stu-id="8ca59-531">**Azure Key Vault integration** = Disabled</span></span> |

<br/>

> [!NOTE]
> <span data-ttu-id="8ca59-532">hello 機器大小，我們建議是為了在 Azure Vm 中測試可用性群組。</span><span class="sxs-lookup"><span data-stu-id="8ca59-532">hello machine sizes suggested here are meant for testing availability groups in Azure VMs.</span></span> <span data-ttu-id="8ca59-533">Hello 實際執行工作負載的最佳效能，請參閱 SQL Server 機器大小和組態中的 hello 建議[效能最佳做法適用於 SQL Server 在 Azure 虛擬機器](virtual-machines-windows-sql-performance.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)。</span><span class="sxs-lookup"><span data-stu-id="8ca59-533">For hello best performance on production workloads, see hello recommendations for SQL Server machine sizes and configuration in [Performance best practices for SQL Server in Azure virtual machines](virtual-machines-windows-sql-performance.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>
>
>

<span data-ttu-id="8ca59-534">Hello 三個 Vm 完整佈建之後，您需要 toojoin 它們 toohello **corp.contoso.com**網域和授與 CORP\Install 管理權限 toohello 機器。</span><span class="sxs-lookup"><span data-stu-id="8ca59-534">After hello three VMs are fully provisioned, you need toojoin them toohello **corp.contoso.com** domain and grant CORP\Install administrative rights toohello machines.</span></span>

### <span data-ttu-id="8ca59-535"><a name="joinDomain"></a>加入 hello 伺服器 toohello 網域</span><span class="sxs-lookup"><span data-stu-id="8ca59-535"><a name="joinDomain"></a>Join hello servers toohello domain</span></span>

<span data-ttu-id="8ca59-536">您現在可以 toojoin 太 hello Vm**corp.contoso.com**。請勿 hello 下列 hello SQL Server Vm 和 hello 檔案共用見證伺服器：</span><span class="sxs-lookup"><span data-stu-id="8ca59-536">You're now able toojoin hello VMs too**corp.contoso.com**. Do hello following for both hello SQL Server VMs and hello file share witness server:</span></span>

1. <span data-ttu-id="8ca59-537">從遠端連線的虛擬機器 toohello **BUILTIN\DomainAdmin**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-537">Remotely connect toohello virtual machine with **BUILTIN\DomainAdmin**.</span></span>
2. <span data-ttu-id="8ca59-538">在 [伺服器管理員] 中，按一下 [本機伺服器]。</span><span class="sxs-lookup"><span data-stu-id="8ca59-538">In **Server Manager**, click **Local Server**.</span></span>
3. <span data-ttu-id="8ca59-539">按一下 hello **WORKGROUP**連結。</span><span class="sxs-lookup"><span data-stu-id="8ca59-539">Click hello **WORKGROUP** link.</span></span>
4. <span data-ttu-id="8ca59-540">在 hello**電腦名稱**區段中，按一下**變更**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-540">In hello **Computer Name** section, click **Change**.</span></span>
5. <span data-ttu-id="8ca59-541">選取 hello**網域**核取方塊，然後輸入**corp.contoso.com** hello 文字方塊中。</span><span class="sxs-lookup"><span data-stu-id="8ca59-541">Select hello **Domain** check box and type **corp.contoso.com** in hello text box.</span></span> <span data-ttu-id="8ca59-542">按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-542">Click **OK**.</span></span>
6. <span data-ttu-id="8ca59-543">在 hello **Windows 安全性**快顯對話方塊中，指定 hello hello 預設網域系統管理員帳戶的認證 (**CORP\DomainAdmin**) 和 hello 密碼 (**Contoso ！ 0000**).</span><span class="sxs-lookup"><span data-stu-id="8ca59-543">In hello **Windows Security** popup dialog, specify hello credentials for hello default domain administrator account (**CORP\DomainAdmin**) and hello password (**Contoso!0000**).</span></span>
7. <span data-ttu-id="8ca59-544">當您看見 hello 「  褖畫惎 toohello corp.contoso.com 網域 」 訊息時，按一下**確定**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-544">When you see hello "Welcome toohello corp.contoso.com domain" message, click **OK**.</span></span>
8. <span data-ttu-id="8ca59-545">按一下**關閉**，然後按一下**立即重新啟動**hello 快顯對話方塊中。</span><span class="sxs-lookup"><span data-stu-id="8ca59-545">Click **Close**, and then click **Restart Now** in hello popup dialog.</span></span>

### <a name="add-hello-corpinstall-user-as-an-administrator-on-each-cluster-vm"></a><span data-ttu-id="8ca59-546">將 hello Corp\Install 使用者新增為每個叢集 VM 的系統管理員</span><span class="sxs-lookup"><span data-stu-id="8ca59-546">Add hello Corp\Install user as an administrator on each cluster VM</span></span>

<span data-ttu-id="8ca59-547">Hello 網域的成員身分的每個虛擬機器重新啟動之後，新增**CORP\Install** hello 本機 administrators 群組的成員身分。</span><span class="sxs-lookup"><span data-stu-id="8ca59-547">After each virtual machine restarts as a member of hello domain, add **CORP\Install** as a member of hello local administrators group.</span></span>

1. <span data-ttu-id="8ca59-548">等候 hello VM 重新啟動，然後太啟動 hello RDP 檔案中的 hello 主要網域控制站 toosign 再次從**sqlserver 0**使用 hello **CORP\DomainAdmin**帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-548">Wait until hello VM is restarted, then launch hello RDP file again from hello primary domain controller toosign in too**sqlserver-0** by using hello **CORP\DomainAdmin** account.</span></span>
   >[!TIP]
   ><span data-ttu-id="8ca59-549">請確定登入 hello 網域系統管理員帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-549">Make sure that you sign in with hello domain administrator account.</span></span> <span data-ttu-id="8ca59-550">在 hello 先前步驟中，您已使用 hello 內建在系統管理員帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-550">In hello previous steps, you were using hello BUILT IN administrator account.</span></span> <span data-ttu-id="8ca59-551">現在已 hello 伺服器 hello 網域中，使用 hello 網域帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-551">Now that hello server is in hello domain, use hello domain account.</span></span> <span data-ttu-id="8ca59-552">在您的 RDP 工作階段中，指定 *DOMAIN*\\*username*。</span><span class="sxs-lookup"><span data-stu-id="8ca59-552">In your RDP session, specify *DOMAIN*\\*username*.</span></span>

2. <span data-ttu-id="8ca59-553">在 伺服器管理員 中選取 工具，然後按一下電腦管理。</span><span class="sxs-lookup"><span data-stu-id="8ca59-553">In **Server Manager**, select **Tools**, and then click **Computer Management**.</span></span>
3. <span data-ttu-id="8ca59-554">在 hello**電腦管理**視窗中，展開**本機使用者和群組**，然後選取**群組**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-554">In hello **Computer Management** window, expand **Local Users and Groups**, and then select **Groups**.</span></span>
4. <span data-ttu-id="8ca59-555">按兩下 hello**管理員**群組。</span><span class="sxs-lookup"><span data-stu-id="8ca59-555">Double-click hello **Administrators** group.</span></span>
5. <span data-ttu-id="8ca59-556">在 hello**系統管理員屬性** 對話方塊中，按一下 hello**新增** 按鈕。</span><span class="sxs-lookup"><span data-stu-id="8ca59-556">In hello **Administrators Properties** dialog, click hello **Add** button.</span></span>
6. <span data-ttu-id="8ca59-557">輸入 hello 使用者**CORP\Install**，然後按一下**確定**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-557">Enter hello user **CORP\Install**, and then click **OK**.</span></span>
7. <span data-ttu-id="8ca59-558">按一下**確定**tooclose hello**系統管理員內容**對話方塊。</span><span class="sxs-lookup"><span data-stu-id="8ca59-558">Click **OK** tooclose hello **Administrator Properties** dialog.</span></span>
8. <span data-ttu-id="8ca59-559">對於重複 hello 上一個步驟**sqlserver 1**和**叢集 fsw**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-559">Repeat hello previous steps on **sqlserver-1** and **cluster-fsw**.</span></span>

### <span data-ttu-id="8ca59-560"><a name="setServiceAccount"></a>設定 hello SQL Server 服務帳戶</span><span class="sxs-lookup"><span data-stu-id="8ca59-560"><a name="setServiceAccount"></a>Set hello SQL Server service accounts</span></span>

<span data-ttu-id="8ca59-561">在每個 SQL Server VM，設定 hello SQL Server 服務帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-561">On each SQL Server VM, set hello SQL Server service account.</span></span> <span data-ttu-id="8ca59-562">使用 hello 帳戶時建立您[hello 網域帳戶設定](#DomainAccounts)。</span><span class="sxs-lookup"><span data-stu-id="8ca59-562">Use hello accounts that you created when you [configured hello domain accounts](#DomainAccounts).</span></span>

1. <span data-ttu-id="8ca59-563">啟動 **SQL Server 組態管理員**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-563">Open **SQL Server Configuration Manager**.</span></span>
2. <span data-ttu-id="8ca59-564">Hello SQL Server 服務，以滑鼠右鍵按一下，然後按一下**屬性**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-564">Right-click hello SQL Server service, and then click **Properties**.</span></span>
3. <span data-ttu-id="8ca59-565">設定 hello 帳戶和密碼。</span><span class="sxs-lookup"><span data-stu-id="8ca59-565">Set hello account and password.</span></span>
4. <span data-ttu-id="8ca59-566">上重複這些步驟 hello 其他 SQL Server VM。</span><span class="sxs-lookup"><span data-stu-id="8ca59-566">Repeat these steps on hello other SQL Server VM.</span></span>  

<span data-ttu-id="8ca59-567">SQL Server 可用性群組，每個 SQL Server VM 會需要 toorun 以網域帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-567">For SQL Server availability groups, each SQL Server VM needs toorun as a domain account.</span></span>

### <a name="create-a-sign-in-on-each-sql-server-vm-for-hello-installation-account"></a><span data-ttu-id="8ca59-568">在 hello 安裝帳戶的每個 SQL Server VM 上建立登入</span><span class="sxs-lookup"><span data-stu-id="8ca59-568">Create a sign-in on each SQL Server VM for hello installation account</span></span>

<span data-ttu-id="8ca59-569">使用 hello 安裝帳戶 (CORP\install) tooconfigure hello 可用性群組。</span><span class="sxs-lookup"><span data-stu-id="8ca59-569">Use hello installation account (CORP\install) tooconfigure hello availability group.</span></span> <span data-ttu-id="8ca59-570">此帳戶必須隸屬 hello toobe **sysadmin**每個 SQL Server VM 上的固定的伺服器角色。</span><span class="sxs-lookup"><span data-stu-id="8ca59-570">This account needs toobe a member of hello **sysadmin** fixed server role on each SQL Server VM.</span></span> <span data-ttu-id="8ca59-571">hello 下列步驟建立的登入 hello 安裝帳戶：</span><span class="sxs-lookup"><span data-stu-id="8ca59-571">hello following steps create a sign-in for hello installation account:</span></span>

1. <span data-ttu-id="8ca59-572">透過 hello 遠端桌面通訊協定 (RDP) 連線 toohello 伺服器，使用 hello  *\<MachineName\>\DomainAdmin*帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-572">Connect toohello server through hello Remote Desktop Protocol (RDP) by using hello *\<MachineName\>\DomainAdmin* account.</span></span>

1. <span data-ttu-id="8ca59-573">開啟 SQL Server Management Studio 並連接 toohello 本機 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="8ca59-573">Open SQL Server Management Studio and connect toohello local instance of SQL Server.</span></span>

1. <span data-ttu-id="8ca59-574">在 [物件總管] **中**，按一下 [安全性]。</span><span class="sxs-lookup"><span data-stu-id="8ca59-574">In **Object Explorer**, click **Security**.</span></span>

1. <span data-ttu-id="8ca59-575">以滑鼠右鍵按一下 [登入]。</span><span class="sxs-lookup"><span data-stu-id="8ca59-575">Right-click **Logins**.</span></span> <span data-ttu-id="8ca59-576">按一下 [新增登入]。</span><span class="sxs-lookup"><span data-stu-id="8ca59-576">Click **New Login**.</span></span>

1. <span data-ttu-id="8ca59-577">在 [登入 - 新增] 中，按一下 [搜尋]。</span><span class="sxs-lookup"><span data-stu-id="8ca59-577">In **Login - New**, click **Search**.</span></span>

1. <span data-ttu-id="8ca59-578">按一下 [位置]。</span><span class="sxs-lookup"><span data-stu-id="8ca59-578">Click **Locations**.</span></span>

1. <span data-ttu-id="8ca59-579">輸入 hello 網域系統管理員的 網路認證。</span><span class="sxs-lookup"><span data-stu-id="8ca59-579">Enter hello domain administrator network credentials.</span></span>

1. <span data-ttu-id="8ca59-580">使用 hello 安裝帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-580">Use hello installation account.</span></span>

1. <span data-ttu-id="8ca59-581">設定登入 toobe hello 的 hello 成員**sysadmin**固定的伺服器角色。</span><span class="sxs-lookup"><span data-stu-id="8ca59-581">Set hello sign-in toobe a member of hello **sysadmin** fixed server role.</span></span>

1. <span data-ttu-id="8ca59-582">按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-582">Click **OK**.</span></span>

<span data-ttu-id="8ca59-583">重複上述步驟 hello 其他 SQL Server VM 的 hello。</span><span class="sxs-lookup"><span data-stu-id="8ca59-583">Repeat hello preceding steps on hello other SQL Server VM.</span></span>

## <a name="add-failover-clustering-features-tooboth-sql-server-vms"></a><span data-ttu-id="8ca59-584">新增容錯移轉叢集功能 tooboth SQL Server Vm</span><span class="sxs-lookup"><span data-stu-id="8ca59-584">Add Failover Clustering features tooboth SQL Server VMs</span></span>

<span data-ttu-id="8ca59-585">請勿 hello tooadd 容錯移轉叢集功能，這兩個 SQL Server Vm 上：</span><span class="sxs-lookup"><span data-stu-id="8ca59-585">tooadd Failover Clustering features, do hello following on both SQL Server VMs:</span></span>

1. <span data-ttu-id="8ca59-586">透過 hello 遠端桌面通訊協定 (RDP) 連線 toohello SQL Server 虛擬機器，使用 hello *CORP\install*帳戶。</span><span class="sxs-lookup"><span data-stu-id="8ca59-586">Connect toohello SQL Server virtual machine through hello Remote Desktop Protocol (RDP) by using hello *CORP\install* account.</span></span> <span data-ttu-id="8ca59-587">開啟 [伺服器管理員儀表板] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-587">Open **Server Manager Dashboard**.</span></span>
2. <span data-ttu-id="8ca59-588">按一下 hello**新增角色及功能**hello 儀表板上的連結。</span><span class="sxs-lookup"><span data-stu-id="8ca59-588">Click hello **Add roles and features** link on hello dashboard.</span></span>

    ![伺服器總管 - 新增角色](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
3. <span data-ttu-id="8ca59-590">選取**下一步**直到 toohello**伺服器功能**> 一節。</span><span class="sxs-lookup"><span data-stu-id="8ca59-590">Select **Next** until you get toohello **Server Features** section.</span></span>
4. <span data-ttu-id="8ca59-591">在 [功能] 中，選取 [容錯移轉叢集]。</span><span class="sxs-lookup"><span data-stu-id="8ca59-591">In **Features**, select **Failover Clustering**.</span></span>
5. <span data-ttu-id="8ca59-592">新增任何其他必要的功能。</span><span class="sxs-lookup"><span data-stu-id="8ca59-592">Add any additional required features.</span></span>
6. <span data-ttu-id="8ca59-593">按一下**安裝**tooadd hello 功能。</span><span class="sxs-lookup"><span data-stu-id="8ca59-593">Click **Install** tooadd hello features.</span></span>

<span data-ttu-id="8ca59-594">Hello 上重複步驟 hello 其他 SQL Server VM。</span><span class="sxs-lookup"><span data-stu-id="8ca59-594">Repeat hello steps on hello other SQL Server VM.</span></span>

## <a name="a-nameendpoint-firewall-configure-hello-firewall-on-each-sql-server-vm"></a><span data-ttu-id="8ca59-595"><a name="endpoint-firewall">每個 SQL Server VM 上 hello 防火牆設定</span><span class="sxs-lookup"><span data-stu-id="8ca59-595"><a name="endpoint-firewall"> Configure hello firewall on each SQL Server VM</span></span>

<span data-ttu-id="8ca59-596">hello 方案需要下列 toobe hello 防火牆中開啟的 TCP 連接埠的 hello:</span><span class="sxs-lookup"><span data-stu-id="8ca59-596">hello solution requires hello following TCP ports toobe open in hello firewall:</span></span>

- <span data-ttu-id="8ca59-597">**SQL Server VM：**</span><span class="sxs-lookup"><span data-stu-id="8ca59-597">**SQL Server VM**:</span></span><br/>
   <span data-ttu-id="8ca59-598">SQL Server 預設執行個體的連接埠 1433。</span><span class="sxs-lookup"><span data-stu-id="8ca59-598">Port 1433 for a default instance of SQL Server.</span></span>
- <span data-ttu-id="8ca59-599">**Azure Load Balancer 探查：**</span><span class="sxs-lookup"><span data-stu-id="8ca59-599">**Azure load balancer probe:**</span></span><br/>
   <span data-ttu-id="8ca59-600">任何可用的連接埠。</span><span class="sxs-lookup"><span data-stu-id="8ca59-600">Any available port.</span></span> <span data-ttu-id="8ca59-601">範例會經常使用 59999。</span><span class="sxs-lookup"><span data-stu-id="8ca59-601">Examples frequently use 59999.</span></span>
- <span data-ttu-id="8ca59-602">**資料庫鏡像端點：**</span><span class="sxs-lookup"><span data-stu-id="8ca59-602">**Database mirroring endpoint:**</span></span> <br/>
   <span data-ttu-id="8ca59-603">任何可用的連接埠。</span><span class="sxs-lookup"><span data-stu-id="8ca59-603">Any available port.</span></span> <span data-ttu-id="8ca59-604">範例會經常使用 5022。</span><span class="sxs-lookup"><span data-stu-id="8ca59-604">Examples frequently use 5022.</span></span>

<span data-ttu-id="8ca59-605">hello 防火牆連接埠需要 toobe 在這兩個 SQL Server Vm 上開啟。</span><span class="sxs-lookup"><span data-stu-id="8ca59-605">hello firewall ports need toobe open on both SQL Server VMs.</span></span>

<span data-ttu-id="8ca59-606">開啟 hello 連接埠的 hello 方法取決於您所使用的 hello 防火牆解決方案。</span><span class="sxs-lookup"><span data-stu-id="8ca59-606">hello method of opening hello ports depends on hello firewall solution that you use.</span></span> <span data-ttu-id="8ca59-607">hello 下一節說明 tooopen hello Windows 防火牆中的連接埠。</span><span class="sxs-lookup"><span data-stu-id="8ca59-607">hello next section explains how tooopen hello ports in Windows Firewall.</span></span> <span data-ttu-id="8ca59-608">開啟 hello 需要在每個 SQL Server Vm 上的連接埠。</span><span class="sxs-lookup"><span data-stu-id="8ca59-608">Open hello required ports on each of your SQL Server VMs.</span></span>

### <a name="open-a-tcp-port-in-hello-firewall"></a><span data-ttu-id="8ca59-609">在 hello 防火牆中開啟 TCP 連接埠</span><span class="sxs-lookup"><span data-stu-id="8ca59-609">Open a TCP port in hello firewall</span></span>

1. <span data-ttu-id="8ca59-610">在 hello 第一個 SQL Server**啟動**畫面上，啟動**具有進階安全性的 Windows 防火牆**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-610">On hello first SQL Server **Start** screen, launch **Windows Firewall with Advanced Security**.</span></span>
2. <span data-ttu-id="8ca59-611">在 hello 左窗格中，選取 **輸入規則**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-611">On hello left pane, select **Inbound Rules**.</span></span> <span data-ttu-id="8ca59-612">在 hello 右窗格中，按一下 **新規則**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-612">On hello right pane, click **New Rule**.</span></span>
3. <span data-ttu-id="8ca59-613">針對 [規則類型]，選擇 [連接埠]。</span><span class="sxs-lookup"><span data-stu-id="8ca59-613">For **Rule Type**, choose **Port**.</span></span>
4. <span data-ttu-id="8ca59-614">Hello 埠指定**TCP**和型別 hello 適當的連接埠號碼。</span><span class="sxs-lookup"><span data-stu-id="8ca59-614">For hello port, specify **TCP** and type hello appropriate port numbers.</span></span> <span data-ttu-id="8ca59-615">請參閱下列範例中的 hello:</span><span class="sxs-lookup"><span data-stu-id="8ca59-615">See hello following example:</span></span>

   ![SQL 防火牆](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/35-tcpports.png)

5. <span data-ttu-id="8ca59-617">按一下 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="8ca59-617">Click **Next**.</span></span>
6. <span data-ttu-id="8ca59-618">在 hello**動作**頁面上，保留**允許 hello 連線**選取，然後再按一下**下一步**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-618">On hello **Action** page, keep **Allow hello connection** selected, and then click **Next**.</span></span>
7. <span data-ttu-id="8ca59-619">在 hello**設定檔**頁面上，接受 hello 預設設定，然後按**下一步**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-619">On hello **Profile** page, accept hello default settings, and then click **Next**.</span></span>
8. <span data-ttu-id="8ca59-620">在 hello**名稱**頁面上，指定規則的名稱 (例如**Azure LB 探查**) 在 hello**名稱**文字方塊，然後再按一下**完成**。</span><span class="sxs-lookup"><span data-stu-id="8ca59-620">On hello **Name** page, specify a rule name (such as **Azure LB Probe**) in hello **Name** text box, and then click **Finish**.</span></span>

<span data-ttu-id="8ca59-621">重複這些步驟在 hello 第二個 SQL Server VM。</span><span class="sxs-lookup"><span data-stu-id="8ca59-621">Repeat these steps on hello second SQL Server VM.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8ca59-622">後續步驟</span><span class="sxs-lookup"><span data-stu-id="8ca59-622">Next steps</span></span>

* [<span data-ttu-id="8ca59-623">在 Azure 虛擬機器上建立 SQL Server Always On 可用性群組</span><span class="sxs-lookup"><span data-stu-id="8ca59-623">Create a SQL Server Always On availability group on Azure virtual machines</span></span>](virtual-machines-windows-portal-sql-availability-group-tutorial.md)
