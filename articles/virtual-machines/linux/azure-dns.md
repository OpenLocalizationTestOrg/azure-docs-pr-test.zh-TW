---
title: "aaaDNS Azure 中 Linux 虛擬機器的名稱解析選項"
description: "Azure IaaS 中 Linux 虛擬機器的名稱解析案例 (包括提供的 DNS 服務)：混合式外部 DNS 和自備 DNS 伺服器。"
services: virtual-machines
documentationcenter: na
author: RicksterCDN
manager: timlt
editor: tysonn
ms.assetid: 787a1e04-cebf-4122-a1b4-1fcf0a2bbf5f
ms.service: virtual-machines-linux
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/19/2016
ms.author: rclaus
ms.openlocfilehash: 7df2320b6f6b42b479bf4070ea60fe5770a78a41
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="dns-name-resolution-options-for-linux-virtual-machines-in-azure"></a><span data-ttu-id="cd1b1-103">Azure 中 Linux 虛擬機器的 DNS 名稱解析選項</span><span class="sxs-lookup"><span data-stu-id="cd1b1-103">DNS Name Resolution options for Linux virtual machines in Azure</span></span>
<span data-ttu-id="cd1b1-104">Azure 預設會提供單一虛擬網路中所有虛擬機器的 DNS 名稱解析。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-104">Azure provides DNS name resolution by default for all virtual machines that are in a single virtual network.</span></span> <span data-ttu-id="cd1b1-105">您可以在 Azure 託管的虛擬機器上設定專屬 DNS 服務，以實作專屬 DNS 名稱解析解決方案。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-105">You can implement your own DNS name resolution solution by configuring your own DNS services on your virtual machines that Azure hosts.</span></span> <span data-ttu-id="cd1b1-106">hello 下列案例應可協助您選擇適合您情況的其中一個 hello。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-106">hello following scenarios should help you choose hello one that works for your situation.</span></span>

* [<span data-ttu-id="cd1b1-107">Azure 提供的名稱解析</span><span class="sxs-lookup"><span data-stu-id="cd1b1-107">Name resolution that Azure provides</span></span>](#azure-provided-name-resolution)
* [<span data-ttu-id="cd1b1-108">使用專屬 DNS 伺服器的名稱解析</span><span class="sxs-lookup"><span data-stu-id="cd1b1-108">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server)

<span data-ttu-id="cd1b1-109">您使用的名稱解析的 hello 類型取決於您的虛擬機器和角色執行個體需要如何與彼此 toocommunicate。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-109">hello type of name resolution that you use depends on how your virtual machines and role instances need toocommunicate with each other.</span></span>

<span data-ttu-id="cd1b1-110">hello 下表說明案例和對應的名稱解析方案：</span><span class="sxs-lookup"><span data-stu-id="cd1b1-110">hello following table illustrates scenarios and corresponding name resolution solutions:</span></span>

| <span data-ttu-id="cd1b1-111">**案例**</span><span class="sxs-lookup"><span data-stu-id="cd1b1-111">**Scenario**</span></span> | <span data-ttu-id="cd1b1-112">**方案**</span><span class="sxs-lookup"><span data-stu-id="cd1b1-112">**Solution**</span></span> | <span data-ttu-id="cd1b1-113">**尾碼**</span><span class="sxs-lookup"><span data-stu-id="cd1b1-113">**Suffix**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="cd1b1-114">角色執行個體或 hello 中的虛擬機器之間的名稱解析相同虛擬網路</span><span class="sxs-lookup"><span data-stu-id="cd1b1-114">Name resolution between role instances or virtual machines in hello same virtual network</span></span> |[<span data-ttu-id="cd1b1-115">Azure 提供的名稱解析</span><span class="sxs-lookup"><span data-stu-id="cd1b1-115">Name resolution that Azure provides</span></span>](#azure-provided-name-resolution) |<span data-ttu-id="cd1b1-116">主機名稱或完整網域名稱 (FQDN)</span><span class="sxs-lookup"><span data-stu-id="cd1b1-116">hostname or fully-qualified domain name (FQDN)</span></span> |
| <span data-ttu-id="cd1b1-117">不同虛擬網路中的角色執行個體或虛擬機器之間的名稱解析</span><span class="sxs-lookup"><span data-stu-id="cd1b1-117">Name resolution between role instances or virtual machines in different virtual networks</span></span> |<span data-ttu-id="cd1b1-118">客戶管理的 DNS 伺服器將虛擬網路之間的查詢轉送供 Azure (DNS Proxy) 解析。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-118">Customer-managed DNS servers that forward queries between virtual networks for resolution by Azure (DNS proxy).</span></span> <span data-ttu-id="cd1b1-119">請參閱[使用專屬 DNS 伺服器的名稱解析](#name-resolution-using-your-own-dns-server)。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-119">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server).</span></span> |<span data-ttu-id="cd1b1-120">僅 FQDN</span><span class="sxs-lookup"><span data-stu-id="cd1b1-120">FQDN only</span></span> |
| <span data-ttu-id="cd1b1-121">解析 Azure 中角色執行個體或虛擬機器的內部部署電腦及伺服器名稱</span><span class="sxs-lookup"><span data-stu-id="cd1b1-121">Resolution of on-premises computers and service names from role instances or virtual machines in Azure</span></span> |<span data-ttu-id="cd1b1-122">客戶管理的 DNS 伺服器 (例如，內部部署的網域控制站、本機唯讀網域控制站或使用區域傳輸同步的次要 DNS)。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-122">Customer-managed DNS servers (for example, on-premises domain controller, local read-only domain controller, or a DNS secondary synced by using zone transfers).</span></span> <span data-ttu-id="cd1b1-123">請參閱[使用專屬 DNS 伺服器的名稱解析](#name-resolution-using-your-own-dns-server)。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-123">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server).</span></span> |<span data-ttu-id="cd1b1-124">僅 FQDN</span><span class="sxs-lookup"><span data-stu-id="cd1b1-124">FQDN only</span></span> |
| <span data-ttu-id="cd1b1-125">從內部部署電腦解析 Azure 主機名稱</span><span class="sxs-lookup"><span data-stu-id="cd1b1-125">Resolution of Azure hostnames from on-premises computers</span></span> |<span data-ttu-id="cd1b1-126">轉送查詢 tooa 客戶管理 proxy 中 DNS 伺服器 hello 對應的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-126">Forward queries tooa customer-managed DNS proxy server in hello corresponding virtual network.</span></span> <span data-ttu-id="cd1b1-127">hello proxy 伺服器將轉寄查詢 tooAzure 進行解析。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-127">hello proxy server forwards queries tooAzure for resolution.</span></span> <span data-ttu-id="cd1b1-128">請參閱[使用專屬 DNS 伺服器的名稱解析](#name-resolution-using-your-own-dns-server)。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-128">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server).</span></span> |<span data-ttu-id="cd1b1-129">僅 FQDN</span><span class="sxs-lookup"><span data-stu-id="cd1b1-129">FQDN only</span></span> |
| <span data-ttu-id="cd1b1-130">內部 IP 的反向 DNS</span><span class="sxs-lookup"><span data-stu-id="cd1b1-130">Reverse DNS for internal IPs</span></span> |[<span data-ttu-id="cd1b1-131">使用專屬 DNS 伺服器的名稱解析</span><span class="sxs-lookup"><span data-stu-id="cd1b1-131">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server) |<span data-ttu-id="cd1b1-132">n/a</span><span class="sxs-lookup"><span data-stu-id="cd1b1-132">n/a</span></span> |

## <a name="name-resolution-that-azure-provides"></a><span data-ttu-id="cd1b1-133">Azure 提供的名稱解析</span><span class="sxs-lookup"><span data-stu-id="cd1b1-133">Name resolution that Azure provides</span></span>
<span data-ttu-id="cd1b1-134">公用 DNS 名稱解析，以及 Azure 提供的內部名稱解析的虛擬機器和角色執行個體中的 hello 相同虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-134">Along with resolution of public DNS names, Azure provides internal name resolution for virtual machines and role instances that are in hello same virtual network.</span></span> <span data-ttu-id="cd1b1-135">中的採用 Azure 資源管理員的虛擬網路，hello DNS 尾碼都一致 hello 虛擬網路。不需要 hello FQDN。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-135">In virtual networks that are based on Azure Resource Manager, hello DNS suffix is consistent across hello virtual network; hello FQDN is not needed.</span></span> <span data-ttu-id="cd1b1-136">Tooboth 網路介面卡 (Nic) 與虛擬機器，可以指派 DNS 名稱。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-136">DNS names can be assigned tooboth network interface cards (NICs) and virtual machines.</span></span> <span data-ttu-id="cd1b1-137">雖然 Azure 提供的 hello 名稱解析不需要任何設定，它並不 hello 適用於所有部署案例中，選擇 hello 上述表格所示。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-137">Although hello name resolution that Azure provides does not require any configuration, it is not hello appropriate choice for all deployment scenarios, as seen on hello preceding table.</span></span>

### <a name="features-and-considerations"></a><span data-ttu-id="cd1b1-138">功能和注意事項</span><span class="sxs-lookup"><span data-stu-id="cd1b1-138">Features and considerations</span></span>
<span data-ttu-id="cd1b1-139">**功能：**</span><span class="sxs-lookup"><span data-stu-id="cd1b1-139">**Features:**</span></span>

* <span data-ttu-id="cd1b1-140">不不需要的 toouse Azure 提供的名稱解析的任何設定。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-140">No configuration is required toouse name resolution that Azure provides.</span></span>
* <span data-ttu-id="cd1b1-141">Azure 提供的 hello 名稱解析服務是高可用性。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-141">hello name resolution service that Azure provides is highly available.</span></span> <span data-ttu-id="cd1b1-142">您不需要 toocreate 並管理您自己的 DNS 伺服器的叢集。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-142">You don't need toocreate and manage clusters of your own DNS servers.</span></span>
* <span data-ttu-id="cd1b1-143">hello Azure 所提供名稱解析服務可以使用您自己的 DNS 伺服器 tooresolve 以及在內部部署和 Azure 的主機名稱。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-143">hello name resolution service that Azure provides can be used along with your own DNS servers tooresolve both on-premises and Azure hostnames.</span></span>
* <span data-ttu-id="cd1b1-144">虛擬網路，而需要在 hello FQDN 中的虛擬機器之間提供名稱解析。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-144">Name resolution is provided between virtual machines in virtual networks without need for hello FQDN.</span></span>
* <span data-ttu-id="cd1b1-145">您可以使用最能描述部署的主機名稱，而不是使用自動產生的名稱。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-145">You can use hostnames that best describe your deployments rather than working with auto-generated names.</span></span>

<bpt id="p1">**</bpt>Considerations:<ept id="p1">**</ept>

* <span data-ttu-id="cd1b1-147">建立 Azure 的 hello DNS 尾碼不能修改。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-147">hello DNS suffix that Azure creates cannot be modified.</span></span>
* <span data-ttu-id="cd1b1-148">您無法手動註冊您自己的記錄。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-148">You cannot manually register your own records.</span></span>
* <span data-ttu-id="cd1b1-149">不支援 WINS 和 NetBIOS。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-149">WINS and NetBIOS are not supported.</span></span>
* <span data-ttu-id="cd1b1-150">主機名稱必須是 DNS 相容。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-150">Hostnames must be DNS-compatible.</span></span>
    <span data-ttu-id="cd1b1-151">名稱只能使用 0-9、a-z 和 '-'，無法以 '-' 開始或結束。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-151">Names must use only 0-9, a-z, and '-', and they cannot start or end with a '-'.</span></span> <span data-ttu-id="cd1b1-152">請參閱 RFC 3696 第 2 節。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-152">See RFC 3696 Section 2.</span></span>
* <span data-ttu-id="cd1b1-153">每部虛擬機器的 DNS 查詢流量已經過節流。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-153">DNS query traffic is throttled for each virtual machine.</span></span> <span data-ttu-id="cd1b1-154">節流應該不會影響大部分的應用程式。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-154">Throttling shouldn't impact most applications.</span></span>  <span data-ttu-id="cd1b1-155">如果觀察到要求節流，請確定用戶端快取已啟用。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-155">If request throttling is observed, ensure that client-side caching is enabled.</span></span>  <span data-ttu-id="cd1b1-156">如需詳細資訊，請參閱[取得 hello 從 Azure 提供名稱解析的大部分](#getting-the-most-from-name-resolution-that-azure-provides)。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-156">For more information, see [Getting hello most from name resolution that Azure provides](#getting-the-most-from-name-resolution-that-azure-provides).</span></span>

### <a name="getting-hello-most-from-name-resolution-that-azure-provides"></a><span data-ttu-id="cd1b1-157">取得 hello 大部分 Azure 提供的名稱解析</span><span class="sxs-lookup"><span data-stu-id="cd1b1-157">Getting hello most from name resolution that Azure provides</span></span>
<span data-ttu-id="cd1b1-158">**用戶端快取：**</span><span class="sxs-lookup"><span data-stu-id="cd1b1-158">**Client-side caching:**</span></span>

<span data-ttu-id="cd1b1-159">某些 DNS 查詢不會傳送 hello 網路上。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-159">Some DNS queries are not sent across hello network.</span></span> <span data-ttu-id="cd1b1-160">用戶端快取有助於降低延遲，並解決週期性的 DNS 查詢，從本機快取來改善恢復功能 toonetwork 不一致。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-160">Client-side caching helps reduce latency and improve resilience toonetwork inconsistencies by resolving recurring DNS queries from a local cache.</span></span> <span data-ttu-id="cd1b1-161">DNS 記錄包含存留時間 (TTL)，可讓 hello 快取 toostore hello 記錄越久，而不會影響記錄的有效性。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-161">DNS records contain a Time-To-Live (TTL), which enables hello cache toostore hello record for as long as possible without impacting record freshness.</span></span> <span data-ttu-id="cd1b1-162">因此，用戶端快取適用於大部分的情況。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-162">As a result, client-side caching is suitable for most situations.</span></span>

<span data-ttu-id="cd1b1-163">某些 Linux 發行版本預設不包含快取功能。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-163">Some Linux distributions do not include caching by default.</span></span> <span data-ttu-id="cd1b1-164">我們建議您檢查沒有本機快取已經之後，新增快取 tooeach Linux 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-164">We recommend that you add a cache tooeach Linux virtual machine after you check that there isn't a local cache already.</span></span>

<span data-ttu-id="cd1b1-165">有數個不同的 DNS 快取封裝可供使用，例如 dnsmasq。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-165">Several different DNS caching packages, such as dnsmasq, are available.</span></span> <span data-ttu-id="cd1b1-166">以下是 hello 步驟 tooinstall dnsmasq hello 最常見的發佈：</span><span class="sxs-lookup"><span data-stu-id="cd1b1-166">Here are hello steps tooinstall dnsmasq on hello most common distributions:</span></span>

<span data-ttu-id="cd1b1-167">**Ubuntu (使用 resolvconf)**</span><span class="sxs-lookup"><span data-stu-id="cd1b1-167">**Ubuntu (uses resolvconf)**</span></span>
  * <span data-ttu-id="cd1b1-168">安裝 hello dnsmasq 套件 ("sudo apt get 安裝 dnsmasq")。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-168">Install hello dnsmasq package (“sudo apt-get install dnsmasq”).</span></span>

<span data-ttu-id="cd1b1-169">SUSE (使用 netconf)：</span><span class="sxs-lookup"><span data-stu-id="cd1b1-169">**SUSE (uses netconf)**:</span></span>
1. <span data-ttu-id="cd1b1-170">安裝 hello dnsmasq 套件 ("sudo zypper 安裝 dnsmasq")。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-170">Install hello dnsmasq package (“sudo zypper install dnsmasq”).</span></span>
2. <span data-ttu-id="cd1b1-171">啟用 hello dnsmasq 服務 (「 systemctl 啟用 dnsmasq.service")。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-171">Enable hello dnsmasq service (“systemctl enable dnsmasq.service”).</span></span>
3. <span data-ttu-id="cd1b1-172">啟動 hello dnsmasq 服務 (「 systemctl 開始 dnsmasq.service")。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-172">Start hello dnsmasq service (“systemctl start dnsmasq.service”).</span></span>
4. <span data-ttu-id="cd1b1-173">編輯"/ 等/sysconfig/網路/config"，並變更 NETCONFIG_DNS_FORWARDER =""太"dnsmasq"。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-173">Edit “/etc/sysconfig/network/config”, and change NETCONFIG_DNS_FORWARDER="" too”dnsmasq”.</span></span>
5. <span data-ttu-id="cd1b1-174">更新 resolv.conf （「 netconfig 更新 」） tooset hello 快取為 hello 本機 DNS 解析程式。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-174">Update resolv.conf ("netconfig update") tooset hello cache as hello local DNS resolver.</span></span>

<span data-ttu-id="cd1b1-175">**CentOS by Rogue Wave Software (先前稱為 OpenLogic；使用 NetworkManager)**</span><span class="sxs-lookup"><span data-stu-id="cd1b1-175">**CentOS by Rogue Wave Software (formerly OpenLogic; uses NetworkManager)**</span></span>
1. <span data-ttu-id="cd1b1-176">安裝 hello dnsmasq 套件 ("sudo yum 安裝 dnsmasq")。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-176">Install hello dnsmasq package (“sudo yum install dnsmasq”).</span></span>
2. <span data-ttu-id="cd1b1-177">啟用 hello dnsmasq 服務 (「 systemctl 啟用 dnsmasq.service")。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-177">Enable hello dnsmasq service (“systemctl enable dnsmasq.service”).</span></span>
3. <span data-ttu-id="cd1b1-178">啟動 hello dnsmasq 服務 (「 systemctl 開始 dnsmasq.service")。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-178">Start hello dnsmasq service (“systemctl start dnsmasq.service”).</span></span>
4. <span data-ttu-id="cd1b1-179">新增 「 前面加上的網域名稱伺服器 127.0.0.1;"too"/etc/dhclient-eth0.conf"。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-179">Add “prepend domain-name-servers 127.0.0.1;” too“/etc/dhclient-eth0.conf”.</span></span>
5. <span data-ttu-id="cd1b1-180">hello 本機 DNS 解析程式時重新啟動 hello 網路服務 （「 網路重新啟動服務 」） tooset hello 快取</span><span class="sxs-lookup"><span data-stu-id="cd1b1-180">Restart hello network service (“service network restart”) tooset hello cache as hello local DNS resolver</span></span>

> [!NOTE]
> <span data-ttu-id="cd1b1-181">: hello 'dnsmasq' 封裝是的 hello 許多 DNS 快取適用於 Linux 的其中之一。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-181">: hello 'dnsmasq' package is only one of hello many DNS caches that are available for Linux.</span></span> <span data-ttu-id="cd1b1-182">在您使用它之前，請檢查您需求的適用性，而且沒有安裝其他快取。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-182">Before you use it, check its suitability for your needs and that no other cache is installed.</span></span>
>
>

<span data-ttu-id="cd1b1-183">**用戶端重試**</span><span class="sxs-lookup"><span data-stu-id="cd1b1-183">**Client-side retries**</span></span>

<span data-ttu-id="cd1b1-184">DNS 主要是 UDP 通訊協定。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-184">DNS is primarily a UDP protocol.</span></span> <span data-ttu-id="cd1b1-185">由於 hello UDP 通訊協定並不保證訊息傳遞，hello DNS 通訊協定本身會處理重試邏輯。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-185">Because hello UDP protocol doesn't guarantee message delivery, hello DNS protocol itself handles retry logic.</span></span> <span data-ttu-id="cd1b1-186">每個 DNS 用戶端 （作業系統） 可以展現不同的重試邏輯，根據 hello 建立者的喜好設定：</span><span class="sxs-lookup"><span data-stu-id="cd1b1-186">Each DNS client (operating system) can exhibit different retry logic depending on hello creator's preference:</span></span>

* <span data-ttu-id="cd1b1-187">Windows 作業系統會在 1 秒後重試，然後再依序隔 2、4、4 秒後重試。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-187">Windows operating systems retry after one second and then again after another two, four, and another four seconds.</span></span>
* <span data-ttu-id="cd1b1-188">hello 預設 Linux 安裝後的重試五秒。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-188">hello default Linux setup retries after five seconds.</span></span>  <span data-ttu-id="cd1b1-189">您應該變更這個 tooretry 五次時，在一秒的時間間隔。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-189">You should change this tooretry five times at one-second intervals.</span></span>  

<span data-ttu-id="cd1b1-190">toocheck hello Linux 虛擬機器，而 'cat /etc/resolv.conf' 上的目前設定，並查看 hello [選項] 行，例如：</span><span class="sxs-lookup"><span data-stu-id="cd1b1-190">toocheck hello current settings on a Linux virtual machine, 'cat /etc/resolv.conf', and look at hello 'options' line, for example:</span></span>

    options timeout:1 attempts:5

<span data-ttu-id="cd1b1-191">hello resolv.conf 檔案是自動產生，並不應編輯。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-191">hello resolv.conf file is auto-generated and should not be edited.</span></span> <span data-ttu-id="cd1b1-192">hello 新增 hello '選項' 列因發佈的特定步驟：</span><span class="sxs-lookup"><span data-stu-id="cd1b1-192">hello specific steps that add hello 'options' line vary by distribution:</span></span>

<span data-ttu-id="cd1b1-193">**Ubuntu** (使用 resolvconf)</span><span class="sxs-lookup"><span data-stu-id="cd1b1-193">**Ubuntu** (uses resolvconf)</span></span>
1. <span data-ttu-id="cd1b1-194">新增 hello 選項列 too'/etc/resolveconf/resolv.conf.d/head'。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-194">Add hello options line too'/etc/resolveconf/resolv.conf.d/head'.</span></span>
2. <span data-ttu-id="cd1b1-195">執行 ' resolvconf u' tooupdate。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-195">Run 'resolvconf -u' tooupdate.</span></span>

<span data-ttu-id="cd1b1-196">**SUSE** (使用 netconf)</span><span class="sxs-lookup"><span data-stu-id="cd1b1-196">**SUSE** (uses netconf)</span></span>
1. <span data-ttu-id="cd1b1-197">新增 ' timeout:1 嘗試次數： 5' toohello NETCONFIG_DNS_RESOLVER_OPTIONS =""參數的 '/ 等/sysconfig/網路/config'。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-197">Add 'timeout:1 attempts:5' toohello NETCONFIG_DNS_RESOLVER_OPTIONS="" parameter in '/etc/sysconfig/network/config'.</span></span>
2. <span data-ttu-id="cd1b1-198">執行 'netconfig 更新' tooupdate。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-198">Run 'netconfig update' tooupdate.</span></span>

<span data-ttu-id="cd1b1-199">**CentOS by Rogue Wave Software (先前稱為 OpenLogic)** (使用 NetworkManager)</span><span class="sxs-lookup"><span data-stu-id="cd1b1-199">**CentOS by Rogue Wave Software (formerly OpenLogic)** (uses NetworkManager)</span></span>
1. <span data-ttu-id="cd1b1-200">新增 '回應 」 選項 timeout:1 嘗試次數： 5 」' too'/etc/NetworkManager/dispatcher.d/11-dhclient'。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-200">Add 'echo "options timeout:1 attempts:5"' too'/etc/NetworkManager/dispatcher.d/11-dhclient'.</span></span>
2. <span data-ttu-id="cd1b1-201">執行 'service 網路 restart' tooupdate。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-201">Run 'service network restart' tooupdate.</span></span>

## <a name="name-resolution-using-your-own-dns-server"></a><span data-ttu-id="cd1b1-202">使用專屬 DNS 伺服器的名稱解析</span><span class="sxs-lookup"><span data-stu-id="cd1b1-202">Name resolution using your own DNS server</span></span>
<span data-ttu-id="cd1b1-203">您的名稱解析需求可能會超越 hello Azure 提供的功能。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-203">Your name resolution needs may go beyond hello features that Azure provides.</span></span> <span data-ttu-id="cd1b1-204">例如，您可能需要虛擬網路之間的 DNS 解析。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-204">For example, you might require DNS resolution between virtual networks.</span></span> <span data-ttu-id="cd1b1-205">toocover 此案例中，您可以使用您自己的 DNS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-205">toocover this scenario, you can use your own DNS servers.</span></span>  

<span data-ttu-id="cd1b1-206">在虛擬網路可以正向 DNS 查詢 toorecursive Azure tooresolve 主機名稱的解析程式中的 DNS 伺服器 hello 相同虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-206">DNS servers within a virtual network can forward DNS queries toorecursive resolvers of Azure tooresolve hostnames that are in hello same virtual network.</span></span> <span data-ttu-id="cd1b1-207">例如，在 Azure 中執行的 DNS 伺服器可以回應 tooDNS 查詢它自己的 dns 區域檔案中，然後轉送其他所有的查詢 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-207">For example, a DNS server that runs in Azure can respond tooDNS queries for its own DNS zone files and forward all other queries tooAzure.</span></span> <span data-ttu-id="cd1b1-208">這項功能可讓虛擬機器 toosee 區域檔案與 Azure 提供 （透過 hello 轉寄站） 的主機名稱中的兩個程式項目。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-208">This functionality enables virtual machines toosee both your entries in your zone files and hostnames that Azure provides (via hello forwarder).</span></span> <span data-ttu-id="cd1b1-209">存取 Azure 的 toohello 遞迴解析程式會透過 hello 虛擬 IP 168.63.129.16 提供。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-209">Access toohello recursive resolvers of Azure is provided via hello virtual IP 168.63.129.16.</span></span>

<span data-ttu-id="cd1b1-210">DNS 轉寄也可讓虛擬網路之間的 DNS 解析，並可讓 Azure 提供您在內部部署機器 tooresolve 主機名稱。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-210">DNS forwarding also enables DNS resolution between virtual networks and enables your on-premises machines tooresolve hostnames that Azure provides.</span></span> <span data-ttu-id="cd1b1-211">tooresolve hello DNS 伺服器的虛擬機器必須位於虛擬機器的主機名稱，在 hello 相同虛擬網路，而且是已設定的 tooforward 主機名稱查詢 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-211">tooresolve a virtual machine's hostname, hello DNS server virtual machine must reside in hello same virtual network and be configured tooforward hostname queries tooAzure.</span></span> <span data-ttu-id="cd1b1-212">由於 hello DNS 尾碼不是在每個虛擬網路中，您可以使用條件轉寄規則 toosend DNS 查詢 toohello 更正進行解析的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-212">Because hello DNS suffix is different in each virtual network, you can use conditional forwarding rules toosend DNS queries toohello correct virtual network for resolution.</span></span> <span data-ttu-id="cd1b1-213">hello 圖顯示兩個虛擬網路與內部部署網路進行使用此方法的虛擬網路之間的 DNS 解析：</span><span class="sxs-lookup"><span data-stu-id="cd1b1-213">hello following image shows two virtual networks and an on-premises network doing DNS resolution between virtual networks by using this method:</span></span>

![虛擬網路之間的 DNS 解析](./media/azure-dns/inter-vnet-dns.png)

<span data-ttu-id="cd1b1-215">當您使用 Azure 提供的名稱解析時，hello 內部的 DNS 尾碼是使用 DHCP 提供 tooeach 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-215">When you use name resolution that Azure provides, hello internal DNS suffix is provided tooeach virtual machine by using DHCP.</span></span> <span data-ttu-id="cd1b1-216">當您使用您自己的名稱解析方案時，但這個後置詞不是提供的 toovirtual 機器因為 hello 尾碼干擾到其他 DNS 架構。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-216">When you use your own name resolution solution, this suffix is not supplied toovirtual machines because hello suffix interferes with other DNS architectures.</span></span> <span data-ttu-id="cd1b1-217">根據您的虛擬機器上的 FQDN 或 tooconfigure hello 尾碼 toorefer toomachines，您可以使用 PowerShell 或 hello API toodetermine hello 尾碼：</span><span class="sxs-lookup"><span data-stu-id="cd1b1-217">toorefer toomachines by FQDN or tooconfigure hello suffix on your virtual machines, you can use PowerShell or hello API toodetermine hello suffix:</span></span>

* <span data-ttu-id="cd1b1-218">Azure 資源管理員所管理的虛擬網路，hello 尾碼是可透過 hello[網路介面卡](https://msdn.microsoft.com/library/azure/mt163668.aspx)資源。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-218">For virtual networks that are managed by Azure Resource Manager, hello suffix is available via hello [network interface card](https://msdn.microsoft.com/library/azure/mt163668.aspx) resource.</span></span> <span data-ttu-id="cd1b1-219">您也可以執行 hello`azure network public-ip show <resource group> <pip name>`命令 toodisplay hello 詳細資料，您的公用 IP，其中包含的 hello hello NIC 的 FQDN</span><span class="sxs-lookup"><span data-stu-id="cd1b1-219">You can also run hello `azure network public-ip show <resource group> <pip name>` command toodisplay hello details of your public IP, which includes hello FQDN of hello NIC.</span></span>

<span data-ttu-id="cd1b1-220">如果轉送查詢 tooAzure 不符合您的需求，您需要 tooprovide 自己的 DNS 解決方案。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-220">If forwarding queries tooAzure doesn't suit your needs, you need tooprovide your own DNS solution.</span></span>  <span data-ttu-id="cd1b1-221">您的 DNS 解決方案需要：</span><span class="sxs-lookup"><span data-stu-id="cd1b1-221">Your DNS solution needs to:</span></span>

* <span data-ttu-id="cd1b1-222">提供適當的主機名稱解析，例如透過 [DDNS](../../virtual-network/virtual-networks-name-resolution-ddns.md)。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-222">Provide appropriate hostname resolution, for example via [DDNS](../../virtual-network/virtual-networks-name-resolution-ddns.md).</span></span> <span data-ttu-id="cd1b1-223">如果您使用 DDNS，您可能需要 toodisable DNS 記錄清除。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-223">If you use DDNS, you might need toodisable DNS record scavenging.</span></span> <span data-ttu-id="cd1b1-224">Azure 的 DHCP 租用期很長，而清除可能會提前移除 DNS 記錄。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-224">DHCP leases of Azure are very long and scavenging may remove DNS records prematurely.</span></span>
* <span data-ttu-id="cd1b1-225">提供適當的遞迴解析 tooallow 解析的外部網域名稱。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-225">Provide appropriate recursive resolution tooallow resolution of external domain names.</span></span>
* <span data-ttu-id="cd1b1-226">是可存取 （TCP 和 UDP 連接埠 53） 從它的作用是 hello 用戶端，而是可以 tooaccess hello 網際網路。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-226">Be accessible (TCP and UDP on port 53) from hello clients it serves and be able tooaccess hello Internet.</span></span>
* <span data-ttu-id="cd1b1-227">受到保護免於從 hello 網際網路 toomitigate 威脅外部代理程式所存取。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-227">Be secured against access from hello Internet toomitigate threats posed by external agents.</span></span>

> [!NOTE]
> <span data-ttu-id="cd1b1-228">為了達到最佳效能，當您使用虛擬機器中的 Azure DNS 伺服器時，停用 IPv6，並指派[執行個體層級公用 IP](../../virtual-network/virtual-networks-instance-level-public-ip.md) tooeach DNS 伺服器的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="cd1b1-228">For best performance, when you use virtual machines in Azure DNS servers, disable IPv6 and assign an [Instance-Level Public IP](../../virtual-network/virtual-networks-instance-level-public-ip.md) tooeach DNS server virtual machine.</span></span>  
>
>
