---
title: "aaaSAP HANA Azure Backup，在檔案層級上 |Microsoft 文件"
description: "備份 Azure 虛擬機器上的 SAP HANA 有兩種主要做法，本文涵蓋檔案層級的 SAP HANA Azure 備份"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: d5a55de5634ac7724e7fd0fa3760c6c408c3db74
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="sap-hana-azure-backup-on-file-level"></a><span data-ttu-id="b59f6-103">檔案層級的 SAP HANA Azure 備份</span><span class="sxs-lookup"><span data-stu-id="b59f6-103">SAP HANA Azure Backup on file level</span></span>

## <a name="introduction"></a><span data-ttu-id="b59f6-104">簡介</span><span class="sxs-lookup"><span data-stu-id="b59f6-104">Introduction</span></span>

<span data-ttu-id="b59f6-105">這是與 SAP HANA 備份相關的三篇系列文章的其中一篇。</span><span class="sxs-lookup"><span data-stu-id="b59f6-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="b59f6-106">[備份指南的 SAP HANA Azure 虛擬機器上](./sap-hana-backup-guide.md)上開始使用提供的概觀和資訊和[SAP HANA 備份為基礎儲存快照集](./sap-hana-backup-storage-snapshots.md)涵蓋 hello 儲存快照集為基礎的備份選項。</span><span class="sxs-lookup"><span data-stu-id="b59f6-106">[Backup guide for SAP HANA on Azure Virtual Machines](./sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA backup based on storage snapshots](./sap-hana-backup-storage-snapshots.md) covers hello storage snapshot-based backup option.</span></span>

<span data-ttu-id="b59f6-107">查看 hello Azure VM 大小，其中一個就可以看到 GS5 允許 64 連接的資料磁碟。</span><span class="sxs-lookup"><span data-stu-id="b59f6-107">Looking at hello Azure VM sizes, one can see that a GS5 allows 64 attached data disks.</span></span> <span data-ttu-id="b59f6-108">在大型的 SAP HANA 系統中，大量磁碟可能已被資料和記錄檔佔據，可能還加上用於最佳磁碟 IO 輸送量的軟體 RAID。</span><span class="sxs-lookup"><span data-stu-id="b59f6-108">For large SAP HANA systems, a significant number of disks might already be taken for data and log files, possibly in combination with software RAID for optimal disk IO throughput.</span></span> <span data-ttu-id="b59f6-109">然後 hello 問題是 toostore SAP HANA 備份無法填滿 hello 附加資料磁碟一段時間的檔案的位置？</span><span class="sxs-lookup"><span data-stu-id="b59f6-109">hello question then is where toostore SAP HANA backup files, which could fill up hello attached data disks over time?</span></span> <span data-ttu-id="b59f6-110">請參閱[在 Azure 中 Linux 虛擬機器的大小](../../linux/sizes.md)hello Azure VM 大小的資料表。</span><span class="sxs-lookup"><span data-stu-id="b59f6-110">See [Sizes for Linux virtual machines in Azure](../../linux/sizes.md) for hello Azure VM size tables.</span></span>

<span data-ttu-id="b59f6-111">目前 SAP HANA 備份還沒有與 Azure 備份服務整合。</span><span class="sxs-lookup"><span data-stu-id="b59f6-111">There is no SAP HANA backup integration available with Azure Backup service at this time.</span></span> <span data-ttu-id="b59f6-112">hello toomanage 備份/還原 hello 檔案層級是以檔案為基礎的備份透過 SAP HANA Studio 或透過 SAP HANA SQL 陳述式的標準方式。</span><span class="sxs-lookup"><span data-stu-id="b59f6-112">hello standard way toomanage backup/restore at hello file level is with a file-based backup via SAP HANA Studio or via SAP HANA SQL statements.</span></span> <span data-ttu-id="b59f6-113">詳細資訊請參閱 [SAP HANA SQL 和系統檢視參考](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf)。</span><span class="sxs-lookup"><span data-stu-id="b59f6-113">See [SAP HANA SQL and System Views Reference](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf) for more information.</span></span>

![此圖將顯示在 SAP HANA Studio hello hello 備份的功能表項目對話方塊](media/sap-hana-backup-file-level/image022.png)

<span data-ttu-id="b59f6-115">此圖會顯示在 SAP HANA Studio hello hello 備份的功能表項目 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="b59f6-115">This figure shows hello dialog of hello backup menu item in SAP HANA Studio.</span></span> <span data-ttu-id="b59f6-116">當您選擇型別時&quot;檔案，&quot;一個 hello 檔案系統，SAP HANA 寫入 hello 備份檔案的位置中具有 toospecify 的路徑。</span><span class="sxs-lookup"><span data-stu-id="b59f6-116">When choosing type &quot;file,&quot; one has toospecify a path in hello file system where SAP HANA writes hello backup files.</span></span> <span data-ttu-id="b59f6-117">還原 hello 的運作方式相同。</span><span class="sxs-lookup"><span data-stu-id="b59f6-117">Restore works hello same way.</span></span>

<span data-ttu-id="b59f6-118">雖然這項選擇聽起來簡單又直接，但仍有一些事要考量。</span><span class="sxs-lookup"><span data-stu-id="b59f6-118">While this choice sounds simple and straight forward, there are some considerations.</span></span> <span data-ttu-id="b59f6-119">之前有提到，Azure 虛擬機器可連結的資料磁碟數目有限制。</span><span class="sxs-lookup"><span data-stu-id="b59f6-119">As mentioned before, an Azure VM has a limitation of number of data disks that can be attached.</span></span> <span data-ttu-id="b59f6-120">不可能在 hello 檔案系統中的 hello VM，視 hello 資料庫和磁碟輸送量需求，其中可能包含軟體 hello 大小而定的容量 toostore SAP HANA 備份檔案 RAID 使用跨多個資料，等量磁碟。</span><span class="sxs-lookup"><span data-stu-id="b59f6-120">There might not be capacity toostore SAP HANA backup files on hello file systems of hello VM, depending on hello size of hello database and disk throughput requirements, which might involve software RAID using striping across multiple data disks.</span></span> <span data-ttu-id="b59f6-121">在本文稍後提供多種選項，可用於在處理數 TB 資料時，移動這些備份檔案以及管理檔案大小限制和效能。</span><span class="sxs-lookup"><span data-stu-id="b59f6-121">Various options for moving these backup files, and managing file size restrictions and performance when handling terabytes of data, are provided later in this article.</span></span>

<span data-ttu-id="b59f6-122">另一個可以不計總容量提供更多自由的選項是 Azure Blob 儲存體。</span><span class="sxs-lookup"><span data-stu-id="b59f6-122">Another option, which offers more freedom regarding total capacity, is Azure blob storage.</span></span> <span data-ttu-id="b59f6-123">雖然單一 blob 也限制的 too1 TB，hello 的單一 blob 容器的總容量目前為 500 TB。</span><span class="sxs-lookup"><span data-stu-id="b59f6-123">While a single blob is also restricted too1 TB, hello total capacity of a single blob container is currently 500 TB.</span></span> <span data-ttu-id="b59f6-124">此外，它可讓客戶 hello choice tooselect 所謂&quot;cool&quot; blob 儲存體，具有成本效益。</span><span class="sxs-lookup"><span data-stu-id="b59f6-124">Additionally, it gives customers hello choice tooselect so-called &quot;cool&quot; blob storage, which has a cost benefit.</span></span> <span data-ttu-id="b59f6-125">如需非經常性 blob 儲存體的詳細資訊，請參閱 [Azure Blob 儲存體︰經常性存取與非經常性存取儲存層](../../../storage/blobs/storage-blob-storage-tiers.md)。</span><span class="sxs-lookup"><span data-stu-id="b59f6-125">See [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md) for details about cool blob storage.</span></span>

<span data-ttu-id="b59f6-126">額外的安全，則可使用異地備援儲存體帳戶 toostore hello SAP HANA 備份。</span><span class="sxs-lookup"><span data-stu-id="b59f6-126">For additional safety, use a geo-replicated storage account toostore hello SAP HANA backups.</span></span> <span data-ttu-id="b59f6-127">如需儲存體帳戶複寫相關的詳細資料，請參閱 [Azure 儲存體複寫](../../../storage/common/storage-redundancy.md)。</span><span class="sxs-lookup"><span data-stu-id="b59f6-127">See [Azure Storage replication](../../../storage/common/storage-redundancy.md) for details about storage account replication.</span></span>

<span data-ttu-id="b59f6-128">一個人將 SAP HANA 備份專用的 VHD 放在異地複寫的專用備份儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="b59f6-128">One could place dedicated VHDs for SAP HANA backups in a dedicated backup storage account that is geo-replicated.</span></span> <span data-ttu-id="b59f6-129">否則一個無法複製 hello Vhd，以避免 hello SAP HANA 備份 tooa 異地備援儲存體帳戶或 tooa 儲存體帳戶位在不同的區域。</span><span class="sxs-lookup"><span data-stu-id="b59f6-129">Or else one could copy hello VHDs that keep hello SAP HANA backups tooa geo-replicated storage account, or tooa storage account that is in a different region.</span></span>

## <a name="azure-backup-agent"></a><span data-ttu-id="b59f6-130">Azure 備份代理程式</span><span class="sxs-lookup"><span data-stu-id="b59f6-130">Azure backup agent</span></span>

<span data-ttu-id="b59f6-131">Azure 備份提供 hello 選項 toonot 只備份完整的 Vm，但也檔案及目錄透過 hello 備份代理程式，其具有 toobe hello 客體作業系統上安裝。</span><span class="sxs-lookup"><span data-stu-id="b59f6-131">Azure backup offers hello option toonot only back up complete VMs, but also files and directories via hello backup agent, which has toobe installed on hello guest OS.</span></span> <span data-ttu-id="b59f6-132">但年 12 月從 2016年開始，此代理程式只支援在 Windows 上 (請參閱[備份使用 hello Resource Manager 部署模型的 Windows 伺服器或用戶端 tooAzure](../../../backup/backup-configure-vault.md))。</span><span class="sxs-lookup"><span data-stu-id="b59f6-132">But as of December 2016, this agent is only supported on Windows (see [Back up a Windows Server or client tooAzure using hello Resource Manager deployment model](../../../backup/backup-configure-vault.md)).</span></span>

<span data-ttu-id="b59f6-133">因應措施 toofirst 複本 （例如，透過 SAMBA 共用） 的 SAP HANA 備份檔案 tooa 在 Azure 上的 Windows VM，然後從該處使用 hello Azure 備份代理程式。</span><span class="sxs-lookup"><span data-stu-id="b59f6-133">A workaround is toofirst copy SAP HANA backup files tooa Windows VM on Azure (for example, via SAMBA share) and then use hello Azure backup agent from there.</span></span> <span data-ttu-id="b59f6-134">雖然可行，它會增加複雜度和 hello 備份變慢或還原程序稍微到期 toohello hello Linux 與 hello Windows VM 之間的複製。</span><span class="sxs-lookup"><span data-stu-id="b59f6-134">While it is technically possible, it would add complexity and slow down hello backup or restore process quite a bit due toohello copy between hello Linux and hello Windows VM.</span></span> <span data-ttu-id="b59f6-135">不建議 toofollow 這種方法。</span><span class="sxs-lookup"><span data-stu-id="b59f6-135">It is not recommended toofollow this approach.</span></span>

## <a name="azure-blobxfer-utility-details"></a><span data-ttu-id="b59f6-136">Azure blobxfer 公用程式詳細資料</span><span class="sxs-lookup"><span data-stu-id="b59f6-136">Azure blobxfer utility details</span></span>

<span data-ttu-id="b59f6-137">其中一個 toostore 目錄與 Azure 儲存體上的檔案，可以使用 CLI 或 PowerShell，或開發工具，使用其中一種 hello [Azure Sdk](https://azure.microsoft.com/downloads/)。</span><span class="sxs-lookup"><span data-stu-id="b59f6-137">toostore directories and files on Azure storage, one could use CLI or PowerShell, or develop a tool using one of hello [Azure SDKs](https://azure.microsoft.com/downloads/).</span></span> <span data-ttu-id="b59f6-138">也有一個已備妥要使用公用程式，AzCopy，來複製資料 tooAzure 存放區，但是它只是 Windows (請參閱[hello AzCopy 命令列公用程式使用傳輸資料](../../../storage/common/storage-use-azcopy.md))。</span><span class="sxs-lookup"><span data-stu-id="b59f6-138">There is also a ready-to-use utility, AzCopy, for copying data tooAzure storage, but it is Windows only (see [Transfer data with hello AzCopy Command-Line Utility](../../../storage/common/storage-use-azcopy.md)).</span></span>

<span data-ttu-id="b59f6-139">因此，使用 blobxfer 來複製 SAP HANA 備份檔案。</span><span class="sxs-lookup"><span data-stu-id="b59f6-139">Therefore blobxfer was used for copying SAP HANA backup files.</span></span> <span data-ttu-id="b59f6-140">blobxfer 是開放原始碼，可從 [GitHub](https://github.com/Azure/blobxfer) 取得，許多客戶在生產環境中使用它。</span><span class="sxs-lookup"><span data-stu-id="b59f6-140">It is open source, used by many customers in production environments, and available on [GitHub](https://github.com/Azure/blobxfer).</span></span> <span data-ttu-id="b59f6-141">直接 tooeither Azure blob 儲存體或 Azure 的檔案共用，此工具可讓一個 toocopy 資料。</span><span class="sxs-lookup"><span data-stu-id="b59f6-141">This tool allows one toocopy data directly tooeither Azure blob storage or Azure file share.</span></span> <span data-ttu-id="b59f6-142">它也提供各種實用的功能，例如 md5 雜湊、複製含多個檔案的目錄時可使用自動平行處理原則。</span><span class="sxs-lookup"><span data-stu-id="b59f6-142">It also offers a range of useful features, like md5 hash or automatic parallelism when copying a directory with multiple files.</span></span>

## <a name="sap-hana-backup-performance"></a><span data-ttu-id="b59f6-143">SAP HANA 備份的效能</span><span class="sxs-lookup"><span data-stu-id="b59f6-143">SAP HANA backup performance</span></span>

![在 SAP HANA Studio hello SAP HANA 備份主控台是這個螢幕擷取畫面](media/sap-hana-backup-file-level/image023.png)

<span data-ttu-id="b59f6-145">在 SAP HANA Studio hello SAP HANA 備份主控台是這個螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="b59f6-145">This screenshot is of hello SAP HANA backup console in SAP HANA Studio.</span></span> <span data-ttu-id="b59f6-146">約有 42 分鐘 toodo hello 備份所需的 hello 230 GB 單一標準的 Azure 儲存體磁碟上附加 toohello HANA VM 使用 XFS 檔案系統。</span><span class="sxs-lookup"><span data-stu-id="b59f6-146">It took about 42 minutes toodo hello backup of hello 230 GB on a single Azure standard storage disk attached toohello HANA VM using XFS file system.</span></span>

![這個螢幕擷取畫面的 YaST 位於 hello SAP HANA 測試 VM](media/sap-hana-backup-file-level/image024.png)

<span data-ttu-id="b59f6-148">這個螢幕擷取畫面是 YaST hello SAP HANA 測試 VM 上。</span><span class="sxs-lookup"><span data-stu-id="b59f6-148">This screenshot is of YaST on hello SAP HANA test VM.</span></span> <span data-ttu-id="b59f6-149">一個可以如同先前所述，請參閱 SAP HANA 備份的 hello 1 TB 單一磁碟。</span><span class="sxs-lookup"><span data-stu-id="b59f6-149">One can see hello 1-TB single disk for SAP HANA backup as mentioned before.</span></span> <span data-ttu-id="b59f6-150">花費約有 42 分鐘 toobackup 230 GB。</span><span class="sxs-lookup"><span data-stu-id="b59f6-150">It took about 42 minutes toobackup 230 GB.</span></span> <span data-ttu-id="b59f6-151">此外，還連結了五個 200 GB 的磁碟並建立了軟體 RAID md0，而且在這五個 Azure 資料磁碟上串接。</span><span class="sxs-lookup"><span data-stu-id="b59f6-151">In addition, five 200-GB disks were attached and software RAID md0 created, with striping on top of these five Azure data disks.</span></span>

![重複的 hello 相同的備份軟體 RAID 使用等量五個跨連結 Azure 標準儲存體資料磁碟](media/sap-hana-backup-file-level/image025.png)

<span data-ttu-id="b59f6-153">重複 hello 相同的備份軟體 RAID 使用等量五個跨 42 分鐘 too10 分鐘後關閉附加 Azure 標準儲存體的資料磁碟回到 hello 備份時間。</span><span class="sxs-lookup"><span data-stu-id="b59f6-153">Repeating hello same backup on software RAID with striping across five attached Azure standard storage data disks brought hello backup time from 42 minutes down too10 minutes.</span></span> <span data-ttu-id="b59f6-154">hello 磁碟附加但不快取 toohello VM。</span><span class="sxs-lookup"><span data-stu-id="b59f6-154">hello disks were attached without caching toohello VM.</span></span> <span data-ttu-id="b59f6-155">因此，明顯重要的磁碟寫入輸送量為 hello 備份時間。</span><span class="sxs-lookup"><span data-stu-id="b59f6-155">So it is obvious how important disk write throughput is for hello backup time.</span></span> <span data-ttu-id="b59f6-156">其中一個無法再交換器 tooAzure premium 儲存體 toofurther 加速 hello 程序，以獲得最佳效能。</span><span class="sxs-lookup"><span data-stu-id="b59f6-156">One could then switch tooAzure premium storage toofurther accelerate hello process for optimal performance.</span></span> <span data-ttu-id="b59f6-157">一般而言，生產系統應該使用 Azure 進階儲存體。</span><span class="sxs-lookup"><span data-stu-id="b59f6-157">In general, Azure premium storage should be used for production systems.</span></span>

## <a name="copy-sap-hana-backup-files-tooazure-blob-storage"></a><span data-ttu-id="b59f6-158">複製 SAP HANA 備份檔案 tooAzure blob 儲存體</span><span class="sxs-lookup"><span data-stu-id="b59f6-158">Copy SAP HANA backup files tooAzure blob storage</span></span>

<span data-ttu-id="b59f6-159">2016 年 12 月的 hello 最佳選項 tooquickly 存放區 SAP HANA 備份檔案是 Azure blob 儲存體。</span><span class="sxs-lookup"><span data-stu-id="b59f6-159">As of December 2016, hello best option tooquickly store SAP HANA backup files is Azure blob storage.</span></span> <span data-ttu-id="b59f6-160">一個單一的 blob 容器已限制為 500 TB，滿足大多數的 SAP HANA 系統，在 Azure，tookeep 足夠 SAP HANA 備份 GS5 VM 中執行。</span><span class="sxs-lookup"><span data-stu-id="b59f6-160">One single blob container has a limit of 500 TB, enough for most SAP HANA systems, running in a GS5 VM on Azure, tookeep sufficient SAP HANA backups.</span></span> <span data-ttu-id="b59f6-161">客戶有 hello 選擇&quot;熱&quot;和&quot;冷&quot;blob 儲存體 (請參閱[Azure Blob 儲存體： 熱和冷卻儲存層](../../../storage/blobs/storage-blob-storage-tiers.md))。</span><span class="sxs-lookup"><span data-stu-id="b59f6-161">Customers have hello choice between &quot;hot&quot; and &quot;cold&quot; blob storage (see [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md)).</span></span>

<span data-ttu-id="b59f6-162">Hello blobxfer 工具，很容易 toocopy hello SAP HANA 備份檔案直接 tooAzure blob 儲存體。</span><span class="sxs-lookup"><span data-stu-id="b59f6-162">With hello blobxfer tool, it is easy toocopy hello SAP HANA backup files directly tooAzure blob storage.</span></span>

![其中一個可以在此處查看完整的 SAP HANA 檔案備份的 hello 檔案](media/sap-hana-backup-file-level/image026.png)

<span data-ttu-id="b59f6-164">其中一個可以在這裡看到 hello 檔案的完整的 SAP HANA 檔案備份。</span><span class="sxs-lookup"><span data-stu-id="b59f6-164">Here one can see hello files of a full SAP HANA file backup.</span></span> <span data-ttu-id="b59f6-165">有四個檔案而 hello 最大的一個有大約 230 GB。</span><span class="sxs-lookup"><span data-stu-id="b59f6-165">There are four files and hello biggest one has roughly 230 GB.</span></span>

![花費大約 3000 秒 toocopy hello 230 GB tooan Azure 標準儲存體帳戶 blob 容器](media/sap-hana-backup-file-level/image027.png)

<span data-ttu-id="b59f6-167">不使用 md5 雜湊 hello 初始的測試中，花費的大約 3000 秒 toocopy hello 230 GB tooan Azure 標準儲存體帳戶 blob 容器。</span><span class="sxs-lookup"><span data-stu-id="b59f6-167">Not using md5 hash in hello initial test, it took roughly 3000 seconds toocopy hello 230 GB tooan Azure standard storage account blob container.</span></span>

![在這個螢幕擷取畫面，其中一個可以查看其外觀上 hello Azure 入口網站](media/sap-hana-backup-file-level/image028.png)

<span data-ttu-id="b59f6-169">在這個螢幕擷取畫面，其中一個可以查看其外觀 hello Azure 入口網站上。</span><span class="sxs-lookup"><span data-stu-id="b59f6-169">In this screenshot, one can see how it looks on hello Azure portal.</span></span> <span data-ttu-id="b59f6-170">名為的 blob 容器&quot;sap-hana-備份&quot;已建立，而且包含 hello 四個 blob，代表 hello SAP HANA 備份檔案。</span><span class="sxs-lookup"><span data-stu-id="b59f6-170">A blob container named &quot;sap-hana-backups&quot; was created and includes hello four blobs, which represent hello SAP HANA backup files.</span></span> <span data-ttu-id="b59f6-171">其中一個的大小約為 230 GB。</span><span class="sxs-lookup"><span data-stu-id="b59f6-171">One of them has a size of roughly 230 GB.</span></span>

<span data-ttu-id="b59f6-172">hello HANA Studio 備份主控台可讓一個 toorestrict hello 檔案大小上限的 HANA 備份檔案。</span><span class="sxs-lookup"><span data-stu-id="b59f6-172">hello HANA Studio backup console allows one toorestrict hello max file size of HANA backup files.</span></span> <span data-ttu-id="b59f6-173">在 hello 範例環境中，它會藉由多個較小的備份檔案，而不是一個大型的 230 GB 檔案可能 toohave 提升效能。</span><span class="sxs-lookup"><span data-stu-id="b59f6-173">In hello sample environment, it improved performance by making it possible toohave multiple smaller backup files, instead of one large 230-GB file.</span></span>

![設定 hello 備份檔案大小限制 hello HANA 端規定 &#39; t 改善 hello 備份時間](media/sap-hana-backup-file-level/image029.png)

<span data-ttu-id="b59f6-175">設定 hello 備份檔案大小限制 hello HANA 端規定 &#39; t 改善 hello 備份時間，，因為 hello 檔案會寫入循序圖中所示。</span><span class="sxs-lookup"><span data-stu-id="b59f6-175">Setting hello backup file size limit on hello HANA side doesn&#39;t improve hello backup time, because hello files are written sequentially as shown in this figure.</span></span> <span data-ttu-id="b59f6-176">hello 檔案大小上限設定 too60 GB，因此 hello 備份單一檔案建立四個大型資料檔案，而不是 hello 230 GB。</span><span class="sxs-lookup"><span data-stu-id="b59f6-176">hello file size limit was set too60 GB, so hello backup created four large data files instead of hello 230-GB single file.</span></span>

![tootest 的平行處理原則的 hello blobxfer 工具 hello 檔案大小上限為 HANA 備份然後將其設定 too15 GB](media/sap-hana-backup-file-level/image030.png)

<span data-ttu-id="b59f6-178">tootest 的平行處理原則的 hello blobxfer 工具 hello 檔案大小上限為 HANA 備份然後將其設定 too15 GB，導致 19 的備份檔案。</span><span class="sxs-lookup"><span data-stu-id="b59f6-178">tootest parallelism of hello blobxfer tool, hello max file size for HANA backups was then set too15 GB, which resulted in 19 backup files.</span></span> <span data-ttu-id="b59f6-179">此設定從下 too875 秒的 3000 秒回到 blobxfer toocopy hello 230 GB tooAzure blob 儲存體的 hello 時間。</span><span class="sxs-lookup"><span data-stu-id="b59f6-179">This configuration brought hello time for blobxfer toocopy hello 230 GB tooAzure blob storage from 3000 seconds down too875 seconds.</span></span>

<span data-ttu-id="b59f6-180">這個結果會因為 60 MB/秒的寫入 Azure blob toohello 限制。</span><span class="sxs-lookup"><span data-stu-id="b59f6-180">This result is due toohello limit of 60 MB/sec for writing an Azure blob.</span></span> <span data-ttu-id="b59f6-181">透過多個 blob 的平行處理原則可以解決 hello 瓶頸，但沒有一個缺點： 增加效能的 hello blobxfer 工具 toocopy 這些 HANA 備份檔案 tooAzure blob 儲存體放負載 hello HANA VM 和 hello 網路上。</span><span class="sxs-lookup"><span data-stu-id="b59f6-181">Parallelism via multiple blobs solves hello bottleneck, but there is a downside: increasing performance of hello blobxfer tool toocopy all these HANA backup files tooAzure blob storage puts load on both hello HANA VM and hello network.</span></span> <span data-ttu-id="b59f6-182">HANA 系統的作業會受影響。</span><span class="sxs-lookup"><span data-stu-id="b59f6-182">Operation of HANA system becomes impacted.</span></span>

## <a name="blob-copy-of-dedicated-azure-data-disks-in-backup-software-raid"></a><span data-ttu-id="b59f6-183">在備份軟體 RAID 中進行 Azure 專用資料磁碟的 Blob 複製</span><span class="sxs-lookup"><span data-stu-id="b59f6-183">Blob copy of dedicated Azure data disks in backup software RAID</span></span>

<span data-ttu-id="b59f6-184">不同於 hello 手動 VM 資料磁碟備份，在其中一個這種方法不會備份所有 hello 資料磁碟上的 VM toosave hello 整個 SAP 安裝，包括 HANA 資料 HANA 記錄檔和組態檔。</span><span class="sxs-lookup"><span data-stu-id="b59f6-184">Unlike hello manual VM data disk backup, in this approach one does not back up all hello data disks on a VM toosave hello whole SAP installation, including HANA data, HANA log files, and config files.</span></span> <span data-ttu-id="b59f6-185">相反地，hello 概念是專用的 toohave 軟體 RAID 具有條狀配置跨多個 Azure 資料 Vhd 來儲存完整的 SAP HANA 檔案備份。</span><span class="sxs-lookup"><span data-stu-id="b59f6-185">Instead, hello idea is toohave dedicated software RAID with striping across multiple Azure data VHDs for storing a full SAP HANA file backup.</span></span> <span data-ttu-id="b59f6-186">其中一個複製只有這些磁碟，其中有 hello SAP HANA 備份。</span><span class="sxs-lookup"><span data-stu-id="b59f6-186">One copies only these disks, which have hello SAP HANA backup.</span></span> <span data-ttu-id="b59f6-187">它們無法輕鬆地保存在專用的 HANA 備份儲存體帳戶，或附加專用 tooa&quot;備份管理 VM&quot;以便進一步處理。</span><span class="sxs-lookup"><span data-stu-id="b59f6-187">They could easily be kept in a dedicated HANA backup storage account, or attached tooa dedicated &quot;backup management VM&quot; for further processing.</span></span>

![涉及的所有 Vhd 已都複製使用 hello * * 開始-azurestorageblobcopy * * PowerShell 命令](media/sap-hana-backup-file-level/image031.png)

<span data-ttu-id="b59f6-189">涉及的所有 Vhd hello 備份 toohello 本機軟體 RAID 已完成之後，已都複製使用 hello**開始 azurestorageblobcopy** PowerShell 命令 (請參閱[開始 AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy))。</span><span class="sxs-lookup"><span data-stu-id="b59f6-189">After hello backup toohello local software RAID was completed, all VHDs involved were copied using hello **start-azurestorageblobcopy** PowerShell command (see [Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span></span> <span data-ttu-id="b59f6-190">它只會影響 hello 專用保持 hello 備份檔案的檔案系統，如有任何疑慮 hello 磁碟上的 SAP HANA 資料或記錄檔一致性。</span><span class="sxs-lookup"><span data-stu-id="b59f6-190">As it only affects hello dedicated file system for keeping hello backup files, there are no concerns about SAP HANA data or log file consistency on hello disk.</span></span> <span data-ttu-id="b59f6-191">此命令的優點是它的運作時 hello VM 仍然會保持連線。</span><span class="sxs-lookup"><span data-stu-id="b59f6-191">A benefit of this command is that it works while hello VM stays online.</span></span> <span data-ttu-id="b59f6-192">toobe 特定的處理序寫入 toohello 備份等量集，可確定 toounmount 前面 hello blob 複製，並將其事後重新裝載。</span><span class="sxs-lookup"><span data-stu-id="b59f6-192">toobe certain that no process writes toohello backup stripe set, be sure toounmount it before hello blob copy, and mount it again afterwards.</span></span> <span data-ttu-id="b59f6-193">或其中一個可以使用適當太&quot;凍結&quot;hello 檔案系統。</span><span class="sxs-lookup"><span data-stu-id="b59f6-193">Or one could use an appropriate way too&quot;freeze&quot; hello file system.</span></span> <span data-ttu-id="b59f6-194">例如，透過 xfs\_hello XFS 檔案系統凍結。</span><span class="sxs-lookup"><span data-stu-id="b59f6-194">For example, via xfs\_freeze for hello XFS file system.</span></span>

![這個螢幕擷取畫面顯示 hello hello Azure 入口網站上的 vhd 容器中的 hello 的 blob 清單](media/sap-hana-backup-file-level/image032.png)

<span data-ttu-id="b59f6-196">這個螢幕擷取畫面顯示 hello 的 blob 清單中 hello &quot;vhd&quot; hello Azure 入口網站上的容器。</span><span class="sxs-lookup"><span data-stu-id="b59f6-196">This screenshot shows hello list of blobs in hello &quot;vhds&quot; container on hello Azure portal.</span></span> <span data-ttu-id="b59f6-197">hello 螢幕擷取畫面顯示 hello 五個 Vhd，其 toohello SAP HANA 伺服器 VM tooserve 做為附加 hello 軟體 RAID tookeep SAP HANA 備份檔案。</span><span class="sxs-lookup"><span data-stu-id="b59f6-197">hello screenshot shows hello five VHDs, which were attached toohello SAP HANA server VM tooserve as hello software RAID tookeep SAP HANA backup files.</span></span> <span data-ttu-id="b59f6-198">它也會顯示 hello 拍攝透過 hello blob 複製命令中的 5 個複本。</span><span class="sxs-lookup"><span data-stu-id="b59f6-198">It also shows hello five copies, which were taken via hello blob copy command.</span></span>

![為了測試用途，hello hello SAP HANA 備份軟體 RAID 磁碟副本是附加的 toohello 應用程式伺服器 VM](media/sap-hana-backup-file-level/image033.png)

<span data-ttu-id="b59f6-200">為了測試用途，hello hello SAP HANA 備份軟體 RAID 磁碟副本是附加的 toohello 應用程式伺服器 VM。</span><span class="sxs-lookup"><span data-stu-id="b59f6-200">For testing purposes, hello copies of hello SAP HANA backup software RAID disks were attached toohello app server VM.</span></span>

![hello 應用程式伺服器 VM 關機 tooattach hello 磁碟複製](media/sap-hana-backup-file-level/image034.png)

<span data-ttu-id="b59f6-202">hello 應用程式伺服器 VM 已關閉 tooattach hello 磁碟複本。</span><span class="sxs-lookup"><span data-stu-id="b59f6-202">hello app server VM was shut down tooattach hello disk copies.</span></span> <span data-ttu-id="b59f6-203">啟動之後 hello VM，hello 磁碟和 hello RAID 發現正確 （透過 UUID 掛接）。</span><span class="sxs-lookup"><span data-stu-id="b59f6-203">After starting hello VM, hello disks and hello RAID were discovered correctly (mounted via UUID).</span></span> <span data-ttu-id="b59f6-204">Hello 掛接點遺失時，透過 hello YaST partitioner 建立時所。</span><span class="sxs-lookup"><span data-stu-id="b59f6-204">Only hello mount point was missing, which was created via hello YaST partitioner.</span></span> <span data-ttu-id="b59f6-205">之後 hello SAP HANA 備份檔案複製作業系統層級上變為可見。</span><span class="sxs-lookup"><span data-stu-id="b59f6-205">Afterwards hello SAP HANA backup file copies became visible on OS level.</span></span>

## <a name="copy-sap-hana-backup-files-toonfs-share"></a><span data-ttu-id="b59f6-206">將 SAP HANA tooNFS 共用的備份檔案複製</span><span class="sxs-lookup"><span data-stu-id="b59f6-206">Copy SAP HANA backup files tooNFS share</span></span>

<span data-ttu-id="b59f6-207">toolessen hello 對可能影響 hello SAP HANA 系統的效能或磁碟空間的觀點來看，一個可能會考慮 hello SAP HANA 備份檔案儲存在上對 NFS 共用。</span><span class="sxs-lookup"><span data-stu-id="b59f6-207">toolessen hello potential impact on hello SAP HANA system from a performance or disk space perspective, one might consider storing hello SAP HANA backup files on an NFS share.</span></span> <span data-ttu-id="b59f6-208">技術上運作，但表示為 hello NFS 共用的 hello 主機使用第二個 Azure VM。</span><span class="sxs-lookup"><span data-stu-id="b59f6-208">Technically it works, but it means using a second Azure VM as hello host of hello NFS share.</span></span> <span data-ttu-id="b59f6-209">它不應該是較小的 VM 大小，因為 toohello VM 網路頻寬。</span><span class="sxs-lookup"><span data-stu-id="b59f6-209">It should not be a small VM size, due toohello VM network bandwidth.</span></span> <span data-ttu-id="b59f6-210">它會使意義上，然後關閉這 tooshut&quot;備份 VM&quot; ，並且只會讓它註冊執行 hello SAP HANA 備份。</span><span class="sxs-lookup"><span data-stu-id="b59f6-210">It would make sense then tooshut down this &quot;backup VM&quot; and only bring it up for executing hello SAP HANA backup.</span></span> <span data-ttu-id="b59f6-211">NFS 上撰寫共用負載 hello 網路上和影響 hello SAP HANA 系統，但是只管理 hello 備份檔案，之後在 hello&quot;備份 VM&quot;就不會影響 hello SAP HANA 系統完全。</span><span class="sxs-lookup"><span data-stu-id="b59f6-211">Writing on an NFS share puts load on hello network and impacts hello SAP HANA system, but merely managing hello backup files afterwards on hello &quot;backup VM&quot; would not influence hello SAP HANA system at all.</span></span>

![從另一個 Azure VM 對 NFS 共用已掛接的 toohello SAP HANA 伺服器 VM](media/sap-hana-backup-file-level/image035.png)

<span data-ttu-id="b59f6-213">tooverify hello NFS 使用大小寫，從另一個 Azure VM 對 NFS 共用已掛接的 toohello SAP HANA 伺服器 VM。</span><span class="sxs-lookup"><span data-stu-id="b59f6-213">tooverify hello NFS use case, an NFS share from another Azure VM was mounted toohello SAP HANA server VM.</span></span> <span data-ttu-id="b59f6-214">沒有套用任何特別的 NFS 微調。</span><span class="sxs-lookup"><span data-stu-id="b59f6-214">There was no special NFS tuning applied.</span></span>

![花費 1 小時 46 分鐘 toodo hello 備份直接](media/sap-hana-backup-file-level/image036.png)

<span data-ttu-id="b59f6-216">hello NFS 共用已快速等量集，例如 hello SAP HANA 伺服器 hello 其中一個。</span><span class="sxs-lookup"><span data-stu-id="b59f6-216">hello NFS share was a fast stripe set, like hello one on hello SAP HANA server.</span></span> <span data-ttu-id="b59f6-217">儘管如此，花費 1 小時到 46 分鐘 toodo hello hello NFS 共用，而不是 10 分鐘，直接在備份時寫入 tooa 本機條狀磁碟組。</span><span class="sxs-lookup"><span data-stu-id="b59f6-217">Nevertheless, it took 1 hour and 46 minutes toodo hello backup directly on hello NFS share instead of 10 minutes, when writing tooa local stripe set.</span></span>

![hello 或者未在 1 小時 43 分鐘更快](media/sap-hana-backup-file-level/image037.png)

<span data-ttu-id="b59f6-219">hello 另一種進行備份 tooa 本機等量集，並且複製 toohello 作業系統層級的 NFS 共用 (簡單**cp avr**命令) 不是更快。</span><span class="sxs-lookup"><span data-stu-id="b59f6-219">hello alternative of doing a backup tooa local stripe set and copying toohello NFS share on OS level (a simple **cp -avr** command) wasn't much quicker.</span></span> <span data-ttu-id="b59f6-220">花了 1 小時 43 分鐘。</span><span class="sxs-lookup"><span data-stu-id="b59f6-220">It took 1 hour and 43 minutes.</span></span>

<span data-ttu-id="b59f6-221">因此它的運作方式，但是效能不適合用來測試備份的 hello 230 GB。</span><span class="sxs-lookup"><span data-stu-id="b59f6-221">So it works, but performance wasn't good for hello 230-GB backup test.</span></span> <span data-ttu-id="b59f6-222">若遇到數 TB 的資料，可能會更糟。</span><span class="sxs-lookup"><span data-stu-id="b59f6-222">It would look even worse for multi terabytes.</span></span>

## <a name="copy-sap-hana-backup-files-tooazure-file-service"></a><span data-ttu-id="b59f6-223">複製 SAP HANA 備份檔案 tooAzure 檔案服務</span><span class="sxs-lookup"><span data-stu-id="b59f6-223">Copy SAP HANA backup files tooAzure file service</span></span>

<span data-ttu-id="b59f6-224">Azure 的檔案共用內 Azure Linux VM 的可能 toomount 它。</span><span class="sxs-lookup"><span data-stu-id="b59f6-224">It is possible toomount an Azure file share inside an Azure Linux VM.</span></span> <span data-ttu-id="b59f6-225">hello 文章[如何 toouse Linux 的 Azure 檔案儲存體](../../../storage/files/storage-how-to-use-files-linux.md)詳細說明如何 toodo 它。</span><span class="sxs-lookup"><span data-stu-id="b59f6-225">hello article [How toouse Azure File storage with Linux](../../../storage/files/storage-how-to-use-files-linux.md) provides details on how toodo it.</span></span> <span data-ttu-id="b59f6-226">請記住，目前 Azure 檔案共用有 5 TB 配額的限制，以及每個檔案 1 TB 的檔案大小限制。</span><span class="sxs-lookup"><span data-stu-id="b59f6-226">Keep in mind that there is currently a 5-TB quota limit of one Azure file share, and a file size limit of 1 TB per file.</span></span> <span data-ttu-id="b59f6-227">如需儲存體限制的詳細資訊，請參閱 [Azure 儲存體延展性和效能目標](../../../storage/common/storage-scalability-targets.md) (英文)。</span><span class="sxs-lookup"><span data-stu-id="b59f6-227">See [Azure Storage Scalability and Performance Targets](../../../storage/common/storage-scalability-targets.md) for information on storage limits.</span></span>

<span data-ttu-id="b59f6-228">不過測試顯示，SAP HANA 備份目前不能直接搭配使用這種 CIFS 掛接。</span><span class="sxs-lookup"><span data-stu-id="b59f6-228">Tests have shown, however, that SAP HANA backup doesn&#39;t currently work directly with this kind of CIFS mount.</span></span> <span data-ttu-id="b59f6-229">在 [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529) (英文) 中也提到不建議使用 CIFS。</span><span class="sxs-lookup"><span data-stu-id="b59f6-229">It is also stated in [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529) that CIFS is not recommended.</span></span>

![此圖中 SAP HANA Studio 中的 hello 備份對話方塊會顯示錯誤](media/sap-hana-backup-file-level/image038.png)

<span data-ttu-id="b59f6-231">此圖會顯示錯誤 hello 備份對話方塊，在 SAP HANA Studio 中，在嘗試 tooback 向上直接 tooa CIFS 裝載 Azure 的檔案共用時。</span><span class="sxs-lookup"><span data-stu-id="b59f6-231">This figure shows an error in hello backup dialog in SAP HANA Studio, when trying tooback up directly tooa CIFS-mounted Azure file share.</span></span> <span data-ttu-id="b59f6-232">讓一個具有 toodo VM 檔案系統的標準 SAP HANA 備份第一次，，然後複製 hello 備份檔案從該處 tooAzure 檔案服務。</span><span class="sxs-lookup"><span data-stu-id="b59f6-232">So one has toodo a standard SAP HANA backup into a VM file system first, and then copy hello backup files from there tooAzure file service.</span></span>

![此圖將顯示花費有關 929 秒 toocopy 19 SAP HANA 備份檔案](media/sap-hana-backup-file-level/image039.png)

<span data-ttu-id="b59f6-234">此圖顯示所花費有關 929 秒 toocopy 19 SAP HANA 備份檔案的約略 230 GB toohello Azure 檔案共用的大小總計。</span><span class="sxs-lookup"><span data-stu-id="b59f6-234">This figure shows that it took about 929 seconds toocopy 19 SAP HANA backup files with a total size of roughly 230 GB toohello Azure file share.</span></span>

![hello SAP HANA VM 上的 hello 來源目錄結構已複製的 toohello Azure 檔案共用](media/sap-hana-backup-file-level/image040.png)

<span data-ttu-id="b59f6-236">在這個螢幕擷取畫面，其中一個可以看到 hello SAP HANA VM 上的 hello 來源目錄結構已複製的 toohello Azure 檔案共用： 一個目錄 (hana\_備份\_fsl\_15 gb) 及 19 的個別備份檔案。</span><span class="sxs-lookup"><span data-stu-id="b59f6-236">In this screenshot, one can see that hello source directory structure on hello SAP HANA VM was copied toohello Azure file share: one directory (hana\_backup\_fsl\_15gb) and 19 individual backup files.</span></span>

<span data-ttu-id="b59f6-237">SAP HANA 檔案備份直接支援時，儲存在 Azure 檔案上的 SAP HANA 備份檔案可能是有趣的選項，在未來的 hello。</span><span class="sxs-lookup"><span data-stu-id="b59f6-237">Storing SAP HANA backup files on Azure files could be an interesting option in hello future when SAP HANA file backups support it directly.</span></span> <span data-ttu-id="b59f6-238">或時就有可能透過 NFS 的 toomount Azure 檔案，而且 hello 最大配額限制是相當高於 5 TB。</span><span class="sxs-lookup"><span data-stu-id="b59f6-238">Or when it becomes possible toomount Azure files via NFS and hello maximum quota limit is considerably higher than 5 TB.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b59f6-239">後續步驟</span><span class="sxs-lookup"><span data-stu-id="b59f6-239">Next steps</span></span>
* <span data-ttu-id="b59f6-240">[Azure 虛擬機器上 SAP HANA 的備份指南](sap-hana-backup-guide.md)提供快速入門的概觀和詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="b59f6-240">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="b59f6-241">[SAP HANA 備份為基礎儲存快照集](sap-hana-backup-storage-snapshots.md)hello 儲存快照集式備份選項的描述。</span><span class="sxs-lookup"><span data-stu-id="b59f6-241">[SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describes hello storage snapshot-based backup option.</span></span>
* <span data-ttu-id="b59f6-242">toolearn tooestablish 高可用性和 Azure （大型執行個體） 上的 SAP HANA 災害復原計劃的看到[SAP HANA （大型執行個體） 高可用性和災害復原在 Azure 上的](hana-overview-high-availability-disaster-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="b59f6-242">toolearn how tooestablish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
