---
title: "SAP NetWeaver 的 Azure 虛擬機器規劃和實作指南 | Microsoft Docs"
description: "SAP NetWeaver 的 Azure 虛擬機器規劃和實作指南"
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: 
author: MSSedusch
manager: timlt
editor: 
tags: azure-resource-manager
keywords: 
ms.assetid: d7c59cc1-b2d0-4d90-9126-628f9c7a5538
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 11/08/2016
ms.author: sedusch
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 17b2277de7df2ce534896c73bc9a682b9e72196f
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="azure-virtual-machines-planning-and-implementation-for-sap-netweaver"></a><span data-ttu-id="17c39-103">SAP NetWeaver 的 Azure 虛擬機器規劃和實作指南</span><span class="sxs-lookup"><span data-stu-id="17c39-103">Azure Virtual Machines planning and implementation for SAP NetWeaver</span></span>
[767598]:https://launchpad.support.sap.com/#/notes/767598
[773830]:https://launchpad.support.sap.com/#/notes/773830
[826037]:https://launchpad.support.sap.com/#/notes/826037
[965908]:https://launchpad.support.sap.com/#/notes/965908
[1031096]:https://launchpad.support.sap.com/#/notes/1031096
[1139904]:https://launchpad.support.sap.com/#/notes/1139904
[1173395]:https://launchpad.support.sap.com/#/notes/1173395
[1245200]:https://launchpad.support.sap.com/#/notes/1245200
[1409604]:https://launchpad.support.sap.com/#/notes/1409604
[1558958]:https://launchpad.support.sap.com/#/notes/1558958
[1585981]:https://launchpad.support.sap.com/#/notes/1585981
[1588316]:https://launchpad.support.sap.com/#/notes/1588316
[1590719]:https://launchpad.support.sap.com/#/notes/1590719
[1597355]:https://launchpad.support.sap.com/#/notes/1597355
[1605680]:https://launchpad.support.sap.com/#/notes/1605680
[1619720]:https://launchpad.support.sap.com/#/notes/1619720
[1619726]:https://launchpad.support.sap.com/#/notes/1619726
[1619967]:https://launchpad.support.sap.com/#/notes/1619967
[1750510]:https://launchpad.support.sap.com/#/notes/1750510
[1752266]:https://launchpad.support.sap.com/#/notes/1752266
[1757924]:https://launchpad.support.sap.com/#/notes/1757924
[1757928]:https://launchpad.support.sap.com/#/notes/1757928
[1758182]:https://launchpad.support.sap.com/#/notes/1758182
[1758496]:https://launchpad.support.sap.com/#/notes/1758496
[1772688]:https://launchpad.support.sap.com/#/notes/1772688
[1814258]:https://launchpad.support.sap.com/#/notes/1814258
[1882376]:https://launchpad.support.sap.com/#/notes/1882376
[1909114]:https://launchpad.support.sap.com/#/notes/1909114
[1922555]:https://launchpad.support.sap.com/#/notes/1922555
[1928533]:https://launchpad.support.sap.com/#/notes/1928533
[1941500]:https://launchpad.support.sap.com/#/notes/1941500
[1956005]:https://launchpad.support.sap.com/#/notes/1956005
[1973241]:https://launchpad.support.sap.com/#/notes/1973241
[1984787]:https://launchpad.support.sap.com/#/notes/1984787
[1999351]:https://launchpad.support.sap.com/#/notes/1999351
[2002167]:https://launchpad.support.sap.com/#/notes/2002167
[2015553]:https://launchpad.support.sap.com/#/notes/2015553
[2039619]:https://launchpad.support.sap.com/#/notes/2039619
[2069760]:https://launchpad.support.sap.com/#/notes/2069760
[2121797]:https://launchpad.support.sap.com/#/notes/2121797
[2134316]:https://launchpad.support.sap.com/#/notes/2134316
[2178632]:https://launchpad.support.sap.com/#/notes/2178632
[2191498]:https://launchpad.support.sap.com/#/notes/2191498
[2233094]:https://launchpad.support.sap.com/#/notes/2233094
[2243692]:https://launchpad.support.sap.com/#/notes/2243692

[azure-cli]:../../../cli-install-nodejs.md
[azure-portal]:https://portal.azure.com
[azure-ps]:/powershell/azureps-cmdlets-docs
[azure-quickstart-templates-github]:https://github.com/Azure/azure-quickstart-templates
[azure-script-ps]:https://go.microsoft.com/fwlink/p/?LinkID=395017
[azure-subscription-service-limits]:../../../azure-subscription-service-limits.md
[azure-subscription-service-limits-subscription]:../../../azure-subscription-service-limits.md#subscription-limits

[dbms-guide]:dbms-guide.md
[dbms-guide-2.1]:dbms-guide.md#c7abf1f0-c927-4a7c-9c1d-c7b5b3b7212f
[dbms-guide-2.2]:dbms-guide.md#c8e566f9-21b7-4457-9f7f-126036971a91
[dbms-guide-2.3]:dbms-guide.md#10b041ef-c177-498a-93ed-44b3441ab152
[dbms-guide-2]:dbms-guide.md#65fa79d6-a85f-47ee-890b-22e794f51a64
[dbms-guide-3]:dbms-guide.md#871dfc27-e509-4222-9370-ab1de77021c3
[dbms-guide-5.5.1]:dbms-guide.md#0fef0e79-d3fe-4ae2-85af-73666a6f7268
[dbms-guide-5.5.2]:dbms-guide.md#f9071eff-9d72-4f47-9da4-1852d782087b
[dbms-guide-5.6]:dbms-guide.md#1b353e38-21b3-4310-aeb6-a77e7c8e81c8
[dbms-guide-5.8]:dbms-guide.md#9053f720-6f3b-4483-904d-15dc54141e30
[dbms-guide-5]:dbms-guide.md#3264829e-075e-4d25-966e-a49dad878737
[dbms-guide-8.4.1]:dbms-guide.md#b48cfe3b-48e9-4f5b-a783-1d29155bd573
[dbms-guide-8.4.2]:dbms-guide.md#23c78d3b-ca5a-4e72-8a24-645d141a3f5d
[dbms-guide-8.4.3]:dbms-guide.md#77cd2fbb-307e-4cbf-a65f-745553f72d2c
[dbms-guide-8.4.4]:dbms-guide.md#f77c1436-9ad8-44fb-a331-8671342de818
[dbms-guide-900-sap-cache-server-on-premises]:dbms-guide.md#642f746c-e4d4-489d-bf63-73e80177a0a8

[dbms-guide-figure-100]:media/virtual-machines-shared-sap-dbms-guide/100_storage_account_types.png
[dbms-guide-figure-200]:media/virtual-machines-shared-sap-dbms-guide/200-ha-set-for-dbms-ha.png
[dbms-guide-figure-300]:media/virtual-machines-shared-sap-dbms-guide/300-reference-config-iaas.png
[dbms-guide-figure-400]:media/virtual-machines-shared-sap-dbms-guide/400-sql-2012-backup-to-blob-storage.png
[dbms-guide-figure-500]:media/virtual-machines-shared-sap-dbms-guide/500-sql-2012-backup-to-blob-storage-different-containers.png
[dbms-guide-figure-600]:media/virtual-machines-shared-sap-dbms-guide/600-iaas-maxdb.png
[dbms-guide-figure-700]:media/virtual-machines-shared-sap-dbms-guide/700-livecach-prod.png
[dbms-guide-figure-800]:media/virtual-machines-shared-sap-dbms-guide/800-azure-vm-sap-content-server.png
[dbms-guide-figure-900]:media/virtual-machines-shared-sap-dbms-guide/900-sap-cache-server-on-premises.png

[deployment-guide]:deployment-guide.md
[deployment-guide-2.2]:deployment-guide.md#42ee2bdb-1efc-4ec7-ab31-fe4c22769b94
[deployment-guide-3.1.2]:deployment-guide.md#3688666f-281f-425b-a312-a77e7db2dfab
[deployment-guide-3.2]:deployment-guide.md#db477013-9060-4602-9ad4-b0316f8bb281
[deployment-guide-3.3]:deployment-guide.md#54a1fc6d-24fd-4feb-9c57-ac588a55dff2
[deployment-guide-3.4]:deployment-guide.md#a9a60133-a763-4de8-8986-ac0fa33aa8c1
[deployment-guide-3]:deployment-guide.md#b3253ee3-d63b-4d74-a49b-185e76c4088e
[deployment-guide-4.1]:deployment-guide.md#604bcec2-8b6e-48d2-a944-61b0f5dee2f7
[deployment-guide-4.2]:deployment-guide.md#7ccf6c3e-97ae-4a7a-9c75-e82c37beb18e
[deployment-guide-4.3]:deployment-guide.md#31d9ecd6-b136-4c73-b61e-da4a29bbc9cc
[deployment-guide-4.4.2]:deployment-guide.md#6889ff12-eaaf-4f3c-97e1-7c9edc7f7542
[deployment-guide-4.4]:deployment-guide.md#c7cbb0dc-52a4-49db-8e03-83e7edc2927d
[deployment-guide-4.5.1]:deployment-guide.md#987cf279-d713-4b4c-8143-6b11589bb9d4
[deployment-guide-4.5.2]:deployment-guide.md#408f3779-f422-4413-82f8-c57a23b4fc2f
[deployment-guide-4.5]:deployment-guide.md#d98edcd3-f2a1-49f7-b26a-07448ceb60ca
[deployment-guide-5.1]:deployment-guide.md#bb61ce92-8c5c-461f-8c53-39f5e5ed91f2
[deployment-guide-5.2]:deployment-guide.md#e2d592ff-b4ea-4a53-a91a-e5521edb6cd1
[deployment-guide-5.3]:deployment-guide.md#fe25a7da-4e4e-4388-8907-8abc2d33cfd8

[deployment-guide-configure-monitoring-scenario-1]:deployment-guide.md#ec323ac3-1de9-4c3a-b770-4ff701def65b
[deployment-guide-configure-proxy]:deployment-guide.md#baccae00-6f79-4307-ade4-40292ce4e02d
[deployment-guide-figure-100]:media/virtual-machines-shared-sap-deployment-guide/100-deploy-vm-image.png
[deployment-guide-figure-1000]:media/virtual-machines-shared-sap-deployment-guide/1000-service-properties.png
[deployment-guide-figure-11]:deployment-guide.md#figure-11
[deployment-guide-figure-1100]:media/virtual-machines-shared-sap-deployment-guide/1100-azperflib.png
[deployment-guide-figure-1200]:media/virtual-machines-shared-sap-deployment-guide/1200-cmd-test-login.png
[deployment-guide-figure-1300]:media/virtual-machines-shared-sap-deployment-guide/1300-cmd-test-executed.png
[deployment-guide-figure-14]:deployment-guide.md#figure-14
[deployment-guide-figure-1400]:media/virtual-machines-shared-sap-deployment-guide/1400-azperflib-error-servicenotstarted.png
[deployment-guide-figure-300]:media/virtual-machines-shared-sap-deployment-guide/300-deploy-private-image.png
[deployment-guide-figure-400]:media/virtual-machines-shared-sap-deployment-guide/400-deploy-using-disk.png
[deployment-guide-figure-5]:deployment-guide.md#figure-5
[deployment-guide-figure-50]:media/virtual-machines-shared-sap-deployment-guide/50-forced-tunneling-suse.png
[deployment-guide-figure-500]:media/virtual-machines-shared-sap-deployment-guide/500-install-powershell.png
[deployment-guide-figure-6]:deployment-guide.md#figure-6
[deployment-guide-figure-600]:media/virtual-machines-shared-sap-deployment-guide/600-powershell-version.png
[deployment-guide-figure-7]:deployment-guide.md#figure-7
[deployment-guide-figure-700]:media/virtual-machines-shared-sap-deployment-guide/700-install-powershell-installed.png
[deployment-guide-figure-760]:media/virtual-machines-shared-sap-deployment-guide/760-azure-cli-version.png
[deployment-guide-figure-900]:media/virtual-machines-shared-sap-deployment-guide/900-cmd-update-executed.png
[deployment-guide-figure-azure-cli-installed]:deployment-guide.md#402488e5-f9bb-4b29-8063-1c5f52a892d0
[deployment-guide-figure-azure-cli-version]:deployment-guide.md#0ad010e6-f9b5-4c21-9c09-bb2e5efb3fda
[deployment-guide-install-vm-agent-windows]:deployment-guide.md#b2db5c9a-a076-42c6-9835-16945868e866
[deployment-guide-troubleshooting-chapter]:deployment-guide.md#564adb4f-5c95-4041-9616-6635e83a810b

[deploy-template-cli]:../../../resource-group-template-deploy-cli.md
[deploy-template-portal]:../../../resource-group-template-deploy-portal.md
[deploy-template-powershell]:../../../resource-group-template-deploy.md

[dr-guide-classic]:http://go.microsoft.com/fwlink/?LinkID=521971

[getting-started]:get-started.md
[getting-started-dbms]:get-started.md#1343ffe1-8021-4ce6-a08d-3a1553a4db82
[getting-started-deployment]:get-started.md#6aadadd2-76b5-46d8-8713-e8d63630e955
[getting-started-planning]:get-started.md#3da0389e-708b-4e82-b2a2-e92f132df89c

[getting-started-windows-classic]:../../virtual-machines-windows-classic-sap-get-started.md
[getting-started-windows-classic-dbms]:../../virtual-machines-windows-classic-sap-get-started.md#c5b77a14-f6b4-44e9-acab-4d28ff72a930
[getting-started-windows-classic-deployment]:../../virtual-machines-windows-classic-sap-get-started.md#f84ea6ce-bbb4-41f7-9965-34d31b0098ea
[getting-started-windows-classic-dr]:../../virtual-machines-windows-classic-sap-get-started.md#cff10b4a-01a5-4dc3-94b6-afb8e55757d3
[getting-started-windows-classic-ha-sios]:../../virtual-machines-windows-classic-sap-get-started.md#4bb7512c-0fa0-4227-9853-4004281b1037
[getting-started-windows-classic-planning]:../../virtual-machines-windows-classic-sap-get-started.md#f2a5e9d8-49e4-419e-9900-af783173481c

[ha-guide-classic]:http://go.microsoft.com/fwlink/?LinkId=613056

[install-extension-cli]:virtual-machines-linux-enable-aem.md

[Logo_Linux]:media/virtual-machines-shared-sap-shared/Linux.png
[Logo_Windows]:media/virtual-machines-shared-sap-shared/Windows.png

[msdn-set-azurermvmaemextension]:https://msdn.microsoft.com/library/azure/mt670598.aspx

[planning-guide]:planning-guide.md  
[planning-guide-1.2]:planning-guide.md#e55d1e22-c2c8-460b-9897-64622a34fdff
[planning-guide-11]:planning-guide.md#7cf991a1-badd-40a9-944e-7baae842a058
[planning-guide-11.4.1]:planning-guide.md#5d9d36f9-9058-435d-8367-5ad05f00de77
[planning-guide-11.5]:planning-guide.md#4e165b58-74ca-474f-a7f4-5e695a93204f
[planning-guide-2.1]:planning-guide.md#1625df66-4cc6-4d60-9202-de8a0b77f803
[planning-guide-2.2]:planning-guide.md#f5b3b18c-302c-4bd8-9ab2-c388f1ab3d10
[planning-guide-3.1]:planning-guide.md#be80d1b9-a463-4845-bd35-f4cebdb5424a
[planning-guide-3.2.1]:planning-guide.md#df49dc09-141b-4f34-a4a2-990913b30358
[planning-guide-3.2.2]:planning-guide.md#fc1ac8b2-e54a-487c-8581-d3cc6625e560
[planning-guide-3.2.3]:planning-guide.md#18810088-f9be-4c97-958a-27996255c665
[planning-guide-3.2]:planning-guide.md#8d8ad4b8-6093-4b91-ac36-ea56d80dbf77
[planning-guide-3.3.2]:planning-guide.md#ff5ad0f9-f7f4-4022-9102-af07aef3bc92
[planning-guide-5.1.1]:planning-guide.md#4d175f1b-7353-4137-9d2f-817683c26e53
[planning-guide-5.1.2]:planning-guide.md#e18f7839-c0e2-4385-b1e6-4538453a285c
[planning-guide-5.2.1]:planning-guide.md#1b287330-944b-495d-9ea7-94b83aff73ef
[planning-guide-5.2.2]:planning-guide.md#57f32b1c-0cba-4e57-ab6e-c39fe22b6ec3
[planning-guide-5.2]:planning-guide.md#6ffb9f41-a292-40bf-9e70-8204448559e7
[planning-guide-5.3.1]:planning-guide.md#6e835de8-40b1-4b71-9f18-d45b20959b79
[planning-guide-5.3.2]:planning-guide.md#a43e40e6-1acc-4633-9816-8f095d5a7b6a
[planning-guide-5.4.2]:planning-guide.md#9789b076-2011-4afa-b2fe-b07a8aba58a1
[planning-guide-5.5.1]:planning-guide.md#4efec401-91e0-40c0-8e64-f2dceadff646
[planning-guide-5.5.3]:planning-guide.md#17e0d543-7e8c-4160-a7da-dd7117a1ad9d
[planning-guide-7.1]:planning-guide.md#3e9c3690-da67-421a-bc3f-12c520d99a30
[planning-guide-7]:planning-guide.md#96a77628-a05e-475d-9df3-fb82217e8f14
[planning-guide-9.1]:planning-guide.md#6f0a47f3-a289-4090-a053-2521618a28c3
[planning-guide-azure-premium-storage]:planning-guide.md#ff5ad0f9-f7f4-4022-9102-af07aef3bc92

[planning-guide-figure-100]:media/virtual-machines-shared-sap-planning-guide/100-single-vm-in-azure.png
[planning-guide-figure-1300]:media/virtual-machines-shared-sap-planning-guide/1300-ref-config-iaas-for-sap.png
[planning-guide-figure-1400]:media/virtual-machines-shared-sap-planning-guide/1400-attach-detach-disks.png
[planning-guide-figure-1600]:media/virtual-machines-shared-sap-planning-guide/1600-firewall-port-rule.png
[planning-guide-figure-1700]:media/virtual-machines-shared-sap-planning-guide/1700-single-vm-demo.png
[planning-guide-figure-1900]:media/virtual-machines-shared-sap-planning-guide/1900-vm-set-vnet.png
[planning-guide-figure-200]:media/virtual-machines-shared-sap-planning-guide/200-multiple-vms-in-azure.png
[planning-guide-figure-2100]:media/virtual-machines-shared-sap-planning-guide/2100-s2s.png
[planning-guide-figure-2200]:media/virtual-machines-shared-sap-planning-guide/2200-network-printing.png
[planning-guide-figure-2300]:media/virtual-machines-shared-sap-planning-guide/2300-sapgui-stms.png
[planning-guide-figure-2400]:media/virtual-machines-shared-sap-planning-guide/2400-vm-extension-overview.png
[planning-guide-figure-2500]:media/virtual-machines-shared-sap-planning-guide/planning-monitoring-overview-2502.png
[planning-guide-figure-2600]:media/virtual-machines-shared-sap-planning-guide/2600-sap-router-connection.png
[planning-guide-figure-2700]:media/virtual-machines-shared-sap-planning-guide/2700-exposed-sap-portal.png
[planning-guide-figure-2800]:media/virtual-machines-shared-sap-planning-guide/2800-endpoint-config.png
[planning-guide-figure-2900]:media/virtual-machines-shared-sap-planning-guide/2900-azure-ha-sap-ha.png
[planning-guide-figure-2901]:media/virtual-machines-shared-sap-planning-guide/2901-azure-ha-sap-ha-md.png
[planning-guide-figure-300]:media/virtual-machines-shared-sap-planning-guide/300-vpn-s2s.png
[planning-guide-figure-3000]:media/virtual-machines-shared-sap-planning-guide/3000-sap-ha-on-azure.png
[planning-guide-figure-3200]:media/virtual-machines-shared-sap-planning-guide/3200-sap-ha-with-sql.png
[planning-guide-figure-3201]:media/virtual-machines-shared-sap-planning-guide/3201-sap-ha-with-sql-md.png
[planning-guide-figure-400]:media/virtual-machines-shared-sap-planning-guide/400-vm-services.png
[planning-guide-figure-600]:media/virtual-machines-shared-sap-planning-guide/600-s2s-details.png
[planning-guide-figure-700]:media/virtual-machines-shared-sap-planning-guide/700-decision-tree-deploy-to-azure.png
[planning-guide-figure-800]:media/virtual-machines-shared-sap-planning-guide/800-portal-vm-overview.png
[planning-guide-microsoft-azure-networking]:planning-guide.md#61678387-8868-435d-9f8c-450b2424f5bd
[planning-guide-storage-microsoft-azure-storage-and-data-disks]:planning-guide.md#a72afa26-4bf4-4a25-8cf7-855d6032157f

[powershell-install-configure]:https://docs.microsoft.com/powershell/azure/install-azurerm-ps
[resource-group-authoring-templates]:../../../resource-group-authoring-templates.md
[resource-group-overview]:../../../azure-resource-manager/resource-group-overview.md
[resource-groups-networking]:../../../virtual-network/resource-groups-networking.md
[sap-pam]:https://support.sap.com/pam
[sap-templates-2-tier-marketplace-image]:https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2Fsap-2-tier-marketplace-image%2Fazuredeploy.json
[sap-templates-2-tier-os-disk]:https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2Fsap-2-tier-user-disk%2Fazuredeploy.json
[sap-templates-2-tier-user-image]:https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2Fsap-2-tier-user-image%2Fazuredeploy.json
[sap-templates-3-tier-marketplace-image]:https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2Fsap-3-tier-marketplace-image%2Fazuredeploy.json
[sap-templates-3-tier-user-image]:https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2Fsap-3-tier-user-image%2Fazuredeploy.json
[storage-azure-cli]:../../../storage/common/storage-azure-cli.md
[storage-azure-cli-copy-blobs]:../../../storage/common/storage-azure-cli.md#copy-blobs
[storage-introduction]:../../../storage/common/storage-introduction.md
[storage-powershell-guide-full-copy-vhd]:../../../storage/common/storage-powershell-guide-full.md#how-to-copy-blobs-from-one-storage-container-to-another
[storage-premium-storage-preview-portal]:../../../storage/common/storage-premium-storage.md
[storage-redundancy]:../../../storage/common/storage-redundancy.md
[storage-scalability-targets]:../../../storage/common/storage-scalability-targets.md
[storage-use-azcopy]:../../../storage/common/storage-use-azcopy.md
[template-201-vm-from-specialized-vhd]:https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-from-specialized-vhd
[templates-101-simple-windows-vm]:https://github.com/Azure/azure-quickstart-templates/tree/master/101-simple-windows-vm
[templates-101-vm-from-user-image]:https://github.com/Azure/azure-quickstart-templates/tree/master/101-vm-from-user-image
[virtual-machines-linux-attach-disk-portal]:../../linux/attach-disk-portal.md
[virtual-machines-azure-resource-manager-architecture]:../../../resource-manager-deployment-model.md
[virtual-machines-azurerm-versus-azuresm]:virtual-machines-linux-compare-deployment-models.md
[virtual-machines-windows-classic-configure-oracle-data-guard]:../../virtual-machines-windows-classic-configure-oracle-data-guard.md
[virtual-machines-linux-cli-deploy-templates]:../../linux/cli-deploy-templates.md
[virtual-machines-deploy-rmtemplates-powershell]:../../virtual-machines-windows-ps-manage.md
[virtual-machines-linux-agent-user-guide]:../../linux/agent-user-guide.md
[virtual-machines-linux-agent-user-guide-command-line-options]:../../linux/agent-user-guide.md#command-line-options
[virtual-machines-linux-capture-image]:../../linux/capture-image.md
[virtual-machines-linux-capture-image-resource-manager]:../../linux/capture-image.md
[virtual-machines-linux-capture-image-resource-manager-capture]:../../linux/capture-image.md#step-2-capture-the-vm
[virtual-machines-windows-capture-image-resource-manager]:../../windows/capture-image.md
[virtual-machines-windows-capture-image]:../../virtual-machines-windows-generalize-vhd.md
[virtual-machines-windows-capture-image-prepare-the-vm-for-image-capture]:../../virtual-machines-windows-generalize-vhd.md
[virtual-machines-linux-configure-raid]:../../linux/configure-raid.md
[virtual-machines-linux-configure-lvm]:../../linux/configure-lvm.md
[virtual-machines-linux-classic-create-upload-vhd-step-1]:../../virtual-machines-linux-classic-create-upload-vhd.md#step-1-prepare-the-image-to-be-uploaded
[virtual-machines-linux-create-upload-vhd-suse]:../../linux/suse-create-upload-vhd.md
[virtual-machines-linux-create-upload-vhd-oracle]:../../linux/oracle-create-upload-vhd.md
[virtual-machines-linux-redhat-create-upload-vhd]:../../linux/redhat-create-upload-vhd.md
[virtual-machines-linux-how-to-attach-disk]:../../linux/add-disk.md
[virtual-machines-linux-how-to-attach-disk-how-to-initialize-a-new-data-disk-in-linux]:../../linux/add-disk.md#connect-to-the-linux-vm-to-mount-the-new-disk
[virtual-machines-linux-tutorial]:../../linux/quick-create-cli.md
[virtual-machines-linux-update-agent]:../../linux/update-agent.md
[virtual-machines-manage-availability]:../../linux/manage-availability.md
[virtual-machines-ps-create-preconfigure-windows-resource-manager-vms]:virtual-machines-windows-create-powershell.md
[virtual-machines-sizes-linux]:../../linux/sizes.md
[virtual-machines-sizes-windows]:../../windows/sizes.md
[virtual-machines-windows-classic-ps-sql-alwayson-availability-groups]:./../../windows/sqlclassic/virtual-machines-windows-classic-ps-sql-alwayson-availability-groups.md
[virtual-machines-windows-classic-ps-sql-int-listener]:./../../windows/sqlclassic/virtual-machines-windows-classic-ps-sql-int-listener.md
[virtual-machines-sql-server-high-availability-and-disaster-recovery-solutions]:./../../windows/sql/virtual-machines-windows-sql-high-availability-dr.md
[virtual-machines-sql-server-infrastructure-services]:./../../windows/sql/virtual-machines-windows-sql-server-iaas-overview.md
[virtual-machines-sql-server-performance-best-practices]:./../../windows/sql/virtual-machines-windows-sql-performance.md
[virtual-machines-upload-image-windows-resource-manager]:../../virtual-machines-windows-upload-image.md
[virtual-machines-windows-tutorial]:../../virtual-machines-windows-hero-tutorial.md
[virtual-machines-workload-template-sql-alwayson]:https://azure.microsoft.com/documentation/templates/sql-server-2014-alwayson-dsc/
[virtual-network-deploy-multinic-arm-cli]:../../../virtual-network/virtual-network-deploy-multinic-arm-cli.md
[virtual-network-deploy-multinic-arm-ps]:../../../virtual-network/virtual-network-deploy-multinic-arm-ps.md
[virtual-network-deploy-multinic-arm-template]:../../../virtual-network/virtual-network-deploy-multinic-arm-template.md
[virtual-networks-configure-vnet-to-vnet-connection]:../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md
[virtual-networks-create-vnet-arm-pportal]:../../../virtual-network/virtual-networks-create-vnet-arm-pportal.md
[virtual-networks-manage-dns-in-vnet]:../../../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md
[virtual-networks-multiple-nics-windows]:../../windows/multiple-nics.md
[virtual-networks-multiple-nics-linux]:../../linux/multiple-nics.md
[virtual-networks-nsg]:../../../virtual-network/virtual-networks-nsg.md
[virtual-networks-reserved-private-ip]:../../../virtual-network/virtual-networks-static-private-ip-arm-ps.md
[virtual-networks-static-private-ip-arm-pportal]:../../../virtual-network/virtual-networks-static-private-ip-arm-pportal.md
[virtual-networks-udr-overview]:../../../virtual-network/virtual-networks-udr-overview.md
[vpn-gateway-about-vpn-devices]:../../../vpn-gateway/vpn-gateway-about-vpn-devices.md
[vpn-gateway-create-site-to-site-rm-powershell]:../../../vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md
[vpn-gateway-cross-premises-options]:../../../vpn-gateway/vpn-gateway-plan-design.md
[vpn-gateway-site-to-site-create]:../../../vpn-gateway/vpn-gateway-site-to-site-create.md
[vpn-gateway-vpn-faq]:../../../vpn-gateway/vpn-gateway-vpn-faq.md
[xplat-cli]:../../../cli-install-nodejs.md
[xplat-cli-azure-resource-manager]:../../../xplat-cli-azure-resource-manager.md
[capture-image-linux-step-2-create-vm-image]:../../linux/capture-image.md#step-2-create-vm-image

[!INCLUDE [learn-about-deployment-models](../../../../includes/learn-about-deployment-models-rm-include.md)]

<span data-ttu-id="17c39-117">Microsoft Azure 可讓公司在最短的時間內取得計算和儲存體資源，而不需要冗長的採購週期。</span><span class="sxs-lookup"><span data-stu-id="17c39-117">Microsoft Azure enables companies to acquire compute and storage resources in minimal time without lengthy procurement cycles.</span></span> <span data-ttu-id="17c39-118">Azure 虛擬機器可讓公司將 SAP NetWeaver 應用程式等傳統應用程式部署到 Azure，並擴充其可靠性和可用性，而不需要在內部部署提供進一步資源。</span><span class="sxs-lookup"><span data-stu-id="17c39-118">Azure Virtual Machines allow companies to deploy classical applications, like SAP NetWeaver based applications into Azure and extend their reliability and availability without having further resources available on-premises.</span></span> <span data-ttu-id="17c39-119">Azure 虛擬機器服務也支援跨單位連線能力，可讓公司主動將 Azure 虛擬機器整合到其內部部署網域、私人雲端和 SAP 系統環境。</span><span class="sxs-lookup"><span data-stu-id="17c39-119">Azure Virtual Machine Services also supports cross-premises connectivity, which enables companies to actively integrate Azure Virtual Machines into their on-premises domains, their Private Clouds and their SAP System Landscape.</span></span>
<span data-ttu-id="17c39-120">本技術白皮書說明 Microsoft Azure 虛擬機器的基本概念，並逐步解說在 Azure 中安裝 SAP NetWeaver 的規劃和實作考量，因此請務必先閱讀本文，再開始於 Azure 上實際部署 SAP NetWeaver。</span><span class="sxs-lookup"><span data-stu-id="17c39-120">This white paper describes the fundamentals of Microsoft Azure Virtual Machine and provides a walk-through of planning and implementation considerations for SAP NetWeaver installations in Azure and as such should be the document to read before starting actual deployments of SAP NetWeaver on Azure.</span></span>
<span data-ttu-id="17c39-121">本白皮書會對「SAP 安裝文件」和「SAP 附註」進行補充說明，指出用來在指定平台上安裝和部署 SAP 軟體的主要資源。</span><span class="sxs-lookup"><span data-stu-id="17c39-121">The paper complements the SAP Installation Documentation and SAP Notes, which represent the primary resources for installations and deployments of SAP software on given platforms.</span></span>

## <a name="summary"></a><span data-ttu-id="17c39-122">摘要</span><span class="sxs-lookup"><span data-stu-id="17c39-122">Summary</span></span>
<span data-ttu-id="17c39-123">雲端運算這個廣泛使用的名詞已日益受到 IT 產業的重視，不論是小型公司、大型公司還是跨國企業都是如此。</span><span class="sxs-lookup"><span data-stu-id="17c39-123">Cloud Computing is a widely used term, which is gaining more and more importance within the IT industry, from small companies up to large and multinational corporations.</span></span>

<span data-ttu-id="17c39-124">Microsoft Azure 是 Microsoft 所推出的雲端服務平台，可提供各式各樣的新契機。</span><span class="sxs-lookup"><span data-stu-id="17c39-124">Microsoft Azure is the Cloud Services Platform from Microsoft, which offers a wide spectrum of new possibilities.</span></span> <span data-ttu-id="17c39-125">客戶現在既能將應用程式快速佈建為雲端服務，也能快速取消佈建，因此不會再受到技術或預算所限制。</span><span class="sxs-lookup"><span data-stu-id="17c39-125">Now customers are able to rapidly provision and de-provision applications as a service in the cloud, so they are not limited to technical or budgeting restrictions.</span></span> <span data-ttu-id="17c39-126">與其在硬體基礎結構投入時間和預算，公司寧可專注於應用程式、商業流程及其帶給客戶和使用者的優點。</span><span class="sxs-lookup"><span data-stu-id="17c39-126">Instead of investing time and budget into hardware infrastructure, companies can focus on the application, business processes, and its benefits for customers and users.</span></span>

<span data-ttu-id="17c39-127">透過 Microsoft Azure 虛擬機器服務，Microsoft 提供完整的基礎結構即服務 (IaaS) 平台。</span><span class="sxs-lookup"><span data-stu-id="17c39-127">With Microsoft Azure Virtual Machine Services, Microsoft offers a comprehensive Infrastructure as a Service (IaaS) platform.</span></span> <span data-ttu-id="17c39-128">Azure 虛擬機器 (IaaS) 支援以 SAP NetWeaver 為基礎的應用程式。</span><span class="sxs-lookup"><span data-stu-id="17c39-128">SAP NetWeaver based applications are supported on Azure Virtual Machines (IaaS).</span></span> <span data-ttu-id="17c39-129">本技術白皮書說明如何在作為所選平台的 Microsoft Azure 中，規劃和實作 SAP NetWeaver 應用程式。</span><span class="sxs-lookup"><span data-stu-id="17c39-129">This whitepaper describes how to plan and implement SAP NetWeaver based applications within Microsoft Azure as the platform of choice.</span></span>

<span data-ttu-id="17c39-130">本文著重於兩個主要部分︰</span><span class="sxs-lookup"><span data-stu-id="17c39-130">The paper itself focuses on two main aspects:</span></span>

* <span data-ttu-id="17c39-131">第一個部分說明在 Azure 上部署 SAP NetWeaver 應用程式所支援的兩種模式，</span><span class="sxs-lookup"><span data-stu-id="17c39-131">The first part describes two supported deployment patterns for SAP NetWeaver based applications on Azure.</span></span> <span data-ttu-id="17c39-132">也會說明考慮到 SAP 部署之一般處理 Azure 的方式。</span><span class="sxs-lookup"><span data-stu-id="17c39-132">It also describes general handling of Azure with SAP deployments in mind.</span></span>
* <span data-ttu-id="17c39-133">第二個部分詳細說明如何實作第一個部分所述的兩個不同案例。</span><span class="sxs-lookup"><span data-stu-id="17c39-133">The second part details implementing the two different scenarios described in the first part.</span></span>

<span data-ttu-id="17c39-134">如需其他資源，請參閱本文的[資源][planning-guide-1.2]一章。</span><span class="sxs-lookup"><span data-stu-id="17c39-134">For additional resources see chapter [Resources][planning-guide-1.2] in this document.</span></span>

### <a name="definitions-upfront"></a><span data-ttu-id="17c39-135">預先定義</span><span class="sxs-lookup"><span data-stu-id="17c39-135">Definitions upfront</span></span>
<span data-ttu-id="17c39-136">我們在本文件中使用下列詞彙︰</span><span class="sxs-lookup"><span data-stu-id="17c39-136">Throughout the document, we use the following terms:</span></span>

* <span data-ttu-id="17c39-137">IaaS：基礎結構即服務</span><span class="sxs-lookup"><span data-stu-id="17c39-137">IaaS: Infrastructure as a Service</span></span>
* <span data-ttu-id="17c39-138">PaaS：平台即服務</span><span class="sxs-lookup"><span data-stu-id="17c39-138">PaaS: Platform as a Service</span></span>
* <span data-ttu-id="17c39-139">SaaS：軟體即服務</span><span class="sxs-lookup"><span data-stu-id="17c39-139">SaaS: Software as a Service</span></span>
* <span data-ttu-id="17c39-140">ARM：Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="17c39-140">ARM: Azure Resource Manager</span></span>
* <span data-ttu-id="17c39-141">SAP 元件︰個別 SAP 應用程式，例如 ECC、BW、Solution Manager 或 EP。</span><span class="sxs-lookup"><span data-stu-id="17c39-141">SAP Component: an individual SAP application such as ECC, BW, Solution Manager, or EP.</span></span>  <span data-ttu-id="17c39-142">SAP 元件可以傳統 ABAP 或 Java 技術為基礎，或以非 NetWeaver 應用程式 (例如商務物件) 為基礎。</span><span class="sxs-lookup"><span data-stu-id="17c39-142">SAP components can be based on traditional ABAP or Java technologies or a non-NetWeaver based application such as Business Objects.</span></span>
* <span data-ttu-id="17c39-143">SAP 環境 (SAP Environment)︰一或多個以邏輯方式分組的 SAP 元件，可執行像是開發、QAS、訓練、DR 或生產等商務功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-143">SAP Environment: one or more SAP components logically grouped to perform a business function such as Development, QAS, Training, DR, or Production.</span></span>
* <span data-ttu-id="17c39-144">SAP 架構 (SAP Landscape)︰這是指客戶 IP 環境中的整個 SAP 資產。</span><span class="sxs-lookup"><span data-stu-id="17c39-144">SAP Landscape: This refers to the entire SAP assets in a customer’s IT landscape.</span></span> <span data-ttu-id="17c39-145">SAP 環境包含所有生產和非生產環境。</span><span class="sxs-lookup"><span data-stu-id="17c39-145">The SAP landscape includes all production and non-production environments.</span></span>
* <span data-ttu-id="17c39-146">SAP 系統︰DBMS 層與應用程式層的組合，例如 SAP ERP 開發系統、SAP BW 測試系統、SAP CRM 生產系統等。</span><span class="sxs-lookup"><span data-stu-id="17c39-146">SAP System: The combination of DBMS layer and application layer of, for example, an SAP ERP development system, SAP BW test system, SAP CRM production system, etc..</span></span> <span data-ttu-id="17c39-147">在 Azure 部署中，不支援在內部部署與 Azure 之間分割這兩個層級。</span><span class="sxs-lookup"><span data-stu-id="17c39-147">In Azure deployments, it is not supported to divide these two layers between on-premises and Azure.</span></span> <span data-ttu-id="17c39-148">這表示 SAP 系統可以在內部部署或在 Azure 部署。</span><span class="sxs-lookup"><span data-stu-id="17c39-148">This means an SAP system is either deployed on-premises or it is deployed in Azure.</span></span> <span data-ttu-id="17c39-149">不過，您可以將 SAP 環境的不同系統部署到 Azure 或內部部署。</span><span class="sxs-lookup"><span data-stu-id="17c39-149">However, you can deploy the different systems of an SAP landscape into either Azure or on-premises.</span></span> <span data-ttu-id="17c39-150">例如，您可以在 Azure 中部署 SAP CRM 開發和測試系統，但在內部部署 SAP CRM 生產系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-150">For example, you could deploy the SAP CRM development and test systems in Azure but the SAP CRM production system on-premises.</span></span>
* <span data-ttu-id="17c39-151">僅限雲端的部署︰在此部署中，Azure 訂用帳戶並未透過站對站或 ExpressRoute 連線，連接到內部部署網路基礎結構。</span><span class="sxs-lookup"><span data-stu-id="17c39-151">Cloud-Only deployment: A deployment where the Azure subscription is not connected via a site-to-site or ExpressRoute connection to the on-premises network infrastructure.</span></span> <span data-ttu-id="17c39-152">在一般 Azure 文件中，這類部署也會描述為「僅限雲端」的部署。</span><span class="sxs-lookup"><span data-stu-id="17c39-152">In common Azure documentation these kinds of deployments are also described as ‘Cloud-Only’ deployments.</span></span> <span data-ttu-id="17c39-153">若要存取以此方法部署的「虛擬機器」，可透過網際網路及公用 IP 位址和 (或) 指派給 Azure VM 的公用 DNS 名稱來存取。</span><span class="sxs-lookup"><span data-stu-id="17c39-153">Virtual Machines deployed with this method are accessed through the internet and a public IP address and/or a public DNS name assigned to the VMs in Azure.</span></span> <span data-ttu-id="17c39-154">在這些部署類型中，Microsoft Windows 的內部部署 Active Directory (AD) 和 DNS 不會擴充到 Azure。</span><span class="sxs-lookup"><span data-stu-id="17c39-154">For Microsoft Windows the on-premises Active Directory (AD) and DNS is not extended to Azure in these types of deployments.</span></span> <span data-ttu-id="17c39-155">因此，VM 不是內部部署 Active Directory 的一部分。</span><span class="sxs-lookup"><span data-stu-id="17c39-155">Hence the VMs are not part of the on-premises Active Directory.</span></span> <span data-ttu-id="17c39-156">此規則也適用於使用像是 OpenLDAP + Kerberos 的 Linux 實作。</span><span class="sxs-lookup"><span data-stu-id="17c39-156">Same is true for Linux implementations using, for example, OpenLDAP + Kerberos.</span></span>

> [!NOTE]
> <span data-ttu-id="17c39-157">本文中的僅限雲端部署定義成在 Azure 中以獨佔方式執行的完整 SAP 環境，而不會將 Active Directory/OpenLDAP 或名稱解析從內部部署擴充到公用雲端。</span><span class="sxs-lookup"><span data-stu-id="17c39-157">Cloud-Only deployment in this document is defined as complete SAP landscapes are running exclusively in Azure without extension of Active Directory / OpenLDAP  or name resolution from on-premises into public cloud.</span></span> <span data-ttu-id="17c39-158">SAP 生產系統或組態不支援僅限雲端組態，在此組態中，裝載於 Azure 的 SAP 系統和位於內部部署的資源之間，必須使用 SAP STMS 或其他內部部署資源。</span><span class="sxs-lookup"><span data-stu-id="17c39-158">Cloud-Only configurations are not supported for production SAP systems or configurations where SAP STMS or other on-premises resources need to be used between SAP systems hosted on Azure and resources residing on-premises.</span></span>
>
>

* <span data-ttu-id="17c39-159">跨單位：描述將 VM 部署到 Azure 訂用帳戶的案例，該訂用帳戶在內部部署資料中心與 Azure 之間具有站對站、多站台或 ExpressRoute 連線能力。</span><span class="sxs-lookup"><span data-stu-id="17c39-159">Cross-premises: Describes a scenario where VMs are deployed to an Azure subscription that has site-to-site, multi-site, or ExpressRoute connectivity between the on-premises datacenter(s) and Azure.</span></span> <span data-ttu-id="17c39-160">在一般 Azure 文件中，這類部署也會描述為跨單位案例。</span><span class="sxs-lookup"><span data-stu-id="17c39-160">In common Azure documentation, these kinds of deployments are also described as cross-premises scenarios.</span></span> <span data-ttu-id="17c39-161">連線的原因是為了將內部部署網域、內部部署 Active Directory/OpenLDAP 和內部部署 DNS 延伸到 Azure。</span><span class="sxs-lookup"><span data-stu-id="17c39-161">The reason for the connection is to extend on-premises domains, on-premises Active Directory/OpenLDAP, and on-premises DNS into Azure.</span></span> <span data-ttu-id="17c39-162">內部部署的架構會擴充到訂用帳戶的 Azure 資產。</span><span class="sxs-lookup"><span data-stu-id="17c39-162">The on-premises landscape is extended to the Azure assets of the subscription.</span></span> <span data-ttu-id="17c39-163">在此擴充下，VM 可以是內部部署網域的一部分。</span><span class="sxs-lookup"><span data-stu-id="17c39-163">Having this extension, the VMs can be part of the on-premises domain.</span></span> <span data-ttu-id="17c39-164">內部部署網域的網域使用者可以存取伺服器，並可在這些 VM 上執行服務 (例如 DBMS 服務)，</span><span class="sxs-lookup"><span data-stu-id="17c39-164">Domain users of the on-premises domain can access the servers and can run services on those VMs (like DBMS services).</span></span> <span data-ttu-id="17c39-165">但無法在內部部署的 VM 和 Azure 部署的 VM 之間進行通訊和名稱解析。</span><span class="sxs-lookup"><span data-stu-id="17c39-165">Communication and name resolution between VMs deployed on-premises and Azure deployed VMs is possible.</span></span> <span data-ttu-id="17c39-166">這是大部分 SAP 資產預期要部署的案例。</span><span class="sxs-lookup"><span data-stu-id="17c39-166">This is the scenario we expect most SAP assets to be deployed in.</span></span> <span data-ttu-id="17c39-167">如需詳細資訊，請參閱[這篇文章][vpn-gateway-cross-premises-options]和[這個主題][vpn-gateway-site-to-site-create]。</span><span class="sxs-lookup"><span data-stu-id="17c39-167">For more information, see [this][vpn-gateway-cross-premises-options] article and [this][vpn-gateway-site-to-site-create].</span></span>

> [!NOTE]
> <span data-ttu-id="17c39-168">SAP 生產系統支援跨單位部署 SAP 系統，其中執行 SAP 系統的 Azure 虛擬機器是內部部署網域的成員。</span><span class="sxs-lookup"><span data-stu-id="17c39-168">Cross-premises deployments of SAP systems where Azure Virtual Machines running SAP systems are members of an on-premises domain are supported for production SAP systems.</span></span> <span data-ttu-id="17c39-169">跨單位組態可將部分或完整 SAP 環境部署到 Azure。</span><span class="sxs-lookup"><span data-stu-id="17c39-169">Cross-premises configurations are supported for deploying parts or complete SAP landscapes into Azure.</span></span> <span data-ttu-id="17c39-170">即使在 Azure 中執行完整 SAP 環境，也需要有這些 VM 成為內部部署網域和 ADS/OpenLDAP 的一部分。</span><span class="sxs-lookup"><span data-stu-id="17c39-170">Even running the complete SAP landscape in Azure requires having those VMs being part of on-premises domain and ADS/OpenLDAP.</span></span> <span data-ttu-id="17c39-171">在本文件的先前版本中，我們曾談到混合式 IT 案例，其中「混合式」一詞基本上是指內部部署與 Azure 之間有跨單位連線能力。</span><span class="sxs-lookup"><span data-stu-id="17c39-171">In former versions of the documentation, we talked about Hybrid-IT scenarios, where the term ‘Hybrid’ is rooted in the fact that there is a cross-premises connectivity between on-premises and Azure.</span></span> <span data-ttu-id="17c39-172">此外，Azure 中的 VM 是內部部署 Active Directory/OpenLDAP 的一部分。</span><span class="sxs-lookup"><span data-stu-id="17c39-172">Plus, the fact that the VMs in Azure are part of the on-premises Active Directory / OpenLDAP.</span></span>
>
>

<span data-ttu-id="17c39-173">有些 Microsoft 文件在描述跨單位案例時稍有不同，特別是針對 DBMS HA 組態。</span><span class="sxs-lookup"><span data-stu-id="17c39-173">Some Microsoft documentation describes cross-premises scenarios a bit differently, especially for DBMS HA configurations.</span></span> <span data-ttu-id="17c39-174">在 SAP 相關的文件中，跨單位案例單純是指具有站對站或私人 (ExpressRoute) 連線能力，以及將 SAP 環境分散到內部部署與 Azure 的情況。</span><span class="sxs-lookup"><span data-stu-id="17c39-174">In the case of the SAP-related documents, the cross-premises scenario just boils down to having a site-to-site or private (ExpressRoute) connectivity and the fact that the SAP landscape is distributed between on-premises and Azure.</span></span>  

### <span data-ttu-id="17c39-175"><a name="e55d1e22-c2c8-460b-9897-64622a34fdff"></a>資源</span><span class="sxs-lookup"><span data-stu-id="17c39-175"><a name="e55d1e22-c2c8-460b-9897-64622a34fdff"></a>Resources</span></span>
<span data-ttu-id="17c39-176">以下提供有關在 Azure 上部署 SAP 之主題的其他指南︰</span><span class="sxs-lookup"><span data-stu-id="17c39-176">The following additional guides are available for the topic of SAP deployments on Azure:</span></span>

* <span data-ttu-id="17c39-177">[SAP NetWeaver 的 Azure 虛擬機器規劃和實作指南 (本文件)][planning-guide]</span><span class="sxs-lookup"><span data-stu-id="17c39-177">[Azure Virtual Machines planning and implementation for SAP NetWeaver (this document)][planning-guide]</span></span>
* <span data-ttu-id="17c39-178">[SAP NetWeaver 的 Azure 虛擬機器部署][deployment-guide]</span><span class="sxs-lookup"><span data-stu-id="17c39-178">[Azure Virtual Machines deployment for SAP NetWeaver][deployment-guide]</span></span>
* <span data-ttu-id="17c39-179">[SAP NetWeaver 的 Azure 虛擬機器 DBMS 部署][dbms-guide]</span><span class="sxs-lookup"><span data-stu-id="17c39-179">[Azure Virtual Machines DBMS deployment for SAP NetWeaver][dbms-guide]</span></span>

> [!IMPORTANT]
> <span data-ttu-id="17c39-180">文件中會儘可能使用參考的《SAP 安裝指南》連結 (如需參考 InstGuide-01，請參閱 <http://service.sap.com/instguides>)。</span><span class="sxs-lookup"><span data-stu-id="17c39-180">Wherever possible a link to the referring SAP Installation Guide is used (Reference InstGuide-01, see <http://service.sap.com/instguides>).</span></span> <span data-ttu-id="17c39-181">由於本文只涵蓋 Microsoft Azure 虛擬機器中所安裝之 SAP NetWeaver 系統的特定工作，因此如需必要條件和安裝程序，請務必仔細閱讀 SAP NetWeaver 安裝指南。</span><span class="sxs-lookup"><span data-stu-id="17c39-181">When it comes to the prerequisites and installation process, the SAP NetWeaver Installation Guides should always be read carefully, as this document only covers specific tasks for SAP NetWeaver systems installed in a Microsoft Azure Virtual Machine.</span></span>
>
>

<span data-ttu-id="17c39-182">下列 SAP 附註與 Azure 上的 SAP 主題相關︰</span><span class="sxs-lookup"><span data-stu-id="17c39-182">The following SAP Notes are related to the topic of SAP on Azure:</span></span>

| <span data-ttu-id="17c39-183">附註編號</span><span class="sxs-lookup"><span data-stu-id="17c39-183">Note number</span></span> | <span data-ttu-id="17c39-184">課程名稱</span><span class="sxs-lookup"><span data-stu-id="17c39-184">Title</span></span> |
| --- | --- |
| <span data-ttu-id="17c39-185">[1928533]</span><span class="sxs-lookup"><span data-stu-id="17c39-185">[1928533]</span></span> |<span data-ttu-id="17c39-186">Azure 上的 SAP 應用程式︰支援的產品和大小</span><span class="sxs-lookup"><span data-stu-id="17c39-186">SAP Applications on Azure: Supported Products and Sizing</span></span> |
| <span data-ttu-id="17c39-187">[2015553]</span><span class="sxs-lookup"><span data-stu-id="17c39-187">[2015553]</span></span> |<span data-ttu-id="17c39-188">Microsoft Azure 上的 SAP：支援的必要條件</span><span class="sxs-lookup"><span data-stu-id="17c39-188">SAP on Microsoft Azure: Support Prerequisites</span></span> |
| <span data-ttu-id="17c39-189">[1999351]</span><span class="sxs-lookup"><span data-stu-id="17c39-189">[1999351]</span></span> |<span data-ttu-id="17c39-190">疑難排解適用於 SAP 且已強化的 Azure 監視功能</span><span class="sxs-lookup"><span data-stu-id="17c39-190">Troubleshooting Enhanced Azure Monitoring for SAP</span></span> |
| <span data-ttu-id="17c39-191">[2178632]</span><span class="sxs-lookup"><span data-stu-id="17c39-191">[2178632]</span></span> |<span data-ttu-id="17c39-192">Microsoft Azure 上的 SAP 主要監視度量</span><span class="sxs-lookup"><span data-stu-id="17c39-192">Key Monitoring Metrics for SAP on Microsoft Azure</span></span> |
| <span data-ttu-id="17c39-193">[1409604]</span><span class="sxs-lookup"><span data-stu-id="17c39-193">[1409604]</span></span> |<span data-ttu-id="17c39-194">Windows 上的虛擬化︰增強型監視功能</span><span class="sxs-lookup"><span data-stu-id="17c39-194">Virtualization on Windows: Enhanced Monitoring</span></span> |
| <span data-ttu-id="17c39-195">[2191498]</span><span class="sxs-lookup"><span data-stu-id="17c39-195">[2191498]</span></span> |<span data-ttu-id="17c39-196">Linux 搭配 Azure 上的 SAP：增強型監視</span><span class="sxs-lookup"><span data-stu-id="17c39-196">SAP on Linux with Azure: Enhanced Monitoring</span></span> |
| <span data-ttu-id="17c39-197">[2243692]</span><span class="sxs-lookup"><span data-stu-id="17c39-197">[2243692]</span></span> |<span data-ttu-id="17c39-198">Microsoft Azure (IaaS) VM 上的 Linux：SAP 授權問題</span><span class="sxs-lookup"><span data-stu-id="17c39-198">Linux on Microsoft Azure (IaaS) VM: SAP license issues</span></span> |
| <span data-ttu-id="17c39-199">[1984787]</span><span class="sxs-lookup"><span data-stu-id="17c39-199">[1984787]</span></span> |<span data-ttu-id="17c39-200">SUSE LINUX Enterprise Server 12：安裝注意事項</span><span class="sxs-lookup"><span data-stu-id="17c39-200">SUSE LINUX Enterprise Server 12: Installation notes</span></span> |
| <span data-ttu-id="17c39-201">[2002167]</span><span class="sxs-lookup"><span data-stu-id="17c39-201">[2002167]</span></span> |<span data-ttu-id="17c39-202">Red Hat Enterprise Linux 7.x：安裝和升級</span><span class="sxs-lookup"><span data-stu-id="17c39-202">Red Hat Enterprise Linux 7.x: Installation and Upgrade</span></span> |
| <span data-ttu-id="17c39-203">[2069760]</span><span class="sxs-lookup"><span data-stu-id="17c39-203">[2069760]</span></span> |<span data-ttu-id="17c39-204">Oracle Linux 7.x SAP 安裝和升級</span><span class="sxs-lookup"><span data-stu-id="17c39-204">Oracle Linux 7.x SAP Installation and Upgrade</span></span> |
| <span data-ttu-id="17c39-205">[1597355]</span><span class="sxs-lookup"><span data-stu-id="17c39-205">[1597355]</span></span> |<span data-ttu-id="17c39-206">適用於 Linux 的交換空間建議</span><span class="sxs-lookup"><span data-stu-id="17c39-206">Swap-space recommendation for Linux</span></span> |

<span data-ttu-id="17c39-207">另請參閱 [SCN Wiki](https://wiki.scn.sap.com/wiki/display/HOME/SAPonLinuxNotes) ，其中包含適用於 Linux 的所有 SAP 附註。</span><span class="sxs-lookup"><span data-stu-id="17c39-207">Also read the [SCN Wiki](https://wiki.scn.sap.com/wiki/display/HOME/SAPonLinuxNotes) that contains all SAP Notes for Linux.</span></span>

<span data-ttu-id="17c39-208">有關 Azure 訂用帳戶的一般預設限制和最大限制，請參閱[這篇文章][azure-subscription-service-limits-subscription]。</span><span class="sxs-lookup"><span data-stu-id="17c39-208">General default limitations and maximum limitations of Azure subscriptions can be found in [this article][azure-subscription-service-limits-subscription].</span></span>

## <a name="possible-scenarios"></a><span data-ttu-id="17c39-209">可能的案例</span><span class="sxs-lookup"><span data-stu-id="17c39-209">Possible Scenarios</span></span>
<span data-ttu-id="17c39-210">SAP 常被視為企業內最常見的關鍵任務應用程式。</span><span class="sxs-lookup"><span data-stu-id="17c39-210">SAP is often seen as one of the most mission-critical applications within enterprises.</span></span> <span data-ttu-id="17c39-211">這些應用程式的架構和作業大部分都是非常複雜的，而且務必要確保您符合可用性和效能的需求。</span><span class="sxs-lookup"><span data-stu-id="17c39-211">The architecture and operations of these applications is mostly very complex and ensuring that you meet requirements on availability and performance is important.</span></span>

<span data-ttu-id="17c39-212">因此，不論所選擇的雲端提供者為何，企業都必須仔細考慮哪些應用程式可以在公用雲端環境中執行。</span><span class="sxs-lookup"><span data-stu-id="17c39-212">Thus enterprises have to think carefully about which applications can be run in a public cloud environment, independent of the chosen cloud provider.</span></span>

<span data-ttu-id="17c39-213">以下列出可能在公用雲端環境中部署 SAP NetWeaver 應用程式的系統類型︰</span><span class="sxs-lookup"><span data-stu-id="17c39-213">Possible system types for deploying SAP NetWeaver based applications within public cloud environments are listed below:</span></span>

1. <span data-ttu-id="17c39-214">中型生產系統</span><span class="sxs-lookup"><span data-stu-id="17c39-214">Medium-sized production systems</span></span>
2. <span data-ttu-id="17c39-215">開發系統</span><span class="sxs-lookup"><span data-stu-id="17c39-215">Development systems</span></span>
3. <span data-ttu-id="17c39-216">測試系統</span><span class="sxs-lookup"><span data-stu-id="17c39-216">Testing systems</span></span>
4. <span data-ttu-id="17c39-217">原型系統</span><span class="sxs-lookup"><span data-stu-id="17c39-217">Prototype systems</span></span>
5. <span data-ttu-id="17c39-218">學習/示範系統</span><span class="sxs-lookup"><span data-stu-id="17c39-218">Learning / Demonstration systems</span></span>

<span data-ttu-id="17c39-219">若要成功地將 SAP 系統部署到 Azure IaaS 或一般 IaaS，請務必了解傳統外包服務商或主機服務提供者的供應項目與 IaaS 供應項目之間的顯著差異。</span><span class="sxs-lookup"><span data-stu-id="17c39-219">In order to successfully deploy SAP systems into either Azure IaaS or IaaS in general, it is important to understand the significant differences between the offerings of traditional outsourcers or hosters and IaaS offerings.</span></span> <span data-ttu-id="17c39-220">傳統主機服務提供者或外包服務商會將基礎結構 (網路、儲存體和伺服器類型) 調整成客戶想要裝載的工作負載，但在 IaaS 部署中，客戶有責任選擇適當的工作負載。</span><span class="sxs-lookup"><span data-stu-id="17c39-220">Whereas the traditional hoster or outsourcer adapts infrastructure (network, storage and server type) to the workload a customer wants to host, it is instead the customer’s responsibility to choose the right workload for IaaS deployments.</span></span>

<span data-ttu-id="17c39-221">在第一個步驟中，客戶必須確認下列項目︰</span><span class="sxs-lookup"><span data-stu-id="17c39-221">As a first step, customers need to verify the following items:</span></span>

* <span data-ttu-id="17c39-222">SAP 支援的 Azure VM 類型</span><span class="sxs-lookup"><span data-stu-id="17c39-222">The SAP supported VM types of Azure</span></span>
* <span data-ttu-id="17c39-223">Azure 上的 SAP 支援的產品/版本</span><span class="sxs-lookup"><span data-stu-id="17c39-223">The SAP supported products/releases on Azure</span></span>
* <span data-ttu-id="17c39-224">Azure 中的特定 SAP 版本支援的 OS 和 DBMS 版本</span><span class="sxs-lookup"><span data-stu-id="17c39-224">The supported OS and DBMS releases for the specific SAP releases in Azure</span></span>
* <span data-ttu-id="17c39-225">不同 Azure SKU 所提供的 SAPS 輸送量</span><span class="sxs-lookup"><span data-stu-id="17c39-225">SAPS throughput provided by different Azure SKUs</span></span>

<span data-ttu-id="17c39-226">您可以在 SAP 附註 [1928533]中找到這些問題的答案。</span><span class="sxs-lookup"><span data-stu-id="17c39-226">The answers to these questions can be read in SAP Note [1928533].</span></span>

<span data-ttu-id="17c39-227">在第二個步驟中，必須將 Azure 資源和頻寬限制，與內部部署系統的實際資源耗用量進行比較。</span><span class="sxs-lookup"><span data-stu-id="17c39-227">As a second step, Azure resource and bandwidth limitations need to be compared to actual resource consumption of on-premises systems.</span></span> <span data-ttu-id="17c39-228">因此，客戶必須熟悉 SAP 支援之 Azure 類型在下列領域的不同功能︰</span><span class="sxs-lookup"><span data-stu-id="17c39-228">Therefore, customers need to be familiar with the different capabilities of the Azure types supported with SAP in the area of:</span></span>

* <span data-ttu-id="17c39-229">不同 VM 類型的 CPU 和記憶體資源，以及</span><span class="sxs-lookup"><span data-stu-id="17c39-229">CPU and memory resources of different VM types and</span></span>
* <span data-ttu-id="17c39-230">不同 VM 類型的 IOPS 頻寬，以及</span><span class="sxs-lookup"><span data-stu-id="17c39-230">IOPS bandwidth of different VM types and</span></span>
* <span data-ttu-id="17c39-231">不同 VM 類型的網路功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-231">Network capabilities of different VM types.</span></span>

<span data-ttu-id="17c39-232">您可以在[這裡 (Linux)][virtual-machines-sizes-linux] 和[這裡 (Windows)][virtual-machines-sizes-windows] 找到大部分的資料。</span><span class="sxs-lookup"><span data-stu-id="17c39-232">Most of that data can be found [here (Linux)][virtual-machines-sizes-linux] and [here (Windows)][virtual-machines-sizes-windows].</span></span>

<span data-ttu-id="17c39-233">請記住，上面連結中所列的限制是上限。</span><span class="sxs-lookup"><span data-stu-id="17c39-233">Keep in mind that the limits listed in the link above are upper limits.</span></span> <span data-ttu-id="17c39-234">它並不表示在所有情況下可提供之任何資源 (例如 IOPS) 的限制。</span><span class="sxs-lookup"><span data-stu-id="17c39-234">It does not mean that the limits for any of the resources, for example IOPS can be provided under all circumstances.</span></span> <span data-ttu-id="17c39-235">不過，這不包括所選擇之 VM 類型的 CPU 和記憶體資源。</span><span class="sxs-lookup"><span data-stu-id="17c39-235">The exceptions though are the CPU and memory resources of a chosen VM type.</span></span> <span data-ttu-id="17c39-236">針對 SAP 支援的 VM 類型，CPU 和記憶體資源會予以保留，因此可在任何時候供 VM 使用。</span><span class="sxs-lookup"><span data-stu-id="17c39-236">For the VM types supported by SAP, the CPU and memory resources are reserved and as such available at any point in time for consumption within the VM.</span></span>

<span data-ttu-id="17c39-237">其他 IaaS 平台等 Microsoft Azure 平台是多租用戶平台。</span><span class="sxs-lookup"><span data-stu-id="17c39-237">The Microsoft Azure platform like other IaaS platforms is a multi-tenant platform.</span></span> <span data-ttu-id="17c39-238">這表示儲存體、網路和其他資源會在租用戶之間共用。</span><span class="sxs-lookup"><span data-stu-id="17c39-238">This means that storage, network, and other resources are shared between tenants.</span></span> <span data-ttu-id="17c39-239">智慧型節流和配額邏輯可用來防止一個租用戶大幅影響另一個租用戶 (鄰點干擾)。</span><span class="sxs-lookup"><span data-stu-id="17c39-239">Intelligent throttling and quota logic is used to prevent one tenant from impacting the performance of another tenant (noisy neighbor) in a drastic way.</span></span> <span data-ttu-id="17c39-240">雖然 Azure 的邏輯嘗試將體驗到的頻寬差異保持在很小，但比起許多客戶在其內部部署所習慣的差異，高度共用的平台往往引進更大的資源/頻寬可用性差異。</span><span class="sxs-lookup"><span data-stu-id="17c39-240">Though logic in Azure tries to keep variances in bandwidth experienced small, highly shared platforms tend to introduce larger variances in resource/bandwidth availability than many customers are used to in their on-premises deployments.</span></span> <span data-ttu-id="17c39-241">因此，您可能會在不同時間，針對網路或儲存體 I/O 體驗到不同等級的頻寬 (流量和延遲)。</span><span class="sxs-lookup"><span data-stu-id="17c39-241">As a result, you might experience different levels of bandwidth regarding networking or storage I/O (the volume as well as latency) from minute to minute.</span></span> <span data-ttu-id="17c39-242">您必須考慮 Azure 上的 SAP 系統可能體驗到比內部部署更大差異的可能性。</span><span class="sxs-lookup"><span data-stu-id="17c39-242">The probability that an SAP system on Azure could experience larger variances than in an on-premises system needs to be taken into account.</span></span>

<span data-ttu-id="17c39-243">最後一個步驟是評估可用性需求。</span><span class="sxs-lookup"><span data-stu-id="17c39-243">A last step is to evaluate availability requirements.</span></span> <span data-ttu-id="17c39-244">此時可能需要更新根本 Azure 基礎結構，並需要重新啟動執行 VM 的主機。</span><span class="sxs-lookup"><span data-stu-id="17c39-244">It can happen, that the underlying Azure infrastructure needs to get updated and requires the hosts running VMs to be rebooted.</span></span> <span data-ttu-id="17c39-245">在這些情況下，也會關閉並重新啟動正在這些主機上執行的 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-245">In these cases, VMs running on those hosts would be shut down and restarted as well.</span></span> <span data-ttu-id="17c39-246">這類維護工作會在特定區域的非主要上班時間內完成，但發生重新啟動的可能時間則相對較廣。</span><span class="sxs-lookup"><span data-stu-id="17c39-246">The timing of such maintenance is done during non-core business hours for a particular region but the potential window of a few hours during which a restart will occur is relatively wide.</span></span> <span data-ttu-id="17c39-247">您可以在 Azure 平台中設定各種技術，來減輕這類更新的部分或所有影響。</span><span class="sxs-lookup"><span data-stu-id="17c39-247">There are various technologies within the Azure platform that can be configured to mitigate some or all of the impact of such updates.</span></span> <span data-ttu-id="17c39-248">Azure 平台、DBMS 和 SAP 應用程式的未來改進，會以將這類重新啟動的影響降到最低為設計目的。</span><span class="sxs-lookup"><span data-stu-id="17c39-248">Future enhancements of the Azure platform, DBMS, and SAP application are designed to minimize the impact of such restarts.</span></span>

<span data-ttu-id="17c39-249">若要成功地將 SAP 系統部署到 Azure，內部部署 SAP 系統的作業系統、資料庫和 SAP 應用程式必須出現在 SAP Azure 支援矩陣中、符合 Azure 基礎結構可提供的資源限制，並且可搭配 Microsoft Azure 所提供的可用性 SLA 使用。</span><span class="sxs-lookup"><span data-stu-id="17c39-249">In order to successfully deploy an SAP system onto Azure, the on-premises SAP system(s) Operating System, Database, and SAP applications must appear on the SAP Azure support matrix, fit within the resources the Azure infrastructure can provide and which can work with the Availability SLAs Microsoft Azure offers.</span></span> <span data-ttu-id="17c39-250">指定這些系統之後，您必須在下列兩種部署案例之間決定其中一個。</span><span class="sxs-lookup"><span data-stu-id="17c39-250">As those systems are identified, you need to decide on one of the following two deployment scenarios.</span></span>

### <span data-ttu-id="17c39-251"><a name="1625df66-4cc6-4d60-9202-de8a0b77f803"></a>僅限雲端 - 將虛擬機器部署到 Azure，無須倚賴內部部署客戶網路</span><span class="sxs-lookup"><span data-stu-id="17c39-251"><a name="1625df66-4cc6-4d60-9202-de8a0b77f803"></a>Cloud-Only - Virtual Machine deployments into Azure without dependencies on the on-premises customer network</span></span>
![在 Azure 中部署 SAP 示範或訓練案例的單一 VM][planning-guide-figure-100]

<span data-ttu-id="17c39-253">這是訓練或示範系統的典型案例，在此案例中，SAP 和非 SAP 軟體的所有元件都會安裝在單一 VM 中。</span><span class="sxs-lookup"><span data-stu-id="17c39-253">This scenario is typical for trainings or demo systems, where all the components of SAP and non-SAP software are installed within a single VM.</span></span> <span data-ttu-id="17c39-254">此部署案例不支援 SAP 生產系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-254">Production SAP systems are not supported in this deployment scenario.</span></span> <span data-ttu-id="17c39-255">一般而言，此案例符合下列需求：</span><span class="sxs-lookup"><span data-stu-id="17c39-255">In general, this scenario meets the following requirements:</span></span>

* <span data-ttu-id="17c39-256">VM 本身可透過公用網路存取。</span><span class="sxs-lookup"><span data-stu-id="17c39-256">The VMs themselves are accessible over the public network.</span></span> <span data-ttu-id="17c39-257">在 VM 中執行的應用程式與擁有示範或訓練內容之公司或客戶的內部部署網路之間，不需要有直接網路連線能力。</span><span class="sxs-lookup"><span data-stu-id="17c39-257">Direct network connectivity for the applications running within the VMs to the on-premises network of either the company owning the demos or trainings content or the customer is not necessary.</span></span>
* <span data-ttu-id="17c39-258">如果有多個代表訓練或示範案例的 VM，這些 VM 之間的網路通訊和名稱解析必須運作正常。</span><span class="sxs-lookup"><span data-stu-id="17c39-258">In case of multiple VMs representing the trainings or demo scenario, network communications and name resolution needs to work between the VMs.</span></span> <span data-ttu-id="17c39-259">但 VM 集合之間的通訊必須隔離，才能在不干擾的情況下，並排部署多組 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-259">But communications between the set of VMs need to be isolated so that several sets of VMs can be deployed side by side without interference.</span></span>  
* <span data-ttu-id="17c39-260">使用者需要有網際網路連線，才能從遠端登入裝載於 Azure 中的 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-260">Internet connectivity is required for the end user to remote login into to the VMs hosted in Azure.</span></span> <span data-ttu-id="17c39-261">視客體 OS 而定，您可以使用終端機服務/RDS 或 VNC/ssh 來存取 VM，以履行訓練工作或執行示範。</span><span class="sxs-lookup"><span data-stu-id="17c39-261">Depending on the guest OS, Terminal Services/RDS or VNC/ssh is used to access the VM to either fulfill the training tasks or perform the demos.</span></span> <span data-ttu-id="17c39-262">如果也會公開 3200、3300 和 3600 等 SAP 連接埠，則可以從任何連線到網際網路的桌面存取 SAP 應用程式執行個體。</span><span class="sxs-lookup"><span data-stu-id="17c39-262">If SAP ports such as 3200, 3300 & 3600 can also be exposed the SAP application instance can be accessed from any Internet connected desktop.</span></span>
* <span data-ttu-id="17c39-263">SAP 系統 (及 VM) 代表 Azure 中的獨立案例，只需要公用網際網路連線能力就能進行使用者存取，而不需要連線到 Azure 中的其他 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-263">The SAP system(s) (and VM(s)) represent a standalone scenario in Azure, which only requires public internet connectivity for end-user access and does not require a connection to other VMs in Azure.</span></span>
* <span data-ttu-id="17c39-264">SAPGUI 和瀏覽器會在 VM 上安裝並直接執行。</span><span class="sxs-lookup"><span data-stu-id="17c39-264">SAPGUI and a browser are installed and run directly on the VM.</span></span>
* <span data-ttu-id="17c39-265">需要快速將 VM 重設為原始狀態，再重新部署該原始狀態。</span><span class="sxs-lookup"><span data-stu-id="17c39-265">A fast reset of a VM to the original state and new deployment of that original state again is required.</span></span>
* <span data-ttu-id="17c39-266">如果是在多個 VM 中實現的示範和訓練案例，每組 VM 都需要有 Active Directory/OpenLDAP 及 (或) DNS 服務。</span><span class="sxs-lookup"><span data-stu-id="17c39-266">In the case of demo and training scenarios, which are realized in multiple VMs, an Active Directory / OpenLDAP and/or DNS service is required for each set of VMs.</span></span>

![代表 Azure 雲端服務中一個示範或訓練案例的 VM 群組][planning-guide-figure-200]

<span data-ttu-id="17c39-268">請務必記住，每組 VM 必須以平行方式部署，其中每組的 VM 名稱會相同。</span><span class="sxs-lookup"><span data-stu-id="17c39-268">It is important to keep in mind that the VM(s) in each of the sets need to be deployed in parallel, where the VM names in each of the set are the same.</span></span>

### <span data-ttu-id="17c39-269"><a name="f5b3b18c-302c-4bd8-9ab2-c388f1ab3d10"></a>跨單位 - 將單一或多個 SAP VM 部署到 Azure，必須完全整合到內部部署網路</span><span class="sxs-lookup"><span data-stu-id="17c39-269"><a name="f5b3b18c-302c-4bd8-9ab2-c388f1ab3d10"></a>Cross-Premises - Deployment of single or multiple SAP VMs into Azure with the requirement of being fully integrated into the on-premises network</span></span>
![具有站對站連線能力的 VPN (跨單位)][planning-guide-figure-300]

<span data-ttu-id="17c39-271">此案例是具有許多可能之部署模式的跨單位案例。</span><span class="sxs-lookup"><span data-stu-id="17c39-271">This scenario is a cross-premises scenario with many possible deployment patterns.</span></span> <span data-ttu-id="17c39-272">它可以簡單描述成在內部部署執行一部分 SAP 環境，並在 Azure 上執行另一部分 SAP 環境。</span><span class="sxs-lookup"><span data-stu-id="17c39-272">It can be described as simply as running some parts of the SAP landscape on-premises and other parts of the SAP landscape on Azure.</span></span> <span data-ttu-id="17c39-273">使用者應該清楚了解在 Azure 上執行一部分 SAP 元件的所有層面。</span><span class="sxs-lookup"><span data-stu-id="17c39-273">All aspects of the fact that part of the SAP components are running on Azure should be transparent for end users.</span></span> <span data-ttu-id="17c39-274">如此一來，Azure 上的 SAP 系統才能順暢地使用 SAP Transport Correction System (STMS)、RFC 通訊、列印、安全性 (例如 SSO) 等。</span><span class="sxs-lookup"><span data-stu-id="17c39-274">Hence the SAP Transport Correction System (STMS), RFC Communication, Printing, Security (like SSO), etc. work seamlessly for the SAP systems running on Azure.</span></span> <span data-ttu-id="17c39-275">不過，跨單位案例也描述在 Azure 中執行完整 SAP 環境，並將客戶的網域和 DNS 擴充到 Azure 的案例。</span><span class="sxs-lookup"><span data-stu-id="17c39-275">But the cross-premises scenario also describes a scenario where the complete SAP landscape runs in Azure with the customer’s domain and DNS extended into Azure.</span></span>

> [!NOTE]
> <span data-ttu-id="17c39-276">這是可執行 SAP 生產系統的部署案例。</span><span class="sxs-lookup"><span data-stu-id="17c39-276">This is the deployment scenario, which is supported for running productive SAP systems.</span></span>
>
>

<span data-ttu-id="17c39-277">如需有關如何將內部部署網路連線到 Microsoft Azure 的詳細資訊，請參閱[這篇文章][vpn-gateway-create-site-to-site-rm-powershell]</span><span class="sxs-lookup"><span data-stu-id="17c39-277">Read [this article][vpn-gateway-create-site-to-site-rm-powershell] for more information on how to connect your on-premises network to Microsoft Azure</span></span>

> [!IMPORTANT]
> <span data-ttu-id="17c39-278">當談到 Azure 與內部部署客戶部署之間的跨單位案例時，所探討的是整個 SAP 系統的資料粒度。</span><span class="sxs-lookup"><span data-stu-id="17c39-278">When we are talking about cross-premises scenarios between Azure and on-premises customer deployments, we are looking at the granularity of whole SAP systems.</span></span> <span data-ttu-id="17c39-279">跨單位案例「不支援」的情況包括︰</span><span class="sxs-lookup"><span data-stu-id="17c39-279">Scenarios which are *not supported* for cross-premises scenarios are:</span></span>
>
> * <span data-ttu-id="17c39-280">以不同的部署方法執行不同的 SAP 應用程式層。</span><span class="sxs-lookup"><span data-stu-id="17c39-280">Running different layers of SAP applications in different deployment methods.</span></span> <span data-ttu-id="17c39-281">例如，在內部部署執行 DBMS 層，但將 VM 中的 SAP 應用程式層部署為 Azure VM；反之亦然。</span><span class="sxs-lookup"><span data-stu-id="17c39-281">For example running the DBMS layer on-premises, but the SAP application layer in VMs deployed as Azure VMs or vice versa.</span></span>
> * <span data-ttu-id="17c39-282">SAP 層的部分元件在 Azure 中，部分元件在內部部署。</span><span class="sxs-lookup"><span data-stu-id="17c39-282">Some components of an SAP layer in Azure and some on-premises.</span></span> <span data-ttu-id="17c39-283">例如，在內部部署與 Azure VM 之間分割 SAP 應用程式層的執行個體。</span><span class="sxs-lookup"><span data-stu-id="17c39-283">For example splitting Instances of the SAP application layer between on-premises and Azure VMs.</span></span>
> * <span data-ttu-id="17c39-284">不支援將執行一個系統之 SAP 執行個體的 VM 分散到多個 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="17c39-284">Distribution of VMs running SAP instances of one system over multiple Azure Regions is not supported.</span></span>
>
> <span data-ttu-id="17c39-285">您必須符合這些限制，才能讓一個 SAP 系統的內部網路有很低的延遲及很高的效能，特別是在 SAP 系統的應用程式執行個體與 DBMS 層之間。</span><span class="sxs-lookup"><span data-stu-id="17c39-285">The reason for these restrictions is the requirement for a very low latency high-performance network within one SAP system, especially between the application instances and the DBMS layer of an SAP system.</span></span>
>
>

### <a name="supported-os-and-database-releases"></a><span data-ttu-id="17c39-286">支援的 OS 和資料庫版本</span><span class="sxs-lookup"><span data-stu-id="17c39-286">Supported OS and Database Releases</span></span>
* <span data-ttu-id="17c39-287">下列文章列出「Azure 虛擬機器服務」支援的 Microsoft 伺服器軟體：<http://support.microsoft.com/kb/2721672>。</span><span class="sxs-lookup"><span data-stu-id="17c39-287">Microsoft server software supported for Azure Virtual Machine Services is listed in this article: <http://support.microsoft.com/kb/2721672>.</span></span>
* <span data-ttu-id="17c39-288">「Azure 虛擬機器服務」搭配 SAP 軟體支援的作業系統版本和資料庫版本記載於 SAP 附註 [1928533]。</span><span class="sxs-lookup"><span data-stu-id="17c39-288">Supported operating system releases, database system releases supported on Azure Virtual Machine Services in conjunction with SAP software are documented in SAP Note [1928533].</span></span>
* <span data-ttu-id="17c39-289">「Azure 虛擬機器服務」支援的 SAP 應用程式和版本記載於 SAP 附註 [1928533]。</span><span class="sxs-lookup"><span data-stu-id="17c39-289">SAP applications and releases supported on Azure Virtual Machine Services are documented in SAP Note [1928533].</span></span>
* <span data-ttu-id="17c39-290">在 SAP 案例中，只支援將 64 位元映像當做 Azure 中的客體 VM 來執行。</span><span class="sxs-lookup"><span data-stu-id="17c39-290">Only 64Bit images are supported to run as Guest VMs in Azure for SAP scenarios.</span></span> <span data-ttu-id="17c39-291">這也表示只支援 64 位元 SAP 應用程式和資料庫。</span><span class="sxs-lookup"><span data-stu-id="17c39-291">This also means that only 64-bit SAP applications and databases are supported.</span></span>

## <a name="microsoft-azure-virtual-machine-services"></a><span data-ttu-id="17c39-292">Microsoft Azure 虛擬機器服務</span><span class="sxs-lookup"><span data-stu-id="17c39-292">Microsoft Azure Virtual Machine Services</span></span>
<span data-ttu-id="17c39-293">Microsoft Azure 平台是在 Microsoft 資料中心內裝載和運作的網際網路規模雲端服務平台。</span><span class="sxs-lookup"><span data-stu-id="17c39-293">The Microsoft Azure platform is an internet-scale cloud services platform hosted and operated in Microsoft data centers.</span></span> <span data-ttu-id="17c39-294">此平台包含 Microsoft Azure 虛擬機器服務 (基礎結構即服務或 IaaS) 和一組豐富的平台即服務 (PaaS) 功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-294">The platform includes the Microsoft Azure Virtual Machine Services (Infrastructure as a Service, or IaaS) and a set of rich Platform as a Service (PaaS) capabilities.</span></span>

<span data-ttu-id="17c39-295">Azure 平台可減少預先採購技術和基礎結構的需求。</span><span class="sxs-lookup"><span data-stu-id="17c39-295">The Azure platform reduces the need for up-front technology and infrastructure purchases.</span></span> <span data-ttu-id="17c39-296">它提供隨選計算和儲存體，來裝載、調整及管理 Web 應用程式和連線的應用程式，藉此簡化維護和操作應用程式的作業。</span><span class="sxs-lookup"><span data-stu-id="17c39-296">It simplifies maintaining and operating applications by providing on-demand compute and storage to host, scale, and manage web application and connected applications.</span></span> <span data-ttu-id="17c39-297">基礎結構管理使用專為高可用性和動態調整規模所設計的平台來自動化，以配合隨用隨付定價模式選項的使用需求。</span><span class="sxs-lookup"><span data-stu-id="17c39-297">Infrastructure management is automated with a platform that is designed for high availability and dynamic scaling to match usage needs with the option of a pay-as-you-go pricing model.</span></span>

![Microsoft Azure 虛擬機器服務的定位][planning-guide-figure-400]

<span data-ttu-id="17c39-299">透過 Azure 虛擬機器服務，Microsoft 可讓您將自訂伺服器映像部署到 Azure 作為 IaaS 執行個體 (請參閱圖 4)。</span><span class="sxs-lookup"><span data-stu-id="17c39-299">With Azure Virtual Machine Services, Microsoft is enabling you to deploy custom server images to Azure as IaaS instances (see Figure 4).</span></span> <span data-ttu-id="17c39-300">Azure 中的虛擬機器是以 Hyper-V 虛擬硬碟 (VHD) 為基礎，並且能夠當做客體 OS 來執行不同的作業系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-300">The Virtual Machines in Azure are based on Hyper-V virtual hard drives (VHD) and are able to run different operating systems as Guest OS.</span></span>

<span data-ttu-id="17c39-301">從作業觀點來看，Azure 虛擬機器服務提供與內部部署的虛擬機器類似的體驗。</span><span class="sxs-lookup"><span data-stu-id="17c39-301">From an operational perspective, the Azure Virtual Machine Service offers similar experiences as virtual machines deployed on premises.</span></span> <span data-ttu-id="17c39-302">不過，它具有不需要採購及管理基礎結構的重大優點。</span><span class="sxs-lookup"><span data-stu-id="17c39-302">However, it has the significant advantage that you don’t need to procure, administer, and manage the infrastructure.</span></span> <span data-ttu-id="17c39-303">開發人員和系統管理員具有這些虛擬機器中作業系統映像的完整控制權。</span><span class="sxs-lookup"><span data-stu-id="17c39-303">Developers and Administrators have full control of the operating system image within these virtual machines.</span></span> <span data-ttu-id="17c39-304">系統管理員可從遠端登入這些虛擬機器，以執行維護和疑難排解工作，以及軟體部署工作。</span><span class="sxs-lookup"><span data-stu-id="17c39-304">Administrators can log on remotely in to those virtual machines to perform maintenance and troubleshooting tasks as well as software deployment tasks.</span></span> <span data-ttu-id="17c39-305">至於部署，唯一的限制是 Azure VM 的大小和功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-305">In regard to deployment, the only restrictions are the sizes and capabilities of Azure VMs.</span></span> <span data-ttu-id="17c39-306">您可能無法如內部部署般，對這些項目進行細微的設定。</span><span class="sxs-lookup"><span data-stu-id="17c39-306">These may not be as fine granular in configuration as this could be done on premises.</span></span> <span data-ttu-id="17c39-307">您可以選擇包含下列項目組合的 VM 類型︰</span><span class="sxs-lookup"><span data-stu-id="17c39-307">There is a choice of VM types that represent a combination of:</span></span>

* <span data-ttu-id="17c39-308">vCPU 數目、</span><span class="sxs-lookup"><span data-stu-id="17c39-308">Number of vCPUs,</span></span>
* <span data-ttu-id="17c39-309">記憶體、</span><span class="sxs-lookup"><span data-stu-id="17c39-309">Memory,</span></span>
* <span data-ttu-id="17c39-310">可連接的 VHD 數目、</span><span class="sxs-lookup"><span data-stu-id="17c39-310">Number of VHDs that can be attached,</span></span>
* <span data-ttu-id="17c39-311">網路和儲存體頻寬。</span><span class="sxs-lookup"><span data-stu-id="17c39-311">Network and Storage bandwidths.</span></span>

<span data-ttu-id="17c39-312">如需所提供各種不同虛擬機器大小的大小和限制，請參閱[這篇文章 (Linux)][virtual-machines-sizes-linux] 和[這篇文章 (Windows)][virtual-machines-sizes-windows] 中的表格。</span><span class="sxs-lookup"><span data-stu-id="17c39-312">The size and limitations of various different virtual machines sizes offered can be seen in a table in [this article (Linux)][virtual-machines-sizes-linux] and [this article (Windows)][virtual-machines-sizes-windows].</span></span>

<span data-ttu-id="17c39-313">如您所見，虛擬機器有不同的系列。</span><span class="sxs-lookup"><span data-stu-id="17c39-313">As you realize, there are different families or series of virtual machines.</span></span> <span data-ttu-id="17c39-314">VM 可分為下列系列：</span><span class="sxs-lookup"><span data-stu-id="17c39-314">You can distinguish the following families of VMs:</span></span>

* <span data-ttu-id="17c39-315">A0-A7 VM 類型︰並未全部通過 SAP 認證。</span><span class="sxs-lookup"><span data-stu-id="17c39-315">A0-A7 VM types: Not all of those are certified for SAP.</span></span> <span data-ttu-id="17c39-316">這是 Azure IaaS 引進的第一個 VM 系列。</span><span class="sxs-lookup"><span data-stu-id="17c39-316">First VM series that Azure IaaS got introduced with.</span></span>
* <span data-ttu-id="17c39-317">A8-A11 VM 類型：高效能運算執行個體。</span><span class="sxs-lookup"><span data-stu-id="17c39-317">A8-A11 VM types: High Performance computing instances.</span></span> <span data-ttu-id="17c39-318">在計算主機上的執行效能高於其他 A 系列 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-318">Running on different better performing compute hosts than other A-series VMs.</span></span>
* <span data-ttu-id="17c39-319">D/Dv2 系列 VM 類型︰執行效能高於 A0-A7。</span><span class="sxs-lookup"><span data-stu-id="17c39-319">D/Dv2-Series VM types: Better performing than A0-A7.</span></span> <span data-ttu-id="17c39-320">此 VM 類型並未全部通過 SAP 認證。</span><span class="sxs-lookup"><span data-stu-id="17c39-320">Not all of the VM types are certified with SAP.</span></span>
* <span data-ttu-id="17c39-321">DS/DSv2 系列 VM 類型︰類似於 D/Dv2 系列，但能夠連線到「Azure 進階儲存體」(請參閱本文件的 [Azure 進階儲存體][planning-guide-3.3.2]一章)。</span><span class="sxs-lookup"><span data-stu-id="17c39-321">DS/DSv2-Series VM types: Similar to D/Dv2-series, but are able to connect to Azure Premium Storage (see chapter [Azure Premium Storage][planning-guide-3.3.2] of this document).</span></span> <span data-ttu-id="17c39-322">同樣地，此 VM 類型並未全部通過 SAP 認證。</span><span class="sxs-lookup"><span data-stu-id="17c39-322">Again not all VM types are certified with SAP.</span></span>
* <span data-ttu-id="17c39-323">G 系列 VM 類型︰高記憶體 VM 類型。</span><span class="sxs-lookup"><span data-stu-id="17c39-323">G-Series VM types: High memory VM types.</span></span>
* <span data-ttu-id="17c39-324">GS 系列 VM 類型︰類似 G 系列，但包含使用「Azure 進階儲存體」的選項 (請參閱本文件的 [Azure 進階儲存體][planning-guide-3.3.2]一章)。</span><span class="sxs-lookup"><span data-stu-id="17c39-324">GS-Series VM types: like G-Series but including the option to use Azure Premium Storage (see chapter [Azure Premium Storage][planning-guide-3.3.2] of this document).</span></span> <span data-ttu-id="17c39-325">使用 GS 系列 VM 作為資料庫伺服器時，會針對 DB 資料和交易記錄檔強制使用進階儲存體</span><span class="sxs-lookup"><span data-stu-id="17c39-325">When using GS-Series VMs as database servers, it's mandatory to use Premium Storage for DB data and transaction log files</span></span>

<span data-ttu-id="17c39-326">您可能在不同的 VM 系列中，發現相同的 CPU 和記憶體組態。</span><span class="sxs-lookup"><span data-stu-id="17c39-326">You may find the same CPU and memory configurations in different VM series.</span></span> <span data-ttu-id="17c39-327">不過，當您查閱這些不同系列 VM 的輸送量效能時，可能會有顯著的差異，</span><span class="sxs-lookup"><span data-stu-id="17c39-327">Nevertheless, when you look up the throughput performance of these VMs out of the different series they might differ significantly.</span></span> <span data-ttu-id="17c39-328">而不論是否具有相同的 CPU 和記憶體組態。</span><span class="sxs-lookup"><span data-stu-id="17c39-328">Despite having the same CPU and memory configuration.</span></span> <span data-ttu-id="17c39-329">這是因為引進不同 VM 類型的基礎主機伺服器硬體具有不同的輸送量特性。</span><span class="sxs-lookup"><span data-stu-id="17c39-329">Reason is that the underlying host server hardware at the introduction of the different VM types had different throughput characteristics.</span></span>  <span data-ttu-id="17c39-330">通常，輸送量效能中所顯示的差異也會反映在不同 VM 的價格。</span><span class="sxs-lookup"><span data-stu-id="17c39-330">Usually the difference shown in throughput performance also is reflected in the price of the different VMs.</span></span>

<span data-ttu-id="17c39-331">並非每個 Azure 區域都會提供所有不同的 VM 系列 (如需 Azure 區域，請參閱下一章)。</span><span class="sxs-lookup"><span data-stu-id="17c39-331">Not all different VM series might be offered in each one of the Azure Regions (for Azure Regions see next chapter).</span></span> <span data-ttu-id="17c39-332">另請注意，並非所有 VM 或 VM 系列都通過 SAP 認證。</span><span class="sxs-lookup"><span data-stu-id="17c39-332">Also be aware that not all VMs or VM-Series are certified for SAP.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="17c39-333">使用以 SAP NetWeaver 為基礎的應用程式時，只支援 SAP 附註 [1928533] 中所列出的一部分 VM 類型和組態。</span><span class="sxs-lookup"><span data-stu-id="17c39-333">For the use of SAP NetWeaver based applications, only the subset of VM types and configurations listed in SAP Note [1928533] are supported.</span></span>
>
>

### <span data-ttu-id="17c39-334"><a name="be80d1b9-a463-4845-bd35-f4cebdb5424a"></a>Azure 區域</span><span class="sxs-lookup"><span data-stu-id="17c39-334"><a name="be80d1b9-a463-4845-bd35-f4cebdb5424a"></a>Azure Regions</span></span>
<span data-ttu-id="17c39-335">Microsoft 允許將虛擬機器部署到所謂的「Azure 區域」。</span><span class="sxs-lookup"><span data-stu-id="17c39-335">Microsoft allows to deploy Virtual Machines into so called ‘Azure Regions’.</span></span> <span data-ttu-id="17c39-336">Azure 區域可以是位置很近的一或多個資料中心。</span><span class="sxs-lookup"><span data-stu-id="17c39-336">An Azure Region may be one or multiple data centers that are located in close proximity.</span></span> <span data-ttu-id="17c39-337">針對全球大多數地緣政治區域，Microsoft 至少有兩個 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="17c39-337">For most of the geopolitical regions in the world Microsoft has at least two Azure Regions.</span></span> <span data-ttu-id="17c39-338">例如，在歐洲，有一個「北歐」和一個「西歐」Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="17c39-338">For example, in Europe there is an Azure Region of ‘North Europe’ and one of ‘West Europe’.</span></span> <span data-ttu-id="17c39-339">一個地緣政治區域中的兩個 Azure 區域之間會相隔足夠的距離，以確保天然或技術性災害不會同時影響相同地緣政治區域中的兩個 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="17c39-339">Such two Azure Regions within a geopolitical region are separated by significant enough distance so that natural or technical disasters do not affect both Azure Regions in the same geopolitical region.</span></span> <span data-ttu-id="17c39-340">由於 Microsoft 在全球不同的地緣政治區域中穩定地擴展新的 Azure 區域，因此這些區域的數目呈現穩定成長，截至 2015 年 12 月為止已達 20 個 Azure 區域，至今已宣告更多區域。</span><span class="sxs-lookup"><span data-stu-id="17c39-340">Since Microsoft is steadily building out new Azure Regions in different geopolitical regions globally, the number of these regions is steadily growing and as of Dec 2015 reached the number of 20 Azure Regions with additional Regions announced already.</span></span> <span data-ttu-id="17c39-341">身為客戶，您可以將 SAP 系統部署到所有區域，包括中國的兩個 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="17c39-341">You as a customer can deploy SAP systems into all these regions, including the two Azure Regions in China.</span></span> <span data-ttu-id="17c39-342">如需有關 Azure 區域的目前最新資訊，請參閱下列網站：<https://azure.microsoft.com/regions/></span><span class="sxs-lookup"><span data-stu-id="17c39-342">For current up-to-date information about Azure regions see this website: <https://azure.microsoft.com/regions/></span></span>

### <span data-ttu-id="17c39-343"><a name="8d8ad4b8-6093-4b91-ac36-ea56d80dbf77"></a>Microsoft Azure 虛擬機器概念</span><span class="sxs-lookup"><span data-stu-id="17c39-343"><a name="8d8ad4b8-6093-4b91-ac36-ea56d80dbf77"></a>The Microsoft Azure Virtual Machine Concept</span></span>
<span data-ttu-id="17c39-344">Microsoft Azure 提供基礎結構即服務 (IaaS) 解決方案來裝載虛擬機器，並提供與內部部署虛擬化解決方案類似的功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-344">Microsoft Azure offers an Infrastructure as a Service (IaaS) solution to host Virtual Machines with similar functionalities as an on-premises virtualization solution.</span></span> <span data-ttu-id="17c39-345">您可以透過 Azure 入口網站、PowerShell 或 CLI 來建立虛擬機器，這也會提供部署和管理功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-345">You are able to create Virtual Machines from within the Azure portal, PowerShell or CLI, which also offer deployment and management capabilities.</span></span>

<span data-ttu-id="17c39-346">Azure 資源管理員可讓您使用宣告式範本佈建應用程式。</span><span class="sxs-lookup"><span data-stu-id="17c39-346">Azure Resource Manager allows you to provision your applications using a declarative template.</span></span> <span data-ttu-id="17c39-347">在單一的範本中，您可以部署多個服務及其相依性。</span><span class="sxs-lookup"><span data-stu-id="17c39-347">In a single template, you can deploy multiple services along with their dependencies.</span></span> <span data-ttu-id="17c39-348">您可以使用相同的範本，在應用程式生命週期的每個階段重複部署應用程式。</span><span class="sxs-lookup"><span data-stu-id="17c39-348">You use the same template to repeatedly deploy your application during every stage of the application life cycle.</span></span>

<span data-ttu-id="17c39-349">如需使用 Resource Manager 範本的詳細資訊，請參閱：</span><span class="sxs-lookup"><span data-stu-id="17c39-349">More information about using Resource Manager templates can be found here:</span></span>

* <span data-ttu-id="17c39-350">[使用 Azure Resource Manager 範本和 Azure CLI 部署和管理虛擬機器][../../linux/create-ssh-secured-vm-from-template.md]</span><span class="sxs-lookup"><span data-stu-id="17c39-350">[Deploy and manage virtual machines by using Azure Resource Manager templates and the Azure CLI][../../linux/create-ssh-secured-vm-from-template.md]</span></span>
* <span data-ttu-id="17c39-351">[使用 Azure Resource Manager 和 PowerShell 管理虛擬機器][virtual-machines-deploy-rmtemplates-powershell]</span><span class="sxs-lookup"><span data-stu-id="17c39-351">[Manage virtual machines using Azure Resource Manager and PowerShell][virtual-machines-deploy-rmtemplates-powershell]</span></span>
* <span data-ttu-id="17c39-352"><https://azure.microsoft.com/documentation/templates/></span><span class="sxs-lookup"><span data-stu-id="17c39-352"><https://azure.microsoft.com/documentation/templates/></span></span>

<span data-ttu-id="17c39-353">另一個有趣的功能是能夠從虛擬機器建立映像，這可讓您準備特定儲存機制，以從中快速部署符合需求的虛擬機器執行個體。</span><span class="sxs-lookup"><span data-stu-id="17c39-353">Another interesting feature is the ability to create images from Virtual Machines, which allows you to prepare certain repositories from which you are able to quickly deploy Virtual machine instances, which meet your requirements.</span></span>

<span data-ttu-id="17c39-354">如需有關從「虛擬機器」建立映像的詳細資訊，請參閱[這篇文章 (Linux)][virtual-machines-linux-capture-image-resource-manager] 或[這篇文章 (Windows)][virtual-machines-windows-capture-image-resource-manager]。</span><span class="sxs-lookup"><span data-stu-id="17c39-354">More information about creating images from Virtual Machines can be found in [this article (Linux)][virtual-machines-linux-capture-image-resource-manager] and [this article (Windows)][virtual-machines-windows-capture-image-resource-manager].</span></span>

#### <span data-ttu-id="17c39-355"><a name="df49dc09-141b-4f34-a4a2-990913b30358"></a>容錯網域</span><span class="sxs-lookup"><span data-stu-id="17c39-355"><a name="df49dc09-141b-4f34-a4a2-990913b30358"></a>Fault Domains</span></span>
<span data-ttu-id="17c39-356">容錯網域代表失敗的實體單位，與資料中心所包含的實體基礎結構密切相關，雖然實體刀鋒視窗或機架可視為容錯網域，但這兩者間並沒有直接的一對一對應。</span><span class="sxs-lookup"><span data-stu-id="17c39-356">Fault Domains represent a physical unit of failure, very closely related to the physical infrastructure contained in data centers, and while a physical blade or rack can be considered a Fault Domain, there is no direct one-to-one mapping between the two.</span></span>

<span data-ttu-id="17c39-357">當您將多個虛擬機器部署為 Microsoft Azure 虛擬機器服務中一個 SAP 系統的一部分時，您可以影響 Azure 網狀架構控制器將您的應用程式部署到不同的容錯網域，以符合 Microsoft Azure SLA 的需求。</span><span class="sxs-lookup"><span data-stu-id="17c39-357">When you deploy multiple Virtual Machines as part of one SAP system in Microsoft Azure Virtual Machine Services, you can influence the Azure Fabric Controller to deploy your application into different Fault Domains, thereby meeting the requirements of the Microsoft Azure SLA.</span></span> <span data-ttu-id="17c39-358">不過，將容錯網域分散到 Azure 縮放單位 (數百個計算節點或儲存體節點和網路的集合)，或將 VM 指派給特定容錯網域，並不是可由您直接控制的作業。</span><span class="sxs-lookup"><span data-stu-id="17c39-358">However, the distribution of Fault Domains over an Azure Scale Unit (collection of hundreds of Compute nodes or Storage nodes and networking) or the assignment of VMs to a specific Fault Domain is something over which you do not have direct control.</span></span> <span data-ttu-id="17c39-359">若要引導 Azure 網狀架構控制器在不同的容錯網域之間部署一組 VM，您必須在部署時，將 Azure 可用性設定組指派給 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-359">In order to direct the Azure fabric controller to deploy a set of VMs over different Fault Domains, you need to assign an Azure Availability Set to the VMs at deployment time.</span></span> <span data-ttu-id="17c39-360">如需有關「Azure 可用性設定組」的詳細資訊，請參閱本文件的 [Azure 可用性設定組][planning-guide-3.2.3]一章。</span><span class="sxs-lookup"><span data-stu-id="17c39-360">For more information on Azure Availability Sets, see chapter [Azure Availability Sets][planning-guide-3.2.3] in this document.</span></span>

#### <span data-ttu-id="17c39-361"><a name="fc1ac8b2-e54a-487c-8581-d3cc6625e560"></a>升級網域</span><span class="sxs-lookup"><span data-stu-id="17c39-361"><a name="fc1ac8b2-e54a-487c-8581-d3cc6625e560"></a>Upgrade Domains</span></span>
<span data-ttu-id="17c39-362">升級網域代表邏輯單元，可協助決定 SAP 系統中 VM 的更新方式 (此 SAP 系統是由多個在 VM 中執行的 SAP 執行個體所組成)。</span><span class="sxs-lookup"><span data-stu-id="17c39-362">Upgrade Domains represent a logical unit that help to determine how a VM within an SAP system, that consists of SAP instances running in multiple VMs, is updated.</span></span> <span data-ttu-id="17c39-363">進行升級時，Microsoft Azure 會逐一更新這些升級網域。</span><span class="sxs-lookup"><span data-stu-id="17c39-363">When an upgrade occurs, Microsoft Azure goes through the process of updating these Upgrade Domains one by one.</span></span> <span data-ttu-id="17c39-364">藉由在部署時將 VM 散佈到不同的升級網域，即可防止您的 SAP 系統可能有一部分停機。</span><span class="sxs-lookup"><span data-stu-id="17c39-364">By spreading VMs at deployment time over different Upgrade Domains, you can protect your SAP system partly from potential downtime.</span></span> <span data-ttu-id="17c39-365">為了強制 Azure 將 SAP 系統的 VM 分散部署到不同的升級網域，您必須在部署每個 VM 時設定特定屬性。</span><span class="sxs-lookup"><span data-stu-id="17c39-365">In order to force Azure to deploy the VMs of an SAP system spread over different Upgrade Domains, you need to set a specific attribute at deployment time of each VM.</span></span> <span data-ttu-id="17c39-366">類似於容錯網域，Azure 縮放單位會分成多個升級網域。</span><span class="sxs-lookup"><span data-stu-id="17c39-366">Similar to Fault Domains, an Azure Scale Unit is divided into multiple Upgrade Domains.</span></span> <span data-ttu-id="17c39-367">若要引導 Azure 網狀架構控制器在不同的升級網域之間部署一組 VM，您必須在部署時，將 Azure 可用性設定組指派給 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-367">In order to direct the Azure fabric controller to deploy a set of VMs over different Upgrade Domains, you need to assign an Azure Availability Set to the VMs at deployment time.</span></span> <span data-ttu-id="17c39-368">如需有關「Azure 可用性設定組」的詳細資訊，請參閱下一章 [Azure 可用性設定][planning-guide-3.2.3]。</span><span class="sxs-lookup"><span data-stu-id="17c39-368">For more information on Azure Availability Sets, see chapter [Azure Availability Sets][planning-guide-3.2.3] below.</span></span>

#### <span data-ttu-id="17c39-369"><a name="18810088-f9be-4c97-958a-27996255c665"></a>Azure 可用性設定組</span><span class="sxs-lookup"><span data-stu-id="17c39-369"><a name="18810088-f9be-4c97-958a-27996255c665"></a>Azure Availability Sets</span></span>
<span data-ttu-id="17c39-370">一個 Azure 可用性設定組內的 Azure 虛擬機器會透過 Azure 網狀架構控制器，分散到不同的容錯和升級網域。</span><span class="sxs-lookup"><span data-stu-id="17c39-370">Azure Virtual Machines within one Azure Availability Set are distributed by the Azure Fabric Controller over different Fault and Upgrade Domains.</span></span> <span data-ttu-id="17c39-371">分散到不同容錯和升級網域的目的是，為了防止 SAP 系統的所有 VM，在基礎結構維護或某個容錯網域內發生失敗時全部關機。</span><span class="sxs-lookup"><span data-stu-id="17c39-371">The purpose of the distribution over different Fault and Upgrade Domains is to prevent all VMs of an SAP system from being shut down in the case of infrastructure maintenance or a failure within one Fault Domain.</span></span> <span data-ttu-id="17c39-372">根據預設，VM 不是可用性設定組的一部分。</span><span class="sxs-lookup"><span data-stu-id="17c39-372">By default, VMs are not part of an Availability Set.</span></span> <span data-ttu-id="17c39-373">您可以在部署時，或稍後藉由重新設定及重新部署 VM，來定義 VM 參與可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="17c39-373">The participation of a VM in an Availability Set is defined at deployment time or later on by a reconfiguration and re-deployment of a VM.</span></span>

<span data-ttu-id="17c39-374">若要了解「Azure 可用性設定組」的概念，以及「可用性設定組」與「容錯網域」和「升級網域」的關聯方式，請參閱[這篇文章][virtual-machines-manage-availability]</span><span class="sxs-lookup"><span data-stu-id="17c39-374">To understand the concept of Azure Availability Sets and the way Availability Sets relate to Fault and Upgrade Domains, read [this article][virtual-machines-manage-availability]</span></span>

<span data-ttu-id="17c39-375">若要透過 JSON 範本定義 ARM 的可用性設定組，請參閱 [REST-API 規格](https://github.com/Azure/azure-rest-api-specs/blob/master/arm-compute/2015-06-15/swagger/compute.json) 並搜尋 "availability"。</span><span class="sxs-lookup"><span data-stu-id="17c39-375">To define availability sets for ARM via a json template see [the rest-api specs](https://github.com/Azure/azure-rest-api-specs/blob/master/arm-compute/2015-06-15/swagger/compute.json) and search for "availability".</span></span>

### <span data-ttu-id="17c39-376"><a name="a72afa26-4bf4-4a25-8cf7-855d6032157f"></a>儲存體：Microsoft Azure 儲存體和資料磁碟</span><span class="sxs-lookup"><span data-stu-id="17c39-376"><a name="a72afa26-4bf4-4a25-8cf7-855d6032157f"></a>Storage: Microsoft Azure Storage and Data Disks</span></span>
<span data-ttu-id="17c39-377">Microsoft Azure 虛擬機器使用不同的儲存體類型。</span><span class="sxs-lookup"><span data-stu-id="17c39-377">Microsoft Azure Virtual Machines utilize different storage types.</span></span> <span data-ttu-id="17c39-378">在 Azure 虛擬機器服務上實作 SAP 時，請務必了解下列兩種主要儲存體類型之間的差異：</span><span class="sxs-lookup"><span data-stu-id="17c39-378">When implementing SAP on Azure Virtual Machine Services, it is important to understand the differences between these two main types of storage:</span></span>

* <span data-ttu-id="17c39-379">非永續性、可變更的儲存體。</span><span class="sxs-lookup"><span data-stu-id="17c39-379">Non-Persistent, volatile storage.</span></span>
* <span data-ttu-id="17c39-380">永續性儲存體。</span><span class="sxs-lookup"><span data-stu-id="17c39-380">Persistent storage.</span></span>

<span data-ttu-id="17c39-381">非永續性儲存體直接連接到執行中的虛擬機器，並位於計算節點本身 - 本機執行個體儲存體 (暫存儲存體)。</span><span class="sxs-lookup"><span data-stu-id="17c39-381">The non-persistent storage is directly attached to the running Virtual Machines and resides on the compute nodes themselves – the local instance storage (temporary storage).</span></span> <span data-ttu-id="17c39-382">其大小取決於開始部署時所選擇的虛擬機器大小。</span><span class="sxs-lookup"><span data-stu-id="17c39-382">The size depends on the size of the Virtual Machine chosen when the deployment started.</span></span> <span data-ttu-id="17c39-383">此儲存體類型是可變更的，因此重新啟動虛擬機器執行個體時會初始化磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-383">This storage type is volatile and therefore the disk is initialized when a Virtual Machine instance is restarted.</span></span> <span data-ttu-id="17c39-384">一般而言，作業系統的分頁檔位於此暫存磁碟上。</span><span class="sxs-lookup"><span data-stu-id="17c39-384">Typically, the pagefile for the operating system is located on this temporary disk.</span></span>

- - -
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-386">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-386">Windows</span></span>
>
> <span data-ttu-id="17c39-387">在 Windows VM 上，TEMP 磁碟機在已部署 VM 中會掛接為磁碟機 D:\。</span><span class="sxs-lookup"><span data-stu-id="17c39-387">On Windows VMs the temp drive is mounted as drive D:\ in a deployed VM.</span></span>
>
> ![Linux][Logo_Linux] <span data-ttu-id="17c39-389">Linux</span><span class="sxs-lookup"><span data-stu-id="17c39-389">Linux</span></span>
>
> <span data-ttu-id="17c39-390">在 Linux VM 上，則會掛接為 /mnt/resource 或 /mnt。</span><span class="sxs-lookup"><span data-stu-id="17c39-390">On Linux VMs, it's mounted as /mnt/resource or /mnt.</span></span> <span data-ttu-id="17c39-391">如需詳細資訊，請參閱：</span><span class="sxs-lookup"><span data-stu-id="17c39-391">See more details here:</span></span>
>
> * <span data-ttu-id="17c39-392">[如何將資料磁碟連接至 Linux 虛擬機器][virtual-machines-linux-how-to-attach-disk]</span><span class="sxs-lookup"><span data-stu-id="17c39-392">[How to Attach a Data Disk to a Linux Virtual Machine][virtual-machines-linux-how-to-attach-disk]</span></span>
> * <span data-ttu-id="17c39-393"><https://docs.microsoft.com/azure/storage/storage-about-disks-and-vhds-linux#temporary-disk></span><span class="sxs-lookup"><span data-stu-id="17c39-393"><https://docs.microsoft.com/azure/storage/storage-about-disks-and-vhds-linux#temporary-disk></span></span>
>
>

- - -
<span data-ttu-id="17c39-394">實際的磁碟機由於會儲存在主機伺服器本身，因此是可變更的。</span><span class="sxs-lookup"><span data-stu-id="17c39-394">The actual drive is volatile because it is getting stored on the host server itself.</span></span> <span data-ttu-id="17c39-395">如果重新部署時移動 VM (例如由於主機上的維護作業或關機後再重新啟動)，磁碟機內容會遺失。</span><span class="sxs-lookup"><span data-stu-id="17c39-395">If the VM moved in a redeployment (for example due to maintenance on the host or shutdown and restart) the content of the drive is lost.</span></span> <span data-ttu-id="17c39-396">因此，不適合在此磁碟機上儲存任何重要資料。</span><span class="sxs-lookup"><span data-stu-id="17c39-396">Therefore, it is not an option to store any important data on this drive.</span></span> <span data-ttu-id="17c39-397">此儲存體類型所使用的媒體類型會因不同的 VM 系列而異，而且會有相當不同的效能特性，截至 2015 年 6 月為止的類型如下所示︰</span><span class="sxs-lookup"><span data-stu-id="17c39-397">The type of media used for this type of storage differs between different VM series with very different performance characteristics which as of June 2015 look like:</span></span>

* <span data-ttu-id="17c39-398">A5-A7︰非常有限的效能。</span><span class="sxs-lookup"><span data-stu-id="17c39-398">A5-A7: Very limited performance.</span></span> <span data-ttu-id="17c39-399">除了分頁檔之外，不建議使用</span><span class="sxs-lookup"><span data-stu-id="17c39-399">Not recommended for anything beyond page file</span></span>
* <span data-ttu-id="17c39-400">A8-A11︰效能特性非常良好，有數萬個 IOPS 和 > 1 GB/秒的輸送量。</span><span class="sxs-lookup"><span data-stu-id="17c39-400">A8-A11: Very good performance characteristics with some ten thousand IOPS and >1GB/sec throughput.</span></span>
* <span data-ttu-id="17c39-401">D 系列︰效能特性非常良好，有數萬個 IOPS 和 > 1 GB/秒的輸送量。</span><span class="sxs-lookup"><span data-stu-id="17c39-401">D-Series: Very good performance characteristics with some then thousand IOPS and >1GB/sec throughput.</span></span>
* <span data-ttu-id="17c39-402">DS 系列︰效能特性非常良好，有數萬個 IOPS 和 > 1 GB/秒的輸送量。</span><span class="sxs-lookup"><span data-stu-id="17c39-402">DS-Series: Very good performance characteristics with some ten thousand IOPS and >1GB/sec throughput.</span></span>
* <span data-ttu-id="17c39-403">G 系列︰效能特性非常良好，有數萬個 IOPS 和 > 1 GB/秒的輸送量。</span><span class="sxs-lookup"><span data-stu-id="17c39-403">G-Series: Very good performance characteristics with some ten thousand IOPS and >1GB/sec throughput.</span></span>
* <span data-ttu-id="17c39-404">GS 系列︰效能特性非常良好，有數萬個 IOPS 和 > 1 GB/秒的輸送量。</span><span class="sxs-lookup"><span data-stu-id="17c39-404">GS-Series: Very good performance characteristics with some ten thousand IOPS and >1GB/sec throughput.</span></span>

<span data-ttu-id="17c39-405">以上陳述均適用於通過 SAP 認證的 VM 類型。</span><span class="sxs-lookup"><span data-stu-id="17c39-405">Statements above are applying to the VM types that are certified with SAP.</span></span> <span data-ttu-id="17c39-406">具有絕佳 IOPS 和輸送量的 VM 系列則可供某些 DBMS 功能使用。</span><span class="sxs-lookup"><span data-stu-id="17c39-406">The VM-series with excellent IOPS and throughput qualify for leverage by some DBMS features.</span></span> <span data-ttu-id="17c39-407">如需詳細資訊，請參閱 [DBMS 部署指南][dbms-guide]。</span><span class="sxs-lookup"><span data-stu-id="17c39-407">For more information, see the [DBMS Deployment Guide][dbms-guide].</span></span>

<span data-ttu-id="17c39-408">Microsoft Azure 儲存體提供永續性儲存體，以及 SAN 儲存體上看得到的一般保護和備援層級。</span><span class="sxs-lookup"><span data-stu-id="17c39-408">Microsoft Azure Storage provides persisted storage and the typical levels of protection and redundancy seen on SAN storage.</span></span> <span data-ttu-id="17c39-409">以 Azure 儲存體為基礎的磁碟是位於 Azure 儲存體服務中的虛擬硬碟 (VHD)。</span><span class="sxs-lookup"><span data-stu-id="17c39-409">Disks based on Azure Storage are virtual hard disk (VHDs) located in the Azure Storage Services.</span></span> <span data-ttu-id="17c39-410">本機 OS 磁碟 (Windows C:\,、Linux /dev/sda1) 會儲存在 Azure 儲存體上，而掛接到 VM 的其他磁碟區/磁碟也會儲存在這裡。</span><span class="sxs-lookup"><span data-stu-id="17c39-410">The local OS-Disk (Windows C:\, Linux /dev/sda1) is stored on the Azure Storage, and additional Volumes/Disks mounted to the VM get stored there, too.</span></span>

<span data-ttu-id="17c39-411">您可以從內部部署上傳現有的 VHD，或從 Azure 建立空的 VHD 並連接到已部署的 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-411">It is possible to upload an existing VHD from on-premises or create empty ones from within Azure and attach those to deployed VMs.</span></span>

<span data-ttu-id="17c39-412">建立 VHD 或將 VHD 上傳至 Azure 儲存體之後，就可以將這些 VHD 掛接並連接到現有的虛擬機器，以及複製現有 (已取消掛接) 的 VHD。</span><span class="sxs-lookup"><span data-stu-id="17c39-412">After creating or uploading a VHD into Azure Storage, it is possible to mount and attach those to an existing Virtual Machine and to copy existing (unmounted) VHD.</span></span>

<span data-ttu-id="17c39-413">由於這些 VHD 為永續性，因此當重新啟動及重新建立虛擬機器執行個體時，這些 VHD 中的資料和變更是安全的。</span><span class="sxs-lookup"><span data-stu-id="17c39-413">As those VHDs are persisted, data and changes within those are safe when rebooting and recreating a Virtual Machine instance.</span></span> <span data-ttu-id="17c39-414">即使刪除執行個體，這些 VHD 仍會保持安全並可重新部署，或在非 OS 磁碟的情況下掛接到其他 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-414">Even if an instance is deleted, these VHDs stay safe and can be redeployed or in case of non-OS disks can be mounted to other VMs.</span></span>

<span data-ttu-id="17c39-415">在 Azure 儲存體網路內，您可以設定不同的備援層級︰</span><span class="sxs-lookup"><span data-stu-id="17c39-415">Within the network of Azure Storage different redundancy levels can be configured:</span></span>

* <span data-ttu-id="17c39-416">您可以選取的最低層級為「本機備援」，這相當於「Azure 區域」的相同資料中心內有三個資料複本 (請參閱 [Azure 區域][planning-guide-3.1]一章)。</span><span class="sxs-lookup"><span data-stu-id="17c39-416">Minimum level that can be selected is ‘local redundancy’, which is equivalent to three-replica of the data within the same data center of an Azure Region (see chapter [Azure Regions][planning-guide-3.1]).</span></span>
* <span data-ttu-id="17c39-417">區域備援儲存體可將三個映像散佈到相同 Azure 區域內的不同資料中心。</span><span class="sxs-lookup"><span data-stu-id="17c39-417">Zone redundant storage, which spreads the three images over different data centers within the same Azure Region.</span></span>
* <span data-ttu-id="17c39-418">預設備援層級是異地備援，會將內容以非同步方式複寫到裝載於相同地緣政治區域中另一個 Azure 區域的另外三個資料映像。</span><span class="sxs-lookup"><span data-stu-id="17c39-418">Default redundancy level is geographic redundancy, which asynchronously replicates the content into another three images of the data into another Azure Region, which is hosted in the same geopolitical region.</span></span>

<span data-ttu-id="17c39-419">除了本文之外，另請參閱有關不同備援選項的表格：<https://azure.microsoft.com/pricing/details/storage/></span><span class="sxs-lookup"><span data-stu-id="17c39-419">Also see the table on top of this article regarding the different redundancy options: <https://azure.microsoft.com/pricing/details/storage/></span></span>

<span data-ttu-id="17c39-420">如需 Azure 儲存體的詳細資訊，請參閱：</span><span class="sxs-lookup"><span data-stu-id="17c39-420">More information about Azure Storage can be found here:</span></span>

* <span data-ttu-id="17c39-421"><https://azure.microsoft.com/documentation/services/storage/></span><span class="sxs-lookup"><span data-stu-id="17c39-421"><https://azure.microsoft.com/documentation/services/storage/></span></span>
* <span data-ttu-id="17c39-422"><https://azure.microsoft.com/services/site-recovery></span><span class="sxs-lookup"><span data-stu-id="17c39-422"><https://azure.microsoft.com/services/site-recovery></span></span>
* <span data-ttu-id="17c39-423"><https://docs.microsoft.com/rest/api/storageservices/Understanding-Block-Blobs--Append-Blobs--and-Page-Blobs></span><span class="sxs-lookup"><span data-stu-id="17c39-423"><https://docs.microsoft.com/rest/api/storageservices/Understanding-Block-Blobs--Append-Blobs--and-Page-Blobs></span></span>
* <span data-ttu-id="17c39-424"><https://blogs.msdn.com/b/azuresecurity/archive/2015/11/17/azure-disk-encryption-for-linux-and-windows-virtual-machines-public-preview.aspx></span><span class="sxs-lookup"><span data-stu-id="17c39-424"><https://blogs.msdn.com/b/azuresecurity/archive/2015/11/17/azure-disk-encryption-for-linux-and-windows-virtual-machines-public-preview.aspx></span></span>

#### <a name="azure-standard-storage"></a><span data-ttu-id="17c39-425">Azure 標準儲存體</span><span class="sxs-lookup"><span data-stu-id="17c39-425">Azure Standard Storage</span></span>
<span data-ttu-id="17c39-426">Azure 標準儲存體是 Azure IaaS 發行時可用的儲存體類型。</span><span class="sxs-lookup"><span data-stu-id="17c39-426">Azure Standard storage was the type of storage available when Azure IaaS was released.</span></span> <span data-ttu-id="17c39-427">每個單一磁碟會強制執行 IOPS 配額。</span><span class="sxs-lookup"><span data-stu-id="17c39-427">There were IOPS quotas enforced per single disk.</span></span> <span data-ttu-id="17c39-428">雖然體驗到的延遲，並不如一般針對內部部署裝載的高階 SAP 系統所部署的 SAN/NAS 裝置好；</span><span class="sxs-lookup"><span data-stu-id="17c39-428">Latency experienced was not in the same class as SAN/NAS devices typically deployed for high-end SAP systems hosted on-premises.</span></span> <span data-ttu-id="17c39-429">不過，Azure 標準儲存體證明對於目前部署在 Azure 中的數百個 SAP 系統便已足夠。</span><span class="sxs-lookup"><span data-stu-id="17c39-429">Nevertheless, the Azure Standard Storage proved sufficient for many hundreds SAP systems meanwhile deployed in Azure.</span></span>

<span data-ttu-id="17c39-430">Azure 標準儲存體帳戶上所儲存磁碟的收費依據包括儲存的實際資料、儲存體交易量、輸出資料傳輸及所選擇的備援選項。</span><span class="sxs-lookup"><span data-stu-id="17c39-430">Disks that are stored on Azure Standard Storage Accounts are charged based on the actual data that is stored, the volume of storage transactions, outbound data transfers, and redundancy option chosen.</span></span> <span data-ttu-id="17c39-431">許多磁碟可建立的大小上限為 1TB，但只要維持空白，就不會產生任何費用。</span><span class="sxs-lookup"><span data-stu-id="17c39-431">Many disks can be created at the maximum 1TB in size, but as long as those remain empty there is no charge.</span></span> <span data-ttu-id="17c39-432">如果您之後在某個 VHD 放置了 100GB，則會針對儲存 100GB 來向您收取費用，而不是所建立 VHD 的正常大小。</span><span class="sxs-lookup"><span data-stu-id="17c39-432">If you then fill one VHD with 100GB each, you are charged for storing 100GB and not for the nominal size the VHD got created with.</span></span>

#### <span data-ttu-id="17c39-433"><a name="ff5ad0f9-f7f4-4022-9102-af07aef3bc92"></a>Azure 進階儲存體</span><span class="sxs-lookup"><span data-stu-id="17c39-433"><a name="ff5ad0f9-f7f4-4022-9102-af07aef3bc92"></a>Azure Premium Storage</span></span>
<span data-ttu-id="17c39-434">在 2015 年 4 月，Microsoft 引進 Azure 進階儲存體。</span><span class="sxs-lookup"><span data-stu-id="17c39-434">In April 2015, Microsoft introduced Azure Premium Storage.</span></span> <span data-ttu-id="17c39-435">引進進階儲存體的目標在於提供︰</span><span class="sxs-lookup"><span data-stu-id="17c39-435">Premium Storage got introduced with the goal to provide:</span></span>

* <span data-ttu-id="17c39-436">更佳的 I/O 延遲。</span><span class="sxs-lookup"><span data-stu-id="17c39-436">Better I/O latency.</span></span>
* <span data-ttu-id="17c39-437">更佳的輸送量。</span><span class="sxs-lookup"><span data-stu-id="17c39-437">Better throughput.</span></span>
* <span data-ttu-id="17c39-438">更小的 I/O 延遲變化性。</span><span class="sxs-lookup"><span data-stu-id="17c39-438">Less variability in I/O latency.</span></span>

<span data-ttu-id="17c39-439">因此引進了許多變更，其中兩項最重要的變更為︰</span><span class="sxs-lookup"><span data-stu-id="17c39-439">For that purpose, many changes were introduced of which the two most significant are:</span></span>

* <span data-ttu-id="17c39-440">Azure 儲存體節點中的 SSD 磁碟使用方式</span><span class="sxs-lookup"><span data-stu-id="17c39-440">Usage of SSD disks in the Azure Storage nodes</span></span>
* <span data-ttu-id="17c39-441">Azure 計算節點的本機 SSD 所支援的新讀取快取</span><span class="sxs-lookup"><span data-stu-id="17c39-441">A new read cache that is backed by the local SSD of an Azure compute node</span></span>

<span data-ttu-id="17c39-442">相對於容量不會隨著磁碟 (或 VHD) 大小變更的標準儲存體，進階儲存體目前有三種不同的磁碟規模，如這篇文章所示：<https://azure.microsoft.com/pricing/details/storage/unmanaged-disks/></span><span class="sxs-lookup"><span data-stu-id="17c39-442">In opposite to Standard storage where capabilities did not change dependent on the size of the disk (or VHD), Premium Storage currently has three different disk categories, which are shown in this article: <https://azure.microsoft.com/pricing/details/storage/unmanaged-disks/></span></span>

<span data-ttu-id="17c39-443">如您所見，IOPS/磁碟和磁碟輸送量/磁碟相依於磁碟的大小類別</span><span class="sxs-lookup"><span data-stu-id="17c39-443">You see that IOPS/disk and disk throughput/disk are dependent on the size category of the disks</span></span>

<span data-ttu-id="17c39-444">進階儲存體的成本基礎不是儲存在這類磁碟的實際資料量，而是這類磁碟的大小規模，與儲存在磁碟內的資料量無關。</span><span class="sxs-lookup"><span data-stu-id="17c39-444">Cost basis in the case of Premium Storage is not the actual data volume stored in such disks, but the size category of such a disk, independent of the amount of the data that is stored within the disk.</span></span>

<span data-ttu-id="17c39-445">您也可以在進階儲存體上，建立未直接對應到所示大小規模的磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-445">You also can create disks on Premium Storage that are not directly mapping into the size categories shown.</span></span> <span data-ttu-id="17c39-446">特別是將磁碟從標準儲存體複製到進階儲存體時，就可能會發生此情況。</span><span class="sxs-lookup"><span data-stu-id="17c39-446">This may be the case, especially when copying disks from Standard Storage into Premium Storage.</span></span> <span data-ttu-id="17c39-447">在此情況下，會執行下一個最大進階儲存體磁碟選項的對應。</span><span class="sxs-lookup"><span data-stu-id="17c39-447">In such cases a mapping to the next largest Premium Storage disk option is performed.</span></span>

<span data-ttu-id="17c39-448">請注意，只有特定 VM 系列可從 Azure 進階儲存體受益。</span><span class="sxs-lookup"><span data-stu-id="17c39-448">Be aware that only certain VM series can benefit from the Azure Premium Storage.</span></span> <span data-ttu-id="17c39-449">截至 2015 年 12 月為止，這是指 DS 和 GS 系列。</span><span class="sxs-lookup"><span data-stu-id="17c39-449">As of Dec 2015, these are the DS- and GS-series.</span></span> <span data-ttu-id="17c39-450">DS 系列基本上與 D 系列相同，不同之處在於 DS 系列能夠將以進階儲存體為基礎的 VM，另外掛接到裝載於 Azure 標準儲存體上的磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-450">The DS-series is basically the same as D-series with the exception that DS-series has the ability to mount Premium Storage based VMs additionally to disks that are hosted on Azure Standard Storage.</span></span> <span data-ttu-id="17c39-451">當 G 系列與 GS 系列相較下也會發生相同的情況。</span><span class="sxs-lookup"><span data-stu-id="17c39-451">Same thing is valid for G-series compared to GS-series.</span></span>

<span data-ttu-id="17c39-452">如果您正在查看[這篇文章 (Linux)][virtual-machines-sizes-linux] 和[這篇文章 (Windows)][virtual-machines-sizes-windows] 中有關 DS 系列 VM 的部分，將會發現在 VM 層級的細微性上，「進階儲存體」磁碟有資料量限制。</span><span class="sxs-lookup"><span data-stu-id="17c39-452">If you are checking out the part of the DS-series VMs in [this article (Linux)][virtual-machines-sizes-linux] and [this article (Windows)][virtual-machines-sizes-windows], you realize that there are data volume limitations to Premium Storage disks on the granularity of the VM level.</span></span> <span data-ttu-id="17c39-453">不同的 DS 系列或 GS 系列 VM 對可掛接的資料磁碟數目也會有不同的限制。</span><span class="sxs-lookup"><span data-stu-id="17c39-453">Different DS-series or GS-series VMs also have different limitations in regards to the number of data disks that can be mounted.</span></span> <span data-ttu-id="17c39-454">這些限制也會記載於上述文章。</span><span class="sxs-lookup"><span data-stu-id="17c39-454">These limits are documented in the article mentioned above as well.</span></span> <span data-ttu-id="17c39-455">但基本上，這表示如果您將 32 x P30 磁碟掛接到單一 DS14 VM，便不會取得 32 x P30 磁碟的最大輸送量。</span><span class="sxs-lookup"><span data-stu-id="17c39-455">But in essence it means that if you, for example, mount 32 x P30 disks to a single DS14 VM you can NOT get 32 x the maximum throughput of a P30 disk.</span></span> <span data-ttu-id="17c39-456">相反地，如文章所述，VM 層級的最大輸送量會限制資料輸送量。</span><span class="sxs-lookup"><span data-stu-id="17c39-456">Instead the maximum throughput on VM level as documented in the article limits data throughput.</span></span>

<span data-ttu-id="17c39-457">如需有關進階儲存體的詳細資訊，請參閱：<http://azure.microsoft.com/blog/2015/04/16/azure-premium-storage-now-generally-available-2></span><span class="sxs-lookup"><span data-stu-id="17c39-457">More information on Premium Storage can be found here: <http://azure.microsoft.com/blog/2015/04/16/azure-premium-storage-now-generally-available-2></span></span>

#### <span data-ttu-id="17c39-458"><a name="c55b2c6e-3ca1-4476-be16-16c81927550f"></a>受控磁碟</span><span class="sxs-lookup"><span data-stu-id="17c39-458"><a name="c55b2c6e-3ca1-4476-be16-16c81927550f"></a>Managed Disks</span></span>
<span data-ttu-id="17c39-459">受控磁碟是 Azure Resource Manager 的新資源類型，可用來取代儲存在 Azure 儲存體帳戶的 VHD。</span><span class="sxs-lookup"><span data-stu-id="17c39-459">Managed Disks are a new resource type in Azure Resource Manager that can be used instead of VHDs that are stored in Azure Storage Accounts.</span></span> <span data-ttu-id="17c39-460">受控磁碟會針對所連接的虛擬機器，自動配合其可用性設定組，因此提高了虛擬機器和虛擬機器上所執行服務的可用性。</span><span class="sxs-lookup"><span data-stu-id="17c39-460">Managed Disks automatically align with the Availability Set of the virtual machine they are attached to and therefore increase the availability of your virtual machine and the services that are running on the virtual machine.</span></span> <span data-ttu-id="17c39-461">如需詳細資訊，請參閱[概觀文章](https://docs.microsoft.com/azure/storage/storage-managed-disks-overview)。</span><span class="sxs-lookup"><span data-stu-id="17c39-461">For more information, read the [overview article](https://docs.microsoft.com/azure/storage/storage-managed-disks-overview).</span></span>

<span data-ttu-id="17c39-462">由於受控磁碟可以簡化虛擬機器的部署和管理，因此建議您使用受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-462">We recommend to you use Managed disk, because they simplify the deployment and management of your virtual machines.</span></span>
<span data-ttu-id="17c39-463">SAP 目前僅支援進階受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-463">SAP currently only supports Premium Managed Disks.</span></span> <span data-ttu-id="17c39-464">如需詳細資訊，請參閱 SAP 附註 [1928533]。</span><span class="sxs-lookup"><span data-stu-id="17c39-464">For more information, read SAP Note [1928533].</span></span>

#### <a name="azure-storage-accounts"></a><span data-ttu-id="17c39-465">Azure 儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="17c39-465">Azure Storage Accounts</span></span>
<span data-ttu-id="17c39-466">在 Azure 中部署服務或 VM 時，VHD 和 VM 映像的部署可以組織成不同單位，稱為 Azure 儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-466">When deploying services or VMs in Azure, deployment of VHDs and VM Images can be organized in units called Azure Storage Accounts.</span></span> <span data-ttu-id="17c39-467">規劃 Azure 部署時，您必須仔細考慮 Azure 的限制。</span><span class="sxs-lookup"><span data-stu-id="17c39-467">When planning an Azure deployment, you need to carefully consider the restrictions of Azure.</span></span> <span data-ttu-id="17c39-468">一方面，每個 Azure 訂用帳戶的「儲存體帳戶」數目有限。</span><span class="sxs-lookup"><span data-stu-id="17c39-468">On the one side, there is a limited number of Storage Accounts per Azure subscription.</span></span> <span data-ttu-id="17c39-469">雖然每個 Azure 儲存體帳戶可以保存大量 VHD 檔案，但是每個儲存體帳戶的 IOPS 總計會有固定的限制。</span><span class="sxs-lookup"><span data-stu-id="17c39-469">Although each Azure Storage Account can hold a large number of VHD files, there is a fixed limit on the total IOPS per Storage Account.</span></span> <span data-ttu-id="17c39-470">當部署數百個 SAP VM 而導致 DBMS 系統建立大量 IO 呼叫時，建議將 IOPS 很高的 DBMS VM 分散到多個 Azure 儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-470">When deploying hundreds of SAP VMs with DBMS systems creating significant IO calls, it is recommended to distribute high IOPS DBMS VMs between multiple Azure Storage Accounts.</span></span> <span data-ttu-id="17c39-471">請務必小心，不要超過每個訂用帳戶的目前「Azure 儲存體帳戶」限制。</span><span class="sxs-lookup"><span data-stu-id="17c39-471">Care must be taken not to exceed the current limit of Azure Storage Accounts per subscription.</span></span> <span data-ttu-id="17c39-472">由於儲存體是 SAP 系統之資料庫部署不可或缺的一部分，因此在已參考的 [DBMS 部署指南][dbms-guide]中會更詳細地討論此概念。</span><span class="sxs-lookup"><span data-stu-id="17c39-472">Because storage is a vital part of the database deployment for an SAP system, this concept is discussed in more detail in the already referenced [DBMS Deployment Guide][dbms-guide].</span></span>

<span data-ttu-id="17c39-473">如需有關「Azure 儲存體帳戶」的詳細資訊，請參閱[這篇文章][storage-scalability-targets]。</span><span class="sxs-lookup"><span data-stu-id="17c39-473">More information about Azure Storage Accounts can be found in [this article][storage-scalability-targets].</span></span> <span data-ttu-id="17c39-474">閱讀這篇文章之後，您會了解 Azure 標準儲存體帳戶與進階儲存體帳戶之間的限制差異。</span><span class="sxs-lookup"><span data-stu-id="17c39-474">Reading this article, you realize that there are differences in the limitations between Azure Standard Storage Accounts and Premium Storage Accounts.</span></span> <span data-ttu-id="17c39-475">主要差異是可儲存在儲存體帳戶中的資料量。</span><span class="sxs-lookup"><span data-stu-id="17c39-475">Major differences are the volume of data that can be stored within such a Storage Account.</span></span> <span data-ttu-id="17c39-476">標準儲存體中的資料量大於進階儲存體中的資料量。</span><span class="sxs-lookup"><span data-stu-id="17c39-476">In Standard Storage the volume is a magnitude larger than with Premium Storage.</span></span> <span data-ttu-id="17c39-477">另一方面，標準儲存體帳戶的 IOPS 限制很嚴格 (請參閱 [總要求率] 一欄)，而 Azure 進階儲存體帳戶則沒有此限制。</span><span class="sxs-lookup"><span data-stu-id="17c39-477">On the other side, the Standard Storage Account is severely limited in IOPS (see column ‘Total Request Rate’), whereas the Azure Premium Storage Account has no such limitation.</span></span> <span data-ttu-id="17c39-478">當談到 SAP 系統 (特別是 DBMS 伺服器) 的部署時，我們將會探討這些差異的詳細資料和結果。</span><span class="sxs-lookup"><span data-stu-id="17c39-478">We will discuss details and results of these differences when discussing the deployments of SAP systems, especially the DBMS servers.</span></span>

<span data-ttu-id="17c39-479">在儲存體帳戶中，您可以建立不同的容器，來組織及分類不同的 VHD。</span><span class="sxs-lookup"><span data-stu-id="17c39-479">Within a Storage Account, you have the possibility to create different containers for the purpose of organizing and categorizing different VHDs.</span></span> <span data-ttu-id="17c39-480">這些容器通常用於不同 VM 的個別 VHD。</span><span class="sxs-lookup"><span data-stu-id="17c39-480">These containers are usually used to, for example, separate VHDs of different VMs.</span></span> <span data-ttu-id="17c39-481">在單一 Azure 儲存體帳戶下只使用一個容器或使用多個容器對效能不會有太大影響。</span><span class="sxs-lookup"><span data-stu-id="17c39-481">There are no performance implications in using just one container or multiple containers underneath a single Azure Storage Account.</span></span>

<span data-ttu-id="17c39-482">在 Azure 中，VHD 名稱會遵循下列命名慣例，必須為 Azure 中的 VHD 提供唯一的名稱︰</span><span class="sxs-lookup"><span data-stu-id="17c39-482">Within Azure a VHD name follows the following naming connection that needs to provide a unique name for the VHD within Azure:</span></span>

    http(s)://<storage account name>.blob.core.windows.net/<container name>/<vhd name>

<span data-ttu-id="17c39-483">如前所述，此字串必須唯一地識別儲存在 Azure 儲存體中的 VHD。</span><span class="sxs-lookup"><span data-stu-id="17c39-483">As mentioned the string above needs to uniquely identify the VHD that is stored on Azure Storage.</span></span>

### <span data-ttu-id="17c39-484"><a name="61678387-8868-435d-9f8c-450b2424f5bd"></a>Microsoft Azure 網路</span><span class="sxs-lookup"><span data-stu-id="17c39-484"><a name="61678387-8868-435d-9f8c-450b2424f5bd"></a>Microsoft Azure Networking</span></span>
<span data-ttu-id="17c39-485">Microsoft Azure 會提供網路基礎結構，可對應至我們想要透過 SAP 軟體實現的所有案例。</span><span class="sxs-lookup"><span data-stu-id="17c39-485">Microsoft Azure provides a network infrastructure, which allows the mapping of all scenarios, which we want to realize with SAP software.</span></span> <span data-ttu-id="17c39-486">其功能如下：</span><span class="sxs-lookup"><span data-stu-id="17c39-486">The capabilities are:</span></span>

* <span data-ttu-id="17c39-487">透過 Windows 終端機服務或 ssh/VNC 從外部直接存取 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-487">Access from the outside, directly to the VMs via Windows Terminal Services or ssh/VNC</span></span>
* <span data-ttu-id="17c39-488">存取 VM 中的應用程式所使用的服務和特定連接埠</span><span class="sxs-lookup"><span data-stu-id="17c39-488">Access to services and specific ports used by applications within the VMs</span></span>
* <span data-ttu-id="17c39-489">在部署為 Azure VM 的一組 VM 之間進行內部通訊和名稱解析</span><span class="sxs-lookup"><span data-stu-id="17c39-489">Internal Communication and Name Resolution between a group of VMs deployed as Azure VMs</span></span>
* <span data-ttu-id="17c39-490">客戶內部部署網路與 Azure 網路之間的跨單位連線能力</span><span class="sxs-lookup"><span data-stu-id="17c39-490">Cross-premises Connectivity between a customer’s on-premises network and the Azure network</span></span>
* <span data-ttu-id="17c39-491">Azure 網站之間的跨 Azure 區域或資料中心連線能力</span><span class="sxs-lookup"><span data-stu-id="17c39-491">Cross Azure Region or data center connectivity between Azure sites</span></span>

<span data-ttu-id="17c39-492">如需詳細資訊，請參閱這裡：<https://azure.microsoft.com/documentation/services/virtual-network/></span><span class="sxs-lookup"><span data-stu-id="17c39-492">More information can be found here: <https://azure.microsoft.com/documentation/services/virtual-network/></span></span>

<span data-ttu-id="17c39-493">在 Azure 中設定名稱和 IP 解析有許多可能的方法。</span><span class="sxs-lookup"><span data-stu-id="17c39-493">There are many different possibilities to configure name and IP resolution in Azure.</span></span> <span data-ttu-id="17c39-494">在本文中，僅限雲端案例需要使用 Azure DNS 的預設值 (相較於定義自己的 DNS 服務)。</span><span class="sxs-lookup"><span data-stu-id="17c39-494">In this document, Cloud-Only scenarios rely on the default of using Azure DNS (in contrast to defining an own DNS service).</span></span> <span data-ttu-id="17c39-495">此外，還可使用新的 Azure DNS 服務，而不是使用您自己的 DNS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="17c39-495">There is also a new Azure DNS service, which can be used instead of setting up your own DNS server.</span></span> <span data-ttu-id="17c39-496">如需詳細資訊，請參閱[這篇文章][virtual-networks-manage-dns-in-vnet]和[這個頁面](https://azure.microsoft.com/services/dns/)。</span><span class="sxs-lookup"><span data-stu-id="17c39-496">More information can be found in [this article][virtual-networks-manage-dns-in-vnet] and on [this page](https://azure.microsoft.com/services/dns/).</span></span>

<span data-ttu-id="17c39-497">在跨單位案例中，我們需要內部部署 AD/OpenLDAP/DNS 已透過 VPN 或私人連線擴充到 Azure。</span><span class="sxs-lookup"><span data-stu-id="17c39-497">For cross-premises scenarios, we are relying on the fact that the on-premises AD/OpenLDAP/DNS has been extended via VPN or private connection to Azure.</span></span> <span data-ttu-id="17c39-498">針對此處所述的特定案例，可能必須在 Azure 中安裝 AD/OpenLDAP 複本。</span><span class="sxs-lookup"><span data-stu-id="17c39-498">For certain scenarios as documented here, it might be necessary to have an AD/OpenLDAP replica installed in Azure.</span></span>

<span data-ttu-id="17c39-499">由於網路和名稱解析是 SAP 系統之資料庫部署不可或缺的一部分，因此在 [DBMS 部署指南][dbms-guide]中會更詳細地討論此概念。</span><span class="sxs-lookup"><span data-stu-id="17c39-499">Because networking and name resolution is a vital part of the database deployment for an SAP system, this concept is discussed in more detail in the [DBMS Deployment Guide][dbms-guide].</span></span>

##### <a name="azure-virtual-networks"></a><span data-ttu-id="17c39-500">Azure 虛擬網路</span><span class="sxs-lookup"><span data-stu-id="17c39-500">Azure Virtual Networks</span></span>
<span data-ttu-id="17c39-501">藉由建置 Azure 虛擬網路，您可以定義由 Azure DHCP 功能所配置之私人 IP 位址的位址範圍。</span><span class="sxs-lookup"><span data-stu-id="17c39-501">By building up an Azure Virtual Network, you can define the address range of the private IP addresses allocated by Azure DHCP functionality.</span></span> <span data-ttu-id="17c39-502">在跨單位案例中，定義的 IP 位址範圍仍會使用 Azure 的 DHCP 進行配置。</span><span class="sxs-lookup"><span data-stu-id="17c39-502">In cross-premises scenarios, the IP address range defined is still allocated using DHCP by Azure.</span></span> <span data-ttu-id="17c39-503">不過，網域名稱解析會在內部部署執行 (假設 VM 是內部部署網域的一部分)，因此可解析不同 Azure 雲端服務以外的位址。</span><span class="sxs-lookup"><span data-stu-id="17c39-503">However, Domain Name resolution is done on-premises (assuming that the VMs are a part of an on-premises domain) and hence can resolve addresses beyond different Azure Cloud Services.</span></span>

<span data-ttu-id="17c39-504">Azure 中的每個虛擬機器都必須連線到虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="17c39-504">Every Virtual Machine in Azure needs to be connected to a Virtual Network.</span></span>

<span data-ttu-id="17c39-505">如需更多詳細資料，請參閱[這篇文章][resource-groups-networking]和[這個頁面](https://azure.microsoft.com/documentation/services/virtual-network/)。</span><span class="sxs-lookup"><span data-stu-id="17c39-505">More details can be found in [this article][resource-groups-networking] and on [this page](https://azure.microsoft.com/documentation/services/virtual-network/).</span></span>

[comment]: <> (MShermannd TODO 找不到包含 OpenLDAP 主題 + ARM 的文章；)
[comment]: <> (MSSedusch <https://channel9.msdn.com/Blogs/Open/Load-balancing-highly-available-Linux-services-on-Windows-Azure-OpenLDAP-and-MySQL>)

> [!NOTE]
> <span data-ttu-id="17c39-508">根據預設，一旦部署 VM，就無法變更虛擬網路組態。</span><span class="sxs-lookup"><span data-stu-id="17c39-508">By default, once a VM is deployed you cannot change the Virtual Network configuration.</span></span> <span data-ttu-id="17c39-509">TCP/IP 設定必須留給 Azure DHCP 伺服器。</span><span class="sxs-lookup"><span data-stu-id="17c39-509">The TCP/IP settings must be left to the Azure DHCP server.</span></span> <span data-ttu-id="17c39-510">預設行為是動態 IP 指派。</span><span class="sxs-lookup"><span data-stu-id="17c39-510">Default behavior is Dynamic IP assignment.</span></span>
>
>

<span data-ttu-id="17c39-511">虛擬網路卡的 MAC 位址在調整大小後可能會變更，在此情況下，Windows 或 Linux 客體 OS 會挑選新的網路卡，並會自動使用 DHCP 來指派 IP 和 DNS 位址。</span><span class="sxs-lookup"><span data-stu-id="17c39-511">The MAC address of the virtual network card may change, for example after resize and the Windows or Linux guest OS picks up the new network card and automatically uses DHCP to assign the IP and DNS addresses in this case.</span></span>

##### <a name="static-ip-assignment"></a><span data-ttu-id="17c39-512">靜態 IP 指派</span><span class="sxs-lookup"><span data-stu-id="17c39-512">Static IP Assignment</span></span>
<span data-ttu-id="17c39-513">您可以將固定或保留的 IP 位址指派給 Azure 虛擬網路中的 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-513">It is possible to assign fixed or reserved IP addresses to VMs within an Azure Virtual Network.</span></span> <span data-ttu-id="17c39-514">在 Azure 虛擬網路中執行 VM 可讓您更有機會在需要進行某些案例時利用這項功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-514">Running the VMs in an Azure Virtual Network opens a great possibility to leverage this functionality if needed or required for some scenarios.</span></span> <span data-ttu-id="17c39-515">IP 指派會在整個 VM 存在期間保持有效，而不論 VM 是執行中或已關機。</span><span class="sxs-lookup"><span data-stu-id="17c39-515">The IP assignment remains valid throughout the existence of the VM, independent of whether the VM is running or shutdown.</span></span> <span data-ttu-id="17c39-516">因此，當您為虛擬網路定義 IP 位址範圍時，必須考慮 VM (執行中和已停止的 VM) 總數。</span><span class="sxs-lookup"><span data-stu-id="17c39-516">As a result, you need to take the overall number of VMs (running and stopped VMS) into account when defining the range of IP addresses for the Virtual Network.</span></span> <span data-ttu-id="17c39-517">在刪除 VM 及其網路介面之前，或在 IP 位址再次取消指派之前，會保持指派此 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="17c39-517">The IP address remains assigned either until the VM and its Network Interface is deleted or until the IP address gets de-assigned again.</span></span> <span data-ttu-id="17c39-518">如需詳細資訊，請參閱[這篇文章][virtual-networks-static-private-ip-arm-pportal]。</span><span class="sxs-lookup"><span data-stu-id="17c39-518">For more information, read [this article][virtual-networks-static-private-ip-arm-pportal].</span></span>

##### <a name="multiple-nics-per-vm"></a><span data-ttu-id="17c39-519">每個 VM 可以有多個 NIC</span><span class="sxs-lookup"><span data-stu-id="17c39-519">Multiple NICs per VM</span></span>
<span data-ttu-id="17c39-520">您可以為一個 Azure 虛擬機器定義多個虛擬網路介面卡 (vNIC)。</span><span class="sxs-lookup"><span data-stu-id="17c39-520">You can define multiple virtual network interface cards (vNIC) for an Azure Virtual Machine.</span></span> <span data-ttu-id="17c39-521">由於可擁有多個 vNIC，因此您可以開始設定網路流量分隔，例如透過一個 vNIC 路由傳送用戶端流量，並透過第二個 vNIC 路由傳送後端流量。</span><span class="sxs-lookup"><span data-stu-id="17c39-521">With the ability to have multiple vNICs you can start to set up network traffic separation where, for example, client traffic is routed through one vNIC and backend traffic is routed through a second vNIC.</span></span> <span data-ttu-id="17c39-522">不同的 VM 類型會有不同的 vNIC 數目限制。</span><span class="sxs-lookup"><span data-stu-id="17c39-522">Dependent on the type of VM there are different limitations in regards to the number of vNICs.</span></span> <span data-ttu-id="17c39-523">如需確切詳細資料、功能和限制，請參閱下列文章︰</span><span class="sxs-lookup"><span data-stu-id="17c39-523">Exact details, functionality, and restrictions can be found in these articles:</span></span>

* <span data-ttu-id="17c39-524">[建立具有多個 NIC 的 Windows VM][virtual-networks-multiple-nics-windows]</span><span class="sxs-lookup"><span data-stu-id="17c39-524">[Create a Windows VM with multiple NICs][virtual-networks-multiple-nics-windows]</span></span>
* <span data-ttu-id="17c39-525">[建立連接多個 NIC 的 Linux VM][virtual-networks-multiple-nics-linux]</span><span class="sxs-lookup"><span data-stu-id="17c39-525">[Create a Linux VM with multiple NICs][virtual-networks-multiple-nics-linux]</span></span>
* <span data-ttu-id="17c39-526">[使用範本部署多個 NIC VM][virtual-network-deploy-multinic-arm-template]</span><span class="sxs-lookup"><span data-stu-id="17c39-526">[Deploy multi NIC VMs using a template][virtual-network-deploy-multinic-arm-template]</span></span>
* <span data-ttu-id="17c39-527">[使用 PowerShell 部署多個 NIC VM][virtual-network-deploy-multinic-arm-ps]</span><span class="sxs-lookup"><span data-stu-id="17c39-527">[Deploy multi NIC VMs using PowerShell][virtual-network-deploy-multinic-arm-ps]</span></span>
* <span data-ttu-id="17c39-528">[使用 Azure CLI 部署多個 NIC VM][virtual-network-deploy-multinic-arm-cli]</span><span class="sxs-lookup"><span data-stu-id="17c39-528">[Deploy multi NIC VMs using the Azure CLI][virtual-network-deploy-multinic-arm-cli]</span></span>

#### <a name="site-to-site-connectivity"></a><span data-ttu-id="17c39-529">站對站連線能力</span><span class="sxs-lookup"><span data-stu-id="17c39-529">Site-to-Site Connectivity</span></span>
<span data-ttu-id="17c39-530">跨單位是指使用透明且永久的 VPN 連線連結 Azure VM 和內部部署 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-530">Cross-premises is Azure VMs and On-Premises linked with a transparent and permanent VPN connection.</span></span> <span data-ttu-id="17c39-531">預期會成為 Azure 中最常見的 SAP 部署模式。</span><span class="sxs-lookup"><span data-stu-id="17c39-531">It is expected to become the most common SAP deployment pattern in Azure.</span></span> <span data-ttu-id="17c39-532">假設 SAP 執行個體在 Azure 中的作業程序和流程應該以透明方式運作。</span><span class="sxs-lookup"><span data-stu-id="17c39-532">The assumption is that operational procedures and processes with SAP instances in Azure should work transparently.</span></span> <span data-ttu-id="17c39-533">這表示您應該能夠列印出這些系統，以及使用 SAP Transport Management System (TMS) 將變更從 Azure 中的開發系統傳輸到內部部署的測試系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-533">This means you should be able to print out of these systems as well as use the SAP Transport Management System (TMS) to transport changes from a development system in Azure to a test system, which is deployed on-premises.</span></span> <span data-ttu-id="17c39-534">如需有關站對站的詳細記載，請參閱[這篇文章][vpn-gateway-create-site-to-site-rm-powershell]</span><span class="sxs-lookup"><span data-stu-id="17c39-534">More documentation around site-to-site can be found in [this article][vpn-gateway-create-site-to-site-rm-powershell]</span></span>

##### <a name="vpn-tunnel-device"></a><span data-ttu-id="17c39-535">VPN 通道裝置</span><span class="sxs-lookup"><span data-stu-id="17c39-535">VPN Tunnel Device</span></span>
<span data-ttu-id="17c39-536">為了建立站對站連線 (內部部署資料中心對 Azure 資料中心)，您必須取得並設定 VPN 裝置，或使用在 Windows Server 2012 中引進作為軟體元件的路由和遠端存取服務 (RRAS)。</span><span class="sxs-lookup"><span data-stu-id="17c39-536">In order to create a site-to-site connection (on-premises data center to Azure data center), you need to either obtain and configure a VPN device, or use Routing and Remote Access Service (RRAS) which was introduced as a software component with Windows Server 2012.</span></span>

* <span data-ttu-id="17c39-537">[使用 PowerShell 建立具有站對站 VPN 連線的虛擬網路][vpn-gateway-create-site-to-site-rm-powershell]</span><span class="sxs-lookup"><span data-stu-id="17c39-537">[Create a virtual network with a site-to-site VPN connection using PowerShell][vpn-gateway-create-site-to-site-rm-powershell]</span></span>
* <span data-ttu-id="17c39-538">[關於站對站 VPN 閘道連線的 VPN 裝置][vpn-gateway-about-vpn-devices]</span><span class="sxs-lookup"><span data-stu-id="17c39-538">[About VPN devices for Site-to-Site VPN Gateway connections][vpn-gateway-about-vpn-devices]</span></span>
* <span data-ttu-id="17c39-539">[VPN 閘道常見問題集][vpn-gateway-vpn-faq]</span><span class="sxs-lookup"><span data-stu-id="17c39-539">[VPN Gateway FAQ][vpn-gateway-vpn-faq]</span></span>

![內部部署與 Azure 之間的站對站連線][planning-guide-figure-600]

<span data-ttu-id="17c39-541">上圖顯示兩個 Azure 訂用帳戶，其 IP 位址子範圍已保留給 Azure 中的「虛擬網路」使用。</span><span class="sxs-lookup"><span data-stu-id="17c39-541">The Figure above shows two Azure subscriptions have IP address subranges reserved for usage in Virtual Networks in Azure.</span></span> <span data-ttu-id="17c39-542">從內部部署網路到 Azure 的連線是透過 VPN 建立。</span><span class="sxs-lookup"><span data-stu-id="17c39-542">The connectivity from the on-premises network to Azure is established via VPN.</span></span>

#### <a name="point-to-site-vpn"></a><span data-ttu-id="17c39-543">點對站 VPN</span><span class="sxs-lookup"><span data-stu-id="17c39-543">Point-to-Site VPN</span></span>
<span data-ttu-id="17c39-544">點對站 VPN 需要每個用戶端電腦使用自己的 VPN 連線到 Azure。</span><span class="sxs-lookup"><span data-stu-id="17c39-544">Point-to-site VPN requires every client machine to connect with its own VPN into Azure.</span></span> <span data-ttu-id="17c39-545">針對我們所討論的 SAP 案例，點對站連線能力並不實用。</span><span class="sxs-lookup"><span data-stu-id="17c39-545">For the SAP scenarios we are looking at, point-to-site connectivity is not practical.</span></span> <span data-ttu-id="17c39-546">因此，不會針對點對站 VPN 連線能力提供進一步的參考資料。</span><span class="sxs-lookup"><span data-stu-id="17c39-546">Therefore, no further references are given to point-to-site VPN connectivity.</span></span>

<span data-ttu-id="17c39-547">如需詳細資訊，請參閱這裡</span><span class="sxs-lookup"><span data-stu-id="17c39-547">More information can be found here</span></span>
* [<span data-ttu-id="17c39-548">使用 Azure 入口網站設定 VNet 的點對站連線</span><span class="sxs-lookup"><span data-stu-id="17c39-548">Configure a Point-to-Site connection to a VNet using the Azure portal</span></span>](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal)
* [<span data-ttu-id="17c39-549">使用 PowerShell 設定 VNet 的點對站連線</span><span class="sxs-lookup"><span data-stu-id="17c39-549">Configure a Point-to-Site connection to a VNet using PowerShell</span></span>](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-howto-point-to-site-rm-ps)

#### <a name="multi-site-vpn"></a><span data-ttu-id="17c39-550">多站台 VPN</span><span class="sxs-lookup"><span data-stu-id="17c39-550">Multi-Site VPN</span></span>
<span data-ttu-id="17c39-551">Azure 現在也可讓您為一個 Azure 訂用帳戶建立「多站台 VPN」連線能力。</span><span class="sxs-lookup"><span data-stu-id="17c39-551">Azure also nowadays offers the possibility to create Multi-Site VPN connectivity for one Azure subscription.</span></span> <span data-ttu-id="17c39-552">之前，單一訂用帳戶僅限於一個站對站 VPN 連線。</span><span class="sxs-lookup"><span data-stu-id="17c39-552">Previously a single subscription was limited to one site-to-site VPN connection.</span></span> <span data-ttu-id="17c39-553">此限制在單一訂用帳戶可以有「多站台 VPN」連線之後已不存在。</span><span class="sxs-lookup"><span data-stu-id="17c39-553">This limitation went away with Multi-Site VPN connections for a single subscription.</span></span> <span data-ttu-id="17c39-554">您可以透過「跨單位」組態，針對特定訂用帳戶使用多個「Azure 區域」。</span><span class="sxs-lookup"><span data-stu-id="17c39-554">This makes it possible to leverage more than one Azure Region for a specific subscription through cross-premises configurations.</span></span>

<span data-ttu-id="17c39-555">如需詳細的記載，請參閱[這篇文章][vpn-gateway-create-site-to-site-rm-powershell]</span><span class="sxs-lookup"><span data-stu-id="17c39-555">For more documentation, please see [this article][vpn-gateway-create-site-to-site-rm-powershell]</span></span>

[comment]: <> (MShermannd TODO 找不到 ARM 文件連結)

#### <a name="vnet-to-vnet-connection"></a><span data-ttu-id="17c39-557">VNet 對 VNet 連線</span><span class="sxs-lookup"><span data-stu-id="17c39-557">VNet to VNet Connection</span></span>
<span data-ttu-id="17c39-558">使用多網站 VPN 時，您必須在每個區域中設定不同的 Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="17c39-558">Using Multi-Site VPN, you need to configure a separate Azure Virtual Network in each of the regions.</span></span> <span data-ttu-id="17c39-559">不過，您通常必須讓不同區域中的軟體元件能夠彼此通訊。</span><span class="sxs-lookup"><span data-stu-id="17c39-559">However very often you have the requirement that the software components in the different regions should communicate with each other.</span></span> <span data-ttu-id="17c39-560">在理想情況下，此通訊應該從一個 Azure 區域路由傳送至內部部署，再由此路由傳送至其他 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="17c39-560">Ideally this communication should not be routed from one Azure Region to on-premises and from there to the other Azure Region.</span></span> <span data-ttu-id="17c39-561">簡而言之，Azure 可讓您設定從某個區域中的一個 Azure 虛擬網路到裝載於另一個區域中之另一個 Azure 虛擬網路的連線。</span><span class="sxs-lookup"><span data-stu-id="17c39-561">To shortcut, Azure offers the possibility to configure a connection from one Azure Virtual Network in one region to another Azure Virtual Network hosted in another region.</span></span> <span data-ttu-id="17c39-562">此功能稱為 VNet 對 VNet 連線。</span><span class="sxs-lookup"><span data-stu-id="17c39-562">This functionality is called VNet-to-VNet connection.</span></span> <span data-ttu-id="17c39-563">如需有關此功能的詳細資訊，請參閱這裡：<https://azure.microsoft.com/documentation/articles/vpn-gateway-vnet-vnet-rm-ps/>。</span><span class="sxs-lookup"><span data-stu-id="17c39-563">More details on this functionality can be found here: <https://azure.microsoft.com/documentation/articles/vpn-gateway-vnet-vnet-rm-ps/>.</span></span>

#### <a name="private-connection-to-azure--expressroute"></a><span data-ttu-id="17c39-564">Azure 的私人連線 - ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="17c39-564">Private Connection to Azure – ExpressRoute</span></span>
<span data-ttu-id="17c39-565">Microsoft Azure ExpressRoute 可在 Azure 資料中心與客戶的內部部署基礎結構或共置環境中的基礎結構之間建立私人連線。</span><span class="sxs-lookup"><span data-stu-id="17c39-565">Microsoft Azure ExpressRoute allows the creation of private connections between Azure data centers and either the customer's on-premises infrastructure or in a co-location environment.</span></span> <span data-ttu-id="17c39-566">ExpressRoute 是由各種 MPLS (封包交換式) VPN 提供者或其他網路服務提供者所提供。</span><span class="sxs-lookup"><span data-stu-id="17c39-566">ExpressRoute is offered by various MPLS (packet switched) VPN providers or other Network Service Providers.</span></span> <span data-ttu-id="17c39-567">ExpressRoute 連線不會經過公用網際網路。</span><span class="sxs-lookup"><span data-stu-id="17c39-567">ExpressRoute connections do not go over the public Internet.</span></span> <span data-ttu-id="17c39-568">相較於網際網路一般連線，ExpressRoute 連線提供更高安全性、透過多個平行循環提高可靠性、更快速度以及更低延遲。</span><span class="sxs-lookup"><span data-stu-id="17c39-568">ExpressRoute connections offer higher security, more reliability through multiple parallel circuits, faster speeds, and lower latencies than typical connections over the Internet.</span></span>

<span data-ttu-id="17c39-569">如需 Azure ExpressRoute 和供應項目的詳細資訊，請參閱︰</span><span class="sxs-lookup"><span data-stu-id="17c39-569">Find more details on Azure ExpressRoute and offerings here:</span></span>

* <span data-ttu-id="17c39-570"><https://azure.microsoft.com/documentation/services/expressroute/></span><span class="sxs-lookup"><span data-stu-id="17c39-570"><https://azure.microsoft.com/documentation/services/expressroute/></span></span>
* <span data-ttu-id="17c39-571"><https://azure.microsoft.com/pricing/details/expressroute/></span><span class="sxs-lookup"><span data-stu-id="17c39-571"><https://azure.microsoft.com/pricing/details/expressroute/></span></span>
* <span data-ttu-id="17c39-572"><https://azure.microsoft.com/documentation/articles/expressroute-faqs/></span><span class="sxs-lookup"><span data-stu-id="17c39-572"><https://azure.microsoft.com/documentation/articles/expressroute-faqs/></span></span>

<span data-ttu-id="17c39-573">如下方所記載，Express Route 可透過一個 ExpressRoute 循環來啟用多個 Azure 訂用帳戶</span><span class="sxs-lookup"><span data-stu-id="17c39-573">Express Route enables multiple Azure subscriptions through one ExpressRoute circuit as documented here</span></span>

* <span data-ttu-id="17c39-574"><https://azure.microsoft.com/documentation/articles/expressroute-howto-linkvnet-arm/></span><span class="sxs-lookup"><span data-stu-id="17c39-574"><https://azure.microsoft.com/documentation/articles/expressroute-howto-linkvnet-arm/></span></span>
* <span data-ttu-id="17c39-575"><https://azure.microsoft.com/documentation/articles/expressroute-howto-circuit-arm/></span><span class="sxs-lookup"><span data-stu-id="17c39-575"><https://azure.microsoft.com/documentation/articles/expressroute-howto-circuit-arm/></span></span>

#### <a name="forced-tunneling-in-case-of-cross-premises"></a><span data-ttu-id="17c39-576">跨單位時的強制通道</span><span class="sxs-lookup"><span data-stu-id="17c39-576">Forced tunneling in case of cross-premises</span></span>
<span data-ttu-id="17c39-577">針對透過站對站、點對站或 ExpressRoute 加入內部部署網域的 VM，您也必須確定為這些 VM 中的所有使用者部署網際網路 Proxy 設定。</span><span class="sxs-lookup"><span data-stu-id="17c39-577">For VMs joining on-premises domains through site-to-site, point-to-site or ExpressRoute, you need to make sure that the Internet proxy settings are getting deployed for all the users in those VMs as well.</span></span> <span data-ttu-id="17c39-578">根據預設，在這些 VM 中執行的軟體或使用瀏覽器存取網際網路的使用者不會經過公司 Proxy，而是會透過 Azure 直接連線到網際網路。</span><span class="sxs-lookup"><span data-stu-id="17c39-578">By default, software running in those VMs or users using a browser to access the internet would not go through the company proxy, but would connect straight through Azure to the internet.</span></span> <span data-ttu-id="17c39-579">但即使是 Proxy 設定也無法 100% 解決將流量引導通過公司 Proxy 的問題，因為檢查 Proxy 的責任在於軟體和服務。</span><span class="sxs-lookup"><span data-stu-id="17c39-579">But even the proxy setting is not a 100% solution to direct the traffic through the company proxy since it is responsibility of software and services to check for the proxy.</span></span> <span data-ttu-id="17c39-580">如果在 VM 中執行的軟體未執行該項作業，或是由系統管理員管理設定，則前往網際網路的流量可能會透過 Azure 直接再次繞道至網際網路。</span><span class="sxs-lookup"><span data-stu-id="17c39-580">If software running in the VM is not doing that or an administrator manipulates the settings, traffic to the Internet can be detoured again directly through Azure to the Internet.</span></span>

<span data-ttu-id="17c39-581">若要避免此問題，您可以在內部部署與 Azure 之間設定具有站對站連線能力的強制通道。</span><span class="sxs-lookup"><span data-stu-id="17c39-581">In order to avoid this, you can configure Forced Tunneling with site-to-site connectivity between on-premises and Azure.</span></span> <span data-ttu-id="17c39-582">如需「強制通道」功能的詳細說明，請參閱這裡 <https://azure.microsoft.com/documentation/articles/vpn-gateway-forced-tunneling-rm/></span><span class="sxs-lookup"><span data-stu-id="17c39-582">The detailed description of the Forced Tunneling feature is published here <https://azure.microsoft.com/documentation/articles/vpn-gateway-forced-tunneling-rm/></span></span>

<span data-ttu-id="17c39-583">ExpressRoute 強制通道會透過 ExpressRoute BGP 對等互連工作階段廣告預設路由的客戶進行啟用。</span><span class="sxs-lookup"><span data-stu-id="17c39-583">Forced Tunneling with ExpressRoute is enabled by customers advertising a default route via the ExpressRoute BGP peering sessions.</span></span>

#### <a name="summary-of-azure-networking"></a><span data-ttu-id="17c39-584">Azure 網路摘要</span><span class="sxs-lookup"><span data-stu-id="17c39-584">Summary of Azure Networking</span></span>
<span data-ttu-id="17c39-585">本章包含有關 Azure 網路的許多重點。</span><span class="sxs-lookup"><span data-stu-id="17c39-585">This chapter contained many important points about Azure Networking.</span></span> <span data-ttu-id="17c39-586">以下是重點摘要：</span><span class="sxs-lookup"><span data-stu-id="17c39-586">Here is a summary of the main points:</span></span>

* <span data-ttu-id="17c39-587">Azure 虛擬網路允許根據您自己的需求來設定網路</span><span class="sxs-lookup"><span data-stu-id="17c39-587">Azure Virtual Networks allows to set up the network according to your own needs</span></span>
* <span data-ttu-id="17c39-588">Azure 虛擬網路可用來將 IP 位址範圍指派給 VM，或將固定 IP 位址指派給 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-588">Azure Virtual Networks can be leveraged to assign IP address ranges to VMs or assign fixed IP addresses to VMs</span></span>
* <span data-ttu-id="17c39-589">若要設定站對站或點對站連線，您必須先建立 Azure 虛擬網路</span><span class="sxs-lookup"><span data-stu-id="17c39-589">To set up a Site-To-Site or Point-To-Site connection you need to create an Azure Virtual Network first</span></span>
* <span data-ttu-id="17c39-590">一旦部署虛擬機器，就無法再變更指派給 VM 的虛擬網路</span><span class="sxs-lookup"><span data-stu-id="17c39-590">Once a virtual machine has been deployed, it is no longer possible to change the Virtual Network assigned to the VM</span></span>

### <a name="quotas-in-azure-virtual-machine-services"></a><span data-ttu-id="17c39-591">Azure 虛擬機器服務中的配額</span><span class="sxs-lookup"><span data-stu-id="17c39-591">Quotas in Azure Virtual Machine Services</span></span>
<span data-ttu-id="17c39-592">我們必須清楚了解在 Azure 基礎結構中執行各種服務的 VM 之間，會共用儲存體和網路基礎結構。</span><span class="sxs-lookup"><span data-stu-id="17c39-592">We need to be clear about the fact that the storage and network infrastructure is shared between VMs running a variety of services in the Azure infrastructure.</span></span> <span data-ttu-id="17c39-593">就像是客戶自己的資料中心，在某種程度上，也會發生過度佈建一些基礎結構資源的情況。</span><span class="sxs-lookup"><span data-stu-id="17c39-593">And just as in the customer’s own data centers, over-provisioning of some of the infrastructure resources does take place to a degree.</span></span> <span data-ttu-id="17c39-594">Microsoft Azure 平台使用磁碟、CPU、網路和其他配額來限制資源耗用量，並保持一致且具決定性的效能。</span><span class="sxs-lookup"><span data-stu-id="17c39-594">The Microsoft Azure Platform uses disk, CPU, network, and other quotas to limit the resource consumption and to preserve consistent and deterministic performance.</span></span>  <span data-ttu-id="17c39-595">不同的 VM 類型 (A5、A6 等) 會有不同的磁碟數、CPU、RAM 和網路配額。</span><span class="sxs-lookup"><span data-stu-id="17c39-595">The different VM types (A5, A6, etc.) have different quotas for the number of disks, CPU, RAM, and Network.</span></span>

> [!NOTE]
> <span data-ttu-id="17c39-596">主機節點上會預先配置 SAP 支援之 VM 類型的 CPU 和記憶體資源。</span><span class="sxs-lookup"><span data-stu-id="17c39-596">CPU and memory resources of the VM types supported by SAP are pre-allocated on the host nodes.</span></span> <span data-ttu-id="17c39-597">這表示一旦部署 VM，就會如 VM 類型所定義來提供主機上的資源。</span><span class="sxs-lookup"><span data-stu-id="17c39-597">This means that once the VM is deployed, the resources on the host are available as defined by the VM type.</span></span>
>
>

<span data-ttu-id="17c39-598">在 Azure 解決方案上規劃 SAP 及調整其大小時，必須考慮每個虛擬機器的大小配額。</span><span class="sxs-lookup"><span data-stu-id="17c39-598">When planning and sizing SAP on Azure solutions the quotas for each virtual machine size must be considered.</span></span> <span data-ttu-id="17c39-599">如需 VM 配額的說明，請參閱[這裡 (Linux)][virtual-machines-sizes-linux] 和[這裡 (Windows)][virtual-machines-sizes-windows]。</span><span class="sxs-lookup"><span data-stu-id="17c39-599">The VM quotas are described [here (Linux)][virtual-machines-sizes-linux] and [here (Windows)][virtual-machines-sizes-windows].</span></span>

<span data-ttu-id="17c39-600">所述配額代表理論上的最大值。</span><span class="sxs-lookup"><span data-stu-id="17c39-600">The quotas described represent the theoretical maximum values.</span></span>  <span data-ttu-id="17c39-601">小型 IO (8 KB) 可達到每個磁碟的 IOPS 限制，但大型 IO (1 MB) 則可能無法達到。</span><span class="sxs-lookup"><span data-stu-id="17c39-601">The limit of IOPS per disk may be achieved with small IOs (8kb) but possibly may not be achieved with large IOs (1Mb).</span></span>  <span data-ttu-id="17c39-602">IOPS 限制會在單一磁碟的資料粒度上強制執行。</span><span class="sxs-lookup"><span data-stu-id="17c39-602">The IOPS limit is enforced on the granularity of single disk.</span></span>

<span data-ttu-id="17c39-603">您可以使用下列決策樹，作為在判斷 SAP 系統是否符合 Azure 虛擬機器服務及其功能，或是現有的系統是否必須以不同方式設定才能在 Azure 上部署系統時的大致決策樹︰</span><span class="sxs-lookup"><span data-stu-id="17c39-603">As a rough decision tree to decide whether an SAP system fits into Azure Virtual Machine Services and its capabilities or whether an existing system needs to be configured differently in order to deploy the system on Azure, the decision tree below can be used:</span></span>

![決定能否將 SAP 部署在 Azure 的決策樹][planning-guide-figure-700]

<span data-ttu-id="17c39-605">**步驟 1**︰若要開始著手進行，最重要的資訊就是所指定 SAP 系統的 SAPS 需求。</span><span class="sxs-lookup"><span data-stu-id="17c39-605">**Step 1**: The most important information to start with is the SAPS requirement for a given SAP system.</span></span> <span data-ttu-id="17c39-606">您必須將 SAPS 需求分為 DBMS 部分和 SAP 應用程式部分，即使 SAP 系統已在 2 層組態中內部部署亦然。</span><span class="sxs-lookup"><span data-stu-id="17c39-606">The SAPS requirements need to be separated out into the DBMS part and the SAP application part, even if the SAP system is already deployed on-premises in a 2-tier configuration.</span></span> <span data-ttu-id="17c39-607">若是現有的系統，通常可根據現有的 SAP 基準來判斷或評估與使用中硬體相關的 SAPS。</span><span class="sxs-lookup"><span data-stu-id="17c39-607">For existing systems, the SAPS related to the hardware in use often can be determined or estimated based on existing SAP benchmarks.</span></span> <span data-ttu-id="17c39-608">結果可以在這裡找到︰<http://global.sap.com/campaigns/benchmark/index.epx>。</span><span class="sxs-lookup"><span data-stu-id="17c39-608">The results can be found here: <http://global.sap.com/campaigns/benchmark/index.epx>.</span></span>
<span data-ttu-id="17c39-609">若是新部署的 SAP 系統，您應該已經完成調整大小練習，而能判斷系統的 SAPS 需求。</span><span class="sxs-lookup"><span data-stu-id="17c39-609">For newly deployed SAP systems, you should have gone through a sizing exercise, which should determine the SAPS requirements of the system.</span></span>
<span data-ttu-id="17c39-610">關於 Azure 上的 SAP 大小調整，另請參閱這個部落格和附加的文件：<http://blogs.msdn.com/b/saponsqlserver/archive/2015/12/01/new-white-paper-on-sizing-sap-solutions-on-azure-public-cloud.aspx></span><span class="sxs-lookup"><span data-stu-id="17c39-610">See also this blog and attached document for SAP sizing on Azure: <http://blogs.msdn.com/b/saponsqlserver/archive/2015/12/01/new-white-paper-on-sizing-sap-solutions-on-azure-public-cloud.aspx></span></span>

<span data-ttu-id="17c39-611">**步驟 2**︰若為現有的系統，應該測量 DBMS 伺服器上的每秒 I/O 量和 I/O 作業數。</span><span class="sxs-lookup"><span data-stu-id="17c39-611">**Step 2**: For existing systems, the I/O volume and I/O operations per second on the DBMS server should be measured.</span></span> <span data-ttu-id="17c39-612">若為新規劃的系統，新系統的調整大小練習也應該讓您大致了解 DBMS 端的 I/O 需求。</span><span class="sxs-lookup"><span data-stu-id="17c39-612">For newly planned systems, the sizing exercise for the new system also should give rough ideas of the I/O requirements on the DBMS side.</span></span> <span data-ttu-id="17c39-613">如果不確定，您最終還是需要進行概念證明。</span><span class="sxs-lookup"><span data-stu-id="17c39-613">If unsure, you eventually need to conduct a Proof of Concept.</span></span>

<span data-ttu-id="17c39-614">**步驟 3**︰將 DBMS 伺服器的 SAPS 需求，與不同的 Azure VM 類型可提供的 SAPS 進行比較。</span><span class="sxs-lookup"><span data-stu-id="17c39-614">**Step 3**: Compare the SAPS requirement for the DBMS server with the SAPS the different VM types of Azure can provide.</span></span> <span data-ttu-id="17c39-615">如需有關不同 Azure VM 類型的 SAPS 資訊，請參閱 SAP 附註 [1928533]。</span><span class="sxs-lookup"><span data-stu-id="17c39-615">The information on SAPS of the different Azure VM types is documented in SAP Note [1928533].</span></span> <span data-ttu-id="17c39-616">重點應該先放在 DBMS VM，因為資料庫層是大多數部署中不會向外延展的 SAP NetWeaver 系統層級。</span><span class="sxs-lookup"><span data-stu-id="17c39-616">The focus should be on the DBMS VM first since the database layer is the layer in an SAP NetWeaver system that does not scale out in the majority of deployments.</span></span> <span data-ttu-id="17c39-617">相反地，SAP 應用程式層則可以向外延展。如果 SAP 支援的任何 Azure VM 類型都無法提供所需的 SAPS，則無法在 Azure 上執行規劃之 SAP 系統的工作負載。</span><span class="sxs-lookup"><span data-stu-id="17c39-617">In contrast, the SAP application layer can be scaled out. If none of the SAP supported Azure VM types can deliver the required SAPS, the workload of the planned SAP system can’t be run on Azure.</span></span> <span data-ttu-id="17c39-618">您必須在內部部署系統，或必須變更系統的工作負載。</span><span class="sxs-lookup"><span data-stu-id="17c39-618">You either need to deploy the system on-premises or you need to change the workload volume for the system.</span></span>

<span data-ttu-id="17c39-619">**步驟 4**︰如[這裡 (Linux)][virtual-machines-sizes-linux] 和[這裡 (Windows)][virtual-machines-sizes-windows] 所述，不論您使用的是「標準儲存體」還是「進階儲存體」，Azure 都會針對每個磁碟強制執行 IOPS 配額。</span><span class="sxs-lookup"><span data-stu-id="17c39-619">**Step 4**: As documented [here (Linux)][virtual-machines-sizes-linux] and [here (Windows)][virtual-machines-sizes-windows], Azure enforces an IOPS quota per disk independent whether you use Standard Storage or Premium Storage.</span></span> <span data-ttu-id="17c39-620">可掛接的資料磁碟數目會因 VM 類型而異。</span><span class="sxs-lookup"><span data-stu-id="17c39-620">Dependent on the VM type, the number of data disks, which can be mounted varies.</span></span> <span data-ttu-id="17c39-621">因此，您可以計算每個不同的 VM 類型可達到的 IOPS 數目上限。</span><span class="sxs-lookup"><span data-stu-id="17c39-621">As a result, you can calculate a maximum IOPS number that can be achieved with each of the different VM types.</span></span> <span data-ttu-id="17c39-622">您可以根據資料庫檔案配置，將磁碟等量劃分成客體 OS 中的一個磁碟區。</span><span class="sxs-lookup"><span data-stu-id="17c39-622">Dependent on the database file layout, you can stripe disks to become one volume in the guest OS.</span></span> <span data-ttu-id="17c39-623">不過，如果所部署 SAP 系統的目前 IOPS 磁碟區超過最大 Azure VM 類型的計算限制，而且沒有機會可以補償更多記憶體，則會嚴重影響 SAP 系統的工作負載。</span><span class="sxs-lookup"><span data-stu-id="17c39-623">However, if the current IOPS volume of a deployed SAP system exceeds the calculated limits of the largest VM type of Azure and if there is no chance to compensate with more memory, the workload of the SAP system can be impacted severely.</span></span> <span data-ttu-id="17c39-624">在此情況下，您可能不應該在 Azure 上部署系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-624">In such cases, you can hit a point where you should not deploy the system on Azure.</span></span>

<span data-ttu-id="17c39-625">**步驟 5**︰特別是在於 2 層組態中內部部署的 SAP 系統中，有可能必須在一個 3 層組態的 Azure 上設定系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-625">**Step 5**: Especially in SAP systems, which are deployed on-premises in 2-Tier configurations, the chances are that the system might need to be configured on Azure in a 3-Tier configuration.</span></span> <span data-ttu-id="17c39-626">在此步驟中，您必須檢查 SAP 應用程式層中是否有元件無法向外延展，而且不符合不同 Azure VM 類型所提供的 CPU 和記憶體資源限制。</span><span class="sxs-lookup"><span data-stu-id="17c39-626">In this step, you need to check whether there is a component in the SAP application layer, which can’t be scaled out and which would not fit into the CPU and memory resources the different Azure VM types offer.</span></span> <span data-ttu-id="17c39-627">如果確實有此元件，則無法將 SAP 系統及其工作負載部署到 Azure。</span><span class="sxs-lookup"><span data-stu-id="17c39-627">If there indeed is such a component, the SAP system and its workload can’t be deployed into Azure.</span></span> <span data-ttu-id="17c39-628">但是，如果您可以將 SAP 應用程式元件向外延展到多個 Azure VM，則可以將系統部署到 Azure。</span><span class="sxs-lookup"><span data-stu-id="17c39-628">But if you can scale out the SAP application components into multiple Azure VMs, the system can be deployed into Azure.</span></span>

<span data-ttu-id="17c39-629">**步驟 6**︰如果可以在 Azure VM 中執行 DBMS 和 SAP 應用程式層元件，則必須定義與下列各項相關的組態︰</span><span class="sxs-lookup"><span data-stu-id="17c39-629">**Step 6**: If the DBMS and SAP application layer components can be run in Azure VMs, the configuration needs to be defined with regard to:</span></span>

* <span data-ttu-id="17c39-630">Azure VM 數目</span><span class="sxs-lookup"><span data-stu-id="17c39-630">Number of Azure VMs</span></span>
* <span data-ttu-id="17c39-631">個別元件的 VM 類型</span><span class="sxs-lookup"><span data-stu-id="17c39-631">VM types for the individual components</span></span>
* <span data-ttu-id="17c39-632">DBMS VM 中可提供足夠 IOPS 的 VHD 數目</span><span class="sxs-lookup"><span data-stu-id="17c39-632">Number of VHDs in DBMS VM to provide enough IOPS</span></span>

## <a name="managing-azure-assets"></a><span data-ttu-id="17c39-633">管理 Azure 資產</span><span class="sxs-lookup"><span data-stu-id="17c39-633">Managing Azure Assets</span></span>
### <a name="azure-portal"></a><span data-ttu-id="17c39-634">Azure 入口網站</span><span class="sxs-lookup"><span data-stu-id="17c39-634">Azure Portal</span></span>
<span data-ttu-id="17c39-635">Azure 入口網站是管理 Azure VM 部署的三個介面之一。</span><span class="sxs-lookup"><span data-stu-id="17c39-635">The Azure portal is one of three interfaces to manage Azure VM deployments.</span></span> <span data-ttu-id="17c39-636">基本管理工作 (例如從映像部署 VM) 可透過 Azure 入口網站進行。</span><span class="sxs-lookup"><span data-stu-id="17c39-636">The basic management tasks, like deploying VMs from images, can be done through the Azure portal.</span></span> <span data-ttu-id="17c39-637">此外，儲存體帳戶、虛擬網路和其他 Azure 元件的建立作業也是 Azure 入口網站可妥善處理的工作。</span><span class="sxs-lookup"><span data-stu-id="17c39-637">In addition, the creation of Storage Accounts, Virtual Networks, and other Azure components are also tasks the Azure portal can handle very well.</span></span> <span data-ttu-id="17c39-638">不過，將 VHD 從內部部署環境上傳至 Azure 或在 Azure 中複製 VHD 等功能，則是需要協力廠商工具或是透過 PowerShell 或 CLI 管理的工作。</span><span class="sxs-lookup"><span data-stu-id="17c39-638">However, functionality like uploading VHDs from on-premises to Azure or copying a VHD within Azure are tasks, which require either third-party tools or administration through PowerShell or CLI.</span></span>

![Microsoft Azure 入口網站 - 虛擬機器概觀][planning-guide-figure-800]

[comment]: <> (MSSedusch * <https://azure.microsoft.com/documentation/articles/virtual-networks-create-vnet-arm-pportal/>)
[comment]: <> (MSSedusch * <https://azure.microsoft.com/documentation/articles/virtual-machines-windows-tutorial/>)

<span data-ttu-id="17c39-642">您可以從 Azure 入口網站進行虛擬機器執行個體的管理和設定工作。</span><span class="sxs-lookup"><span data-stu-id="17c39-642">Administration and configuration tasks for the Virtual Machine instance are possible from within the Azure portal.</span></span>

<span data-ttu-id="17c39-643">除了重新啟動及關閉虛擬機器之外，您也可以連接、中斷連接及建立虛擬機器執行個體的資料磁碟，以擷取執行個體供映像準備使用，並設定虛擬機器執行個體的大小。</span><span class="sxs-lookup"><span data-stu-id="17c39-643">Besides restarting and shutting down a Virtual Machine you can also attach, detach, and create data disks for the Virtual Machine instance, to capture the instance for image preparation and configure the size of the Virtual Machine instance.</span></span>

<span data-ttu-id="17c39-644">Azure 入口網站提供用以部署及設定 VM 和許多其他 Azure 服務的基本功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-644">The Azure portal provides basic functionality to deploy and configure VMs and many other Azure services.</span></span> <span data-ttu-id="17c39-645">不過，Azure 入口網站並未涵蓋所有可用的功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-645">However not all available functionality is covered by the Azure portal.</span></span> <span data-ttu-id="17c39-646">在 Azure 入口網站中，不可能執行下列工作：</span><span class="sxs-lookup"><span data-stu-id="17c39-646">In the Azure portal, it’s not possible to perform tasks like:</span></span>

* <span data-ttu-id="17c39-647">將 VHD 上傳至 Azure</span><span class="sxs-lookup"><span data-stu-id="17c39-647">Uploading VHDs to Azure</span></span>
* <span data-ttu-id="17c39-648">複製 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-648">Copying VMs</span></span>

[comment]: <> (MShermannd TODO SAP VM 的自動化服務如何？)
[comment]: <> (MSSedusch 目前可以部署多個 VM OS)
[comment]: <> (MSSedusch 使用 Azure 入口網站也無法進行任何類型的部署自動化。多個 VM 的指令碼部署等工作無法透過 Azure 入口網站進行。)

### <a name="management-via-microsoft-azure-powershell-cmdlets"></a><span data-ttu-id="17c39-652">透過 Microsoft Azure PowerShell Cmdlet 管理</span><span class="sxs-lookup"><span data-stu-id="17c39-652">Management via Microsoft Azure PowerShell cmdlets</span></span>
<span data-ttu-id="17c39-653">Windows PowerShell 是強大且可擴充的架構，客戶已廣泛採用此架構在 Azure 中部署大量系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-653">Windows PowerShell is a powerful and extensible framework that has been widely adopted by customers deploying larger numbers of systems in Azure.</span></span> <span data-ttu-id="17c39-654">在桌上型電腦、膝上型電腦或專用管理工作站上安裝 PowerShell Cmdlet 之後，即可從遠端執行 PowerShell Cmdlet。</span><span class="sxs-lookup"><span data-stu-id="17c39-654">After the installation of PowerShell cmdlets on a desktop, laptop or dedicated management station, the PowerShell cmdlets can be run remotely.</span></span>

<span data-ttu-id="17c39-655">如需了解讓本機桌上型電腦/膝上型電腦能夠使用 Azure PowerShell Cmdlet 的程序，以及如何設定這些項目以與 Azure 訂用帳戶搭配使用，請參閱[這篇文章][powershell-install-configure]。</span><span class="sxs-lookup"><span data-stu-id="17c39-655">The process to enable a local desktop/laptop for the usage of Azure PowerShell cmdlets and how to configure those for the usage with the Azure subscription(s) is described in [this article][powershell-install-configure].</span></span>

<span data-ttu-id="17c39-656">如需有關如何安裝、更新及設定 Azure PowerShell Cmdlet 的更詳細步驟，另請參閱[部署指南的這一章][deployment-guide-4.1]。</span><span class="sxs-lookup"><span data-stu-id="17c39-656">More detailed steps on how to install, update, and configure the Azure PowerShell cmdlets can also be found in [this chapter of the Deployment Guide][deployment-guide-4.1].</span></span>

<span data-ttu-id="17c39-657">根據客戶到目前為止的體驗，PowerShell (PS) 確實是可部署 VM 及建立 VM 部署之自訂步驟的更強大工具。</span><span class="sxs-lookup"><span data-stu-id="17c39-657">Customer experience so far has been that PowerShell (PS) is certainly the more powerful tool to deploy VMs and to create custom steps in the deployment of VMs.</span></span> <span data-ttu-id="17c39-658">在 Azure 中執行 SAP 執行個體的所有客戶使用 PS Cmdlet 來支援他們在 Azure 入口網站中執行的管理工作，或甚至單獨使用 PS Cmdlet 來管理他們在 Azure 中的部署。</span><span class="sxs-lookup"><span data-stu-id="17c39-658">All of the customers running SAP instances in Azure are using PS cmdlets to supplement management tasks they do in the Azure portal or are even using PS cmdlets exclusively to manage their deployments in Azure.</span></span> <span data-ttu-id="17c39-659">由於 Azure 特定的 Cmdlet 與超過 2000 個 Windows 相關 Cmdlet 共用相同的命名慣例，因此 Windows 系統管理員可輕鬆地利用這些 Cmdlet。</span><span class="sxs-lookup"><span data-stu-id="17c39-659">Since the Azure-specific cmdlets share the same naming convention as the more than 2000 Windows-related cmdlets, it is an easy task for Windows administrators to leverage those cmdlets.</span></span>

<span data-ttu-id="17c39-660">請參閱以下的範例︰<http://blogs.technet.com/b/keithmayer/archive/2015/07/07/18-steps-for-end-to-end-iaas-provisioning-in-the-cloud-with-azure-resource-manager-arm-powershell-and-desired-state-configuration-dsc.aspx></span><span class="sxs-lookup"><span data-stu-id="17c39-660">See example here: <http://blogs.technet.com/b/keithmayer/archive/2015/07/07/18-steps-for-end-to-end-iaas-provisioning-in-the-cloud-with-azure-resource-manager-arm-powershell-and-desired-state-configuration-dsc.aspx></span></span>

[comment]: <> (MShermannd TODO 描述測試時的新 CLI 命令)
<span data-ttu-id="17c39-662">您只能透過 PowerShell 或 CLI 來部署 Azure Monitoring Extension for SAP (請參閱本文件的[適用於 SAP 的 Azure 監視解決方案][planning-guide-9.1]一章)。</span><span class="sxs-lookup"><span data-stu-id="17c39-662">Deployment of the Azure Monitoring Extension for SAP (see chapter [Azure Monitoring Solution for SAP][planning-guide-9.1] in this document) is only possible via PowerShell or CLI.</span></span> <span data-ttu-id="17c39-663">因此，在 Azure 中部署或管理 SAP NetWeaver 系統時，請務必安裝及設定 PowerShell 或 CLI。</span><span class="sxs-lookup"><span data-stu-id="17c39-663">Therefore it is mandatory to set up and configure PowerShell or CLI when deploying or administering an SAP NetWeaver system in Azure.</span></span>  

<span data-ttu-id="17c39-664">隨著 Azure 提供更多功能，也會新增 PS Cmdlet，而需要更新 Cmdlet。</span><span class="sxs-lookup"><span data-stu-id="17c39-664">As Azure provides more functionality, new PS cmdlets are going to be added that requires an update of the cmdlets.</span></span> <span data-ttu-id="17c39-665">因此，您每個月至少要檢查一次「Azure 下載」網站 <https://azure.microsoft.com/downloads/> 是否有新的 Cmdlet 版本。</span><span class="sxs-lookup"><span data-stu-id="17c39-665">Therefore it makes sense to check the Azure Download site at least once the month <https://azure.microsoft.com/downloads/> for a new version of the cmdlets.</span></span> <span data-ttu-id="17c39-666">新版本會覆蓋舊版本進行安裝。</span><span class="sxs-lookup"><span data-stu-id="17c39-666">The new version is installed on top of the older version.</span></span>

<span data-ttu-id="17c39-667">如需 Azure 相關 PowerShell 命令的一般清單，請按一下這裡︰<https://docs.microsoft.com/powershell/azure/overview>。</span><span class="sxs-lookup"><span data-stu-id="17c39-667">For a general list of Azure-related PowerShell commands check here: <https://docs.microsoft.com/powershell/azure/overview>.</span></span>

### <a name="management-via-microsoft-azure-cli-commands"></a><span data-ttu-id="17c39-668">透過 Microsoft Azure CLI 命令管理</span><span class="sxs-lookup"><span data-stu-id="17c39-668">Management via Microsoft Azure CLI commands</span></span>
<span data-ttu-id="17c39-669">如果客戶使用 Linux 並想要管理 Azure 資源，則可能不適合使用 Powershell。</span><span class="sxs-lookup"><span data-stu-id="17c39-669">For customers who use Linux and want to manage Azure resources Powershell might not be an option.</span></span> <span data-ttu-id="17c39-670">Microsoft 提供 Azure CLI 作為替代方案。</span><span class="sxs-lookup"><span data-stu-id="17c39-670">Microsoft offers Azure CLI as an alternative.</span></span>
<span data-ttu-id="17c39-671">Azure CLI 提供您一組開放原始碼的跨平台命令集合，供您運用在 Azure 平台上。</span><span class="sxs-lookup"><span data-stu-id="17c39-671">The Azure CLI provides a set of open source, cross-platform commands for working with the Azure Platform.</span></span> <span data-ttu-id="17c39-672">Azure CLI 提供許多與 Azure 入口網站相同的功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-672">The Azure CLI provides much of the same functionality found in the Azure portal.</span></span>

<span data-ttu-id="17c39-673">如需安裝、組態及如何使用 CLI 命令完成 Azure 工作的資訊，請參閱</span><span class="sxs-lookup"><span data-stu-id="17c39-673">For information about installation, configuration and how to use CLI commands to accomplish Azure tasks see</span></span>

* <span data-ttu-id="17c39-674">[安裝 Azure CLI][xplat-cli]</span><span class="sxs-lookup"><span data-stu-id="17c39-674">[Install the Azure CLI][xplat-cli]</span></span>
* <span data-ttu-id="17c39-675">[使用 Azure Resource Manager 範本和 Azure CLI 部署和管理虛擬機器][../../linux/create-ssh-secured-vm-from-template.md]</span><span class="sxs-lookup"><span data-stu-id="17c39-675">[Deploy and manage virtual machines by using Azure Resource Manager templates and the Azure CLI][../../linux/create-ssh-secured-vm-from-template.md]</span></span>
* <span data-ttu-id="17c39-676">[搭配使用 Mac、Linux 和 Windows 適用的 Azure CLI 與 Azure Resource Manager][xplat-cli-azure-resource-manager]</span><span class="sxs-lookup"><span data-stu-id="17c39-676">[Use the Azure CLI for Mac, Linux, and Windows with Azure Resource Manager][xplat-cli-azure-resource-manager]</span></span>

<span data-ttu-id="17c39-677">如需了解如何使用 Azure CLI 來部署 Azure Monitoring Extension for SAP，另請參閱[部署指南][planning-guide]中的[適用於 Linux VM 的 Azure CLI][deployment-guide-4.5.2] 一章。</span><span class="sxs-lookup"><span data-stu-id="17c39-677">Also read chapter [Azure CLI for Linux VMs][deployment-guide-4.5.2] in the [Deployment Guide][planning-guide] on how to use Azure CLI to deploy the Azure Monitoring Extension for SAP.</span></span>

## <a name="different-ways-to-deploy-vms-for-sap-in-azure"></a><span data-ttu-id="17c39-678">在 Azure 中為 SAP 部署 VM 的不同方式</span><span class="sxs-lookup"><span data-stu-id="17c39-678">Different ways to deploy VMs for SAP in Azure</span></span>
<span data-ttu-id="17c39-679">在本章中，您會學習在 Azure 中部署 VM 的不同方式。</span><span class="sxs-lookup"><span data-stu-id="17c39-679">In this chapter, you learn the different ways to deploy a VM in Azure.</span></span> <span data-ttu-id="17c39-680">本章涵蓋其他準備程序，以及在 Azure 中處理 VHD 和 VM 的方式。</span><span class="sxs-lookup"><span data-stu-id="17c39-680">Additional preparation procedures, as well as handling of VHDs and VMs in Azure are covered in this chapter.</span></span>

### <a name="deployment-of-vms-for-sap"></a><span data-ttu-id="17c39-681">為 SAP 部署 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-681">Deployment of VMs for SAP</span></span>
<span data-ttu-id="17c39-682">Microsoft Azure 提供多種方法來部署 VM 和相關聯的磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-682">Microsoft Azure offers multiple ways to deploy VMs and associated disks.</span></span> <span data-ttu-id="17c39-683">因此，請務必了解這些差異，因為 VM 的準備工作可能會因部署方法而異。</span><span class="sxs-lookup"><span data-stu-id="17c39-683">Thus it is very important to understand the differences since preparations of the VMs might differ depending on the method of deployment.</span></span> <span data-ttu-id="17c39-684">大致上，我們將探討下列案例︰</span><span class="sxs-lookup"><span data-stu-id="17c39-684">In general, we take a look at the following scenarios:</span></span>

#### <span data-ttu-id="17c39-685"><a name="4d175f1b-7353-4137-9d2f-817683c26e53"></a>使用非一般化磁碟將 VM 從內部部署環境移至 Azure</span><span class="sxs-lookup"><span data-stu-id="17c39-685"><a name="4d175f1b-7353-4137-9d2f-817683c26e53"></a>Moving a VM from on-premises to Azure with a non-generalized disk</span></span>
<span data-ttu-id="17c39-686">您想要將特定 SAP 系統從內部部署移至 Azure。</span><span class="sxs-lookup"><span data-stu-id="17c39-686">You plan to move a specific SAP system from on-premises to Azure.</span></span> <span data-ttu-id="17c39-687">這可藉由將包含 OS、SAP 二進位檔和 DBMS 二進位檔的 VHD，以及包含 DBMS 資料和記錄檔的 VHD 上傳至 Azure 來完成。</span><span class="sxs-lookup"><span data-stu-id="17c39-687">This can be done by uploading the VHD, which contains the OS, the SAP Binaries, and DBMS binaries plus the VHDs with the data and log files of the DBMS to Azure.</span></span> <span data-ttu-id="17c39-688">相對於[下面的案例 2][planning-guide-5.1.2]，您可以在 Azure VM 中，保留內部部署環境中所設定的主機名稱、SAP SID 及 SAP 使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-688">In contrast to [scenario #2 below][planning-guide-5.1.2], you keep the hostname, SAP SID, and SAP user accounts in the Azure VM as they were configured in the on-premises environment.</span></span> <span data-ttu-id="17c39-689">因此，不需要將映像一般化。</span><span class="sxs-lookup"><span data-stu-id="17c39-689">Therefore, generalizing the image is not necessary.</span></span> <span data-ttu-id="17c39-690">如需了解內部部署準備步驟，以及如何將非一般化 VM 或 VHD 上傳至 Azure，請參閱本文件的[準備使用非一般化磁碟將 VM 從內部部署環境移至 Azure][planning-guide-5.2.1]一章。</span><span class="sxs-lookup"><span data-stu-id="17c39-690">See chapters [Preparation for moving a VM from on-premises to Azure with a non-generalized disk][planning-guide-5.2.1] of this document for on-premises preparation steps and upload of non-generalized VMs or VHDs to Azure.</span></span> <span data-ttu-id="17c39-691">如需了解在 Azure 中部署這類映像的詳細步驟，請參閱[部署指南][deployment-guide]中的[案例 3：使用非一般化 Azure VHD 搭配 SAP 從內部部署環境移動 VM][deployment-guide-3.4] 一章。</span><span class="sxs-lookup"><span data-stu-id="17c39-691">Read chapter [Scenario 3: Moving a VM from on-premises using a non-generalized Azure VHD with SAP][deployment-guide-3.4] in the [Deployment Guide][deployment-guide] for detailed steps of deploying such an image in Azure.</span></span>

#### <span data-ttu-id="17c39-692"><a name="e18f7839-c0e2-4385-b1e6-4538453a285c"></a>使用客戶特定的映像部署 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-692"><a name="e18f7839-c0e2-4385-b1e6-4538453a285c"></a>Deploying a VM with a customer-specific image</span></span>
<span data-ttu-id="17c39-693">基於您的 OS 或 DBMS 版本的特定修補程式需求，Azure Marketplace 所提供的映像可能不符合您的需求。</span><span class="sxs-lookup"><span data-stu-id="17c39-693">Due to specific patch requirements of your OS or DBMS version, the provided images in the Azure Marketplace might not fit your needs.</span></span> <span data-ttu-id="17c39-694">因此，您可能必須使用自己「私人」的 OS/DBMS VM 映像來建立 VM，之後可多次部署此映像。</span><span class="sxs-lookup"><span data-stu-id="17c39-694">Therefore, you might need to create a VM using your own ‘private’ OS/DBMS VM image, which can be deployed several times afterwards.</span></span> <span data-ttu-id="17c39-695">為了準備這類「私人」映像以重複使用，必須考慮下列事項︰</span><span class="sxs-lookup"><span data-stu-id="17c39-695">To prepare such a ‘private’ image for duplication, the following items have to be considered:</span></span>

- - -
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-697">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-697">Windows</span></span>
>
> <span data-ttu-id="17c39-698">如需詳細資訊，請參閱：<https://docs.microsoft.com/azure/virtual-machines/windows/upload-generalized-managed> Windows 設定 (例如 Windows SID 和主機名稱) 必須透過 sysprep 命令在內部部署 VM 抽象化/一般化。</span><span class="sxs-lookup"><span data-stu-id="17c39-698">See more details here: <https://docs.microsoft.com/azure/virtual-machines/windows/upload-generalized-managed> The Windows settings (like Windows SID and hostname) must be abstracted/generalized on the on-premises VM via the sysprep command.</span></span>
>
>
> ![Linux][Logo_Linux] <span data-ttu-id="17c39-700">Linux</span><span class="sxs-lookup"><span data-stu-id="17c39-700">Linux</span></span>
>
> <span data-ttu-id="17c39-701">請依照這些適用於 [SUSE][virtual-machines-linux-create-upload-vhd-suse]、[Red Hat][virtual-machines-linux-redhat-create-upload-vhd] 或 [Oracle Linux][virtual-machines-linux-create-upload-vhd-oracle] 的文章中所述的步驟，來準備要上傳至 Azure 的 VHD。</span><span class="sxs-lookup"><span data-stu-id="17c39-701">Follow the steps described in these articles for [SUSE][virtual-machines-linux-create-upload-vhd-suse], [Red Hat][virtual-machines-linux-redhat-create-upload-vhd], or [Oracle Linux][virtual-machines-linux-create-upload-vhd-oracle], to prepare a VHD to be uploaded to Azure.</span></span>
>
>

- - -
<span data-ttu-id="17c39-702">如果您已在內部部署 VM (特別是針對 2 層系統) 中安裝 SAP 內容，您可以在部署 Azure VM 之後，透過 SAP Software Provisioning Manager 支援的執行個體重新命名程序來調整 SAP 系統設定 (SAP 附註 [1619720])。</span><span class="sxs-lookup"><span data-stu-id="17c39-702">If you have already installed SAP content in your on-premises VM (especially for 2-Tier systems), you can adapt the SAP system settings after the deployment of the Azure VM through the instance rename procedure supported by the SAP Software Provisioning Manager (SAP Note [1619720]).</span></span> <span data-ttu-id="17c39-703">如需了解內部部署準備步驟，以及如何將一般化 VM 上傳至 Azure，請參閱本文件的[準備使用客戶特定的映像為 SAP 部署 VM][planning-guide-5.2.2] 和[將 VHD 從內部部署環境上傳至 Azure][planning-guide-5.3.2] 章節。</span><span class="sxs-lookup"><span data-stu-id="17c39-703">See chapters [Preparation for deploying a VM with a customer-specific image for SAP][planning-guide-5.2.2] and [Uploading a VHD from on-premises to Azure][planning-guide-5.3.2] of this document for on-premises preparation steps and upload of a generalized VM to Azure.</span></span> <span data-ttu-id="17c39-704">如需了解在 Azure 中部署這類映像的詳細步驟，請參閱[部署指南][deployment-guide]中的[案例 2：使用自訂映像為 SAP 部署 VM][deployment-guide-3.3] 一章。</span><span class="sxs-lookup"><span data-stu-id="17c39-704">Read chapter [Scenario 2: Deploying a VM with a custom image for SAP][deployment-guide-3.3] in the [Deployment Guide][deployment-guide] for detailed steps of deploying such an image in Azure.</span></span>

#### <a name="deploying-a-vm-out-of-the-azure-marketplace"></a><span data-ttu-id="17c39-705">從 Azure Marketplace 部署 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-705">Deploying a VM out of the Azure Marketplace</span></span>
<span data-ttu-id="17c39-706">您想要從 Azure Marketplace 使用 Microsoft 或協力廠商提供的 VM 映像來部署 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-706">You would like to use a Microsoft or third-party provided VM image from the Azure Marketplace to deploy your VM.</span></span> <span data-ttu-id="17c39-707">在 Azure 中部署您的 VM 之後，您可以遵循與內部部署環境相同的方針和工具，在 VM 中安裝 SAP 軟體及 (或) DBMS。</span><span class="sxs-lookup"><span data-stu-id="17c39-707">After you deployed your VM in Azure, you follow the same guidelines and tools to install the SAP software and/or DBMS inside your VM as you would do in an on-premises environment.</span></span> <span data-ttu-id="17c39-708">如需更詳細的部署說明，請參閱[部署指南][deployment-guide]中的[案例 1：從 Azure Marketplace 為 SAP 部署 VM][deployment-guide-3.2]。</span><span class="sxs-lookup"><span data-stu-id="17c39-708">For more detailed deployment description, please see chapter [Scenario 1: Deploying a VM out of the Azure Marketplace for SAP][deployment-guide-3.2] in the [Deployment Guide][deployment-guide].</span></span>

### <span data-ttu-id="17c39-709"><a name="6ffb9f41-a292-40bf-9e70-8204448559e7"></a>使用適用於 Azure 的 SAP 準備 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-709"><a name="6ffb9f41-a292-40bf-9e70-8204448559e7"></a>Preparing VMs with SAP for Azure</span></span>
<span data-ttu-id="17c39-710">將 VM 上傳至 Azure 之前，您必須確定 VM 和 VHD 符合特定需求。</span><span class="sxs-lookup"><span data-stu-id="17c39-710">Before uploading VMs into Azure you need to make sure the VMs and VHDs fulfill certain requirements.</span></span> <span data-ttu-id="17c39-711">這些需求會因所使用的部署方法而有些微的不同。</span><span class="sxs-lookup"><span data-stu-id="17c39-711">There are small differences depending on the deployment method that is used.</span></span>

#### <span data-ttu-id="17c39-712"><a name="1b287330-944b-495d-9ea7-94b83aff73ef"></a>準備使用非一般化磁碟將 VM 從內部部署環境移至 Azure</span><span class="sxs-lookup"><span data-stu-id="17c39-712"><a name="1b287330-944b-495d-9ea7-94b83aff73ef"></a>Preparation for moving a VM from on-premises to Azure with a non-generalized disk</span></span>
<span data-ttu-id="17c39-713">常見的部署方法是將執行 SAP 系統的現有 VM 從內部部署移至 Azure。</span><span class="sxs-lookup"><span data-stu-id="17c39-713">A common deployment method is to move an existing VM which runs an SAP system from on-premises to Azure.</span></span> <span data-ttu-id="17c39-714">該 VM 和 VM 中的 SAP 系統只能使用相同的主機名稱並可能使用相同的 SAP SID 在 Azure 中執行。</span><span class="sxs-lookup"><span data-stu-id="17c39-714">That VM and the SAP system in the VM just should run in Azure using the same hostname and very likely the same SAP SID.</span></span> <span data-ttu-id="17c39-715">在此情況下，VM 的客體 OS 不應該針對多個部署進行一般化。</span><span class="sxs-lookup"><span data-stu-id="17c39-715">In this case the guest OS of VM should not be generalized for multiple deployments.</span></span> <span data-ttu-id="17c39-716">如果內部部署網路已延伸到 Azure (請參閱本文件的[跨單位 - 將單一或多個 SAP VM 部署到 Azure，必須完全整合到內部部署網路][planning-guide-2.2]一章)，則在 VM 中甚至可以使用與之前在內部部署所使用相同的網域帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-716">If the on-premises network got extended into Azure (see chapter [cross-premises - Deployment of single or multiple SAP VMs into Azure with the requirement of being fully integrated into the on-premises network][planning-guide-2.2] in this document), then even the same domain accounts can be used within the VM as those were used before on-premises.</span></span>

<span data-ttu-id="17c39-717">準備您自己的 Azure VM 磁碟時的需求如下︰</span><span class="sxs-lookup"><span data-stu-id="17c39-717">Requirements when preparing your own Azure VM Disk are:</span></span>

* <span data-ttu-id="17c39-718">含有作業系統的 VHD 原本可能只有 127GB 的大小上限。</span><span class="sxs-lookup"><span data-stu-id="17c39-718">Originally the VHD containing the operating system could have a maximum size of 127GB only.</span></span> <span data-ttu-id="17c39-719">這項限制已在 2015 年 3 月底排除。</span><span class="sxs-lookup"><span data-stu-id="17c39-719">This limitation got eliminated at the end of March 2015.</span></span> <span data-ttu-id="17c39-720">現在，含有作業系統的 VHD 可以有高達 1TB 的大小，任何其他 Azure 儲存體裝載的 VHD 也是一樣。</span><span class="sxs-lookup"><span data-stu-id="17c39-720">Now the VHD containing the operating system can be up to 1TB in size as any other Azure Storage hosted VHD as well.</span></span>
* <span data-ttu-id="17c39-721">它必須是固定 VHD 格式。</span><span class="sxs-lookup"><span data-stu-id="17c39-721">It needs to be in the fixed VHD format.</span></span> <span data-ttu-id="17c39-722">Azure 尚未支援動態 VHD 或 VHDx 格式的 VHD。</span><span class="sxs-lookup"><span data-stu-id="17c39-722">Dynamic VHDs or VHDs in VHDx format are not yet supported on Azure.</span></span> <span data-ttu-id="17c39-723">當您使用 PowerShell Commandlet 或 CLI 上傳 VHD 時，動態 VHD 會轉換成靜態 VHD</span><span class="sxs-lookup"><span data-stu-id="17c39-723">Dynamic VHDs will be converted to static VHDs when you upload the VHD with PowerShell commandlets or CLI</span></span>
* <span data-ttu-id="17c39-724">掛接到 VM 並應該在 Azure 中再次掛接到 VM 的 VHD 也必須是固定 VHD 格式。</span><span class="sxs-lookup"><span data-stu-id="17c39-724">VHDs which are mounted to the VM and should be mounted again in Azure to the VM need to be in a fixed VHD format as well.</span></span> <span data-ttu-id="17c39-725">如需資料磁碟的大小限制，請參閱[這篇文章 (Linux)](https://docs.microsoft.com/azure/storage/storage-about-disks-and-vhds-linux) 和[這篇文章 (Windows)](https://docs.microsoft.com/azure/storage/storage-about-disks-and-vhds-windows)。</span><span class="sxs-lookup"><span data-stu-id="17c39-725">Please read [this article (Linux)](https://docs.microsoft.com/azure/storage/storage-about-disks-and-vhds-linux) and [this article (Windows)](https://docs.microsoft.com/azure/storage/storage-about-disks-and-vhds-windows) for size limits of data disks.</span></span> <span data-ttu-id="17c39-726">當您使用 PowerShell Commandlet 或 CLI 上傳 VHD 時，動態 VHD 會轉換成靜態 VHD</span><span class="sxs-lookup"><span data-stu-id="17c39-726">Dynamic VHDs will be converted to static VHDs when you upload the VHD with PowerShell commandlets or CLI</span></span>
* <span data-ttu-id="17c39-727">使用系統管理員權限新增另一個本機帳戶，此帳戶可供 Microsoft 支援服務使用，或指派為服務和應用程式執行所在的內容，直到部署 VM 並可使用更適當的使用者為止。</span><span class="sxs-lookup"><span data-stu-id="17c39-727">Add another local account with administrator privileges which can be used by Microsoft support or which can be assigned as context for services and applications to run in until the VM is deployed and more appropriate users can be used.</span></span>
* <span data-ttu-id="17c39-728">若使用「僅限雲端」部署案例 (請參閱本文件的[僅限雲端 - 將虛擬機器部署到 Azure，無須倚賴內部部署客戶網路][planning-guide-2.1]一章) 搭配此部署方法，則一旦在 Azure 中部署「Azure 磁碟」，網域帳戶可能就無法運作。</span><span class="sxs-lookup"><span data-stu-id="17c39-728">For the case of using a Cloud-Only deployment scenario (see chapter [Cloud-Only - Virtual Machine deployments into Azure without dependencies on the on-premises customer network][planning-guide-2.1] of this document) in combination with this deployment method, domain accounts might not work once the Azure Disk is deployed in Azure.</span></span> <span data-ttu-id="17c39-729">特別是使用帳戶來執行 DBMS 或 SAP 應用程式等服務時。</span><span class="sxs-lookup"><span data-stu-id="17c39-729">This is especially true for accounts which are used to run services like the DBMS or SAP applications.</span></span> <span data-ttu-id="17c39-730">因此，您必須以 VM 本機帳戶取代這類網域帳戶，並刪除 VM 中的內部部署網域帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-730">Therefore you need to replace such domain accounts with VM local accounts and delete the on-premises domain accounts in the VM.</span></span> <span data-ttu-id="17c39-731">在以「跨單位」方式部署 VM 的情況下 (如本文件的[跨單位 - 將單一或多個 SAP VM 部署到 Azure，必須完全整合到內部部署網路][planning-guide-2.2]一章中所述)，在 VM 映像中保留內部部署網域使用者並不構成問題。</span><span class="sxs-lookup"><span data-stu-id="17c39-731">Keeping on-premises domain users in the VM image is not an issue when the VM is deployed in the cross-premises scenario as described in chapter [Cross-Premises - Deployment of single or multiple SAP VMs into Azure with the requirement of being fully integrated into the on-premises network][planning-guide-2.2] in this document.</span></span>
* <span data-ttu-id="17c39-732">如果在內部部署執行系統時使用網域帳戶作為 DBMS 登入或使用者，而且支援在僅限雲端案例中部署這些 VM，則必須刪除網域使用者。</span><span class="sxs-lookup"><span data-stu-id="17c39-732">If domain accounts were used as DBMS logins or users when running the system on-premises and those VMs are supposed to be deployed in Cloud-Only scenarios, the domain users need to be deleted.</span></span> <span data-ttu-id="17c39-733">您必須確定將本機系統管理員及另一位 VM 本機使用者以登入/使用者身分加入 DBMS 成為系統管理員。</span><span class="sxs-lookup"><span data-stu-id="17c39-733">You need to make sure that the local administrator plus another VM local user is added as a login/user into the DBMS as administrators.</span></span>
* <span data-ttu-id="17c39-734">新增其他本機帳戶，因為特定部署案例可能需要這些帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-734">Add other local accounts as those might be needed for the specific deployment scenario.</span></span>

- - -
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-736">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-736">Windows</span></span>
>
> <span data-ttu-id="17c39-737">在此案例中，需要一般化 (sysprep) VM 才能上傳並在 Azure 上部署 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-737">In this scenario no generalization (sysprep) of the VM is required to upload and deploy the VM on Azure.</span></span>
> <span data-ttu-id="17c39-738">請確定並未使用磁碟機 D:\，</span><span class="sxs-lookup"><span data-stu-id="17c39-738">Make sure that drive D:\ is not used.</span></span>
> <span data-ttu-id="17c39-739">並如本文件中的[為連接的磁碟設定自動掛接][planning-guide-5.5.3]一章所述，為連接的磁碟設定磁碟自動掛接。</span><span class="sxs-lookup"><span data-stu-id="17c39-739">Set disk automount for attached disks as described in chapter [Setting automount for attached disks][planning-guide-5.5.3] in this document.</span></span>
>
> ![Linux][Logo_Linux] <span data-ttu-id="17c39-741">Linux</span><span class="sxs-lookup"><span data-stu-id="17c39-741">Linux</span></span>
>
> <span data-ttu-id="17c39-742">在此案例中，需要一般化 (waagent -deprovision) VM 才能上傳並在 Azure 上部署 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-742">In this scenario no generalization (waagent -deprovision) of the VM is required to upload and deploy the VM on Azure.</span></span>
> <span data-ttu-id="17c39-743">確定不會使用 /mnt/resource，並透過 uuid 掛接所有磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-743">Make sure that /mnt/resource is not used and that ALL disks are mounted via uuid.</span></span> <span data-ttu-id="17c39-744">針對 OS 磁碟，請確定確定開機載入器項目也會反映 uuid 型掛接。</span><span class="sxs-lookup"><span data-stu-id="17c39-744">For the OS disk, make sure that the bootloader entry also reflects the uuid-based mount.</span></span>
>
>

- - -
#### <span data-ttu-id="17c39-745"><a name="57f32b1c-0cba-4e57-ab6e-c39fe22b6ec3"></a>準備使用客戶特定的映像為 SAP 部署 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-745"><a name="57f32b1c-0cba-4e57-ab6e-c39fe22b6ec3"></a>Preparation for deploying a VM with a customer-specific image for SAP</span></span>
<span data-ttu-id="17c39-746">含有一般化 OS 的 VHD 檔案會儲存在 Azure 儲存體帳戶的容器中或作為受控磁碟映像。</span><span class="sxs-lookup"><span data-stu-id="17c39-746">VHD files that contain a generalized OS are stored in containers on Azure Storage Accounts or as Managed Disk images.</span></span> <span data-ttu-id="17c39-747">您可以從這類映像部署新的 VM，方法是在部署範本檔案中將這類 VHD 或受控磁碟應項作為來源來參考，如[部署指南][deployment-guide]的[案例 2：使用自訂映像為 SAP 部署 VM][deployment-guide-3.3] 一章所述。</span><span class="sxs-lookup"><span data-stu-id="17c39-747">You can deploy a new VM from such an image by referencing the VHD or Managed Disk image as a source in your deployment template files as described in chapter [Scenario 2: Deploying a VM with a custom image for SAP][deployment-guide-3.3] of the [Deployment Guide][deployment-guide].</span></span>

<span data-ttu-id="17c39-748">準備您自己的 Azure VM 映像時的需求包括︰</span><span class="sxs-lookup"><span data-stu-id="17c39-748">Requirements when preparing your own Azure VM Image are:</span></span>

* <span data-ttu-id="17c39-749">含有作業系統的 VHD 原本可能只有 127GB 的大小上限。</span><span class="sxs-lookup"><span data-stu-id="17c39-749">Originally the VHD containing the operating system could have a maximum size of 127GB only.</span></span> <span data-ttu-id="17c39-750">這項限制已在 2015 年 3 月底排除。</span><span class="sxs-lookup"><span data-stu-id="17c39-750">This limitation got eliminated at the end of March 2015.</span></span> <span data-ttu-id="17c39-751">現在，含有作業系統的 VHD 可以有高達 1TB 的大小，任何其他 Azure 儲存體裝載的 VHD 也是一樣。</span><span class="sxs-lookup"><span data-stu-id="17c39-751">Now the VHD containing the operating system can be up to 1TB in size as any other Azure Storage hosted VHD as well.</span></span>
* <span data-ttu-id="17c39-752">它必須是固定 VHD 格式。</span><span class="sxs-lookup"><span data-stu-id="17c39-752">It needs to be in the fixed VHD format.</span></span> <span data-ttu-id="17c39-753">Azure 尚未支援動態 VHD 或 VHDx 格式的 VHD。</span><span class="sxs-lookup"><span data-stu-id="17c39-753">Dynamic VHDs or VHDs in VHDx format are not yet supported on Azure.</span></span> <span data-ttu-id="17c39-754">當您使用 PowerShell Commandlet 或 CLI 上傳 VHD 時，動態 VHD 會轉換成靜態 VHD</span><span class="sxs-lookup"><span data-stu-id="17c39-754">Dynamic VHDs will be converted to static VHDs when you upload the VHD with PowerShell commandlets or CLI</span></span>
* <span data-ttu-id="17c39-755">掛接到 VM 並應該在 Azure 中再次掛接到 VM 的 VHD 也必須是固定 VHD 格式。</span><span class="sxs-lookup"><span data-stu-id="17c39-755">VHDs which are mounted to the VM and should be mounted again in Azure to the VM need to be in a fixed VHD format as well.</span></span> <span data-ttu-id="17c39-756">如需資料磁碟的大小限制，請參閱[這篇文章 (Linux)](https://docs.microsoft.com/azure/storage/storage-about-disks-and-vhds-linux) 和[這篇文章 (Windows)](https://docs.microsoft.com/azure/storage/storage-about-disks-and-vhds-windows)。</span><span class="sxs-lookup"><span data-stu-id="17c39-756">Please read [this article (Linux)](https://docs.microsoft.com/azure/storage/storage-about-disks-and-vhds-linux) and [this article (Windows)](https://docs.microsoft.com/azure/storage/storage-about-disks-and-vhds-windows) for size limits of data disks.</span></span> <span data-ttu-id="17c39-757">當您使用 PowerShell Commandlet 或 CLI 上傳 VHD 時，動態 VHD 會轉換成靜態 VHD</span><span class="sxs-lookup"><span data-stu-id="17c39-757">Dynamic VHDs will be converted to static VHDs when you upload the VHD with PowerShell commandlets or CLI</span></span>
* <span data-ttu-id="17c39-758">由於所有在 VM 中註冊為使用者的網域使用者在「僅限雲端」案例中都將不存在 (請參閱本文件的[僅限雲端 - 將虛擬機器部署到 Azure，無須倚賴內部部署客戶網路][planning-guide-2.1]一章)，因此一旦在 Azure 中部署映像，使用這類網域帳戶的服務可能就無法運作。</span><span class="sxs-lookup"><span data-stu-id="17c39-758">Since all the Domain users registered as users in the VM will not exist in a Cloud-Only scenario (see chapter [Cloud-Only - Virtual Machine deployments into Azure without dependencies on the on-premises customer network][planning-guide-2.1] of this document), services using such domain accounts might not work once the Image is deployed in Azure.</span></span> <span data-ttu-id="17c39-759">特別是使用帳戶來執行 DBMS 或 SAP 應用程式等的服務時。</span><span class="sxs-lookup"><span data-stu-id="17c39-759">This is especially true for accounts which are used to run services like DBMS or SAP applications.</span></span> <span data-ttu-id="17c39-760">因此，您必須以 VM 本機帳戶取代這類網域帳戶，並刪除 VM 中的內部部署網域帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-760">Therefore you need to replace such domain accounts with VM local accounts and delete the on-premises domain accounts in the VM.</span></span> <span data-ttu-id="17c39-761">在以「跨單位」方式部署 VM 的情況下 (如本文件的[跨單位 - 將單一或多個 SAP VM 部署到 Azure，必須完全整合到內部部署網路][planning-guide-2.2]一章中所述)，在 VM 映像中保留內部部署網域使用者並不構成問題。</span><span class="sxs-lookup"><span data-stu-id="17c39-761">Keeping on-premises domain users in the VM image might not be an issue when the VM is deployed in the cross-premises scenario as described in chapter [Cross-Premises - Deployment of single or multiple SAP VMs into Azure with the requirement of being fully integrated into the on-premises network][planning-guide-2.2] in this document.</span></span>
* <span data-ttu-id="17c39-762">使用系統管理員權限新增本機帳戶，此帳戶可供 Microsoft 支援服務用來調查問題，並可指派為執行服務和應用程式的內容，直到部署 VM 並可使用更適當的使用者為止。</span><span class="sxs-lookup"><span data-stu-id="17c39-762">Add another local account with administrator privileges which can be used by Microsoft support in problem investigations or which can be assigned as context for services and applications to run in until the VM is deployed and more appropriate users can be used.</span></span>
* <span data-ttu-id="17c39-763">在僅限雲端部署中，如果在內部部署執行系統時使用網域帳戶作為 DBMS 登入或使用者，則應該刪除網域使用者。</span><span class="sxs-lookup"><span data-stu-id="17c39-763">In Cloud-Only deployments and where domain accounts were used as DBMS logins or users when running the system on-premises, the domain users should be deleted.</span></span> <span data-ttu-id="17c39-764">您必須確定將本機系統管理員和另一位 VM 本機使用者以 DBMS 的登入/使用者身分加入成為系統管理員。</span><span class="sxs-lookup"><span data-stu-id="17c39-764">You need to make sure that the local administrator plus another VM local user is added as a login/user of the DBMS as administrators.</span></span>
* <span data-ttu-id="17c39-765">新增其他本機帳戶，因為特定部署案例可能需要這些帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-765">Add other local accounts as those might be needed for the specific deployment scenario.</span></span>
* <span data-ttu-id="17c39-766">如果映像包含 SAP NetWeaver 的安裝，而且可能在部署 Azure 時重新命名主機名稱的原始名稱，則建議將最新版 SAP Software Provisioning Manager DVD 複製到範本。</span><span class="sxs-lookup"><span data-stu-id="17c39-766">If the image contains an installation of SAP NetWeaver and renaming of the host name from the original name at the point of the Azure deployment is likely, it is recommended to copy the latest versions of the SAP Software Provisioning Manager DVD into the template.</span></span> <span data-ttu-id="17c39-767">這可讓您輕鬆地使用 SAP 提供的重新命名功能，來調整已變更的主機名稱，及 (或) 在啟動新複本之後，變更已部署 VM 映像中 SAP 系統的 SID。</span><span class="sxs-lookup"><span data-stu-id="17c39-767">This will enable you to easily use the SAP provided rename functionality to adapt the changed hostname and/or change the SID of the SAP system within the deployed VM image as soon as a new copy is started.</span></span>

- - -
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-769">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-769">Windows</span></span>
>
> <span data-ttu-id="17c39-770">請確定並未使用磁碟機 D:\，並如本文件中的[為連接的磁碟設定自動掛接][planning-guide-5.5.3]一章所述，為連接的磁碟設定磁碟自動掛接。</span><span class="sxs-lookup"><span data-stu-id="17c39-770">Make sure that drive D:\ is not used Set disk automount for attached disks as described in chapter [Setting automount for attached disks][planning-guide-5.5.3] in this document.</span></span>
>
> ![Linux][Logo_Linux] <span data-ttu-id="17c39-772">Linux</span><span class="sxs-lookup"><span data-stu-id="17c39-772">Linux</span></span>
>
> <span data-ttu-id="17c39-773">確定不會使用 /mnt/resource，並透過 uuid 掛接所有磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-773">Make sure that /mnt/resource is not used and that ALL disks are mounted via uuid.</span></span> <span data-ttu-id="17c39-774">針對 OS 磁碟，確定開機載入器項目也會反映 uuid 型掛接。</span><span class="sxs-lookup"><span data-stu-id="17c39-774">For the OS disk, make sure the bootloader entry also reflects the uuid-based mount.</span></span>
>
>

- - -
* <span data-ttu-id="17c39-775">SAP GUI (用於管理和安裝) 可預先安裝在這類範本中。</span><span class="sxs-lookup"><span data-stu-id="17c39-775">SAP GUI (for administrative and setup purposes) can be pre-installed in such a template.</span></span>
* <span data-ttu-id="17c39-776">只要此軟體可使用 VM 的重新命名功能，就能安裝在跨單位案例中成功執行 VM 所需的其他軟體。</span><span class="sxs-lookup"><span data-stu-id="17c39-776">Other software necessary to run the VMs successfully in cross-premises scenarios can be installed as long as this software can work with the rename of the VM.</span></span>

<span data-ttu-id="17c39-777">如果已準備好 VM 進行一般化，而且最終與目標 Azure 部署案例中未提供的的帳戶/使用者無關，則可以進行一般化這類映像的最後一個準備步驟。</span><span class="sxs-lookup"><span data-stu-id="17c39-777">If the VM is prepared sufficiently to be generic and eventually independent of accounts/users not available in the targeted Azure deployment scenario, the last preparation step of generalizing such an image is conducted.</span></span>

##### <a name="generalizing-a-vm"></a><span data-ttu-id="17c39-778">一般化 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-778">Generalizing a VM</span></span>
- - -
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-780">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-780">Windows</span></span>
>
> <span data-ttu-id="17c39-781">最後一個步驟是使用系統管理員帳戶登入 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-781">The last step is to log in to a VM with an Administrator account.</span></span> <span data-ttu-id="17c39-782">以「系統管理員」身分開啟 Windows 命令視窗。</span><span class="sxs-lookup"><span data-stu-id="17c39-782">Open a Windows command window as ‘administrator’.</span></span> <span data-ttu-id="17c39-783">移至 %windir%\windows\system32\sysprep and execute sysprep.exe。</span><span class="sxs-lookup"><span data-stu-id="17c39-783">Go to %windir%\windows\system32\sysprep and execute sysprep.exe.</span></span>
> <span data-ttu-id="17c39-784">隨即會出現一個小視窗。</span><span class="sxs-lookup"><span data-stu-id="17c39-784">A small window will appear.</span></span> <span data-ttu-id="17c39-785">請務必核取 [一般化] 選項 (預設不會核取)，並將 [關機] 選項從預設的 [重新開機] 變更為 [關機]。</span><span class="sxs-lookup"><span data-stu-id="17c39-785">It is important to check the ‘Generalize’ option (the default is un-checked) and change the Shutdown Option from its default of ‘Reboot’ to ‘Shutdown’.</span></span> <span data-ttu-id="17c39-786">此程序假設在 VM 的客體 OS 中以內部部署方式執行 sysprep 處理序。</span><span class="sxs-lookup"><span data-stu-id="17c39-786">This procedure assumes that the sysprep process is executed on-premises in the Guest OS of a VM.</span></span>
> <span data-ttu-id="17c39-787">如果您想要使用已在 Azure 中執行的 VM 來執行此程序，請依照[這篇文章](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/capture-image-resource)所述的步驟操作。</span><span class="sxs-lookup"><span data-stu-id="17c39-787">If you want to perform the procedure with a VM already running in Azure, follow the steps described in [this article](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/capture-image-resource).</span></span>
>
> ![Linux][Logo_Linux] <span data-ttu-id="17c39-789">Linux</span><span class="sxs-lookup"><span data-stu-id="17c39-789">Linux</span></span>
>
> <span data-ttu-id="17c39-790">[如何擷取 Linux 虛擬機器來作為 Resource Manager 範本使用][capture-image-linux-step-2-create-vm-image]</span><span class="sxs-lookup"><span data-stu-id="17c39-790">[How to capture a Linux virtual machine to use as a Resource Manager template][capture-image-linux-step-2-create-vm-image]</span></span>
>
>

- - -
### <a name="transferring-vms-and-vhds-between-on-premises-to-azure"></a><span data-ttu-id="17c39-791">在內部部署與 Azure 之間傳輸 VM 和 VHD</span><span class="sxs-lookup"><span data-stu-id="17c39-791">Transferring VMs and VHDs between on-premises to Azure</span></span>
<span data-ttu-id="17c39-792">因為無法透過 Azure 入口網站將 VM 映像和磁碟上傳至 Azure，所以您必須使用 Azure PowerShell Cmdlet 或 CLI。</span><span class="sxs-lookup"><span data-stu-id="17c39-792">Since uploading VM images and disks to Azure is not possible via the Azure portal, you need to use Azure PowerShell cmdlets or CLI.</span></span> <span data-ttu-id="17c39-793">您也可以使用 ’AzCopy’ 工具。</span><span class="sxs-lookup"><span data-stu-id="17c39-793">Another possibility is the use of the tool ‘AzCopy’.</span></span> <span data-ttu-id="17c39-794">此工具可在內部部署與 Azure 之間 (雙向) 複製 VHD。</span><span class="sxs-lookup"><span data-stu-id="17c39-794">The tool can copy VHDs between on-premises and Azure (in both directions).</span></span> <span data-ttu-id="17c39-795">它也可以在 Azure 區域之間複製 VHD。</span><span class="sxs-lookup"><span data-stu-id="17c39-795">It also can copy VHDs between Azure Regions.</span></span> <span data-ttu-id="17c39-796">如需了解如何下載及使用 AzCopy，請參閱[這份文件][storage-use-azcopy]。</span><span class="sxs-lookup"><span data-stu-id="17c39-796">Please consult [this documentation][storage-use-azcopy] for download and usage of AzCopy.</span></span>

<span data-ttu-id="17c39-797">第三個替代方案是使用各種協力廠商 GUI 導向的工具。</span><span class="sxs-lookup"><span data-stu-id="17c39-797">A third alternative would be to use various third-party GUI-oriented tools.</span></span> <span data-ttu-id="17c39-798">不過，請確定這些工具支援 Azure 分頁 Blob。</span><span class="sxs-lookup"><span data-stu-id="17c39-798">However, please make sure that these tools are supporting Azure Page Blobs.</span></span> <span data-ttu-id="17c39-799">基於本文的目的，我們需要使用 Azure 分頁 Blob 存放區 (差異如下所示：<https://docs.microsoft.com/rest/api/storageservices/Understanding-Block-Blobs--Append-Blobs--and-Page-Blobs>)。</span><span class="sxs-lookup"><span data-stu-id="17c39-799">For our purposes we need to use Azure Page Blob store (the differences are described here: <https://docs.microsoft.com/rest/api/storageservices/Understanding-Block-Blobs--Append-Blobs--and-Page-Blobs>).</span></span> <span data-ttu-id="17c39-800">此外，Azure 所提供的工具可有效率地壓縮必須上傳的 VM 和 VHD。</span><span class="sxs-lookup"><span data-stu-id="17c39-800">Also the tools provided by Azure are very efficient in compressing the VMs and VHDs which need to be uploaded.</span></span> <span data-ttu-id="17c39-801">這點很重要，因為此壓縮效率可縮短上傳時間 (也會因上傳的網際網路連結來自內部部署設施和目標 Azure 部署區域而異)。</span><span class="sxs-lookup"><span data-stu-id="17c39-801">This is important because this efficiency in compression reduces the upload time (which varies anyway depending on the upload link to the internet from the on-premises facility and the Azure deployment region targeted).</span></span> <span data-ttu-id="17c39-802">您可以合理假設將 VM 或 VHD 從歐洲位置上傳至美國 Azure 資料中心，比將相同的 VM/VHD 上傳至歐洲 Azure 資料中心需要更長的時間。</span><span class="sxs-lookup"><span data-stu-id="17c39-802">It is a fair assumption that uploading a VM or VHD from European location to the U.S.-based Azure data centers will take longer than uploading the same VMs/VHDs to the European Azure data centers.</span></span>

#### <span data-ttu-id="17c39-803"><a name="a43e40e6-1acc-4633-9816-8f095d5a7b6a"></a>將 VHD 從內部部署環境上傳至 Azure</span><span class="sxs-lookup"><span data-stu-id="17c39-803"><a name="a43e40e6-1acc-4633-9816-8f095d5a7b6a"></a>Uploading a VHD from on-premises to Azure</span></span>
<span data-ttu-id="17c39-804">若要從內部部署網路上傳現有的 VM 或 VHD，這類 VM 或 VHD 必須符合本文件的[準備使用非一般化磁碟將 VM 從內部部署環境移至 Azure][planning-guide-5.2.1]一章中所列的需求。</span><span class="sxs-lookup"><span data-stu-id="17c39-804">To upload an existing VM or VHD from the on-premises network such a VM or VHD needs to meet the requirements as listed in chapter [Preparation for moving a VM from on-premises to Azure with a non-generalized disk][planning-guide-5.2.1] of this document.</span></span>

<span data-ttu-id="17c39-805">這類 VM 不需要進行一般化，並且可依內部部署端關機後的狀態和形態進行上傳。</span><span class="sxs-lookup"><span data-stu-id="17c39-805">Such a VM does NOT need to be generalized and can be uploaded in the state and shape it has after shutdown on the on-premises side.</span></span> <span data-ttu-id="17c39-806">此規則也適用於不含作業系統的其他 VHD。</span><span class="sxs-lookup"><span data-stu-id="17c39-806">The same is true for additional VHDs which don’t contain any operating system.</span></span>

##### <a name="uploading-a-vhd-and-making-it-an-azure-disk"></a><span data-ttu-id="17c39-807">上傳 VHD 並將其設為 Azure 磁碟</span><span class="sxs-lookup"><span data-stu-id="17c39-807">Uploading a VHD and making it an Azure Disk</span></span>
<span data-ttu-id="17c39-808">在本例中，我們想要上傳 VHD (可含有或不含 OS)，並將其掛接到 VM，以作為資料磁碟或用作 OS 磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-808">In this case we want to upload a VHD, either with or without an OS in it, and mount it to a VM as a data disk or use it as OS disk.</span></span> <span data-ttu-id="17c39-809">這是一個多步驟程序</span><span class="sxs-lookup"><span data-stu-id="17c39-809">This is a multi-step process</span></span>

<span data-ttu-id="17c39-810">**Powershell**</span><span class="sxs-lookup"><span data-stu-id="17c39-810">**Powershell**</span></span>

* <span data-ttu-id="17c39-811">使用 *Login-AzureRmAccount* 登入您的訂用帳戶</span><span class="sxs-lookup"><span data-stu-id="17c39-811">Log in to your subscription with *Login-AzureRmAccount*</span></span>
* <span data-ttu-id="17c39-812">使用 *Set-AzureRmContext* 和參數 SubscriptionId 或 SubscriptionName 來設定您內容的訂用帳戶 - 請參閱 <https://docs.microsoft.com/powershell/module/azurerm.profile/set-azurermcontext></span><span class="sxs-lookup"><span data-stu-id="17c39-812">Set the subscription of your context with *Set-AzureRmContext* and parameter SubscriptionId or SubscriptionName - see <https://docs.microsoft.com/powershell/module/azurerm.profile/set-azurermcontext></span></span>
* <span data-ttu-id="17c39-813">使用 *Add-AzureRmVhd* 將 VHD 上傳至 Azure 儲存體帳戶 - 請參閱 <https://docs.microsoft.com/powershell/module/azurerm.compute/add-azurermvhd></span><span class="sxs-lookup"><span data-stu-id="17c39-813">Upload the VHD with *Add-AzureRmVhd* to an Azure Storage Account - see <https://docs.microsoft.com/powershell/module/azurerm.compute/add-azurermvhd></span></span>
* <span data-ttu-id="17c39-814">(選擇性) 使用 *New-AzureRmDisk* 從 VHD 建立受控磁碟 - 請參閱<https://docs.microsoft.com/powershell/module/azurerm.compute/new-azurermdisk></span><span class="sxs-lookup"><span data-stu-id="17c39-814">(Optional) Create a Managed Disk from the VHD with *New-AzureRmDisk*  - see <https://docs.microsoft.com/powershell/module/azurerm.compute/new-azurermdisk></span></span>
* <span data-ttu-id="17c39-815">使用 *Set-AzureRmVMOSDisk* 將新 VM 組態的作業系統磁碟設定為 VHD 或受控磁碟 - 請參閱<https://docs.microsoft.com/powershell/module/azurerm.compute/set-azurermvmosdisk></span><span class="sxs-lookup"><span data-stu-id="17c39-815">Set the OS disk of a new VM config to the VHD or Managed Disk with *Set-AzureRmVMOSDisk* - see <https://docs.microsoft.com/powershell/module/azurerm.compute/set-azurermvmosdisk></span></span>
* <span data-ttu-id="17c39-816">從 VM 組態，以建立新的 VM*新增 AzureRmVM* -請參閱<https://docs.microsoft.com/powershell/module/azurerm.compute/new-azurermvm></span><span class="sxs-lookup"><span data-stu-id="17c39-816">Create a new VM from the VM config with *New-AzureRmVM* - see <https://docs.microsoft.com/powershell/module/azurerm.compute/new-azurermvm></span></span>
* <span data-ttu-id="17c39-817">將資料磁碟加入至新的 VM 與*新增 AzureRmVMDataDisk* - 請參閱<https://docs.microsoft.com/powershell/module/azurerm.compute/add-azurermvmdatadisk></span><span class="sxs-lookup"><span data-stu-id="17c39-817">Add a data disk to a new VM with *Add-AzureRmVMDataDisk* - see <https://docs.microsoft.com/powershell/module/azurerm.compute/add-azurermvmdatadisk></span></span>

<span data-ttu-id="17c39-818">**Azure CLI 2.0**</span><span class="sxs-lookup"><span data-stu-id="17c39-818">**Azure CLI 2.0**</span></span>

* <span data-ttu-id="17c39-819">使用 *az login* 來登入您的訂用帳戶</span><span class="sxs-lookup"><span data-stu-id="17c39-819">Log in to your subscription with *az login*</span></span>
* <span data-ttu-id="17c39-820">使用 *az account set --subscription `<subscription name or id`>* 來選取您的訂用帳戶</span><span class="sxs-lookup"><span data-stu-id="17c39-820">Select your subscription with *az account set --subscription `<subscription name or id`>*</span></span>
* <span data-ttu-id="17c39-821">使用 *az storage blob upload* 來上傳 VHD - 請參閱[使用 Azure CLI 搭配 Azure 儲存體][storage-azure-cli]</span><span class="sxs-lookup"><span data-stu-id="17c39-821">Upload the VHD with *az storage blob upload* - see [Using the Azure CLI with Azure Storage][storage-azure-cli]</span></span>
* <span data-ttu-id="17c39-822">(選擇性) 使用 *az disk create* 從 VHD 建立受控磁碟 - 請參閱 https://docs.microsoft.com/cli/azure/disk#create</span><span class="sxs-lookup"><span data-stu-id="17c39-822">(Optional) Create a Managed Disk from the VHD with *az disk create* - see https://docs.microsoft.com/cli/azure/disk#create</span></span>
* <span data-ttu-id="17c39-823">使用 *az vm create* 和參數 *--attach-os-disk* 來建立一個指定以上傳的 VHD 或受控磁碟作為作業系統磁碟的新 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-823">Create a new VM specifying the uploaded VHD or Managed Disk as OS disk with *az vm create* and parameter *--attach-os-disk*</span></span>
* <span data-ttu-id="17c39-824">使用 *az vm disk attach* 和參數 *--new* 來將資料磁碟新增至新的 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-824">Add a data disk to a new VM with *az vm disk attach* and parameter *--new*</span></span>

<span data-ttu-id="17c39-825">**範本**</span><span class="sxs-lookup"><span data-stu-id="17c39-825">**Template**</span></span>

* <span data-ttu-id="17c39-826">使用 Powershell 或 Azure CLI 上傳 VHD</span><span class="sxs-lookup"><span data-stu-id="17c39-826">Upload the VHD with Powershell or Azure CLI</span></span>
* <span data-ttu-id="17c39-827">(選擇性) 使用 Powershell、Azure CLI 或 Azure 入口網站從 VHD 建立受控磁碟</span><span class="sxs-lookup"><span data-stu-id="17c39-827">(Optional) Create a Managed Disk from the VHD with Powershell, Azure CLI or the Azure portal</span></span>
* <span data-ttu-id="17c39-828">如[此 JSON 範本範例](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-vm-specialized-vhd/azuredeploy.json)所示使用參考 VHD 的 JSON 範本，或如[此 JSON 範本範例](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/sap-2-tier-user-disk-md/azuredeploy.json)所示使用受控磁碟，來部署 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-828">Deploy the VM with a JSON template referencing the VHD as shown in [this example JSON template](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-vm-specialized-vhd/azuredeploy.json) or using Managed Disks as shown in [this example JSON template](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/sap-2-tier-user-disk-md/azuredeploy.json).</span></span>

#### <a name="deployment-of-a-vm-image"></a><span data-ttu-id="17c39-829">VM 映像的部署</span><span class="sxs-lookup"><span data-stu-id="17c39-829">Deployment of a VM Image</span></span>
<span data-ttu-id="17c39-830">若要從內部部署網路上傳現有的 VM 或 VHD 以作為 Azure VM 映像，這類 VM 或 VHD 必須符合本文件的[準備使用客戶特定的映像為 SAP 部署 VM][planning-guide-5.2.2] 一章中所列的需求。</span><span class="sxs-lookup"><span data-stu-id="17c39-830">To upload an existing VM or VHD from the on-premises network in order to use it as an Azure VM image such a VM or VHD need to meet the requirements listed in chapter [Preparation for deploying a VM with a customer-specific image for SAP][planning-guide-5.2.2] of this document.</span></span>

* <span data-ttu-id="17c39-831">在 Windows 上使用 *sysprep* 或在 Linux 上使用 *waagent -deprovision* 以將您的 VM 一般化 - 請參閱 [Sysprep 技術參考](https://technet.microsoft.com/library/cc766049.aspx) (適用於 Windows) 或[如何擷取 Linux 虛擬機器來作為 Resource Manager 範本使用][capture-image-linux-step-2-create-vm-image] (適用於 Linux)</span><span class="sxs-lookup"><span data-stu-id="17c39-831">Use *sysprep* on Windows or *waagent -deprovision* on Linux to generalize your VM - see [Sysprep Technical Reference](https://technet.microsoft.com/library/cc766049.aspx) for Windows or [How to capture a Linux virtual machine to use as a Resource Manager template][capture-image-linux-step-2-create-vm-image] for Linux</span></span>
* <span data-ttu-id="17c39-832">使用 *Login-AzureRmAccount* 登入您的訂用帳戶</span><span class="sxs-lookup"><span data-stu-id="17c39-832">Log in to your subscription with *Login-AzureRmAccount*</span></span>
* <span data-ttu-id="17c39-833">使用 *Set-AzureRmContext* 和參數 SubscriptionId 或 SubscriptionName 來設定您內容的訂用帳戶 - 請參閱 <https://docs.microsoft.com/powershell/module/azurerm.profile/set-azurermcontext></span><span class="sxs-lookup"><span data-stu-id="17c39-833">Set the subscription of your context with *Set-AzureRmContext* and parameter SubscriptionId or SubscriptionName - see <https://docs.microsoft.com/powershell/module/azurerm.profile/set-azurermcontext></span></span>
* <span data-ttu-id="17c39-834">使用 *Add-AzureRmVhd* 將 VHD 上傳至 Azure 儲存體帳戶 - 請參閱 <https://docs.microsoft.com/powershell/module/azurerm.compute/add-azurermvhd></span><span class="sxs-lookup"><span data-stu-id="17c39-834">Upload the VHD with *Add-AzureRmVhd* to an Azure Storage Account - see <https://docs.microsoft.com/powershell/module/azurerm.compute/add-azurermvhd></span></span>
* <span data-ttu-id="17c39-835">(選擇性) 使用 *New-AzureRmImage* 從 VHD 建立受控磁碟映像 - 請參閱 <https://docs.microsoft.com/powershell/module/azurerm.compute/new-azurermimage></span><span class="sxs-lookup"><span data-stu-id="17c39-835">(Optional) Create a Managed Disk Image from the VHD with *New-AzureRmImage*  - see <https://docs.microsoft.com/powershell/module/azurerm.compute/new-azurermimage></span></span>
* <span data-ttu-id="17c39-836">將新 VM 設定的 OS 磁碟設定為</span><span class="sxs-lookup"><span data-stu-id="17c39-836">Set the OS disk of a new VM config to the</span></span>
  * <span data-ttu-id="17c39-837">VHD (使用 *Set-AzureRmVMOSDisk -SourceImageUri -CreateOption fromImage*) - 請參閱 <https://docs.microsoft.com/powershell/module/azurerm.compute/set-azurermvmosdisk></span><span class="sxs-lookup"><span data-stu-id="17c39-837">VHD with *Set-AzureRmVMOSDisk -SourceImageUri -CreateOption fromImage* - see <https://docs.microsoft.com/powershell/module/azurerm.compute/set-azurermvmosdisk></span></span>
  * <span data-ttu-id="17c39-838">受控磁碟映像 *Set-AzureRmVMSourceImage* - 請參閱 <https://docs.microsoft.com/powershell/module/azurerm.compute/set-azurermvmsourceimage></span><span class="sxs-lookup"><span data-stu-id="17c39-838">Managed Disk Image *Set-AzureRmVMSourceImage* - see <https://docs.microsoft.com/powershell/module/azurerm.compute/set-azurermvmsourceimage></span></span>
* <span data-ttu-id="17c39-839">從 VM 組態，以建立新的 VM*新增 AzureRmVM* -請參閱<https://docs.microsoft.com/powershell/module/azurerm.compute/new-azurermvm></span><span class="sxs-lookup"><span data-stu-id="17c39-839">Create a new VM from the VM config with *New-AzureRmVM* - see <https://docs.microsoft.com/powershell/module/azurerm.compute/new-azurermvm></span></span>

<span data-ttu-id="17c39-840">**Azure CLI 2.0**</span><span class="sxs-lookup"><span data-stu-id="17c39-840">**Azure CLI 2.0**</span></span>

* <span data-ttu-id="17c39-841">在 Windows 上使用 *sysprep* 或在 Linux 上使用 *waagent -deprovision* 以將您的 VM 一般化 - 請參閱 [Sysprep 技術參考](https://technet.microsoft.com/library/cc766049.aspx) (適用於 Windows) 或[如何擷取 Linux 虛擬機器來作為 Resource Manager 範本使用][capture-image-linux-step-2-create-vm-image] (適用於 Linux)</span><span class="sxs-lookup"><span data-stu-id="17c39-841">Use *sysprep* on Windows or *waagent -deprovision* on Linux to generalize your VM - see [Sysprep Technical Reference](https://technet.microsoft.com/library/cc766049.aspx) for Windows or [How to capture a Linux virtual machine to use as a Resource Manager template][capture-image-linux-step-2-create-vm-image] for Linux</span></span>
* <span data-ttu-id="17c39-842">使用 *az login* 來登入您的訂用帳戶</span><span class="sxs-lookup"><span data-stu-id="17c39-842">Log in to your subscription with *az login*</span></span>
* <span data-ttu-id="17c39-843">使用 *az account set --subscription `<subscription name or id`>* 來選取您的訂用帳戶</span><span class="sxs-lookup"><span data-stu-id="17c39-843">Select your subscription with *az account set --subscription `<subscription name or id`>*</span></span>
* <span data-ttu-id="17c39-844">使用 *az storage blob upload* 來上傳 VHD - 請參閱[使用 Azure CLI 搭配 Azure 儲存體][storage-azure-cli]</span><span class="sxs-lookup"><span data-stu-id="17c39-844">Upload the VHD with *az storage blob upload* - see [Using the Azure CLI with Azure Storage][storage-azure-cli]</span></span>
* <span data-ttu-id="17c39-845">(選擇性) 使用 *az image create* 從 VHD 建立受控磁碟映像 - 請參閱 https://docs.microsoft.com/cli/azure/image#create</span><span class="sxs-lookup"><span data-stu-id="17c39-845">(Optional) Create a Managed Disk Image from the VHD with *az image create* - see https://docs.microsoft.com/cli/azure/image#create</span></span>
* <span data-ttu-id="17c39-846">使用 *az vm create* 和參數 *--image* 來建立一個指定以上傳的 VHD 或受控磁碟映像作為作業系統磁碟的新 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-846">Create a new VM specifying the uploaded VHD or Managed Disk Image as OS disk with *az vm create* and parameter *--image*</span></span>

<span data-ttu-id="17c39-847">**範本**</span><span class="sxs-lookup"><span data-stu-id="17c39-847">**Template**</span></span>

* <span data-ttu-id="17c39-848">在 Windows 上使用 *sysprep* 或在 Linux 上使用 *waagent -deprovision* 以將您的 VM 一般化 - 請參閱 [Sysprep 技術參考](https://technet.microsoft.com/library/cc766049.aspx) (適用於 Windows) 或[如何擷取 Linux 虛擬機器來作為 Resource Manager 範本使用][capture-image-linux-step-2-create-vm-image] (適用於 Linux)</span><span class="sxs-lookup"><span data-stu-id="17c39-848">Use *sysprep* on Windows or *waagent -deprovision* on Linux to generalize your VM - see [Sysprep Technical Reference](https://technet.microsoft.com/library/cc766049.aspx) for Windows or [How to capture a Linux virtual machine to use as a Resource Manager template][capture-image-linux-step-2-create-vm-image] for Linux</span></span>
* <span data-ttu-id="17c39-849">使用 Powershell 或 Azure CLI 上傳 VHD</span><span class="sxs-lookup"><span data-stu-id="17c39-849">Upload the VHD with Powershell or Azure CLI</span></span>
* <span data-ttu-id="17c39-850">(選擇性) 使用 Powershell、Azure CLI 或 Azure 入口網站從 VHD 建立受控磁碟映像</span><span class="sxs-lookup"><span data-stu-id="17c39-850">(Optional) Create a Managed Disk Image from the VHD with Powershell, Azure CLI or the Azure portal</span></span>
* <span data-ttu-id="17c39-851">如[此 JSON 範本範例](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/sap-2-tier-user-image/azuredeploy.json)所示使用參考映像 VHD 的 JSON 範本，或如[此 JSON 範本範例](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-vm-from-user-image/azuredeploy.json)所示使用受控磁碟映像，來部署 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-851">Deploy the VM with a JSON template referencing the image VHD as shown in [this example JSON template](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/sap-2-tier-user-image/azuredeploy.json) or using the Managed Disk Image as shown in [this example JSON template](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-vm-from-user-image/azuredeploy.json).</span></span>

#### <a name="downloading-vhds-or-managed-disks-to-on-premises"></a><span data-ttu-id="17c39-852">將 VHD 或受控磁碟下載至內部部署</span><span class="sxs-lookup"><span data-stu-id="17c39-852">Downloading VHDs or Managed Disks to on-premises</span></span>
<span data-ttu-id="17c39-853">Azure 基礎結構即服務不只可以單向上傳 VHD 和 SAP 系統，</span><span class="sxs-lookup"><span data-stu-id="17c39-853">Azure Infrastructure as a Service is not a one-way street of only being able to upload VHDs and SAP systems.</span></span> <span data-ttu-id="17c39-854">您也可以將 SAP 系統從 Azure 移回內部部署世界。</span><span class="sxs-lookup"><span data-stu-id="17c39-854">You can move SAP systems from Azure back into the on-premises world as well.</span></span>

<span data-ttu-id="17c39-855">下載期間無法啟動 VHD 或受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-855">During the time of the download the VHDs or Managed Disks can’t be active.</span></span> <span data-ttu-id="17c39-856">即使是下載掛接到 VM 的磁碟時，也必須將 VM 關閉和解除配置。</span><span class="sxs-lookup"><span data-stu-id="17c39-856">Even when downloading disks which are mounted to VMs, the VM needs to be shut down and deallocated.</span></span> <span data-ttu-id="17c39-857">如果您只想要下載資料庫內容，然後使用此內容在內部部署安裝新系統，而且如果在下載及安裝新系統的期間，Azure 中的系統仍然可以運作，則您可以藉由執行將壓縮的資料庫備份到磁碟，並只下載該磁碟而不是同時下載 OS 基底 VM，來避免停機時間過長。</span><span class="sxs-lookup"><span data-stu-id="17c39-857">If you only want to download the database content which then should be used to set up a new system on-premises and if it is acceptable that during the time of the download and the setup of the new system that the system in Azure can still be operational, you could avoid a long downtime by performing a compressed database backup into a disk and just download that disk instead of also downloading the OS base VM.</span></span>

#### <a name="powershell"></a><span data-ttu-id="17c39-858">Powershell</span><span class="sxs-lookup"><span data-stu-id="17c39-858">Powershell</span></span>

  * <span data-ttu-id="17c39-859">下載受控磁碟</span><span class="sxs-lookup"><span data-stu-id="17c39-859">Downloading a Managed Disk</span></span>  
  <span data-ttu-id="17c39-860">您必須先取得受控磁碟的基礎 Blob 存取權。</span><span class="sxs-lookup"><span data-stu-id="17c39-860">You first need to get access to the underlying blob of the Managed Disk.</span></span> <span data-ttu-id="17c39-861">然後您可以將基礎 Blob 複製到新的儲存體帳戶，並從這個儲存體帳戶下載 Blob。</span><span class="sxs-lookup"><span data-stu-id="17c39-861">Then you can copy the underlying blob to a new storage account and download the blob from this storage account.</span></span>

  ```powershell
  $access = Grant-AzureRmDiskAccess -ResourceGroupName <resource group> -DiskName <disk name> -Access Read -DurationInSecond 3600
  $key = (Get-AzureRmStorageAccountKey -ResourceGroupName <resource group> -Name <storage account name>)[0].Value
  $destContext = (New-AzureStorageContext -StorageAccountName <storage account name -StorageAccountKey $key)
  Start-AzureStorageBlobCopy -AbsoluteUri $access.AccessSAS -DestContainer <container name> -DestBlob <blob name> -DestContext $destContext
  # Wait for blob copy to finish
  Get-AzureStorageBlobCopyState -Container <container name> -Blob <blob name> -Context $destContext
  Save-AzureRmVhd -SourceUri <blob in new storage account> -LocalFilePath <local file path> -StorageKey $key
  # Wait for download to finish
  Revoke-AzureRmDiskAccess -ResourceGroupName <resource group> -DiskName <disk name>
  ```

  * <span data-ttu-id="17c39-862">下載 VHD</span><span class="sxs-lookup"><span data-stu-id="17c39-862">Downloading a VHD</span></span>  
  <span data-ttu-id="17c39-863">停止 SAP 系統並關閉 VM 之後，您可以在內部部署目標上使用 PowerShell Cmdlet Save-AzureRmVhd，將 VHD 磁碟下載回到內部部署世界。</span><span class="sxs-lookup"><span data-stu-id="17c39-863">Once the SAP system is stopped and the VM is shut down, you can use the PowerShell cmdlet Save-AzureRmVhd on the on-premises target to download the VHD disks back to the on-premises world.</span></span> <span data-ttu-id="17c39-864">若要執行這項操作，需要 VHD 的 URL。此 URL 可以在 Azure 入口網站的 [儲存體] 區段中找到 (必須巡覽至儲存體帳戶及 VHD 建立所在的儲存體容器)。您也必須知道複製 VHD 的目的地。</span><span class="sxs-lookup"><span data-stu-id="17c39-864">In order to do that, you need the URL of the VHD which you can find in the ‘Storage Section’ of the Azure portal (need to navigate to the Storage Account and the storage container where the VHD was created) and you need to know where the VHD should be copied to.</span></span>

  <span data-ttu-id="17c39-865">然後您可以利用此命令，方法是直接定義參數 SourceUri 作為要下載之 VHD 的 URL，並定義 LocalFilePath 作為 VHD (包括其名稱) 的實體位置。</span><span class="sxs-lookup"><span data-stu-id="17c39-865">Then you can leverage the command by simply defining the parameter SourceUri as the URL of the VHD to download and the LocalFilePath as the physical location of the VHD (including its name).</span></span> <span data-ttu-id="17c39-866">此命令可能如下所示︰</span><span class="sxs-lookup"><span data-stu-id="17c39-866">The command could look like:</span></span>

  ```powerhell
  Save-AzureRmVhd -ResourceGroupName <resource group name of storage account> -SourceUri http://<storage account name>.blob.core.windows.net/<container name>/sapidedata.vhd -LocalFilePath E:\Azure_downloads\sapidesdata.vhd
  ```

  <span data-ttu-id="17c39-867">如需 Save-AzureRmVhd Cmdlet 的詳細資訊，請參閱以下 <https://docs.microsoft.com/powershell/module/azurerm.compute/save-azurermvhd>。</span><span class="sxs-lookup"><span data-stu-id="17c39-867">For more details of the Save-AzureRmVhd cmdlet, please check here <https://docs.microsoft.com/powershell/module/azurerm.compute/save-azurermvhd>.</span></span>

#### <a name="cli-20"></a><span data-ttu-id="17c39-868">CLI 2.0</span><span class="sxs-lookup"><span data-stu-id="17c39-868">CLI 2.0</span></span>
  * <span data-ttu-id="17c39-869">下載受控磁碟</span><span class="sxs-lookup"><span data-stu-id="17c39-869">Downloading a Managed Disk</span></span>  
  <span data-ttu-id="17c39-870">您必須先取得受控磁碟的基礎 Blob 存取權。</span><span class="sxs-lookup"><span data-stu-id="17c39-870">You first need to get access to the underlying blob of the Managed Disk.</span></span> <span data-ttu-id="17c39-871">然後您可以將基礎 Blob 複製到新的儲存體帳戶，並從這個儲存體帳戶下載 Blob。</span><span class="sxs-lookup"><span data-stu-id="17c39-871">Then you can copy the underlying blob to a new storage account and download the blob from this storage account.</span></span>
  ```
  az disk grant-access --ids "/subscriptions/<subscription id>/resourceGroups/<resource group>/providers/Microsoft.Compute/disks/<disk name>" --duration-in-seconds 3600
  az storage blob download --sas-token "<sas token>" --account-name <account name> --container-name <container name> --name <blob name> --file <local file>
  az disk revoke-access --ids "/subscriptions/<subscription id>/resourceGroups/<resource group>/providers/Microsoft.Compute/disks/<disk name>"
  ```

  * <span data-ttu-id="17c39-872">下載 VHD</span><span class="sxs-lookup"><span data-stu-id="17c39-872">Downloading a VHD</span></span>   
  <span data-ttu-id="17c39-873">停止 SAP 系統並關閉 VM 之後，您可以在內部部署目標上使用 Azure CLI 命令 _azure storage blob download_，將 VHD 磁碟下載回到內部部署世界。</span><span class="sxs-lookup"><span data-stu-id="17c39-873">Once the SAP system is stopped and the VM is shut down, you can use the Azure CLI command _azure storage blob download_ on the on-premises target to download the VHD disks back to the on-premises world.</span></span> <span data-ttu-id="17c39-874">若要執行這項操作，需要 VHD 的名稱和容器。VHD 的名稱和容器可以在 Azure 入口網站的 [儲存體] 區段中找到 (必須巡覽至儲存體帳戶及 VHD 建立所在的儲存體容器)。您也必須知道複製 VHD 的目的地。</span><span class="sxs-lookup"><span data-stu-id="17c39-874">In order to do that, you need the name and the container of the VHD which you can find in the ‘Storage Section’ of the Azure portal (need to navigate to the Storage Account and the storage container where the VHD was created) and you need to know where the VHD should be copied to.</span></span>

  <span data-ttu-id="17c39-875">然後您可以利用此命令，方法是直接定義要下載之 VHD 的參數 blob 和 container，並定義 destination 作為 VHD (包括其名稱) 的實體目標位置。</span><span class="sxs-lookup"><span data-stu-id="17c39-875">Then you can leverage the command by simply defining the parameters blob and container of the VHD to download and the destination as the physical target location of the VHD (including its name).</span></span> <span data-ttu-id="17c39-876">此命令可能如下所示︰</span><span class="sxs-lookup"><span data-stu-id="17c39-876">The command could look like:</span></span>

  ```
  az storage blob download --name <name of the VHD to download> --container-name <container of the VHD to download> --account-name <storage account name of the VHD to download> --account-key <storage account key> --file <destination of the VHD to download>
  ```

### <a name="transferring-vms-and-disks-within-azure"></a><span data-ttu-id="17c39-877">在 Azure 內傳輸 VM 和磁碟</span><span class="sxs-lookup"><span data-stu-id="17c39-877">Transferring VMs and disks within Azure</span></span>
#### <a name="copying-sap-systems-within-azure"></a><span data-ttu-id="17c39-878">在 Azure 內複製 SAP 系統</span><span class="sxs-lookup"><span data-stu-id="17c39-878">Copying SAP systems within Azure</span></span>
<span data-ttu-id="17c39-879">SAP 系統或甚至是支援 SAP 應用程式層的專用 DBMS 伺服器很可能是由數個磁碟所組成，其中包含作業系統二進位檔或 SAP 資料庫的資料和記錄檔。</span><span class="sxs-lookup"><span data-stu-id="17c39-879">An SAP system or even a dedicated DBMS server supporting an SAP application layer will likely consist of several disks which contain either the OS with the binaries or the data and log file(s) of the SAP database.</span></span> <span data-ttu-id="17c39-880">複製磁碟的 Azure 功能或將磁碟儲存至本機磁碟的 Azure 功能都沒有同步處理機制，無法同步對多個磁碟進行快照。</span><span class="sxs-lookup"><span data-stu-id="17c39-880">Neither the Azure functionality of copying disks nor the Azure functionality of saving disks to a local disk has a synchronization mechanism, which would snapshot multiple disks synchronously.</span></span> <span data-ttu-id="17c39-881">因此，即使對相同 VM 掛接複製或儲存的磁碟，磁碟的狀態也不會相同。</span><span class="sxs-lookup"><span data-stu-id="17c39-881">Therefore, the state of the copied or saved disks even if those are mounted against the same VM would be different.</span></span> <span data-ttu-id="17c39-882">這表示在不同磁碟含有不同資料和記錄檔的明確情況下，最後的資料庫可能會不一致。</span><span class="sxs-lookup"><span data-stu-id="17c39-882">This means that in the concrete case of having different data and logfile(s) contained in the different disks, the database in the end would be inconsistent.</span></span>

<span data-ttu-id="17c39-883">**結論︰若要複製或儲存包含在 SAP 系統組態中的磁碟，您必須停止 SAP 系統，也必須關閉已部署的 VM。唯有如此，您才能複製或下載磁碟集合，以在 Azure 中或在內部部署建立 SAP 系統複本。**</span><span class="sxs-lookup"><span data-stu-id="17c39-883">**Conclusion: In order to copy or save disks which are part of an SAP system configuration you need to stop the SAP system and also need to shut down the deployed VM. Only then you can copy or download the set of disks to either create a copy of the SAP system in Azure or on-premises.**</span></span>

<span data-ttu-id="17c39-884">資料磁碟可儲存為 Azure 儲存體帳戶中的 VHD 檔案，而且可以直接連接到虛擬機器或用作映像。</span><span class="sxs-lookup"><span data-stu-id="17c39-884">Data disks can be stored as VHD files in an Azure Storage Account and can be directly attached to a virtual machine or be used as an image.</span></span> <span data-ttu-id="17c39-885">在本例中，VHD 會複製到另一個位置，再連接到虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="17c39-885">In this case, the VHD is copied to another location before being attached to the virtual machine.</span></span> <span data-ttu-id="17c39-886">Azure 中之 VHD 檔案的完整名稱必須在 Azure 中是唯一的。</span><span class="sxs-lookup"><span data-stu-id="17c39-886">The full name of the VHD file in Azure must be unique within Azure.</span></span> <span data-ttu-id="17c39-887">如前所述，此名稱是由三個部分所組成，如下所示︰</span><span class="sxs-lookup"><span data-stu-id="17c39-887">As mentioned earlier already, the name is kind of a three-part name that looks like:</span></span>

    http(s)://<storage account name>.blob.core.windows.net/<container name>/<vhd name>

<span data-ttu-id="17c39-888">資料磁碟也可以是受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-888">Data disks can also be Managed Disks.</span></span> <span data-ttu-id="17c39-889">在本例中，先使用受控磁碟建立新的受控磁碟，再連接到虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="17c39-889">In this case, the Managed Disk is used to create a new Managed Disk before being attached to the virtual machine.</span></span> <span data-ttu-id="17c39-890">受控磁碟的名稱必須是資源群組內唯一的。</span><span class="sxs-lookup"><span data-stu-id="17c39-890">The name of the Managed Disk must be unique within a resource group.</span></span>

##### <a name="powershell"></a><span data-ttu-id="17c39-891">Powershell</span><span class="sxs-lookup"><span data-stu-id="17c39-891">Powershell</span></span>
<span data-ttu-id="17c39-892">您可以使用 Azure PowerShell Cmdlet 來複製 VHD，如[這篇文章][storage-powershell-guide-full-copy-vhd]所示。</span><span class="sxs-lookup"><span data-stu-id="17c39-892">You can use Azure PowerShell cmdlets to copy a VHD as shown in [this article][storage-powershell-guide-full-copy-vhd].</span></span> <span data-ttu-id="17c39-893">若要建立新的受控磁碟，請使用 New-AzureRmDiskConfig 和 New-AzureRmDisk，如下列範例所示。</span><span class="sxs-lookup"><span data-stu-id="17c39-893">To create a new Managed Disk, use New-AzureRmDiskConfig and New-AzureRmDisk as shown in the following example.</span></span>

```powershell
$config = New-AzureRmDiskConfig -CreateOption Copy -SourceUri "/subscriptions/<subscription id>/resourceGroups/<resource group>/providers/Microsoft.Compute/disks/<disk name>" -Location <location>
New-AzureRmDisk -ResourceGroupName <resource group name> -DiskName <disk name> -Disk $config
```

##### <a name="cli-20"></a><span data-ttu-id="17c39-894">CLI 2.0</span><span class="sxs-lookup"><span data-stu-id="17c39-894">CLI 2.0</span></span>
<span data-ttu-id="17c39-895">您可以使用 Azure CLI 來複製 VHD，如[這篇文章][storage-azure-cli-copy-blobs]所示。</span><span class="sxs-lookup"><span data-stu-id="17c39-895">You can use Azure CLI to copy a VHD as shown in [this article][storage-azure-cli-copy-blobs].</span></span> <span data-ttu-id="17c39-896">若要建立新的受控磁碟，請使用 *az disk create*，如下列範例所示。</span><span class="sxs-lookup"><span data-stu-id="17c39-896">To create a new Managed Disk, use *az disk create* as shown in the following example.</span></span>

```
az disk create --source "/subscriptions/<subscription id>/resourceGroups/<resource group>/providers/Microsoft.Compute/disks/<disk name>" --name <disk name> --resource-group <resource group name> --location <location>
```

##### <a name="azure-storage-tools"></a><span data-ttu-id="17c39-897">Azure 儲存體工具</span><span class="sxs-lookup"><span data-stu-id="17c39-897">Azure Storage tools</span></span>
* <span data-ttu-id="17c39-898"><http://storageexplorer.com/></span><span class="sxs-lookup"><span data-stu-id="17c39-898"><http://storageexplorer.com/></span></span>

<span data-ttu-id="17c39-899">您可以在下面找到 Azure 儲存體總管的專業版︰</span><span class="sxs-lookup"><span data-stu-id="17c39-899">Professional editions of Azure Storage Explorers can be found here:</span></span>

* <span data-ttu-id="17c39-900"><http://www.cerebrata.com/></span><span class="sxs-lookup"><span data-stu-id="17c39-900"><http://www.cerebrata.com/></span></span>
* <span data-ttu-id="17c39-901"><http://clumsyleaf.com/products/cloudxplorer></span><span class="sxs-lookup"><span data-stu-id="17c39-901"><http://clumsyleaf.com/products/cloudxplorer></span></span>

<span data-ttu-id="17c39-902">在儲存體帳戶中複製 VHD 本身是只需要幾秒鐘的程序 (類似於使用延遲複製和寫入時複製來建立快照集的 SAN 硬體)。</span><span class="sxs-lookup"><span data-stu-id="17c39-902">The copy of a VHD itself within a storage account is a process which takes only a few seconds (similar to SAN hardware creating snapshots with lazy copy and copy on write).</span></span> <span data-ttu-id="17c39-903">擁有 VHD 檔案複本之後，您可以將其連接到虛擬機器，或用作映像以將 VHD 複本連接到虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="17c39-903">After you have a copy of the VHD file you can attach it to a virtual machine or use it as an image to attach copies of the VHD to virtual machines.</span></span>

##### <a name="powershell"></a><span data-ttu-id="17c39-904">Powershell</span><span class="sxs-lookup"><span data-stu-id="17c39-904">Powershell</span></span>
```powershell
# attach a vhd to a vm
$vm = Get-AzureRmVM -ResourceGroupName <resource group name> -Name <vm name>
$vm = Add-AzureRmVMDataDisk -VM $vm -Name newdatadisk -VhdUri <path to vhd> -Caching <caching option> -DiskSizeInGB $null -Lun <lun, for example 0> -CreateOption attach
$vm | Update-AzureRmVM

# attach a managed disk to a vm
$vm = Get-AzureRmVM -ResourceGroupName <resource group name> -Name <vm name>
$vm = Add-AzureRmVMDataDisk -VM $vm -Name newdatadisk -ManagedDiskId <managed disk id> -Caching <caching option> -DiskSizeInGB $null -Lun <lun, for example 0> -CreateOption attach
$vm | Update-AzureRmVM

# attach a copy of the vhd to a vm
$vm = Get-AzureRmVM -ResourceGroupName <resource group name> -Name <vm name>
$vm = Add-AzureRmVMDataDisk -VM $vm -Name <disk name> -VhdUri <new path of vhd> -SourceImageUri <path to image vhd> -Caching <caching option> -DiskSizeInGB $null -Lun <lun, for example 0> -CreateOption fromImage
$vm | Update-AzureRmVM

# attach a copy of the managed disk to a vm
$vm = Get-AzureRmVM -ResourceGroupName <resource group name> -Name <vm name>
$diskConfig = New-AzureRmDiskConfig -Location $vm.Location -CreateOption Copy -SourceUri <source managed disk id>
$disk = New-AzureRmDisk -DiskName <disk name> -Disk $diskConfig -ResourceGroupName <resource group name>
$vm = Add-AzureRmVMDataDisk -VM $vm -Caching <caching option> -Lun <lun, for example 0> -CreateOption attach -ManagedDiskId $disk.Id
$vm | Update-AzureRmVM
```
##### <a name="cli-20"></a><span data-ttu-id="17c39-905">CLI 2.0</span><span class="sxs-lookup"><span data-stu-id="17c39-905">CLI 2.0</span></span>
```

# attach a vhd to a vm
az vm unmanaged-disk attach --resource-group <resource group name> --vm-name <vm name> --vhd-uri <path to vhd>

# attach a managed disk to a vm
az vm disk attach --resource-group <resource group name> --vm-name <vm name> --disk <managed disk id>

# attach a copy of the vhd to a vm
# this scenario is currently not possible with Azure CLI. A workaround is to manually copy the vhd to the destination.

# attach a copy of a managed disk to a vm
az disk create --name <new disk name> --resource-group <resource group name> --location <location of target virtual machine> --source <source managed disk id>
az vm disk attach --disk <new disk name or managed disk id> --resource-group <resource group name> --vm-name <vm name> --caching <caching option> --lun <lun, for example 0>
```

#### <span data-ttu-id="17c39-906"><a name="9789b076-2011-4afa-b2fe-b07a8aba58a1"></a>在 Azure 儲存體帳戶之間複製磁碟</span><span class="sxs-lookup"><span data-stu-id="17c39-906"><a name="9789b076-2011-4afa-b2fe-b07a8aba58a1"></a>Copying disks between Azure Storage Accounts</span></span>
<span data-ttu-id="17c39-907">無法在 Azure 入口網站上執行這項工作。</span><span class="sxs-lookup"><span data-stu-id="17c39-907">This task cannot be performed on the Azure portal.</span></span> <span data-ttu-id="17c39-908">您可以使用 Azure PowerShell Cmdlet、Azure CLI 或協力廠商儲存體瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="17c39-908">You can use Azure PowerShell cmdlets, Azure CLI or a third-party storage browser.</span></span> <span data-ttu-id="17c39-909">PowerShell Cmdlet 或 CLI 命令可以建立及管理 Blob，其中包括能夠在 Azure 訂用帳戶內以非同步方式跨「儲存體帳戶」及跨區域複製 Blob。</span><span class="sxs-lookup"><span data-stu-id="17c39-909">The PowerShell cmdlets or CLI commands can create and manage blobs, which include the ability to asynchronously copy blobs across Storage Accounts and across regions within the Azure subscription.</span></span>

##### <a name="powershell"></a><span data-ttu-id="17c39-910">Powershell</span><span class="sxs-lookup"><span data-stu-id="17c39-910">Powershell</span></span>
<span data-ttu-id="17c39-911">您也可以訂用帳戶之間複製 VHD。</span><span class="sxs-lookup"><span data-stu-id="17c39-911">You can also copy VHDs between subscriptions.</span></span> <span data-ttu-id="17c39-912">如需詳細資訊，請參閱[這篇文章][storage-powershell-guide-full-copy-vhd]。</span><span class="sxs-lookup"><span data-stu-id="17c39-912">For more information read [this article][storage-powershell-guide-full-copy-vhd].</span></span>

<span data-ttu-id="17c39-913">PS Cmdlet 邏輯的基本流程如下所示︰</span><span class="sxs-lookup"><span data-stu-id="17c39-913">The basic flow of the PS cmdlet logic looks like this:</span></span>

* <span data-ttu-id="17c39-914">使用 *New-AzureStorageContext* 來建立「來源」儲存體帳戶的儲存體帳戶內容 - 請參閱 <https://msdn.microsoft.com/library/dn806380.aspx></span><span class="sxs-lookup"><span data-stu-id="17c39-914">Create a storage account context for the **source** storage account with *New-AzureStorageContext* - see <https://msdn.microsoft.com/library/dn806380.aspx></span></span>
* <span data-ttu-id="17c39-915">使用 *New-AzureStorageContext* 來建立「目標」儲存體帳戶的儲存體帳戶內容 - 請參閱 <https://msdn.microsoft.com/library/dn806380.aspx></span><span class="sxs-lookup"><span data-stu-id="17c39-915">Create a storage account context for the **target** storage account with *New-AzureStorageContext* - see <https://msdn.microsoft.com/library/dn806380.aspx></span></span>
* <span data-ttu-id="17c39-916">如下開始複製</span><span class="sxs-lookup"><span data-stu-id="17c39-916">Start the copy with</span></span>

```powershell
Start-AzureStorageBlobCopy -SrcBlob <source blob name> -SrcContainer <source container name> -SrcContext <variable containing context of source storage account> -DestBlob <target blob name> -DestContainer <target container name> -DestContext <variable containing context of target storage account>
```

* <span data-ttu-id="17c39-917">如下檢查迴圈中的複製狀態</span><span class="sxs-lookup"><span data-stu-id="17c39-917">Check the status of the copy in a loop with</span></span>

```powershell
Get-AzureStorageBlobCopyState -Blob <target blob name> -Container <target container name> -Context <variable containing context of target storage account>
```

* <span data-ttu-id="17c39-918">如上所述，將新的 VHD 連接到虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="17c39-918">Attach the new VHD to a virtual machine as described above.</span></span>

<span data-ttu-id="17c39-919">如需範例，請參閱[這篇文章][storage-powershell-guide-full-copy-vhd]。</span><span class="sxs-lookup"><span data-stu-id="17c39-919">For examples see [this article][storage-powershell-guide-full-copy-vhd].</span></span>

##### <a name="cli-20"></a><span data-ttu-id="17c39-920">CLI 2.0</span><span class="sxs-lookup"><span data-stu-id="17c39-920">CLI 2.0</span></span>
* <span data-ttu-id="17c39-921">如下開始複製</span><span class="sxs-lookup"><span data-stu-id="17c39-921">Start the copy with</span></span>

```
az storage blob copy start --source-blob <source blob name> --source-container <source container name> --source-account-name <source storage account name> --source-account-key <source storage account key> --destination-container <target container name> --destination-blob <target blob name> --account-name <target storage account name> --account-key <target storage account name>
```

* <span data-ttu-id="17c39-922">如下檢查迴圈中的複製狀態</span><span class="sxs-lookup"><span data-stu-id="17c39-922">Check the status if the copy in a loop with</span></span>

```
az storage blob show --name <target blob name> --container <target container name> --account-name <target storage account name> --account-key <target storage account name>
```

* <span data-ttu-id="17c39-923">如上所述，將新的 VHD 連接到虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="17c39-923">Attach the new VHD to a virtual machine as described above.</span></span>

<span data-ttu-id="17c39-924">如需範例，請參閱[這篇文章][storage-azure-cli-copy-blobs]。</span><span class="sxs-lookup"><span data-stu-id="17c39-924">For examples see [this article][storage-azure-cli-copy-blobs].</span></span>

### <a name="disk-handling"></a><span data-ttu-id="17c39-925">磁碟處理</span><span class="sxs-lookup"><span data-stu-id="17c39-925">Disk Handling</span></span>
#### <span data-ttu-id="17c39-926"><a name="4efec401-91e0-40c0-8e64-f2dceadff646"></a>SAP 部署的 VM/磁碟結構</span><span class="sxs-lookup"><span data-stu-id="17c39-926"><a name="4efec401-91e0-40c0-8e64-f2dceadff646"></a>VM/disk structure for SAP deployments</span></span>
<span data-ttu-id="17c39-927">在理想情況下，VM 及相關聯磁碟的結構處理應該很簡單。</span><span class="sxs-lookup"><span data-stu-id="17c39-927">Ideally the handling of the structure of a VM and the associated disks should be very simple.</span></span> <span data-ttu-id="17c39-928">在內部部署安裝中，客戶開發了許多方法來結構化伺服器安裝。</span><span class="sxs-lookup"><span data-stu-id="17c39-928">In on-premises installations, customers developed many ways of structuring a server installation.</span></span>

* <span data-ttu-id="17c39-929">一個基底磁碟，其中包含作業系統以及 DBMS 及 (或) SAP 的所有二進位檔。</span><span class="sxs-lookup"><span data-stu-id="17c39-929">One base disk which contains the OS and all the binaries of the DBMS and/or SAP.</span></span> <span data-ttu-id="17c39-930">從 2015 年 3 月開始，此磁碟可以有高達 1TB 的大小，而不是先前限制的 127GB 上限。</span><span class="sxs-lookup"><span data-stu-id="17c39-930">Since March 2015, this disk can be up to 1TB in size instead of earlier restrictions that limited it to 127GB.</span></span>
* <span data-ttu-id="17c39-931">一或多個磁碟，其中包含 SAP 資料庫的 DBMS 記錄檔和 DBMS 暫存區的記錄檔 (如果 DBMS 支援)。</span><span class="sxs-lookup"><span data-stu-id="17c39-931">One or multiple disks which contains the DBMS log file of the SAP database and the log file of the DBMS temp storage area (if the DBMS supports this).</span></span> <span data-ttu-id="17c39-932">如果資料庫記錄 IOPS 需求很高，您必須等量劃分多個磁碟的磁碟區，以達到所需的 IOPS 數量。</span><span class="sxs-lookup"><span data-stu-id="17c39-932">If the database log IOPS requirements are high, you need to stripe multiple disks in order to reach the IOPS volume required.</span></span>
* <span data-ttu-id="17c39-933">一些磁碟，其中包含 SAP 資料庫的一或兩個資料庫檔案，也包含 DBMS 暫存資料檔案 (如果 DBMS 支援)。</span><span class="sxs-lookup"><span data-stu-id="17c39-933">A number of disks containing one or two database files of the SAP database and the DBMS temp data files as well (if the DBMS supports this).</span></span>

![適用於 SAP 之 Azure IaaS VM 的參考組態][planning-guide-figure-1300]

[comment]: <> (MShermannd TODO 描述 Linux 結構)

- - -
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-937">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-937">Windows</span></span>
>
> <span data-ttu-id="17c39-938">我們發現在許多客戶的組態中，SAP 和 DBMS 二進位檔並未安裝在 OS 安裝所在的 c:\ 磁碟機中。</span><span class="sxs-lookup"><span data-stu-id="17c39-938">With many customers we saw configurations where, for example, SAP and DBMS binaries were not installed on the c:\ drive where the OS was installed.</span></span> <span data-ttu-id="17c39-939">有各種原因會造成此情況，但回溯至根本原因時，通常是因為 10-15 年前的磁碟機很小，而且 OS 升級需要額外的空間。</span><span class="sxs-lookup"><span data-stu-id="17c39-939">There were various reasons for this, but when we went back to the root, it usually was that the drives were small and OS upgrades needed additional space 10-15 years ago.</span></span> <span data-ttu-id="17c39-940">最近則不太常發生這兩種情況。</span><span class="sxs-lookup"><span data-stu-id="17c39-940">Both conditions do not apply these days too often anymore.</span></span> <span data-ttu-id="17c39-941">今日，c:\ 磁碟機可對應至大量磁碟或 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-941">Today the c:\ drive can be mapped on large volume disks or VMs.</span></span> <span data-ttu-id="17c39-942">為了讓部署的結構保持簡單，建議遵循 Azure 中 SAP NetWeaver 系統的下列部署模式</span><span class="sxs-lookup"><span data-stu-id="17c39-942">In order to keep deployments simple in their structure, it is recommended to follow the following deployment pattern for SAP NetWeaver systems in Azure</span></span>
>
> <span data-ttu-id="17c39-943">Windows 作業系統分頁檔應該在 D: 磁碟機 (非永續性磁碟) 上</span><span class="sxs-lookup"><span data-stu-id="17c39-943">The Windows operating system pagefile should be on the D: drive (non-persistent disk)</span></span>
>
> ![Linux][Logo_Linux] <span data-ttu-id="17c39-945">Linux</span><span class="sxs-lookup"><span data-stu-id="17c39-945">Linux</span></span>
>
> <span data-ttu-id="17c39-946">將 Linux 分頁檔放在 Linux 上的 /mnt /mnt/resource 下，如[這篇文章][virtual-machines-linux-agent-user-guide]所述。</span><span class="sxs-lookup"><span data-stu-id="17c39-946">Place the Linux swapfile under /mnt /mnt/resource on Linux as described in [this article][virtual-machines-linux-agent-user-guide].</span></span> <span data-ttu-id="17c39-947">您可以在 Linux 代理程式 /etc/waagent.conf 的組態檔中設定分頁檔。</span><span class="sxs-lookup"><span data-stu-id="17c39-947">The swap file can be configured in the configuration file of the Linux Agent /etc/waagent.conf.</span></span> <span data-ttu-id="17c39-948">新增或變更下列設定：</span><span class="sxs-lookup"><span data-stu-id="17c39-948">Add or change the following settings:</span></span>
>
>

```
ResourceDisk.EnableSwap=y
ResourceDisk.SwapSizeMB=30720
```

<span data-ttu-id="17c39-949">若要啟用變更，您必須如下重新啟動 Linux 代理程式</span><span class="sxs-lookup"><span data-stu-id="17c39-949">To activate the changes, you need to restart the Linux Agent with</span></span>

```
sudo service waagent restart
```

<span data-ttu-id="17c39-950">如需有關所建議分頁檔大小的更多詳細資料，請參閱 SAP 附註 [1597355]</span><span class="sxs-lookup"><span data-stu-id="17c39-950">Please read SAP Note [1597355] for more details on the recommended swap file size</span></span>

- - -
<span data-ttu-id="17c39-951">用於 DBMS 資料檔案的磁碟數目，以及裝載這些磁碟的 Azure 儲存體類型，應該取決 IOPS 需求和所需的延遲。</span><span class="sxs-lookup"><span data-stu-id="17c39-951">The number of disks used for the DBMS data files and the type of Azure Storage these disks are hosted on should be determined by the IOPS requirements and the latency required.</span></span> <span data-ttu-id="17c39-952">如需確切配額的說明，請參閱[這篇文章 (Linux)][virtual-machines-sizes-linux] 和[這篇文章 (Windows)][virtual-machines-sizes-windows]。</span><span class="sxs-lookup"><span data-stu-id="17c39-952">Exact quotas are described in [this article (Linux)][virtual-machines-sizes-linux] and [this article (Windows)][virtual-machines-sizes-windows].</span></span>

<span data-ttu-id="17c39-953">過去 2 年的 SAP 部署經驗提供一些教訓，摘要如下︰</span><span class="sxs-lookup"><span data-stu-id="17c39-953">Experience of SAP deployments over the last 2 years taught us some lessons which can be summarized as:</span></span>

* <span data-ttu-id="17c39-954">不同資料檔案的 IOPS 流量不一定相同，因為現有的客戶系統可能會有代表其 SAP 資料庫之不同大小的資料檔案。</span><span class="sxs-lookup"><span data-stu-id="17c39-954">IOPS traffic to different data files is not always the same since existing customer systems might have differently sized data files representing their SAP database(s).</span></span> <span data-ttu-id="17c39-955">因此，最好在多個磁碟上使用 RAID 組態，以放置從中切割出的資料檔案 LUN。</span><span class="sxs-lookup"><span data-stu-id="17c39-955">As a result it turned out to be better using a RAID configuration over multiple disks to place the data files LUNs carved out of those.</span></span> <span data-ttu-id="17c39-956">有時 (特別是針對 Azure 標準儲存體) IOPS 速率會達到單一磁碟對 DBMS 交易記錄的配額。</span><span class="sxs-lookup"><span data-stu-id="17c39-956">There were situations, especially with Azure Standard Storage where an IOPS rate hit the quota of a single disk against the DBMS transaction log.</span></span> <span data-ttu-id="17c39-957">在此情況下，建議使用進階儲存體，或是使用軟體 RAID 彙總多個標準儲存體磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-957">In such scenarios the use of Premium Storage is recommended or alternatively aggregating multiple Standard Storage disks with a software RAID.</span></span>

- - -
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-959">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-959">Windows</span></span>
>
> * <span data-ttu-id="17c39-960">[Azure 虛擬機器中的 SQL Server 效能最佳做法][virtual-machines-sql-server-performance-best-practices]</span><span class="sxs-lookup"><span data-stu-id="17c39-960">[Performance best practices for SQL Server in Azure Virtual Machines][virtual-machines-sql-server-performance-best-practices]</span></span>
>
> ![Linux][Logo_Linux] <span data-ttu-id="17c39-962">Linux</span><span class="sxs-lookup"><span data-stu-id="17c39-962">Linux</span></span>
>
> * <span data-ttu-id="17c39-963">[在 Linux 上設定軟體 RAID][virtual-machines-linux-configure-raid]</span><span class="sxs-lookup"><span data-stu-id="17c39-963">[Configure Software RAID on Linux][virtual-machines-linux-configure-raid]</span></span>
> * <span data-ttu-id="17c39-964">[在 Azure 中的 Linux VM 上設定 LVM][virtual-machines-linux-configure-lvm]</span><span class="sxs-lookup"><span data-stu-id="17c39-964">[Configure LVM on a Linux VM in Azure][virtual-machines-linux-configure-lvm]</span></span>
> * [<span data-ttu-id="17c39-965">Azure 儲存體密碼和 Linux I/O 最佳化</span><span class="sxs-lookup"><span data-stu-id="17c39-965">Azure Storage secrets and Linux I/O optimizations</span></span>](http://blogs.msdn.com/b/igorpag/archive/2014/10/23/azure-storage-secrets-and-linux-i-o-optimizations.aspx)
>
>

- - -
* <span data-ttu-id="17c39-966">進階儲存體顯示效能大幅提升，特別是針對重要的交易記錄寫入。</span><span class="sxs-lookup"><span data-stu-id="17c39-966">Premium Storage is showing significant better performance, especially for critical transaction log writes.</span></span> <span data-ttu-id="17c39-967">在必須提供產能的 SAP 案例中 (例如效能)，強烈建議使用可利用 Azure 進階儲存體的 VM 系列。</span><span class="sxs-lookup"><span data-stu-id="17c39-967">For SAP scenarios that are expected to deliver production like performance, it is highly recommended to use VM-Series that can leverage Azure Premium Storage.</span></span>

<span data-ttu-id="17c39-968">請記住，含有作業系統以及建議之 SAP 和資料庫 (基底 VM) 二進位檔的磁碟，已不再限制為 127GB。</span><span class="sxs-lookup"><span data-stu-id="17c39-968">Keep in mind that the disk which contains the OS, and as we recommend, the binaries of SAP and the database (base VM) as well, is not anymore limited to 127GB.</span></span> <span data-ttu-id="17c39-969">它現在可以擁有高達 1TB 的大小。</span><span class="sxs-lookup"><span data-stu-id="17c39-969">It now can have up to 1TB in size.</span></span> <span data-ttu-id="17c39-970">這對於保留所有必要檔案 (包含 SAP 批次工作記錄) 便已足夠。</span><span class="sxs-lookup"><span data-stu-id="17c39-970">This should be enough space to keep all the necessary file including, for example, SAP batch job logs.</span></span>

<span data-ttu-id="17c39-971">如需其他建議和詳細資料 (特別是針對 DBMS VM)，請參閱 [DBMS 部署指南][dbms-guide]</span><span class="sxs-lookup"><span data-stu-id="17c39-971">For more suggestions and more details, specifically for DBMS VMs, please consult the [DBMS Deployment Guide][dbms-guide]</span></span>

#### <a name="disk-handling"></a><span data-ttu-id="17c39-972">磁碟處理</span><span class="sxs-lookup"><span data-stu-id="17c39-972">Disk Handling</span></span>
<span data-ttu-id="17c39-973">在大多數情況下，您必須建立額外的磁碟，才能將 SAP 資料庫部署到 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-973">In most scenarios you need to create additional disks in order to deploy the SAP database into the VM.</span></span> <span data-ttu-id="17c39-974">在本文件的 [SAP 部署的 VM/磁碟結構][planning-guide-5.5.1]一章中，我們已談到磁碟數目的考量。</span><span class="sxs-lookup"><span data-stu-id="17c39-974">We talked about the considerations on number of disks in chapter [VM/disk structure for SAP deployments][planning-guide-5.5.1] of this document.</span></span> <span data-ttu-id="17c39-975">Azure 入口網站允許在部署基底 VM 之後連接及中斷連接磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-975">The Azure portal allows to attach and detach disks once a base VM is deployed.</span></span> <span data-ttu-id="17c39-976">您可以在啟動及執行 VM 時，以及在停止 VM 時，連接/中斷連接磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-976">The disks can be attached/detached when the VM is up and running as well as when it is stopped.</span></span> <span data-ttu-id="17c39-977">連接磁碟時，Azure 入口網站可連接空的磁碟，或連接目前未連接到其他 VM 的現有磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-977">When attaching a disk, the Azure portal offers to attach an empty disk or an existing disk which at this point in time is not attached to another VM.</span></span>

<span data-ttu-id="17c39-978">**注意**：磁碟在任何指定的時間都只能連接到一個 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-978">**Note**: Disks can only be attached to one VM at any given time.</span></span>

![連接/中斷連接 Azure 標準儲存體的磁碟][planning-guide-figure-1400]

<span data-ttu-id="17c39-980">部署新虛擬機器時，您可以決定要使用受控磁碟或將磁碟放在 Azure 儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-980">During the deployment of a new virtual machine, you can decide whether you want to use Managed Disks or place your disks on Azure Storage Accounts.</span></span> <span data-ttu-id="17c39-981">如果您想要使用進階儲存體，建議使用受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-981">If you want to use Premium Storage, we recommend using Managed Disks.</span></span>

<span data-ttu-id="17c39-982">接著，您必須決定要建立新的空白磁碟，還是要選取稍早上傳且現在應該連接到 VM 的現有磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-982">Next, you need to decide whether you want to create a new and empty disk or whether you want to select an existing disk that was uploaded earlier and should be attached to the VM now.</span></span>

<span data-ttu-id="17c39-983">**重要**︰建議您**不要**搭配「Azure 標準儲存體」使用「主機快取」。</span><span class="sxs-lookup"><span data-stu-id="17c39-983">**IMPORTANT**: You **DO NOT** want to use Host Caching with Azure Standard Storage.</span></span> <span data-ttu-id="17c39-984">您應該保留 [主機快取] 喜好設定的預設值 [無]。</span><span class="sxs-lookup"><span data-stu-id="17c39-984">You should leave the Host Cache preference at the default of NONE.</span></span> <span data-ttu-id="17c39-985">使用 Azure 進階儲存體時，如果 I/O 特性大部分會讀取為類似對資料庫資料檔案的一般 I/O 流量，則應該啟用 [讀取快取]。</span><span class="sxs-lookup"><span data-stu-id="17c39-985">With Azure Premium Storage you should enable Read Caching if the I/O characteristic is mostly read like typical I/O traffic against database data files.</span></span> <span data-ttu-id="17c39-986">在資料庫交易記錄檔中，不建議使用快取。</span><span class="sxs-lookup"><span data-stu-id="17c39-986">In case of database transaction log file no caching is recommended.</span></span>

- - -
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-988">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-988">Windows</span></span>
>
> <span data-ttu-id="17c39-989">[如何在 Azure 入口網站中連接資料磁碟][virtual-machines-linux-attach-disk-portal]</span><span class="sxs-lookup"><span data-stu-id="17c39-989">[How to attach a data disk in the Azure portal][virtual-machines-linux-attach-disk-portal]</span></span>
>
> <span data-ttu-id="17c39-990">如果已連接磁碟，您必須登入 VM 來開啟 Windows 磁碟管理員。</span><span class="sxs-lookup"><span data-stu-id="17c39-990">If disks are attached, you need to log in to the VM to open the Windows Disk Manager.</span></span> <span data-ttu-id="17c39-991">如果未依照[為連接的磁碟設定自動掛接][planning-guide-5.5.3]一章所建議來啟用自動掛接，就必須使新連接的磁碟區上線並初始化。</span><span class="sxs-lookup"><span data-stu-id="17c39-991">If automount is not enabled as recommended in chapter [Setting automount for attached disks][planning-guide-5.5.3], the newly attached volume needs to be taken online and initialized.</span></span>
>
> ![Linux][Logo_Linux] <span data-ttu-id="17c39-993">Linux</span><span class="sxs-lookup"><span data-stu-id="17c39-993">Linux</span></span>
>
> <span data-ttu-id="17c39-994">如果已連接磁碟，您必須登入 VM 並將磁碟初始化，如[這篇文章][virtual-machines-linux-how-to-attach-disk-how-to-initialize-a-new-data-disk-in-linux]所述</span><span class="sxs-lookup"><span data-stu-id="17c39-994">If disks are attached, you need to log in to the VM and initialize the disks as described in [this article][virtual-machines-linux-how-to-attach-disk-how-to-initialize-a-new-data-disk-in-linux]</span></span>
>
>

- - -
<span data-ttu-id="17c39-995">如果新磁碟是空的磁碟，您也必須格式化磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-995">If the new disk is an empty disk, you need to format the disk as well.</span></span> <span data-ttu-id="17c39-996">格式化時，特別是針對 DBMS 資料和記錄檔，也適用對 DBMS 裸機部署的相同建議。</span><span class="sxs-lookup"><span data-stu-id="17c39-996">For formatting, especially for DBMS data and log files the same recommendations as for bare-metal deployments of the DBMS apply.</span></span>

<span data-ttu-id="17c39-997">如 [Microsoft Azure 虛擬機器概念][planning-guide-3.2]一章已經提到的，Azure 儲存體帳戶就 I/O 量、IOPS 及資料量而言，不會提供無限的資源。</span><span class="sxs-lookup"><span data-stu-id="17c39-997">As already mentioned in chapter [The Microsoft Azure Virtual Machine Concept][planning-guide-3.2], an Azure Storage account does not provide infinite resources in terms of I/O volume, IOPS and data volume.</span></span> <span data-ttu-id="17c39-998">這點對 DBMS VM 的影響通常最大。</span><span class="sxs-lookup"><span data-stu-id="17c39-998">Usually DBMS VMs are most affected by this.</span></span> <span data-ttu-id="17c39-999">如果您要部署之高 I/O 磁碟區的 VM 很少，最好針對每個 VM 使用個別的儲存體帳戶，以便維持在 Azure 儲存體帳戶磁碟區的限制內。</span><span class="sxs-lookup"><span data-stu-id="17c39-999">It might be best to use a separate Storage Account for each VM if you have few high I/O volume VMs to deploy in order to stay within the limit of the Azure Storage Account volume.</span></span> <span data-ttu-id="17c39-1000">否則，您必須了解如何在不達到每個儲存體帳戶限制的情況下，於不同的儲存體帳戶之間平衡這些 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-1000">Otherwise, you need to see how you can balance these VMs between different Storage accounts without hitting the limit of each single Storage Account.</span></span> <span data-ttu-id="17c39-1001">如需更多詳細的討論，請參閱 [DBMS 部署指南][dbms-guide]。</span><span class="sxs-lookup"><span data-stu-id="17c39-1001">More details are discussed in the [DBMS Deployment Guide][dbms-guide].</span></span> <span data-ttu-id="17c39-1002">針對完全使用 SAP 應用程式伺服器 VM，或最後可能需要更多 VHD 的其他 VM，您也應該記住這些限制。</span><span class="sxs-lookup"><span data-stu-id="17c39-1002">You should also keep these limitations in mind for pure SAP application server VMs or other VMs which eventually might require additional VHDs.</span></span> <span data-ttu-id="17c39-1003">如果您使用受控磁碟，並不適用這些限制。</span><span class="sxs-lookup"><span data-stu-id="17c39-1003">These restrictions do not apply if you use Managed Disk.</span></span> <span data-ttu-id="17c39-1004">如果您打算使用進階儲存體，建議使用受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-1004">If you plan to use Premium Storage, we recommend using Managed Disk.</span></span>

<span data-ttu-id="17c39-1005">另一個與「儲存體帳戶」相關的主題為：是否要對「儲存體帳戶」中的 VHD 進行異地複寫。</span><span class="sxs-lookup"><span data-stu-id="17c39-1005">Another topic which is relevant for Storage Accounts is whether the VHDs in a Storage Account are getting Geo-replicated.</span></span> <span data-ttu-id="17c39-1006">[異地複寫] 會在在儲存體帳戶層級 (而不是 VM 層級) 啟用或停用。</span><span class="sxs-lookup"><span data-stu-id="17c39-1006">Geo-replication is enabled or disabled on the Storage Account level and not on the VM level.</span></span> <span data-ttu-id="17c39-1007">如果啟用 [異地複寫]，則會將儲存體帳戶中的 VHD 複寫至相同區域中的其他 Azure 資料中心。</span><span class="sxs-lookup"><span data-stu-id="17c39-1007">If geo-replication is enabled, the VHDs within the Storage Account would be replicated into another Azure data center within the same region.</span></span> <span data-ttu-id="17c39-1008">在做這個決定之前，您應該考慮下列限制︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1008">Before deciding on this, you should think about the following restriction:</span></span>

<span data-ttu-id="17c39-1009">Azure 異地複寫可在 VM 中的每個 VHD 上本機運作，而且不會依時間先後順序在 VM 中的多個 VHD 之間複寫 IO。</span><span class="sxs-lookup"><span data-stu-id="17c39-1009">Azure Geo-replication works locally on each VHD in a VM and does not replicate the IOs in chronological order across multiple VHDs in a VM.</span></span> <span data-ttu-id="17c39-1010">因此，代表基底 VM 的 VHD 和連接到 VM 的任何其他 VHD 會彼此獨立複寫。</span><span class="sxs-lookup"><span data-stu-id="17c39-1010">Therefore, the VHD that represents the base VM as well as any additional VHDs attached to the VM are replicated independent of each other.</span></span> <span data-ttu-id="17c39-1011">這表示不會同步處理不同 VHD 的變更。</span><span class="sxs-lookup"><span data-stu-id="17c39-1011">This means there is no synchronization between the changes in the different VHDs.</span></span> <span data-ttu-id="17c39-1012">由於複寫 IO 的順序與寫入的順序無關，這表示異地複寫的值不是針對其資料庫已分散至多個 VHD 的資料庫伺服器。</span><span class="sxs-lookup"><span data-stu-id="17c39-1012">The fact that the IOs are replicated independently of the order in which they are written means that geo-replication is not of value for database servers that have their databases distributed over multiple VHDs.</span></span> <span data-ttu-id="17c39-1013">除了 DBMS 之外，也可能會有其他應用程式，其中的處理序會在不同的 VHD 中寫入或處理資料，而且必須保持變更順序。</span><span class="sxs-lookup"><span data-stu-id="17c39-1013">In addition to the DBMS, there also might be other applications where processes write or manipulate data in different VHDs and where it is important to keep the order of changes.</span></span> <span data-ttu-id="17c39-1014">如果這是必要條件，則不應該在 Azure 中啟用 [異地複寫]。</span><span class="sxs-lookup"><span data-stu-id="17c39-1014">If that is a requirement, geo-replication in Azure should not be enabled.</span></span> <span data-ttu-id="17c39-1015">根據您是否需要或想要對一組 VM 進行異地複寫，但不對另一組進行異地複寫，您可能已將 VM 及其相關的 VHD 分類到已啟用或停用 [異地複寫] 的不同儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-1015">Dependent on whether you need or want geo-replication for a set of VMs, but not for another set, you can already categorize VMs and their related VHDs into different Storage Accounts that have geo-replication enabled or disabled.</span></span>

#### <span data-ttu-id="17c39-1016"><a name="17e0d543-7e8c-4160-a7da-dd7117a1ad9d"></a>為連接的磁碟設定自動掛接</span><span class="sxs-lookup"><span data-stu-id="17c39-1016"><a name="17e0d543-7e8c-4160-a7da-dd7117a1ad9d"></a>Setting automount for attached disks</span></span>
- - -
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-1018">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-1018">Windows</span></span>
>
> <span data-ttu-id="17c39-1019">針對從自己的映像或磁碟建立的 VM，您必須檢查並可能設定自動掛接參數。</span><span class="sxs-lookup"><span data-stu-id="17c39-1019">For VMs which are created from own Images or Disks, it is necessary to check and possibly set the automount parameter.</span></span> <span data-ttu-id="17c39-1020">設定此參數可讓 VM 在 Azure 中重新啟動或重新部署之後，自動重新掛接已連接/掛接的磁碟機。</span><span class="sxs-lookup"><span data-stu-id="17c39-1020">Setting this parameter will allow the VM after a restart or redeployment in Azure to mount the attached/mounted drives again automatically.</span></span>
> <span data-ttu-id="17c39-1021">此參數會針對 Microsoft 在 Azure Marketplace 中提供的映像設定。</span><span class="sxs-lookup"><span data-stu-id="17c39-1021">The parameter is set for the images provided by Microsoft in the Azure Marketplace.</span></span>
>
> <span data-ttu-id="17c39-1022">若要設定自動掛接，請參閱命令列可執行檔 diskpart.exe 的文件︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1022">In order to set the automount, please check the documentation of the command-line executable diskpart.exe here:</span></span>
>
> * [<span data-ttu-id="17c39-1023">DiskPart 命令列選項</span><span class="sxs-lookup"><span data-stu-id="17c39-1023">DiskPart Command-Line Options</span></span>](https://technet.microsoft.com/library/bb490893.aspx)
> * [<span data-ttu-id="17c39-1024">Automount (自動掛接)</span><span class="sxs-lookup"><span data-stu-id="17c39-1024">Automount</span></span>](http://technet.microsoft.com/library/cc753703.aspx)
>
> <span data-ttu-id="17c39-1025">您應該以系統管理員身分開啟 Windows 命令列視窗。</span><span class="sxs-lookup"><span data-stu-id="17c39-1025">The Windows command-line window should be opened as administrator.</span></span>
>
> <span data-ttu-id="17c39-1026">如果已連接磁碟，您必須登入 VM 來開啟 Windows 磁碟管理員。</span><span class="sxs-lookup"><span data-stu-id="17c39-1026">If disks are attached, you need to log in to the VM to open the Windows Disk Manager.</span></span> <span data-ttu-id="17c39-1027">如果未依照[為連接的磁碟設定自動掛接][planning-guide-5.5.3]一章所建議來啟用自動掛接，就必須使新連接的磁碟區上線並初始化。</span><span class="sxs-lookup"><span data-stu-id="17c39-1027">If automount is not enabled as recommended in chapter [Setting automount for attached disks][planning-guide-5.5.3],  the newly attached volume >needs to be taken online and initialized.</span></span>
>
> ![Linux][Logo_Linux] <span data-ttu-id="17c39-1029">Linux</span><span class="sxs-lookup"><span data-stu-id="17c39-1029">Linux</span></span>
>
> <span data-ttu-id="17c39-1030">您必須將新連接的空磁碟初始化，如[這篇文章][virtual-machines-linux-how-to-attach-disk-how-to-initialize-a-new-data-disk-in-linux]所述。</span><span class="sxs-lookup"><span data-stu-id="17c39-1030">You need to initialize a newly attached empty disk as described in [this article][virtual-machines-linux-how-to-attach-disk-how-to-initialize-a-new-data-disk-in-linux].</span></span>
> <span data-ttu-id="17c39-1031">您也必須將新磁碟加入 /etc/fstab。</span><span class="sxs-lookup"><span data-stu-id="17c39-1031">You also need to add new disks to the /etc/fstab.</span></span>
>
>

- - -
### <a name="final-deployment"></a><span data-ttu-id="17c39-1032">最終部署</span><span class="sxs-lookup"><span data-stu-id="17c39-1032">Final Deployment</span></span>
<span data-ttu-id="17c39-1033">如需最終的部署和確切的步驟 (特別是與部署「SAP 延伸監視」相關的步驟)，請參閱[部署指南][deployment-guide]。</span><span class="sxs-lookup"><span data-stu-id="17c39-1033">For the final deployment and exact steps, especially with regards to the deployment of SAP Extended Monitoring, please refer to the [Deployment Guide][deployment-guide].</span></span>

## <a name="accessing-sap-systems-running-within-azure-vms"></a><span data-ttu-id="17c39-1034">存取在 Azure VM 中執行的 SAP 系統</span><span class="sxs-lookup"><span data-stu-id="17c39-1034">Accessing SAP systems running within Azure VMs</span></span>
<span data-ttu-id="17c39-1035">在僅限雲端案例中，您可能需要使用 SAP GUI 連線到公用網際網路上的這些 SAP 系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-1035">For Cloud-Only scenarios, you might want to connect to those SAP systems across the public internet using SAP GUI.</span></span> <span data-ttu-id="17c39-1036">在這些情況下，您必須套用下列程序。</span><span class="sxs-lookup"><span data-stu-id="17c39-1036">For these cases, the following procedures need to be applied.</span></span>

<span data-ttu-id="17c39-1037">本文稍後將討論其他主要案例，這些案例會連線到在內部部署系統和 Azure 系統之間具有站對站連線 (VPN 通道) 或 ExpressRoute 連線之跨單位部署中的 SAP 系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-1037">Later in the document we will discuss the other major scenario, connecting to SAP systems in cross-premises deployments which have a site-to-site connection (VPN tunnel) or Azure ExpressRoute connection between the on-premises systems and Azure systems.</span></span>

### <a name="remote-access-to-sap-systems"></a><span data-ttu-id="17c39-1038">遠端存取 SAP 系統</span><span class="sxs-lookup"><span data-stu-id="17c39-1038">Remote Access to SAP systems</span></span>
<span data-ttu-id="17c39-1039">使用 Azure Resource Manager 時，不再有類似先前傳統模型中的預設端點。</span><span class="sxs-lookup"><span data-stu-id="17c39-1039">With Azure Resource Manager there are no default endpoints anymore like in the former classic model.</span></span> <span data-ttu-id="17c39-1040">只要符合下列情況，就可以開啟 Azure ARM VM 的所有連接埠︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1040">All ports of an Azure ARM VM are open as long as:</span></span>

1. <span data-ttu-id="17c39-1041">未針對子網路或網路介面定義網路安全性群組。</span><span class="sxs-lookup"><span data-stu-id="17c39-1041">No Network Security Group is defined for the subnet or the network interface.</span></span> <span data-ttu-id="17c39-1042">可透過所謂的「網路安全性群組」來保護 Azure VM 的網路流量。</span><span class="sxs-lookup"><span data-stu-id="17c39-1042">Network traffic to Azure VMs can be secured via so-called "Network Security Groups".</span></span> <span data-ttu-id="17c39-1043">如需詳細資訊，請參閱[什麼是網路安全性群組 (NSG)？][virtual-networks-nsg]</span><span class="sxs-lookup"><span data-stu-id="17c39-1043">For more information see [What is a Network Security Group (NSG)?][virtual-networks-nsg]</span></span>
2. <span data-ttu-id="17c39-1044">未針對網路介面定義 Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="17c39-1044">No Azure Load Balancer is defined for the network interface</span></span>   

<span data-ttu-id="17c39-1045">請參閱[這篇文章][virtual-machines-azure-resource-manager-architecture]所述之傳統模型與 ARM 之間的架構差異。</span><span class="sxs-lookup"><span data-stu-id="17c39-1045">See the architecture difference between classic model and ARM as described in [this article][virtual-machines-azure-resource-manager-architecture].</span></span>

#### <a name="configuration-of-the-sap-system-and-sap-gui-connectivity-for-cloud-only-scenario"></a><span data-ttu-id="17c39-1046">在僅限雲端案例中，設定 SAP 系統和 SAP GUI 連線能力</span><span class="sxs-lookup"><span data-stu-id="17c39-1046">Configuration of the SAP System and SAP GUI connectivity for Cloud-Only scenario</span></span>
<span data-ttu-id="17c39-1047">請參閱下列文章，其中對此主題有詳細的說明︰<http://blogs.msdn.com/b/saponsqlserver/archive/2014/06/24/sap-gui-connection-closed-when-connecting-to-sap-system-in-azure.aspx></span><span class="sxs-lookup"><span data-stu-id="17c39-1047">Please see this article which describes details to this topic: <http://blogs.msdn.com/b/saponsqlserver/archive/2014/06/24/sap-gui-connection-closed-when-connecting-to-sap-system-in-azure.aspx></span></span>

#### <a name="changing-firewall-settings-within-vm"></a><span data-ttu-id="17c39-1048">變更 VM 中的防火牆設定</span><span class="sxs-lookup"><span data-stu-id="17c39-1048">Changing Firewall Settings within VM</span></span>
<span data-ttu-id="17c39-1049">您可能必須在虛擬機器上設定防火牆，以允許 SAP 系統的輸入流量。</span><span class="sxs-lookup"><span data-stu-id="17c39-1049">It might be necessary to configure the firewall on your virtual machines to allow inbound traffic to your SAP system.</span></span>

- - -
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-1051">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-1051">Windows</span></span>
>
> <span data-ttu-id="17c39-1052">預設會開啟 Azure 所部署之 VM 中的 Windows 防火牆。</span><span class="sxs-lookup"><span data-stu-id="17c39-1052">By default, the Windows Firewall within an Azure deployed VM is turned on.</span></span> <span data-ttu-id="17c39-1053">您現在必須允許開啟 SAP 連接埠，否則 SAP GUI 將無法連線。</span><span class="sxs-lookup"><span data-stu-id="17c39-1053">You now need to allow the SAP Port to be opened, otherwise the SAP GUI will not be able to connect.</span></span>
> <span data-ttu-id="17c39-1054">作法：</span><span class="sxs-lookup"><span data-stu-id="17c39-1054">To do this:</span></span>
>
> * <span data-ttu-id="17c39-1055">將 [控制台]\[系統及安全性]\[Windows 防火牆] 開啟至 [進階設定]。</span><span class="sxs-lookup"><span data-stu-id="17c39-1055">Open Control Panel\System and Security\Windows Firewall to ‘Advanced Settings’.</span></span>
> * <span data-ttu-id="17c39-1056">現在以滑鼠右鍵按一下 [輸入規則]，然後選擇 [新增規則]。</span><span class="sxs-lookup"><span data-stu-id="17c39-1056">Now right-click on Inbound Rules and chose ‘New Rule’.</span></span>
> * <span data-ttu-id="17c39-1057">在下列精靈中，選擇建立新的「連接埠」規則。</span><span class="sxs-lookup"><span data-stu-id="17c39-1057">In the following Wizard chose to create a new ‘Port’ rule.</span></span>
> * <span data-ttu-id="17c39-1058">在精靈的下一個步驟中，保留 [TCP] 設定，然後輸入您要開啟的連接埠號碼。</span><span class="sxs-lookup"><span data-stu-id="17c39-1058">In the next step of the wizard, leave the setting at TCP and type in the port number you want to open.</span></span> <span data-ttu-id="17c39-1059">因為我們的 SAP 執行個體 ID 為 00，所以我們採用 3200。</span><span class="sxs-lookup"><span data-stu-id="17c39-1059">Since our SAP instance ID is 00, we took 3200.</span></span> <span data-ttu-id="17c39-1060">如果您的執行個體有不同的執行個體號碼，則會開啟稍早依據此執行個體號碼所定義的連接埠。</span><span class="sxs-lookup"><span data-stu-id="17c39-1060">If your instance has a different instance number, the port you defined earlier based on the instance number should be opened.</span></span>
> * <span data-ttu-id="17c39-1061">在精靈的下一個部分，您必須保持核取 [允許連線] 項目。</span><span class="sxs-lookup"><span data-stu-id="17c39-1061">In the next part of the wizard, you need to leave the item ‘Allow Connection’ checked.</span></span>
> * <span data-ttu-id="17c39-1062">在精靈的下一個步驟中，您必須定義是否會針對網域、私人和公用網路套用此規則。</span><span class="sxs-lookup"><span data-stu-id="17c39-1062">In the next step of the wizard you need to define whether the rule applies for Domain, Private and Public network.</span></span> <span data-ttu-id="17c39-1063">請視需要進行調整。</span><span class="sxs-lookup"><span data-stu-id="17c39-1063">Please adjust it if necessary to your needs.</span></span> <span data-ttu-id="17c39-1064">不過，透過公用網路從外部連線到 SAP GUI 時，您必須將規則套用至公用網路。</span><span class="sxs-lookup"><span data-stu-id="17c39-1064">However, connecting with SAP GUI from the outside through the public network, you need to have the rule applied to the public network.</span></span>
> * <span data-ttu-id="17c39-1065">在精靈的最後一個步驟中，為規則命名，然後按 [完成] 來儲存</span><span class="sxs-lookup"><span data-stu-id="17c39-1065">In the last step of the wizard, name the rule and save by pressing ‘Finish’</span></span>
>
> <span data-ttu-id="17c39-1066">此規則會立即生效。</span><span class="sxs-lookup"><span data-stu-id="17c39-1066">The rule becomes effective immediately.</span></span>
>
> ![連接埠規則定義][planning-guide-figure-1600]
>
> ![Linux][Logo_Linux] <span data-ttu-id="17c39-1069">Linux</span><span class="sxs-lookup"><span data-stu-id="17c39-1069">Linux</span></span>
>
> <span data-ttu-id="17c39-1070">Azure Marketplace 中的 Linux 映像預設不會啟用 iptables 防火牆，而 SAP 系統的連線應該會運作正常。</span><span class="sxs-lookup"><span data-stu-id="17c39-1070">The Linux images in the Azure Marketplace do not enable the iptables firewall by default and the connection to your SAP system should work.</span></span> <span data-ttu-id="17c39-1071">如果啟用 iptables 或其他防火牆，請參閱 iptables 或所使用之防火牆的文件，來允許連接埠 32xx 的輸入 TCP 流量 (其中 xx 是 SAP 系統的系統編號)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1071">If you enabled iptables or another firewall, please refer to the documentation of iptables or the used firewall to allow inbound tcp traffic to  port 32xx (where xx is the system number of your SAP system).</span></span>
>
>

- - -
#### <a name="security-recommendations"></a><span data-ttu-id="17c39-1072">安全性建議</span><span class="sxs-lookup"><span data-stu-id="17c39-1072">Security recommendations</span></span>
<span data-ttu-id="17c39-1073">SAP GUI 不會立即連線到執行中的任何 SAP 執行個體 (連接埠 32xx)，而是先透過已開啟的連接埠連線到 SAP 訊息伺服器處理序 (連接埠 36xx)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1073">The SAP GUI does not connect immediately to any of the SAP instances (port 32xx) which are running, but first connects via the port opened to the SAP message server process (port 36xx).</span></span> <span data-ttu-id="17c39-1074">在過去，訊息伺服器會使用相同的連接埠，來對應用程式執行個體進行內部通訊。</span><span class="sxs-lookup"><span data-stu-id="17c39-1074">In the past the very same port was used by the message server for the internal communication to the application instances.</span></span> <span data-ttu-id="17c39-1075">為了防止內部部署應用程式伺服器不慎與 Azure 中的訊息伺服器通訊，您可以變更內部通訊連接埠。</span><span class="sxs-lookup"><span data-stu-id="17c39-1075">To prevent on-premises application servers from inadvertently communicating with a message server in Azure the internal communication ports can be changed.</span></span> <span data-ttu-id="17c39-1076">強烈建議在已從內部部署系統複製的系統上 (例如專案測試等部署的複製)，將 SAP 訊息伺服器與其應用程式執行個體之間的內部通訊，變更為不同的連接埠號碼。您可以使用預設設定檔參數來完成此動作：</span><span class="sxs-lookup"><span data-stu-id="17c39-1076">It is highly recommended to change the internal communication between the SAP message server and its application instances to a different port number on systems that have been cloned from on-premises systems, such as a clone of development for project testing etc. This can be done with the default profile parameter:</span></span>

> <span data-ttu-id="17c39-1077">rdisp/msserv_internal</span><span class="sxs-lookup"><span data-stu-id="17c39-1077">rdisp/msserv_internal</span></span>
>
>

<span data-ttu-id="17c39-1078">如 [SAP 訊息伺服器的安全性設定](https://help.sap.com/saphelp_nwpi71/helpdata/en/47/c56a6938fb2d65e10000000a42189c/content.htm)中所述</span><span class="sxs-lookup"><span data-stu-id="17c39-1078">as documented in [Security Settings for the SAP Message Server ](https://help.sap.com/saphelp_nwpi71/helpdata/en/47/c56a6938fb2d65e10000000a42189c/content.htm)</span></span>

## <span data-ttu-id="17c39-1079"><a name="96a77628-a05e-475d-9df3-fb82217e8f14"></a>SAP 執行個體的僅限雲端部署概念</span><span class="sxs-lookup"><span data-stu-id="17c39-1079"><a name="96a77628-a05e-475d-9df3-fb82217e8f14"></a>Concepts of Cloud-Only deployment of SAP instances</span></span>
### <span data-ttu-id="17c39-1080"><a name="3e9c3690-da67-421a-bc3f-12c520d99a30"></a>搭配 SAP NetWeaver 示範/訓練案例的單一 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-1080"><a name="3e9c3690-da67-421a-bc3f-12c520d99a30"></a>Single VM with SAP NetWeaver demo/training scenario</span></span>
![在 Azure 雲端服務中以隔離方式執行具有相同 VM 名稱的單一 VM SAP 示範系統][planning-guide-figure-1700]

<span data-ttu-id="17c39-1082">在此案例中 (請參閱本文件的[僅限雲端][planning-guide-2.1]一章)，我們將實作一個典型的訓練/示範系統案例，其中完整的訓練/示範案例會包含在單一 VM 中。</span><span class="sxs-lookup"><span data-stu-id="17c39-1082">In this scenario (see chapter [Cloud-Only][planning-guide-2.1] of this document) we are implementing a typical training/demo system scenario where the complete training/demo scenario is contained in a single VM.</span></span> <span data-ttu-id="17c39-1083">我們假設部署是透過 VM 映像範本完成。</span><span class="sxs-lookup"><span data-stu-id="17c39-1083">We assume that the deployment is done through VM image templates.</span></span> <span data-ttu-id="17c39-1084">此外，也假設其中多個示範/訓練 VM 必須使用具有相同名稱的 VM 進行部署。</span><span class="sxs-lookup"><span data-stu-id="17c39-1084">We also assume that multiple of these demo/trainings VMs need to be deployed with the VMs having the same name.</span></span>

<span data-ttu-id="17c39-1085">這裡假設您已如本文件中[使用適用於 Azure 的 SAP 準備 VM][planning-guide-5.2] 一章的某些小節所述建立 VM 映像。</span><span class="sxs-lookup"><span data-stu-id="17c39-1085">The assumption is that you created a VM Image as described in some sections of chapter [Preparing VMs with SAP for Azure][planning-guide-5.2] in this document.</span></span>

<span data-ttu-id="17c39-1086">實作案例的事件順序如下所示︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1086">The sequence of events to implement the scenario looks like this:</span></span>

##### <a name="powershell"></a><span data-ttu-id="17c39-1087">Powershell</span><span class="sxs-lookup"><span data-stu-id="17c39-1087">Powershell</span></span>
* <span data-ttu-id="17c39-1088">為每個訓練/示範環境建立新的資源群組</span><span class="sxs-lookup"><span data-stu-id="17c39-1088">Create a new resource group for every training/demo landscape</span></span>

```powershell
$rgName = "SAPERPDemo1"
New-AzureRmResourceGroup -Name $rgName -Location "North Europe"
```
* <span data-ttu-id="17c39-1089">如果您不想要使用受控磁碟，請建立新的儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="17c39-1089">Create a new storage account if you don't want to use Managed Disks</span></span>

```powershell
$suffix = Get-Random -Minimum 100000 -Maximum 999999
$account = New-AzureRmStorageAccount -ResourceGroupName $rgName -Name "saperpdemo$suffix" -SkuName Standard_LRS -Kind "Storage" -Location "North Europe"
```

* <span data-ttu-id="17c39-1090">為每個訓練/示範環境建立新的虛擬網路，以允許使用相同的主機名稱和 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="17c39-1090">Create a new virtual network for every training/demo landscape to enable the usage of the same hostname and IP addresses.</span></span> <span data-ttu-id="17c39-1091">虛擬網路受到網路安全性群組的保護，只允許連接埠 3389 的流量，以針對 SSH 啟用遠端桌面存取和連接埠 22。</span><span class="sxs-lookup"><span data-stu-id="17c39-1091">The virtual network is protected by a Network Security Group that only allows traffic to port 3389 to enable Remote Desktop access and port 22 for SSH.</span></span>

```powershell
# Create a new Virtual Network
$rdpRule = New-AzureRmNetworkSecurityRuleConfig -Name SAPERPDemoNSGRDP -Protocol * -SourcePortRange * -DestinationPortRange 3389 -Access Allow -Direction Inbound -SourceAddressPrefix * -DestinationAddressPrefix * -Priority 100
$sshRule = New-AzureRmNetworkSecurityRuleConfig -Name SAPERPDemoNSGSSH -Protocol * -SourcePortRange * -DestinationPortRange 22 -Access Allow -Direction Inbound -SourceAddressPrefix * -DestinationAddressPrefix * -Priority 101
$nsg = New-AzureRmNetworkSecurityGroup -Name SAPERPDemoNSG -ResourceGroupName $rgName -Location  "North Europe" -SecurityRules $rdpRule,$sshRule

$subnetConfig = New-AzureRmVirtualNetworkSubnetConfig -Name Subnet1 -AddressPrefix  10.0.1.0/24 -NetworkSecurityGroup $nsg
$vnet = New-AzureRmVirtualNetwork -Name SAPERPDemoVNet -ResourceGroupName $rgName -Location "North Europe"  -AddressPrefix 10.0.1.0/24 -Subnet $subnetConfig
```

* <span data-ttu-id="17c39-1092">建立可用來從網際網路存取虛擬機器的新公用 IP 位址</span><span class="sxs-lookup"><span data-stu-id="17c39-1092">Create a new public IP address that can be used to access the virtual machine from the internet</span></span>

```powershell
# Create a public IP address with a DNS name
$pip = New-AzureRmPublicIpAddress -Name SAPERPDemoPIP -ResourceGroupName $rgName -Location "North Europe" -DomainNameLabel $rgName.ToLower() -AllocationMethod Dynamic
```

* <span data-ttu-id="17c39-1093">為虛擬機器建立新的網路介面</span><span class="sxs-lookup"><span data-stu-id="17c39-1093">Create a new network interface for the virtual machine</span></span>

```powershell
# Create a new Network Interface
$nic = New-AzureRmNetworkInterface -Name SAPERPDemoNIC -ResourceGroupName $rgName -Location "North Europe" -Subnet $vnet.Subnets[0] -PublicIpAddress $pip
```

* <span data-ttu-id="17c39-1094">建立虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="17c39-1094">Create a virtual machine.</span></span> <span data-ttu-id="17c39-1095">在僅限雲端案例中，每個 VM 會有相同的名稱。</span><span class="sxs-lookup"><span data-stu-id="17c39-1095">For the Cloud-Only scenario every VM will have the same name.</span></span> <span data-ttu-id="17c39-1096">這些 VM 中的 SAP NetWeaver 執行個體 SAP SID 也會相同。</span><span class="sxs-lookup"><span data-stu-id="17c39-1096">The SAP SID of the SAP NetWeaver instances in those VMs will be the same as well.</span></span> <span data-ttu-id="17c39-1097">在 Azure 資源群組中，VM 的名稱必須是唯一的，但在不同的 Azure 資源群組中，您可以執行具有相同名稱的 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-1097">Within the Azure Resource Group, the name of the VM needs to be unique, but in different Azure Resource Groups you can run VMs with the same name.</span></span> <span data-ttu-id="17c39-1098">Windows 的預設「系統管理員」帳戶和 Linux 的「根」帳戶無效。</span><span class="sxs-lookup"><span data-stu-id="17c39-1098">The default 'Administrator' account of Windows or 'root' for Linux are not valid.</span></span> <span data-ttu-id="17c39-1099">因此，新的系統管理員使用者名稱必須與密碼一起定義。</span><span class="sxs-lookup"><span data-stu-id="17c39-1099">Therefore, a new administrator user name needs to be defined together with a password.</span></span> <span data-ttu-id="17c39-1100">您也必須定義 VM 的大小。</span><span class="sxs-lookup"><span data-stu-id="17c39-1100">The size of the VM also needs to be defined.</span></span>

```powershell
#####
# Create a new virtual machine with an official image from the Azure Marketplace
#####
$cred=Get-Credential -Message "Type the name and password of the local administrator account."
$vmconfig = New-AzureRmVMConfig -VMName SAPERPDemo -VMSize Standard_D11

# select image
$vmconfig = Set-AzureRmVMSourceImage -VM $vmconfig -PublisherName "MicrosoftWindowsServer" -Offer "WindowsServer" -Skus "2012-R2-Datacenter" -Version "latest"
$vmconfig = Set-AzureRmVMOperatingSystem -VM $vmconfig -Windows -ComputerName "SAPERPDemo" -Credential $cred -ProvisionVMAgent -EnableAutoUpdate
# $vmconfig = Set-AzureRmVMSourceImage -VM $vmconfig -PublisherName "SUSE" -Offer "SLES-SAP" -Skus "12-SP1" -Version "latest"
# $vmconfig = Set-AzureRmVMSourceImage -VM $vmconfig -PublisherName "RedHat" -Offer "RHEL" -Skus "7.2" -Version "latest"
# $vmconfig = Set-AzureRmVMSourceImage -VM $vmconfig -PublisherName "Oracle" -Offer "Oracle-Linux" -Skus "7.2" -Version "latest"
# $vmconfig = Set-AzureRmVMOperatingSystem -VM $vmconfig -Linux -ComputerName "SAPERPDemo" -Credential $cred

$vmconfig = Add-AzureRmVMNetworkInterface -VM $vmconfig -Id $nic.Id

$vmconfig = Set-AzureRmVMBootDiagnostics -Disable -VM $vmconfig
$vm = New-AzureRmVM -ResourceGroupName $rgName -Location "North Europe" -VM $vmconfig
```

```powershell
#####
# Create a new virtual machine with a VHD that contains the private image that you want to use
#####
$cred=Get-Credential -Message "Type the name and password of the local administrator account."
$vmconfig = New-AzureRmVMConfig -VMName SAPERPDemo -VMSize Standard_D11

$vmconfig = Add-AzureRmVMNetworkInterface -VM $vmconfig -Id $nic.Id

$diskName="osfromimage"
$osDiskUri=$account.PrimaryEndpoints.Blob.ToString() + "vhds/" + $diskName  + ".vhd"

$vmconfig = Set-AzureRmVMOSDisk -VM $vmconfig -Name $diskName -VhdUri $osDiskUri -CreateOption fromImage -SourceImageUri <path to VHD that contains the OS image> -Windows
$vmconfig = Set-AzureRmVMOperatingSystem -VM $vmconfig -Windows -ComputerName "SAPERPDemo" -Credential $cred
#$vmconfig = Set-AzureRmVMOSDisk -VM $vmconfig -Name $diskName -VhdUri $osDiskUri -CreateOption fromImage -SourceImageUri <path to VHD that contains the OS image> -Linux
#$vmconfig = Set-AzureRmVMOperatingSystem -VM $vmconfig -Linux -ComputerName "SAPERPDemo" -Credential $cred

$vmconfig = Set-AzureRmVMBootDiagnostics -Disable -VM $vmconfig
$vm = New-AzureRmVM -ResourceGroupName $rgName -Location "North Europe" -VM $vmconfig
```

```powershell
#####
# Create a new virtual machine with a Managed Disk Image
#####
$cred=Get-Credential -Message "Type the name and password of the local administrator account."
$vmconfig = New-AzureRmVMConfig -VMName SAPERPDemo -VMSize Standard_D11

$vmconfig = Add-AzureRmVMNetworkInterface -VM $vmconfig -Id $nic.Id

$vmconfig = Set-AzureRmVMSourceImage -VM $vmconfig -Id <Id of Managed Disk Image>
$vmconfig = Set-AzureRmVMOperatingSystem -VM $vmconfig -Windows -ComputerName "SAPERPDemo" -Credential $cred
#$vmconfig = Set-AzureRmVMOperatingSystem -VM $vmconfig -Linux -ComputerName "SAPERPDemo" -Credential $cred

$vmconfig = Set-AzureRmVMBootDiagnostics -Disable -VM $vmconfig
$vm = New-AzureRmVM -ResourceGroupName $rgName -Location "North Europe" -VM $vmconfig
```

* <span data-ttu-id="17c39-1101">選擇性地新增其他磁碟，並還原所需的內容。</span><span class="sxs-lookup"><span data-stu-id="17c39-1101">Optionally add additional disks and restore necessary content.</span></span> <span data-ttu-id="17c39-1102">請注意，所有 Blob 名稱 (Blob 的 URL) 在 Azure 中必須是唯一的。</span><span class="sxs-lookup"><span data-stu-id="17c39-1102">Be aware that all blob names (URLs to the blobs) must be unique within Azure.</span></span>

```powershell
# Optional: Attach additional VHD data disks
$vm = Get-AzureRmVM -ResourceGroupName $rgName -Name SAPERPDemo
$dataDiskUri = $account.PrimaryEndpoints.Blob.ToString() + "vhds/datadisk.vhd"
Add-AzureRmVMDataDisk -VM $vm -Name datadisk -VhdUri $dataDiskUri -DiskSizeInGB 1023 -CreateOption empty | Update-AzureRmVM

# Optional: Attach additional Managed Disks
$vm = Get-AzureRmVM -ResourceGroupName $rgName -Name SAPERPDemo
Add-AzureRmVMDataDisk -VM $vm -Name datadisk -DiskSizeInGB 1023 -CreateOption empty -Lun 0 | Update-AzureRmVM
```

##### <a name="cli"></a><span data-ttu-id="17c39-1103">CLI</span><span class="sxs-lookup"><span data-stu-id="17c39-1103">CLI</span></span>
<span data-ttu-id="17c39-1104">下列範例程式碼可用於 Linux。</span><span class="sxs-lookup"><span data-stu-id="17c39-1104">The following example code can be used on Linux.</span></span> <span data-ttu-id="17c39-1105">若是 Windows，請依上述方式使用 PowerShell，或將範例調整成使用 %rgName% 而不是 $rgName，並使用 Windows 命令 *set*來設定環境變數。</span><span class="sxs-lookup"><span data-stu-id="17c39-1105">For Windows, please either use PowerShell as described above or adapt the example to use %rgName% instead of $rgName and set the environment variable using the Windows command *set*.</span></span>

* <span data-ttu-id="17c39-1106">為每個訓練/示範環境建立新的資源群組</span><span class="sxs-lookup"><span data-stu-id="17c39-1106">Create a new resource group for every training/demo landscape</span></span>

```
rgName=SAPERPDemo1
rgNameLower=saperpdemo1
az group create --name $rgName --location "North Europe"
```

* <span data-ttu-id="17c39-1107">建立新的儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="17c39-1107">Create a new storage account</span></span>

```
az storage account create --resource-group $rgName --location "North Europe" --kind Storage --sku Standard_LRS --name $rgNameLower
```

* <span data-ttu-id="17c39-1108">為每個訓練/示範環境建立新的虛擬網路，以允許使用相同的主機名稱和 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="17c39-1108">Create a new virtual network for every training/demo landscape to enable the usage of the same hostname and IP addresses.</span></span> <span data-ttu-id="17c39-1109">虛擬網路受到網路安全性群組的保護，只允許連接埠 3389 的流量，以針對 SSH 啟用遠端桌面存取和連接埠 22。</span><span class="sxs-lookup"><span data-stu-id="17c39-1109">The virtual network is protected by a Network Security Group that only allows traffic to port 3389 to enable Remote Desktop access and port 22 for SSH.</span></span>

```
az network nsg create --resource-group $rgName --location "North Europe" --name SAPERPDemoNSG
az network nsg rule create --resource-group $rgName --nsg-name SAPERPDemoNSG --name SAPERPDemoNSGRDP --protocol \* --source-address-prefix \* --source-port-range \* --destination-address-prefix \* --destination-port-range 3389 --access Allow --priority 100 --direction Inbound
az network nsg rule create --resource-group $rgName --nsg-name SAPERPDemoNSG --name SAPERPDemoNSGSSH --protocol \* --source-address-prefix \* --source-port-range \* --destination-address-prefix \* --destination-port-range 22 --access Allow --priority 101 --direction Inbound

az network vnet create --resource-group $rgName --name SAPERPDemoVNet --location "North Europe" --address-prefixes 10.0.1.0/24
az network vnet subnet create --resource-group $rgName --vnet-name SAPERPDemoVNet --name Subnet1 --address-prefix 10.0.1.0/24 --network-security-group SAPERPDemoNSG
```

* <span data-ttu-id="17c39-1110">建立可用來從網際網路存取虛擬機器的新公用 IP 位址</span><span class="sxs-lookup"><span data-stu-id="17c39-1110">Create a new public IP address that can be used to access the virtual machine from the internet</span></span>

```
az network public-ip create --resource-group $rgName --name SAPERPDemoPIP --location "North Europe" --dns-name $rgNameLower --allocation-method Dynamic
```

* <span data-ttu-id="17c39-1111">為虛擬機器建立新的網路介面</span><span class="sxs-lookup"><span data-stu-id="17c39-1111">Create a new network interface for the virtual machine</span></span>

```
az network nic create --resource-group $rgName --location "North Europe" --name SAPERPDemoNIC --public-ip-address SAPERPDemoPIP --subnet Subnet1 --vnet-name SAPERPDemoVNet
```

* <span data-ttu-id="17c39-1112">建立虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="17c39-1112">Create a virtual machine.</span></span> <span data-ttu-id="17c39-1113">在僅限雲端案例中，每個 VM 會有相同的名稱。</span><span class="sxs-lookup"><span data-stu-id="17c39-1113">For the Cloud-Only scenario every VM will have the same name.</span></span> <span data-ttu-id="17c39-1114">這些 VM 中的 SAP NetWeaver 執行個體 SAP SID 也會相同。</span><span class="sxs-lookup"><span data-stu-id="17c39-1114">The SAP SID of the SAP NetWeaver instances in those VMs will be the same as well.</span></span> <span data-ttu-id="17c39-1115">在 Azure 資源群組中，VM 的名稱必須是唯一的，但在不同的 Azure 資源群組中，您可以執行具有相同名稱的 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-1115">Within the Azure Resource Group, the name of the VM needs to be unique, but in different Azure Resource Groups you can run VMs with the same name.</span></span> <span data-ttu-id="17c39-1116">Windows 的預設「系統管理員」帳戶和 Linux 的「根」帳戶無效。</span><span class="sxs-lookup"><span data-stu-id="17c39-1116">The default 'Administrator' account of Windows or 'root' for Linux are not valid.</span></span> <span data-ttu-id="17c39-1117">因此，新的系統管理員使用者名稱必須與密碼一起定義。</span><span class="sxs-lookup"><span data-stu-id="17c39-1117">Therefore, a new administrator user name needs to be defined together with a password.</span></span> <span data-ttu-id="17c39-1118">您也必須定義 VM 的大小。</span><span class="sxs-lookup"><span data-stu-id="17c39-1118">The size of the VM also needs to be defined.</span></span>

```
#####
# Create virtual machines using storage accounts
#####
az vm create --resource-group $rgName --location "North Europe" --name SAPERPDemo --nics SAPERPDemoNIC --image MicrosoftWindowsServer:WindowsServer:2012-R2-Datacenter:latest --admin-username <username> --admin-password <password> --size Standard_D11 --use-unmanaged-disk --storage-account $rgNameLower --storage-container-name vhds --os-disk-name os
#az vm create --resource-group $rgName --location "North Europe" --name SAPERPDemo --nics SAPERPDemoNIC --image SUSE:SLES-SAP:12-SP1:latest --admin-username <username> --admin-password <password> --size Standard_D11 --use-unmanaged-disk --storage-account $rgNameLower --storage-container-name vhds --os-disk-name os --authentication-type password
#az vm create --resource-group $rgName --location "North Europe" --name SAPERPDemo --nics SAPERPDemoNIC --image RedHat:RHEL:7.2:latest --admin-username <username> --admin-password <password> --size Standard_D11 --use-unmanaged-disk --storage-account $rgNameLower --storage-container-name vhds --os-disk-name os --authentication-type password
#az vm create --resource-group $rgName --location "North Europe" --name SAPERPDemo --nics SAPERPDemoNIC --image "Oracle:Oracle-Linux:7.2:latest" --admin-username <username> --admin-password <password> --size Standard_D11 --use-unmanaged-disk --storage-account $rgNameLower --storage-container-name vhds --os-disk-name os --authentication-type password

#####
# Create virtual machines using Managed Disks
#####
az vm create --resource-group $rgName --location "North Europe" --name SAPERPDemo --nics SAPERPDemoNIC --image MicrosoftWindowsServer:WindowsServer:2012-R2-Datacenter:latest --admin-username <username> --admin-password <password> --size Standard_DS11_v2 --os-disk-name os
#az vm create --resource-group $rgName --location "North Europe" --name SAPERPDemo --nics SAPERPDemoNIC --image SUSE:SLES-SAP:12-SP1:latest --admin-username <username> --admin-password <password> --size Standard_DS11_v2 --os-disk-name os --authentication-type password
#az vm create --resource-group $rgName --location "North Europe" --name SAPERPDemo --nics SAPERPDemoNIC --image RedHat:RHEL:7.2:latest --admin-username <username> --admin-password <password> --size Standard_DS11_v2 --os-disk-name os --authentication-type password
#az vm create --resource-group $rgName --location "North Europe" --name SAPERPDemo --nics SAPERPDemoNIC --image "Oracle:Oracle-Linux:7.2:latest" --admin-username <username> --admin-password <password> --size Standard_DS11_v2 --os-disk-name os --authentication-type password
```

```
#####
# Create a new virtual machine with a VHD that contains the private image that you want to use
#####
az vm create --resource-group $rgName --location "North Europe" --name SAPERPDemo --nics SAPERPDemoNIC --os-type Windows --admin-username <username> --admin-password <password> --size Standard_D11 --use-unmanaged-disk --storage-account $rgNameLower --storage-container-name vhds --os-disk-name os --image <path to image vhd>
#az vm create --resource-group $rgName --location "North Europe" --name SAPERPDemo --nics SAPERPDemoNIC --os-type Linux --admin-username <username> --admin-password <password> --size Standard_D11 --use-unmanaged-disk --storage-account $rgNameLower --storage-container-name vhds --os-disk-name os --image <path to image vhd> --authentication-type password

#####
# Create a new virtual machine with a Managed Disk Image
#####
az vm create --resource-group $rgName --location "North Europe" --name SAPERPDemo --nics SAPERPDemoNIC --admin-username <username> --admin-password <password> --size Standard_DS11_v2 --os-disk-name os --image <managed disk image id>
#az vm create --resource-group $rgName --location "North Europe" --name SAPERPDemo --nics SAPERPDemoNIC --admin-username <username> --admin-password <password> --size Standard_DS11_v2 --os-disk-name os --image <managed disk image id> --authentication-type password
```

* <span data-ttu-id="17c39-1119">選擇性地新增其他磁碟，並還原所需的內容。</span><span class="sxs-lookup"><span data-stu-id="17c39-1119">Optionally add additional disks and restore necessary content.</span></span> <span data-ttu-id="17c39-1120">請注意，所有 Blob 名稱 (Blob 的 URL) 在 Azure 中必須是唯一的。</span><span class="sxs-lookup"><span data-stu-id="17c39-1120">Be aware that all blob names (URLs to the blobs) must be unique within Azure.</span></span>

```
# Optional: Attach additional VHD data disks
az vm unmanaged-disk attach --resource-group $rgName --vm-name SAPERPDemo --size-gb 1023 --vhd-uri https://$rgNameLower.blob.core.windows.net/vhds/data.vhd  --new

# Optional: Attach additional Managed Disks
az vm disk attach --resource-group $rgName --vm-name SAPERPDemo --size-gb 1023 --disk datadisk --new
```

##### <a name="template"></a><span data-ttu-id="17c39-1121">範本</span><span class="sxs-lookup"><span data-stu-id="17c39-1121">Template</span></span>
<span data-ttu-id="17c39-1122">您可以使用 GitHub 上 azure-quickstart-templates 儲存機制中的範例範本。</span><span class="sxs-lookup"><span data-stu-id="17c39-1122">You can use the sample templates on the azure-quickstart-templates repository on github.</span></span>

* [<span data-ttu-id="17c39-1123">簡單的 Linux VM</span><span class="sxs-lookup"><span data-stu-id="17c39-1123">Simple Linux VM</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/101-vm-simple-linux)
* [<span data-ttu-id="17c39-1124">簡單的 Windows VM</span><span class="sxs-lookup"><span data-stu-id="17c39-1124">Simple Windows VM</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/101-vm-simple-windows)
* [<span data-ttu-id="17c39-1125">來自映像的 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-1125">VM from image</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/101-vm-from-user-image)

### <a name="implement-a-set-of-vms-which-need-to-communicate-within-azure"></a><span data-ttu-id="17c39-1126">實作一組需要在 Azure 內通訊的 VM</span><span class="sxs-lookup"><span data-stu-id="17c39-1126">Implement a set of VMs which need to communicate within Azure</span></span>
<span data-ttu-id="17c39-1127">此僅限雲端案例是用於訓練和示範的典型案例，其中代表訓練/示範案例的軟體會散佈到多個 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-1127">This Cloud-Only scenario is a typical scenario for training and demo purposes where the software representing the demo/training scenario is spread over multiple VMs.</span></span> <span data-ttu-id="17c39-1128">安裝在不同 VM 中的不同元件必須能夠彼此通訊。</span><span class="sxs-lookup"><span data-stu-id="17c39-1128">The different components installed in the different VMs need to communicate with each other.</span></span> <span data-ttu-id="17c39-1129">同樣地，在此案例中，不需要內部部署網路通訊或跨單位案例。</span><span class="sxs-lookup"><span data-stu-id="17c39-1129">Again, in this scenario no on-premises network communication or cross-premises scenario is needed.</span></span>

<span data-ttu-id="17c39-1130">此案例是本文件的[搭配 SAP NetWeaver 示範/訓練案例的單一 VM][planning-guide-7.1] 一章中所述安裝的延伸。</span><span class="sxs-lookup"><span data-stu-id="17c39-1130">This scenario is an extension of the installation described in chapter [Single VM with SAP NetWeaver demo/training scenario][planning-guide-7.1] of this document.</span></span> <span data-ttu-id="17c39-1131">在本例中，會將更多虛擬機器加入現有的資源群組。</span><span class="sxs-lookup"><span data-stu-id="17c39-1131">In this case more virtual machines will be added to an existing resource group.</span></span> <span data-ttu-id="17c39-1132">在下列範例中，訓練環境是由 SAP ASCS/SCS VM、執行 DBMS 的 VM 和 SAP 應用程式伺服器執行個體 VM 所組成。</span><span class="sxs-lookup"><span data-stu-id="17c39-1132">In the following example the training landscape consists of an SAP ASCS/SCS VM, a VM running a DBMS and an SAP Application Server instance VM.</span></span>

<span data-ttu-id="17c39-1133">建置此案例之前，您必須考慮先前案例中已練習過的基本設定。</span><span class="sxs-lookup"><span data-stu-id="17c39-1133">Before you build this scenario you need to think about basic settings as already exercised in the scenario before.</span></span>

#### <a name="resource-group-and-virtual-machine-naming"></a><span data-ttu-id="17c39-1134">資源群組和虛擬機器命名</span><span class="sxs-lookup"><span data-stu-id="17c39-1134">Resource Group and Virtual Machine naming</span></span>
<span data-ttu-id="17c39-1135">所有資源群組名稱必須是唯一的。</span><span class="sxs-lookup"><span data-stu-id="17c39-1135">All resource group names must be unique.</span></span> <span data-ttu-id="17c39-1136">請開發您自己的資源命名配置，例如 `<rg-name`>-尾碼。</span><span class="sxs-lookup"><span data-stu-id="17c39-1136">Develop your own naming scheme of your resources, such as `<rg-name`>-suffix.</span></span>

<span data-ttu-id="17c39-1137">虛擬機器名稱在資源群組內必須是唯一的。</span><span class="sxs-lookup"><span data-stu-id="17c39-1137">The virtual machine name has to be unique within the resource group.</span></span>

#### <a name="set-up-network-for-communication-between-the-different-vms"></a><span data-ttu-id="17c39-1138">設定網路以在不同的 VM 之間進行通訊</span><span class="sxs-lookup"><span data-stu-id="17c39-1138">Set up Network for communication between the different VMs</span></span>
![Azure 虛擬網路內的 VM 集合][planning-guide-figure-1900]

<span data-ttu-id="17c39-1140">若要避免與相同訓練/示範環境複製發生命名衝突，您必須為每個環境建立 Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="17c39-1140">To prevent naming collisions with clones of the same training/demo landscapes, you need to create an Azure Virtual Network for every landscape.</span></span> <span data-ttu-id="17c39-1141">Azure 將會提供 DNS 名稱解析，您也可以在 Azure 外設定自己的 DNS 伺服器 (此處不會進一步討論)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1141">DNS name resolution will be provided by Azure or you can configure your own DNS server outside Azure (not to be further discussed here).</span></span> <span data-ttu-id="17c39-1142">在本例中，我們不會設定自己的 DNS。</span><span class="sxs-lookup"><span data-stu-id="17c39-1142">In this scenario we do not configure our own DNS.</span></span> <span data-ttu-id="17c39-1143">針對一個 Azure 虛擬網路內的所有虛擬機器，會啟用透過主機名稱進行通訊。</span><span class="sxs-lookup"><span data-stu-id="17c39-1143">For all virtual machines inside one Azure Virtual Network, communication via hostnames will be enabled.</span></span>

<span data-ttu-id="17c39-1144">依虛擬網路 (而不只是依資源群組) 分隔訓練或示範環境的原因可能如下︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1144">The reasons to separate training or demo landscapes by virtual networks and not only resource groups could be:</span></span>

* <span data-ttu-id="17c39-1145">設定的 SAP 環境需要它自己的 AD/OpenLDAP，而且網域伺服器需要成為各環境的一部分。</span><span class="sxs-lookup"><span data-stu-id="17c39-1145">The SAP landscape as set up needs its own AD/OpenLDAP and a Domain Server needs to be part of each of the landscapes.</span></span>  
* <span data-ttu-id="17c39-1146">設定的 SAP 環境具有需要使用固定 IP 位址的元件。</span><span class="sxs-lookup"><span data-stu-id="17c39-1146">The SAP landscape as set up has components that need to work with fixed IP addresses.</span></span>

<span data-ttu-id="17c39-1147">如需有關「Azure 虛擬網路」及如何定義這些網路的更多詳細資料，請參閱[這篇文章][virtual-networks-create-vnet-arm-pportal]。</span><span class="sxs-lookup"><span data-stu-id="17c39-1147">More details about Azure Virtual Networks and how to define them can be found in [this article][virtual-networks-create-vnet-arm-pportal].</span></span>

## <a name="deploying-sap-vms-with-corporate-network-connectivity-cross-premises"></a><span data-ttu-id="17c39-1148">部署具有公司網路連線能力的 SAP VM (跨單位)</span><span class="sxs-lookup"><span data-stu-id="17c39-1148">Deploying SAP VMs with Corporate Network Connectivity (Cross-Premises)</span></span>
<span data-ttu-id="17c39-1149">您執行 SAP 環境，並想要在高階 DBMS 伺服器的裸機，以及應用程式層及更小型 2 層已設定 SAP 系統和 Azure IaaS 的內部部署虛擬環境之間分割部署。</span><span class="sxs-lookup"><span data-stu-id="17c39-1149">You run an SAP landscape and want to divide the deployment between bare-metal for high-end DBMS servers, on-premises virtualized environments for application layers and smaller 2-Tier configured SAP systems and Azure IaaS.</span></span> <span data-ttu-id="17c39-1150">基本假設是一個 SAP 環境內的 SAP 系統必須彼此通訊，並在公司中部署許多其他軟體元件，而不論其部署形式為何。</span><span class="sxs-lookup"><span data-stu-id="17c39-1150">The base assumption is that SAP systems within one SAP landscape need to communicate with each other and with many other software components deployed in the company, independent of their deployment form.</span></span> <span data-ttu-id="17c39-1151">此外，使用 SAP GUI 或其他介面進行連線之使用者的部署形式應該不會引進任何差異。</span><span class="sxs-lookup"><span data-stu-id="17c39-1151">There also should be no differences introduced by the deployment form for the end user connecting with SAP GUI or other interfaces.</span></span> <span data-ttu-id="17c39-1152">只有在已透過站對站/多網站連線能力或私人連線 (例如 Azure ExpressRoute)，將內部部署 Active Directory/OpenLDAP 和 DNS 服務擴充到 Azure 系統時，才符合這些條件。</span><span class="sxs-lookup"><span data-stu-id="17c39-1152">These conditions can only be met when we have the on-premises Active Directory/OpenLDAP and DNS services extended to the Azure systems through site-to-site/multi-site connectivity or private connections like Azure ExpressRoute.</span></span>

<span data-ttu-id="17c39-1153">為了取得 Azure 上 SAP 實作詳細資料的更多背景資訊，建議您閱讀本文件的 [SAP 執行個體的僅限雲端部署概念][planning-guide-7]一章，此章說明了 Azure 的一些基本建構，以及在 Azure 中應如何搭配 SAP 應用程式使用這些建構。</span><span class="sxs-lookup"><span data-stu-id="17c39-1153">In order to get more background on the implementation details of SAP on Azure, we encourage you to read chapter [Concepts of Cloud-Only deployment of SAP instances][planning-guide-7] of this document which explains some of the basics constructs of Azure and how these should be used with SAP applications in Azure.</span></span>

### <a name="scenario-of-an-sap-landscape"></a><span data-ttu-id="17c39-1154">SAP 環境的案例</span><span class="sxs-lookup"><span data-stu-id="17c39-1154">Scenario of an SAP landscape</span></span>
<span data-ttu-id="17c39-1155">跨單位案例大致上可以下圖描述︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1155">The cross-premises scenario can be roughly described like in the graphics below:</span></span>

![內部部署與 Azure 資產之間的站對站連線能力][planning-guide-figure-2100]

<span data-ttu-id="17c39-1157">上述案例描述內部部署 AD/OpenLDAP 和 DNS 擴充到 Azure 的案例。</span><span class="sxs-lookup"><span data-stu-id="17c39-1157">The scenario shown above describes a scenario where the on-premises AD/OpenLDAP and DNS are extended to Azure.</span></span> <span data-ttu-id="17c39-1158">在內部部署端，會為每個 Azure 訂用帳戶保留一個特定的 IP 位址範圍。</span><span class="sxs-lookup"><span data-stu-id="17c39-1158">On the on-premises side, a certain IP address range is reserved per Azure subscription.</span></span> <span data-ttu-id="17c39-1159">此 IP 位址範圍會指派給 Azure 端的 Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="17c39-1159">The IP address range will be assigned to an Azure Virtual Network on the Azure side.</span></span>

#### <a name="security-considerations"></a><span data-ttu-id="17c39-1160">安全性考量</span><span class="sxs-lookup"><span data-stu-id="17c39-1160">Security considerations</span></span>
<span data-ttu-id="17c39-1161">您必須至少使用 SSL/TLS 等安全的通訊協定，才能存取瀏覽器，或至少必須使用 VPN 連線，才能讓系統存取 Azure 服務。</span><span class="sxs-lookup"><span data-stu-id="17c39-1161">The minimum requirement is the use of secure communication protocols such as SSL/TLS for browser access or VPN-based connections for system access to the Azure services.</span></span> <span data-ttu-id="17c39-1162">假設公司處理其公司網路與 Azure 之間的 VPN 連線的方式大不相同。</span><span class="sxs-lookup"><span data-stu-id="17c39-1162">The assumption is that companies handle the VPN connection between their corporate network and Azure very differently.</span></span> <span data-ttu-id="17c39-1163">有些公司可能在不加思索的情況下開啟所有連接埠。</span><span class="sxs-lookup"><span data-stu-id="17c39-1163">Some companies might blankly open all the ports.</span></span> <span data-ttu-id="17c39-1164">有些公司可能想要能夠精確地開啟所需的連接埠。</span><span class="sxs-lookup"><span data-stu-id="17c39-1164">Some other companies might want to be very precise in which ports they need to open, etc.</span></span>

<span data-ttu-id="17c39-1165">下表列出一般 SAP 通訊連接埠。</span><span class="sxs-lookup"><span data-stu-id="17c39-1165">In the table below typical SAP communication ports are listed.</span></span> <span data-ttu-id="17c39-1166">基本上，這便足已開啟 SAP 閘道連接埠。</span><span class="sxs-lookup"><span data-stu-id="17c39-1166">Basically it is sufficient to open the SAP gateway port.</span></span>

| <span data-ttu-id="17c39-1167">服務</span><span class="sxs-lookup"><span data-stu-id="17c39-1167">Service</span></span> | <span data-ttu-id="17c39-1168">連接埠名稱</span><span class="sxs-lookup"><span data-stu-id="17c39-1168">Port Name</span></span> | <span data-ttu-id="17c39-1169">範例 `<nn`> = 01</span><span class="sxs-lookup"><span data-stu-id="17c39-1169">Example `<nn`> = 01</span></span> | <span data-ttu-id="17c39-1170">預設範圍 (最小值-最大值)</span><span class="sxs-lookup"><span data-stu-id="17c39-1170">Default Range (min-max)</span></span> | <span data-ttu-id="17c39-1171">註解</span><span class="sxs-lookup"><span data-stu-id="17c39-1171">Comment</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="17c39-1172">發送器</span><span class="sxs-lookup"><span data-stu-id="17c39-1172">Dispatcher</span></span> |<span data-ttu-id="17c39-1173">sapdp`<nn>` 請參閱 *</span><span class="sxs-lookup"><span data-stu-id="17c39-1173">sapdp`<nn>` see *</span></span> |<span data-ttu-id="17c39-1174">3201</span><span class="sxs-lookup"><span data-stu-id="17c39-1174">3201</span></span> |<span data-ttu-id="17c39-1175">3200 - 3299</span><span class="sxs-lookup"><span data-stu-id="17c39-1175">3200 – 3299</span></span> |<span data-ttu-id="17c39-1176">SAP 發送器，供 Windows 和 Java 的 SAP GUI 使用</span><span class="sxs-lookup"><span data-stu-id="17c39-1176">SAP Dispatcher, used by SAP GUI for Windows and Java</span></span> |
| <span data-ttu-id="17c39-1177">訊息伺服器</span><span class="sxs-lookup"><span data-stu-id="17c39-1177">Message server</span></span> |<span data-ttu-id="17c39-1178">sapms`<sid`> 請參閱 **</span><span class="sxs-lookup"><span data-stu-id="17c39-1178">sapms`<sid`> see **</span></span> |<span data-ttu-id="17c39-1179">3600</span><span class="sxs-lookup"><span data-stu-id="17c39-1179">3600</span></span> |<span data-ttu-id="17c39-1180">任意 sapms`<anySID`></span><span class="sxs-lookup"><span data-stu-id="17c39-1180">free sapms`<anySID`></span></span> |<span data-ttu-id="17c39-1181">sid = SAP 系統 ID</span><span class="sxs-lookup"><span data-stu-id="17c39-1181">sid = SAP-System-ID</span></span> |
| <span data-ttu-id="17c39-1182">閘道器</span><span class="sxs-lookup"><span data-stu-id="17c39-1182">Gateway</span></span> |<span data-ttu-id="17c39-1183">sapgw`<nn`> 請參閱 *</span><span class="sxs-lookup"><span data-stu-id="17c39-1183">sapgw`<nn`> see *</span></span> |<span data-ttu-id="17c39-1184">3301</span><span class="sxs-lookup"><span data-stu-id="17c39-1184">3301</span></span> |<span data-ttu-id="17c39-1185">任意</span><span class="sxs-lookup"><span data-stu-id="17c39-1185">free</span></span> |<span data-ttu-id="17c39-1186">SAP 閘道，用於 CPIC 和 RFC 通訊</span><span class="sxs-lookup"><span data-stu-id="17c39-1186">SAP gateway, used for CPIC and RFC communication</span></span> |
| <span data-ttu-id="17c39-1187">SAP 路由器</span><span class="sxs-lookup"><span data-stu-id="17c39-1187">SAP router</span></span> |<span data-ttu-id="17c39-1188">sapdp99</span><span class="sxs-lookup"><span data-stu-id="17c39-1188">sapdp99</span></span> |<span data-ttu-id="17c39-1189">3299</span><span class="sxs-lookup"><span data-stu-id="17c39-1189">3299</span></span> |<span data-ttu-id="17c39-1190">任意</span><span class="sxs-lookup"><span data-stu-id="17c39-1190">free</span></span> |<span data-ttu-id="17c39-1191">安裝後，只能將 /etc/services 中的 CI (中央執行個體) 服務名稱重新指派為任意值。</span><span class="sxs-lookup"><span data-stu-id="17c39-1191">Only CI (central instance) Service names can be reassigned in /etc/services to an arbitrary value after installation.</span></span> |

<span data-ttu-id="17c39-1192">*) nn = SAP 執行個體號碼</span><span class="sxs-lookup"><span data-stu-id="17c39-1192">*) nn = SAP Instance Number</span></span>

<span data-ttu-id="17c39-1193">**) sid = SAP 系統 ID</span><span class="sxs-lookup"><span data-stu-id="17c39-1193">**) sid = SAP-System-ID</span></span>

<span data-ttu-id="17c39-1194">如需不同 SAP 產品或 SAP 產品所提供的服務所需之連接埠的詳細資訊，請參閱 <http://scn.sap.com/docs/DOC-17124>。</span><span class="sxs-lookup"><span data-stu-id="17c39-1194">More detailed information on ports required for different SAP products or services by SAP products can be found here <http://scn.sap.com/docs/DOC-17124>.</span></span>
<span data-ttu-id="17c39-1195">透過這篇文章，您應該能夠在 VPN 裝置中，開啟特定 SAP 產品和案例所需的專用連接埠。</span><span class="sxs-lookup"><span data-stu-id="17c39-1195">With this document you should be able to open dedicated ports in the VPN device necessary for specific SAP products and scenarios.</span></span>

<span data-ttu-id="17c39-1196">在此情況下部署 VM 時，其他安全性措施可能還包括建立[網路安全性群組][virtual-networks-nsg]來定義存取規則。</span><span class="sxs-lookup"><span data-stu-id="17c39-1196">Other security measures when deploying VMs in such a scenario could be to create a [Network Security Group][virtual-networks-nsg] to define access rules.</span></span>

### <a name="dealing-with-different-virtual-machine-series"></a><span data-ttu-id="17c39-1197">面對不同的虛擬機器系列</span><span class="sxs-lookup"><span data-stu-id="17c39-1197">Dealing with different Virtual Machine Series</span></span>
<span data-ttu-id="17c39-1198">在過去 12 個月內，Microsoft 已新增更多 VM 類型，這些類型在 vCPU 數目、記憶體，更重要的是其執行所在的硬體方面各不相同。</span><span class="sxs-lookup"><span data-stu-id="17c39-1198">In the course of last 12 months Microsoft added many more VM types that differ either in number of vCPUs, memory or more important on hardware it is running on.</span></span> <span data-ttu-id="17c39-1199">SAP 並未針對所有這些 VM 都提供支援 (請參閱 SAP 附註 [1928533]中支援的 VM 類型)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1199">Not all those VMs are supported with SAP (see supported VM types in SAP Note [1928533]).</span></span> <span data-ttu-id="17c39-1200">其中一些 VM 會在不同世代的主機硬體上執行。</span><span class="sxs-lookup"><span data-stu-id="17c39-1200">Some of those VMs run on different host hardware generations.</span></span> <span data-ttu-id="17c39-1201">這些世代的主機硬體會以 Azure 縮放單位的資料粒度進行部署。</span><span class="sxs-lookup"><span data-stu-id="17c39-1201">These host hardware generations are getting deployed in the granularity of an Azure Scale-Unit.</span></span> <span data-ttu-id="17c39-1202">有時您選擇的不同 VM 大小可能無法在相同的縮放單位上執行。</span><span class="sxs-lookup"><span data-stu-id="17c39-1202">Means cases may arise where the different VM sizes you chose can’t be run on the same Scale-Unit.</span></span> <span data-ttu-id="17c39-1203">根據不同硬體，可用性設定組跨越縮放單位的能力會受到限制。</span><span class="sxs-lookup"><span data-stu-id="17c39-1203">An Availability Set is limited in the ability to span Scale-Units based of different hardware.</span></span>  <span data-ttu-id="17c39-1204">舉例來說，如果您想要在 A5-A11 VM 上執行 DBMS，並在 G 系列 VM 上執行 SAP 應用程式層，就必須部署單一 SAP 系統，或在不同的可用性設定組內部署不同的 SAP 系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-1204">For example if you want to run the DBMS on A5-A11 VMs and the SAP application layer on G-Series VMs, you would be forced to deploy a single SAP system or different SAP systems within different Availability Sets.</span></span>

#### <a name="printing-on-a-local-network-printer-from-sap-instance-in-azure"></a><span data-ttu-id="17c39-1205">在 Azure 中從 SAP 執行個體的區域網路印表機進行列印</span><span class="sxs-lookup"><span data-stu-id="17c39-1205">Printing on a local network printer from SAP instance in Azure</span></span>
##### <a name="printing-over-tcpip-in-cross-premises-scenario"></a><span data-ttu-id="17c39-1206">在跨單位案例中透過 TCP/IP 進行列印</span><span class="sxs-lookup"><span data-stu-id="17c39-1206">Printing over TCP/IP in Cross-Premises scenario</span></span>
<span data-ttu-id="17c39-1207">在 Azure VM 中設定內部部署 TCP/IP 網路印表機就像是在公司網路中設定一樣，都會假設您已確實建立 VPN 站對站通道或 ExpressRoute 連線。</span><span class="sxs-lookup"><span data-stu-id="17c39-1207">Setting up your on-premises TCP/IP based network printers in an Azure VM is overall the same as in your corporate network, assuming you do have a VPN Site-To-Site tunnel or ExpressRoute connection established.</span></span>

- - -
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-1209">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-1209">Windows</span></span>
>
> <span data-ttu-id="17c39-1210">作法：</span><span class="sxs-lookup"><span data-stu-id="17c39-1210">To do this:</span></span>
>
> * <span data-ttu-id="17c39-1211">有些網路印表機隨附組態精靈，可讓您輕鬆地在 Azure VM 中設定印表機。</span><span class="sxs-lookup"><span data-stu-id="17c39-1211">Some network printers come with a configuration wizard which makes it easy to set up your printer in an Azure VM.</span></span> <span data-ttu-id="17c39-1212">如果印表機未隨附任何精靈軟體，設定印表機的「手動」方式是建立新的 TCP/IP 印表機連接埠。</span><span class="sxs-lookup"><span data-stu-id="17c39-1212">If no wizard software has been distributed with the printer the “manual” way to set up the printer is to create a new TCP/IP printer port.</span></span>
> * <span data-ttu-id="17c39-1213">開啟 [控制台] -> [裝置和印表機] -> [新增印表機]</span><span class="sxs-lookup"><span data-stu-id="17c39-1213">Open Control Panel -> Devices and Printers -> Add a printer</span></span>
> * <span data-ttu-id="17c39-1214">選擇 [使用 TCP/IP 位址或主機名稱新增印表機]</span><span class="sxs-lookup"><span data-stu-id="17c39-1214">Choose Add a printer using a TCP/IP address or hostname</span></span>
> * <span data-ttu-id="17c39-1215">輸入印表機的 IP 位址</span><span class="sxs-lookup"><span data-stu-id="17c39-1215">Type in the IP address of the printer</span></span>
> * <span data-ttu-id="17c39-1216">印表機連接埠標準 9100</span><span class="sxs-lookup"><span data-stu-id="17c39-1216">Printer Port standard 9100</span></span>
> * <span data-ttu-id="17c39-1217">如有必要，請手動安裝適當的印表機驅動程式。</span><span class="sxs-lookup"><span data-stu-id="17c39-1217">If necessary install the appropriate printer driver manually.</span></span>
>
> ![Linux][Logo_Linux] <span data-ttu-id="17c39-1219">Linux</span><span class="sxs-lookup"><span data-stu-id="17c39-1219">Linux</span></span>
>
> * <span data-ttu-id="17c39-1220">類似於 Windows，只要遵循標準程序即可安裝網路印表機</span><span class="sxs-lookup"><span data-stu-id="17c39-1220">like for Windows just follow the standard procedure to install a network printer</span></span>
> * <span data-ttu-id="17c39-1221">只要遵循 [SUSE](https://www.suse.com/documentation/sles-12/book_sle_deployment/data/sec_y2_hw_print.html) 或 [Red Hat 和 Oracle Linux](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Deployment_Guide/sec-Printer_Configuration.html) 的公用 Linux 指南中有關如何新增印表機的說明操作即可。</span><span class="sxs-lookup"><span data-stu-id="17c39-1221">just follow the public Linux guides for [SUSE](https://www.suse.com/documentation/sles-12/book_sle_deployment/data/sec_y2_hw_print.html) or [Red Hat and Oracle Linux](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Deployment_Guide/sec-Printer_Configuration.html) on how to add a printer.</span></span>
>
>

- - -
![網路列印][planning-guide-figure-2200]

##### <a name="host-based-printer-over-smb-shared-printer-in-cross-premises-scenario"></a><span data-ttu-id="17c39-1223">在跨單位案例中透過 SMB 的主機型印表機 (共用印表機)</span><span class="sxs-lookup"><span data-stu-id="17c39-1223">Host-based printer over SMB (shared printer) in Cross-Premises scenario</span></span>
<span data-ttu-id="17c39-1224">根據設計，主機型印表機與網路不相容。</span><span class="sxs-lookup"><span data-stu-id="17c39-1224">Host-based printers are not network-compatible by design.</span></span> <span data-ttu-id="17c39-1225">但只要主機型印表機連線到開啟電源的電腦，就可以在網路上的電腦之間共用印表機。</span><span class="sxs-lookup"><span data-stu-id="17c39-1225">But a host-based printer can be shared among computers on a network as long as the printer is connected to a powered-on computer.</span></span> <span data-ttu-id="17c39-1226">請以站對站或 ExpressRoute 方式連線到您的公司網路，並共用您的本機印表機。</span><span class="sxs-lookup"><span data-stu-id="17c39-1226">Connect your corporate network either Site-To-Site or ExpressRoute and share your local printer.</span></span> <span data-ttu-id="17c39-1227">SMB 通訊協定使用 NetBIOS 作為名稱服務，而不是 DNS。</span><span class="sxs-lookup"><span data-stu-id="17c39-1227">The SMB protocol uses NetBIOS instead of DNS as name service.</span></span> <span data-ttu-id="17c39-1228">NetBIOS 主機名稱可以與 DNS 主機名稱不同。</span><span class="sxs-lookup"><span data-stu-id="17c39-1228">The NetBIOS host name can be different from the DNS host name.</span></span> <span data-ttu-id="17c39-1229">標準情況是 NetBIOS 主機名稱和 DNS 主機名稱完全相同。</span><span class="sxs-lookup"><span data-stu-id="17c39-1229">The standard case is that the NetBIOS host name and the DNS host name are identical.</span></span> <span data-ttu-id="17c39-1230">DNS 網域在 NetBIOS 命名空間中毫無意義。</span><span class="sxs-lookup"><span data-stu-id="17c39-1230">The DNS domain does not make sense in the NetBIOS name space.</span></span> <span data-ttu-id="17c39-1231">因此，完整的 DNS 主機名稱是由 DNS 主機名稱所組成，而且 NetBIOS 命名空間中不能使用 DNS 網域。</span><span class="sxs-lookup"><span data-stu-id="17c39-1231">Accordingly, the fully qualified DNS host name consisting of the DNS host name and DNS domain must not be used in the NetBIOS name space.</span></span>

<span data-ttu-id="17c39-1232">印表機共用將透過網路中的唯一名稱來識別︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1232">The printer share is identified by a unique name in the network:</span></span>

* <span data-ttu-id="17c39-1233">SMB 主機的主機名稱 (一律需要)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1233">Host name of the SMB host (always needed).</span></span>
* <span data-ttu-id="17c39-1234">共用的名稱 (一律需要)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1234">Name of the share (always needed).</span></span>
* <span data-ttu-id="17c39-1235">如果印表機共用與 SAP 系統不在相同的網域中，則為網域的名稱。</span><span class="sxs-lookup"><span data-stu-id="17c39-1235">Name of the domain if printer share is not in the same domain as SAP system.</span></span>
* <span data-ttu-id="17c39-1236">此外，還可能需要使用者名稱和密碼，才能存取印表機共用。</span><span class="sxs-lookup"><span data-stu-id="17c39-1236">Additionally, a user name and a password may be required to access the printer share.</span></span>

<span data-ttu-id="17c39-1237">作法：</span><span class="sxs-lookup"><span data-stu-id="17c39-1237">How to:</span></span>

- - -
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-1239">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-1239">Windows</span></span>
>
> <span data-ttu-id="17c39-1240">共用您的本機印表機。</span><span class="sxs-lookup"><span data-stu-id="17c39-1240">Share your local printer.</span></span>
> <span data-ttu-id="17c39-1241">在 Azure VM 中，開啟 Windows 檔案總管，並輸入印表機的共用名稱。</span><span class="sxs-lookup"><span data-stu-id="17c39-1241">In the Azure VM, open the Windows Explorer and type in the share name of the printer.</span></span>
> <span data-ttu-id="17c39-1242">[印表機安裝精靈] 將會引導您完成安裝程序。</span><span class="sxs-lookup"><span data-stu-id="17c39-1242">A printer installation wizard will guide you through the installation process.</span></span>
>
> ![Linux][Logo_Linux] <span data-ttu-id="17c39-1244">Linux</span><span class="sxs-lookup"><span data-stu-id="17c39-1244">Linux</span></span>
>
> <span data-ttu-id="17c39-1245">以下是有關在 Linux 中設定網路印表機，或包含在 Linux 中列印之相關章節的一些文件範例。</span><span class="sxs-lookup"><span data-stu-id="17c39-1245">Here are some examples of documentation about configuring network printers in Linux or including a chapter regarding printing in Linux.</span></span> <span data-ttu-id="17c39-1246">只要 VM 是 VPN 的一部分，就會以在 Azure Linux VM 中的相同方式來運作︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1246">It will work the same way in an Azure Linux VM as long as the VM is part of a VPN:</span></span>
>
> * <span data-ttu-id="17c39-1247">SLES <https://en.opensuse.org/SDB:Printing_via_SMB_(Samba)_Share_or_Windows_Share></span><span class="sxs-lookup"><span data-stu-id="17c39-1247">SLES <https://en.opensuse.org/SDB:Printing_via_SMB_(Samba)_Share_or_Windows_Share></span></span>
> * <span data-ttu-id="17c39-1248">RHEL 或 Oracle Linux <https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sec-Printer_Configuration.html#s1-printing-smb-printer></span><span class="sxs-lookup"><span data-stu-id="17c39-1248">RHEL or Oracle Linux <https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sec-Printer_Configuration.html#s1-printing-smb-printer></span></span>
>
>

- - -
##### <a name="usb-printer-printer-forwarding"></a><span data-ttu-id="17c39-1249">USB 印表機 (印表機轉送)</span><span class="sxs-lookup"><span data-stu-id="17c39-1249">USB Printer (printer forwarding)</span></span>
<span data-ttu-id="17c39-1250">在 Azure 中，可讓使用者在遠端工作階段中存取本機印表機裝置的遠端桌面服務功能無法使用。</span><span class="sxs-lookup"><span data-stu-id="17c39-1250">In Azure the ability of the Remote Desktop Services to provide users the access to their local printer devices in a remote session is not available.</span></span>

- - -
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-1252">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-1252">Windows</span></span>
>
> <span data-ttu-id="17c39-1253">使用 Windows 列印的更多詳細資料，請參閱：<http://technet.microsoft.com/library/jj590748.aspx>。</span><span class="sxs-lookup"><span data-stu-id="17c39-1253">More details on printing with Windows can be found here: <http://technet.microsoft.com/library/jj590748.aspx>.</span></span>
>
>

- - -
#### <a name="integration-of-sap-azure-systems-into-correction-and-transport-system-tms-in-cross-premises"></a><span data-ttu-id="17c39-1254">在跨單位中將 SAP Azure 系統整合到 Correction and Transport System (TMS)</span><span class="sxs-lookup"><span data-stu-id="17c39-1254">Integration of SAP Azure Systems into Correction and Transport System (TMS) in Cross-Premises</span></span>
<span data-ttu-id="17c39-1255">您必須設定 SAP Change and Transport System (TMS)，才能在環境中的不同系統之間匯出及匯入傳輸要求。</span><span class="sxs-lookup"><span data-stu-id="17c39-1255">The SAP Change and Transport System (TMS) needs to be configured to export and import transport request across systems in the landscape.</span></span> <span data-ttu-id="17c39-1256">假設 SAP 系統 (DEV) 的開發執行個體位於 Azure 中，而品質保證 (QA) 和生產系統 (PRD) 在內部部署。</span><span class="sxs-lookup"><span data-stu-id="17c39-1256">We assume that the development instances of an SAP system (DEV) are located in Azure whereas the quality assurance (QA) and productive systems (PRD) are on-premises.</span></span> <span data-ttu-id="17c39-1257">此外，假設有一個中央傳輸目錄。</span><span class="sxs-lookup"><span data-stu-id="17c39-1257">Furthermore, we assume that there is a central transport directory.</span></span>

##### <a name="configuring-the-transport-domain"></a><span data-ttu-id="17c39-1258">設定傳輸網域</span><span class="sxs-lookup"><span data-stu-id="17c39-1258">Configuring the Transport Domain</span></span>
<span data-ttu-id="17c39-1259">在您指定為「傳輸網域控制站」的系統上設定「傳輸網域」，如 [Configuring the Transport Domain Controller (設定傳輸網域控制站)](http://help.sap.com/erp2005_ehp_04/helpdata/en/44/b4a0b47acc11d1899e0000e829fbbd/content.htm)所述。</span><span class="sxs-lookup"><span data-stu-id="17c39-1259">Configure your Transport Domain on the system you designated as the Transport Domain Controller as described in [Configuring the Transport Domain Controller](http://help.sap.com/erp2005_ehp_04/helpdata/en/44/b4a0b47acc11d1899e0000e829fbbd/content.htm).</span></span> <span data-ttu-id="17c39-1260">這會建立系統使用者 TMSADM，並產生必要的 RFC 目的地。</span><span class="sxs-lookup"><span data-stu-id="17c39-1260">A system user TMSADM will be created and the required RFC destination will be generated.</span></span> <span data-ttu-id="17c39-1261">您可以查看使用交易 SM59 的這些 RFC 連線。</span><span class="sxs-lookup"><span data-stu-id="17c39-1261">You may check these RFC connections using the transaction SM59.</span></span> <span data-ttu-id="17c39-1262">您必須在傳輸網域內啟用主機名稱解析。</span><span class="sxs-lookup"><span data-stu-id="17c39-1262">Hostname resolution must be enabled across your transport domain.</span></span>

<span data-ttu-id="17c39-1263">作法：</span><span class="sxs-lookup"><span data-stu-id="17c39-1263">How to:</span></span>

* <span data-ttu-id="17c39-1264">在本例中，我們決定內部部署 QAS 系統將成為 CTS 網域控制站。</span><span class="sxs-lookup"><span data-stu-id="17c39-1264">In our scenario we decided the on-premises QAS system will be the CTS domain controller.</span></span> <span data-ttu-id="17c39-1265">呼叫交易 STMS。</span><span class="sxs-lookup"><span data-stu-id="17c39-1265">Call transaction STMS.</span></span> <span data-ttu-id="17c39-1266">[TMS] 對話方塊隨即顯示。</span><span class="sxs-lookup"><span data-stu-id="17c39-1266">The TMS dialog box appears.</span></span> <span data-ttu-id="17c39-1267">[Configure Transport Domain]\(設定傳輸網域) 對話方塊隨即顯示</span><span class="sxs-lookup"><span data-stu-id="17c39-1267">A Configure Transport Domain dialog box is displayed.</span></span> <span data-ttu-id="17c39-1268">(只有在您尚未設定傳輸網域時，才會顯示此對話方塊)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1268">(This dialog box only appears if you have not yet configured a transport domain.)</span></span>
* <span data-ttu-id="17c39-1269">確定自動建立的使用者 TMSADM 已獲得授權 ([SM59] -> [ABAP Connection]\(ABAP 連線) -> [TMSADM@E61.DOMAIN_E61] -> [Details]\(詳細資料) -> [Utilities(M)]\(公用程式(M)) -> [Authorization Test]\(授權測試))。</span><span class="sxs-lookup"><span data-stu-id="17c39-1269">Make sure that the automatically created user TMSADM is authorized (SM59 -> ABAP Connection -> TMSADM@E61.DOMAIN_E61 -> Details -> Utilities(M) -> Authorization Test).</span></span> <span data-ttu-id="17c39-1270">交易 STMS 的初始畫面應該顯示此 SAP 系統現在會作為傳輸網域的控制站，如下所示：</span><span class="sxs-lookup"><span data-stu-id="17c39-1270">The initial screen of transaction STMS should show that this SAP System is now functioning as the controller of the transport domain as shown here:</span></span>

![網域控制站上的交易 STMS 初始畫面][planning-guide-figure-2300]

#### <a name="including-sap-systems-in-the-transport-domain"></a><span data-ttu-id="17c39-1272">將 SAP 系統加入傳輸網域</span><span class="sxs-lookup"><span data-stu-id="17c39-1272">Including SAP Systems in the Transport Domain</span></span>
<span data-ttu-id="17c39-1273">將 SAP 系統加入傳輸網域的順序如下所示︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1273">The sequence of including an SAP system in a transport domain looks as follows:</span></span>

* <span data-ttu-id="17c39-1274">在 Azure 的 DEV 系統上，移至傳輸系統 (用戶端 000) 並呼叫交易 STMS。</span><span class="sxs-lookup"><span data-stu-id="17c39-1274">On the DEV system in Azure, go to the transport system (Client 000) and call transaction STMS.</span></span> <span data-ttu-id="17c39-1275">從對話方塊選擇 [Other Configuration]\(其他組態)，並繼續進行 [Include System in Domain]\(將系統加入網域)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1275">Choose Other Configuration from the dialog box and continue with Include System in Domain.</span></span> <span data-ttu-id="17c39-1276">將「網域控制站」指定為目標主機 ([Including SAP Systems in the Transport Domain (將 SAP 系統加入傳輸網域)](http://help.sap.com/erp2005_ehp_04/helpdata/en/44/b4a0c17acc11d1899e0000e829fbbd/content.htm?frameset=/en/44/b4a0b47acc11d1899e0000e829fbbd/frameset.htm))。</span><span class="sxs-lookup"><span data-stu-id="17c39-1276">Specify the Domain Controller as target host ([Including SAP Systems in the Transport Domain](http://help.sap.com/erp2005_ehp_04/helpdata/en/44/b4a0c17acc11d1899e0000e829fbbd/content.htm?frameset=/en/44/b4a0b47acc11d1899e0000e829fbbd/frameset.htm)).</span></span> <span data-ttu-id="17c39-1277">系統正在等候加入傳輸網域。</span><span class="sxs-lookup"><span data-stu-id="17c39-1277">The system is now waiting to be included in the transport domain.</span></span>
* <span data-ttu-id="17c39-1278">基於安全性理由，您必須接著回到網域控制站確認您的要求。</span><span class="sxs-lookup"><span data-stu-id="17c39-1278">For security reasons, you then have to go back to the domain controller to confirm your request.</span></span> <span data-ttu-id="17c39-1279">針對等候中系統，選擇 [系統概觀] 和 [核准]。</span><span class="sxs-lookup"><span data-stu-id="17c39-1279">Choose System Overview and Approve of the waiting system.</span></span> <span data-ttu-id="17c39-1280">然後確認提示，設定會隨即發佈。</span><span class="sxs-lookup"><span data-stu-id="17c39-1280">Then confirm the prompt and the configuration will be distributed.</span></span>

<span data-ttu-id="17c39-1281">此 SAP 系統現在包含有關傳輸網域中所有其他 SAP 系統的必要資訊。</span><span class="sxs-lookup"><span data-stu-id="17c39-1281">This SAP system now contains the necessary information about all the other SAP systems in the transport domain.</span></span> <span data-ttu-id="17c39-1282">同時會將新 SAP 系統的位址資料傳送至所有其他 SAP 系統，並在傳輸控制程式的傳輸設定檔中輸入 SAP 系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-1282">At the same time, the address data of the new SAP system is sent to all the other SAP systems, and the SAP system is entered in the transport profile of the transport control program.</span></span> <span data-ttu-id="17c39-1283">檢查網域之傳輸目錄的 RFC 和存取是否運作正常。</span><span class="sxs-lookup"><span data-stu-id="17c39-1283">Check whether RFCs and access to the transport directory of the domain work.</span></span>

<span data-ttu-id="17c39-1284">如 [Change and Transport System (變更和傳輸系統)](http://help.sap.com/saphelp_nw70ehp3/helpdata/en/48/c4300fca5d581ce10000000a42189c/content.htm?frameset=/en/44/b4a0b47acc11d1899e0000e829fbbd/frameset.htm)一文所述，像往常一樣繼續設定傳輸系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-1284">Continue with the configuration of your transport system as usual as described in the documentation [Change and Transport System](http://help.sap.com/saphelp_nw70ehp3/helpdata/en/48/c4300fca5d581ce10000000a42189c/content.htm?frameset=/en/44/b4a0b47acc11d1899e0000e829fbbd/frameset.htm).</span></span>

<span data-ttu-id="17c39-1285">作法：</span><span class="sxs-lookup"><span data-stu-id="17c39-1285">How to:</span></span>

* <span data-ttu-id="17c39-1286">確定您在內部部署的 STMS 已正確設定。</span><span class="sxs-lookup"><span data-stu-id="17c39-1286">Make sure your STMS on premises is configured correctly.</span></span>
* <span data-ttu-id="17c39-1287">確定您在 Azure 上的虛擬機器可解析傳輸網域控制站的主機名稱，反之亦然。</span><span class="sxs-lookup"><span data-stu-id="17c39-1287">Make sure the hostname of the Transport Domain Controller can be resolved by your virtual machine on Azure and vice visa.</span></span>
* <span data-ttu-id="17c39-1288">呼叫交易 STMS -> [Other Configuration]\(其他組態) -> [Include System in Domain]\(將系統加入網域)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1288">Call transaction STMS -> Other Configuration -> Include System in Domain.</span></span>
* <span data-ttu-id="17c39-1289">確認內部部署 TMS 系統已連線。</span><span class="sxs-lookup"><span data-stu-id="17c39-1289">Confirm the connection in the on premises TMS system.</span></span>
* <span data-ttu-id="17c39-1290">像往常一樣，設定傳輸路由、群組和層級。</span><span class="sxs-lookup"><span data-stu-id="17c39-1290">Configure transport routes, groups and layers as usual.</span></span>

<span data-ttu-id="17c39-1291">在站對站連線的跨單位案例中，內部部署與 Azure 之間的延遲時間可能仍然很長。</span><span class="sxs-lookup"><span data-stu-id="17c39-1291">In site-to-site connected cross-premises scenarios, the latency between on-premises and Azure still can be substantial.</span></span> <span data-ttu-id="17c39-1292">如果我們遵循傳輸物件通過開發和測試系統到生產環境的順序，並考慮將傳輸或支援封裝套用至不同的系統，請了解根據中央傳輸目錄的位置，部分系統將會遇到讀取或寫入中央傳輸目錄的延遲很高的情況。</span><span class="sxs-lookup"><span data-stu-id="17c39-1292">If we follow the sequence of transporting objects through development and test systems to production or think about applying transports or support packages to the different systems, you realize that, dependent on the location of the central transport directory, some of the systems will encounter high latency reading or writing data in the central transport directory.</span></span> <span data-ttu-id="17c39-1293">此情況類似於 SAP 環境組態，其中不同的系統會散佈到不同的資料中心，而且這些資料中心彼此距離很遠。</span><span class="sxs-lookup"><span data-stu-id="17c39-1293">The situation is similar to SAP landscape configurations where the different systems are spread through different data centers with substantial distance between the data centers.</span></span>

<span data-ttu-id="17c39-1294">為了解決此延遲問題，並讓系統快速地從傳輸目錄讀取或寫入傳輸目錄，您可以設定兩個 STMS 傳輸網域 (一個用於內部部署，一個用於 Azure 中的系統)，並連結傳輸網域。</span><span class="sxs-lookup"><span data-stu-id="17c39-1294">In order to work around such latency and have the systems work fast in reading or writing to or from the transport directory, you can set up two STMS transport domains (one for on-premises and one with the systems in Azure and link the transport domains.</span></span> <span data-ttu-id="17c39-1295">請參閱下列文件，其中說明 SAP TMS 中此概念背後的原則：<http://help.sap.com/saphelp_me60/helpdata/en/c4/6045377b52253de10000009b38f889/content.htm?frameset=/en/57/38dd924eb711d182bf0000e829fbfe/frameset.htm>。</span><span class="sxs-lookup"><span data-stu-id="17c39-1295">Please check this documentation which explains the principles behind this concept in the SAP TMS: <http://help.sap.com/saphelp_me60/helpdata/en/c4/6045377b52253de10000009b38f889/content.htm?frameset=/en/57/38dd924eb711d182bf0000e829fbfe/frameset.htm>.</span></span>

<span data-ttu-id="17c39-1296">作法：</span><span class="sxs-lookup"><span data-stu-id="17c39-1296">How to:</span></span>

* <span data-ttu-id="17c39-1297">使用交易 STMS 在每個位置 (內部部署和 Azure) 設定傳輸網域 <http://help.sap.com/saphelp_nw70ehp3/helpdata/en/44/b4a0b47acc11d1899e0000e829fbbd/content.htm></span><span class="sxs-lookup"><span data-stu-id="17c39-1297">Set up a transport domain on each location (on-premises and Azure) using transaction STMS <http://help.sap.com/saphelp_nw70ehp3/helpdata/en/44/b4a0b47acc11d1899e0000e829fbbd/content.htm></span></span>
* <span data-ttu-id="17c39-1298">使用網域連結來連結網域，並確認兩個網域之間的連結。</span><span class="sxs-lookup"><span data-stu-id="17c39-1298">Link the domains with a domain link and confirm the link between the two domains.</span></span>
  <span data-ttu-id="17c39-1299"><http://help.sap.com/saphelp_nw73ehp1/helpdata/en/a3/139838280c4f18e10000009b38f8cf/content.htm></span><span class="sxs-lookup"><span data-stu-id="17c39-1299"><http://help.sap.com/saphelp_nw73ehp1/helpdata/en/a3/139838280c4f18e10000009b38f8cf/content.htm></span></span>
* <span data-ttu-id="17c39-1300">將組態分散到連結的系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-1300">Distribute the configuration to the linked system.</span></span>

#### <a name="rfc-traffic-between-sap-instances-located-in-azure-and-on-premises-cross-premises"></a><span data-ttu-id="17c39-1301">在 Azure 中及內部部署的 SAP 執行個體之間的 RFC 流量 (跨單位)</span><span class="sxs-lookup"><span data-stu-id="17c39-1301">RFC traffic between SAP instances located in Azure and on-premises (Cross-Premises)</span></span>
<span data-ttu-id="17c39-1302">在內部部署及 Azure 中的系統之間的 RFC 流量必須運作正常。</span><span class="sxs-lookup"><span data-stu-id="17c39-1302">RFC traffic between systems which are on-premises and in Azure needs to work.</span></span> <span data-ttu-id="17c39-1303">若要設定連線，請呼叫來源系統中的交易 SM59，您必須在此系統中定義目標系統的 RFC 連線。</span><span class="sxs-lookup"><span data-stu-id="17c39-1303">To set up a connection call transaction SM59 in a source system where you need to define an RFC connection towards the target system.</span></span> <span data-ttu-id="17c39-1304">此組態類似於 RFC 連線的標準設定。</span><span class="sxs-lookup"><span data-stu-id="17c39-1304">The configuration is similar to the standard setup of an RFC Connection.</span></span>

<span data-ttu-id="17c39-1305">假設在跨單位案例中，執行 SAP 系統且必須彼此通訊的 VM 位於相同的網域中。</span><span class="sxs-lookup"><span data-stu-id="17c39-1305">We assume that in the cross-premises scenario, the VMs which run SAP systems that need to communicate with each other are in the same domain.</span></span> <span data-ttu-id="17c39-1306">因此，SAP 系統之間的 RFC 連線設定，與內部部署案例中的設定步驟和輸入並無不同。</span><span class="sxs-lookup"><span data-stu-id="17c39-1306">Therefore the setup of an RFC connection between SAP systems does not differ from the setup steps and inputs in on-premises scenarios.</span></span>

#### <a name="accessing-local-fileshares-from-sap-instances-located-in-azure-or-vice-versa"></a><span data-ttu-id="17c39-1307">從 Azure 中的 SAP 執行個體存取「本機」檔案共用，反之亦然</span><span class="sxs-lookup"><span data-stu-id="17c39-1307">Accessing ‘local’ fileshares from SAP instances located in Azure or vice versa</span></span>
<span data-ttu-id="17c39-1308">Azure 中的 SAP 執行個體必須能夠存取公司內部的檔案共用。</span><span class="sxs-lookup"><span data-stu-id="17c39-1308">SAP instances located in Azure need to access file shares which are within the corporate premises.</span></span> <span data-ttu-id="17c39-1309">此外，內部部署 SAP 執行個體必須能夠存取 Azure 中的檔案共用。</span><span class="sxs-lookup"><span data-stu-id="17c39-1309">In addition, on-premises SAP instances need to access file shares which are located in Azure.</span></span> <span data-ttu-id="17c39-1310">若要啟用檔案共用，您必須設定本機系統上的權限和共用選項。</span><span class="sxs-lookup"><span data-stu-id="17c39-1310">To enable the file shares you must configure the permissions and sharing options on the local system.</span></span> <span data-ttu-id="17c39-1311">請務必在 Azure 與您的資料中心之間，開啟 VPN 或 ExpressRoute 連線的連接埠。</span><span class="sxs-lookup"><span data-stu-id="17c39-1311">Make sure to open the ports on the VPN or ExpressRoute connection between Azure and your datacenter.</span></span>

## <a name="supportability"></a><span data-ttu-id="17c39-1312">支援能力</span><span class="sxs-lookup"><span data-stu-id="17c39-1312">Supportability</span></span>
### <span data-ttu-id="17c39-1313"><a name="6f0a47f3-a289-4090-a053-2521618a28c3"></a>適用於 SAP 的 Azure 監視解決方案</span><span class="sxs-lookup"><span data-stu-id="17c39-1313"><a name="6f0a47f3-a289-4090-a053-2521618a28c3"></a>Azure Monitoring Solution for SAP</span></span>
<span data-ttu-id="17c39-1314">若要在 Azure 上啟用任務關鍵性 SAP 系統的監視功能，SAPOSCOL 或 SAP Host Agent 等 SAP 監視工具會透過 Azure Monitoring Extension for SAP，從 Azure 虛擬機器服務主機取得資料。</span><span class="sxs-lookup"><span data-stu-id="17c39-1314">In order to enable the monitoring of mission critical SAP systems on Azure the SAP monitoring tools SAPOSCOL or SAP Host Agent get data off the Azure Virtual Machine Service host via an Azure Monitoring Extension for SAP.</span></span> <span data-ttu-id="17c39-1315">由於 SAP 的需求是專門針對 SAP 應用程式，因此 Microsoft 決定不將必要功能的實作一般化到 Azure，而由客戶將必要的監視元件和組態，部署到他們在 Azure 中執行的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="17c39-1315">Since the demands by SAP were very specific to SAP applications, Microsoft decided not to generically implement the required functionality into Azure, but leave it for customers to deploy the necessary monitoring components and configurations to their Virtual Machines running in Azure.</span></span> <span data-ttu-id="17c39-1316">不過，監視元件的部署和生命週期管理大部分會由 Azure 自動化。</span><span class="sxs-lookup"><span data-stu-id="17c39-1316">However, deployment and lifecycle management of the monitoring components will be mostly automated by Azure.</span></span>

#### <a name="solution-design"></a><span data-ttu-id="17c39-1317">解決方案設計</span><span class="sxs-lookup"><span data-stu-id="17c39-1317">Solution design</span></span>
<span data-ttu-id="17c39-1318">為啟用 SAP 監視所開發的解決方案，是以 Azure VM 代理程式的架構和擴充功能架構為基礎。</span><span class="sxs-lookup"><span data-stu-id="17c39-1318">The solution developed to enable SAP Monitoring is based on the architecture of Azure VM Agent and Extension framework.</span></span> <span data-ttu-id="17c39-1319">Azure VM 代理程式和擴充功能架構的概念是，允許在 VM 中安裝 Azure VM 擴充功能資源庫中可用的軟體應用程式。</span><span class="sxs-lookup"><span data-stu-id="17c39-1319">The idea of the Azure VM Agent and Extension framework is to allow installation of software application(s) available in the Azure VM Extension gallery within a VM.</span></span> <span data-ttu-id="17c39-1320">此概念背後的主要概念是，允許 (以 Azure Monitoring Extension for SAP 為例) 將特殊功能部署到 VM，並在部署時設定這類軟體。</span><span class="sxs-lookup"><span data-stu-id="17c39-1320">The principle idea behind this concept is to allow (in cases like the Azure Monitoring Extension for SAP), the deployment of special functionality into a VM and the configuration of such software at deployment time.</span></span>

<span data-ttu-id="17c39-1321">在 Azure 入口網站中建立 VM 時，預設會將可在 VM 中處理特定 Azure VM 擴充功能的「Azure VM 代理程式」，插入 Windows VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-1321">The 'Azure VM Agent' that enables handling of specific Azure VM Extensions within the VM is injected into Windows VMs by default on VM creation in the Azure portal.</span></span> <span data-ttu-id="17c39-1322">若是 SUSE、Red Hat 或 Oracle Linux，則 VM 代理程式已經包含在 Azure Marketplace 映像中。</span><span class="sxs-lookup"><span data-stu-id="17c39-1322">In case of SUSE, Red Hat or Oracle Linux, the VM agent is already part of the Azure Marketplace image.</span></span> <span data-ttu-id="17c39-1323">如果使用者會將 Linux VM 從內部部署上傳至 Azure，則必須手動安裝 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="17c39-1323">In case one would upload a Linux VM from on-premises to Azure the VM agent has to be installed manually.</span></span>

<span data-ttu-id="17c39-1324">適用於 SAP 之 Azure 監視解決方案的基本建置組塊如下所示：</span><span class="sxs-lookup"><span data-stu-id="17c39-1324">The basic building blocks of the Monitoring solution in Azure for SAP looks like this:</span></span>

![Microsoft Azure 擴充功能元件][planning-guide-figure-2400]

<span data-ttu-id="17c39-1326">如上面的區塊圖所示，適用於 SAP 之監視解決方案的一部分會裝載於 Azure VM 映像和 Azure 擴充功能資源庫，後者是由 Azure 營運團隊管理的全域複寫儲存機制。</span><span class="sxs-lookup"><span data-stu-id="17c39-1326">As shown in the block diagram above, one part of the monitoring solution for SAP is hosted in the Azure VM Image and Azure Extension Gallery which is a globally replicated repository that is managed by Azure Operations.</span></span> <span data-ttu-id="17c39-1327">SAP/MS 聯合團隊會負責處理 SAP 的 Azure 實作，並與 Azure 營運團隊合作發佈新版 Azure Monitoring Extension for SAP。</span><span class="sxs-lookup"><span data-stu-id="17c39-1327">It is the responsibility of the joint SAP/MS team working on the Azure implementation of SAP to work with Azure Operations to publish new versions of the Azure Monitoring Extension for SAP.</span></span>

<span data-ttu-id="17c39-1328">當您部署新的 Windows VM 時，會自動將「Azure VM 代理程式」加入 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-1328">When you deploy a new Windows VM, the ‘Azure VM Agent’ is automatically added into the VM.</span></span> <span data-ttu-id="17c39-1329">此代理程式的功能是協調用於監視 SAP NetWeaver 系統之 Azure 擴充功能的載入和設定。</span><span class="sxs-lookup"><span data-stu-id="17c39-1329">The function of this agent is to coordinate the loading and configuration of the Azure Extensions for monitoring of SAP NetWeaver Systems.</span></span> <span data-ttu-id="17c39-1330">針對 Linux VM，VM 代理程式已是 Azure Marketplace OS 映像的一部分。</span><span class="sxs-lookup"><span data-stu-id="17c39-1330">For Linux VMs the Azure VM Agent is already part of the Azure Marketplace OS image.</span></span>

<span data-ttu-id="17c39-1331">不過，客戶仍必須執行一個步驟。</span><span class="sxs-lookup"><span data-stu-id="17c39-1331">However, there is a step that still needs to be executed by the customer.</span></span> <span data-ttu-id="17c39-1332">那就是啟用及設定效能收集。</span><span class="sxs-lookup"><span data-stu-id="17c39-1332">This is the enablement and configuration of the performance collection.</span></span> <span data-ttu-id="17c39-1333">「設定」的相關程序會由 PowerShell 指令碼或 CLI 命令自動化。</span><span class="sxs-lookup"><span data-stu-id="17c39-1333">The process related to the ‘configuration’ is automated by a PowerShell script or CLI command.</span></span> <span data-ttu-id="17c39-1334">您可以從「Microsoft Azure 指令碼中心」下載 PowerShell 指令碼，如[部署指南][deployment-guide]所述。</span><span class="sxs-lookup"><span data-stu-id="17c39-1334">The PowerShell script can be downloaded in the Microsoft Azure Script Center as described in the [Deployment Guide][deployment-guide].</span></span>

<span data-ttu-id="17c39-1335">適用於 SAP 之 Azure 監視解決方案的整體架構如下所示︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1335">The overall Architecture of the Azure monitoring solution for SAP looks like:</span></span>

![適用於 SAP NetWeaver 的 Azure 監視解決方案][planning-guide-figure-2500]

<span data-ttu-id="17c39-1337">**如需確切的操作說明，以及在部署期間使用這些 PowerShell Cmdlet 或 CLI 命令的詳細步驟，請遵循[部署指南][deployment-guide]中所提供的指示。**</span><span class="sxs-lookup"><span data-stu-id="17c39-1337">**For the exact how-to and for detailed steps of using these PowerShell cmdlets or CLI command during deployments, follow the instructions given in the [Deployment Guide][deployment-guide].**</span></span>

### <a name="integration-of-azure-located-sap-instance-into-saprouter"></a><span data-ttu-id="17c39-1338">將位於 Azure 的 SAP 執行個體整合到 SAProuter</span><span class="sxs-lookup"><span data-stu-id="17c39-1338">Integration of Azure located SAP instance into SAProuter</span></span>
<span data-ttu-id="17c39-1339">在 Azure 中執行的 SAP 執行個體也必須能夠從 SAProuter 存取。</span><span class="sxs-lookup"><span data-stu-id="17c39-1339">SAP instances running in Azure need to be accessible from SAProuter as well.</span></span>

![SAP 路由器網路連線][planning-guide-figure-2600]

<span data-ttu-id="17c39-1341">如果沒有直接的 IP 連線，SAProuter 可啟用參與系統之間的 TCP/IP 通訊。</span><span class="sxs-lookup"><span data-stu-id="17c39-1341">A SAProuter enables the TCP/IP communication between participating systems if there is no direct IP connection.</span></span> <span data-ttu-id="17c39-1342">這樣做的優點是，通訊合作夥伴之間不需要有網路層級的端對端連線。</span><span class="sxs-lookup"><span data-stu-id="17c39-1342">This provides the advantage that no end-to-end connection between the communication partners is necessary on network level.</span></span> <span data-ttu-id="17c39-1343">SAProuter 預設會在連接埠 3299 接聽。</span><span class="sxs-lookup"><span data-stu-id="17c39-1343">The SAProuter is listening on port 3299 by default.</span></span>
<span data-ttu-id="17c39-1344">若要透過 SAProuter 連線 SAP 執行個體，您必須提供任何連線嘗試的 SAProuter 字串和主機名稱。</span><span class="sxs-lookup"><span data-stu-id="17c39-1344">To connect SAP instances through a SAProuter you need to give the SAProuter string and host name with any attempt to connect.</span></span>

## <a name="sap-netweaver-as-java"></a><span data-ttu-id="17c39-1345">SAP NetWeaver AS Java</span><span class="sxs-lookup"><span data-stu-id="17c39-1345">SAP NetWeaver AS Java</span></span>
<span data-ttu-id="17c39-1346">到目前為止，本文的重點放在 SAP NetWeaver 概觀或 SAP NetWeaver ABAP 堆疊。</span><span class="sxs-lookup"><span data-stu-id="17c39-1346">So far the focus of the document has been SAP NetWeaver in general or the SAP NetWeaver ABAP stack.</span></span> <span data-ttu-id="17c39-1347">在本小節中，會列出 SAP Java 堆疊的特定考量。</span><span class="sxs-lookup"><span data-stu-id="17c39-1347">In this small section, specific considerations for the SAP Java stack are listed.</span></span> <span data-ttu-id="17c39-1348">完全以 Java 為主的其中一個最重要 SAP NetWeaver 應用程式是 SAP 企業版入口網站。</span><span class="sxs-lookup"><span data-stu-id="17c39-1348">One of the most important SAP NetWeaver Java exclusively based applications is the SAP Enterprise Portal.</span></span> <span data-ttu-id="17c39-1349">其他 SAP NetWeaver 應用程式 (例如 SAP PI 和 SAP Solution Manager) 會同時使用 SAP NetWeaver ABAP 和 Java 堆疊。</span><span class="sxs-lookup"><span data-stu-id="17c39-1349">Other SAP NetWeaver based applications like SAP PI and SAP Solution Manager use both the SAP NetWeaver ABAP and Java stacks.</span></span> <span data-ttu-id="17c39-1350">因此，當然也需要考慮與 SAP NetWeaver Java 堆疊相關的特定層面。</span><span class="sxs-lookup"><span data-stu-id="17c39-1350">Therefore, there certainly is a need to consider specific aspects related to the SAP NetWeaver Java stack as well.</span></span>

### <a name="sap-enterprise-portal"></a><span data-ttu-id="17c39-1351">SAP 企業版入口網站</span><span class="sxs-lookup"><span data-stu-id="17c39-1351">SAP Enterprise Portal</span></span>
<span data-ttu-id="17c39-1352">如果您想要在跨單位案例中進行部署，Azure 虛擬機器中的 SAP 入口網站安裝與內部部署安裝並無不同。</span><span class="sxs-lookup"><span data-stu-id="17c39-1352">The setup of an SAP Portal in an Azure Virtual Machine does not differ from an on premises installation if you are deploying in cross-premises scenarios.</span></span> <span data-ttu-id="17c39-1353">因為 DNS 是在內部部署進行，所以可以像是已設定的內部部署來進行個別執行個體的連接埠設定。</span><span class="sxs-lookup"><span data-stu-id="17c39-1353">Since the DNS is done by on-premises, the port settings of the individual instances can be done as configured on-premises.</span></span> <span data-ttu-id="17c39-1354">一般而言，本文所述的建議和限制目前適用於 SAP 企業版入口網站或 SAP NetWeaver Java 堆疊等應用程式。</span><span class="sxs-lookup"><span data-stu-id="17c39-1354">The recommendations and restrictions described in this document so far apply for an application like SAP Enterprise Portal or the SAP NetWeaver Java stack in general.</span></span>

![公開的 SAP 入口網站][planning-guide-figure-2700]

<span data-ttu-id="17c39-1356">有些客戶的特殊部署案例會直接向網際網路公開 SAP 企業版入口網站，而且虛擬機器主機會透過站對站 VPN 通道或 ExpressRoute 連線到公司網路。</span><span class="sxs-lookup"><span data-stu-id="17c39-1356">A special deployment scenario by some customers is the direct exposure of the SAP Enterprise Portal to the Internet while the virtual machine host is connected to the company network via site-to-site VPN tunnel or ExpressRoute.</span></span> <span data-ttu-id="17c39-1357">在此案例中，您必須確定特定連接埠已開啟，並且未遭到防火牆或網路安全性群組封鎖。</span><span class="sxs-lookup"><span data-stu-id="17c39-1357">For such a scenario, you have to make sure that specific ports are open and not blocked by firewall or network security group.</span></span> <span data-ttu-id="17c39-1358">當您想要在僅限雲端案例中，從內部部署連線到 SAP Java 執行個體時，則必須套用相同的機制。</span><span class="sxs-lookup"><span data-stu-id="17c39-1358">The same mechanics would need to be applied when you want to connect to an SAP Java instance from on-premises in a Cloud-Only scenario.</span></span>

<span data-ttu-id="17c39-1359">初始入口網站 URI 為 http(s):`<Portalserver`>:5XX00/irj，其中連接埠是由 50000 加上 (系統編號 × 100) 來形成。</span><span class="sxs-lookup"><span data-stu-id="17c39-1359">The initial portal URI is http(s):`<Portalserver`>:5XX00/irj where the port is formed by 50000 plus (Systemnumber × 100).</span></span> <span data-ttu-id="17c39-1360">SAP 系統 00 的預設入口網站 URI 為 `<dns name`>.`<azure region`>.Cloudapp.azure.com:PublicPort/irj。</span><span class="sxs-lookup"><span data-stu-id="17c39-1360">The default portal URI of SAP system 00 is `<dns name`>.`<azure region`>.Cloudapp.azure.com:PublicPort/irj.</span></span> <span data-ttu-id="17c39-1361">如需詳細資訊，請參閱 <http://help.sap.com/saphelp_nw70ehp1/helpdata/de/a2/f9d7fed2adc340ab462ae159d19509/frameset.htm>。</span><span class="sxs-lookup"><span data-stu-id="17c39-1361">For more details, have a look at <http://help.sap.com/saphelp_nw70ehp1/helpdata/de/a2/f9d7fed2adc340ab462ae159d19509/frameset.htm>.</span></span>

![端點組態][planning-guide-figure-2800]

<span data-ttu-id="17c39-1363">如果您想要自訂 SAP 企業版入口網站的的 URL 及 (或) 連接埠，請參閱下列文件︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1363">If you want to customize the URL and/or ports of your SAP Enterprise Portal, please check this documentation:</span></span>

* [<span data-ttu-id="17c39-1364">Change Portal URL (變更入口網站 URL)</span><span class="sxs-lookup"><span data-stu-id="17c39-1364">Change Portal URL</span></span>](http://wiki.scn.sap.com/wiki/display/EP/Change+Portal+URL)
* [<span data-ttu-id="17c39-1365">Change Default port numbers, Portal port numbers (變更預設連接埠號碼、入口網站連接埠號碼)</span><span class="sxs-lookup"><span data-stu-id="17c39-1365">Change Default port numbers, Portal port numbers</span></span>](http://wiki.scn.sap.com/wiki/display/NWTech/Change+Default++port+numbers%2C+Portal+port+numbers)

## <a name="high-availability-ha-and-disaster-recovery-dr-for-sap-netweaver-running-on-azure-virtual-machines"></a><span data-ttu-id="17c39-1366">Azure 虛擬機器上執行之 SAP NetWeaver 的高可用性 (HA) 和災害復原 (DR)</span><span class="sxs-lookup"><span data-stu-id="17c39-1366">High Availability (HA) and Disaster Recovery (DR) for SAP NetWeaver running on Azure Virtual Machines</span></span>
### <a name="definition-of-terminologies"></a><span data-ttu-id="17c39-1367">術語定義</span><span class="sxs-lookup"><span data-stu-id="17c39-1367">Definition of terminologies</span></span>
<span data-ttu-id="17c39-1368">**高可用性 (HA)** 一詞通常與一組技術相關，該組技術可透過**相同**資料中心內受備援、容錯或容錯移轉保護的元件，提供 IT 服務的商務持續性，藉此將 IT 中斷的情況降到最低。</span><span class="sxs-lookup"><span data-stu-id="17c39-1368">The term **high availability (HA)** is generally related to a set of technologies that minimizes IT disruptions by providing business continuity of IT services through redundant, fault-tolerant or failover protected components inside the **same** data center.</span></span> <span data-ttu-id="17c39-1369">在本例中，會是在一個 Azure 區域內。</span><span class="sxs-lookup"><span data-stu-id="17c39-1369">In our case, within one Azure Region.</span></span>

<span data-ttu-id="17c39-1370">**災害復原 (DR)** 的目標也是將 IT 服務中斷的情況降到最低，但其復原通常會橫跨距離數百公里遠的**不同**資料中心。</span><span class="sxs-lookup"><span data-stu-id="17c39-1370">**Disaster recovery (DR)** is also targeting minimizing IT services disruption, and their recovery but across **different** data centers, that are usually located hundreds of kilometers away.</span></span> <span data-ttu-id="17c39-1371">在本例中，通常是相同地緣政治區域內的不同 Azure 區域之間，或由身為客戶的您所建立。</span><span class="sxs-lookup"><span data-stu-id="17c39-1371">In our case usually between different Azure Regions within the same geopolitical region or as established by you as a customer.</span></span>

### <a name="overview-of-high-availability"></a><span data-ttu-id="17c39-1372">高可用性概觀</span><span class="sxs-lookup"><span data-stu-id="17c39-1372">Overview of High Availability</span></span>
<span data-ttu-id="17c39-1373">Azure 中之 SAP 高可用性的相關討論可分為兩個部分：</span><span class="sxs-lookup"><span data-stu-id="17c39-1373">We can separate the discussion about SAP high availability in Azure into two parts:</span></span>

* <span data-ttu-id="17c39-1374">**Azure 基礎結構高可用性** (例如計算 (VM)、網路、儲存體等的 HA)，以及它在增加 SAP 應用程式可用性方面的優點。</span><span class="sxs-lookup"><span data-stu-id="17c39-1374">**Azure infrastructure high availability**, for example HA of compute (VMs), network, storage etc. and its benefits for increasing SAP application availability.</span></span>
* <span data-ttu-id="17c39-1375">**SAP 應用程式高可用性** (例如 SAP 軟體元件的 HA)︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1375">**SAP application high availability**, for example HA of SAP software components:</span></span>
  * <span data-ttu-id="17c39-1376">SAP 應用程式伺服器</span><span class="sxs-lookup"><span data-stu-id="17c39-1376">SAP application servers</span></span>
  * <span data-ttu-id="17c39-1377">SAP ASCS/SCS 執行個體</span><span class="sxs-lookup"><span data-stu-id="17c39-1377">SAP ASCS/SCS instance</span></span>
  * <span data-ttu-id="17c39-1378">DB 伺服器</span><span class="sxs-lookup"><span data-stu-id="17c39-1378">DB server</span></span>

<span data-ttu-id="17c39-1379">以及如何與 Azure 基礎結構 HA 結合。</span><span class="sxs-lookup"><span data-stu-id="17c39-1379">and how it can be combined with Azure infrastructure HA.</span></span>

<span data-ttu-id="17c39-1380">Azure 中的 SAP 高可用性與內部部署實體或虛擬環境中的 SAP 高可用性相較下，有一些差異。</span><span class="sxs-lookup"><span data-stu-id="17c39-1380">SAP High Availability in Azure has some differences compared to SAP High Availability in an on-premises physical or virtual environment.</span></span> <span data-ttu-id="17c39-1381">下列來自 SAP 的文件說明 Windows 虛擬環境中的標準「SAP 高可用性」組態︰<http://scn.sap.com/docs/DOC-44415>。</span><span class="sxs-lookup"><span data-stu-id="17c39-1381">The following paper from SAP describes standard SAP High Availability configurations in virtualized environments on Windows: <http://scn.sap.com/docs/DOC-44415>.</span></span> <span data-ttu-id="17c39-1382">不同於 Windows，Linux 沒有整合 sapinst 的 SAP-HA 組態。</span><span class="sxs-lookup"><span data-stu-id="17c39-1382">There is no sapinst-integrated SAP-HA configuration for Linux like it exists for Windows.</span></span> <span data-ttu-id="17c39-1383">如需有關 Linux 之內部部署 SAP HA 的詳細資訊，請參閱︰<http://scn.sap.com/docs/DOC-8541>。</span><span class="sxs-lookup"><span data-stu-id="17c39-1383">Regarding SAP HA on-premises for Linux find more information here: <http://scn.sap.com/docs/DOC-8541>.</span></span>

### <a name="azure-infrastructure-high-availability"></a><span data-ttu-id="17c39-1384">Azure 基礎結構高可用性</span><span class="sxs-lookup"><span data-stu-id="17c39-1384">Azure Infrastructure High Availability</span></span>
<span data-ttu-id="17c39-1385">目前 99.9% 都是單一 VM SLA。</span><span class="sxs-lookup"><span data-stu-id="17c39-1385">There is currently a single-VM SLA of 99.9%.</span></span> <span data-ttu-id="17c39-1386">若要了解單一 VM 可用性可能有的樣貌，您可以直接建立不同可用 Azure SLA 的乘積︰<https://azure.microsoft.com/support/legal/sla/>。</span><span class="sxs-lookup"><span data-stu-id="17c39-1386">To get an idea how the availability of a single VM might look like you can simply build the product of the different available Azure SLAs: <https://azure.microsoft.com/support/legal/sla/>.</span></span>

<span data-ttu-id="17c39-1387">計算基礎是每個月 30 天 (或 43200 分鐘)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1387">The basis for the calculation is 30 days per month, or 43200 minutes.</span></span> <span data-ttu-id="17c39-1388">因此，0.05% 停機時間會對應至 21.6 分鐘。</span><span class="sxs-lookup"><span data-stu-id="17c39-1388">Therefore, 0.05% downtime corresponds to 21.6 minutes.</span></span> <span data-ttu-id="17c39-1389">像往常一樣，不同服務的可用性會以下列方式相乘︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1389">As usual, the availability of the different services will multiply in the following way:</span></span>

<span data-ttu-id="17c39-1390">(可用性服務 #1/100) * (可用性服務 #2/100) * (可用性服務 #3/100) *...</span><span class="sxs-lookup"><span data-stu-id="17c39-1390">(Availability Service #1/100) * (Availability Service #2/100) * (Availability Service #3/100) *…</span></span>

<span data-ttu-id="17c39-1391">例如：</span><span class="sxs-lookup"><span data-stu-id="17c39-1391">Like:</span></span>

<span data-ttu-id="17c39-1392">(99.95/100) * (99.9/100) * (99.9/100) = 0.9975 或整體可用性 99.75%。</span><span class="sxs-lookup"><span data-stu-id="17c39-1392">(99.95/100) * (99.9/100) * (99.9/100) = 0.9975 or an overall availability of 99.75%.</span></span>

#### <a name="virtual-machine-vm-high-availability"></a><span data-ttu-id="17c39-1393">虛擬機器 (VM) 高可用性</span><span class="sxs-lookup"><span data-stu-id="17c39-1393">Virtual Machine (VM) High Availability</span></span>
<span data-ttu-id="17c39-1394">有兩種可以影響您虛擬機器可用性的 Azure 平台事件：計劃性維護和非計劃性維護。</span><span class="sxs-lookup"><span data-stu-id="17c39-1394">There are two types of Azure platform events that can affect the availability of your virtual machines: planned maintenance and unplanned maintenance.</span></span>

* <span data-ttu-id="17c39-1395">規劃的維護事件 是由 Microsoft 對基礎 Azure 平台進行的定期更新，為虛擬機器在其中執行的平台基礎結構改善整體可靠性、效能和安全性。</span><span class="sxs-lookup"><span data-stu-id="17c39-1395">Planned maintenance events are periodic updates made by Microsoft to the underlying Azure platform to improve overall reliability, performance, and security of the platform infrastructure that your virtual machines run on.</span></span>
* <span data-ttu-id="17c39-1396">未規劃的維護事件會在虛擬機器中的硬體或實體基礎結構產生某些方面的錯誤時發生。</span><span class="sxs-lookup"><span data-stu-id="17c39-1396">Unplanned maintenance events occur when the hardware or physical infrastructure underlying your virtual machine has faulted in some way.</span></span> <span data-ttu-id="17c39-1397">這可能包含本機網路錯誤、本機磁碟錯誤，或其他機架層級的錯誤。</span><span class="sxs-lookup"><span data-stu-id="17c39-1397">This may include local network failures, local disk failures, or other rack level failures.</span></span> <span data-ttu-id="17c39-1398">Azure 平台會在偵測到此類錯誤時，自動從裝載虛擬機器且狀況不良的實體伺服器，將虛擬機器移轉至狀況良好的實體伺服器。</span><span class="sxs-lookup"><span data-stu-id="17c39-1398">When such a failure is detected, the Azure platform will automatically migrate your virtual machine from the unhealthy physical server hosting your virtual machine to a healthy physical server.</span></span> <span data-ttu-id="17c39-1399">這類事件非常稀少，但可能會導致虛擬機器重新啟動。</span><span class="sxs-lookup"><span data-stu-id="17c39-1399">Such events are rare, but may also cause your virtual machine to reboot.</span></span>

<span data-ttu-id="17c39-1400">如需更多詳細資訊，請參閱這份文件︰<http://azure.microsoft.com/documentation/articles/virtual-machines-manage-availability></span><span class="sxs-lookup"><span data-stu-id="17c39-1400">More details can be found in this documentation: <http://azure.microsoft.com/documentation/articles/virtual-machines-manage-availability></span></span>

#### <a name="azure-storage-redundancy"></a><span data-ttu-id="17c39-1401">Azure 儲存體備援</span><span class="sxs-lookup"><span data-stu-id="17c39-1401">Azure Storage Redundancy</span></span>
<span data-ttu-id="17c39-1402">Microsoft Azure 儲存體帳戶中的資料一律會進行複寫以確保持久性及高可用性，即使在面對暫時性的硬體故障時，仍可滿足 Azure 儲存體 SLA。</span><span class="sxs-lookup"><span data-stu-id="17c39-1402">The data in your Microsoft Azure Storage Account is always replicated to ensure durability and high availability, meeting the Azure Storage SLA even in the face of transient hardware failures.</span></span>

<span data-ttu-id="17c39-1403">由於 Azure 儲存體預設會保留三個資料映像，因此不需要跨多個 Azure 磁碟的 RAID5 或 RAID1。</span><span class="sxs-lookup"><span data-stu-id="17c39-1403">Since Azure Storage is keeping three images of the data by default, RAID5 or RAID1 across multiple Azure disks are not necessary.</span></span>

<span data-ttu-id="17c39-1404">如需更多詳細資訊，請參閱這篇文章︰<http://azure.microsoft.com/documentation/articles/storage-redundancy/></span><span class="sxs-lookup"><span data-stu-id="17c39-1404">More details can be found in this article: <http://azure.microsoft.com/documentation/articles/storage-redundancy/></span></span>

#### <a name="utilizing-azure-infrastructure-vm-restart-to-achieve-higher-availability-of-sap-applications"></a><span data-ttu-id="17c39-1405">使用 Azure 基礎結構 VM 重新啟動達到 SAP 應用程式的「更高可用性」</span><span class="sxs-lookup"><span data-stu-id="17c39-1405">Utilizing Azure Infrastructure VM Restart to Achieve “Higher Availability” of SAP Applications</span></span>
<span data-ttu-id="17c39-1406">如果您決定不使用 Windows Server 容錯移轉叢集 (WSFC) 或 Linux 上的 Pacemaker (目前僅支援 SLES 12 及更新版本)，則會使用 Azure VM 重新啟動來保護 SAP 系統，以防止 Azure 實體伺服器基礎結構和整體基礎 Azure 平台發生規劃和未規劃的停機。</span><span class="sxs-lookup"><span data-stu-id="17c39-1406">If you decide not to use functionalities like Windows Server Failover Clustering (WSFC) or Pacemaker on Linux (currently only supported for SLES 12 and higher), Azure VM Restart is utilized to protect an SAP System against planned and unplanned downtime of the Azure physical server infrastructure and overall underlying Azure platform.</span></span>

> [!NOTE]
> <span data-ttu-id="17c39-1407">請注意，Azure VM 重新啟動主要是保護 VM，而不是應用程式。</span><span class="sxs-lookup"><span data-stu-id="17c39-1407">It is important to mention that Azure VM Restart primarily protects VMs and NOT applications.</span></span> <span data-ttu-id="17c39-1408">VM 重新啟動並未提供 SAP 應用程式的高可用性，而是提供特定基礎結構層級的可用性，因而間接達到 SAP 系統的「更高可用性」。</span><span class="sxs-lookup"><span data-stu-id="17c39-1408">VM Restart does not offer high availability for SAP applications, but it does offer a certain level of infrastructure availability and therefore indirectly “higher availability” of SAP systems.</span></span> <span data-ttu-id="17c39-1409">此外，在規劃或未規劃的主機中斷之後重新啟動 VM 所需的時間，也沒有 SLA。</span><span class="sxs-lookup"><span data-stu-id="17c39-1409">There is also no SLA for the time it will take to restart a VM after a planned or unplanned host outage.</span></span> <span data-ttu-id="17c39-1410">因此，此「高可用性」方法不適用於 SAP 系統的重要元件，例如 (A)SCS 或 DBMS。</span><span class="sxs-lookup"><span data-stu-id="17c39-1410">Therefore, this method of ‘high availability’ is not suitable for critical components of an SAP system like (A)SCS or DBMS.</span></span>
>
>

<span data-ttu-id="17c39-1411">高可用性的另一個重要基礎結構項目是儲存體。</span><span class="sxs-lookup"><span data-stu-id="17c39-1411">Another important infrastructure element for high availability is storage.</span></span> <span data-ttu-id="17c39-1412">例如，Azure 儲存體 SLA 可用性為 99.9%。</span><span class="sxs-lookup"><span data-stu-id="17c39-1412">For example Azure Storage SLA is 99,9 % availability.</span></span> <span data-ttu-id="17c39-1413">如果使用者將所有 VM 及其磁碟部署到單一 Azure 儲存體帳戶，當 Azure 儲存體可能無法使用時，將會導致 Azure 儲存體帳戶中的所有 VM，以及這些 VM 內執行的所有 SAP 元件都無法使用。</span><span class="sxs-lookup"><span data-stu-id="17c39-1413">If one deploys all VMs with its disks into a single Azure Storage Account, potential Azure Storage unavailability will cause unavailability of all VMs that are placed in that Azure Storage Account, and also all SAP components running inside of those VMs.</span></span>  

<span data-ttu-id="17c39-1414">您也可以針對每個 VM 使用專用儲存體帳戶，而不是將所有 VM 放入單一 Azure 儲存體帳戶；如此一來，您就可以藉由使用多個獨立的 Azure 儲存體帳戶，來增加整體 VM 和 SAP 應用程式可用性。</span><span class="sxs-lookup"><span data-stu-id="17c39-1414">Instead of putting all VMs into one single Azure Storage Account, you can also use dedicated storage accounts for each VM, and in this way increase overall VM and SAP application availability by using multiple independent Azure Storage Accounts.</span></span>

<span data-ttu-id="17c39-1415">Azure 受控磁碟會自動放在其所連接虛擬機器的容錯網域。</span><span class="sxs-lookup"><span data-stu-id="17c39-1415">Azure Managed Disks are automatically placed in the Fault Domain of the virtual machine they are attached to.</span></span> <span data-ttu-id="17c39-1416">如果您將兩部虛擬機器放在可用性設定組中並使用受控磁碟，平台也會負責將受控磁碟散發到不同容錯網域。</span><span class="sxs-lookup"><span data-stu-id="17c39-1416">If you place two virtual machines in an availability set and use Managed Disks, the platform will take care of distributing the Managed Disks into different Fault Domains as well.</span></span> <span data-ttu-id="17c39-1417">如果您打算使用進階儲存體，強烈建議也要使用受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-1417">If you plan to use Premium Storage, we highly recommend using Manage Disks as well.</span></span>

<span data-ttu-id="17c39-1418">使用 Azure 基礎結構 HA 和儲存體帳戶之 SAP NetWeaver 系統的範例架構如下所示︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1418">A sample architecture of an SAP NetWeaver system that uses Azure infrastructure HA and storage accounts could look like this:</span></span>

![使用 Azure 基礎結構 HA 達到 SAP 應用程式的「更高」可用性][planning-guide-figure-2900]

<span data-ttu-id="17c39-1420">使用 Azure 基礎結構 HA 和受控磁碟之 SAP NetWeaver 系統的範例架構如下所示︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1420">A sample architecture of an SAP NetWeaver system that uses Azure infrastructure HA and Managed Disks could look like this:</span></span>

![使用 Azure 基礎結構 HA 達到 SAP 應用程式的「更高」可用性][planning-guide-figure-2901]

<span data-ttu-id="17c39-1422">針對重要的 SAP 元件，我們目前為止已達到︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1422">For critical SAP components we achieved the following so far:</span></span>

* <span data-ttu-id="17c39-1423">SAP 應用程式伺服器 (AS) 的高可用性</span><span class="sxs-lookup"><span data-stu-id="17c39-1423">High Availability of SAP Application Servers (AS)</span></span>

  <span data-ttu-id="17c39-1424">SAP 應用程式伺服器執行個體是備援元件。</span><span class="sxs-lookup"><span data-stu-id="17c39-1424">SAP application server instances are redundant components.</span></span> <span data-ttu-id="17c39-1425">每個 SAP AS 執行個體都是部署在自己的 VM 上，而此 VM 是在不同的 Azure「容錯網域」及「升級網域」中執行 (請參閱[容錯網域][planning-guide-3.2.1]和[升級網域][planning-guide-3.2.2]章節)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1425">Each SAP AS instance is deployed on its own VM, that is running in a different Azure Fault and Upgrade Domain (see chapters [Fault Domains][planning-guide-3.2.1] and [Upgrade Domains][planning-guide-3.2.2]).</span></span> <span data-ttu-id="17c39-1426">這是藉由使用「Azure 可用性設定組」來加以確保 (請參閱 [Azure 可用性設定組][planning-guide-3.2.3]一章)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1426">This is ensured by using Azure Availability Sets (see chapter [Azure Availability Sets][planning-guide-3.2.3]).</span></span> <span data-ttu-id="17c39-1427">當 Azure 容錯或升級網域可能因規劃或未規劃而無法使用時，將會導致有限數目的 VM 及其 SAP AS 執行個體無法使用。</span><span class="sxs-lookup"><span data-stu-id="17c39-1427">Potential planned or unplanned unavailability of an Azure Fault or Upgrade Domain will cause unavailability of a restricted number of VMs with their SAP AS instances.</span></span>

  <span data-ttu-id="17c39-1428">每個 SAP 執行個體都會在自己的 Azure 儲存體帳戶中 - 當一個 Azure 儲存體可能無法使用時，只會導致一個 VM 及其 SAP AS 執行個體無法使用。</span><span class="sxs-lookup"><span data-stu-id="17c39-1428">Each SAP AS instance is placed in its own Azure Storage account – potential unavailability of one Azure Storage Account will cause unavailability of only one VM with its SAP AS instance.</span></span> <span data-ttu-id="17c39-1429">不過請注意，一個 Azure 訂用帳戶中的「Azure 儲存體帳戶」數目有限。</span><span class="sxs-lookup"><span data-stu-id="17c39-1429">However, be aware that there is a limit of Azure Storage Accounts within one Azure subscription.</span></span> <span data-ttu-id="17c39-1430">為了確保在 VM 重新啟動後會自動啟動 (A)SCS 執行個體，請務必在[對 SAP 執行個體使用自動啟動][planning-guide-11.5]一章所述的 (A)SCS 執行個體啟動設定檔中，設定 Autostart 參數。</span><span class="sxs-lookup"><span data-stu-id="17c39-1430">To ensure automatic start of (A)SCS instance after the VM reboot, make sure to set the Autostart parameter in (A)SCS instance start profile described in chapter [Using Autostart for SAP instances][planning-guide-11.5].</span></span>
  <span data-ttu-id="17c39-1431">如需更多詳細資料，另請參閱 [SAP 應用程式伺服器的高可用性][planning-guide-11.4.1]一章。</span><span class="sxs-lookup"><span data-stu-id="17c39-1431">Please also read chapter [High Availability for SAP Application Servers][planning-guide-11.4.1] for more details.</span></span>

  <span data-ttu-id="17c39-1432">即使您使用受控磁碟，這些磁碟也會儲存在 Azure 儲存體帳戶，而且在儲存體發生中斷時會無法使用。</span><span class="sxs-lookup"><span data-stu-id="17c39-1432">Even if you use Managed Disks, those disks are also stored in an Azure Storage Account and can be unavailable in an event of a storage outage.</span></span>

* <span data-ttu-id="17c39-1433"> SAP (A)SCS 執行個體可用性</span><span class="sxs-lookup"><span data-stu-id="17c39-1433">*Higher* Availability of SAP (A)SCS instance</span></span>

  <span data-ttu-id="17c39-1434">我們在此處使用 Azure VM 重新啟動，來保護已安裝 SAP (A)SCS 執行個體的 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-1434">Here we utilize Azure VM Restart to protect the VM with installed SAP (A)SCS instance.</span></span> <span data-ttu-id="17c39-1435">如果 Azure 伺服器發生規劃或未規劃的停機，則會在另一個可用的伺服器上重新啟動 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-1435">In the case of planned or unplanned downtime of Azure severs, VMs will be restarted on another available server.</span></span> <span data-ttu-id="17c39-1436">如前所述，在此 (A)SCS 執行個體案例中，Azure VM 重新啟動主要是保護 VM，而不是應用程式。</span><span class="sxs-lookup"><span data-stu-id="17c39-1436">As mentioned earlier, Azure VM Restart primarily protects VMs and NOT applications, in this case the (A)SCS instance.</span></span> <span data-ttu-id="17c39-1437">透過 VM 重新啟動，我們可間接達到 SAP (A)SCS 執行個體的「更高可用性」。</span><span class="sxs-lookup"><span data-stu-id="17c39-1437">Through the VM Restart we’ll reach indirectly “higher availability” of SAP (A)SCS instance.</span></span> <span data-ttu-id="17c39-1438">為了確保在 VM 重新啟動後會自動啟動 (A)SCS 執行個體，請務必在[對 SAP 執行個體使用自動啟動][planning-guide-11.5]一章所述的 (A)SCS 執行個體啟動設定檔中，設定 Autostart 參數。</span><span class="sxs-lookup"><span data-stu-id="17c39-1438">To insure automatic start of (A)SCS instance after the VM reboot, make sure to set Autostart parameter in (A)SCS instance start profile described in chapter [Using Autostart for SAP instances][planning-guide-11.5].</span></span> <span data-ttu-id="17c39-1439">這表示 (A)SCS 執行個體會當做單一 VM 上執行的單一失敗點 (SPOF)，以決定整個 SAP 環境是否可用。</span><span class="sxs-lookup"><span data-stu-id="17c39-1439">This means the (A)SCS instance as a Single Point of Failure (SPOF) running in a single VM will be the determinative factor for the availability of the whole SAP landscape.</span></span>

* <span data-ttu-id="17c39-1440"> DBMS 伺服器可用性</span><span class="sxs-lookup"><span data-stu-id="17c39-1440">*Higher* Availability of DBMS Server</span></span>

  <span data-ttu-id="17c39-1441">類似於 SAP (A) SCS 執行個體使用案例，我們在此使用 Azure VM 重新啟動，來保護已安裝 DBMS 軟體的 VM，並透過 VM 重新啟動達到 DBMS 軟體的「高可用性」。</span><span class="sxs-lookup"><span data-stu-id="17c39-1441">Here, similar to the SAP (A)SCS instance use case, we utilize Azure VM Restart to protect the VM with installed DBMS software, and we achieve “higher availability” of DBMS software through VM Restart.</span></span>
  <span data-ttu-id="17c39-1442">在單一 VM 中執行的 DBMS 也是 SPOF，它會決定整個 SAP 環境是否可用。</span><span class="sxs-lookup"><span data-stu-id="17c39-1442">DBMS running in a single VM is also a SPOF, and it is the determinative factor for the availability of the whole SAP landscape.</span></span>

### <a name="sap-application-high-availability-on-azure-iaas"></a><span data-ttu-id="17c39-1443">Azure IaaS 上的 SAP 應用程式高可用性</span><span class="sxs-lookup"><span data-stu-id="17c39-1443">SAP Application High Availability on Azure IaaS</span></span>
<span data-ttu-id="17c39-1444">為了達到完整 SAP 系統高可用性，我們需要保護所有重要的 SAP 系統元件 (例如備援 SAP 應用程式伺服器)，以及 SAP (A)SCS 執行個體和 DBMS 等獨特的元件 (例如單一失敗點)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1444">To achieve full SAP system high availability, we need to protect all critical SAP system components, for example redundant SAP application servers, and unique components (for example Single Point of Failure) like SAP (A)SCS instance and DBMS.</span></span>

#### <span data-ttu-id="17c39-1445"><a name="5d9d36f9-9058-435d-8367-5ad05f00de77"></a>SAP 應用程式伺服器的高可用性</span><span class="sxs-lookup"><span data-stu-id="17c39-1445"><a name="5d9d36f9-9058-435d-8367-5ad05f00de77"></a>High Availability for SAP Application Servers</span></span>
<span data-ttu-id="17c39-1446">針對 SAP 應用程式伺服器/對話方塊執行個體，您不必考慮特定高可用性解決方案。</span><span class="sxs-lookup"><span data-stu-id="17c39-1446">For the SAP application servers/dialog instances it’s not necessary to think about a specific high availability solution.</span></span> <span data-ttu-id="17c39-1447">高可用性可直接透過備援來達成，因此必須在不同的虛擬機器中有足夠的備援。</span><span class="sxs-lookup"><span data-stu-id="17c39-1447">High availability is simply achieved by redundancy and thereby having enough of them in different virtual machines.</span></span> <span data-ttu-id="17c39-1448">它們應該會全部放相同的 Azure 可用性設定組中，以避免在規劃的維護停機時間內可能會同時更新 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-1448">They should all be placed in the same Azure Availability Set to avoid that the VMs might be updated at the same time during planned maintenance downtime.</span></span> <span data-ttu-id="17c39-1449">[升級網域][planning-guide-3.2.2]一章已介紹以「Azure 縮放單位」內不同「升級網域」和「容錯網域」為基礎的基本功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-1449">The basic functionality which builds on different Upgrade and Fault Domains within an Azure Scale Unit was already introduced in chapter [Upgrade Domains][planning-guide-3.2.2].</span></span> <span data-ttu-id="17c39-1450">本文件的 [Azure 可用性設定組][planning-guide-3.2.3]一章則提供「Azure 可用性設定組」的說明。</span><span class="sxs-lookup"><span data-stu-id="17c39-1450">Azure Availability Sets were presented in chapter [Azure Availability Sets][planning-guide-3.2.3] of this document.</span></span>

<span data-ttu-id="17c39-1451">Azure 縮放單位內的 Azure 可用性設定組可使用不限數目的容錯和升級網域。</span><span class="sxs-lookup"><span data-stu-id="17c39-1451">There is no infinite number of Fault and Upgrade Domains that can be used by an Azure Availability Set within an Azure Scale Unit.</span></span> <span data-ttu-id="17c39-1452">這表示將一些 VM 放在一個可用性設定組中，遲早會有多個 VM 最後位於同一個容錯或升級網域中。</span><span class="sxs-lookup"><span data-stu-id="17c39-1452">This means that putting a number of VMs into one Availability Set, sooner or later more than one VM ends up in the same Fault or Upgrade Domain.</span></span>

<span data-ttu-id="17c39-1453">將一些 SAP 應用程式伺服器執行個體部署在其專用 VM 中，並假設我們有五個升級網域，最後會形成下圖。</span><span class="sxs-lookup"><span data-stu-id="17c39-1453">Deploying a few SAP application server instances in their dedicated VMs and assuming that we got five Upgrade Domains, the following picture emerges at the end.</span></span> <span data-ttu-id="17c39-1454">可用性設定組內之容錯和更新網域的實際數目上限未來可能會有所變更︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1454">The actual max number of fault and update domains within an availability set might change in the future:</span></span>

![Azure 中 SAP 應用程式伺服器的 HA][planning-guide-figure-3000]

<span data-ttu-id="17c39-1456">如需更多詳細資訊，請參閱這份文件︰<http://azure.microsoft.com/documentation/articles/virtual-machines-manage-availability></span><span class="sxs-lookup"><span data-stu-id="17c39-1456">More details can be found in this documentation: <http://azure.microsoft.com/documentation/articles/virtual-machines-manage-availability></span></span>

#### <a name="high-availability-for-the-sap-ascs-instance-on-windows"></a><span data-ttu-id="17c39-1457">Windows 上 SAP (A)SCS 執行個體的高可用性</span><span class="sxs-lookup"><span data-stu-id="17c39-1457">High Availability for the SAP (A)SCS instance on Windows</span></span>
<span data-ttu-id="17c39-1458">Windows Server 容錯移轉叢集 (WSFC) 是常用來保護 SAP (A)SCS 執行個體的解決方案。</span><span class="sxs-lookup"><span data-stu-id="17c39-1458">Windows Server Failover Cluster (WSFC) is a frequently used solution to protect the SAP (A)SCS instance.</span></span> <span data-ttu-id="17c39-1459">它也會以「HA 安裝」的形式整合到 sapinst。</span><span class="sxs-lookup"><span data-stu-id="17c39-1459">It is also integrated into sapinst in form of an "HA installation".</span></span> <span data-ttu-id="17c39-1460">Azure 基礎結構目前無法提供功能，以與內部部署相同的方式來設定必要的 Windows Server 容錯移轉叢集。</span><span class="sxs-lookup"><span data-stu-id="17c39-1460">At this point in time the Azure infrastructure is not able to provide the functionality to set up the required Windows Server Failover Cluster the same way as it's done on-premises.</span></span>

<span data-ttu-id="17c39-1461">截至 2016 年 1 月為止，執行 Windows 作業系統的 Azure 雲端平台無法使用兩個 Azure VM 間之共用磁碟上的叢集共用磁碟區。</span><span class="sxs-lookup"><span data-stu-id="17c39-1461">As of January 2016 the Azure cloud platform running the Windows operating system does not provide the possibility of using a cluster shared volume on a disk shared between two Azure VMs.</span></span>

<span data-ttu-id="17c39-1462">不過，您可以使用協力廠商軟體，藉由可整合到 WSFC 的同步和透明磁碟複寫來提供共用磁碟區，以有效地解決這個問題。</span><span class="sxs-lookup"><span data-stu-id="17c39-1462">A valid solution though is the usage of 3rd-party software which provides a shared volume by synchronous and transparent disk replication which can be integrated into WSFC.</span></span> <span data-ttu-id="17c39-1463">此方法表示只有作用中的叢集節點能夠一次存取一個磁碟複本。</span><span class="sxs-lookup"><span data-stu-id="17c39-1463">This approach implies that only the active cluster node is able to access one of the disk copies at a point in time.</span></span> <span data-ttu-id="17c39-1464">截至 2016 年 1 月為止，提供此 HA 組態的支援，可搭配協力廠商軟體 SIOS DataKeeper，來保護 Azure VM 之 Windows 客體 OS 上的 SAP (A)SCS 執行個體。</span><span class="sxs-lookup"><span data-stu-id="17c39-1464">As of January 2016 this HA configuration is supported to protect the SAP (A)SCS instance on Windows guest OS on Azure VMs in combination with 3rd-party software SIOS DataKeeper.</span></span>

<span data-ttu-id="17c39-1465">SIOS DataKeeper 解決方案提供共用磁碟叢集資源給 Windows 容錯移轉叢集，而且︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1465">The SIOS DataKeeper solution provides a shared disk cluster resource to Windows Failover Clusters by having:</span></span>

* <span data-ttu-id="17c39-1466">會將額外的 Azure VHD 連接到 Windows 叢集組態中的每個虛擬機器 (VM)</span><span class="sxs-lookup"><span data-stu-id="17c39-1466">An additional Azure VHD attached to each of the virtual machines (VMs) that are in a Windows Cluster configuration</span></span>
* <span data-ttu-id="17c39-1467">會在兩個 VM 節點上執行 SIOS DataKeeper Cluster Edition</span><span class="sxs-lookup"><span data-stu-id="17c39-1467">SIOS DataKeeper Cluster Edition running on both VM nodes</span></span>
* <span data-ttu-id="17c39-1468">會設定 SIOS DataKeeper Cluster Edition，讓來源 VM 之連接到其他 VHD 的磁碟區，能夠以同步方式鏡像至目標 VM 之連接到其他 VHD 的磁碟區。</span><span class="sxs-lookup"><span data-stu-id="17c39-1468">Having SIOS DataKeeper Cluster Edition configured in a way that it synchronously mirrors the content of the additional VHD attached volume from source VMs to additional VHD attached volume of target VM.</span></span>
* <span data-ttu-id="17c39-1469">SIOS DataKeeper 會提取來源和目標本機磁碟區，並以單一共用磁碟形式呈現給 Windows 容錯移轉叢集。</span><span class="sxs-lookup"><span data-stu-id="17c39-1469">SIOS DataKeeper is abstracting the source and target local volumes and presenting them to Windows Failover Cluster as a single shared disk.</span></span>

<span data-ttu-id="17c39-1470">您可以在[在 Azure 上使用 Windows Server 容錯移轉叢集搭配 SIOS DataKeeper 將 SAP ASCS 執行個體叢集化][ha-guide-classic]技術白皮書中，找到有關如何使用 SIOS DataKeeper 和 SAP 來安裝「Windows 容錯移轉叢集」的所有詳細資料。</span><span class="sxs-lookup"><span data-stu-id="17c39-1470">You can find all details on how to install a Windows Failover Cluster with SIOS DataKeeper and SAP in the [Clustering SAP ASCS Instance using Windows Server Failover Cluster on Azure with SIOS DataKeeper][ha-guide-classic] white paper.</span></span>

#### <a name="high-availability-for-the-sap-ascs-instance-on-linux"></a><span data-ttu-id="17c39-1471">Linux 上 SAP (A)SCS 執行個體的高可用性</span><span class="sxs-lookup"><span data-stu-id="17c39-1471">High Availability for the SAP (A)SCS instance on Linux</span></span>
<span data-ttu-id="17c39-1472">截至 2015 年 12 月為止，Azure 上的 Linux VM 也沒有共用磁碟 WSFC 的對等用法。</span><span class="sxs-lookup"><span data-stu-id="17c39-1472">As of Dec 2015 there is also no equivalent to shared disk WSFC for Linux VMs on Azure.</span></span> <span data-ttu-id="17c39-1473">使用協力廠商軟體的替代解決方案 (例如適用於Windows 的 SIOS) 尚未經過驗證，無法在 Azure 上的 Linux 執行 SAP。</span><span class="sxs-lookup"><span data-stu-id="17c39-1473">Alternative solutions using 3rd-party software like SIOS for Windows are not validated yet for running SAP on Linux on Azure.</span></span>

#### <a name="high-availability-for-the-sap-database-instance"></a><span data-ttu-id="17c39-1474">SAP 資料庫執行個體的高可用性</span><span class="sxs-lookup"><span data-stu-id="17c39-1474">High Availability for the SAP database instance</span></span>
<span data-ttu-id="17c39-1475">一般 SAP DBMS HA 設定會根據兩個 DBMS VM 進行，其中 DBMS 高可用性功能可用來將資料從使用中 DBMS 執行個體複寫到第二個 VM 的被動 DBMS 執行個體。</span><span class="sxs-lookup"><span data-stu-id="17c39-1475">The typical SAP DBMS HA setup is based on two DBMS VMs where DBMS high-availability functionality is used to replicate data from the active DBMS instance to the second VM into a passive DBMS instance.</span></span>

<span data-ttu-id="17c39-1476">[DBMS 部署指南][dbms-guide]說明了一般 DBMS 及特定 DBMS 的高可用性和災害復原功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-1476">High Availability and Disaster recovery functionality for DBMS in general as well as specific DBMS are described in the [DBMS Deployment Guide][dbms-guide].</span></span>

#### <a name="end-to-end-high-availability-for-the-complete-sap-system"></a><span data-ttu-id="17c39-1477">完整 SAP 系統的端對端高可用性</span><span class="sxs-lookup"><span data-stu-id="17c39-1477">End-to-End High Availability for the Complete SAP System</span></span>
<span data-ttu-id="17c39-1478">以下是 Azure 中完整 SAP NetWeaver HA 架構的兩個範例 - 一個用於 Windows，一個用於 Linux。</span><span class="sxs-lookup"><span data-stu-id="17c39-1478">Here are two examples of a complete SAP NetWeaver HA architecture in Azure - one for Windows and one for Linux.</span></span>

<span data-ttu-id="17c39-1479">僅限非受控磁碟：當您部署許多 SAP 系統，而且所部署的 VM 數目將超過每個訂用帳戶的「儲存體帳戶」數目上限時，可能必須對以下所述的概念稍作取捨。</span><span class="sxs-lookup"><span data-stu-id="17c39-1479">Unmanaged disks only: The concepts as explained below may need to be compromised a bit when you deploy many SAP systems and the number of VMs deployed are exceeding the maximum limit of Storage Accounts per subscription.</span></span> <span data-ttu-id="17c39-1480">在此情況下，VM 的 VHD 必須結合到一個儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-1480">In such cases, VHDs of VMs need to be combined within one Storage Account.</span></span> <span data-ttu-id="17c39-1481">您通常會結合不同 SAP 系統之 SAP 應用程式層 VM 的 VHD 來達成目的。</span><span class="sxs-lookup"><span data-stu-id="17c39-1481">Usually you would do so by combining VHDs of SAP application layer VMs of different SAP systems.</span></span>  <span data-ttu-id="17c39-1482">我們也會將不同 SAP 系統之不同 DBMS VM 的不同 VHD 結合到一個 Azure 儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-1482">We also combined different VHDs of different DBMS VMs of different SAP systems in one Azure Storage Account.</span></span> <span data-ttu-id="17c39-1483">因此，請記住「Azure 儲存體帳戶」的 IOPS 限制 (<https://azure.microsoft.com/documentation/articles/storage-scalability-targets>)</span><span class="sxs-lookup"><span data-stu-id="17c39-1483">Thereby keeping the IOPS limits of Azure Storage Accounts in mind (<https://azure.microsoft.com/documentation/articles/storage-scalability-targets>)</span></span>


##### <a name="windowslogowindows-ha-on-windows"></a>![Windows][Logo_Windows] <span data-ttu-id="17c39-1485">Windows 上的 HA</span><span class="sxs-lookup"><span data-stu-id="17c39-1485">HA on Windows</span></span>
![Azure IaaS SQL Server 的 SAP NetWeaver 應用程式 HA 架構][planning-guide-figure-3200]

<span data-ttu-id="17c39-1487">下列 Azure 建構適用於 SAP NetWeaver 系統，可將基礎結構問題和主機修補的影響降到最低︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1487">The following Azure constructs are used for the SAP NetWeaver system, to minimize impact by infrastructure issues and host patching:</span></span>

* <span data-ttu-id="17c39-1488">整個系統部署在 Azure 上 (必要 - DBMS 層、(A)SCS 執行個體及整個應用程式層必須在相同的位置中執行)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1488">The complete system is deployed on Azure (required - DBMS layer, (A)SCS instance and complete application layer need to run in the same location).</span></span>
* <span data-ttu-id="17c39-1489">整個系統在一個 Azure 訂用帳戶內執行 (必要)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1489">The complete system runs within one Azure subscription (required).</span></span>
* <span data-ttu-id="17c39-1490">整個系統在一個「Azure 虛擬網路」內執行 (必要)。</span><span class="sxs-lookup"><span data-stu-id="17c39-1490">The complete system runs within one Azure Virtual Network (required).</span></span>
* <span data-ttu-id="17c39-1491">您可以將一個 SAP 系統的多個 VM 分成三個可用性設定組，即使所有 VM 都屬於相同的虛擬網路亦然。</span><span class="sxs-lookup"><span data-stu-id="17c39-1491">The separation of the VMs of one SAP system into three Availability Sets is possible even with all the VMs belonging to the same Virtual Network.</span></span>
* <span data-ttu-id="17c39-1492">執行一個 SAP 系統之 DBMS 執行個體的所有 VM 都會在一個可用性設定組中。</span><span class="sxs-lookup"><span data-stu-id="17c39-1492">All VMs running DBMS instances of one SAP system are in one Availability Set.</span></span> <span data-ttu-id="17c39-1493">假設有多個 VM 針對每個系統執行 DBMS 執行個體，因為使用了原生 DBMS 高可用性功能，例如 SQL Server AlwaysOn 或 Oracle Data Guard。</span><span class="sxs-lookup"><span data-stu-id="17c39-1493">We assume that there is more than one VM running DBMS instances per system since native DBMS high availability features are used, like SQL Server AlwaysOn or Oracle Data Guard.</span></span>
* <span data-ttu-id="17c39-1494">所有執行 DBMS 執行個體的 VM 都會使用自己的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-1494">All VMs running DBMS instances use their own storage account.</span></span> <span data-ttu-id="17c39-1495">DBMS 資料和記錄檔會使用同步處理資料的 DBMS 高可用性功能，從一個儲存體帳戶複寫到另一個儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-1495">DBMS data and log files are replicated from one storage account to another storage account using DBMS high availability functions that synchronize the data.</span></span> <span data-ttu-id="17c39-1496">無法使用一個儲存體帳戶會導致無法使用一個 SQL Windows 叢集節點，而不是整個 SQL Server 服務。</span><span class="sxs-lookup"><span data-stu-id="17c39-1496">Unavailability of one storage account will cause unavailability of one SQL Windows cluster node, but not the whole SQL Server service.</span></span>
* <span data-ttu-id="17c39-1497">執行一個 SAP 系統之 (A)SCS 執行個體的所有 VM 都會在一個可用性設定組中。</span><span class="sxs-lookup"><span data-stu-id="17c39-1497">All VMs running (A)SCS instance of one SAP system are in one Availability Set.</span></span> <span data-ttu-id="17c39-1498">在這些 VM 中，設定 Windows Sever 容錯移轉叢集 (WSFC) 來保護 (A)SCS 執行個體。</span><span class="sxs-lookup"><span data-stu-id="17c39-1498">A Windows Server Failover Cluster (WSFC) is configured inside of those VMs to protect the (A)SCS instance.</span></span>
* <span data-ttu-id="17c39-1499">所有執行 (A)SCS 執行個體的 VM 都會使用自己的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-1499">All VMs running (A)SCS instances use their own storage account.</span></span> <span data-ttu-id="17c39-1500">(A)SCS 執行個體檔案和 SAP 通用資料夾會使用 SIOS DataKeeper 複寫，從一個儲存體帳戶複寫到另一個儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-1500">(A)SCS instance files and SAP global folder are replicated from one storage account to another storage account using SIOS DataKeeper replication.</span></span> <span data-ttu-id="17c39-1501">無法使用一個儲存體帳戶會導致無法使用一個 (A)SCS Windows 叢集節點，而不是整個 (A)SCS 服務。</span><span class="sxs-lookup"><span data-stu-id="17c39-1501">Unavailability of one storage account will cause unavailability of one (A)SCS Windows cluster node, but not the whole (A)SCS service.</span></span>
* <span data-ttu-id="17c39-1502">所有代表 SAP 應用程式伺服器層的 VM 都會在第三個可用性設定組中。</span><span class="sxs-lookup"><span data-stu-id="17c39-1502">ALL the VMs representing the SAP application server layer are in a third Availability Set.</span></span>
* <span data-ttu-id="17c39-1503">所有執行 SAP 應用程式伺服器的 VM 都會使用自己的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-1503">ALL the VMs running SAP application servers use their own storage account.</span></span> <span data-ttu-id="17c39-1504">無法使用一個儲存體帳戶會導致無法使用一部 SAP 應用程式伺服器，而其他 SAP AS 則可繼續執行。</span><span class="sxs-lookup"><span data-stu-id="17c39-1504">Unavailability of one storage account will cause unavailability of one SAP application server, where other SAP AS continue to run.</span></span>

<span data-ttu-id="17c39-1505">下圖說明使用受控磁碟的相同環境。</span><span class="sxs-lookup"><span data-stu-id="17c39-1505">The following figure illustrated the same landscape using Managed Disks.</span></span>

![Azure IaaS SQL Server 的 SAP NetWeaver 應用程式 HA 架構][planning-guide-figure-3201]

##### <a name="linuxlogolinux-ha-on-linux"></a>![Linux][Logo_Linux] <span data-ttu-id="17c39-1508">Linux 上的 HA</span><span class="sxs-lookup"><span data-stu-id="17c39-1508">HA on Linux</span></span>
<span data-ttu-id="17c39-1509">Azure 上 Linux 的 SAP HA 架構基本上與上述 Windows 相同。</span><span class="sxs-lookup"><span data-stu-id="17c39-1509">The architecture for SAP HA on Linux on Azure is basically the same as for Windows as described above.</span></span> <span data-ttu-id="17c39-1510">截至 2016 年 6 月為止，Azure 上的 Linux 尚未支援 SAP (A)SCS HA 解決方案</span><span class="sxs-lookup"><span data-stu-id="17c39-1510">As of Jan 2016 there is no SAP (A)SCS HA solution supported yet on Linux on Azure</span></span>

<span data-ttu-id="17c39-1511">因此，截至 2016 年 1 月為止，SAP-Linux-Azure 系統無法達成與 SAP-Windows-Azure 系統相同的可用性，因為 (A)SCS 執行個體和單一執行個體 SAP ASE 資料庫遺漏 HA。</span><span class="sxs-lookup"><span data-stu-id="17c39-1511">As a consequence as of January 2016 an SAP-Linux-Azure system cannot achieve the same availability as an SAP-Windows-Azure system because of missing HA for the (A)SCS instance and the single-instance SAP ASE database.</span></span>

### <span data-ttu-id="17c39-1512"><a name="4e165b58-74ca-474f-a7f4-5e695a93204f"></a>對 SAP 執行個體使用自動啟動</span><span class="sxs-lookup"><span data-stu-id="17c39-1512"><a name="4e165b58-74ca-474f-a7f4-5e695a93204f"></a>Using Autostart for SAP instances</span></span>
<span data-ttu-id="17c39-1513">SAP 提供可在啟動 VM 內的 OS 之後立即啟動 SAP 執行個體的功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-1513">SAP offered the functionality to start SAP instances immediately after the start of the OS within the VM.</span></span> <span data-ttu-id="17c39-1514">確切步驟記載於 SAP 知識庫文章 [1909114]。</span><span class="sxs-lookup"><span data-stu-id="17c39-1514">The exact steps were documented in SAP Knowledge Base Article [1909114].</span></span> <span data-ttu-id="17c39-1515">不過，不再建議 SAP 使用此設定，因為無法控制執行個體重新啟動的順序，並假設多個 VM 已受到影響，或每個 VM 已執行多個執行個體。</span><span class="sxs-lookup"><span data-stu-id="17c39-1515">However, SAP is not recommending to use the setting anymore because there is no control in the order of instance restarts, assuming more than one VM got affected or multiple instances ran per VM.</span></span> <span data-ttu-id="17c39-1516">假設這是一個 VM 中有一個 SAP 應用程式伺服器執行個體的典型 Azure 案例，而且這是最終會重新啟動單一 VM 的案例，因此 Autostart 不是真的很重要，而且可以藉由新增此參數來啟用︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1516">Assuming a typical Azure scenario of one SAP application server instance in a VM and the case of a single VM eventually getting restarted, the Autostart is not really critical and can be enabled by adding this parameter:</span></span>

    Autostart = 1

<span data-ttu-id="17c39-1517">執行 SAP ABAP 及 (或) Java 執行個體的啟動設定檔。</span><span class="sxs-lookup"><span data-stu-id="17c39-1517">Into the start profile of the SAP ABAP and/or Java instance.</span></span>

> [!NOTE]
> <span data-ttu-id="17c39-1518">Autostart 參數可能還有一些缺點。</span><span class="sxs-lookup"><span data-stu-id="17c39-1518">The Autostart parameter can have some downfalls as well.</span></span> <span data-ttu-id="17c39-1519">詳細來說，此參數會在啟動執行個體的相關 Windows/Linux 服務時，觸發 SAP ABAP 或 Java 執行個體的啟動。</span><span class="sxs-lookup"><span data-stu-id="17c39-1519">In more detail, the parameter triggers the start of an SAP ABAP or Java instance when the related Windows/Linux service of the instance is started.</span></span> <span data-ttu-id="17c39-1520">當作業系統啟動時，便是這種情況。</span><span class="sxs-lookup"><span data-stu-id="17c39-1520">That certainly is the case when the operating system boots up.</span></span> <span data-ttu-id="17c39-1521">不過，SAP 軟體生命週期管理功能 (例如加總或其他更新或升級) 也經常需要重新啟動 SAP 服務。</span><span class="sxs-lookup"><span data-stu-id="17c39-1521">However, restarts of SAP services are also a common thing for SAP Software Lifecycle Management functionality like SUM or other updates or upgrades.</span></span> <span data-ttu-id="17c39-1522">這些功能完全不會要求必須自動重新啟動執行個體。</span><span class="sxs-lookup"><span data-stu-id="17c39-1522">These functionalities are not expecting an instance to be restarted automatically at all.</span></span> <span data-ttu-id="17c39-1523">因此，執行這類工作之前，應該停用 Autostart 參數。</span><span class="sxs-lookup"><span data-stu-id="17c39-1523">Therefore, the Autostart parameter should be disabled before running such tasks.</span></span> <span data-ttu-id="17c39-1524">叢集化的 SAP 執行個體 (例如 ASCS/SCS/CI) 也不應該使用 Autostart 參數。</span><span class="sxs-lookup"><span data-stu-id="17c39-1524">The Autostart parameter also should not be used for SAP instances that are clustered, like ASCS/SCS/CI.</span></span>
>
>

<span data-ttu-id="17c39-1525">如需自動啟動 SAP 執行個體的其他資訊，請參閱︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1525">See additional information regarding autostart for SAP instances here:</span></span>

* [<span data-ttu-id="17c39-1526">Start/Stop SAP along with your Unix Server Start/Stop (隨著 Unix 伺服器啟動/停止一起啟動/停止 SAP)</span><span class="sxs-lookup"><span data-stu-id="17c39-1526">Start/Stop SAP along with your Unix Server Start/Stop</span></span>](http://scn.sap.com/community/unix/blog/2012/08/07/startstop-sap-along-with-your-unix-server-startstop)
* [<span data-ttu-id="17c39-1527">Starting and Stopping SAP NetWeaver Management Agents (啟動及停止 SAP NetWeaver 管理代理程式)</span><span class="sxs-lookup"><span data-stu-id="17c39-1527">Starting and Stopping SAP NetWeaver Management Agents</span></span>](https://help.sap.com/saphelp_nwpi711/helpdata/en/49/9a15525b20423ee10000000a421938/content.htm)
* [<span data-ttu-id="17c39-1528">How to enable auto Start of HANA Database (如何啟用 HANA 資料庫的自動啟動)</span><span class="sxs-lookup"><span data-stu-id="17c39-1528">How to enable auto Start of HANA Database</span></span>](http://www.freehanatutorials.com/2012/10/how-to-enable-auto-start-of-hana.html)

### <a name="larger-3-tier-sap-systems"></a><span data-ttu-id="17c39-1529">更大型的 3 層 SAP 系統</span><span class="sxs-lookup"><span data-stu-id="17c39-1529">Larger 3-Tier SAP systems</span></span>
<span data-ttu-id="17c39-1530">稍早的章節中已談到 3 層 SAP 組態的高可用性觀點。</span><span class="sxs-lookup"><span data-stu-id="17c39-1530">High-Availability aspects of 3-Tier SAP configurations got discussed in earlier sections already.</span></span> <span data-ttu-id="17c39-1531">但如果 DBMS 伺服器需求太大而無法位於 Azure，但可將 SAP 應用程式層部署到 Azure 的系統又該怎麼辦？</span><span class="sxs-lookup"><span data-stu-id="17c39-1531">But what about systems where the DBMS server requirements are too large to have it located in Azure, but the SAP application layer could be deployed into Azure?</span></span>

#### <a name="location-of-3-tier-sap-configurations"></a><span data-ttu-id="17c39-1532">3 層 SAP 組態的位置</span><span class="sxs-lookup"><span data-stu-id="17c39-1532">Location of 3-Tier SAP configurations</span></span>
<span data-ttu-id="17c39-1533">不支援在內部部署與 Azure 之間分割應用程式層本身，或分割應用程式和 DBMS 層。</span><span class="sxs-lookup"><span data-stu-id="17c39-1533">It is not supported to split the application tier itself or the application and DBMS tier between on-premises and Azure.</span></span> <span data-ttu-id="17c39-1534">SAP 系統可以完全在內部部署或在 Azure 中部署。</span><span class="sxs-lookup"><span data-stu-id="17c39-1534">An SAP system is either completely deployed on-premises OR in Azure.</span></span> <span data-ttu-id="17c39-1535">也不支援在內部部署執行一些應用程式伺服器，並在 Azure 中執行其他一些應用程式伺服器。</span><span class="sxs-lookup"><span data-stu-id="17c39-1535">It is also not supported to have some of the application servers run on-premises and some others in Azure.</span></span> <span data-ttu-id="17c39-1536">以此為起點繼續往下討論。</span><span class="sxs-lookup"><span data-stu-id="17c39-1536">That is the starting point of the discussion.</span></span> <span data-ttu-id="17c39-1537">我們也不支援將 SAP 系統的 DBMS 元件和 SAP 應用程式伺服器層部署在兩個不同的 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="17c39-1537">We also are not supporting to have the DBMS components of an SAP system and the SAP application server layer deployed in two different Azure Regions.</span></span> <span data-ttu-id="17c39-1538">例如，DBMS 在美國西部，而 SAP 應用程式層在美國中部。</span><span class="sxs-lookup"><span data-stu-id="17c39-1538">For example DBMS in West US and SAP application layer in Central US.</span></span> <span data-ttu-id="17c39-1539">不支援這類組態是因為 SAP NetWeaver 架構的延遲敏感度。</span><span class="sxs-lookup"><span data-stu-id="17c39-1539">Reason for not supporting such configurations is the latency sensitivity of the SAP NetWeaver architecture.</span></span>

<span data-ttu-id="17c39-1540">不過，在去年一整年，資料中心合作夥伴已開發 Azure 區域的共置。</span><span class="sxs-lookup"><span data-stu-id="17c39-1540">However, over the course of last year data center partners developed co-locations to Azure Regions.</span></span> <span data-ttu-id="17c39-1541">這些共置通常很接近 Azure 區域內的實體 Azure 資料中心。</span><span class="sxs-lookup"><span data-stu-id="17c39-1541">These co-locations often are in very close proximity to the physical Azure data centers within an Azure Region.</span></span> <span data-ttu-id="17c39-1542">距離變短及透過 ExpressRoute 將共置資產連線到 Azure 可將延遲縮短為不到 2 毫秒。</span><span class="sxs-lookup"><span data-stu-id="17c39-1542">The short distance and connection of assets in the co-location through ExpressRoute into Azure can result in a latency that is less than 2ms.</span></span> <span data-ttu-id="17c39-1543">在此情況下，您可以將 DBMS 層 (包括 SAN/NAS 存放裝置) 放在這類共置中，並將 SAP 應用程式層放在 Azure 中。</span><span class="sxs-lookup"><span data-stu-id="17c39-1543">In such cases, to locate the DBMS layer (including storage SAN/NAS) in such a co-location and the SAP application layer in Azure is possible.</span></span> <span data-ttu-id="17c39-1544">截至 2015 年 12 月為止，我們沒有這類部署。</span><span class="sxs-lookup"><span data-stu-id="17c39-1544">As of Dec 2015, we don’t have any deployments like that.</span></span> <span data-ttu-id="17c39-1545">但是，具有非 SAP 應用程式部署的其他客戶已採用此方法。</span><span class="sxs-lookup"><span data-stu-id="17c39-1545">But different customers with non-SAP application deployments are using such approaches already.</span></span>

### <a name="offline-backup-of-sap-systems"></a><span data-ttu-id="17c39-1546">SAP 系統的離線備份</span><span class="sxs-lookup"><span data-stu-id="17c39-1546">Offline Backup of SAP systems</span></span>
<span data-ttu-id="17c39-1547">根據所選擇的 SAP 組態 (2 層或 3 層)，可能需要進行備份。</span><span class="sxs-lookup"><span data-stu-id="17c39-1547">Dependent on the SAP configuration chosen (2-Tier or 3-Tier) there could be a need to back up.</span></span> <span data-ttu-id="17c39-1548">您必須備份 VM 本身的內容及資料庫。</span><span class="sxs-lookup"><span data-stu-id="17c39-1548">The content of the VM itself plus to have a backup of the database.</span></span> <span data-ttu-id="17c39-1549">DBMS 相關的備份必須使用資料庫方法來進行。</span><span class="sxs-lookup"><span data-stu-id="17c39-1549">The DBMS-related backups are expected to be done with database methods.</span></span> <span data-ttu-id="17c39-1550">如需不同資料庫的詳細說明，請參閱 [DBMS 指南][dbms-guide]。</span><span class="sxs-lookup"><span data-stu-id="17c39-1550">A detailed description for the different databases, can be found in [DBMS Guide][dbms-guide].</span></span> <span data-ttu-id="17c39-1551">另一方面，SAP 資料可如本節所述進行離線備份 (同時包含資料庫內容)，或是如下一節所述進行線上備份。</span><span class="sxs-lookup"><span data-stu-id="17c39-1551">On the other hand, the SAP data can be backed up in an offline manner (including the database content as well) as described in this section or online as described in the next section.</span></span>

<span data-ttu-id="17c39-1552">離線備份基本上需要透過 Azure 入口網站關閉 VM，並將基底 VM 磁碟及所有連接的磁碟複製到 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-1552">The offline backup would basically require a shutdown of the VM through the Azure portal and a copy of the base VM disk plus all attached disks to the VM.</span></span> <span data-ttu-id="17c39-1553">這會保留 VM 及其相關聯磁碟的某個時間點映像。</span><span class="sxs-lookup"><span data-stu-id="17c39-1553">This would preserve a point in time image of the VM and its associated disk.</span></span> <span data-ttu-id="17c39-1554">建議將「備份」複製到不同的 Azure 儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="17c39-1554">It is recommended to copy the ‘backups’ into a different Azure Storage Account.</span></span> <span data-ttu-id="17c39-1555">因此，本文件的[在 Azure 儲存體帳戶之間複製磁碟][planning-guide-5.4.2]一章所述的程序會適用。</span><span class="sxs-lookup"><span data-stu-id="17c39-1555">Hence the procedure described in chapter [Copying disks between Azure Storage Accounts][planning-guide-5.4.2] of this document would apply.</span></span>
<span data-ttu-id="17c39-1556">除了透過 Azure 入口網站關機之外，使用者也可以如以下所述，透過 Powershell 或 CLI 來執行這項作業︰<https://azure.microsoft.com/documentation/articles/virtual-machines-deploy-rmtemplates-powershell/></span><span class="sxs-lookup"><span data-stu-id="17c39-1556">Besides the shutdown using the Azure portal one can also do it via Powershell or CLI as described here: <https://azure.microsoft.com/documentation/articles/virtual-machines-deploy-rmtemplates-powershell/></span></span>

<span data-ttu-id="17c39-1557">還原該狀態需要刪除基底 VM 及基底 VM 的原始磁碟和已掛接的磁碟、將儲存的磁碟複製回原始儲存體帳戶，或受控磁碟的資源群組，然後重新部署此系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-1557">A restore of that state would consist of deleting the base VM as well as the original disks of the base VM and mounted disks, copying back the saved disks to the original Storage Account or resource group for managed disks and then redeploying the system.</span></span>
<span data-ttu-id="17c39-1558">下列文章示範如何使用 Powershell 來編寫此程序的指令碼︰<http://www.westerndevs.com/azure-snapshots/></span><span class="sxs-lookup"><span data-stu-id="17c39-1558">This article shows an example how to script this process in Powershell: <http://www.westerndevs.com/azure-snapshots/></span></span>

<span data-ttu-id="17c39-1559">請務必安裝新的 SAP 授權，因為如上所述還原 VM 備份會建立新的硬體金鑰。</span><span class="sxs-lookup"><span data-stu-id="17c39-1559">Please make sure to install a new SAP license since restoring a VM backup as described above creates a new hardware key.</span></span>

### <a name="online-backup-of-an-sap-system"></a><span data-ttu-id="17c39-1560">SAP 系統的線上備份</span><span class="sxs-lookup"><span data-stu-id="17c39-1560">Online backup of an SAP system</span></span>
<span data-ttu-id="17c39-1561">DBMS 的備份是使用 [DBMS 指南][dbms-guide]中所述的 DBMS 特定方法來執行。</span><span class="sxs-lookup"><span data-stu-id="17c39-1561">Backup of the DBMS is performed with DBMS-specific methods as described in the [DBMS Guide][dbms-guide].</span></span>

<span data-ttu-id="17c39-1562">SAP 系統內的其他 VM 可以使用 Azure 虛擬機器備份功能進行備份。</span><span class="sxs-lookup"><span data-stu-id="17c39-1562">Other VMs within the SAP system can be backed up using Azure Virtual Machine Backup functionality.</span></span> <span data-ttu-id="17c39-1563">Azure 虛擬機器備份在 2015 年初引進，也是目前在 Azure 中備份完整 VM 的標準方法。</span><span class="sxs-lookup"><span data-stu-id="17c39-1563">Azure Virtual Machine Backup got introduced early in 2015 and meanwhile is a standard method to back up a complete VM in Azure.</span></span> <span data-ttu-id="17c39-1564">Azure 備份將備份儲存在 Azure 中，並允許再次還原 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-1564">Azure Backup stores the backups in Azure and allows a restore of a VM again.</span></span>

> [!NOTE]
> <span data-ttu-id="17c39-1565">截至 2015 年 12 月為止，使用 VM 備份並不會保留用於 SAP 授權的唯一 VM ID。</span><span class="sxs-lookup"><span data-stu-id="17c39-1565">As of Dec 2015 using VM Backup does NOT keep the unique VM ID which is used for SAP licensing.</span></span> <span data-ttu-id="17c39-1566">這表示從 VM 備份還原需要安裝新的 SAP 授權金鑰，因為還原的 VM 會視為新的 VM，而不會取代之前儲存的舊版。</span><span class="sxs-lookup"><span data-stu-id="17c39-1566">This means that a restore from a VM backup requires installation of a new SAP license key as the restored VM is considered to be a new VM and not a replacement of the former one which was saved.</span></span>
>
> ![Windows][Logo_Windows] <span data-ttu-id="17c39-1568">Windows</span><span class="sxs-lookup"><span data-stu-id="17c39-1568">Windows</span></span>
>
> <span data-ttu-id="17c39-1569">理論上，如果 DBMS 系統支援 Windows VSS (磁碟區陰影複製服務 <https://msdn.microsoft.com/library/windows/desktop/bb968832(v=vs.85).aspx>)，例如就像 SQL Server 一樣，則也可以用一致的方式備份執行資料庫的 VM。</span><span class="sxs-lookup"><span data-stu-id="17c39-1569">Theoretically, VMs that run databases can be backed up in a consistent manner as well if the DBMS system supports the Windows VSS (Volume Shadow Copy Service <https://msdn.microsoft.com/library/windows/desktop/bb968832(v=vs.85).aspx>) as, for example, SQL Server does.</span></span>
> <span data-ttu-id="17c39-1570">不過請注意，您無法根據 Azure VM 備份還原時間點來還原資料庫。</span><span class="sxs-lookup"><span data-stu-id="17c39-1570">However, be aware that based on Azure VM backups point-in-time restores of databases are not possible.</span></span> <span data-ttu-id="17c39-1571">因此，建議使用 DBMS 功能執行資料庫的備份，而不是依賴 Azure VM 備份。</span><span class="sxs-lookup"><span data-stu-id="17c39-1571">Therefore, the recommendation is to perform backups of databases with DBMS functionality instead of relying on Azure VM Backup.</span></span>
>
> <span data-ttu-id="17c39-1572">若要熟悉「Azure 虛擬機器備份」，請從這裡開始著手：<https://docs.microsoft.com/azure/backup/backup-azure-vms>。</span><span class="sxs-lookup"><span data-stu-id="17c39-1572">To get familiar with Azure Virtual Machine Backup please start here: <https://docs.microsoft.com/azure/backup/backup-azure-vms>.</span></span>
>
> <span data-ttu-id="17c39-1573">您也可以混合使用安裝在 Azure VM 中的 Microsoft Data Protection Manager 及 Azure 備份，來備份/還原資料庫。</span><span class="sxs-lookup"><span data-stu-id="17c39-1573">Other possibilities are to use a combination of Microsoft Data Protection Manager installed in an Azure VM and Azure Backup to backup/restore databases.</span></span> <span data-ttu-id="17c39-1574">如需詳細資訊，請參閱：<https://docs.microsoft.com/azure/backup/backup-azure-dpm-introduction>。</span><span class="sxs-lookup"><span data-stu-id="17c39-1574">More information can be found here: <https://docs.microsoft.com/azure/backup/backup-azure-dpm-introduction>.</span></span>  
>
> ![Linux][Logo_Linux] <span data-ttu-id="17c39-1576">Linux</span><span class="sxs-lookup"><span data-stu-id="17c39-1576">Linux</span></span>
>
> <span data-ttu-id="17c39-1577">Windows VSS 在 Linux 中沒有對等用法。</span><span class="sxs-lookup"><span data-stu-id="17c39-1577">There is no equivalent to Windows VSS in Linux.</span></span> <span data-ttu-id="17c39-1578">因此，您只能進行檔案一致備份，而無法進行應用程式一致備份。</span><span class="sxs-lookup"><span data-stu-id="17c39-1578">Therefore only file-consistent backups are possible but not application-consistent backups.</span></span> <span data-ttu-id="17c39-1579">SAP DBMS 備份應該使用 DBMS 功能來進行。</span><span class="sxs-lookup"><span data-stu-id="17c39-1579">The SAP DBMS backup should be done using DBMS functionality.</span></span> <span data-ttu-id="17c39-1580">例如，您可以如以下所述，使用 tar 來儲存包含 SAP 相關資料的檔案系統︰<http://help.sap.com/saphelp_nw70ehp2/helpdata/en/d3/c0da3ccbb04d35b186041ba6ac301f/content.htm></span><span class="sxs-lookup"><span data-stu-id="17c39-1580">The file system which includes the SAP-related data can be saved, for example, using tar as described here: <http://help.sap.com/saphelp_nw70ehp2/helpdata/en/d3/c0da3ccbb04d35b186041ba6ac301f/content.htm></span></span>
>
>

### <a name="azure-as-dr-site-for-production-sap-landscapes"></a><span data-ttu-id="17c39-1581">Azure 作為 SAP 生產環境的 DR 網站</span><span class="sxs-lookup"><span data-stu-id="17c39-1581">Azure as DR site for production SAP landscapes</span></span>
<span data-ttu-id="17c39-1582">從 2014 年中開始，以 Hyper-V、System Center 和 Azure 為主的各種元件延伸模組，可使用 Azure 作為在內部部署執行並以 Hyper-V 為基礎之 VM 的 DR 站台。</span><span class="sxs-lookup"><span data-stu-id="17c39-1582">Since Mid 2014, extensions to various components around Hyper-V, System Center and Azure enable the usage of Azure as DR site for VMs running on-premises based on Hyper-V.</span></span>

<span data-ttu-id="17c39-1583">如需詳細說明如何部署此解決方案的部落格，請參閱︰<http://blogs.msdn.com/b/saponsqlserver/archive/2014/11/19/protecting-sap-solutions-with-azure-site-recovery.aspx>。</span><span class="sxs-lookup"><span data-stu-id="17c39-1583">A blog detailing how to deploy this solution is documented here: <http://blogs.msdn.com/b/saponsqlserver/archive/2014/11/19/protecting-sap-solutions-with-azure-site-recovery.aspx>.</span></span>

## <a name="summary"></a><span data-ttu-id="17c39-1584">摘要</span><span class="sxs-lookup"><span data-stu-id="17c39-1584">Summary</span></span>
<span data-ttu-id="17c39-1585">Azure 中 SAP 系統的高可用性重點如下：</span><span class="sxs-lookup"><span data-stu-id="17c39-1585">The key points of High Availability for SAP systems in Azure are:</span></span>

* <span data-ttu-id="17c39-1586">目前，您無法以與內部部署完全相同的方式來保護 SAP 單一失敗點。</span><span class="sxs-lookup"><span data-stu-id="17c39-1586">At this point in time, the SAP single point of failure cannot be secured exactly the same way as it can be done in on-premises deployments.</span></span> <span data-ttu-id="17c39-1587">這是因為在 Azure 中還無法在未使用協力廠商軟體的情況下建置共用磁碟叢集。</span><span class="sxs-lookup"><span data-stu-id="17c39-1587">The reason is that Shared Disk clusters can’t yet be built in Azure without the use of 3rd party software.</span></span>
* <span data-ttu-id="17c39-1588">針對 DBMS 層，您必須使用不依賴共用磁碟叢集技術的 DBMS 功能。</span><span class="sxs-lookup"><span data-stu-id="17c39-1588">For the DBMS layer you need to use DBMS functionality that does not rely on shared disk cluster technology.</span></span> <span data-ttu-id="17c39-1589">詳細資料記載於 [DBMS 指南][dbms-guide]。</span><span class="sxs-lookup"><span data-stu-id="17c39-1589">Details are documented in the [DBMS Guide][dbms-guide].</span></span>
* <span data-ttu-id="17c39-1590">若要將 Azure 基礎結構或主機維護中之容錯網域問題的影響降到最低，您應該使用 Azure 可用性設定組︰</span><span class="sxs-lookup"><span data-stu-id="17c39-1590">To minimize the impact of problems within Fault Domains in the Azure infrastructure or host maintenance, you should use Azure Availability Sets:</span></span>
  * <span data-ttu-id="17c39-1591">建議針對 SAP 應用程式層使用一個可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="17c39-1591">It is recommended to have one Availability Set for the SAP application layer.</span></span>
  * <span data-ttu-id="17c39-1592">建議針對 SAP DBMS 層使用另一個可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="17c39-1592">It is recommended to have a separate Availability Set for the SAP DBMS layer.</span></span>
  * <span data-ttu-id="17c39-1593">不建議將 VM 的相同可用性設定組套用至不同的 SAP 系統。</span><span class="sxs-lookup"><span data-stu-id="17c39-1593">It is NOT recommended to apply the same Availability set for VMs of different SAP systems.</span></span>
  * <span data-ttu-id="17c39-1594">建議使用進階受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="17c39-1594">It is recommended to use Premium Managed Disks.</span></span>
* <span data-ttu-id="17c39-1595">如需了解 SAP DBMS 層的備份用途，請參閱 [DBMS 指南][dbms-guide]。</span><span class="sxs-lookup"><span data-stu-id="17c39-1595">For Backup purposes of the SAP DBMS layer, please check the [DBMS Guide][dbms-guide].</span></span>
* <span data-ttu-id="17c39-1596">備份 SAP 對話方塊執行個體沒有太大幫助，因為重新部署簡單的對話方塊執行個體通常更快。</span><span class="sxs-lookup"><span data-stu-id="17c39-1596">Backing up SAP Dialog instances makes little sense since it is usually faster to redeploy simple dialog instances.</span></span>
* <span data-ttu-id="17c39-1597">備份含有 SAP 系統通用目錄的 VM 及不同執行個體的所有設定檔則很有幫助，而且應該透過 Windows 備份或 Linux 上的 tar 執行。</span><span class="sxs-lookup"><span data-stu-id="17c39-1597">Backing up the VM which contains the global directory of the SAP system and with it all the profiles of the different instances, does make sense and should be performed with Windows Backup or, for example, tar on Linux.</span></span> <span data-ttu-id="17c39-1598">由於 Windows Server 2008 (R2) 和 Windows Server 2012 (R2) 之間有差異，因此使用更新版的 Windows Server 可讓您更輕鬆地進行備份，建議將 Windows Server 2012 (R2) 當做 Windows 客體作業系統來執行。</span><span class="sxs-lookup"><span data-stu-id="17c39-1598">Since there are differences between Windows Server 2008 (R2) and Windows Server 2012 (R2), which make it easier to back up using the more recent Windows Server releases, we recommend to run Windows Server 2012 (R2) as Windows guest operating system.</span></span>
