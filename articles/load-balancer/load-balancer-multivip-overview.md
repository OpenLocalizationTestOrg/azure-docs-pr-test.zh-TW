---
title: "Azure 負載平衡器 Vip aaaMultiple |Microsoft 文件"
description: "Azure Load Balancer 上多個 VIP 概觀"
services: load-balancer
documentationcenter: na
author: chkuhtz
manager: narayan
editor: 
ms.assetid: 748e50cd-3087-4c2e-a9e1-ac0ecce4f869
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/11/2016
ms.author: chkuhtz
ms.openlocfilehash: e186e1248e7d187e7efd0668dc3244465ce3e156
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="multiple-vips-for-azure-load-balancer"></a><span data-ttu-id="8600c-103">Azure Load Balancer 的多個 VIP</span><span class="sxs-lookup"><span data-stu-id="8600c-103">Multiple VIPs for Azure Load Balancer</span></span>

<span data-ttu-id="8600c-104">Azure 負載平衡器可讓您在多個連接埠、 多個 IP 位址，或兩者上的 tooload 平衡服務。</span><span class="sxs-lookup"><span data-stu-id="8600c-104">Azure Load Balancer allows you tooload balance services on multiple ports, multiple IP addresses, or both.</span></span> <span data-ttu-id="8600c-105">您可以使用公用和內部負載平衡器定義 tooload 平衡流量分配一組的 Vm。</span><span class="sxs-lookup"><span data-stu-id="8600c-105">You can use public and internal load balancer definitions tooload balance flows across a set of VMs.</span></span>

<span data-ttu-id="8600c-106">這篇文章會說明這個能力、 重要的概念和條件約束的 hello 基本概念。</span><span class="sxs-lookup"><span data-stu-id="8600c-106">This article describes hello fundamentals of this ability, important concepts, and constraints.</span></span> <span data-ttu-id="8600c-107">如果您只想 tooexpose 服務在一個 IP 位址上，您可以找到簡化的指示[公用](load-balancer-get-started-internet-portal.md)或[內部](load-balancer-get-started-ilb-arm-portal.md)負載平衡器組態。</span><span class="sxs-lookup"><span data-stu-id="8600c-107">If you only intend tooexpose services on one IP address, you can find simplified instructions for [public](load-balancer-get-started-internet-portal.md) or [internal](load-balancer-get-started-ilb-arm-portal.md) load balancer configurations.</span></span> <span data-ttu-id="8600c-108">加入多個 Vip 是累加 tooa 單一 VIP 設定。</span><span class="sxs-lookup"><span data-stu-id="8600c-108">Adding Multiple VIPs is incremental tooa single VIP configuration.</span></span> <span data-ttu-id="8600c-109">使用本文章中的 hello 概念，您可以展開簡化的組態，在任何時間。</span><span class="sxs-lookup"><span data-stu-id="8600c-109">Using hello concepts in this article, you can expand a simplified configuration at any time.</span></span>

<span data-ttu-id="8600c-110">定義 Azure Load Balancer 時，前端和後端設定會與規則連線。</span><span class="sxs-lookup"><span data-stu-id="8600c-110">When you define an Azure Load Balancer, a frontend and a backend configuration are connected with rules.</span></span> <span data-ttu-id="8600c-111">hello hello 規則所參考的健全狀況探查是使用的 toodetermine 新流量會傳送 hello 後端集區中的 tooa 節點。</span><span class="sxs-lookup"><span data-stu-id="8600c-111">hello health probe referenced by hello rule is used toodetermine how new flows are sent tooa node in hello backend pool.</span></span> <span data-ttu-id="8600c-112">hello 前端定義的虛擬 IP (VIP)，也就是 3-tuple 組成 （公用或內部） 的 IP 位址、 傳輸通訊協定 （UDP 或 TCP） 和連接埠號碼。</span><span class="sxs-lookup"><span data-stu-id="8600c-112">hello frontend is defined by a Virtual IP (VIP), which is a 3-tuple comprised of an IP address (public or internal), a transport protocol (UDP or TCP), and a port number.</span></span> <span data-ttu-id="8600c-113">DIP 是 Azure 的虛擬 NIC 上的 IP 位址附加 tooa hello 後端集區中的 VM。</span><span class="sxs-lookup"><span data-stu-id="8600c-113">A DIP is an IP address on an Azure virtual NIC attached tooa VM in hello backend pool.</span></span>

<span data-ttu-id="8600c-114">hello 下表包含一些範例前端組態：</span><span class="sxs-lookup"><span data-stu-id="8600c-114">hello following table contains some example frontend configurations:</span></span>

| <span data-ttu-id="8600c-115">VIP</span><span class="sxs-lookup"><span data-stu-id="8600c-115">VIP</span></span> | <span data-ttu-id="8600c-116">IP 位址</span><span class="sxs-lookup"><span data-stu-id="8600c-116">IP address</span></span> | <span data-ttu-id="8600c-117">protocol</span><span class="sxs-lookup"><span data-stu-id="8600c-117">protocol</span></span> | <span data-ttu-id="8600c-118">連接埠</span><span class="sxs-lookup"><span data-stu-id="8600c-118">port</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="8600c-119">1</span><span class="sxs-lookup"><span data-stu-id="8600c-119">1</span></span> |<span data-ttu-id="8600c-120">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="8600c-120">65.52.0.1</span></span> |<span data-ttu-id="8600c-121">TCP</span><span class="sxs-lookup"><span data-stu-id="8600c-121">TCP</span></span> |<span data-ttu-id="8600c-122">80</span><span class="sxs-lookup"><span data-stu-id="8600c-122">80</span></span> |
| <span data-ttu-id="8600c-123">2</span><span class="sxs-lookup"><span data-stu-id="8600c-123">2</span></span> |<span data-ttu-id="8600c-124">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="8600c-124">65.52.0.1</span></span> |<span data-ttu-id="8600c-125">TCP</span><span class="sxs-lookup"><span data-stu-id="8600c-125">TCP</span></span> |<span data-ttu-id="8600c-126">*8080*</span><span class="sxs-lookup"><span data-stu-id="8600c-126">*8080*</span></span> |
| <span data-ttu-id="8600c-127">3</span><span class="sxs-lookup"><span data-stu-id="8600c-127">3</span></span> |<span data-ttu-id="8600c-128">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="8600c-128">65.52.0.1</span></span> |<span data-ttu-id="8600c-129">*UDP*</span><span class="sxs-lookup"><span data-stu-id="8600c-129">*UDP*</span></span> |<span data-ttu-id="8600c-130">80</span><span class="sxs-lookup"><span data-stu-id="8600c-130">80</span></span> |
| <span data-ttu-id="8600c-131">4</span><span class="sxs-lookup"><span data-stu-id="8600c-131">4</span></span> |<span data-ttu-id="8600c-132">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="8600c-132">*65.52.0.2*</span></span> |<span data-ttu-id="8600c-133">TCP</span><span class="sxs-lookup"><span data-stu-id="8600c-133">TCP</span></span> |<span data-ttu-id="8600c-134">80</span><span class="sxs-lookup"><span data-stu-id="8600c-134">80</span></span> |

<span data-ttu-id="8600c-135">hello 表顯示四個不同的前端。</span><span class="sxs-lookup"><span data-stu-id="8600c-135">hello table shows four different frontends.</span></span> <span data-ttu-id="8600c-136">#1、#2、#3 前端是具有多個規則的單一 VIP。</span><span class="sxs-lookup"><span data-stu-id="8600c-136">Frontends #1, #2 and #3 are a single VIP with multiple rules.</span></span> <span data-ttu-id="8600c-137">hello 相同的 IP 位址使用，但 hello 連接埠或通訊協定是每個前端不同。</span><span class="sxs-lookup"><span data-stu-id="8600c-137">hello same IP address is used but hello port or protocol is different for each frontend.</span></span> <span data-ttu-id="8600c-138">前端 #1 和 #4，多個 Vip，其中 hello 相同前端通訊協定和連接埠可重複使用跨多個 Vip 的範例。</span><span class="sxs-lookup"><span data-stu-id="8600c-138">Frontends #1 and #4 are an example of Multiple VIPs, where hello same frontend protocol and port are reused across multiple VIPs.</span></span>

<span data-ttu-id="8600c-139">Azure 負載平衡器提供有彈性地定義 hello 負載平衡規則。</span><span class="sxs-lookup"><span data-stu-id="8600c-139">Azure Load Balancer provides flexibility in defining hello load balancing rules.</span></span> <span data-ttu-id="8600c-140">規則宣告如何位址和連接埠 hello 前端上是對應的 toohello 目的地位址與連接埠 hello 後端上。</span><span class="sxs-lookup"><span data-stu-id="8600c-140">A rule declares how an address and port on hello frontend is mapped toohello destination address and port on hello backend.</span></span> <span data-ttu-id="8600c-141">在規則上重複使用後端連接埠是不論是否取決於 hello hello 規則類型。</span><span class="sxs-lookup"><span data-stu-id="8600c-141">Whether or not backend ports are reused across rules depends on hello type of hello rule.</span></span> <span data-ttu-id="8600c-142">每種規則類型有特定的需求，會影響主機設定和探查設計的方式。</span><span class="sxs-lookup"><span data-stu-id="8600c-142">Each type of rule has specific requirements that can affect host configuration and probe design.</span></span> <span data-ttu-id="8600c-143">規則分為兩種：</span><span class="sxs-lookup"><span data-stu-id="8600c-143">There are two types of rules:</span></span>

1. <span data-ttu-id="8600c-144">hello 與任何後端連接埠的預設規則重複使用</span><span class="sxs-lookup"><span data-stu-id="8600c-144">hello default rule with no backend port reuse</span></span>
2. <span data-ttu-id="8600c-145">hello 浮動 IP 規則會在重複使用後端連接埠</span><span class="sxs-lookup"><span data-stu-id="8600c-145">hello Floating IP rule where backend ports are reused</span></span>

<span data-ttu-id="8600c-146">Azure 負載平衡器可讓您同時在 規則類型 toomix hello 相同負載平衡器組態。</span><span class="sxs-lookup"><span data-stu-id="8600c-146">Azure Load Balancer allows you toomix both rule types on hello same load balancer configuration.</span></span> <span data-ttu-id="8600c-147">hello 負載平衡器可以使用它們同時針對指定的 VM 或任何組合中，只要您遵守 hello 的 hello 規則的條件約束。</span><span class="sxs-lookup"><span data-stu-id="8600c-147">hello load balancer can use them simultaneously for a given VM, or any combination, as long as you abide by hello constraints of hello rule.</span></span> <span data-ttu-id="8600c-148">您選擇哪些規則類型取決於您應用程式和 hello 的複雜度，支援該組態的 hello 需求。</span><span class="sxs-lookup"><span data-stu-id="8600c-148">Which rule type you choose depends on hello requirements of your application and hello complexity of supporting that configuration.</span></span> <span data-ttu-id="8600c-149">您應該評估何種規則類型最適合您的案例。</span><span class="sxs-lookup"><span data-stu-id="8600c-149">You should evaluate which rule types are best for your scenario.</span></span>

<span data-ttu-id="8600c-150">我們來探索這些案例進一步開頭 hello 預設行為。</span><span class="sxs-lookup"><span data-stu-id="8600c-150">We explore these scenarios further by starting with hello default behavior.</span></span>

## <a name="rule-type-1-no-backend-port-reuse"></a><span data-ttu-id="8600c-151">規則類型 #1︰不重複使用後端連接埠</span><span class="sxs-lookup"><span data-stu-id="8600c-151">Rule type #1: No backend port reuse</span></span>

![MultiVIP 圖解片](./media/load-balancer-multivip-overview/load-balancer-multivip.png)

<span data-ttu-id="8600c-153">在此案例中，hello 前端 Vip 設定，如下所示：</span><span class="sxs-lookup"><span data-stu-id="8600c-153">In this scenario, hello frontend VIPs are configured as follows:</span></span>

| <span data-ttu-id="8600c-154">VIP</span><span class="sxs-lookup"><span data-stu-id="8600c-154">VIP</span></span> | <span data-ttu-id="8600c-155">IP 位址</span><span class="sxs-lookup"><span data-stu-id="8600c-155">IP address</span></span> | <span data-ttu-id="8600c-156">protocol</span><span class="sxs-lookup"><span data-stu-id="8600c-156">protocol</span></span> | <span data-ttu-id="8600c-157">連接埠</span><span class="sxs-lookup"><span data-stu-id="8600c-157">port</span></span> |
| --- | --- | --- | --- |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="8600c-159">1</span><span class="sxs-lookup"><span data-stu-id="8600c-159">1</span></span> |<span data-ttu-id="8600c-160">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="8600c-160">65.52.0.1</span></span> |<span data-ttu-id="8600c-161">TCP</span><span class="sxs-lookup"><span data-stu-id="8600c-161">TCP</span></span> |<span data-ttu-id="8600c-162">80</span><span class="sxs-lookup"><span data-stu-id="8600c-162">80</span></span> |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="8600c-164">2</span><span class="sxs-lookup"><span data-stu-id="8600c-164">2</span></span> |<span data-ttu-id="8600c-165">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="8600c-165">*65.52.0.2*</span></span> |<span data-ttu-id="8600c-166">TCP</span><span class="sxs-lookup"><span data-stu-id="8600c-166">TCP</span></span> |<span data-ttu-id="8600c-167">80</span><span class="sxs-lookup"><span data-stu-id="8600c-167">80</span></span> |

<span data-ttu-id="8600c-168">hello DIP 是 hello hello 目的地的輸入流量。</span><span class="sxs-lookup"><span data-stu-id="8600c-168">hello DIP is hello destination of hello inbound flow.</span></span> <span data-ttu-id="8600c-169">在 hello 後端集區，每個 VM 會公開 hello 預期 DIP 的唯一連接埠上的服務。</span><span class="sxs-lookup"><span data-stu-id="8600c-169">In hello backend pool, each VM exposes hello desired service on a unique port on a DIP.</span></span> <span data-ttu-id="8600c-170">此服務是透過規則定義的 hello 前端與相關聯。</span><span class="sxs-lookup"><span data-stu-id="8600c-170">This service is associated with hello frontend through a rule definition.</span></span>

<span data-ttu-id="8600c-171">我們定義兩個規則︰</span><span class="sxs-lookup"><span data-stu-id="8600c-171">We define two rules:</span></span>

| <span data-ttu-id="8600c-172">規則</span><span class="sxs-lookup"><span data-stu-id="8600c-172">Rule</span></span> | <span data-ttu-id="8600c-173">對應前端</span><span class="sxs-lookup"><span data-stu-id="8600c-173">Map frontend</span></span> | <span data-ttu-id="8600c-174">toobackend 集區</span><span class="sxs-lookup"><span data-stu-id="8600c-174">toobackend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="8600c-175">1</span><span class="sxs-lookup"><span data-stu-id="8600c-175">1</span></span> |![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="8600c-177">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="8600c-177">VIP1:80</span></span> |![後端](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="8600c-179">DIP1:80,</span><span class="sxs-lookup"><span data-stu-id="8600c-179">DIP1:80,</span></span> ![後端](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="8600c-181">DIP2:80</span><span class="sxs-lookup"><span data-stu-id="8600c-181">DIP2:80</span></span> |
| <span data-ttu-id="8600c-182">2</span><span class="sxs-lookup"><span data-stu-id="8600c-182">2</span></span> |![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="8600c-184">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="8600c-184">VIP2:80</span></span> |![後端](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="8600c-186">DIP1:81,</span><span class="sxs-lookup"><span data-stu-id="8600c-186">DIP1:81,</span></span> ![後端](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="8600c-188">DIP2:81</span><span class="sxs-lookup"><span data-stu-id="8600c-188">DIP2:81</span></span> |

<span data-ttu-id="8600c-189">Azure 負載平衡器中的 hello 完成對應現在如下所示：</span><span class="sxs-lookup"><span data-stu-id="8600c-189">hello complete mapping in Azure Load Balancer is now as follows:</span></span>

| <span data-ttu-id="8600c-190">規則</span><span class="sxs-lookup"><span data-stu-id="8600c-190">Rule</span></span> | <span data-ttu-id="8600c-191">VIP IP 位址</span><span class="sxs-lookup"><span data-stu-id="8600c-191">VIP IP address</span></span> | <span data-ttu-id="8600c-192">protocol</span><span class="sxs-lookup"><span data-stu-id="8600c-192">protocol</span></span> | <span data-ttu-id="8600c-193">連接埠</span><span class="sxs-lookup"><span data-stu-id="8600c-193">port</span></span> | <span data-ttu-id="8600c-194">目的地</span><span class="sxs-lookup"><span data-stu-id="8600c-194">Destination</span></span> | <span data-ttu-id="8600c-195">連接埠</span><span class="sxs-lookup"><span data-stu-id="8600c-195">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![規則](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="8600c-197">1</span><span class="sxs-lookup"><span data-stu-id="8600c-197">1</span></span> |<span data-ttu-id="8600c-198">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="8600c-198">65.52.0.1</span></span> |<span data-ttu-id="8600c-199">TCP</span><span class="sxs-lookup"><span data-stu-id="8600c-199">TCP</span></span> |<span data-ttu-id="8600c-200">80</span><span class="sxs-lookup"><span data-stu-id="8600c-200">80</span></span> |<span data-ttu-id="8600c-201">DIP IP 位址</span><span class="sxs-lookup"><span data-stu-id="8600c-201">DIP IP Address</span></span> |<span data-ttu-id="8600c-202">80</span><span class="sxs-lookup"><span data-stu-id="8600c-202">80</span></span> |
| ![規則](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="8600c-204">2</span><span class="sxs-lookup"><span data-stu-id="8600c-204">2</span></span> |<span data-ttu-id="8600c-205">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="8600c-205">65.52.0.2</span></span> |<span data-ttu-id="8600c-206">TCP</span><span class="sxs-lookup"><span data-stu-id="8600c-206">TCP</span></span> |<span data-ttu-id="8600c-207">80</span><span class="sxs-lookup"><span data-stu-id="8600c-207">80</span></span> |<span data-ttu-id="8600c-208">DIP IP 位址</span><span class="sxs-lookup"><span data-stu-id="8600c-208">DIP IP Address</span></span> |<span data-ttu-id="8600c-209">81</span><span class="sxs-lookup"><span data-stu-id="8600c-209">81</span></span> |

<span data-ttu-id="8600c-210">每個規則都必須產生具有唯一組合 (目的地 IP 位址和目的地連接埠組合) 的流程。</span><span class="sxs-lookup"><span data-stu-id="8600c-210">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="8600c-211">藉由各種 hello 的目的地連接埠 hello 資料流程，多個規則可以提供流程 toohello 不同的連接埠上的相同 DIP。</span><span class="sxs-lookup"><span data-stu-id="8600c-211">By varying hello destination port of hello flow, multiple rules can deliver flows toohello same DIP on different ports.</span></span>

<span data-ttu-id="8600c-212">健全狀況探查一律會導向的 toohello VM 的 DIP。</span><span class="sxs-lookup"><span data-stu-id="8600c-212">Health probes are always directed toohello DIP of a VM.</span></span> <span data-ttu-id="8600c-213">您必須確定您您探查反映 hello VM hello 健全狀況。</span><span class="sxs-lookup"><span data-stu-id="8600c-213">You must ensure you that your probe reflects hello health of hello VM.</span></span>

## <a name="rule-type-2-backend-port-reuse-by-using-floating-ip"></a><span data-ttu-id="8600c-214">規則類型 #2︰使用浮動 IP 來重複使用後端連接埠</span><span class="sxs-lookup"><span data-stu-id="8600c-214">Rule type #2: backend port reuse by using Floating IP</span></span>

<span data-ttu-id="8600c-215">Azure 負載平衡器提供跨多個 Vip，不論使用的 hello 規則類型 hello 彈性 tooreuse hello 的前端連接埠。</span><span class="sxs-lookup"><span data-stu-id="8600c-215">Azure Load Balancer provides hello flexibility tooreuse hello frontend port across multiple VIPs regardless of hello rule type used.</span></span> <span data-ttu-id="8600c-216">此外，部分應用程式案例偏好或要求相同連接埠 toobe hello 後端集區中之單一 vm 的多個應用程式執行個體所使用的 hello。</span><span class="sxs-lookup"><span data-stu-id="8600c-216">Additionally, some application scenarios prefer or require hello same port toobe used by multiple application instances on a single VM in hello backend pool.</span></span> <span data-ttu-id="8600c-217">連接埠重複使用的常見範例包括提供高可用性的叢集、網路虛擬裝置、公開多個不會重新加密的 TLS 端點。</span><span class="sxs-lookup"><span data-stu-id="8600c-217">Common examples of port reuse include clustering for high availability, network virtual appliances, and exposing multiple TLS endpoints without re-encryption.</span></span>

<span data-ttu-id="8600c-218">如果您想 tooreuse hello 後端連接埠跨多個規則，您必須啟用浮動 IP hello 規則定義中。</span><span class="sxs-lookup"><span data-stu-id="8600c-218">If you want tooreuse hello backend port across multiple rules, you must enable Floating IP in hello rule definition.</span></span>

<span data-ttu-id="8600c-219">浮動 IP 是伺服器直接回傳 (DSR) 的一部分。</span><span class="sxs-lookup"><span data-stu-id="8600c-219">Floating IP is a portion of what is known as Direct Server Return (DSR).</span></span> <span data-ttu-id="8600c-220">DSR 包含兩個部分︰流程拓樸和 IP 位址對應配置。</span><span class="sxs-lookup"><span data-stu-id="8600c-220">DSR consists of two parts: a flow topology and an IP address mapping scheme.</span></span> <span data-ttu-id="8600c-221">在平台層級，Azure Load Balancer 一律在 DSR 流程拓撲中運作，無論是否已啟用浮動 IP。</span><span class="sxs-lookup"><span data-stu-id="8600c-221">At a platform level, Azure Load Balancer always operates in a DSR flow topology regardless of whether Floating IP is enabled or not.</span></span> <span data-ttu-id="8600c-222">這表示 hello 流程一部分輸出永遠是正確重寫的 tooflow 直接後 toohello 原點。</span><span class="sxs-lookup"><span data-stu-id="8600c-222">This means that hello outbound part of a flow is always correctly rewritten tooflow directly back toohello origin.</span></span>

<span data-ttu-id="8600c-223">與 hello 預設規則類型，Azure 會公開傳統負載平衡以方便使用的 IP 位址對應配置。</span><span class="sxs-lookup"><span data-stu-id="8600c-223">With hello default rule type, Azure exposes a traditional load balancing IP address mapping scheme for ease of use.</span></span> <span data-ttu-id="8600c-224">啟用浮動 IP 變更額外的彈性，說明如下所示為 hello IP 位址對應配置 tooallow。</span><span class="sxs-lookup"><span data-stu-id="8600c-224">Enabling Floating IP changes hello IP address mapping scheme tooallow for additional flexibility as explained below.</span></span>

<span data-ttu-id="8600c-225">hello 下列圖表將說明這項設定：</span><span class="sxs-lookup"><span data-stu-id="8600c-225">hello following diagram illustrates this configuration:</span></span>

![MultiVIP 圖解片](./media/load-balancer-multivip-overview/load-balancer-multivip-dsr.png)

<span data-ttu-id="8600c-227">此案例中，針對 hello 後端集區中的每個 VM 會具有三個網路介面：</span><span class="sxs-lookup"><span data-stu-id="8600c-227">For this scenario, every VM in hello backend pool has three network interfaces:</span></span>

* <span data-ttu-id="8600c-228">DIP: 虛擬 NIC 與 hello VM （Azure 的 NIC 資源的 IP 組態） 相關聯</span><span class="sxs-lookup"><span data-stu-id="8600c-228">DIP: a Virtual NIC associated with hello VM (IP configuration of Azure's NIC resource)</span></span>
* <span data-ttu-id="8600c-229">VIP1︰客體 OS 內的回送介面 (此 OS 已設定了 VIP1 的 IP 位址)</span><span class="sxs-lookup"><span data-stu-id="8600c-229">VIP1: a loopback interface within guest OS that is configured with IP address of VIP1</span></span>
* <span data-ttu-id="8600c-230">VIP2︰客體 OS 內的回送介面 (此 OS 已設定了 VIP2 的 IP 位址)</span><span class="sxs-lookup"><span data-stu-id="8600c-230">VIP2: a loopback interface within guest OS that is configured with IP address of VIP2</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8600c-231">hello 組態的 hello 邏輯介面 hello 客體作業系統內執行。</span><span class="sxs-lookup"><span data-stu-id="8600c-231">hello configuration of hello logical interfaces is performed within hello guest OS.</span></span> <span data-ttu-id="8600c-232">這項設定不是由 Azure 執行或管理。</span><span class="sxs-lookup"><span data-stu-id="8600c-232">This configuration is not performed or managed by Azure.</span></span> <span data-ttu-id="8600c-233">沒有此設定，hello 規則將無法運作。</span><span class="sxs-lookup"><span data-stu-id="8600c-233">Without this configuration, hello rules will not function.</span></span> <span data-ttu-id="8600c-234">健全狀況探查定義使用 hello hello VM 的 DIP，而不是 hello 邏輯的 VIP。</span><span class="sxs-lookup"><span data-stu-id="8600c-234">Health probe definitions use hello DIP of hello VM rather than hello logical VIP.</span></span> <span data-ttu-id="8600c-235">因此，您的服務必須提供所提供的 hello 服務的 hello 狀態反映 hello 邏輯 vip DIP 通訊埠上的探查回應。</span><span class="sxs-lookup"><span data-stu-id="8600c-235">Therefore, your service must provide probe responses on a DIP port that reflect hello status of hello service offered on hello logical VIP.</span></span>

<span data-ttu-id="8600c-236">讓我們假設 hello 相同的前端組態，如 hello 前一個案例所示：</span><span class="sxs-lookup"><span data-stu-id="8600c-236">Let's assume hello same frontend configuration as in hello previous scenario:</span></span>

| <span data-ttu-id="8600c-237">VIP</span><span class="sxs-lookup"><span data-stu-id="8600c-237">VIP</span></span> | <span data-ttu-id="8600c-238">IP 位址</span><span class="sxs-lookup"><span data-stu-id="8600c-238">IP address</span></span> | <span data-ttu-id="8600c-239">protocol</span><span class="sxs-lookup"><span data-stu-id="8600c-239">protocol</span></span> | <span data-ttu-id="8600c-240">連接埠</span><span class="sxs-lookup"><span data-stu-id="8600c-240">port</span></span> |
| --- | --- | --- | --- |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="8600c-242">1</span><span class="sxs-lookup"><span data-stu-id="8600c-242">1</span></span> |<span data-ttu-id="8600c-243">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="8600c-243">65.52.0.1</span></span> |<span data-ttu-id="8600c-244">TCP</span><span class="sxs-lookup"><span data-stu-id="8600c-244">TCP</span></span> |<span data-ttu-id="8600c-245">80</span><span class="sxs-lookup"><span data-stu-id="8600c-245">80</span></span> |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="8600c-247">2</span><span class="sxs-lookup"><span data-stu-id="8600c-247">2</span></span> |<span data-ttu-id="8600c-248">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="8600c-248">*65.52.0.2*</span></span> |<span data-ttu-id="8600c-249">TCP</span><span class="sxs-lookup"><span data-stu-id="8600c-249">TCP</span></span> |<span data-ttu-id="8600c-250">80</span><span class="sxs-lookup"><span data-stu-id="8600c-250">80</span></span> |

<span data-ttu-id="8600c-251">我們定義兩個規則︰</span><span class="sxs-lookup"><span data-stu-id="8600c-251">We define two rules:</span></span>

| <span data-ttu-id="8600c-252">規則</span><span class="sxs-lookup"><span data-stu-id="8600c-252">Rule</span></span> | <span data-ttu-id="8600c-253">對應前端</span><span class="sxs-lookup"><span data-stu-id="8600c-253">Map frontend</span></span> | <span data-ttu-id="8600c-254">toobackend 集區</span><span class="sxs-lookup"><span data-stu-id="8600c-254">toobackend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="8600c-255">1</span><span class="sxs-lookup"><span data-stu-id="8600c-255">1</span></span> |![規則](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="8600c-257">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="8600c-257">VIP1:80</span></span> |![後端](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="8600c-259">VIP1:80 (在 VM1 和 VM2)</span><span class="sxs-lookup"><span data-stu-id="8600c-259">VIP1:80 (in VM1 and VM2)</span></span> |
| <span data-ttu-id="8600c-260">2</span><span class="sxs-lookup"><span data-stu-id="8600c-260">2</span></span> |![規則](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="8600c-262">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="8600c-262">VIP2:80</span></span> |![後端](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="8600c-264">VIP2:80 (在 VM1 和 VM2)</span><span class="sxs-lookup"><span data-stu-id="8600c-264">VIP2:80 (in VM1 and VM2)</span></span> |

<span data-ttu-id="8600c-265">下表中的 hello hello 負載平衡器中顯示 hello 完整的對應：</span><span class="sxs-lookup"><span data-stu-id="8600c-265">hello following table shows hello complete mapping in hello load balancer:</span></span>

| <span data-ttu-id="8600c-266">規則</span><span class="sxs-lookup"><span data-stu-id="8600c-266">Rule</span></span> | <span data-ttu-id="8600c-267">VIP IP 位址</span><span class="sxs-lookup"><span data-stu-id="8600c-267">VIP IP address</span></span> | <span data-ttu-id="8600c-268">protocol</span><span class="sxs-lookup"><span data-stu-id="8600c-268">protocol</span></span> | <span data-ttu-id="8600c-269">連接埠</span><span class="sxs-lookup"><span data-stu-id="8600c-269">port</span></span> | <span data-ttu-id="8600c-270">目的地</span><span class="sxs-lookup"><span data-stu-id="8600c-270">Destination</span></span> | <span data-ttu-id="8600c-271">連接埠</span><span class="sxs-lookup"><span data-stu-id="8600c-271">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="8600c-273">1</span><span class="sxs-lookup"><span data-stu-id="8600c-273">1</span></span> |<span data-ttu-id="8600c-274">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="8600c-274">65.52.0.1</span></span> |<span data-ttu-id="8600c-275">TCP</span><span class="sxs-lookup"><span data-stu-id="8600c-275">TCP</span></span> |<span data-ttu-id="8600c-276">80</span><span class="sxs-lookup"><span data-stu-id="8600c-276">80</span></span> |<span data-ttu-id="8600c-277">與 VIP 相同 (65.52.0.1)</span><span class="sxs-lookup"><span data-stu-id="8600c-277">same as VIP (65.52.0.1)</span></span> |<span data-ttu-id="8600c-278">與 VIP 相同 (80)</span><span class="sxs-lookup"><span data-stu-id="8600c-278">same as VIP (80)</span></span> |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="8600c-280">2</span><span class="sxs-lookup"><span data-stu-id="8600c-280">2</span></span> |<span data-ttu-id="8600c-281">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="8600c-281">65.52.0.2</span></span> |<span data-ttu-id="8600c-282">TCP</span><span class="sxs-lookup"><span data-stu-id="8600c-282">TCP</span></span> |<span data-ttu-id="8600c-283">80</span><span class="sxs-lookup"><span data-stu-id="8600c-283">80</span></span> |<span data-ttu-id="8600c-284">與 VIP 相同 (65.52.0.2)</span><span class="sxs-lookup"><span data-stu-id="8600c-284">same as VIP (65.52.0.2)</span></span> |<span data-ttu-id="8600c-285">與 VIP 相同 (80)</span><span class="sxs-lookup"><span data-stu-id="8600c-285">same as VIP (80)</span></span> |

<span data-ttu-id="8600c-286">hello 目的地 hello 的輸入的流量沒有受到 hello VM 中的 hello 回送介面上的 hello VIP 位址。</span><span class="sxs-lookup"><span data-stu-id="8600c-286">hello destination of hello inbound flow is hello VIP address on hello loopback interface in hello VM.</span></span> <span data-ttu-id="8600c-287">每個規則都必須產生具有唯一組合 (目的地 IP 位址和目的地連接埠組合) 的流程。</span><span class="sxs-lookup"><span data-stu-id="8600c-287">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="8600c-288">依不同 hello 目的地 IP 位址的 hello 流程連接埠重複使用是有可能會在 hello 相同的 VM。</span><span class="sxs-lookup"><span data-stu-id="8600c-288">By varying hello destination IP address of hello flow, port reuse is possible on hello same VM.</span></span> <span data-ttu-id="8600c-289">您的服務 toohello VIP 的 IP 位址和連接埠 hello 個別的回送介面將它繫結所公開的 toohello 負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="8600c-289">Your service is exposed toohello load balancer by binding it toohello VIP’s IP address and port of hello respective loopback interface.</span></span>

<span data-ttu-id="8600c-290">請注意此範例不會變更 hello 目的地連接埠。</span><span class="sxs-lookup"><span data-stu-id="8600c-290">Notice that this example does not change hello destination port.</span></span> <span data-ttu-id="8600c-291">雖然這是浮動 IP 的案例，Azure 負載平衡器也支援定義規則 toorewrite hello 後端目的地連接埠和 toomake 它不同於 hello 前端目的地連接埠。</span><span class="sxs-lookup"><span data-stu-id="8600c-291">Even though this is a Floating IP scenario, Azure Load Balancer also supports defining a rule toorewrite hello backend destination port and toomake it different from hello frontend destination port.</span></span>

<span data-ttu-id="8600c-292">hello 浮動 IP 規則類型是數種負載平衡器組態模式的 hello foundation。</span><span class="sxs-lookup"><span data-stu-id="8600c-292">hello Floating IP rule type is hello foundation of several load balancer configuration patterns.</span></span> <span data-ttu-id="8600c-293">目前可用的其中一個範例是 hello[與多個接聽程式的 SQL AlwaysOn](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md)組態。</span><span class="sxs-lookup"><span data-stu-id="8600c-293">One example that is currently available is hello [SQL AlwaysOn with Multiple Listeners](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) configuration.</span></span> <span data-ttu-id="8600c-294">經過一段時間，我們會記載更多這類案例。</span><span class="sxs-lookup"><span data-stu-id="8600c-294">Over time, we will document more of these scenarios.</span></span>

## <a name="limitations"></a><span data-ttu-id="8600c-295">限制</span><span class="sxs-lookup"><span data-stu-id="8600c-295">Limitations</span></span>

* <span data-ttu-id="8600c-296">只有 IaaS VM 支援多個 VIP 設定。</span><span class="sxs-lookup"><span data-stu-id="8600c-296">Multiple VIP configurations are only supported with IaaS VMs.</span></span>
* <span data-ttu-id="8600c-297">Hello 浮動 IP 規則之後，您的應用程式必須使用輸出流量 hello DIP。</span><span class="sxs-lookup"><span data-stu-id="8600c-297">With hello Floating IP rule, your application must use hello DIP for outbound flows.</span></span> <span data-ttu-id="8600c-298">如果您的應用程式將繫結 toohello hello 客體作業系統中的 hello 回送介面上設定的 VIP 位址，則 SNAT 不是使用 toorewrite hello 輸出流量，而 hello 流程失敗。</span><span class="sxs-lookup"><span data-stu-id="8600c-298">If your application binds toohello VIP address configured on hello loopback interface in hello guest OS, then SNAT is not available toorewrite hello outbound flow and hello flow fails.</span></span>
* <span data-ttu-id="8600c-299">公用 IP 位址需要費用。</span><span class="sxs-lookup"><span data-stu-id="8600c-299">Public IP addresses have an effect on billing.</span></span> <span data-ttu-id="8600c-300">如需詳細資訊，請參閱 [IP 位址定價](https://azure.microsoft.com/pricing/details/ip-addresses/)</span><span class="sxs-lookup"><span data-stu-id="8600c-300">For more information, see [IP Address pricing](https://azure.microsoft.com/pricing/details/ip-addresses/)</span></span>
* <span data-ttu-id="8600c-301">訂用帳戶有其限制。</span><span class="sxs-lookup"><span data-stu-id="8600c-301">Subscription limits apply.</span></span> <span data-ttu-id="8600c-302">如需詳細資訊，請參閱 [服務限制](../azure-subscription-service-limits.md#networking-limits) 的說明。</span><span class="sxs-lookup"><span data-stu-id="8600c-302">For more information, see [Service limits](../azure-subscription-service-limits.md#networking-limits) for details.</span></span>
