---
title: "針對應用程式 Proxy 進行疑難排解 | Microsoft Docs"
description: "說明如何疑難排解 Azure AD 應用程式 Proxy 中的錯誤。"
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 970caafb-40b8-483c-bb46-c8b032a4fb74
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/21/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: H1Hack27Feb2017; it-pro
ms.openlocfilehash: 3ef74c8d5d5b75eb2bca4e6c994f4718b5226db8
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/03/2017
---
# <a name="troubleshoot-application-proxy-problems-and-error-messages"></a><span data-ttu-id="28d9c-103">針對應用程式 Proxy 問題和錯誤訊息進行疑難排解</span><span class="sxs-lookup"><span data-stu-id="28d9c-103">Troubleshoot Application Proxy problems and error messages</span></span>
<span data-ttu-id="28d9c-104">如果在存取已發佈的應用程式或發佈應用程式時發生錯誤，請檢查下列選項以查看 Microsoft Azure AD 應用程式 Proxy 是否運作正常︰</span><span class="sxs-lookup"><span data-stu-id="28d9c-104">If errors occur in accessing a published application or in publishing applications, check the following options to see if Microsoft Azure AD Application Proxy is working correctly:</span></span>

* <span data-ttu-id="28d9c-105">開啟 [Windows 服務] 主控台並確認 [Microsoft AAD 應用程式 Proxy 連接器]  服務已啟用並在執行中。</span><span class="sxs-lookup"><span data-stu-id="28d9c-105">Open the Windows Services console and verify that the **Microsoft AAD Application Proxy Connector** service is enabled and running.</span></span> <span data-ttu-id="28d9c-106">您也可以查看應用程式 Proxy 服務屬性頁面，如下圖所示：</span><span class="sxs-lookup"><span data-stu-id="28d9c-106">You may also want to look at the Application Proxy service properties page, as shown in the following image:</span></span>  
  <span data-ttu-id="28d9c-107">![[Microsoft AAD 應用程式 Proxy 連接器屬性] 視窗螢幕擷取畫面](./media/active-directory-application-proxy-troubleshoot/connectorproperties.png)</span><span class="sxs-lookup"><span data-stu-id="28d9c-107">![Microsoft AAD Application Proxy Connector Properties window screenshot](./media/active-directory-application-proxy-troubleshoot/connectorproperties.png)</span></span>
* <span data-ttu-id="28d9c-108">開啟 [事件檢視器]，然後在 [應用程式及服務記錄檔] > [Microsoft] > [AadApplicationProxy] > [Connector] > [Admin] 中尋找「應用程式 Proxy」連接器事件。</span><span class="sxs-lookup"><span data-stu-id="28d9c-108">Open Event Viewer and look for Application Proxy connector events in **Applications and Services Logs** > **Microsoft** > **AadApplicationProxy** > **Connector** > **Admin**.</span></span>
* <span data-ttu-id="28d9c-109">如有需要，請透過[開啟應用程式 Proxy 連接器工作階段記錄檔](application-proxy-understand-connectors.md#under-the-hood)，來取得更詳細的記錄檔。</span><span class="sxs-lookup"><span data-stu-id="28d9c-109">If needed, more detailed logs are available by [turning on the Application Proxy connector session logs](application-proxy-understand-connectors.md#under-the-hood).</span></span>

<span data-ttu-id="28d9c-110">如需 Azure AD 疑難排解工具的詳細資訊，請參閱[用於驗證連接器網路必要條件的疑難排解工具](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/03/troubleshooting-tool-to-validate-connector-networking-prerequisites)。</span><span class="sxs-lookup"><span data-stu-id="28d9c-110">For more information about the Azure AD Troubleshooting tool, see [Troubleshooting tool to validate connector networking prerequisites](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/03/troubleshooting-tool-to-validate-connector-networking-prerequisites).</span></span>

## <a name="the-page-is-not-rendered-correctly"></a><span data-ttu-id="28d9c-111">無法正確轉譯頁面</span><span class="sxs-lookup"><span data-stu-id="28d9c-111">The page is not rendered correctly</span></span>
<span data-ttu-id="28d9c-112">您可能會遇到應用程式轉譯有問題或運作不正確，但沒有收到特定錯誤訊息的情況。</span><span class="sxs-lookup"><span data-stu-id="28d9c-112">You may have problems with your application rendering or functioning incorrectly without receiving specific error messages.</span></span> <span data-ttu-id="28d9c-113">如果您已發佈文章路徑，但應用程式需要存在於該路徑以外的內容，就可能發生此問題。</span><span class="sxs-lookup"><span data-stu-id="28d9c-113">This can occur if you published the article path, but the application requires content that exists outside that path.</span></span>

<span data-ttu-id="28d9c-114">例如，如果您發佈的路徑是 https://yourapp/app，但應用程式呼叫的是 https://yourapp/media 中的影像，系統便不會轉譯那些影像。</span><span class="sxs-lookup"><span data-stu-id="28d9c-114">For example, if you publish the path https://yourapp/app but the application calls images in https://yourapp/media, they won't be rendered.</span></span> <span data-ttu-id="28d9c-115">請確定您是使用包含所有相關內容所需的最高層級路徑來發佈應用程式。</span><span class="sxs-lookup"><span data-stu-id="28d9c-115">Make sure that you publish the application using the highest level path you need to include all relevant content.</span></span> <span data-ttu-id="28d9c-116">在此範例中，它會是 http://yourapp/。</span><span class="sxs-lookup"><span data-stu-id="28d9c-116">In this example, it would be http://yourapp/.</span></span>

<span data-ttu-id="28d9c-117">如果您變更路徑以包含參考的內容，但仍需要使用者登入該路徑中更深層的連結，請參閱部落格文章 [在 Azure AD 存取面板和 Office 365 應用程式啟動程式中為應用程式 Proxy 應用程式設定正確的連結](https://blogs.technet.microsoft.com/applicationproxyblog/2016/04/06/setting-the-right-link-for-application-proxy-applications-in-the-azure-ad-access-panel-and-office-365-app-launcher/)。</span><span class="sxs-lookup"><span data-stu-id="28d9c-117">If you change your path to include referenced content, but still need users to land on a deeper link in the path, see the blog post [Setting the right link for Application Proxy applications in the Azure AD access panel and Office 365 app launcher](https://blogs.technet.microsoft.com/applicationproxyblog/2016/04/06/setting-the-right-link-for-application-proxy-applications-in-the-azure-ad-access-panel-and-office-365-app-launcher/).</span></span>

## <a name="connector-errors"></a><span data-ttu-id="28d9c-118">連接器錯誤</span><span class="sxs-lookup"><span data-stu-id="28d9c-118">Connector errors</span></span>

<span data-ttu-id="28d9c-119">請使用 [Azure AD 應用程式 Proxy 連接器連接埠測試工具](https://aadap-portcheck.connectorporttest.msappproxy.net/)，來確認您的連接器是否能夠連線到「應用程式 Proxy」服務。</span><span class="sxs-lookup"><span data-stu-id="28d9c-119">Use the [Azure AD Application Proxy Connector Ports Test Tool](https://aadap-portcheck.connectorporttest.msappproxy.net/) to verify that your connector can reach the Application Proxy service.</span></span> <span data-ttu-id="28d9c-120">至少，請確定「美國中部」區域及離您最近的區域都具有綠色勾選記號。</span><span class="sxs-lookup"><span data-stu-id="28d9c-120">At a minimum, make sure that the Central US region and the region closest to you have all green checkmarks.</span></span> <span data-ttu-id="28d9c-121">除此之外，綠色勾選記號越多代表恢復能力越佳。</span><span class="sxs-lookup"><span data-stu-id="28d9c-121">Beyond that, more green checkmarks means greater resiliency.</span></span> 

<span data-ttu-id="28d9c-122">如果在連接器精靈安裝期間註冊失敗，有兩種方式可以檢視失敗的原因。</span><span class="sxs-lookup"><span data-stu-id="28d9c-122">If registration fails during the Connector wizard installation, there are two ways to view the reason for the failure.</span></span> <span data-ttu-id="28d9c-123">在事件記錄檔中的 **Applications and Services Logs\Microsoft\AadApplicationProxy\Connector\Admin** 底下尋找，或執行下列 Windows PowerShell 命令：</span><span class="sxs-lookup"><span data-stu-id="28d9c-123">Either look in the event log under **Applications and Services Logs\Microsoft\AadApplicationProxy\Connector\Admin**, or run the following Windows PowerShell command:</span></span>

    Get-EventLog application –source “Microsoft AAD Application Proxy Connector” –EntryType “Error” –Newest 1

<span data-ttu-id="28d9c-124">若您在事件記錄檔中找到連接器錯誤，則使用這份常見錯誤表格來解決問題︰</span><span class="sxs-lookup"><span data-stu-id="28d9c-124">Once you find the Connector error from the event log, use this table of common errors to resolve the problem:</span></span>

| <span data-ttu-id="28d9c-125">錯誤</span><span class="sxs-lookup"><span data-stu-id="28d9c-125">Error</span></span> | <span data-ttu-id="28d9c-126">建議的步驟</span><span class="sxs-lookup"><span data-stu-id="28d9c-126">Recommended steps</span></span> |
| ----- | ----------------- |
| <span data-ttu-id="28d9c-127">連接器註冊失敗︰確定您已在 Azure 管理入口網站中啟用應用程式 Proxy，並已正確地輸入您的 Active Directory 使用者名稱和密碼。</span><span class="sxs-lookup"><span data-stu-id="28d9c-127">Connector registration failed: Make sure you enabled Application Proxy in the Azure Management Portal and that you entered your Active Directory user name and password correctly.</span></span> <span data-ttu-id="28d9c-128">錯誤︰「發生一或多個錯誤。」</span><span class="sxs-lookup"><span data-stu-id="28d9c-128">Error: 'One or more errors occurred.'</span></span> | <span data-ttu-id="28d9c-129">如果您在未登入 Azure AD 的情況下關閉註冊視窗，請再次執行連接器精靈，並註冊連接器。</span><span class="sxs-lookup"><span data-stu-id="28d9c-129">If you closed the registration window without signing in to Azure AD, run the Connector wizard again and register the Connector.</span></span> <br><br> <span data-ttu-id="28d9c-130">如果註冊視窗隨即開啟，然後立即關閉，而不讓您登入，您可能會發生此錯誤。</span><span class="sxs-lookup"><span data-stu-id="28d9c-130">If the registration window opens and then immediately closes without allowing you to log in, you will probably get this error.</span></span> <span data-ttu-id="28d9c-131">您的系統有網路錯誤時，就會發生此錯誤。</span><span class="sxs-lookup"><span data-stu-id="28d9c-131">This error occurs when there is a networking error on your system.</span></span> <span data-ttu-id="28d9c-132">確定可以從瀏覽器連線至公用網站，並如 [應用程式 Proxy 先決條件](active-directory-application-proxy-enable.md)所指定開啟連接埠。</span><span class="sxs-lookup"><span data-stu-id="28d9c-132">Make sure that it is possible to connect from a browser to a public website and that the ports are open as specified in [Application Proxy prerequisites](active-directory-application-proxy-enable.md).</span></span> |
| <span data-ttu-id="28d9c-133">清除錯誤會顯示在註冊視窗中。</span><span class="sxs-lookup"><span data-stu-id="28d9c-133">Clear error is presented in the registration window.</span></span> <span data-ttu-id="28d9c-134">無法繼續</span><span class="sxs-lookup"><span data-stu-id="28d9c-134">Cannot proceed</span></span> | <span data-ttu-id="28d9c-135">如果您看到這個錯誤且視窗隨後關閉，表示您輸入錯誤的使用者名稱或密碼。</span><span class="sxs-lookup"><span data-stu-id="28d9c-135">If you see this error and then the window closes, you entered the wrong username or password.</span></span> <span data-ttu-id="28d9c-136">請再試一次。</span><span class="sxs-lookup"><span data-stu-id="28d9c-136">Try again.</span></span> |
| <span data-ttu-id="28d9c-137">連接器註冊失敗︰確定您已在 Azure 管理入口網站中啟用應用程式 Proxy，並已正確地輸入您的 Active Directory 使用者名稱和密碼。</span><span class="sxs-lookup"><span data-stu-id="28d9c-137">Connector registration failed: Make sure you enabled Application Proxy in the Azure Management Portal and that you entered your Active Directory user name and password correctly.</span></span> <span data-ttu-id="28d9c-138">錯誤︰「AADSTS50059: 在要求中找不到租用戶識別資訊，或任何提供的認證均未隱含租用戶識別資訊，而且依服務主體 URI 的搜尋已失敗。</span><span class="sxs-lookup"><span data-stu-id="28d9c-138">Error: 'AADSTS50059: No tenant-identifying information found in either the request or implied by any provided credentials and search by service principal URI has failed.</span></span> | <span data-ttu-id="28d9c-139">您嘗試使用 Microsoft 帳戶進行登入，而非使用屬於您嘗試存取之目錄的組織識別碼的網域。</span><span class="sxs-lookup"><span data-stu-id="28d9c-139">You are trying to sign in using a Microsoft Account and not a domain that is part of the organization ID of the directory you are trying to access.</span></span> <span data-ttu-id="28d9c-140">確定系統管理員屬於與租用戶網域相同的網域名稱，例如，若 Azure AD 網域是 contoso.com，則系統管理員應該是 admin@contoso.com。</span><span class="sxs-lookup"><span data-stu-id="28d9c-140">Make sure that the admin is part of the same domain name as the tenant domain, for example, if the Azure AD domain is contoso.com, the admin should be admin@contoso.com.</span></span> |
| <span data-ttu-id="28d9c-141">無法擷取目前的執行原則以供執行 PowerShell 指令碼。</span><span class="sxs-lookup"><span data-stu-id="28d9c-141">Failed to retrieve the current execution policy for running PowerShell scripts.</span></span> | <span data-ttu-id="28d9c-142">如果連接器安裝失敗，請檢查以確定未停用 PowerShell 執行原則。</span><span class="sxs-lookup"><span data-stu-id="28d9c-142">If the Connector installation fails, check to make sure that PowerShell execution policy is not disabled.</span></span> <br><br><span data-ttu-id="28d9c-143">1.開啟 [群組原則編輯器]。</span><span class="sxs-lookup"><span data-stu-id="28d9c-143">1. Open the Group Policy Editor.</span></span><br><span data-ttu-id="28d9c-144">2.移至 [電腦設定] > [系統管理範本] > [Windows 元件] > [Windows PowerShell]，按兩下 [開啟指令碼執行]。</span><span class="sxs-lookup"><span data-stu-id="28d9c-144">2. Go to **Computer Configuration** > **Administrative Templates** > **Windows Components** > **Windows PowerShell** and double-click **Turn on Script Execution**.</span></span><br><span data-ttu-id="28d9c-145">3.執行原則可以設定為 [未設定] 或 [已啟用]。</span><span class="sxs-lookup"><span data-stu-id="28d9c-145">3. The execution policy can be set to either **Not Configured** or **Enabled**.</span></span> <span data-ttu-id="28d9c-146">如果是設定為 [已啟用]，請確定 [選項] 底下的 [執行原則] 是設定為 [允許本機指令碼和遠端已簽署的指令碼] 或 [允許所有指令碼]。</span><span class="sxs-lookup"><span data-stu-id="28d9c-146">If set to **Enabled**, make sure that under Options, the Execution Policy is set to either **Allow local scripts and remote signed scripts** or to **Allow all scripts**.</span></span> |
| <span data-ttu-id="28d9c-147">連接器無法下載組態。</span><span class="sxs-lookup"><span data-stu-id="28d9c-147">Connector failed to download the configuration.</span></span> | <span data-ttu-id="28d9c-148">連接器用於驗證的用戶端憑證已過期。</span><span class="sxs-lookup"><span data-stu-id="28d9c-148">The Connector’s client certificate, which is used for authentication, expired.</span></span> <span data-ttu-id="28d9c-149">如果您將連接器安裝在 Proxy 後面，也可能發生這種情形。</span><span class="sxs-lookup"><span data-stu-id="28d9c-149">This may also occur if you have the Connector installed behind a proxy.</span></span> <span data-ttu-id="28d9c-150">在此情況下，連接器無法存取網際網路，且無法將應用程式提供給遠端使用者。</span><span class="sxs-lookup"><span data-stu-id="28d9c-150">In this case, the Connector cannot access the Internet and will not be able to provide applications to remote users.</span></span> <span data-ttu-id="28d9c-151">在 Windows PowerShell 中使用 `Register-AppProxyConnector` Cmdlet，手動更新信任。</span><span class="sxs-lookup"><span data-stu-id="28d9c-151">Renew trust manually using the `Register-AppProxyConnector` cmdlet in Windows PowerShell.</span></span> <span data-ttu-id="28d9c-152">如果您的連接器位於 Proxy 後面，則必須將網際網路存取權授與「網絡服務」和「本機系統」連接器帳戶。</span><span class="sxs-lookup"><span data-stu-id="28d9c-152">If your Connector is behind a proxy, it is necessary to grant Internet access to the Connector accounts “network services” and “local system.”</span></span> <span data-ttu-id="28d9c-153">授與 Proxy 的存取權或將其設為略過 Proxy，即可完成此作業。</span><span class="sxs-lookup"><span data-stu-id="28d9c-153">This can be accomplished either by granting them access to the Proxy or by setting them to bypass the proxy.</span></span> |
| <span data-ttu-id="28d9c-154">連接器註冊失敗︰確定您是 Active Directory 的全域管理員以註冊連接器。</span><span class="sxs-lookup"><span data-stu-id="28d9c-154">Connector registration failed: Make sure you are a Global Administrator of your Active Directory to register the Connector.</span></span> <span data-ttu-id="28d9c-155">錯誤︰「註冊要求被拒絕。」</span><span class="sxs-lookup"><span data-stu-id="28d9c-155">Error: 'The registration request was denied.'</span></span> | <span data-ttu-id="28d9c-156">您嘗試用以登入的別名不是此網域的系統管理員。</span><span class="sxs-lookup"><span data-stu-id="28d9c-156">The alias you're trying to log in with isn't an admin on this domain.</span></span> <span data-ttu-id="28d9c-157">您的連接器永遠都會針對擁有使用者網域的目錄進行安裝。</span><span class="sxs-lookup"><span data-stu-id="28d9c-157">Your Connector is always installed for the directory that owns the user’s domain.</span></span> <span data-ttu-id="28d9c-158">確定您嘗試用以登入的系統管理員身分帳戶具有 Azure AD 租用戶的全域權限。</span><span class="sxs-lookup"><span data-stu-id="28d9c-158">Make sure that the admin account you are trying to sign in with has global permissions to the Azure AD tenant.</span></span> |

## <a name="kerberos-errors"></a><span data-ttu-id="28d9c-159">Kerberos 錯誤</span><span class="sxs-lookup"><span data-stu-id="28d9c-159">Kerberos errors</span></span>

<span data-ttu-id="28d9c-160">這個表格涵蓋有關 Kerberos 設定和組態的常見錯誤，並建議解決辦法。</span><span class="sxs-lookup"><span data-stu-id="28d9c-160">This table covers the more common errors that come from Kerberos setup and configuration, and includes suggestions for resolution.</span></span>

| <span data-ttu-id="28d9c-161">錯誤</span><span class="sxs-lookup"><span data-stu-id="28d9c-161">Error</span></span> | <span data-ttu-id="28d9c-162">建議的步驟</span><span class="sxs-lookup"><span data-stu-id="28d9c-162">Recommended steps</span></span> |
| ----- | ----------------- |
| <span data-ttu-id="28d9c-163">無法擷取目前的執行原則以供執行 PowerShell 指令碼。</span><span class="sxs-lookup"><span data-stu-id="28d9c-163">Failed to retrieve the current execution policy for running PowerShell scripts.</span></span> | <span data-ttu-id="28d9c-164">如果連接器安裝失敗，請檢查以確定未停用 PowerShell 執行原則。</span><span class="sxs-lookup"><span data-stu-id="28d9c-164">If the Connector installation fails, check to make sure that PowerShell execution policy is not disabled.</span></span><br><br><span data-ttu-id="28d9c-165">1.開啟 [群組原則編輯器]。</span><span class="sxs-lookup"><span data-stu-id="28d9c-165">1. Open the Group Policy Editor.</span></span><br><span data-ttu-id="28d9c-166">2.移至 [電腦設定] > [系統管理範本] > [Windows 元件] > [Windows PowerShell]，按兩下 [開啟指令碼執行]。</span><span class="sxs-lookup"><span data-stu-id="28d9c-166">2. Go to **Computer Configuration** > **Administrative Templates** > **Windows Components** > **Windows PowerShell** and double-click **Turn on Script Execution**.</span></span><br><span data-ttu-id="28d9c-167">3.執行原則可以設定為 [未設定] 或 [已啟用]。</span><span class="sxs-lookup"><span data-stu-id="28d9c-167">3. The execution policy can be set to either **Not Configured** or **Enabled**.</span></span> <span data-ttu-id="28d9c-168">如果是設定為 [已啟用]，請確定 [選項] 底下的 [執行原則] 是設定為 [允許本機指令碼和遠端已簽署的指令碼] 或 [允許所有指令碼]。</span><span class="sxs-lookup"><span data-stu-id="28d9c-168">If set to **Enabled**, make sure that under Options, the Execution Policy is set to either **Allow local scripts and remote signed scripts** or to **Allow all scripts**.</span></span> |
| <span data-ttu-id="28d9c-169">12008 - Azure AD 已超出後端伺服器允許的 Kerberos 驗證嘗試次數上限。</span><span class="sxs-lookup"><span data-stu-id="28d9c-169">12008 - Azure AD exceeded the maximum number of permitted Kerberos authentication attempts to the backend server.</span></span> | <span data-ttu-id="28d9c-170">此錯誤可能表示 Azure AD 與後端應用程式伺服器之間的設定不正確，或兩台電腦上的日期和時間設定有問題。</span><span class="sxs-lookup"><span data-stu-id="28d9c-170">This error may indicate incorrect configuration between Azure AD and the backend application server, or a problem in time and date configuration on both machines.</span></span> <span data-ttu-id="28d9c-171">後端伺服器拒絕了 Azure AD 所建立的 Kerberos 票證。</span><span class="sxs-lookup"><span data-stu-id="28d9c-171">The backend server declined the Kerberos ticket created by Azure AD.</span></span> <span data-ttu-id="28d9c-172">確認 Azure AD 和後端應用程式伺服器的設定正確無誤。</span><span class="sxs-lookup"><span data-stu-id="28d9c-172">Verify that Azure AD and the backend application server are configured correctly.</span></span> <span data-ttu-id="28d9c-173">確定 Azure AD 與後端應用程式伺服器的日期和時間設定已同步。</span><span class="sxs-lookup"><span data-stu-id="28d9c-173">Make sure that the time and date configuration on the Azure AD and the backend application server are synchronized.</span></span> |
| <span data-ttu-id="28d9c-174">13016 - 因為邊緣權杖或存取 cookie 中沒有 UPN，Azure AD 無法代表使用者擷取 Kerberos 票證。</span><span class="sxs-lookup"><span data-stu-id="28d9c-174">13016 - Azure AD cannot retrieve a Kerberos ticket on behalf of the user because there is no UPN in the edge token or in the access cookie.</span></span> | <span data-ttu-id="28d9c-175">STS 組態有問題。</span><span class="sxs-lookup"><span data-stu-id="28d9c-175">There is a problem with the STS configuration.</span></span> <span data-ttu-id="28d9c-176">在 STS 中修正 UPN 宣告設定。</span><span class="sxs-lookup"><span data-stu-id="28d9c-176">Fix the UPN claim configuration in the STS.</span></span> |
| <span data-ttu-id="28d9c-177">13019 - 因為下列一般 API 錯誤，Azure AD 無法代表使用者擷取 Kerberos 票證。</span><span class="sxs-lookup"><span data-stu-id="28d9c-177">13019 - Azure AD cannot retrieve a Kerberos ticket on behalf of the user because of the following general API error.</span></span> | <span data-ttu-id="28d9c-178">此事件可能表示 Azure AD 與網域控制站伺服器之間的設定不正確，或兩台電腦上的日期和時間設定有問題。</span><span class="sxs-lookup"><span data-stu-id="28d9c-178">This event may indicate incorrect configuration between Azure AD and the domain controller server, or a problem in time and date configuration on both machines.</span></span> <span data-ttu-id="28d9c-179">網域控制站拒絕了 Azure AD 所建立的 Kerberos 票證。</span><span class="sxs-lookup"><span data-stu-id="28d9c-179">The domain controller declined the Kerberos ticket created by Azure AD.</span></span> <span data-ttu-id="28d9c-180">確認 Azure AD 和後端應用程式伺服器的設定正確無誤，尤其是 SPN 組態。</span><span class="sxs-lookup"><span data-stu-id="28d9c-180">Verify that Azure AD and the backend application server are configured correctly, especially the SPN configuration.</span></span> <span data-ttu-id="28d9c-181">確定 Azure AD 的網域已加入至與網域控制站相同的網域，確保網域控制站建立 Azure AD 的信任。</span><span class="sxs-lookup"><span data-stu-id="28d9c-181">Make sure the Azure AD is domain joined to the same domain as the domain controller to ensure that the domain controller establishes trust with Azure AD.</span></span> <span data-ttu-id="28d9c-182">確定 Azure AD 與網域控制站的日期和時間設定已同步。</span><span class="sxs-lookup"><span data-stu-id="28d9c-182">Make sure that the time and date configuration on the Azure AD and the domain controller are synchronized.</span></span> |
| <span data-ttu-id="28d9c-183">13020 - 因為未定義後端伺服器 SPN，Azure AD 無法代表使用者擷取 Kerberos 票證。</span><span class="sxs-lookup"><span data-stu-id="28d9c-183">13020 - Azure AD cannot retrieve a Kerberos ticket on behalf of the user because the backend server SPN is not defined.</span></span> | <span data-ttu-id="28d9c-184">此事件可能表示 Azure AD 與網域控制站伺服器之間的設定不正確，或兩台電腦上的日期和時間設定有問題。</span><span class="sxs-lookup"><span data-stu-id="28d9c-184">This event may indicate incorrect configuration between Azure AD and the domain controller server, or a problem in time and date configuration on both machines.</span></span> <span data-ttu-id="28d9c-185">網域控制站拒絕了 Azure AD 所建立的 Kerberos 票證。</span><span class="sxs-lookup"><span data-stu-id="28d9c-185">The domain controller declined the Kerberos ticket created by Azure AD.</span></span> <span data-ttu-id="28d9c-186">確認 Azure AD 和後端應用程式伺服器的設定正確無誤，尤其是 SPN 組態。</span><span class="sxs-lookup"><span data-stu-id="28d9c-186">Verify that Azure AD and the backend application server are configured correctly, especially the SPN configuration.</span></span> <span data-ttu-id="28d9c-187">確定 Azure AD 的網域已加入至與網域控制站相同的網域，確保網域控制站建立 Azure AD 的信任。</span><span class="sxs-lookup"><span data-stu-id="28d9c-187">Make sure the Azure AD is domain joined to the same domain as the domain controller to ensure that the domain controller establishes trust with Azure AD.</span></span> <span data-ttu-id="28d9c-188">確定 Azure AD 與網域控制站的日期和時間設定已同步。</span><span class="sxs-lookup"><span data-stu-id="28d9c-188">Make sure that the time and date configuration on the Azure AD and the domain controller are synchronized.</span></span> |
| <span data-ttu-id="28d9c-189">13022 - 因為後端伺服器以 HTTP 401 錯誤回應 Kerberos 驗證嘗試，Azure AD 便無法驗證使用者。</span><span class="sxs-lookup"><span data-stu-id="28d9c-189">13022 - Azure AD cannot authenticate the user because the backend server responds to Kerberos authentication attempts with an HTTP 401 error.</span></span> | <span data-ttu-id="28d9c-190">此事件可能表示 Azure AD 與後端應用程式伺服器之間的設定不正確，或兩台電腦上的日期和時間設定有問題。</span><span class="sxs-lookup"><span data-stu-id="28d9c-190">This event may indicate incorrect configuration between Azure AD and the backend application server, or a problem in time and date configuration on both machines.</span></span> <span data-ttu-id="28d9c-191">後端伺服器拒絕了 Azure AD 所建立的 Kerberos 票證。</span><span class="sxs-lookup"><span data-stu-id="28d9c-191">The backend server declined the Kerberos ticket created by Azure AD.</span></span> <span data-ttu-id="28d9c-192">確認 Azure AD 和後端應用程式伺服器的設定正確無誤。</span><span class="sxs-lookup"><span data-stu-id="28d9c-192">Verify that Azure AD and the backend application server are configured correctly.</span></span> <span data-ttu-id="28d9c-193">確定 Azure AD 與後端應用程式伺服器的日期和時間設定已同步。</span><span class="sxs-lookup"><span data-stu-id="28d9c-193">Make sure that the time and date configuration on the Azure AD and the backend application server are synchronized.</span></span> |

## <a name="end-user-errors"></a><span data-ttu-id="28d9c-194">使用者錯誤</span><span class="sxs-lookup"><span data-stu-id="28d9c-194">End-user errors</span></span>

<span data-ttu-id="28d9c-195">這份清單涵蓋您的終端使用者嘗試存取應用程式並失敗時可能會遇到的錯誤。</span><span class="sxs-lookup"><span data-stu-id="28d9c-195">This list covers errors that your end users might encounter when they try to access the app and fail.</span></span> 

| <span data-ttu-id="28d9c-196">錯誤</span><span class="sxs-lookup"><span data-stu-id="28d9c-196">Error</span></span> | <span data-ttu-id="28d9c-197">建議的步驟</span><span class="sxs-lookup"><span data-stu-id="28d9c-197">Recommended steps</span></span> |
| ----- | ----------------- |
| <span data-ttu-id="28d9c-198">網站無法顯示頁面。</span><span class="sxs-lookup"><span data-stu-id="28d9c-198">The website cannot display the page.</span></span> | <span data-ttu-id="28d9c-199">如果應用程式是 IWA 應用程式，則使用者在嘗試存取此應用程式時可能會發生此錯誤。</span><span class="sxs-lookup"><span data-stu-id="28d9c-199">Your user may get this error when trying to access the app you published if the application is an IWA application.</span></span> <span data-ttu-id="28d9c-200">為此應用程式定義的 SPN 可能不正確。</span><span class="sxs-lookup"><span data-stu-id="28d9c-200">The defined SPN for this application may be incorrect.</span></span> <span data-ttu-id="28d9c-201">若是 IWA 應用程式，確定為此應用程式設定的 SPN 正確無誤。</span><span class="sxs-lookup"><span data-stu-id="28d9c-201">For IWA apps, make sure that the SPN configured for this application is correct.</span></span> |
| <span data-ttu-id="28d9c-202">網站無法顯示頁面。</span><span class="sxs-lookup"><span data-stu-id="28d9c-202">The website cannot display the page.</span></span> | <span data-ttu-id="28d9c-203">如果應用程式是 OWA 應用程式，則使用者在嘗試存取此應用程式時可能會發生此錯誤。</span><span class="sxs-lookup"><span data-stu-id="28d9c-203">Your user may get this error when trying to access the app you published if the application is an OWA application.</span></span> <span data-ttu-id="28d9c-204">這可能是由下列下列其中一項所造成︰</span><span class="sxs-lookup"><span data-stu-id="28d9c-204">This could be caused by one of the following:</span></span><br><li><span data-ttu-id="28d9c-205">為此應用程式定義的 SPN 不正確。</span><span class="sxs-lookup"><span data-stu-id="28d9c-205">The defined SPN for this application is incorrect.</span></span> <span data-ttu-id="28d9c-206">確定為此應用程式設定的 SPN 正確無誤。</span><span class="sxs-lookup"><span data-stu-id="28d9c-206">Make sure that the SPN configured for this application is correct.</span></span></li><li><span data-ttu-id="28d9c-207">嘗試存取應用程式的使用者使用 Microsoft 帳戶，而不是使用適當的公司帳戶進行登入，或使用者是來賓使用者。</span><span class="sxs-lookup"><span data-stu-id="28d9c-207">The user who tried to access the application is using a Microsoft account rather than the proper corporate account to sign in, or the user is a guest user.</span></span> <span data-ttu-id="28d9c-208">確定使用者是使用符合已發佈應用程式之網域的公司帳戶進行登入。</span><span class="sxs-lookup"><span data-stu-id="28d9c-208">Make sure the user signs in using their corporate account that matches the domain of the published application.</span></span> <span data-ttu-id="28d9c-209">Microsoft 帳戶使用者和來賓無法存取 IWA 應用程式。</span><span class="sxs-lookup"><span data-stu-id="28d9c-209">Microsoft Account users and guest cannot access IWA applications.</span></span></li><li><span data-ttu-id="28d9c-210">未在內部部署端針對此應用程式正確地定義嘗試存取應用程式的使用者。</span><span class="sxs-lookup"><span data-stu-id="28d9c-210">The user who tried to access the application is not properly defined for this application on the on-prem side.</span></span> <span data-ttu-id="28d9c-211">確定此使用者具有適當的權限，如在內部部署電腦上針對此後端應用程式所定義的權限。</span><span class="sxs-lookup"><span data-stu-id="28d9c-211">Make sure that this user has the proper permissions as defined for this backend application on the on-prem machine.</span></span> |
| <span data-ttu-id="28d9c-212">無法存取此公司應用程式。</span><span class="sxs-lookup"><span data-stu-id="28d9c-212">This corporate app can’t be accessed.</span></span> <span data-ttu-id="28d9c-213">您未獲得授權存取此應用程式。</span><span class="sxs-lookup"><span data-stu-id="28d9c-213">You are not authorized to access this application.</span></span> <span data-ttu-id="28d9c-214">授權失敗。</span><span class="sxs-lookup"><span data-stu-id="28d9c-214">Authorization failed.</span></span> <span data-ttu-id="28d9c-215">務必將此應用程式的存取權指派給使用者。</span><span class="sxs-lookup"><span data-stu-id="28d9c-215">Make sure to assign the user with access to this application.</span></span> | <span data-ttu-id="28d9c-216">如果使用者使用 Microsoft 帳戶而非其公司帳戶進行登入，則使用者在嘗試存取您發佈的應用程式時可能會發生此錯誤。</span><span class="sxs-lookup"><span data-stu-id="28d9c-216">Your users may get this error when trying to access the app you published if they use Microsoft accounts instead of their corporate account to sign in.</span></span> <span data-ttu-id="28d9c-217">來賓使用者也可能會發生此錯誤。</span><span class="sxs-lookup"><span data-stu-id="28d9c-217">Guest users may also get this error.</span></span> <span data-ttu-id="28d9c-218">Microsoft 帳戶使用者和來賓無法存取 IWA 應用程式。</span><span class="sxs-lookup"><span data-stu-id="28d9c-218">Microsoft Account users and guests cannot access IWA applications.</span></span> <span data-ttu-id="28d9c-219">確定使用者是使用符合已發佈應用程式之網域的公司帳戶進行登入。</span><span class="sxs-lookup"><span data-stu-id="28d9c-219">Make sure the user signs in using their corporate account that matches the domain of the published application.</span></span><br><br><span data-ttu-id="28d9c-220">您可能尚未對此應用程式指派使用者。</span><span class="sxs-lookup"><span data-stu-id="28d9c-220">You may not have assigned the user for this application.</span></span> <span data-ttu-id="28d9c-221">移至 [應用程式] 索引標籤，在 [使用者和群組] 底下，將此使用者或使用者群組指派給此應用程式。</span><span class="sxs-lookup"><span data-stu-id="28d9c-221">Go to the **Application** tab, and under **Users and Groups**, assign this user or user group to this application.</span></span> |
| <span data-ttu-id="28d9c-222">無法立即存取此公司應用程式。</span><span class="sxs-lookup"><span data-stu-id="28d9c-222">This corporate app can’t be accessed right now.</span></span> <span data-ttu-id="28d9c-223">請稍後再試...連接器已逾時。</span><span class="sxs-lookup"><span data-stu-id="28d9c-223">Please try again later…The connector timed out.</span></span> | <span data-ttu-id="28d9c-224">如果未在內部部署端針對此應用程式正確地定義使用者，則使用者在嘗試存取此應用程式時可能會發生此錯誤。</span><span class="sxs-lookup"><span data-stu-id="28d9c-224">Your users may get this error when trying to access the app you published if they are not properly defined for this application on the on-prem side.</span></span> <span data-ttu-id="28d9c-225">確定使用者具有適當的權限，如在內部部署電腦上針對此後端應用程式所定義的權限。</span><span class="sxs-lookup"><span data-stu-id="28d9c-225">Make sure that your users have the proper permissions as defined for this backend application on the on-prem machine.</span></span> |
| <span data-ttu-id="28d9c-226">無法存取此公司應用程式。</span><span class="sxs-lookup"><span data-stu-id="28d9c-226">This corporate app can’t be accessed.</span></span> <span data-ttu-id="28d9c-227">您未獲得授權存取此應用程式。</span><span class="sxs-lookup"><span data-stu-id="28d9c-227">You are not authorized to access this application.</span></span> <span data-ttu-id="28d9c-228">授權失敗。</span><span class="sxs-lookup"><span data-stu-id="28d9c-228">Authorization failed.</span></span> <span data-ttu-id="28d9c-229">確定使用者有 Azure Active Directory Premium 或 Basic 的授權。</span><span class="sxs-lookup"><span data-stu-id="28d9c-229">Make sure that the user has a license for Azure Active Directory Premium or Basic.</span></span> | <span data-ttu-id="28d9c-230">如果訂閱者的系統管理員未明確將Premium/Basic 授權指派給使用者，則使用者在嘗試存取您發佈的應用程式時可能會發生此錯誤。</span><span class="sxs-lookup"><span data-stu-id="28d9c-230">Your users may get this error when trying to access the app you published if they weren't explicitly assigned with a Premium/Basic license by the subscriber’s administrator.</span></span> <span data-ttu-id="28d9c-231">移至訂用帳戶的 Active Directory [授權]  索引標籤，並確定此使用者或使用者群組已被指派 Premium 或 Basic 授權。</span><span class="sxs-lookup"><span data-stu-id="28d9c-231">Go to the subscriber’s Active Directory **Licenses** tab and make sure that this user or user group is assigned a Premium or Basic license.</span></span> |

## <a name="my-error-wasnt-listed-here"></a><span data-ttu-id="28d9c-232">此處未列出我的錯誤</span><span class="sxs-lookup"><span data-stu-id="28d9c-232">My error wasn't listed here</span></span>

<span data-ttu-id="28d9c-233">如果您遇到的 Azure AD 應用程式 Proxy 錯誤或問題沒有列在這份疑難排解指南中，我們想要知道更多。</span><span class="sxs-lookup"><span data-stu-id="28d9c-233">If you encounter an error or problem with Azure AD Application Proxy that isn't listed in this troubleshooting guide, we'd like to hear about it.</span></span> <span data-ttu-id="28d9c-234">請用電子郵件將該錯誤的詳細資料傳送給我們的[意見反應小組](mailto:aadapfeedback@microsoft.com)。</span><span class="sxs-lookup"><span data-stu-id="28d9c-234">Send an email to our [feedback team](mailto:aadapfeedback@microsoft.com) with the details of the error you encountered.</span></span>

## <a name="see-also"></a><span data-ttu-id="28d9c-235">另請參閱</span><span class="sxs-lookup"><span data-stu-id="28d9c-235">See also</span></span>
* [<span data-ttu-id="28d9c-236">啟用 Azure Active Directory 的應用程式 Proxy</span><span class="sxs-lookup"><span data-stu-id="28d9c-236">Enable Application Proxy for Azure Active Directory</span></span>](active-directory-application-proxy-enable.md)
* [<span data-ttu-id="28d9c-237">使用應用程式 Proxy 發行應用程式</span><span class="sxs-lookup"><span data-stu-id="28d9c-237">Publish applications with Application Proxy</span></span>](active-directory-application-proxy-publish.md)
* [<span data-ttu-id="28d9c-238">啟用單一登入</span><span class="sxs-lookup"><span data-stu-id="28d9c-238">Enable single sign-on</span></span>](active-directory-application-proxy-sso-using-kcd.md)
* [<span data-ttu-id="28d9c-239">啟用條件式存取</span><span class="sxs-lookup"><span data-stu-id="28d9c-239">Enable conditional access</span></span>](active-directory-application-proxy-conditional-access.md)


<!--Image references-->
[1]: ./media/active-directory-application-proxy-troubleshoot/connectorproperties.png
[2]: ./media/active-directory-application-proxy-troubleshoot/sessionlog.png
