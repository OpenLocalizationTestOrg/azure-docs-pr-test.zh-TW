---
title: "Azure AD SSPR 與密碼回寫 | Microsoft Docs"
description: "使用 Azure AD 和 Azure AD Connect 將密碼回寫到內部部署目錄"
services: active-directory
keywords: "Active directory 密碼管理, 密碼管理, Azure AD 自助式密碼重設"
documentationcenter: 
author: MicrosoftGuyJFlo
manager: femila
ms.reviewer: gahug
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: joflore
ms.custom: it-pro
ms.openlocfilehash: 6b195fdcce17184628acd98a686520528a6dadd5
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/03/2017
---
# <a name="password-writeback-overview"></a><span data-ttu-id="b2827-104">密碼回寫概觀</span><span class="sxs-lookup"><span data-stu-id="b2827-104">Password writeback overview</span></span>

<span data-ttu-id="b2827-105">密碼回寫可讓您將 Azure AD 設定為將密碼回寫到您的內部部署 Active Directory。</span><span class="sxs-lookup"><span data-stu-id="b2827-105">Password writeback allows you to configure Azure AD to write passwords back to you on-premises Active Directory.</span></span> <span data-ttu-id="b2827-106">不需設定和管理複雜的內部部署自助式密碼重設解決方案，並且提供便利的雲端方式，供您的使用者重設其內部部署密碼 (無論他們身處何處)。</span><span class="sxs-lookup"><span data-stu-id="b2827-106">It removes the need to set up and manage a complicated on-premises self-service password reset solution, and it provides a convenient cloud-based way for your users to reset their on-premises passwords wherever they are.</span></span> <span data-ttu-id="b2827-107">密碼回寫是 [Azure Active Directory Connect](./connect/active-directory-aadconnect.md) 的元件，可供目前的 [Azure Active Directory 版本](active-directory-editions.md)訂閱者啟用及使用。</span><span class="sxs-lookup"><span data-stu-id="b2827-107">Password writeback is a component of [Azure Active Directory Connect](./connect/active-directory-aadconnect.md) that can be enabled and used by current subscribers of Premium [Azure Active Directory Editions](active-directory-editions.md).</span></span>

<span data-ttu-id="b2827-108">密碼回寫提供下列功能：</span><span class="sxs-lookup"><span data-stu-id="b2827-108">Password writeback provides the following features</span></span>

* <span data-ttu-id="b2827-109">**零延遲的意見反應** - 密碼回寫是一項同步作業。</span><span class="sxs-lookup"><span data-stu-id="b2827-109">**Zero delay feedback** - Password writeback is a synchronous operation.</span></span> <span data-ttu-id="b2827-110">如果使用者的密碼不符合原則，或因為任何原因而無法重設或變更，他們會立即收到通知。</span><span class="sxs-lookup"><span data-stu-id="b2827-110">Your users are notified immediately if their password did not meet policy or was not able to be reset or changed for any reason.</span></span>
* <span data-ttu-id="b2827-111">**支援使用者使用 AD FS 或其他同盟技術來重設密碼** - 在使用密碼回寫後，只要同盟的使用者帳戶同步處理到您的 Azure AD 租用戶，他們就能夠從雲端管理自己的內部部署 AD 密碼。</span><span class="sxs-lookup"><span data-stu-id="b2827-111">**Supports resetting passwords for users using AD FS or other federation technologies** - With password writeback, as long as the federated user accounts are synchronized into your Azure AD tenant, they are able to manage their on-premises AD passwords from the cloud.</span></span>
* <span data-ttu-id="b2827-112">**支援使用者使用[密碼雜湊同步](./connect/active-directory-aadconnectsync-implement-password-synchronization.md)來重設密碼** - 當密碼重設服務偵測到同步處理的使用者帳戶已啟用密碼雜湊同步時，我們會同時重設此帳戶的內部部署密碼和雲端密碼。</span><span class="sxs-lookup"><span data-stu-id="b2827-112">**Supports resetting passwords for users using [password hash sync](./connect/active-directory-aadconnectsync-implement-password-synchronization.md)** - When the password reset service detects that a synchronized user account is enabled for password hash sync, we reset both this account’s on-premises and cloud password simultaneously.</span></span>
* <span data-ttu-id="b2827-113">**支援從存取面板和 Office 365 變更密碼** - 當同盟或密碼同步使用者過來變更已過期或尚未過期的密碼時，我們會將這些密碼回寫到您的本機 AD 環境。</span><span class="sxs-lookup"><span data-stu-id="b2827-113">**Supports changing passwords from the access panel and Office 365** - When federated or password synchronized users come to change their expired or non-expired passwords, we write those passwords back to your local AD environment.</span></span>
* <span data-ttu-id="b2827-114">**支援當系統管理員從 Azure 入口網站重設密碼時將密碼回寫** - 每當系統管理員在 [Azure 入口網站](https://portal.azure.com)重設使用者的密碼，如果該使用者為同盟或密碼同步使用者，我們也會在您的本機 AD 上設定系統管理員所選取的密碼。</span><span class="sxs-lookup"><span data-stu-id="b2827-114">**Supports writing back passwords when an admin reset them from the Azure portal** - Whenever an admin resets a user’s password in the [Azure portal](https://portal.azure.com), if that user is federated or password synchronized, we’ll set the password the admin selects on your local AD, as well.</span></span> <span data-ttu-id="b2827-115">Office 系統管理入口網站目前不支援這項作業。</span><span class="sxs-lookup"><span data-stu-id="b2827-115">This is currently not supported in the Office Admin Portal.</span></span>
* <span data-ttu-id="b2827-116">**強制您的內部部署 AD 密碼原則** - 當使用者重設其密碼時，我們會確保它符合您的內部部署 AD 原則，然後再認可到該目錄。</span><span class="sxs-lookup"><span data-stu-id="b2827-116">**Enforces your on-premises AD password policies** - When a user resets their password, we make sure that it meets your on-premises AD policy before committing it to that directory.</span></span> <span data-ttu-id="b2827-117">這當中包括歷程記錄、複雜度、使用期限、密碼篩選和您在本機 AD 中定義的任何其他密碼限制。</span><span class="sxs-lookup"><span data-stu-id="b2827-117">This includes history, complexity, age, password filters, and any other password restrictions you have defined in your local AD.</span></span>
* <span data-ttu-id="b2827-118">**不需要任何輸入防火牆規則** - 密碼回寫會以 Azure 服務匯流排轉送作為基礎通訊管道，這表示您不必在防火牆上開啟任何輸入連接埠，這項功能就能正常運作。</span><span class="sxs-lookup"><span data-stu-id="b2827-118">**Doesn’t require any inbound firewall rules** - Password writeback uses an Azure Service Bus relay as an underlying communication channel, meaning that you do not have to open any inbound ports on your firewall for this feature to work.</span></span>
* <span data-ttu-id="b2827-119">**不支援存在於內部部署 Active Directory 中受保護群組內的使用者帳戶** - 如需受保護群組的詳細資訊，請參閱 [Active Directory 中受保護的帳戶和群組](https://technet.microsoft.com/library/dn535499.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b2827-119">**Is not supported for user accounts that exist within protected groups in your on-premises Active Directory** - For more information about protected groups, see [Protected Accounts and Groups in Active Directory](https://technet.microsoft.com/library/dn535499.aspx).</span></span>

## <a name="how-password-writeback-works"></a><span data-ttu-id="b2827-120">密碼回寫的運作方式</span><span class="sxs-lookup"><span data-stu-id="b2827-120">How password writeback works</span></span>

<span data-ttu-id="b2827-121">當同盟或密碼雜湊同步使用者過來重設或變更其雲端密碼時，會發生下列情況：</span><span class="sxs-lookup"><span data-stu-id="b2827-121">When a federated or password hash synchronized user comes to reset or change their password in the cloud, the following occurs:</span></span>

1. <span data-ttu-id="b2827-122">我們會檢查看看使用者擁有哪一種密碼。</span><span class="sxs-lookup"><span data-stu-id="b2827-122">We check to see what type of password the user has.</span></span>
    * <span data-ttu-id="b2827-123">如果我們看到密碼是在內部部署環境管理</span><span class="sxs-lookup"><span data-stu-id="b2827-123">If we see the password is managed on premises</span></span>
        * <span data-ttu-id="b2827-124">我們會檢查回寫服務是否已啟動並執行，如果情況正是如此，我們會讓使用者繼續進行</span><span class="sxs-lookup"><span data-stu-id="b2827-124">We check if the writeback service is up and running, if it is, we let the user proceed</span></span>
        * <span data-ttu-id="b2827-125">如果回寫服務並未啟動，我們會告訴使用者不能立即重設其密碼</span><span class="sxs-lookup"><span data-stu-id="b2827-125">If the writeback service is not up, we tell the user that their password cannot be reset now</span></span>
2. <span data-ttu-id="b2827-126">接下來，使用者通過適當的驗證關卡，並到達重設密碼畫面。</span><span class="sxs-lookup"><span data-stu-id="b2827-126">Next, the user passes the appropriate authentication gates and reaches the reset password screen.</span></span>
3. <span data-ttu-id="b2827-127">使用者選取新的密碼，並加以確認。</span><span class="sxs-lookup"><span data-stu-id="b2827-127">The user selects a new password and confirms it.</span></span>
4. <span data-ttu-id="b2827-128">按一下送出，我們便會以回寫設定程序期間所建立的對稱金鑰加密純文字密碼。</span><span class="sxs-lookup"><span data-stu-id="b2827-128">Upon clicking submit, we encrypt the plaintext password with a symmetric key that was created during the writeback setup process.</span></span>
5. <span data-ttu-id="b2827-129">在加密密碼後，我們會將它放入裝載中，透過 HTTPS 通道傳送到您租用戶特定的服務匯流排轉送 (我們也會在回寫設定過程中為您設定此轉送)。</span><span class="sxs-lookup"><span data-stu-id="b2827-129">After encrypting the password, we include it in a payload that gets sent over an HTTPS channel to your tenant-specific service bus relay (that we also set up for you during the writeback setup process).</span></span> <span data-ttu-id="b2827-130">此轉送受到只有您的內部部署安裝才會知道的隨機產生密碼所保護。</span><span class="sxs-lookup"><span data-stu-id="b2827-130">This relay is protected by a randomly generated password that only your on-premises installation knows.</span></span>
6. <span data-ttu-id="b2827-131">一旦訊息抵達服務匯流排，密碼重設端點就會自動甦醒，並看到它有擱置中的重設要求。</span><span class="sxs-lookup"><span data-stu-id="b2827-131">Once the message reaches service bus, the password reset endpoint automatically wakes up and sees that it has a reset request pending.</span></span>
7. <span data-ttu-id="b2827-132">服務接著會使用雲端錨點屬性來尋找提出要求的使用者。</span><span class="sxs-lookup"><span data-stu-id="b2827-132">The service then looks for the user in question by using the cloud anchor attribute.</span></span> <span data-ttu-id="b2827-133">若要讓此查閱成功︰</span><span class="sxs-lookup"><span data-stu-id="b2827-133">For this lookup to succeed:</span></span>

    * <span data-ttu-id="b2827-134">使用者物件必須存在於 AD 連接器空間內</span><span class="sxs-lookup"><span data-stu-id="b2827-134">The user object must exist in the AD connector space</span></span>
    * <span data-ttu-id="b2827-135">使用者物件必須連結至對應的 MV 物件</span><span class="sxs-lookup"><span data-stu-id="b2827-135">The user object must be linked to the corresponding MV object</span></span>
    * <span data-ttu-id="b2827-136">使用者物件必須連結至對應的 AAD 連接器物件。</span><span class="sxs-lookup"><span data-stu-id="b2827-136">The user object must be linked to the corresponding AAD connector object.</span></span>
    * <span data-ttu-id="b2827-137">AD 連接器物件與 MV 的連結上必須有同步處理規則 `Microsoft.InfromADUserAccountEnabled.xxx`。</span><span class="sxs-lookup"><span data-stu-id="b2827-137">The link from AD connector object to MV must have the synchronization rule `Microsoft.InfromADUserAccountEnabled.xxx` on the link.</span></span> <br> <br>
    <span data-ttu-id="b2827-138">當呼叫是來自雲端時，同步處理引擎會使用 cloudAnchor 屬性來查閱 AAD 連接器空間物件，然後順著連結回到 MV 物件，接著再順著連結回到 AD 物件。</span><span class="sxs-lookup"><span data-stu-id="b2827-138">When the call comes in from the cloud, the synchronization engine uses the cloudAnchor attribute to look up the AAD connector space object, follows the link back to the MV object, and then follows the link back to the AD object.</span></span> <span data-ttu-id="b2827-139">因為相同使用者可能有多個 AD 物件 (多樹系)，同步處理引擎需仰賴 `Microsoft.InfromADUserAccountEnabled.xxx` 連結來選出正確的物件。</span><span class="sxs-lookup"><span data-stu-id="b2827-139">Because there could be multiple AD objects (multi-forest) for the same user, the sync engine relies on the `Microsoft.InfromADUserAccountEnabled.xxx` link to pick the correct one.</span></span>

    > [!Note]
    > <span data-ttu-id="b2827-140">因為此邏輯，Azure AD Connect 必須能夠與 PDC 模擬器通訊，密碼回寫才能運作。</span><span class="sxs-lookup"><span data-stu-id="b2827-140">As a result of this logic, Azure AD Connect must be able to communicate with the PDC Emulator for password writeback to work.</span></span> <span data-ttu-id="b2827-141">如果您需要手動啟用此功能，您可以在 Active Directory 同步處理連接器的**屬性**上按一下滑鼠右鍵，然後選取**設定目錄分割**，將 Azure AD Connect 連線至 PDC 模擬器。</span><span class="sxs-lookup"><span data-stu-id="b2827-141">If you need to enable this manually, you can connect Azure AD Connect to the PDC Emulator by right-clicking on the **properties** of the Active Directory synchronization connector, then selecting **configure directory partitions**.</span></span> <span data-ttu-id="b2827-142">從那裡尋找**網域控制站連線設定**區段，然後核取標題為**只使用慣用的網域控制站**的方塊。</span><span class="sxs-lookup"><span data-stu-id="b2827-142">From there, look for the **domain controller connection settings** section and check the box titled **only use preferred domain controllers**.</span></span> <span data-ttu-id="b2827-143">即使慣用的 DC 不是 PDC 模擬器，Azure AD Connect 仍會嘗試連線至 PDC 進行密碼回寫。</span><span class="sxs-lookup"><span data-stu-id="b2827-143">Even if the preferred DC is not a PDC emulator, Azure AD Connect will attempt to connect to the PDC for password writeback.</span></span>

8. <span data-ttu-id="b2827-144">一旦找到使用者帳戶，我們會嘗試直接在適當的 AD 樹系中重設密碼。</span><span class="sxs-lookup"><span data-stu-id="b2827-144">Once the user account is found, we attempt to reset the password directly in the appropriate AD forest.</span></span>
9. <span data-ttu-id="b2827-145">如果密碼設定作業成功，我們會告訴使用者其密碼已變更。</span><span class="sxs-lookup"><span data-stu-id="b2827-145">If the password set operation is successful, we tell the user their password has been changed.</span></span>
    > [!NOTE]
    > <span data-ttu-id="b2827-146">在使用「密碼同步處理」將使用者密碼同步至 Azure AD 的情況下，有可能內部部署密碼原則會比雲端密碼原則弱。</span><span class="sxs-lookup"><span data-stu-id="b2827-146">In the case when the user's password is synchronized to Azure AD using password synchronization, there is a chance that the on-premises password policy is weaker than the cloud password policy.</span></span> <span data-ttu-id="b2827-147">在此情況下，我們仍然會強制執行內部部署原則 (不論是怎樣的原則)，並且改為允許密碼雜湊同步作業同步處理該密碼的雜湊。</span><span class="sxs-lookup"><span data-stu-id="b2827-147">In this case, we still enforce whatever the on-premises policy is, and instead allow password hash synchronization to synchronize the hash of that password.</span></span> <span data-ttu-id="b2827-148">這可確保不論您是使用密碼同步處理還是同盟來提供單一登入，都會在雲端強制執行您的內部部署原則。</span><span class="sxs-lookup"><span data-stu-id="b2827-148">This ensures that your on-premises policy is enforced in the cloud, no matter if you use password synchronization or federation to provide single sign-on.</span></span>

10. <span data-ttu-id="b2827-149">如果密碼設定作業失敗，我們會對使用者傳回錯誤，請他們再試一次。</span><span class="sxs-lookup"><span data-stu-id="b2827-149">If the password set operation fails, we return the error to the user and let them try again.</span></span>
    * <span data-ttu-id="b2827-150">作業可能會失敗，原因如下：</span><span class="sxs-lookup"><span data-stu-id="b2827-150">The operation might fail because of the following</span></span>
        * <span data-ttu-id="b2827-151">服務已關閉</span><span class="sxs-lookup"><span data-stu-id="b2827-151">The service was down</span></span>
        * <span data-ttu-id="b2827-152">他們所選的密碼不符合組織原則</span><span class="sxs-lookup"><span data-stu-id="b2827-152">The password they selected did not meet organization policies</span></span>
        * <span data-ttu-id="b2827-153">我們在本機 AD 中找不到使用者</span><span class="sxs-lookup"><span data-stu-id="b2827-153">We could not find the user in the local AD</span></span>

    <span data-ttu-id="b2827-154">其中的許多原因會有特定的訊息，讓使用者知道該怎麼做來解決問題。</span><span class="sxs-lookup"><span data-stu-id="b2827-154">We have a specific message for many of these cases and tell the user what they can do to resolve the issue.</span></span>

## <a name="configuring-password-writeback"></a><span data-ttu-id="b2827-155">設定密碼回寫</span><span class="sxs-lookup"><span data-stu-id="b2827-155">Configuring password writeback</span></span>

<span data-ttu-id="b2827-156">如果您想使用密碼回寫，我們建議您使用 [Azure AD Connect](./connect/active-directory-aadconnect-get-started-express.md) 的自動更新功能。</span><span class="sxs-lookup"><span data-stu-id="b2827-156">We recommend that you use the auto-update feature of [Azure AD Connect](./connect/active-directory-aadconnect-get-started-express.md) if you want to use password writeback.</span></span>

<span data-ttu-id="b2827-157">啟用密碼回寫功能已不再支援 DirSync 和 Azure AD 同步這兩種方法。[從 DirSync 和 Azure AD Sync 升級](connect/active-directory-aadconnect-dirsync-deprecated.md)一文有詳細資訊可協助您進行轉換。</span><span class="sxs-lookup"><span data-stu-id="b2827-157">DirSync and Azure AD Sync are no longer supported means of enabling password writeback the article [Upgrade from DirSync and Azure AD Sync](connect/active-directory-aadconnect-dirsync-deprecated.md) has more information to help with your transition.</span></span>

<span data-ttu-id="b2827-158">下列步驟假設您已使用[快速](./connect/active-directory-aadconnect-get-started-express.md)或[自訂](./connect/active-directory-aadconnect-get-started-custom.md)設定在您的環境中設定 Azure AD Connect。</span><span class="sxs-lookup"><span data-stu-id="b2827-158">The steps below assume you have already configured Azure AD Connect in your environment using the [Express](./connect/active-directory-aadconnect-get-started-express.md) or [Custom](./connect/active-directory-aadconnect-get-started-custom.md) settings.</span></span>

1. <span data-ttu-id="b2827-159">若要設定和啟用密碼回寫，請登入 Azure AD Connect 伺服器並啟動 **Azure AD Connect** 設定精靈。</span><span class="sxs-lookup"><span data-stu-id="b2827-159">To configure and enable password writeback log in to your Azure AD Connect server and start the **Azure AD Connect** configuration wizard.</span></span>
2. <span data-ttu-id="b2827-160">在 [歡迎使用] 畫面中，按一下 [設定]。</span><span class="sxs-lookup"><span data-stu-id="b2827-160">On the Welcome screen click **Configure**.</span></span>
3. <span data-ttu-id="b2827-161">在 [其他工作] 畫面中，按一下 [自訂同步處理選項]，然後選擇 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="b2827-161">On the Additional tasks screen click **Customize synchronization options** and then choose **Next**.</span></span>
4. <span data-ttu-id="b2827-162">在 [連線到 Azure AD] 畫面中，輸入全域管理員認證，然後選擇 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="b2827-162">On the Connect to Azure AD screen enter a Global Administrator credential and choose **Next**.</span></span>
5. <span data-ttu-id="b2827-163">在 [連線您的目錄] 和 [網域與 OU 篩選] 畫面中，您可以選擇 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="b2827-163">On the Connect your directories and Domain and OU filtering screens you can choose **Next**.</span></span>
6. <span data-ttu-id="b2827-164">在 [選用功能] 畫面中，勾選 [密碼回寫] 旁邊的方塊，然後按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="b2827-164">On the Optional features screen check the box next to **Password writeback** and click **Next**.</span></span>
   <span data-ttu-id="b2827-165">![在 Azure AD Connect 中啟用密碼回寫][Writeback]</span><span class="sxs-lookup"><span data-stu-id="b2827-165">![Enable password writeback in Azure AD Connect][Writeback]</span></span>
7. <span data-ttu-id="b2827-166">在 [準備好設定] 畫面中，按一下 [設定]，然後等待設定程序完成。</span><span class="sxs-lookup"><span data-stu-id="b2827-166">On the Ready to configure screen click **Configure** and wait for the process to complete.</span></span>
8. <span data-ttu-id="b2827-167">當您看到「設定完成」時，您可以按一下 **[結束]**</span><span class="sxs-lookup"><span data-stu-id="b2827-167">When you see Configuration complete you can click **Exit**</span></span>

## <a name="licensing-requirements-for-password-writeback"></a><span data-ttu-id="b2827-168">密碼回寫的授權需求</span><span class="sxs-lookup"><span data-stu-id="b2827-168">Licensing requirements for password writeback</span></span>

<span data-ttu-id="b2827-169">如需授權相關資訊，請參閱[密碼回寫所需的授權](active-directory-passwords-licensing.md#licenses-required-for-password-writeback)主題或下列網站</span><span class="sxs-lookup"><span data-stu-id="b2827-169">For information regarding licensing, see the topic [Licenses required for password writeback](active-directory-passwords-licensing.md#licenses-required-for-password-writeback) or the following sites</span></span>

* [<span data-ttu-id="b2827-170">Azure Active Directory 價格網站</span><span class="sxs-lookup"><span data-stu-id="b2827-170">Azure Active Directory Pricing site</span></span>](https://azure.microsoft.com/pricing/details/active-directory/)
* [<span data-ttu-id="b2827-171">Enterprise Mobility + Security</span><span class="sxs-lookup"><span data-stu-id="b2827-171">Enterprise Mobility + Security</span></span>](https://www.microsoft.com/cloud-platform/enterprise-mobility-security)
* [<span data-ttu-id="b2827-172">Secure Productive Enterprise</span><span class="sxs-lookup"><span data-stu-id="b2827-172">Secure Productive Enterprise</span></span>](https://www.microsoft.com/secure-productive-enterprise/default.aspx)

### <a name="on-premises-authentication-modes-supported-for-password-writeback"></a><span data-ttu-id="b2827-173">密碼回寫支援的內部部署驗證模式</span><span class="sxs-lookup"><span data-stu-id="b2827-173">On-premises authentication modes supported for password writeback</span></span>

<span data-ttu-id="b2827-174">密碼回寫適用於下列使用者的密碼類型︰</span><span class="sxs-lookup"><span data-stu-id="b2827-174">Password writeback works for the following user password types:</span></span>

* <span data-ttu-id="b2827-175">**僅限雲端的使用者**︰密碼回寫不適用於這種情況，因為沒有內部部署密碼</span><span class="sxs-lookup"><span data-stu-id="b2827-175">**Cloud-only users**: Password writeback does not apply in this situation, because there is no on-premises password</span></span>
* <span data-ttu-id="b2827-176">**已同步處理密碼的使用者**︰支援密碼回寫</span><span class="sxs-lookup"><span data-stu-id="b2827-176">**Password-synchronized users**: Password writeback supported</span></span>
* <span data-ttu-id="b2827-177">**同盟使用者**︰支援密碼回寫</span><span class="sxs-lookup"><span data-stu-id="b2827-177">**Federated users**: Password writeback supported</span></span>
* <span data-ttu-id="b2827-178">**傳遞驗證使用者**︰支援密碼回寫</span><span class="sxs-lookup"><span data-stu-id="b2827-178">**Pass-through authentication users**: Password writeback supported</span></span>

### <a name="user-and-admin-operations-supported-for-password-writeback"></a><span data-ttu-id="b2827-179">密碼回寫支援的使用者和系統管理員作業</span><span class="sxs-lookup"><span data-stu-id="b2827-179">User and Admin operations supported for password writeback</span></span>

<span data-ttu-id="b2827-180">下列所有情況都會回寫密碼︰</span><span class="sxs-lookup"><span data-stu-id="b2827-180">Passwords are written back in all the following situations:</span></span>

* <span data-ttu-id="b2827-181">**支援的使用者作業**</span><span class="sxs-lookup"><span data-stu-id="b2827-181">**Supported End-user operations**</span></span>
  * <span data-ttu-id="b2827-182">任何使用者自助式自願變更密碼作業</span><span class="sxs-lookup"><span data-stu-id="b2827-182">Any end-user self-service voluntary change password operation</span></span>
  * <span data-ttu-id="b2827-183">任何使用者自助式強制變更密碼作業 (例如密碼到期)</span><span class="sxs-lookup"><span data-stu-id="b2827-183">Any end-user self-service force change password operation (for example, password expiration)</span></span>
  * <span data-ttu-id="b2827-184">任何源自[密碼重設入口網站](https://passwordreset.microsoftonline.com)的使用者自助式密碼重設</span><span class="sxs-lookup"><span data-stu-id="b2827-184">Any end-user self-service password reset originating from the [Password Reset Portal](https://passwordreset.microsoftonline.com)</span></span>
* <span data-ttu-id="b2827-185">**支援的系統管理員作業**</span><span class="sxs-lookup"><span data-stu-id="b2827-185">**Supported Administrator operations**</span></span>
  * <span data-ttu-id="b2827-186">任何系統管理員自助式自願變更密碼作業</span><span class="sxs-lookup"><span data-stu-id="b2827-186">Any administrator self-service voluntary change password operation</span></span>
  * <span data-ttu-id="b2827-187">任何系統管理員自助式強制變更密碼作業 (例如密碼到期)</span><span class="sxs-lookup"><span data-stu-id="b2827-187">Any administrator self-service force change password operation (for example, password expiration)</span></span>
  * <span data-ttu-id="b2827-188">任何源自[密碼重設入口網站](https://passwordreset.microsoftonline.com)的系統管理員自助式密碼重設</span><span class="sxs-lookup"><span data-stu-id="b2827-188">Any administrator self-service password reset originating from the [Password Reset Portal](https://passwordreset.microsoftonline.com)</span></span>
  * <span data-ttu-id="b2827-189">系統管理員從 [Azure 傳統入口網站](https://manage.windowsazure.com)起始的任何使用者密碼重設</span><span class="sxs-lookup"><span data-stu-id="b2827-189">Any administrator-initiated end-user password reset from the [Azure classic portal](https://manage.windowsazure.com)</span></span>
  * <span data-ttu-id="b2827-190">系統管理員從 [Azure 入口網站](https://portal.azure.com)起始的任何使用者密碼重設</span><span class="sxs-lookup"><span data-stu-id="b2827-190">Any administrator-initiated end-user password reset from the [Azure portal](https://portal.azure.com)</span></span>

### <a name="user-and-admin-operations-not-supported-for-password-writeback"></a><span data-ttu-id="b2827-191">密碼回寫不支援的使用者和系統管理員作業</span><span class="sxs-lookup"><span data-stu-id="b2827-191">User and Admin operations not supported for password writeback</span></span>

<span data-ttu-id="b2827-192">下列任何情況均**不會**回寫密碼︰</span><span class="sxs-lookup"><span data-stu-id="b2827-192">Passwords are **not** written back in any of the following situations:</span></span>

* <span data-ttu-id="b2827-193">**不支援的使用者作業**</span><span class="sxs-lookup"><span data-stu-id="b2827-193">**Unsupported End-user operations**</span></span>
  * <span data-ttu-id="b2827-194">任何使用 PowerShell v1、v2 或 Azure AD Graph API 重設自有密碼的使用者</span><span class="sxs-lookup"><span data-stu-id="b2827-194">Any end user resetting their own password using PowerShell v1, v2, or the Azure AD Graph API</span></span>
* <span data-ttu-id="b2827-195">**不支援的系統管理員作業**</span><span class="sxs-lookup"><span data-stu-id="b2827-195">**Unsupported Administrator operations**</span></span>
  * <span data-ttu-id="b2827-196">系統管理員從 [Office 管理入口網站](https://portal.office.com)起始的任何使用者密碼重設</span><span class="sxs-lookup"><span data-stu-id="b2827-196">Any administrator-initiated end-user password reset from the [Office management portal](https://portal.office.com)</span></span>
  * <span data-ttu-id="b2827-197">系統管理員從 PowerShell v1、v2 或 Azure AD Graph API 起始的任何使用者密碼重設</span><span class="sxs-lookup"><span data-stu-id="b2827-197">Any administrator-initiated end-user password reset from PowerShell v1, v2, or the Azure AD Graph API</span></span>

<span data-ttu-id="b2827-198">雖然我們正努力移除這些限制，但我們並未提出任何具體的時間表。</span><span class="sxs-lookup"><span data-stu-id="b2827-198">While we are working to remove these limitations, we do not have a specific timeline we can share yet.</span></span>

## <a name="password-writeback-security-model"></a><span data-ttu-id="b2827-199">密碼回寫的安全性模型</span><span class="sxs-lookup"><span data-stu-id="b2827-199">Password writeback security model</span></span>

<span data-ttu-id="b2827-200">密碼回寫是一項極為安全的服務。</span><span class="sxs-lookup"><span data-stu-id="b2827-200">Password writeback is a highly secure service.</span></span>  <span data-ttu-id="b2827-201">為了確保您的資訊受到保護，我們啟用了 4 層式的安全性模型，詳細情形如下所述。</span><span class="sxs-lookup"><span data-stu-id="b2827-201">To ensure your information is protected, we enable a 4-tiered security model that is described below.</span></span>

* <span data-ttu-id="b2827-202">**租用戶特定的服務匯流排轉送**</span><span class="sxs-lookup"><span data-stu-id="b2827-202">**Tenant-specific service-bus relay**</span></span>
  * <span data-ttu-id="b2827-203">當您在設定服務時，我們會設定租用戶特定的服務匯流排轉送，並以隨機產生的強式密碼加以保護，Microsoft 永遠無法得知此密碼。</span><span class="sxs-lookup"><span data-stu-id="b2827-203">When you set up the service, we set up a tenant-specific service bus relay that is protected by a randomly generated strong password that Microsoft never has access to.</span></span>
* <span data-ttu-id="b2827-204">**受到鎖定的密碼編譯強式密碼加密金鑰**</span><span class="sxs-lookup"><span data-stu-id="b2827-204">**Locked down, cryptographically strong, password encryption key**</span></span>
  * <span data-ttu-id="b2827-205">在建立服務匯流排轉送後，我們會建立強式對稱金鑰，以在密碼透過線路傳送過來時予以加密。</span><span class="sxs-lookup"><span data-stu-id="b2827-205">After the service bus relay is created, we create a strong symmetric key we use to encrypt the password as it comes over the wire.</span></span> <span data-ttu-id="b2827-206">此金鑰只會存在於您在雲端的公司密碼存放區中，並受到嚴密鎖定和稽核，情形就和目錄中的任何密碼一樣。</span><span class="sxs-lookup"><span data-stu-id="b2827-206">This key lives only in your company's secret store in the cloud, which is heavily locked down and audited, just like any password in the directory.</span></span>
* <span data-ttu-id="b2827-207">**業界標準 TLS**</span><span class="sxs-lookup"><span data-stu-id="b2827-207">**Industry standard TLS**</span></span>
  1. <span data-ttu-id="b2827-208">當雲端上發生密碼重設或變更作業時，我們會擷取純文字密碼，並以公開金鑰予以加密。</span><span class="sxs-lookup"><span data-stu-id="b2827-208">When a password reset or change operation occurs in the cloud, we take the plaintext password and encrypt it with your public key.</span></span>
  2. <span data-ttu-id="b2827-209">然後將它放入 HTTPS 訊息中，使用 Microsoft 的 SSL 憑證透過加密通道傳送到您的服務匯流排轉送中。</span><span class="sxs-lookup"><span data-stu-id="b2827-209">We then place that into an HTTPS message, which is sent over an encrypted channel using Microsoft’s SSL certs to your service bus relay.</span></span>
  3. <span data-ttu-id="b2827-210">訊息抵達服務匯流排之後，您的內部部署代理程式會使用先前產生的強式密碼來喚醒及驗證服務匯流排。</span><span class="sxs-lookup"><span data-stu-id="b2827-210">After the message arrives into Service Bus, your on-premises agent wakes up and authenticates to Service Bus using the strong password that was previously generated.</span></span>
  4. <span data-ttu-id="b2827-211">內部部署代理程式會挑選加密訊息，並使用我們所產生的私密金鑰進行解密。</span><span class="sxs-lookup"><span data-stu-id="b2827-211">On-premises agent picks up the encrypted message, decrypts it using the private key we generated.</span></span>
  5. <span data-ttu-id="b2827-212">內部部署代理程式會接著嘗試透過 AD DS SetPassword API 設定密碼。</span><span class="sxs-lookup"><span data-stu-id="b2827-212">On-premises agent then attempts to set the password through the AD DS SetPassword API.</span></span>
     * <span data-ttu-id="b2827-213">這個步驟能讓我們在雲端上強制執行 AD 內部部署密碼原則 (複雜度、使用期限、歷程記錄、篩選等)。</span><span class="sxs-lookup"><span data-stu-id="b2827-213">This step is what allows us to enforce your AD on-premises password policy (complexity, age, history, filters, etc.) in the cloud.</span></span>
* <span data-ttu-id="b2827-214">**訊息到期原則**</span><span class="sxs-lookup"><span data-stu-id="b2827-214">**Message expiration policies**</span></span> 
  * <span data-ttu-id="b2827-215">如果訊息因為內部部署服務已關閉而停留在服務匯流排，它將會在數分鐘後逾時並遭到移除，更進一步地提升安全性。</span><span class="sxs-lookup"><span data-stu-id="b2827-215">If the message sits in Service Bus because your on-premises service is down, it will time out and be removed after several minutes to increase security even further.</span></span>

### <a name="password-writeback-encryption-details"></a><span data-ttu-id="b2827-216">密碼回寫的加密詳細資料</span><span class="sxs-lookup"><span data-stu-id="b2827-216">Password writeback encryption details</span></span>

<span data-ttu-id="b2827-217">以下說明在使用者提交密碼重設要求之後，在其抵達您的內部部署環境之前，該項要求所要經歷的加密步驟，以確保最高的服務可靠性和安全性。</span><span class="sxs-lookup"><span data-stu-id="b2827-217">The encryption steps a password reset request goes through after a user submits it, before it arrives in your on-premises environment, to ensure maximum service reliability and security are described below.</span></span>

* <span data-ttu-id="b2827-218">**步驟 1- 採用 2048 位元 RSA 金鑰的密碼加密** - 使用者一旦提交要寫回內部部署環境的密碼，首先，所提交的密碼本身會以 2048 位元 RSA 金鑰進行加密。</span><span class="sxs-lookup"><span data-stu-id="b2827-218">**Step 1 - Password encryption with 2048-bit RSA Key** - Once a user submits a password to be written back to on-premises, first, the submitted password itself is encrypted with a 2048-bit RSA key.</span></span>
* <span data-ttu-id="b2827-219">**步驟 2 - 採用 AES-GCM 的套件層級加密** - 然後會使用 AES-GCM 將整個套件 (密碼 + 必要的中繼資料) 加密。</span><span class="sxs-lookup"><span data-stu-id="b2827-219">**Step 2 - Package-level encryption with AES-GCM** - Then the entire package (password + required metadata) is encrypted using AES-GCM.</span></span> <span data-ttu-id="b2827-220">這可防止任何可直接存取基礎 ServiceBus 通道的人員檢視/竄改內容。</span><span class="sxs-lookup"><span data-stu-id="b2827-220">This prevents anyone with direct access to the underlying ServiceBus channel from viewing/tampering with the contents.</span></span>
* <span data-ttu-id="b2827-221">**步驟 3 - 所有通訊都會透過 TLS / SSL 進行** - 所有與 ServiceBus 的通訊都會在 SSL/TLS 通道中進行。</span><span class="sxs-lookup"><span data-stu-id="b2827-221">**Step 3 - All communication occurs over TLS / SSL** - All the communication with ServiceBus happens in a SSL/TLS channel.</span></span> <span data-ttu-id="b2827-222">這可保護內容，免於遭到未經授權的第三方存取。</span><span class="sxs-lookup"><span data-stu-id="b2827-222">This secures the contents from unauthorized 3rd parties.</span></span>
* <span data-ttu-id="b2827-223">**每 6 個月自動變換金鑰**- 每 6 個月或每一次在 Azure AD Connect 上停用 / 重新啟用密碼回寫時，我們都會自動變換所有金鑰，以確保最高的服務安全性。</span><span class="sxs-lookup"><span data-stu-id="b2827-223">**Automatic key rollover every six months** - Automatically every 6 months, or every time password writeback is disabled / re-enabled on Azure AD Connect, we rollover all these keys to ensure maximum service security and safety.</span></span>

### <a name="password-writeback-bandwidth-usage"></a><span data-ttu-id="b2827-224">密碼回寫頻寬使用量</span><span class="sxs-lookup"><span data-stu-id="b2827-224">Password writeback bandwidth usage</span></span>

<span data-ttu-id="b2827-225">密碼回寫是一種低頻寬的服務，只有在下列情況下，才可將要求傳回內部部署代理程式︰</span><span class="sxs-lookup"><span data-stu-id="b2827-225">Password writeback is a low-bandwidth service that sends requests back to the on-premises agent only under the following circumstances:</span></span>

1. <span data-ttu-id="b2827-226">透過 Azure AD Connect 啟用或停用此功能時傳送兩則訊息。</span><span class="sxs-lookup"><span data-stu-id="b2827-226">Two messages sent when enabling or disabling the feature through Azure AD Connect.</span></span>
2. <span data-ttu-id="b2827-227">每 5 分鐘傳送一則訊息作為服務活動訊號 (只要服務正在執行)。</span><span class="sxs-lookup"><span data-stu-id="b2827-227">One message is sent once every five minutes as a service heartbeat for as long as the service is running.</span></span>
3. <span data-ttu-id="b2827-228">每次提交新密碼時會傳送兩則訊息</span><span class="sxs-lookup"><span data-stu-id="b2827-228">Two messages are sent each time a new password is submitted</span></span>
    * <span data-ttu-id="b2827-229">第一則訊息，要求執行作業</span><span class="sxs-lookup"><span data-stu-id="b2827-229">First message, as a request to perform the operation</span></span>
    * <span data-ttu-id="b2827-230">第二則訊息，包含作業的結果並且在下列情況傳送︰</span><span class="sxs-lookup"><span data-stu-id="b2827-230">Second message, which contains the result of the operation and are sent in the following circumstances:</span></span>
        * <span data-ttu-id="b2827-231">每次在使用者自助式密碼重設期間提交新密碼時。</span><span class="sxs-lookup"><span data-stu-id="b2827-231">Each time a new password is submitted during a user self-service password reset.</span></span>
        * <span data-ttu-id="b2827-232">每次在使用者密碼變更作業期間提交新密碼時。</span><span class="sxs-lookup"><span data-stu-id="b2827-232">Each time a new password is submitted during a user password change operation.</span></span>
        * <span data-ttu-id="b2827-233">每次在系統管理員所起始的使用者密碼重設期間提交新密碼時 (僅限從 Azure 系統管理員入口網站)。</span><span class="sxs-lookup"><span data-stu-id="b2827-233">Each time a new password is submitted during an admin-initiated user password reset (from the Azure admin portals only).</span></span>

#### <a name="message-size-and-bandwidth-considerations"></a><span data-ttu-id="b2827-234">訊息大小和頻寬考量</span><span class="sxs-lookup"><span data-stu-id="b2827-234">Message size and bandwidth considerations</span></span>

<span data-ttu-id="b2827-235">以上所述的每則訊息大小通常在 1 kb 以下，即使在極大負載之下，密碼回寫服務本身每秒耗用頻寬的幾千位元。</span><span class="sxs-lookup"><span data-stu-id="b2827-235">The size of each of the message described above is typically under 1 kb, even under extreme loads, the password writeback service itself is consuming a few kilobits per second of bandwidth.</span></span> <span data-ttu-id="b2827-236">因為每則訊息都是即時傳送 (只限於密碼更新作業要求時)，而且因為訊息大小如此小，所以回寫功能的頻寬使用量實際上太小，以致沒有任何真正可測量的影響。</span><span class="sxs-lookup"><span data-stu-id="b2827-236">Since each message is sent in real time, only when required by a password update operation, and since the message size is so small, the bandwidth usage of the writeback capability is effectively too small to have any real measurable impact.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b2827-237">後續步驟</span><span class="sxs-lookup"><span data-stu-id="b2827-237">Next steps</span></span>

<span data-ttu-id="b2827-238">下列連結提供有關使用 Azure AD 重設密碼的其他資訊</span><span class="sxs-lookup"><span data-stu-id="b2827-238">The following links provide additional information regarding password reset using Azure AD</span></span>

* <span data-ttu-id="b2827-239">[**快速入門**](active-directory-passwords-getting-started.md) - 開始執行 Azure AD 自助式密碼管理</span><span class="sxs-lookup"><span data-stu-id="b2827-239">[**Quick Start**](active-directory-passwords-getting-started.md) - Get up and running with Azure AD self service password management</span></span> 
* <span data-ttu-id="b2827-240">[**授權**](active-directory-passwords-licensing.md) - 設定 Azure AD 授權</span><span class="sxs-lookup"><span data-stu-id="b2827-240">[**Licensing**](active-directory-passwords-licensing.md) - Configure your Azure AD Licensing</span></span>
* <span data-ttu-id="b2827-241">[**資料**](active-directory-passwords-data.md) -了解所需的資料以及如何將它使用於密碼管理</span><span class="sxs-lookup"><span data-stu-id="b2827-241">[**Data**](active-directory-passwords-data.md) - Understand the data that is required and how it is used for password management</span></span>
* <span data-ttu-id="b2827-242">[**推出**](active-directory-passwords-best-practices.md) - 使用此處提供的指引來規劃 SSPR 並將它部署至使用者</span><span class="sxs-lookup"><span data-stu-id="b2827-242">[**Rollout**](active-directory-passwords-best-practices.md) - Plan and deploy SSPR to your users using the guidance found here</span></span>
* <span data-ttu-id="b2827-243">[**自訂**](active-directory-passwords-customize.md) - 為您的公司自訂 SSPR 體驗的外觀及操作方式。</span><span class="sxs-lookup"><span data-stu-id="b2827-243">[**Customize**](active-directory-passwords-customize.md) - Customize the look and feel of the SSPR experience for your company.</span></span>
* <span data-ttu-id="b2827-244">[**原則**](active-directory-passwords-policy.md) - 了解並設定 Azure AD 密碼原則</span><span class="sxs-lookup"><span data-stu-id="b2827-244">[**Policy**](active-directory-passwords-policy.md) - Understand and set Azure AD password policies</span></span>
* <span data-ttu-id="b2827-245">[**報告**](active-directory-passwords-reporting.md) - 探索您的使用者是否、何時、何地存取 SSPR 功能</span><span class="sxs-lookup"><span data-stu-id="b2827-245">[**Reporting**](active-directory-passwords-reporting.md) - Discover if, when, and where your users are accessing SSPR functionality</span></span>
* <span data-ttu-id="b2827-246">[**技術性深入探討**](active-directory-passwords-how-it-works.md) - 深入探索以了解其運作方式</span><span class="sxs-lookup"><span data-stu-id="b2827-246">[**Technical Deep Dive**](active-directory-passwords-how-it-works.md) - Go behind the curtain to understand how it works</span></span>
* <span data-ttu-id="b2827-247">[**常見問題集**](active-directory-passwords-faq.md) - 如何？</span><span class="sxs-lookup"><span data-stu-id="b2827-247">[**Frequently Asked Questions**](active-directory-passwords-faq.md) - How?</span></span> <span data-ttu-id="b2827-248">原因為何？</span><span class="sxs-lookup"><span data-stu-id="b2827-248">Why?</span></span> <span data-ttu-id="b2827-249">何事？</span><span class="sxs-lookup"><span data-stu-id="b2827-249">What?</span></span> <span data-ttu-id="b2827-250">何地？</span><span class="sxs-lookup"><span data-stu-id="b2827-250">Where?</span></span> <span data-ttu-id="b2827-251">何人？</span><span class="sxs-lookup"><span data-stu-id="b2827-251">Who?</span></span> <span data-ttu-id="b2827-252">何時？</span><span class="sxs-lookup"><span data-stu-id="b2827-252">When?</span></span> <span data-ttu-id="b2827-253">- -您一直想要詢問之問題的答案</span><span class="sxs-lookup"><span data-stu-id="b2827-253">- Answers to questions you always wanted to ask</span></span>
* <span data-ttu-id="b2827-254">[**疑難排解**](active-directory-passwords-troubleshoot.md) - 了解如何解決我們看到的 SSPR 常見問題</span><span class="sxs-lookup"><span data-stu-id="b2827-254">[**Troubleshoot**](active-directory-passwords-troubleshoot.md) - Learn how to resolve common issues that we see with SSPR</span></span>

<span data-ttu-id="b2827-255">[Writeback]: ./media/active-directory-passwords-writeback/enablepasswordwriteback.png "在 Azure AD Connect 中啟用密碼回寫"</span><span class="sxs-lookup"><span data-stu-id="b2827-255">[Writeback]: ./media/active-directory-passwords-writeback/enablepasswordwriteback.png "Enable password writeback in Azure AD Connect"</span></span>
