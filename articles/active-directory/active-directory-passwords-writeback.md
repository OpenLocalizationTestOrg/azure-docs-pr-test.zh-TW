---
title: "Azure AD SSPR 與密碼回寫 | Microsoft Docs"
description: "使用 Azure AD 和 Azure AD Connect toowriteback 密碼 tooon 內部部署目錄"
services: active-directory
keywords: "Active directory 密碼管理, 密碼管理, Azure AD 自助式密碼重設"
documentationcenter: 
author: MicrosoftGuyJFlo
manager: femila
ms.reviewer: gahug
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: joflore
ms.custom: it-pro
ms.openlocfilehash: 6a1dd964a51b4f3b5b0be303b722ab6deb4a6110
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="password-writeback-overview"></a><span data-ttu-id="f308a-104">密碼回寫概觀</span><span class="sxs-lookup"><span data-stu-id="f308a-104">Password writeback overview</span></span>

<span data-ttu-id="f308a-105">密碼回寫可讓您的 Azure AD tooconfigure toowrite 密碼備份 tooyou 內部部署 Active Directory。</span><span class="sxs-lookup"><span data-stu-id="f308a-105">Password writeback allows you tooconfigure Azure AD toowrite passwords back tooyou on-premises Active Directory.</span></span> <span data-ttu-id="f308a-106">它 hello 需要 tooset 移除註冊和管理複雜的內部部署自助式密碼重設解決方案，並提供方便雲端式使用者 tooreset 其內部部署密碼隨時隨地都能。</span><span class="sxs-lookup"><span data-stu-id="f308a-106">It removes hello need tooset up and manage a complicated on-premises self-service password reset solution, and it provides a convenient cloud-based way for your users tooreset their on-premises passwords wherever they are.</span></span> <span data-ttu-id="f308a-107">密碼回寫是 [Azure Active Directory Connect](./connect/active-directory-aadconnect.md) 的元件，可供目前的 [Azure Active Directory 版本](active-directory-editions.md)訂閱者啟用及使用。</span><span class="sxs-lookup"><span data-stu-id="f308a-107">Password writeback is a component of [Azure Active Directory Connect](./connect/active-directory-aadconnect.md) that can be enabled and used by current subscribers of Premium [Azure Active Directory Editions](active-directory-editions.md).</span></span>

<span data-ttu-id="f308a-108">密碼回寫中提供下列功能的 hello</span><span class="sxs-lookup"><span data-stu-id="f308a-108">Password writeback provides hello following features</span></span>

* <span data-ttu-id="f308a-109">**零延遲的意見反應** - 密碼回寫是一項同步作業。</span><span class="sxs-lookup"><span data-stu-id="f308a-109">**Zero delay feedback** - Password writeback is a synchronous operation.</span></span> <span data-ttu-id="f308a-110">如果他們的密碼不符合原則，或已不能 toobe 重設或變更任何原因，會立即通知您的使用者。</span><span class="sxs-lookup"><span data-stu-id="f308a-110">Your users are notified immediately if their password did not meet policy or was not able toobe reset or changed for any reason.</span></span>
* <span data-ttu-id="f308a-111">**支援使用 AD FS 或其他同盟技術的使用者密碼重設**-密碼回寫，只要 hello 同盟的使用者帳戶會同步處理到 Azure AD 租用戶，它們都是可以 toomanage 其在內部部署 AD從 hello 雲端的密碼。</span><span class="sxs-lookup"><span data-stu-id="f308a-111">**Supports resetting passwords for users using AD FS or other federation technologies** - With password writeback, as long as hello federated user accounts are synchronized into your Azure AD tenant, they are able toomanage their on-premises AD passwords from hello cloud.</span></span>
* <span data-ttu-id="f308a-112">**支援使用的使用者密碼重設[密碼雜湊同步](./connect/active-directory-aadconnectsync-implement-password-synchronization.md)** -時 hello 密碼重設服務偵測到啟用同步處理的使用者帳戶的密碼雜湊同步處理，所以重設兩個此帳戶在內部部署和雲端密碼同時。</span><span class="sxs-lookup"><span data-stu-id="f308a-112">**Supports resetting passwords for users using [password hash sync](./connect/active-directory-aadconnectsync-implement-password-synchronization.md)** - When hello password reset service detects that a synchronized user account is enabled for password hash sync, we reset both this account’s on-premises and cloud password simultaneously.</span></span>
* <span data-ttu-id="f308a-113">**支援密碼變更 hello 從存取面板和 Office 365** -當同盟或密碼同步處理使用者返回 toochange 到期或尚未到期的密碼，我們寫入這些密碼後 tooyour 本機 AD 環境。</span><span class="sxs-lookup"><span data-stu-id="f308a-113">**Supports changing passwords from hello access panel and Office 365** - When federated or password synchronized users come toochange their expired or non-expired passwords, we write those passwords back tooyour local AD environment.</span></span>
* <span data-ttu-id="f308a-114">**回寫密碼時通知系統管理員重設他們從 hello Azure 入口網站**-為系統管理員重設使用者密碼在 hello 每當[Azure 入口網站](https://portal.azure.com)，如果該使用者為同盟或密碼同步，我們會隨即制定 hello在您的本機 AD，以及會選取密碼 hello 系統管理員。</span><span class="sxs-lookup"><span data-stu-id="f308a-114">**Supports writing back passwords when an admin reset them from hello Azure portal** - Whenever an admin resets a user’s password in hello [Azure portal](https://portal.azure.com), if that user is federated or password synchronized, we’ll set hello password hello admin selects on your local AD, as well.</span></span> <span data-ttu-id="f308a-115">這是目前不支援在 hello Office 管理入口網站中。</span><span class="sxs-lookup"><span data-stu-id="f308a-115">This is currently not supported in hello Office Admin Portal.</span></span>
* <span data-ttu-id="f308a-116">**會強制執行您內部部署 AD 密碼原則**-當使用者重設其密碼，我們確定它符合您內部部署 AD 原則，再認可 toothat 目錄。</span><span class="sxs-lookup"><span data-stu-id="f308a-116">**Enforces your on-premises AD password policies** - When a user resets their password, we make sure that it meets your on-premises AD policy before committing it toothat directory.</span></span> <span data-ttu-id="f308a-117">這當中包括歷程記錄、複雜度、使用期限、密碼篩選和您在本機 AD 中定義的任何其他密碼限制。</span><span class="sxs-lookup"><span data-stu-id="f308a-117">This includes history, complexity, age, password filters, and any other password restrictions you have defined in your local AD.</span></span>
* <span data-ttu-id="f308a-118">**不需要任何輸入的防火牆規則**-密碼回寫使用 Azure 服務匯流排轉送當做基礎的通訊通道，這表示，您不需要 tooopen 任何輸入連接埠此功能 toowork 在防火牆上。</span><span class="sxs-lookup"><span data-stu-id="f308a-118">**Doesn’t require any inbound firewall rules** - Password writeback uses an Azure Service Bus relay as an underlying communication channel, meaning that you do not have tooopen any inbound ports on your firewall for this feature toowork.</span></span>
* <span data-ttu-id="f308a-119">**不支援存在於內部部署 Active Directory 中受保護群組內的使用者帳戶** - 如需受保護群組的詳細資訊，請參閱 [Active Directory 中受保護的帳戶和群組](https://technet.microsoft.com/library/dn535499.aspx)。</span><span class="sxs-lookup"><span data-stu-id="f308a-119">**Is not supported for user accounts that exist within protected groups in your on-premises Active Directory** - For more information about protected groups, see [Protected Accounts and Groups in Active Directory](https://technet.microsoft.com/library/dn535499.aspx).</span></span>

## <a name="how-password-writeback-works"></a><span data-ttu-id="f308a-120">密碼回寫的運作方式</span><span class="sxs-lookup"><span data-stu-id="f308a-120">How password writeback works</span></span>

<span data-ttu-id="f308a-121">當同盟或密碼雜湊同步處理使用者 tooreset 或變更其密碼的 hello 雲端發生 hello 下列情況：</span><span class="sxs-lookup"><span data-stu-id="f308a-121">When a federated or password hash synchronized user comes tooreset or change their password in hello cloud, hello following occurs:</span></span>

1. <span data-ttu-id="f308a-122">我們會檢查 toosee 有何種密碼 hello 使用者。</span><span class="sxs-lookup"><span data-stu-id="f308a-122">We check toosee what type of password hello user has.</span></span>
    * <span data-ttu-id="f308a-123">如果我們看到 hello 密碼由內部部署管理</span><span class="sxs-lookup"><span data-stu-id="f308a-123">If we see hello password is managed on premises</span></span>
        * <span data-ttu-id="f308a-124">我們會檢查如果 hello 回寫服務已啟動且執行中，如果是，我們讓 hello 使用者繼續</span><span class="sxs-lookup"><span data-stu-id="f308a-124">We check if hello writeback service is up and running, if it is, we let hello user proceed</span></span>
        * <span data-ttu-id="f308a-125">如果 hello 回寫服務不是往上，我們告訴 hello 使用者，他們無法重設密碼現在</span><span class="sxs-lookup"><span data-stu-id="f308a-125">If hello writeback service is not up, we tell hello user that their password cannot be reset now</span></span>
2. <span data-ttu-id="f308a-126">接下來，hello 使用者傳送嗨適當的驗證閘道，並達到 hello 重設密碼畫面。</span><span class="sxs-lookup"><span data-stu-id="f308a-126">Next, hello user passes hello appropriate authentication gates and reaches hello reset password screen.</span></span>
3. <span data-ttu-id="f308a-127">hello 使用者選取新密碼，並確認它。</span><span class="sxs-lookup"><span data-stu-id="f308a-127">hello user selects a new password and confirms it.</span></span>
4. <span data-ttu-id="f308a-128">按下提交，我們已在 hello 回寫設定程序期間建立的對稱金鑰加密 hello 純文字密碼。</span><span class="sxs-lookup"><span data-stu-id="f308a-128">Upon clicking submit, we encrypt hello plaintext password with a symmetric key that was created during hello writeback setup process.</span></span>
5. <span data-ttu-id="f308a-129">加密 hello 密碼之後, 我們包含在透過 HTTPS 通道 tooyour 租用戶專屬的服務匯流排轉送 （我們也為您設定 hello 回寫設定程序） 送裝載。</span><span class="sxs-lookup"><span data-stu-id="f308a-129">After encrypting hello password, we include it in a payload that gets sent over an HTTPS channel tooyour tenant-specific service bus relay (that we also set up for you during hello writeback setup process).</span></span> <span data-ttu-id="f308a-130">此轉送受到只有您的內部部署安裝才會知道的隨機產生密碼所保護。</span><span class="sxs-lookup"><span data-stu-id="f308a-130">This relay is protected by a randomly generated password that only your on-premises installation knows.</span></span>
6. <span data-ttu-id="f308a-131">一旦 hello 訊息抵達服務匯流排，hello 密碼重設端點自動喚醒並看到它有暫止的重設要求。</span><span class="sxs-lookup"><span data-stu-id="f308a-131">Once hello message reaches service bus, hello password reset endpoint automatically wakes up and sees that it has a reset request pending.</span></span>
7. <span data-ttu-id="f308a-132">hello 服務接著會尋找 hello 使用者有問題使用 hello 雲端錨點屬性。</span><span class="sxs-lookup"><span data-stu-id="f308a-132">hello service then looks for hello user in question by using hello cloud anchor attribute.</span></span> <span data-ttu-id="f308a-133">針對此查閱 toosucceed:</span><span class="sxs-lookup"><span data-stu-id="f308a-133">For this lookup toosucceed:</span></span>

    * <span data-ttu-id="f308a-134">hello 使用者物件必須存在於 AD 連接器空間 hello</span><span class="sxs-lookup"><span data-stu-id="f308a-134">hello user object must exist in hello AD connector space</span></span>
    * <span data-ttu-id="f308a-135">hello 使用者物件必須是連結的 toohello 相對應的 MV 物件</span><span class="sxs-lookup"><span data-stu-id="f308a-135">hello user object must be linked toohello corresponding MV object</span></span>
    * <span data-ttu-id="f308a-136">hello 使用者物件必須是連結的 toohello 相對應的 AAD 連接器物件。</span><span class="sxs-lookup"><span data-stu-id="f308a-136">hello user object must be linked toohello corresponding AAD connector object.</span></span>
    * <span data-ttu-id="f308a-137">hello 連結從 AD 連接器物件 tooMV 必須有 hello 同步處理規則`Microsoft.InfromADUserAccountEnabled.xxx`hello 連結。</span><span class="sxs-lookup"><span data-stu-id="f308a-137">hello link from AD connector object tooMV must have hello synchronization rule `Microsoft.InfromADUserAccountEnabled.xxx` on hello link.</span></span> <br> <br>
    <span data-ttu-id="f308a-138">當 hello 呼叫會來自 hello 雲端時，hello 同步處理引擎會使用 hello cloudAnchor 屬性 toolook hello AAD 連接器空間物件，跟 hello 連結後 toohello MV 物件，然後依照 [hello 連結後 toohello AD 物件。</span><span class="sxs-lookup"><span data-stu-id="f308a-138">When hello call comes in from hello cloud, hello synchronization engine uses hello cloudAnchor attribute toolook up hello AAD connector space object, follows hello link back toohello MV object, and then follows hello link back toohello AD object.</span></span> <span data-ttu-id="f308a-139">因為可能有多個 AD 物件 （多樹系） 的相同使用者，hello 同步引擎依賴 hello hello`Microsoft.InfromADUserAccountEnabled.xxx`連結 toopick hello 更正其中一個。</span><span class="sxs-lookup"><span data-stu-id="f308a-139">Because there could be multiple AD objects (multi-forest) for hello same user, hello sync engine relies on hello `Microsoft.InfromADUserAccountEnabled.xxx` link toopick hello correct one.</span></span>

    > [!Note]
    > <span data-ttu-id="f308a-140">因為此邏輯，而 Azure AD Connect 必須能夠以 hello PDC 模擬器的密碼回寫 toowork toocommunicate。</span><span class="sxs-lookup"><span data-stu-id="f308a-140">As a result of this logic, Azure AD Connect must be able toocommunicate with hello PDC Emulator for password writeback toowork.</span></span> <span data-ttu-id="f308a-141">如果您在此手動需要 tooenable，您可以以滑鼠右鍵按一下 hello 連接 Azure AD Connect toohello PDC 模擬器**屬性**的 hello Active Directory 同步處理連接器，然後選取**設定目錄分割**。</span><span class="sxs-lookup"><span data-stu-id="f308a-141">If you need tooenable this manually, you can connect Azure AD Connect toohello PDC Emulator by right-clicking on hello **properties** of hello Active Directory synchronization connector, then selecting **configure directory partitions**.</span></span> <span data-ttu-id="f308a-142">從該處，尋找 hello**網域控制站連線設定**區段，並檢查 hello 方塊**只使用慣用的網域控制站**。</span><span class="sxs-lookup"><span data-stu-id="f308a-142">From there, look for hello **domain controller connection settings** section and check hello box titled **only use preferred domain controllers**.</span></span> <span data-ttu-id="f308a-143">即使 hello 慣用 DC 不是 PDC 模擬器，Azure AD Connect 會嘗試 tooconnect toohello PDC 密碼回寫。</span><span class="sxs-lookup"><span data-stu-id="f308a-143">Even if hello preferred DC is not a PDC emulator, Azure AD Connect will attempt tooconnect toohello PDC for password writeback.</span></span>

8. <span data-ttu-id="f308a-144">一旦找到 hello 使用者帳戶，我們會嘗試直接在 hello 適當 AD 樹系中的 tooreset hello 密碼。</span><span class="sxs-lookup"><span data-stu-id="f308a-144">Once hello user account is found, we attempt tooreset hello password directly in hello appropriate AD forest.</span></span>
9. <span data-ttu-id="f308a-145">如果 hello 密碼設定作業成功，我們會告訴 hello 使用者，其密碼已經變更集。</span><span class="sxs-lookup"><span data-stu-id="f308a-145">If hello password set operation is successful, we tell hello user their password has been changed.</span></span>
    > [!NOTE]
    > <span data-ttu-id="f308a-146">萬一 hello hello 使用者的密碼已同步處理的 tooAzure AD 時使用的密碼同步處理，沒有機會 hello 在內部部署密碼原則是比 hello 雲端密碼原則更弱。</span><span class="sxs-lookup"><span data-stu-id="f308a-146">In hello case when hello user's password is synchronized tooAzure AD using password synchronization, there is a chance that hello on-premises password policy is weaker than hello cloud password policy.</span></span> <span data-ttu-id="f308a-147">在此情況下，仍強制任何 hello 在內部部署原則，並改為允許的密碼雜湊同步處理 toosynchronize hello 雜湊的密碼。</span><span class="sxs-lookup"><span data-stu-id="f308a-147">In this case, we still enforce whatever hello on-premises policy is, and instead allow password hash synchronization toosynchronize hello hash of that password.</span></span> <span data-ttu-id="f308a-148">這可確保您在內部部署的原則會強制執行的 hello 雲端，不論如果您使用密碼同步或同盟 tooprovide 單一登入。</span><span class="sxs-lookup"><span data-stu-id="f308a-148">This ensures that your on-premises policy is enforced in hello cloud, no matter if you use password synchronization or federation tooprovide single sign-on.</span></span>

10. <span data-ttu-id="f308a-149">如果 hello 密碼設定作業失敗，我們會傳回 hello toohello 使用者時發生錯誤，並且讓他們再試一次。</span><span class="sxs-lookup"><span data-stu-id="f308a-149">If hello password set operation fails, we return hello error toohello user and let them try again.</span></span>
    * <span data-ttu-id="f308a-150">hello 作業可能會因為 hello 下列失敗</span><span class="sxs-lookup"><span data-stu-id="f308a-150">hello operation might fail because of hello following</span></span>
        * <span data-ttu-id="f308a-151">hello 服務已關閉</span><span class="sxs-lookup"><span data-stu-id="f308a-151">hello service was down</span></span>
        * <span data-ttu-id="f308a-152">選取這些 hello 密碼不符合公司原則</span><span class="sxs-lookup"><span data-stu-id="f308a-152">hello password they selected did not meet organization policies</span></span>
        * <span data-ttu-id="f308a-153">我們找不到 hello 本機 AD 中的 hello 使用者</span><span class="sxs-lookup"><span data-stu-id="f308a-153">We could not find hello user in hello local AD</span></span>

    <span data-ttu-id="f308a-154">我們有許多這類情況的訊息，告知 hello 使用者他們可以執行特定 tooresolve hello 問題。</span><span class="sxs-lookup"><span data-stu-id="f308a-154">We have a specific message for many of these cases and tell hello user what they can do tooresolve hello issue.</span></span>

## <a name="configuring-password-writeback"></a><span data-ttu-id="f308a-155">設定密碼回寫</span><span class="sxs-lookup"><span data-stu-id="f308a-155">Configuring password writeback</span></span>

<span data-ttu-id="f308a-156">我們建議您使用 hello 自動更新功能[Azure AD Connect](./connect/active-directory-aadconnect-get-started-express.md)如果您想 toouse 密碼回寫。</span><span class="sxs-lookup"><span data-stu-id="f308a-156">We recommend that you use hello auto-update feature of [Azure AD Connect](./connect/active-directory-aadconnect-get-started-express.md) if you want toouse password writeback.</span></span>

<span data-ttu-id="f308a-157">DirSync 和 Azure AD 同步作業已不再支援的方法，啟用密碼回寫 hello 發行項的[從 DirSync 和 Azure AD Sync 升級](connect/active-directory-aadconnect-dirsync-deprecated.md)已與您轉換的詳細資訊 toohelp。</span><span class="sxs-lookup"><span data-stu-id="f308a-157">DirSync and Azure AD Sync are no longer supported means of enabling password writeback hello article [Upgrade from DirSync and Azure AD Sync](connect/active-directory-aadconnect-dirsync-deprecated.md) has more information toohelp with your transition.</span></span>

<span data-ttu-id="f308a-158">hello 下列步驟假設您已經使用 hello 您環境中設定 Azure AD Connect [Express](./connect/active-directory-aadconnect-get-started-express.md)或[自訂](./connect/active-directory-aadconnect-get-started-custom.md)設定。</span><span class="sxs-lookup"><span data-stu-id="f308a-158">hello steps below assume you have already configured Azure AD Connect in your environment using hello [Express](./connect/active-directory-aadconnect-get-started-express.md) or [Custom](./connect/active-directory-aadconnect-get-started-custom.md) settings.</span></span>

1. <span data-ttu-id="f308a-159">tooconfigure 並啟用密碼回寫登入 tooyour Azure AD Connect 的伺服器，然後啟動 hello **Azure AD Connect**組態精靈。</span><span class="sxs-lookup"><span data-stu-id="f308a-159">tooconfigure and enable password writeback log in tooyour Azure AD Connect server and start hello **Azure AD Connect** configuration wizard.</span></span>
2. <span data-ttu-id="f308a-160">在 [hello 歡迎使用] 畫面上按一下**設定**。</span><span class="sxs-lookup"><span data-stu-id="f308a-160">On hello Welcome screen click **Configure**.</span></span>
3. <span data-ttu-id="f308a-161">在 [hello 其他工作畫面上按一下**自訂同步處理選項**，然後選擇 [**下一步**。</span><span class="sxs-lookup"><span data-stu-id="f308a-161">On hello Additional tasks screen click **Customize synchronization options** and then choose **Next**.</span></span>
4. <span data-ttu-id="f308a-162">Hello 連接 tooAzure AD 畫面上輸入全域系統管理員認證，然後選擇**下一步**。</span><span class="sxs-lookup"><span data-stu-id="f308a-162">On hello Connect tooAzure AD screen enter a Global Administrator credential and choose **Next**.</span></span>
5. <span data-ttu-id="f308a-163">Hello 上您的目錄和網域連線，而且您可以選擇篩選螢幕的 OU**下一步**。</span><span class="sxs-lookup"><span data-stu-id="f308a-163">On hello Connect your directories and Domain and OU filtering screens you can choose **Next**.</span></span>
6. <span data-ttu-id="f308a-164">在 hello 選擇性功能] 畫面上核取 hello 方塊旁太**密碼回寫**按一下**下一步**。</span><span class="sxs-lookup"><span data-stu-id="f308a-164">On hello Optional features screen check hello box next too**Password writeback** and click **Next**.</span></span>
   <span data-ttu-id="f308a-165">![在 Azure AD Connect 中啟用密碼回寫][Writeback]</span><span class="sxs-lookup"><span data-stu-id="f308a-165">![Enable password writeback in Azure AD Connect][Writeback]</span></span>
7. <span data-ttu-id="f308a-166">Hello 準備 tooconfigure 畫面上按一下 [**設定**並等候 hello 程序 toocomplete。</span><span class="sxs-lookup"><span data-stu-id="f308a-166">On hello Ready tooconfigure screen click **Configure** and wait for hello process toocomplete.</span></span>
8. <span data-ttu-id="f308a-167">當您看到「設定完成」時，您可以按一下 **[結束]**</span><span class="sxs-lookup"><span data-stu-id="f308a-167">When you see Configuration complete you can click **Exit**</span></span>

## <a name="licensing-requirements-for-password-writeback"></a><span data-ttu-id="f308a-168">密碼回寫的授權需求</span><span class="sxs-lookup"><span data-stu-id="f308a-168">Licensing requirements for password writeback</span></span>

<span data-ttu-id="f308a-169">如需有關授權，請參閱 hello 主題[授權所需的密碼回寫](active-directory-passwords-licensing.md#licenses-required-for-password-writeback)或 hello 下列站台</span><span class="sxs-lookup"><span data-stu-id="f308a-169">For information regarding licensing, see hello topic [Licenses required for password writeback](active-directory-passwords-licensing.md#licenses-required-for-password-writeback) or hello following sites</span></span>

* [<span data-ttu-id="f308a-170">Azure Active Directory 價格網站</span><span class="sxs-lookup"><span data-stu-id="f308a-170">Azure Active Directory Pricing site</span></span>](https://azure.microsoft.com/pricing/details/active-directory/)
* [<span data-ttu-id="f308a-171">Enterprise Mobility + Security</span><span class="sxs-lookup"><span data-stu-id="f308a-171">Enterprise Mobility + Security</span></span>](https://www.microsoft.com/cloud-platform/enterprise-mobility-security)
* [<span data-ttu-id="f308a-172">Secure Productive Enterprise</span><span class="sxs-lookup"><span data-stu-id="f308a-172">Secure Productive Enterprise</span></span>](https://www.microsoft.com/secure-productive-enterprise/default.aspx)

### <a name="on-premises-authentication-modes-supported-for-password-writeback"></a><span data-ttu-id="f308a-173">密碼回寫支援的內部部署驗證模式</span><span class="sxs-lookup"><span data-stu-id="f308a-173">On-premises authentication modes supported for password writeback</span></span>

<span data-ttu-id="f308a-174">密碼回寫適用於下列使用者的密碼類型 hello:</span><span class="sxs-lookup"><span data-stu-id="f308a-174">Password writeback works for hello following user password types:</span></span>

* <span data-ttu-id="f308a-175">**僅限雲端的使用者**︰密碼回寫不適用於這種情況，因為沒有內部部署密碼</span><span class="sxs-lookup"><span data-stu-id="f308a-175">**Cloud-only users**: Password writeback does not apply in this situation, because there is no on-premises password</span></span>
* <span data-ttu-id="f308a-176">**已同步處理密碼的使用者**︰支援密碼回寫</span><span class="sxs-lookup"><span data-stu-id="f308a-176">**Password-synchronized users**: Password writeback supported</span></span>
* <span data-ttu-id="f308a-177">**同盟使用者**︰支援密碼回寫</span><span class="sxs-lookup"><span data-stu-id="f308a-177">**Federated users**: Password writeback supported</span></span>
* <span data-ttu-id="f308a-178">**傳遞驗證使用者**︰支援密碼回寫</span><span class="sxs-lookup"><span data-stu-id="f308a-178">**Pass-through authentication users**: Password writeback supported</span></span>

### <a name="user-and-admin-operations-supported-for-password-writeback"></a><span data-ttu-id="f308a-179">密碼回寫支援的使用者和系統管理員作業</span><span class="sxs-lookup"><span data-stu-id="f308a-179">User and Admin operations supported for password writeback</span></span>

<span data-ttu-id="f308a-180">密碼會回寫，在下列情況下的所有 hello:</span><span class="sxs-lookup"><span data-stu-id="f308a-180">Passwords are written back in all hello following situations:</span></span>

* <span data-ttu-id="f308a-181">**支援的使用者作業**</span><span class="sxs-lookup"><span data-stu-id="f308a-181">**Supported End-user operations**</span></span>
  * <span data-ttu-id="f308a-182">任何使用者自助式自願變更密碼作業</span><span class="sxs-lookup"><span data-stu-id="f308a-182">Any end-user self-service voluntary change password operation</span></span>
  * <span data-ttu-id="f308a-183">任何使用者自助式強制變更密碼作業 (例如密碼到期)</span><span class="sxs-lookup"><span data-stu-id="f308a-183">Any end-user self-service force change password operation (for example, password expiration)</span></span>
  * <span data-ttu-id="f308a-184">任何使用者自助式密碼重設源自 hello[密碼重設入口網站](https://passwordreset.microsoftonline.com)</span><span class="sxs-lookup"><span data-stu-id="f308a-184">Any end-user self-service password reset originating from hello [Password Reset Portal](https://passwordreset.microsoftonline.com)</span></span>
* <span data-ttu-id="f308a-185">**支援的系統管理員作業**</span><span class="sxs-lookup"><span data-stu-id="f308a-185">**Supported Administrator operations**</span></span>
  * <span data-ttu-id="f308a-186">任何系統管理員自助式自願變更密碼作業</span><span class="sxs-lookup"><span data-stu-id="f308a-186">Any administrator self-service voluntary change password operation</span></span>
  * <span data-ttu-id="f308a-187">任何系統管理員自助式強制變更密碼作業 (例如密碼到期)</span><span class="sxs-lookup"><span data-stu-id="f308a-187">Any administrator self-service force change password operation (for example, password expiration)</span></span>
  * <span data-ttu-id="f308a-188">任何系統管理員自助式密碼重設源自 hello[密碼重設入口網站](https://passwordreset.microsoftonline.com)</span><span class="sxs-lookup"><span data-stu-id="f308a-188">Any administrator self-service password reset originating from hello [Password Reset Portal](https://passwordreset.microsoftonline.com)</span></span>
  * <span data-ttu-id="f308a-189">任何從 hello 重設的系統管理員起始使用者密碼[Azure 傳統入口網站](https://manage.windowsazure.com)</span><span class="sxs-lookup"><span data-stu-id="f308a-189">Any administrator-initiated end-user password reset from hello [Azure classic portal](https://manage.windowsazure.com)</span></span>
  * <span data-ttu-id="f308a-190">任何從 hello 重設的系統管理員起始使用者密碼[Azure 入口網站](https://portal.azure.com)</span><span class="sxs-lookup"><span data-stu-id="f308a-190">Any administrator-initiated end-user password reset from hello [Azure portal](https://portal.azure.com)</span></span>

### <a name="user-and-admin-operations-not-supported-for-password-writeback"></a><span data-ttu-id="f308a-191">密碼回寫不支援的使用者和系統管理員作業</span><span class="sxs-lookup"><span data-stu-id="f308a-191">User and Admin operations not supported for password writeback</span></span>

<span data-ttu-id="f308a-192">密碼是**不**寫入中任何 hello 下列情況：</span><span class="sxs-lookup"><span data-stu-id="f308a-192">Passwords are **not** written back in any of hello following situations:</span></span>

* <span data-ttu-id="f308a-193">**不支援的使用者作業**</span><span class="sxs-lookup"><span data-stu-id="f308a-193">**Unsupported End-user operations**</span></span>
  * <span data-ttu-id="f308a-194">重設自己的密碼使用 PowerShell v1、 v2、 或 hello Azure AD Graph API 的所有使用者</span><span class="sxs-lookup"><span data-stu-id="f308a-194">Any end user resetting their own password using PowerShell v1, v2, or hello Azure AD Graph API</span></span>
* <span data-ttu-id="f308a-195">**不支援的系統管理員作業**</span><span class="sxs-lookup"><span data-stu-id="f308a-195">**Unsupported Administrator operations**</span></span>
  * <span data-ttu-id="f308a-196">任何從 hello 重設的系統管理員起始使用者密碼[Office 管理入口網站](https://portal.office.com)</span><span class="sxs-lookup"><span data-stu-id="f308a-196">Any administrator-initiated end-user password reset from hello [Office management portal](https://portal.office.com)</span></span>
  * <span data-ttu-id="f308a-197">任何系統管理員起始使用者密碼從 PowerShell v1、 v2、 重設或 hello Azure AD Graph API</span><span class="sxs-lookup"><span data-stu-id="f308a-197">Any administrator-initiated end-user password reset from PowerShell v1, v2, or hello Azure AD Graph API</span></span>

<span data-ttu-id="f308a-198">當我們使用 tooremove 這些限制時，我們不需要特定的時間軸，我們可以在尚未共用。</span><span class="sxs-lookup"><span data-stu-id="f308a-198">While we are working tooremove these limitations, we do not have a specific timeline we can share yet.</span></span>

## <a name="password-writeback-security-model"></a><span data-ttu-id="f308a-199">密碼回寫的安全性模型</span><span class="sxs-lookup"><span data-stu-id="f308a-199">Password writeback security model</span></span>

<span data-ttu-id="f308a-200">密碼回寫是一項極為安全的服務。</span><span class="sxs-lookup"><span data-stu-id="f308a-200">Password writeback is a highly secure service.</span></span>  <span data-ttu-id="f308a-201">您的資訊保護的 tooensure，我們會啟用如下所述的 4 層的安全性模型。</span><span class="sxs-lookup"><span data-stu-id="f308a-201">tooensure your information is protected, we enable a 4-tiered security model that is described below.</span></span>

* <span data-ttu-id="f308a-202">**租用戶特定的服務匯流排轉送**</span><span class="sxs-lookup"><span data-stu-id="f308a-202">**Tenant-specific service-bus relay**</span></span>
  * <span data-ttu-id="f308a-203">當您設定 hello 服務時，我們會設定租用戶特定服務匯流排轉送由隨機產生的強式密碼，Microsoft 也無法存取受保護。</span><span class="sxs-lookup"><span data-stu-id="f308a-203">When you set up hello service, we set up a tenant-specific service bus relay that is protected by a randomly generated strong password that Microsoft never has access to.</span></span>
* <span data-ttu-id="f308a-204">**受到鎖定的密碼編譯強式密碼加密金鑰**</span><span class="sxs-lookup"><span data-stu-id="f308a-204">**Locked down, cryptographically strong, password encryption key**</span></span>
  * <span data-ttu-id="f308a-205">建立 hello service bus 轉送之後，我們會建立我們使用 tooencrypt hello 密碼就會自動收到 hello 線上強式對稱金鑰。</span><span class="sxs-lookup"><span data-stu-id="f308a-205">After hello service bus relay is created, we create a strong symmetric key we use tooencrypt hello password as it comes over hello wire.</span></span> <span data-ttu-id="f308a-206">此機碼只有位於您公司的密碼存放區在 hello 雲端中，這是大量鎖定且稽核，就像在 hello 目錄中的任何密碼。</span><span class="sxs-lookup"><span data-stu-id="f308a-206">This key lives only in your company's secret store in hello cloud, which is heavily locked down and audited, just like any password in hello directory.</span></span>
* <span data-ttu-id="f308a-207">**業界標準 TLS**</span><span class="sxs-lookup"><span data-stu-id="f308a-207">**Industry standard TLS**</span></span>
  1. <span data-ttu-id="f308a-208">當密碼重設或變更作業發生 hello 雲端中，我們對 hello 純文字密碼，並以您的公開金鑰加密它。</span><span class="sxs-lookup"><span data-stu-id="f308a-208">When a password reset or change operation occurs in hello cloud, we take hello plaintext password and encrypt it with your public key.</span></span>
  2. <span data-ttu-id="f308a-209">我們然後將之放在 HTTPS 訊息，透過使用 Microsoft 的 SSL 憑證 tooyour service bus 轉送加密通道傳送。</span><span class="sxs-lookup"><span data-stu-id="f308a-209">We then place that into an HTTPS message, which is sent over an encrypted channel using Microsoft’s SSL certs tooyour service bus relay.</span></span>
  3. <span data-ttu-id="f308a-210">Hello 訊息抵達服務匯流排，在內部部署代理程式喚醒時設定，並驗證之後 tooService 匯流排使用 hello 先前產生的強式密碼。</span><span class="sxs-lookup"><span data-stu-id="f308a-210">After hello message arrives into Service Bus, your on-premises agent wakes up and authenticates tooService Bus using hello strong password that was previously generated.</span></span>
  4. <span data-ttu-id="f308a-211">在內部部署代理程式收取 hello 加密訊息，它使用我們產生 hello 私密金鑰解密。</span><span class="sxs-lookup"><span data-stu-id="f308a-211">On-premises agent picks up hello encrypted message, decrypts it using hello private key we generated.</span></span>
  5. <span data-ttu-id="f308a-212">在內部部署代理程式接著會嘗試透過 AD DS SetPassword API hello tooset hello 密碼。</span><span class="sxs-lookup"><span data-stu-id="f308a-212">On-premises agent then attempts tooset hello password through hello AD DS SetPassword API.</span></span>
     * <span data-ttu-id="f308a-213">這個步驟可讓我們 tooenforce AD 內部部署密碼原則 （複雜性、 存在時間、 記錄、 篩選等） hello 雲端中。</span><span class="sxs-lookup"><span data-stu-id="f308a-213">This step is what allows us tooenforce your AD on-premises password policy (complexity, age, history, filters, etc.) in hello cloud.</span></span>
* <span data-ttu-id="f308a-214">**訊息到期原則**</span><span class="sxs-lookup"><span data-stu-id="f308a-214">**Message expiration policies**</span></span> 
  * <span data-ttu-id="f308a-215">如果 Service Bus 中的 hello 訊息位於，因為在內部部署服務已關閉，它會將階段逾時，並在幾分鐘的時間 tooincrease 安全性更進一步之後移除。</span><span class="sxs-lookup"><span data-stu-id="f308a-215">If hello message sits in Service Bus because your on-premises service is down, it will time out and be removed after several minutes tooincrease security even further.</span></span>

### <a name="password-writeback-encryption-details"></a><span data-ttu-id="f308a-216">密碼回寫的加密詳細資料</span><span class="sxs-lookup"><span data-stu-id="f308a-216">Password writeback encryption details</span></span>

<span data-ttu-id="f308a-217">使用者送出，才能到達您在內部部署環境、 tooensure 最大的服務的可靠性和安全性之後，密碼重設要求會經過 hello 加密步驟說明如下。</span><span class="sxs-lookup"><span data-stu-id="f308a-217">hello encryption steps a password reset request goes through after a user submits it, before it arrives in your on-premises environment, tooensure maximum service reliability and security are described below.</span></span>

* <span data-ttu-id="f308a-218">**步驟 1-使用 2048年位元 RSA 金鑰的密碼加密**-當使用者提交密碼 toobe 寫回 tooon 內部部署，第一個，hello 提交的密碼本身使用 2048年位元 RSA 金鑰加密。</span><span class="sxs-lookup"><span data-stu-id="f308a-218">**Step 1 - Password encryption with 2048-bit RSA Key** - Once a user submits a password toobe written back tooon-premises, first, hello submitted password itself is encrypted with a 2048-bit RSA key.</span></span>
* <span data-ttu-id="f308a-219">**步驟 2-封裝層級加密使用 AES GCM** -然後 hello 整個封裝 （密碼 + 必要的中繼資料） 會使用 AES GCM 進行加密。</span><span class="sxs-lookup"><span data-stu-id="f308a-219">**Step 2 - Package-level encryption with AES-GCM** - Then hello entire package (password + required metadata) is encrypted using AES-GCM.</span></span> <span data-ttu-id="f308a-220">這可防止任何人都直接存取 toohello 基礎 ServiceBus 通道檢視/竄改 hello 內容。</span><span class="sxs-lookup"><span data-stu-id="f308a-220">This prevents anyone with direct access toohello underlying ServiceBus channel from viewing/tampering with hello contents.</span></span>
* <span data-ttu-id="f308a-221">**步驟 3-所有通訊，就會都發生 5060，TLS / SSL** -所有與 ServiceBus hello 通訊會發生在 SSL/TLS 通道。</span><span class="sxs-lookup"><span data-stu-id="f308a-221">**Step 3 - All communication occurs over TLS / SSL** - All hello communication with ServiceBus happens in a SSL/TLS channel.</span></span> <span data-ttu-id="f308a-222">這可以保護 hello 內容來自未經授權的第 3 個合作對象。</span><span class="sxs-lookup"><span data-stu-id="f308a-222">This secures hello contents from unauthorized 3rd parties.</span></span>
* <span data-ttu-id="f308a-223">**自動金鑰變換每六個月**自動每 6 月或每次密碼回寫是停用 / 重新啟用 Azure AD Connect，我們變換所有這些金鑰 tooensure 最大的服務安全性和安全。</span><span class="sxs-lookup"><span data-stu-id="f308a-223">**Automatic key rollover every six months** - Automatically every 6 months, or every time password writeback is disabled / re-enabled on Azure AD Connect, we rollover all these keys tooensure maximum service security and safety.</span></span>

### <a name="password-writeback-bandwidth-usage"></a><span data-ttu-id="f308a-224">密碼回寫頻寬使用量</span><span class="sxs-lookup"><span data-stu-id="f308a-224">Password writeback bandwidth usage</span></span>

<span data-ttu-id="f308a-225">密碼回寫是一種低頻寬的服務，會傳送要求回 toohello 在內部部署代理程式只能在下列情況下的 hello:</span><span class="sxs-lookup"><span data-stu-id="f308a-225">Password writeback is a low-bandwidth service that sends requests back toohello on-premises agent only under hello following circumstances:</span></span>

1. <span data-ttu-id="f308a-226">兩個傳送的訊息時啟用或停用透過 Azure AD Connect 的 hello 功能。</span><span class="sxs-lookup"><span data-stu-id="f308a-226">Two messages sent when enabling or disabling hello feature through Azure AD Connect.</span></span>
2. <span data-ttu-id="f308a-227">一則訊息會傳送一次每隔五分鐘做為服務活動訊號，只要 hello 服務正在執行。</span><span class="sxs-lookup"><span data-stu-id="f308a-227">One message is sent once every five minutes as a service heartbeat for as long as hello service is running.</span></span>
3. <span data-ttu-id="f308a-228">每次提交新密碼時會傳送兩則訊息</span><span class="sxs-lookup"><span data-stu-id="f308a-228">Two messages are sent each time a new password is submitted</span></span>
    * <span data-ttu-id="f308a-229">第一則訊息，以要求 tooperform hello 作業</span><span class="sxs-lookup"><span data-stu-id="f308a-229">First message, as a request tooperform hello operation</span></span>
    * <span data-ttu-id="f308a-230">第二個訊息，其中包含 hello hello 作業結果，會傳送 hello 下列情況：</span><span class="sxs-lookup"><span data-stu-id="f308a-230">Second message, which contains hello result of hello operation and are sent in hello following circumstances:</span></span>
        * <span data-ttu-id="f308a-231">每次在使用者自助式密碼重設期間提交新密碼時。</span><span class="sxs-lookup"><span data-stu-id="f308a-231">Each time a new password is submitted during a user self-service password reset.</span></span>
        * <span data-ttu-id="f308a-232">每次在使用者密碼變更作業期間提交新密碼時。</span><span class="sxs-lookup"><span data-stu-id="f308a-232">Each time a new password is submitted during a user password change operation.</span></span>
        * <span data-ttu-id="f308a-233">每次在系統管理員起始使用者密碼重設 （從 hello Azure 管理員入口網站只） 期間，送出新密碼。</span><span class="sxs-lookup"><span data-stu-id="f308a-233">Each time a new password is submitted during an admin-initiated user password reset (from hello Azure admin portals only).</span></span>

#### <a name="message-size-and-bandwidth-considerations"></a><span data-ttu-id="f308a-234">訊息大小和頻寬考量</span><span class="sxs-lookup"><span data-stu-id="f308a-234">Message size and bandwidth considerations</span></span>

<span data-ttu-id="f308a-235">hello hello 訊息上面所述的每個的大小通常是在 1 kb，甚至在極端負載下，hello 密碼回寫服務本身會耗用幾秒千位元的頻寬。</span><span class="sxs-lookup"><span data-stu-id="f308a-235">hello size of each of hello message described above is typically under 1 kb, even under extreme loads, hello password writeback service itself is consuming a few kilobits per second of bandwidth.</span></span> <span data-ttu-id="f308a-236">因為每個訊息會傳送即時，所需的密碼更新作業時，才而且 hello 訊息大小很小，因為 hello 頻寬使用量 hello 回寫功能的有效地是太小 toohave 任何實數明顯的影響。</span><span class="sxs-lookup"><span data-stu-id="f308a-236">Since each message is sent in real time, only when required by a password update operation, and since hello message size is so small, hello bandwidth usage of hello writeback capability is effectively too small toohave any real measurable impact.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f308a-237">後續步驟</span><span class="sxs-lookup"><span data-stu-id="f308a-237">Next steps</span></span>

<span data-ttu-id="f308a-238">hello 下列連結提供有關密碼重設使用 Azure AD 的其他資訊</span><span class="sxs-lookup"><span data-stu-id="f308a-238">hello following links provide additional information regarding password reset using Azure AD</span></span>

* <span data-ttu-id="f308a-239">[**快速入門**](active-directory-passwords-getting-started.md) - 開始執行 Azure AD 自助式密碼管理</span><span class="sxs-lookup"><span data-stu-id="f308a-239">[**Quick Start**](active-directory-passwords-getting-started.md) - Get up and running with Azure AD self service password management</span></span> 
* <span data-ttu-id="f308a-240">[**授權**](active-directory-passwords-licensing.md) - 設定 Azure AD 授權</span><span class="sxs-lookup"><span data-stu-id="f308a-240">[**Licensing**](active-directory-passwords-licensing.md) - Configure your Azure AD Licensing</span></span>
* <span data-ttu-id="f308a-241">[**資料**](active-directory-passwords-data.md) -了解所需的 hello 資料及如何使用密碼管理</span><span class="sxs-lookup"><span data-stu-id="f308a-241">[**Data**](active-directory-passwords-data.md) - Understand hello data that is required and how it is used for password management</span></span>
* <span data-ttu-id="f308a-242">[**首度發行**](active-directory-passwords-best-practices.md) -計劃和部署 SSPR tooyour 使用者 hello 指引，請參閱</span><span class="sxs-lookup"><span data-stu-id="f308a-242">[**Rollout**](active-directory-passwords-best-practices.md) - Plan and deploy SSPR tooyour users using hello guidance found here</span></span>
* <span data-ttu-id="f308a-243">[**自訂**](active-directory-passwords-customize.md) -自訂的 hello SSPR 體驗您的公司 hello 外觀與風格。</span><span class="sxs-lookup"><span data-stu-id="f308a-243">[**Customize**](active-directory-passwords-customize.md) - Customize hello look and feel of hello SSPR experience for your company.</span></span>
* <span data-ttu-id="f308a-244">[**原則**](active-directory-passwords-policy.md) - 了解並設定 Azure AD 密碼原則</span><span class="sxs-lookup"><span data-stu-id="f308a-244">[**Policy**](active-directory-passwords-policy.md) - Understand and set Azure AD password policies</span></span>
* <span data-ttu-id="f308a-245">[**報告**](active-directory-passwords-reporting.md) - 探索您的使用者是否、何時、何地存取 SSPR 功能</span><span class="sxs-lookup"><span data-stu-id="f308a-245">[**Reporting**](active-directory-passwords-reporting.md) - Discover if, when, and where your users are accessing SSPR functionality</span></span>
* <span data-ttu-id="f308a-246">[**技術的深入探討**](active-directory-passwords-how-it-works.md) -hello 帘 toounderstand 後方移它的運作方式</span><span class="sxs-lookup"><span data-stu-id="f308a-246">[**Technical Deep Dive**](active-directory-passwords-how-it-works.md) - Go behind hello curtain toounderstand how it works</span></span>
* <span data-ttu-id="f308a-247">[**常見問題集**](active-directory-passwords-faq.md) - 如何？</span><span class="sxs-lookup"><span data-stu-id="f308a-247">[**Frequently Asked Questions**](active-directory-passwords-faq.md) - How?</span></span> <span data-ttu-id="f308a-248">原因為何？</span><span class="sxs-lookup"><span data-stu-id="f308a-248">Why?</span></span> <span data-ttu-id="f308a-249">何事？</span><span class="sxs-lookup"><span data-stu-id="f308a-249">What?</span></span> <span data-ttu-id="f308a-250">何地？</span><span class="sxs-lookup"><span data-stu-id="f308a-250">Where?</span></span> <span data-ttu-id="f308a-251">何人？</span><span class="sxs-lookup"><span data-stu-id="f308a-251">Who?</span></span> <span data-ttu-id="f308a-252">何時？</span><span class="sxs-lookup"><span data-stu-id="f308a-252">When?</span></span> <span data-ttu-id="f308a-253">-回答您總是想 tooask tooquestions</span><span class="sxs-lookup"><span data-stu-id="f308a-253">- Answers tooquestions you always wanted tooask</span></span>
* <span data-ttu-id="f308a-254">[**疑難排解**](active-directory-passwords-troubleshoot.md) -了解如何 tooresolve 常見問題，我們會看到與 SSPR</span><span class="sxs-lookup"><span data-stu-id="f308a-254">[**Troubleshoot**](active-directory-passwords-troubleshoot.md) - Learn how tooresolve common issues that we see with SSPR</span></span>

[Writeback]: ./media/active-directory-passwords-writeback/enablepasswordwriteback.png "在 Azure AD Connect 中啟用密碼回寫"
