---
title: "aaaSingle 登入應用程式 proxy |Microsoft 文件"
description: "涵蓋 tooprovide 的單一登入使用 Azure AD Application Proxy。"
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: ded0d9c9-45f6-47d7-bd0f-3f7fd99ab621
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/25/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: H1Hack27Feb2017, it-pro
ms.openlocfilehash: 0047e834cd42e057a75ebc0c5dcf860734464a05
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="kerberos-constrained-delegation-for-single-sign-on-tooyour-apps-with-application-proxy"></a><span data-ttu-id="4c883-103">Kerberos 限制委派針對單一登入 tooyour 應用程式與應用程式 Proxy</span><span class="sxs-lookup"><span data-stu-id="4c883-103">Kerberos Constrained Delegation for single sign-on tooyour apps with Application Proxy</span></span>

<span data-ttu-id="4c883-104">您可以針對透過應用程式 Proxy 發佈並使用整合式 Windows 驗證保護的內部部署應用程式，提供單一登入。</span><span class="sxs-lookup"><span data-stu-id="4c883-104">You can provide single sign-on for on-premises applications published through Application Proxy that are secured with Integrated Windows Authentication.</span></span> <span data-ttu-id="4c883-105">這些應用程式需要 Kerberos 票證以進行存取。</span><span class="sxs-lookup"><span data-stu-id="4c883-105">These applications require a Kerberos ticket for access.</span></span> <span data-ttu-id="4c883-106">應用程式 Proxy 會使用 Kerberos 限制委派 (KCD) toosupport 這些應用程式。</span><span class="sxs-lookup"><span data-stu-id="4c883-106">Application Proxy uses Kerberos Constrained Delegation (KCD) toosupport these applications.</span></span> 

<span data-ttu-id="4c883-107">您可以啟用單一登入 tooyour 應用程式使用整合式 Windows 驗證 (IWA) 在 Active Directory tooimpersonate 使用者，提供應用程式 Proxy 連接器權限。</span><span class="sxs-lookup"><span data-stu-id="4c883-107">You can enable single sign-on tooyour applications using Integrated Windows Authentication (IWA) by giving Application Proxy connectors permission in Active Directory tooimpersonate users.</span></span> <span data-ttu-id="4c883-108">hello 連接器會使用此權限 toosend，並接收代表語彙基元。</span><span class="sxs-lookup"><span data-stu-id="4c883-108">hello connectors use this permission toosend and receive tokens on their behalf.</span></span>

## <a name="how-single-sign-on-with-kcd-works"></a><span data-ttu-id="4c883-109">使用 KCD 單一登入的運作方式</span><span class="sxs-lookup"><span data-stu-id="4c883-109">How single sign-on with KCD works</span></span>
<span data-ttu-id="4c883-110">使用者嘗試 tooaccess 使用 IWA 的內部應用程式時，此圖表會說明 hello 流程。</span><span class="sxs-lookup"><span data-stu-id="4c883-110">This diagram explains hello flow when a user attempts tooaccess an on-prem application that uses IWA.</span></span>

![Microsoft AAD 驗證流程圖](./media/active-directory-application-proxy-sso-using-kcd/AuthDiagram.png)

1. <span data-ttu-id="4c883-112">hello 使用者輸入 hello URL tooaccess hello 內部應用程式透過應用程式 Proxy。</span><span class="sxs-lookup"><span data-stu-id="4c883-112">hello user enters hello URL tooaccess hello on-prem application through Application Proxy.</span></span>
2. <span data-ttu-id="4c883-113">應用程式 Proxy 會重新導向 hello 要求 tooAzure AD 驗證服務 toopreauthenticate。</span><span class="sxs-lookup"><span data-stu-id="4c883-113">Application Proxy redirects hello request tooAzure AD authentication services toopreauthenticate.</span></span> <span data-ttu-id="4c883-114">此時，Azure AD 會套用任何適用的驗證和授權原則，例如多重要素驗證。</span><span class="sxs-lookup"><span data-stu-id="4c883-114">At this point, Azure AD applies any applicable authentication and authorization policies, such as multifactor authentication.</span></span> <span data-ttu-id="4c883-115">如果 hello 使用者已經驗證，Azure AD 建立語彙基元，並將它傳送 toohello 使用者。</span><span class="sxs-lookup"><span data-stu-id="4c883-115">If hello user is validated, Azure AD creates a token and sends it toohello user.</span></span>
3. <span data-ttu-id="4c883-116">hello 使用者通過 hello 語彙基元 tooApplication Proxy。</span><span class="sxs-lookup"><span data-stu-id="4c883-116">hello user passes hello token tooApplication Proxy.</span></span>
4. <span data-ttu-id="4c883-117">應用程式 Proxy 驗證 hello 語彙基元，和擷取 hello 使用者主體名稱 (UPN)，並傳送 hello 要求、 hello UPN，然後 hello 透過經雙重驗證安全通道的服務主要名稱 (SPN) toohello 連接器。</span><span class="sxs-lookup"><span data-stu-id="4c883-117">Application Proxy validates hello token and retrieves hello User Principal Name (UPN) from it, and then sends hello request, hello UPN, and hello Service Principal Name (SPN) toohello Connector through a dually authenticated secure channel.</span></span>
5. <span data-ttu-id="4c883-118">hello 連接器執行與 hello 內部的 Kerberos 限制委派 (KCD) 交涉 AD，模擬 hello 使用者 tooget Kerberos 權杖 toohello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="4c883-118">hello Connector performs Kerberos Constrained Delegation (KCD) negotiation with hello on-prem AD, impersonating hello user tooget a Kerberos token toohello application.</span></span>
6. <span data-ttu-id="4c883-119">Active Directory 會傳送 hello 應用程式 toohello 連接器的 hello Kerberos 權杖。</span><span class="sxs-lookup"><span data-stu-id="4c883-119">Active Directory sends hello Kerberos token for hello application toohello Connector.</span></span>
7. <span data-ttu-id="4c883-120">hello 連接器會傳送 hello 原始要求 toohello 使用應用程式伺服器，它收到來自 AD hello Kerberos 權杖。</span><span class="sxs-lookup"><span data-stu-id="4c883-120">hello Connector sends hello original request toohello application server, using hello Kerberos token it received from AD.</span></span>
8. <span data-ttu-id="4c883-121">hello 應用程式會傳送 hello 回應 toohello 連接器，然後傳回 toohello 應用程式 Proxy 服務和最後 toohello 使用者。</span><span class="sxs-lookup"><span data-stu-id="4c883-121">hello application sends hello response toohello Connector, which is then returned toohello Application Proxy service and finally toohello user.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="4c883-122">必要條件</span><span class="sxs-lookup"><span data-stu-id="4c883-122">Prerequisites</span></span>
<span data-ttu-id="4c883-123">您開始使用單一登入 IWA 應用程式之前，請確定您的環境是否準備好以 hello 之後設定和設定：</span><span class="sxs-lookup"><span data-stu-id="4c883-123">Before you get started with single sign-on for IWA applications, make sure your environment is ready with hello following settings and configurations:</span></span>

* <span data-ttu-id="4c883-124">您的應用程式，例如 SharePoint Web 應用程式，設定 toouse 整合式 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="4c883-124">Your apps, like SharePoint Web apps, are set toouse Integrated Windows Authentication.</span></span> <span data-ttu-id="4c883-125">如需詳細資訊，請參閱[啟用支援 Kerberos 驗證](https://technet.microsoft.com/library/dd759186.aspx)，或者若是使用 SharePoint，請參閱[為 SharePoint 2013 中的 Kerberos 驗證做規劃](https://technet.microsoft.com/library/ee806870.aspx)。</span><span class="sxs-lookup"><span data-stu-id="4c883-125">For more information, see [Enable Support for Kerberos Authentication](https://technet.microsoft.com/library/dd759186.aspx), or for SharePoint see [Plan for Kerberos authentication in SharePoint 2013](https://technet.microsoft.com/library/ee806870.aspx).</span></span>
* <span data-ttu-id="4c883-126">您的所有應用程式都有[服務主體名稱](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx)。</span><span class="sxs-lookup"><span data-stu-id="4c883-126">All your apps have [Service Principal Names](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx).</span></span>
* <span data-ttu-id="4c883-127">hello 伺服器執行 hello 連接器和執行 hello 應用程式的 hello 伺服器是已加入網域且 hello 的相同網域或信任網域。</span><span class="sxs-lookup"><span data-stu-id="4c883-127">hello server running hello Connector and hello server running hello app are domain joined and part of hello same domain or trusting domains.</span></span> <span data-ttu-id="4c883-128">如需有關加入網域的詳細資訊，請參閱[加入網域的電腦 tooa](https://technet.microsoft.com/library/dd807102.aspx)。</span><span class="sxs-lookup"><span data-stu-id="4c883-128">For more information on domain join, see [Join a Computer tooa Domain](https://technet.microsoft.com/library/dd807102.aspx).</span></span>
* <span data-ttu-id="4c883-129">執行 hello 連接器 hello 伺服器具有使用者存取 tooread hello TokenGroupsGlobalAndUniversal 屬性。</span><span class="sxs-lookup"><span data-stu-id="4c883-129">hello server running hello Connector has access tooread hello TokenGroupsGlobalAndUniversal attribute for users.</span></span> <span data-ttu-id="4c883-130">此預設設定可能會影響安全性強化 hello 環境。</span><span class="sxs-lookup"><span data-stu-id="4c883-130">This default setting might have been impacted by security hardening hello environment.</span></span>

### <a name="configure-active-directory"></a><span data-ttu-id="4c883-131">設定 Active Directory</span><span class="sxs-lookup"><span data-stu-id="4c883-131">Configure Active Directory</span></span>
<span data-ttu-id="4c883-132">hello Active Directory 組態會有所不同，取決於您的應用程式 Proxy 連接器和 hello 應用程式伺服器是否在 hello 或不相同的網域。</span><span class="sxs-lookup"><span data-stu-id="4c883-132">hello Active Directory configuration varies, depending on whether your Application Proxy connector and hello application server are in hello same domain or not.</span></span>

#### <a name="connector-and-application-server-in-hello-same-domain"></a><span data-ttu-id="4c883-133">連接器和 hello 中的應用程式伺服器相同的網域</span><span class="sxs-lookup"><span data-stu-id="4c883-133">Connector and application server in hello same domain</span></span>
1. <span data-ttu-id="4c883-134">在 Active Directory 中，移過**工具** > **使用者和電腦**。</span><span class="sxs-lookup"><span data-stu-id="4c883-134">In Active Directory, go too**Tools** > **Users and Computers**.</span></span>
2. <span data-ttu-id="4c883-135">選取 hello 執行 hello 連接器的伺服器。</span><span class="sxs-lookup"><span data-stu-id="4c883-135">Select hello server running hello connector.</span></span>
3. <span data-ttu-id="4c883-136">按一下滑鼠右鍵，然後選取 [屬性] > [委派]。</span><span class="sxs-lookup"><span data-stu-id="4c883-136">Right-click and select **Properties** > **Delegation**.</span></span>
4. <span data-ttu-id="4c883-137">選取**信任這台電腦所委派 toospecified 服務只**。</span><span class="sxs-lookup"><span data-stu-id="4c883-137">Select **Trust this computer for delegation toospecified services only**.</span></span> 
5. <span data-ttu-id="4c883-138">在下**服務 toowhich 此帳戶可以呈送委派的認證**加入 hello hello hello 應用程式伺服器的 SPN 身分識別值。</span><span class="sxs-lookup"><span data-stu-id="4c883-138">Under **Services toowhich this account can present delegated credentials** add hello value for hello SPN identity of hello application server.</span></span> <span data-ttu-id="4c883-139">這可在 AD 中讓 hello 應用程式 Proxy 連接器 tooimpersonate 使用者對 hello hello 清單中所定義的應用程式。</span><span class="sxs-lookup"><span data-stu-id="4c883-139">This enables hello Application Proxy Connector tooimpersonate users in AD against hello applications defined in hello list.</span></span>

   ![[連接器 SVR 屬性] 視窗螢幕擷取畫面](./media/active-directory-application-proxy-sso-using-kcd/Properties.jpg)

#### <a name="connector-and-application-server-in-different-domains"></a><span data-ttu-id="4c883-141">連接器和應用程式伺服器位於不同網域</span><span class="sxs-lookup"><span data-stu-id="4c883-141">Connector and application server in different domains</span></span>
1. <span data-ttu-id="4c883-142">如需跨網域使用 KCD 的先決條件清單，請參閱 [跨網域的 Kerberos 限制委派](https://technet.microsoft.com/library/hh831477.aspx)。</span><span class="sxs-lookup"><span data-stu-id="4c883-142">For a list of prerequisites for working with KCD across domains, see [Kerberos Constrained Delegation across domains](https://technet.microsoft.com/library/hh831477.aspx).</span></span>
2. <span data-ttu-id="4c883-143">使用 hello `principalsallowedtodelegateto` hello 連接器伺服器 tooenable hello 應用程式 Proxy toodelegate hello 連接器的伺服器上的屬性。</span><span class="sxs-lookup"><span data-stu-id="4c883-143">Use hello `principalsallowedtodelegateto` property on hello Connector server tooenable hello Application Proxy toodelegate for hello Connector server.</span></span> <span data-ttu-id="4c883-144">hello 應用程式伺服器是`sharepointserviceaccount`而且委派伺服器 hello `connectormachineaccount`。</span><span class="sxs-lookup"><span data-stu-id="4c883-144">hello application server is `sharepointserviceaccount` and hello delegating server is `connectormachineaccount`.</span></span> <span data-ttu-id="4c883-145">在 Windows 2012 R2 中，以此程式碼作為範例：</span><span class="sxs-lookup"><span data-stu-id="4c883-145">For Windows 2012 R2, use this code as an example:</span></span>

        $connector= Get-ADComputer -Identity connectormachineaccount -server dc.connectordomain.com

        Set-ADComputer -Identity sharepointserviceaccount -PrincipalsAllowedToDelegateToAccount $connector

        Get-ADComputer sharepointserviceaccount -Properties PrincipalsAllowedToDelegateToAccount

<span data-ttu-id="4c883-146">Sharepointserviceaccount 可以 hello SPS 電腦帳戶或服務帳戶的 hello 預存程序下執行應用程式集區。</span><span class="sxs-lookup"><span data-stu-id="4c883-146">Sharepointserviceaccount can be hello SPS machine account or a service account under which hello SPS app pool is running.</span></span>

## <a name="configure-single-sign-on"></a><span data-ttu-id="4c883-147">設定單一登入</span><span class="sxs-lookup"><span data-stu-id="4c883-147">Configure single sign-on</span></span> 
1. <span data-ttu-id="4c883-148">將根據 toohello 指示中所述的應用程式發行[發行應用程式 Proxy](application-proxy-publish-azure-portal.md)。</span><span class="sxs-lookup"><span data-stu-id="4c883-148">Publish your application according toohello instructions described in [Publish applications with Application Proxy](application-proxy-publish-azure-portal.md).</span></span> <span data-ttu-id="4c883-149">請確定 tooselect **Azure Active Directory**為 hello**預先驗證方法**。</span><span class="sxs-lookup"><span data-stu-id="4c883-149">Make sure tooselect **Azure Active Directory** as hello **Preauthentication Method**.</span></span>
2. <span data-ttu-id="4c883-150">Hello 企業應用程式清單中出現您的應用程式之後，請選取它，然後按一下**單一登入**。</span><span class="sxs-lookup"><span data-stu-id="4c883-150">After your application appears in hello list of enterprise applications, select it and click **Single sign-on**.</span></span>
3. <span data-ttu-id="4c883-151">Hello 單一登入模式設定太**整合式 Windows 驗證**。</span><span class="sxs-lookup"><span data-stu-id="4c883-151">Set hello single sign-on mode too**Integrated Windows Authentication**.</span></span>  
4. <span data-ttu-id="4c883-152">輸入 hello**內部應用程式 SPN** hello 應用程式伺服器。</span><span class="sxs-lookup"><span data-stu-id="4c883-152">Enter hello **Internal Application SPN** of hello application server.</span></span> <span data-ttu-id="4c883-153">在此範例中，我們已發行的應用程式的 hello SPN 是 http/www.contoso.com。此服務 toowhich hello 連接器 hello 清單中的 SPN 需求 toobe 可以呈送委派的認證。</span><span class="sxs-lookup"><span data-stu-id="4c883-153">In this example, hello SPN for our published application is http/www.contoso.com. This SPN needs toobe in hello list of services toowhich hello connector can present delegated credentials.</span></span> 
5. <span data-ttu-id="4c883-154">選擇 hello**委派登入身分識別**的 hello 連接器 toouse 代表您的使用者。</span><span class="sxs-lookup"><span data-stu-id="4c883-154">Choose hello **Delegated Login Identity** for hello connector toouse on behalf of your users.</span></span> <span data-ttu-id="4c883-155">如需詳細資訊，請參閱[使用不同的內部部署和雲端身分識別](#Working-with-different-on-premises-and-cloud-identities)</span><span class="sxs-lookup"><span data-stu-id="4c883-155">For more information, see [Working with different on-premises and cloud identities](#Working-with-different-on-premises-and-cloud-identities)</span></span>

   ![進階應用程式組態](./media/active-directory-application-proxy-sso-using-kcd/cwap_auth2.png)  


## <a name="sso-for-non-windows-apps"></a><span data-ttu-id="4c883-157">非 Windows 應用程式的 SSO</span><span class="sxs-lookup"><span data-stu-id="4c883-157">SSO for non-Windows apps</span></span>
<span data-ttu-id="4c883-158">Azure AD 會驗證 hello 雲端中的 hello 使用者時，就會啟動 hello Kerberos 委派流程在 Azure AD Application Proxy。</span><span class="sxs-lookup"><span data-stu-id="4c883-158">hello Kerberos delegation flow in Azure AD Application Proxy starts when Azure AD authenticates hello user in hello cloud.</span></span> <span data-ttu-id="4c883-159">一旦 hello 要求抵達在內部部署，Azure AD 應用程式 Proxy 連接器發出 Kerberos 票證代表 hello 使用者互動的 hello hello 本機 Active Directory。</span><span class="sxs-lookup"><span data-stu-id="4c883-159">Once hello request arrives on-premises, hello Azure AD Application Proxy connector issues a Kerberos ticket on behalf of hello user by interacting with hello local Active Directory.</span></span> <span data-ttu-id="4c883-160">此程序是參照的 tooas Kerberos 限制委派 (KCD)。</span><span class="sxs-lookup"><span data-stu-id="4c883-160">This process is referred tooas Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="4c883-161">Hello 中下一個階段中，會將要求傳送 toohello 後端應用程式與這個 Kerberos 票證。</span><span class="sxs-lookup"><span data-stu-id="4c883-161">In hello next phase, a request is sent toohello backend application with this Kerberos ticket.</span></span> <span data-ttu-id="4c883-162">有數個定義如何 toosend 這類要求的通訊協定。</span><span class="sxs-lookup"><span data-stu-id="4c883-162">There are several protocols that define how toosend such requests.</span></span> <span data-ttu-id="4c883-163">大部分的非 Windows 伺服器會預期 Azure AD 應用程式 Proxy 現在支援的交涉/SPNego。</span><span class="sxs-lookup"><span data-stu-id="4c883-163">Most non-Windows servers expect Negotiate/SPNego that is now supported on Azure AD Application Proxy.</span></span>

<span data-ttu-id="4c883-164">如需有關 Kerberos 的詳細資訊，請參閱[所有您想要關於 Kerberos 限制委派 (KCD) tooknow](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd)。</span><span class="sxs-lookup"><span data-stu-id="4c883-164">For more information about Kerberos, see [All you want tooknow about Kerberos Constrained Delegation (KCD)](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd).</span></span>

<span data-ttu-id="4c883-165">非 Windows 應用程式通常會使用使用者名稱或 SAM 帳戶名稱，而不是網域的電子郵件地址。</span><span class="sxs-lookup"><span data-stu-id="4c883-165">Non-Windows apps typically user usernames or SAM account names instead of domain email addresses.</span></span> <span data-ttu-id="4c883-166">如果這種情況下套用 tooyour 應用程式，您需要 tooconfigure 委派 hello 登入身分識別欄位 tooconnect 雲端身分識別 tooyour 應用程式識別。</span><span class="sxs-lookup"><span data-stu-id="4c883-166">If that situation applies tooyour applications, you need tooconfigure hello delegated login identity field tooconnect your cloud identities tooyour application identities.</span></span> 

## <a name="working-with-different-on-premises-and-cloud-identities"></a><span data-ttu-id="4c883-167">使用不同的內部部署和雲端身分識別</span><span class="sxs-lookup"><span data-stu-id="4c883-167">Working with different on-premises and cloud identities</span></span>
<span data-ttu-id="4c883-168">應用程式 Proxy 會假設使用者是否具有剛好 hello hello 雲端和內部部署中的相同身分識別。</span><span class="sxs-lookup"><span data-stu-id="4c883-168">Application Proxy assumes that users have exactly hello same identity in hello cloud and on-premises.</span></span> <span data-ttu-id="4c883-169">如果不是 hello 情況下，您可以仍然可以使用 KCD 的單一登入。</span><span class="sxs-lookup"><span data-stu-id="4c883-169">If that's not hello case, you can can still use KCD for single sign-on.</span></span> <span data-ttu-id="4c883-170">設定**委派登入身分識別**的單一登入執行時，應該使用哪些身分識別的每個應用程式 toospecify。</span><span class="sxs-lookup"><span data-stu-id="4c883-170">Configure a **Delegated login identity** for each application toospecify which identity should be used when performing single sign-on.</span></span>  

<span data-ttu-id="4c883-171">這項功能可讓許多組織可以有不同的內部部署和雲端識別 toohave SSO 從 hello 雲端 tooon 內部部署應用程式而不需要 hello 使用者 tooenter 不同使用者名稱和密碼。</span><span class="sxs-lookup"><span data-stu-id="4c883-171">This capability allows many organizations that have different on-premises and cloud identities toohave SSO from hello cloud tooon-premises apps without requiring hello users tooenter different usernames and passwords.</span></span> <span data-ttu-id="4c883-172">這包括下列組織：</span><span class="sxs-lookup"><span data-stu-id="4c883-172">This includes organizations that:</span></span>

* <span data-ttu-id="4c883-173">就內部而言有多個網域 (joe@us.contoso.com， joe@eu.contoso.com) hello 雲端中的單一定義域 (joe@contoso.com)。</span><span class="sxs-lookup"><span data-stu-id="4c883-173">Have multiple domains internally (joe@us.contoso.com, joe@eu.contoso.com) and a single domain in hello cloud (joe@contoso.com).</span></span>
* <span data-ttu-id="4c883-174">在內部有路由的內部網域名稱 (joe@contoso.usa) 和一個法律 hello 雲端中的。</span><span class="sxs-lookup"><span data-stu-id="4c883-174">Have non-routable domain name internally (joe@contoso.usa) and a legal one in hello cloud.</span></span>
* <span data-ttu-id="4c883-175">請勿在內部使用網域名稱 (joe)</span><span class="sxs-lookup"><span data-stu-id="4c883-175">Do not use domain names internally (joe)</span></span>
* <span data-ttu-id="4c883-176">使用不同別名由內部部署和 hello 雲端中。</span><span class="sxs-lookup"><span data-stu-id="4c883-176">Use different aliases on-prem and in hello cloud.</span></span> <span data-ttu-id="4c883-177">例如：joe-johns@contoso.com 對上 joej@contoso.com</span><span class="sxs-lookup"><span data-stu-id="4c883-177">For example, joe-johns@contoso.com vs. joej@contoso.com</span></span>  

<span data-ttu-id="4c883-178">應用程式 proxy，您可以選取的身分識別 toouse tooobtain hello Kerberos 票證。</span><span class="sxs-lookup"><span data-stu-id="4c883-178">With Application Proxy, you can select which identity toouse tooobtain hello Kerberos ticket.</span></span> <span data-ttu-id="4c883-179">這項設定會因應用程式而異。</span><span class="sxs-lookup"><span data-stu-id="4c883-179">This setting is per application.</span></span> <span data-ttu-id="4c883-180">其中的一些選項適合不接受電子郵件地址格式的系統，另外的選項則設計用於替代登入。</span><span class="sxs-lookup"><span data-stu-id="4c883-180">Some of these options are suitable for systems that do not accept email address format, others are designed for alternative login.</span></span>

![[委派的登入身分識別] 參數螢幕擷取畫面](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_upn.png)

<span data-ttu-id="4c883-182">如果使用委派的登入身分識別，則 hello 值可能不是唯一跨所有 hello 網域或組織中的樹系。</span><span class="sxs-lookup"><span data-stu-id="4c883-182">If delegated login identity is used, hello value might not be unique across all hello domains or forests in your organization.</span></span> <span data-ttu-id="4c883-183">您可以藉由使用兩個不同的連接器群組發佈這些應用程式兩次來避免此問題。</span><span class="sxs-lookup"><span data-stu-id="4c883-183">You can avoid this issue by publishing these applications twice using two different Connector groups.</span></span> <span data-ttu-id="4c883-184">因為每個應用程式都有不同的使用者對象，您可以加入其連接器 tooa 不同的網域。</span><span class="sxs-lookup"><span data-stu-id="4c883-184">Since each application has a different user audience, you can join its Connectors tooa different domain.</span></span>

### <a name="configure-sso-for-different-identities"></a><span data-ttu-id="4c883-185">設定不同身分識別的 SSO</span><span class="sxs-lookup"><span data-stu-id="4c883-185">Configure SSO for different identities</span></span>
1. <span data-ttu-id="4c883-186">設定 Azure AD Connect 的設定，讓 hello 主要識別是 hello 電子郵件地址 （郵件）。</span><span class="sxs-lookup"><span data-stu-id="4c883-186">Configure Azure AD Connect settings so hello main identity is hello email address (mail).</span></span> <span data-ttu-id="4c883-187">這是屬於 hello 自訂程序，藉由變更 hello**使用者主體名稱**hello 同步處理設定中的欄位。</span><span class="sxs-lookup"><span data-stu-id="4c883-187">This is done as part of hello customize process, by changing hello **User Principal Name** field in hello sync settings.</span></span> <span data-ttu-id="4c883-188">這些設定也會決定使用者如何登入 tooOffice365、 Windows10 裝置，以及其他 Azure AD 做為其身分識別存放區的應用程式。</span><span class="sxs-lookup"><span data-stu-id="4c883-188">These settings also determine how users log in tooOffice365, Windows10 devices, and other applications that use Azure AD as their identity store.</span></span>  
   <span data-ttu-id="4c883-189">![識別使用者螢幕擷取畫面 - [使用者主體名稱] 下拉式清單](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span><span class="sxs-lookup"><span data-stu-id="4c883-189">![Identifying users screenshot - User Principal Name dropdown](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span></span>  
2. <span data-ttu-id="4c883-190">在 hello hello 應用程式的應用程式組態設定您想要 toomodify，選取 hello**委派登入身分識別**toobe 使用：</span><span class="sxs-lookup"><span data-stu-id="4c883-190">In hello Application Configuration settings for hello application you would like toomodify, select hello **Delegated Login Identity** toobe used:</span></span>

   * <span data-ttu-id="4c883-191">使用者主體名稱 (例如 joe@contoso.com)</span><span class="sxs-lookup"><span data-stu-id="4c883-191">User Principal Name (for example, joe@contoso.com)</span></span>
   * <span data-ttu-id="4c883-192">替代使用者主體名稱 (例如 joed@contoso.local)</span><span class="sxs-lookup"><span data-stu-id="4c883-192">Alternate User Principal Name (for example, joed@contoso.local)</span></span>
   * <span data-ttu-id="4c883-193">使用者主體名稱的使用者名稱部分 (例如 joe)</span><span class="sxs-lookup"><span data-stu-id="4c883-193">Username part of User Principal Name (for example, joe)</span></span>
   * <span data-ttu-id="4c883-194">替代使用者主體名稱的使用者名稱部分 (例如 joed)</span><span class="sxs-lookup"><span data-stu-id="4c883-194">Username part of Alternate User Principal Name (for example, joed)</span></span>
   * <span data-ttu-id="4c883-195">在內部部署 SAM 帳戶名稱 （取決於 hello 網域控制站設定）</span><span class="sxs-lookup"><span data-stu-id="4c883-195">On-premises SAM account name (depends on hello domain controller configuration)</span></span>

### <a name="troubleshooting-sso-for-different-identities"></a><span data-ttu-id="4c883-196">疑難排解不同身分識別的 SSO</span><span class="sxs-lookup"><span data-stu-id="4c883-196">Troubleshooting SSO for different identities</span></span>
<span data-ttu-id="4c883-197">如果 hello SSO 程序中有錯誤，則會出現在 hello 連接器電腦事件記錄檔中所述[疑難排解](application-proxy-back-end-kerberos-constrained-delegation-how-to.md)。</span><span class="sxs-lookup"><span data-stu-id="4c883-197">If there is an error in hello SSO process, it appears in hello connector machine event log as explained in [Troubleshooting](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).</span></span>
<span data-ttu-id="4c883-198">但是，在某些情況下，hello 要求成功傳送 toohello 後端應用程式時，此應用程式回覆中的各種其他 HTTP 回應。</span><span class="sxs-lookup"><span data-stu-id="4c883-198">But, in some cases, hello request is successfully sent toohello backend application while this application replies in various other HTTP responses.</span></span> <span data-ttu-id="4c883-199">疑難排解這些情況下，應該藉由檢查事件編號 24029 hello 應用程式 Proxy 的工作階段事件記錄檔中的 hello 連接器電腦上啟動。</span><span class="sxs-lookup"><span data-stu-id="4c883-199">Troubleshooting these cases should start by examining event number 24029 on hello connector machine in hello Application Proxy session event log.</span></span> <span data-ttu-id="4c883-200">hello 用於委派的使用者識別會出現在 hello hello 事件詳細資料中的 「 使用者 」 欄位。</span><span class="sxs-lookup"><span data-stu-id="4c883-200">hello user identity that was used for delegation appears in hello “user” field within hello event details.</span></span> <span data-ttu-id="4c883-201">對工作階段記錄 tooturn 選取**顯示分析與偵錯記錄檔**hello 事件檢視器檢視 功能表中。</span><span class="sxs-lookup"><span data-stu-id="4c883-201">tooturn on session log, select **Show analytic and debug logs** in hello event viewer view menu.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4c883-202">後續步驟</span><span class="sxs-lookup"><span data-stu-id="4c883-202">Next steps</span></span>

* [<span data-ttu-id="4c883-203">如何 tooconfigure 應用程式 Proxy 應用程式 toouse Kerberos 限制委派</span><span class="sxs-lookup"><span data-stu-id="4c883-203">How tooconfigure an Application Proxy application toouse Kerberos Constrained Delegation</span></span>](application-proxy-back-end-kerberos-constrained-delegation-how-to.md)
* [<span data-ttu-id="4c883-204">使用應用程式 Proxy 疑難排解您遇到的問題</span><span class="sxs-lookup"><span data-stu-id="4c883-204">Troubleshoot issues you're having with Application Proxy</span></span>](active-directory-application-proxy-troubleshoot.md)


<span data-ttu-id="4c883-205">如 hello 最新消息和更新，請參閱 hello[應用程式 Proxy 部落格](http://blogs.technet.com/b/applicationproxyblog/)</span><span class="sxs-lookup"><span data-stu-id="4c883-205">For hello latest news and updates, check out hello [Application Proxy blog](http://blogs.technet.com/b/applicationproxyblog/)</span></span>

