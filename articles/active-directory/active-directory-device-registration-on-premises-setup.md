---
title: "使用 Azure Active Directory 裝置註冊來設定內部部署條件式存取 | Microsoft Docs"
description: "在 Windows Server 2012 R2 中使用 Active Directory Federation Services (AD FS) 來啟用對內部部署應用程式之條件式存取的逐步指南。"
services: active-directory
documentationcenter: 
author: MarkusVi
manager: femila
editor: 
ms.assetid: 6ae9df8b-31fe-4d72-9181-cf50cfebbf05
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/31/2017
ms.author: markvi
ms.reviewer: jairoc
ms.openlocfilehash: 1a6f1c6566468188daa71939db8345280b7a529f
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/03/2017
---
# <a name="setting-up-on-premises-conditional-access-by-using-azure-active-directory-device-registration"></a><span data-ttu-id="6e011-103">使用 Azure Active Directory 裝置註冊來設定內部部署條件式存取</span><span class="sxs-lookup"><span data-stu-id="6e011-103">Setting up on-premises conditional access by using Azure Active Directory device registration</span></span>
<span data-ttu-id="6e011-104">當您要求使用者在工作場所將其個人裝置加入至 Azure Active Directory (Azure AD) 裝置註冊服務時，他們的裝置便可標示為組織已知的裝置。</span><span class="sxs-lookup"><span data-stu-id="6e011-104">When you require users to workplace-join their personal devices to the Azure Active Directory (Azure AD) device registration service, their devices can be marked as known to your organization.</span></span> <span data-ttu-id="6e011-105">以下是一個逐步指南，說明如何在 Windows Server 2012 R2 中使用 Active Directory Federation Services (AD FS)，來啟用對內部部署應用程式的條件式存取。</span><span class="sxs-lookup"><span data-stu-id="6e011-105">Following is a step-by-step guide for enabling conditional access to on-premises applications by using Active Directory Federation Services (AD FS) in Windows Server 2012 R2.</span></span>

> [!NOTE]
> <span data-ttu-id="6e011-106">使用在 Azure Active Directory 裝置註冊服務條件式存取原則中註冊的裝置時，需要有 Office 365 授權或 Azure AD Premium 授權。</span><span class="sxs-lookup"><span data-stu-id="6e011-106">An Office 365 license or Azure AD Premium license is required when using devices that are registered in Azure Active Directory device registration service conditional access policies.</span></span> <span data-ttu-id="6e011-107">這些包括內部部署資源中的 AD FS 所強制執行的原則。</span><span class="sxs-lookup"><span data-stu-id="6e011-107">These include policies that are enforced by AD FS in on-premises resources.</span></span>
> 
> <span data-ttu-id="6e011-108">如需有關內部部署之條件式存取案例的詳細資訊，請參閱 [從任何裝置加入工作場所網路，以在所有公司應用程式進行 SSO 和無縫銜接的第二要素驗證](https://technet.microsoft.com/library/dn280945.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6e011-108">For more information about the conditional access scenarios for on-premises resources, see [Join to workplace from any device for SSO and seamless second-factor authentication across company applications](https://technet.microsoft.com/library/dn280945.aspx).</span></span>

<span data-ttu-id="6e011-109">凡是購買 Azure Active Directory Premium 授權的客戶皆可使用這些功能。</span><span class="sxs-lookup"><span data-stu-id="6e011-109">These capabilities are available to customers who purchase an Azure Active Directory Premium license.</span></span>

## <a name="supported-devices"></a><span data-ttu-id="6e011-110">支援的裝置</span><span class="sxs-lookup"><span data-stu-id="6e011-110">Supported devices</span></span>
* <span data-ttu-id="6e011-111">已加入網域的 Windows 7 裝置</span><span class="sxs-lookup"><span data-stu-id="6e011-111">Windows 7 domain-joined devices</span></span>
* <span data-ttu-id="6e011-112">個人和已加入網域的 Windows 8.1 裝置</span><span class="sxs-lookup"><span data-stu-id="6e011-112">Windows 8.1 personal and domain-joined devices</span></span>
* <span data-ttu-id="6e011-113">iOS 6 和更新版本 (適用於 Safari 瀏覽器)</span><span class="sxs-lookup"><span data-stu-id="6e011-113">iOS 6 and later for the Safari browser</span></span>
* <span data-ttu-id="6e011-114">Android 4.0 或更新版本、Samsung GS3 或更新的手機、Samsung Note 2 或更新的平板電腦</span><span class="sxs-lookup"><span data-stu-id="6e011-114">Android 4.0 or later, Samsung GS3 or later phones, Samsung Galaxy Note 2 or later tablets</span></span>

## <a name="scenario-prerequisites"></a><span data-ttu-id="6e011-115">案例必要條件</span><span class="sxs-lookup"><span data-stu-id="6e011-115">Scenario prerequisites</span></span>
* <span data-ttu-id="6e011-116">Office 365 或 Azure Active Directory Premium 的訂用帳戶</span><span class="sxs-lookup"><span data-stu-id="6e011-116">Subscription to Office 365 or Azure Active Directory Premium</span></span>
* <span data-ttu-id="6e011-117">Azure Active Directory 租用戶</span><span class="sxs-lookup"><span data-stu-id="6e011-117">An Azure Active Directory tenant</span></span>
* <span data-ttu-id="6e011-118">Windows Server Active Directory (Windows Server 2008 或更新版本)</span><span class="sxs-lookup"><span data-stu-id="6e011-118">Windows Server Active Directory (Windows Server 2008 or later)</span></span>
* <span data-ttu-id="6e011-119">Windows Server 2012 R2 中更新的結構描述</span><span class="sxs-lookup"><span data-stu-id="6e011-119">Updated schema in Windows Server 2012 R2</span></span>
* <span data-ttu-id="6e011-120">Azure Active Directory Premium 的授權</span><span class="sxs-lookup"><span data-stu-id="6e011-120">License for Azure Active Directory Premium</span></span>
* <span data-ttu-id="6e011-121">Windows Server 2012 R2 Federation Services，針對 Azure AD 的 SSO 設定</span><span class="sxs-lookup"><span data-stu-id="6e011-121">Windows Server 2012 R2 Federation Services, configured for SSO to Azure AD</span></span>
* <span data-ttu-id="6e011-122">Windows Server 2012 R2 Web 應用程式 Proxy</span><span class="sxs-lookup"><span data-stu-id="6e011-122">Windows Server 2012 R2 Web Application Proxy</span></span> 
* <span data-ttu-id="6e011-123">Microsoft Azure Active Directory Connect (Azure AD Connect) [(下載 Azure AD Connect)](http://www.microsoft.com/en-us/download/details.aspx?id=47594)</span><span class="sxs-lookup"><span data-stu-id="6e011-123">Microsoft Azure Active Directory Connect (Azure AD Connect) [(Download Azure AD Connect)](http://www.microsoft.com/en-us/download/details.aspx?id=47594)</span></span>
* <span data-ttu-id="6e011-124">已驗證的網域</span><span class="sxs-lookup"><span data-stu-id="6e011-124">Verified domain</span></span>

## <a name="known-issues-in-this-release"></a><span data-ttu-id="6e011-125">此版本已知的問題</span><span class="sxs-lookup"><span data-stu-id="6e011-125">Known issues in this release</span></span>
* <span data-ttu-id="6e011-126">裝置型條件式存取原則會要求將裝置物件從 Azure Active Directory 寫回至 Active Directory。</span><span class="sxs-lookup"><span data-stu-id="6e011-126">Device-based conditional access policies require device object writeback to Active Directory from Azure Active Directory.</span></span> <span data-ttu-id="6e011-127">將裝置物件寫回至 Active Directory 可能需要長達三小時的時間。</span><span class="sxs-lookup"><span data-stu-id="6e011-127">It can take up to three hours for device objects to be written back to Active Directory.</span></span>
* <span data-ttu-id="6e011-128">進行用戶端憑證驗證時，iOS 7 裝置一律會提示使用者選取憑證。</span><span class="sxs-lookup"><span data-stu-id="6e011-128">iOS 7 devices  always prompt the user to select a certificate during client certificate authentication.</span></span>
* <span data-ttu-id="6e011-129">iOS 8.3 之前的某些 iOS 8 版本無法運作。</span><span class="sxs-lookup"><span data-stu-id="6e011-129">Some versions of iOS 8 before iOS 8.3 do not work.</span></span>

## <a name="scenario-assumptions"></a><span data-ttu-id="6e011-130">案例假設</span><span class="sxs-lookup"><span data-stu-id="6e011-130">Scenario assumptions</span></span>
<span data-ttu-id="6e011-131">此案例假設您有一個由 Azure AD 租用戶與內部部署 Active Directory 所組成的混合式環境。</span><span class="sxs-lookup"><span data-stu-id="6e011-131">This scenario assumes that you have a hybrid environment consisting of an Azure AD tenant and an on-premises Active Directory.</span></span> <span data-ttu-id="6e011-132">這些租用戶應該以 Azure AD Connect 連接、具有已驗證的網域，以及具有用來進行 SSO 的 AD FS。</span><span class="sxs-lookup"><span data-stu-id="6e011-132">These tenants should be connected with Azure AD Connect, with a verified domain, and with AD FS for SSO.</span></span> <span data-ttu-id="6e011-133">請使用下列檢查清單來協助您根據需求設定環境。</span><span class="sxs-lookup"><span data-stu-id="6e011-133">Use the following checklist to help you configure your environment according to the requirements.</span></span>

## <a name="checklist-prerequisites-for-conditional-access-scenario"></a><span data-ttu-id="6e011-134">檢查清單︰條件式存取案例的必要條件</span><span class="sxs-lookup"><span data-stu-id="6e011-134">Checklist: Prerequisites for conditional access scenario</span></span>
<span data-ttu-id="6e011-135">將 Azure AD 租用戶與內部部署 Active Directory 執行個體連接。</span><span class="sxs-lookup"><span data-stu-id="6e011-135">Connect your Azure AD tenant with your on-premises Active Directory instance.</span></span>

## <a name="configure-azure-active-directory-device-registration-service"></a><span data-ttu-id="6e011-136">設定 Azure Active Directory 裝置註冊服務</span><span class="sxs-lookup"><span data-stu-id="6e011-136">Configure Azure Active Directory device registration service</span></span>
<span data-ttu-id="6e011-137">使用本指南來為您的組織部署及設定 Azure Active Directory 裝置註冊服務。</span><span class="sxs-lookup"><span data-stu-id="6e011-137">Use this guide to deploy and configure the Azure Active Directory device registration service for your organization.</span></span>

<span data-ttu-id="6e011-138">本指南假設您已設定 Windows Server Active Directory 並已訂閱 Microsoft Azure Active Directory。</span><span class="sxs-lookup"><span data-stu-id="6e011-138">This guide assumes that you've configured Windows Server Active Directory and have subscribed to Microsoft Azure Active Directory.</span></span> <span data-ttu-id="6e011-139">請參閱稍早所述的必要條件。</span><span class="sxs-lookup"><span data-stu-id="6e011-139">See the prerequisites described earlier.</span></span>

<span data-ttu-id="6e011-140">若要使用您的 Azure Active Directory 租用戶來部署 Azure Active Directory 裝置註冊服務，請依序完成下列檢查清單中的工作。</span><span class="sxs-lookup"><span data-stu-id="6e011-140">To deploy the Azure Active Directory device registration service with your Azure Active Directory tenant, complete the tasks in the following checklist in order.</span></span> <span data-ttu-id="6e011-141">當參考連結將您導向概念性主題時，請在之後返回此檢查清單，以便繼續執行剩餘的工作。</span><span class="sxs-lookup"><span data-stu-id="6e011-141">When a reference link takes you to a conceptual topic, return to this checklist afterward, so that you can proceed with the remaining tasks.</span></span> <span data-ttu-id="6e011-142">有些工作包含案例驗證步驟，可協助您確認是否已成功完成該步驟。</span><span class="sxs-lookup"><span data-stu-id="6e011-142">Some tasks include a scenario validation step that can help you confirm whether the step was completed successfully.</span></span>

## <a name="part-1-enable-azure-active-directory-device-registration"></a><span data-ttu-id="6e011-143">第 1 部分：啟用 Azure Active Directory 裝置註冊</span><span class="sxs-lookup"><span data-stu-id="6e011-143">Part 1: Enable Azure Active Directory device registration</span></span>
<span data-ttu-id="6e011-144">請依照檢查清單中的步驟來啟用及設定 Azure Active Directory 裝置註冊服務。</span><span class="sxs-lookup"><span data-stu-id="6e011-144">Follow the steps in the checklist to enable and configure the Azure Active Directory device registration service.</span></span>

| <span data-ttu-id="6e011-145">工作</span><span class="sxs-lookup"><span data-stu-id="6e011-145">Task</span></span> | <span data-ttu-id="6e011-146">參考</span><span class="sxs-lookup"><span data-stu-id="6e011-146">Reference</span></span> | 
| --- | --- |
| <span data-ttu-id="6e011-147">在 Azure Active Directory 租用戶中啟用裝置註冊，以允許裝置加入工作場所。</span><span class="sxs-lookup"><span data-stu-id="6e011-147">Enable device registration in your Azure Active Directory tenant to allow devices to join the workplace.</span></span> <span data-ttu-id="6e011-148">預設不會為服務啟用 Azure Multi-Factor Authentication。</span><span class="sxs-lookup"><span data-stu-id="6e011-148">By default, Azure Multi-Factor Authentication is not enabled for the service.</span></span> <span data-ttu-id="6e011-149">不過，建議您在註冊裝置時使用 Multi-Factor Authentication。</span><span class="sxs-lookup"><span data-stu-id="6e011-149">However, we recommend that you use Multi-Factor Authentication when you register a device.</span></span> <span data-ttu-id="6e011-150">在 Active Directory 註冊服務中啟用 Multi-Factor Authentication 之前，請確定已為 Multi-Factor Authentication 提供者設定 AD FS。</span><span class="sxs-lookup"><span data-stu-id="6e011-150">Before enabling Multi-Factor Authentication in Active Directory registration service, ensure that AD FS is configured for a Multi-Factor Authentication  provider.</span></span> |[<span data-ttu-id="6e011-151">啟用 Azure Active Directory 裝置註冊</span><span class="sxs-lookup"><span data-stu-id="6e011-151">Enable Azure Active Directory device registration</span></span>](active-directory-device-registration-get-started.md)| 
|<span data-ttu-id="6e011-152">裝置透過尋找已知的 DNS 記錄來探索您的 Azure Active Directory 裝置註冊服務。</span><span class="sxs-lookup"><span data-stu-id="6e011-152">Devices discover your Azure Active Directory device registration service by looking for well-known DNS records.</span></span> <span data-ttu-id="6e011-153">請設定您的公司 DNS，以便讓裝置探索您的 Azure Active Directory 裝置註冊服務。</span><span class="sxs-lookup"><span data-stu-id="6e011-153">Configure your company DNS so that devices can discover your Azure Active Directory device registration service.</span></span> |[<span data-ttu-id="6e011-154">設定 Azure Active Directory 裝置註冊探索</span><span class="sxs-lookup"><span data-stu-id="6e011-154">Configure Azure Active Directory device registration discovery</span></span>](active-directory-device-registration-get-started.md)| 


## <a name="part-2-deploy-and-configure-windows-server-2012-r2-active-directory-federation-services-and-set-up-a-federation-relationship-with-azure-ad"></a><span data-ttu-id="6e011-155">第 2 部分：部署和設定 Windows Server 2012 R2 Active Directory Federation Services，以及設定與 Azure AD 的同盟關係</span><span class="sxs-lookup"><span data-stu-id="6e011-155">Part 2: Deploy and configure Windows Server 2012 R2 Active Directory Federation Services and set up a federation relationship with Azure AD</span></span>

| <span data-ttu-id="6e011-156">工作</span><span class="sxs-lookup"><span data-stu-id="6e011-156">Task</span></span> | <span data-ttu-id="6e011-157">參考</span><span class="sxs-lookup"><span data-stu-id="6e011-157">Reference</span></span> |
| --- | --- |
| <span data-ttu-id="6e011-158">使用 Windows Server 2012 R2 結構描述延伸模組來部署 Active Directory Domain Services。</span><span class="sxs-lookup"><span data-stu-id="6e011-158">Deploy Active Directory Domain Services with the Windows Server 2012 R2 schema extensions.</span></span> <span data-ttu-id="6e011-159">您不需要將任何網域控制站升級到 Windows Server 2012 R2。</span><span class="sxs-lookup"><span data-stu-id="6e011-159">You do not need to upgrade any of your domain controllers to Windows Server 2012 R2.</span></span> <span data-ttu-id="6e011-160">結構描述升級是唯一的要求。</span><span class="sxs-lookup"><span data-stu-id="6e011-160">The schema upgrade is the only requirement.</span></span> |[<span data-ttu-id="6e011-161">升級您的 Active Directory Domain Services 結構描述</span><span class="sxs-lookup"><span data-stu-id="6e011-161">Upgrade your Active Directory Domain Services schema</span></span>](#upgrade-your-active-directory-domain-services-schema) |
| <span data-ttu-id="6e011-162">裝置透過尋找已知的 DNS 記錄來探索您的 Azure Active Directory 裝置註冊服務。</span><span class="sxs-lookup"><span data-stu-id="6e011-162">Devices discover your Azure Active Directory device registration service by looking for well-known DNS records.</span></span> <span data-ttu-id="6e011-163">請設定您的公司 DNS，以便讓裝置探索您的 Azure Active Directory 裝置註冊服務。</span><span class="sxs-lookup"><span data-stu-id="6e011-163">Configure your company DNS so that devices can discover your Azure Active Directory device registration service.</span></span> |[<span data-ttu-id="6e011-164">準備您的 Active Directory 支援裝置</span><span class="sxs-lookup"><span data-stu-id="6e011-164">Prepare your Active Directory support devices</span></span>](#prepare-your-active-directory-to-support-devices) |

## <a name="part-3-enable-device-writeback-in-azure-ad"></a><span data-ttu-id="6e011-165">第 3 部分：在 Azure AD 中啟用裝置回寫</span><span class="sxs-lookup"><span data-stu-id="6e011-165">Part 3: Enable device writeback in Azure AD</span></span>
| <span data-ttu-id="6e011-166">工作</span><span class="sxs-lookup"><span data-stu-id="6e011-166">Task</span></span> | <span data-ttu-id="6e011-167">參考</span><span class="sxs-lookup"><span data-stu-id="6e011-167">Reference</span></span> |
| --- | --- |
| <span data-ttu-id="6e011-168">完成「在 Azure AD Connect 中啟用裝置回寫」的第 2 部分。</span><span class="sxs-lookup"><span data-stu-id="6e011-168">Complete part two of "Enabling device writeback in Azure AD Connect."</span></span> <span data-ttu-id="6e011-169">完成之後，請返回本指南。</span><span class="sxs-lookup"><span data-stu-id="6e011-169">After you finish it, return to this guide.</span></span> |[<span data-ttu-id="6e011-170">在 Azure AD Connect 中啟用裝置回寫</span><span class="sxs-lookup"><span data-stu-id="6e011-170">Enabling device writeback in Azure AD Connect</span></span>](#upgrade-your-active-directory-domain-services-schema) |

## <a name="optional-part-4-enable-multi-factor-authentication"></a><span data-ttu-id="6e011-171">[選擇性] 第 4 部分：啟用 Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="6e011-171">[Optional] Part 4: Enable Multi-Factor Authentication</span></span>
<span data-ttu-id="6e011-172">強烈建議您設定數個 Multi-Factor Authentication 選項其中之一。</span><span class="sxs-lookup"><span data-stu-id="6e011-172">We strongly recommended that you configure one of the several options for Multi-Factor Authentication.</span></span> <span data-ttu-id="6e011-173">如果您想要要求 Multi-Factor Authentication，請參閱[選擇您的 Multi-Factor Authentication 安全性解決方案](../multi-factor-authentication/multi-factor-authentication-get-started.md)。</span><span class="sxs-lookup"><span data-stu-id="6e011-173">If you want to require Multi-Factor Authentication, see [Choose the Multi-Factor Authentication security solution for you](../multi-factor-authentication/multi-factor-authentication-get-started.md).</span></span> <span data-ttu-id="6e011-174">它包含每個解決方案的描述，以及可協助您設定您所選解決方案的連結。</span><span class="sxs-lookup"><span data-stu-id="6e011-174">It includes a description of each solution, and links to help you configure the solution of your choice.</span></span>

## <a name="part-5-verification"></a><span data-ttu-id="6e011-175">第 5 部分：驗證</span><span class="sxs-lookup"><span data-stu-id="6e011-175">Part 5: Verification</span></span>
<span data-ttu-id="6e011-176">部署程序現已完成，您可以試試一些案例。</span><span class="sxs-lookup"><span data-stu-id="6e011-176">The deployment is now complete, and you can try out some scenarios.</span></span> <span data-ttu-id="6e011-177">請使用下列連結來進行服務實驗以熟悉其功能。</span><span class="sxs-lookup"><span data-stu-id="6e011-177">Use the following links to experiment with the service and become familiar with its features.</span></span>

| <span data-ttu-id="6e011-178">工作</span><span class="sxs-lookup"><span data-stu-id="6e011-178">Task</span></span> | <span data-ttu-id="6e011-179">參考</span><span class="sxs-lookup"><span data-stu-id="6e011-179">Reference</span></span> |
| --- | --- |
| <span data-ttu-id="6e011-180">使用 Azure Active Directory 裝置註冊服務將一些裝置加入到您的工作場所。</span><span class="sxs-lookup"><span data-stu-id="6e011-180">Join some devices to your workplace by using Azure Active Directory device registration service.</span></span> <span data-ttu-id="6e011-181">您可以將 iOS、Windows 及 Android 裝置加入。</span><span class="sxs-lookup"><span data-stu-id="6e011-181">You can join iOS, Windows, and Android devices.</span></span> |[<span data-ttu-id="6e011-182">使用 Azure Active Directory 裝置註冊服務將裝置加入到您的工作場所</span><span class="sxs-lookup"><span data-stu-id="6e011-182">Join devices to your workplace using Azure Active Directory device registration service</span></span>](#join-devices-to-your-workplace-using-azure-active-directory-device-registration) |
| <span data-ttu-id="6e011-183">使用系統管理員入口網站來檢視及啟用或停用已註冊的裝置。</span><span class="sxs-lookup"><span data-stu-id="6e011-183">View and enable or disable registered devices by using the administrator portal.</span></span> <span data-ttu-id="6e011-184">在這項工作中，您將使用系統管理員入口網站來檢視一些已註冊的裝置。</span><span class="sxs-lookup"><span data-stu-id="6e011-184">In this task, you view some registered devices by using the administrator portal.</span></span> |[<span data-ttu-id="6e011-185">Azure Active Directory 裝置註冊服務概觀</span><span class="sxs-lookup"><span data-stu-id="6e011-185">Azure Active Directory device registration service overview</span></span>](active-directory-device-registration-get-started.md) |
| <span data-ttu-id="6e011-186">確認裝置物件已從 Azure Active Directory 寫回至 Windows Server Active Directory。</span><span class="sxs-lookup"><span data-stu-id="6e011-186">Verify that device objects are written back from Azure Active Directory to Windows Server Active Directory.</span></span> |[<span data-ttu-id="6e011-187">確認將已註冊的裝置寫回至 Active Directory</span><span class="sxs-lookup"><span data-stu-id="6e011-187">Verify registered devices are written back to Active Directory</span></span>](#verify-registered-devices-are-written-back-to-active-directory) |
| <span data-ttu-id="6e011-188">現在使用者可以註冊其裝置，您可以在 AD FS 中建立僅允許已註冊裝置的應用程式存取原則。</span><span class="sxs-lookup"><span data-stu-id="6e011-188">Now that users can register their devices, you can create application access polices in AD FS that allow only registered devices.</span></span> <span data-ttu-id="6e011-189">在這項工作中，您需建立應用程式存取規則和自訂拒絕存取訊息。</span><span class="sxs-lookup"><span data-stu-id="6e011-189">In this task, you create an application access rule and a custom access-denied message.</span></span> |[<span data-ttu-id="6e011-190">建立應用程式存取原則和自訂的拒絕存取訊息</span><span class="sxs-lookup"><span data-stu-id="6e011-190">Create an application access policy and custom access-denied message</span></span>](#create-an-application-access-policy-and-custom-access-denied-message) |

## <a name="integrate-azure-active-directory-with-on-premises-active-directory"></a><span data-ttu-id="6e011-191">整合 Azure Active Directory 與內部部署 Active Directory</span><span class="sxs-lookup"><span data-stu-id="6e011-191">Integrate Azure Active Directory with on-premises Active Directory</span></span>
<span data-ttu-id="6e011-192">此步驟可協助您使用 Azure AD Connect 將 Azure AD 租用戶與內部部署 Active Directory 整合。</span><span class="sxs-lookup"><span data-stu-id="6e011-192">This step helps you integrate your Azure AD tenant with your on-premises Active Directory by using Azure AD Connect.</span></span> <span data-ttu-id="6e011-193">雖然在 Azure 傳統入口網站中都有提供這些步驟，但請記下本節中所列的一切特殊指示。</span><span class="sxs-lookup"><span data-stu-id="6e011-193">Although the steps are available in the Azure classic portal, make note of any special instructions that are listed in this section.</span></span>

1. <span data-ttu-id="6e011-194">使用在 Azure AD 中擔任全域管理員的帳戶來登入 Azure 傳統入口網站。</span><span class="sxs-lookup"><span data-stu-id="6e011-194">Sign in to the Azure classic portal by using an account that is a global administrator in Azure AD.</span></span>
2. <span data-ttu-id="6e011-195">在左窗格中選取 [Active Directory] 。</span><span class="sxs-lookup"><span data-stu-id="6e011-195">On the left pane, select **Active Directory**.</span></span>
3. <span data-ttu-id="6e011-196">在 [目錄]  索引標籤中，選取您的目錄。</span><span class="sxs-lookup"><span data-stu-id="6e011-196">On the **Directory** tab, select your directory.</span></span>
4. <span data-ttu-id="6e011-197">選取 [目錄整合]  索引標籤。</span><span class="sxs-lookup"><span data-stu-id="6e011-197">Select the **Directory Integration** tab.</span></span>
5. <span data-ttu-id="6e011-198">在 [部署及管理] 區段底下，依照步驟 1 到 3 將 Azure Active Directory 與您的內部部署目錄整合。</span><span class="sxs-lookup"><span data-stu-id="6e011-198">Under the **deploy and manage** section, follow steps 1 through 3 to integrate Azure Active Directory with your on-premises directory.</span></span>
   
   1. <span data-ttu-id="6e011-199">新增網域。</span><span class="sxs-lookup"><span data-stu-id="6e011-199">Add domains.</span></span>
   2. <span data-ttu-id="6e011-200">使用[自訂 Azure AD Connect 安裝](connect/active-directory-aadconnect-get-started-custom.md)中的指示來安裝並執行 Azure AD Connect。</span><span class="sxs-lookup"><span data-stu-id="6e011-200">Install and run Azure AD Connect by using the instructions at [Custom installation of Azure AD Connect](connect/active-directory-aadconnect-get-started-custom.md).</span></span>
   3. <span data-ttu-id="6e011-201">驗證及管理目錄同步作業。</span><span class="sxs-lookup"><span data-stu-id="6e011-201">Verify and manage directory sync.</span></span> <span data-ttu-id="6e011-202">此步驟中可取得單一登入的指示。</span><span class="sxs-lookup"><span data-stu-id="6e011-202">Single sign-on instructions are available within this step.</span></span>
   
   <span data-ttu-id="6e011-203">此外，依照[自訂 Azure AD Connect 安裝](connect/active-directory-aadconnect-get-started-custom.md)所述，設定與 AD FS 的同盟。</span><span class="sxs-lookup"><span data-stu-id="6e011-203">In addition, configure federation with AD FS as outlined in [Custom installation of Azure AD Connect](connect/active-directory-aadconnect-get-started-custom.md).</span></span>

## <a name="upgrade-your-active-directory-domain-services-schema"></a><span data-ttu-id="6e011-204">升級您的 Active Directory 網域服務結構描述</span><span class="sxs-lookup"><span data-stu-id="6e011-204">Upgrade your Active Directory Domain Services schema</span></span>
> [!NOTE]
> <span data-ttu-id="6e011-205">將 Active Directory 結構描述升級之後，即無法回復此程序。</span><span class="sxs-lookup"><span data-stu-id="6e011-205">After you upgrade your Active Directory schema, the process cannot be reversed.</span></span> <span data-ttu-id="6e011-206">建議您先在測試環境中執行升級。</span><span class="sxs-lookup"><span data-stu-id="6e011-206">We recommend that you first perform the upgrade in a test environment.</span></span>
> 

1. <span data-ttu-id="6e011-207">使用同時具備企業系統管理員和結構描述系統管理員權限的帳戶來登入網域控制站。</span><span class="sxs-lookup"><span data-stu-id="6e011-207">Sign in to your domain controller with an account that has both enterprise administrator and schema administrator rights.</span></span>
2. <span data-ttu-id="6e011-208">將 **[media]\support\adprep** 目錄和子目錄複製到其中一個 Active Directory 網域控制站 (其中 **[media]** 是 Windows Server 2012 R2 安裝媒體的路徑)。</span><span class="sxs-lookup"><span data-stu-id="6e011-208">Copy the **[media]\support\adprep** directory and subdirectories to one of your Active Directory domain controllers (where **[media]** is the path to the Windows Server 2012 R2 installation media).</span></span>
4. <span data-ttu-id="6e011-209">從命令提示字元，瀏覽至 **adprep** 目錄並執行 **adprep.exe /forestprep**。</span><span class="sxs-lookup"><span data-stu-id="6e011-209">From a command prompt, go to the **adprep** directory and run **adprep.exe /forestprep**.</span></span> <span data-ttu-id="6e011-210">請遵循畫面上的指示完成結構描述升級。</span><span class="sxs-lookup"><span data-stu-id="6e011-210">Follow the onscreen instructions to complete the schema upgrade.</span></span>

## <a name="prepare-your-active-directory-to-support-devices"></a><span data-ttu-id="6e011-211">準備您的 Active Directory 以支援裝置</span><span class="sxs-lookup"><span data-stu-id="6e011-211">Prepare your Active Directory to support devices</span></span>
> [!NOTE]
> <span data-ttu-id="6e011-212">這是您必須執行的一次性作業，以準備 Active Directory 樹系支援裝置。</span><span class="sxs-lookup"><span data-stu-id="6e011-212">This is a one-time operation that you must run to prepare your Active Directory forest to support devices.</span></span> <span data-ttu-id="6e011-213">若要完成此程序，您必須以企業系統管理員權限登入，且您的 Active Directory 樹系必須具有 Windows Server 2012 R2 結構描述。</span><span class="sxs-lookup"><span data-stu-id="6e011-213">To complete this procedure, you must be signed in with enterprise administrator permissions and your Active Directory forest must have the Windows Server 2012 R2 schema.</span></span>
> 


### <a name="prepare-your-active-directory-forest"></a><span data-ttu-id="6e011-214">準備您的 Active Directory 樹系</span><span class="sxs-lookup"><span data-stu-id="6e011-214">Prepare your Active Directory forest</span></span>
1. <span data-ttu-id="6e011-215">在您的同盟伺服器上，開啟 Windows PowerShell 命令視窗，然後輸入 **Initialize-ADDeviceRegistration**。</span><span class="sxs-lookup"><span data-stu-id="6e011-215">On your federation server, open a Windows PowerShell command window, and then type **Initialize-ADDeviceRegistration**.</span></span> 
2. <span data-ttu-id="6e011-216">收到 **ServiceAccountName**提示時，請輸入您選取做為 AD FS 服務帳戶的服務帳戶名稱。</span><span class="sxs-lookup"><span data-stu-id="6e011-216">When prompted for **ServiceAccountName**, enter the name of the service account you selected as the service account for AD FS.</span></span> <span data-ttu-id="6e011-217">如果是 gMSA 帳戶，請使用 **domain\accountname$** 格式來輸入帳戶。</span><span class="sxs-lookup"><span data-stu-id="6e011-217">If it's a gMSA account, enter the account in the **domain\accountname$** format.</span></span> <span data-ttu-id="6e011-218">對於網域帳戶，請使用格式 **domain\accountname**。</span><span class="sxs-lookup"><span data-stu-id="6e011-218">For a domain account, use the format **domain\accountname**.</span></span>

### <a name="enable-device-authentication-in-ad-fs"></a><span data-ttu-id="6e011-219">在 AD FS 中啟用裝置驗證</span><span class="sxs-lookup"><span data-stu-id="6e011-219">Enable device authentication in AD FS</span></span>
1. <span data-ttu-id="6e011-220">在您的同盟伺服器上，開啟 AD FS 管理主控台並移至 [AD FS] > [驗證原則]。</span><span class="sxs-lookup"><span data-stu-id="6e011-220">On your federation server, open the AD FS management console and go to **AD FS** > **Authentication Policies**.</span></span>
2. <span data-ttu-id="6e011-221">在 [動作] 窗格上，選取 [編輯全域主要驗證]。</span><span class="sxs-lookup"><span data-stu-id="6e011-221">On the **Actions** pane, select **Edit Global Primary Authentication**.</span></span>
3. <span data-ttu-id="6e011-222">勾選 [啟用裝置驗證]，然後選取 [確定]。</span><span class="sxs-lookup"><span data-stu-id="6e011-222">Check **Enable device authentication**, and then select **OK**.</span></span>
4. <span data-ttu-id="6e011-223">AD FS 預設會定期從 Active Directory 移除未使用的裝置。</span><span class="sxs-lookup"><span data-stu-id="6e011-223">By default, AD FS periodically removes unused devices from Active Directory.</span></span> <span data-ttu-id="6e011-224">使用 Azure Active Directory 裝置註冊服務時，請停用此工作，以便在 Azure 中管理裝置。</span><span class="sxs-lookup"><span data-stu-id="6e011-224">Disable this task when you're using Azure Active Directory device registration service so that devices can be managed in Azure.</span></span>

### <a name="disable-unused-device-cleanup"></a><span data-ttu-id="6e011-225">停用未使用的裝置清除</span><span class="sxs-lookup"><span data-stu-id="6e011-225">Disable unused device cleanup</span></span>
<span data-ttu-id="6e011-226">在您的同盟伺服器上，開啟 Windows PowerShell 命令視窗，然後輸入 **Set-AdfsDeviceRegistration -MaximumInactiveDays 0**。</span><span class="sxs-lookup"><span data-stu-id="6e011-226">On your federation server, open a Windows PowerShell command window, and then type **Set-AdfsDeviceRegistration -MaximumInactiveDays 0**.</span></span>

### <a name="prepare-azure-ad-connect-for-device-writeback"></a><span data-ttu-id="6e011-227">準備 Azure AD Connect 以便裝置回寫</span><span class="sxs-lookup"><span data-stu-id="6e011-227">Prepare Azure AD Connect for device writeback</span></span>
<span data-ttu-id="6e011-228">完成第 1 部分：準備 Azure AD Connect。</span><span class="sxs-lookup"><span data-stu-id="6e011-228">Complete part 1: Prepare Azure AD Connect.</span></span>

## <a name="join-devices-to-your-workplace-by-using-azure-active-directory-device-registration-service"></a><span data-ttu-id="6e011-229">使用 Azure Active Directory 裝置註冊服務將裝置加入到您的工作場所</span><span class="sxs-lookup"><span data-stu-id="6e011-229">Join devices to your workplace by using Azure Active Directory device registration service</span></span>

### <a name="join-an-ios-device-by-using-azure-active-directory-device-registration"></a><span data-ttu-id="6e011-230">使用 Azure Active Directory 裝置註冊來加入 iOS 裝置</span><span class="sxs-lookup"><span data-stu-id="6e011-230">Join an iOS device by using Azure Active Directory device registration</span></span>
<span data-ttu-id="6e011-231">Azure Active Directory 裝置註冊針對 iOS 裝置會使用「空中下載設定檔」註冊程序。</span><span class="sxs-lookup"><span data-stu-id="6e011-231">Azure Active Directory device registration uses the Over-the-Air Profile enrollment process for iOS devices.</span></span> <span data-ttu-id="6e011-232">當使用者使用 Safari 來連線到設定檔註冊 URL 時，此程序就會開始。</span><span class="sxs-lookup"><span data-stu-id="6e011-232">This process begins when the user connects to the profile enrollment URL with Safari.</span></span> <span data-ttu-id="6e011-233">URL 格式如下所示：</span><span class="sxs-lookup"><span data-stu-id="6e011-233">The URL format is as follows:</span></span>

    https://enterpriseregistration.windows.net/enrollmentserver/otaprofile/"yourdomainname"

<span data-ttu-id="6e011-234">在此案例中，`yourdomainname` 是您使用 Azure Active Directory 來設定的網域名稱。</span><span class="sxs-lookup"><span data-stu-id="6e011-234">In this case, `yourdomainname` is the domain name that you configured with Azure Active Directory.</span></span> <span data-ttu-id="6e011-235">例如，如果您的網域名稱是 contoso.com，URL 就會如下所示：</span><span class="sxs-lookup"><span data-stu-id="6e011-235">For example, if your domain name is contoso.com, the URL is as follows:</span></span>

    https://enterpriseregistration.windows.net/enrollmentserver/otaprofile/contoso.com

<span data-ttu-id="6e011-236">有許多不同的方式可讓 URL 與您的使用者進行通訊。</span><span class="sxs-lookup"><span data-stu-id="6e011-236">There are many different ways to communicate this URL to your users.</span></span> <span data-ttu-id="6e011-237">例如，其中一個建議方式是在 AD FS 的自訂應用程式拒絕存取訊息中發佈此 URL。</span><span class="sxs-lookup"><span data-stu-id="6e011-237">For example, one method we recommend is publishing this URL in a custom application access-denied message in AD FS.</span></span> <span data-ttu-id="6e011-238">即將推出的[建立應用程式存取原則和自訂的拒絕存取訊息](#create-an-application-access-policy-and-custom-access-denied-message)一節中將會說明此訊息。</span><span class="sxs-lookup"><span data-stu-id="6e011-238">This information is covered in the upcoming section [Create an application access policy and custom access-denied message](#create-an-application-access-policy-and-custom-access-denied-message).</span></span>

### <a name="join-a-windows-81-device-by-using-azure-active-directory-device-registration"></a><span data-ttu-id="6e011-239">使用 Azure Active Directory 裝置註冊來加入 Windows 8.1 裝置</span><span class="sxs-lookup"><span data-stu-id="6e011-239">Join a Windows 8.1 device by using Azure Active Directory device registration</span></span>
1. <span data-ttu-id="6e011-240">在 Windows 8.1 裝置上，選取 [電腦設定] > [網路] > [工作場所]。</span><span class="sxs-lookup"><span data-stu-id="6e011-240">On your Windows 8.1 device, select **PC Settings** > **Network** > **Workplace**.</span></span>
2. <span data-ttu-id="6e011-241">以 UPN 格式輸入您的使用者名稱；例如 **dan@contoso.com**。</span><span class="sxs-lookup"><span data-stu-id="6e011-241">Enter your user name in UPN format; for example, **dan@contoso.com**.</span></span>
3. <span data-ttu-id="6e011-242">選取 [加入] 。</span><span class="sxs-lookup"><span data-stu-id="6e011-242">Select **Join**.</span></span>
4. <span data-ttu-id="6e011-243">出現提示時，使用您的認證登入。</span><span class="sxs-lookup"><span data-stu-id="6e011-243">When prompted, sign in with your credentials.</span></span> <span data-ttu-id="6e011-244">裝置會隨即加入。</span><span class="sxs-lookup"><span data-stu-id="6e011-244">The device is now joined.</span></span>

### <a name="join-a-windows-7-device-by-using-azure-active-directory-device-registration"></a><span data-ttu-id="6e011-245">使用 Azure Active Directory 裝置註冊來加入 Windows 7 裝置</span><span class="sxs-lookup"><span data-stu-id="6e011-245">Join a Windows 7 device by using Azure Active Directory device registration</span></span>
<span data-ttu-id="6e011-246">若要註冊已加入網域的 Windows 7 裝置，您必須部署裝置註冊軟體套件。</span><span class="sxs-lookup"><span data-stu-id="6e011-246">To register Windows 7 domain-joined devices, you need to deploy the device registration software package.</span></span> <span data-ttu-id="6e011-247">此軟體套件稱為 Workplace Join for Windows 7，您可以從 [Microsoft Connect 網站](https://connect.microsoft.com/site1164)下載。</span><span class="sxs-lookup"><span data-stu-id="6e011-247">The software package is called Workplace Join for Windows 7, and it's available for download at the [Microsoft Connect website](https://connect.microsoft.com/site1164).</span></span> 

<span data-ttu-id="6e011-248">如需有關如何使用此套件的指示，請參閱[如何設定讓已加入網域的 Windows 裝置自動向 Azure Active Directory 註冊](active-directory-conditional-access-automatic-device-registration-setup.md)。</span><span class="sxs-lookup"><span data-stu-id="6e011-248">Instructions about how to use the package are available in [How to configure automatic registration of Windows domain-joined devices with Azure Active Directory](active-directory-conditional-access-automatic-device-registration-setup.md).</span></span>

## <a name="verify-that-registered-devices-are-written-back-to-active-directory"></a><span data-ttu-id="6e011-249">確認將已註冊的裝置寫回至 Active Directory</span><span class="sxs-lookup"><span data-stu-id="6e011-249">Verify that registered devices are written back to Active Directory</span></span>
<span data-ttu-id="6e011-250">您可以使用 LDP.exe 或「ADSI 編輯」來檢視及確認裝置物件已寫回至 Active Directory。</span><span class="sxs-lookup"><span data-stu-id="6e011-250">You can view and verify that your device objects have been written back to your Active Directory by using LDP.exe or ADSI Edit.</span></span> <span data-ttu-id="6e011-251">兩者都是透過 Active Directory 系統管理工具提供的工具。</span><span class="sxs-lookup"><span data-stu-id="6e011-251">Both are available with the Active Directory administrator tools.</span></span>

<span data-ttu-id="6e011-252">從 Azure Active Directory 寫回的裝置物件預設會放在與 AD FS 伺服器陣列相同的網域中。</span><span class="sxs-lookup"><span data-stu-id="6e011-252">By default, device objects that are written back from Azure Active Directory are placed in the same domain as your AD FS farm.</span></span>

    CN=RegisteredDevices,defaultNamingContext

## <a name="create-an-application-access-policy-and-custom-access-denied-message"></a><span data-ttu-id="6e011-253">建立應用程式存取原則和自訂的拒絕存取訊息</span><span class="sxs-lookup"><span data-stu-id="6e011-253">Create an application access policy and custom access-denied message</span></span>
<span data-ttu-id="6e011-254">請考慮下列案例：您在 AD FS 中建立應用程式信賴憑證者信任，並設定只允許已註冊裝置的發佈授權規則。</span><span class="sxs-lookup"><span data-stu-id="6e011-254">Consider the following scenario: You create an application Relying Party Trust in AD FS and configure an Issuance Authorization Rule that allows only registered devices.</span></span> <span data-ttu-id="6e011-255">現在只允許已註冊的裝置存取應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e011-255">Now only devices that are registered are allowed to access the application.</span></span> 

<span data-ttu-id="6e011-256">若要讓使用者輕鬆存取應用程式，您需設定自訂的拒絕存取訊息，其中包含如何加入其裝置的指示。</span><span class="sxs-lookup"><span data-stu-id="6e011-256">To make it easy for your users to gain access to the application, you configure a custom access-denied message that includes instructions for how to join their device.</span></span> <span data-ttu-id="6e011-257">現在您的使用者已可順暢地註冊其裝置以存取應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e011-257">Now your users have a seamless way to register their devices so they can access an application.</span></span>

<span data-ttu-id="6e011-258">下列步驟說明如何實作此案例。</span><span class="sxs-lookup"><span data-stu-id="6e011-258">The following steps show you how to implement this scenario.</span></span>

> [!NOTE]
> <span data-ttu-id="6e011-259">本節假設您已在 AD FS 中為您的應用程式設定信賴憑證者信任。</span><span class="sxs-lookup"><span data-stu-id="6e011-259">This section assumes that you have already configured a Relying Party Trust for your application in AD FS.</span></span>
> 

1. <span data-ttu-id="6e011-260">開啟 AD FS MMC 工具，然後選取 [AD FS] > [信任關係] > [信賴憑證者信任]。</span><span class="sxs-lookup"><span data-stu-id="6e011-260">Open the AD FS MMC tool, and then select **AD FS** > **Trust Relationships** > **Relying Party Trusts**.</span></span>
2. <span data-ttu-id="6e011-261">找出將套用這個新存取規則的應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e011-261">Locate the application to which this new access rule applies.</span></span> <span data-ttu-id="6e011-262">在應用程式上按一下滑鼠右鍵，然後選取 [編輯宣告規則]。</span><span class="sxs-lookup"><span data-stu-id="6e011-262">Right-click the application, and then select **Edit Claim Rules**.</span></span>
3. <span data-ttu-id="6e011-263">選取 [發佈授權規則] 索引標籤，然後選取 [新增規則]。</span><span class="sxs-lookup"><span data-stu-id="6e011-263">Select the **Issuance Authorization Rules** tab, and then select **Add Rule**.</span></span>
4. <span data-ttu-id="6e011-264">從 [宣告規則] 範本下拉式清單中，選取 [根據傳入宣告來允許或拒絕使用者]。</span><span class="sxs-lookup"><span data-stu-id="6e011-264">From the **Claim rule** template drop-down list, select **Permit or Deny Users Based on an Incoming Claim**.</span></span> <span data-ttu-id="6e011-265">然後，選取 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="6e011-265">Then select **Next**.</span></span>
5. <span data-ttu-id="6e011-266">在 [宣告規則名稱] 欄位中，輸入**允許從已註冊的裝置存取**。</span><span class="sxs-lookup"><span data-stu-id="6e011-266">In the **Claim rule name** field, type **Permit access from registered devices**.</span></span>
6. <span data-ttu-id="6e011-267">從 [傳入宣告類型] 下拉式清單中，選取 [為登錄的使用者]。</span><span class="sxs-lookup"><span data-stu-id="6e011-267">From the **Incoming claim type** drop-down list, select **Is Registered User**.</span></span>
7. <span data-ttu-id="6e011-268">在 [傳入宣告值] 欄位中，輸入 **true**。</span><span class="sxs-lookup"><span data-stu-id="6e011-268">In the **Incoming claim value** field, type **true**.</span></span>
8. <span data-ttu-id="6e011-269">選取 [允許具有這個傳入宣告的使用者存取]  選項按鈕。</span><span class="sxs-lookup"><span data-stu-id="6e011-269">Select the **Permit access to users with this incoming claim** radio button.</span></span>
9. <span data-ttu-id="6e011-270">選取 [完成]，然後選取 [套用]。</span><span class="sxs-lookup"><span data-stu-id="6e011-270">Select **Finish**, and then select **Apply**.</span></span>
10. <span data-ttu-id="6e011-271">移除所有比您所建立之規則更寬鬆的規則。</span><span class="sxs-lookup"><span data-stu-id="6e011-271">Remove any rules that are more permissive than the rule you created.</span></span> <span data-ttu-id="6e011-272">例如，移除預設的 [允許所有使用者存取] 規則。</span><span class="sxs-lookup"><span data-stu-id="6e011-272">For example, remove the default rule **Permit Access to all Users**.</span></span>

<span data-ttu-id="6e011-273">您的應用程式現在已設定為只有在使用者來自他們已註冊並加入工作場所的裝置時才允許存取。</span><span class="sxs-lookup"><span data-stu-id="6e011-273">Your application is now configured to allow access only when the user is coming from a device that they registered and joined to the workplace.</span></span> <span data-ttu-id="6e011-274">如需更進階的存取原則，請參閱[針對敏感性應用程式使用額外的 Multi-Factor Authentication 來管理風險](https://technet.microsoft.com/library/dn280949.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6e011-274">For more advanced access polices, see [Manage Risk with Additional Multi-Factor Authentication for Sensitive Applications](https://technet.microsoft.com/library/dn280949.aspx).</span></span>

<span data-ttu-id="6e011-275">接下來，您將為應用程式設定自訂的錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="6e011-275">Next, you configure a custom error message for your application.</span></span> <span data-ttu-id="6e011-276">錯誤訊息可讓使用者知道他們必須先將其裝置加入到工作場所，才能存取應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e011-276">The error message lets users know that they must join their device to the workplace before they can access the application.</span></span> <span data-ttu-id="6e011-277">您可以使用自訂 HTML 和 PowerShell 來建立自訂的應用程式拒絕存取訊息。</span><span class="sxs-lookup"><span data-stu-id="6e011-277">You can create a custom application access-denied message by using custom HTML and PowerShell.</span></span>

<span data-ttu-id="6e011-278">在您的同盟伺服器上，開啟 PowerShell 命令視窗，然後輸入下列命令。</span><span class="sxs-lookup"><span data-stu-id="6e011-278">On your federation server, open a PowerShell command window, and then type the following command.</span></span> <span data-ttu-id="6e011-279">將部分的命令取代成系統專屬的項目：</span><span class="sxs-lookup"><span data-stu-id="6e011-279">Replace portions of the command with items that are specific to your system:</span></span>

    Set-AdfsRelyingPartyWebContent -Name "relying party trust name" -ErrorPageAuthorizationErrorMessage
<span data-ttu-id="6e011-280">在您可以存取此應用程式之前，您必須註冊您的裝置。</span><span class="sxs-lookup"><span data-stu-id="6e011-280">You must register your device before you can access this application.</span></span>

<span data-ttu-id="6e011-281">**如果您使用 iOS 裝置，請選取此連結加入您的裝置**：</span><span class="sxs-lookup"><span data-stu-id="6e011-281">**If you are using an iOS device, select this link to join your device**:</span></span>

    a href='https://enterpriseregistration.windows.net/enrollmentserver/otaprofile/yourdomain.com

<span data-ttu-id="6e011-282">將這個 iOS 裝置加入至您的工作場所。</span><span class="sxs-lookup"><span data-stu-id="6e011-282">Join this iOS device to your workplace.</span></span>

<span data-ttu-id="6e011-283">如果您使用 Windows 8.1 裝置，則可以選取 [電腦設定]> [網路] > [工作場所] 來加入您的裝置。</span><span class="sxs-lookup"><span data-stu-id="6e011-283">If you are using a Windows 8.1 device, you can join your device by selecting **PC Settings**> **Network** > **Workplace**.</span></span>

<span data-ttu-id="6e011-284">在上述命令中，「信賴憑證者信任名稱」是 AD FS 中您應用程式「信賴憑證者信任」物件的名稱。</span><span class="sxs-lookup"><span data-stu-id="6e011-284">In the preceding commands, **relying party trust name** is the name of your application's Relying Party Trust object in AD FS.</span></span>
<span data-ttu-id="6e011-285">而 **yourdomain.com** 則是您已使用 Azure Active Directory 來設定的網域名稱 (例如 contoso.com)。</span><span class="sxs-lookup"><span data-stu-id="6e011-285">And **yourdomain.com** is the domain name that you have configured with Azure Active Directory (for example, contoso.com).</span></span>
<span data-ttu-id="6e011-286">請務必從您傳遞給 **Set-AdfsRelyingPartyWebContent** Cmdlet 的 HTML 內容中移除任何分行符號 (如果有的話)。</span><span class="sxs-lookup"><span data-stu-id="6e011-286">Be sure to remove any line breaks (if any) from the HTML content that you pass to the **Set-AdfsRelyingPartyWebContent** cmdlet.</span></span>

<span data-ttu-id="6e011-287">現在，當使用者從沒有向 Azure Active Directory 裝置註冊服務註冊的裝置存取您的應用程式時，將會看到與下面螢幕擷取畫面類似的頁面。</span><span class="sxs-lookup"><span data-stu-id="6e011-287">Now when users access your application from a device that's not registered with the Azure Active Directory device registration service, they see a page that looks similar to the following screenshot.</span></span>

![使用者尚未向 Azure AD 註冊其裝置時的錯誤螢幕擷取畫面](./media/active-directory-conditional-access/error-azureDRS-device-not-registered.gif)


