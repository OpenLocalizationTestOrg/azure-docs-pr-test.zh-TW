---
title: "Azure Active Directory v2.0 權杖參考 | Microsoft Docs"
description: "Azure AD v2.0 端點所發出之權杖和宣告的類型"
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: dc58c282-9684-4b38-b151-f3e079f034fd
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: a3611a239fe044cf1b953220a6e96b0e101f47a4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="azure-active-directory-v20-tokens-reference"></a><span data-ttu-id="8339f-103">Azure Active Directory v2.0 權杖參考</span><span class="sxs-lookup"><span data-stu-id="8339f-103">Azure Active Directory v2.0 tokens reference</span></span>
<span data-ttu-id="8339f-104">Azure Active Directory (Azure AD) v2.0 端點會在每個[驗證流程](active-directory-v2-flows.md)中發出數種安全性權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-104">The Azure Active Directory (Azure AD) v2.0 endpoint emits several types of security tokens in each [authentication flow](active-directory-v2-flows.md).</span></span> <span data-ttu-id="8339f-105">本參考文件說明每種權杖的格式、安全性特性及內容。</span><span class="sxs-lookup"><span data-stu-id="8339f-105">This reference describes the format, security characteristics, and contents of each type of token.</span></span>

> [!NOTE]
> <span data-ttu-id="8339f-106">v2.0 端點並未支援所有的 Azure Active Directory 案例和功能。</span><span class="sxs-lookup"><span data-stu-id="8339f-106">The v2.0 endpoint does not support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="8339f-107">若要判斷您是否應該使用 v2.0 端點，請參閱 [v2.0 限制](active-directory-v2-limitations.md)。</span><span class="sxs-lookup"><span data-stu-id="8339f-107">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

## <a name="types-of-tokens"></a><span data-ttu-id="8339f-108">權杖的類型</span><span class="sxs-lookup"><span data-stu-id="8339f-108">Types of tokens</span></span>
<span data-ttu-id="8339f-109">v2.0 端點支援 [OAuth 2.0 授權通訊協定](active-directory-v2-protocols.md)，此通訊協定會使用存取權杖和重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-109">The v2.0 endpoint supports the [OAuth 2.0 authorization protocol](active-directory-v2-protocols.md), which uses access tokens and refresh tokens.</span></span> <span data-ttu-id="8339f-110">v2.0 端點也支援透過 [OpenID Connect](active-directory-v2-protocols.md) 進行驗證和登入。</span><span class="sxs-lookup"><span data-stu-id="8339f-110">The v2.0 endpoint also supports authentication and sign-in via [OpenID Connect](active-directory-v2-protocols.md).</span></span> <span data-ttu-id="8339f-111">OpenID Connect 引進了第三種權杖，即識別碼權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-111">OpenID Connect introduces a third type of token, the ID token.</span></span> <span data-ttu-id="8339f-112">這些權杖中的每一個都是以「持有人」權杖來表示。</span><span class="sxs-lookup"><span data-stu-id="8339f-112">Each of these tokens is represented as a *bearer* token.</span></span>

<span data-ttu-id="8339f-113">持有人權杖是輕巧型的安全性權杖，可授權持有人存取受保護的資源。</span><span class="sxs-lookup"><span data-stu-id="8339f-113">A bearer token is a lightweight security token that grants the bearer access to a protected resource.</span></span> <span data-ttu-id="8339f-114">持有人是可出示權杖的任何一方。</span><span class="sxs-lookup"><span data-stu-id="8339f-114">The bearer is any party that can present the token.</span></span> <span data-ttu-id="8339f-115">雖然某一方必須先向 Azure AD 進行驗證，才能收到持有人權杖，但如果在傳輸和儲存期間未採取步驟來保護權杖，它就可能會被非預期的一方攔截和使用。</span><span class="sxs-lookup"><span data-stu-id="8339f-115">Although a party must authenticate with Azure AD to receive the bearer token, if steps are not taken to secure the token during transmission and storage, it can be intercepted and used by an unintended party.</span></span> <span data-ttu-id="8339f-116">有些安全性權杖有內建的機制，可防止未經授權的對象使用它們，但持有人權杖並沒有這種機制。</span><span class="sxs-lookup"><span data-stu-id="8339f-116">Some security tokens have a built-in mechanism to prevent unauthorized parties from using them, but bearer tokens do not.</span></span> <span data-ttu-id="8339f-117">持有人權杖必須在安全的通道 (例如傳輸層安全性 (HTTPS)) 中傳輸。</span><span class="sxs-lookup"><span data-stu-id="8339f-117">Bearer tokens must be transported in a secure channel such as transport layer security (HTTPS).</span></span> <span data-ttu-id="8339f-118">如果在沒有這種安全性的情況下傳輸持有人權杖，惡意人士便可能使用「攔截式攻擊」來取得權杖，並使用它以未經授權的方式存取受保護的資源。</span><span class="sxs-lookup"><span data-stu-id="8339f-118">If a bearer token is transmitted without this type of security, a malicious party could use a "man-in-the-middle attack" to acquire the token and use it for unauthorized access to a protected resource.</span></span> <span data-ttu-id="8339f-119">儲存或快取持有者權杖供以後使用時，也適用相同的安全性原則。</span><span class="sxs-lookup"><span data-stu-id="8339f-119">The same security principles apply when storing or caching bearer tokens for later use.</span></span> <span data-ttu-id="8339f-120">請一律確保您的應用程式以安全的方式傳輸和儲存持有人權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-120">Always ensure that your app securely transmits and stores bearer tokens.</span></span> <span data-ttu-id="8339f-121">如需了解持有人權杖的更多安全性考量，請參閱 [RFC 6750 第 5 節](http://tools.ietf.org/html/rfc6750)。</span><span class="sxs-lookup"><span data-stu-id="8339f-121">For more security considerations for bearer tokens, see [RFC 6750 Section 5](http://tools.ietf.org/html/rfc6750).</span></span>

<span data-ttu-id="8339f-122">許多由 v2.0 端點所簽發的權杖都是以「Json Web 權杖」(JWT) 的形式實作。</span><span class="sxs-lookup"><span data-stu-id="8339f-122">Many of the tokens issued by the v2.0 endpoint are implemented as JSON Web Tokens (JWTs).</span></span> <span data-ttu-id="8339f-123">JWT 是一種精簡的 URL 安全方法，可在兩方之間傳輸資訊。</span><span class="sxs-lookup"><span data-stu-id="8339f-123">A JWT is a compact, URL-safe way to transfer information between two parties.</span></span> <span data-ttu-id="8339f-124">JWT 中的資訊稱為「宣告」。</span><span class="sxs-lookup"><span data-stu-id="8339f-124">The information in a JWT is called a *claim*.</span></span> <span data-ttu-id="8339f-125">它是權杖持有人及主體相關資訊的判斷提示。</span><span class="sxs-lookup"><span data-stu-id="8339f-125">It's an assertion of information about the bearer and subject of the token.</span></span> <span data-ttu-id="8339f-126">JWT 中的宣告是針對傳輸進行編碼和序列化的「JavaScript 物件標記法」(JSON) 物件。</span><span class="sxs-lookup"><span data-stu-id="8339f-126">The claims in a JWT are JavaScript Object Notation (JSON) objects that are encoded and serialized for transmission.</span></span> <span data-ttu-id="8339f-127">由於 v2.0 端點所簽發的 JWT 已簽署但未加密，因此您可以輕鬆地檢查 JWT 的內容以便進行偵錯。</span><span class="sxs-lookup"><span data-stu-id="8339f-127">Because the JWTs issued by the v2.0 endpoint are signed but not encrypted, you can easily inspect the contents of a JWT for debugging purposes.</span></span> <span data-ttu-id="8339f-128">如需有關 JWT 的詳細資訊，請參閱 [JWT 規格](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html)。</span><span class="sxs-lookup"><span data-stu-id="8339f-128">For more information about JWTs, see the [JWT specification](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html).</span></span>

### <a name="id-tokens"></a><span data-ttu-id="8339f-129">ID 權杖</span><span class="sxs-lookup"><span data-stu-id="8339f-129">ID tokens</span></span>
<span data-ttu-id="8339f-130">識別碼權杖是您的應用程式使用 [OpenID Connect](active-directory-v2-protocols.md) 來執行驗證時所收到的一種登入安全性權杖形式。</span><span class="sxs-lookup"><span data-stu-id="8339f-130">An ID token is a form of sign-in security token that your app receives when it performs authentication by using [OpenID Connect](active-directory-v2-protocols.md).</span></span> <span data-ttu-id="8339f-131">識別碼權杖會以 [JWT](#types-of-tokens)表示，並且包含了您可用來讓使用者登入應用程式的宣告。</span><span class="sxs-lookup"><span data-stu-id="8339f-131">ID tokens are represented as [JWTs](#types-of-tokens), and they contain claims that you can use to sign the user in to your app.</span></span> <span data-ttu-id="8339f-132">您可以用各種方式使用識別碼權杖中的宣告。</span><span class="sxs-lookup"><span data-stu-id="8339f-132">You can use the claims in an ID token in various ways.</span></span> <span data-ttu-id="8339f-133">通常，系統管理員會使用識別碼權杖來顯示顯示帳戶資訊，或是在應用程式中進行存取控制決策。</span><span class="sxs-lookup"><span data-stu-id="8339f-133">Typically, admins use ID tokens to display account information or to make access control decisions in an app.</span></span> <span data-ttu-id="8339f-134">v2.0 端點只會簽發一種識別碼權杖，不論登入的使用者是哪一種類型，都有一組一致的宣告。</span><span class="sxs-lookup"><span data-stu-id="8339f-134">The v2.0 endpoint issues only one type of ID token, which has a consistent set of claims, regardless of the type of user that is signed in.</span></span> <span data-ttu-id="8339f-135">就個人 Microsoft 帳戶使用者及工作或學校帳戶而言，識別碼權杖的格式和內容都相同。</span><span class="sxs-lookup"><span data-stu-id="8339f-135">The format and content of ID tokens are the same for personal Microsoft account users and for work or school accounts.</span></span>

<span data-ttu-id="8339f-136">目前識別碼權杖已簽署但未加密。</span><span class="sxs-lookup"><span data-stu-id="8339f-136">Currently, ID tokens are signed but not encrypted.</span></span> <span data-ttu-id="8339f-137">當您的應用程式收到識別碼權杖時，它必須[驗證簽章](#validating-tokens)以證明權杖的真實性，以及驗證權杖中的一些宣告來證明其有效性。</span><span class="sxs-lookup"><span data-stu-id="8339f-137">When your app receives an ID token, it must [validate the signature](#validating-tokens) to prove the token's authenticity and validate a few claims in the token to prove its validity.</span></span> <span data-ttu-id="8339f-138">應用程式所驗證的宣告會視案例需求而有所不同，但您的應用程式必須在每一種案例中都執行一些[常見的宣告驗證](#validating-tokens)。</span><span class="sxs-lookup"><span data-stu-id="8339f-138">The claims validated by an app vary depending on scenario requirements, but your app must perform some [common claim validations](#validating-tokens) in every scenario.</span></span>

<span data-ttu-id="8339f-139">在接下來的幾節中，除了範例識別碼權杖之外，我們還會提供有關識別碼權杖中宣告的完整詳細資料。</span><span class="sxs-lookup"><span data-stu-id="8339f-139">We give you the full details about claims in ID tokens in the following sections, in addition to a sample ID token.</span></span> <span data-ttu-id="8339f-140">請注意，識別碼權杖中的宣告不會以特定順序傳回。</span><span class="sxs-lookup"><span data-stu-id="8339f-140">Note that claims in ID tokens are not returned in a specific order.</span></span> <span data-ttu-id="8339f-141">此外，隨時都可以在識別碼權杖中導入新的宣告。</span><span class="sxs-lookup"><span data-stu-id="8339f-141">Also, new claims can be introduced into ID tokens at any time.</span></span> <span data-ttu-id="8339f-142">導入新宣告時，您的應用程式應該不會發生中斷的現象。</span><span class="sxs-lookup"><span data-stu-id="8339f-142">Your app should not break when new claims are introduced.</span></span> <span data-ttu-id="8339f-143">下列清單包含您應用程式目前可確實解譯的宣告。</span><span class="sxs-lookup"><span data-stu-id="8339f-143">The following list includes the claims that your app currently can reliably interpret.</span></span> <span data-ttu-id="8339f-144">您可以在 [OpenID Connect 規格](http://openid.net/specs/openid-connect-core-1_0.html)中找到更多詳細資料。</span><span class="sxs-lookup"><span data-stu-id="8339f-144">You can find more details in the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html).</span></span>

#### <a name="sample-id-token"></a><span data-ttu-id="8339f-145">範例 ID 權杖</span><span class="sxs-lookup"><span data-stu-id="8339f-145">Sample ID token</span></span>
```
eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSJ9.eyJhdWQiOiI2NzMxZGU3Ni0xNGE2LTQ5YWUtOTdiYy02ZWJhNjkxNDM5MWUiLCJpc3MiOiJodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vYjk0MTk4MTgtMDlhZi00OWMyLWIwYzMtNjUzYWRjMWYzNzZlL3YyLjAiLCJpYXQiOjE0NTIyODUzMzEsIm5iZiI6MTQ1MjI4NTMzMSwiZXhwIjoxNDUyMjg5MjMxLCJuYW1lIjoiQmFiZSBSdXRoIiwibm9uY2UiOiIxMjM0NSIsIm9pZCI6ImExZGJkZGU4LWU0ZjktNDU3MS1hZDkzLTMwNTllMzc1MGQyMyIsInByZWZlcnJlZF91c2VybmFtZSI6InRoZWdyZWF0YmFtYmlub0BueXkub25taWNyb3NvZnQuY29tIiwic3ViIjoiTUY0Zi1nZ1dNRWppMTJLeW5KVU5RWnBoYVVUdkxjUXVnNWpkRjJubDAxUSIsInRpZCI6ImI5NDE5ODE4LTA5YWYtNDljMi1iMGMzLTY1M2FkYzFmMzc2ZSIsInZlciI6IjIuMCJ9.p_rYdrtJ1oCmgDBggNHB9O38KTnLCMGbMDODdirdmZbmJcTHiZDdtTc-hguu3krhbtOsoYM2HJeZM3Wsbp_YcfSKDY--X_NobMNsxbT7bqZHxDnA2jTMyrmt5v2EKUnEeVtSiJXyO3JWUq9R0dO-m4o9_8jGP6zHtR62zLaotTBYHmgeKpZgTFB9WtUq8DVdyMn_HSvQEfz-LWqckbcTwM_9RNKoGRVk38KChVJo4z5LkksYRarDo8QgQ7xEKmYmPvRr_I7gvM2bmlZQds2OeqWLB1NSNbFZqyFOCgYn3bAQ-nEQSKwBaA36jYGPOVG2r2Qv1uKcpSOxzxaQybzYpQ
```

> [!TIP]
> <span data-ttu-id="8339f-146">練習時，為了檢查範例識別碼權杖中的宣告，請將範例識別碼權杖貼到 [calebb.net](http://calebb.net/) 中。</span><span class="sxs-lookup"><span data-stu-id="8339f-146">For practice, to inspect the claims in the sample ID token, paste the sample ID token into [calebb.net](http://calebb.net/).</span></span>
>
>

#### <a name="claims-in-id-tokens"></a><span data-ttu-id="8339f-147">ID 權杖中的宣告</span><span class="sxs-lookup"><span data-stu-id="8339f-147">Claims in ID tokens</span></span>
| <span data-ttu-id="8339f-148">名稱</span><span class="sxs-lookup"><span data-stu-id="8339f-148">Name</span></span> | <span data-ttu-id="8339f-149">宣告</span><span class="sxs-lookup"><span data-stu-id="8339f-149">Claim</span></span> | <span data-ttu-id="8339f-150">範例值</span><span class="sxs-lookup"><span data-stu-id="8339f-150">Example value</span></span> | <span data-ttu-id="8339f-151">說明</span><span class="sxs-lookup"><span data-stu-id="8339f-151">Description</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="8339f-152">audience</span><span class="sxs-lookup"><span data-stu-id="8339f-152">audience</span></span> |`aud` |`6731de76-14a6-49ae-97bc-6eba6914391e` |<span data-ttu-id="8339f-153">識別權杖的預定接收者。</span><span class="sxs-lookup"><span data-stu-id="8339f-153">Identifies the intended recipient of the token.</span></span> <span data-ttu-id="8339f-154">在識別碼權杖中，對象是在「Microsoft 應用程式註冊入口網站」中指派給您應用程式的「應用程式識別碼」。</span><span class="sxs-lookup"><span data-stu-id="8339f-154">In ID tokens, the audience is your app's Application ID, assigned to your app in the Microsoft Application Registration Portal.</span></span> <span data-ttu-id="8339f-155">您的應用程式應驗證此值，並拒絕值不相符的權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-155">Your app should validate this value, and reject the token if the value does not match.</span></span> |
| <span data-ttu-id="8339f-156">簽發者</span><span class="sxs-lookup"><span data-stu-id="8339f-156">issuer</span></span> |`iss` |`https://login.microsoftonline.com/b9419818-09af-49c2-b0c3-653adc1f376e/v2.0 ` |<span data-ttu-id="8339f-157">識別建構並傳回權杖的 Security Token Service (STS)，以及在其中驗證使用者的 Azure AD 租用戶。</span><span class="sxs-lookup"><span data-stu-id="8339f-157">Identifies the security token service (STS) that constructs and returns the token, and the Azure AD tenant in which the user was authenticated.</span></span> <span data-ttu-id="8339f-158">您的應用程式應驗證簽發者宣告，以確保權杖來自 v2.0 端點。</span><span class="sxs-lookup"><span data-stu-id="8339f-158">Your app should validate the issuer claim to ensure that the token came from the v2.0 endpoint.</span></span> <span data-ttu-id="8339f-159">它也應該使用宣告的 GUID 部分來限制可登入應用程式的租用戶集合。</span><span class="sxs-lookup"><span data-stu-id="8339f-159">It also should use the GUID portion of the claim to restrict the set of tenants that can sign in to the app.</span></span> <span data-ttu-id="8339f-160">指出使用者是來自 Microsoft 帳戶之取用者使用者的 GUID 是 `9188040d-6c67-4c5b-b112-36a304b66dad`。</span><span class="sxs-lookup"><span data-stu-id="8339f-160">The GUID that indicates that the user is a consumer user from a Microsoft account is `9188040d-6c67-4c5b-b112-36a304b66dad`.</span></span> |
| <span data-ttu-id="8339f-161">簽發時間</span><span class="sxs-lookup"><span data-stu-id="8339f-161">issued at</span></span> |`iat` |`1452285331` |<span data-ttu-id="8339f-162">簽發權杖的時間 (以新紀元 (Epoch) 時間表示)。</span><span class="sxs-lookup"><span data-stu-id="8339f-162">The time at which the token was issued, represented in epoch time.</span></span> |
| <span data-ttu-id="8339f-163">到期時間</span><span class="sxs-lookup"><span data-stu-id="8339f-163">expiration time</span></span> |`exp` |`1452289231` |<span data-ttu-id="8339f-164">權杖失效的時間 (以新紀元 (Epoch) 時間表示)。</span><span class="sxs-lookup"><span data-stu-id="8339f-164">The time at which the token becomes invalid, represented in epoch time.</span></span> <span data-ttu-id="8339f-165">您的應用程式應使用此宣告來驗證權杖存留期的有效性。</span><span class="sxs-lookup"><span data-stu-id="8339f-165">Your app should use this claim to verify the validity of the token lifetime.</span></span> |
| <span data-ttu-id="8339f-166">生效時間</span><span class="sxs-lookup"><span data-stu-id="8339f-166">not before</span></span> |`nbf` |`1452285331` |<span data-ttu-id="8339f-167">權杖生效的時間 (以新紀元 (Epoch) 時間表示)。</span><span class="sxs-lookup"><span data-stu-id="8339f-167">The time at which the token becomes valid, represented in epoch time.</span></span> <span data-ttu-id="8339f-168">這通常與簽發時間相同。</span><span class="sxs-lookup"><span data-stu-id="8339f-168">It is usually the same as the issuance time.</span></span> <span data-ttu-id="8339f-169">您的應用程式應使用此宣告來驗證權杖存留期的有效性。</span><span class="sxs-lookup"><span data-stu-id="8339f-169">Your app should use this claim to verify the validity of the token lifetime.</span></span> |
| <span data-ttu-id="8339f-170">版本</span><span class="sxs-lookup"><span data-stu-id="8339f-170">version</span></span> |`ver` |`2.0` |<span data-ttu-id="8339f-171">Azure AD 所定義的識別碼權杖版本。</span><span class="sxs-lookup"><span data-stu-id="8339f-171">The version of the ID token, as defined by Azure AD.</span></span> <span data-ttu-id="8339f-172">就 v2.0 端點而言，值會是 `2.0`。</span><span class="sxs-lookup"><span data-stu-id="8339f-172">For the v2.0 endpoint, the value is `2.0`.</span></span> |
| <span data-ttu-id="8339f-173">租用戶識別碼</span><span class="sxs-lookup"><span data-stu-id="8339f-173">tenant ID</span></span> |`tid` |`b9419818-09af-49c2-b0c3-653adc1f376e` |<span data-ttu-id="8339f-174">代表使用者是來自哪個 Azure AD 租用戶的 GUID。</span><span class="sxs-lookup"><span data-stu-id="8339f-174">A GUID that represents the Azure AD tenant that the user is from.</span></span> <span data-ttu-id="8339f-175">就工作和學校帳戶而言，GUID 是使用者所屬組織的不可變租用戶識別碼。</span><span class="sxs-lookup"><span data-stu-id="8339f-175">For work and school accounts, the GUID is the immutable tenant ID of the organization that the user belongs to.</span></span> <span data-ttu-id="8339f-176">就個人帳戶而言，此值會是 `9188040d-6c67-4c5b-b112-36a304b66dad`。</span><span class="sxs-lookup"><span data-stu-id="8339f-176">For personal accounts, the value is `9188040d-6c67-4c5b-b112-36a304b66dad`.</span></span> <span data-ttu-id="8339f-177">需要 `profile` 範圍才能接收此宣告。</span><span class="sxs-lookup"><span data-stu-id="8339f-177">The `profile` scope is required in order to receive this claim.</span></span> |
| <span data-ttu-id="8339f-178">代碼雜湊</span><span class="sxs-lookup"><span data-stu-id="8339f-178">code hash</span></span> |`c_hash` |`SGCPtt01wxwfgnYZy2VJtQ` |<span data-ttu-id="8339f-179">只有當識別碼權杖是隨著 OAuth 2.0 授權碼一起簽發時，代碼雜湊才會包含在識別碼權杖中。</span><span class="sxs-lookup"><span data-stu-id="8339f-179">The code hash is included in ID tokens only when the ID token is issued with an OAuth 2.0 authorization code.</span></span> <span data-ttu-id="8339f-180">它可用來驗證授權碼的真實性。</span><span class="sxs-lookup"><span data-stu-id="8339f-180">It can be used to validate the authenticity of an authorization code.</span></span> <span data-ttu-id="8339f-181">如需有關執行此驗證的詳細資料，請參閱 [OpenID Connect 規格](http://openid.net/specs/openid-connect-core-1_0.html)。</span><span class="sxs-lookup"><span data-stu-id="8339f-181">For details about performing this validation, see the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html).</span></span> |
| <span data-ttu-id="8339f-182">存取權杖雜湊</span><span class="sxs-lookup"><span data-stu-id="8339f-182">access token hash</span></span> |`at_hash` |`SGCPtt01wxwfgnYZy2VJtQ` |<span data-ttu-id="8339f-183">只有當識別碼權杖是隨著 OAuth 2.0 存取權杖一起簽發時，存取權杖雜湊才會包含在識別碼權杖中。</span><span class="sxs-lookup"><span data-stu-id="8339f-183">The access token hash is included in ID tokens only when the ID token is issued with an OAuth 2.0 access token.</span></span> <span data-ttu-id="8339f-184">它可用來驗證存取權杖的真實性。</span><span class="sxs-lookup"><span data-stu-id="8339f-184">It can be used to validate the authenticity of an access token.</span></span> <span data-ttu-id="8339f-185">如需有關執行此驗證的詳細資料，請參閱 [OpenID Connect 規格](http://openid.net/specs/openid-connect-core-1_0.html)。</span><span class="sxs-lookup"><span data-stu-id="8339f-185">For details about performing this validation, see the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html).</span></span> |
| <span data-ttu-id="8339f-186">nonce</span><span class="sxs-lookup"><span data-stu-id="8339f-186">nonce</span></span> |`nonce` |`12345` |<span data-ttu-id="8339f-187">Nonce 是緩和權杖重新執行攻擊的策略。</span><span class="sxs-lookup"><span data-stu-id="8339f-187">The nonce is a strategy for mitigating token replay attacks.</span></span> <span data-ttu-id="8339f-188">您的應用程式可以使用 `nonce` 查詢參數，在授權要求中指定 Nonce。</span><span class="sxs-lookup"><span data-stu-id="8339f-188">Your app can specify a nonce in an authorization request by using the `nonce` query parameter.</span></span> <span data-ttu-id="8339f-189">您在要求中提供的值會不經修改在識別碼權杖的 `nonce` 宣告中發出。</span><span class="sxs-lookup"><span data-stu-id="8339f-189">The value you provide in the request is emitted in the ID token's `nonce` claim, unmodified.</span></span> <span data-ttu-id="8339f-190">您的應用程式可根據它在要求上指定的值來驗證此值，使應用程式的工作階段與特定的識別碼權杖產生關聯。</span><span class="sxs-lookup"><span data-stu-id="8339f-190">Your app can verify the value against the value it specified on the request, which associates the app's session with a specific ID token.</span></span> <span data-ttu-id="8339f-191">您的應用程式應在 ID 權杖驗證程序中執行這項驗證。</span><span class="sxs-lookup"><span data-stu-id="8339f-191">Your app should perform this validation during the ID token validation process.</span></span> |
| <span data-ttu-id="8339f-192">名稱</span><span class="sxs-lookup"><span data-stu-id="8339f-192">name</span></span> |`name` |`Babe Ruth` |<span data-ttu-id="8339f-193">名稱宣告會提供人類看得懂的值，用以識別權杖的主體。</span><span class="sxs-lookup"><span data-stu-id="8339f-193">The name claim provides a human-readable value that identifies the subject of the token.</span></span> <span data-ttu-id="8339f-194">此值不保證是唯一值，它是可變動的，並且在設計上僅用於顯示。</span><span class="sxs-lookup"><span data-stu-id="8339f-194">The value is not guaranteed to be unique, it is mutable, and it's designed to be used only for display purposes.</span></span> <span data-ttu-id="8339f-195">需要 `profile` 範圍才能接收此宣告。</span><span class="sxs-lookup"><span data-stu-id="8339f-195">The `profile` scope is required in order to receive this claim.</span></span> |
| <span data-ttu-id="8339f-196">電子郵件</span><span class="sxs-lookup"><span data-stu-id="8339f-196">email</span></span> |`email` |`thegreatbambino@nyy.onmicrosoft.com` |<span data-ttu-id="8339f-197">與使用者帳戶相關聯的主要電子郵件地址 (如果有的話)。</span><span class="sxs-lookup"><span data-stu-id="8339f-197">The primary email address associated with the user account, if one exists.</span></span> <span data-ttu-id="8339f-198">其值是可變動的，並且可能隨著時間改變。</span><span class="sxs-lookup"><span data-stu-id="8339f-198">Its value is mutable and might change over time.</span></span> <span data-ttu-id="8339f-199">需要 `email` 範圍才能接收此宣告。</span><span class="sxs-lookup"><span data-stu-id="8339f-199">The `email` scope is required in order to receive this claim.</span></span> |
| <span data-ttu-id="8339f-200">慣用的使用者名稱</span><span class="sxs-lookup"><span data-stu-id="8339f-200">preferred username</span></span> |`preferred_username` |`thegreatbambino@nyy.onmicrosoft.com` |<span data-ttu-id="8339f-201">代表 v2.0 端點中使用者的主要使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="8339f-201">The primary username that represents the user in the v2.0 endpoint.</span></span> <span data-ttu-id="8339f-202">它可以是電子郵件地址、電話號碼或未指定格式的一般使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="8339f-202">It could be an email address, phone number, or a generic username without a specified format.</span></span> <span data-ttu-id="8339f-203">其值是可變動的，並且可能隨著時間改變。</span><span class="sxs-lookup"><span data-stu-id="8339f-203">Its value is mutable and might change over time.</span></span> <span data-ttu-id="8339f-204">需要 `profile` 範圍才能接收此宣告。</span><span class="sxs-lookup"><span data-stu-id="8339f-204">The `profile` scope is required in order to receive this claim.</span></span> |
| <span data-ttu-id="8339f-205">主旨</span><span class="sxs-lookup"><span data-stu-id="8339f-205">subject</span></span> |`sub` |`MF4f-ggWMEji12KynJUNQZphaUTvLcQug5jdF2nl01Q` | <span data-ttu-id="8339f-206">權杖判斷提示其相關資訊的主體，例如應用程式的使用者。</span><span class="sxs-lookup"><span data-stu-id="8339f-206">The principal about which the token asserts information, such as the user of an app.</span></span> <span data-ttu-id="8339f-207">這個值不可變，而且無法重新指派或重複使用。</span><span class="sxs-lookup"><span data-stu-id="8339f-207">This value is immutable and cannot be reassigned or reused.</span></span> <span data-ttu-id="8339f-208">它可用來安全地執行授權檢查 (例如當權杖用於存取資源時)，並可做為資料庫資料表中的索引鍵。</span><span class="sxs-lookup"><span data-stu-id="8339f-208">It can be used to perform authorization checks safely, such as when the token is used to access a resource, and can be used as a key in database tables.</span></span> <span data-ttu-id="8339f-209">由於主體一律是存在於 Azure AD 所簽發的權杖中，因此建議您在一般用途的授權系統中使用此值。</span><span class="sxs-lookup"><span data-stu-id="8339f-209">Because the subject is always present in the tokens that Azure AD issues, we recommend using this value in a general-purpose authorization system.</span></span> <span data-ttu-id="8339f-210">不過，主體是成對識別碼，對於特定應用程式識別碼來說，主體是唯一的。</span><span class="sxs-lookup"><span data-stu-id="8339f-210">The subject is, however, a pairwise identifier - it is unique to a particular application ID.</span></span>  <span data-ttu-id="8339f-211">因此，如果單一使用者使用兩個不同的用戶端識別碼登入兩個不同的應用程式，這些應用程式會收到兩個不同的主體宣告值。</span><span class="sxs-lookup"><span data-stu-id="8339f-211">Therefore, if a single user signs into two different apps using two different client IDs, those apps will receive two different values for the subject claim.</span></span>  <span data-ttu-id="8339f-212">視您的架構和隱私權需求而定，這不一定是您想要的。</span><span class="sxs-lookup"><span data-stu-id="8339f-212">This may or may not be desired depending on your architecture and privacy requirements.</span></span> |
| <span data-ttu-id="8339f-213">物件識別碼</span><span class="sxs-lookup"><span data-stu-id="8339f-213">object ID</span></span> |`oid` |`a1dbdde8-e4f9-4571-ad93-3059e3750d23` | <span data-ttu-id="8339f-214">物件在 Microsoft 身分識別系統中的不可變識別碼，在此案例為使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="8339f-214">The immutable identifier for an object in the Microsoft identity system, in this case, a user account.</span></span>  <span data-ttu-id="8339f-215">它也可用來安全地執行授權檢查，以及做為資料庫資料表中的索引鍵。</span><span class="sxs-lookup"><span data-stu-id="8339f-215">It can also be used to perform authorization checks safely and as a key in database tables.</span></span> <span data-ttu-id="8339f-216">此識別碼可跨應用程式唯一識別使用者，同一位使用者登入兩個不同的應用程式會在 `oid` 宣告中收到相同的值。</span><span class="sxs-lookup"><span data-stu-id="8339f-216">This ID uniquely identifies the user across applications - two different applications signing in the same user will receive the same value in the `oid` claim.</span></span>  <span data-ttu-id="8339f-217">這表示在對 Microsoft 線上服務 (例如 Microsoft Graph) 進行查詢時可使用此識別碼。</span><span class="sxs-lookup"><span data-stu-id="8339f-217">This means that it can be used when making queries to Microsoft online services, such as the Microsoft Graph.</span></span>  <span data-ttu-id="8339f-218">Microsoft Graph 會傳回這個識別碼做為指定使用者帳戶的 `id` 屬性。</span><span class="sxs-lookup"><span data-stu-id="8339f-218">The Microsoft Graph will return this ID as the `id` property for a given user account.</span></span>  <span data-ttu-id="8339f-219">因為 `oid` 可讓多個應用程式相互關聯使用者，因此需要 `profile` 範圍才能接收此宣告。</span><span class="sxs-lookup"><span data-stu-id="8339f-219">Because the `oid` allows multiple apps to correlate users, the `profile` scope is required in order to receive this claim.</span></span> <span data-ttu-id="8339f-220">請注意，如果單一使用者存在於多個租用戶，使用者將會在每個租用戶中包含不同的物件識別碼，它們會被視為不同帳戶，即使使用者使用相同認證來登入各個帳戶也是如此。</span><span class="sxs-lookup"><span data-stu-id="8339f-220">Note that if a single user exists in multiple tenants, the user will contain a different object ID in each tenant - they are considered different accounts, even though the user logs into each account with the same credentials.</span></span> |

### <a name="access-tokens"></a><span data-ttu-id="8339f-221">存取權杖</span><span class="sxs-lookup"><span data-stu-id="8339f-221">Access tokens</span></span>
<span data-ttu-id="8339f-222">目前 v2.0 端點所簽發的存取權杖僅供「Microsoft 服務」取用。</span><span class="sxs-lookup"><span data-stu-id="8339f-222">Currently, access tokens issued by the v2.0 endpoint can be consumed only by Microsoft Services.</span></span> <span data-ttu-id="8339f-223">針對任何目前支援的案例，您的應用程式應該不需要執行任何存取權杖驗證或檢查。</span><span class="sxs-lookup"><span data-stu-id="8339f-223">Your apps shouldn't need to perform any validation or inspection of access tokens for any of the currently supported scenarios.</span></span> <span data-ttu-id="8339f-224">您可以將存取權杖視為完全不透明。</span><span class="sxs-lookup"><span data-stu-id="8339f-224">You can treat access tokens as completely opaque.</span></span> <span data-ttu-id="8339f-225">它們只是您應用程式可以在 HTTP 要求中傳遞給 Microsoft 的字串。</span><span class="sxs-lookup"><span data-stu-id="8339f-225">They are just strings that your app can pass to Microsoft in HTTP requests.</span></span>

<span data-ttu-id="8339f-226">在不久的將來，v2.0 端點將引進可讓您的應用程式從其他用戶端接收存取權杖的功能。</span><span class="sxs-lookup"><span data-stu-id="8339f-226">In the near future, the v2.0 endpoint will introduce the ability for your app to receive access tokens from other clients.</span></span> <span data-ttu-id="8339f-227">屆時，本參考主題中的資訊將會更新為應用程式執行存取權杖驗證和其他類似工作所需的資訊。</span><span class="sxs-lookup"><span data-stu-id="8339f-227">At that time, the information in this reference topic will be updated with the information that you need for your app to perform access token validation and other similar tasks.</span></span>

<span data-ttu-id="8339f-228">當您向 v2.0 端點要求存取權杖時，v2.0 端點也會傳回存取權杖的相關中繼資料，以供您的應用程式使用。</span><span class="sxs-lookup"><span data-stu-id="8339f-228">When you request an access token from the v2.0 endpoint, the v2.0 endpoint also returns metadata about the access token for your app to use.</span></span> <span data-ttu-id="8339f-229">此資訊包括存取權杖的到期時間以及其有效範圍。</span><span class="sxs-lookup"><span data-stu-id="8339f-229">This information includes the expiry time of the access token and the scopes for which it is valid.</span></span> <span data-ttu-id="8339f-230">您的應用程式可使用此中繼資料來執行存取權杖的智慧型快取，而不需剖析存取權杖本身。</span><span class="sxs-lookup"><span data-stu-id="8339f-230">Your app uses this metadata to perform intelligent caching of access tokens without having to parse open the access token itself.</span></span>

### <a name="refresh-tokens"></a><span data-ttu-id="8339f-231">重新整理權杖</span><span class="sxs-lookup"><span data-stu-id="8339f-231">Refresh tokens</span></span>
<span data-ttu-id="8339f-232">重新整理權杖是安全性權杖，可供您的應用程式用來在 OAuth 2.0 流程中取得新的存取權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-232">Refresh tokens are security tokens that your app can use to get new access tokens in an OAuth 2.0 flow.</span></span> <span data-ttu-id="8339f-233">您的應用程式可以使用重新整理權杖來代表使用者長期存取資源，而不需與使用者互動。</span><span class="sxs-lookup"><span data-stu-id="8339f-233">Your app can use refresh tokens to achieve long-term access to resources on behalf of a user without requiring interaction with the user.</span></span>

<span data-ttu-id="8339f-234">重新整理權杖屬於多資源權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-234">Refresh tokens are multi-resource.</span></span> <span data-ttu-id="8339f-235">在一個資源的權杖要求期間收到的重新整理權杖可以兌換完全不同資源的存取權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-235">A refresh token received during a token request for one resource can be redeemed for access tokens to a completely different resource.</span></span>

<span data-ttu-id="8339f-236">若要在權杖回應中接收重新整理權杖，您的應用程式必須要求並獲得 `offline_acesss` 範圍。</span><span class="sxs-lookup"><span data-stu-id="8339f-236">To receive a refresh in a token response, your app must request and be granted the `offline_acesss` scope.</span></span> <span data-ttu-id="8339f-237">若要深入了解 `offline_access` 範圍，請參閱[同意和範圍](active-directory-v2-scopes.md)一文。</span><span class="sxs-lookup"><span data-stu-id="8339f-237">To learn more about the `offline_access` scope, see the [consent and scopes](active-directory-v2-scopes.md) article.</span></span>

<span data-ttu-id="8339f-238">重新整理權杖對您的應用程式來說，一律是完全不透明的。</span><span class="sxs-lookup"><span data-stu-id="8339f-238">Refresh tokens are, and always will be, completely opaque to your app.</span></span> <span data-ttu-id="8339f-239">它們是由 Azure AD v2.0 端點所簽發，只能由 v2.0 端點檢查和解譯。</span><span class="sxs-lookup"><span data-stu-id="8339f-239">They are issued by the Azure AD v2.0 endpoint and can only be inspected and interpreted by the v2.0 endpoint.</span></span> <span data-ttu-id="8339f-240">它們屬於長效權杖，但不得將您的應用程式撰寫成預期重新整理權杖將持續任何一段時間。</span><span class="sxs-lookup"><span data-stu-id="8339f-240">They are long-lived, but your app should not be written to expect that a refresh token will last for any period of time.</span></span> <span data-ttu-id="8339f-241">重新整理權杖可能會因為各種原因而隨時失效。</span><span class="sxs-lookup"><span data-stu-id="8339f-241">Refresh tokens can be invalidated at any moment for various reasons.</span></span> <span data-ttu-id="8339f-242">讓您的應用程式知道重新整理權杖是否有效的唯一方式，就是對 v2.0 端點提出權杖要求以嘗試兌換。</span><span class="sxs-lookup"><span data-stu-id="8339f-242">The only way for your app to know if a refresh token is valid is to attempt to redeem it by making a token request to the v2.0 endpoint.</span></span>

<span data-ttu-id="8339f-243">當您以重新整理權杖兌換新的存取權杖 (而且如果您的應用程式已獲得 `offline_access` 範圍) 時，您會在權杖回應中收到新的重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-243">When you redeem a refresh token for a new access token (and if your app had been granted the `offline_access` scope), you receive a new refresh token in the token response.</span></span> <span data-ttu-id="8339f-244">請儲存新簽發的重新整理權杖，以取代您在要求中使用的重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-244">Save the newly issued refresh token, to replace the one you used in the request.</span></span> <span data-ttu-id="8339f-245">這可保證您的重新整理權杖儘可能長期保持有效。</span><span class="sxs-lookup"><span data-stu-id="8339f-245">This guarantees that your refresh tokens remain valid for as long as possible.</span></span>

## <a name="validating-tokens"></a><span data-ttu-id="8339f-246">驗證權杖</span><span class="sxs-lookup"><span data-stu-id="8339f-246">Validating tokens</span></span>
<span data-ttu-id="8339f-247">目前，您應用程式應需要執行的唯一權杖驗證就是驗證識別碼權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-247">Currently, the only token validation your apps should need to perform is validating ID tokens.</span></span> <span data-ttu-id="8339f-248">若要驗證識別碼權杖，您的應用程式應該同時驗證識別碼權杖的簽章和識別碼權杖中的宣告。</span><span class="sxs-lookup"><span data-stu-id="8339f-248">To validate an ID token, your app should validate both the ID token's signature and the claims in the ID token.</span></span>

<!-- TODO: Link -->
<span data-ttu-id="8339f-249">Microsoft 提供示範如何輕鬆處理權杖驗證的程式庫和程式碼範例。</span><span class="sxs-lookup"><span data-stu-id="8339f-249">Microsoft provides libraries and code samples that show you how to easily handle token validation.</span></span> <span data-ttu-id="8339f-250">在後續小節中，我們將說明基礎程序。</span><span class="sxs-lookup"><span data-stu-id="8339f-250">In the next sections, we describe the underlying process.</span></span> <span data-ttu-id="8339f-251">此外，也有數個協力廠商開放原始碼程式庫可用於 JWT 驗證。</span><span class="sxs-lookup"><span data-stu-id="8339f-251">Several third-party open-source libraries also are available for JWT validation.</span></span> <span data-ttu-id="8339f-252">幾乎每個平台和語言都有至少一個程式庫選項。</span><span class="sxs-lookup"><span data-stu-id="8339f-252">There's at least one library option for almost every platform and language.</span></span>

### <a name="validate-the-signature"></a><span data-ttu-id="8339f-253">驗證簽章</span><span class="sxs-lookup"><span data-stu-id="8339f-253">Validate the signature</span></span>
<span data-ttu-id="8339f-254">JWT 包含三個區段 (以 `.` 字元分隔)。</span><span class="sxs-lookup"><span data-stu-id="8339f-254">A JWT contains three segments, which are separated by the `.` character.</span></span> <span data-ttu-id="8339f-255">第一個區段稱為「標頭」、第二個區段稱為「主體」，而第三個區段則稱為「簽章」。</span><span class="sxs-lookup"><span data-stu-id="8339f-255">The first segment is known as the *header*, the second segment is the *body*, and the third segment is the *signature*.</span></span> <span data-ttu-id="8339f-256">簽章區段可用來驗證 ID 權杖的真實性，以便獲得應用程式的信任。</span><span class="sxs-lookup"><span data-stu-id="8339f-256">The signature segment can be used to validate the authenticity of the ID token so that it can be trusted by your app.</span></span>

<span data-ttu-id="8339f-257">ID 權杖是經由業界標準非對稱式加密演算法 (例如 RSA 256) 進行簽署。</span><span class="sxs-lookup"><span data-stu-id="8339f-257">ID tokens are signed by using industry-standard asymmetric encryption algorithms, such as RSA 256.</span></span> <span data-ttu-id="8339f-258">識別碼權杖的標頭包含用來簽署權杖之金鑰和加密方法的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="8339f-258">The header of the ID token has information about the key and encryption method used to sign the token.</span></span> <span data-ttu-id="8339f-259">例如：</span><span class="sxs-lookup"><span data-stu-id="8339f-259">For example:</span></span>

```
{
  "typ": "JWT",
  "alg": "RS256",
  "kid": "MnC_VZcATfM5pOYiJHMba9goEKY"
}
```

<span data-ttu-id="8339f-260">`alg` 宣告指出用來簽署權杖的演算法。</span><span class="sxs-lookup"><span data-stu-id="8339f-260">The `alg` claim indicates the algorithm that was used to sign the token.</span></span> <span data-ttu-id="8339f-261">`kid` 宣告指出用來簽署權杖的公開金鑰。</span><span class="sxs-lookup"><span data-stu-id="8339f-261">The `kid` claim indicates the public key that was used to sign the token.</span></span>

<span data-ttu-id="8339f-262">v2.0 端點隨時都可能使用一組特定的公開/私密金鑰組的其中一個金鑰組來簽署識別碼權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-262">At any time, the v2.0 endpoint might sign an ID token by using any one of a specific set of public-private key pairs.</span></span> <span data-ttu-id="8339f-263">v2.0 端點會定期替換一組可能的金鑰，因此應將您的應用程式撰寫成自動處理這些金鑰變更。</span><span class="sxs-lookup"><span data-stu-id="8339f-263">The v2.0 endpoint periodically rotates the possible set of keys, so your app should be written to handle those key changes automatically.</span></span> <span data-ttu-id="8339f-264">若要檢查對 v2.0 端點所用公開金鑰的更新，合理的頻率為每隔 24 小時。</span><span class="sxs-lookup"><span data-stu-id="8339f-264">A reasonable frequency to check for updates to the public keys used by the v2.0 endpoint is every 24 hours.</span></span>

<span data-ttu-id="8339f-265">您可以使用位於下列位置的 OpenID Connect 中繼資料文件，來取得驗證簽章所需的簽署金鑰資料：</span><span class="sxs-lookup"><span data-stu-id="8339f-265">You can acquire the signing key data that you need to validate the signature by using the OpenID Connect metadata document located at:</span></span>

```
https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration
```

> [!TIP]
> <span data-ttu-id="8339f-266">請在瀏覽器中嘗試該 URL！</span><span class="sxs-lookup"><span data-stu-id="8339f-266">Try the URL in a browser!</span></span>
>
>

<span data-ttu-id="8339f-267">此中繼資料文件是 JSON 物件，內含幾項實用的資訊，例如執行 OpenID Connect 驗證所需的各種端點的位置。</span><span class="sxs-lookup"><span data-stu-id="8339f-267">This metadata document is a JSON object that has several useful pieces of information, such as the location of the various endpoints required for OpenID Connect authentication.</span></span>  <span data-ttu-id="8339f-268">此文件也包含 *jwks_uri*，此 URI 提供用來簽署權杖的公用金鑰組的位置。</span><span class="sxs-lookup"><span data-stu-id="8339f-268">The document also includes a *jwks_uri*, which gives the location of the set of public keys used to sign tokens.</span></span> <span data-ttu-id="8339f-269">位於 jwks_uri 的 JSON 文件包含目前使用中的所有公開金鑰資訊。</span><span class="sxs-lookup"><span data-stu-id="8339f-269">The JSON document located at the jwks_uri has all the public key information that is currently in use.</span></span> <span data-ttu-id="8339f-270">您的應用程式可以使用 JWT 標頭中的 `kid` 宣告，來選取本文件中已用來簽署權杖的公開金鑰。</span><span class="sxs-lookup"><span data-stu-id="8339f-270">Your app can use the `kid` claim in the JWT header to select which public key in this document has been used to sign a token.</span></span> <span data-ttu-id="8339f-271">它可接著使用正確的公開金鑰和所指出的演算法，來執行簽章驗證。</span><span class="sxs-lookup"><span data-stu-id="8339f-271">It then performs signature validation by using the correct public key and the indicated algorithm.</span></span>

<span data-ttu-id="8339f-272">執行簽章驗證已超出本文的範圍。</span><span class="sxs-lookup"><span data-stu-id="8339f-272">Performing signature validation is outside the scope of this document.</span></span> <span data-ttu-id="8339f-273">有許多開放原始碼程式庫可協助您進行這方面的操作。</span><span class="sxs-lookup"><span data-stu-id="8339f-273">Many open-source libraries are available to help you with this.</span></span>

### <a name="validate-the-claims"></a><span data-ttu-id="8339f-274">驗證宣告</span><span class="sxs-lookup"><span data-stu-id="8339f-274">Validate the claims</span></span>
<span data-ttu-id="8339f-275">如果您的應用程式在使用者登入時收到識別碼權杖，則它應該一併對識別碼權杖中的宣告執行一些檢查。</span><span class="sxs-lookup"><span data-stu-id="8339f-275">When your app receives an ID token upon user sign-in, it should also perform a few checks against the claims in the ID token.</span></span> <span data-ttu-id="8339f-276">包含但不限於：</span><span class="sxs-lookup"><span data-stu-id="8339f-276">These include but are not limited to:</span></span>

* <span data-ttu-id="8339f-277">**對象**宣告 - 用以確認識別碼權杖預定是要提供給您的應用程式</span><span class="sxs-lookup"><span data-stu-id="8339f-277">**audience** claim, to verify that the ID token was intended to be given to your app</span></span>
* <span data-ttu-id="8339f-278">**生效時間**和**到期時間**宣告 - 用以確認識別碼權杖尚未過期</span><span class="sxs-lookup"><span data-stu-id="8339f-278">**not before** and **expiration time** claims, to verify that the ID token has not expired</span></span>
* <span data-ttu-id="8339f-279">**簽發者**宣告 - 用以確認權杖是由 v2.0 端點簽發給您的應用程式</span><span class="sxs-lookup"><span data-stu-id="8339f-279">**issuer** claim, to verify that the token was issued to your app by the v2.0 endpoint</span></span>
* <span data-ttu-id="8339f-280">**Nonce** - 作為權杖重新執行攻擊的緩和措施</span><span class="sxs-lookup"><span data-stu-id="8339f-280">**nonce**, as a token replay attack mitigation</span></span>

<span data-ttu-id="8339f-281">如需您應用程式應執行的宣告驗證完整清單，請參閱 [OpenID Connect 規格](http://openid.net/specs/openid-connect-core-1_0.html#IDTokenValidation)。</span><span class="sxs-lookup"><span data-stu-id="8339f-281">For a full list of claim validations that your app should perform, see the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html#IDTokenValidation).</span></span>

<span data-ttu-id="8339f-282">這些宣告的預期值詳細資料均包含在[識別碼權杖](# ID tokens)一節中。</span><span class="sxs-lookup"><span data-stu-id="8339f-282">Details of the expected values for these claims are included in the [ID tokens](# ID tokens) section.</span></span>

## <a name="token-lifetimes"></a><span data-ttu-id="8339f-283">權杖存留期</span><span class="sxs-lookup"><span data-stu-id="8339f-283">Token lifetimes</span></span>
<span data-ttu-id="8339f-284">以下提供的權杖存留期僅供您參考。</span><span class="sxs-lookup"><span data-stu-id="8339f-284">We provide the following token lifetimes for your information only.</span></span> <span data-ttu-id="8339f-285">當您對應用程式進行開發和偵錯時，此資訊或許可協助您。</span><span class="sxs-lookup"><span data-stu-id="8339f-285">The information might help you as you develop and debug apps.</span></span> <span data-ttu-id="8339f-286">撰寫應用程式時，請勿將其撰寫成預期任何這些存留期會保持不變。</span><span class="sxs-lookup"><span data-stu-id="8339f-286">Your apps should not be written to expect any of these lifetimes to remain constant.</span></span> <span data-ttu-id="8339f-287">權杖存留期可以而且將會隨時變更。</span><span class="sxs-lookup"><span data-stu-id="8339f-287">Token lifetimes can and will change at any time.</span></span>

| <span data-ttu-id="8339f-288">權杖</span><span class="sxs-lookup"><span data-stu-id="8339f-288">Token</span></span> | <span data-ttu-id="8339f-289">存留期</span><span class="sxs-lookup"><span data-stu-id="8339f-289">Lifetime</span></span> | <span data-ttu-id="8339f-290">說明</span><span class="sxs-lookup"><span data-stu-id="8339f-290">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="8339f-291">識別碼權杖 (工作或學校帳戶)</span><span class="sxs-lookup"><span data-stu-id="8339f-291">ID tokens (work or school accounts)</span></span> |<span data-ttu-id="8339f-292">1 小時</span><span class="sxs-lookup"><span data-stu-id="8339f-292">1 hour</span></span> |<span data-ttu-id="8339f-293">識別碼權杖的有效期通常為 1 小時。</span><span class="sxs-lookup"><span data-stu-id="8339f-293">ID tokens typically are valid for 1 hour.</span></span> <span data-ttu-id="8339f-294">您的 Web 應用程式可以使用此相同的存留期來維護自己與使用者的工作階段 (建議)，或者您也可以選擇一個完全不同的工作階段存留期。</span><span class="sxs-lookup"><span data-stu-id="8339f-294">Your web app can use this same lifetime to maintain its own session with the user (recommended), or you can choose a completely different session lifetime.</span></span> <span data-ttu-id="8339f-295">如果您的應用程式需要取得新的識別碼權杖，它就需要對 v2.0 授權端點提出新的登入要求。</span><span class="sxs-lookup"><span data-stu-id="8339f-295">If your app needs to get a new ID token, it needs to make a new sign-in request to the v2.0 authorize endpoint.</span></span> <span data-ttu-id="8339f-296">如果使用者有 v2.0 端點的有效瀏覽器工作階段，則可能不需要再次輸入其認證。</span><span class="sxs-lookup"><span data-stu-id="8339f-296">If the user has a valid browser session with the v2.0 endpoint, the user might not be required to enter their credentials again.</span></span> |
| <span data-ttu-id="8339f-297">識別碼權杖 (個人帳戶)</span><span class="sxs-lookup"><span data-stu-id="8339f-297">ID tokens (personal accounts)</span></span> |<span data-ttu-id="8339f-298">24 小時</span><span class="sxs-lookup"><span data-stu-id="8339f-298">24 hours</span></span> |<span data-ttu-id="8339f-299">個人帳戶的識別碼權杖有效期通常為 24 小時。</span><span class="sxs-lookup"><span data-stu-id="8339f-299">ID tokens for personal accounts typically are valid for 24 hours.</span></span> <span data-ttu-id="8339f-300">您的 Web 應用程式可以使用此相同的存留期來維護自己與使用者的工作階段 (建議)，或者您也可以選擇一個完全不同的工作階段存留期。</span><span class="sxs-lookup"><span data-stu-id="8339f-300">Your web app can use this same lifetime to maintain its own session with the user (recommended), or you can choose a completely different session lifetime.</span></span> <span data-ttu-id="8339f-301">如果您的應用程式需要取得新的識別碼權杖，它就需要對 v2.0 授權端點提出新的登入要求。</span><span class="sxs-lookup"><span data-stu-id="8339f-301">If your app needs to get a new ID token, it needs to make a new sign-in request to the v2.0 authorize endpoint.</span></span> <span data-ttu-id="8339f-302">如果使用者有 v2.0 端點的有效瀏覽器工作階段，則可能不需要再次輸入其認證。</span><span class="sxs-lookup"><span data-stu-id="8339f-302">If the user has a valid browser session with the v2.0 endpoint, the user might not be required to enter their credentials again.</span></span> |
| <span data-ttu-id="8339f-303">存取權杖 (工作或學校帳戶)</span><span class="sxs-lookup"><span data-stu-id="8339f-303">Access tokens (work or school accounts)</span></span> |<span data-ttu-id="8339f-304">1 小時</span><span class="sxs-lookup"><span data-stu-id="8339f-304">1 hour</span></span> |<span data-ttu-id="8339f-305">在權杖回應中指出為權杖中繼資料的一部分。</span><span class="sxs-lookup"><span data-stu-id="8339f-305">Indicated in token responses as part of the token metadata.</span></span> |
| <span data-ttu-id="8339f-306">存取權杖 (個人帳戶)</span><span class="sxs-lookup"><span data-stu-id="8339f-306">Access tokens (personal accounts)</span></span> |<span data-ttu-id="8339f-307">1 小時</span><span class="sxs-lookup"><span data-stu-id="8339f-307">1 hour</span></span> |<span data-ttu-id="8339f-308">在權杖回應中指出為權杖中繼資料的一部分。</span><span class="sxs-lookup"><span data-stu-id="8339f-308">Indicated in token responses as part of the token metadata.</span></span> <span data-ttu-id="8339f-309">可以為代表個人帳戶簽發的存取權杖設定不同的存留期，但通常是一小時。</span><span class="sxs-lookup"><span data-stu-id="8339f-309">Access tokens that are issued on behalf of personal accounts can be configured for a different lifetime, but 1 hour is typical.</span></span> |
| <span data-ttu-id="8339f-310">重新整理權杖 (工作或學校帳戶)</span><span class="sxs-lookup"><span data-stu-id="8339f-310">Refresh tokens (work or school account)</span></span> |<span data-ttu-id="8339f-311">最多 14 天</span><span class="sxs-lookup"><span data-stu-id="8339f-311">Up to 14 days</span></span> |<span data-ttu-id="8339f-312">單一重新整理權杖的有效期最多 14 天。</span><span class="sxs-lookup"><span data-stu-id="8339f-312">A single refresh token is valid for a maximum of 14 days.</span></span> <span data-ttu-id="8339f-313">不過，重新整理權杖可能會因為各種原因而隨時失效，因此您的應用程式應該繼續嘗試使用重新整理權杖，直到其失敗為止，或直到您的應用程式以新的重新整理權杖取代它為止。</span><span class="sxs-lookup"><span data-stu-id="8339f-313">However, the refresh token might become invalid at any time for various reasons, so your app should continue to try to use a refresh token until it fails, or until your app replaces it with a new refresh token.</span></span> <span data-ttu-id="8339f-314">如果自使用者輸入其認證之後已達 90 天，則重新整理權杖也會失效。</span><span class="sxs-lookup"><span data-stu-id="8339f-314">A refresh token also becomes invalid if it has been 90 days since the user has entered their credentials.</span></span> |
| <span data-ttu-id="8339f-315">重新整理權杖 (個人帳戶)</span><span class="sxs-lookup"><span data-stu-id="8339f-315">Refresh tokens (personal accounts)</span></span> |<span data-ttu-id="8339f-316">最多 1 年</span><span class="sxs-lookup"><span data-stu-id="8339f-316">Up to 1 year</span></span> |<span data-ttu-id="8339f-317">單一重新整理權杖的有效期最多 1 年。</span><span class="sxs-lookup"><span data-stu-id="8339f-317">A single refresh token is valid for a maximum of 1 year.</span></span> <span data-ttu-id="8339f-318">不過，重新整理權杖可能會因為各種原因而隨時失效，因此您的應用程式應該繼續嘗試使用重新整理權杖，直到其失敗為止。</span><span class="sxs-lookup"><span data-stu-id="8339f-318">However, the refresh token might become invalid at any time for various reasons, so your app should continue to try to use a refresh token until it fails.</span></span> |
| <span data-ttu-id="8339f-319">授權碼 (工作或學校帳戶)</span><span class="sxs-lookup"><span data-stu-id="8339f-319">Authorization codes (work or school accounts)</span></span> |<span data-ttu-id="8339f-320">10 分鐘</span><span class="sxs-lookup"><span data-stu-id="8339f-320">10 minutes</span></span> |<span data-ttu-id="8339f-321">授權碼的存留期是蓄意設定得較短，應該在收到權杖時立即兌換存取權杖和重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-321">Authorization codes are purposely short-lived, and should be immediately redeemed for access tokens and refresh tokens when the tokens are received.</span></span> |
| <span data-ttu-id="8339f-322">授權碼 (個人帳戶)</span><span class="sxs-lookup"><span data-stu-id="8339f-322">Authorization codes (personal accounts)</span></span> |<span data-ttu-id="8339f-323">5 分鐘</span><span class="sxs-lookup"><span data-stu-id="8339f-323">5 minutes</span></span> |<span data-ttu-id="8339f-324">授權碼的存留期是蓄意設定得較短，應該在收到權杖時立即兌換存取權杖和重新整理權杖。</span><span class="sxs-lookup"><span data-stu-id="8339f-324">Authorization codes are purposely short-lived, and should be immediately redeemed for access tokens and refresh tokens when the tokens are received.</span></span> <span data-ttu-id="8339f-325">代表個人帳戶簽發的授權碼是供單次使用。</span><span class="sxs-lookup"><span data-stu-id="8339f-325">Authorization codes that are issued on behalf of personal accounts are for one-time use.</span></span> |
