---
title: "aaaHow toobuild 可以登入 Azure AD 中的任何使用者的應用程式 |Microsoft 文件"
description: "如何建置可讓使用者從任何 Azure Active Directory 租用戶登入之應用程式 (也稱為多租用戶應用程式) 的逐步解說。"
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 35af95cb-ced3-46ad-b01d-5d2f6fd064a3
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/26/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 123ea8125fa3c308ce0f124cc58e85ec28d476d5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="how-toosign-in-any-azure-active-directory-ad-user-using-hello-multi-tenant-application-pattern"></a><span data-ttu-id="96904-103">如何在任何 Azure Active Directory (AD) 使用者使用 toosign hello 多租用戶應用程式模式</span><span class="sxs-lookup"><span data-stu-id="96904-103">How toosign in any Azure Active Directory (AD) user using hello multi-tenant application pattern</span></span>
<span data-ttu-id="96904-104">如果您提供 「 軟體即服務應用程式 toomany 組織，您可以設定您應用程式 tooaccept 登入任何 Azure AD 租用戶。</span><span class="sxs-lookup"><span data-stu-id="96904-104">If you offer a Software as a Service application toomany organizations, you can configure your application tooaccept sign-ins from any Azure AD tenant.</span></span>  <span data-ttu-id="96904-105">在 Azure AD 中，這稱為讓您的應用程式成為多租用戶應用程式。</span><span class="sxs-lookup"><span data-stu-id="96904-105">In Azure AD this is called making your application multi-tenant.</span></span>  <span data-ttu-id="96904-106">在任何 Azure AD 租用戶中的使用者將無法 tooyour 後的應用程式中無法 toosign 同意 toouse 其帳戶與您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="96904-106">Users in any Azure AD tenant will be able toosign in tooyour application after consenting toouse their account with your application.</span></span>  

<span data-ttu-id="96904-107">如果您的現有應用程式有其自己的帳戶系統，或支援從其他雲端提供者執行其他登入方式，則新增從任何租用戶執行 Azure AD 登入很簡單。</span><span class="sxs-lookup"><span data-stu-id="96904-107">If you have an existing application that has its own account system, or supports other kinds of sign-in from other cloud providers, adding Azure AD sign-in from any tenant is simple.</span></span> <span data-ttu-id="96904-108">只要註冊您的應用程式、透過 OAuth2、OpenID Connect 或 SAML 新增登入程式碼，然後將 [使用 Microsoft 登入] 按鈕放在您的應用程式上即可。</span><span class="sxs-lookup"><span data-stu-id="96904-108">Just register your app, add sign-in code via OAuth2, OpenID Connect, or SAML, and put a "Sign In with Microsoft" button on your application.</span></span> <span data-ttu-id="96904-109">按一下下列按鈕 toolearn 深入了解您的應用程式的商標 hello。</span><span class="sxs-lookup"><span data-stu-id="96904-109">Click hello following button toolearn more about branding your application.</span></span>

<span data-ttu-id="96904-110">[![登入按鈕][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="96904-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="96904-111">本文假設您已經熟悉如何為 Azure AD 建置單一租用戶應用程式。</span><span class="sxs-lookup"><span data-stu-id="96904-111">This article assumes you’re already familiar with building a single tenant application for Azure AD.</span></span>  <span data-ttu-id="96904-112">如果您不這樣做，head 備份 toohello[開發人員指南首頁][ AAD-Dev-Guide] ，然後再次嘗試我們的快速入門的其中一個 ！</span><span class="sxs-lookup"><span data-stu-id="96904-112">If you’re not, head back up toohello [developer guide homepage][AAD-Dev-Guide] and try one of our quick starts!</span></span>

<span data-ttu-id="96904-113">有四個簡單步驟 tooconvert 到 Azure AD 多租用戶應用程式的應用程式：</span><span class="sxs-lookup"><span data-stu-id="96904-113">There are four simple steps tooconvert your application into an Azure AD multi-tenant app:</span></span>

1. <span data-ttu-id="96904-114">更新您的應用程式註冊 toobe 多租用戶</span><span class="sxs-lookup"><span data-stu-id="96904-114">Update your application registration toobe multi-tenant</span></span>
2. <span data-ttu-id="96904-115">更新您的程式碼 toosend 要求 toohello /common 端點</span><span class="sxs-lookup"><span data-stu-id="96904-115">Update your code toosend requests toohello /common endpoint</span></span> 
3. <span data-ttu-id="96904-116">更新您的程式碼 toohandle 多個簽發者值</span><span class="sxs-lookup"><span data-stu-id="96904-116">Update your code toohandle multiple issuer values</span></span>
4. <span data-ttu-id="96904-117">了解使用者和系統管理員的同意意向並進行適當的程式碼變更</span><span class="sxs-lookup"><span data-stu-id="96904-117">Understand user and admin consent and make appropriate code changes</span></span>

<span data-ttu-id="96904-118">讓我們仔細看看每個步驟。</span><span class="sxs-lookup"><span data-stu-id="96904-118">Let’s look at each step in detail.</span></span> <span data-ttu-id="96904-119">您也可以直接太跳[這份清單的多租用戶範例][AAD-Samples-MT]。</span><span class="sxs-lookup"><span data-stu-id="96904-119">You can also jump straight too[this list of multi-tenant samples][AAD-Samples-MT].</span></span>

## <a name="update-registration-toobe-multi-tenant"></a><span data-ttu-id="96904-120">更新註冊 toobe 多租用戶</span><span class="sxs-lookup"><span data-stu-id="96904-120">Update registration toobe multi-tenant</span></span>
<span data-ttu-id="96904-121">Azure AD 中的 Web 應用程式/API 註冊預設是單一租用戶。</span><span class="sxs-lookup"><span data-stu-id="96904-121">By default, web app/API registrations in Azure AD are single tenant.</span></span>  <span data-ttu-id="96904-122">您可以讓您註冊多租用戶尋找您的應用程式註冊在 hello hello 屬性頁面上的 hello"多 Tenanted"切換[Azure 入口網站][ AZURE-portal]並將其設定太"Yes"。</span><span class="sxs-lookup"><span data-stu-id="96904-122">You can make your registration multi-tenant by finding hello “Multi-Tenanted” switch on hello properties page of your application registration in hello [Azure portal][AZURE-portal] and setting it too“Yes”.</span></span>

<span data-ttu-id="96904-123">也請注意之前的應用程式可以由多租用戶，, Azure AD 需要 hello hello 應用程式 toobe 全域唯一的應用程式識別碼 URI。</span><span class="sxs-lookup"><span data-stu-id="96904-123">Also note, before an application can be made multi-tenant, Azure AD requires hello App ID URI of hello application toobe globally unique.</span></span> <span data-ttu-id="96904-124">hello 應用程式識別碼 URI 是應用程式識別通訊協定訊息中的 hello 方法之一。</span><span class="sxs-lookup"><span data-stu-id="96904-124">hello App ID URI is one of hello ways an application is identified in protocol messages.</span></span>  <span data-ttu-id="96904-125">單一租用戶應用程式中，就足夠 hello 應用程式識別碼 URI toobe 該租用戶中唯一的。</span><span class="sxs-lookup"><span data-stu-id="96904-125">For a single tenant application, it is sufficient for hello App ID URI toobe unique within that tenant.</span></span>  <span data-ttu-id="96904-126">為多租用戶應用程式，它必須是全域唯一讓 Azure AD 可以跨所有租用戶尋找 hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="96904-126">For a multi-tenant application, it must be globally unique so Azure AD can find hello application across all tenants.</span></span>  <span data-ttu-id="96904-127">藉由要求 hello 應用程式識別碼 URI toohave 符合 hello Azure AD 租用戶的已驗證的網域主機名稱會強制執行全域的唯一性。</span><span class="sxs-lookup"><span data-stu-id="96904-127">Global uniqueness is enforced by requiring hello App ID URI toohave a host name that matches a verified domain of hello Azure AD tenant.</span></span>  <span data-ttu-id="96904-128">例如，如果您的租用戶的 hello 名稱 contoso.onmicrosoft.com 則有效應用程式識別碼 URI 會`https://contoso.onmicrosoft.com/myapp`。</span><span class="sxs-lookup"><span data-stu-id="96904-128">For example, if hello name of your tenant was contoso.onmicrosoft.com then a valid App ID URI would be `https://contoso.onmicrosoft.com/myapp`.</span></span>  <span data-ttu-id="96904-129">如果租用戶具有已驗證的網域 `contoso.com`，則有效的「應用程式識別碼 URI」也會是 `https://contoso.com/myapp`。</span><span class="sxs-lookup"><span data-stu-id="96904-129">If your tenant had a verified domain of `contoso.com`, then a valid App ID URI would also be `https://contoso.com/myapp`.</span></span>  <span data-ttu-id="96904-130">Hello 應用程式識別碼 URI 未遵循此模式設定為多租用戶的應用程式將會失敗。</span><span class="sxs-lookup"><span data-stu-id="96904-130">Setting an application as multi-tenant will fail if hello App ID URI doesn’t follow this pattern.</span></span>

<span data-ttu-id="96904-131">原生用戶端註冊預設即為多租用戶。</span><span class="sxs-lookup"><span data-stu-id="96904-131">Native client registrations are multi-tenant by default.</span></span>  <span data-ttu-id="96904-132">您不需要任何動作 toomake 的原生用戶端應用程式註冊多租用戶 tootake。</span><span class="sxs-lookup"><span data-stu-id="96904-132">You don’t need tootake any action toomake a native client application registration multi-tenant.</span></span>

## <a name="update-your-code-toosend-requests-toocommon"></a><span data-ttu-id="96904-133">更新您的程式碼 toosend 要求太/一般</span><span class="sxs-lookup"><span data-stu-id="96904-133">Update your code toosend requests too/common</span></span>
<span data-ttu-id="96904-134">在單一租用戶應用程式中，登入要求會傳送 toohello 租用戶登入端點。</span><span class="sxs-lookup"><span data-stu-id="96904-134">In a single tenant application, sign-in requests are sent toohello tenant’s sign-in endpoint.</span></span> <span data-ttu-id="96904-135">例如，如 contoso.onmicrosoft.com hello 端點將會是：</span><span class="sxs-lookup"><span data-stu-id="96904-135">For example, for contoso.onmicrosoft.com hello endpoint would be:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="96904-136">傳送要求的租用戶 tooa 端點中該租用戶中的租用戶 tooapplications 登入使用者 （或來賓）。</span><span class="sxs-lookup"><span data-stu-id="96904-136">Requests sent tooa tenant’s endpoint can sign in users (or guests) in that tenant tooapplications in that tenant.</span></span>  <span data-ttu-id="96904-137">與多租用戶應用程式，並不知道 hello 應用程式最前面位置 hello 租用戶的使用者是從，因此無法傳送要求 tooa 租用戶端點。</span><span class="sxs-lookup"><span data-stu-id="96904-137">With a multi-tenant application, hello application doesn’t know up front what tenant hello user is from, so you can’t send requests tooa tenant’s endpoint.</span></span>  <span data-ttu-id="96904-138">相反地，要求會傳送信號分離跨所有的 Azure AD 租用戶的 tooan 端點：</span><span class="sxs-lookup"><span data-stu-id="96904-138">Instead, requests are sent tooan endpoint that multiplexes across all Azure AD tenants:</span></span>

    https://login.microsoftonline.com/common

<span data-ttu-id="96904-139">當 Azure AD 會收到要求時在 hello/一般端點，它 hello 使用者登入，而結果會探索哪些租用戶 hello 使用者是從。</span><span class="sxs-lookup"><span data-stu-id="96904-139">When Azure AD receives a request on hello /common endpoint, it signs hello user in and as a consequence discovers which tenant hello user is from.</span></span>  <span data-ttu-id="96904-140">hello/一般端點可以使用所有的 hello Azure AD 支援的驗證通訊協定： OpenID Connect、 OAuth 2.0、 SAML 2.0 和 WS-同盟。</span><span class="sxs-lookup"><span data-stu-id="96904-140">hello /common endpoint works with all of hello authentication protocols supported by Azure AD:  OpenID Connect, OAuth 2.0, SAML 2.0, and WS-Federation.</span></span>

<span data-ttu-id="96904-141">hello 登入回應 toohello 然後應用程式包含代表 hello 使用者的權杖。</span><span class="sxs-lookup"><span data-stu-id="96904-141">hello sign-in response toohello application then contains a token representing hello user.</span></span>  <span data-ttu-id="96904-142">hello 權杖中的 hello 簽發者值會告訴應用程式租用戶的 hello 使用者是從。</span><span class="sxs-lookup"><span data-stu-id="96904-142">hello issuer value in hello token tells an application what tenant hello user is from.</span></span>  <span data-ttu-id="96904-143">當回應會傳回從 hello/一般端點，hello 權杖中的 hello 簽發者值會對應 toohello 使用者的租用戶。</span><span class="sxs-lookup"><span data-stu-id="96904-143">When a response returns from hello /common endpoint, hello issuer value in hello token will correspond toohello user’s tenant.</span></span>  <span data-ttu-id="96904-144">它是重要 toonote hello/一般端點不是租用戶，而且不是簽發者，只要多工器。</span><span class="sxs-lookup"><span data-stu-id="96904-144">It’s important toonote hello /common endpoint is not a tenant and is not an issuer, it’s just a multiplexer.</span></span>  <span data-ttu-id="96904-145">使用時 /common，在您的應用程式 toovalidate 權杖中的 hello 邏輯必須更新 toobe tootake 這納入考量。</span><span class="sxs-lookup"><span data-stu-id="96904-145">When using /common, hello logic in your application toovalidate tokens needs toobe updated tootake this into account.</span></span> 

<span data-ttu-id="96904-146">稍早提到、 多租用戶應用程式也應該為使用者提供一致的登入體驗，如下列 hello Azure AD 應用程式的商標指導方針。</span><span class="sxs-lookup"><span data-stu-id="96904-146">As mentioned earlier, multi-tenant applications should also provide a consistent sign-in experience for users, following hello Azure AD application branding guidelines.</span></span> <span data-ttu-id="96904-147">按一下下列按鈕 toolearn 深入了解您的應用程式的商標 hello。</span><span class="sxs-lookup"><span data-stu-id="96904-147">Click hello following button toolearn more about branding your application.</span></span>

<span data-ttu-id="96904-148">[![登入按鈕][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="96904-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="96904-149">讓我們看看 hello /common hello 使用端點和您的程式碼中實作更多詳細資料。</span><span class="sxs-lookup"><span data-stu-id="96904-149">Let’s take a look at hello use of hello /common endpoint and your code implementation in more detail.</span></span>

## <a name="update-your-code-toohandle-multiple-issuer-values"></a><span data-ttu-id="96904-150">更新您的程式碼 toohandle 多個簽發者值</span><span class="sxs-lookup"><span data-stu-id="96904-150">Update your code toohandle multiple issuer values</span></span>
<span data-ttu-id="96904-151">Web 應用程式和 Web API 會接收並驗證來自 Azure AD 的權杖。</span><span class="sxs-lookup"><span data-stu-id="96904-151">Web applications and web APIs receive and validate tokens from Azure AD.</span></span>  

> [!NOTE]
> <span data-ttu-id="96904-152">在原生用戶端應用程式要求並接收來自 Azure AD 的權杖時，它們執行的動作是 toosend 它們 tooAPIs，驗證其中。</span><span class="sxs-lookup"><span data-stu-id="96904-152">While native client applications request and receive tokens from Azure AD, they do so toosend them tooAPIs, where they are validated.</span></span>  <span data-ttu-id="96904-153">原生應用程式不會驗證權杖，而且必須將它們視為不透明。</span><span class="sxs-lookup"><span data-stu-id="96904-153">Native applications do not validate tokens and must treat them as opaque.</span></span>
> 
> 

<span data-ttu-id="96904-154">讓我們看看應用程式如何驗證它從 Azure AD 接收的權杖。</span><span class="sxs-lookup"><span data-stu-id="96904-154">Let’s look at how an application validates tokens it receives from Azure AD.</span></span>  <span data-ttu-id="96904-155">單一租用戶應用程式通常會採用類似以下的端點值：</span><span class="sxs-lookup"><span data-stu-id="96904-155">A single tenant application will normally take an endpoint value like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="96904-156">並使用它 tooconstruct 中繼資料 URL （在此情況下，OpenID Connect） 類似：</span><span class="sxs-lookup"><span data-stu-id="96904-156">and use it tooconstruct a metadata URL (in this case, OpenID Connect) like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration

<span data-ttu-id="96904-157">toodownload 兩個重要的資訊片段，這是使用的 toovalidate 權杖： hello 租用戶的簽署金鑰和簽發者值。</span><span class="sxs-lookup"><span data-stu-id="96904-157">toodownload two critical pieces of information that are used toovalidate tokens:  hello tenant’s signing keys and issuer value.</span></span>  <span data-ttu-id="96904-158">每個 Azure AD 租用戶的簽發者唯一值為 hello 表單：</span><span class="sxs-lookup"><span data-stu-id="96904-158">Each Azure AD tenant has a unique issuer value of hello form:</span></span>

    https://sts.windows.net/31537af4-6d77-4bb9-a681-d2394888ea26/

<span data-ttu-id="96904-159">其中 hello GUID 值是 hello hello 租用戶的租用戶識別碼 hello 重新命名安全版本。</span><span class="sxs-lookup"><span data-stu-id="96904-159">where hello GUID value is hello rename-safe version of hello tenant ID of hello tenant.</span></span>  <span data-ttu-id="96904-160">如果您按一下前的中繼資料連結的 hello `contoso.onmicrosoft.com`，您可以看到這個 hello 文件中的簽發者值。</span><span class="sxs-lookup"><span data-stu-id="96904-160">If you click on hello preceding metadata link for `contoso.onmicrosoft.com`, you can see this issuer value in hello document.</span></span>

<span data-ttu-id="96904-161">當單一租用戶應用程式會驗證權杖時，它會檢查 hello 權杖簽署金鑰 hello 中繼資料文件的 hello hello 簽章。</span><span class="sxs-lookup"><span data-stu-id="96904-161">When a single tenant application validates a token, it checks hello signature of hello token against hello signing keys from hello metadata document.</span></span> <span data-ttu-id="96904-162">這可以讓它 toomake 確定 hello 簽發者值 hello 語彙基元的相符項目 hello 一個 hello 中繼資料文件中找到。</span><span class="sxs-lookup"><span data-stu-id="96904-162">This allows it toomake sure hello issuer value in hello token matches hello one that was found in hello metadata document.</span></span>

<span data-ttu-id="96904-163">由於 hello/一般端點未對應 tooa 租用戶，而且不是簽發者，當您檢查 hello 中繼資料中的 hello 簽發者值/常見它具有一個樣板化的 URL，而不是實際的值：</span><span class="sxs-lookup"><span data-stu-id="96904-163">Since hello /common endpoint doesn’t correspond tooa tenant and isn’t an issuer, when you examine hello issuer value in hello metadata for /common it has a templated URL instead of an actual value:</span></span>

    https://sts.windows.net/{tenantid}/

<span data-ttu-id="96904-164">因此，多租用戶應用程式時，無法只藉由比對以 hello hello 中繼資料中的 hello 簽發者值驗證語彙基元`issuer`hello 權杖中的值。</span><span class="sxs-lookup"><span data-stu-id="96904-164">Therefore, a multi-tenant application can’t validate tokens just by matching hello issuer value in hello metadata with hello `issuer` value in hello token.</span></span>  <span data-ttu-id="96904-165">多租用戶應用程式的簽發者值有效，而且可不需要邏輯 toodecide，根據 hello 租用戶識別碼部分 hello 簽發者值。</span><span class="sxs-lookup"><span data-stu-id="96904-165">A multi-tenant application needs logic toodecide which issuer values are valid and which are not, based on hello tenant ID portion of hello issuer value.</span></span>  

<span data-ttu-id="96904-166">例如，如果多租用戶應用程式僅允許登入特定的租用戶已註冊的服務，然後它必須檢查 hello 簽發者值或 hello`tid`宣告在 hello 語彙基元 toomake 確定該租用戶的清單中的值訂閱者。</span><span class="sxs-lookup"><span data-stu-id="96904-166">For example, if a multi-tenant application only allows sign-in from specific tenants who have signed up for their service, then it must check either hello issuer value or hello `tid` claim value in hello token toomake sure that tenant is in their list of subscribers.</span></span>  <span data-ttu-id="96904-167">如果多租用戶應用程式僅處理個人版，並沒有做出任何存取根據租用戶，則其可以忽略 hello 簽發者值完全。</span><span class="sxs-lookup"><span data-stu-id="96904-167">If a multi-tenant application only deals with individuals and doesn’t make any access decisions based on tenants, then it can ignore hello issuer value altogether.</span></span>

<span data-ttu-id="96904-168">在 hello hello 多租用戶範例[相關內容](#related-content)在本文中，簽發者驗證的 hello 結尾的區段是已停用的 tooenable 中的任何 Azure AD 租用戶 toosign。</span><span class="sxs-lookup"><span data-stu-id="96904-168">In hello multi-tenant samples in hello [Related Content](#related-content) section at hello end of this article, issuer validation is disabled tooenable any Azure AD tenant toosign in.</span></span>

<span data-ttu-id="96904-169">現在讓我們看看 hello 登入 toomulti 租用戶應用程式的使用者的使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="96904-169">Now let’s look at hello user experience for users that are signing in toomulti-tenant applications.</span></span>

## <a name="understanding-user-and-admin-consent"></a><span data-ttu-id="96904-170">了解使用者和系統管理員的同意意向</span><span class="sxs-lookup"><span data-stu-id="96904-170">Understanding user and admin consent</span></span>
<span data-ttu-id="96904-171">Hello 應用程式必須針對使用者 toosign tooan 在 Azure AD 中的應用程式中，表示 hello 使用者的租用戶中。</span><span class="sxs-lookup"><span data-stu-id="96904-171">For a user toosign in tooan application in Azure AD, hello application must be represented in hello user’s tenant.</span></span>  <span data-ttu-id="96904-172">這可讓組織 hello toodo 等項目套用唯一的原則，從其租用戶的使用者登入時 toohello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="96904-172">This allows hello organization toodo things like apply unique policies when users from their tenant sign in toohello application.</span></span>  <span data-ttu-id="96904-173">單一租用戶應用程式中，此註冊很簡單;它具有 hello hello 註冊 hello 應用程式時，會發生情況的其中一個[Azure 入口網站][AZURE-portal]。</span><span class="sxs-lookup"><span data-stu-id="96904-173">For a single tenant application, this registration is simple; it’s hello one that happens when you register hello application in hello [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="96904-174">為多租用戶應用程式，hello hello 應用程式的初始註冊位於 hello hello 開發人員所使用的 Azure AD 租用戶。</span><span class="sxs-lookup"><span data-stu-id="96904-174">For a multi-tenant application, hello initial registration for hello application lives in hello Azure AD tenant used by hello developer.</span></span>  <span data-ttu-id="96904-175">當使用者從不同的租用戶登入時 toohello 應用程式的 hello 第一次時，Azure AD 會要求他們 hello 應用程式所要求的 tooconsent toohello 權限。</span><span class="sxs-lookup"><span data-stu-id="96904-175">When a user from a different tenant signs in toohello application for hello first time, Azure AD asks them tooconsent toohello permissions requested by hello application.</span></span>  <span data-ttu-id="96904-176">如果他們同意，則 hello 應用程式的表示法稱為*服務主體*中建立 hello 使用者的租用戶，而且登入可以繼續。</span><span class="sxs-lookup"><span data-stu-id="96904-176">If they consent, then a representation of hello application called a *service principal* is created in hello user’s tenant, and sign-in can continue.</span></span> <span data-ttu-id="96904-177">委派，也會建立 hello 記錄 hello 使用者同意 toohello 應用程式的目錄中。</span><span class="sxs-lookup"><span data-stu-id="96904-177">A delegation is also created in hello directory that records hello user’s consent toohello application.</span></span> <span data-ttu-id="96904-178">請參閱[應用程式與服務主體物件][ AAD-App-SP-Objects]需 hello 應用程式的應用程式和 ServicePrincipal 物件，和如何彼此 tooeach 其他詳細資料。</span><span class="sxs-lookup"><span data-stu-id="96904-178">See [Application Objects and Service Principal Objects][AAD-App-SP-Objects] for details on hello application's Application and ServicePrincipal objects, and how they relate tooeach other.</span></span>

![同意 toosingle 層應用程式][Consent-Single-Tier] 

<span data-ttu-id="96904-180">此同意體驗會受到 hello hello 應用程式所要求的權限。</span><span class="sxs-lookup"><span data-stu-id="96904-180">This consent experience is affected by hello permissions requested by hello application.</span></span>  <span data-ttu-id="96904-181">Azure AD 支援兩種類型的權限，即僅限應用程式的權限和委派的權限︰</span><span class="sxs-lookup"><span data-stu-id="96904-181">Azure AD supports two kinds of permissions, app-only and delegated:</span></span>

* <span data-ttu-id="96904-182">委派的權限授與應用程式 hello 能力 tooact，登入的使用者子集的 hello 事項 hello 使用者一樣。</span><span class="sxs-lookup"><span data-stu-id="96904-182">A delegated permission grants an application hello ability tooact as a signed in user for a subset of hello things hello user can do.</span></span>  <span data-ttu-id="96904-183">例如，您可以授與登入使用者的行事曆應用程式 hello 委派權限 tooread hello。</span><span class="sxs-lookup"><span data-stu-id="96904-183">For example, you can grant an application hello delegated permission tooread hello signed in user’s calendar.</span></span>
* <span data-ttu-id="96904-184">僅限應用程式的權限授與直接 toohello hello 應用程式識別。</span><span class="sxs-lookup"><span data-stu-id="96904-184">An app-only permission is granted directly toohello identity of hello application.</span></span>  <span data-ttu-id="96904-185">例如，您可以授與的應用程式 hello 僅限應用程式的權限 tooread hello 清單中的租用戶，不論使用者登入 toohello 應用程式的使用者。</span><span class="sxs-lookup"><span data-stu-id="96904-185">For example, you can grant an application hello app-only permission tooread hello list of users in a tenant, regardless of who is signed in toohello application.</span></span>

<span data-ttu-id="96904-186">某些權限可以是已獲得同意的 tooby 一般使用者，而有些則需要在租用戶系統管理員的同意。</span><span class="sxs-lookup"><span data-stu-id="96904-186">Some permissions can be consented tooby a regular user, while others require a tenant administrator’s consent.</span></span> 

### <a name="admin-consent"></a><span data-ttu-id="96904-187">系統管理員同意</span><span class="sxs-lookup"><span data-stu-id="96904-187">Admin consent</span></span>
<span data-ttu-id="96904-188">僅限應用程式的權限一律需要租用戶系統管理員的同意。</span><span class="sxs-lookup"><span data-stu-id="96904-188">App-only permissions always require a tenant administrator’s consent.</span></span>  <span data-ttu-id="96904-189">如果您的應用程式要求僅限應用程式的權限，而且使用者嘗試 toosign toohello 應用程式中的，將指出 hello 使用者不能 tooconsent 顯示錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="96904-189">If your application requests an app-only permission and a user tries toosign in toohello application, an error message will be displayed saying hello user isn’t able tooconsent.</span></span>

<span data-ttu-id="96904-190">有些委派的權限也需要租用戶系統管理員的同意。</span><span class="sxs-lookup"><span data-stu-id="96904-190">Certain delegated permissions also require a tenant administrator’s consent.</span></span>  <span data-ttu-id="96904-191">比方說，hello 能力 toowrite 後 tooAzure AD hello 登入的使用者為要求的租用戶系統管理員同意。</span><span class="sxs-lookup"><span data-stu-id="96904-191">For example, hello ability toowrite back tooAzure AD as hello signed in user requires a tenant administrator’s consent.</span></span>  <span data-ttu-id="96904-192">僅限應用程式的權限，例如，如果一般的使用者嘗試 toosign tooan 要求需要管理員同意的委派權限的應用程式中您的應用程式會收到錯誤。</span><span class="sxs-lookup"><span data-stu-id="96904-192">Like app-only permissions, if an ordinary user tries toosign in tooan application that requests a delegated permission that requires administrator consent, your application will receive an error.</span></span>  <span data-ttu-id="96904-193">需要權限獲得管理員同意取決於發行 hello 資源的 hello 開發人員，而且可以在 hello 文件以 hello 資源中找到。</span><span class="sxs-lookup"><span data-stu-id="96904-193">Whether or not a permission requires admin consent is determined by hello developer that published hello resource, and can be found in hello documentation for hello resource.</span></span>  <span data-ttu-id="96904-194">連結 tootopics 說明 hello 可用權限 hello Azure AD Graph API 和 Microsoft Graph API 位於 hello[相關內容](#related-content)本文一節。</span><span class="sxs-lookup"><span data-stu-id="96904-194">Links tootopics describing hello available permissions for hello Azure AD Graph API and Microsoft Graph API are in hello [Related Content](#related-content) section of this article.</span></span>

<span data-ttu-id="96904-195">如果您的應用程式使用需要獲得管理員同意權限，您會需要 toohave 手勢，例如按鈕或連結 hello 系統管理員可以在其中啟動 hello 動作。</span><span class="sxs-lookup"><span data-stu-id="96904-195">If your application uses permissions that require admin consent, you need toohave a gesture such as a button or link where hello admin can initiate hello action.</span></span>  <span data-ttu-id="96904-196">您的應用程式傳送這個動作是一般 OAuth2/OpenID Connect 授權要求，但也包含 hello hello 要求`prompt=admin_consent`查詢字串參數。</span><span class="sxs-lookup"><span data-stu-id="96904-196">hello request your application sends for this action is a usual OAuth2/OpenID Connect authorization request, but that also includes hello `prompt=admin_consent` query string parameter.</span></span>  <span data-ttu-id="96904-197">後續登入要求之後 hello 系統管理員同意和 hello 客戶的租用戶建立 hello 服務主體，不需要 hello`prompt=admin_consent`參數。</span><span class="sxs-lookup"><span data-stu-id="96904-197">Once hello admin has consented and hello service principal is created in hello customer’s tenant, subsequent sign-in requests do not need hello `prompt=admin_consent` parameter.</span></span> <span data-ttu-id="96904-198">Hello 系統管理員決定 hello 要求權限是可接受，因為將會從該點之後的同意不提示 hello 租用戶中的任何其他使用者。</span><span class="sxs-lookup"><span data-stu-id="96904-198">Since hello administrator has decided hello requested permissions are acceptable, no other users in hello tenant will be prompted for consent from that point forward.</span></span>

<span data-ttu-id="96904-199">hello`prompt=admin_consent`要求權限，不需要獲得管理員同意的應用程式也可以使用參數。</span><span class="sxs-lookup"><span data-stu-id="96904-199">hello `prompt=admin_consent` parameter can also be used by applications that request permissions that do not require admin consent.</span></span> <span data-ttu-id="96904-200">這是當 hello 應用程式需要體驗其中 hello 租用戶系統管理員 「 註冊 」 一次，且沒有其他系統會提示使用者的同意層級從該點上。</span><span class="sxs-lookup"><span data-stu-id="96904-200">This is done when hello applicaton requires an experience where hello tenant admin “signs up” one time, and no other users are prompted for consent from that point on.</span></span>

<span data-ttu-id="96904-201">如果應用程式需要系統管理員同意和管理員簽署在但 hello`prompt=admin_consent`參數不會傳送、 hello 系統管理員已成功將同意 toohello 應用程式**只為其使用者帳戶**。</span><span class="sxs-lookup"><span data-stu-id="96904-201">If an application requires admin consent, and an admin signs in but hello `prompt=admin_consent` parameter is not sent, hello admin will successfully consent toohello application **only for their user account**.</span></span>  <span data-ttu-id="96904-202">一般使用者仍不會在無法 toosign 和同意 toohello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="96904-202">Regular users will still not be able toosign in and consent toohello application.</span></span>  <span data-ttu-id="96904-203">這非常有用，如果您想 toogive hello 租用戶系統管理員 hello 能力 tooexplore 您的應用程式，才能允許其他使用者的存取。</span><span class="sxs-lookup"><span data-stu-id="96904-203">This is useful if you want toogive hello tenant administrator hello ability tooexplore your application before allowing other users access.</span></span>

<span data-ttu-id="96904-204">租用戶系統管理員可以停用一般使用者 tooconsent tooapplications hello 能力。</span><span class="sxs-lookup"><span data-stu-id="96904-204">A tenant administrator can disable hello ability for regular users tooconsent tooapplications.</span></span>  <span data-ttu-id="96904-205">這項功能已停用，都一律需要 hello hello 租用戶中設定的應用程式 toobe 獲得管理員同意。</span><span class="sxs-lookup"><span data-stu-id="96904-205">If this capability is disabled, admin consent is always required for hello application toobe set up in hello tenant.</span></span>  <span data-ttu-id="96904-206">如果您想的 tootest 停用您的應用程式，一般使用者同意的情況下，您可以找到 hello 的組態參數： hello Azure AD 租用戶中的 hello 的組態區段[Azure 入口網站][AZURE-portal]。</span><span class="sxs-lookup"><span data-stu-id="96904-206">If you want tootest your application with regular user consent disabled, you can find hello configuration switch in hello Azure AD tenant configuration section of hello [Azure portal][AZURE-portal].</span></span>

> [!NOTE]
> <span data-ttu-id="96904-207">某些應用程式想要運作的一般使用者能 tooconsent 一開始，而稍後 hello 應用程式可能是 hello 系統管理員並要求權限的系統管理員同意體驗。</span><span class="sxs-lookup"><span data-stu-id="96904-207">Some applications want an experience where regular users are able tooconsent initially, and later hello application can involve hello administrator and request permissions that require admin consent.</span></span>  <span data-ttu-id="96904-208">沒有任何方式 toodo 這與單一應用程式註冊在現今 Azure AD 中。</span><span class="sxs-lookup"><span data-stu-id="96904-208">There is no way toodo this with a single application registration in Azure AD today.</span></span>  <span data-ttu-id="96904-209">hello 即將推出的 Azure AD v2 端點可讓應用程式 toorequest 權限，在執行階段，而不是在登錄時，會啟用此案例。</span><span class="sxs-lookup"><span data-stu-id="96904-209">hello upcoming Azure AD v2 endpoint will allow applications toorequest permissions at runtime, instead of at registration time, which will enable this scenario.</span></span>  <span data-ttu-id="96904-210">如需詳細資訊，請參閱 hello [Azure AD 應用程式模型 v2 開發人員指南][AAD-V2-Dev-Guide]。</span><span class="sxs-lookup"><span data-stu-id="96904-210">For more information, see hello [Azure AD App Model v2 Developer Guide][AAD-V2-Dev-Guide].</span></span>
> 
> 

### <a name="consent-and-multi-tier-applications"></a><span data-ttu-id="96904-211">同意和多層應用程式</span><span class="sxs-lookup"><span data-stu-id="96904-211">Consent and multi-tier applications</span></span>
<span data-ttu-id="96904-212">您的應用程式可能會有多層，每一層皆由它自己在 Azure AD 中的註冊代表。</span><span class="sxs-lookup"><span data-stu-id="96904-212">Your application may have multiple tiers, each represented by its own registration in Azure AD.</span></span>  <span data-ttu-id="96904-213">例如，一個呼叫 Web API 的原生應用程式，或是一個呼叫 Web API 的 Web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="96904-213">For example, a native application that calls a web API, or a web application that calls a web API.</span></span>  <span data-ttu-id="96904-214">在這兩種情況下，hello 用戶端 （原生應用程式或 web 應用程式） 會要求權限 toocall hello 資源 (web 應用程式開發介面)。</span><span class="sxs-lookup"><span data-stu-id="96904-214">In both of these cases, hello client (native app or web app) requests permissions toocall hello resource (web API).</span></span>  <span data-ttu-id="96904-215">針對 hello 用戶端 toobe 成功同意至客戶的租用戶，它會要求權限的所有資源 toowhich 必須存都在於 hello 客戶的租用戶。</span><span class="sxs-lookup"><span data-stu-id="96904-215">For hello client toobe successfully consented into a customer’s tenant, all resources toowhich it requests permissions must already exist in hello customer’s tenant.</span></span>  <span data-ttu-id="96904-216">如果不符合此條件，Azure AD 會傳回必須先新增 hello 資源時發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="96904-216">If this condition isn’t met, Azure AD will return an error that hello resource must be added first.</span></span>

<span data-ttu-id="96904-217">**單一租用戶中的多層**</span><span class="sxs-lookup"><span data-stu-id="96904-217">**Multiple tiers in a single tenant**</span></span>

<span data-ttu-id="96904-218">如果您的邏輯應用程式包含兩個或更多個應用程式註冊 (例如個別的用戶端和資源)，這可能會造成問題。</span><span class="sxs-lookup"><span data-stu-id="96904-218">This can be a problem if your logical application consists of two or more application registrations, for example a separate client and resource.</span></span>  <span data-ttu-id="96904-219">如何取得 hello 資源 hello 客戶租用戶到第一個？</span><span class="sxs-lookup"><span data-stu-id="96904-219">How do you get hello resource into hello customer tenant first?</span></span>  <span data-ttu-id="96904-220">Azure AD 涵蓋此案例藉由啟用用戶端和資源 toobe 同意以單一步驟。</span><span class="sxs-lookup"><span data-stu-id="96904-220">Azure AD covers this case by enabling client and resource toobe consented in a single step.</span></span> <span data-ttu-id="96904-221">hello 使用者會看見 hello 總和的 hello hello 用戶端和 hello 同意頁面上的資源要求的權限。</span><span class="sxs-lookup"><span data-stu-id="96904-221">hello user sees hello sum total of hello permissions requested by both hello client and resource on hello consent page.</span></span>  <span data-ttu-id="96904-222">tooenable 這種行為，hello 資源的應用程式註冊必須包含 hello 用戶端應用程式識別碼，表示為`knownClientApplications`應用程式資訊清單中。</span><span class="sxs-lookup"><span data-stu-id="96904-222">tooenable this behavior, hello resource’s application registration must include hello client’s App ID as a `knownClientApplications` in its application manifest.</span></span>  <span data-ttu-id="96904-223">例如：</span><span class="sxs-lookup"><span data-stu-id="96904-223">For example:</span></span>

    knownClientApplications": ["94da0930-763f-45c7-8d26-04d5938baab2"]

<span data-ttu-id="96904-224">此屬性可以透過 hello 資源更新[應用程式的資訊清單][AAD-App-Manifest]。</span><span class="sxs-lookup"><span data-stu-id="96904-224">This property can be updated via hello resource [application’s manifest][AAD-App-Manifest].</span></span> <span data-ttu-id="96904-225">這示範於多層式的原生用戶端，在 hello 呼叫 web API 範例[相關內容](#related-content)hello 本文結尾 > 一節。</span><span class="sxs-lookup"><span data-stu-id="96904-225">This is demonstrated in a multi-tier native client calling web API sample in hello [Related Content](#related-content) section at hello end of this article.</span></span> <span data-ttu-id="96904-226">hello 圖概略說明同意在單一租用戶中註冊之多層式應用程式：</span><span class="sxs-lookup"><span data-stu-id="96904-226">hello following diagram provides an overview of consent for a multi-tier app registered in a single tenant :</span></span>

![同意 toomulti 層已知的用戶端應用程式][Consent-Multi-Tier-Known-Client] 

<span data-ttu-id="96904-228">**多個租用戶中的多層**</span><span class="sxs-lookup"><span data-stu-id="96904-228">**Multiple tiers in multiple tenants**</span></span>

<span data-ttu-id="96904-229">如果 hello 不同的應用程式層會在不同的租用戶中註冊，則會發生類似的案例。</span><span class="sxs-lookup"><span data-stu-id="96904-229">A similar case happens if hello different tiers of an application are registered in different tenants.</span></span>  <span data-ttu-id="96904-230">例如，請考慮 hello 的建置呼叫 hello Office 365 Exchange Online API 的原生用戶端應用程式的大小寫。</span><span class="sxs-lookup"><span data-stu-id="96904-230">For example, consider hello case of building a native client application that calls hello Office 365 Exchange Online API.</span></span>  <span data-ttu-id="96904-231">應用程式，及更新版本的客戶的租用戶中的 hello 原生應用程式 toorun，toodevelop hello 原生、 hello Exchange Online 服務主體必須存在。</span><span class="sxs-lookup"><span data-stu-id="96904-231">toodevelop hello native application, and later for hello native application toorun in a customer’s tenant, hello Exchange Online service principal must be present.</span></span>  <span data-ttu-id="96904-232">在此情況下，hello 開發人員和客戶購買 Exchange Online 的 hello 服務主體 toobe 其租用戶中建立。</span><span class="sxs-lookup"><span data-stu-id="96904-232">In this case, hello developer and customer must purchase Exchange Online for hello service principal toobe created in their tenants.</span></span>  

<span data-ttu-id="96904-233">在應用程式開發介面，由 Microsoft 以外的組織所建立的 hello 情況下，hello 的 hello API 的開發人員必須 tooprovide 方式他們的客戶 tooconsent hello 的應用程式至其客戶的租用戶。</span><span class="sxs-lookup"><span data-stu-id="96904-233">In hello case of an API built by an organization other than Microsoft, hello developer of hello API needs tooprovide a way for their customers tooconsent hello application into their customers' tenants.</span></span> <span data-ttu-id="96904-234">hello 建議設計為 hello 第 3 個合作對象開發人員 toobuild hello 應用程式開發介面，它也可以當作 web 用戶端 tooimplement 註冊：</span><span class="sxs-lookup"><span data-stu-id="96904-234">hello recommended design is for hello 3rd party developer toobuild hello API such that it can also function as a web client tooimplement sign-up :</span></span>

1. <span data-ttu-id="96904-235">請遵循 hello 先前各節 tooensure hello API 實作 hello 多租用戶應用程式登錄/程式碼的需求</span><span class="sxs-lookup"><span data-stu-id="96904-235">Follow hello earlier sections tooensure hello API implements hello multi-tenant application registration/code requirements</span></span>
2. <span data-ttu-id="96904-236">此外 tooexposing hello 應用程式開發介面的範圍/角色，請確定 hello 註冊包含 hello 」 登入並讀取使用者設定檔"（預設值所提供） 的 Azure AD 權限</span><span class="sxs-lookup"><span data-stu-id="96904-236">In addition tooexposing hello API's scopes/roles, ensure hello registration includes hello "Sign in and read user profile" Azure AD permission (provided by default)</span></span>
3. <span data-ttu-id="96904-237">在 hello web 用戶端，遵循 hello 中實作登在 /-註冊頁面[獲得管理員同意](#admin-consent)先前討論一般指導方針</span><span class="sxs-lookup"><span data-stu-id="96904-237">Implement a sign-in/sign-up page in hello web client, following hello [admin consent](#admin-consent) guidance discussed earlier</span></span> 
4. <span data-ttu-id="96904-238">一旦 hello 使用者同意 toohello 應用程式，hello 服務主體和同意委派連結便會建立在其租用戶和 hello 原生應用程式可以取得 hello API 的語彙基元</span><span class="sxs-lookup"><span data-stu-id="96904-238">Once hello user consents toohello application, hello service principal and consent delegation links are created in their tenant, and hello native application can get tokens for hello API</span></span>

<span data-ttu-id="96904-239">下列圖表中的 hello 概略說明同意在不同的租用戶中註冊之多層式應用程式：</span><span class="sxs-lookup"><span data-stu-id="96904-239">hello following diagram provides an overview of consent for a multi-tier app registered in different tenants:</span></span>

![同意 toomulti 層多方應用程式][Consent-Multi-Tier-Multi-Party] 

### <a name="revoking-consent"></a><span data-ttu-id="96904-241">撤銷同意</span><span class="sxs-lookup"><span data-stu-id="96904-241">Revoking Consent</span></span>
<span data-ttu-id="96904-242">使用者和系統管理員可以撤銷同意 tooyour 應用程式在任何時間：</span><span class="sxs-lookup"><span data-stu-id="96904-242">Users and administrators can revoke consent tooyour application at any time:</span></span>

* <span data-ttu-id="96904-243">使用者撤銷存取 tooindividual 應用程式移除它們從其[存取面板應用程式][ AAD-Access-Panel]清單。</span><span class="sxs-lookup"><span data-stu-id="96904-243">Users revoke access tooindividual applications by removing them from their [Access Panel Applications][AAD-Access-Panel] list.</span></span>
* <span data-ttu-id="96904-244">系統管理員移除 hello hello Azure AD 管理一節，使用 Azure AD 撤銷存取 tooapplications [Azure 入口網站][AZURE-portal]。</span><span class="sxs-lookup"><span data-stu-id="96904-244">Administrators revoke access tooapplications by removing them from Azure AD using hello Azure AD management section of hello [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="96904-245">如果系統管理員同意時 tooan 租用戶中的所有使用者的應用程式，使用者就無法個別撤銷存取權。</span><span class="sxs-lookup"><span data-stu-id="96904-245">If an administrator consents tooan application for all users in a tenant, users cannot revoke access individually.</span></span>  <span data-ttu-id="96904-246">只有 hello 系統管理員可以撤銷存取權，而且只會針對 hello 整個應用程式。</span><span class="sxs-lookup"><span data-stu-id="96904-246">Only hello administrator can revoke access, and only for hello whole application.</span></span>

### <a name="consent-and-protocol-support"></a><span data-ttu-id="96904-247">同意和通訊協定支援</span><span class="sxs-lookup"><span data-stu-id="96904-247">Consent and Protocol Support</span></span>
<span data-ttu-id="96904-248">同意 hello OAuth、 OpenID Connect，透過 Azure ad 支援 WS-同盟和 SAML 通訊協定。</span><span class="sxs-lookup"><span data-stu-id="96904-248">Consent is supported in Azure AD via hello OAuth, OpenID Connect, WS-Federation, and SAML protocols.</span></span>  <span data-ttu-id="96904-249">hello SAML 和 WS-同盟通訊協定不支援 hello`prompt=admin_consent`參數，因此系統管理員同意才可透過 OAuth 和 OpenID Connect。</span><span class="sxs-lookup"><span data-stu-id="96904-249">hello SAML and WS-Federation protocols do not support hello `prompt=admin_consent` parameter, so admin consent is only possible via OAuth and OpenID Connect.</span></span>

## <a name="multi-tenant-applications-and-caching-access-tokens"></a><span data-ttu-id="96904-250">多租用戶應用程式和快取存取權杖</span><span class="sxs-lookup"><span data-stu-id="96904-250">Multi-Tenant Applications and Caching Access Tokens</span></span>
<span data-ttu-id="96904-251">多租用戶應用程式也可以取得存取權杖 toocall Azure AD 所保護的應用程式開發介面。</span><span class="sxs-lookup"><span data-stu-id="96904-251">Multi-tenant applications can also get access tokens toocall APIs that are protected by Azure AD.</span></span>  <span data-ttu-id="96904-252">使用 hello Active Directory 驗證程式庫 (ADAL) 的多租用戶應用程式時常見的錯誤 tooinitially 要求使用者使用 /common 語彙基元、 接收回應，然後要求該相同的使用者，同時也使用 /common 後續的權杖。</span><span class="sxs-lookup"><span data-stu-id="96904-252">A common error when using hello Active Directory Authentication Library (ADAL) with a multi-tenant application, is tooinitially request a token for a user using /common, receive a response, then request a subsequent token for that same user also using /common.</span></span>  <span data-ttu-id="96904-253">因為從 Azure AD 的 hello 回應不會從租用戶，/通用，ADAL 會快取為來自 hello 租用戶的 hello 語彙基元。</span><span class="sxs-lookup"><span data-stu-id="96904-253">Since hello response from Azure AD comes from a tenant, not /common, ADAL caches hello token as being from hello tenant.</span></span> <span data-ttu-id="96904-254">hello 後續呼叫太/一般 tooget hello 使用者遺漏 hello 快取項目和 hello 使用者的存取權杖是提示的 toosign 中一次。</span><span class="sxs-lookup"><span data-stu-id="96904-254">hello subsequent call too/common tooget an access token for hello user misses hello cache entry, and hello user is prompted toosign in again.</span></span>  <span data-ttu-id="96904-255">tooavoid 遺漏 hello 快取，請確定後續已登入的使用者會呼叫 toohello 租用戶端點。</span><span class="sxs-lookup"><span data-stu-id="96904-255">tooavoid missing hello cache, make sure subsequent calls for an already signed in user are made toohello tenant’s endpoint.</span></span>

## <a name="next-steps"></a><span data-ttu-id="96904-256">後續步驟</span><span class="sxs-lookup"><span data-stu-id="96904-256">Next steps</span></span>
<span data-ttu-id="96904-257">在本文中，您學到如何 toobuild 可以登入任何 Azure Active Directory 租用戶中的應用程式。</span><span class="sxs-lookup"><span data-stu-id="96904-257">In this article, you learned how toobuild an application that can sign in a user from any Azure Active Directory tenant.</span></span> <span data-ttu-id="96904-258">啟用單一登入您的應用程式與 Azure Active Directory 之間之後, 您也可以更新您的應用程式 tooaccess Microsoft 資源，例如 Office 365 所公開的 Api。</span><span class="sxs-lookup"><span data-stu-id="96904-258">After enabling Single Sign-On between your app and Azure Active Directory, you can also update your application tooaccess APIs exposed by Microsoft resources, like Office 365.</span></span> <span data-ttu-id="96904-259">因此您可以提供個人化的經驗中您的應用程式，例如顯示 toohello 使用者，其設定檔圖片或其下一個行事曆約會等內容的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="96904-259">So you can offer a personalized experience in your application, for example showing contextual information toohello users, like their profile picture or their next calendar appointment.</span></span> <span data-ttu-id="96904-260">toolearn 深入了解進行 API 呼叫 tooAzure Active Directory 和 Office 365 服務，例如 Exchange、 SharePoint、 OneDrive、 OneNote、 Planner、 Excel 和詳細資訊，請造訪： [Microsoft Graph API][MSFT-Graph-overview]。</span><span class="sxs-lookup"><span data-stu-id="96904-260">toolearn more about making API calls tooAzure Active Directory and Office 365 services like Exchange, SharePoint, OneDrive, OneNote, Planner, Excel and more, visit: [Microsoft Graph API][MSFT-Graph-overview].</span></span>


## <a name="related-content"></a><span data-ttu-id="96904-261">相關內容</span><span class="sxs-lookup"><span data-stu-id="96904-261">Related content</span></span>
* <span data-ttu-id="96904-262">[多租用戶應用程式範例][AAD-Samples-MT]</span><span class="sxs-lookup"><span data-stu-id="96904-262">[Multi-tenant application samples][AAD-Samples-MT]</span></span>
* <span data-ttu-id="96904-263">[應用程式的商標指導方針][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="96904-263">[Branding Guidelines for Applications][AAD-App-Branding]</span></span>
* <span data-ttu-id="96904-264">[Azure AD 開發人員指南][AAD-Dev-Guide]</span><span class="sxs-lookup"><span data-stu-id="96904-264">[Azure AD Developer's Guide][AAD-Dev-Guide]</span></span>
* <span data-ttu-id="96904-265">[應用程式物件和服務主體物件][AAD-App-SP-Objects]</span><span class="sxs-lookup"><span data-stu-id="96904-265">[Application Objects and Service Principal Objects][AAD-App-SP-Objects]</span></span>
* <span data-ttu-id="96904-266">[整合應用程式與 Azure Active Directory][AAD-Integrating-Apps]</span><span class="sxs-lookup"><span data-stu-id="96904-266">[Integrating Applications with Azure Active Directory][AAD-Integrating-Apps]</span></span>
* <span data-ttu-id="96904-267">[Hello 同意架構的概觀][AAD-Consent-Overview]</span><span class="sxs-lookup"><span data-stu-id="96904-267">[Overview of hello Consent Framework][AAD-Consent-Overview]</span></span>
* <span data-ttu-id="96904-268">[Microsoft Graph API 權限範圍][MSFT-Graph-permision-scopes]</span><span class="sxs-lookup"><span data-stu-id="96904-268">[Microsoft Graph API Permission Scopes][MSFT-Graph-permision-scopes]</span></span>
* <span data-ttu-id="96904-269">[Azure AD Graph API 權限範圍][AAD-Graph-Perm-Scopes]</span><span class="sxs-lookup"><span data-stu-id="96904-269">[Azure AD Graph API Permission Scopes][AAD-Graph-Perm-Scopes]</span></span>

<span data-ttu-id="96904-270">請使用下列註解區段 tooprovide 意見反應的 hello，並協助我們改善並圖形內容。</span><span class="sxs-lookup"><span data-stu-id="96904-270">Please use hello following comments section tooprovide feedback and help us refine and shape our content.</span></span>

<!--Reference style links IN USE -->
[AAD-Access-Panel]:  https://myapps.microsoft.com
[AAD-App-Branding]: ./active-directory-branding-guidelines.md
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Consent-Overview]: ./active-directory-integrating-applications.md#overview-of-the-consent-framework
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Overview]: https://azure.microsoft.com/en-us/documentation/articles/active-directory-graph-api/
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Samples-MT]: https://azure.microsoft.com/documentation/samples/?service=active-directory&term=multitenant
[AAD-Why-To-Integrate]: ./active-directory-how-to-integrate.md
[AZURE-portal]: https://portal.azure.com
[MSFT-Graph-overview]: https://graph.microsoft.io/en-us/docs/overview/overview
[MSFT-Graph-permision-scopes]: https://graph.microsoft.io/en-us/docs/authorization/permission_scopes

<!--Image references-->
[AAD-Sign-In]: ./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png
[Consent-Single-Tier]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-single-tier.png
[Consent-Multi-Tier-Known-Client]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-known-clients.png
[Consent-Multi-Tier-Multi-Party]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-multi-party.png

<!--Reference style links -->
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Graph-App-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#application-entity
[AAD-Graph-Sp-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity
[AAD-Graph-User-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#user-entity
[AAD-How-To-Integrate]: ./active-directory-how-to-integrate.md
[AAD-Security-Token-Claims]: ./active-directory-authentication-scenarios/#claims-in-azure-ad-security-tokens
[AAD-Tokens-Claims]: ./active-directory-token-and-claims.md
[AAD-V2-Dev-Guide]: ../active-directory-appmodel-v2-overview.md
[AZURE-portal]: https://portal.azure.com
[Duyshant-Role-Blog]: http://www.dushyantgill.com/blog/2014/12/10/roles-based-access-control-in-cloud-applications-using-azure-ad/
[JWT]: https://tools.ietf.org/html/draft-ietf-oauth-json-web-token-32
[O365-Perm-Ref]: https://msdn.microsoft.com/en-us/office/office365/howto/application-manifest
[OAuth2-Access-Token-Scopes]: https://tools.ietf.org/html/rfc6749#section-3.3
[OAuth2-AuthZ-Code-Grant-Flow]: https://msdn.microsoft.com/library/azure/dn645542.aspx
[OAuth2-AuthZ-Grant-Types]: https://tools.ietf.org/html/rfc6749#section-1.3 
[OAuth2-Client-Types]: https://tools.ietf.org/html/rfc6749#section-2.1
[OAuth2-Role-Def]: https://tools.ietf.org/html/rfc6749#page-6
[OpenIDConnect]: http://openid.net/specs/openid-connect-core-1_0.html
[OpenIDConnect-ID-Token]: http://openid.net/specs/openid-connect-core-1_0.html#IDToken














