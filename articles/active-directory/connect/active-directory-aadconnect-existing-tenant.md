---
title: "Azure AD Connect︰當您已經有 Azure AD 時 | Microsoft Docs"
description: "本主題描述當您有現有的 Azure AD 租用戶時，如何使用 Connect。"
services: active-directory
documentationcenter: 
author: andkjell
manager: femila
editor: 
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: 908c576b0427a23934c844362a4fd69443800d0f
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-when-you-have-an-existent-tenant"></a><span data-ttu-id="0c06a-103">Azure AD Connect︰當您有存在的租用戶</span><span class="sxs-lookup"><span data-stu-id="0c06a-103">Azure AD Connect: When you have an existent tenant</span></span>
<span data-ttu-id="0c06a-104">大部分說明如何使用 Azure AD Connect 的主題會假設您開始使用新的 Azure AD 租用戶，而且沒有任何使用者或其他物件。</span><span class="sxs-lookup"><span data-stu-id="0c06a-104">Most of the topics for how to use Azure AD Connect assumes you start with a new Azure AD tenant and that there are no users or other objects there.</span></span> <span data-ttu-id="0c06a-105">但如果您開始使用 Azure AD 租用戶，且以使用者和其他物件填入，而現在想要使用 Connect，則這個主題很適用於您。</span><span class="sxs-lookup"><span data-stu-id="0c06a-105">But if you have started with an Azure AD tenant, populated it with users and other objects, and now want to use Connect, then this topic is for you.</span></span>

## <a name="the-basics"></a><span data-ttu-id="0c06a-106">基本概念</span><span class="sxs-lookup"><span data-stu-id="0c06a-106">The basics</span></span>
<span data-ttu-id="0c06a-107">Azure AD 中的物件可能會在雲端 (Azure AD) 中受控或內部部署。</span><span class="sxs-lookup"><span data-stu-id="0c06a-107">An object in Azure AD is either mastered in the cloud (Azure AD) or on-premises.</span></span> <span data-ttu-id="0c06a-108">針對一個單一物件，您無法管理內部部署的某些屬性和 Azure AD 中的一些其他屬性。</span><span class="sxs-lookup"><span data-stu-id="0c06a-108">For one single object, you cannot manage some attributes on-premises and some other attributes in Azure AD.</span></span> <span data-ttu-id="0c06a-109">每個物件都有表示物件受管理位置的旗標。</span><span class="sxs-lookup"><span data-stu-id="0c06a-109">Each object has a flag indicating where the object is managed.</span></span>

<span data-ttu-id="0c06a-110">您可以在內部部署管理部分使用者，並在雲端中管理其他使用者。</span><span class="sxs-lookup"><span data-stu-id="0c06a-110">You can manage some users on-premises and other in the cloud.</span></span> <span data-ttu-id="0c06a-111">混合著會計工作者和銷售工作者的組織是此組態的常見案例。</span><span class="sxs-lookup"><span data-stu-id="0c06a-111">A common scenario for this configuration is an organization with a mix of accounting workers and sales workers.</span></span> <span data-ttu-id="0c06a-112">會計工作者具有內部部署 AD 帳戶，但銷售工作者沒有這種帳戶，他們在 Azure AD 中有帳戶。</span><span class="sxs-lookup"><span data-stu-id="0c06a-112">The accounting workers have an on-premises AD account, but the sales workers do not, they have an account in Azure AD.</span></span> <span data-ttu-id="0c06a-113">您可在內部部署管理部分使用者，並在 Azure AD 管理其他使用者。</span><span class="sxs-lookup"><span data-stu-id="0c06a-113">You would manage some users on-premises and some in Azure AD.</span></span>

<span data-ttu-id="0c06a-114">如果您開始管理 Azure AD 且也在內部部署 AD 中的使用者，且稍後想要使用 Connect，則您必須考慮一些其他考量。</span><span class="sxs-lookup"><span data-stu-id="0c06a-114">If you started to manage users in Azure AD that are also in on-premises AD and later want to use Connect, then there are some additional concerns you need to consider.</span></span>

## <a name="sync-with-existing-users-in-azure-ad"></a><span data-ttu-id="0c06a-115">在 Azure AD 中與現有的使用者同步處理</span><span class="sxs-lookup"><span data-stu-id="0c06a-115">Sync with existing users in Azure AD</span></span>
<span data-ttu-id="0c06a-116">當您安裝 Azure AD Connect 時，您開始同步處理，Azure AD 同步服務 (在 Azure AD 中) 會檢查每個新的物件，然後嘗試尋找要比對的現有物件。</span><span class="sxs-lookup"><span data-stu-id="0c06a-116">When you install Azure AD Connect and you start synchronizing, the Azure AD sync service (in Azure AD) does a check on every new object and try to find an existing object to match.</span></span> <span data-ttu-id="0c06a-117">有三種屬性用於此處理程序︰**userPrincipalName**、**proxyAddresses** 和 **sourceAnchor**/**immutableID**。</span><span class="sxs-lookup"><span data-stu-id="0c06a-117">There are three attributes used for this process: **userPrincipalName**, **proxyAddresses**, and **sourceAnchor**/**immutableID**.</span></span> <span data-ttu-id="0c06a-118">比對 **userPrincipalName** 和 **proxyAddresses** 稱為**大致比對**。</span><span class="sxs-lookup"><span data-stu-id="0c06a-118">A match on **userPrincipalName** and **proxyAddresses** is known as a **soft match**.</span></span> <span data-ttu-id="0c06a-119">比對 **sourceAnchor** 稱為**精確比對**。</span><span class="sxs-lookup"><span data-stu-id="0c06a-119">A match on **sourceAnchor** is known as **hard match**.</span></span> <span data-ttu-id="0c06a-120">針對 **proxyAddresses** 屬性，僅具有 **SMTP:** 的值 (也就是主要電子郵件地址) 會用來進行評估。</span><span class="sxs-lookup"><span data-stu-id="0c06a-120">For the **proxyAddresses** attribute only the value with **SMTP:**, that is the primary email address, is used for the evaluation.</span></span>

<span data-ttu-id="0c06a-121">比對只會評估來自 Connect 的新物件。</span><span class="sxs-lookup"><span data-stu-id="0c06a-121">The match is only evaluated for new objects coming from Connect.</span></span> <span data-ttu-id="0c06a-122">如果您變更現有的物件，而它會比對任何這些屬性，則您會看到錯誤。</span><span class="sxs-lookup"><span data-stu-id="0c06a-122">If you change an exiting object so it is matching any of these attributes, then you see an error instead.</span></span>

<span data-ttu-id="0c06a-123">如果 Azure AD 找到的物件當中屬性值與來自 Connect 的物件相同，且已經存在於 Azure AD，則 Azure AD 中的物件會接替 Connect。</span><span class="sxs-lookup"><span data-stu-id="0c06a-123">If Azure AD finds an object where the attribute values are the same for an object coming from Connect and that it is already present in Azure AD, then the object in Azure AD is taken over by Connect.</span></span> <span data-ttu-id="0c06a-124">先前的雲端管理的物件標示為內部部署管理。</span><span class="sxs-lookup"><span data-stu-id="0c06a-124">The previously cloud-managed object is flagged as on-premises managed.</span></span> <span data-ttu-id="0c06a-125">Azure AD 中具有內部部署 AD 值的所有屬性會以內部部署值覆寫。</span><span class="sxs-lookup"><span data-stu-id="0c06a-125">All attributes in Azure AD with a value in on-premises AD are overwritten with the on-premises value.</span></span> <span data-ttu-id="0c06a-126">例外狀況是在屬性擁有 **NULL** 值的內部部署。</span><span class="sxs-lookup"><span data-stu-id="0c06a-126">The exception is when an attribute has a **NULL** value on-premises.</span></span> <span data-ttu-id="0c06a-127">在此情況下，會保留 Azure AD 的值，但是您仍然只能在內部部署將它變更為其他項目。</span><span class="sxs-lookup"><span data-stu-id="0c06a-127">In this case, the value in Azure AD remains, but you can still only change it on-premises to something else.</span></span>

> [!WARNING]
> <span data-ttu-id="0c06a-128">因為 Azure AD 中的所有屬性都將會以內部部署值覆寫，請確定您有良好的資料在內部部署。</span><span class="sxs-lookup"><span data-stu-id="0c06a-128">Since all attributes in Azure AD are going to be overwritten by the on-premises value, make sure you have good data on-premises.</span></span> <span data-ttu-id="0c06a-129">例如，如果您只在 Office 365 中管理電子郵件地址，且不會在內部部署 AD DS 中保持更新，則您會遺失不存在於 AD DS 之 Azure AD/Office 365 中的任何值。</span><span class="sxs-lookup"><span data-stu-id="0c06a-129">For example, if you only have managed email address in Office 365 and not kept it updated in on-premises AD DS, then you lose any values in Azure AD/Office 365 not present in AD DS.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="0c06a-130">如果您使用一律會使用快速設定的密碼同步，則會使用內部部署 AD 中的密碼覆寫 Azure AD 中的密碼。</span><span class="sxs-lookup"><span data-stu-id="0c06a-130">If you use password sync, which is always used by express settings, then the password in Azure AD is overwritten with the password in on-premises AD.</span></span> <span data-ttu-id="0c06a-131">如果您的使用者用來管理不同的密碼，則您需要通知它們在您已安裝 Connect 時，應該使用內部部署密碼。</span><span class="sxs-lookup"><span data-stu-id="0c06a-131">If your users are used to manage different passwords, then you need to inform them that they should use the on-premises password when you have installed Connect.</span></span>

<span data-ttu-id="0c06a-132">必須在您的規劃中考量上一節和警告。</span><span class="sxs-lookup"><span data-stu-id="0c06a-132">The previous section and warning must be considered in your planning.</span></span> <span data-ttu-id="0c06a-133">如果您在 Azure AD 中進行的許多變更不會在內部部署 AD DS 中反映，則您需要規劃如何在使用 Azure AD Connect 同步您的物件之前填入 AD DS 與更新的值。</span><span class="sxs-lookup"><span data-stu-id="0c06a-133">If you have made many changes in Azure AD not reflected in on-premises AD DS, then you need to plan for how to populate AD DS with the updated values before you sync your objects with Azure AD Connect.</span></span>

<span data-ttu-id="0c06a-134">如果以大致比對來比對軟體，則 **sourceAnchor** 會新增至 Azure AD 中的物件，以便稍後可以使用精確比對。</span><span class="sxs-lookup"><span data-stu-id="0c06a-134">If you matched your objects with a soft-match, then the **sourceAnchor** is added to the object in Azure AD so a hard match can be used later.</span></span>

### <a name="hard-match-vs-soft-match"></a><span data-ttu-id="0c06a-135">精確比對與大致比對</span><span class="sxs-lookup"><span data-stu-id="0c06a-135">Hard-match vs Soft-match</span></span>
<span data-ttu-id="0c06a-136">對於 Connect 的全新安裝，精確比對與大致比對之間並無實際差別。</span><span class="sxs-lookup"><span data-stu-id="0c06a-136">For a new installation of Connect, there is no practical difference between a soft- and a hard-match.</span></span> <span data-ttu-id="0c06a-137">不同之處在於災害復原狀況。</span><span class="sxs-lookup"><span data-stu-id="0c06a-137">The difference is in a disaster recovery situation.</span></span> <span data-ttu-id="0c06a-138">如果遺失您的伺服器與 Azure AD Connect，您可以重新安裝新的執行個體而不會遺失任何資料。</span><span class="sxs-lookup"><span data-stu-id="0c06a-138">If you have lost your server with Azure AD Connect, you can reinstall a new instance without losing any data.</span></span> <span data-ttu-id="0c06a-139">在初始安裝期間，具有 sourceAnchor 的物件會傳送到 Connect。</span><span class="sxs-lookup"><span data-stu-id="0c06a-139">An object with a sourceAnchor is sent to Connect during initial install.</span></span> <span data-ttu-id="0c06a-140">接著，用戶端 (Azure AD Connect) 可以評估比對，這會比在 Azure AD 中執行相同動作更快速。</span><span class="sxs-lookup"><span data-stu-id="0c06a-140">The match can then be evaluated by the client (Azure AD Connect), which is a lot faster than doing the same in Azure AD.</span></span> <span data-ttu-id="0c06a-141">精確比對會由 Connect 和 Azure AD 評估。</span><span class="sxs-lookup"><span data-stu-id="0c06a-141">A hard match is evaluated both by Connect and by Azure AD.</span></span> <span data-ttu-id="0c06a-142">大致比對只會由 Azure AD 評估。</span><span class="sxs-lookup"><span data-stu-id="0c06a-142">A soft match is only evaluated by Azure AD.</span></span>

### <a name="other-objects-than-users"></a><span data-ttu-id="0c06a-143">使用者以外的其他物件</span><span class="sxs-lookup"><span data-stu-id="0c06a-143">Other objects than users</span></span>
<span data-ttu-id="0c06a-144">使用者通常會有 userPrincipalName 和 proxyAddresses，使比對更容易。</span><span class="sxs-lookup"><span data-stu-id="0c06a-144">Users usually have both userPrincipalName and proxyAddresses, making the match easy.</span></span> <span data-ttu-id="0c06a-145">但是其他物件 (例如安全性群組) 沒有這些。</span><span class="sxs-lookup"><span data-stu-id="0c06a-145">But other objects, such as security groups, do not have those.</span></span> <span data-ttu-id="0c06a-146">在此情況下，您只可以使用 sourceAnchor 比對精確比對。</span><span class="sxs-lookup"><span data-stu-id="0c06a-146">In this case, you can only match on a hard match using the sourceAnchor.</span></span> <span data-ttu-id="0c06a-147">SourceAnchor 一律為 Base64 轉換的 **objectGUID**內部部署，因此當您需要比對兩個物件時，必須更新 Azure AD 中的值。</span><span class="sxs-lookup"><span data-stu-id="0c06a-147">The sourceAnchor is always the Base64 converted **objectGUID** on-premises, so you must update the value in Azure AD when you need two objects to match.</span></span> <span data-ttu-id="0c06a-148">sourceAnchor/immutableID 僅可使用 PowerShell 而無法透過入口網站更新。</span><span class="sxs-lookup"><span data-stu-id="0c06a-148">The sourceAnchor/immutableID can only be updated with PowerShell and not through the portals.</span></span>

## <a name="create-a-new-on-premises-active-directory-from-data-in-azure-ad"></a><span data-ttu-id="0c06a-149">從 Azure AD 中的資料建立新的內部部署 Active Directory</span><span class="sxs-lookup"><span data-stu-id="0c06a-149">Create a new on-premises Active Directory from data in Azure AD</span></span>
<span data-ttu-id="0c06a-150">有些客戶開始使用僅限雲端的解決方案與 Azure AD，且他們沒有內部部署 AD。</span><span class="sxs-lookup"><span data-stu-id="0c06a-150">Some customers start with a cloud-only solution with Azure AD and they do not have an on-premises AD.</span></span> <span data-ttu-id="0c06a-151">稍後，他們要使用內部部署資源，而且想要根據 Azure AD 資料建置內部部署 AD。</span><span class="sxs-lookup"><span data-stu-id="0c06a-151">Later they want to consume on-premises resources and want to build an on-premises AD based on Azure AD data.</span></span> <span data-ttu-id="0c06a-152">Azure AD Connect 無法針對此案例協助您。</span><span class="sxs-lookup"><span data-stu-id="0c06a-152">Azure AD Connect cannot help you for this scenario.</span></span> <span data-ttu-id="0c06a-153">它不會在內部部署建立使用者，且它無法在內部部署將密碼設定為與 Azure AD 中的相同。</span><span class="sxs-lookup"><span data-stu-id="0c06a-153">It does not create users on-premises and it does not have any ability to set the password on-premises to the same as in Azure AD.</span></span>

<span data-ttu-id="0c06a-154">如果您計劃要新增內部部署 AD 的唯一理由是要支援 LOB (特定業務應用程式)，則或許您應該考慮改為使用 [Azure AD 網域服務](../../active-directory-domain-services/index.md)。</span><span class="sxs-lookup"><span data-stu-id="0c06a-154">If the only reason why you plan to add on-premises AD is to support LOBs (Line-of-Business apps), then maybe you should consider to use [Azure AD domain services](../../active-directory-domain-services/index.md) instead.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0c06a-155">後續步驟</span><span class="sxs-lookup"><span data-stu-id="0c06a-155">Next steps</span></span>
<span data-ttu-id="0c06a-156">深入了解 [整合內部部署身分識別與 Azure Active Directory](active-directory-aadconnect.md)。</span><span class="sxs-lookup"><span data-stu-id="0c06a-156">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
