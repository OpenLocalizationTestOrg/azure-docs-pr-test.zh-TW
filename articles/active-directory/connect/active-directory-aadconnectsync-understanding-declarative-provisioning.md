---
title: "Azure AD Connect：了解宣告式佈建 | Microsoft Docs"
description: "說明 Azure AD Connect 中的宣告式佈建組態模型。"
services: active-directory
documentationcenter: 
author: andkjell
manager: femila
editor: 
ms.assetid: cfbb870d-be7d-47b3-ba01-9e78121f0067
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: 7497ec2ca658c3790227c56ef1755d9a1cb74e0a
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-sync-understanding-declarative-provisioning"></a><span data-ttu-id="46dc2-103">Azure AD Connect 同步處理：了解宣告式佈建</span><span class="sxs-lookup"><span data-stu-id="46dc2-103">Azure AD Connect sync: Understanding Declarative Provisioning</span></span>
<span data-ttu-id="46dc2-104">本主題說明 Azure AD Connect 中的組態模型。</span><span class="sxs-lookup"><span data-stu-id="46dc2-104">This topic explains the configuration model in Azure AD Connect.</span></span> <span data-ttu-id="46dc2-105">此模型稱為宣告式佈建，它可讓您輕鬆地進行組態變更。</span><span class="sxs-lookup"><span data-stu-id="46dc2-105">The model is called Declarative Provisioning and it allows you to make a configuration change with ease.</span></span> <span data-ttu-id="46dc2-106">本主題中所述的許多項目都是進階的，而且在大部分客戶案例中並非必要。</span><span class="sxs-lookup"><span data-stu-id="46dc2-106">Many things described in this topic are advanced and not required for most customer scenarios.</span></span>

## <a name="overview"></a><span data-ttu-id="46dc2-107">概觀</span><span class="sxs-lookup"><span data-stu-id="46dc2-107">Overview</span></span>
<span data-ttu-id="46dc2-108">宣告式佈建正在處理來自來源連接的目錄中的物件，並決定應如何將物件和屬性從來源轉換到目標。</span><span class="sxs-lookup"><span data-stu-id="46dc2-108">Declarative provisioning is processing objects coming in from a source connected directory and determines how the object and attributes should be transformed from a source to a target.</span></span> <span data-ttu-id="46dc2-109">物件會在同步處理管線中進行處理，而輸入和輸出規則的管線都相同。</span><span class="sxs-lookup"><span data-stu-id="46dc2-109">An object is processed in a sync pipeline and the pipeline is the same for inbound and outbound rules.</span></span> <span data-ttu-id="46dc2-110">輸入規則是從連接器空間至 Metaverse，而輸出規則是從 Metaverse 至連接器空間。</span><span class="sxs-lookup"><span data-stu-id="46dc2-110">An inbound rule is from a connector space to the metaverse and an outbound rule is from the metaverse to a connector space.</span></span>

![同步處理管線](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/sync1.png)  

<span data-ttu-id="46dc2-112">管線有數個不同的模組。</span><span class="sxs-lookup"><span data-stu-id="46dc2-112">The pipeline has several different modules.</span></span> <span data-ttu-id="46dc2-113">每個模組負責物件同步處理中的一個概念。</span><span class="sxs-lookup"><span data-stu-id="46dc2-113">Each one is responsible for one concept in object synchronization.</span></span>

![同步處理管線](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/pipeline.png)  

* <span data-ttu-id="46dc2-115">資料：來源物件</span><span class="sxs-lookup"><span data-stu-id="46dc2-115">Source, The source object</span></span>
* <span data-ttu-id="46dc2-116">[範圍](#scope)：尋找所有適用的同步處理規則</span><span class="sxs-lookup"><span data-stu-id="46dc2-116">[Scope](#scope), Finds all sync rules that are in scope</span></span>
* <span data-ttu-id="46dc2-117">[聯結](#join)：判斷連接器空間和 Metaverse 之間的關聯性</span><span class="sxs-lookup"><span data-stu-id="46dc2-117">[Join](#join), Determines relationship between connector space and metaverse</span></span>
* <span data-ttu-id="46dc2-118">[轉換](#transform)：計算屬性應如何轉換和流動</span><span class="sxs-lookup"><span data-stu-id="46dc2-118">[Transform](#transform), Calculates how attributes should be transformed and flow</span></span>
* <span data-ttu-id="46dc2-119">[優先順序](#precedence)：解決衝突的屬性貢獻</span><span class="sxs-lookup"><span data-stu-id="46dc2-119">[Precedence](#precedence), Resolves conflicting attribute contributions</span></span>
* <span data-ttu-id="46dc2-120">目標：目標物件</span><span class="sxs-lookup"><span data-stu-id="46dc2-120">Target, The target object</span></span>

## <a name="scope"></a><span data-ttu-id="46dc2-121">範圍</span><span class="sxs-lookup"><span data-stu-id="46dc2-121">Scope</span></span>
<span data-ttu-id="46dc2-122">範圍模組會評估物件，並判斷在範圍中且應納入處理的規則。</span><span class="sxs-lookup"><span data-stu-id="46dc2-122">The scope module is evaluating an object and determines the rules that are in scope and should be included in the processing.</span></span> <span data-ttu-id="46dc2-123">視物件上的屬性值而定，不同的同步處理規則會評估為在範圍中。</span><span class="sxs-lookup"><span data-stu-id="46dc2-123">Depending on the attributes values on the object, different sync rules are evaluated to be in scope.</span></span> <span data-ttu-id="46dc2-124">例如，沒有 Exchange 信箱的已停用使用者會有不同於具有信箱的已啟用使用者的規則。</span><span class="sxs-lookup"><span data-stu-id="46dc2-124">For example, a disabled user with no Exchange mailbox does have different rules than an enabled user with a mailbox.</span></span>  
![範圍](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/scope1.png)  

<span data-ttu-id="46dc2-126">範圍可定義為群組和子句。</span><span class="sxs-lookup"><span data-stu-id="46dc2-126">The scope is defined as groups and clauses.</span></span> <span data-ttu-id="46dc2-127">子句位於群組中。</span><span class="sxs-lookup"><span data-stu-id="46dc2-127">The clauses are inside a group.</span></span> <span data-ttu-id="46dc2-128">邏輯 AND 使用於群組中的所有子句之間。</span><span class="sxs-lookup"><span data-stu-id="46dc2-128">A logical AND is used between all clauses in a group.</span></span> <span data-ttu-id="46dc2-129">例如，(department =IT AND country = Denmark)。</span><span class="sxs-lookup"><span data-stu-id="46dc2-129">For example, (department =IT AND country = Denmark).</span></span> <span data-ttu-id="46dc2-130">邏輯 OR 使用於群組之間。</span><span class="sxs-lookup"><span data-stu-id="46dc2-130">A logical OR is used between groups.</span></span>

![範圍](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/scope2.png)  
<span data-ttu-id="46dc2-132">此圖中的範圍應該讀為 (department = IT AND country = Denmark) OR (country=Sweden)。</span><span class="sxs-lookup"><span data-stu-id="46dc2-132">The scope in this picture should be read as (department = IT AND country = Denmark) OR (country=Sweden).</span></span> <span data-ttu-id="46dc2-133">如果群組 1 或 2 群組評估為 true，規則便在範圍中。</span><span class="sxs-lookup"><span data-stu-id="46dc2-133">If either group 1 or group 2 is evaluated to true, then the rule is in scope.</span></span>

<span data-ttu-id="46dc2-134">範圍模組支援下列作業。</span><span class="sxs-lookup"><span data-stu-id="46dc2-134">The scope module supports the following operations.</span></span>

| <span data-ttu-id="46dc2-135">作業</span><span class="sxs-lookup"><span data-stu-id="46dc2-135">Operation</span></span> | <span data-ttu-id="46dc2-136">說明</span><span class="sxs-lookup"><span data-stu-id="46dc2-136">Description</span></span> |
| --- | --- |
| <span data-ttu-id="46dc2-137">EQUAL、NOTEQUAL</span><span class="sxs-lookup"><span data-stu-id="46dc2-137">EQUAL, NOTEQUAL</span></span> |<span data-ttu-id="46dc2-138">評估此值是否等於屬性值的字串比較。</span><span class="sxs-lookup"><span data-stu-id="46dc2-138">A string compare that evaluates if value is equal to the value in the attribute.</span></span> <span data-ttu-id="46dc2-139">若為多重值屬性，請參閱 ISIN 和 ISNOTIN。</span><span class="sxs-lookup"><span data-stu-id="46dc2-139">For multi-valued attributes, see ISIN and ISNOTIN.</span></span> |
| <span data-ttu-id="46dc2-140">LESSTHAN、LESSTHAN_OR_EQUAL</span><span class="sxs-lookup"><span data-stu-id="46dc2-140">LESSTHAN, LESSTHAN_OR_EQUAL</span></span> |<span data-ttu-id="46dc2-141">評估此值是否小於屬性值的字串比較。</span><span class="sxs-lookup"><span data-stu-id="46dc2-141">A string compare that evaluates if value is less than of the value in the attribute.</span></span> |
| <span data-ttu-id="46dc2-142">CONTAINS、NOTCONTAINS</span><span class="sxs-lookup"><span data-stu-id="46dc2-142">CONTAINS, NOTCONTAINS</span></span> |<span data-ttu-id="46dc2-143">評估是否可在屬性值中找到此值的字串比較。</span><span class="sxs-lookup"><span data-stu-id="46dc2-143">A string compare that evaluates if value can be found somewhere inside value in the attribute.</span></span> |
| <span data-ttu-id="46dc2-144">STARTSWITH、NOTSTARTSWITH</span><span class="sxs-lookup"><span data-stu-id="46dc2-144">STARTSWITH, NOTSTARTSWITH</span></span> |<span data-ttu-id="46dc2-145">評估此值是否在屬性值開頭的字串比較。</span><span class="sxs-lookup"><span data-stu-id="46dc2-145">A string compare that evaluates if value is in the beginning of the value in the attribute.</span></span> |
| <span data-ttu-id="46dc2-146">ENDSWITH、NOTENDSWITH</span><span class="sxs-lookup"><span data-stu-id="46dc2-146">ENDSWITH, NOTENDSWITH</span></span> |<span data-ttu-id="46dc2-147">評估此值是否在屬性值結尾的字串比較。</span><span class="sxs-lookup"><span data-stu-id="46dc2-147">A string compare that evaluates if value is in the end of the value in the attribute.</span></span> |
| <span data-ttu-id="46dc2-148">GREATERTHAN、GREATERTHAN_OR_EQUAL</span><span class="sxs-lookup"><span data-stu-id="46dc2-148">GREATERTHAN, GREATERTHAN_OR_EQUAL</span></span> |<span data-ttu-id="46dc2-149">評估此值是否大於屬性值的字串比較。</span><span class="sxs-lookup"><span data-stu-id="46dc2-149">A string compare that evaluates if value is greater than of the value in the attribute.</span></span> |
| <span data-ttu-id="46dc2-150">ISNULL、ISNOTNULL</span><span class="sxs-lookup"><span data-stu-id="46dc2-150">ISNULL, ISNOTNULL</span></span> |<span data-ttu-id="46dc2-151">評估物件是否不存在此屬性。</span><span class="sxs-lookup"><span data-stu-id="46dc2-151">Evaluates if the attribute is absent from the object.</span></span> <span data-ttu-id="46dc2-152">如果屬性不存在，因而為 null，規則便在範圍中。</span><span class="sxs-lookup"><span data-stu-id="46dc2-152">If the attribute is not present and therefore null, then the rule is in scope.</span></span> |
| <span data-ttu-id="46dc2-153">ISIN、ISNOTIN</span><span class="sxs-lookup"><span data-stu-id="46dc2-153">ISIN, ISNOTIN</span></span> |<span data-ttu-id="46dc2-154">判斷此值是否存在於定義的屬性中。</span><span class="sxs-lookup"><span data-stu-id="46dc2-154">Evaluates if the value is present in the defined attribute.</span></span> <span data-ttu-id="46dc2-155">此作業是 EQUAL 和 NOTEQUAL 的多重值變化。</span><span class="sxs-lookup"><span data-stu-id="46dc2-155">This operation is the multi-valued variation of EQUAL and NOTEQUAL.</span></span> <span data-ttu-id="46dc2-156">屬性應該是多重值的屬性，而如果可以在任何屬性值中找到此值，規則便在範圍中。</span><span class="sxs-lookup"><span data-stu-id="46dc2-156">The attribute is supposed to be a multi-valued attribute and if the value can be found in any of the attribute values, then the rule is in scope.</span></span> |
| <span data-ttu-id="46dc2-157">ISBITSET、ISNOTBITSET</span><span class="sxs-lookup"><span data-stu-id="46dc2-157">ISBITSET, ISNOTBITSET</span></span> |<span data-ttu-id="46dc2-158">評估是否已設定特定的位元。</span><span class="sxs-lookup"><span data-stu-id="46dc2-158">Evaluates if a particular bit is set.</span></span> <span data-ttu-id="46dc2-159">例如，可用來評估 userAccountControl 中的位元，以查看使用者已啟用或停用。</span><span class="sxs-lookup"><span data-stu-id="46dc2-159">For example, can be used to evaluate the bits in userAccountControl to see if a user is enabled or disabled.</span></span> |
| <span data-ttu-id="46dc2-160">ISMEMBEROF、ISNOTMEMBEROF</span><span class="sxs-lookup"><span data-stu-id="46dc2-160">ISMEMBEROF, ISNOTMEMBEROF</span></span> |<span data-ttu-id="46dc2-161">此值應該包含連接器空間中群組的 DN。</span><span class="sxs-lookup"><span data-stu-id="46dc2-161">The value should contain a DN to a group in the connector space.</span></span> <span data-ttu-id="46dc2-162">如果物件是指定群組的成員，規則便在範圍中。</span><span class="sxs-lookup"><span data-stu-id="46dc2-162">If the object is a member of the group specified, the rule is in scope.</span></span> |

## <a name="join"></a><span data-ttu-id="46dc2-163">聯結</span><span class="sxs-lookup"><span data-stu-id="46dc2-163">Join</span></span>
<span data-ttu-id="46dc2-164">同步處理管線中的聯結模組負責尋找來源中物件和目標中物件之間的關聯性。</span><span class="sxs-lookup"><span data-stu-id="46dc2-164">The join module in the sync pipeline is responsible for finding the relationship between the object in the source and an object in the target.</span></span> <span data-ttu-id="46dc2-165">在輸入規則上，此關聯性是連接器空間中的物件找到對 Metaverse 中物件的關聯性。</span><span class="sxs-lookup"><span data-stu-id="46dc2-165">On an inbound rule, this relationship would be an object in a connector space finding a relationship to an object in the metaverse.</span></span>  
![聯結 cs 與 mv](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/join1.png)  
<span data-ttu-id="46dc2-167">目標在於查看應該相關聯的 Metaverse 中是否已經有一個物件 (由另一個連接器建立)。</span><span class="sxs-lookup"><span data-stu-id="46dc2-167">The goal is to see if there is an object already in the metaverse, created by another Connector, it should be associated with.</span></span> <span data-ttu-id="46dc2-168">比方說，在帳戶-資源樹系中，帳戶樹系中的使用者應該與資源樹系中的使用者聯結。</span><span class="sxs-lookup"><span data-stu-id="46dc2-168">For example, in an account-resource forest the user from the account forest should be joined with the user from the resource forest.</span></span>

<span data-ttu-id="46dc2-169">聯結大多數使用於輸入規則，以將連接器空間物件與相同的 Metaverse 物件聯結在一起。</span><span class="sxs-lookup"><span data-stu-id="46dc2-169">Joins are used mostly on inbound rules to join connector space objects together to the same metaverse object.</span></span>

<span data-ttu-id="46dc2-170">聯結會定義為一或多個群組。</span><span class="sxs-lookup"><span data-stu-id="46dc2-170">The joins are defined as one or more groups.</span></span> <span data-ttu-id="46dc2-171">在群組中，您有一些子句。</span><span class="sxs-lookup"><span data-stu-id="46dc2-171">Inside a group, you have clauses.</span></span> <span data-ttu-id="46dc2-172">邏輯 AND 使用於群組中的所有子句之間。</span><span class="sxs-lookup"><span data-stu-id="46dc2-172">A logical AND is used between all clauses in a group.</span></span> <span data-ttu-id="46dc2-173">邏輯 OR 使用於群組之間。</span><span class="sxs-lookup"><span data-stu-id="46dc2-173">A logical OR is used between groups.</span></span> <span data-ttu-id="46dc2-174">群組的處理順序為從上而下。</span><span class="sxs-lookup"><span data-stu-id="46dc2-174">The groups are processed in order from top to bottom.</span></span> <span data-ttu-id="46dc2-175">當一個群組在目標中恰巧找到一個相符的物件，則不會評估任何其他聯結規則。</span><span class="sxs-lookup"><span data-stu-id="46dc2-175">When one group has found exactly one match with an object in the target, then no other join rules are evaluated.</span></span> <span data-ttu-id="46dc2-176">如果找到零個或多個物件，則處理會繼續下一個規則群組。</span><span class="sxs-lookup"><span data-stu-id="46dc2-176">If zero or more than one object is found, processing continues to the next group of rules.</span></span> <span data-ttu-id="46dc2-177">基於這個理由，應該最先建立最明確的規則，而最後建立比較模糊的規則。</span><span class="sxs-lookup"><span data-stu-id="46dc2-177">For this reason, the rules should be created in the order of most explicit first and more fuzzy at the end.</span></span>  
![聯結定義](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/join2.png)  
<span data-ttu-id="46dc2-179">此圖中的聯結會從上而下處理。</span><span class="sxs-lookup"><span data-stu-id="46dc2-179">The joins in this picture are processed from top to bottom.</span></span> <span data-ttu-id="46dc2-180">首先，同步處理管線會查看是否有相符的 employeeID。</span><span class="sxs-lookup"><span data-stu-id="46dc2-180">First the sync pipeline sees if there is a match on employeeID.</span></span> <span data-ttu-id="46dc2-181">如果沒有，第二個規則會查看帳戶名稱是否可用來將物件聯結在一起。</span><span class="sxs-lookup"><span data-stu-id="46dc2-181">If not, the second rule sees if the account name can be used to join the objects together.</span></span> <span data-ttu-id="46dc2-182">如果也不相符，則第三個 (最後一個) 規則會使用使用者名稱尋找更模糊的相符項目。</span><span class="sxs-lookup"><span data-stu-id="46dc2-182">If that is not a match either, the third and final rule is a more fuzzy match by using the name of user.</span></span>

<span data-ttu-id="46dc2-183">如果所有聯結規則經評估後沒有完全相符的項目，則會使用 [說明] 頁面上的 [連結類型]。</span><span class="sxs-lookup"><span data-stu-id="46dc2-183">If all join rules have been evaluated and there is not exactly one match, the **Link Type** on the **Description** page is used.</span></span> <span data-ttu-id="46dc2-184">如果此選項設定為 [佈建] ，則目標中會建立新的物件。</span><span class="sxs-lookup"><span data-stu-id="46dc2-184">If this option is set to **Provision**, then a new object in the target is created.</span></span>  
<span data-ttu-id="46dc2-185">![佈建或聯結](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/join3.png)</span><span class="sxs-lookup"><span data-stu-id="46dc2-185">![Provision or join](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/join3.png)</span></span>  

<span data-ttu-id="46dc2-186">一個物件應該只有一個同步處理規則具有在範圍中的聯結規則。</span><span class="sxs-lookup"><span data-stu-id="46dc2-186">An object should only have one single sync rule with join rules in scope.</span></span> <span data-ttu-id="46dc2-187">如果有多個同步處理規則定義了聯結，則會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="46dc2-187">If there are multiple sync rules where join is defined, an error occurs.</span></span> <span data-ttu-id="46dc2-188">優先順序不會用於解決聯結衝突。</span><span class="sxs-lookup"><span data-stu-id="46dc2-188">Precedence is not used to resolve join conflicts.</span></span> <span data-ttu-id="46dc2-189">物件必須具有在範圍中的聯結規則，屬性才能以相同的輸入/輸出方向流動。</span><span class="sxs-lookup"><span data-stu-id="46dc2-189">An object must have a join rule in scope for attributes to flow with the same inbound/outbound direction.</span></span> <span data-ttu-id="46dc2-190">如果您需要讓屬性以輸入和輸出方式流向相同的物件，則聯結必須具有輸入和輸出同步處理規則。</span><span class="sxs-lookup"><span data-stu-id="46dc2-190">If you need to flow attributes both inbound and outbound to the same object, you must have both an inbound and an outbound sync rule with join.</span></span>

<span data-ttu-id="46dc2-191">輸出聯結嘗試將物件佈建到目標連接器空間時，會有特殊的行為。</span><span class="sxs-lookup"><span data-stu-id="46dc2-191">Outbound join has a special behavior when it tries to provision an object to a target connector space.</span></span> <span data-ttu-id="46dc2-192">DN 屬性用於先嘗試反向聯結。</span><span class="sxs-lookup"><span data-stu-id="46dc2-192">The DN attribute is used to first try a reverse-join.</span></span> <span data-ttu-id="46dc2-193">如果目標連接器空間中已經有相同 DN 的物件，則物件會聯結起來。</span><span class="sxs-lookup"><span data-stu-id="46dc2-193">If there is already an object in the target connector space with the same DN, the objects are joined.</span></span>

<span data-ttu-id="46dc2-194">當新的同步處理規則進入範圍時，只會評估聯結模組一次。</span><span class="sxs-lookup"><span data-stu-id="46dc2-194">The join module is only evaluated once when a new sync rule comes into scope.</span></span> <span data-ttu-id="46dc2-195">物件若已聯結，即使不再符合聯結準則，也不會取消聯結。</span><span class="sxs-lookup"><span data-stu-id="46dc2-195">When an object has joined, it is not disjoining even if the join criteria is no longer satisfied.</span></span> <span data-ttu-id="46dc2-196">如果您想要取消物件的聯結，則聯結物件的同步處理規則必須超出範圍。</span><span class="sxs-lookup"><span data-stu-id="46dc2-196">If you want to disjoin an object, the sync rule that joined the objects must go out of scope.</span></span>

### <a name="metaverse-delete"></a><span data-ttu-id="46dc2-197">Metaverse 刪除</span><span class="sxs-lookup"><span data-stu-id="46dc2-197">Metaverse delete</span></span>
<span data-ttu-id="46dc2-198">只要有一個在範圍中的同步處理規則，Metaverse 物件的 [連結類型] 就會維持設定為 [佈建] 或 [StickyJoin]。</span><span class="sxs-lookup"><span data-stu-id="46dc2-198">A metaverse object remains as long as there is one sync rule in scope with **Link Type** set to **Provision** or **StickyJoin**.</span></span> <span data-ttu-id="46dc2-199">StickyJoin 使用於不允許連接器將新物件佈建至 Metaverse 時 ，但若已聯結該物件，則必須先在來源中加以刪除，才能刪除 Metaverse 物件。</span><span class="sxs-lookup"><span data-stu-id="46dc2-199">A StickyJoin is used when a Connector is not allowed to provision a new object to the metaverse, but when it has joined, it must be deleted in the source before the metaverse object is deleted.</span></span>

<span data-ttu-id="46dc2-200">刪除 Metaverse 物件後，所有與標示要 [佈建]  的輸出同步處理規則相關聯的物件都會標示要刪除。</span><span class="sxs-lookup"><span data-stu-id="46dc2-200">When a metaverse object is deleted, all objects associated with an outbound sync rule marked for **provision** are marked for a delete.</span></span>

## <a name="transformations"></a><span data-ttu-id="46dc2-201">轉換</span><span class="sxs-lookup"><span data-stu-id="46dc2-201">Transformations</span></span>
<span data-ttu-id="46dc2-202">轉換用來定義屬性應如何從來源流動到目標。</span><span class="sxs-lookup"><span data-stu-id="46dc2-202">The transformations are used to define how attributes should flow from the source to the target.</span></span> <span data-ttu-id="46dc2-203">流程可以有下列其中一種 **流程類型**︰直接、常數或運算式。</span><span class="sxs-lookup"><span data-stu-id="46dc2-203">The flows can have one of the following **flow types**: Direct, Constant, or Expression.</span></span> <span data-ttu-id="46dc2-204">直接流程，讓屬性值依現狀流動，而不進行其他轉換。</span><span class="sxs-lookup"><span data-stu-id="46dc2-204">A direct flow, flows an attribute value as-is with no additional transformations.</span></span> <span data-ttu-id="46dc2-205">常數值可設定指定的值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-205">A constant value sets the specified value.</span></span> <span data-ttu-id="46dc2-206">運算式會使用宣告式佈建運算式語言來表示應該如何轉換。</span><span class="sxs-lookup"><span data-stu-id="46dc2-206">An expression uses the declarative provisioning expression language to express how the transformation should be.</span></span> <span data-ttu-id="46dc2-207">如需運算式語言的詳細資料，請參閱 [了解宣告式佈建運算式語言](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md) 主題。</span><span class="sxs-lookup"><span data-stu-id="46dc2-207">The details for the expression language can be found in the [understanding declarative provisioning expression language](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md) topic.</span></span>

![佈建或聯結](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/transformations1.png)  

<span data-ttu-id="46dc2-209">[套用一次]  核取方塊會定義只能在最初建立物件時設定的屬性。</span><span class="sxs-lookup"><span data-stu-id="46dc2-209">The **Apply once** checkbox defines that the attribute should only be set when the object is initially created.</span></span> <span data-ttu-id="46dc2-210">例如，此組態可用來設定新使用者物件的初始密碼。</span><span class="sxs-lookup"><span data-stu-id="46dc2-210">For example, this configuration can be used to set an initial password for a new user object.</span></span>

### <a name="merging-attribute-values"></a><span data-ttu-id="46dc2-211">合併屬性值</span><span class="sxs-lookup"><span data-stu-id="46dc2-211">Merging attribute values</span></span>
<span data-ttu-id="46dc2-212">在屬性流程中，有一個設定可決定是否應該從數個不同的連接器合併多重值屬性。</span><span class="sxs-lookup"><span data-stu-id="46dc2-212">In the attribute flows there is a setting to determine if multi-valued attributes should be merged from several different Connectors.</span></span> <span data-ttu-id="46dc2-213">預設值為 [Update] ，表示應採用具有最高優先順序的同步處理規則。</span><span class="sxs-lookup"><span data-stu-id="46dc2-213">The default value is **Update**, which indicates that the sync rule with highest precedence should win.</span></span>

![合併類型](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/mergetype.png)  

<span data-ttu-id="46dc2-215">另外還有 **Merge** 和 **MergeCaseInsensitive**。</span><span class="sxs-lookup"><span data-stu-id="46dc2-215">There is also **Merge** and **MergeCaseInsensitive**.</span></span> <span data-ttu-id="46dc2-216">這些選項可讓您合併來自不同來源的值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-216">These options allow you to merge values from different sources.</span></span> <span data-ttu-id="46dc2-217">例如，它可用於合併來自數個不同樹系的成員或 proxyAddresses 屬性。</span><span class="sxs-lookup"><span data-stu-id="46dc2-217">For example, it can be used to merge the member or proxyAddresses attribute from several different forests.</span></span> <span data-ttu-id="46dc2-218">當您使用此選項時，物件範圍中的所有同步處理規則必須使用相同的合併類型。</span><span class="sxs-lookup"><span data-stu-id="46dc2-218">When you use this option, all sync rules in scope for an object must use the same merge type.</span></span> <span data-ttu-id="46dc2-219">您不能定義從一個連接器 **Update** 和從另一個連接器 **Merge**。</span><span class="sxs-lookup"><span data-stu-id="46dc2-219">You cannot define **Update** from one Connector and **Merge** from another.</span></span> <span data-ttu-id="46dc2-220">如果您嘗試，您會收到錯誤。</span><span class="sxs-lookup"><span data-stu-id="46dc2-220">If you try, you receive an error.</span></span>

<span data-ttu-id="46dc2-221">**Merge** 和 **MergeCaseInsensitive** 之間的差異在於處理重複屬性值的方式。</span><span class="sxs-lookup"><span data-stu-id="46dc2-221">The difference between **Merge** and **MergeCaseInsensitive** is how to process duplicate attribute values.</span></span> <span data-ttu-id="46dc2-222">同步處理引擎可確保不會將重複的值插入目標屬性中。</span><span class="sxs-lookup"><span data-stu-id="46dc2-222">The sync engine makes sure duplicate values are not inserted into the target attribute.</span></span> <span data-ttu-id="46dc2-223">使用 [MergeCaseInsensitive] ，就不會出現只有大小寫差異的重複值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-223">With **MergeCaseInsensitive**, duplicate values with only a difference in case are not going to be present.</span></span> <span data-ttu-id="46dc2-224">例如，您不應該在目標屬性中同時看到 SMTP:bob@contoso.com 和 smtp:bob@contoso.com。</span><span class="sxs-lookup"><span data-stu-id="46dc2-224">For example, you should not see both "SMTP:bob@contoso.com" and "smtp:bob@contoso.com" in the target attribute.</span></span> <span data-ttu-id="46dc2-225"> 只會查看只可能出現大小寫差異的確切值和多個值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-225">**Merge** is only looking at the exact values and multiple values where there only is a difference in case might be present.</span></span>

<span data-ttu-id="46dc2-226">**Replace** 選項與 **Update** 相同，但未使用。</span><span class="sxs-lookup"><span data-stu-id="46dc2-226">The option **Replace** is the same as **Update**, but it is not used.</span></span>

### <a name="control-the-attribute-flow-process"></a><span data-ttu-id="46dc2-227">控制屬性流程程序</span><span class="sxs-lookup"><span data-stu-id="46dc2-227">Control the attribute flow process</span></span>
<span data-ttu-id="46dc2-228">將多個輸入同步處理規則設定為貢獻於相同的 Metaverse 屬性時，則會使用優先順序來決定獲得採用的規則。</span><span class="sxs-lookup"><span data-stu-id="46dc2-228">When multiple inbound sync rules are configured to contribute to the same metaverse attribute, then precedence is used to determine the winner.</span></span> <span data-ttu-id="46dc2-229">具有最高優先順序 (最小數值) 的同步處理規則將會貢獻值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-229">The sync rule with highest precedence (lowest numeric value) is going to contribute the value.</span></span> <span data-ttu-id="46dc2-230">輸出規則的情況一樣。</span><span class="sxs-lookup"><span data-stu-id="46dc2-230">The same happens for outbound rules.</span></span> <span data-ttu-id="46dc2-231">具有最高優先順序的同步處理規則會獲得採用，並貢獻值給已連接的目錄。</span><span class="sxs-lookup"><span data-stu-id="46dc2-231">The sync rule with highest precedence wins and contribute the value to the connected directory.</span></span>

<span data-ttu-id="46dc2-232">在某些情況下，同步處理規則應該判斷其他規則的行為方式，而不是貢獻值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-232">In some cases, rather than contribute a value, the sync rule should determine how other rules should behave.</span></span> <span data-ttu-id="46dc2-233">在此情況下會使用一些特殊的常值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-233">There are some special literals used for this case.</span></span>

<span data-ttu-id="46dc2-234">對於輸入同步處理規則，常值 **NULL** 可用來指出流程沒有要貢獻的值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-234">For inbound Synchronization Rules, the literal **NULL** can be used to indicate that the flow has no value to contribute.</span></span> <span data-ttu-id="46dc2-235">具有較低優先順序的其他規則可以貢獻一個值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-235">Another rule with lower precedence can contribute a value.</span></span> <span data-ttu-id="46dc2-236">如果沒有規則提供值，則會移除 Metaverse 屬性。</span><span class="sxs-lookup"><span data-stu-id="46dc2-236">If no rule contributed a value, then the metaverse attribute is removed.</span></span> <span data-ttu-id="46dc2-237">對於輸出規則，如果 **NULL** 是處理完所有同步處理規則後的最終值，則會在已連接的目錄中移除此值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-237">For an outbound rule, if **NULL** is the final value after all sync rules have been processed, then the value is removed in the connected directory.</span></span>

<span data-ttu-id="46dc2-238">常值 **AuthoritativeNull** 類似 **NULL**，但差別在於沒有較低優先順序的規則可以貢獻值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-238">The literal **AuthoritativeNull** is similar to **NULL** but with the difference that no lower precedence rules can contribute a value.</span></span>

<span data-ttu-id="46dc2-239">屬性流程也可以使用 **IgnoreThisFlow**。</span><span class="sxs-lookup"><span data-stu-id="46dc2-239">An attribute flow can also use **IgnoreThisFlow**.</span></span> <span data-ttu-id="46dc2-240">意思上類似於 NULL，表示沒有要貢獻的項目。</span><span class="sxs-lookup"><span data-stu-id="46dc2-240">It is similar to NULL in the sense that it indicates there is nothing to contribute.</span></span> <span data-ttu-id="46dc2-241">差別在於它不會移除目標中已經存在的值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-241">The difference is that it does not remove an already existing value in the target.</span></span> <span data-ttu-id="46dc2-242">好像屬性流程未曾出現一樣。</span><span class="sxs-lookup"><span data-stu-id="46dc2-242">It is like the attribute flow has never been there.</span></span>

<span data-ttu-id="46dc2-243">下列是一個範例：</span><span class="sxs-lookup"><span data-stu-id="46dc2-243">Here is an example:</span></span>

<span data-ttu-id="46dc2-244">在 *Out to AD - User Exchange hybrid* 可以找到下列流程：</span><span class="sxs-lookup"><span data-stu-id="46dc2-244">In *Out to AD - User Exchange hybrid* the following flow can be found:</span></span>  
`IIF([cloudSOAExchMailbox] = True,[cloudMSExchSafeSendersHash],IgnoreThisFlow)`  
<span data-ttu-id="46dc2-245">此運算式的意思是︰如果使用者信箱位於 Azure AD 中，則將屬性從 Azure AD 傳送至 AD。</span><span class="sxs-lookup"><span data-stu-id="46dc2-245">This expression should be read as: if the user mailbox is located in Azure AD, then flow the attribute from Azure AD to AD.</span></span> <span data-ttu-id="46dc2-246">如果並非如此，請勿將任何項目送回 Active Directory。</span><span class="sxs-lookup"><span data-stu-id="46dc2-246">If not, do not flow anything back to Active Directory.</span></span> <span data-ttu-id="46dc2-247">在此情況下，它會在 AD 中保留現有的值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-247">In this case, it would keep the existing value in AD.</span></span>

### <a name="importedvalue"></a><span data-ttu-id="46dc2-248">ImportedValue</span><span class="sxs-lookup"><span data-stu-id="46dc2-248">ImportedValue</span></span>
<span data-ttu-id="46dc2-249">函式 ImportedValue 與其他所有函式都不同，其屬性名稱必須以引號 (而非方括號) 括住：</span><span class="sxs-lookup"><span data-stu-id="46dc2-249">The function ImportedValue is different than all other functions since the attribute name must be enclosed in quotes rather than square brackets:</span></span>  
<span data-ttu-id="46dc2-250">`ImportedValue("proxyAddresses")`。</span><span class="sxs-lookup"><span data-stu-id="46dc2-250">`ImportedValue("proxyAddresses")`.</span></span>

<span data-ttu-id="46dc2-251">通常在同步處理期間，屬性會使用預期的值，即使它尚未匯出或在匯出期間 (「協定塔的頂端」) 收到錯誤。</span><span class="sxs-lookup"><span data-stu-id="46dc2-251">Usually during synchronization an attribute uses the expected value, even if it hasn’t been exported yet or an error was received during export (“top of the tower”).</span></span> <span data-ttu-id="46dc2-252">輸入同步處理會假設尚未到達已連接目錄的屬性最後還是會到達。</span><span class="sxs-lookup"><span data-stu-id="46dc2-252">An inbound synchronization assumes that an attribute that hasn’t yet reached a connected directory eventually reaches it.</span></span> <span data-ttu-id="46dc2-253">在某些情況下，請務必只同步處理已連接目錄所確認的值 (「全像圖和差異匯入協定塔」)。</span><span class="sxs-lookup"><span data-stu-id="46dc2-253">In some cases, it is important to only synchronize a value that has been confirmed by the connected directory (“hologram and delta import tower”).</span></span>

<span data-ttu-id="46dc2-254">在現成可用的同步處理規則 In from AD – User Common from Exchange 中可以找到此函式的範例。</span><span class="sxs-lookup"><span data-stu-id="46dc2-254">An example of this function can be found in the out-of-box Synchronization Rule *In from AD – User Common from Exchange*.</span></span> <span data-ttu-id="46dc2-255">在混合式 Exchange 中，由 Exchange Online 新增的值只有在確認已成功匯出該值時，才能同步處理：</span><span class="sxs-lookup"><span data-stu-id="46dc2-255">In Hybrid Exchange, the value added by Exchange online should only be synchronized when it has been confirmed that the value was exported successfully:</span></span>  
`proxyAddresses` <- `RemoveDuplicates(Trim(ImportedValue("proxyAddresses")))`

## <a name="precedence"></a><span data-ttu-id="46dc2-256">優先順序</span><span class="sxs-lookup"><span data-stu-id="46dc2-256">Precedence</span></span>
<span data-ttu-id="46dc2-257">當數個同步處理規則嘗試將相同的屬性貢獻給目標時，則會使用優先順序值來決定獲得採用的規則。</span><span class="sxs-lookup"><span data-stu-id="46dc2-257">When several sync rules try to contribute the same attribute value to the target, the precedence value is used to determine the winner.</span></span> <span data-ttu-id="46dc2-258">具有最高優先順序 (最小數值) 的規則將會在衝突中貢獻此屬性。</span><span class="sxs-lookup"><span data-stu-id="46dc2-258">The rule with highest precedence, lowest numeric value, is going to contribute the attribute in a conflict.</span></span>

![合併類型](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/precedence1.png)  

<span data-ttu-id="46dc2-260">此排序方式可針對一小部分的物件，用來定義更精確的屬性流程。</span><span class="sxs-lookup"><span data-stu-id="46dc2-260">This ordering can be used to define more precise attribute flows for a small subset of objects.</span></span> <span data-ttu-id="46dc2-261">例如，現成可用的規則會確定已啟用帳戶 (**User AccountEnabled**) 的屬性優先於其他帳戶的屬性。</span><span class="sxs-lookup"><span data-stu-id="46dc2-261">For example, the out-of-box-rules make sure that attributes from an enabled account (**User AccountEnabled**) have precedence from other accounts.</span></span>

<span data-ttu-id="46dc2-262">可以定義連接器之間的優先順序。</span><span class="sxs-lookup"><span data-stu-id="46dc2-262">Precedence can be defined between Connectors.</span></span> <span data-ttu-id="46dc2-263">這可讓具有較佳資料的連接器先貢獻值。</span><span class="sxs-lookup"><span data-stu-id="46dc2-263">That allows Connectors with better data to contribute values first.</span></span>

### <a name="multiple-objects-from-the-same-connector-space"></a><span data-ttu-id="46dc2-264">相同連接器空間中的多個物件</span><span class="sxs-lookup"><span data-stu-id="46dc2-264">Multiple objects from the same connector space</span></span>
<span data-ttu-id="46dc2-265">如果在聯結至相同 Metaverse 物件的相同連接器空間中有數個物件，則必須調整優先順序。</span><span class="sxs-lookup"><span data-stu-id="46dc2-265">If you have several objects in the same connector space joined to the same metaverse object, precedence must be adjusted.</span></span> <span data-ttu-id="46dc2-266">如果數個物件都是在相同同步處理規則的範圍中，則同步處理引擎便無法判斷優先順序。</span><span class="sxs-lookup"><span data-stu-id="46dc2-266">If several objects are in scope of the same sync rule, then the sync engine is not able to determine precedence.</span></span> <span data-ttu-id="46dc2-267">應該貢獻值給 Metaverse 的來源物件模稜兩可。</span><span class="sxs-lookup"><span data-stu-id="46dc2-267">It is ambiguous which source object should contribute the value to the metaverse.</span></span> <span data-ttu-id="46dc2-268">即使來源中的屬性具有相同的值，此組態仍會回報為模稜兩可。</span><span class="sxs-lookup"><span data-stu-id="46dc2-268">This configuration is reported as ambiguous even if the attributes in the source have the same value.</span></span>  
![多個物件聯結至相同的 mv 物件](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/multiple1.png)  

<span data-ttu-id="46dc2-270">在此案例中，您需要變更同步處理規則的範圍，讓來源物件在範圍中有不同的同步處理規則。</span><span class="sxs-lookup"><span data-stu-id="46dc2-270">For this scenario, you need to change the scope of the sync rules so the source objects have different sync rules in scope.</span></span> <span data-ttu-id="46dc2-271">這可讓您定義不同的優先順序。</span><span class="sxs-lookup"><span data-stu-id="46dc2-271">That allows you to define different precedence.</span></span>  
![多個物件聯結至相同的 mv 物件](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/multiple2.png)  

## <a name="next-steps"></a><span data-ttu-id="46dc2-273">後續步驟</span><span class="sxs-lookup"><span data-stu-id="46dc2-273">Next steps</span></span>
* <span data-ttu-id="46dc2-274">如需運算式語言的詳細資訊，請參閱 [了解宣告式佈建運算式](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md)。</span><span class="sxs-lookup"><span data-stu-id="46dc2-274">Read more about the expression language in [Understanding Declarative Provisioning Expressions](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md).</span></span>
* <span data-ttu-id="46dc2-275">如需了解如何立即使用宣告式佈建，請參閱 [了解預設組態](active-directory-aadconnectsync-understanding-default-configuration.md)。</span><span class="sxs-lookup"><span data-stu-id="46dc2-275">See how declarative provisioning is used out-of-box in [Understanding the default configuration](active-directory-aadconnectsync-understanding-default-configuration.md).</span></span>
* <span data-ttu-id="46dc2-276">如需了解如何使用宣告式佈建進行實際變更，請參閱 [如何變更預設組態](active-directory-aadconnectsync-change-the-configuration.md)。</span><span class="sxs-lookup"><span data-stu-id="46dc2-276">See how to make a practical change using declarative provisioning in [How to make a change to the default configuration](active-directory-aadconnectsync-change-the-configuration.md).</span></span>
* <span data-ttu-id="46dc2-277">如需了解使用者與連絡人的共同運作方式，請繼續閱讀 [了解使用者和連絡人](active-directory-aadconnectsync-understanding-users-and-contacts.md)。</span><span class="sxs-lookup"><span data-stu-id="46dc2-277">Continue to read how users and contacts work together in [Understanding Users and Contacts](active-directory-aadconnectsync-understanding-users-and-contacts.md).</span></span>

<span data-ttu-id="46dc2-278">**概觀主題**</span><span class="sxs-lookup"><span data-stu-id="46dc2-278">**Overview topics**</span></span>

* [<span data-ttu-id="46dc2-279">Azure AD Connect 同步處理：了解及自訂同步處理</span><span class="sxs-lookup"><span data-stu-id="46dc2-279">Azure AD Connect sync: Understand and customize synchronization</span></span>](active-directory-aadconnectsync-whatis.md)
* [<span data-ttu-id="46dc2-280">整合內部部署身分識別與 Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="46dc2-280">Integrating your on-premises identities with Azure Active Directory</span></span>](active-directory-aadconnect.md)

<span data-ttu-id="46dc2-281">**參考主題**</span><span class="sxs-lookup"><span data-stu-id="46dc2-281">**Reference topics**</span></span>

* [<span data-ttu-id="46dc2-282">Azure AD Connect 同步處理：函式參考</span><span class="sxs-lookup"><span data-stu-id="46dc2-282">Azure AD Connect sync: Functions Reference</span></span>](active-directory-aadconnectsync-functions-reference.md)
