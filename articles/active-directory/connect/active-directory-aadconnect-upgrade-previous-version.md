---
title: "Azure AD Connect：從舊版升級 | Microsoft Docs"
description: "說明 hello 不同的方法 tooupgrade toohello 最新版的 Azure Active Directory Connect，包括就地升級和迴旋移轉。"
services: active-directory
documentationcenter: 
author: AndKjell
manager: femila
editor: 
ms.assetid: 31f084d8-2b89-478c-9079-76cf92e6618f
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: Identity
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: 57bd5b094654e4983cafa303b6f3daecadafb01c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="azure-ad-connect-upgrade-from-a-previous-version-toohello-latest"></a><span data-ttu-id="dd377-103">從先前版本 toohello 最新的 azure AD Connect： 升級</span><span class="sxs-lookup"><span data-stu-id="dd377-103">Azure AD Connect: Upgrade from a previous version toohello latest</span></span>
<span data-ttu-id="dd377-104">本主題描述 hello 不同，您可以使用 tooupgrade 您 Azure Active Directory (Azure AD) 連線安裝 toohello 最新版本的方法。</span><span class="sxs-lookup"><span data-stu-id="dd377-104">This topic describes hello different methods that you can use tooupgrade your Azure Active Directory (Azure AD) Connect installation toohello latest release.</span></span> <span data-ttu-id="dd377-105">我們建議您保留自己目前與 Azure AD connect 的 hello 發行版本。</span><span class="sxs-lookup"><span data-stu-id="dd377-105">We recommend that you keep yourself current with hello releases of Azure AD Connect.</span></span> <span data-ttu-id="dd377-106">您也使用 hello hello 步驟[迴旋移轉](#swing-migration)區段進行大量的設定變更時。</span><span class="sxs-lookup"><span data-stu-id="dd377-106">You also use hello steps in hello [Swing migration](#swing-migration) section when you make a substantial configuration change.</span></span>

<span data-ttu-id="dd377-107">如果您想從 DirSync tooupgrade，請參閱[從 Azure AD 同步作業工具 (DirSync) 升級](active-directory-aadconnect-dirsync-upgrade-get-started.md)改為。</span><span class="sxs-lookup"><span data-stu-id="dd377-107">If you want tooupgrade from DirSync, see [Upgrade from Azure AD sync tool (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md) instead.</span></span>

<span data-ttu-id="dd377-108">有幾個不同的策略，您可以使用 Azure AD Connect tooupgrade。</span><span class="sxs-lookup"><span data-stu-id="dd377-108">There are a few different strategies that you can use tooupgrade Azure AD Connect.</span></span>

| <span data-ttu-id="dd377-109">方法</span><span class="sxs-lookup"><span data-stu-id="dd377-109">Method</span></span> | <span data-ttu-id="dd377-110">說明</span><span class="sxs-lookup"><span data-stu-id="dd377-110">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="dd377-111">自動升級</span><span class="sxs-lookup"><span data-stu-id="dd377-111">Automatic upgrade</span></span>](active-directory-aadconnect-feature-automatic-upgrade.md) |<span data-ttu-id="dd377-112">這是 hello 的客戶進行快速安裝最簡單的方法。</span><span class="sxs-lookup"><span data-stu-id="dd377-112">This is hello easiest method for customers with an express installation.</span></span> |
| [<span data-ttu-id="dd377-113">就地升級</span><span class="sxs-lookup"><span data-stu-id="dd377-113">In-place upgrade</span></span>](#in-place-upgrade) |<span data-ttu-id="dd377-114">如果您有一部伺服器，您可以在升級 hello 安裝就地 hello 相同的伺服器。</span><span class="sxs-lookup"><span data-stu-id="dd377-114">If you have a single server, you can upgrade hello installation in-place on hello same server.</span></span> |
| [<span data-ttu-id="dd377-115">變換移轉</span><span class="sxs-lookup"><span data-stu-id="dd377-115">Swing migration</span></span>](#swing-migration) |<span data-ttu-id="dd377-116">兩部伺服器，您可以準備 hello hello 新版本或組態中，伺服器的其中一個，並變更 hello 作用中的伺服器，當您準備好。</span><span class="sxs-lookup"><span data-stu-id="dd377-116">With two servers, you can prepare one of hello servers with hello new release or configuration, and change hello active server when you're ready.</span></span> |

<span data-ttu-id="dd377-117">權限資訊，請參閱 hello[升級必要的權限](active-directory-aadconnect-accounts-permissions.md#upgrade)。</span><span class="sxs-lookup"><span data-stu-id="dd377-117">For permissions information, see hello [permissions required for an upgrade](active-directory-aadconnect-accounts-permissions.md#upgrade).</span></span>

> [!NOTE]
> <span data-ttu-id="dd377-118">啟用您新 Azure AD Connect 伺服器 toostart 同步處理變更 tooAzure AD 之後，您必須復原 toousing DirSync 或 Azure AD Sync。從 Azure AD Connect toolegacy 用戶端，包括 DirSync 和 Azure AD Sync，降級不受支援，而且可能會在 Azure AD 中的 tooissues，例如資料遺失。</span><span class="sxs-lookup"><span data-stu-id="dd377-118">After you've enabled your new Azure AD Connect server toostart synchronizing changes tooAzure AD, you must not roll back toousing DirSync or Azure AD Sync. Downgrading from Azure AD Connect toolegacy clients, including DirSync and Azure AD Sync, isn't supported and can lead tooissues such as data loss in Azure AD.</span></span>

## <a name="in-place-upgrade"></a><span data-ttu-id="dd377-119">就地升級</span><span class="sxs-lookup"><span data-stu-id="dd377-119">In-place upgrade</span></span>
<span data-ttu-id="dd377-120">就地升級適用於從 Azure AD Sync 或 Azure AD Connect 移轉，</span><span class="sxs-lookup"><span data-stu-id="dd377-120">An in-place upgrade works for moving from Azure AD Sync or Azure AD Connect.</span></span> <span data-ttu-id="dd377-121">但不適用於從 DirSync 移轉，也不適用於任何利用 Forefront Identity Manager (FIM) + Azure AD 連接器的解決方案。</span><span class="sxs-lookup"><span data-stu-id="dd377-121">It doesn't work for moving from DirSync or for a solution with Forefront Identity Manager (FIM) + Azure AD Connector.</span></span>

<span data-ttu-id="dd377-122">您只有一台伺服器，且擁有的物件少於 100000 個時，這個方法是最適合您。</span><span class="sxs-lookup"><span data-stu-id="dd377-122">This method is preferred when you have a single server and less than about 100,000 objects.</span></span> <span data-ttu-id="dd377-123">如果有任何變更 toohello 現成的同步處理規則，hello 升級之後會發生完整匯入和完整同步處理。</span><span class="sxs-lookup"><span data-stu-id="dd377-123">If there are any changes toohello out-of-box sync rules, a full import and full synchronization occur after hello upgrade.</span></span> <span data-ttu-id="dd377-124">這個方法會確保 hello 新設定將套用的 tooall 現有物件處於 hello 系統。</span><span class="sxs-lookup"><span data-stu-id="dd377-124">This method ensures that hello new configuration is applied tooall existing objects in hello system.</span></span> <span data-ttu-id="dd377-125">此回合可能需要幾個小時，而是根據 hello 範圍中的 hello 同步處理引擎的物件數目。</span><span class="sxs-lookup"><span data-stu-id="dd377-125">This run might take a few hours, depending on hello number of objects that are in scope of hello sync engine.</span></span> <span data-ttu-id="dd377-126">暫止 hello 一般差異同步處理排程器 （可同步處理預設每隔 30 分鐘），但密碼同步處理繼續進行。</span><span class="sxs-lookup"><span data-stu-id="dd377-126">hello normal delta synchronization scheduler (which synchronizes every 30 minutes by default) is suspended, but password synchronization continues.</span></span> <span data-ttu-id="dd377-127">您可能會考慮在週末期間 hello 就地升級。</span><span class="sxs-lookup"><span data-stu-id="dd377-127">You might consider doing hello in-place upgrade during a weekend.</span></span> <span data-ttu-id="dd377-128">如果有任何變更 toohello 鶈蜪設定的 hello 新的 Azure AD Connect 版本，然後一般差異匯入/同步處理開始改為。</span><span class="sxs-lookup"><span data-stu-id="dd377-128">If there are no changes toohello out-of-box configuration with hello new Azure AD Connect release, then a normal delta import/sync starts instead.</span></span>  
![就地升級](./media/active-directory-aadconnect-upgrade-previous-version/inplaceupgrade.png)

<span data-ttu-id="dd377-130">如果您所做的變更 toohello 現成的同步處理規則，然後設定這些規則是回 toohello 預設組態升級時。</span><span class="sxs-lookup"><span data-stu-id="dd377-130">If you've made changes toohello out-of-box synchronization rules, then these rules are set back toohello default configuration on upgrade.</span></span> <span data-ttu-id="dd377-131">toomake 確定您的設定會保留之間升級時，請確定您進行變更，如所述[變更 hello 預設組態的最佳做法](active-directory-aadconnectsync-best-practices-changing-default-configuration.md)。</span><span class="sxs-lookup"><span data-stu-id="dd377-131">toomake sure that your configuration is kept between upgrades, make sure that you make changes as they're described in [Best practices for changing hello default configuration](active-directory-aadconnectsync-best-practices-changing-default-configuration.md).</span></span>

<span data-ttu-id="dd377-132">就地升級時，有可能無法導入需要特定的同步處理活動 （包括完整匯入步驟和完整同步處理步驟） toobe 升級完成之後執行的變更。</span><span class="sxs-lookup"><span data-stu-id="dd377-132">During in-place upgrade, there may be changes introduced that require specific synchronization activities (including Full Import step and Full Synchronization step) toobe executed after upgrade completes.</span></span> <span data-ttu-id="dd377-133">toodefer 這類活動，請參閱 toosection [toodefer 完整升級後的同步處理的方式](#how-to-defer-full-synchronization-after-upgrade)。</span><span class="sxs-lookup"><span data-stu-id="dd377-133">toodefer such activities, refer toosection [How toodefer full synchronization after upgrade](#how-to-defer-full-synchronization-after-upgrade).</span></span>

## <a name="swing-migration"></a><span data-ttu-id="dd377-134">變換移轉</span><span class="sxs-lookup"><span data-stu-id="dd377-134">Swing migration</span></span>
<span data-ttu-id="dd377-135">如果您有複雜的部署或多個物件，它可能不太實用 toodo hello 即時系統的就地升級。</span><span class="sxs-lookup"><span data-stu-id="dd377-135">If you have a complex deployment or many objects, it might be impractical toodo an in-place upgrade on hello live system.</span></span> <span data-ttu-id="dd377-136">就某些客戶而言，此程序可能需花好幾天的時間，而在這段期間並不會處理任何差異變更。</span><span class="sxs-lookup"><span data-stu-id="dd377-136">For some customers, this process might take multiple days--and during this time, no delta changes are processed.</span></span> <span data-ttu-id="dd377-137">您也可以使用這個方法，當您計劃 toomake 大量變更 tooyour 組態，而且您想 tootry 文之前它們正在推送 toohello 雲端。</span><span class="sxs-lookup"><span data-stu-id="dd377-137">You can also use this method when you plan toomake substantial changes tooyour configuration and you want tootry them out before they're pushed toohello cloud.</span></span>

<span data-ttu-id="dd377-138">建議使用的方法，這些案例的 hello 是 toouse 迴旋移轉。</span><span class="sxs-lookup"><span data-stu-id="dd377-138">hello recommended method for these scenarios is toouse a swing migration.</span></span> <span data-ttu-id="dd377-139">您需要 (至少) 兩台伺服器，一台是作用中伺服器，而另一台是預備伺服器。</span><span class="sxs-lookup"><span data-stu-id="dd377-139">You need (at least) two servers--one active server and one staging server.</span></span> <span data-ttu-id="dd377-140">hello （hello 遵循圖片的藍色實線顯示） 的使用中伺服器負責 hello 作用中的生產負載。</span><span class="sxs-lookup"><span data-stu-id="dd377-140">hello active server (shown with solid blue lines in hello following picture) is responsible for hello active production load.</span></span> <span data-ttu-id="dd377-141">hello 開發用伺服器 （虛線紫色顯示） 已準備好 hello 新版本或設定。</span><span class="sxs-lookup"><span data-stu-id="dd377-141">hello staging server (shown with dashed purple lines) is prepared with hello new release or configuration.</span></span> <span data-ttu-id="dd377-142">準備就緒時，這台伺服器的狀態會變成作用中。</span><span class="sxs-lookup"><span data-stu-id="dd377-142">When it's fully ready, this server is made active.</span></span> <span data-ttu-id="dd377-143">hello 先前作用中伺服器，現在 hello 舊版本或安裝設定，會進行到開發用伺服器 hello 並會升級。</span><span class="sxs-lookup"><span data-stu-id="dd377-143">hello previous active server, which now has hello old version or configuration installed, is made into hello staging server and is upgraded.</span></span>

<span data-ttu-id="dd377-144">hello 兩部伺服器可以使用不同的版本。</span><span class="sxs-lookup"><span data-stu-id="dd377-144">hello two servers can use different versions.</span></span> <span data-ttu-id="dd377-145">例如，您計劃 toodecommission hello 作用中的伺服器可以使用 Azure AD Sync，和 hello 新臨時伺服器可以使用 Azure AD Connect。</span><span class="sxs-lookup"><span data-stu-id="dd377-145">For example, hello active server that you plan toodecommission can use Azure AD Sync, and hello new staging server can use Azure AD Connect.</span></span> <span data-ttu-id="dd377-146">如果您使用迴旋移轉 toodevelop 新的組態，它的建議 toohave hello 相同的版本上 hello 兩部伺服器。</span><span class="sxs-lookup"><span data-stu-id="dd377-146">If you use swing migration toodevelop a new configuration, it's a good idea toohave hello same versions on hello two servers.</span></span>  
![預備伺服器](./media/active-directory-aadconnect-upgrade-previous-version/stagingserver1.png)

> [!NOTE]
> <span data-ttu-id="dd377-148">某些客戶比較傾向 toohave 三或四個伺服器，在此案例。</span><span class="sxs-lookup"><span data-stu-id="dd377-148">Some customers prefer toohave three or four servers for this scenario.</span></span> <span data-ttu-id="dd377-149">開發用伺服器 hello 升級資料庫時，您不需要的備份伺服器[嚴重損壞修復](active-directory-aadconnectsync-operations.md#disaster-recovery)。</span><span class="sxs-lookup"><span data-stu-id="dd377-149">When hello staging server is upgraded, you don't have a backup server for [disaster recovery](active-directory-aadconnectsync-operations.md#disaster-recovery).</span></span> <span data-ttu-id="dd377-150">有三或四個伺服器，您就可以準備一組的 hello 新版本，確保永遠位於準備 tootake 臨時伺服器的主要/待命伺服器。</span><span class="sxs-lookup"><span data-stu-id="dd377-150">With three or four servers, you can prepare one set of primary/standby servers with hello new version, which ensures that there is always a staging server that's ready tootake over.</span></span>

<span data-ttu-id="dd377-151">這些步驟也適用 toomove 從 Azure AD 同步或 FIM + Azure AD 連接器具有的解決方案。</span><span class="sxs-lookup"><span data-stu-id="dd377-151">These steps also work toomove from Azure AD Sync or a solution with FIM + Azure AD Connector.</span></span> <span data-ttu-id="dd377-152">這些步驟沒有作用的目錄同步，但卻是相同迴旋移轉方法 （也稱為平行部署） 的步驟進行目錄同步處理的 hello[升級 Azure Active Directory 同步作業 (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md)。</span><span class="sxs-lookup"><span data-stu-id="dd377-152">These steps don't work for DirSync, but hello same swing migration method (also called parallel deployment) with steps for DirSync is in [Upgrade Azure Active Directory sync (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md).</span></span>

### <a name="use-a-swing-migration-tooupgrade"></a><span data-ttu-id="dd377-153">使用迴旋移轉 tooupgrade</span><span class="sxs-lookup"><span data-stu-id="dd377-153">Use a swing migration tooupgrade</span></span>
1. <span data-ttu-id="dd377-154">當您使用 Azure AD Connect 的伺服器和計劃 tooonly 進行組態變更，請確定您的作用中的伺服器和臨時伺服器會同時使用 hello 相同版本。</span><span class="sxs-lookup"><span data-stu-id="dd377-154">If you use Azure AD Connect on both servers and plan tooonly make a configuration change, make sure that your active server and staging server are both using hello same version.</span></span> <span data-ttu-id="dd377-155">可讓您更輕鬆 toocompare 差異更新版本。</span><span class="sxs-lookup"><span data-stu-id="dd377-155">That makes it easier toocompare differences later.</span></span> <span data-ttu-id="dd377-156">如果您從 Azure AD 同步進行升級，這些伺服器會有不同的版本。</span><span class="sxs-lookup"><span data-stu-id="dd377-156">If you're upgrading from Azure AD Sync, then these servers have different versions.</span></span> <span data-ttu-id="dd377-157">如果您要從較舊版本的 Azure AD Connect 升級，它是個不錯的主意 toostart hello 兩個伺服器與使用 hello 相同的版本，但它不需要。</span><span class="sxs-lookup"><span data-stu-id="dd377-157">If you're upgrading from an older version of Azure AD Connect, it's a good idea toostart with hello two servers that are using hello same version, but it's not required.</span></span>
2. <span data-ttu-id="dd377-158">如果您所做的自訂組態，且您的臨時伺服器沒有它，請遵循下的 hello 步驟[移動自訂設定從臨時伺服器 hello active server toohello](#move-custom-configuration-from-active-to-staging-server)。</span><span class="sxs-lookup"><span data-stu-id="dd377-158">If you've made a custom configuration and your staging server doesn't have it, follow hello steps under [Move a custom configuration from hello active server toohello staging server](#move-custom-configuration-from-active-to-staging-server).</span></span>
3. <span data-ttu-id="dd377-159">如果您要從 Azure AD Connect 先前的版本升級，升級 hello 暫存伺服器 toohello 最新版本。</span><span class="sxs-lookup"><span data-stu-id="dd377-159">If you're upgrading from an earlier release of Azure AD Connect, upgrade hello staging server toohello latest version.</span></span> <span data-ttu-id="dd377-160">如果您要從 Azure AD 同步進行移動，請在預備伺服器上安裝 Azure AD Connect。</span><span class="sxs-lookup"><span data-stu-id="dd377-160">If you're moving from Azure AD Sync, then install Azure AD Connect on your staging server.</span></span>
4. <span data-ttu-id="dd377-161">可讓 hello 同步處理引擎執行完整匯入和完整同步處理您的臨時伺服器上。</span><span class="sxs-lookup"><span data-stu-id="dd377-161">Let hello sync engine run full import and full synchronization on your staging server.</span></span>
5. <span data-ttu-id="dd377-162">確認中的 hello 新設定未使用 [驗證] 下的 hello 步驟而造成未預期的任何變更[確認伺服器的 hello 設定](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server)。</span><span class="sxs-lookup"><span data-stu-id="dd377-162">Verify that hello new configuration didn't cause any unexpected changes by using hello steps under "Verify" in [Verify hello configuration of a server](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span></span> <span data-ttu-id="dd377-163">如果項目未如預期，正確，執行 hello 匯入和同步處理，並確認 hello 資料，使其看起來不錯，依照 hello 步驟。</span><span class="sxs-lookup"><span data-stu-id="dd377-163">If something isn't as expected, correct it, run hello import and sync, and verify hello data until it looks good, by following hello steps.</span></span>
6. <span data-ttu-id="dd377-164">切換 hello 暫存伺服器 toobe hello 作用中的伺服器。</span><span class="sxs-lookup"><span data-stu-id="dd377-164">Switch hello staging server toobe hello active server.</span></span> <span data-ttu-id="dd377-165">這是最後一個步驟 「 交換器的作用中伺服器 」 hello[確認伺服器的 hello 設定](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server)。</span><span class="sxs-lookup"><span data-stu-id="dd377-165">This is hello final step "Switch active server" in [Verify hello configuration of a server](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span></span>
7. <span data-ttu-id="dd377-166">如果您要升級 Azure AD Connect，請在現在預備模式 toohello 最新版本的 hello 伺服器升級。</span><span class="sxs-lookup"><span data-stu-id="dd377-166">If you're upgrading Azure AD Connect, upgrade hello server that's now in staging mode toohello latest release.</span></span> <span data-ttu-id="dd377-167">請遵循相同步驟之前 tooget hello 資料和設定升級的 hello。</span><span class="sxs-lookup"><span data-stu-id="dd377-167">Follow hello same steps as before tooget hello data and configuration upgraded.</span></span> <span data-ttu-id="dd377-168">如果您是從 Azure AD Sync 進行升級，現在可以關閉舊伺服器並解除任務。</span><span class="sxs-lookup"><span data-stu-id="dd377-168">If you upgraded from Azure AD Sync, you can now turn off and decommission your old server.</span></span>

### <a name="move-a-custom-configuration-from-hello-active-server-toohello-staging-server"></a><span data-ttu-id="dd377-169">移動自訂組態從 hello active server toohello 臨時伺服器</span><span class="sxs-lookup"><span data-stu-id="dd377-169">Move a custom configuration from hello active server toohello staging server</span></span>
<span data-ttu-id="dd377-170">如果您所做的組態變更 toohello 作用中的伺服器，您需要 toomake 確定 hello 相同的變更會套用的 toohello 臨時伺服器。</span><span class="sxs-lookup"><span data-stu-id="dd377-170">If you've made configuration changes toohello active server, you need toomake sure that hello same changes are applied toohello staging server.</span></span> <span data-ttu-id="dd377-171">與這個 toohelp 移動，您可以使用 hello [Azure AD Connect 設定文件產生器](https://github.com/Microsoft/AADConnectConfigDocumenter)。</span><span class="sxs-lookup"><span data-stu-id="dd377-171">toohelp with this move, you can use hello [Azure AD Connect configuration documenter](https://github.com/Microsoft/AADConnectConfigDocumenter).</span></span>

<span data-ttu-id="dd377-172">您可以移動您使用 PowerShell 建立的 hello 自訂同步處理規則。</span><span class="sxs-lookup"><span data-stu-id="dd377-172">You can move hello custom sync rules that you've created by using PowerShell.</span></span> <span data-ttu-id="dd377-173">您必須先套用其他變更 hello 相同的方式上的系統，而且您無法移轉 hello 變更。</span><span class="sxs-lookup"><span data-stu-id="dd377-173">You must apply other changes hello same way on both systems, and you can't migrate hello changes.</span></span> <span data-ttu-id="dd377-174">hello[組態文件產生器](https://github.com/Microsoft/AADConnectConfigDocumenter)可協助您比較兩個 hello 系統 toomake 確定它們是否完全相同。</span><span class="sxs-lookup"><span data-stu-id="dd377-174">hello [configuration documenter](https://github.com/Microsoft/AADConnectConfigDocumenter) can help you comparing hello two systems toomake sure they are identical.</span></span> <span data-ttu-id="dd377-175">hello 工具也可協助自動化 hello 本章節的步驟。</span><span class="sxs-lookup"><span data-stu-id="dd377-175">hello tool can also help in automating hello steps found in this section.</span></span>

<span data-ttu-id="dd377-176">您需要 tooconfigure hello 下列項目 hello 相同兩部伺服器上的方式：</span><span class="sxs-lookup"><span data-stu-id="dd377-176">You need tooconfigure hello following things hello same way on both servers:</span></span>

* <span data-ttu-id="dd377-177">連接 toohello 相同的樹系</span><span class="sxs-lookup"><span data-stu-id="dd377-177">Connection toohello same forests</span></span>
* <span data-ttu-id="dd377-178">任何網域及 OU 篩選</span><span class="sxs-lookup"><span data-stu-id="dd377-178">Any domain and OU filtering</span></span>
* <span data-ttu-id="dd377-179">hello 相同的選用功能，例如密碼同步及密碼回寫</span><span class="sxs-lookup"><span data-stu-id="dd377-179">hello same optional features, such as password sync and password writeback</span></span>

<span data-ttu-id="dd377-180">**移動自訂同步處理規則**</span><span class="sxs-lookup"><span data-stu-id="dd377-180">**Move custom synchronization rules**</span></span>  
<span data-ttu-id="dd377-181">toomove 自訂同步處理規則，hello 遵循：</span><span class="sxs-lookup"><span data-stu-id="dd377-181">toomove custom synchronization rules, do hello following:</span></span>

1. <span data-ttu-id="dd377-182">開啟作用中伺服器上的 [同步處理規則編輯器]  。</span><span class="sxs-lookup"><span data-stu-id="dd377-182">Open **Synchronization Rules Editor** on your active server.</span></span>
2. <span data-ttu-id="dd377-183">選取自訂規則。</span><span class="sxs-lookup"><span data-stu-id="dd377-183">Select a custom rule.</span></span> <span data-ttu-id="dd377-184">按一下 [匯出]。</span><span class="sxs-lookup"><span data-stu-id="dd377-184">Click **Export**.</span></span> <span data-ttu-id="dd377-185">此時會出現一個 [記事本] 視窗。</span><span class="sxs-lookup"><span data-stu-id="dd377-185">This brings up a Notepad window.</span></span> <span data-ttu-id="dd377-186">以 PS1 副檔名儲存 hello 暫存檔案。</span><span class="sxs-lookup"><span data-stu-id="dd377-186">Save hello temporary file with a PS1 extension.</span></span> <span data-ttu-id="dd377-187">這會讓該檔案變成 PowerShell 指令碼。</span><span class="sxs-lookup"><span data-stu-id="dd377-187">This makes it a PowerShell script.</span></span> <span data-ttu-id="dd377-188">將複製 hello PS1 檔案 toohello 臨時伺服器。</span><span class="sxs-lookup"><span data-stu-id="dd377-188">Copy hello PS1 file toohello staging server.</span></span>  
   <span data-ttu-id="dd377-189">![同步處理規則匯出](./media/active-directory-aadconnect-upgrade-previous-version/exportrule.png)</span><span class="sxs-lookup"><span data-stu-id="dd377-189">![Sync rule export](./media/active-directory-aadconnect-upgrade-previous-version/exportrule.png)</span></span>
3. <span data-ttu-id="dd377-190">hello 連接器 GUID 不同 hello 臨時伺服器上，且您必須變更它。</span><span class="sxs-lookup"><span data-stu-id="dd377-190">hello Connector GUID is different on hello staging server, and you must change it.</span></span> <span data-ttu-id="dd377-191">tooget hello GUID，啟動**同步處理規則編輯器**，選取其中一個 hello 鶈蜪規則相同連線系統中，然後按一下該代表 hello**匯出**。</span><span class="sxs-lookup"><span data-stu-id="dd377-191">tooget hello GUID, start **Synchronization Rules Editor**, select one of hello out-of-box rules that represent hello same connected system, and click **Export**.</span></span> <span data-ttu-id="dd377-192">從臨時伺服器 hello hello GUID 取代 hello PS1 檔案中的 GUID。</span><span class="sxs-lookup"><span data-stu-id="dd377-192">Replace hello GUID in your PS1 file with hello GUID from hello staging server.</span></span>
4. <span data-ttu-id="dd377-193">在 PowerShell 命令提示字元中，執行 hello PS1 檔案。</span><span class="sxs-lookup"><span data-stu-id="dd377-193">In a PowerShell prompt, run hello PS1 file.</span></span> <span data-ttu-id="dd377-194">這會建立暫存伺服器 hello hello 自訂同步處理規則。</span><span class="sxs-lookup"><span data-stu-id="dd377-194">This creates hello custom synchronization rule on hello staging server.</span></span>
5. <span data-ttu-id="dd377-195">針對所有自訂規則重複此步驟。</span><span class="sxs-lookup"><span data-stu-id="dd377-195">Repeat this for all your custom rules.</span></span>

## <a name="how-toodefer-full-synchronization-after-upgrade"></a><span data-ttu-id="dd377-196">Toodefer 完整升級後的同步處理的方式</span><span class="sxs-lookup"><span data-stu-id="dd377-196">How toodefer full synchronization after upgrade</span></span>
<span data-ttu-id="dd377-197">就地升級時，有可能無法導入需要特定的同步處理活動 （包括完整匯入步驟和完整同步處理步驟） toobe 執行的變更。</span><span class="sxs-lookup"><span data-stu-id="dd377-197">During in-place upgrade, there may be changes introduced that require specific synchronization activities (including Full Import step and Full Synchronization step) toobe executed.</span></span> <span data-ttu-id="dd377-198">連接器結構描述變更的要求，例如**完整匯入**步驟和現成的同步處理規則變更需要**完整同步處理**步驟 toobe 受影響的連接器上執行。</span><span class="sxs-lookup"><span data-stu-id="dd377-198">For example, connector schema changes require **full import** step and out-of-box synchronization rule changes require **full synchronization** step toobe executed on affected connectors.</span></span> <span data-ttu-id="dd377-199">在升級期間，Azure AD Connect 會決定需要何種同步處理活動，並將其記錄為「覆寫」。</span><span class="sxs-lookup"><span data-stu-id="dd377-199">During upgrade, Azure AD Connect determines what synchronization activities are required and records them as *overrides*.</span></span> <span data-ttu-id="dd377-200">在下列同步處理循環的 hello，hello 同步處理排程器會收取這些覆寫，並執行。</span><span class="sxs-lookup"><span data-stu-id="dd377-200">In hello following synchronization cycle, hello synchronization scheduler picks up these overrides and executes them.</span></span> <span data-ttu-id="dd377-201">覆寫成功執行之後就會移除。</span><span class="sxs-lookup"><span data-stu-id="dd377-201">Once an override is successfully executed, it is removed.</span></span>

<span data-ttu-id="dd377-202">可能有一些情況，您不想這些覆寫 tootake 位置在升級之後立即。</span><span class="sxs-lookup"><span data-stu-id="dd377-202">There may be situations where you do not want these overrides tootake place immediately after upgrade.</span></span> <span data-ttu-id="dd377-203">例如，您有多個同步處理的物件，而您想讓這些同步處理步驟 toooccur 在上班時間之後。</span><span class="sxs-lookup"><span data-stu-id="dd377-203">For example, you have numerous synchronized objects and you would like these synchronization steps toooccur after business hours.</span></span> <span data-ttu-id="dd377-204">這些覆寫 tooremove:</span><span class="sxs-lookup"><span data-stu-id="dd377-204">tooremove these overrides:</span></span>

1. <span data-ttu-id="dd377-205">在升級期間，**取消核取**hello 選項**組態完成時啟動 hello 同步處理程序**。</span><span class="sxs-lookup"><span data-stu-id="dd377-205">During upgrade, **uncheck** hello option **Start hello synchronization process when configuration completes**.</span></span> <span data-ttu-id="dd377-206">這會停用 hello 同步處理排程器，並防止同步處理循環進行自動移除 hello 覆寫之前。</span><span class="sxs-lookup"><span data-stu-id="dd377-206">This disables hello synchronization scheduler and prevents synchronization cycle from taking place automatically before hello overrides are removed.</span></span>

   ![DisableFullSyncAfterUpgrade](./media/active-directory-aadconnect-upgrade-previous-version/disablefullsync01.png)

2. <span data-ttu-id="dd377-208">升級完成之後，執行下列 cmdlet 已加入哪些覆寫出的 toofind hello:`Get-ADSyncSchedulerConnectorOverride | fl`</span><span class="sxs-lookup"><span data-stu-id="dd377-208">After upgrade completes, run hello following cmdlet toofind out what overrides have been added: `Get-ADSyncSchedulerConnectorOverride | fl`</span></span>

   >[!NOTE]
   > <span data-ttu-id="dd377-209">hello 覆寫是連接器專屬的。</span><span class="sxs-lookup"><span data-stu-id="dd377-209">hello overrides are connector-specific.</span></span> <span data-ttu-id="dd377-210">Hello 在下列範例中，完整匯入步驟和完整同步處理步驟已加入 tooboth hello 內部部署 AD 連接器與 Azure AD 連接器。</span><span class="sxs-lookup"><span data-stu-id="dd377-210">In hello following example, Full Import step and Full Synchronization step have been added tooboth hello on-premises AD Connector and Azure AD Connector.</span></span>

   ![DisableFullSyncAfterUpgrade](./media/active-directory-aadconnect-upgrade-previous-version/disablefullsync02.png)

3. <span data-ttu-id="dd377-212">記下現有的 hello 會覆寫已新增。</span><span class="sxs-lookup"><span data-stu-id="dd377-212">Note down hello existing overrides that have been added.</span></span>
   
4. <span data-ttu-id="dd377-213">完整匯入和完整同步處理任意的連接器，執行下列 cmdlet 的 hello 上覆寫 tooremove hello:`Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid-of-ConnectorIdentifier> -FullImportRequired $false -FullSyncRequired $false`</span><span class="sxs-lookup"><span data-stu-id="dd377-213">tooremove hello overrides for both full import and full synchronization on an arbitrary connector, run hello following cmdlet: `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid-of-ConnectorIdentifier> -FullImportRequired $false -FullSyncRequired $false`</span></span>

   <span data-ttu-id="dd377-214">tooremove hello 覆寫所有的連接器上執行下列 PowerShell 指令碼的 hello:</span><span class="sxs-lookup"><span data-stu-id="dd377-214">tooremove hello overrides on all connectors, execute hello following PowerShell script:</span></span>

   ```
   foreach ($connectorOverride in Get-ADSyncSchedulerConnectorOverride)
   {
       Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier $connectorOverride.ConnectorIdentifier.Guid -FullSyncRequired $false -FullImportRequired $false
   }
   ```

5. <span data-ttu-id="dd377-215">tooresume hello 排程器，執行下列 cmdlet 的 hello:`Set-ADSyncScheduler -SyncCycleEnabled $true`</span><span class="sxs-lookup"><span data-stu-id="dd377-215">tooresume hello scheduler, run hello following cmdlet: `Set-ADSyncScheduler -SyncCycleEnabled $true`</span></span>

   >[!IMPORTANT]
   > <span data-ttu-id="dd377-216">請記住您的方便盡早 tooexecute hello 需要同步處理步驟。</span><span class="sxs-lookup"><span data-stu-id="dd377-216">Remember tooexecute hello required synchronization steps at your earliest convenience.</span></span> <span data-ttu-id="dd377-217">您可以手動執行這些步驟使用 hello 同步處理服務管理員，或新增 hello 覆寫回使用 hello 組 ADSyncSchedulerConnectorOverride cmdlet。</span><span class="sxs-lookup"><span data-stu-id="dd377-217">You can either manually execute these steps using hello Synchronization Service Manager or add hello overrides back using hello Set-ADSyncSchedulerConnectorOverride cmdlet.</span></span>

<span data-ttu-id="dd377-218">完整匯入和完整同步處理任意的連接器，執行下列 cmdlet 的 hello 上覆寫 tooadd hello:`Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid> -FullImportRequired $true -FullSyncRequired $true`</span><span class="sxs-lookup"><span data-stu-id="dd377-218">tooadd hello overrides for both full import and full synchronization on an arbitrary connector, run hello following cmdlet:  `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid> -FullImportRequired $true -FullSyncRequired $true`</span></span>

## <a name="next-steps"></a><span data-ttu-id="dd377-219">後續步驟</span><span class="sxs-lookup"><span data-stu-id="dd377-219">Next steps</span></span>
<span data-ttu-id="dd377-220">深入了解[將內部部署身分識別與 Azure Active Directory 整合](active-directory-aadconnect.md)。</span><span class="sxs-lookup"><span data-stu-id="dd377-220">Learn more about [integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
