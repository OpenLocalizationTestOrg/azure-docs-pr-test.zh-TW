---
title: "Azure AD Connect 同步：了解預設組態 | Microsoft Docs"
description: "本文說明 Azure AD Connect Sync 的預設組態。"
services: active-directory
documentationcenter: 
author: andkjell
manager: femila
editor: 
ms.assetid: ed876f22-6892-4b9d-acbe-6a2d112f1cd1
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: 32a693c059a1b4261f33a3d6f50f397365e9dac4
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-sync-understanding-the-default-configuration"></a><span data-ttu-id="0a14d-103">Azure AD Connect 同步處理：了解預設組態</span><span class="sxs-lookup"><span data-stu-id="0a14d-103">Azure AD Connect sync: Understanding the default configuration</span></span>
<span data-ttu-id="0a14d-104">本文說明現成可用的組態規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-104">This article explains the out-of-box configuration rules.</span></span> <span data-ttu-id="0a14d-105">其中說明這些規則以及這些規則對組態有何影響。</span><span class="sxs-lookup"><span data-stu-id="0a14d-105">It documents the rules and how these rules impact the configuration.</span></span> <span data-ttu-id="0a14d-106">本文也會引導您完成 Azure AD Connect 同步處理的預設組態。</span><span class="sxs-lookup"><span data-stu-id="0a14d-106">It also walks you through the default configuration of Azure AD Connect sync.</span></span> <span data-ttu-id="0a14d-107">其目的是讓讀者了解組態模型 (名為宣告式佈建) 在實際範例中的運作情形。</span><span class="sxs-lookup"><span data-stu-id="0a14d-107">The goal is that the reader understands how the configuration model, named declarative provisioning, is working in a real-world example.</span></span> <span data-ttu-id="0a14d-108">本文假設您已使用安裝精靈安裝並設定 Azure AD Connect Sync。</span><span class="sxs-lookup"><span data-stu-id="0a14d-108">This article assumes that you have already installed and configure Azure AD Connect sync using the installation wizard.</span></span>

<span data-ttu-id="0a14d-109">若要了解組態模型的詳細資訊，請參閱 [了解宣告式佈建](active-directory-aadconnectsync-understanding-declarative-provisioning.md)。</span><span class="sxs-lookup"><span data-stu-id="0a14d-109">To understand the details of the configuration model, read [Understanding Declarative Provisioning](active-directory-aadconnectsync-understanding-declarative-provisioning.md).</span></span>

## <a name="out-of-box-rules-from-on-premises-to-azure-ad"></a><span data-ttu-id="0a14d-110">從內部部署至 Azure AD 的現成可用規則</span><span class="sxs-lookup"><span data-stu-id="0a14d-110">Out-of-box rules from on-premises to Azure AD</span></span>
<span data-ttu-id="0a14d-111">現成可用的組態中包含下列運算式。</span><span class="sxs-lookup"><span data-stu-id="0a14d-111">The following expressions can be found in the out-of-box configuration.</span></span>

### <a name="user-out-of-box-rules"></a><span data-ttu-id="0a14d-112">使用者現成可用的規則</span><span class="sxs-lookup"><span data-stu-id="0a14d-112">User out-of-box rules</span></span>
<span data-ttu-id="0a14d-113">這些規則也會套用至 iNetOrgPerson 物件類型。</span><span class="sxs-lookup"><span data-stu-id="0a14d-113">These rules also apply to the iNetOrgPerson object type.</span></span>

<span data-ttu-id="0a14d-114">使用者物件必須符合下列條件，才會進行同步處理：</span><span class="sxs-lookup"><span data-stu-id="0a14d-114">A user object must satisfy the following to be synchronized:</span></span>

* <span data-ttu-id="0a14d-115">必須具有 sourceAnchor。</span><span class="sxs-lookup"><span data-stu-id="0a14d-115">Must have a sourceAnchor.</span></span>
* <span data-ttu-id="0a14d-116">在 Azure AD 中建立物件之後，即無法變更 sourceAnchor。</span><span class="sxs-lookup"><span data-stu-id="0a14d-116">After the object has been created in Azure AD, then sourceAnchor cannot change.</span></span> <span data-ttu-id="0a14d-117">如果值在內部部署中變更，則物件會停止同步處理，直到 sourceAnchor 重新變更為原先的值。</span><span class="sxs-lookup"><span data-stu-id="0a14d-117">If the value is changed on-premises, the object stops synchronizing until the sourceAnchor is changed back to its previous value.</span></span>
* <span data-ttu-id="0a14d-118">必須有已填入的 accountEnabled (userAccountControl) 屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-118">Must have the accountEnabled (userAccountControl) attribute populated.</span></span> <span data-ttu-id="0a14d-119">在內部部署 Active Directory 中，一律會存在並填入此屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-119">With an on-premises Active Directory, this attribute is always present and populated.</span></span>

<span data-ttu-id="0a14d-120">下列使用者物件 **不會** 同步處理至 Azure AD：</span><span class="sxs-lookup"><span data-stu-id="0a14d-120">The following user objects are **not** synchronized to Azure AD:</span></span>

* <span data-ttu-id="0a14d-121">`IsPresent([isCriticalSystemObject])`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-121">`IsPresent([isCriticalSystemObject])`.</span></span> <span data-ttu-id="0a14d-122">請確定 Active Directory 中多項現成可用的物件 (例如內建的系統管理員帳戶) 不會同步處理。</span><span class="sxs-lookup"><span data-stu-id="0a14d-122">Ensure many out-of-box objects in Active Directory, such as the built-in administrator account, are not synchronized.</span></span>
* <span data-ttu-id="0a14d-123">`IsPresent([sAMAccountName]) = False`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-123">`IsPresent([sAMAccountName]) = False`.</span></span> <span data-ttu-id="0a14d-124">請確定沒有 sAMAccountName 屬性的使用者物件不會同步處理。</span><span class="sxs-lookup"><span data-stu-id="0a14d-124">Ensure user objects with no sAMAccountName attribute are not synchronized.</span></span> <span data-ttu-id="0a14d-125">這種情況實際上只會發生在從 NT4 升級的網域中。</span><span class="sxs-lookup"><span data-stu-id="0a14d-125">This case would only practically happen in a domain upgraded from NT4.</span></span>
* <span data-ttu-id="0a14d-126">`Left([sAMAccountName], 4) = "AAD_"`，`Left([sAMAccountName], 5) = "MSOL_"`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-126">`Left([sAMAccountName], 4) = "AAD_"`, `Left([sAMAccountName], 5) = "MSOL_"`.</span></span> <span data-ttu-id="0a14d-127">不要同步處理 Azure AD Connect Sync 和較早版本所使用的服務帳戶。</span><span class="sxs-lookup"><span data-stu-id="0a14d-127">Do not synchronize the service account used by Azure AD Connect sync and its earlier versions.</span></span>
* <span data-ttu-id="0a14d-128">請勿同步處理不會在 Exchange Online 中運作的 Exchange 帳戶。</span><span class="sxs-lookup"><span data-stu-id="0a14d-128">Do not synchronize Exchange accounts that would not work in Exchange Online.</span></span>
  * `[sAMAccountName] = "SUPPORT_388945a0"`
  * `Left([mailNickname], 14) = "SystemMailbox{"`
  * `(Left([mailNickname], 4) = "CAS_" && (InStr([mailNickname], "}") > 0))`
  * `(Left([sAMAccountName], 4) = "CAS_" && (InStr([sAMAccountName], "}")> 0))`
* <span data-ttu-id="0a14d-129">請勿同步處理不會在 Exchange Online 中運作的物件。</span><span class="sxs-lookup"><span data-stu-id="0a14d-129">Do not synchronize objects that would not work in Exchange Online.</span></span>
  `CBool(IIF(IsPresent([msExchRecipientTypeDetails]),BitAnd([msExchRecipientTypeDetails],&H21C07000) > 0,NULL))`  
  <span data-ttu-id="0a14d-130">此位元遮罩 (&amp;H21C07000) 會篩選掉下列物件：</span><span class="sxs-lookup"><span data-stu-id="0a14d-130">This bitmask (&H21C07000) would filter out the following objects:</span></span>
  * <span data-ttu-id="0a14d-131">擁有郵件功能的公用資料夾</span><span class="sxs-lookup"><span data-stu-id="0a14d-131">Mail-enabled Public Folder</span></span>
  * <span data-ttu-id="0a14d-132">系統服務員信箱</span><span class="sxs-lookup"><span data-stu-id="0a14d-132">System Attendant Mailbox</span></span>
  * <span data-ttu-id="0a14d-133">信箱資料庫信箱 (系統信箱)</span><span class="sxs-lookup"><span data-stu-id="0a14d-133">Mailbox Database Mailbox (System Mailbox)</span></span>
  * <span data-ttu-id="0a14d-134">萬用安全性群組 (不會對使用者套用，但因舊版因素而存在)</span><span class="sxs-lookup"><span data-stu-id="0a14d-134">Universal Security Group (wouldn't apply for a user, but is present for legacy reasons)</span></span>
  * <span data-ttu-id="0a14d-135">非萬用群組 (不會對使用者套用，但因舊版因素而存在)</span><span class="sxs-lookup"><span data-stu-id="0a14d-135">Non-Universal Group (wouldn't apply for a user, but is present for legacy reasons)</span></span>
  * <span data-ttu-id="0a14d-136">信箱計劃</span><span class="sxs-lookup"><span data-stu-id="0a14d-136">Mailbox Plan</span></span>
  * <span data-ttu-id="0a14d-137">探索信箱</span><span class="sxs-lookup"><span data-stu-id="0a14d-137">Discovery Mailbox</span></span>
* <span data-ttu-id="0a14d-138">`CBool(InStr(DNComponent(CRef([dn]),1),"\\0ACNF:")>0)`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-138">`CBool(InStr(DNComponent(CRef([dn]),1),"\\0ACNF:")>0)`.</span></span> <span data-ttu-id="0a14d-139">請不要同步處理任何複寫犧牲者物件。</span><span class="sxs-lookup"><span data-stu-id="0a14d-139">Do not synchronize any replication victim objects.</span></span>

<span data-ttu-id="0a14d-140">適用的屬性規則如下：</span><span class="sxs-lookup"><span data-stu-id="0a14d-140">The following attribute rules apply:</span></span>

* <span data-ttu-id="0a14d-141">`sourceAnchor <- IIF([msExchRecipientTypeDetails]=2,NULL,..)`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-141">`sourceAnchor <- IIF([msExchRecipientTypeDetails]=2,NULL,..)`.</span></span> <span data-ttu-id="0a14d-142">不會從連結的信箱提供 SourceAnchor 屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-142">The sourceAnchor attribute is not contributed from a linked mailbox.</span></span> <span data-ttu-id="0a14d-143">根據假設，如果已找到連結的信箱，實際的帳戶會在稍後加入。</span><span class="sxs-lookup"><span data-stu-id="0a14d-143">It is assumed that if a linked mailbox has been found, the actual account is joined later.</span></span>
* <span data-ttu-id="0a14d-144">只有在屬性 **mailNickName** 具有值時，才會同步處理 Exchange 的相關屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-144">Exchange related attributes are only synchronized if the attribute **mailNickName** has a value.</span></span>
* <span data-ttu-id="0a14d-145">如果有多個樹系，則會依下列順序使用屬性：</span><span class="sxs-lookup"><span data-stu-id="0a14d-145">When there are multiple forests, then attributes are consumed in the following order:</span></span>
  1. <span data-ttu-id="0a14d-146">會從具有已啟用帳戶的樹系提供登入的相關屬性 (例如 userPrincipalName)。</span><span class="sxs-lookup"><span data-stu-id="0a14d-146">Attributes related to sign-in (for example userPrincipalName) are contributed from the forest with an enabled account.</span></span>
  2. <span data-ttu-id="0a14d-147">可以在 Exchange GAL (全域通訊清單) 中找到的屬性，則會從具有 Exchange 信箱的樹系提供。</span><span class="sxs-lookup"><span data-stu-id="0a14d-147">Attributes that can be found in an Exchange GAL (Global Address List) are contributed from the forest with an Exchange Mailbox.</span></span>
  3. <span data-ttu-id="0a14d-148">如果找不到信箱，則這些屬性可來自於任何樹系。</span><span class="sxs-lookup"><span data-stu-id="0a14d-148">If no mailbox can be found, then these attributes can come from any forest.</span></span>
  4. <span data-ttu-id="0a14d-149">Exchange 相關屬性 (技術屬性不會顯示在 GAL 中) 會從 `mailNickname ISNOTNULL`的樹系提供。</span><span class="sxs-lookup"><span data-stu-id="0a14d-149">Exchange related attributes (technical attributes not visible in the GAL) are contributed from the forest where `mailNickname ISNOTNULL`.</span></span>
  5. <span data-ttu-id="0a14d-150">如果有多個樹系會符合其中一個規則，則會使用連接器 (樹系) 的建立順序 (日期/時間) 來決定由哪個樹系提供屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-150">If there are multiple forests that would satisfy one of these rules, then the creation order (date/time) of the Connectors (forests) is used to determine which forest contributes the attributes.</span></span>

### <a name="contact-out-of-box-rules"></a><span data-ttu-id="0a14d-151">連絡人現成可用的規則</span><span class="sxs-lookup"><span data-stu-id="0a14d-151">Contact out-of-box rules</span></span>
<span data-ttu-id="0a14d-152">連絡人物件必須符合下列條件，才會進行同步處理：</span><span class="sxs-lookup"><span data-stu-id="0a14d-152">A contact object must satisfy the following to be synchronized:</span></span>

* <span data-ttu-id="0a14d-153">連絡人必須擁有郵件功能。</span><span class="sxs-lookup"><span data-stu-id="0a14d-153">The contact must be mail-enabled.</span></span> <span data-ttu-id="0a14d-154">這會使用下列規則來驗證：</span><span class="sxs-lookup"><span data-stu-id="0a14d-154">It is verified with the following rules:</span></span>
  * <span data-ttu-id="0a14d-155">`IsPresent([proxyAddresses]) = True)`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-155">`IsPresent([proxyAddresses]) = True)`.</span></span> <span data-ttu-id="0a14d-156">必須填入 proxyAddresses 屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-156">The proxyAddresses attribute must be populated.</span></span>
  * <span data-ttu-id="0a14d-157">可在 proxyAddresses 屬性或郵件屬性中找到主要電子郵件地址。</span><span class="sxs-lookup"><span data-stu-id="0a14d-157">A primary email address can be found in either the proxyAddresses attribute or the mail attribute.</span></span> <span data-ttu-id="0a14d-158">與否 @ 用來驗證的內容是電子郵件地址。</span><span class="sxs-lookup"><span data-stu-id="0a14d-158">The presence of an @ is used to verify that the content is an email address.</span></span> <span data-ttu-id="0a14d-159">下列其中一個規則必須評估為 True。</span><span class="sxs-lookup"><span data-stu-id="0a14d-159">One of these two rules must be evaluated to True.</span></span>
    * <span data-ttu-id="0a14d-160">`(Contains([proxyAddresses], "SMTP:") > 0) && (InStr(Item([proxyAddresses], Contains([proxyAddresses], "SMTP:")), "@") > 0))`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-160">`(Contains([proxyAddresses], "SMTP:") > 0) && (InStr(Item([proxyAddresses], Contains([proxyAddresses], "SMTP:")), "@") > 0))`.</span></span> <span data-ttu-id="0a14d-161">是否有與項目"SMTP:"，而且如果沒有，可以 @ 都找不到字串中？</span><span class="sxs-lookup"><span data-stu-id="0a14d-161">Is there an entry with "SMTP:" and if there is, can an @ be found in the string?</span></span>
    * <span data-ttu-id="0a14d-162">`(IsPresent([mail]) = True && (InStr([mail], "@") > 0)`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-162">`(IsPresent([mail]) = True && (InStr([mail], "@") > 0)`.</span></span> <span data-ttu-id="0a14d-163">Mail 屬性填入，而且如果是，可以是 @ 都找不到字串中？</span><span class="sxs-lookup"><span data-stu-id="0a14d-163">Is the mail attribute populated and if it is, can an @ be found in the string?</span></span>

<span data-ttu-id="0a14d-164">下列連絡人物件 **不會** 同步處理至 Azure AD：</span><span class="sxs-lookup"><span data-stu-id="0a14d-164">The following contact objects are **not** synchronized to Azure AD:</span></span>

* <span data-ttu-id="0a14d-165">`IsPresent([isCriticalSystemObject])`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-165">`IsPresent([isCriticalSystemObject])`.</span></span> <span data-ttu-id="0a14d-166">請確定沒有標記為重要的連絡人物件進行同步處理。</span><span class="sxs-lookup"><span data-stu-id="0a14d-166">Ensure no contact objects marked as critical are synchronized.</span></span> <span data-ttu-id="0a14d-167">不應該是任何使用預設組態的項目。</span><span class="sxs-lookup"><span data-stu-id="0a14d-167">Shouldn't be any with a default configuration.</span></span>
* <span data-ttu-id="0a14d-168">`((InStr([displayName], "(MSOL)") > 0) && (CBool([msExchHideFromAddressLists])))`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-168">`((InStr([displayName], "(MSOL)") > 0) && (CBool([msExchHideFromAddressLists])))`.</span></span>
* <span data-ttu-id="0a14d-169">`(Left([mailNickname], 4) = "CAS_" && (InStr([mailNickname], "}") > 0))`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-169">`(Left([mailNickname], 4) = "CAS_" && (InStr([mailNickname], "}") > 0))`.</span></span> <span data-ttu-id="0a14d-170">這些物件無法在 Exchange Online 中運作。</span><span class="sxs-lookup"><span data-stu-id="0a14d-170">These objects wouldn't work in Exchange Online.</span></span>
* <span data-ttu-id="0a14d-171">`CBool(InStr(DNComponent(CRef([dn]),1),"\\0ACNF:")>0)`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-171">`CBool(InStr(DNComponent(CRef([dn]),1),"\\0ACNF:")>0)`.</span></span> <span data-ttu-id="0a14d-172">請不要同步處理任何複寫犧牲者物件。</span><span class="sxs-lookup"><span data-stu-id="0a14d-172">Do not synchronize any replication victim objects.</span></span>

### <a name="group-out-of-box-rules"></a><span data-ttu-id="0a14d-173">群組現成可用的規則</span><span class="sxs-lookup"><span data-stu-id="0a14d-173">Group out-of-box rules</span></span>
<span data-ttu-id="0a14d-174">群組物件必須符合下列條件，才會進行同步處理：</span><span class="sxs-lookup"><span data-stu-id="0a14d-174">A group object must satisfy the following to be synchronized:</span></span>

* <span data-ttu-id="0a14d-175">擁有的成員必須少於 50,000 個。</span><span class="sxs-lookup"><span data-stu-id="0a14d-175">Must have less than 50,000 members.</span></span> <span data-ttu-id="0a14d-176">此計數為內部部署群組中的成員數目。</span><span class="sxs-lookup"><span data-stu-id="0a14d-176">This count is the number of members in the on-premises group.</span></span>
  * <span data-ttu-id="0a14d-177">如果在第一次開始同步處理之前擁有較多成員，則不會同步處理群組。</span><span class="sxs-lookup"><span data-stu-id="0a14d-177">If it has more members before synchronization starts the first time, the group is not synchronized.</span></span>
  * <span data-ttu-id="0a14d-178">如果成員數目在它最初建立之後有所成長，在達到 50,000 個成員時，它會停止同步處理，直到成員資格計數再次低於 50,000。</span><span class="sxs-lookup"><span data-stu-id="0a14d-178">If the number of members grow from when it was initially created, then when it reaches 50,000 members it stops synchronizing until the membership count is lower than 50,000 again.</span></span>
  * <span data-ttu-id="0a14d-179">注意：Azure AD 也會強制執行 50,000 個成員資格計數。</span><span class="sxs-lookup"><span data-stu-id="0a14d-179">Note: The 50,000 membership count is also enforced by Azure AD.</span></span> <span data-ttu-id="0a14d-180">您無法同步處理具有更多個成員的群組，即使您修改或移除此規則亦然。</span><span class="sxs-lookup"><span data-stu-id="0a14d-180">You are not able to synchronize groups with more members even if you modify or remove this rule.</span></span>
* <span data-ttu-id="0a14d-181">如果群組是 **通訊群組**，則也必須擁有郵件功能。</span><span class="sxs-lookup"><span data-stu-id="0a14d-181">If the group is a **Distribution Group**, then it must also be mail enabled.</span></span> <span data-ttu-id="0a14d-182">請參閱 [連絡人現成可用的規則](#contact-out-of-box-rules) ，以了解強制執行此規則的情形。</span><span class="sxs-lookup"><span data-stu-id="0a14d-182">See [Contact out-of-box rules](#contact-out-of-box-rules) for this rule is enforced.</span></span>

<span data-ttu-id="0a14d-183">下列群組物件 **不會** 同步處理至 Azure AD：</span><span class="sxs-lookup"><span data-stu-id="0a14d-183">The following group objects are **not** synchronized to Azure AD:</span></span>

* <span data-ttu-id="0a14d-184">`IsPresent([isCriticalSystemObject])`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-184">`IsPresent([isCriticalSystemObject])`.</span></span> <span data-ttu-id="0a14d-185">請確定 Active Directory 中多項現成可用的物件 (例如內建的系統管理員群組) 不會同步處理。</span><span class="sxs-lookup"><span data-stu-id="0a14d-185">Ensure many out-of-box objects in Active Directory, such as the built-in administrators group, are not synchronized.</span></span>
* <span data-ttu-id="0a14d-186">`[sAMAccountName] = "MSOL_AD_Sync_RichCoexistence"`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-186">`[sAMAccountName] = "MSOL_AD_Sync_RichCoexistence"`.</span></span> <span data-ttu-id="0a14d-187">DirSync 所使用的舊版群組。</span><span class="sxs-lookup"><span data-stu-id="0a14d-187">Legacy group used by DirSync.</span></span>
* <span data-ttu-id="0a14d-188">`BitAnd([msExchRecipientTypeDetails],&amp;H40000000)`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-188">`BitAnd([msExchRecipientTypeDetails],&amp;H40000000)`.</span></span> <span data-ttu-id="0a14d-189">角色群組。</span><span class="sxs-lookup"><span data-stu-id="0a14d-189">Role Group.</span></span>
* <span data-ttu-id="0a14d-190">`CBool(InStr(DNComponent(CRef([dn]),1),"\\0ACNF:")>0)`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-190">`CBool(InStr(DNComponent(CRef([dn]),1),"\\0ACNF:")>0)`.</span></span> <span data-ttu-id="0a14d-191">請不要同步處理任何複寫犧牲者物件。</span><span class="sxs-lookup"><span data-stu-id="0a14d-191">Do not synchronize any replication victim objects.</span></span>

### <a name="foreignsecurityprincipal-out-of-box-rules"></a><span data-ttu-id="0a14d-192">ForeignSecurityPrincipal 現成可用的規則</span><span class="sxs-lookup"><span data-stu-id="0a14d-192">ForeignSecurityPrincipal out-of-box rules</span></span>
<span data-ttu-id="0a14d-193">FSP 會聯結至 Metaverse 中的「任何」(\*) 物件。</span><span class="sxs-lookup"><span data-stu-id="0a14d-193">FSPs are joined to "any" (\*) object in the metaverse.</span></span> <span data-ttu-id="0a14d-194">實際上，此聯結只會針對使用者和安全性群組執行。</span><span class="sxs-lookup"><span data-stu-id="0a14d-194">In reality, this join only happens for users and security groups.</span></span> <span data-ttu-id="0a14d-195">此組態可確保跨樹系成員資格會進行解析，並正確地顯示在 Azure AD 中。</span><span class="sxs-lookup"><span data-stu-id="0a14d-195">This configuration ensures that cross-forest memberships are resolved and represented correctly in Azure AD.</span></span>

### <a name="computer-out-of-box-rules"></a><span data-ttu-id="0a14d-196">電腦現成可用的規則</span><span class="sxs-lookup"><span data-stu-id="0a14d-196">Computer out-of-box rules</span></span>
<span data-ttu-id="0a14d-197">電腦物件必須符合下列條件，才會進行同步處理：</span><span class="sxs-lookup"><span data-stu-id="0a14d-197">A computer object must satisfy the following to be synchronized:</span></span>

* <span data-ttu-id="0a14d-198">`userCertificate ISNOTNULL`。</span><span class="sxs-lookup"><span data-stu-id="0a14d-198">`userCertificate ISNOTNULL`.</span></span> <span data-ttu-id="0a14d-199">只有 Windows 10 電腦會填入此屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-199">Only Windows 10 computers populate this attribute.</span></span> <span data-ttu-id="0a14d-200">所有具有此屬性值的電腦物件都會進行同步處理。</span><span class="sxs-lookup"><span data-stu-id="0a14d-200">All computer objects with a value in this attribute are synchronized.</span></span>

## <a name="understanding-the-out-of-box-rules-scenario"></a><span data-ttu-id="0a14d-201">了解現成可用的規則案例</span><span class="sxs-lookup"><span data-stu-id="0a14d-201">Understanding the out-of-box rules scenario</span></span>
<span data-ttu-id="0a14d-202">在此範例中，我們會使用具有一個帳戶樹系 (A)、一個資源樹系 (R) 和一個 Azure AD 目錄的部署。</span><span class="sxs-lookup"><span data-stu-id="0a14d-202">In this example, we are using a deployment with one account forest (A), one resource forest (R), and one Azure AD directory.</span></span>

![含案例說明的圖片](./media/active-directory-aadconnectsync-understanding-default-configuration/scenario.png)

<span data-ttu-id="0a14d-204">在此組態中，假設帳戶樹系中有已啟用的帳戶，而具有連結信箱的資源樹系中有已停用的帳戶。</span><span class="sxs-lookup"><span data-stu-id="0a14d-204">In this configuration, it is assumed there is an enabled account in the account forest and a disabled account in the resource forest with a linked mailbox.</span></span>

<span data-ttu-id="0a14d-205">我們使用預設組態的目的是：</span><span class="sxs-lookup"><span data-stu-id="0a14d-205">Our goal with the default configuration is:</span></span>

* <span data-ttu-id="0a14d-206">登入的相關屬性會從具有已啟用帳戶的樹系進行同步處理。</span><span class="sxs-lookup"><span data-stu-id="0a14d-206">Attributes related to sign-in are synchronized from the forest with the enabled account.</span></span>
* <span data-ttu-id="0a14d-207">可以在 GAL (全域通訊清單) 中找到的屬性，會從具有信箱的樹系進行同步處理。</span><span class="sxs-lookup"><span data-stu-id="0a14d-207">Attributes that can be found in the GAL (Global Address List) are synchronized from the forest with the mailbox.</span></span> <span data-ttu-id="0a14d-208">如果找不到信箱，則會使用任何其他樹系。</span><span class="sxs-lookup"><span data-stu-id="0a14d-208">If no mailbox can be found, any other forest is used.</span></span>
* <span data-ttu-id="0a14d-209">如果找到連結的信箱，則要匯出至 Azure AD 的物件必須有已連結並啟用的帳戶。</span><span class="sxs-lookup"><span data-stu-id="0a14d-209">If a linked mailbox is found, the linked enabled account must be found for the object to be exported to Azure AD.</span></span>

### <a name="synchronization-rule-editor"></a><span data-ttu-id="0a14d-210">同步處理規則編輯器</span><span class="sxs-lookup"><span data-stu-id="0a14d-210">Synchronization Rule Editor</span></span>
<span data-ttu-id="0a14d-211">您可以使用同步處理規則編輯器 (SRE) 這項工具來檢視及變更組態，並且可在 [開始] 功能表中找到其捷徑。</span><span class="sxs-lookup"><span data-stu-id="0a14d-211">The configuration can be viewed and changed with the tool Synchronization Rules Editor (SRE) and a shortcut to it can be found in the start menu.</span></span>

![同步處理規則編輯器圖示](./media/active-directory-aadconnectsync-understanding-default-configuration/sre.png)

<span data-ttu-id="0a14d-213">SRE 是一項資源套件工具，會隨 Azure AD Connect Sync 一起安裝。</span><span class="sxs-lookup"><span data-stu-id="0a14d-213">The SRE is a resource kit tool and it is installed with Azure AD Connect sync.</span></span> <span data-ttu-id="0a14d-214">您必須是 ADSyncAdmins 群組的成員，才能夠加以啟動。</span><span class="sxs-lookup"><span data-stu-id="0a14d-214">To be able to start it, you must be a member of the ADSyncAdmins group.</span></span> <span data-ttu-id="0a14d-215">在它啟動時，您會看到如下的畫面：</span><span class="sxs-lookup"><span data-stu-id="0a14d-215">When it starts, you see something like this:</span></span>

![同步處理規則 (輸入)](./media/active-directory-aadconnectsync-understanding-default-configuration/syncrulesinbound.png)

<span data-ttu-id="0a14d-217">在此窗格中，您會看到所有為您的組態建立的同步處理規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-217">In this pane, you see all Synchronization Rules created for your configuration.</span></span> <span data-ttu-id="0a14d-218">表格中的每一行都是一個同步處理規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-218">Each line in the table is one Synchronization Rule.</span></span> <span data-ttu-id="0a14d-219">在 [規則類型] 的左下方會列出兩種不同類型：[輸入] 和 [輸出]。</span><span class="sxs-lookup"><span data-stu-id="0a14d-219">To the left under Rule Types, the two different types are listed: Inbound and Outbound.</span></span> <span data-ttu-id="0a14d-220">[輸入] 和 [輸出] 來自 Metaverse 的檢視。</span><span class="sxs-lookup"><span data-stu-id="0a14d-220">Inbound and Outbound is from the view of the metaverse.</span></span> <span data-ttu-id="0a14d-221">您主要會將重點放在本概觀中的輸入規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-221">You are mainly going to focus on the inbound rules in this overview.</span></span> <span data-ttu-id="0a14d-222">實際的同步處理規則清單取決於在 AD 中偵測到的結構描述。</span><span class="sxs-lookup"><span data-stu-id="0a14d-222">The actual list of Synchronization Rules depends on the detected schema in AD.</span></span> <span data-ttu-id="0a14d-223">在上圖中，帳戶樹系 (fabrikamonline.com) 沒有任何服務 (例如 Exchange 和 Lync)，而且也沒有為這些服務建立任何同步處理規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-223">In the picture above, the account forest (fabrikamonline.com) does not have any services, such as Exchange and Lync, and no Synchronization Rules have been created for these services.</span></span> <span data-ttu-id="0a14d-224">不過，在資源樹系 (res.fabrikamonline.com) 中，您可找到這些服務的同步處理規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-224">However, in the resource forest (res.fabrikamonline.com) you find Synchronization Rules for these services.</span></span> <span data-ttu-id="0a14d-225">規則的內容會隨著偵測到的版本而有所不同。</span><span class="sxs-lookup"><span data-stu-id="0a14d-225">The content of the rules is different depending on the version detected.</span></span> <span data-ttu-id="0a14d-226">比方說，在 Exchange 2013 的部署中，屬性流程比在 Exchange 2010/2007 中設定的多。</span><span class="sxs-lookup"><span data-stu-id="0a14d-226">For example, in a deployment with Exchange 2013 there are more attribute flows configured than in Exchange 2010/2007.</span></span>

### <a name="synchronization-rule"></a><span data-ttu-id="0a14d-227">同步處理規則</span><span class="sxs-lookup"><span data-stu-id="0a14d-227">Synchronization Rule</span></span>
<span data-ttu-id="0a14d-228">同步處理規則是一個組態物件，當滿足條件時會有一組屬性進行流動。</span><span class="sxs-lookup"><span data-stu-id="0a14d-228">A Synchronization Rule is a configuration object with a set of attributes flowing when a condition is satisfied.</span></span> <span data-ttu-id="0a14d-229">此規則也會用來說明連接器空間中物件與 Metaverse 中物件的關係 (稱為**聯結**或**相符項目**)。</span><span class="sxs-lookup"><span data-stu-id="0a14d-229">It is also used to describe how an object in a connector space is related to an object in the metaverse, known as **join** or **match**.</span></span> <span data-ttu-id="0a14d-230">同步處理規則具有優先順序值，指出它們彼此之間的關係。</span><span class="sxs-lookup"><span data-stu-id="0a14d-230">The Synchronization Rules have a precedence value indicating how they relate to each other.</span></span> <span data-ttu-id="0a14d-231">具有較低數值的同步處理規則具有較高的優先順序，而在發生屬性流程衝突時，較高的優先順序會在衝突解決過程中勝出。</span><span class="sxs-lookup"><span data-stu-id="0a14d-231">A Synchronization Rule with a lower numeric value has a higher precedence and in an attribute flow conflict, higher precedence wins the conflict resolution.</span></span>

<span data-ttu-id="0a14d-232">舉例來說，我們將了解同步處理規則 **In from AD – User AccountEnabled**。</span><span class="sxs-lookup"><span data-stu-id="0a14d-232">As an example, look at the Synchronization Rule **In from AD – User AccountEnabled**.</span></span> <span data-ttu-id="0a14d-233">在 SRE 中標示這一行並選取 [編輯] 。</span><span class="sxs-lookup"><span data-stu-id="0a14d-233">Mark this line in the SRE and select **Edit**.</span></span>

<span data-ttu-id="0a14d-234">由於此規則是現成可用的規則，因此您會在開啟規則時收到警告。</span><span class="sxs-lookup"><span data-stu-id="0a14d-234">Since this rule is an out-of-box rule, you receive a warning when you open the rule.</span></span> <span data-ttu-id="0a14d-235">您不應 [變更現成可用的規則](active-directory-aadconnectsync-best-practices-changing-default-configuration.md)，而要讓系統詢問您自己的意願為何。</span><span class="sxs-lookup"><span data-stu-id="0a14d-235">You should not make any [changes to out-of-box rules](active-directory-aadconnectsync-best-practices-changing-default-configuration.md), so you are asked what your intentions are.</span></span> <span data-ttu-id="0a14d-236">在此案例中，您只想要檢視規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-236">In this case, you only want to view the rule.</span></span> <span data-ttu-id="0a14d-237">請選取 [否] 。</span><span class="sxs-lookup"><span data-stu-id="0a14d-237">Select **No**.</span></span>

![同步處理規則警告](./media/active-directory-aadconnectsync-understanding-default-configuration/warningeditrule.png)

<span data-ttu-id="0a14d-239">同步處理規則具有四個組態區段：說明、範圍篩選器、聯結規則及轉換。</span><span class="sxs-lookup"><span data-stu-id="0a14d-239">A Synchronization Rule has four configuration sections: Description, Scoping filter, Join rules, and Transformations.</span></span>

#### <a name="description"></a><span data-ttu-id="0a14d-240">說明</span><span class="sxs-lookup"><span data-stu-id="0a14d-240">Description</span></span>
<span data-ttu-id="0a14d-241">第一個區段提供基本資訊，例如名稱和說明。</span><span class="sxs-lookup"><span data-stu-id="0a14d-241">The first section provides basic information such as a name and description.</span></span>

![<span data-ttu-id="0a14d-242">同步處理規則編輯器中的說明索引標籤</span><span class="sxs-lookup"><span data-stu-id="0a14d-242">Description tab in Sync rule editor</span></span> ](./media/active-directory-aadconnectsync-understanding-default-configuration/syncruledescription.png)

<span data-ttu-id="0a14d-243">您也可尋找一些資訊，例如哪個已連線系統與此規則有關、哪個已連線系統的物件類型適用於此規則，以及 Metaverse 物件的類型。</span><span class="sxs-lookup"><span data-stu-id="0a14d-243">You also find information about which connected system this rule is related to, which object type in the connected system it applies to, and the metaverse object type.</span></span> <span data-ttu-id="0a14d-244">無法來源物件類型為使用者、iNetOrgPerson 或連絡人，Metaverse 物件類型一律為個人。</span><span class="sxs-lookup"><span data-stu-id="0a14d-244">The metaverse object type is always person regardless when the source object type is a user, iNetOrgPerson, or contact.</span></span> <span data-ttu-id="0a14d-245">Metaverse 物件類型永遠不會改變，所以它必須以一般類型建立。</span><span class="sxs-lookup"><span data-stu-id="0a14d-245">The metaverse object type should never change so it is created as a generic type.</span></span> <span data-ttu-id="0a14d-246">您可以將連結類型設為 Join、StickyJoin 或 Provision。</span><span class="sxs-lookup"><span data-stu-id="0a14d-246">The Link Type can be set to Join, StickyJoin, or Provision.</span></span> <span data-ttu-id="0a14d-247">此設定會與 [聯結規則] 區段共同運作，稍後會討論其運作方式。</span><span class="sxs-lookup"><span data-stu-id="0a14d-247">This setting works together with the Join Rules section and is covered later.</span></span>

<span data-ttu-id="0a14d-248">您也可以看到此同步處理規則用於密碼同步。</span><span class="sxs-lookup"><span data-stu-id="0a14d-248">You can also see that this sync rule is used for password sync.</span></span> <span data-ttu-id="0a14d-249">如果使用者在此同步處理規則的範圍內，密碼會從內部部署同步處理至雲端 (假設您已啟用密碼同步功能)。</span><span class="sxs-lookup"><span data-stu-id="0a14d-249">If a user is in scope for this sync rule, the password is synchronized from on-premises to cloud (assuming you have enabled the password sync feature).</span></span>

#### <a name="scoping-filter"></a><span data-ttu-id="0a14d-250">範圍篩選器</span><span class="sxs-lookup"><span data-stu-id="0a14d-250">Scoping filter</span></span>
<span data-ttu-id="0a14d-251">範圍篩選器區段是用來設定同步處理規則套用的時機。</span><span class="sxs-lookup"><span data-stu-id="0a14d-251">The Scoping Filter section is used to configure when a Synchronization Rule should apply.</span></span> <span data-ttu-id="0a14d-252">由於您目前看到的同步處理規則名稱表示只應針對已啟用使用者套用，因此您必須設定該範圍，切勿將 AD 屬性 **userAccountControl** 設為位元 2。</span><span class="sxs-lookup"><span data-stu-id="0a14d-252">Since the name of the Synchronization Rule you are looking at indicates it should only be applied for enabled users, the scope is configured so the AD attribute **userAccountControl** must not have the bit 2 set.</span></span> <span data-ttu-id="0a14d-253">當同步處理引擎在 AD 中尋找使用者時，如果 **userAccountControl** 設為十進位值 512 (啟用的一般使用者)，則會套用此同步處理規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-253">When the sync engine finds a user in AD, it applies this sync rule when **userAccountControl** is set to the decimal value 512 (enabled normal user).</span></span> <span data-ttu-id="0a14d-254">當使用者的 **userAccountControl** 設為 514 (停用的一般使用者) 時，則不會套用此規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-254">It does not apply the rule when the user has **userAccountControl** set to 514 (disabled normal user).</span></span>

![<span data-ttu-id="0a14d-255">同步處理規則編輯器中的範圍索引標籤</span><span class="sxs-lookup"><span data-stu-id="0a14d-255">Scoping tab in Sync rule editor</span></span> ](./media/active-directory-aadconnectsync-understanding-default-configuration/syncrulescopingfilter.png)

<span data-ttu-id="0a14d-256">範圍篩選器具有可為巢狀的群組和子句。</span><span class="sxs-lookup"><span data-stu-id="0a14d-256">The scoping filter has Groups and Clauses that can be nested.</span></span> <span data-ttu-id="0a14d-257">必須滿足群組中的所有子句，才能套用同步處理規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-257">All clauses inside a group must be satisfied for a Synchronization Rule to apply.</span></span> <span data-ttu-id="0a14d-258">如果多個群組已經過定義時，則必須至少滿足一個群組才能套用該規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-258">When multiple groups are defined, then at least one group must be satisfied for the rule to apply.</span></span> <span data-ttu-id="0a14d-259">也就是說，系統會在群組間評估邏輯 OR ，而在單一群組中評估邏輯 AND。</span><span class="sxs-lookup"><span data-stu-id="0a14d-259">That is, a logical OR is evaluated between groups and a logical AND is evaluated inside a group.</span></span> <span data-ttu-id="0a14d-260">您可以在輸出同步處理規則 **Out to AAD – Group Join**中找到此組態的範例。</span><span class="sxs-lookup"><span data-stu-id="0a14d-260">An example of this configuration can be found in the outbound Synchronization Rule **Out to AAD – Group Join**.</span></span> <span data-ttu-id="0a14d-261">同步處理篩選器有數個群組，例如，一個適用於安全性群組 (`securityEnabled EQUAL True`) 的群組，和一個適用於通訊群組 (`securityEnabled EQUAL False`) 的群組。</span><span class="sxs-lookup"><span data-stu-id="0a14d-261">There are several synchronization filter groups, for example one for security groups (`securityEnabled EQUAL True`) and one for distribution groups (`securityEnabled EQUAL False`).</span></span>

![<span data-ttu-id="0a14d-262">同步處理規則編輯器中的範圍索引標籤</span><span class="sxs-lookup"><span data-stu-id="0a14d-262">Scoping tab in Sync rule editor</span></span> ](./media/active-directory-aadconnectsync-understanding-default-configuration/syncrulescopingfilterout.png)

<span data-ttu-id="0a14d-263">此規則是用來定義哪些群組應該佈建至 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="0a14d-263">This rule is used to define which Groups should be provisioned to Azure AD.</span></span> <span data-ttu-id="0a14d-264">通訊群組必須啟用郵件，才可使用 Azure AD 進行同步處理；但是安全性群組不需要電子郵件，即可進行同步處理。</span><span class="sxs-lookup"><span data-stu-id="0a14d-264">Distribution Groups must be mail enabled to be synchronized with Azure AD, but for security groups an email is not required.</span></span>

#### <a name="join-rules"></a><span data-ttu-id="0a14d-265">聯結規則</span><span class="sxs-lookup"><span data-stu-id="0a14d-265">Join rules</span></span>
<span data-ttu-id="0a14d-266">第三個區段是用來設定連接器空間中物件與 Metaverse 中物件的關係。</span><span class="sxs-lookup"><span data-stu-id="0a14d-266">The third section is used to configure how objects in the connector space relate to objects in the metaverse.</span></span> <span data-ttu-id="0a14d-267">您先前看過的規則中並沒有任何適用於聯結規則的組態，因此您將繼續了解 **In from AD - User Join**。</span><span class="sxs-lookup"><span data-stu-id="0a14d-267">The rule you have looked at earlier does not have any configuration for Join Rules, so instead you are going to look at **In from AD – User Join**.</span></span>

![<span data-ttu-id="0a14d-268">同步處理規則編輯器中的聯結規則索引標籤</span><span class="sxs-lookup"><span data-stu-id="0a14d-268">Join rules tab in Sync rule editor</span></span> ](./media/active-directory-aadconnectsync-understanding-default-configuration/syncrulejoinrules.png)

<span data-ttu-id="0a14d-269">聯結規則的內容取決於安裝精靈中選取的比對選項。</span><span class="sxs-lookup"><span data-stu-id="0a14d-269">The content of the join rule depends on the matching option selected in the installation wizard.</span></span> <span data-ttu-id="0a14d-270">針對輸入規則，評估作業將會從來源連接器空間中的物件開始進行，接著再評估聯結規則中的各個群組。</span><span class="sxs-lookup"><span data-stu-id="0a14d-270">For an inbound rule, the evaluation starts with an object in the source connector space and each group in the join rules is evaluated in sequence.</span></span> <span data-ttu-id="0a14d-271">如果來源物件經評估確實符合 Metaverse 中的一個物件，且 Metaverse 使用其中一個聯結規則，物件就會聯結起來。</span><span class="sxs-lookup"><span data-stu-id="0a14d-271">If a source object is evaluated to match exactly one object in the metaverse using one of the join rules, the objects are joined.</span></span> <span data-ttu-id="0a14d-272">如果所有規則經評估後沒有任何相符項目，則會使用說明頁面上的連結類型。</span><span class="sxs-lookup"><span data-stu-id="0a14d-272">If all rules have been evaluated and there is no match, then the Link Type on the description page is used.</span></span> <span data-ttu-id="0a14d-273">如果此組態設定為為 [佈建]，則目標 (Metaverse) 中會建立新的物件。</span><span class="sxs-lookup"><span data-stu-id="0a14d-273">If this configuration is set to **Provision**, then a new object is created in the target, the metaverse.</span></span> <span data-ttu-id="0a14d-274">將新物件佈建至 Metaverse，也等同於將物件**投射**至 Metaverse。</span><span class="sxs-lookup"><span data-stu-id="0a14d-274">To provision a new object to the metaverse is also known as to **project** an object to the metaverse.</span></span>

<span data-ttu-id="0a14d-275">只會對聯結規則評估一次。</span><span class="sxs-lookup"><span data-stu-id="0a14d-275">The join rules are only evaluated once.</span></span> <span data-ttu-id="0a14d-276">當連接器空間物件和 Metaverse 物件聯結起來時，只要仍滿足同步處理規則的範圍，兩者就會維持聯結狀態。</span><span class="sxs-lookup"><span data-stu-id="0a14d-276">When a connector space object and a metaverse object are joined, they remain joined as long as the scope of the Synchronization Rule is still satisfied.</span></span>

<span data-ttu-id="0a14d-277">評估同步處理規則時，只有一個具有已定義聯結規則的同步處理規則必須在範圍內。</span><span class="sxs-lookup"><span data-stu-id="0a14d-277">When evaluating Synchronization Rules, only one Synchronization Rule with join rules defined must be in scope.</span></span> <span data-ttu-id="0a14d-278">如果發現多個具有聯結規則的同步處理規則用於單一物件，就會擲回錯誤。</span><span class="sxs-lookup"><span data-stu-id="0a14d-278">If multiple Synchronization Rules with join rules are found for one object, an error is thrown.</span></span> <span data-ttu-id="0a14d-279">基於這個原因，最佳作法就是在多個同步處理規則都在同一個範圍內用於單一物件時，只有一個具有已定義聯結的同步處理規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-279">For this reason, the best practice is to have only one Synchronization Rule with join defined when multiple Synchronization Rules are in scope for an object.</span></span> <span data-ttu-id="0a14d-280">在 Azure AD Connect 同步處理現成可用的組態中，您可以查看規則名稱來找到這些規則，並發現它們的名稱結尾都有 **Join** 一詞。</span><span class="sxs-lookup"><span data-stu-id="0a14d-280">In the out-of-box configuration for Azure AD Connect sync, these rules can be found by looking at the name and find those with the word **Join** at the end of the name.</span></span> <span data-ttu-id="0a14d-281">如果其他同步處理規則將物件聯結在一起，或在目標中佈建新物件，則未定義任何聯結規則的同步處理規則會套用屬性流程。</span><span class="sxs-lookup"><span data-stu-id="0a14d-281">A Synchronization Rule without any join rules defined applies the attribute flows when another Synchronization Rule joined the objects together or provisioned a new object in the target.</span></span>

<span data-ttu-id="0a14d-282">在檢視上圖時，您可以看到規則嘗試將 **objectSID** 與 **msExchMasterAccountSid** (Exchange) 和 **msRTCSIP-OriginatorSid** (Lync) 聯結，而這正是我們在帳戶資源樹系拓撲中所預期的。</span><span class="sxs-lookup"><span data-stu-id="0a14d-282">If you look at the picture above, you can see that the rule is trying to join **objectSID** with **msExchMasterAccountSid** (Exchange) and **msRTCSIP-OriginatorSid** (Lync), which is what we expect in an account-resource forest topology.</span></span> <span data-ttu-id="0a14d-283">您會發現所有樹系具有相同的規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-283">You find the same rule on all forests.</span></span> <span data-ttu-id="0a14d-284">我們可以假設每個樹系可能是帳戶或資源樹系。</span><span class="sxs-lookup"><span data-stu-id="0a14d-284">The assumption is that every forest could be either an account or resource forest.</span></span> <span data-ttu-id="0a14d-285">如果您有帳戶存在於單一樹系中，且不需要聯結，也適用此組態。</span><span class="sxs-lookup"><span data-stu-id="0a14d-285">This configuration also works if you have accounts that live in a single forest and do not have to be joined.</span></span>

#### <a name="transformations"></a><span data-ttu-id="0a14d-286">轉換</span><span class="sxs-lookup"><span data-stu-id="0a14d-286">Transformations</span></span>
<span data-ttu-id="0a14d-287">轉換區段會定義當物件呈現聯結狀態並滿足範圍篩選器時，會套用至目標物件的所有屬性流程。</span><span class="sxs-lookup"><span data-stu-id="0a14d-287">The transformation section defines all attribute flows that apply to the target object when the objects are joined and the scope filter is satisfied.</span></span> <span data-ttu-id="0a14d-288">回到 **In from AD - User AccountEnabled** 同步處理規則時，您會看見下列轉換：</span><span class="sxs-lookup"><span data-stu-id="0a14d-288">Going back to the **In from AD – User AccountEnabled** Synchronization Rule, you find the following transformations:</span></span>

![<span data-ttu-id="0a14d-289">同步處理規則編輯器中的轉換索引標籤</span><span class="sxs-lookup"><span data-stu-id="0a14d-289">Transformations tab in Sync rule editor</span></span> ](./media/active-directory-aadconnectsync-understanding-default-configuration/syncruletransformations.png)

<span data-ttu-id="0a14d-290">若要將此組態放在內容中，則在帳戶-資源樹系部署中，預計會在帳戶樹系中找到啟用的帳戶，並在具有 Exchange 和 Lync 設定的資源樹系中找到停用的帳戶。</span><span class="sxs-lookup"><span data-stu-id="0a14d-290">To put this configuration in context, in an Account-Resource forest deployment, it is expected to find an enabled account in the account forest and a disabled account in the resource forest with Exchange and Lync settings.</span></span> <span data-ttu-id="0a14d-291">您目前看到的同步處理規則包含登入所需的屬性，而這些屬性應從具有已啟用帳戶的樹系流出。</span><span class="sxs-lookup"><span data-stu-id="0a14d-291">The Synchronization Rule you are looking at contains the attributes required for sign-in and these attributes should flow from the forest where there is an enabled account.</span></span> <span data-ttu-id="0a14d-292">這些屬性流程會全部放在一個同步處理規則中。</span><span class="sxs-lookup"><span data-stu-id="0a14d-292">All these attribute flows are put together in one Synchronization Rule.</span></span>

<span data-ttu-id="0a14d-293">轉換可具有不同類型：Constant、Direct 和 Expression。</span><span class="sxs-lookup"><span data-stu-id="0a14d-293">A transformation can have different types: Constant, Direct, and Expression.</span></span>

* <span data-ttu-id="0a14d-294">Constant 流程會一律流送硬式編碼值。</span><span class="sxs-lookup"><span data-stu-id="0a14d-294">A constant flow always flows a hardcoded value.</span></span> <span data-ttu-id="0a14d-295">在上述例子中，一律會在名為 **accountEnabled** 的 Metaverse 屬性中設定 **True** 值。</span><span class="sxs-lookup"><span data-stu-id="0a14d-295">In the case above, it always sets the value **True** in the metaverse attribute named **accountEnabled**.</span></span>
* <span data-ttu-id="0a14d-296">Direct 流程一律會將來源中的屬性值依現狀流動至目標屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-296">A direct flow always flows the value of the attribute in the source to the target attribute as-is.</span></span>
* <span data-ttu-id="0a14d-297">第三個流程類型是 Expression，可讓您使用更為進階的組態。</span><span class="sxs-lookup"><span data-stu-id="0a14d-297">The third flow type is Expression and it allows for more advanced configurations.</span></span>

<span data-ttu-id="0a14d-298">由於運算式語言為 VBA (Visual Basic for Applications)，因此具有 Microsoft Office 或 VBScript 使用經驗的人員就能辨認其格式。</span><span class="sxs-lookup"><span data-stu-id="0a14d-298">The expression language is VBA (Visual Basic for Applications), so people with experience of Microsoft Office or VBScript will recognize the format.</span></span> <span data-ttu-id="0a14d-299">屬性會包在方括號之中，例如 [attributeName]。</span><span class="sxs-lookup"><span data-stu-id="0a14d-299">Attributes are enclosed in square brackets, [attributeName].</span></span> <span data-ttu-id="0a14d-300">屬性名稱與函數名稱有區分大小寫，但是當運算式無效時，同步處理規則編輯器會評估運算式並且發出警告。</span><span class="sxs-lookup"><span data-stu-id="0a14d-300">Attribute names and function names are case-sensitive, but the Synchronization Rules Editor evaluates the expressions and provide a warning if the expression is not valid.</span></span> <span data-ttu-id="0a14d-301">所有運算式將會以具有巢狀函式的單一行表示。</span><span class="sxs-lookup"><span data-stu-id="0a14d-301">All expressions are expressed on a single line with nested functions.</span></span> <span data-ttu-id="0a14d-302">若要發揮組態語言的功能，請使用插入其他註解的 pwdLastSet 流程：</span><span class="sxs-lookup"><span data-stu-id="0a14d-302">To show the power of the configuration language, here is the flow for pwdLastSet, but with additional comments inserted:</span></span>

```
// If-then-else
IIF(
// (The evaluation for IIF) Is the attribute pwdLastSet present in AD?
IsPresent([pwdLastSet]),
// (The True part of IIF) If it is, then from right to left, convert the AD time format to a .Net datetime, change it to the time format used by Azure AD, and finally convert it to a string.
CStr(FormatDateTime(DateFromNum([pwdLastSet]),"yyyyMMddHHmmss.0Z")),
// (The False part of IIF) Nothing to contribute
NULL
)
```

<span data-ttu-id="0a14d-303">如需屬性流程的運算式語言詳細資訊，請參閱 [了解宣告式佈建運算式](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md)</span><span class="sxs-lookup"><span data-stu-id="0a14d-303">See [Understanding Declarative Provisioning Expressions](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md) for more information on the expression language for attribute flows.</span></span>

### <a name="precedence"></a><span data-ttu-id="0a14d-304">優先順序</span><span class="sxs-lookup"><span data-stu-id="0a14d-304">Precedence</span></span>
<span data-ttu-id="0a14d-305">您現在已看過一些個別的同步處理規則，但這些規則會在組態中一起運作。</span><span class="sxs-lookup"><span data-stu-id="0a14d-305">You have now looked at some individual Synchronization Rules, but the rules work together in the configuration.</span></span> <span data-ttu-id="0a14d-306">在某些情況下，屬性值會由相同目標屬性的多個同步處理規則提供。</span><span class="sxs-lookup"><span data-stu-id="0a14d-306">In some cases, an attribute value is contributed from multiple synchronization rules to the same target attribute.</span></span> <span data-ttu-id="0a14d-307">在此情況下，即可使用屬性優先順序來判斷哪個屬性會勝出。</span><span class="sxs-lookup"><span data-stu-id="0a14d-307">In this case, attribute precedence is used to determine which attribute wins.</span></span> <span data-ttu-id="0a14d-308">以 sourceAnchor 屬性為例。</span><span class="sxs-lookup"><span data-stu-id="0a14d-308">As an example, look at the attribute sourceAnchor.</span></span> <span data-ttu-id="0a14d-309">此屬性是能否登入 Azure AD 的重要屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-309">This attribute is an important attribute to be able to sign in to Azure AD.</span></span> <span data-ttu-id="0a14d-310">您可以在兩個不同的同步處理規則中看到此屬性的屬性流程：**In from AD – User AccountEnabled** 和 **In from AD – User Common**。</span><span class="sxs-lookup"><span data-stu-id="0a14d-310">You can find an attribute flow for this attribute in two different Synchronization Rules, **In from AD – User AccountEnabled** and **In from AD – User Common**.</span></span> <span data-ttu-id="0a14d-311">由於有同步處理規則優先順序，如果有數個物件聯結至 Metaverse 物件，則會由先具有已啟用帳戶的樹系提供 sourceAnchor 屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-311">Due to Synchronization Rule precedence, the sourceAnchor attribute is contributed from the forest with an enabled account first when there are several objects joined to the metaverse object.</span></span> <span data-ttu-id="0a14d-312">如果沒有已啟用的帳戶，則同步處理引擎會使用全部擷取同步處理規則 **In from AD – User Common**。</span><span class="sxs-lookup"><span data-stu-id="0a14d-312">If there are no enabled accounts, then the sync engine uses the catch-all Synchronization Rule **In from AD – User Common**.</span></span> <span data-ttu-id="0a14d-313">此組態可確保即使是已停用的帳戶，仍有 sourceAnchor。</span><span class="sxs-lookup"><span data-stu-id="0a14d-313">This configuration ensures that even for accounts that are disabled, there is still a sourceAnchor.</span></span>

![同步處理規則 (輸入)](./media/active-directory-aadconnectsync-understanding-default-configuration/syncrulesinbound.png)

<span data-ttu-id="0a14d-315">同步處理規則的優先順序會由安裝精靈設定在群組中。</span><span class="sxs-lookup"><span data-stu-id="0a14d-315">The precedence for Synchronization Rules is set in groups by the installation wizard.</span></span> <span data-ttu-id="0a14d-316">群組中的所有規則具有相同的名稱，但是會連接到不同的連接目錄。</span><span class="sxs-lookup"><span data-stu-id="0a14d-316">All rules in a group have the same name, but they are connected to different connected directories.</span></span> <span data-ttu-id="0a14d-317">安裝精靈會將最高優先順序提供給 **In from AD – User Join** 規則，並逐一查看所有連接的 AD 目錄。</span><span class="sxs-lookup"><span data-stu-id="0a14d-317">The installation wizard gives the rule **In from AD – User Join** highest precedence and it iterates over all connected AD directories.</span></span> <span data-ttu-id="0a14d-318">接著，它會以預先定義的順序繼續處理後續的規則群組。</span><span class="sxs-lookup"><span data-stu-id="0a14d-318">It then continues with the next groups of rules in a predefined order.</span></span> <span data-ttu-id="0a14d-319">在群組中，會以在精靈中新增連接器的順序來新增規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-319">Inside a group, the rules are added in the order the Connectors were added in the wizard.</span></span> <span data-ttu-id="0a14d-320">如果透過精靈新增其他連接器，則會將同步處理規則重新排序，而新連接器的規則會插入在每個群組中的結尾處。</span><span class="sxs-lookup"><span data-stu-id="0a14d-320">If another Connector is added through the wizard, the Synchronization Rules are reordered and the new Connector’s rules are inserted last in each group.</span></span>

### <a name="putting-it-all-together"></a><span data-ttu-id="0a14d-321">總整理</span><span class="sxs-lookup"><span data-stu-id="0a14d-321">Putting it all together</span></span>
<span data-ttu-id="0a14d-322">我們現在對同步處理規則已有足夠的認識，而能夠了解組態如何在不同的同步處理規則下運作。</span><span class="sxs-lookup"><span data-stu-id="0a14d-322">We now know enough about Synchronization Rules to be able to understand how the configuration works with the different Synchronization Rules.</span></span> <span data-ttu-id="0a14d-323">如果您觀察某個使用者以及提供給 Metaverse 的屬性，則會以下列順序套用規則：</span><span class="sxs-lookup"><span data-stu-id="0a14d-323">If you look at a user and the attributes that are contributed to the metaverse, the rules are applied in the following order:</span></span>

| <span data-ttu-id="0a14d-324">名稱</span><span class="sxs-lookup"><span data-stu-id="0a14d-324">Name</span></span> | <span data-ttu-id="0a14d-325">註解</span><span class="sxs-lookup"><span data-stu-id="0a14d-325">Comment</span></span> |
|:--- |:--- |
| <span data-ttu-id="0a14d-326">In from AD - User Join</span><span class="sxs-lookup"><span data-stu-id="0a14d-326">In from AD – User Join</span></span> |<span data-ttu-id="0a14d-327">聯結連接器空間物件與 Metaverse 的規則。</span><span class="sxs-lookup"><span data-stu-id="0a14d-327">Rule for joining connector space objects with metaverse.</span></span> |
| <span data-ttu-id="0a14d-328">In from AD – UserAccount Enabled</span><span class="sxs-lookup"><span data-stu-id="0a14d-328">In from AD – UserAccount Enabled</span></span> |<span data-ttu-id="0a14d-329">登入 Azure AD 和 Office 365 所需的屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-329">Attributes required for sign-in to Azure AD and Office 365.</span></span> <span data-ttu-id="0a14d-330">我們想從已啟用的帳戶取得這些屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-330">We want these attributes from the enabled account.</span></span> |
| <span data-ttu-id="0a14d-331">In from AD – User Common from Exchange</span><span class="sxs-lookup"><span data-stu-id="0a14d-331">In from AD – User Common from Exchange</span></span> |<span data-ttu-id="0a14d-332">在全域通訊清單中找到的屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-332">Attributes found in the Global Address List.</span></span> <span data-ttu-id="0a14d-333">我們假設在使用者信箱所在的樹系中，具有最佳的資料品質。</span><span class="sxs-lookup"><span data-stu-id="0a14d-333">We assume the data quality is best in the forest where we have found the user’s mailbox.</span></span> |
| <span data-ttu-id="0a14d-334">In from AD – User Common</span><span class="sxs-lookup"><span data-stu-id="0a14d-334">In from AD – User Common</span></span> |<span data-ttu-id="0a14d-335">在全域通訊清單中找到的屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-335">Attributes found in the Global Address List.</span></span> <span data-ttu-id="0a14d-336">如果找不到信箱，則可由任何其他聯結物件提供屬性值。</span><span class="sxs-lookup"><span data-stu-id="0a14d-336">In case we didn’t find a mailbox, any other joined object can contribute the attribute value.</span></span> |
| <span data-ttu-id="0a14d-337">In from AD – User Exchange</span><span class="sxs-lookup"><span data-stu-id="0a14d-337">In from AD – User Exchange</span></span> |<span data-ttu-id="0a14d-338">只有在偵測到 Exchange 後才存在。</span><span class="sxs-lookup"><span data-stu-id="0a14d-338">Only exists if Exchange has been detected.</span></span> <span data-ttu-id="0a14d-339">它會流送所有基礎結構 Exchange 屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-339">It flows all infrastructure Exchange attributes.</span></span> |
| <span data-ttu-id="0a14d-340">In from AD – User Lync</span><span class="sxs-lookup"><span data-stu-id="0a14d-340">In from AD – User Lync</span></span> |<span data-ttu-id="0a14d-341">只有在偵測到 Lync 後才存在。</span><span class="sxs-lookup"><span data-stu-id="0a14d-341">Only exists if Lync has been detected.</span></span> <span data-ttu-id="0a14d-342">它會流送所有基礎結構 Lync 屬性。</span><span class="sxs-lookup"><span data-stu-id="0a14d-342">It flows all infrastructure Lync attributes.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="0a14d-343">後續步驟</span><span class="sxs-lookup"><span data-stu-id="0a14d-343">Next steps</span></span>
* <span data-ttu-id="0a14d-344">如需組態模型的詳細資訊，請參閱 [了解宣告式佈建](active-directory-aadconnectsync-understanding-declarative-provisioning.md)。</span><span class="sxs-lookup"><span data-stu-id="0a14d-344">Read more about the configuration model in [Understanding Declarative Provisioning](active-directory-aadconnectsync-understanding-declarative-provisioning.md).</span></span>
* <span data-ttu-id="0a14d-345">如需運算式語言的詳細資訊，請參閱 [了解宣告式佈建運算式](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md)。</span><span class="sxs-lookup"><span data-stu-id="0a14d-345">Read more about the expression language in [Understanding Declarative Provisioning Expressions](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md).</span></span>
* <span data-ttu-id="0a14d-346">如需了解現成可用組態的運作方式，請繼續閱讀 [了解使用者和連絡人](active-directory-aadconnectsync-understanding-users-and-contacts.md)</span><span class="sxs-lookup"><span data-stu-id="0a14d-346">Continue reading how the out-of-box configuration works in [Understanding Users and Contacts](active-directory-aadconnectsync-understanding-users-and-contacts.md)</span></span>
* <span data-ttu-id="0a14d-347">如需了解如何使用宣告式佈建進行實際變更，請參閱 [如何變更預設組態](active-directory-aadconnectsync-change-the-configuration.md)。</span><span class="sxs-lookup"><span data-stu-id="0a14d-347">See how to make a practical change using declarative provisioning in [How to make a change to the default configuration](active-directory-aadconnectsync-change-the-configuration.md).</span></span>

<span data-ttu-id="0a14d-348">**概觀主題**</span><span class="sxs-lookup"><span data-stu-id="0a14d-348">**Overview topics**</span></span>

* [<span data-ttu-id="0a14d-349">Azure AD Connect 同步處理：了解及自訂同步處理</span><span class="sxs-lookup"><span data-stu-id="0a14d-349">Azure AD Connect sync: Understand and customize synchronization</span></span>](active-directory-aadconnectsync-whatis.md)
* [<span data-ttu-id="0a14d-350">整合內部部署身分識別與 Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="0a14d-350">Integrating your on-premises identities with Azure Active Directory</span></span>](active-directory-aadconnect.md)

