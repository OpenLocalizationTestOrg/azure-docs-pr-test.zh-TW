---
title: "Azure AD Connect 同步︰處理 userCertificate 屬性所造成的 LargeObject 錯誤 | Microsoft Docs"
description: "本主題針對 userCertificate 屬性所造成的 LargeObject 錯誤提供補救步驟。"
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 146ad5b3-74d9-4a83-b9e8-0973a19828d9
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: 2a5418ff61e07793fceca5a8207c1c5aa18847b4
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-sync-handling-largeobject-errors-caused-by-usercertificate-attribute"></a><span data-ttu-id="b0dc6-103">Azure AD Connect 同步︰處理 userCertificate 屬性所造成的 LargeObject 錯誤 | Microsoft Docs</span><span class="sxs-lookup"><span data-stu-id="b0dc6-103">Azure AD Connect sync: Handling LargeObject errors caused by userCertificate attribute</span></span>

<span data-ttu-id="b0dc6-104">Azure AD 會在 **userCertificate** 屬性上強制執行最大限制 **15** 個憑證值。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-104">Azure AD enforces a maximum limit of **15** certificate values on the **userCertificate** attribute.</span></span> <span data-ttu-id="b0dc6-105">如果 Azure AD Connect 匯出至 Azure AD 的物件有 15 個以上的值，Azure AD 會傳回 **LargeObject** 錯誤，訊息為︰</span><span class="sxs-lookup"><span data-stu-id="b0dc6-105">If Azure AD Connect exports an object with more than 15 values to Azure AD, Azure AD returns a **LargeObject** error with message:</span></span>

><span data-ttu-id="b0dc6-106">*「佈建的物件太大。請修剪此物件的屬性值數量。下次同步處理循環會重試這項作業...」*</span><span class="sxs-lookup"><span data-stu-id="b0dc6-106">*"The provisioned object is too large. Trim the number of attribute values on this object. The operation will be retried in the next synchronization cycle..."*</span></span>

<span data-ttu-id="b0dc6-107">其他 AD 屬性也可能造成 LargeObject 錯誤。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-107">The LargeObject error may be caused by other AD attributes.</span></span> <span data-ttu-id="b0dc6-108">若要確認確實是由 userCertificate 屬性所造成，您需要在內部部署 AD 或 [Synchronization Service Manager Metaverse 搜尋](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnectsync-service-manager-ui-mvsearch)中驗證物件。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-108">To confirm it is indeed caused by the userCertificate attribute, you need to verify against the object either in on-premises AD or in the [Synchronization Service Manager Metaverse Search](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnectsync-service-manager-ui-mvsearch).</span></span>

<span data-ttu-id="b0dc6-109">若要取得租用戶中發生 LargeObject 錯誤的物件清單，請使用下列其中一種方法︰</span><span class="sxs-lookup"><span data-stu-id="b0dc6-109">To obtain the list of objects in your tenant with LargeObject errors, use one of the following methods:</span></span>

 * <span data-ttu-id="b0dc6-110">如果已啟用您的租用戶透過 Azure AD Connect Health 進行同步，您可以參考已提供的[同步處理錯誤報告](https://docs.microsoft.com/azure/active-directory/connect-health/active-directory-aadconnect-health-sync#object-level-synchronization-error-report-preview)。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-110">If your tenant is enabled for Azure AD Connect Health for sync, you can refer to the [Synchronization Error Report](https://docs.microsoft.com/azure/active-directory/connect-health/active-directory-aadconnect-health-sync#object-level-synchronization-error-report-preview) provided.</span></span>
 
 * <span data-ttu-id="b0dc6-111">在每個同步週期結束時會傳送目錄同步處理錯誤的通知電子郵件，其中提供一份發生 LargeObject 錯誤的物件清單。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-111">The notification email for directory synchronization errors that is sent at the end of each sync cycle has the list of objects with LargeObject errors.</span></span> 
 * <span data-ttu-id="b0dc6-112">如果您按一下最新的「匯出至 Azure AD」作業，[Synchronization Service Manager Operations [作業] 索引標籤](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnectsync-service-manager-ui-operations)會顯示發生 LargeObject 錯誤的物件清單。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-112">The [Synchronization Service Manager Operations tab](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnectsync-service-manager-ui-operations) displays the list of objects with LargeObject errors if you click the latest Export to Azure AD operation.</span></span>
 
## <a name="mitigation-options"></a><span data-ttu-id="b0dc6-113">緩和選項</span><span class="sxs-lookup"><span data-stu-id="b0dc6-113">Mitigation options</span></span>
<span data-ttu-id="b0dc6-114">在解決 LargeObject 錯誤之前，同一個物件的其他屬性變更無法匯出至 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-114">Until the LargeObject error is resolved, other attribute changes to the same object cannot be exported to Azure AD.</span></span> <span data-ttu-id="b0dc6-115">若要解決錯誤，您可以考慮下列選項︰</span><span class="sxs-lookup"><span data-stu-id="b0dc6-115">To resolve the error, you can consider the following options:</span></span>

 * <span data-ttu-id="b0dc6-116">將 Azure AD Connect 升級至 1.1.524.0 組建版本或更新版本。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-116">Upgrade Azure AD Connect to build 1.1.524.0 or after.</span></span> <span data-ttu-id="b0dc6-117">在 Azure AD Connect 1.1.524.0 組建版本中，現成的同步處理規則已更新成如果屬性有 15 個以上的值，則不匯出屬性 userCertificate 和 userSMIMECertificate。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-117">In Azure AD Connect build 1.1.524.0, the out-of-box synchronization rules have been updated to not export attributes userCertificate and userSMIMECertificate if the attributes have more than 15 values.</span></span> <span data-ttu-id="b0dc6-118">如需如何升級 Azure AD Connect 的詳細資訊，請參閱 [Azure AD Connect：從舊版升級到最新版本](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version)一文。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-118">For details on how to upgrade Azure AD Connect, refer to article [Azure AD Connect: Upgrade from a previous version to the latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version).</span></span>

 * <span data-ttu-id="b0dc6-119">在 Azure AD Connect 中實作**輸出同步規則**，以匯出 **Null 值，而不是有 15 個以上憑證值之物件的實際值**。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-119">Implement an **outbound sync rule** in Azure AD Connect that exports a **null value instead of the actual values for objects with more than 15 certificate values**.</span></span> <span data-ttu-id="b0dc6-120">對於有 15 個值以上的物件，如果您不需要將任何憑證值匯出至 Azure AD，此選項就很適合。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-120">This option is suitable if you do not require any of the certificate values to be exported to Azure AD for objects with more than 15 values.</span></span> <span data-ttu-id="b0dc6-121">如需有關如何實作此同步規則的詳細資訊，請參閱下一節：[實作同步規則以限制 userCertificate 屬性的匯出](#implementing-sync-rule-to-limit-export-of-usercertificate-attribute)。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-121">For details on how to implement this sync rule, refer to next section [Implementing sync rule to limit export of userCertificate attribute](#implementing-sync-rule-to-limit-export-of-usercertificate-attribute).</span></span>

 * <span data-ttu-id="b0dc6-122">在內部部署 AD 物件上，移除您的組織不再使用的值，以減少憑證值數量 (15 個或更少)。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-122">Reduce the number of certificate values on the on-premises AD object (15 or less) by removing values that are no longer in use by your organization.</span></span> <span data-ttu-id="b0dc6-123">如果由於過期或未使用的憑證而造成屬性膨脹，這是很適合的作法。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-123">This is suitable if the attribute bloat is caused by expired or unused certificates.</span></span> <span data-ttu-id="b0dc6-124">您可以使用[這裡提供的 PowerShell 指令碼](https://gallery.technet.microsoft.com/Remove-Expired-Certificates-0517e34f)，協助您在內部部署 AD 中尋找、備份和刪除過期的憑證。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-124">You can use the [PowerShell script available here](https://gallery.technet.microsoft.com/Remove-Expired-Certificates-0517e34f) to help find, backup, and delete expired certificates in your on-premises AD.</span></span> <span data-ttu-id="b0dc6-125">刪除憑證之前，建議您向組織的公開金鑰基礎結構管理員查證。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-125">Before deleting the certificates, it is recommended that you verify with the Public-Key-Infrastructure administrators in your organization.</span></span>

 * <span data-ttu-id="b0dc6-126">設定 Azure AD Connect 將 userCertificate 屬性排除，而不要匯出至 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-126">Configure Azure AD Connect to exclude the userCertificate attribute from being exported to Azure AD.</span></span> <span data-ttu-id="b0dc6-127">一般而言，我們不建議這個選項，因為 Microsoft Online Services 可能使用此屬性來啟用特定案例。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-127">In general, we do not recommend this option since the attribute may be used by Microsoft Online Services to enable specific scenarios.</span></span> <span data-ttu-id="b0dc6-128">特別是：</span><span class="sxs-lookup"><span data-stu-id="b0dc6-128">In particular:</span></span>
    * <span data-ttu-id="b0dc6-129">Exchange Online 和 Outlook 用戶端會使用 User 物件的 userCertificate 屬性，將郵件簽署和加密。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-129">The userCertificate attribute on the User object is used by Exchange Online and Outlook clients for message signing and encryption.</span></span> <span data-ttu-id="b0dc6-130">若要深入了解此功能，請參閱[為郵件簽章和加密的 S/MIME](https://technet.microsoft.com/library/dn626158(v=exchg.150).aspx) 一文。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-130">To learn more about this feature, refer to article [S/MIME for message signing and encryption](https://technet.microsoft.com/library/dn626158(v=exchg.150).aspx).</span></span>

    * <span data-ttu-id="b0dc6-131">Azure AD 會使用 Computer 物件的 userCertificate 屬性，以允許加入網域的 Windows 10 內部部署裝置連線至 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-131">The userCertificate attribute on the Computer object is used by Azure AD to allow Windows 10 on-premises domain-joined devices to connect to Azure AD.</span></span> <span data-ttu-id="b0dc6-132">若要深入了解此功能，請參閱[將已加入網域的裝置連線至 Azure AD 以體驗 Windows 10](https://docs.microsoft.com/azure/active-directory/active-directory-azureadjoin-devices-group-policy) 一文。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-132">To learn more about this feature, please refer to article [Connect domain-joined devices to Azure AD for Windows 10 experiences](https://docs.microsoft.com/azure/active-directory/active-directory-azureadjoin-devices-group-policy).</span></span>

## <a name="implementing-sync-rule-to-limit-export-of-usercertificate-attribute"></a><span data-ttu-id="b0dc6-133">實作同步規則以限制 userCertificate 屬性的匯出</span><span class="sxs-lookup"><span data-stu-id="b0dc6-133">Implementing sync rule to limit export of userCertificate attribute</span></span>
<span data-ttu-id="b0dc6-134">若要解決 userCertificate 屬性所造成的 LargeObject 錯誤，您可以在 Azure AD Connect 中實作輸出同步規則，以匯出 **Null 值，而不是有 15 個以上憑證值之物件的實際值**。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-134">To resolve the LargeObject error caused by the userCertificate attribute, you can implement an outbound sync rule in Azure AD Connect that exports a **null value instead of the actual values for objects with more than 15 certificate values**.</span></span> <span data-ttu-id="b0dc6-135">本節說明對 **User** 物件實作同步規則所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-135">This section describes the steps required to implement the sync rule for **User** objects.</span></span> <span data-ttu-id="b0dc6-136">這些步驟可以調整為適合 **Contact** 和 **Computer** 物件。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-136">The steps can be adapted for **Contact** and **Computer** objects.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b0dc6-137">匯出 Null 值會移除先前成功匯出至 Azure AD 的憑證值。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-137">Exporting null value removes certificate values previously exported successfully to Azure AD.</span></span>

<span data-ttu-id="b0dc6-138">步驟可以摘要如下︰</span><span class="sxs-lookup"><span data-stu-id="b0dc6-138">The steps can be summarized as:</span></span>

1. <span data-ttu-id="b0dc6-139">停用同步排程器，並確認沒有任何同步處理在進行中。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-139">Disable sync scheduler and verify there is no synchronization in progress.</span></span>
3. <span data-ttu-id="b0dc6-140">尋找 userCertificate 屬性的現有輸出同步規則。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-140">Find the existing outbound sync rule for userCertificate attribute.</span></span>
4. <span data-ttu-id="b0dc6-141">建立所需的輸出同步規則。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-141">Create the outbound sync rule required.</span></span>
5. <span data-ttu-id="b0dc6-142">在發生 LargeObject 錯誤的現有物件上驗證新的同步規則。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-142">Verify the new sync rule on an existing object with LargeObject error.</span></span>
6. <span data-ttu-id="b0dc6-143">將新的同步規則套用至發生 LargeObject 錯誤的其餘物件。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-143">Apply the new sync rule to remaining objects with LargeObject error.</span></span>
7. <span data-ttu-id="b0dc6-144">確認沒有非預期的變更在等候匯出至 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-144">Verify there are no unexpected changes waiting to be exported to Azure AD.</span></span>
8. <span data-ttu-id="b0dc6-145">將變更匯出至 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-145">Export the changes to Azure AD.</span></span>
9. <span data-ttu-id="b0dc6-146">重新啟用同步排程器。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-146">Re-enable sync scheduler.</span></span>

### <a name="step-1-disable-sync-scheduler-and-verify-there-is-no-synchronization-in-progress"></a><span data-ttu-id="b0dc6-147">步驟 1.</span><span class="sxs-lookup"><span data-stu-id="b0dc6-147">Step 1.</span></span> <span data-ttu-id="b0dc6-148">停用同步排程器，並確認沒有任何同步處理在進行中</span><span class="sxs-lookup"><span data-stu-id="b0dc6-148">Disable sync scheduler and verify there is no synchronization in progress</span></span>
<span data-ttu-id="b0dc6-149">請確定您在實作新的同步規則時不會發生同步處理，以避免非預期的變更匯出至 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-149">Ensure no synchronization takes place while you are in the middle of implementing a new sync rule to avoid unintended changes being exported to Azure AD.</span></span> <span data-ttu-id="b0dc6-150">若要停用內建的同步排程器︰</span><span class="sxs-lookup"><span data-stu-id="b0dc6-150">To disable the built-in sync scheduler:</span></span>
1. <span data-ttu-id="b0dc6-151">在 Azure AD Connect 伺服器上啟動 PowerShell 工作階段。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-151">Start PowerShell session on the Azure AD Connect server.</span></span>

2. <span data-ttu-id="b0dc6-152">執行 Cmdlet 以停用排定的同步處理︰`Set-ADSyncScheduler -SyncCycleEnabled $false`</span><span class="sxs-lookup"><span data-stu-id="b0dc6-152">Disable scheduled synchronization by running cmdlet: `Set-ADSyncScheduler -SyncCycleEnabled $false`</span></span>

> [!Note]
> <span data-ttu-id="b0dc6-153">上述步驟僅適用於已內建排程器之較新版本 (1.1.xxx.x) 的 Azure AD Connect。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-153">The preceding steps are only applicable to newer versions (1.1.xxx.x) of Azure AD Connect with the built-in scheduler.</span></span> <span data-ttu-id="b0dc6-154">如果您使用較舊版本 (1.0.xxx.x) 的 Azure AD Connect (使用 Windows 工作排程器)，或使用您自己的自訂排程器 (不常見) 觸發定期同步處理，則必須視情況停用它們。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-154">If you are using older versions (1.0.xxx.x) of Azure AD Connect that uses Windows Task Scheduler, or you are using your own custom scheduler (not common) to trigger periodic synchronization, you need to disable them accordingly.</span></span>

3. <span data-ttu-id="b0dc6-155">移至 [開始] → [同步處理服務] 來啟動 **Synchronization Service Manager**。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-155">Start the **Synchronization Service Manager** by going to START → Synchronization Service.</span></span>

4. <span data-ttu-id="b0dc6-156">移至 [作業] 索引標籤，確認沒有任何作業是「進行中」狀態。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-156">Go to the **Operations** tab and confirm there is no operation whose status is *“in progress.”*</span></span>

### <a name="step-2-find-the-existing-outbound-sync-rule-for-usercertificate-attribute"></a><span data-ttu-id="b0dc6-157">步驟 2.</span><span class="sxs-lookup"><span data-stu-id="b0dc6-157">Step 2.</span></span> <span data-ttu-id="b0dc6-158">尋找 userCertificate 屬性的現有輸出同步規則</span><span class="sxs-lookup"><span data-stu-id="b0dc6-158">Find the existing outbound sync rule for userCertificate attribute</span></span>
<span data-ttu-id="b0dc6-159">應該有一個現有的同步規則已啟用，且設定為將 User 物件的 userCertificate 屬性匯出至 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-159">There should be an existing sync rule that is enabled and configured to export userCertificate attribute for User objects to Azure AD.</span></span> <span data-ttu-id="b0dc6-160">找出此同步規則，查明其**優先順序**和**範圍設定篩選**設定︰</span><span class="sxs-lookup"><span data-stu-id="b0dc6-160">Locate this sync rule to find out its **precedence** and **scoping filter** configuration:</span></span>

1. <span data-ttu-id="b0dc6-161">移至 [開始] → [同步處理規則編輯器] 來啟動**同步處理規則編輯器**。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-161">Start the **Synchronization Rules Editor** by going to START → Synchronization Rules Editor.</span></span>

2. <span data-ttu-id="b0dc6-162">使用下列值來設定搜尋篩選條件：</span><span class="sxs-lookup"><span data-stu-id="b0dc6-162">Configure the search filters with the following values:</span></span>

    | <span data-ttu-id="b0dc6-163">屬性</span><span class="sxs-lookup"><span data-stu-id="b0dc6-163">Attribute</span></span> | <span data-ttu-id="b0dc6-164">值</span><span class="sxs-lookup"><span data-stu-id="b0dc6-164">Value</span></span> |
    | --- | --- |
    | <span data-ttu-id="b0dc6-165">方向</span><span class="sxs-lookup"><span data-stu-id="b0dc6-165">Direction</span></span> |<span data-ttu-id="b0dc6-166">**輸出**</span><span class="sxs-lookup"><span data-stu-id="b0dc6-166">**Outbound**</span></span> |
    | <span data-ttu-id="b0dc6-167">MV 物件類型</span><span class="sxs-lookup"><span data-stu-id="b0dc6-167">MV Object Type</span></span> |<span data-ttu-id="b0dc6-168">**人員**</span><span class="sxs-lookup"><span data-stu-id="b0dc6-168">**Person**</span></span> |
    | <span data-ttu-id="b0dc6-169">連接器</span><span class="sxs-lookup"><span data-stu-id="b0dc6-169">Connector</span></span> |<span data-ttu-id="b0dc6-170">Azure AD 連接器的名稱</span><span class="sxs-lookup"><span data-stu-id="b0dc6-170">*name of your Azure AD connector*</span></span> |
    | <span data-ttu-id="b0dc6-171">連接器物件類型</span><span class="sxs-lookup"><span data-stu-id="b0dc6-171">Connector Object Type</span></span> |<span data-ttu-id="b0dc6-172">**user**</span><span class="sxs-lookup"><span data-stu-id="b0dc6-172">**user**</span></span> |
    | <span data-ttu-id="b0dc6-173">MV 屬性</span><span class="sxs-lookup"><span data-stu-id="b0dc6-173">MV attribute</span></span> |<span data-ttu-id="b0dc6-174">**userCertificate**</span><span class="sxs-lookup"><span data-stu-id="b0dc6-174">**userCertificate**</span></span> |

3. <span data-ttu-id="b0dc6-175">如果您使用 OOB (全新) 同步規則讓 Azure AD 連接器匯出 User 物件的 userCertficiate 屬性，您應該會取回「輸出至 AAD – 使用者 ExchangeOnline」規則。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-175">If you are using OOB (out-of-box) sync rules to Azure AD connector to export userCertficiate attribute for User objects, you should get back the *“Out to AAD – User ExchangeOnline”* rule.</span></span>
4. <span data-ttu-id="b0dc6-176">記下此同步規則的**優先順序**值。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-176">Note down the **precedence** value of this sync rule.</span></span>
5. <span data-ttu-id="b0dc6-177">選取同步規則，然後按一下 [編輯]。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-177">Select the sync rule and click **Edit**.</span></span>
6. <span data-ttu-id="b0dc6-178">在 [確認編輯保留規則] 快顯對話方塊中，按一下 [否]。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-178">In the *“Edit Reserved Rule Confirmation”* pop-up dialog, click **No**.</span></span> <span data-ttu-id="b0dc6-179">(別擔心，我們完全不會變更此同步規則)。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-179">(Don’t worry, we are not going to make any change to this sync rule).</span></span>
7. <span data-ttu-id="b0dc6-180">在編輯畫面中，選取 [範圍設定篩選] 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-180">In the edit screen, select the **Scoping filter** tab.</span></span>
8. <span data-ttu-id="b0dc6-181">記下的範圍設定篩選組態。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-181">Note down the scoping filter configuration.</span></span> <span data-ttu-id="b0dc6-182">如果您使用 OOB 同步規則，應該只有**一個範圍設定篩選群組，含有兩個子句**，包括︰</span><span class="sxs-lookup"><span data-stu-id="b0dc6-182">If you are using the OOB sync rule, there should exactly be **one scoping filter group containing two clauses**, including:</span></span>

    | <span data-ttu-id="b0dc6-183">屬性</span><span class="sxs-lookup"><span data-stu-id="b0dc6-183">Attribute</span></span> | <span data-ttu-id="b0dc6-184">運算子</span><span class="sxs-lookup"><span data-stu-id="b0dc6-184">Operator</span></span> | <span data-ttu-id="b0dc6-185">值</span><span class="sxs-lookup"><span data-stu-id="b0dc6-185">Value</span></span> |
    | --- | --- | --- |
    | <span data-ttu-id="b0dc6-186">sourceObjectType</span><span class="sxs-lookup"><span data-stu-id="b0dc6-186">sourceObjectType</span></span> | <span data-ttu-id="b0dc6-187">EQUAL</span><span class="sxs-lookup"><span data-stu-id="b0dc6-187">EQUAL</span></span> | <span data-ttu-id="b0dc6-188">User</span><span class="sxs-lookup"><span data-stu-id="b0dc6-188">User</span></span> |
    | <span data-ttu-id="b0dc6-189">cloudMastered</span><span class="sxs-lookup"><span data-stu-id="b0dc6-189">cloudMastered</span></span> | <span data-ttu-id="b0dc6-190">NOTEQUAL</span><span class="sxs-lookup"><span data-stu-id="b0dc6-190">NOTEQUAL</span></span> | <span data-ttu-id="b0dc6-191">True</span><span class="sxs-lookup"><span data-stu-id="b0dc6-191">True</span></span> |

### <a name="step-3-create-the-outbound-sync-rule-required"></a><span data-ttu-id="b0dc6-192">步驟 3.</span><span class="sxs-lookup"><span data-stu-id="b0dc6-192">Step 3.</span></span> <span data-ttu-id="b0dc6-193">建立所需的輸出同步規則</span><span class="sxs-lookup"><span data-stu-id="b0dc6-193">Create the outbound sync rule required</span></span>
<span data-ttu-id="b0dc6-194">新的同步規則必須具有相同的**範圍設定篩選**，以及比現有同步規則**更高的優先順序**。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-194">The new sync rule must have the same **scoping filter** and **higher precedence** than the existing sync rule.</span></span> <span data-ttu-id="b0dc6-195">這可確保新的同步規則會套用至現有同步規則的同一組物件，並覆寫 userCertificate 屬性的現有同步規則。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-195">This ensures that the new sync rule applies to the same set of objects as the existing sync rule and overrides the existing sync rule for the userCertificate attribute.</span></span> <span data-ttu-id="b0dc6-196">若要刪除同步規則：</span><span class="sxs-lookup"><span data-stu-id="b0dc6-196">To create the sync rule:</span></span>
1. <span data-ttu-id="b0dc6-197">在 [同步處理規則編輯器] 中，按一下 [新增規則] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-197">In the Synchronization Rules Editor, click the **Add new rule** button.</span></span>
2. <span data-ttu-id="b0dc6-198">在 [描述] 索引標籤下，提供下列設定︰</span><span class="sxs-lookup"><span data-stu-id="b0dc6-198">Under the **Description tab**, provide the following configuration:</span></span>

    | <span data-ttu-id="b0dc6-199">屬性</span><span class="sxs-lookup"><span data-stu-id="b0dc6-199">Attribute</span></span> | <span data-ttu-id="b0dc6-200">值</span><span class="sxs-lookup"><span data-stu-id="b0dc6-200">Value</span></span> | <span data-ttu-id="b0dc6-201">詳細資料</span><span class="sxs-lookup"><span data-stu-id="b0dc6-201">Details</span></span> |
    | --- | --- | --- |
    | <span data-ttu-id="b0dc6-202">名稱</span><span class="sxs-lookup"><span data-stu-id="b0dc6-202">Name</span></span> | <span data-ttu-id="b0dc6-203">提供名稱</span><span class="sxs-lookup"><span data-stu-id="b0dc6-203">*Provide a name*</span></span> | <span data-ttu-id="b0dc6-204">例如，「輸出至 AAD – userCertificate 的自訂覆寫」</span><span class="sxs-lookup"><span data-stu-id="b0dc6-204">E.g., *“Out to AAD – Custom override for userCertificate”*</span></span> |
    | <span data-ttu-id="b0dc6-205">說明</span><span class="sxs-lookup"><span data-stu-id="b0dc6-205">Description</span></span> | <span data-ttu-id="b0dc6-206">提供描述</span><span class="sxs-lookup"><span data-stu-id="b0dc6-206">*Provide a description*</span></span> | <span data-ttu-id="b0dc6-207">例如，「如果 userCertificate 屬性有 15 個以上的值，匯出 NULL」。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-207">E.g., *“If userCertificate attribute has more than 15 values, export NULL.”*</span></span> |
    | <span data-ttu-id="b0dc6-208">連線系統</span><span class="sxs-lookup"><span data-stu-id="b0dc6-208">Connected System</span></span> | <span data-ttu-id="b0dc6-209">選取 Azure AD 連接器</span><span class="sxs-lookup"><span data-stu-id="b0dc6-209">*Select the Azure AD Connector*</span></span> |
    | <span data-ttu-id="b0dc6-210">連線系統物件類型</span><span class="sxs-lookup"><span data-stu-id="b0dc6-210">Connected System Object Type</span></span> | <span data-ttu-id="b0dc6-211">**user**</span><span class="sxs-lookup"><span data-stu-id="b0dc6-211">**user**</span></span> | |
    | <span data-ttu-id="b0dc6-212">Metaverse 物件類型</span><span class="sxs-lookup"><span data-stu-id="b0dc6-212">Metaverse Object Type</span></span> | <span data-ttu-id="b0dc6-213">**person**</span><span class="sxs-lookup"><span data-stu-id="b0dc6-213">**person**</span></span> | |
    | <span data-ttu-id="b0dc6-214">連結類型</span><span class="sxs-lookup"><span data-stu-id="b0dc6-214">Link Type</span></span> | <span data-ttu-id="b0dc6-215">**Join**</span><span class="sxs-lookup"><span data-stu-id="b0dc6-215">**Join**</span></span> | |
    | <span data-ttu-id="b0dc6-216">優先順序</span><span class="sxs-lookup"><span data-stu-id="b0dc6-216">Precedence</span></span> | <span data-ttu-id="b0dc6-217">選擇 1-99 之間的數字</span><span class="sxs-lookup"><span data-stu-id="b0dc6-217">*Chose a number between 1 - 99*</span></span> | <span data-ttu-id="b0dc6-218">選擇的數字不能被任何現有的同步規則使用，而且比現有同步規則的值更小 (因此，優先順序較高)。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-218">The number chosen must not be used by any existing sync rule and has a lower value (and therefore, higher precedence) than the existing sync rule.</span></span> |

3. <span data-ttu-id="b0dc6-219">移至 [範圍設定篩選] 索引標籤，實作與現有同步規則相同的範圍設定篩選。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-219">Go to the **Scoping filter** tab and implement the same scoping filter the existing sync rule is using.</span></span>
4. <span data-ttu-id="b0dc6-220">略過 [聯結規則] 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-220">Skip the **Join rules** tab.</span></span>
5. <span data-ttu-id="b0dc6-221">移至 [轉換] 索引標籤，使用下列設定新增轉換︰</span><span class="sxs-lookup"><span data-stu-id="b0dc6-221">Go to the **Transformations** tab to add a new transformation using following configuration:</span></span>

    | <span data-ttu-id="b0dc6-222">屬性</span><span class="sxs-lookup"><span data-stu-id="b0dc6-222">Attribute</span></span> | <span data-ttu-id="b0dc6-223">值</span><span class="sxs-lookup"><span data-stu-id="b0dc6-223">Value</span></span> |
    | --- | --- |
    | <span data-ttu-id="b0dc6-224">流程類型</span><span class="sxs-lookup"><span data-stu-id="b0dc6-224">Flow Type</span></span> |<span data-ttu-id="b0dc6-225">**運算式**</span><span class="sxs-lookup"><span data-stu-id="b0dc6-225">**Expression**</span></span> |
    | <span data-ttu-id="b0dc6-226">目標屬性</span><span class="sxs-lookup"><span data-stu-id="b0dc6-226">Target Attribute</span></span> |<span data-ttu-id="b0dc6-227">**userCertificate**</span><span class="sxs-lookup"><span data-stu-id="b0dc6-227">**userCertificate**</span></span> |
    | <span data-ttu-id="b0dc6-228">來源屬性</span><span class="sxs-lookup"><span data-stu-id="b0dc6-228">Source Attribute</span></span> |<span data-ttu-id="b0dc6-229">「使用下列運算式」：`IIF(IsNullOrEmpty([userCertificate]), NULL, IIF((Count([userCertificate])> 15),AuthoritativeNull,[userCertificate]))`</span><span class="sxs-lookup"><span data-stu-id="b0dc6-229">*Use the following expression*: `IIF(IsNullOrEmpty([userCertificate]), NULL, IIF((Count([userCertificate])> 15),AuthoritativeNull,[userCertificate]))`</span></span> |
    
6. <span data-ttu-id="b0dc6-230">按一下 [新增] 按鈕建立同步規則。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-230">Click the **Add** button to create the sync rule.</span></span>

### <a name="step-4-verify-the-new-sync-rule-on-an-existing-object-with-largeobject-error"></a><span data-ttu-id="b0dc6-231">步驟 4.</span><span class="sxs-lookup"><span data-stu-id="b0dc6-231">Step 4.</span></span> <span data-ttu-id="b0dc6-232">在發生 LargeObject 錯誤的現有物件上驗證新的同步規則</span><span class="sxs-lookup"><span data-stu-id="b0dc6-232">Verify the new sync rule on an existing object with LargeObject error</span></span>
<span data-ttu-id="b0dc6-233">這是為了先在發生 LargeObject 錯誤的現有 AD 物件上，確認同步規則可以正確運作，然後再套用至其他物件︰</span><span class="sxs-lookup"><span data-stu-id="b0dc6-233">This is to verify that the sync rule created is working correctly on an existing AD object with LargeObject error before you apply it to other objects:</span></span>
1. <span data-ttu-id="b0dc6-234">移至 Synchronization Service Manager 中的 [作業] 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-234">Go to the **Operations** tab in the Synchronization Service Manager.</span></span>
2. <span data-ttu-id="b0dc6-235">選取最新的「匯出至 Azure AD」作業，然後按一下其中一個發生 LargeObject 錯誤的物件。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-235">Select the most recent Export to Azure AD operation and click on one of the objects with LargeObject errors.</span></span>
3.  <span data-ttu-id="b0dc6-236">在 [連接器空間物件屬性] 快顯畫面中，按一下 [預覽] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-236">In the Connector Space Object Properties pop-up screen, click on the **Preview** button.</span></span>
4. <span data-ttu-id="b0dc6-237">在 [預覽] 快顯畫面中，選取 [完整同步處理]，然後按一下 [認可預覽]。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-237">In the Preview pop-up screen, select **Full synchronization** and click **Commit Preview**.</span></span>
5. <span data-ttu-id="b0dc6-238">關閉 [預覽] 畫面和 [連接器空間物件屬性] 畫面。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-238">Close the Preview screen and the Connector Space Object Properties screen.</span></span>
6. <span data-ttu-id="b0dc6-239">移至 Synchronization Service Manager 中的 [連接器] 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-239">Go to the **Connectors** tab in the Synchronization Service Manager.</span></span>
7. <span data-ttu-id="b0dc6-240">以滑鼠右鍵按一下 [Azure AD 連接器]，然後選取 [執行...]。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-240">Right-click on the **Azure AD** Connector and select **Run...**</span></span>
8. <span data-ttu-id="b0dc6-241">在 [執行連接器] 快顯視窗中，選取 [匯出] 步驟，然後按一下 [確定]。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-241">In the Run Connector pop-up, select **Export** step and click **OK**.</span></span>
9. <span data-ttu-id="b0dc6-242">等候「匯出至 Azure AD」完成，並確認此特定物件不再發生 LargeObject 錯誤。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-242">Wait for Export to Azure AD to complete and confirm there is no more LargeObject error on this specific object.</span></span>

### <a name="step-5-apply-the-new-sync-rule-to-remaining-objects-with-largeobject-error"></a><span data-ttu-id="b0dc6-243">步驟 5。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-243">Step 5.</span></span> <span data-ttu-id="b0dc6-244">將新的同步規則套用至發生 LargeObject 錯誤的其餘物件</span><span class="sxs-lookup"><span data-stu-id="b0dc6-244">Apply the new sync rule to remaining objects with LargeObject error</span></span>
<span data-ttu-id="b0dc6-245">新增同步規則之後，您需要在 AD 連接器上執行完整同步處理步驟︰</span><span class="sxs-lookup"><span data-stu-id="b0dc6-245">Once the sync rule has been added, you need to run a full synchronization step on the AD Connector:</span></span>
1. <span data-ttu-id="b0dc6-246">移至 Synchronization Service Manager 中的 [連接器] 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-246">Go to the **Connectors** tab in the Synchronization Service Manager.</span></span>
2. <span data-ttu-id="b0dc6-247">以滑鼠右鍵按一下 [AD 連接器]，然後選取 [執行...]。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-247">Right-click on the **AD** Connector and select **Run...**</span></span>
3. <span data-ttu-id="b0dc6-248">在 [執行連接器] 快顯視窗中，選取 [完整同步處理] 步驟，然後按一下 [確定]。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-248">In the Run Connector pop-up, select **Full Synchronization** step and click **OK**.</span></span>
4. <span data-ttu-id="b0dc6-249">等候「完整同步處理」步驟完成。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-249">Wait for the Full Synchronization step to complete.</span></span>
5. <span data-ttu-id="b0dc6-250">如果您有多個 AD 連接器，請對剩餘的 AD 連接器重複上述步驟。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-250">Repeat the above steps for the remaining AD Connectors if you have more than one AD Connectors.</span></span> <span data-ttu-id="b0dc6-251">通常，如果您有多個內部部署目錄，則需要多個連接器。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-251">Usually, multiple connectors are required if you have multiple on-premises directories.</span></span>

### <a name="step-6-verify-there-are-no-unexpected-changes-waiting-to-be-exported-to-azure-ad"></a><span data-ttu-id="b0dc6-252">步驟 6.</span><span class="sxs-lookup"><span data-stu-id="b0dc6-252">Step 6.</span></span> <span data-ttu-id="b0dc6-253">確認沒有非預期的變更在等候匯出至 Azure AD</span><span class="sxs-lookup"><span data-stu-id="b0dc6-253">Verify there are no unexpected changes waiting to be exported to Azure AD</span></span>
1. <span data-ttu-id="b0dc6-254">移至 Synchronization Service Manager 中的 [連接器] 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-254">Go to the **Connectors** tab in the Synchronization Service Manager.</span></span>
2. <span data-ttu-id="b0dc6-255">以滑鼠右鍵按一下 [Azure AD 連接器]，然後選取 [搜尋連接器空間]。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-255">Right-click on the **Azure AD** Connector and select **Search Connector Space**.</span></span>
3. <span data-ttu-id="b0dc6-256">在 [搜尋連接器空間] 快顯視窗中：</span><span class="sxs-lookup"><span data-stu-id="b0dc6-256">In the Search Connector Space pop-up:</span></span>
    1. <span data-ttu-id="b0dc6-257">將 [範圍] 設定為 [暫止匯出]。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-257">Set Scope to **Pending Export**.</span></span>
    2. <span data-ttu-id="b0dc6-258">將 3 個核取方塊全部勾選，包括 [新增]、[修改] 和 [刪除]。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-258">Check all 3 checkboxes, including **Add**, **Modify** and **Delete**.</span></span>
    3. <span data-ttu-id="b0dc6-259">按一下 [搜尋] 按鈕，以傳回所有在等候將變更匯出至 Azure AD 的物件。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-259">Click **Search** button to return all objects with changes waiting to be exported to Azure AD.</span></span>
    4. <span data-ttu-id="b0dc6-260">請確認沒有任何非預期的變更。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-260">Verify there are no unexpected changes.</span></span> <span data-ttu-id="b0dc6-261">若要檢查給定物件的變更，請按兩下物件。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-261">To examine the changes for a given object, double-click on the object.</span></span>

### <a name="step-7-export-the-changes-to-azure-ad"></a><span data-ttu-id="b0dc6-262">步驟 7.</span><span class="sxs-lookup"><span data-stu-id="b0dc6-262">Step 7.</span></span> <span data-ttu-id="b0dc6-263">將變更匯出至 Azure AD</span><span class="sxs-lookup"><span data-stu-id="b0dc6-263">Export the changes to Azure AD</span></span>
<span data-ttu-id="b0dc6-264">若要將變更匯出至 Azure AD：</span><span class="sxs-lookup"><span data-stu-id="b0dc6-264">To export the changes to Azure AD:</span></span>
1. <span data-ttu-id="b0dc6-265">移至 Synchronization Service Manager 中的 [連接器] 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-265">Go to the **Connectors** tab in the Synchronization Service Manager.</span></span>
2. <span data-ttu-id="b0dc6-266">以滑鼠右鍵按一下 [Azure AD 連接器]，然後選取 [執行...]。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-266">Right-click on the **Azure AD** Connector and select **Run...**</span></span>
4. <span data-ttu-id="b0dc6-267">在 [執行連接器] 快顯視窗中，選取 [匯出] 步驟，然後按一下 [確定]。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-267">In the Run Connector pop-up, select **Export** step and click **OK**.</span></span>
5. <span data-ttu-id="b0dc6-268">等候「匯出至 Azure AD」完成，並確認不再有 LargeObject 錯誤。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-268">Wait for Export to Azure AD to complete and confirm there are no more LargeObject errors.</span></span>

### <a name="step-8-re-enable-sync-scheduler"></a><span data-ttu-id="b0dc6-269">步驟 8。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-269">Step 8.</span></span> <span data-ttu-id="b0dc6-270">重新啟用同步排程器</span><span class="sxs-lookup"><span data-stu-id="b0dc6-270">Re-enable sync scheduler</span></span>
<span data-ttu-id="b0dc6-271">現在已解決問題，請重新啟用內建的同步排程器︰</span><span class="sxs-lookup"><span data-stu-id="b0dc6-271">Now that the issue is resolved, re-enable the built-in sync scheduler:</span></span>
1. <span data-ttu-id="b0dc6-272">啟動 PowerShell 工作階段。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-272">Start PowerShell session.</span></span>
2. <span data-ttu-id="b0dc6-273">執行 Cmdlet 以重新啟用排定的同步處理︰`Set-ADSyncScheduler -SyncCycleEnabled $true`</span><span class="sxs-lookup"><span data-stu-id="b0dc6-273">Re-enable scheduled synchronization by running cmdlet: `Set-ADSyncScheduler -SyncCycleEnabled $true`</span></span>

> [!Note]
> <span data-ttu-id="b0dc6-274">上述步驟僅適用於已內建排程器之較新版本 (1.1.xxx.x) 的 Azure AD Connect。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-274">The preceding steps are only applicable to newer versions (1.1.xxx.x) of Azure AD Connect with the built-in scheduler.</span></span> <span data-ttu-id="b0dc6-275">如果您使用較舊版本 (1.0.xxx.x) 的 Azure AD Connect (使用 Windows 工作排程器)，或使用您自己的自訂排程器 (不常見) 觸發定期同步處理，則必須視情況停用它們。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-275">If you are using older versions (1.0.xxx.x) of Azure AD Connect that uses Windows Task Scheduler, or you are using your own custom scheduler (not common) to trigger periodic synchronization, you need to disable them accordingly.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b0dc6-276">後續步驟</span><span class="sxs-lookup"><span data-stu-id="b0dc6-276">Next steps</span></span>
<span data-ttu-id="b0dc6-277">深入了解 [整合內部部署身分識別與 Azure Active Directory](active-directory-aadconnect.md)。</span><span class="sxs-lookup"><span data-stu-id="b0dc6-277">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>

