---
title: "Azure AD Connect：使用 SAML 2.0 識別提供者來進行單一登入 | Microsoft Docs"
description: "本主題描述如何使用 SAML 2.0 相容 Idp 來進行單一登入。"
services: active-directory
author: billmath
manager: femila
ms.custom: it-pro
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: f9653dc44fb284a9b3c1988f623c33f27ae148cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
#  <a name="use-a-saml-20-identity-provider-idp-for-single-sign-on"></a><span data-ttu-id="46f99-103">使用 SAML 2.0 識別提供者 (IdP) 來進行單一登入</span><span class="sxs-lookup"><span data-stu-id="46f99-103">Use a SAML 2.0 Identity Provider (IdP) for Single Sign On</span></span>

<span data-ttu-id="46f99-104">本主題包含資訊使用 SAML 2.0 相容之 Sp-lite 設定檔身分識別提供者做為架構 hello 慣用安全性權杖服務 (STS) / 身分識別提供者。</span><span class="sxs-lookup"><span data-stu-id="46f99-104">This topic contains information on using a SAML 2.0 compliant SP-Lite profile based Identity Provider as hello preferred Security Token Service (STS) / identity provider.</span></span> <span data-ttu-id="46f99-105">在已有內部部署的使用者目錄和密碼存放區並可使用 SAML 2.0 來加以存取時，這種做法非常實用。</span><span class="sxs-lookup"><span data-stu-id="46f99-105">This is useful where you already have a user directory and password store on-premises that can be accessed using SAML 2.0.</span></span> <span data-ttu-id="46f99-106">這個現有的使用者目錄可用來登入 tooOffice 365 和其他 Azure AD 保護的資源。</span><span class="sxs-lookup"><span data-stu-id="46f99-106">This existing user directory can be used for sign-on tooOffice 365 and other Azure AD-secured resources.</span></span> <span data-ttu-id="46f99-107">hello SAML 2.0 Sp-lite 設定檔根據 hello 廣泛使用安全性聲明標記語言 (SAML) 同盟識別身分標準 tooprovide 登入和屬性交換架構。</span><span class="sxs-lookup"><span data-stu-id="46f99-107">hello SAML 2.0 SP-Lite profile is based on hello widely used Security Assertion Markup Language (SAML) federated identity standard tooprovide a sign-on and attribute exchange framework.</span></span>

>[!NOTE]
><span data-ttu-id="46f99-108">如需第 3 個合作對象的 Idps 過搭配 Azure AD，請參閱 hello [Azure AD 同盟相容性清單](active-directory-aadconnect-federation-compatibility.md)</span><span class="sxs-lookup"><span data-stu-id="46f99-108">For a list of 3rd party Idps that have been tested for use with Azure AD see hello [Azure AD federation compatibility list](active-directory-aadconnect-federation-compatibility.md)</span></span>

<span data-ttu-id="46f99-109">Microsoft hello 整合，例如 Office 365 的 Microsoft 雲端服務的形式支援此登入體驗，您已正確設定 SAML 2.0 設定檔基礎 IdP。</span><span class="sxs-lookup"><span data-stu-id="46f99-109">Microsoft supports this sign-on experience as hello integration of a Microsoft cloud service, such as Office 365, with your properly configured SAML 2.0 profile based IdP.</span></span> <span data-ttu-id="46f99-110">SAML 2.0 身分識別提供者是第三方產品，因此 Microsoft 不提供支援的 hello 部署、 設定、 疑難排解最佳作法等項目的相關。</span><span class="sxs-lookup"><span data-stu-id="46f99-110">SAML 2.0 identity providers are third-party products and therefore Microsoft does not provide support for hello deployment, configuration, troubleshooting best practices regarding them.</span></span> <span data-ttu-id="46f99-111">一次正確設定，與 hello SAML 2.0 身分識別提供者可以透過使用 hello 以下更詳細說明 Microsoft Connectivity Analyzer Tool 測試的適當組態的 hello 整合。</span><span class="sxs-lookup"><span data-stu-id="46f99-111">Once properly configured, hello integration with hello SAML 2.0 identity provider can be tested for proper configuration by using hello Microsoft Connectivity Analyzer Tool which is described in more detail below.</span></span> <span data-ttu-id="46f99-112">如需 SAML 2.0 Sp-lite 設定檔型身分識別提供者的詳細資訊，請詢問 hello 組織提供它。</span><span class="sxs-lookup"><span data-stu-id="46f99-112">For more information about your SAML 2.0 SP-Lite profile based identity provider, ask hello organization that supplied it.</span></span>

>[!IMPORTANT]
><span data-ttu-id="46f99-113">在此登入案例中，只有一小部分的用戶端可與 SAML 2.0 識別提供者搭配使用，這些用戶端包括：</span><span class="sxs-lookup"><span data-stu-id="46f99-113">Only a limited set of clients are available in this sign-on scenario with SAML 2.0 identity providers, this includes:</span></span>

>- <span data-ttu-id="46f99-114">Web 型用戶端，例如 Outlook Web Access 和 SharePoint Online</span><span class="sxs-lookup"><span data-stu-id="46f99-114">Web-based clients such as Outlook Web Access and SharePoint Online</span></span>
- <span data-ttu-id="46f99-115">使用基本驗證和 IMAP、 POP、 Active Sync、 MAPI，例如支援的 Exchange 存取方法的電子郵件豐富型用戶端等 (hello 結束點是部署的必要的 toobe 增強用戶端通訊協定)，包括：</span><span class="sxs-lookup"><span data-stu-id="46f99-115">Email-rich clients that use basic authentication and a supported Exchange access method such as IMAP, POP, Active Sync, MAPI, etc. (hello Enhanced Client Protocol end point is required toobe deployed), including:</span></span>
    - <span data-ttu-id="46f99-116">Microsoft Outlook 2010/Outlook 2013/Outlook 2016、Apple iPhone (各種 iOS 版本)</span><span class="sxs-lookup"><span data-stu-id="46f99-116">Microsoft Outlook 2010/Outlook 2013/Outlook 2016, Apple iPhone (various iOS versions)</span></span>
    - <span data-ttu-id="46f99-117">各種 Google Android 裝置</span><span class="sxs-lookup"><span data-stu-id="46f99-117">Various Google Android Devices</span></span>
    - <span data-ttu-id="46f99-118">Windows Phone 7、Windows Phone 7.8 及 Windows Phone 8.0</span><span class="sxs-lookup"><span data-stu-id="46f99-118">Windows Phone 7, Windows Phone 7.8, and Windows Phone 8.0</span></span>
    - <span data-ttu-id="46f99-119">Windows 8 郵件用戶端和 Windows 8.1 郵件用戶端</span><span class="sxs-lookup"><span data-stu-id="46f99-119">Windows 8 Mail Client and Windows 8.1 Mail Client</span></span>
    - <span data-ttu-id="46f99-120">Windows 10 郵件用戶端</span><span class="sxs-lookup"><span data-stu-id="46f99-120">Windows 10 Mail Client</span></span>

<span data-ttu-id="46f99-121">在此登入案例中，其他所有用戶端則無法與 SAML 2.0 識別提供者搭配使用。</span><span class="sxs-lookup"><span data-stu-id="46f99-121">All other clients are not available in this sign-on scenario with your SAML 2.0 Identity Provider.</span></span> <span data-ttu-id="46f99-122">例如，hello Lync 2010 桌面用戶端不能 toologin hello 服務設定進行單一登入您 SAML 2.0 身分識別提供者。</span><span class="sxs-lookup"><span data-stu-id="46f99-122">For example, hello Lync 2010 desktop client is not able toologin into hello service with your SAML 2.0 Identity Provider configured for single sign-on.</span></span>

## <a name="azure-ad-saml-20-protocol-requirements"></a><span data-ttu-id="46f99-123">Azure AD SAML 2.0 通訊協定需求</span><span class="sxs-lookup"><span data-stu-id="46f99-123">Azure AD SAML 2.0 protocol requirements</span></span>
<span data-ttu-id="46f99-124">本主題包含 hello 通訊協定和訊息格式與 Azure AD tooenable 登入 tooone toofederate 或多個 Microsoft 雲端服務 （例如 Office 365)，必須實作您的 SAML 2.0 身分識別提供者的詳細的需求。</span><span class="sxs-lookup"><span data-stu-id="46f99-124">This topic contains detailed requirements on hello protocol and message formatting that your SAML 2.0 identity provider must implement toofederate with Azure AD tooenable sign-on tooone or more Microsoft cloud services (such as Office 365).</span></span> <span data-ttu-id="46f99-125">hello SAML 2.0 信賴憑證者合作對象 (SP-STS) 在此案例中使用的 Microsoft 雲端服務是 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="46f99-125">hello SAML 2.0 relying party (SP-STS) for a Microsoft cloud service used in this scenario is Azure AD.</span></span>

<span data-ttu-id="46f99-126">建議您確保 SAML 2.0 身分識別提供者輸出訊息是儘可能提供的範例追蹤相似 toohello 當做。</span><span class="sxs-lookup"><span data-stu-id="46f99-126">It is recommended that you ensure your SAML 2.0 identity provider output messages be as similar toohello provided sample traces as possible.</span></span> <span data-ttu-id="46f99-127">此外，請盡可能使用特定的屬性值從提供的 hello Azure AD 中繼資料。</span><span class="sxs-lookup"><span data-stu-id="46f99-127">Also, use specific attribute values from hello supplied Azure AD metadata where possible.</span></span> <span data-ttu-id="46f99-128">一旦您滿意您的輸出訊息時，您可以測試以 hello Microsoft Connectivity Analyzer，如下所述。</span><span class="sxs-lookup"><span data-stu-id="46f99-128">Once you are happy with your output messages, you can test with hello Microsoft Connectivity Analyzer as described below.</span></span>

<span data-ttu-id="46f99-129">hello Azure AD 中繼資料可以從此 URL 下載： [https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml](http://https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml)。</span><span class="sxs-lookup"><span data-stu-id="46f99-129">hello Azure AD metadata can be downloaded from this URL: [https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml](http://https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml).</span></span>
<span data-ttu-id="46f99-130">針對客戶在中國使用 hello 的 Office 365 的中國特定執行個體，應該使用 hello 遵循同盟端點： [https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml](https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml).</span><span class="sxs-lookup"><span data-stu-id="46f99-130">For customers in China using hello China-specific instance of Office 365, hello following federation endpoint should be used: [https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml](https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml).</span></span>

## <a name="saml-protocol-requirements"></a><span data-ttu-id="46f99-131">SAML 通訊協定需求</span><span class="sxs-lookup"><span data-stu-id="46f99-131">SAML protocol requirements</span></span>
<span data-ttu-id="46f99-132">本節詳述如何 hello 要求和回應訊息配對會放在一起的順序 toohelp 您 tooformat 郵件正確。</span><span class="sxs-lookup"><span data-stu-id="46f99-132">This section details how hello request and response message pairs are put together in order toohelp you tooformat your messages correctly.</span></span>

<span data-ttu-id="46f99-133">Azure AD 可與使用特定需求的 hello SAML 2.0 SP Lite 設定檔，如下所示的身分識別提供者設定的 toowork。</span><span class="sxs-lookup"><span data-stu-id="46f99-133">Azure AD can be configured toowork with identity providers that use hello SAML 2.0 SP Lite profile with some specific requirements as listed below.</span></span> <span data-ttu-id="46f99-134">使用 hello 範例 SAML 要求和回應訊息搭配自動化和手動測試，您可以使用與 Azure AD 的 tooachieve 互通性。</span><span class="sxs-lookup"><span data-stu-id="46f99-134">Using hello sample SAML request and response messages along with automated and manual testing, you can work tooachieve interoperability with Azure AD.</span></span>

## <a name="signature-block-requirements"></a><span data-ttu-id="46f99-135">簽章區塊需求</span><span class="sxs-lookup"><span data-stu-id="46f99-135">Signature block requirements</span></span>
<span data-ttu-id="46f99-136">在 SAML 回應 hello 訊息 hello 簽章節點會包含 hello hello 訊息本身的數位簽章的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="46f99-136">Within hello SAML Response message hello Signature node contains information about hello digital signature for hello message itself.</span></span> <span data-ttu-id="46f99-137">hello 簽章區塊具有下列需求的 hello:</span><span class="sxs-lookup"><span data-stu-id="46f99-137">hello signature block has hello following requirements:</span></span>

1. <span data-ttu-id="46f99-138">hello 宣告節點本身必須經過簽署。</span><span class="sxs-lookup"><span data-stu-id="46f99-138">hello assertion node itself must be signed</span></span>
2.  <span data-ttu-id="46f99-139">hello rsa-sha1 演算法必須當做 hello DigestMethod。</span><span class="sxs-lookup"><span data-stu-id="46f99-139">hello RSA-sha1 algorithm must be used as hello DigestMethod.</span></span> <span data-ttu-id="46f99-140">不接受其他數位簽章演算法。</span><span class="sxs-lookup"><span data-stu-id="46f99-140">Other digital signature algorithms are not accepted.</span></span>
   `<ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/>`
3.  <span data-ttu-id="46f99-141">您也可以簽署 hello XML 文件。</span><span class="sxs-lookup"><span data-stu-id="46f99-141">You may also sign hello XML document.</span></span> 
4.  <span data-ttu-id="46f99-142">hello Transform Algorithm 必須符合 hello 遵循範例中的 hello 值：`<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
       <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>`</span><span class="sxs-lookup"><span data-stu-id="46f99-142">hello Transform Algorithm must match hello values in hello following sample:    `<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
       <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>`</span></span>
9.  <span data-ttu-id="46f99-143">hello SignatureMethod Algorithm 必須符合下列範例中的 hello:`<ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>`</span><span class="sxs-lookup"><span data-stu-id="46f99-143">hello SignatureMethod Algorithm must match hello following sample:   `<ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>`</span></span>

## <a name="supported-bindings"></a><span data-ttu-id="46f99-144">支援的繫結</span><span class="sxs-lookup"><span data-stu-id="46f99-144">Supported bindings</span></span>
<span data-ttu-id="46f99-145">繫結是 hello 傳輸相關通訊所需的參數。</span><span class="sxs-lookup"><span data-stu-id="46f99-145">Bindings are hello transport related communications parameters that are required.</span></span> <span data-ttu-id="46f99-146">下列需求的 hello 套用 toohello 繫結</span><span class="sxs-lookup"><span data-stu-id="46f99-146">hello following requirements apply toohello bindings</span></span>

1. <span data-ttu-id="46f99-147">HTTPS 是必要的 hello 傳輸。</span><span class="sxs-lookup"><span data-stu-id="46f99-147">HTTPS is hello required transport.</span></span>
2.  <span data-ttu-id="46f99-148">在登入期間，Azure AD 需要 HTTP POST 以便提交權杖</span><span class="sxs-lookup"><span data-stu-id="46f99-148">Azure AD will require HTTP POST for token submission during logon</span></span>
3.  <span data-ttu-id="46f99-149">Azure AD 會將 HTTP POST hello 驗證要求 toohello 身分識別提供者] 和 [重新導向 hello 登出訊息 toohello 身分識別提供者。</span><span class="sxs-lookup"><span data-stu-id="46f99-149">Azure AD will use HTTP POST for hello authentication request toohello identity provider and REDIRECT for hello Logoff message toohello identity provider.</span></span>

## <a name="required-attributes"></a><span data-ttu-id="46f99-150">必要的屬性</span><span class="sxs-lookup"><span data-stu-id="46f99-150">Required attributes</span></span>
<span data-ttu-id="46f99-151">下表會顯示 hello SAML 2.0 訊息中的特定屬性的需求。</span><span class="sxs-lookup"><span data-stu-id="46f99-151">This table shows requirements for specific attributes in hello SAML 2.0 message.</span></span>
 
|<span data-ttu-id="46f99-152">屬性</span><span class="sxs-lookup"><span data-stu-id="46f99-152">Attribute</span></span>|<span data-ttu-id="46f99-153">說明</span><span class="sxs-lookup"><span data-stu-id="46f99-153">Description</span></span>|
| ----- | ----- |
|<span data-ttu-id="46f99-154">NameID</span><span class="sxs-lookup"><span data-stu-id="46f99-154">NameID</span></span>|<span data-ttu-id="46f99-155">此宣告 hello 值必須 hello 與 hello Azure AD 使用者的 ImmutableID 的相同。</span><span class="sxs-lookup"><span data-stu-id="46f99-155">hello value of this assertion must be hello same as hello Azure AD user’s ImmutableID.</span></span> <span data-ttu-id="46f99-156">它可以是 too64 英數字元組成。</span><span class="sxs-lookup"><span data-stu-id="46f99-156">It can be up too64 alpha numeric characters.</span></span> <span data-ttu-id="46f99-157">若為非 HTML 安全字元就必須編碼，例如，"+" 字元將會顯示為 ".2B"。</span><span class="sxs-lookup"><span data-stu-id="46f99-157">Any non HTML safe characters must be encoded, for example a “+” character is shown as “.2B”.</span></span>|
|<span data-ttu-id="46f99-158">IDPEmail</span><span class="sxs-lookup"><span data-stu-id="46f99-158">IDPEmail</span></span>|<span data-ttu-id="46f99-159">hello 使用者主體名稱 (UPN) 會列在 hello SAML 回應 hello 的項目名稱 IDPEmail 這是 hello 使用者的 UserPrincipalName (UPN) 在 Azure AD/Office 365 中。</span><span class="sxs-lookup"><span data-stu-id="46f99-159">hello User Principal Name (UPN) is listed in hello SAML response as an element with hello name IDPEmail This is hello user’s UserPrincipalName (UPN) in Azure AD/Office 365.</span></span> <span data-ttu-id="46f99-160">hello UPN 的電子郵件地址格式。</span><span class="sxs-lookup"><span data-stu-id="46f99-160">hello UPN is in email address format.</span></span> <span data-ttu-id="46f99-161">Windows Office 365 (Azure Active Directory) 中的 UPN 值。</span><span class="sxs-lookup"><span data-stu-id="46f99-161">UPN value in Windows Office 365 (Azure Active Directory).</span></span>|
|<span data-ttu-id="46f99-162">簽發者</span><span class="sxs-lookup"><span data-stu-id="46f99-162">Issuer</span></span>|<span data-ttu-id="46f99-163">這是必要的 toobe hello 身分識別提供者的 URI。</span><span class="sxs-lookup"><span data-stu-id="46f99-163">This is required toobe a URI of hello identity provider.</span></span> <span data-ttu-id="46f99-164">您不應該重複使用 hello 簽發者從 hello 範例訊息。</span><span class="sxs-lookup"><span data-stu-id="46f99-164">You should not reuse hello Issuer from hello sample messages.</span></span> <span data-ttu-id="46f99-165">如果您有多個頂層網域，Issuer 必須符合您 Azure AD 租用戶 hello 中 hello 指定 URI 設定每個網域。</span><span class="sxs-lookup"><span data-stu-id="46f99-165">If you have multiple top-level domains in your Azure AD tenants hello Issuer must match hello specified URI setting configured per domain.</span></span>|

>[!IMPORTANT]
><span data-ttu-id="46f99-166">Azure AD 目前支援 hello 依照 SAML 2.0:urn:oasis:names:tc:SAML:2.0:nameid NameID 格式 URI 的格式： 持續性。</span><span class="sxs-lookup"><span data-stu-id="46f99-166">Azure AD currently supports hello following NameID Format URI for SAML 2.0:urn:oasis:names:tc:SAML:2.0:nameid-format:persistent.</span></span>

## <a name="sample-saml-request-and-response-messages"></a><span data-ttu-id="46f99-167">SAML 要求和回應訊息範例</span><span class="sxs-lookup"><span data-stu-id="46f99-167">Sample SAML request and response messages</span></span>
<span data-ttu-id="46f99-168">要求和回應訊息配對則會顯示 hello 登入訊息交換。</span><span class="sxs-lookup"><span data-stu-id="46f99-168">A request and response message pair is shown for hello sign-on message exchange.</span></span>
<span data-ttu-id="46f99-169">這是從 Azure AD tooa 範例 SAML 2.0 身分識別提供者傳送的範例要求訊息。</span><span class="sxs-lookup"><span data-stu-id="46f99-169">This is a sample request message that is sent from Azure AD tooa sample SAML 2.0 identity provider.</span></span> <span data-ttu-id="46f99-170">hello 範例 SAML 2.0 身分識別提供者是 Active Directory Federation Services (AD FS) 設定 toouse SAML-P 通訊協定。</span><span class="sxs-lookup"><span data-stu-id="46f99-170">hello sample SAML 2.0 identity provider is Active Directory Federation Services (AD FS) configured toouse SAML-P protocol.</span></span> <span data-ttu-id="46f99-171">此範例也已經對其他 SAML 2.0 識別提供者完成互通性測試。</span><span class="sxs-lookup"><span data-stu-id="46f99-171">Interoperability testing has also been completed with other SAML 2.0 identity providers.</span></span>

    `<samlp:AuthnRequest xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol" xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" ID="_7171b0b2-19f2-4ba2-8f94-24b5e56b7f1e" IssueInstant="2014-01-30T16:18:35Z" Version="2.0" AssertionConsumerServiceIndex="0" >
    <saml:Issuer>urn:federation:MicrosoftOnline</saml:Issuer>
    <samlp:NameIDPolicy Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"/>
    </samlp:AuthnRequest>`

<span data-ttu-id="46f99-172">這是範例回應訊息所送出的 hello 範例 SAML 2.0 相容身分識別提供者 tooAzure AD / Office 365。</span><span class="sxs-lookup"><span data-stu-id="46f99-172">This is a sample response message that is sent from hello sample SAML 2.0 compliant identity provider tooAzure AD / Office 365.</span></span>

    `<samlp:Response ID="_592c022f-e85e-4d23-b55b-9141c95cd2a5" Version="2.0" IssueInstant="2014-01-31T15:36:31.357Z" Destination="https://login.microsoftonline.com/login.srf" Consent="urn:oasis:names:tc:SAML:2.0:consent:unspecified" InResponseTo="_049917a6-1183-42fd-a190-1d2cbaf9b144" xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol">
    <Issuer xmlns="urn:oasis:names:tc:SAML:2.0:assertion">http://WS2012R2-0.contoso.com/adfs/services/trust</Issuer>
    <samlp:Status>
    <samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success" />
    </samlp:Status>
    <Assertion ID="_7e3c1bcd-f180-4f78-83e1-7680920793aa" IssueInstant="2014-01-31T15:36:31.279Z" Version="2.0" xmlns="urn:oasis:names:tc:SAML:2.0:assertion">
    <Issuer>http://WS2012R2-0.contoso.com/adfs/services/trust</Issuer>
    <ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
      <ds:SignedInfo>
        <ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
        <ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1" />
        <ds:Reference URI="#_7e3c1bcd-f180-4f78-83e1-7680920793aa">
          <ds:Transforms>
            <ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature" />
            <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
          </ds:Transforms>
          <ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1" />
          <ds:DigestValue>CBn/5YqbheaJP425c0pHva9PhNY=</ds:DigestValue>
        </ds:Reference>
      </ds:SignedInfo>
      <ds:SignatureValue>TciWMyHW2ZODrh/2xrvp5ggmcHBFEd9vrp6DYXp+hZWJzmXMmzwmwS8KNRJKy8H7XqBsdELA1Msqi8I3TmWdnoIRfM/ZAyUppo8suMu6Zw+boE32hoQRnX9EWN/f0vH6zA/YKTzrjca6JQ8gAV1ErwvRWDpyMcwdYCiWALv9ScbkAcebOE1s1JctZ5RBXggdZWrYi72X+I4i6WgyZcIGai/rZ4v2otoWAEHS0y1yh1qT7NDPpl/McDaTGkNU6C+8VfjD78DrUXEcAfKvPgKlKrOMZnD1lCGsViimGY+LSuIdY45MLmyaa5UT4KWph6dA==</ds:SignatureValue>
      <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#">
        <ds:X509Data>
          <ds:X509Certificate>MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyhBREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDTE1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9ybWVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/+3ZWxd9T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEMb2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvyJOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBySx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==</ds:X509Certificate>
        </ds:X509Data>
      </KeyInfo>
    </ds:Signature>
    <Subject>
      <NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent">ABCDEG1234567890</NameID>
      <SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer">
        <SubjectConfirmationData InResponseTo="_049917a6-1183-42fd-a190-1d2cbaf9b144" NotOnOrAfter="2014-01-31T15:41:31.357Z" Recipient="https://login.microsoftonline.com/login.srf" />
      </SubjectConfirmation>
    </Subject>
    <Conditions NotBefore="2014-01-31T15:36:31.263Z" NotOnOrAfter="2014-01-31T16:36:31.263Z">
      <AudienceRestriction>
        <Audience>urn:federation:MicrosoftOnline</Audience>
      </AudienceRestriction>
    </Conditions>
    <AttributeStatement>
      <Attribute Name="IDPEmail">
        <AttributeValue>administrator@contoso.com</AttributeValue>
      </Attribute>
    </AttributeStatement>
    <AuthnStatement AuthnInstant="2014-01-31T15:36:30.200Z" SessionIndex="_7e3c1bcd-f180-4f78-83e1-7680920793aa">
      <AuthnContext>
        <AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</AuthnContextClassRef>
      </AuthnContext>
    </AuthnStatement>
    </Assertion>
    </samlp:Response>`

## <a name="configure-your-saml-20-compliant-identity-provider"></a><span data-ttu-id="46f99-173">設定 SAML 2.0 相容識別提供者</span><span class="sxs-lookup"><span data-stu-id="46f99-173">Configure your SAML 2.0 compliant identity provider</span></span>
<span data-ttu-id="46f99-174">本主題包含如何 tooconfigure 您 SAML 2.0 身分識別提供者 toofederate 的 Azure AD tooenable 單一登入存取 tooone 或多個 Microsoft 雲端服務 （例如 Office 365) 的指導方針使用 hello SAML 2.0 通訊協定。</span><span class="sxs-lookup"><span data-stu-id="46f99-174">This topic contains guidelines on how tooconfigure your SAML 2.0 identity provider toofederate with Azure AD tooenable single sign-on access tooone or more Microsoft cloud services (such as Office 365) using hello SAML 2.0 protocol.</span></span> <span data-ttu-id="46f99-175">hello SAML 2.0 信賴憑證者在此案例中使用的 Microsoft 雲端服務的合作對象是 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="46f99-175">hello SAML 2.0 relying party for a Microsoft cloud service used in this scenario is Azure AD.</span></span>

## <a name="add-azure-ad-metadata"></a><span data-ttu-id="46f99-176">新增 Azure AD 中繼資料</span><span class="sxs-lookup"><span data-stu-id="46f99-176">Add Azure AD metadata</span></span>
<span data-ttu-id="46f99-177">您的 SAML 2.0 身分識別提供者需要 tooadhere tooinformation 有關 hello Azure AD 信賴憑證者的合作對象。</span><span class="sxs-lookup"><span data-stu-id="46f99-177">Your SAML 2.0 identity provider needs tooadhere tooinformation about hello Azure AD relying party.</span></span> <span data-ttu-id="46f99-178">Azure AD 會在 https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml 發佈中繼資料。</span><span class="sxs-lookup"><span data-stu-id="46f99-178">Azure AD publishes metadata at https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml.</span></span>

<span data-ttu-id="46f99-179">建議您一律匯入 hello 最新的 Azure AD 中繼資料時在設定 SAML 2.0 身分識別提供者。</span><span class="sxs-lookup"><span data-stu-id="46f99-179">It is recommended that you always import hello latest Azure AD metadata when configuring your SAML 2.0 identity provider.</span></span> <span data-ttu-id="46f99-180">請注意，Azure AD 不會讀取 hello 身分識別提供者中繼資料。</span><span class="sxs-lookup"><span data-stu-id="46f99-180">Note that Azure AD does not read metadata from hello identity provider.</span></span>

## <a name="add-azure-ad-as-a-relying-party"></a><span data-ttu-id="46f99-181">將 Azure AD 新增為信賴憑證者</span><span class="sxs-lookup"><span data-stu-id="46f99-181">Add Azure AD as a relying party</span></span>
<span data-ttu-id="46f99-182">您有 tooenable SAML 2.0 身分識別提供者和 Azure AD 之間的通訊。</span><span class="sxs-lookup"><span data-stu-id="46f99-182">You have tooenable communication between your SAML 2.0 identity provider and Azure AD.</span></span> <span data-ttu-id="46f99-183">這項設定將會相依於您特定的身分識別提供者，您應該參閱 toodocumentation 它。</span><span class="sxs-lookup"><span data-stu-id="46f99-183">This configuration will be dependent on your specific identity provider and you should refer toodocumentation for it.</span></span> <span data-ttu-id="46f99-184">您需要設定信賴憑證者合作對象識別碼 toohello hello 與 hello 從 hello Azure AD 中繼資料內的 entityID 相同。</span><span class="sxs-lookup"><span data-stu-id="46f99-184">You would typically set hello relying party ID toohello same as hello entityID from hello Azure AD metadata.</span></span>

>[!NOTE]
><span data-ttu-id="46f99-185">確認 SAML 2.0 身分識別提供者伺服器上的 hello 時鐘同步的 tooan 準確的時間來源。</span><span class="sxs-lookup"><span data-stu-id="46f99-185">Verify hello clock on your SAML 2.0 identity provider server is synchronized tooan accurate time source.</span></span> <span data-ttu-id="46f99-186">錯誤的時鐘時間可能會導致同盟登入 toofail。</span><span class="sxs-lookup"><span data-stu-id="46f99-186">An inaccurate clock time can cause federated logins toofail.</span></span>

## <a name="install-windows-powershell-for-sign-on-with-saml-20-identity-provider"></a><span data-ttu-id="46f99-187">安裝 Windows PowerShell 以使用 SAML 2.0 識別提供者來進行登入</span><span class="sxs-lookup"><span data-stu-id="46f99-187">Install Windows PowerShell for sign-on with SAML 2.0 identity provider</span></span>
<span data-ttu-id="46f99-188">您已設定您的 SAML 2.0 身分識別提供者以使用 Azure AD 登入之後，hello 下一個步驟是 toodownload 和安裝 hello Azure Active Directory 的 Windows PowerShell 模組。</span><span class="sxs-lookup"><span data-stu-id="46f99-188">After you have configured your SAML 2.0 identity provider for use with Azure AD sign-on, hello next step is toodownload and install hello Azure Active Directory Module for Windows PowerShell.</span></span> <span data-ttu-id="46f99-189">安裝之後，您將使用這些 cmdlet tooconfigure 將 Azure AD 網域為同盟網域。</span><span class="sxs-lookup"><span data-stu-id="46f99-189">Once installed, you will use these cmdlets tooconfigure your Azure AD domains as federated domains.</span></span>

<span data-ttu-id="46f99-190">hello Azure Active Directory 的 Windows PowerShell 模組是在 Azure AD 中管理組織資料的下載。</span><span class="sxs-lookup"><span data-stu-id="46f99-190">hello Azure Active Directory Module for Windows PowerShell is a download for managing your organizations data in Azure AD.</span></span> <span data-ttu-id="46f99-191">此模組會安裝一組 cmdlet tooWindows PowerShell;執行這些 cmdlet tooset，設定單一登入存取 tooAzure AD 和依次 tooall hello 的雲端的服務訂閱。</span><span class="sxs-lookup"><span data-stu-id="46f99-191">This module installs a set of cmdlets tooWindows PowerShell; you run those cmdlets tooset up single sign-on access tooAzure AD and in turn tooall of hello cloud services you are subscribed to.</span></span> <span data-ttu-id="46f99-192">如需有關 toodownload 並安裝 hello cmdlet 的指示，請參閱[http://technet.microsoft.com/library/jj151815.aspx](http://technet.microsoft.com/library/jj151815.aspx)</span><span class="sxs-lookup"><span data-stu-id="46f99-192">For instructions about how toodownload and install hello cmdlets, see [http://technet.microsoft.com/library/jj151815.aspx](http://technet.microsoft.com/library/jj151815.aspx)</span></span>

## <a name="set-up-a-trust-between-your-saml-identity-provider-and-azure-ad"></a><span data-ttu-id="46f99-193">設定 SAML 識別提供者與 Azure AD 的信任關係</span><span class="sxs-lookup"><span data-stu-id="46f99-193">Set up a trust between your SAML identity provider and Azure AD</span></span>
<span data-ttu-id="46f99-194">在 Azure AD 網域中設定同盟之前，您必須先設定自訂網域。</span><span class="sxs-lookup"><span data-stu-id="46f99-194">Before configuring federation on an Azure AD domain, it must have a custom domain configured.</span></span> <span data-ttu-id="46f99-195">您無法將由 Microsoft 所提供的 hello 預設網域加入同盟。</span><span class="sxs-lookup"><span data-stu-id="46f99-195">You cannot federate hello default domain that is provided by Microsoft.</span></span> <span data-ttu-id="46f99-196">microsoft hello 預設網域結尾是"onmicrosoft.com"。</span><span class="sxs-lookup"><span data-stu-id="46f99-196">hello default domain from Microsoft ends with “onmicrosoft.com”.</span></span>
<span data-ttu-id="46f99-197">您將會在 hello Windows PowerShell 命令列介面 tooadd 中執行一系列的 cmdlet，或轉換網域的單一登入。</span><span class="sxs-lookup"><span data-stu-id="46f99-197">You will run a series of cmdlets in hello Windows PowerShell command-line interface tooadd or convert domains for single sign-on.</span></span>

<span data-ttu-id="46f99-198">每個您想要使用 SAML 2.0 身分識別提供者的 toofederate 必須下列其中一個的 Azure Active Directory 網域新增為單一登入網域或轉換的 toobe 單一登入網域從標準網域。</span><span class="sxs-lookup"><span data-stu-id="46f99-198">Each Azure Active Directory domain that you want toofederate using your SAML 2.0 identity provider must either be added as a single sign-on domain or converted toobe a single sign-on domain from a standard domain.</span></span> <span data-ttu-id="46f99-199">新增或轉換網域會設定 SAML 2.0 識別提供者和 Azure AD 之間的信任關係。</span><span class="sxs-lookup"><span data-stu-id="46f99-199">Adding or converting a domain sets up a trust between your SAML 2.0 identity provider and Azure AD.</span></span>

<span data-ttu-id="46f99-200">hello 下列程序引導您轉換現有標準網域 tooa 的同盟的網域使用 SAML 2.0 Sp-lite。</span><span class="sxs-lookup"><span data-stu-id="46f99-200">hello following procedure walks you through converting an existing standard domain tooa federated domain using SAML 2.0 SP-Lite.</span></span> <span data-ttu-id="46f99-201">請注意您的網域可能會遇到會影響使用者 too2 時數在執行此步驟之後中斷。</span><span class="sxs-lookup"><span data-stu-id="46f99-201">Note that your domain may experience an outage that impacts users up too2 hours after you take this step.</span></span>

## <a name="configuring-a-domain-in-your-azure-ad-directory-for-federation"></a><span data-ttu-id="46f99-202">在 Azure AD 目錄中設定用於同盟的網域</span><span class="sxs-lookup"><span data-stu-id="46f99-202">Configuring a domain in your Azure AD Directory for federation</span></span>


1. <span data-ttu-id="46f99-203">連接 Azure AD 目錄租用戶系統管理員身分 tooyour： 連接 Connect-msolservice。</span><span class="sxs-lookup"><span data-stu-id="46f99-203">Connect tooyour Azure AD Directory as a tenant administrator: Connect-MsolService .</span></span>
2.  <span data-ttu-id="46f99-204">設定您所需的 Office 365 網域 toouse 同盟和 SAML 2.0:`$dom = "contoso.com" $BrandName - "Sample SAML 2.0 IDP" $LogOnUrl = "https://WS2012R2-0.contoso.com/passiveLogon" $LogOffUrl = "https://WS2012R2-0.contoso.com/passiveLogOff" $ecpUrl = "https://WS2012R2-0.contoso.com/PAOS" $MyURI = "urn:uri:MySamlp2IDP" $MySigningCert = @" MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyh BREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDT E1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9yb WVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/kupQ VcjKuKLitVDbssFyqbDTjP7WRjlVMWAHBI3kgNT7oE362Gf2WMJFf1b0HcrsgLin7daRXpq4Qi6OA57 sW1YFMj3sqyuTP0eZV3S4+ZbDVob6amsZIdIwxaLP9Zfywg2bLsGnVldB0+XKedZwDbCLCVg+3ZWxd9 T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEM b2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcC AwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9 eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+ CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvy JOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBy Sx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==" "@ $uri = "http://WS2012R2-0.contoso.com/adfs/services/trust" $Protocol = "SAMLP" Set-MsolDomainAuthentication -DomainName $dom -FederationBrandName $dom -Authentication Federated -PassiveLogOnUri $MyURI -ActiveLogOnUri $ecpUrl -SigningCertificate $MySigningCert -IssuerUri $uri -LogOffUri $url -PreferredAuthenticationProtocol $Protocol`</span><span class="sxs-lookup"><span data-stu-id="46f99-204">Configure your desired Office 365 domain toouse federation with SAML 2.0: `$dom = "contoso.com" $BrandName - "Sample SAML 2.0 IDP" $LogOnUrl = "https://WS2012R2-0.contoso.com/passiveLogon" $LogOffUrl = "https://WS2012R2-0.contoso.com/passiveLogOff" $ecpUrl = "https://WS2012R2-0.contoso.com/PAOS" $MyURI = "urn:uri:MySamlp2IDP" $MySigningCert = @" MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyh BREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDT E1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9yb WVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/kupQ VcjKuKLitVDbssFyqbDTjP7WRjlVMWAHBI3kgNT7oE362Gf2WMJFf1b0HcrsgLin7daRXpq4Qi6OA57 sW1YFMj3sqyuTP0eZV3S4+ZbDVob6amsZIdIwxaLP9Zfywg2bLsGnVldB0+XKedZwDbCLCVg+3ZWxd9 T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEM b2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcC AwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9 eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+ CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvy JOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBy Sx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==" "@ $uri = "http://WS2012R2-0.contoso.com/adfs/services/trust" $Protocol = "SAMLP" Set-MsolDomainAuthentication -DomainName $dom -FederationBrandName $dom -Authentication Federated -PassiveLogOnUri $MyURI -ActiveLogOnUri $ecpUrl -SigningCertificate $MySigningCert -IssuerUri $uri -LogOffUri $url -PreferredAuthenticationProtocol $Protocol`</span></span> 

3.  <span data-ttu-id="46f99-205">您可以取得 hello 簽署憑證從 IDP 中繼資料檔案的 base64 編碼字串。</span><span class="sxs-lookup"><span data-stu-id="46f99-205">You can obtain hello signing certificate base64 encoded string from your IDP metadata file.</span></span> <span data-ttu-id="46f99-206">我們提供了此位置的範例，但此範例可能會隨您的實作方式而略有不同。</span><span class="sxs-lookup"><span data-stu-id="46f99-206">An example of this location has been provided but may differ slightly based on your implementation.</span></span>

    `<IDPSSODescriptor protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"> <KeyDescriptor use="signing"> <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#"> <X509Data> <X509Certificate>MIIC5jCCAc6gAwIBAgIQLnaxUPzay6ZJsC8HVv/QfTANBgkqhkiG9w0BAQsFADAvMS0wKwYDVQQDEyRBREZTIFNpZ25pbmcgLSBmcy50ZWNobGFiY2VudHJhbC5vcmcwHhcNMTMxMTA0MTgxMzMyWhcNMTQxMTA0MTgxMzMyWjAvMS0wKwYDVQQDEyRBREZTIFNpZ25pbmcgLSBmcy50ZWNobGFiY2VudHJhbC5vcmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCwMdVLTr5YTSRp+ccbSpuuFeXMfABD9mVCi2wtkRwC30TIyPdORz642MkurdxdPCWjwgJ0HW6TvXwcO9afH3OC5V//wEGDoNcI8PV4enCzTYFe/h//w51uqyv48Fbb3lEXs+aVl8155OAj2sO9IX64OJWKey82GQWK3g7LfhWWpp17j5bKpSd9DBH5pvrV+Q1ESU3mx71TEOvikHGCZYitEPywNeVMLRKrevdWI3FAhFjcCSO6nWDiMqCqiTDYOURXIcHVYTSof1YotkJ4tG6mP5Kpjzd4VQvnR7Pjb47nhIYG6iZ3mR1F85Ns9+hBWukQWNN2hcD/uGdPXhpdMVpBAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAK7h7jF7wPzhZ1dPl4e+XMAr8I7TNbhgEU3+oxKyW/IioQbvZVw1mYVCbGq9Rsw4KE06eSMybqHln3w5EeBbLS0MEkApqHY+p68iRpguqa+W7UHKXXQVgPMCpqxMFKonX6VlSQOR64FgpBme2uG+LJ8reTgypEKspQIN0WvtPWmiq4zAwBp08hAacgv868c0MM4WbOYU0rzMIR6Q+ceGVRImlCwZ5b7XKp4mJZ9hlaRjeuyVrDuzBkzROSurX1OXoci08yJvhbtiBJLf3uPOJHrhjKRwIt2TnzS9ElgFZlJiDIA26Athe73n43CT0af2IG6yC7e6sK4L3NEXJrwwUZk=</X509Certificate> </X509Data> </KeyInfo> </KeyDescriptor>` 

<span data-ttu-id="46f99-207">如需「Set-msoldomainauthentication」的詳細資訊，請參閱：[http://technet.microsoft.com/library/dn194112.aspx](http://technet.microsoft.com/library/dn194112.aspx)。</span><span class="sxs-lookup"><span data-stu-id="46f99-207">For more information about “Set-MsolDomainAuthentication”, see: [http://technet.microsoft.com/library/dn194112.aspx](http://technet.microsoft.com/library/dn194112.aspx).</span></span>

>[!NOTE]
><span data-ttu-id="46f99-208">只有在已經為識別提供者設定了 ECP 擴充功能時，才必須執行使用「$ecpUrl = "https://WS2012R2-0.contoso.com/PAOS"」。</span><span class="sxs-lookup"><span data-stu-id="46f99-208">You must run use “$ecpUrl = “https://WS2012R2-0.contoso.com/PAOS“” only if you set up an ECP extension for your identity provider.</span></span> <span data-ttu-id="46f99-209">Exchange Online 用戶端 (Outlook Web App (OWA) 除外) 仰賴以 POST 為基礎的作用中端點。</span><span class="sxs-lookup"><span data-stu-id="46f99-209">Exchange Online clients, excluding Outlook Web Application (OWA), rely on a POST based active end point.</span></span> <span data-ttu-id="46f99-210">如果 SAML 2.0 STS 實作的作用中的結束點作用中端點類似 tooShibboleth ECP 實作它可能會以 hello Exchange Online 服務這些豐富型用戶端 toointeract。</span><span class="sxs-lookup"><span data-stu-id="46f99-210">If your SAML 2.0 STS implements an active end point similar tooShibboleth’s ECP implementation of an active end point it may be possible for these rich clients toointeract with hello Exchange Online service.</span></span>

<span data-ttu-id="46f99-211">設定同盟後，即可切換後太 「 非同盟 」 （或 「 受管理 」），不過這項變更會佔用 tootwo 小時 toocomplete 且其需要指派新的隨機密碼，雲端型登入 tooeach 使用者。</span><span class="sxs-lookup"><span data-stu-id="46f99-211">Once federation has been configured you can switch back too“non-federated” (or “managed”), however this change takes up tootwo hours toocomplete and it requires assigning new random passwords for cloud based sign-in tooeach user.</span></span> <span data-ttu-id="46f99-212">切換回太 「 受管理 」 可能會在某些案例 tooreset 需要您的設定中的錯誤。</span><span class="sxs-lookup"><span data-stu-id="46f99-212">Switching back too“managed” may be required in some scenarios tooreset an error in your settings.</span></span> <span data-ttu-id="46f99-213">如需網域轉換的詳細資訊，請參閱：[http://msdn.microsoft.com/library/windowsazure/dn194122.aspx](http://msdn.microsoft.com/library/windowsazure/dn194122.aspx)。</span><span class="sxs-lookup"><span data-stu-id="46f99-213">For more information on Domain conversion see: [http://msdn.microsoft.com/library/windowsazure/dn194122.aspx](http://msdn.microsoft.com/library/windowsazure/dn194122.aspx).</span></span>

## <a name="provision-user-principals-tooazure-ad--office-365"></a><span data-ttu-id="46f99-214">佈建使用者主體 tooAzure AD / Office 365</span><span class="sxs-lookup"><span data-stu-id="46f99-214">Provision user principals tooAzure AD / Office 365</span></span>
<span data-ttu-id="46f99-215">您可以驗證您的使用者 tooOffice 365 之前您必須與對應 toohello hello SAML 2.0 中的判斷提示的主體宣告的使用者佈建 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="46f99-215">Before you can authenticate your users tooOffice 365 you must provision Azure AD with user principals that correspond toohello assertion in hello SAML 2.0 claim.</span></span> <span data-ttu-id="46f99-216">如果這些使用者主體未知的 tooAzure 事先 AD 然後它們無法用於同盟登入。</span><span class="sxs-lookup"><span data-stu-id="46f99-216">If these user principals are not known tooAzure AD in advance then they cannot be used for federated sign-in.</span></span> <span data-ttu-id="46f99-217">Azure AD Connect 或 Windows PowerShell 可以使用的 tooprovision 使用者主體。</span><span class="sxs-lookup"><span data-stu-id="46f99-217">Either Azure AD Connect or Windows PowerShell can be used tooprovision user principals.</span></span>

<span data-ttu-id="46f99-218">Azure AD Connect 可從 hello 內部部署 Active Directory 您 Azure AD 目錄中的使用的 tooprovision 主體 tooyour 網域。</span><span class="sxs-lookup"><span data-stu-id="46f99-218">Azure AD Connect can be used tooprovision principals tooyour domains in your Azure AD Directory from hello on-premises Active Directory.</span></span> <span data-ttu-id="46f99-219">如需詳細資訊，請參閱[整合您的內部部署目錄與 Azure Active Directory](active-directory-aadconnect.md)。</span><span class="sxs-lookup"><span data-stu-id="46f99-219">For more detailed information, see [Integrate your on-premises directories with Azure Active Directory](active-directory-aadconnect.md).</span></span>

<span data-ttu-id="46f99-220">Windows PowerShell 也可以使用的 tooautomate 加入新使用者 tooAzure AD 並 toosynchronize 變更從 hello 在內部部署目錄。</span><span class="sxs-lookup"><span data-stu-id="46f99-220">Windows PowerShell can also be used tooautomate adding new users tooAzure AD and toosynchronize changes from hello on-premises directory.</span></span> <span data-ttu-id="46f99-221">toouse hello Windows PowerShell cmdlet，您必須下載 hello [Azure Active Directory 模組](https://docs.microsoft.com/powershell/azure/install-adv2?view=azureadps-2.0)。</span><span class="sxs-lookup"><span data-stu-id="46f99-221">toouse hello Windows PowerShell cmdlets you must download hello [Azure Active Directory Modules](https://docs.microsoft.com/powershell/azure/install-adv2?view=azureadps-2.0).</span></span>

<span data-ttu-id="46f99-222">此程序示範如何 tooadd 單一使用者 tooAzure AD。</span><span class="sxs-lookup"><span data-stu-id="46f99-222">This procedure shows how tooadd a single user tooAzure AD.</span></span>


1. <span data-ttu-id="46f99-223">連接 Azure AD 目錄租用戶系統管理員身分 tooyour： 連接 Connect-msolservice。</span><span class="sxs-lookup"><span data-stu-id="46f99-223">Connect tooyour Azure AD Directory as a tenant administrator: Connect-MsolService.</span></span>
2.  <span data-ttu-id="46f99-224">建立新的使用者主體：` New-MsolUser
        -UserPrincipalName elwoodf1@contoso.com
        -ImmutableId ABCDEFG1234567890
        -DisplayName "Elwood Folk"
        -FirstName Elwood 
        -LastName Folk 
        -AlternateEmailAddresses "Elwood.Folk@contoso.com" 
        -LicenseAssignment "samlp2test:ENTERPRISEPACK" 
        -UsageLocation "US" `</span><span class="sxs-lookup"><span data-stu-id="46f99-224">Create a new user principal: ` New-MsolUser
        -UserPrincipalName elwoodf1@contoso.com
    -ImmutableId ABCDEFG1234567890
    -DisplayName "Elwood Folk"
    -FirstName Elwood 
    -LastName Folk 
    -AlternateEmailAddresses "Elwood.Folk@contoso.com" 
    -LicenseAssignment "samlp2test:ENTERPRISEPACK" 
    -UsageLocation "US" `</span></span> 

<span data-ttu-id="46f99-225">如需「New-MsolUser」的詳細資訊，請參閱 [http://technet.microsoft.com/library/dn194096.aspx](http://technet.microsoft.com/library/dn194096.aspx)</span><span class="sxs-lookup"><span data-stu-id="46f99-225">For more information about “New-MsolUser” check out, [http://technet.microsoft.com/library/dn194096.aspx](http://technet.microsoft.com/library/dn194096.aspx)</span></span>

>[!NOTE]
><span data-ttu-id="46f99-226">hello"UserPrinciplName"值必須符合您將會傳送為"IDPEmail"hello"ImmutableID"值必須符合您"NameID"宣告中傳送的 hello 值和 SAML 2.0 宣告中的 hello 值。</span><span class="sxs-lookup"><span data-stu-id="46f99-226">hello “UserPrinciplName” value must match hello value that you will send for “IDPEmail” in your SAML 2.0 claim and hello “ImmutableID” value must match hello value sent in your “NameID” assertion.</span></span>

## <a name="verify-single-sign-on-with-your-saml-20-idp"></a><span data-ttu-id="46f99-227">使用 SAML 2.0 IDP 驗證單一登入</span><span class="sxs-lookup"><span data-stu-id="46f99-227">Verify single sign-on with your SAML 2.0 IDP</span></span>
<span data-ttu-id="46f99-228">Hello 系統管理員，您驗證及管理單一登入 （也稱為身分識別同盟） 之前，檢閱 hello 資訊，在下列單一登入與 SAML 2.0 Sp-lite 型身分識別提供者的發行項 tooset hello 執行 hello 步驟：</span><span class="sxs-lookup"><span data-stu-id="46f99-228">As hello administrator, before you verify and manage single sign-on (also called identity federation), review hello information and perform hello steps in hello following articles tooset up single sign-on with your SAML 2.0 SP-Lite based identity provider:</span></span>


1.  <span data-ttu-id="46f99-229">您已檢閱 hello Azure AD SAML 2.0 通訊協定需求</span><span class="sxs-lookup"><span data-stu-id="46f99-229">You have reviewed hello Azure AD SAML 2.0 Protocol Requirements</span></span>
2.  <span data-ttu-id="46f99-230">您已設定 SAML 2.0 識別提供者</span><span class="sxs-lookup"><span data-stu-id="46f99-230">You have configured your SAML 2.0 identity provider</span></span>
3.  <span data-ttu-id="46f99-231">安裝 Windows PowerShell 以使用 SAML 2.0 識別提供者來進行單一登入</span><span class="sxs-lookup"><span data-stu-id="46f99-231">Install Windows PowerShell for single sign-on with SAML 2.0 identity provider</span></span>
4.  <span data-ttu-id="46f99-232">設定 SAML 2.0 識別提供者與 Azure AD 的信任關係</span><span class="sxs-lookup"><span data-stu-id="46f99-232">Set up a trust between SAML 2.0 identity provider and Azure AD</span></span>
5.  <span data-ttu-id="46f99-233">透過 Windows PowerShell 或 Azure AD Connect 使用者佈建已知的測試使用者主體 tooAzure Active Directory (Office 365)。</span><span class="sxs-lookup"><span data-stu-id="46f99-233">Provisioned a known test user principal tooAzure Active Directory (Office 365) either through Windows PowerShell or Azure AD Connect.</span></span>
6.  <span data-ttu-id="46f99-234">使用 [Azure AD Connect](active-directory-aadconnect.md) 來設定目錄同步作業。</span><span class="sxs-lookup"><span data-stu-id="46f99-234">Configure directory synchronization using [Azure AD Connect](active-directory-aadconnect.md).</span></span>

<span data-ttu-id="46f99-235">在設定了使用 SAML 2.0 SP-Lite 型識別提供者來進行的單一登入後，您應該確認它是否能正常運作。</span><span class="sxs-lookup"><span data-stu-id="46f99-235">After setting up single sign-on with your SAML 2.0 SP-Lite based identity Provider, you should verify that it is working correctly.</span></span>

>[!NOTE]
><span data-ttu-id="46f99-236">如果您轉換網域，而非新增網域，就會在 too24 小時 tooset 單一登入。</span><span class="sxs-lookup"><span data-stu-id="46f99-236">If you converted a domain, rather than adding one, it may take up too24 hours tooset up single sign-on.</span></span>
<span data-ttu-id="46f99-237">在驗證單一登入之前，請先完成 Active Directory 同步作業的設定、對目錄進行同步處理，並啟用已同步處理的使用者。</span><span class="sxs-lookup"><span data-stu-id="46f99-237">Before you verify single sign-on, you should finish setting up Active Directory synchronization, synchronize your directories, and activate your synced users.</span></span>

### <a name="use-hello-tool-tooverify-that-single-sign-on-has-been-set-up-correctly"></a><span data-ttu-id="46f99-238">單一登入使用 hello 工具 tooverify 已正確設定</span><span class="sxs-lookup"><span data-stu-id="46f99-238">Use hello tool tooverify that single sign-on has been set up correctly</span></span>
<span data-ttu-id="46f99-239">tooverify 單一登入已正確設定，您可以執行下列程序 tooconfirm 您利用公司認證所能 toosign toohello 雲端服務中的 hello。</span><span class="sxs-lookup"><span data-stu-id="46f99-239">tooverify that single sign-on has been set up correctly, you can perform hello following procedure tooconfirm that you are able toosign in toohello cloud service with your corporate credentials.</span></span>

<span data-ttu-id="46f99-240">Microsoft 已提供一種工具，您可以使用 tootest SAML 2.0 型身分識別提供者。</span><span class="sxs-lookup"><span data-stu-id="46f99-240">Microsoft has provided a tool that you can use tootest your SAML 2.0 based identity provider.</span></span> <span data-ttu-id="46f99-241">執行 hello 之前測試工具，您必須設定 Azure AD 租用戶 toofederate 與您的身分識別提供者。</span><span class="sxs-lookup"><span data-stu-id="46f99-241">Before running hello test tool you must have configured an Azure AD tenant toofederate with your identity provider.</span></span>

>[!NOTE]
><span data-ttu-id="46f99-242">hello Connectivity Analyzer 需要 Internet Explorer 10 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="46f99-242">hello Connectivity Analyzer requires Internet Explorer 10 or later.</span></span>



1. <span data-ttu-id="46f99-243">下載 hello Connectivity Analyzer， [https://testconnectivity.microsoft.com/?tabid=Client](https://testconnectivity.microsoft.com/?tabid=Client)。</span><span class="sxs-lookup"><span data-stu-id="46f99-243">Download hello Connectivity Analyzer from, [https://testconnectivity.microsoft.com/?tabid=Client](https://testconnectivity.microsoft.com/?tabid=Client).</span></span>
2.  <span data-ttu-id="46f99-244">按一下 立即安裝 toobegin 下載及安裝 hello 工具。</span><span class="sxs-lookup"><span data-stu-id="46f99-244">Click Install Now toobegin downloading and installing hello tool.</span></span>
3.  <span data-ttu-id="46f99-245">選取 [我無法設定與 Office 365、Azure 或其他使用 Azure Active Directory 之服務的同盟]。</span><span class="sxs-lookup"><span data-stu-id="46f99-245">Select “I can’t set up federation with Office 365, Azure, or other services that use Azure Active Directory”.</span></span>
4.  <span data-ttu-id="46f99-246">一旦 hello 工具下載及執行，您會看到 hello 連線診斷 視窗。</span><span class="sxs-lookup"><span data-stu-id="46f99-246">Once hello tool is downloaded and running, you will see hello Connectivity Diagnostics window.</span></span> <span data-ttu-id="46f99-247">hello 工具會逐步完成同盟連線的測試。</span><span class="sxs-lookup"><span data-stu-id="46f99-247">hello tool will step you through testing your federation connection.</span></span>
5.  <span data-ttu-id="46f99-248">hello Connectivity Analyzer 會開啟您 SAML 2.0 IDP 以供您 toologon，輸入您要測試的 hello 使用者主體 hello 認證： ![SAML](media/active-directory-aadconnect-federation-saml-idp/saml1.png)</span><span class="sxs-lookup"><span data-stu-id="46f99-248">hello Connectivity Analyzer will open your SAML 2.0 IDP for you toologon, enter hello credentials for hello user principal you are testing: ![SAML](media/active-directory-aadconnect-federation-saml-idp/saml1.png)</span></span>
6.  <span data-ttu-id="46f99-249">在 hello 同盟測試登入視窗應該會與您的 SAML 2.0 身分識別提供者同盟設定的 toobe hello Azure AD 租用戶輸入帳戶名稱和密碼。</span><span class="sxs-lookup"><span data-stu-id="46f99-249">At hello Federation test sign-in window you should enter an account name and password for hello Azure AD tenant that is configured toobe federated with your SAML 2.0 identity provider.</span></span> <span data-ttu-id="46f99-250">hello 工具會嘗試 toosign 中使用這些認證，而且 hello 登入嘗試期間執行之測試的詳細的結果將會提供做為輸出。</span><span class="sxs-lookup"><span data-stu-id="46f99-250">hello tool will attempt toosign-in using those credentials and detailed results of tests performed during hello sign-in attempt will be provided as output.</span></span>
<span data-ttu-id="46f99-251">![SAML](media/active-directory-aadconnect-federation-saml-idp/saml2.png)</span><span class="sxs-lookup"><span data-stu-id="46f99-251">![SAML](media/active-directory-aadconnect-federation-saml-idp/saml2.png)</span></span>
7. <span data-ttu-id="46f99-252">此視窗顯示失敗的測試結果。</span><span class="sxs-lookup"><span data-stu-id="46f99-252">This window shows a failed result of testing.</span></span> <span data-ttu-id="46f99-253">按一下 檢閱詳細的結果將會顯示針對每個已執行的測試 hello 結果的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="46f99-253">Clicking on Review detailed results will show information about hello results for each test that was performed.</span></span> <span data-ttu-id="46f99-254">您也可以儲存 hello 結果 toodisk 中順序 tooshare 它們。</span><span class="sxs-lookup"><span data-stu-id="46f99-254">You can also save hello results toodisk in order tooshare them.</span></span>
 
>[!NOTE]
><span data-ttu-id="46f99-255">hello Connectivity analyzer 還會測試作用中的同盟，使用 hello WS *-型和 ECP/PAOS 通訊協定。</span><span class="sxs-lookup"><span data-stu-id="46f99-255">hello Connectivity analyzer also tests Active Federation using hello WS*-based and ECP/PAOS protocols.</span></span> <span data-ttu-id="46f99-256">如果您不使用這些可以忽略下列錯誤 hello： 測試 hello 作用中登入流程使用身分識別提供者的作用中同盟端點。</span><span class="sxs-lookup"><span data-stu-id="46f99-256">If you are not using these you can disregard hello following error: Testing hello Active sign-in flow using your identity provider’s Active federation endpoint.</span></span>

### <a name="manually-verify-that-single-sign-on-has-been-set-up-correctly"></a><span data-ttu-id="46f99-257">手動驗證系統是否已正確設定單一登入</span><span class="sxs-lookup"><span data-stu-id="46f99-257">Manually verify that single sign-on has been set up correctly</span></span>
<span data-ttu-id="46f99-258">手動驗證提供額外的步驟，您可在許多情況下您的 SAML 2.0 身分識別提供者正常運作的 tooensure。</span><span class="sxs-lookup"><span data-stu-id="46f99-258">Manual verification provides additional steps that you can take tooensure that your SAML 2.0 identity Provider is working properly in many scenarios.</span></span>
<span data-ttu-id="46f99-259">單一登入的 tooverify 是否已正確設定，請完成 hello 下列步驟：</span><span class="sxs-lookup"><span data-stu-id="46f99-259">tooverify that single sign-on has been set up correctly, complete hello following steps:</span></span>


1. <span data-ttu-id="46f99-260">已加入網域的電腦上，登入 tooyour 雲端服務使用的 hello 相同登入您的公司認證所使用的名稱。</span><span class="sxs-lookup"><span data-stu-id="46f99-260">On a domain-joined computer, sign in tooyour cloud service using hello same logon name that you use for your corporate credentials.</span></span>
2.  <span data-ttu-id="46f99-261">Hello 密碼方塊內按一下。</span><span class="sxs-lookup"><span data-stu-id="46f99-261">Click inside hello password box.</span></span> <span data-ttu-id="46f99-262">如果單一登入設定，hello 密碼方塊將呈陰影狀，而且您會看到下列訊息的 hello: 「 您已在中的必要的 toosign <your company>。 」</span><span class="sxs-lookup"><span data-stu-id="46f99-262">If single sign-on is set up, hello password box will be shaded, and you will see hello following message: “You are now required toosign in at <your company>.”</span></span>
3.  <span data-ttu-id="46f99-263">按一下 hello 登入<your company>連結。</span><span class="sxs-lookup"><span data-stu-id="46f99-263">Click hello Sign in at <your company> link.</span></span> <span data-ttu-id="46f99-264">如果您不能 toosign 中的，然後單一登入具有已設定。</span><span class="sxs-lookup"><span data-stu-id="46f99-264">If you are able toosign in, then single sign-on has been set up.</span></span>

## <a name="next-steps"></a><span data-ttu-id="46f99-265">後續步驟</span><span class="sxs-lookup"><span data-stu-id="46f99-265">Next Steps</span></span>


- [<span data-ttu-id="46f99-266">使用 Azure AD Connect 管理和自訂 Active Directory Federation Services</span><span class="sxs-lookup"><span data-stu-id="46f99-266">Active Directory Federation Services management and customization with Azure AD Connect</span></span>](active-directory-aadconnect-federation-management.md)
- [<span data-ttu-id="46f99-267">Azure AD 同盟相容性清單</span><span class="sxs-lookup"><span data-stu-id="46f99-267">Azure AD federation compatibility list</span></span>](active-directory-aadconnect-federation-compatibility.md)
- [<span data-ttu-id="46f99-268">Azure AD Connect 自訂安裝</span><span class="sxs-lookup"><span data-stu-id="46f99-268">Azure AD Connect Custom Installation</span></span>](active-directory-aadconnect-get-started-custom.md)
