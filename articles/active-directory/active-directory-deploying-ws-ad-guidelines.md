---
title: "部署 Windows Server Active directory 在 Azure 虛擬機器 aaaGuidelines |Microsoft 文件"
description: "如果您知道如何 toodeploy AD 網域服務和內部，AD 同盟服務了解如何在 Azure 虛擬機器上。"
services: active-directory
documentationcenter: 
author: femila
manager: femila
editor: 
ms.assetid: 04df4c46-e6b6-4754-960a-57b823d617fa
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 07/26/2017
ms.author: femila
ms.openlocfilehash: 9ad5a5f138a6402cbb656d9160545846051207b6
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="guidelines-for-deploying-windows-server-active-directory-on-azure-virtual-machines"></a><span data-ttu-id="6e8b5-103">在 Azure 虛擬機器上部署 Windows Server Active Directory 的指導方針</span><span class="sxs-lookup"><span data-stu-id="6e8b5-103">Guidelines for deploying Windows Server Active Directory on Azure virtual machines</span></span>
<span data-ttu-id="6e8b5-104">本文說明 hello 部署 Windows Server Active Directory 網域服務 (AD DS) 與 Active Directory Federation Services (AD FS) 內部部署與部署到 Microsoft Azure 虛擬機器之間的重要差異。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-104">This article explains hello important differences between deploying Windows Server Active Directory Domain Services (AD DS) and Active Directory Federation Services (AD FS) on-premises versus deploying them on Microsoft Azure virtual machines.</span></span>

## <a name="scope-and-audience"></a><span data-ttu-id="6e8b5-105">範圍和對象</span><span class="sxs-lookup"><span data-stu-id="6e8b5-105">Scope and audience</span></span>
<span data-ttu-id="6e8b5-106">hello 發行項的主要對象已經熟悉 Active Directory 在內部部署。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-106">hello article is intended for those already experienced with deploying Active Directory on-premises.</span></span> <span data-ttu-id="6e8b5-107">它涵蓋了在 Microsoft Azure 虛擬機器 /azure 虛擬網路和傳統內部部署 Active Directory 部署中部署 Active Directory 的 hello 差異。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-107">It covers hello differences between deploying Active Directory on Microsoft Azure virtual machines/Azure virtual networks and traditional on-premises Active Directory deployments.</span></span> <span data-ttu-id="6e8b5-108">Azure 虛擬機器和 Azure 虛擬網路是基礎結構做為服務 (IaaS) 供應項目組織 tooleverage 運算資源 hello 雲端中的一部分。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-108">Azure virtual machines and Azure virtual networks are part of an Infrastructure-as-a-Service (IaaS) offering for organizations tooleverage computing resources in hello cloud.</span></span>

<span data-ttu-id="6e8b5-109">對於不熟悉 AD 部署，請參閱 hello [AD DS 部署指南](https://technet.microsoft.com/library/cc753963)或[規劃 AD FS 部署](https://technet.microsoft.com/library/dn151324.aspx)依適當情況。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-109">For those that are not familiar with AD deployment, see hello [AD DS Deployment Guide](https://technet.microsoft.com/library/cc753963) or [Plan your AD FS deployment](https://technet.microsoft.com/library/dn151324.aspx) as appropriate.</span></span>

<span data-ttu-id="6e8b5-110">本文章假設 hello 讀者已熟悉下列概念的 hello:</span><span class="sxs-lookup"><span data-stu-id="6e8b5-110">This article assumes that hello reader is familiar with hello following concepts:</span></span>

* <span data-ttu-id="6e8b5-111">Windows Server AD DS 部署和管理</span><span class="sxs-lookup"><span data-stu-id="6e8b5-111">Windows Server AD DS deployment and management</span></span>
* <span data-ttu-id="6e8b5-112">部署和設定 DNS toosupport Windows Server AD DS 基礎結構</span><span class="sxs-lookup"><span data-stu-id="6e8b5-112">Deployment and configuration of DNS toosupport a Windows Server AD DS infrastructure</span></span>
* <span data-ttu-id="6e8b5-113">Windows Server AD FS 部署和管理</span><span class="sxs-lookup"><span data-stu-id="6e8b5-113">Windows Server AD FS deployment and management</span></span>
* <span data-ttu-id="6e8b5-114">部署、設定及管理可以使用 Windows Server AD FS 權杖的信賴憑證者應用程式 (網站和 Web 服務)</span><span class="sxs-lookup"><span data-stu-id="6e8b5-114">Deploying, configuring, and managing relying party applications (websites and web services) that can consume Windows Server AD FS tokens</span></span>
* <span data-ttu-id="6e8b5-115">一般虛擬機器概念，例如如何 tooconfigure 的虛擬機器，虛擬磁碟和虛擬網路</span><span class="sxs-lookup"><span data-stu-id="6e8b5-115">General virtual machine concepts, such as how tooconfigure a virtual machine, virtual disks, and virtual networks</span></span>

<span data-ttu-id="6e8b5-116">本文強調混合式部署案例中，Windows Server AD DS 或 AD FS 的一部分會部署在內部部署環境，一部分則部署在 Azure 虛擬機器上的 hello 要求。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-116">This article highlights hello requirements for a hybrid deployment scenario in which Windows Server AD DS or AD FS are partly deployed on-premises and partly deployed on Azure virtual machines.</span></span> <span data-ttu-id="6e8b5-117">hello 文件先涵蓋 hello 重大差異與內部部署，以及影響設計和部署的重要決策點的 Azure 虛擬機器上執行 Windows Server AD DS 和 AD FS。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-117">hello document first covers hello critical differences between running Windows Server AD DS and AD FS on Azure virtual machines versus on-premises, and important decision points that affect design and deployment.</span></span> <span data-ttu-id="6e8b5-118">hello 紙張的 hello 其餘部分會說明指導方針，每個詳細資料，以及如何 tooapply hello 指導方針 toovarious 部署案例中的 hello 決策點。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-118">hello rest of hello paper explains guidelines for each of hello decision points in more detail, and how tooapply hello guidelines toovarious deployment scenarios.</span></span>

<span data-ttu-id="6e8b5-119">本文將不會討論的 hello 組態[Azure Active Directory](http://azure.microsoft.com/services/active-directory/)，即為雲端應用程式提供身分識別管理及存取控制功能的 REST 式服務。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-119">This article does not discuss hello configuration of [Azure Active Directory](http://azure.microsoft.com/services/active-directory/), which is a REST-based service that provides identity management and access control capabilities for cloud applications.</span></span> <span data-ttu-id="6e8b5-120">Azure Active Directory (Azure AD) 和 Windows Server AD DS，不過，是設計的 toowork 一起 tooprovide 身分識別和存取管理解決方案，針對目前混合式 IT 環境和現代化應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-120">Azure Active Directory (Azure AD) and Windows Server AD DS are, however, designed toowork together tooprovide an identity and access management solution for today’s hybrid IT environments and modern applications.</span></span> <span data-ttu-id="6e8b5-121">toohelp 了解 hello 差異和 Windows Server AD DS 與 Azure AD 之間的關聯性，請考慮下列 hello:</span><span class="sxs-lookup"><span data-stu-id="6e8b5-121">toohelp understand hello differences and relationships between Windows Server AD DS and Azure AD, consider hello following:</span></span>

1. <span data-ttu-id="6e8b5-122">您可能會遇到 Windows Server AD DS hello 雲端 Azure 虛擬機器上使用 Azure tooextend 時您的內部部署資料中心 hello 雲端。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-122">You might run Windows Server AD DS in hello cloud on Azure virtual machines when you are using Azure tooextend your on-premises datacenter into hello cloud.</span></span>
2. <span data-ttu-id="6e8b5-123">您可以使用 Azure AD toogive 使用者單一登入 tooSoftware 做為服務 (SaaS) 應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-123">You might use Azure AD toogive your users single sign-on tooSoftware-as-a-Service (SaaS) applications.</span></span> <span data-ttu-id="6e8b5-124">例如，Microsoft Office 365 會使用這項技術，而且在 Azure 或其他雲端平台中執行的應用程式也可以使用此技術。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-124">Microsoft Office 365 uses this technology, for example, and applications running on Azure or other cloud platforms can also use it.</span></span>
3. <span data-ttu-id="6e8b5-125">您可以使用 Azure AD （其存取控制服務） toolet 使用者的登入使用 Facebook、 Google、 Microsoft 及裝載於 hello 雲端或內部部署其他身分識別提供者 tooapplications 來自身分識別。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-125">You might use Azure AD (its Access Control Service) toolet users sign in using identities from Facebook, Google, Microsoft, and other identity providers tooapplications that are hosted in hello cloud or on-premises.</span></span>

<span data-ttu-id="6e8b5-126">如需有關這些差異的詳細資訊，請參閱 [Azure 身分識別](fundamentals-identity.md)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-126">For more information about these differences, see [Azure Identity](fundamentals-identity.md).</span></span>

## <a name="related-resources"></a><span data-ttu-id="6e8b5-127">相關資源</span><span class="sxs-lookup"><span data-stu-id="6e8b5-127">Related resources</span></span>
<span data-ttu-id="6e8b5-128">您可以下載及執行 hello [Azure 虛擬機器整備評估](https://www.microsoft.com/download/details.aspx?id=40898)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-128">You may download and run hello [Azure Virtual Machine Readiness Assessment](https://www.microsoft.com/download/details.aspx?id=40898).</span></span> <span data-ttu-id="6e8b5-129">hello 評估會自動檢查您的內部部署環境，並產生自訂的報告根據 hello 指引中找到這個主題 toohelp 移轉 hello 環境 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-129">hello assessment will automatically inspect your on-premises environment and generate a customized report based on hello guidance found in this topic toohelp you migrate hello environment tooAzure.</span></span>

<span data-ttu-id="6e8b5-130">我們建議您也會先檢閱 hello 教學課程、 輔助線和影片涵蓋下列主題中的 hello:</span><span class="sxs-lookup"><span data-stu-id="6e8b5-130">We recommend that you also first review hello tutorials, guides, and videos that cover hello following topics:</span></span>

* [<span data-ttu-id="6e8b5-131">在 hello Azure 入口網站中設定純雲端虛擬網路</span><span class="sxs-lookup"><span data-stu-id="6e8b5-131">Configure a Cloud-Only Virtual Network in hello Azure Portal</span></span>](../virtual-network/virtual-networks-create-vnet-arm-pportal.md)
* [<span data-ttu-id="6e8b5-132">在 hello Azure 入口網站中設定站對站 VPN</span><span class="sxs-lookup"><span data-stu-id="6e8b5-132">Configure a Site-to-Site VPN in hello Azure Portal</span></span>](../vpn-gateway/vpn-gateway-site-to-site-create.md)
* [<span data-ttu-id="6e8b5-133">在 Azure 虛擬網路上安裝新的 Active Directory 樹系</span><span class="sxs-lookup"><span data-stu-id="6e8b5-133">Install a new Active Directory forest on an Azure virtual network</span></span>](active-directory-new-forest-virtual-machine.md)
* [<span data-ttu-id="6e8b5-134">在 Azure 中安裝複本 Active Directory 網域控制站</span><span class="sxs-lookup"><span data-stu-id="6e8b5-134">Install a replica Active Directory domain controller on Azure</span></span>](active-directory-install-replica-active-directory-domain-controller.md)
* [<span data-ttu-id="6e8b5-135">Microsoft Azure IT Pro IaaS：(01) 虛擬機器基本概念</span><span class="sxs-lookup"><span data-stu-id="6e8b5-135">Microsoft Azure IT Pro IaaS: (01) Virtual Machine Fundamentals</span></span>](https://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/01)
* [<span data-ttu-id="6e8b5-136">Microsoft Azure IT Pro IaaS：(05) 建立虛擬網路和跨單位連線</span><span class="sxs-lookup"><span data-stu-id="6e8b5-136">Microsoft Azure IT Pro IaaS: (05) Creating Virtual Networks and Cross-Premises Connectivity</span></span>](https://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/05)

## <a name="introduction"></a><span data-ttu-id="6e8b5-137">簡介</span><span class="sxs-lookup"><span data-stu-id="6e8b5-137">Introduction</span></span>
<span data-ttu-id="6e8b5-138">hello Azure 虛擬機器上部署 Windows Server Active Directory 的基本需求不同變動會越來越小從將它部署在內部部署虛擬機器 （甚至是實體機器 toosome 範圍）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-138">hello fundamental requirements for deploying Windows Server Active Directory on Azure virtual machines differ very little from deploying it in on-premises virtual machines (and, toosome extent, physical machines).</span></span> <span data-ttu-id="6e8b5-139">例如，hello 在 Windows Server AD DS 中，如果 hello 網域控制站 (Dc) 部署在 Azure 虛擬機器中的現有複本的大小寫內部部署公司網域/樹系，然後可以比照使用 hello 來處理 hello Azure 部署相同的方式可能會將任何其他額外的 Windows Server Active Directory 站台。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-139">For example, in hello case of Windows Server AD DS, if hello domain controllers (DCs) that you deploy on Azure virtual machines are replicas in an existing on-premises corporate domain/forest, then hello Azure deployment can largely be treated in hello same way as you might treat any other additional Windows Server Active Directory site.</span></span> <span data-ttu-id="6e8b5-140">也就是子網路必須定義在 Windows Server AD DS 中，為建立網站、 hello 子網路連結 toothat 網站和連接 tooother 站台使用適當的站台連結。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-140">That is, subnets must be defined in Windows Server AD DS, a site created, hello subnets linked toothat site, and connected tooother sites using appropriate site-links.</span></span> <span data-ttu-id="6e8b5-141">有，不過，有些差異，包括一般 tooall Azure 部署，而某些則可改變相應 toohello 特定部署案例。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-141">There are, however, some differences that are common tooall Azure deployments and some that vary according toohello specific deployment scenario.</span></span> <span data-ttu-id="6e8b5-142">兩個基本差異如下所列︰</span><span class="sxs-lookup"><span data-stu-id="6e8b5-142">Two fundamental differences are outlined below:</span></span>

### <a name="azure-virtual-machines-may-need-connectivity-toohello-on-premises-corporate-network"></a><span data-ttu-id="6e8b5-143">連線 toohello 在內部部署公司網路時，可能需要 azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-143">Azure virtual machines may need connectivity toohello on-premises corporate network.</span></span>
<span data-ttu-id="6e8b5-144">連接 Azure 虛擬機器回復 tooan 內部公司網路需要 Azure 虛擬網路，其中包含網站-站台或站對點虛擬私人網路 (VPN) 元件無法 tooseamlessly 連接 Azure 虛擬機器和在內部部署機器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-144">Connecting Azure virtual machines back tooan on-premises corporate network requires Azure virtual network, which includes a site-to-site or site-to-point virtual private network (VPN) component able tooseamlessly connect Azure virtual machines and on-premises machines.</span></span> <span data-ttu-id="6e8b5-145">這個 VPN 元件也可讓內部部署網域成員電腦 tooaccess Windows Server Active Directory 網域的網域控制站會獨家裝載於 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-145">This VPN component could also enable on-premises domain member computers tooaccess a Windows Server Active Directory domain whose domain controllers are hosted exclusively on Azure virtual machines.</span></span> <span data-ttu-id="6e8b5-146">重要 toonote，不過，如果 hello VPN 失敗、 驗證和其他作業，取決於 Windows Server Active Directory 也會失敗。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-146">It is important toonote, though, that if hello VPN fails, authentication and other operations that depend on Windows Server Active Directory will also fail.</span></span> <span data-ttu-id="6e8b5-147">使用者可能無法 toosign 中使用現有的快取的認證，所有點對點或尚未 toobe 發出，或已經過時，有哪些票證的用戶端對伺服器驗證嘗試時將會失敗。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-147">While users may be able toosign in using existing cached credentials, all peer-to-peer or client-to-server authentication attempts for which tickets have yet toobe issued or have become stale will fail.</span></span>

<span data-ttu-id="6e8b5-148">請參閱[虛擬網路](http://azure.microsoft.com/documentation/services/virtual-network/)如需觀看示範影片以及逐步教學課程，包括清單[hello Azure 入口網站中設定站對站 VPN](../vpn-gateway/vpn-gateway-site-to-site-create.md)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-148">See [Virtual Network](http://azure.microsoft.com/documentation/services/virtual-network/) for a demonstration video and a list of step-by-step tutorials, including [Configure a Site-to-Site VPN in hello Azure portal](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>

> [!NOTE]
> <span data-ttu-id="6e8b5-149">您也可以未連接內部部署網路的 Azure 虛擬網路上部署 Windows Server Active Directory。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-149">You can also deploy Windows Server Active Directory on an Azure virtual network that does not have connectivity with an on-premises network.</span></span> <span data-ttu-id="6e8b5-150">但是，本主題中的 hello 指導方針會假設使用 Azure 虛擬網路，因為它會提供 IP 定址功能所不可或缺的 tooWindows 伺服器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-150">hello guidelines in this topic, however, assume that an Azure virtual network is used because it provides IP addressing capabilities that are essential tooWindows Server.</span></span>
> 
> 

### <a name="static-ip-addresses-must-be-configured-with-azure-powershell"></a><span data-ttu-id="6e8b5-151">必須使用 Azure PowerShell 設定靜態 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-151">Static IP addresses must be configured with Azure PowerShell.</span></span>
<span data-ttu-id="6e8b5-152">動態位址會依預設，會配置，但改為使用 hello Set-azurestaticvnetip cmdlet tooassign 靜態 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-152">Dynamic addresses are allocated by default, but use hello Set-AzureStaticVNetIP cmdlet tooassign a static IP address instead.</span></span> <span data-ttu-id="6e8b5-153">這樣會設定靜態 IP 位址，在服務修復和 VM 關機/重新啟動期間是持續性的。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-153">That sets a static IP address that will persist through service healing and VM shutdown/restart.</span></span> <span data-ttu-id="6e8b5-154">如需詳細資訊，請參閱 [虛擬機器的靜態內部 IP 位址](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-154">For more information, see [Static internal IP address for virtual machines](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/).</span></span>

## <span data-ttu-id="6e8b5-155"><a name="BKMK_Glossary"></a>詞彙和定義</span><span class="sxs-lookup"><span data-stu-id="6e8b5-155"><a name="BKMK_Glossary"></a>Terms and definitions</span></span>
<span data-ttu-id="6e8b5-156">hello 以下是適用於各種 Azure 技術，將在本文中參考詞彙的非完整清單。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-156">hello following is a non-exhaustive list of terms for various Azure technologies which will be referenced in this article.</span></span>

* <span data-ttu-id="6e8b5-157">**Azure 虛擬機器**: hello 的 IaaS 方案可讓客戶幾乎執行任何傳統式 toodeploy Vm 的 Azure 中內部部署伺服器工作負載。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-157">**Azure virtual machines**: hello IaaS offering in Azure that allows customers toodeploy VMs running nearly any traditionally on-premises server workload.</span></span>
* <span data-ttu-id="6e8b5-158">**Azure 虛擬網路**: hello 網路可讓客戶建立及管理 Azure 中的虛擬網路和安全地連結的 Azure 服務 tootheir 自己內部部署網路基礎結構使用虛擬私人網路 (VPN)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-158">**Azure virtual network**: hello networking service in Azure that lets customers create and manage virtual networks in Azure and securely link them tootheir own on-premises networking infrastructure by using a virtual private network (VPN).</span></span>
* <span data-ttu-id="6e8b5-159">**虛擬 IP 位址**： 面對網際網路的 IP 位址未繫結的 tooa 特定電腦或網路介面卡。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-159">**Virtual IP address**: An internet-facing IP address that is not bound tooa specific computer or network interface card.</span></span> <span data-ttu-id="6e8b5-160">接收網路流量，也就是重新導向的 tooan Azure VM 的虛擬 IP 位址會指派給雲端服務。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-160">Cloud services are assigned a virtual IP address for receiving network traffic which is redirected tooan Azure VM.</span></span> <span data-ttu-id="6e8b5-161">虛擬 IP 位址是雲端服務的屬性，該雲端服務可包含一或多個 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-161">A virtual IP address is a property of a cloud-service which can contain one or more Azure virtual machines.</span></span> <span data-ttu-id="6e8b5-162">另外請注意，Azure 虛擬網路可以包含一或多個雲端服務。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-162">Also note that an Azure virtual network can contain one or more cloud-services.</span></span> <span data-ttu-id="6e8b5-163">虛擬 IP 位址提供原生負載平衡功能。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-163">Virtual IP addresses provide native load-balancing capabilities.</span></span>
* <span data-ttu-id="6e8b5-164">**動態 IP 位址**： 這是僅供內部的 hello IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-164">**Dynamic IP address**: This is hello IP address that is internal only.</span></span> <span data-ttu-id="6e8b5-165">它應該設定為靜態 IP 位址 （透過使用 hello Set-azurestaticvnetip cmdlet） 的主控 hello DC/DNS 伺服器角色的 Vm。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-165">It should be configured as a static IP address (by using hello Set-AzureStaticVNetIP cmdlet) for VMs that host hello DC/DNS server roles.</span></span>
* <span data-ttu-id="6e8b5-166">**服務修復**: hello 程序所在 Azure 會自動將傳回服務 tooa 狀態執行一次之後偵測到該 hello 服務失敗。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-166">**Service healing**: hello process in which Azure automatically returns a service tooa running state again after it detects that hello service has failed.</span></span> <span data-ttu-id="6e8b5-167">服務修復是 Azure 支援可用性和恢復功能的 hello 層面的其中一個。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-167">Service healing is one of hello aspects of Azure that supports availability and resiliency.</span></span> <span data-ttu-id="6e8b5-168">雖然不太可能，服務在 VM 上執行之 dc 修復事件之後的 hello 結果類似 tooan 未計畫重新開機，但有一些副作用：</span><span class="sxs-lookup"><span data-stu-id="6e8b5-168">While unlikely, hello result following a service healing incident for a DC running on a VM is similar tooan unplanned reboot, but has a few side-effects:</span></span>
  
  * <span data-ttu-id="6e8b5-169">hello hello VM 中的虛擬網路介面卡將會變更</span><span class="sxs-lookup"><span data-stu-id="6e8b5-169">hello virtual network adapter in hello VM will change</span></span>
  * <span data-ttu-id="6e8b5-170">hello hello 虛擬網路介面卡的 MAC 位址會變更</span><span class="sxs-lookup"><span data-stu-id="6e8b5-170">hello MAC address of hello virtual network adapter will change</span></span>
  * <span data-ttu-id="6e8b5-171">hello hello VM 的處理器 /CPU 識別碼將會變更</span><span class="sxs-lookup"><span data-stu-id="6e8b5-171">hello Processor/CPU ID of hello VM will change</span></span>
  * <span data-ttu-id="6e8b5-172">hello hello 虛擬網路介面卡的 IP 設定不會變更，只要 hello VM 是附加的 tooa 虛擬網路並 hello VM 的 IP 位址是靜態的。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-172">hello IP configuration of hello virtual network adapter will not change as long as hello VM is attached tooa virtual network and hello VM’s IP address is static.</span></span>
  
  <span data-ttu-id="6e8b5-173">但是，這些行為會影響 Windows Server Active Directory，因為它有不相依於 hello MAC 位址或處理器 /CPU 識別碼，且在 Azure 上的所有 Windows Server Active Directory 部署都建議 toobe 如上面所述，在 Azure 虛擬網路上執行.</span><span class="sxs-lookup"><span data-stu-id="6e8b5-173">None of these behaviors affect Windows Server Active Directory because it has no dependency on hello MAC address or Processor/CPU ID, and all Windows Server Active Directory deployments on Azure are recommended toobe run on an Azure virtual network as outlined above.</span></span>

## <a name="is-it-safe-toovirtualize-windows-server-active-directory-domain-controllers"></a><span data-ttu-id="6e8b5-174">它是安全的 toovirtualize Windows Server Active Directory 網域控制站嗎？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-174">Is it safe toovirtualize Windows Server Active Directory domain controllers?</span></span>
<span data-ttu-id="6e8b5-175">Azure 虛擬機器上部署 Windows Server Active Directory Dc 是主體 toohello 做為內部部署執行網域控制站上的虛擬機器中的相同指導方針。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-175">Deploying Windows Server Active Directory DCs on Azure virtual machines is subject toohello same guidelines as running DCs on-premises in a virtual machine.</span></span> <span data-ttu-id="6e8b5-176">只要遵循備份和還原 DC 的指導方針，那麼執行虛擬化 DC 是安全的作法。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-176">Running virtualized DCs is a safe practice as long as guidelines for backing up and restoring DCs are followed.</span></span> <span data-ttu-id="6e8b5-177">如需執行虛擬化 DC 的條件約束和指導方針的詳細資訊，請參閱 [在 Hyper-V 中執行網域控制站](https://technet.microsoft.com/library/dd363553)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-177">For more information about constraints and guidelines for running virtualized DCs, see [Running Domain Controllers in Hyper-V](https://technet.microsoft.com/library/dd363553).</span></span>

<span data-ttu-id="6e8b5-178">Hypervisor 提供或忽略技術，可能會造成許多分散式系統的問題，包括 Windows Server Active Directory。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-178">Hypervisors provide or trivialize technologies that can cause problems for many distributed systems, including Windows Server Active Directory.</span></span> <span data-ttu-id="6e8b5-179">比方說，在實體伺服器上，您可以複製磁碟，或使用不受支援的方法 tooroll 後 hello 狀態伺服器，包括使用 San 等等，但這麼做可在實體伺服器上會比還原中 」 的 hypervisor 的虛擬機器快照集困難得多。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-179">For example, on a physical server, you can clone a disk or use unsupported methods tooroll back hello state of a server, including using SANs and so on, but doing that on a physical server is much harder than restoring a virtual machine snapshot in a hypervisor.</span></span> <span data-ttu-id="6e8b5-180">Azure 提供的功能可能會導致 hello 相同，讓人困擾的狀況。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-180">Azure offers functionality that can result in hello same undesirable condition.</span></span> <span data-ttu-id="6e8b5-181">例如，您不應該複製 Dc 的 VHD 檔案取代正常備份因為還原這些可能導致類似的情況下 toousing 快照集還原功能。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-181">For example, you should not copy VHD files of DCs instead of performing regular backups because restoring them can result in a similar situation toousing snapshot restore features.</span></span>

<span data-ttu-id="6e8b5-182">這類回復會引進 USN 泡沫可能導致 Dc 之間的 toopermanently 但內容不同的狀態。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-182">Such rollbacks introduce USN bubbles that can lead toopermanently divergent states between DCs.</span></span> <span data-ttu-id="6e8b5-183">這可能會導致以下問題︰</span><span class="sxs-lookup"><span data-stu-id="6e8b5-183">That can cause issues such as:</span></span>

* <span data-ttu-id="6e8b5-184">停留物件</span><span class="sxs-lookup"><span data-stu-id="6e8b5-184">Lingering objects</span></span>
* <span data-ttu-id="6e8b5-185">密碼不一致</span><span class="sxs-lookup"><span data-stu-id="6e8b5-185">Inconsistent passwords</span></span>
* <span data-ttu-id="6e8b5-186">屬性值不一致</span><span class="sxs-lookup"><span data-stu-id="6e8b5-186">Inconsistent attribute values</span></span>
* <span data-ttu-id="6e8b5-187">如果回復 hello 架構主機的架構不相符</span><span class="sxs-lookup"><span data-stu-id="6e8b5-187">Schema mismatches if hello schema master is rolled back</span></span>

<span data-ttu-id="6e8b5-188">如需 DC 如何受到影響的詳細資訊，請參閱 [USN 和 USN 回復](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv.aspx#usn_and_usn_rollback)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-188">For more information about how DCs are impacted, see [USN and USN Rollback](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv.aspx#usn_and_usn_rollback).</span></span>

<span data-ttu-id="6e8b5-189">從 Windows Server 2012，開始[tooAD DS 內建額外的保護措施](https://technet.microsoft.com/library/hh831734.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-189">Beginning with Windows Server 2012, [additional safeguards are built in tooAD DS](https://technet.microsoft.com/library/hh831734.aspx).</span></span> <span data-ttu-id="6e8b5-190">這些保護，可協助保護虛擬的網域控制站針對 hello 上述問題，只要基礎 hypervisor 平台 hello 支援-VM 世代識別碼。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-190">These safeguards help protect virtualized domain controllers against hello aforementioned problems, as long as hello underlying hypervisor platform supports VM-GenerationID.</span></span> <span data-ttu-id="6e8b5-191">Azure 支援 Vm-generationid，這表示執行 Windows Server 2012 或更新版本的 Azure 虛擬機器的網域控制站具有 hello 額外的保護措施。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-191">Azure supports VM-GenerationID, which means that domain controllers that run Windows Server 2012 or later on Azure virtual machines have hello additional safeguards.</span></span>

> [!NOTE]
> <span data-ttu-id="6e8b5-192">您應該關閉並重新啟動 VM 在 Azure 中執行 hello 網域控制站角色在 hello 客體作業系統，而不是使用 hello**關機**hello Azure porta 中的選項。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-192">You should shut down and restart a VM that runs hello domain controller role in Azure within hello guest operating system instead of using hello **Shut Down** option in hello Azure porta.</span></span> <span data-ttu-id="6e8b5-193">現在，使用 hello 入口 tooshut 關閉 VM 會造成 hello VM toobe 取消配置。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-193">Today, using hello portal tooshut down a VM causes hello VM toobe deallocated.</span></span> <span data-ttu-id="6e8b5-194">取消配置的 VM 具有 hello 優點不會產生費用，但它也會重設 hello Vm-generationid，這是不想要針對網域控制站。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-194">A deallocated VM has hello advantage of not incurring charges, but it also resets hello VM-GenerationID, which is undesirable for a DC.</span></span> <span data-ttu-id="6e8b5-195">重設 hello-VM 世代識別碼，則當 hello hello AD DS 資料庫的 invocationID 也會重設、，捨棄 RID 集區 hello 和 SYSVOL 會標示為非系統授權。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-195">When hello VM-GenerationID is reset, hello invocationID of hello AD DS database is also reset, hello RID pool is discarded, and SYSVOL is marked as non-authoritative.</span></span> <span data-ttu-id="6e8b5-196">如需詳細資訊，請參閱[簡介 tooActive Directory 網域服務 (AD DS) 虛擬化](https://technet.microsoft.com/library/hh831734.aspx)和[安全地虛擬化 DFSR](http://blogs.technet.com/b/filecab/archive/2013/04/05/safely-virtualizing-dfsr.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-196">For more information, see [Introduction tooActive Directory Domain Services (AD DS) Virtualization](https://technet.microsoft.com/library/hh831734.aspx) and [Safely Virtualizing DFSR](http://blogs.technet.com/b/filecab/archive/2013/04/05/safely-virtualizing-dfsr.aspx).</span></span>
> 
> 

## <a name="why-deploy-windows-server-ad-ds-on-azure-virtual-machines"></a><span data-ttu-id="6e8b5-197">為什麼要在 Azure 虛擬機器上部署 Windows Server AD DS？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-197">Why deploy Windows Server AD DS on Azure Virtual Machines?</span></span>
<span data-ttu-id="6e8b5-198">許多 Windows Server AD DS 部署案例都非常適合部署為 Azure 上的 VM。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-198">Many Windows Server AD DS deployment scenarios are well-suited for deployment as VMs on Azure.</span></span> <span data-ttu-id="6e8b5-199">例如，假設您有需要 tooauthenticate 使用者在亞洲遠端位置的歐洲的公司。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-199">For example, suppose you have a company in Europe that needs tooauthenticate users in a remote location in Asia.</span></span> <span data-ttu-id="6e8b5-200">hello 公司尚未先前部署 Windows Server Active Directory Dc 亞洲到期 toohello 成本 toodeploy 它們且最有限的專業知識 toomanage hello 伺服器後置部署。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-200">hello company has not previously deployed Windows Server Active Directory DCs in Asia due toohello cost toodeploy them and limited expertise toomanage hello servers post-deployment.</span></span> <span data-ttu-id="6e8b5-201">如此一來，來自亞洲的驗證要求會由在歐洲的 DC 提供服務，結果不理想。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-201">As a result, authentication requests from Asia are serviced by DCs in Europe with suboptimal results.</span></span> <span data-ttu-id="6e8b5-202">在此情況下，您可以部署在您已經指定必須在 hello 於亞洲 Azure 資料中心內執行的 VM 上的 DC。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-202">In this case, you can deploy a DC on a VM that you have specified must be run within hello Azure datacenter in Asia.</span></span> <span data-ttu-id="6e8b5-203">附加該 DC tooan toohello 遠端位置將會提高驗證效能直接連接的 Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-203">Attaching that DC tooan Azure virtual network that is connected directly toohello remote location will improve authentication performance.</span></span>

<span data-ttu-id="6e8b5-204">Azure 也非常適合做為替代 toootherwise 高成本的災害復原 (DR) 站台的。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-204">Azure is also well-suited as a substitute toootherwise costly disaster recovery (DR) sites.</span></span> <span data-ttu-id="6e8b5-205">hello 以成本相對低的裝載少量的網域控制站和單一虛擬網路在 Azure 上的代表具吸引力的替代方案。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-205">hello relatively low-cost of hosting a small number of domain controllers and a single virtual network on Azure represents an attractive alternative.</span></span>

<span data-ttu-id="6e8b5-206">最後，您可能想 toodeploy 在 Azure 上，例如 SharePoint，需要 Windows Server Active Directory，但是並沒有相依性 hello 在內部部署網路或 hello 公司 Windows Server Active Directory 的網路應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-206">Finally, you may want toodeploy a network application on Azure, such as SharePoint, that requires Windows Server Active Directory but has no dependency on hello on-premises network or hello corporate Windows Server Active Directory.</span></span> <span data-ttu-id="6e8b5-207">在此情況下，部署隔離的樹系上 Azure toomeet hello SharePoint 伺服器的要求是最佳作法。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-207">In this case, deploying an isolated forest on Azure toomeet hello SharePoint server’s requirements is optimal.</span></span> <span data-ttu-id="6e8b5-208">同樣地，也支援部署需要連線 toohello 內部網路以及 hello 公司 Active Directory 的網路應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-208">Again, deploying network applications that do require connectivity toohello on-premises network and hello corporate Active Directory is also supported.</span></span>

> [!NOTE]
> <span data-ttu-id="6e8b5-209">它會提供 layer-3 連接，因為 hello VPN 元件，可提供 Azure 虛擬網路與內部部署網路之間的連線也可以啟用的成員伺服器來執行在 Azure 執行做為 Azure 虛擬機器的內部部署 tooleverage Dc虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-209">Since it provides a layer-3 connection, hello VPN component that provides connectivity between an Azure virtual network and an on-premises network can also enable member servers that run on-premises tooleverage DCs that run as Azure virtual machines on Azure virtual network.</span></span> <span data-ttu-id="6e8b5-210">但如果無法使用 hello VPN 時，之間通訊的內部電腦並以 Azure 為基礎的網域控制站將無法運作，導致驗證和其他各種錯誤發生。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-210">But if hello VPN is unavailable, communication between on-premises computers and Azure-based domain controllers will not function, resulting in authentication and various other errors.</span></span>  
> 
> 

## <a name="contrasts-between-deploying-windows-server-active-directory-domain-controllers-on-azure-virtual-machines-versus-on-premises"></a><span data-ttu-id="6e8b5-211">在 Azure 虛擬機器上與在內部部署上部署 Windows Server Active Directory 網域控制站之間的對照</span><span class="sxs-lookup"><span data-stu-id="6e8b5-211">Contrasts between deploying Windows Server Active Directory domain controllers on Azure Virtual Machines versus on-premises</span></span>
* <span data-ttu-id="6e8b5-212">包含多部 vm 的任何 Windows Server Active Directory 部署案例，則是必要的 toouse Azure 虛擬網路 IP 位址一致性。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-212">For any Windows Server Active Directory deployment scenario that includes more than a single VM, it is necessary toouse an Azure virtual network for IP address consistency.</span></span> <span data-ttu-id="6e8b5-213">請注意，本指南假設 DC 在 Azure 虛擬網路上執行。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-213">Note that this guide assumes that DCs are running on an Azure virtual network.</span></span>
* <span data-ttu-id="6e8b5-214">如同內部部署 DC，建議使用靜態 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-214">As with on-premises DCs, static IP addresses are recommended.</span></span> <span data-ttu-id="6e8b5-215">靜態 IP 位址只能使用 Azure PowerShell 進行設定。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-215">A static IP address can only be configured by using Azure PowerShell.</span></span> <span data-ttu-id="6e8b5-216">如需詳細資訊，請參閱 [VM 的靜態內部 IP 位址](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/) 。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-216">See [Static internal IP address for VMs](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/) for more details.</span></span> <span data-ttu-id="6e8b5-217">如果您有監控系統或其他解決方案會檢查為 hello 客體作業系統內的靜態 IP 位址組態，您可以指派 hello 相同 IP 位址 toohello 網路介面卡的靜態屬性 hello VM。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-217">If you have monitoring systems or other solutions that check for static IP address configuration within hello guest operating system, you can assign hello same static IP address toohello network adapter properties of hello VM.</span></span> <span data-ttu-id="6e8b5-218">但是請注意如果 hello VM 經歷了服務修復或 hello 入口網站中關閉，而且已為其位址取消配置，將會捨棄該 hello 網路介面卡。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-218">But be aware that hello network adapter will be discarded if hello VM undergoes service healing or is shut down in hello portal and has its address deallocated.</span></span> <span data-ttu-id="6e8b5-219">在此情況下，hello 客體內 hello 靜態 IP 位址必須 toobe 重設。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-219">In that case, hello static IP address within hello guest will need toobe reset.</span></span>
* <span data-ttu-id="6e8b5-220">虛擬網路上部署 Vm 不表示 （或要求） 連線後 tooan 在內部部署網路。hello 虛擬網路只會啟用以排除這個可能性。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-220">Deploying VMs on a virtual network does not imply (or require) connectivity back tooan on-premises network; hello virtual network merely enables that possibility.</span></span> <span data-ttu-id="6e8b5-221">您必須建立虛擬網路以在 Azure 和您的內部部署網路之間進行私密通訊。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-221">You must create a virtual network for private communication between Azure and your on-premises network.</span></span> <span data-ttu-id="6e8b5-222">您需要 toodeploy hello 與內部網路的 VPN 端點。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-222">You need toodeploy a VPN endpoint on hello on-premises network.</span></span> <span data-ttu-id="6e8b5-223">從 Azure toohello 在內部部署網路開啟 hello VPN。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-223">hello VPN is opened from Azure toohello on-premises network.</span></span> <span data-ttu-id="6e8b5-224">如需詳細資訊，請參閱[虛擬網路概觀](../virtual-network/virtual-networks-overview.md)和[hello Azure 入口網站中設定站對站 VPN](../vpn-gateway/vpn-gateway-site-to-site-create.md)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-224">For more information, see [Virtual Network Overview](../virtual-network/virtual-networks-overview.md) and [Configure a Site-to-Site VPN in hello Azure Portal](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>

> [!NOTE]
> <span data-ttu-id="6e8b5-225">選項太[建立點對站 VPN](../vpn-gateway/vpn-gateway-point-to-site-create.md)是可用 tooconnect 個別的 Windows 電腦直接 tooan Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-225">An option too[create a point-to-site VPN](../vpn-gateway/vpn-gateway-point-to-site-create.md) is available tooconnect individual Windows-based computers directly tooan Azure virtual network.</span></span>
> 
> 

* <span data-ttu-id="6e8b5-226">不論您是否建立虛擬網路，Azure 會針對輸出流量計費，而不會對輸入流量計費。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-226">Regardless of whether you create a virtual network or not, Azure charges for egress traffic but not ingress.</span></span> <span data-ttu-id="6e8b5-227">不同的 Windows Server Active Directory 設計選擇會影響部署產生的輸出流量。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-227">Various Windows Server Active Directory design choices can affect how much egress traffic is generated by a deployment.</span></span> <span data-ttu-id="6e8b5-228">例如，部署唯讀網域控制站 (RODC) 會限制輸出流量，因為它不會複寫輸出。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-228">For example, deploying a read-only domain controller (RODC) limits egress traffic because it does not replicate outbound.</span></span> <span data-ttu-id="6e8b5-229">但 hello 決策 toodeploy RODC 必須權衡 hello 需要 tooperform toobe 寫入作業對 hello DC 和 hello[相容性](https://technet.microsoft.com/library/cc755190)應用程式和服務 hello 站台中有 Rodc。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-229">But hello decision toodeploy an RODC needs toobe weighed against hello need tooperform write operations against hello DC and hello [compatibility](https://technet.microsoft.com/library/cc755190) that applications and services in hello site have with RODCs.</span></span> <span data-ttu-id="6e8b5-230">如需流量費用的詳細資訊，請參閱 [Azure 價格一覽](http://azure.microsoft.com/pricing/)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-230">For more information about traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>
* <span data-ttu-id="6e8b5-231">雖然您可以完全控制哪些伺服器資源 toouse，Vm 內部部署，如 RAM、 磁碟大小等等，透過在 Azure 上您必須從選取的預先設定的伺服器規模清單。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-231">While you have complete control over what server resources toouse for VMs on-premises, such as RAM, disk size, and so on, on Azure you must select from a list of preconfigured server sizes.</span></span> <span data-ttu-id="6e8b5-232">對於 DC 而言順序 toostore hello Windows Server Active Directory 資料庫中的加法 toohello 作業系統磁碟中需要的資料磁碟。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-232">For a DC, a data disk is needed in addition toohello operating system disk in order toostore hello Windows Server Active Directory database.</span></span>

## <a name="can-you-deploy-windows-server-ad-fs-on-azure-virtual-machines"></a><span data-ttu-id="6e8b5-233">是否可以在 Azure 虛擬機器上部署 Windows Server AD FS？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-233">Can you deploy Windows Server AD FS on Azure virtual machines?</span></span>
<span data-ttu-id="6e8b5-234">是，您可以部署在 Azure 的虛擬機器上的 Windows Server AD FS 和 hello [AD FS 部署的最佳做法](https://technet.microsoft.com/library/dn151324.aspx)內部同樣適 tooAD FS 部署在 Azure 上。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-234">Yes, you can deploy Windows Server AD FS on Azure virtual machines, and hello [best practices for AD FS deployment](https://technet.microsoft.com/library/dn151324.aspx) on-premises apply equally tooAD FS deployment on Azure.</span></span> <span data-ttu-id="6e8b5-235">但有些 hello 最佳作法，例如負載平衡和高可用性需要超越 AD FS 本身提供的技術。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-235">But some of hello best practices such as load balancing and high availability require technologies beyond what AD FS offers itself.</span></span> <span data-ttu-id="6e8b5-236">它們必須由 hello 基礎結構提供。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-236">They must be provided by hello underlying infrastructure.</span></span> <span data-ttu-id="6e8b5-237">讓我們複習這些最佳作法，並且使用 Azure VM 和 Azure 虛擬網路來查看如何達成。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-237">Let’s review some of those best practices and see how they can be achieved by using Azure VMs and an Azure virtual network.</span></span>

1. <span data-ttu-id="6e8b5-238">**絕不能公開安全性權杖服務 (STS) 伺服器直接 toohello 網際網路。**</span><span class="sxs-lookup"><span data-stu-id="6e8b5-238">**Never expose security token service (STS) servers directly toohello Internet.**</span></span>
   
    <span data-ttu-id="6e8b5-239">這是很重要，因為 hello STS 發出安全性權杖。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-239">This is important because hello STS issues security tokens.</span></span> <span data-ttu-id="6e8b5-240">如此一來，STS 伺服器例如 AD FS 伺服器應視為與 hello 相同層級的保護，做為網域控制站。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-240">As a result, STS servers such as AD FS servers should be treated with hello same level of protection as a domain controller.</span></span> <span data-ttu-id="6e8b5-241">如果犧牲 STS，惡意使用者有可能包含宣告其選擇的 toorelying 合作對象應用程式和其他 STS 伺服器信任組織中的 hello 能力 tooissue 存取權杖。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-241">If an STS is compromised, malicious users have hello ability tooissue access tokens potentially containing claims of their choosing toorelying party applications and other STS servers in trusting organizations.</span></span>
2. <span data-ttu-id="6e8b5-242">**部署 hello 做為 hello AD FS 伺服器相同網路中的所有使用者網域的 Active Directory 網域控制的站。**</span><span class="sxs-lookup"><span data-stu-id="6e8b5-242">**Deploy Active Directory domain controllers for all user domains in hello same network as hello AD FS servers.**</span></span>
   
    <span data-ttu-id="6e8b5-243">AD FS 伺服器使用 Active Directory 網域服務 tooauthenticate 使用者。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-243">AD FS servers use Active Directory Domain Services tooauthenticate users.</span></span> <span data-ttu-id="6e8b5-244">建議 toodeploy hello 與 hello AD FS 伺服器相同網路上的網域控制站。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-244">It is recommended toodeploy domain controllers on hello same network as hello AD FS servers.</span></span> <span data-ttu-id="6e8b5-245">這會提供業務續航力 hello 之間的連結 hello Azure 網路，而且在內部部署網路已中斷，並且可縮短延遲和提高登入的效能。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-245">This provides business continuity in case hello link between hello Azure network and your on-premises network is broken, and enables lower latency and increased performance for logins.</span></span>
3. <span data-ttu-id="6e8b5-246">**部署高可用性以及平衡 hello 負載的多個 AD FS 節點。**</span><span class="sxs-lookup"><span data-stu-id="6e8b5-246">**Deploy multiple AD FS nodes for high availability and balancing hello load.**</span></span>
   
    <span data-ttu-id="6e8b5-247">在大部分情況下，AD FS 啟用的應用程式的 hello 失敗是無法接受的因為需要安全性權杖通常的 hello 應用程式非常關鍵。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-247">In most cases, hello failure of an application that AD FS enables is unacceptable because hello applications that require security tokens are often mission critical.</span></span> <span data-ttu-id="6e8b5-248">如此一來，而且 AD FS 此時存在於 hello 徑 tooaccessing 關鍵任務應用程式中，因為 hello AD FS 服務必須是高可用性，透過多個 AD FS proxy 和 AD FS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-248">As a result, and because AD FS now resides in hello critical path tooaccessing mission critical applications, hello AD FS service must be highly available through multiple AD FS proxies and AD FS servers.</span></span> <span data-ttu-id="6e8b5-249">tooachieve 發佈的要求，負載平衡器通常會 hello AD FS Proxy 和 hello AD FS 伺服器前面進行部署。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-249">tooachieve distribution of requests, load balancers are typically deployed in front of both hello AD FS Proxies and hello AD FS servers.</span></span>
4. <span data-ttu-id="6e8b5-250">**針對網際網路存取部署一或多個 Web 應用程式 Proxy 節點。**</span><span class="sxs-lookup"><span data-stu-id="6e8b5-250">**Deploy one or more Web Application Proxy nodes for internet access.**</span></span>
   
    <span data-ttu-id="6e8b5-251">當使用者需要 tooaccess hello AD FS 服務所保護的應用程式時，hello AD FS 服務的需求 toobe 可從 hello 網際網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-251">When users need tooaccess applications protected by hello AD FS service, hello AD FS service needs toobe available from hello internet.</span></span> <span data-ttu-id="6e8b5-252">這是藉由部署 hello Web 應用程式 Proxy 服務來達成。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-252">This is achieved by deploying hello Web Application Proxy service.</span></span> <span data-ttu-id="6e8b5-253">強烈建議 toodeploy 多個高可用性和負載平衡的 hello 目的的一個節點。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-253">It is strongly recommended toodeploy more than one node for hello purposes of high availability and load balancing.</span></span>
5. <span data-ttu-id="6e8b5-254">**限制從 hello Web 應用程式 Proxy 節點 toointernal 網路資源的存取。**</span><span class="sxs-lookup"><span data-stu-id="6e8b5-254">**Restrict access from hello Web Application Proxy nodes toointernal network resources.**</span></span>
   
    <span data-ttu-id="6e8b5-255">從 tooallow 外部使用者 tooaccess AD FS hello 網際網路，您需要 toodeploy Web 應用程式 Proxy 節點 （或在舊版的 Windows Server AD FS Proxy）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-255">tooallow external users tooaccess AD FS from hello internet, you need toodeploy Web Application Proxy nodes (or AD FS Proxy in earlier versions of Windows Server).</span></span> <span data-ttu-id="6e8b5-256">hello Web 應用程式 proxy 節點會直接公開 toohello 網際網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-256">hello Web Application proxy nodes are directly exposed toohello Internet.</span></span> <span data-ttu-id="6e8b5-257">它們不是必要的 toobe 已加入網域，它們只需要存取 toohello AD FS 伺服器透過 TCP 連接埠 443 和 80。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-257">They are not required toobe domain-joined and they only need access toohello AD FS servers over TCP ports 443 and 80.</span></span> <span data-ttu-id="6e8b5-258">強烈建議該通訊 tooall （尤其是網域控制站） 的其他電腦遭到封鎖。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-258">It is strongly recommended that communication tooall other computers (especially domain controllers) is blocked.</span></span>
   
    <span data-ttu-id="6e8b5-259">這通常是藉由 DMZ 的方式在內部部署達成。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-259">This is typically achieved on-premises by means of a DMZ.</span></span> <span data-ttu-id="6e8b5-260">防火牆會使用作業 toorestrict hello DMZ toohello 與內部網路流量的白名單模式 （亦即，僅流量 hello 從指定的 IP 位址和 over 指定允許的連接埠，而所有其他流量被封鎖）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-260">Firewalls use a whitelist mode of operation toorestrict traffic from hello DMZ toohello on-premises network (that is, only traffic from hello specified IP addresses and over specified ports is allowed, and all other traffic is blocked).</span></span>

<span data-ttu-id="6e8b5-261">hello 下列圖表顯示傳統內部部署 AD FS 部署。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-261">hello following diagram shows a traditional on-premises AD FS deployment.</span></span>

![傳統內部部署 Active Directory Federation Services 部署的圖表](media/active-directory-deploying-ws-ad-guidelines/ADFS_onprem.png)

<span data-ttu-id="6e8b5-263">不過，因為 Azure 不提供原生而功能完整的防火牆功能，其他選項會需要使用 toobe toorestrict 流量。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-263">However, because Azure does not provide native, full-featured firewall capability, other options need toobe used toorestrict traffic.</span></span> <span data-ttu-id="6e8b5-264">hello 下表顯示每個選項及其優點和缺點。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-264">hello following table shows each option and its advantages and disadvantages.</span></span>

| <span data-ttu-id="6e8b5-265">選項</span><span class="sxs-lookup"><span data-stu-id="6e8b5-265">Option</span></span> | <span data-ttu-id="6e8b5-266">優點</span><span class="sxs-lookup"><span data-stu-id="6e8b5-266">Advantage</span></span> | <span data-ttu-id="6e8b5-267">缺點</span><span class="sxs-lookup"><span data-stu-id="6e8b5-267">Disadvantage</span></span> |
| --- | --- | --- |
| [<span data-ttu-id="6e8b5-268">Azure 網路 ACL</span><span class="sxs-lookup"><span data-stu-id="6e8b5-268">Azure network ACLs</span></span>](../virtual-network/virtual-networks-acl.md) |<span data-ttu-id="6e8b5-269">較便宜又簡單的初始組態</span><span class="sxs-lookup"><span data-stu-id="6e8b5-269">Less costly and simpler initial configuration</span></span> |<span data-ttu-id="6e8b5-270">如果任何新的 Vm 會加入 toohello 部署不需要額外的網路 ACL 設定</span><span class="sxs-lookup"><span data-stu-id="6e8b5-270">Additional network ACL configuration required if any new VMs are added toohello deployment</span></span> |
| [<span data-ttu-id="6e8b5-271">Barracuda NG 防火牆</span><span class="sxs-lookup"><span data-stu-id="6e8b5-271">Barracuda NG firewall</span></span>](https://www.barracuda.com/products/ngfirewall) |<span data-ttu-id="6e8b5-272">作業的白名單模式且不需要網路 ACL 組態</span><span class="sxs-lookup"><span data-stu-id="6e8b5-272">Whitelist mode of operation and it requires no network ACL configuration</span></span> |<span data-ttu-id="6e8b5-273">初始設定的增加成本與複雜度</span><span class="sxs-lookup"><span data-stu-id="6e8b5-273">Increased cost and complexity for initial setup</span></span> |

<span data-ttu-id="6e8b5-274">hello 高階步驟 toodeploy AD FS 在此情況下，如下所示如下：</span><span class="sxs-lookup"><span data-stu-id="6e8b5-274">hello high-level steps toodeploy AD FS in this case are as follows:</span></span>

1. <span data-ttu-id="6e8b5-275">使用 VPN 或 [ExpressRoute](http://azure.microsoft.com/services/expressroute/)，建立具有跨單位連線的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-275">Create a virtual network with cross-premises connectivity, using either a VPN or [ExpressRoute](http://azure.microsoft.com/services/expressroute/).</span></span>
2. <span data-ttu-id="6e8b5-276">部署 hello 虛擬網路上的網域控制站。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-276">Deploy domain controllers on hello virtual network.</span></span> <span data-ttu-id="6e8b5-277">此步驟為選用步驟，但建議執行。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-277">This step is optional but recommended.</span></span>
3. <span data-ttu-id="6e8b5-278">部署已加入網域的 AD FS 伺服器 hello 虛擬網路上。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-278">Deploy domain-joined AD FS servers on hello virtual network.</span></span>
4. <span data-ttu-id="6e8b5-279">建立[內部負載平衡集](http://azure.microsoft.com/blog/internal-load-balancing/)，包含 hello AD FS 伺服器，以及使用新的私用 IP 位址在 hello 虛擬網路 （動態 IP 位址）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-279">Create an [internal load balanced set](http://azure.microsoft.com/blog/internal-load-balancing/) that includes hello AD FS servers and uses a new private IP address within hello virtual network (a dynamic IP address).</span></span>
   
   1. <span data-ttu-id="6e8b5-280">更新 DNS toocreate hello FQDN toopoint toohello 私用 （動態） 的 IP 位址的 hello 內部負載平衡集。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-280">Update DNS toocreate hello FQDN toopoint toohello private (dynamic) IP address of hello internal load balanced set.</span></span>
5. <span data-ttu-id="6e8b5-281">建立雲端服務 （或個別的虛擬網路） 的 hello Web 應用程式 Proxy 節點。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-281">Create a cloud service (or a separate virtual network) for hello Web Application Proxy nodes.</span></span>
6. <span data-ttu-id="6e8b5-282">部署 hello hello 雲端服務或虛擬網路中的 Web 應用程式 Proxy 節點</span><span class="sxs-lookup"><span data-stu-id="6e8b5-282">Deploy hello Web Application Proxy nodes in hello cloud service or virtual network</span></span>
   
   1. <span data-ttu-id="6e8b5-283">建立外部負載平衡集，其中包含 hello Web 應用程式 Proxy 節點。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-283">Create an external load balanced set that includes hello Web Application Proxy nodes.</span></span>
   2. <span data-ttu-id="6e8b5-284">更新 hello 外部 DNS 名稱 (FQDN) toopoint toohello 雲端服務公用 IP 位址 （hello 虛擬 IP 位址）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-284">Update hello external DNS name (FQDN) toopoint toohello cloud service public IP address (hello virtual IP address).</span></span>
   3. <span data-ttu-id="6e8b5-285">設定 AD FS proxy toouse hello 對應 toohello 內部負載平衡集 hello AD FS 伺服器的 FQDN。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-285">Configure AD FS proxies toouse hello FQDN that corresponds toohello internal load balanced set for hello AD FS servers.</span></span>
   4. <span data-ttu-id="6e8b5-286">更新宣告式 web 網站 toouse hello 外部 FQDN 用於其宣告提供者。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-286">Update claims-based web sites toouse hello external FQDN for their claims provider.</span></span>
7. <span data-ttu-id="6e8b5-287">限制 Web 應用程式 Proxy tooany 機器 hello AD FS 虛擬網路中的存取權。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-287">Restrict access between Web Application Proxy tooany machine in hello AD FS virtual network.</span></span>

<span data-ttu-id="6e8b5-288">toorestrict 流量 hello hello Azure 內部負載平衡器負載平衡集需要 toobe 設定成只有流量 tooTCP 通訊埠 80 和 443，並捨棄所有其他流量 toohello 內部動態 IP 位址的負載平衡集 hello 訊息。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-288">toorestrict traffic, hello load-balanced set for hello Azure internal load balancer needs toobe configured for only traffic tooTCP ports 80 and 443, and all other traffic toohello internal dynamic IP address of hello load balanced set is dropped.</span></span>

![允許 TCP 443 + 80 的 ADFS 網路 ACL 的圖表。](media/active-directory-deploying-ws-ad-guidelines/ADFS_ACLs.png)

<span data-ttu-id="6e8b5-290">流量 toohello AD FS 伺服器只會允許下列來源的 hello:</span><span class="sxs-lookup"><span data-stu-id="6e8b5-290">Traffic toohello AD FS servers would be permitted only by hello following sources:</span></span>

* <span data-ttu-id="6e8b5-291">hello Azure 內部負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-291">hello Azure internal load balancer.</span></span>
* <span data-ttu-id="6e8b5-292">hello hello 與內部網路上的系統管理員的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-292">hello IP address of an administrator on hello on-premises network.</span></span>

> [!WARNING]
> <span data-ttu-id="6e8b5-293">hello 設計必須防止 Web 應用程式 Proxy 節點 hello Azure 虛擬網路中的其他 Vm 或 hello 與內部網路上的任何位置。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-293">hello design must prevent Web Application Proxy nodes from reaching any other VMs in hello Azure virtual network or any locations on hello on-premises network.</span></span> <span data-ttu-id="6e8b5-294">可以藉由在 hello Express Route 連線的內部部署應用裝置或 hello 站對站 VPN 連線的 VPN 裝置設定防火牆規則來完成。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-294">That can be done by configuring firewall rules in hello on-premises appliance for Express Route connections or hello VPN device for site-to-site VPN connections.</span></span>
> 
> 

<span data-ttu-id="6e8b5-295">缺點 toothis 選項是 hello 需要 tooconfigure hello 網路 Acl 的多個裝置，包括內部負載平衡器、 hello AD FS 伺服器，以及加入 toohello 虛擬網路的任何其他伺服器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-295">A disadvantage toothis option is hello need tooconfigure hello network ACLs for multiple devices, including internal load balancer, hello AD FS servers, and any other servers that get added toohello virtual network.</span></span> <span data-ttu-id="6e8b5-296">如果任何裝置加入 toohello 部署而不需設定網路 Acl toorestrict 流量 tooit，hello 整個部署可能會有風險。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-296">If any device is added toohello deployment without configuring network ACLs toorestrict traffic tooit, hello entire deployment can be at risk.</span></span> <span data-ttu-id="6e8b5-297">如果 hello hello Web 應用程式 Proxy 節點的 IP 位址有所變更，必須重設 hello 網路 Acl (也就是說，hello proxy 應該設定的 toouse[靜態動態 IP 位址](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/))。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-297">If hello IP addresses of hello Web Application Proxy nodes ever change, hello network ACLs must be reset (which means hello proxies should be configured toouse [static dynamic IP addresses](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/)).</span></span>

![使用網路 ACLS 的 Azure 上的 ADFS。](media/active-directory-deploying-ws-ad-guidelines/ADFS_Azure.png)

<span data-ttu-id="6e8b5-299">另一個選項是 toouse hello [Barracuda NG 防火牆](https://www.barracuda.com/products/ngfirewall)應用裝置 toocontrol AD FS proxy 伺服器與 hello AD FS 伺服器之間的流量。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-299">Another option is toouse hello [Barracuda NG Firewall](https://www.barracuda.com/products/ngfirewall) appliance toocontrol traffic between AD FS proxy servers and hello AD FS servers.</span></span> <span data-ttu-id="6e8b5-300">此選項符合安全性和高可用性的最佳作法，而且需要較少的管理 hello 初始安裝之後，因為 hello Barracuda NG 防火牆應用裝置提供防火牆管理的白名單模式，而且可以進行安裝直接在 Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-300">This option complies with best practices for security and high availability, and requires less administration after hello initial setup because hello Barracuda NG Firewall appliance provides a whitelist mode of firewall administration and it can be installed directly on an Azure virtual network.</span></span> <span data-ttu-id="6e8b5-301">新伺服器新增 toohello 部署任何時間排除 hello 需要 tooconfigure 網路 Acl。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-301">That eliminates hello need tooconfigure network ACLs any time a new server is added toohello deployment.</span></span> <span data-ttu-id="6e8b5-302">但是，此選項會增加初始部署的複雜度和成本。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-302">But this option adds initial deployment complexity and cost.</span></span>

<span data-ttu-id="6e8b5-303">在此情況下，會部署兩個虛擬網路而不是一個。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-303">In this case, two virtual networks are deployed instead of one.</span></span> <span data-ttu-id="6e8b5-304">我們稱之為 VNet1 和 VNet2。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-304">We'll call them VNet1 and VNet2.</span></span> <span data-ttu-id="6e8b5-305">VNet1 包含 hello proxy，而 VNet2 包含 Sts hello 與 hello 網路連線後 toohello 公司網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-305">VNet1 contains hello proxies and VNet2 contains hello STSs and hello network connection back toohello corporate network.</span></span> <span data-ttu-id="6e8b5-306">VNet1 因此是實際 （雖然實際上） 對 vnet2 而言，再接著從 hello 公司網路隔離。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-306">VNet1 is therefore physically (albeit virtually) isolated from VNet2 and, in turn, from hello corporate network.</span></span> <span data-ttu-id="6e8b5-307">VNet1 再連接的 tooVNet2 使用已知做為傳輸獨立網路架構 (TINA) 的特殊通道技術。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-307">VNet1 is then connected tooVNet2 using a special tunneling technology known as Transport Independent Network Architecture (TINA).</span></span> <span data-ttu-id="6e8b5-308">hello TINA 通道會使用 Barracuda NG 防火牆 hello 虛擬網路附加的 tooeach — 一個 Barracuda hello 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-308">hello TINA tunnel is attached tooeach of hello virtual networks using a Barracuda NG firewall—one Barracuda on each of hello virtual networks.</span></span>  <span data-ttu-id="6e8b5-309">如需高可用性，建議您部署兩個 Barracuda 上每個虛擬網路。一個使用中，hello 另一個被動。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-309">For high-availability, it is recommended that you deploy two Barracudas on each virtual network; one active, hello other passive.</span></span> <span data-ttu-id="6e8b5-310">它們提供非常豐富的防火牆功能，讓我們的傳統內部部署 DMZ toomimic hello 作業在 Azure 中。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-310">They offer extremely rich firewalling capabilities which allow us toomimic hello operation of a traditional on-premises DMZ in Azure.</span></span>

![使用防火牆的 Azure 上的 ADFS。](media/active-directory-deploying-ws-ad-guidelines/ADFS_Azure_firewall.png)

<span data-ttu-id="6e8b5-312">如需詳細資訊，請參閱[AD FS： 擴充宣告感知的內部部署前端應用程式 toohello 網際網路](#BKMK_CloudOnlyFed)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-312">For more information, see [AD FS: Extend a claims-aware on-premises front-end application toohello Internet](#BKMK_CloudOnlyFed).</span></span>

### <a name="an-alternative-tooad-fs-deployment-if-hello-goal-is-office-365-sso-alone"></a><span data-ttu-id="6e8b5-313">如果 hello 的目標是 Office 365 SSO 時替代 tooAD FS 部署</span><span class="sxs-lookup"><span data-stu-id="6e8b5-313">An alternative tooAD FS deployment if hello goal is Office 365 SSO alone</span></span>
<span data-ttu-id="6e8b5-314">如果您的目標是只 tooenable 登入 Office 365，還有另一個替代 toodeploying AD FS 完全。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-314">There is another alternative toodeploying AD FS altogether if your goal is only tooenable sign-in for Office 365.</span></span> <span data-ttu-id="6e8b5-315">在此情況下，只需使用密碼同步內部部署目錄同步和達到同樣的最終結果 hello 與最低的部署複雜性，因為這種方法不需要 AD FS 或 Azure。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-315">In that case, you can simply deploy DirSync with password sync on-premises and achieve hello same end-result with minimal deployment complexity because this approach does not require AD FS or Azure.</span></span>

<span data-ttu-id="6e8b5-316">hello 下表比較使用和不部署 AD FS，hello 登入處理程序的運作方式。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-316">hello following table compares how hello sign-in processes work with and without deploying AD FS.</span></span>

| <span data-ttu-id="6e8b5-317">使用 AD FS 和 DirSync 的 Office 365 單一登入</span><span class="sxs-lookup"><span data-stu-id="6e8b5-317">Office 365 single sign-on using AD FS and DirSync</span></span> | <span data-ttu-id="6e8b5-318">使用 DirSync + Password Sync 的 Office 365 相同登入</span><span class="sxs-lookup"><span data-stu-id="6e8b5-318">Office 365 same sign-on using DirSync + Password Sync</span></span> |
| --- | --- |
| <span data-ttu-id="6e8b5-319">1.hello 使用者登入時 tooa 公司網路，且驗證的 tooWindows Server Active Directory。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-319">1. hello user logs on tooa corporate network, and is authenticated tooWindows Server Active Directory.</span></span> |<span data-ttu-id="6e8b5-320">1.hello 使用者登入時 tooa 公司網路，且驗證的 tooWindows Server Active Directory。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-320">1. hello user logs on tooa corporate network, and is authenticated tooWindows Server Active Directory.</span></span> |
| <span data-ttu-id="6e8b5-321">2.hello 的使用者嘗試 tooaccess Office 365 (我@contoso.com)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-321">2. hello user tries tooaccess Office 365 (I am @contoso.com).</span></span> |<span data-ttu-id="6e8b5-322">2.hello 的使用者嘗試 tooaccess Office 365 (我@contoso.com)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-322">2. hello user tries tooaccess Office 365 (I am @contoso.com).</span></span> |
| <span data-ttu-id="6e8b5-323">3.Office 365 將重新導向 hello 使用者 tooAzure AD。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-323">3. Office 365 redirects hello user tooAzure AD.</span></span> |<span data-ttu-id="6e8b5-324">3.Office 365 將重新導向 hello 使用者 tooAzure AD。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-324">3. Office 365 redirects hello user tooAzure AD.</span></span> |
| <span data-ttu-id="6e8b5-325">4.Azure AD 無法驗證 hello 使用者及了解 AD FS 內部部署信任，因為它會重新導向 hello 使用者 tooAD FS。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-325">4. Since Azure AD can’t authenticate hello user and understands there is a trust with AD FS on-premises, it redirects hello user tooAD FS.</span></span> |<span data-ttu-id="6e8b5-326">4.Azure AD 不能直接接受 Kerberos 票證，並沒有信任關係存在，因此會要求該 hello 使用者輸入認證。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-326">4. Azure AD can’t accept Kerberos tickets directly and no trust relationship exists so it requests that hello user enter credentials.</span></span> |
| <span data-ttu-id="6e8b5-327">5.hello 使用者傳送 Kerberos 票證 toohello AD FS STS。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-327">5. hello user sends a Kerberos ticket toohello AD FS STS.</span></span> |<span data-ttu-id="6e8b5-328">5.hello 使用者輸入 hello 相同內部部署密碼，且 Azure AD 進行驗證 hello 使用者名稱和密碼以 DirSync 所同步。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-328">5. hello user enters hello same on-premises password, and Azure AD validates them against hello user name and password that was synchronized by DirSync.</span></span> |
| <span data-ttu-id="6e8b5-329">6.AD FS 轉換 Kerberos 票證 toohello 所需的 token 格式/宣告，並將重新導向 hello 使用者 tooAzure AD hello。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-329">6. AD FS transforms hello Kerberos ticket toohello required token format/claims and redirects hello user tooAzure AD.</span></span> |<span data-ttu-id="6e8b5-330">6.Azure AD 會重新導向 hello 使用者 tooOffice 365。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-330">6. Azure AD redirects hello user tooOffice 365.</span></span> |
| <span data-ttu-id="6e8b5-331">7.hello 使用者驗證 tooAzure AD （另一個轉換發生時）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-331">7. hello user authenticates tooAzure AD (another transformation occurs).</span></span> |<span data-ttu-id="6e8b5-332">7.hello 使用者可以登入 tooOffice 365 和 OWA 使用 hello Azure AD 的權杖。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-332">7. hello user can sign in tooOffice 365 and OWA using hello Azure AD token.</span></span> |
| <span data-ttu-id="6e8b5-333">8.Azure AD 會重新導向 hello 使用者 tooOffice 365。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-333">8. Azure AD redirects hello user tooOffice 365.</span></span> | |
| <span data-ttu-id="6e8b5-334">9.hello 使用者是以無訊息模式登入 tooOffice 365。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-334">9. hello user is silently signed on tooOffice 365.</span></span> | |

<span data-ttu-id="6e8b5-335">在 hello Office 365 DirSync 搭配密碼同步案例 (沒有 AD FS)，單一登入已取代 「 相同登入 」 其中 「 相同 」 表示使用者必須重新輸入其相同的內部部署認證存取 Office 365 時。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-335">In hello Office 365 with DirSync with password sync scenario (no AD FS), single sign-on is replaced by “same sign-on” where “same” simply means that users must re-enter their same on-premises credentials when accessing Office 365.</span></span> <span data-ttu-id="6e8b5-336">請注意，可以由 hello 使用者的瀏覽器 toohelp 記住此資料會減少後續提示。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-336">Note that this data can be remembered by hello user’s browser toohelp reduce subsequent prompts.</span></span>

### <a name="additional-food-for-thought"></a><span data-ttu-id="6e8b5-337">其他考量</span><span class="sxs-lookup"><span data-stu-id="6e8b5-337">Additional food for thought</span></span>
* <span data-ttu-id="6e8b5-338">如果您將部署在 Azure 虛擬機器上的 AD FS proxy，則需要連線 toohello AD FS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-338">If you deploy an AD FS proxy on an Azure virtual machine, connectivity toohello AD FS servers is needed.</span></span> <span data-ttu-id="6e8b5-339">如果它們是在內部部署，建議您利用 hello 虛擬網路 tooallow hello Web 應用程式 Proxy 節點 toocommunicate 提供與其 AD FS 伺服器的 hello 站對站 VPN 連線。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-339">If they are on-premises, it is recommended that you leverage hello site-to-site VPN connectivity provided by hello virtual network tooallow hello Web Application Proxy nodes toocommunicate with their AD FS servers.</span></span>
* <span data-ttu-id="6e8b5-340">如果您部署 AD FS 伺服器上的 Azure 虛擬機器，連線 tooWindows Server Active Directory 網域控制站、 屬性存放區和組態資料庫是必要的可能也需要 ExpressRoute 或站對站 VPN 連線之間 hello Azure 虛擬網路和 hello 內部網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-340">If you deploy an AD FS server on an Azure virtual machine, connectivity tooWindows Server Active Directory domain controllers, Attribute Stores, and Configuration databases is necessary and may also require an ExpressRoute or a site-to-site VPN connection between hello Azure virtual network and hello on-premises network.</span></span>
* <span data-ttu-id="6e8b5-341">都需要收取費用 tooall 流量從 Azure 虛擬機器 （輸出流量）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-341">Charges are applied tooall traffic from Azure virtual machines (egress traffic).</span></span> <span data-ttu-id="6e8b5-342">如果成本是 hello 驅動因素，則建議 toodeploy hello Web 應用程式 Proxy 節點，在 Azure 上，而保留 hello AD FS 伺服器在內部。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-342">If cost is hello driving factor, it is advisable toodeploy hello Web Application Proxy nodes on Azure, leaving hello AD FS servers on-premises.</span></span> <span data-ttu-id="6e8b5-343">如果 hello AD FS 伺服器部署在 Azure 虛擬機器上，額外的成本將會產生的 tooauthenticate 內部使用者。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-343">If hello AD FS servers are deployed on Azure virtual machines as well, additional costs will be incurred tooauthenticate on-premises users.</span></span> <span data-ttu-id="6e8b5-344">輸出流量都會產生成本無論周遊 hello ExpressRoute 或 hello VPN 站對站連線。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-344">Egress traffic incurs a cost regardless of whether or not it is traversing hello ExpressRoute or hello VPN site-to-site connection.</span></span>
* <span data-ttu-id="6e8b5-345">如果您決定 toouse Azure 的原生伺服器負載平衡的 AD FS 伺服器的高可用性功能，請注意負載平衡會提供探查，會使用的 toodetermine hello hello hello 雲端服務內的虛擬機器健全狀況。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-345">If you decide toouse Azure’s native server load balancing capabilities for high availability of AD FS servers, note that load balancing provides probes that are used toodetermine hello health of hello virtual machines within hello cloud service.</span></span> <span data-ttu-id="6e8b5-346">在 Azure 虛擬機器 （做為相對於 tooweb 或背景工作角色） 的 hello 情況下，由於 hello 代理程式回應 toohello 預設探查 」 不存在於 Azure 虛擬機器必須使用自訂探查。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-346">In hello case of Azure virtual machines (as opposed tooweb or worker roles), a custom probe must be used since hello agent that responds toohello default probes is not present on Azure virtual machines.</span></span> <span data-ttu-id="6e8b5-347">為了簡單起見，您可以使用自訂 TCP 探查，這只需要 TCP 連線 （TCP SYN 區段傳送及回應 TCP SYN ACK 區段 toowith） 都已成功建立的 toodetermine 虛擬機器健全狀況。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-347">For simplicity, you might use a custom TCP probe — this requires only that a TCP connection (a TCP SYN segment sent and responded toowith a TCP SYN ACK segment) be successfully established toodetermine virtual machine health.</span></span> <span data-ttu-id="6e8b5-348">您可以設定虛擬機器主動接聽任何 TCP 連接埠 toowhich hello 自訂探查 toouse。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-348">You can configure hello custom probe toouse any TCP port toowhich your virtual machines are actively listening.</span></span>

> [!NOTE]
> <span data-ttu-id="6e8b5-349">需要直接 toohello 網際網路 （例如連接埠 80 和 443） 不能共用相同設定的連接埠 tooexpose hello 機器 hello 相同雲端服務。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-349">Machines that need tooexpose hello same set of ports directly toohello Internet (such as port 80 and 443) cannot share hello same cloud service.</span></span> <span data-ttu-id="6e8b5-350">因此，建議您建立專用的雲端服務，如您在順序 tooavoid 潛在 「 Windows Server AD FS 伺服器與應用程式的連接埠需求與 Windows Server AD FS 之間重疊。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-350">It is, therefore, recommended that you create a dedicated cloud service for your Windows Server AD FS servers in order tooavoid potential overlaps between port requirements for an application and Windows Server AD FS.</span></span>
> 
> 

## <a name="deployment-scenarios"></a><span data-ttu-id="6e8b5-351">部署案例</span><span class="sxs-lookup"><span data-stu-id="6e8b5-351">Deployment scenarios</span></span>
<span data-ttu-id="6e8b5-352">下列章節的 hello 概述經常部署案例 toodraw 注意 tooimportant 考量必須納入考量。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-352">hello following section outlines commonplace deployment scenarios toodraw attention tooimportant considerations that must be taken into account.</span></span> <span data-ttu-id="6e8b5-353">每個案例都有關於 hello 決策和因素 tooconsider 連結 toomore 詳細資料。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-353">Each scenario has links toomore details about hello decisions and factors tooconsider.</span></span>

1. [<span data-ttu-id="6e8b5-354">AD DS︰部署 AD DS 感知應用程式，不需要公司網路連接</span><span class="sxs-lookup"><span data-stu-id="6e8b5-354">AD DS: Deploy an AD DS-aware application with no requirement for corporate network connectivity</span></span>](#BKMK_CloudOnly)
   
    <span data-ttu-id="6e8b5-355">例如，網際網路對應 SharePoint 服務會部署在 Azure 虛擬機器上。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-355">For example, an Internet-facing SharePoint service is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="6e8b5-356">hello 應用程式具有公司網路資源的任何相依性。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-356">hello application has no dependencies on corporate-network resources.</span></span> <span data-ttu-id="6e8b5-357">hello 應用程式需要 Windows Server AD DS，但不需要 hello 公司 Windows Server AD DS。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-357">hello application does require Windows Server AD DS but does NOT require hello corporate Windows Server AD DS.</span></span>
2. [<span data-ttu-id="6e8b5-358">AD FS： 擴充宣告感知的內部部署前端應用程式 toohello 網際網路</span><span class="sxs-lookup"><span data-stu-id="6e8b5-358">AD FS: Extend a claims-aware on-premises front-end application toohello Internet</span></span>](#BKMK_CloudOnlyFed)
   
    <span data-ttu-id="6e8b5-359">例如，已成功部署在內部部署而且由公司使用者使用的宣告感知應用程式需要 toobecome hello 網際網路從可以存取。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-359">For example, a claims-aware application that has been successfully deployed on-premises and used by corporate users needs toobecome accessible from hello Internet.</span></span> <span data-ttu-id="6e8b5-360">hello 應用程式需要 toobe 直接透過 hello 網際網路存取，使用自己公司身分識別的商業夥伴和現有公司使用者。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-360">hello application needs toobe accessed directly over hello Internet both by business partners using their own corporate identities and by existing corporate users.</span></span>
3. [<span data-ttu-id="6e8b5-361">AD DS： 部署可感知 Windows Server AD DS 的應用程式需要連接 toohello 公司網路</span><span class="sxs-lookup"><span data-stu-id="6e8b5-361">AD DS: Deploy a Windows Server AD DS-aware application that requires connectivity toohello corporate network</span></span>](#BKMK_HybridExt)
   
    <span data-ttu-id="6e8b5-362">例如，支援 Windows 整合式驗證並使用 Windows Server AD DS 做為組態和使用者設定檔資料儲存機制的 LDAP 感知應用程式，會部署在 Azure 虛擬機器上。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-362">For example, an LDAP-aware application that supports Windows-integrated authentication and uses Windows Server AD DS as a repository for configuration and user-profile data is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="6e8b5-363">它是理想的 hello 應用程式 tooleverage hello 現有公司 Windows Server AD DS，並提供單一登入。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-363">It is desirable for hello application tooleverage hello existing corporate Windows Server AD DS and provide single sign-on.</span></span> <span data-ttu-id="6e8b5-364">無法感知宣告的 hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-364">hello application is not claims-aware.</span></span>

### <span data-ttu-id="6e8b5-365"><a name="BKMK_CloudOnly"></a>1.AD DS︰部署 AD DS 感知應用程式，不需要公司網路連接</span><span class="sxs-lookup"><span data-stu-id="6e8b5-365"><a name="BKMK_CloudOnly"></a>1. AD DS: Deploy an AD DS-aware application with no requirement for corporate network connectivity</span></span>
<span data-ttu-id="6e8b5-366">![僅限雲端的 AD DS 部署](media/active-directory-deploying-ws-ad-guidelines/ADDS_cloud.png)
**圖 1**</span><span class="sxs-lookup"><span data-stu-id="6e8b5-366">![Cloud-only AD DS deployment](media/active-directory-deploying-ws-ad-guidelines/ADDS_cloud.png)
**Figure 1**</span></span>

#### <a name="description"></a><span data-ttu-id="6e8b5-367">說明</span><span class="sxs-lookup"><span data-stu-id="6e8b5-367">Description</span></span>
<span data-ttu-id="6e8b5-368">SharePoint 會部署在 Azure 虛擬機器上而且 hello 應用程式不相依於公司網路資源。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-368">SharePoint is deployed on an Azure virtual machine and hello application has no dependencies on corporate-network resources.</span></span> <span data-ttu-id="6e8b5-369">hello 應用程式需要 Windows Server AD DS，但不會*不*需要 hello 公司 Windows Server AD DS。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-369">hello application does require Windows Server AD DS but does *not* require hello corporate Windows Server AD DS.</span></span> <span data-ttu-id="6e8b5-370">不需要 Kerberos 或同盟的信任，因為使用者可透過 hello hello Windows Server AD DS 網域也裝載於 Azure 虛擬機器上的 hello 雲端應用程式自行佈建。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-370">No Kerberos or federated trusts are required because users are self-provisioned through hello application into hello Windows Server AD DS domain that is also hosted in hello cloud on Azure virtual machines.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-toohello-scenario"></a><span data-ttu-id="6e8b5-371">案例考量以及技術領域如何套用 toohello 案例</span><span class="sxs-lookup"><span data-stu-id="6e8b5-371">Scenario considerations and how technology areas apply toohello scenario</span></span>
* <span data-ttu-id="6e8b5-372">[網路拓撲](#BKMK_NetworkTopology)︰建立 Azure 虛擬網路，而不需要跨單位連線 (也稱為站對站連接)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-372">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network without cross-premises connectivity (also known as site-to-site connectivity).</span></span>
* <span data-ttu-id="6e8b5-373">[DC 部署組態](#BKMK_DeploymentConfig)︰將新的網域控制站部署到新的單一網域 Windows Server Active Directory 樹系。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-373">[DC deployment configuration](#BKMK_DeploymentConfig): Deploy a new domain controller into a new, single-domain, Windows Server Active Directory forest.</span></span> <span data-ttu-id="6e8b5-374">這應該部署以及 hello Windows DNS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-374">This should be deployed along with hello Windows DNS server.</span></span>
* <span data-ttu-id="6e8b5-375">[Windows Server Active Directory 站台拓撲](#BKMK_ADSiteTopology)： 使用 hello 預設 Windows Server Active Directory 站台 （預設值第一個站台名稱將所有的電腦）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-375">[Windows Server Active Directory site topology](#BKMK_ADSiteTopology): Use hello default Windows Server Active Directory site (all computers will be in Default-First-Site-Name).</span></span>
* <span data-ttu-id="6e8b5-376">[IP 位址和 DNS](#BKMK_IPAddressDNS)：</span><span class="sxs-lookup"><span data-stu-id="6e8b5-376">[IP addressing and DNS](#BKMK_IPAddressDNS):</span></span>
  
  * <span data-ttu-id="6e8b5-377">使用 hello Set-azurestaticvnetip Azure PowerShell cmdlet 設定 hello DC 的靜態 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-377">Set a static IP address for hello DC by using hello Set-AzureStaticVNetIP Azure PowerShell cmdlet.</span></span>
  * <span data-ttu-id="6e8b5-378">安裝和設定 Windows Server DNS hello Azure 上的網域控制站。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-378">Install and configure Windows Server DNS on hello domain controller(s) on Azure.</span></span>
  * <span data-ttu-id="6e8b5-379">Hello 名稱和 IP 位址的 hello 裝載 hello DC 和 DNS 伺服器角色的 VM 設定 hello 虛擬網路屬性。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-379">Configure hello virtual network properties with hello name and IP address of hello VM that hosts hello DC and DNS server roles.</span></span>
* <span data-ttu-id="6e8b5-380">[通用類別目錄](#BKMK_GC): hello hello 樹系中的第一個 DC 必須是通用類別目錄伺服器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-380">[Global Catalog](#BKMK_GC): hello first DC in hello forest must be a global catalog server.</span></span> <span data-ttu-id="6e8b5-381">也應該將其他網域控制站設定為 Gc，因為在單一網域樹系 hello 通用類別目錄不需要任何額外的工作，從 hello DC。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-381">Additional DCs should also be configured as GCs because in a single domain forest, hello global catalog does not require any additional work from hello DC.</span></span>
* <span data-ttu-id="6e8b5-382">[Hello Windows Server AD DS 資料庫和 SYSVOL 的位置](#BKMK_PlaceDB)： 新增為 Azure Vm 執行順序 toostore hello Windows Server Active Directory 資料庫、 記錄檔和 SYSVOL 中的資料磁碟 tooDCs。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-382">[Placement of hello Windows Server AD DS database and SYSVOL](#BKMK_PlaceDB): Add a data disk tooDCs running as Azure VMs in order toostore hello Windows Server Active Directory database, logs, and SYSVOL.</span></span>
* <span data-ttu-id="6e8b5-383">[備份和還原](#BKMK_BUR)： 決定您想要 toostore 系統狀態備份。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-383">[Backup and Restore](#BKMK_BUR): Determine where you want toostore system state backups.</span></span> <span data-ttu-id="6e8b5-384">如有必要，加入另一個資料磁碟 toohello DC VM toostore 的備份。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-384">If necessary, add another data disk toohello DC VM toostore backups.</span></span>

### <span data-ttu-id="6e8b5-385"><a name="BKMK_CloudOnlyFed"></a>2 AD FS： 擴充宣告感知的內部部署前端應用程式 toohello 網際網路</span><span class="sxs-lookup"><span data-stu-id="6e8b5-385"><a name="BKMK_CloudOnlyFed"></a>2 AD FS: Extend a claims-aware on-premises front-end application toohello Internet</span></span>
<span data-ttu-id="6e8b5-386">![具有跨單位連線的同盟](media/active-directory-deploying-ws-ad-guidelines/Federation_xprem.png)
**圖 2**</span><span class="sxs-lookup"><span data-stu-id="6e8b5-386">![Federation with cross-premises connectivity](media/active-directory-deploying-ws-ad-guidelines/Federation_xprem.png)
**Figure 2**</span></span>

#### <a name="description"></a><span data-ttu-id="6e8b5-387">說明</span><span class="sxs-lookup"><span data-stu-id="6e8b5-387">Description</span></span>
<span data-ttu-id="6e8b5-388">宣告感知應用程式已成功部署在內部部署而且由公司使用者需求 toobecome 可以直接從 hello 網際網路存取。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-388">A claims-aware application that has been successfully deployed on-premises and used by corporate users needs toobecome accessible directly from hello Internet.</span></span> <span data-ttu-id="6e8b5-389">hello 應用程式當做 web 前端 tooa SQL database 以儲存資料。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-389">hello application serves as a web frontend tooa SQL database in which it stores data.</span></span> <span data-ttu-id="6e8b5-390">hello hello 應用程式所使用的 SQL server 也位於 hello 公司網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-390">hello SQL servers used by hello application are also located on hello corporate network.</span></span> <span data-ttu-id="6e8b5-391">兩個 Windows Server AD FS Sts 和負載平衡器已在內部部署的 tooprovide 存取 toohello 公司使用者。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-391">Two Windows Server AD FS STSs and a load-balancer have been deployed on-premises tooprovide access toohello corporate users.</span></span> <span data-ttu-id="6e8b5-392">hello 應用程式現在需要 toobe 提供額外的存取直接透過網際網路 hello 使用自己公司身分識別的商業夥伴和現有公司使用者。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-392">hello application now needs toobe additionally accessed directly over hello Internet both by business partners using their own corporate identities and by existing corporate users.</span></span>

<span data-ttu-id="6e8b5-393">投入時間 toosimplify 和符合 hello 部署和組態需求，這個新要求，我們決定將兩個額外的 web 前端和兩部 Azure 虛擬機器上安裝 Windows Server AD FS proxy 伺服器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-393">In an effort toosimplify and meet hello deployment and configuration needs of this new requirement, it is decided that two additional web frontends and two Windows Server AD FS proxy servers be installed on Azure virtual machines.</span></span> <span data-ttu-id="6e8b5-394">所有四個 Vm 將會直接公開 toohello 網際網路，而且將會提供連線 toohello 在內部部署網路使用 Azure 虛擬網路的站對站 VPN 功能。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-394">All four VMs will be exposed directly toohello Internet and will be provided connectivity toohello on-premises network using Azure Virtual Network’s site-to-site VPN capability.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-toohello-scenario"></a><span data-ttu-id="6e8b5-395">案例考量以及技術領域如何套用 toohello 案例</span><span class="sxs-lookup"><span data-stu-id="6e8b5-395">Scenario considerations and how technology areas apply toohello scenario</span></span>
* <span data-ttu-id="6e8b5-396">[網路拓撲](#BKMK_NetworkTopology)：建立 Azure 虛擬網路和[設定跨單位連線](../vpn-gateway/vpn-gateway-site-to-site-create.md)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-396">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network and [configure cross-premises connectivity](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>
  
  > [!NOTE]
  > <span data-ttu-id="6e8b5-397">每一個 hello Windows Server AD FS 憑證，請確定 hello URL 範本內定義 hello 憑證，並在 Azure 上執行的 hello Windows Server AD FS 執行個體可到達 hello 產生的憑證。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-397">For each of hello Windows Server AD FS certificates, ensure that hello URL defined within hello certificate template and hello resulting certificates can be reached by hello Windows Server AD FS instances running on Azure.</span></span> <span data-ttu-id="6e8b5-398">這可能需要跨單位連線 tooparts PKI 基礎結構。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-398">This may require cross-premises connectivity tooparts of your PKI infrastructure.</span></span> <span data-ttu-id="6e8b5-399">例如，如果 hello CRL 的端點是以 LDAP 為基礎和以獨佔方式裝載內部部署，則跨單位連線都是必要的。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-399">For example if hello CRL's endpoint is LDAP-based and hosted exclusively on-premises, then cross-premises connectivity will be required.</span></span> <span data-ttu-id="6e8b5-400">如果不需要這樣做，它可能是必要 toouse hello 網際網路位於可存取的 CRL 的 CA 所簽發的憑證。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-400">If this is not desirable, it may be necessary toouse certificates issued by a CA whose CRL is accessible over hello Internet.</span></span>
  > 
  > 
* <span data-ttu-id="6e8b5-401">[雲端服務組態](#BKMK_CloudSvcConfig)︰請確定您有兩個雲端服務，以便提供兩個負載平衡虛擬 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-401">[Cloud services configuration](#BKMK_CloudSvcConfig): Ensure you have two cloud services in order provide two load-balanced virtual IP addresses.</span></span> <span data-ttu-id="6e8b5-402">hello 第一個雲端服務的虛擬 IP 位址將會導向的 toohello 兩個 Windows Server AD FS proxy 連接埠 80 和 443 上的 Vm。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-402">hello first cloud service’s virtual IP address will be directed toohello two Windows Server AD FS proxy VMs on ports 80 and 443.</span></span> <span data-ttu-id="6e8b5-403">hello Windows Server AD FS proxy Vm 將會設定 hello 內部負載平衡器面對 hello Windows Server AD FS Sts toopoint toohello IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-403">hello Windows Server AD FS proxy VMs will be configured toopoint toohello IP address of hello on-premises load-balancer that fronts hello Windows Server AD FS STSs.</span></span> <span data-ttu-id="6e8b5-404">hello 第二個雲端服務的虛擬 IP 位址將會導向的 toohello 兩個 Vm 同樣在連接埠 80 和 443 上執行 hello web 前端。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-404">hello second cloud service’s virtual IP address will be directed toohello two VMs running hello web frontend again on ports 80 and 443.</span></span> <span data-ttu-id="6e8b5-405">設定自訂探查 tooensure hello 負載平衡器只會將導向流量 toofunctioning Windows Server AD FS proxy 和 web 前端 Vm。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-405">Configure a custom probe tooensure hello load-balancer only directs traffic toofunctioning Windows Server AD FS proxy and web frontend VMs.</span></span>
* <span data-ttu-id="6e8b5-406">[同盟伺服器設定](#BKMK_FedSrvConfig): hello hello 雲端中建立的 Windows Server Active Directory 樹系設定 Windows Server AD FS 同盟伺服器 (STS) toogenerate 安全性 token。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-406">[Federation server configuration](#BKMK_FedSrvConfig): Configure Windows Server AD FS as a federation server (STS) toogenerate security tokens for hello Windows Server Active Directory forest created in hello cloud.</span></span> <span data-ttu-id="6e8b5-407">設定同盟宣告提供者信任關係有 hello 想 tooaccept 身分識別，從不同的夥伴，並使用您想 toogenerate 語彙基元來 hello 不同應用程式設定信賴憑證者的合作對象的信任關係。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-407">Set federation claims provider trust relationships with hello different partners you wish tooaccept identities from, and configure relying party trust relationships with hello different applications you want toogenerate tokens to.</span></span>
  
    <span data-ttu-id="6e8b5-408">在大部分情況下，Windows Server AD FS Proxy 伺服器會基於安全性理由而部署在網際網路對應的容量，其 Windows Server AD FS 同盟對應項目依然隔離為直接網際網路連接。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-408">In most scenarios, Windows Server AD FS proxy servers are deployed in an Internet-facing capacity for security purposes while their Windows Server AD FS federation counterparts remain isolated from direct Internet connectivity.</span></span> <span data-ttu-id="6e8b5-409">不論您的部署案例，您必須設定您的雲端服務會提供公開的 IP 位址以及能夠 tooload 餘額會橫跨兩個 Windows Server AD FS STS 執行個體或 proxy 執行個體的連接埠的虛擬 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-409">Regardless of your deployment scenario, you must configure your cloud service with a virtual IP address that will provide a publicly exposed IP address and port that is able tooload-balance across either your two Windows Server AD FS STS instances or proxy instances.</span></span>
* <span data-ttu-id="6e8b5-410">[Windows Server AD FS 高可用性組態](#BKMK_ADFSHighAvail)： 它是建議 toodeploy 容錯移轉和負載平衡的至少兩部伺服器的 Windows Server AD FS 伺服器陣列。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-410">[Windows Server AD FS high availability configuration](#BKMK_ADFSHighAvail): It is advisable toodeploy a Windows Server AD FS farm with at least two servers for failover and load balancing.</span></span> <span data-ttu-id="6e8b5-411">您可能會想 tooconsider hello Windows 內部資料庫 (WID) 用於 Windows Server AD FS 組態資料，並使用 hello 內部負載平衡 hello 伺服陣列中的 hello 伺服器功能的 Azure toodistribute 連入要求。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-411">You might want tooconsider using hello Windows Internal Database (WID) for Windows Server AD FS configuration data, and use hello internal load balancing capability of Azure toodistribute incoming requests across hello servers in hello farm.</span></span>

<span data-ttu-id="6e8b5-412">如需詳細資訊，請參閱 hello [AD DS 部署指南](https://technet.microsoft.com/library/cc753963)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-412">For more information, see hello [AD DS Deployment Guide](https://technet.microsoft.com/library/cc753963).</span></span>

### <span data-ttu-id="6e8b5-413"><a name="BKMK_HybridExt"></a>3.AD DS： 部署可感知 Windows Server AD DS 的應用程式需要連接 toohello 公司網路</span><span class="sxs-lookup"><span data-stu-id="6e8b5-413"><a name="BKMK_HybridExt"></a>3. AD DS: Deploy a Windows Server AD DS-aware application that requires connectivity toohello corporate network</span></span>
<span data-ttu-id="6e8b5-414">![跨單位 AD DS 部署](media/active-directory-deploying-ws-ad-guidelines/ADDS_xprem.png)
**圖 3**</span><span class="sxs-lookup"><span data-stu-id="6e8b5-414">![Cross-premises AD DS deployment](media/active-directory-deploying-ws-ad-guidelines/ADDS_xprem.png)
**Figure 3**</span></span>

#### <a name="description"></a><span data-ttu-id="6e8b5-415">說明</span><span class="sxs-lookup"><span data-stu-id="6e8b5-415">Description</span></span>
<span data-ttu-id="6e8b5-416">LDAP 感知應用程式會部署在 Azure 虛擬機器上。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-416">An LDAP-aware application is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="6e8b5-417">支援 Windows 整合式驗證並使用 Windows Server AD DS 做為組態和使用者設定檔資料的儲存機制。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-417">It supports Windows-integrated authentication and uses Windows Server AD DS as a repository for configuration and user profile data.</span></span> <span data-ttu-id="6e8b5-418">hello 目標的 hello 應用程式 tooleverage hello 現有公司 Windows Server AD DS 中，並提供單一登入。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-418">hello goal is for hello application tooleverage hello existing corporate Windows Server AD DS and provide single sign-on.</span></span> <span data-ttu-id="6e8b5-419">無法感知宣告的 hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-419">hello application is not claims-aware.</span></span> <span data-ttu-id="6e8b5-420">使用者也需要直接從網際網路 hello tooaccess hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-420">Users also need tooaccess hello application directly from hello Internet.</span></span> <span data-ttu-id="6e8b5-421">toooptimize 效能和成本，我們決定將兩個屬於 hello 公司網域的其他網域控制站會連同 hello Azure 上的應用程式一起部署。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-421">toooptimize for performance and cost, it is decided that two additional domain controllers that are part of hello corporate domain be deployed alongside hello application on Azure.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-toohello-scenario"></a><span data-ttu-id="6e8b5-422">案例考量以及技術領域如何套用 toohello 案例</span><span class="sxs-lookup"><span data-stu-id="6e8b5-422">Scenario considerations and how technology areas apply toohello scenario</span></span>
* <span data-ttu-id="6e8b5-423">[網路拓撲：](#BKMK_NetworkTopology)使用[跨單位連線](../vpn-gateway/vpn-gateway-site-to-site-create.md)建立 Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-423">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network with [cross-premises connectivity](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>
* <span data-ttu-id="6e8b5-424">[安裝方法](#BKMK_InstallMethod)： 部署複本 Dc 從 hello 公司 Windows Server Active Directory 網域。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-424">[Installation method](#BKMK_InstallMethod): Deploy replica DCs from hello corporate Windows Server Active Directory domain.</span></span> <span data-ttu-id="6e8b5-425">對於複本 DC，您可以安裝 Windows Server AD DS 上 hello VM，並選擇性地使用 hello 安裝從媒體 (IFM) 功能 tooreduce hello 的資料量需要 toobe 複寫 toohello 期間安裝新的 DC。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-425">For a replica DC, you can install Windows Server AD DS on hello VM, and optionally use hello Install From Media (IFM) feature tooreduce hello amount of data that needs toobe replicated toohello new DC during installation.</span></span> <span data-ttu-id="6e8b5-426">如需教學課程，請參閱 [在 Azure 中安裝複本 Active Directory 網域控制站](active-directory-install-replica-active-directory-domain-controller.md)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-426">For a tutorial, see [Install a replica Active Directory domain controller on Azure](active-directory-install-replica-active-directory-domain-controller.md).</span></span> <span data-ttu-id="6e8b5-427">即使您使用 IFM，它可能會更有效率的 toobuild hello 虛擬 DC 在內部部署和移動 hello 整個虛擬硬碟 (VHD) toohello 雲端而不是在安裝期間複寫 Windows Server AD DS。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-427">Even if you use IFM, it may be more efficient toobuild hello virtual DC on-premises and move hello entire Virtual Hard Disk (VHD) toohello cloud instead of replicating Windows Server AD DS during installation.</span></span> <span data-ttu-id="6e8b5-428">基於安全考量，建議您一旦已複製的 tooAzure hello VHD 刪除從 hello 與內部網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-428">For safety, it is recommended that you delete hello VHD from hello on-premises network once it has been copied tooAzure.</span></span>
* <span data-ttu-id="6e8b5-429">[Windows Server Active Directory 網站拓撲](#BKMK_ADSiteTopology)：在 Active Directory 網站及服務中建立新的 Azure 網站。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-429">[Windows Server Active Directory site topology](#BKMK_ADSiteTopology): Create a new Azure site in Active Directory Sites and Services.</span></span> <span data-ttu-id="6e8b5-430">建立 Windows Server Active Directory 子網路物件 toorepresent hello Azure 虛擬網路，並新增 hello 子網路 toohello 網站。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-430">Create a Windows Server Active Directory subnet object toorepresent hello Azure virtual network and add hello subnet toohello site.</span></span> <span data-ttu-id="6e8b5-431">建立新的站台連結，它包含 hello 新的 Azure 網站以及 hello 網站中的 hello Azure 虛擬網路 VPN 端點位於順序 toocontrol 來最佳化 Windows Server Active Directory 流量 tooand 從 Azure。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-431">Create a new site link that includes hello new Azure site and hello site in which hello Azure virtual network VPN endpoint is located in order toocontrol and optimize Windows Server Active Directory traffic tooand from Azure.</span></span>
* <span data-ttu-id="6e8b5-432">[IP 位址和 DNS](#BKMK_IPAddressDNS)：</span><span class="sxs-lookup"><span data-stu-id="6e8b5-432">[IP addressing and DNS](#BKMK_IPAddressDNS):</span></span>
  
  * <span data-ttu-id="6e8b5-433">使用 hello Set-azurestaticvnetip Azure PowerShell cmdlet 設定 hello DC 的靜態 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-433">Set a static IP address for hello DC by using hello Set-AzureStaticVNetIP Azure PowerShell cmdlet.</span></span>
  * <span data-ttu-id="6e8b5-434">安裝和設定 Windows Server DNS hello Azure 上的網域控制站。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-434">Install and configure Windows Server DNS on hello domain controller(s) on Azure.</span></span>
  * <span data-ttu-id="6e8b5-435">Hello 名稱和 IP 位址的 hello 裝載 hello DC 和 DNS 伺服器角色的 VM 設定 hello 虛擬網路屬性。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-435">Configure hello virtual network properties with hello name and IP address of hello VM that hosts hello DC and DNS server roles.</span></span>
* <span data-ttu-id="6e8b5-436">[地理位置分散 DC](#BKMK_DistributedDCs)︰視需要設定其他虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-436">[Geo-distributed DCs](#BKMK_DistributedDCs): Configure additional virtual networks as needed.</span></span> <span data-ttu-id="6e8b5-437">如果您的 Active Directory 站台拓撲需要對應 toodifferent Azure 的地理位置中的網域控制站與您的區域，據此想 toocreate Active Directory 站台。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-437">If your Active Directory site topology requires DCs in geographies that correspond toodifferent Azure regions, than you want toocreate Active Directory sites accordingly.</span></span>
* <span data-ttu-id="6e8b5-438">[唯讀網域控制站](#BKMK_RODC)： 您可能會將 RODC 部署在 hello Azure 站台，取決於您的需求執行的寫入作業對 hello DC 和 hello 相容性應用程式和服務在 hello 與 Rodc 的站台。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-438">[Read-only DCs](#BKMK_RODC): You might deploy an RODC in hello Azure site, depending on your requirements for performing write operations against hello DC and hello compatibility of applications and services in hello site with RODCs.</span></span> <span data-ttu-id="6e8b5-439">如需有關應用程式相容性的詳細資訊，請參閱 hello[唯讀網域控制站的應用程式相容性指南](https://technet.microsoft.com/library/cc755190)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-439">For more information about application compatibility, see hello [Read-Only domain controllers application compatibility guide](https://technet.microsoft.com/library/cc755190).</span></span>
* <span data-ttu-id="6e8b5-440">[通用類別目錄](#BKMK_GC): Gc 是多重網域樹系中的所需的 tooservice 登入要求。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-440">[Global Catalog](#BKMK_GC): GCs are needed tooservice logon requests in multidomain forests.</span></span> <span data-ttu-id="6e8b5-441">如果您未部署 GC hello Azure 網站中的，就會發生輸出流量成本，因為驗證要求在其他站台中會產生查詢 Gc。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-441">If you do not deploy a GC in hello Azure site, you will incur egress traffic costs as authentication requests cause queries GCs in other sites.</span></span> <span data-ttu-id="6e8b5-442">流量的 toominimize，您可以啟用快取 hello Azure Active Directory 站台及服務中的站台的萬用群組成員資格。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-442">toominimize that traffic, you can enable universal group membership caching for hello Azure site in Active Directory Sites and Services.</span></span>
  
    <span data-ttu-id="6e8b5-443">如果您部署 GC，設定網站連結和站台連結成本，因此不需要 tooreplicate 的其他 Gc 慣用當做來源 DC hello GC hello Azure 站台在 hello 相同部分網域分割區。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-443">If you deploy a GC, configure site links and site links costs so that hello GC in hello Azure site is not preferred as a source DC by other GCs that need tooreplicate hello same partial domain partitions.</span></span>
* <span data-ttu-id="6e8b5-444">[Hello Windows Server AD DS 資料庫和 SYSVOL 的位置](#BKMK_PlaceDB)： 加入資料磁碟 tooDCs 訂單 toostore hello Windows Server Active Directory 資料庫、 記錄檔和 SYSVOL 中的 Azure Vm 上執行。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-444">[Placement of hello Windows Server AD DS database and SYSVOL](#BKMK_PlaceDB): Add a data disk tooDCs running on Azure VMs in order toostore hello Windows Server Active Directory database, logs, and SYSVOL.</span></span>
* <span data-ttu-id="6e8b5-445">[備份和還原](#BKMK_BUR)： 決定您想要 toostore 系統狀態備份。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-445">[Backup and Restore](#BKMK_BUR): Determine where you want toostore system state backups.</span></span> <span data-ttu-id="6e8b5-446">如有必要，加入另一個資料磁碟 toohello DC VM toostore 的備份。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-446">If necessary, add another data disk toohello DC VM toostore backups.</span></span>

## <a name="deployment-decisions-and-factors"></a><span data-ttu-id="6e8b5-447">部署決策和因素</span><span class="sxs-lookup"><span data-stu-id="6e8b5-447">Deployment decisions and factors</span></span>
<span data-ttu-id="6e8b5-448">本表會摘要說明 hello Windows Server Active Directory 技術領域 hello 上述案例中受到影響，hello 對應決策 tooconsider 與下方的連結 toomore 詳細資料。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-448">This table summarizes hello Windows Server Active Directory technology areas that are impacted in hello preceding scenarios and hello corresponding decisions tooconsider, with links toomore detail below.</span></span> <span data-ttu-id="6e8b5-449">某些技術領域可能不適用 tooevery 部署案例中，以及一些技術領域可能比其他技術領域更為重要 tooa 部署案例。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-449">Some technology areas might not be applicable tooevery deployment scenario, and some technology areas might be more critical tooa deployment scenario than other technology areas.</span></span>

<span data-ttu-id="6e8b5-450">例如，如果部署複本 DC 上的虛擬網路，而且您的樹系只有單一網域，然後選擇 toodeploy 通用類別目錄伺服器在此情況下將無法重大 toohello 部署案例因為它不會建立任何額外的複寫需求。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-450">For example, if you deploy a replica DC on a virtual network and your forest has only a single domain, then choosing toodeploy a global catalog server in that case will not be critical toohello deployment scenario because it will not create any additional replication requirements.</span></span> <span data-ttu-id="6e8b5-451">在 hello 相反地，如果 hello 樹系有幾個網域，然後 hello 決策 toodeploy 虛擬網路上的通用類別目錄可能會影響可用的頻寬、 效能、 驗證、 目錄查閱等等。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-451">On hello other hand, if hello forest has several domains, then hello decision toodeploy a global catalog on a virtual network could affect available bandwidth, performance, authentication, directory lookups, and so on.</span></span>

| <span data-ttu-id="6e8b5-452">Windows Server Active Directory 技術領域</span><span class="sxs-lookup"><span data-stu-id="6e8b5-452">Windows Server Active Directory technology area</span></span> | <span data-ttu-id="6e8b5-453">決策</span><span class="sxs-lookup"><span data-stu-id="6e8b5-453">Decisions</span></span> | <span data-ttu-id="6e8b5-454">因素</span><span class="sxs-lookup"><span data-stu-id="6e8b5-454">Factors</span></span> |
| --- | --- | --- |
| [<span data-ttu-id="6e8b5-455">網路拓撲</span><span class="sxs-lookup"><span data-stu-id="6e8b5-455">Network topology</span></span>](#BKMK_NetworkTopology) |<span data-ttu-id="6e8b5-456">建立虛擬網路？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-456">Do you create a virtual network?</span></span> |<li><span data-ttu-id="6e8b5-457">需求 tooaccess 公司資源</span><span class="sxs-lookup"><span data-stu-id="6e8b5-457">Requirements tooaccess Corp resources</span></span></li> <li><span data-ttu-id="6e8b5-458">驗證</span><span class="sxs-lookup"><span data-stu-id="6e8b5-458">Authentication</span></span></li> <li><span data-ttu-id="6e8b5-459">帳戶管理</span><span class="sxs-lookup"><span data-stu-id="6e8b5-459">Account management</span></span></li> |
| [<span data-ttu-id="6e8b5-460">DC 部署組態</span><span class="sxs-lookup"><span data-stu-id="6e8b5-460">DC deployment configuration</span></span>](#BKMK_DeploymentConfig) |<li><span data-ttu-id="6e8b5-461">在沒有任何信任的情況下部署個別樹系？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-461">Deploy a separate forest without any trusts?</span></span></li> <li><span data-ttu-id="6e8b5-462">部署具有同盟的新樹系？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-462">Deploy a new forest with federation?</span></span></li> <li><span data-ttu-id="6e8b5-463">部署具有 Windows Server Active Directory 樹系信任或 Kerberos 的新樹系？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-463">Deploy a new forest with Windows Server Active Directory forest trust or Kerberos?</span></span></li> <li><span data-ttu-id="6e8b5-464">藉由部署複本 DC 擴充公司樹系？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-464">Extend Corp forest by deploying a replica DC?</span></span></li> <li><span data-ttu-id="6e8b5-465">藉由部署新的子網域或網域樹系擴充公司樹系？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-465">Extend Corp forest by deploying a new child domain or domain tree?</span></span></li> |<li><span data-ttu-id="6e8b5-466">安全性</span><span class="sxs-lookup"><span data-stu-id="6e8b5-466">Security</span></span></li> <li><span data-ttu-id="6e8b5-467">法規遵循</span><span class="sxs-lookup"><span data-stu-id="6e8b5-467">Compliance</span></span></li> <li><span data-ttu-id="6e8b5-468">成本</span><span class="sxs-lookup"><span data-stu-id="6e8b5-468">Cost</span></span></li> <li><span data-ttu-id="6e8b5-469">恢復功能和容錯</span><span class="sxs-lookup"><span data-stu-id="6e8b5-469">Resiliency and fault-tolerance</span></span></li> <li><span data-ttu-id="6e8b5-470">應用程式相容性</span><span class="sxs-lookup"><span data-stu-id="6e8b5-470">Application compatibility</span></span></li> |
| [<span data-ttu-id="6e8b5-471">Windows Server Active Directory 網站拓撲</span><span class="sxs-lookup"><span data-stu-id="6e8b5-471">Windows Server Active Directory site topology</span></span>](#BKMK_ADSiteTopology) |<span data-ttu-id="6e8b5-472">您該如何設定 Azure 虛擬網路 toooptimize 流量子網路、 網站和站台連結並成本降至最低？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-472">How do you configure subnets, sites, and site links with Azure Virtual Network toooptimize traffic and minimize cost?</span></span> |<li><span data-ttu-id="6e8b5-473">子網路和站台定義</span><span class="sxs-lookup"><span data-stu-id="6e8b5-473">Subnet and site definitions</span></span></li> <li><span data-ttu-id="6e8b5-474">站台連結屬性和變更通知</span><span class="sxs-lookup"><span data-stu-id="6e8b5-474">Site link properties and change notification</span></span></li> <li><span data-ttu-id="6e8b5-475">複寫壓縮</span><span class="sxs-lookup"><span data-stu-id="6e8b5-475">Replication compression</span></span></li> |
| [<span data-ttu-id="6e8b5-476">IP 位址和 DNS</span><span class="sxs-lookup"><span data-stu-id="6e8b5-476">IP addressing and DNS</span></span>](#BKMK_IPAddressDNS) |<span data-ttu-id="6e8b5-477">如何 tooconfigure IP 位址和名稱解析？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-477">How tooconfigure IP addresses and name resolution?</span></span> |<li><span data-ttu-id="6e8b5-478">使用 hello 使用 hello Set-azurestaticvnetip cmdlet tooassign 靜態 IP 位址</span><span class="sxs-lookup"><span data-stu-id="6e8b5-478">Use hello Use hello Set-AzureStaticVNetIP cmdlet tooassign a static IP address</span></span></li> <li><span data-ttu-id="6e8b5-479">安裝 Windows Server DNS 伺服器及 hello 名稱和 IP 位址的 hello 裝載 hello DC 和 DNS 伺服器角色的 VM 設定 hello 虛擬網路屬性</span><span class="sxs-lookup"><span data-stu-id="6e8b5-479">Install Windows Server DNS server and configure hello virtual network properties with hello name and IP address of hello VM that hosts hello DC and DNS server roles</span></span></li> |
| [<span data-ttu-id="6e8b5-480">地理位置分散 DC</span><span class="sxs-lookup"><span data-stu-id="6e8b5-480">Geo-distributed DCs</span></span>](#BKMK_DistributedDCs) |<span data-ttu-id="6e8b5-481">如何 tooreplicate tooDCs 上的個別虛擬網路？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-481">How tooreplicate tooDCs on separate virtual networks?</span></span> |<span data-ttu-id="6e8b5-482">如果您的 Active Directory 站台拓撲需要對應 toodifferent Azure 的地理位置中的網域控制站與您的區域，據此想 toocreate Active Directory 站台。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-482">If your Active Directory site topology requires DCs in geographies that corresponds toodifferent Azure regions, than you want toocreate Active Directory sites accordingly.</span></span> <span data-ttu-id="6e8b5-483">[設定虛擬網路 toovirtual 網路連線](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md)tooreplicate 不同虛擬網路上的網域控制站之間。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-483">[Configure virtual network toovirtual network Connectivity](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) tooreplicate between domain controllers on separate virtual networks.</span></span> |
| [<span data-ttu-id="6e8b5-484">唯讀 DC</span><span class="sxs-lookup"><span data-stu-id="6e8b5-484">Read-only DCs</span></span>](#BKMK_RODC) |<span data-ttu-id="6e8b5-485">使用唯讀或可寫入 DC？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-485">Use read-only or writeable DCs?</span></span> |<li><span data-ttu-id="6e8b5-486">篩選 HBI/PII 屬性</span><span class="sxs-lookup"><span data-stu-id="6e8b5-486">Filter HBI/PII attributes</span></span></li> <li><span data-ttu-id="6e8b5-487">篩選祕密</span><span class="sxs-lookup"><span data-stu-id="6e8b5-487">Filter secrets</span></span></li> <li><span data-ttu-id="6e8b5-488">限制輸出流量</span><span class="sxs-lookup"><span data-stu-id="6e8b5-488">Limit outbound traffic</span></span></li> |
| [<span data-ttu-id="6e8b5-489">通用類別目錄</span><span class="sxs-lookup"><span data-stu-id="6e8b5-489">Global catalog</span></span>](#BKMK_GC) |<span data-ttu-id="6e8b5-490">安裝通用類別目錄？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-490">Install global catalog?</span></span> |<li><span data-ttu-id="6e8b5-491">對於單一網域樹系，讓所有 DC 都是 GC</span><span class="sxs-lookup"><span data-stu-id="6e8b5-491">For single-domain forest, make all DCs GCs</span></span></li> <li><span data-ttu-id="6e8b5-492">對於多網域樹系，需要 GC 以進行驗證</span><span class="sxs-lookup"><span data-stu-id="6e8b5-492">For multidomain forest, GCs are required for authentication</span></span></li> |
| [<span data-ttu-id="6e8b5-493">安裝方法</span><span class="sxs-lookup"><span data-stu-id="6e8b5-493">Installation method</span></span>](#BKMK_InstallMethod) |<span data-ttu-id="6e8b5-494">如何在 Azure 中的 tooinstall DC？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-494">How tooinstall DC in Azure?</span></span> |<span data-ttu-id="6e8b5-495">下列任一方法︰</span><span class="sxs-lookup"><span data-stu-id="6e8b5-495">Either:</span></span> <li><span data-ttu-id="6e8b5-496">使用 Windows PowerShell 或 Dcpromo 安裝 AD DS</span><span class="sxs-lookup"><span data-stu-id="6e8b5-496">Install AD DS using Windows PowerShell or Dcpromo</span></span></li> <li><span data-ttu-id="6e8b5-497">移動內部部署虛擬 DC 的 VHD</span><span class="sxs-lookup"><span data-stu-id="6e8b5-497">Move VHD of an on-premises virtual DC</span></span></li> |
| [<span data-ttu-id="6e8b5-498">Hello Windows Server AD DS 資料庫和 SYSVOL 的位置</span><span class="sxs-lookup"><span data-stu-id="6e8b5-498">Placement of hello Windows Server AD DS database and SYSVOL</span></span>](#BKMK_PlaceDB) |<span data-ttu-id="6e8b5-499">其中 toostore Windows Server AD DS 資料庫、 記錄檔，以及 SYSVOL 嗎？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-499">Where toostore Windows Server AD DS database, logs, and SYSVOL?</span></span> |<span data-ttu-id="6e8b5-500">變更 Dcpromo.exe 預設值。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-500">Change Dcpromo.exe default values.</span></span> <span data-ttu-id="6e8b5-501">這些重要的 Active Directory 檔案「必須」  放在 Azure 資料磁碟，而不是實作寫入快取的作業系統磁碟。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-501">These critical Active Directory files *must* be placed on Azure Data Disks instead of Operating System disks that implement write caching.</span></span> |
| [<span data-ttu-id="6e8b5-502">備份與還原</span><span class="sxs-lookup"><span data-stu-id="6e8b5-502">Backup and Restore</span></span>](#BKMK_BUR) |<span data-ttu-id="6e8b5-503">如何 toosafeguard 和復原資料嗎？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-503">How toosafeguard and recover data?</span></span> |<span data-ttu-id="6e8b5-504">建立系統狀態備份</span><span class="sxs-lookup"><span data-stu-id="6e8b5-504">Create system state backups</span></span> |
| [<span data-ttu-id="6e8b5-505">同盟伺服器組態</span><span class="sxs-lookup"><span data-stu-id="6e8b5-505">Federation server configuration</span></span>](#BKMK_FedSrvConfig) |<li><span data-ttu-id="6e8b5-506">部署新的樹系具有同盟 hello 雲端中嗎？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-506">Deploy a new forest with federation in hello cloud?</span></span></li> <li><span data-ttu-id="6e8b5-507">部署 AD FS 內部部署及公開 proxy hello 雲端中的嗎？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-507">Deploy AD FS on-premises and expose a proxy in hello cloud?</span></span></li> |<li><span data-ttu-id="6e8b5-508">安全性</span><span class="sxs-lookup"><span data-stu-id="6e8b5-508">Security</span></span></li> <li><span data-ttu-id="6e8b5-509">法規遵循</span><span class="sxs-lookup"><span data-stu-id="6e8b5-509">Compliance</span></span></li> <li><span data-ttu-id="6e8b5-510">成本</span><span class="sxs-lookup"><span data-stu-id="6e8b5-510">Cost</span></span></li> <li><span data-ttu-id="6e8b5-511">存取 tooapplications 的商務夥伴</span><span class="sxs-lookup"><span data-stu-id="6e8b5-511">Access tooapplications by business partners</span></span></li> |
| [<span data-ttu-id="6e8b5-512">雲端服務組態</span><span class="sxs-lookup"><span data-stu-id="6e8b5-512">Cloud services configuration</span></span>](#BKMK_CloudSvcConfig) |<span data-ttu-id="6e8b5-513">以隱含方式部署雲端服務 hello 建立虛擬機器的第一次。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-513">A cloud service is implicitly deployed hello first time you create a virtual machine.</span></span> <span data-ttu-id="6e8b5-514">您需要 toodeploy 其他雲端服務嗎？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-514">Do you need toodeploy additional cloud services?</span></span> |<li><span data-ttu-id="6e8b5-515">Vm 需要直接暴露 toohello 網際網路嗎？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-515">Does a VM or VMs require direct exposure toohello Internet?</span></span></li> <li> <span data-ttu-id="6e8b5-516">需要負載平衡 hello 服務嗎？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-516">Does hello service require load-balancing?</span></span></li> |
| [<span data-ttu-id="6e8b5-517">公用和私人 IP 位址 (動態 IP 與虛擬 IP) 的同盟伺服器需求</span><span class="sxs-lookup"><span data-stu-id="6e8b5-517">Federation server requirements for public and private IP addressing (dynamic IP vs. virtual IP)</span></span>](#BKMK_FedReqVIPDIP) |<li><span data-ttu-id="6e8b5-518">Hello Windows Server AD FS 執行個體需要 toobe 直接從 hello 網際網路聯繫嗎？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-518">Does hello Windows Server AD FS instance need toobe reached directly from hello Internet?</span></span></li> <li><span data-ttu-id="6e8b5-519">Hello 雲端中部署的 hello 應用程式需要它自己的面向網際網路 IP 位址和連接埠嗎？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-519">Does hello application being deployed in hello cloud require its own Internet-facing IP address and port?</span></span></li> |<span data-ttu-id="6e8b5-520">針對您的部署所需的每個虛擬 IP 位址建立一個雲端服務</span><span class="sxs-lookup"><span data-stu-id="6e8b5-520">Create one cloud-service for each virtual IP address that is required by your deployment</span></span> |
| [<span data-ttu-id="6e8b5-521">Windows Server AD FS 高可用性組態</span><span class="sxs-lookup"><span data-stu-id="6e8b5-521">Windows Server AD FS high availability configuration</span></span>](#BKMK_ADFSHighAvail) |<li><span data-ttu-id="6e8b5-522">在我的 Windows Server AD FS 伺服器陣列中有多少節點？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-522">How many nodes in my Windows Server AD FS server farm?</span></span></li> <li><span data-ttu-id="6e8b5-523">在 我的 Windows Server AD FS proxy 伺服器陣列中的節點 toodeploy 多少？</span><span class="sxs-lookup"><span data-stu-id="6e8b5-523">How many nodes toodeploy in my Windows Server AD FS proxy farm?</span></span></li> |<span data-ttu-id="6e8b5-524">恢復功能和容錯</span><span class="sxs-lookup"><span data-stu-id="6e8b5-524">Resiliency and fault tolerance</span></span> |

### <span data-ttu-id="6e8b5-525"><a name="BKMK_NetworkTopology"></a>網路拓撲</span><span class="sxs-lookup"><span data-stu-id="6e8b5-525"><a name="BKMK_NetworkTopology"></a>Network topology</span></span>
<span data-ttu-id="6e8b5-526">在訂單 toomeet hello IP 位址一致性和 Windows Server AD DS 的 DNS 需求，就需要建立 toofirst [Azure 虛擬網路](../virtual-network/virtual-networks-overview.md)和附加虛擬機器 tooit。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-526">In order toomeet hello IP address consistency and DNS requirements of Windows Server AD DS, it is necessary toofirst create an [Azure virtual network](../virtual-network/virtual-networks-overview.md) and attach your virtual machines tooit.</span></span> <span data-ttu-id="6e8b5-527">在其建立時，您必須決定是否 toooptionally 擴充連線 tooyour 內部公司網路，明確地連接 Azure 虛擬機器 tooon 內部部署機器 — 這利用傳統 VPN 技術來達成和需要將 VPN 端點公開在 hello hello 公司網路邊緣上。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-527">During its creation, you must decide whether toooptionally extend connectivity tooyour on-premises corporate network, which transparently connects Azure virtual machines tooon-premises machines — this is achieved using traditional VPN technologies and requires that a VPN endpoint be exposed on hello edge of hello corporate network.</span></span> <span data-ttu-id="6e8b5-528">也就是從 Azure toohello 公司網路時，不成立起始 hello VPN。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-528">That is, hello VPN is initiated from Azure toohello corporate network, not vice-versa.</span></span>

<span data-ttu-id="6e8b5-529">請注意，額外費用 適用於擴充超過 hello 的標準收費適用於 tooeach VM 的虛擬網路 tooyour 與內部網路時。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-529">Note that additional charges apply when extending a virtual network tooyour on-premises network beyond hello standard charges that apply tooeach VM.</span></span> <span data-ttu-id="6e8b5-530">具體來說，費用支付 CPU 時間的 hello Azure 虛擬網路閘道，而也橫跨 hello VPN 與內部部署電腦通訊的每部 VM 所產生的 hello 輸出流量。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-530">Specifically, there are charges for CPU time of hello Azure Virtual Network gateway and for hello egress traffic generated by each VM that communicates with on-premises machines across hello VPN.</span></span> <span data-ttu-id="6e8b5-531">如需網路流量費用的詳細資訊，請參閱 [Azure 價格一覽](http://azure.microsoft.com/pricing/)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-531">For more information about network traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>

### <span data-ttu-id="6e8b5-532"><a name="BKMK_DeploymentConfig"></a>DC 部署組態</span><span class="sxs-lookup"><span data-stu-id="6e8b5-532"><a name="BKMK_DeploymentConfig"></a>DC deployment configuration</span></span>
<span data-ttu-id="6e8b5-533">hello 的方式來設定的 hello DC 依存於 hello 需求 hello 服務您想在 Azure 上的 toorun。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-533">hello way you configure hello DC depends on hello requirements for hello service you want toorun on Azure.</span></span> <span data-ttu-id="6e8b5-534">例如，您可能會部署新的樹系，與您自己公司的樹系隔離，進行測試的概念證明、 新的應用程式或某些其他短期專案需要目錄服務，但未指定存取 toointernal 公司資源。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-534">For example, you might deploy a new forest, isolated from your own corporate forest, for testing a proof-of-concept, a new application, or some other short term project that requires directory services but not specific access toointernal corporate resources.</span></span>

<span data-ttu-id="6e8b5-535">一個好處是，隔離的樹系 DC 不會複寫與內部部署網域控制站，導致較少輸出 hello 系統本身，所產生的網路流量並直接降低成本。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-535">As a benefit, an isolated forest DC does not replicate with on-premises DCs, resulting in less outbound network traffic generated by hello system itself, directly reducing costs.</span></span> <span data-ttu-id="6e8b5-536">如需網路流量費用的詳細資訊，請參閱 [Azure 價格一覽](http://azure.microsoft.com/pricing/)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-536">For more information about network traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>

<span data-ttu-id="6e8b5-537">另舉一例，假設您有服務的隱私權需求，但 hello 服務依存於存取 tooyour 內部 Windows Server Active Directory。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-537">As another example, suppose you have privacy requirements for a service, but hello service depends on access tooyour internal Windows Server Active Directory.</span></span> <span data-ttu-id="6e8b5-538">如果您允許 toohost hello 服務 hello 雲端中的資料，您可以為內部樹系在 Azure 上部署新的子網域。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-538">If you are allowed toohost data for hello service in hello cloud, you might deploy a new child domain for your internal forest on Azure.</span></span> <span data-ttu-id="6e8b5-539">在此情況下，您可以部署 DC，hello 新子網域 （不含 hello 通用類別目錄中的順序 toohelp 處理隱私權問題）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-539">In this case, you can deploy a DC for hello new child domain (without hello global catalog in order toohelp address privacy concerns).</span></span> <span data-ttu-id="6e8b5-540">此案例連同複本 DC 部署，需要虛擬網路以與內部部署 DC 連接。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-540">This scenario, along with a replica DC deployment, requires a virtual network for connectivity with your on-premises DCs.</span></span>

<span data-ttu-id="6e8b5-541">如果您建立新的樹系時，選擇是否 toouse [Active Directory 信任](https://technet.microsoft.com/library/cc771397)或[同盟信任](https://technet.microsoft.com/library/dd807036)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-541">If you create a new forest, choose whether toouse [Active Directory trusts](https://technet.microsoft.com/library/cc771397) or [Federation trusts](https://technet.microsoft.com/library/dd807036).</span></span> <span data-ttu-id="6e8b5-542">平衡相容性、 安全性、 規範、 成本和恢復功能所需的 hello 要求。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-542">Balance hello requirements dictated by compatibility, security, compliance, cost, and resiliency.</span></span> <span data-ttu-id="6e8b5-543">例如，tootake 利用[選擇性驗證](https://technet.microsoft.com/library/cc755844)您可能會選擇 toodeploy 在 Azure 上的新樹系和 Windows Server Active Directory 之間建立信任 hello 內部部署樹系與 hello 雲端樹系。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-543">For example, tootake advantage of [selective authentication](https://technet.microsoft.com/library/cc755844) you might choose toodeploy a new forest on Azure and create a Windows Server Active Directory trust between hello on-premises forest and hello cloud forest.</span></span> <span data-ttu-id="6e8b5-544">如果 hello 應用程式之可感知宣告，不過，您可能會部署而不是 Active Directory 樹系信任的同盟信任。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-544">If hello application is claims-aware, however, you might deploy federation trusts instead of Active Directory forest trusts.</span></span> <span data-ttu-id="6e8b5-545">另一個因素將 hello 成本 tooeither 複寫更多資料透過 Windows Server Active Directory toohello 雲端擴充您的內部或產生更多傳出流量，因為驗證和查詢負載。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-545">Another factor will be hello cost tooeither replicate more data by extending your on-premises Windows Server Active Directory toohello cloud or generate more outbound traffic as a result of authentication and query load.</span></span>

<span data-ttu-id="6e8b5-546">可用性和容錯的需求也會影響您的選擇。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-546">Requirements for availability and fault tolerance also affect your choice.</span></span> <span data-ttu-id="6e8b5-547">例如，如果 hello 連結中斷了，利用 Kerberos 信任或同盟信任的應用程式可能都會完全中斷，除非您已經部署在 Azure 上足夠的基礎結構。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-547">For example, if hello link is interrupted, applications leveraging either a Kerberos trust or a federation trust are all likely entirely broken unless you have deployed sufficient infrastructure on Azure.</span></span> <span data-ttu-id="6e8b5-548">替代部署組態，例如複本 Dc (可寫入或 Rodc) 增加 hello 的能 tootolerate 連結中斷的可能性。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-548">Alternative deployment configurations such as replica DCs (writeable or RODCs) increase hello likelihood of being able tootolerate link outages.</span></span>

### <span data-ttu-id="6e8b5-549"><a name="BKMK_ADSiteTopology"></a>Windows Server Active Directory 網站拓撲</span><span class="sxs-lookup"><span data-stu-id="6e8b5-549"><a name="BKMK_ADSiteTopology"></a>Windows Server Active Directory site topology</span></span>
<span data-ttu-id="6e8b5-550">您需要 toocorrectly 定義站台和站台連結中順序 toooptimize 流量，並將成本降至最低。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-550">You need toocorrectly define sites and site links in order toooptimize traffic and minimize cost.</span></span> <span data-ttu-id="6e8b5-551">站台、 站台連結和子網路會影響 Dc 之間的驗證流量的 hello 流程 hello 複寫拓撲。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-551">Sites, site-links, and subnets affect hello replication topology between DCs and hello flow of authentication traffic.</span></span> <span data-ttu-id="6e8b5-552">請考慮下列流量費用的 hello 然後部署和設定網域控制站，根據您的部署案例 toohello 需求：</span><span class="sxs-lookup"><span data-stu-id="6e8b5-552">Consider hello following traffic charges and then deploy and configure DCs according toohello requirements of your deployment scenario:</span></span>

* <span data-ttu-id="6e8b5-553">會每小時的 hello 閘道本身支付工本費：</span><span class="sxs-lookup"><span data-stu-id="6e8b5-553">There is a nominal fee per hour for hello gateway itself:</span></span>
  
  * <span data-ttu-id="6e8b5-554">您可以自行斟酌啟動或停止</span><span class="sxs-lookup"><span data-stu-id="6e8b5-554">It can be started and stopped as you see fit</span></span>
  * <span data-ttu-id="6e8b5-555">如果停止，Azure Vm 就會與 hello 公司網路隔離</span><span class="sxs-lookup"><span data-stu-id="6e8b5-555">If stopped, Azure VMs are isolated from hello corporate network</span></span>
* <span data-ttu-id="6e8b5-556">輸入流量是免費的</span><span class="sxs-lookup"><span data-stu-id="6e8b5-556">Inbound traffic is free</span></span>
* <span data-ttu-id="6e8b5-557">輸出流量的收費依據太[Azure 定價在摘要](http://azure.microsoft.com/pricing/)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-557">Outbound traffic is charged, according too[Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span> <span data-ttu-id="6e8b5-558">您可以最佳化內部部署網站與 hello 雲端網站之間的站台連結內容，如下所示：</span><span class="sxs-lookup"><span data-stu-id="6e8b5-558">You can optimize site link properties between on-premises sites and hello cloud sites as follows:</span></span>
  
  * <span data-ttu-id="6e8b5-559">如果您使用多個虛擬網路，設定 hello 網站連結與其成本適當地排列 hello Azure 從 tooprevent Windows Server AD DS 站台過去一可以提供相同服務層級的免費 hello。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-559">If you are using multiple virtual networks, configure hello site-links and their costs appropriately tooprevent Windows Server AD DS from prioritizing hello Azure site over one that can provide hello same levels of service at no charge.</span></span> <span data-ttu-id="6e8b5-560">您也可以考慮停用 hello 橋接所有網站連結 (BASL) 選項 （預設為啟用）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-560">You might also consider disabling hello Bridge all site link (BASL) option (which is enabled by default).</span></span> <span data-ttu-id="6e8b5-561">這可確保只有直接連接的網站彼此複寫。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-561">This ensures that only directly-connected sites replicate with one another.</span></span> <span data-ttu-id="6e8b5-562">過渡連接網站中的網域控制站就不再能夠 tooreplicate 彼此直接，但必須透過共同網站複寫。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-562">DCs in transitively connected sites are no longer able tooreplicate directly with each other, but must replicate through a common site or sites.</span></span> <span data-ttu-id="6e8b5-563">如果基於某些原因，hello 介網站變成無法使用，即使 hello 站台間連線可以使用，將不會發生過渡連接網站中 Dc 之間的複寫。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-563">If hello intermediary sites become unavailable for some reason, replication between DCs in transitively connected sites will not occur even if connectivity between hello sites is available.</span></span> <span data-ttu-id="6e8b5-564">最後，其中的複寫行為區段依然需要過渡，建立站台包含 hello 適當的站台連結和網站，例如內部部署公司網路站台連結橋接器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-564">Finally, where sections of transitive replication behavior remain desirable, create site link bridges that contain hello appropriate site-links and sites, such as on-premises, corporate network sites.</span></span>
  * <span data-ttu-id="6e8b5-565">[設定站台連結成本](https://technet.microsoft.com/library/cc794882)適當 tooavoid 意想不到的流量。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-565">[Configure site link costs](https://technet.microsoft.com/library/cc794882) appropriately tooavoid unintended traffic.</span></span> <span data-ttu-id="6e8b5-566">例如，如果**嘗試下一個最接近的網站**設定時，請確定站台不是接下來 hello hello 虛擬網路最接近藉由增加 hello 連接 hello Azure 站台後 toohello hello 站台連結物件的相關聯的成本公司網路。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-566">For example, if **Try Next Closest Site** setting is enabled, make sure hello virtual network sites are not hello next closest by increasing hello cost associated of hello site-link object that connects hello Azure site back toohello corporate network.</span></span>
  * <span data-ttu-id="6e8b5-567">設定站台連結[間隔](https://technet.microsoft.com/library/cc794878)和[排程](https://technet.microsoft.com/library/cc816906)根據 tooconsistency 需求和物件變更的速率。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-567">Configure site link [intervals](https://technet.microsoft.com/library/cc794878) and [schedules](https://technet.microsoft.com/library/cc816906) according tooconsistency requirements and rate of object changes.</span></span> <span data-ttu-id="6e8b5-568">對齊複寫排程與延遲容許範圍。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-568">Align replication schedule with latency tolerance.</span></span> <span data-ttu-id="6e8b5-569">網域控制站複寫只 hello 最後一個值的狀態，因此如果沒有足夠的物件變更速率降低 hello 複寫間隔可節省成本。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-569">DCs replicate only hello last state of a value, so decreasing hello replication interval can save costs if there is a sufficient object change rate.</span></span>
* <span data-ttu-id="6e8b5-570">如果將成本降至最低是優先事項，請確定已排程複寫且變更通知未啟用。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-570">If minimizing costs is a priority, ensure replication is scheduled and change notification is not enabled.</span></span> <span data-ttu-id="6e8b5-571">站台之間複寫時，這會是 hello 預設組態。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-571">This is hello default configuration when replicating between sites.</span></span> <span data-ttu-id="6e8b5-572">這並不重要，如果您要部署的虛擬網路上的 RODC，因為 hello RODC 不會複寫任何傳出的變更。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-572">This is not important if you are deploying an RODC on a virtual network because hello RODC will not replicate any changes outbound.</span></span> <span data-ttu-id="6e8b5-573">但是，如果您部署可寫入的 DC，您應該確定 hello 站台連結不是設定的 tooreplicate 更新，而不需要的頻率。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-573">But if you deploy a writable DC, you should make sure hello site link is not configured tooreplicate updates with unnecessary frequency.</span></span> <span data-ttu-id="6e8b5-574">如果您部署通用類別目錄伺服器 (GC)，請確定其他每一個包含 GC 的站台從來源站台連結會連接到站台中的 DC 複寫網域分割區，或具有較低的成本的站台連結比 hello 中的 GC hello Azure 站台。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-574">If you deploy a global catalog server (GC), make sure that every other site that contains a GC replicates domain partitions from a source DC in a site that is connected with a site-link or site-links that have a lower cost than hello GC in hello Azure site.</span></span>
* <span data-ttu-id="6e8b5-575">很可能 toofurther 仍會降低藉由變更 hello 複寫壓縮演算法的站台間複寫所產生的網路流量。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-575">It is possible toofurther still reduce network traffic generated by replication between sites by changing hello replication compression algorithm.</span></span> <span data-ttu-id="6e8b5-576">hello 壓縮演算法是由 hello REG_DWORD 登錄項目 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\Replicator 壓縮演算法來控制。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-576">hello compression algorithm is controlled by hello REG_DWORD registry entry HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\Replicator compression algorithm.</span></span> <span data-ttu-id="6e8b5-577">hello 預設值為 3，toohello Xpress Compress 演算法相互關聯。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-577">hello default value is 3, which correlates toohello Xpress Compress algorithm.</span></span> <span data-ttu-id="6e8b5-578">您可以變更 hello 值 too2，哪些變更 hello 演算法 tooMSZip。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-578">You can change hello value too2, which changes hello algorithm tooMSZip.</span></span> <span data-ttu-id="6e8b5-579">在大部分情況下，這會增加 hello 壓縮，但會以 hello 的 CPU 使用量的費用。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-579">In most cases, this will increase hello compression, but it does so at hello expense of CPU utilization.</span></span> <span data-ttu-id="6e8b5-580">如需詳細資訊，請參閱 [Active Directory 複寫拓撲如何運作](https://technet.microsoft.com/library/cc755994)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-580">For more information, see [How Active Directory replication topology works](https://technet.microsoft.com/library/cc755994).</span></span>

### <span data-ttu-id="6e8b5-581"><a name="BKMK_IPAddressDNS"></a>IP 位址和 DNS</span><span class="sxs-lookup"><span data-stu-id="6e8b5-581"><a name="BKMK_IPAddressDNS"></a>IP addressing and DNS</span></span>
<span data-ttu-id="6e8b5-582">Azure 虛擬機器預設會配置「DHCP 租用位址」。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-582">Azure virtual machines are allocated “DHCP-leased addresses” by default.</span></span> <span data-ttu-id="6e8b5-583">因為與虛擬機器的 Azure 虛擬網路動態位址是 hello hello 虛擬機器的存留期間保存，所以符合 Windows Server AD ds 的 hello 需求。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-583">Because Azure virtual network dynamic addresses persist with a virtual machine for hello lifetime of hello virtual machine, hello requirements of Windows Server AD DS are met.</span></span>

<span data-ttu-id="6e8b5-584">如此一來，當您在 Azure 上使用動態位址，您會使用靜態 IP 位址，因為它可路由傳送 hello 段 hello 租用，而且 hello hello 租用期間就等於 toohello hello 雲端服務的存留期的作用中。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-584">As a result, when you use a dynamic address on Azure, you are in effect using a static IP address because it is routable for hello period of hello lease, and hello period of hello lease is equal toohello lifetime of hello cloud service.</span></span>

<span data-ttu-id="6e8b5-585">不過，如果 hello VM 會關閉，會取消配置 hello 動態位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-585">However, hello dynamic address is deallocated if hello VM is shutdown.</span></span> <span data-ttu-id="6e8b5-586">您可以 tooprevent hello 取消配置的 IP 位址，[使用 Set-azurestaticvnetip tooassign 靜態 IP 位址](http://social.technet.microsoft.com/wiki/contents/articles/23447.how-to-assign-a-private-static-ip-to-an-azure-vm.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-586">tooprevent hello IP address from being deallocated, you can [use Set-AzureStaticVNetIP tooassign a static IP address](http://social.technet.microsoft.com/wiki/contents/articles/23447.how-to-assign-a-private-static-ip-to-an-azure-vm.aspx).</span></span>

<span data-ttu-id="6e8b5-587">針對名稱解析，部署您自己 （或利用現有） DNS 伺服器基礎結構Azure 提供的 DNS 不符合 hello 進階名稱解析需求 Windows Server AD DS。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-587">For name resolution, deploy your own (or leverage your existing) DNS server infrastructure; Azure-provided DNS does not meet hello advanced name resolution needs of Windows Server AD DS.</span></span> <span data-ttu-id="6e8b5-588">例如，不支援動態 SRV 記錄等等。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-588">For example, it does not support dynamic SRV records, and so on.</span></span> <span data-ttu-id="6e8b5-589">名稱解析是 DC 和加入網域的用戶端的重要組態項目。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-589">Name resolution is a critical configuration item for DCs and domain-joined clients.</span></span> <span data-ttu-id="6e8b5-590">DC 必須能夠註冊資源記錄及解析其他 DC 的資源記錄。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-590">DCs must be capable of registering resource records and resolving other DC’s resource records.</span></span>
<span data-ttu-id="6e8b5-591">基於容錯和效能理由，是最佳 tooinstall hello Windows Server DNS 服務在 Azure 上執行的 hello Dc 上。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-591">For fault tolerance and performance reasons, it is optimal tooinstall hello Windows Server DNS service on hello DCs running on Azure.</span></span> <span data-ttu-id="6e8b5-592">Hello 名稱與 hello DNS 伺服器 IP 位址，然後設定 hello Azure 虛擬網路屬性。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-592">Then configure hello Azure virtual network properties with hello name and IP address of hello DNS server.</span></span> <span data-ttu-id="6e8b5-593">當 hello 虛擬網路上的其他 Vm 啟動時，其 DNS 用戶端解析程式設定會設定與 DNS 伺服器 hello 動態 IP 位址配置的一部分。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-593">When other VMs on hello virtual network start, their DNS client resolver settings will be configured with DNS server as part of hello dynamic IP address allocation.</span></span>

> [!NOTE]
> <span data-ttu-id="6e8b5-594">您無法加入內部部署電腦 tooa Windows Server AD DS Active Directory 網域，會直接透過網際網路 hello Azure 上裝載。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-594">You cannot join on-premises computers tooa Windows Server AD DS Active Directory domain that is hosted on Azure directly over hello Internet.</span></span> <span data-ttu-id="6e8b5-595">針對 Active Directory 和 hello 網域加入作業轉譯它並不實用 toodirectly 公開 hello 必要的連接埠，且有作用，整個 DC toohello 網際網路 hello 連接埠需求。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-595">hello port requirements for Active Directory and hello domain-join operation render it impractical toodirectly expose hello necessary ports and in effect, an entire DC toohello Internet.</span></span>
> 
> 

<span data-ttu-id="6e8b5-596">VM 會在啟動或有名稱變更時自動註冊其 DNS 名稱。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-596">VMs register their DNS name automatically on startup or when there is a name change.</span></span>

<span data-ttu-id="6e8b5-597">如需此範例，說明如何 tooprovision hello 第一個 VM，並在其上安裝 AD DS 的另一個範例的詳細資訊，請參閱[Microsoft Azure 上安裝新的 Active Directory 樹系](active-directory-new-forest-virtual-machine.md)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-597">For more information about this example and another example that shows how tooprovision hello first VM and install AD DS on it, see [Install a new Active Directory forest on Microsoft Azure](active-directory-new-forest-virtual-machine.md).</span></span> <span data-ttu-id="6e8b5-598">如需使用 Windows PowerShell 的詳細資訊，請參閱[安裝 Azure PowerShell](/powershell/azureps-cmdlets-docs) 和 [Azure 管理 Cmdlet](/powershell/module/azurerm.compute/#virtual_machines)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-598">For more information about using Windows PowerShell, see [Install Azure PowerShell](/powershell/azureps-cmdlets-docs) and [Azure Management Cmdlets](/powershell/module/azurerm.compute/#virtual_machines).</span></span>

### <span data-ttu-id="6e8b5-599"><a name="BKMK_DistributedDCs"></a>地理位置分散 DC</span><span class="sxs-lookup"><span data-stu-id="6e8b5-599"><a name="BKMK_DistributedDCs"></a>Geo-distributed DCs</span></span>
<span data-ttu-id="6e8b5-600">在不同的虛擬網路上裝載多個 DC 時，Azure 提供一些優點︰</span><span class="sxs-lookup"><span data-stu-id="6e8b5-600">Azure offers advantages when hosting multiple DCs on different virtual networks:</span></span>

* <span data-ttu-id="6e8b5-601">多網站容錯</span><span class="sxs-lookup"><span data-stu-id="6e8b5-601">Multi-site fault-tolerance</span></span>
* <span data-ttu-id="6e8b5-602">實際接近 toobranch 辦公室 （較低延遲）</span><span class="sxs-lookup"><span data-stu-id="6e8b5-602">Physical proximity toobranch offices (lower latency)</span></span>

<span data-ttu-id="6e8b5-603">如需設定虛擬網路之間直接進行通訊的資訊，請參閱[設定虛擬網路 toovirtual 網路連接性](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-603">For information about configuring direct communication between virtual networks, see [Configure virtual network toovirtual network connectivity](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span>

### <span data-ttu-id="6e8b5-604"><a name="BKMK_RODC"></a>唯讀 DC</span><span class="sxs-lookup"><span data-stu-id="6e8b5-604"><a name="BKMK_RODC"></a>Read-only DCs</span></span>
<span data-ttu-id="6e8b5-605">您需要 toochoose 是否 toodeploy 讀取-只有或可寫入網域控制站。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-605">You need toochoose whether toodeploy read-only or writeable DCs.</span></span> <span data-ttu-id="6e8b5-606">您可能會想的 toodeploy Rodc，因為您將不會有實體控制權停留，但是 Rodc 設計的 toobe 部署其實體安全性的風險，例如分公司辦公室位置。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-606">You might be inclined toodeploy RODCs because you will not have physical control over them, but RODCs are designed toobe deployed in locations where their physical security is at risk, such as branch offices.</span></span>

<span data-ttu-id="6e8b5-607">Azure 沒有分公司辦公室，hello 實體安全性風險，但是 Rodc 經過證明可能還是 toobe 更符合成本效益，因為 hello 功能提供適合的 toothese 環境，雖然原因非常不同。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-607">Azure does not present hello physical security risk of a branch office, but RODCs might still prove toobe more cost effective because hello features they provide are well-suited toothese environments albeit for very different reasons.</span></span> <span data-ttu-id="6e8b5-608">例如，Rodc 有沒有傳出複寫，並會無法 tooselectively 擴展秘密 （密碼）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-608">For example, RODCs have no outbound replication and are able tooselectively populate secrets (passwords).</span></span> <span data-ttu-id="6e8b5-609">在 hello 缺點 hello 缺少這些密碼可能需要視輸出流量 toovalidate 他們的使用者或電腦進行驗證。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-609">On hello downside, hello lack of these secrets might require on-demand outbound traffic toovalidate them as a user or computer authenticates.</span></span> <span data-ttu-id="6e8b5-610">但是，密碼可以選擇性地預先填入及快取。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-610">But secrets can be selectively prepopulated and cached.</span></span>

<span data-ttu-id="6e8b5-611">Rodc 提供額外的優點 HBI 和 PII 顧慮，因為您可以加入屬性包含機密資料 toohello RODC 已篩選屬性集 (FAS)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-611">RODCs provide an additional advantage in and around HBI and PII concerns because you can add attributes that contain sensitive data toohello RODC filtered attribute set (FAS).</span></span> <span data-ttu-id="6e8b5-612">hello FAS 是一組可自訂的屬性不是複寫的 tooRODCs。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-612">hello FAS is a customizable set of attributes that are not replicated tooRODCs.</span></span> <span data-ttu-id="6e8b5-613">如果您不允許或不想 toostore PII 或 HBI，在 Azure 上的，您可以使用 hello FAS 當做保護。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-613">You can use hello FAS as a safeguard in case you are not permitted or do not want toostore PII or HBI on Azure.</span></span> <span data-ttu-id="6e8b5-614">如需詳細資訊，請參閱 [RODC 已篩選屬性集[(https://technet.microsoft.com/library/cc753459)]。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-614">For more information, see [RODC filtered attribute set[(https://technet.microsoft.com/library/cc753459)].</span></span>

<span data-ttu-id="6e8b5-615">請確定應用程式將會與 Rodc 相容您計劃 toouse。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-615">Make sure that applications will be compatible with RODCs you plan toouse.</span></span> <span data-ttu-id="6e8b5-616">許多 Windows Server Active Directory 功能的應用程式適用於 Rodc，但某些應用程式可以無效率地執行，或如果不需要存取 tooa 失敗可寫入的 DC。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-616">Many Windows Server Active Directory-enabled applications work well with RODCs, but some applications can perform inefficiently or fail if they do not have access tooa writable DC.</span></span> <span data-ttu-id="6e8b5-617">如需詳細資訊，請參閱 [唯讀 DC 應用程式相容性指南](https://technet.microsoft.com/library/cc755190)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-617">For more information, see [Read-Only DCs application compatibility guide](https://technet.microsoft.com/library/cc755190).</span></span>

### <span data-ttu-id="6e8b5-618"><a name="BKMK_GC"></a>通用類別目錄</span><span class="sxs-lookup"><span data-stu-id="6e8b5-618"><a name="BKMK_GC"></a>Global catalog</span></span>
<span data-ttu-id="6e8b5-619">您是否需要 toochoose tooinstall 通用類別目錄 (GC)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-619">You need toochoose whether tooinstall a global catalog (GC).</span></span> <span data-ttu-id="6e8b5-620">在單一網域樹系中，您應該將所有 DC 設為通用類別目錄伺服器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-620">In a single domain forest, you should configure all DCs as global catalog servers.</span></span> <span data-ttu-id="6e8b5-621">這樣不會增加成本，因為沒有任何額外複寫流量。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-621">It will not increase costs because there will be no additional replication traffic.</span></span>

<span data-ttu-id="6e8b5-622">在多重網域樹系中，Gc hello 驗證程序期間，進行必要 tooexpand 萬用群組成員資格。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-622">In a multidomain forest, GCs are necessary tooexpand Universal Group memberships during hello authentication process.</span></span> <span data-ttu-id="6e8b5-623">如果您未部署 GC，hello 虛擬網路上針對在 Azure 上的 DC 驗證的工作負載將會間接產生傳出驗證流量 tooquery Gc 內部期間每個驗證嘗試。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-623">If you do not deploy a GC, workloads on hello virtual network that authenticate against a DC on Azure will indirectly generate outbound authentication traffic tooquery GCs on-premises during each authentication attempt.</span></span>

<span data-ttu-id="6e8b5-624">hello 與 Gc 相關聯的成本會比較無法預測的因為它們會裝載每個網域 （部分）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-624">hello costs associated with GCs are less-predictable because they host every domain (in-part).</span></span> <span data-ttu-id="6e8b5-625">如果 hello 工作負載裝載面對網際網路服務，且會驗證使用者的 Windows Server AD DS，hello 成本可能完全無法預測。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-625">If hello workload hosts an Internet-facing service and authenticates users against Windows Server AD DS, hello costs could be completely unpredictable.</span></span> <span data-ttu-id="6e8b5-626">toohelp 在驗證期間減少 hello 雲端網站之外的 GC 查詢，您可以[啟用萬用群組成員資格快取](https://technet.microsoft.com/library/cc816928)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-626">toohelp reduce GC queries outside of hello cloud site during authentication, you can [enable Universal Group Membership Caching](https://technet.microsoft.com/library/cc816928).</span></span>

### <span data-ttu-id="6e8b5-627"><a name="BKMK_InstallMethod"></a>安裝方法</span><span class="sxs-lookup"><span data-stu-id="6e8b5-627"><a name="BKMK_InstallMethod"></a>Installation method</span></span>
<span data-ttu-id="6e8b5-628">您需要如何 toochoose tooinstall hello Dc hello 虛擬網路上：</span><span class="sxs-lookup"><span data-stu-id="6e8b5-628">You need toochoose how tooinstall hello DCs on hello virtual network:</span></span>

* <span data-ttu-id="6e8b5-629">升級新的 DC。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-629">Promote new DCs.</span></span> <span data-ttu-id="6e8b5-630">如需詳細資訊，請參閱 [在 Azure 虛擬網路上安裝新的 Active Directory 樹系](active-directory-new-forest-virtual-machine.md)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-630">For more information, see [Install a new Active Directory forest on an Azure virtual network](active-directory-new-forest-virtual-machine.md).</span></span>
* <span data-ttu-id="6e8b5-631">移動 hello 在內部部署虛擬 DC 的 toohello 雲端的 VHD。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-631">Move hello VHD of an on-premises virtual DC toohello cloud.</span></span> <span data-ttu-id="6e8b5-632">在此情況下，您必須確定該 hello 在內部部署虛擬 DC 會 「 移動 」 沒有 「 複製 」 或 「 複製 」。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-632">In this case, you must ensure that hello on-premises virtual DC is “moved,” not “copied” or “cloned.”</span></span>

<span data-ttu-id="6e8b5-633">作為僅 Azure 虛擬機器的網域控制站 （相對於的 tooAzure"web"或 「 背景工作 」 角色 Vm）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-633">Use only Azure virtual machines for DCs (as opposed tooAzure “web” or “worker” role VMs).</span></span> <span data-ttu-id="6e8b5-634">它們很持久，而且需要 DC 狀態的持久性。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-634">They are durable and durability of state for a DC is required.</span></span> <span data-ttu-id="6e8b5-635">Azure 虛擬機器是針對類似 DC 的工作負載而設計的。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-635">Azure virtual machines are designed for workloads such as DCs.</span></span>

<span data-ttu-id="6e8b5-636">請勿使用 SYSPREP toodeploy 或複製 Dc。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-636">Do not use SYSPREP toodeploy or clone DCs.</span></span> <span data-ttu-id="6e8b5-637">hello 能力 tooclone 網域控制站是從開始才能使用 Windows Server 2012 中。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-637">hello ability tooclone DCs is only available beginning in Windows Server 2012.</span></span> <span data-ttu-id="6e8b5-638">hello 複製功能需要 hello 基礎 hypervisor 中的 VMGenerationID 支援。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-638">hello cloning feature requires support for VMGenerationID in hello underlying hypervisor.</span></span> <span data-ttu-id="6e8b5-639">Windows Server 2012 和 Azure 虛擬網路中的 Hyper-V 都支援 VMGenerationID，如同協力廠商虛擬化軟體廠商一樣。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-639">Hyper-V in Windows Server 2012 and Azure virtual networks both support VMGenerationID, as do third-party virtualization software vendors.</span></span>

### <span data-ttu-id="6e8b5-640"><a name="BKMK_PlaceDB"></a>Hello Windows Server AD DS 資料庫和 SYSVOL 的位置</span><span class="sxs-lookup"><span data-stu-id="6e8b5-640"><a name="BKMK_PlaceDB"></a>Placement of hello Windows Server AD DS database and SYSVOL</span></span>
<span data-ttu-id="6e8b5-641">選取 toolocate hello Windows Server AD DS 資料庫、 記錄以及 SYSVOL 的位置。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-641">Select where toolocate hello Windows Server AD DS database, logs, and SYSVOL.</span></span> <span data-ttu-id="6e8b5-642">必須部署在 Azure 資料磁碟上。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-642">They must be deployed on Azure Data disks.</span></span>

> [!NOTE]
> <span data-ttu-id="6e8b5-643">Azure 資料磁碟會受條件約束的 too1 TB。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-643">Azure Data disks are constrained too1 TB.</span></span>
> 
> 

<span data-ttu-id="6e8b5-644">根據預設，資料磁碟機未快取寫入。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-644">Data disk drives do not cache writes by default.</span></span> <span data-ttu-id="6e8b5-645">資料磁碟的磁碟機附加的 tooa VM 使用直接寫入式快取。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-645">Data disk drives that are attached tooa VM use write-through caching.</span></span> <span data-ttu-id="6e8b5-646">直接寫入式快取會確定 hello 寫入認可的 toodurable Azure 儲存體之前會 hello 交易已完成從 hello 觀點來看的 hello VM 的作業系統。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-646">Write-through caching makes sure hello write is committed toodurable Azure storage before hello transaction is complete from hello perspective of hello VM’s operating system.</span></span> <span data-ttu-id="6e8b5-647">它提供在 hello 費用的稍微慢一點寫入的持久性。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-647">It provides durability, at hello expense of slightly slower writes.</span></span>

<span data-ttu-id="6e8b5-648">這是很重要的 Windows Server AD DS，因為貫穿式寫入磁碟快取失效 hello DC 所做的假設。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-648">This is important for Windows Server AD DS because write-behind disk-caching invalidates assumptions made by hello DC.</span></span> <span data-ttu-id="6e8b5-649">Windows Server AD DS 會嘗試 toodisable 寫入快取，但它已啟動 toohello 磁碟 IO 系統 toohonor 它。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-649">Windows Server AD DS attempts toodisable write caching but it is up toohello disk IO system toohonor it.</span></span> <span data-ttu-id="6e8b5-650">失敗 toodisable 寫入快取，在某些情況下，會引進 USN 回復導致物件逗留和其他問題。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-650">Failure toodisable write caching may, under certain circumstances, introduce USN rollback resulting in lingering objects and other problems.</span></span>

<span data-ttu-id="6e8b5-651">對虛擬 Dc 的最佳作法是，不要 hello 遵循：</span><span class="sxs-lookup"><span data-stu-id="6e8b5-651">As a best practice for virtual DCs, do hello following:</span></span>

* <span data-ttu-id="6e8b5-652">Hello 主機快取喜好設定設為 無 hello Azure 資料磁碟。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-652">Set hello Host Cache Preference setting on hello Azure data disk for NONE.</span></span> <span data-ttu-id="6e8b5-653">這可避免 AD DS 作業的寫入快取問題。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-653">This prevents issues with write caching for AD DS operations.</span></span>
* <span data-ttu-id="6e8b5-654">Hello 相同的資料磁碟或不同的資料磁碟上儲存 hello 資料庫、 記錄檔和 SYSVOL。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-654">Store hello database, logs, and SYSVOL on hello either same data disk or separate data disks.</span></span> <span data-ttu-id="6e8b5-655">一般而言，這是用於 hello 作業系統本身的 hello 磁碟從不同的磁碟。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-655">Typically, this is a separate disk from hello disk used for hello operating system itself.</span></span> <span data-ttu-id="6e8b5-656">hello 重點就是該 hello Windows Server AD DS 資料庫和 SYSVOL 不得儲存在 Azure 作業系統磁碟類型。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-656">hello key takeaway is that hello Windows Server AD DS database and SYSVOL must not be stored on an Azure Operating System disk type.</span></span> <span data-ttu-id="6e8b5-657">根據預設，hello AD DS 安裝程序會安裝這些元件在 %systemroot%資料夾，但是不建議在 Azure 中。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-657">By default, hello AD DS installation process installs these components in %systemroot% folder, which is NOT recommended for Azure.</span></span>

### <span data-ttu-id="6e8b5-658"><a name="BKMK_BUR"></a>備份與還原</span><span class="sxs-lookup"><span data-stu-id="6e8b5-658"><a name="BKMK_BUR"></a>Backup and restore</span></span>
<span data-ttu-id="6e8b5-659">請注意通常對於 DC 的備份與還原支援和不支援的項目，具體而言，就是在 VM 中執行的項目。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-659">Be aware of what is and is not supported for backup and restore of a DC in general, and more specifically, those running in a VM.</span></span> <span data-ttu-id="6e8b5-660">請參閱 [虛擬化 DC 的備份與還原考量](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv#backup_and_restore_considerations_for_virtualized_domain_controllers)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-660">See [Backup and Restore Considerations for Virtualized DCs](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv#backup_and_restore_considerations_for_virtualized_domain_controllers).</span></span>

<span data-ttu-id="6e8b5-661">建立系統狀態備份，方法是只使用特別知道 Windows Server AD DS 的備份需求的備份軟體，例如 Windows Server Backup。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-661">Create system state backups by using only backup software that is specifically aware of backup requirements for Windows Server AD DS, such as Windows Server Backup.</span></span>

<span data-ttu-id="6e8b5-662">請勿複製 (copy) 或複製 (clone) DC 的 VHD 檔案，而是執行定期備份。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-662">Do not copy or clone VHD files of DCs instead of performing regular backups.</span></span> <span data-ttu-id="6e8b5-663">如果需要還原，使用複製的 VHD 而未使用 Windows Server 2012 和支援的 hypervisor 會產生 USN 泡沫。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-663">Should a restore ever be required, doing so using cloned or copied VHDs without Windows Server 2012 and a supported hypervisor will introduce USN bubbles.</span></span>

### <span data-ttu-id="6e8b5-664"><a name="BKMK_FedSrvConfig"></a>同盟伺服器組態</span><span class="sxs-lookup"><span data-stu-id="6e8b5-664"><a name="BKMK_FedSrvConfig"></a>Federation server configuration</span></span>
<span data-ttu-id="6e8b5-665">Windows Server AD FS 同盟伺服器 (Sts) 的 hello 組態部分取決於 hello 應用程式是否要在 Azure 上的 toodeploy 需要 tooaccess 在內部部署網路上的資源。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-665">hello configuration of Windows Server AD FS federation servers (STSs) depends in part on whether hello applications that you want toodeploy on Azure need tooaccess resources on your on-premises network.</span></span>

<span data-ttu-id="6e8b5-666">如果 hello 應用程式符合下列準則的 hello，您可以從您的內部網路部署 hello 中隔離的應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-666">If hello applications meet hello following criteria, you could deploy hello applications in isolation from your on-premises network.</span></span>

* <span data-ttu-id="6e8b5-667">它們接受 SAML 安全性權杖</span><span class="sxs-lookup"><span data-stu-id="6e8b5-667">They accept SAML security tokens</span></span>
* <span data-ttu-id="6e8b5-668">它們是 exposable toohello 網際網路</span><span class="sxs-lookup"><span data-stu-id="6e8b5-668">They are exposable toohello Internet</span></span>
* <span data-ttu-id="6e8b5-669">它們不會存取內部部署資源</span><span class="sxs-lookup"><span data-stu-id="6e8b5-669">They do not access on-premises resources</span></span>

<span data-ttu-id="6e8b5-670">在此情況下，設定 Windows Server AD FS STS，如下所示︰</span><span class="sxs-lookup"><span data-stu-id="6e8b5-670">In this case, configure Windows Server AD FS STSs as follows:</span></span>

1. <span data-ttu-id="6e8b5-671">在 Azure 上設定隔離的單一網域樹系。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-671">Configure an isolated single-domain forest on Azure.</span></span>
2. <span data-ttu-id="6e8b5-672">藉由設定 Windows Server AD FS 同盟伺服器陣列中提供同盟的存取 toohello 樹系。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-672">Provide federated access toohello forest by configuring a Windows Server AD FS federation server farm.</span></span>
3. <span data-ttu-id="6e8b5-673">Hello 在內部部署樹系中設定 Windows Server AD FS （同盟伺服器陣列和同盟伺服器 proxy 伺服器陣列）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-673">Configure Windows Server AD FS (federation server farm and federation server proxy farm) in hello on-premises forest.</span></span>
4. <span data-ttu-id="6e8b5-674">建立 hello 內部部署與 Windows Server AD FS 的 Azure 執行個體之間的同盟信任關係。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-674">Establish a federation trust relationship between hello on-premises and Azure instances of Windows Server AD FS.</span></span>

<span data-ttu-id="6e8b5-675">在 hello 另一方面，如果 hello 應用程式需要存取 tooon 內部部署資源，您可以設定 Windows Server AD FS 與 Azure 上的 hello 應用程式，如下所示：</span><span class="sxs-lookup"><span data-stu-id="6e8b5-675">On hello other hand, if hello applications require access tooon-premises resources, you could configure Windows Server AD FS with hello application on Azure as follows:</span></span>

1. <span data-ttu-id="6e8b5-676">設定內部部署網路與 Azure 之間的連接。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-676">Configure connectivity between on-premises networks and Azure.</span></span>
2. <span data-ttu-id="6e8b5-677">Hello 在內部部署樹系中設定 Windows Server AD FS 同盟伺服器陣列。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-677">Configure a Windows Server AD FS federation server farm in hello on-premises forest.</span></span>
3. <span data-ttu-id="6e8b5-678">在 Azure 上設定 Windows Server AD FS 同盟伺服器 Proxy 伺服器陣列。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-678">Configure a Windows Server AD FS federation server proxy farm on Azure.</span></span>

<span data-ttu-id="6e8b5-679">這個組態具有減少 hello 暴露在內部部署資源的類似 tooconfiguring Windows Server AD FS 與應用程式在周邊網路中的 hello 優點。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-679">This configuration has hello advantage of reducing hello exposure of on-premises resources, similar tooconfiguring Windows Server AD FS with applications in a perimeter network.</span></span>

<span data-ttu-id="6e8b5-680">請注意，在任一案例中，如果需要企業對企業共同作業，您可以建立具有多個識別提供者的信任關係。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-680">Note that in either scenario, you can establish trusts relationships with more identity providers, if business-to-business collaboration is needed.</span></span>

### <span data-ttu-id="6e8b5-681"><a name="BKMK_CloudSvcConfig"></a>雲端服務組態</span><span class="sxs-lookup"><span data-stu-id="6e8b5-681"><a name="BKMK_CloudSvcConfig"></a>Cloud services configuration</span></span>
<span data-ttu-id="6e8b5-682">雲端服務所需，如果您想 tooexpose VM 直接 toohello 網際網路或 tooexpose 網際網路對向負載平衡應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-682">Cloud services are necessary if you want tooexpose a VM directly toohello Internet or tooexpose an Internet-facing load-balanced application.</span></span> <span data-ttu-id="6e8b5-683">這是可行的，因為每個雲端服務提供一個可設定虛擬 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-683">This is possible because each cloud service offers a single configurable virtual IP address.</span></span>

### <span data-ttu-id="6e8b5-684"><a name="BKMK_FedReqVIPDIP"></a>公用和私人 IP 位址 (動態 IP 與虛擬 IP) 的同盟伺服器需求</span><span class="sxs-lookup"><span data-stu-id="6e8b5-684"><a name="BKMK_FedReqVIPDIP"></a>Federation server requirements for public and private IP addressing (dynamic IP vs. virtual IP)</span></span>
<span data-ttu-id="6e8b5-685">每個 Azure 虛擬機器會接收動態 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-685">Each Azure virtual machine receives a dynamic IP address.</span></span> <span data-ttu-id="6e8b5-686">動態 IP 位址是只能在 Azure 中存取的私人位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-686">A dynamic IP address is a private address accessible only within Azure.</span></span> <span data-ttu-id="6e8b5-687">不過，在大部分情況下，它將會需要 tooconfigure Windows Server AD FS 部署的虛擬 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-687">In most cases, however, it will be necessary tooconfigure a virtual IP address for your Windows Server AD FS deployments.</span></span> <span data-ttu-id="6e8b5-688">hello 虛擬 IP 必要 tooexpose Windows Server AD FS 端點 toohello 網際網路，並將用於同盟的合作夥伴和用戶端驗證和持續管理。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-688">hello virtual IP is necessary tooexpose Windows Server AD FS endpoints toohello Internet, and will be used by federated partners and clients for authentication and ongoing management.</span></span> <span data-ttu-id="6e8b5-689">虛擬 IP 位址是雲端服務的屬性，該雲端服務包含一或多個 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-689">A virtual IP address is a property of a cloud service which contains one or more Azure virtual machines.</span></span> <span data-ttu-id="6e8b5-690">如果在 Azure 和 Windows Server AD FS 上部署的 hello 宣告感知應用程式面對網際網路並且共用共同的連接埠，都需要自己的虛擬 IP 位址，它將因此需要 toocreate hello 應用程式的一個雲端服務和第二個為 Windows Server AD FS。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-690">If hello claims-aware application deployed on Azure and Windows Server AD FS are both Internet-facing and share common ports, each will require a virtual IP address of its own and it will therefore be necessary toocreate one cloud service for hello application and a second for Windows Server AD FS.</span></span>

<span data-ttu-id="6e8b5-691">Hello 條款虛擬 IP 位址和動態 IP 位址的定義，請參閱[詞彙和定義](#BKMK_Glossary)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-691">For definitions of hello terms virtual IP address and dynamic IP address, see [Terms and definitions](#BKMK_Glossary).</span></span>

### <span data-ttu-id="6e8b5-692"><a name="BKMK_ADFSHighAvail"></a>Windows Server AD FS 高可用性組態</span><span class="sxs-lookup"><span data-stu-id="6e8b5-692"><a name="BKMK_ADFSHighAvail"></a>Windows Server AD FS high availability configuration</span></span>
<span data-ttu-id="6e8b5-693">雖然可能 toodeploy 獨立 Windows Server AD FS 同盟服務，它會建議使用 toodeploy 包含至少兩個節點的伺服陣列 AD FS STS 和生產環境的 proxy。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-693">While it is possible toodeploy standalone Windows Server AD FS federation services, it is recommended toodeploy a farm with at least two nodes for both AD FS STS and proxies for production environments.</span></span>

<span data-ttu-id="6e8b5-694">請參閱[AD FS 2.0 部署拓撲考量](https://technet.microsoft.com/library/gg982489)在 hello [AD FS 2.0 設計指南](https://technet.microsoft.com/library/dd807036)toodecide 的部署組態選項最適合您的特定需求。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-694">See [AD FS 2.0 deployment topology considerations](https://technet.microsoft.com/library/gg982489) in hello [AD FS 2.0 Design Guide](https://technet.microsoft.com/library/dd807036) toodecide which deployment configuration options best suit your particular needs.</span></span>

> [!NOTE]
> <span data-ttu-id="6e8b5-695">順序 tooget 負載平衡中在 Azure 上、 Windows Server AD FS 端點設定 hello hello Windows Server AD FS 伺服器陣列的所有成員相同雲端服務，而使用 hello 負載平衡的 Azure 功能的 HTTP （預設值 80） 和 HTTPS 連接埠 （預設為 443）。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-695">In order tooget load balancing for Windows Server AD FS endpoints on Azure, configure all members of hello Windows Server AD FS farm in hello same cloud service, and use hello load balancing capability of Azure for HTTP (default 80) and HTTPS ports (default 443).</span></span> <span data-ttu-id="6e8b5-696">如需詳細資訊，請參閱 [Azure 負載平衡器探查](https://msdn.microsoft.com/library/azure/jj151530)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-696">For more information, see [Azure load-balancer probe](https://msdn.microsoft.com/library/azure/jj151530).</span></span>
> <span data-ttu-id="6e8b5-697">Azure 不支援 Windows Server 網路負載平衡 (NLB)。</span><span class="sxs-lookup"><span data-stu-id="6e8b5-697">Windows Server Network Load Balancing (NLB) is not supported on Azure.</span></span>
> 
> 

