---
title: "雲端服務配置失敗 aaaTroubleshooting |Microsoft 文件"
description: "疑難排解在 Azure 中部署雲端服務時發生的配置失敗"
services: azure-service-management, cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 529157eb-e4a1-4388-aa2b-09e8b923af74
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: dfd5cc4663ccc6ed1b27ca9df579182737363b0e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-allocation-failure-when-you-deploy-cloud-services-in-azure"></a><span data-ttu-id="a82d0-103">疑難排解在 Azure 中部署雲端服務時發生的配置失敗</span><span class="sxs-lookup"><span data-stu-id="a82d0-103">Troubleshooting allocation failure when you deploy Cloud Services in Azure</span></span>
## <a name="summary"></a><span data-ttu-id="a82d0-104">摘要</span><span class="sxs-lookup"><span data-stu-id="a82d0-104">Summary</span></span>
<span data-ttu-id="a82d0-105">當您部署雲端服務的執行個體 tooa 或加入新的 web 或背景工作角色執行個體時，Microsoft Azure 配置計算資源。</span><span class="sxs-lookup"><span data-stu-id="a82d0-105">When you deploy instances tooa Cloud Service or add new web or worker role instances, Microsoft Azure allocates compute resources.</span></span> <span data-ttu-id="a82d0-106">您到達 hello Azure 訂用帳戶限制之前執行這些作業時，您偶爾可能會收到錯誤。</span><span class="sxs-lookup"><span data-stu-id="a82d0-106">You may occasionally receive errors when performing these operations even before you reach hello Azure subscription limits.</span></span> <span data-ttu-id="a82d0-107">本文說明 hello 一些 hello 的一般配置失敗的原因，並建議可能的補救措施。</span><span class="sxs-lookup"><span data-stu-id="a82d0-107">This article explains hello causes of some of hello common allocation failures and suggests possible remediation.</span></span> <span data-ttu-id="a82d0-108">當您計劃 hello 部署您的服務，hello 資訊可能也很有用。</span><span class="sxs-lookup"><span data-stu-id="a82d0-108">hello information may also be useful when you plan hello deployment of your services.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

### <a name="background--how-allocation-works"></a><span data-ttu-id="a82d0-109">背景 – 配置的運作方式</span><span class="sxs-lookup"><span data-stu-id="a82d0-109">Background – How allocation works</span></span>
<span data-ttu-id="a82d0-110">在 Azure 資料中心的 hello 伺服器會分割成叢集。</span><span class="sxs-lookup"><span data-stu-id="a82d0-110">hello servers in Azure datacenters are partitioned into clusters.</span></span> <span data-ttu-id="a82d0-111">在多個叢集中嘗試新的雲端服務配置要求。</span><span class="sxs-lookup"><span data-stu-id="a82d0-111">A new cloud service allocation request is attempted in multiple clusters.</span></span> <span data-ttu-id="a82d0-112">Hello 第一個執行個體與部署的 tooa 雲端服務 （在預備環境或生產），為雲端服務時取得釘選的 tooa 叢集。</span><span class="sxs-lookup"><span data-stu-id="a82d0-112">When hello first instance is deployed tooa cloud service(in either staging or production), that cloud service gets pinned tooa cluster.</span></span> <span data-ttu-id="a82d0-113">任何其他部署的 hello 雲端服務將會發生在 hello 相同叢集。</span><span class="sxs-lookup"><span data-stu-id="a82d0-113">Any further deployments for hello cloud service will happen in hello same cluster.</span></span> <span data-ttu-id="a82d0-114">在本文中，我們將參照 toothis 為 「 已釘選的 tooa 叢集 」。</span><span class="sxs-lookup"><span data-stu-id="a82d0-114">In this article, we'll refer toothis as "pinned tooa cluster".</span></span> <span data-ttu-id="a82d0-115">下面圖 1 說明 hello 案例的標準配置，而不會嘗試在多個叢集。圖 2 說明 hello 裝載的已釘選的 tooCluster 2，其中是 hello 現有雲端服務 CS_1 因為發生配置的大小寫。</span><span class="sxs-lookup"><span data-stu-id="a82d0-115">Diagram 1 below illustrates hello case of a normal allocation which is attempted in multiple clusters; Diagram 2 illustrates hello case of an allocation that's pinned tooCluster 2 because that's where hello existing Cloud Service CS_1 is hosted.</span></span>

![配置圖表](./media/cloud-services-allocation-failure/Allocation1.png)

### <a name="why-allocation-failure-happens"></a><span data-ttu-id="a82d0-117">配置失敗的原因</span><span class="sxs-lookup"><span data-stu-id="a82d0-117">Why allocation failure happens</span></span>
<span data-ttu-id="a82d0-118">釘選的 tooa 叢集配置要求時，有更高版本可能會因為 hello 可用的資源集區是有限的 tooa 叢集失敗 toofind 釋出資源。</span><span class="sxs-lookup"><span data-stu-id="a82d0-118">When an allocation request is pinned tooa cluster, there's a higher chance of failing toofind free resources since hello available resource pool is limited tooa cluster.</span></span> <span data-ttu-id="a82d0-119">此外，如果您配置的要求是已釘選的 tooa 叢集但 hello 您要求的資源類型不支援該叢集，您的要求將會失敗，hello 叢集在沒有可用的資源。</span><span class="sxs-lookup"><span data-stu-id="a82d0-119">Furthermore, if your allocation request is pinned tooa cluster but hello type of resource you requested is not supported by that cluster, your request will fail even if hello cluster has free resource.</span></span> <span data-ttu-id="a82d0-120">圖 3 說明 hello 案例，其中已釘選的配置失敗，因為 hello 只有候選叢集沒有可用的資源。</span><span class="sxs-lookup"><span data-stu-id="a82d0-120">Diagram 3 below illustrates hello case where a pinned allocation fails because hello only candidate cluster does not have free resources.</span></span> <span data-ttu-id="a82d0-121">圖 4 說明其中釘選的配置失敗，因為只有候選群集 hello 不支援的 hello 情況 hello 即使 hello 叢集已釋放資源，請要求 VM 大小。</span><span class="sxs-lookup"><span data-stu-id="a82d0-121">Diagram 4 illustrates hello case where a pinned allocation fails because hello only candidate cluster does not support hello requested VM size, even though hello cluster has free resources.</span></span>

![釘選配置失敗](./media/cloud-services-allocation-failure/Allocation2.png)

## <a name="troubleshooting-allocation-failure-for-cloud-services"></a><span data-ttu-id="a82d0-123">雲端服務配置失敗的疑難排解</span><span class="sxs-lookup"><span data-stu-id="a82d0-123">Troubleshooting allocation failure for cloud services</span></span>
### <a name="error-message"></a><span data-ttu-id="a82d0-124">錯誤訊息</span><span class="sxs-lookup"><span data-stu-id="a82d0-124">Error Message</span></span>
<span data-ttu-id="a82d0-125">您可能會看到下列錯誤訊息的 hello:</span><span class="sxs-lookup"><span data-stu-id="a82d0-125">You may see hello following error message:</span></span>

    "Azure operation '{operation id}' failed with code Compute.ConstrainedAllocationFailed. Details: Allocation failed; unable toosatisfy constraints in request. hello requested new service deployment is bound tooan Affinity Group, or it targets a Virtual Network, or there is an existing deployment under this hosted service. Any of these conditions constrains hello new deployment toospecific Azure resources. Please retry later or try reducing hello VM size or number of role instances. Alternatively, if possible, remove hello aforementioned constraints or try deploying tooa different region."

### <a name="common-issues"></a><span data-ttu-id="a82d0-126">常見問題</span><span class="sxs-lookup"><span data-stu-id="a82d0-126">Common Issues</span></span>
<span data-ttu-id="a82d0-127">以下是 hello 配置的常見案例會造成配置要求 toobe 釘選的 tooa 單一叢集。</span><span class="sxs-lookup"><span data-stu-id="a82d0-127">Here are hello common allocation scenarios that cause an allocation request toobe pinned tooa single cluster.</span></span>

* <span data-ttu-id="a82d0-128">部署 tooStaging 位置-如果雲端服務部署中任一個位置，然後 hello 整個雲端服務是已釘選的 tooa 特定叢集。</span><span class="sxs-lookup"><span data-stu-id="a82d0-128">Deploying tooStaging Slot - If a cloud service has a deployment in either slot, then hello entire cloud service is pinned tooa specific cluster.</span></span>  <span data-ttu-id="a82d0-129">這表示，如果部署已經存在於 hello 生產位置，然後新的預備環境部署只可配置在 hello 相同叢集為 hello 生產位置。</span><span class="sxs-lookup"><span data-stu-id="a82d0-129">This means that if a deployment already exists in hello production slot, then a new staging deployment can only be allocated in hello same cluster as hello production slot.</span></span> <span data-ttu-id="a82d0-130">如果 hello 叢集已接近其容量，hello 要求可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="a82d0-130">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="a82d0-131">調整-加入新執行個體 tooan 現有的雲端服務必須配置中的 hello 相同叢集。</span><span class="sxs-lookup"><span data-stu-id="a82d0-131">Scaling - Adding new instances tooan existing cloud service must allocate in hello same cluster.</span></span>  <span data-ttu-id="a82d0-132">小型的調整要求通常可配置，但並不盡然。</span><span class="sxs-lookup"><span data-stu-id="a82d0-132">Small scaling requests can usually be allocated, but not always.</span></span> <span data-ttu-id="a82d0-133">如果 hello 叢集已接近其容量，hello 要求可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="a82d0-133">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="a82d0-134">親和性群組-新的部署 tooan 空的雲端服務可以將任何在該區域中，叢集中的 hello 網狀架構由配置，除非 hello 雲端服務是已釘選的 tooan 同質群組。</span><span class="sxs-lookup"><span data-stu-id="a82d0-134">Affinity Group - A new deployment tooan empty cloud service can be allocated by hello fabric in any cluster in that region, unless hello cloud service is pinned tooan affinity group.</span></span> <span data-ttu-id="a82d0-135">部署 toohello 相同同質群組將會在 hello 嘗試相同的叢集。</span><span class="sxs-lookup"><span data-stu-id="a82d0-135">Deployments toohello same affinity group will be attempted on hello same cluster.</span></span> <span data-ttu-id="a82d0-136">如果 hello 叢集已接近其容量，hello 要求可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="a82d0-136">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="a82d0-137">同質群組 vNet 的較舊的虛擬網路繫結的 tooaffinity 群組，而不是地區，而且這些虛擬網路中的雲端服務會釘選的 toohello 同質群組的叢集。</span><span class="sxs-lookup"><span data-stu-id="a82d0-137">Affinity Group vNet - Older Virtual Networks were tied tooaffinity groups instead of regions, and cloud services in these Virtual Networks would be pinned toohello affinity group cluster.</span></span> <span data-ttu-id="a82d0-138">釘選的 hello 叢集上，將會嘗試部署的虛擬網路的 toothis 類型。</span><span class="sxs-lookup"><span data-stu-id="a82d0-138">Deployments toothis type of virtual network will be attempted on hello pinned cluster.</span></span> <span data-ttu-id="a82d0-139">如果 hello 叢集已接近其容量，hello 要求可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="a82d0-139">If hello cluster is nearing capacity, hello request may fail.</span></span>

## <a name="solutions"></a><span data-ttu-id="a82d0-140">解決方案</span><span class="sxs-lookup"><span data-stu-id="a82d0-140">Solutions</span></span>
1. <span data-ttu-id="a82d0-141">重新部署 tooa 新的雲端服務-此解決方案為它可讓所有的叢集，在該區域中的 hello 平台 toochoose 可能 toobe 最成功。</span><span class="sxs-lookup"><span data-stu-id="a82d0-141">Redeploy tooa new cloud service - This solution is likely toobe most successful as it allows hello platform toochoose from all clusters in that region.</span></span>

   * <span data-ttu-id="a82d0-142">Hello 工作負載 tooa 新雲端服務部署</span><span class="sxs-lookup"><span data-stu-id="a82d0-142">Deploy hello workload tooa new cloud service</span></span>  
   * <span data-ttu-id="a82d0-143">更新 hello 或 CNAME 記錄 toopoint 流量 toohello 新的雲端服務</span><span class="sxs-lookup"><span data-stu-id="a82d0-143">Update hello CNAME or A record toopoint traffic toohello new cloud service</span></span>
   * <span data-ttu-id="a82d0-144">一旦零流量即將 toohello 舊的站台，您可以刪除 hello 舊的雲端服務。</span><span class="sxs-lookup"><span data-stu-id="a82d0-144">Once zero traffic is going toohello old site, you can delete hello old cloud service.</span></span> <span data-ttu-id="a82d0-145">此解決方案不需要停機。</span><span class="sxs-lookup"><span data-stu-id="a82d0-145">This solution should incur zero downtime.</span></span>
2. <span data-ttu-id="a82d0-146">刪除生產和預備位置-這個解決方案將會保留現有的 DNS 名稱，但會導致停機時間 tooyour 應用程式。</span><span class="sxs-lookup"><span data-stu-id="a82d0-146">Delete both production and staging slots - This solution will preserve your existing DNS name, but will cause downtime tooyour application.</span></span>

   * <span data-ttu-id="a82d0-147">刪除 hello 生產和預備位置的現有雲端服務，以便 hello 雲端服務是空的然後按一下</span><span class="sxs-lookup"><span data-stu-id="a82d0-147">Delete hello production and staging slots of an existing cloud service so that hello cloud service is empty, and then</span></span>
   * <span data-ttu-id="a82d0-148">Hello 現有雲端服務中建立新的部署。</span><span class="sxs-lookup"><span data-stu-id="a82d0-148">Create a new deployment in hello existing cloud service.</span></span> <span data-ttu-id="a82d0-149">這會重新嘗試 tooallocation hello 區域中的所有叢集上。</span><span class="sxs-lookup"><span data-stu-id="a82d0-149">This will re-attempt tooallocation on all clusters in hello region.</span></span> <span data-ttu-id="a82d0-150">確定 hello 雲端服務不是繫結的 tooan 同質群組。</span><span class="sxs-lookup"><span data-stu-id="a82d0-150">Ensure hello cloud service is not tied tooan affinity group.</span></span>
3. <span data-ttu-id="a82d0-151">保留的 IP-此方案將會保留您現有的 IP 位址，但是會造成停機時間 tooyour 應用程式。</span><span class="sxs-lookup"><span data-stu-id="a82d0-151">Reserved IP -  This solution will preserve your existing IP address, but will cause downtime tooyour application.</span></span>  

   * <span data-ttu-id="a82d0-152">使用 Powershell 為您現有的部署建立 ReservedIP</span><span class="sxs-lookup"><span data-stu-id="a82d0-152">Create a ReservedIP for your existing deployment using Powershell</span></span>

     ```
     New-AzureReservedIP -ReservedIPName {new reserved IP name} -Location {location} -ServiceName {existing service name}
     ```
   * <span data-ttu-id="a82d0-153">請遵循 corresponding，進行確定 toospecify hello hello 服務 CSCFG 中新的 ReservedIP #2。</span><span class="sxs-lookup"><span data-stu-id="a82d0-153">Follow #2 from above, making sure toospecify hello new ReservedIP in hello service's CSCFG.</span></span>
4. <span data-ttu-id="a82d0-154">移除新部署中的同質群組 - 不再建議使用同質群組。</span><span class="sxs-lookup"><span data-stu-id="a82d0-154">Remove affinity group for new deployments - Affinity Groups are no longer recommended.</span></span> <span data-ttu-id="a82d0-155">請遵循上面 toodeploy 新的雲端服務的 #1 的步驟。</span><span class="sxs-lookup"><span data-stu-id="a82d0-155">Follow steps for #1 above toodeploy a new cloud service.</span></span> <span data-ttu-id="a82d0-156">請確定雲端服務不在同質群組中。</span><span class="sxs-lookup"><span data-stu-id="a82d0-156">Ensure cloud service is not in an affinity group.</span></span>
5. <span data-ttu-id="a82d0-157">轉換 tooa 區域虛擬網路-請參閱[如何從同質群組 tooa 區域虛擬網路 (VNet) toomigrate](../virtual-network/virtual-networks-migrate-to-regional-vnet.md)。</span><span class="sxs-lookup"><span data-stu-id="a82d0-157">Convert tooa Regional Virtual Network - See [How toomigrate from Affinity Groups tooa Regional Virtual Network (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span></span>
