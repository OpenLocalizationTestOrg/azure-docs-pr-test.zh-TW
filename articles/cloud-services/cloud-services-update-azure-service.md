---
title: "aaaHow tooupdate 雲端服務 |Microsoft 文件"
description: "了解 tooupdate 雲端服務在 Azure 中的方式。 了解如何更新雲端服務上的繼續 tooensure 可用性。"
services: cloud-services
documentationcenter: 
author: Thraka
manager: timlt
editor: 
ms.assetid: c6a8b5e6-5c99-454c-9911-5c7ae8d1af63
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/19/2017
ms.author: adegeo
ms.openlocfilehash: 7e4c8bd46e51a555b4309ea8927d120e8efcf0ea
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooupdate-a-cloud-service"></a><span data-ttu-id="009e6-104">如何 tooupdate 雲端服務</span><span class="sxs-lookup"><span data-stu-id="009e6-104">How tooupdate a cloud service</span></span>

<span data-ttu-id="009e6-105">更新雲端服務 (包括其角色和客體 OS) 是一個包含三步驟的程序。</span><span class="sxs-lookup"><span data-stu-id="009e6-105">Updating a cloud service, including both its roles and guest OS, is a three step process.</span></span> <span data-ttu-id="009e6-106">首先，hello 二進位檔和組態檔 hello 新雲端服務，或必須上傳的作業系統版本。</span><span class="sxs-lookup"><span data-stu-id="009e6-106">First, hello binaries and configuration files for hello new cloud service or OS version must be uploaded.</span></span> <span data-ttu-id="009e6-107">接下來，Azure 會保留運算和網路資源 hello hello hello 新雲端服務版本需求為基礎的雲端服務。</span><span class="sxs-lookup"><span data-stu-id="009e6-107">Next, Azure reserves compute and network resources for hello cloud service based on hello requirements of hello new cloud service version.</span></span> <span data-ttu-id="009e6-108">最後，Azure 會執行輪流升級 tooincrementally 更新 hello 租用戶 toohello 新版本或客體作業系統，同時保留您的可用性。</span><span class="sxs-lookup"><span data-stu-id="009e6-108">Finally, Azure performs a rolling upgrade tooincrementally update hello tenant toohello new version or guest OS, while preserving your availability.</span></span> <span data-ttu-id="009e6-109">本文討論最後一個步驟-hello 輪流升級的 hello 詳細的資料。</span><span class="sxs-lookup"><span data-stu-id="009e6-109">This article discusses hello details of this last step – hello rolling upgrade.</span></span>

## <a name="update-an-azure-service"></a><span data-ttu-id="009e6-110">更新 Azure 服務</span><span class="sxs-lookup"><span data-stu-id="009e6-110">Update an Azure Service</span></span>
<span data-ttu-id="009e6-111">Azure 會將您的角色執行個體組織成名為升級網域 (UD) 的邏輯群組。</span><span class="sxs-lookup"><span data-stu-id="009e6-111">Azure organizes your role instances into logical groupings called upgrade domains (UD).</span></span> <span data-ttu-id="009e6-112">升級網域 (UD) 是角色執行個體的邏輯集合，會以群組方式進行更新。</span><span class="sxs-lookup"><span data-stu-id="009e6-112">Upgrade domains (UD) are logical sets of role instances that are updated as a group.</span></span>  <span data-ttu-id="009e6-113">Azure 雲端的更新一次，可讓執行個體中其他處理流量的 Ud toocontinue 服務一個 UD。</span><span class="sxs-lookup"><span data-stu-id="009e6-113">Azure updates a cloud service one UD at a time, which allows instances in other UDs toocontinue serving traffic.</span></span>

<span data-ttu-id="009e6-114">升級網域的 hello 預設數目為 5。</span><span class="sxs-lookup"><span data-stu-id="009e6-114">hello default number of upgrade domains is 5.</span></span> <span data-ttu-id="009e6-115">您可以指定不同數目的升級網域包括 hello 服務定義檔 (.csdef) 中的 hello upgradeDomainCount 屬性。</span><span class="sxs-lookup"><span data-stu-id="009e6-115">You can specify a different number of upgrade domains by including hello upgradeDomainCount attribute in hello service’s definition file (.csdef).</span></span> <span data-ttu-id="009e6-116">如需 hello upgradeDomainCount 屬性的詳細資訊，請參閱[WebRole 結構描述](https://msdn.microsoft.com/library/azure/gg557553.aspx)或[WorkerRole 結構描述](https://msdn.microsoft.com/library/azure/gg557552.aspx)。</span><span class="sxs-lookup"><span data-stu-id="009e6-116">For more information about hello upgradeDomainCount attribute, see [WebRole Schema](https://msdn.microsoft.com/library/azure/gg557553.aspx) or [WorkerRole Schema](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span></span>

<span data-ttu-id="009e6-117">當您在您的服務執行的一個或多個角色的就地更新時，Azure 會更新依據 toohello 升級網域 toowhich 所隸屬的角色執行個體的集合。</span><span class="sxs-lookup"><span data-stu-id="009e6-117">When you perform an in-place update of one or more roles in your service, Azure updates sets of role instances according toohello upgrade domain toowhich they belong.</span></span> <span data-ttu-id="009e6-118">Azure hello 中所有執行個體指定的升級網域 – 加以停止、 更新，將它們放回線上的更新，然後移到 hello 下一個網域。</span><span class="sxs-lookup"><span data-stu-id="009e6-118">Azure updates all of hello instances in a given upgrade domain – stopping them, updating them, bringing them back on-line – then moves onto hello next domain.</span></span> <span data-ttu-id="009e6-119">透過停止目前的 hello 中執行的唯一 hello 執行個體的升級網域時，Azure 可確保進行更新時 hello 執行服務最低可能影響 toohello。</span><span class="sxs-lookup"><span data-stu-id="009e6-119">By stopping only hello instances running in hello current upgrade domain, Azure makes sure that an update occurs with hello least possible impact toohello running service.</span></span> <span data-ttu-id="009e6-120">如需詳細資訊，請參閱[hello 更新，如何繼續](#howanupgradeproceeds)本文稍後。</span><span class="sxs-lookup"><span data-stu-id="009e6-120">For more information, see [How hello update proceeds](#howanupgradeproceeds) later in this article.</span></span>

> [!NOTE]
> <span data-ttu-id="009e6-121">雖然 hello 條款**更新**和**升級**hello 內容 Azure 中有稍微不同的意義，但它們可以交替 hello 程序和本文件中的 hello 功能的描述。</span><span class="sxs-lookup"><span data-stu-id="009e6-121">While hello terms **update** and **upgrade** have slightly different meaning in hello context Azure, they can be used interchangeably for hello processes and descriptions of hello features in this document.</span></span>
>
>

<span data-ttu-id="009e6-122">您的服務必須定義至少兩個該角色更新 toobe 就地而無需停機的角色執行個體。</span><span class="sxs-lookup"><span data-stu-id="009e6-122">Your service must define at least two instances of a role for that role toobe updated in-place without downtime.</span></span> <span data-ttu-id="009e6-123">如果 hello 服務包含一個角色只有一個執行個體，您的服務將無法使用，直到 hello 就地更新已完成。</span><span class="sxs-lookup"><span data-stu-id="009e6-123">If hello service consists of only one instance of one role, your service will be unavailable until hello in-place update has finished.</span></span>

<span data-ttu-id="009e6-124">本主題涵蓋下列 Azure 更新的相關資訊的 hello:</span><span class="sxs-lookup"><span data-stu-id="009e6-124">This topic covers hello following information about Azure updates:</span></span>

* [<span data-ttu-id="009e6-125">在更新期間允許的服務變更</span><span class="sxs-lookup"><span data-stu-id="009e6-125">Allowed service changes during an update</span></span>](#AllowedChanges)
* [<span data-ttu-id="009e6-126">如何繼續進行升級</span><span class="sxs-lookup"><span data-stu-id="009e6-126">How an upgrade proceeds</span></span>](#howanupgradeproceeds)
* [<span data-ttu-id="009e6-127">復原更新</span><span class="sxs-lookup"><span data-stu-id="009e6-127">Rollback of an update</span></span>](#RollbackofanUpdate)
* [<span data-ttu-id="009e6-128">在進行中的部署上起始多項變更作業</span><span class="sxs-lookup"><span data-stu-id="009e6-128">Initiating multiple mutating operations on an ongoing deployment</span></span>](#multiplemutatingoperations)
* [<span data-ttu-id="009e6-129">將角色散發於升級網域</span><span class="sxs-lookup"><span data-stu-id="009e6-129">Distribution of roles across upgrade domains</span></span>](#distributiondfroles)

<a name="AllowedChanges"></a>

## <a name="allowed-service-changes-during-an-update"></a><span data-ttu-id="009e6-130">在更新期間允許的服務變更</span><span class="sxs-lookup"><span data-stu-id="009e6-130">Allowed service changes during an update</span></span>
<span data-ttu-id="009e6-131">hello 下表顯示 hello 允許變更 tooa 服務更新期間：</span><span class="sxs-lookup"><span data-stu-id="009e6-131">hello following table shows hello allowed changes tooa service during an update:</span></span>

| <span data-ttu-id="009e6-132">允許 toohosting、 服務和角色變更</span><span class="sxs-lookup"><span data-stu-id="009e6-132">Changes permitted toohosting, services, and roles</span></span> | <span data-ttu-id="009e6-133">就地更新</span><span class="sxs-lookup"><span data-stu-id="009e6-133">In-place update</span></span> | <span data-ttu-id="009e6-134">預備 (VIP 交換)</span><span class="sxs-lookup"><span data-stu-id="009e6-134">Staged (VIP swap)</span></span> | <span data-ttu-id="009e6-135">刪除並重新部署</span><span class="sxs-lookup"><span data-stu-id="009e6-135">Delete and re-deploy</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="009e6-136">作業系統版本</span><span class="sxs-lookup"><span data-stu-id="009e6-136">Operating system version</span></span> |<span data-ttu-id="009e6-137">是</span><span class="sxs-lookup"><span data-stu-id="009e6-137">Yes</span></span> |<span data-ttu-id="009e6-138">是</span><span class="sxs-lookup"><span data-stu-id="009e6-138">Yes</span></span> |<span data-ttu-id="009e6-139">是</span><span class="sxs-lookup"><span data-stu-id="009e6-139">Yes</span></span> |
| <span data-ttu-id="009e6-140">.NET 信任等級</span><span class="sxs-lookup"><span data-stu-id="009e6-140">.NET trust level</span></span> |<span data-ttu-id="009e6-141">是</span><span class="sxs-lookup"><span data-stu-id="009e6-141">Yes</span></span> |<span data-ttu-id="009e6-142">是</span><span class="sxs-lookup"><span data-stu-id="009e6-142">Yes</span></span> |<span data-ttu-id="009e6-143">是</span><span class="sxs-lookup"><span data-stu-id="009e6-143">Yes</span></span> |
| <span data-ttu-id="009e6-144">虛擬機器大小<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="009e6-144">Virtual machine size<sup>1</sup></span></span> |<span data-ttu-id="009e6-145">是<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="009e6-145">Yes<sup>2</sup></span></span> |<span data-ttu-id="009e6-146">是</span><span class="sxs-lookup"><span data-stu-id="009e6-146">Yes</span></span> |<span data-ttu-id="009e6-147">是</span><span class="sxs-lookup"><span data-stu-id="009e6-147">Yes</span></span> |
| <span data-ttu-id="009e6-148">本機儲存體設定</span><span class="sxs-lookup"><span data-stu-id="009e6-148">Local storage settings</span></span> |<span data-ttu-id="009e6-149">只會增加<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="009e6-149">Increase only<sup>2</sup></span></span> |<span data-ttu-id="009e6-150">是</span><span class="sxs-lookup"><span data-stu-id="009e6-150">Yes</span></span> |<span data-ttu-id="009e6-151">是</span><span class="sxs-lookup"><span data-stu-id="009e6-151">Yes</span></span> |
| <span data-ttu-id="009e6-152">在服務中新增或移除角色</span><span class="sxs-lookup"><span data-stu-id="009e6-152">Add or remove roles in a service</span></span> |<span data-ttu-id="009e6-153">是</span><span class="sxs-lookup"><span data-stu-id="009e6-153">Yes</span></span> |<span data-ttu-id="009e6-154">是</span><span class="sxs-lookup"><span data-stu-id="009e6-154">Yes</span></span> |<span data-ttu-id="009e6-155">是</span><span class="sxs-lookup"><span data-stu-id="009e6-155">Yes</span></span> |
| <span data-ttu-id="009e6-156">特定角色的執行個體數目</span><span class="sxs-lookup"><span data-stu-id="009e6-156">Number of instances of a particular role</span></span> |<span data-ttu-id="009e6-157">是</span><span class="sxs-lookup"><span data-stu-id="009e6-157">Yes</span></span> |<span data-ttu-id="009e6-158">是</span><span class="sxs-lookup"><span data-stu-id="009e6-158">Yes</span></span> |<span data-ttu-id="009e6-159">是</span><span class="sxs-lookup"><span data-stu-id="009e6-159">Yes</span></span> |
| <span data-ttu-id="009e6-160">服務端點的數目或類型</span><span class="sxs-lookup"><span data-stu-id="009e6-160">Number or type of endpoints for a service</span></span> |<span data-ttu-id="009e6-161">是<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="009e6-161">Yes<sup>2</sup></span></span> |<span data-ttu-id="009e6-162">否</span><span class="sxs-lookup"><span data-stu-id="009e6-162">No</span></span> |<span data-ttu-id="009e6-163">是</span><span class="sxs-lookup"><span data-stu-id="009e6-163">Yes</span></span> |
| <span data-ttu-id="009e6-164">組態設定的名稱和值</span><span class="sxs-lookup"><span data-stu-id="009e6-164">Names and values of configuration settings</span></span> |<span data-ttu-id="009e6-165">是</span><span class="sxs-lookup"><span data-stu-id="009e6-165">Yes</span></span> |<span data-ttu-id="009e6-166">是</span><span class="sxs-lookup"><span data-stu-id="009e6-166">Yes</span></span> |<span data-ttu-id="009e6-167">是</span><span class="sxs-lookup"><span data-stu-id="009e6-167">Yes</span></span> |
| <span data-ttu-id="009e6-168">組態設定的值 (而不是名稱)</span><span class="sxs-lookup"><span data-stu-id="009e6-168">Values (but not names) of configuration settings</span></span> |<span data-ttu-id="009e6-169">是</span><span class="sxs-lookup"><span data-stu-id="009e6-169">Yes</span></span> |<span data-ttu-id="009e6-170">是</span><span class="sxs-lookup"><span data-stu-id="009e6-170">Yes</span></span> |<span data-ttu-id="009e6-171">是</span><span class="sxs-lookup"><span data-stu-id="009e6-171">Yes</span></span> |
| <span data-ttu-id="009e6-172">加入新憑證</span><span class="sxs-lookup"><span data-stu-id="009e6-172">Add new certificates</span></span> |<span data-ttu-id="009e6-173">是</span><span class="sxs-lookup"><span data-stu-id="009e6-173">Yes</span></span> |<span data-ttu-id="009e6-174">是</span><span class="sxs-lookup"><span data-stu-id="009e6-174">Yes</span></span> |<span data-ttu-id="009e6-175">是</span><span class="sxs-lookup"><span data-stu-id="009e6-175">Yes</span></span> |
| <span data-ttu-id="009e6-176">變更現有的憑證</span><span class="sxs-lookup"><span data-stu-id="009e6-176">Change existing certificates</span></span> |<span data-ttu-id="009e6-177">是</span><span class="sxs-lookup"><span data-stu-id="009e6-177">Yes</span></span> |<span data-ttu-id="009e6-178">是</span><span class="sxs-lookup"><span data-stu-id="009e6-178">Yes</span></span> |<span data-ttu-id="009e6-179">是</span><span class="sxs-lookup"><span data-stu-id="009e6-179">Yes</span></span> |
| <span data-ttu-id="009e6-180">部署新程式碼</span><span class="sxs-lookup"><span data-stu-id="009e6-180">Deploy new code</span></span> |<span data-ttu-id="009e6-181">是</span><span class="sxs-lookup"><span data-stu-id="009e6-181">Yes</span></span> |<span data-ttu-id="009e6-182">是</span><span class="sxs-lookup"><span data-stu-id="009e6-182">Yes</span></span> |<span data-ttu-id="009e6-183">是</span><span class="sxs-lookup"><span data-stu-id="009e6-183">Yes</span></span> |

<span data-ttu-id="009e6-184"><sup>1</sup>大小變更限制 toohello 子集可用 hello 雲端服務的大小。</span><span class="sxs-lookup"><span data-stu-id="009e6-184"><sup>1</sup> Size change limited toohello subset of sizes available for hello cloud service.</span></span>

<span data-ttu-id="009e6-185"><sup>2</sup> 需要 Azure SDK 1.5 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="009e6-185"><sup>2</sup> Requires Azure SDK 1.5 or later versions.</span></span>

> [!WARNING]
> <span data-ttu-id="009e6-186">變更 hello 虛擬機器大小，將會損毀本機資料。</span><span class="sxs-lookup"><span data-stu-id="009e6-186">Changing hello virtual machine size will destroy local data.</span></span>
>
>

<span data-ttu-id="009e6-187">更新期間，不支援下列項目 hello:</span><span class="sxs-lookup"><span data-stu-id="009e6-187">hello following items are not supported during an update:</span></span>

* <span data-ttu-id="009e6-188">變更 hello 角色的名稱。</span><span class="sxs-lookup"><span data-stu-id="009e6-188">Changing hello name of a role.</span></span> <span data-ttu-id="009e6-189">移除，然後再加入 hello 與 hello 新名稱的角色。</span><span class="sxs-lookup"><span data-stu-id="009e6-189">Remove and then add hello role with hello new name.</span></span>
* <span data-ttu-id="009e6-190">變更 hello 升級網域計數。</span><span class="sxs-lookup"><span data-stu-id="009e6-190">Changing of hello Upgrade Domain count.</span></span>
* <span data-ttu-id="009e6-191">遞減 hello hello 本機資源大小。</span><span class="sxs-lookup"><span data-stu-id="009e6-191">Decreasing hello size of hello local resources.</span></span>

<span data-ttu-id="009e6-192">如果您要進行其他更新 tooyour 服務定義，例如減少本機資源大小 hello 必須改為執行 VIP 交換更新。</span><span class="sxs-lookup"><span data-stu-id="009e6-192">If you are making other updates tooyour service's definition, such as decreasing hello size of local resource, you must perform a VIP swap update instead.</span></span> <span data-ttu-id="009e6-193">如需詳細資訊，請參閱 [交換部署](https://msdn.microsoft.com/library/azure/ee460814.aspx)。</span><span class="sxs-lookup"><span data-stu-id="009e6-193">For more information, see [Swap Deployment](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span></span>

<a name="howanupgradeproceeds"></a>

## <a name="how-an-upgrade-proceeds"></a><span data-ttu-id="009e6-194">如何繼續進行升級</span><span class="sxs-lookup"><span data-stu-id="009e6-194">How an upgrade proceeds</span></span>
<span data-ttu-id="009e6-195">您可以決定是否要讓 tooupdate 所有服務中的 hello 角色或 hello 服務中的單一角色。</span><span class="sxs-lookup"><span data-stu-id="009e6-195">You can decide whether you want tooupdate all of hello roles in your service or a single role in hello service.</span></span> <span data-ttu-id="009e6-196">在任一情況下，每個角色，正在升級而且屬於 toohello 第一個升級網域的所有執行個體是停止、 升級，並回到線上。</span><span class="sxs-lookup"><span data-stu-id="009e6-196">In either case, all instances of each role that is being upgraded and belong toohello first upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="009e6-197">它們都回到線上之後，hello hello 第二個升級網域中的執行個體已停止、 升級，而資料庫恢復上線。</span><span class="sxs-lookup"><span data-stu-id="009e6-197">Once they are back online, hello instances in hello second upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="009e6-198">雲端服務一次最多可有一個作用中的升級。</span><span class="sxs-lookup"><span data-stu-id="009e6-198">A cloud service can have at most one upgrade active at a time.</span></span> <span data-ttu-id="009e6-199">hello 升級會自動執行對 hello hello 雲端服務的最新版本。</span><span class="sxs-lookup"><span data-stu-id="009e6-199">hello upgrade is always performed against hello latest version of hello cloud service.</span></span>

<span data-ttu-id="009e6-200">hello 下列圖表說明如果您要升級所有 hello 服務中的 hello 角色 hello 升級，如何繼續：</span><span class="sxs-lookup"><span data-stu-id="009e6-200">hello following diagram illustrates how hello upgrade proceeds if you are upgrading all of hello roles in hello service:</span></span>

<span data-ttu-id="009e6-201">![升級服務](media/cloud-services-update-azure-service/IC345879.png "升級服務")</span><span class="sxs-lookup"><span data-stu-id="009e6-201">![Upgrade service](media/cloud-services-update-azure-service/IC345879.png "Upgrade service")</span></span>

<span data-ttu-id="009e6-202">下圖說明如果您要升級單一角色，hello 更新如何繼續：</span><span class="sxs-lookup"><span data-stu-id="009e6-202">This next diagram illustrates how hello update proceeds if you are upgrading only a single role:</span></span>

<span data-ttu-id="009e6-203">![升級角色](media/cloud-services-update-azure-service/IC345880.png "升級角色")</span><span class="sxs-lookup"><span data-stu-id="009e6-203">![Upgrade role](media/cloud-services-update-azure-service/IC345880.png "Upgrade role")</span></span>  

<span data-ttu-id="009e6-204">自動更新期間 hello Azure 網狀架構控制器定期評估 hello 雲端服務 toodetermine hello 健全狀況時的安全 toowalk hello UD 下一步。</span><span class="sxs-lookup"><span data-stu-id="009e6-204">During an automatic update, hello Azure Fabric Controller periodically evaluates hello health of hello cloud service toodetermine when it’s safe toowalk hello next UD.</span></span> <span data-ttu-id="009e6-205">此健全狀況評估執行每個角色為基礎，並將只執行個體視為 hello 最新版本 （也就是從執行個體已逐步的 Ud） 中。</span><span class="sxs-lookup"><span data-stu-id="009e6-205">This health evaluation is performed on a per-role basis and considers only instances in hello latest version (i.e. instances from UDs that have already been walked).</span></span> <span data-ttu-id="009e6-206">它會確認每個角色的最少角色執行個體是否已達到令人滿意的終止狀態。</span><span class="sxs-lookup"><span data-stu-id="009e6-206">It verifies that a minimum number of role instances, for each role, have achieved a satisfactory terminal state.</span></span>

### <a name="role-instance-start-timeout"></a><span data-ttu-id="009e6-207">角色執行個體啟動逾時</span><span class="sxs-lookup"><span data-stu-id="009e6-207">Role Instance Start Timeout</span></span>
<span data-ttu-id="009e6-208">hello 網狀架構控制器會等待 30 分鐘每個角色執行個體 tooreach 已啟動 」 狀態的時間。</span><span class="sxs-lookup"><span data-stu-id="009e6-208">hello Fabric Controller will wait 30 minutes for each role instance tooreach a Started state.</span></span> <span data-ttu-id="009e6-209">如果已超過 hello 逾時持續期間，hello 網狀架構控制器會繼續查核 toohello 下一個角色執行個體。</span><span class="sxs-lookup"><span data-stu-id="009e6-209">If hello timeout duration elapses, hello Fabric Controller will continue walking toohello next role instance.</span></span>

### <a name="impact-toodrive-data-during-cloud-service-upgrades"></a><span data-ttu-id="009e6-210">在雲端服務升級期間影響 toodrive 資料</span><span class="sxs-lookup"><span data-stu-id="009e6-210">Impact toodrive data during Cloud Service upgrades</span></span>

<span data-ttu-id="009e6-211">從您的服務將會關閉 hello 升級由於 Azure 升級服務 toohello 方法執行期間的單一執行個體 toomultiple 執行個體的服務升級。</span><span class="sxs-lookup"><span data-stu-id="009e6-211">When upgrading a service from a single instance toomultiple instances your service will be brought down while hello upgrade is performed due toohello way Azure upgrades services.</span></span> <span data-ttu-id="009e6-212">hello 服務等級協定保證服務可用性僅適用於與多個執行個體一起部署的 tooservices。</span><span class="sxs-lookup"><span data-stu-id="009e6-212">hello service level agreement guaranteeing service availability only applies tooservices that are deployed with more than one instance.</span></span> <span data-ttu-id="009e6-213">hello 下列清單描述每個 Azure 服務升級案例如何影響每個磁碟機上的 hello 資料：</span><span class="sxs-lookup"><span data-stu-id="009e6-213">hello following list describes how hello data on each drive is affected by each Azure service upgrade scenario:</span></span>

|<span data-ttu-id="009e6-214">案例</span><span class="sxs-lookup"><span data-stu-id="009e6-214">Scenario</span></span>|<span data-ttu-id="009e6-215">C 磁碟機</span><span class="sxs-lookup"><span data-stu-id="009e6-215">C Drive</span></span>|<span data-ttu-id="009e6-216">D 磁碟機</span><span class="sxs-lookup"><span data-stu-id="009e6-216">D Drive</span></span>|<span data-ttu-id="009e6-217">E 磁碟機</span><span class="sxs-lookup"><span data-stu-id="009e6-217">E Drive</span></span>|
|--------|-------|-------|-------|
|<span data-ttu-id="009e6-218">VM 重新啟動</span><span class="sxs-lookup"><span data-stu-id="009e6-218">VM reboot</span></span>|<span data-ttu-id="009e6-219">保留</span><span class="sxs-lookup"><span data-stu-id="009e6-219">Preserved</span></span>|<span data-ttu-id="009e6-220">保留</span><span class="sxs-lookup"><span data-stu-id="009e6-220">Preserved</span></span>|<span data-ttu-id="009e6-221">保留</span><span class="sxs-lookup"><span data-stu-id="009e6-221">Preserved</span></span>|
|<span data-ttu-id="009e6-222">入口網站重新啟動</span><span class="sxs-lookup"><span data-stu-id="009e6-222">Portal reboot</span></span>|<span data-ttu-id="009e6-223">保留</span><span class="sxs-lookup"><span data-stu-id="009e6-223">Preserved</span></span>|<span data-ttu-id="009e6-224">保留</span><span class="sxs-lookup"><span data-stu-id="009e6-224">Preserved</span></span>|<span data-ttu-id="009e6-225">終結</span><span class="sxs-lookup"><span data-stu-id="009e6-225">Destroyed</span></span>|
|<span data-ttu-id="009e6-226">入口網站重新安裝映像</span><span class="sxs-lookup"><span data-stu-id="009e6-226">Portal reimage</span></span>|<span data-ttu-id="009e6-227">保留</span><span class="sxs-lookup"><span data-stu-id="009e6-227">Preserved</span></span>|<span data-ttu-id="009e6-228">終結</span><span class="sxs-lookup"><span data-stu-id="009e6-228">Destroyed</span></span>|<span data-ttu-id="009e6-229">終結</span><span class="sxs-lookup"><span data-stu-id="009e6-229">Destroyed</span></span>|
|<span data-ttu-id="009e6-230">就地升級</span><span class="sxs-lookup"><span data-stu-id="009e6-230">In-Place Upgrade</span></span>|<span data-ttu-id="009e6-231">保留</span><span class="sxs-lookup"><span data-stu-id="009e6-231">Preserved</span></span>|<span data-ttu-id="009e6-232">保留</span><span class="sxs-lookup"><span data-stu-id="009e6-232">Preserved</span></span>|<span data-ttu-id="009e6-233">終結</span><span class="sxs-lookup"><span data-stu-id="009e6-233">Destroyed</span></span>|
|<span data-ttu-id="009e6-234">節點移轉</span><span class="sxs-lookup"><span data-stu-id="009e6-234">Node migration</span></span>|<span data-ttu-id="009e6-235">終結</span><span class="sxs-lookup"><span data-stu-id="009e6-235">Destroyed</span></span>|<span data-ttu-id="009e6-236">終結</span><span class="sxs-lookup"><span data-stu-id="009e6-236">Destroyed</span></span>|<span data-ttu-id="009e6-237">終結</span><span class="sxs-lookup"><span data-stu-id="009e6-237">Destroyed</span></span>|

<span data-ttu-id="009e6-238">請注意，在清單上方的 hello，hello e： 磁碟機代表 hello 角色的根磁碟機，而不應該是硬式編碼。</span><span class="sxs-lookup"><span data-stu-id="009e6-238">Note that, in hello above list, hello E: drive represents hello role’s root drive, and should not be hard-coded.</span></span> <span data-ttu-id="009e6-239">請改用 hello **%roleroot%**環境變數 toorepresent hello 磁碟機。</span><span class="sxs-lookup"><span data-stu-id="009e6-239">Instead, use hello **%RoleRoot%** environment variable toorepresent hello drive.</span></span>

<span data-ttu-id="009e6-240">toominimize hello 停機時間時升級單一執行個體服務，部署新多重執行個體服務 toohello 臨時伺服器，並執行 VIP 交換。</span><span class="sxs-lookup"><span data-stu-id="009e6-240">toominimize hello downtime when upgrading a single-instance service, deploy a new multi-instance service toohello staging server and perform a VIP swap.</span></span>

<a name="RollbackofanUpdate"></a>

## <a name="rollback-of-an-update"></a><span data-ttu-id="009e6-241">復原更新</span><span class="sxs-lookup"><span data-stu-id="009e6-241">Rollback of an update</span></span>
<span data-ttu-id="009e6-242">Azure 提供有彈性地管理服務更新期間，讓您之後 hello Azure 網狀架構控制器接受 hello 初始更新要求起始服務的其他作業。</span><span class="sxs-lookup"><span data-stu-id="009e6-242">Azure provides flexibility in managing services during an update by letting you initiate additional operations on a service, after hello initial update request is accepted by hello Azure Fabric Controller.</span></span> <span data-ttu-id="009e6-243">更新 （組態變更） 時，可以只執行回復，或升級處於 hello**正在**hello 部署狀態。</span><span class="sxs-lookup"><span data-stu-id="009e6-243">A rollback can only be performed when an update (configuration change) or upgrade is in hello **in progress** state on hello deployment.</span></span> <span data-ttu-id="009e6-244">更新或升級，只要至少一個執行個體尚未更新的 toohello 新版 hello 服務被視為 toobe 進行中。</span><span class="sxs-lookup"><span data-stu-id="009e6-244">An update or upgrade is considered toobe in-progress as long as there is at least one instance of hello service which has not yet been updated toohello new version.</span></span> <span data-ttu-id="009e6-245">tootest 是否允許回復，檢查 hello hello RollbackAllowed 旗標的值，傳回[取得部署](https://msdn.microsoft.com/library/azure/ee460804.aspx)和[取得雲端服務屬性](https://msdn.microsoft.com/library/azure/ee460806.aspx)作業，會設定 tootrue。</span><span class="sxs-lookup"><span data-stu-id="009e6-245">tootest whether a rollback is allowed, check hello value of hello RollbackAllowed flag, returned by [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations, is set tootrue.</span></span>

> [!NOTE]
> <span data-ttu-id="009e6-246">它只會在意義上 toocall 復原**就地**更新或升級，因為 VIP 交換升級牽涉到取代另一個整個執行執行個體的服務。</span><span class="sxs-lookup"><span data-stu-id="009e6-246">It only makes sense toocall Rollback on an **in-place** update or upgrade because VIP swap upgrades involve replacing one entire running instance of your service with another.</span></span>
>
>

<span data-ttu-id="009e6-247">回復進行中更新具有下列效果 hello 部署的 hello:</span><span class="sxs-lookup"><span data-stu-id="009e6-247">Rollback of an in-progress update has hello following effects on hello deployment:</span></span>

* <span data-ttu-id="009e6-248">尚未尚未更新或升級 toohello 新版本的任何角色執行個體不會更新或升級，因為這些執行個體已經在執行 hello 服務 hello 目標版本。</span><span class="sxs-lookup"><span data-stu-id="009e6-248">Any role instances which had not yet been updated or upgraded toohello new version are not updated or upgraded, because those instances are already running hello target version of hello service.</span></span>
* <span data-ttu-id="009e6-249">任何角色執行個體，其具有已更新或升級的 toohello 新版 hello 服務封裝 (\*.cspkg) 檔案或 hello 服務組態 (\*.cscfg) 檔案 （或這兩個檔案） 是還原的 toohello 升級前版本這些檔案。</span><span class="sxs-lookup"><span data-stu-id="009e6-249">Any role instances which had already been updated or upgraded toohello new version of hello service package (\*.cspkg) file or hello service configuration (\*.cscfg) file (or both files) are reverted toohello pre-upgrade version of these files.</span></span>

<span data-ttu-id="009e6-250">此功能是由提供 hello 下列功能：</span><span class="sxs-lookup"><span data-stu-id="009e6-250">This functionally is provided by hello following features:</span></span>

* <span data-ttu-id="009e6-251">hello[回復更新或升級](https://msdn.microsoft.com/library/azure/hh403977.aspx)作業，可針對組態更新 (藉由呼叫觸發[變更部署組態](https://msdn.microsoft.com/library/azure/ee460809.aspx)) 或升級 (藉由呼叫觸發[升級部署](https://msdn.microsoft.com/library/azure/ee460793.aspx))，只要 hello 服務中沒有至少一個執行個體的尚未更新 toohello 新版本。</span><span class="sxs-lookup"><span data-stu-id="009e6-251">hello [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation, which can be called on a configuration update (triggered by calling [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx)) or an upgrade (triggered by calling [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx)) as long as there is at least one instance in hello service which has not yet been updated toohello new version.</span></span>
* <span data-ttu-id="009e6-252">hello 鎖定元素和 hello RollbackAllowed 元素，都以 hello 回應 hello 主體的一部分傳回[取得部署](https://msdn.microsoft.com/library/azure/ee460804.aspx)和[取得雲端服務屬性](https://msdn.microsoft.com/library/azure/ee460806.aspx)作業：</span><span class="sxs-lookup"><span data-stu-id="009e6-252">hello Locked element and hello RollbackAllowed element, which are returned as part of hello response body of hello [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations:</span></span>

  1. <span data-ttu-id="009e6-253">hello 鎖定項目可讓您 toodetect 時可以針對給定部署叫用變更作業。</span><span class="sxs-lookup"><span data-stu-id="009e6-253">hello Locked element allows you toodetect when a mutating operation can be invoked on a given deployment.</span></span>
  2. <span data-ttu-id="009e6-254">hello RollbackAllowed 元素可讓您 toodetect 時 hello[復原更新或升級](https://msdn.microsoft.com/library/azure/hh403977.aspx)可以針對給定的部署呼叫作業。</span><span class="sxs-lookup"><span data-stu-id="009e6-254">hello RollbackAllowed element allows you toodetect when hello [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation can be called on a given deployment.</span></span>

  <span data-ttu-id="009e6-255">在訂單 tooperform 復原，您沒有 toocheck hello 鎖定和 hello RollbackAllowed 元素。</span><span class="sxs-lookup"><span data-stu-id="009e6-255">In order tooperform a rollback, you do not have toocheck both hello Locked and hello RollbackAllowed elements.</span></span> <span data-ttu-id="009e6-256">這樣便已足夠 tooconfirm RollbackAllowed 設定 tootrue。</span><span class="sxs-lookup"><span data-stu-id="009e6-256">It suffices tooconfirm that RollbackAllowed is set tootrue.</span></span> <span data-ttu-id="009e6-257">這些項目才會傳回這些方法會叫用使用 hello 要求標頭設定得 「 x ms 版本： 2011年-10-01"或更新版本。</span><span class="sxs-lookup"><span data-stu-id="009e6-257">These elements are only returned if these methods are invoked by using hello request header set too“x-ms-version: 2011-10-01” or a later version.</span></span> <span data-ttu-id="009e6-258">如需標頭版本控制的詳細資訊，請參閱 [服務管理版本控制](https://msdn.microsoft.com/library/azure/gg592580.aspx)。</span><span class="sxs-lookup"><span data-stu-id="009e6-258">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<span data-ttu-id="009e6-259">有某些情況下，不支援復原更新或升級，如下所示：</span><span class="sxs-lookup"><span data-stu-id="009e6-259">There are some situations where a rollback of an update or upgrade is not supported, these are as follows:</span></span>

* <span data-ttu-id="009e6-260">減少本機資源-如果 hello 更新增加 hello 本機資源角色 hello Azure 平台不允許回復。</span><span class="sxs-lookup"><span data-stu-id="009e6-260">Reduction in local resources - If hello update increases hello local resources for a role hello Azure platform does not allow rolling back.</span></span>
* <span data-ttu-id="009e6-261">配額限制-如果 hello 更新已減少作業，您可能不會再有足夠計算配額 toocomplete hello （rollback） 作業。</span><span class="sxs-lookup"><span data-stu-id="009e6-261">Quota limitations - If hello update was a scale down operation you may no longer have sufficient compute quota toocomplete hello rollback operation.</span></span> <span data-ttu-id="009e6-262">每個 Azure 訂用帳戶已指定 hello 最大數目可供所有的託管服務屬於 toothat 訂用帳戶核心配額與它相關聯。</span><span class="sxs-lookup"><span data-stu-id="009e6-262">Each Azure subscription has a quota associated with it that specifies hello maximum number of cores which can be consumed by all hosted services that belong toothat subscription.</span></span> <span data-ttu-id="009e6-263">如果執行指定之更新的復原會讓您的訂用帳戶超出配額，則不會啟用復原。</span><span class="sxs-lookup"><span data-stu-id="009e6-263">If performing a rollback of a given update would put your subscription over quota then that a rollback will not be enabled.</span></span>
* <span data-ttu-id="009e6-264">競爭情形-如果 hello 初始更新已完成，不可能復原。</span><span class="sxs-lookup"><span data-stu-id="009e6-264">Race condition - If hello initial update has completed, a rollback is not possible.</span></span>

<span data-ttu-id="009e6-265">更新 hello 回復時可能會很有用的範例是，如果您使用 hello[升級部署](https://msdn.microsoft.com/library/azure/ee460793.aspx)作業在手動模式 toocontrol hello 速率的主要就地升級 tooyour Azure 託管服務中推出。</span><span class="sxs-lookup"><span data-stu-id="009e6-265">An example of when hello rollback of an update might be useful is if you are using hello [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) operation in manual mode toocontrol hello rate at which a major in-place upgrade tooyour Azure hosted service is rolled out.</span></span>

<span data-ttu-id="009e6-266">在您呼叫 hello 升級的 hello 首展期間[升級部署](https://msdn.microsoft.com/library/azure/ee460793.aspx)在手動模式中，並開始 toowalk 升級網域。</span><span class="sxs-lookup"><span data-stu-id="009e6-266">During hello rollout of hello upgrade you call [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) in manual mode and begin toowalk upgrade domains.</span></span> <span data-ttu-id="009e6-267">如果在某個時間點，當您監視 hello 升級，您會注意 hello 第一個升級網域中檢查某些角色執行個體變得沒有回應，您可以呼叫 hello[復原更新或升級](https://msdn.microsoft.com/library/azure/hh403977.aspx)hello 部署作業的會保留不變的 hello 有尚未升級的執行個體，這便是復原執行個體升級 toohello 先前的服務封裝和組態。</span><span class="sxs-lookup"><span data-stu-id="009e6-267">If at some point, as you monitor hello upgrade, you note some role instances in hello first upgrade domains that you examine have become unresponsive, you can call hello [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation on hello deployment, which will leave untouched hello instances which had not yet been upgraded and rollback instances which had been upgraded toohello previous service package and configuration.</span></span>

<a name="multiplemutatingoperations"></a>

## <a name="initiating-multiple-mutating-operations-on-an-ongoing-deployment"></a><span data-ttu-id="009e6-268">在進行中的部署上起始多項變更作業</span><span class="sxs-lookup"><span data-stu-id="009e6-268">Initiating multiple mutating operations on an ongoing deployment</span></span>
<span data-ttu-id="009e6-269">在某些情況下您可能想 tooinitiate 持續進行的部署上的多個同時變更作業。</span><span class="sxs-lookup"><span data-stu-id="009e6-269">In some cases you may want tooinitiate multiple simultaneous mutating operations on an ongoing deployment.</span></span> <span data-ttu-id="009e6-270">例如，您可能會執行服務更新，在該更新透過您的服務復原，您想 toomake 某些變更，tooroll 例如 hello 回更新、 套用不同的更新，或甚至刪除 hello 部署。</span><span class="sxs-lookup"><span data-stu-id="009e6-270">For example, you may perform a service update and, while that update is being rolled out across your service, you want toomake some change, e.g. tooroll hello update back, apply a different update, or even delete hello deployment.</span></span> <span data-ttu-id="009e6-271">這可能是必要的情況是如果服務升級包含下列程式碼中造成升級的角色執行個體 toorepeatedly 損毀。</span><span class="sxs-lookup"><span data-stu-id="009e6-271">A case in which this might be necessary is if a service upgrade contains buggy code which causes an upgraded role instance toorepeatedly crash.</span></span> <span data-ttu-id="009e6-272">在此情況下，hello Azure 網狀架構控制器不會在套用升級，因為 hello 升級網域中執行個體數目不足的狀況良好的能 toomake 進度。</span><span class="sxs-lookup"><span data-stu-id="009e6-272">In this case, hello Azure Fabric Controller will not be able toomake progress in applying that upgrade because an insufficient number of instances in hello upgraded domain are healthy.</span></span> <span data-ttu-id="009e6-273">此狀態是參照的 tooas*停滯部署*。</span><span class="sxs-lookup"><span data-stu-id="009e6-273">This state is referred tooas a *stuck deployment*.</span></span> <span data-ttu-id="009e6-274">您可助您脫離停滯 hello 部署回復 hello update 或透過頂端的其中一個失敗的 hello 套用新的更新。</span><span class="sxs-lookup"><span data-stu-id="009e6-274">You can unstick hello deployment by rolling back hello update or applying a fresh update over top of hello failing one.</span></span>

<span data-ttu-id="009e6-275">一旦 hello 初始要求 tooupdate 或升級 hello 服務已收到 hello Azure 網狀架構控制器，就可以開始後續變更作業。</span><span class="sxs-lookup"><span data-stu-id="009e6-275">Once hello initial request tooupdate or upgrade hello service has been received by hello Azure Fabric Controller, you can start subsequent mutating operations.</span></span> <span data-ttu-id="009e6-276">也就是您沒有針對 hello 初始作業 toocomplete toowait 才能開始另一個變更作業。</span><span class="sxs-lookup"><span data-stu-id="009e6-276">That is, you do not have toowait for hello initial operation toocomplete before you can start another mutating operation.</span></span>

<span data-ttu-id="009e6-277">Hello 第一次更新正在進行中時，起始第二個更新作業將會執行類似 toohello 復原作業。</span><span class="sxs-lookup"><span data-stu-id="009e6-277">Initiating a second update operation while hello first update is ongoing will perform similar toohello rollback operation.</span></span> <span data-ttu-id="009e6-278">如果 hello 第二個更新，以自動模式 hello 的第一個升級網域將會立即升級，這樣可能會導致 tooinstances 多個升級網域已在 hello 離線相同時間點。</span><span class="sxs-lookup"><span data-stu-id="009e6-278">If hello second update is in automatic mode, hello first upgrade domain will be upgraded immediately, possibly leading tooinstances from multiple upgrade domains being offline at hello same point in time.</span></span>

<span data-ttu-id="009e6-279">hello 變更作業如下：[變更部署組態](https://msdn.microsoft.com/library/azure/ee460809.aspx)，[升級部署](https://msdn.microsoft.com/library/azure/ee460793.aspx)，[更新部署狀態](https://msdn.microsoft.com/library/azure/ee460808.aspx)，[刪除部署](https://msdn.microsoft.com/library/azure/ee460815.aspx)，和[回復更新或升級](https://msdn.microsoft.com/library/azure/hh403977.aspx)。</span><span class="sxs-lookup"><span data-stu-id="009e6-279">hello mutating operations are as follows: [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Update Deployment Status](https://msdn.microsoft.com/library/azure/ee460808.aspx), [Delete Deployment](https://msdn.microsoft.com/library/azure/ee460815.aspx), and [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span></span>

<span data-ttu-id="009e6-280">兩個作業，[取得部署](https://msdn.microsoft.com/library/azure/ee460804.aspx)和[取得雲端服務屬性](https://msdn.microsoft.com/library/azure/ee460806.aspx)，傳回是否可以針對給定部署叫用變更作業可以是檢查的 toodetermine hello 鎖定旗標。</span><span class="sxs-lookup"><span data-stu-id="009e6-280">Two operations, [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx), return hello Locked flag which can be examined toodetermine whether a mutating operation can be invoked on a given deployment.</span></span>

<span data-ttu-id="009e6-281">順序 toocall hello 版本的這些方法會傳回 hello 鎖定旗標，您必須設定要求標頭太"x ms 版本： 2011年-10-01"或更新的版本。</span><span class="sxs-lookup"><span data-stu-id="009e6-281">In order toocall hello version of these methods which returns hello Locked flag, you must set request header too“x-ms-version: 2011-10-01” or a later.</span></span> <span data-ttu-id="009e6-282">如需標頭版本控制的詳細資訊，請參閱 [服務管理版本控制](https://msdn.microsoft.com/library/azure/gg592580.aspx)。</span><span class="sxs-lookup"><span data-stu-id="009e6-282">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<a name="distributiondfroles"></a>

## <a name="distribution-of-roles-across-upgrade-domains"></a><span data-ttu-id="009e6-283">將角色散發於升級網域</span><span class="sxs-lookup"><span data-stu-id="009e6-283">Distribution of roles across upgrade domains</span></span>
<span data-ttu-id="009e6-284">Azure 平均將角色執行個體分散到固定數目的升級網域，可以設定為 hello 服務定義 (.csdef) 檔案的一部分。</span><span class="sxs-lookup"><span data-stu-id="009e6-284">Azure distributes instances of a role evenly across a set number of upgrade domains, which can be configured as part of hello service definition (.csdef) file.</span></span> <span data-ttu-id="009e6-285">hello 升級網域數目上限為 20，hello 預設值為 5。</span><span class="sxs-lookup"><span data-stu-id="009e6-285">hello max number of upgrade domains is 20 and hello default is 5.</span></span> <span data-ttu-id="009e6-286">如需有關如何 toomodify hello 服務定義檔的詳細資訊，請參閱[Azure 服務定義結構描述 (.csdef 檔)](cloud-services-model-and-package.md#csdef)。</span><span class="sxs-lookup"><span data-stu-id="009e6-286">For more information about how toomodify hello service definition file, see [Azure Service Definition Schema (.csdef File)](cloud-services-model-and-package.md#csdef).</span></span>

<span data-ttu-id="009e6-287">例如，如果您的角色有 10 個執行個體，依預設每個升級網域包含 2 個執行個體。</span><span class="sxs-lookup"><span data-stu-id="009e6-287">For example, if your role has ten instances, by default each upgrade domain contains two instances.</span></span> <span data-ttu-id="009e6-288">如果您的角色有 14 個執行個體，則四個 hello 升級網域包含三個執行個體，和第五個網域包含兩個。</span><span class="sxs-lookup"><span data-stu-id="009e6-288">If your role has 14 instances, then four of hello upgrade domains contain three instances, and a fifth domain contains two.</span></span>

<span data-ttu-id="009e6-289">升級網域會使用以零為起始的索引加以識別： hello 的第一個升級網域的 ID 為 0，個 hello 第二個升級網域的識別碼為 1，依此類推。</span><span class="sxs-lookup"><span data-stu-id="009e6-289">Upgrade domains are identified with a zero-based index: hello first upgrade domain has an ID of 0, and hello second upgrade domain has an ID of 1, and so on.</span></span>

<span data-ttu-id="009e6-290">hello 下列圖表說明 hello 服務定義兩個升級網域時，如何散發包含兩個角色服務。</span><span class="sxs-lookup"><span data-stu-id="009e6-290">hello following diagram illustrates how a service than contains two roles are distributed when hello service defines two upgrade domains.</span></span> <span data-ttu-id="009e6-291">hello 服務正在執行的 hello web 角色的八個執行個體並 hello 背景工作角色的九個執行個體。</span><span class="sxs-lookup"><span data-stu-id="009e6-291">hello service is running eight instances of hello web role and nine instances of hello worker role.</span></span>

<span data-ttu-id="009e6-292">![升級網域的分配](media/cloud-services-update-azure-service/IC345533.png "升級網域的分配")</span><span class="sxs-lookup"><span data-stu-id="009e6-292">![Distribution of Upgrade Domains](media/cloud-services-update-azure-service/IC345533.png "Distribution of Upgrade Domains")</span></span>

> [!NOTE]
> <span data-ttu-id="009e6-293">請注意，Azure 會控制執行個體配置於升級網域的方式。</span><span class="sxs-lookup"><span data-stu-id="009e6-293">Note that Azure controls how instances are allocated across upgrade domains.</span></span> <span data-ttu-id="009e6-294">不可能 toospecify 哪一個執行個體配置 toowhich 網域。</span><span class="sxs-lookup"><span data-stu-id="009e6-294">It's not possible toospecify which instances are allocated toowhich domain.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="009e6-295">後續步驟</span><span class="sxs-lookup"><span data-stu-id="009e6-295">Next steps</span></span>
[<span data-ttu-id="009e6-296">如何 tooManage 雲端服務</span><span class="sxs-lookup"><span data-stu-id="009e6-296">How tooManage Cloud Services</span></span>](cloud-services-how-to-manage.md)  
[<span data-ttu-id="009e6-297">如何 tooMonitor 雲端服務</span><span class="sxs-lookup"><span data-stu-id="009e6-297">How tooMonitor Cloud Services</span></span>](cloud-services-how-to-monitor.md)  
[<span data-ttu-id="009e6-298">如何 tooConfigure 雲端服務</span><span class="sxs-lookup"><span data-stu-id="009e6-298">How tooConfigure Cloud Services</span></span>](cloud-services-how-to-configure.md)  
