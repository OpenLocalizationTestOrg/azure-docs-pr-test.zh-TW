---
title: "如何更新雲端服務 | Microsoft Docs"
description: "了解如何在 Azure 中更新雲端服務。 了解如何繼續進行雲端服務更新來確保可用性。"
services: cloud-services
documentationcenter: 
author: Thraka
manager: timlt
editor: 
ms.assetid: c6a8b5e6-5c99-454c-9911-5c7ae8d1af63
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/19/2017
ms.author: adegeo
ms.openlocfilehash: 2ba9676ed2afce7f18446642527971f5001b5ca7
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-update-a-cloud-service"></a><span data-ttu-id="439a2-104">如何更新雲端服務</span><span class="sxs-lookup"><span data-stu-id="439a2-104">How to update a cloud service</span></span>

<span data-ttu-id="439a2-105">更新雲端服務 (包括其角色和客體 OS) 是一個包含三步驟的程序。</span><span class="sxs-lookup"><span data-stu-id="439a2-105">Updating a cloud service, including both its roles and guest OS, is a three step process.</span></span> <span data-ttu-id="439a2-106">首先，必須上傳新雲端服務或作業系統版本的二進位檔和組態檔案。</span><span class="sxs-lookup"><span data-stu-id="439a2-106">First, the binaries and configuration files for the new cloud service or OS version must be uploaded.</span></span> <span data-ttu-id="439a2-107">接著，Azure 會根據新雲端服務版本的需求，保留雲端服務的計算和網路資源。</span><span class="sxs-lookup"><span data-stu-id="439a2-107">Next, Azure reserves compute and network resources for the cloud service based on the requirements of the new cloud service version.</span></span> <span data-ttu-id="439a2-108">最後，Azure 會執行輪流升級，以累加方式將租用戶更新為新版本或客體 OS，同時保留您的可用性。</span><span class="sxs-lookup"><span data-stu-id="439a2-108">Finally, Azure performs a rolling upgrade to incrementally update the tenant to the new version or guest OS, while preserving your availability.</span></span> <span data-ttu-id="439a2-109">本文將討論最後一個步驟 (輪流升級) 的細節。</span><span class="sxs-lookup"><span data-stu-id="439a2-109">This article discusses the details of this last step – the rolling upgrade.</span></span>

## <a name="update-an-azure-service"></a><span data-ttu-id="439a2-110">更新 Azure 服務</span><span class="sxs-lookup"><span data-stu-id="439a2-110">Update an Azure Service</span></span>
<span data-ttu-id="439a2-111">Azure 會將您的角色執行個體組織成名為升級網域 (UD) 的邏輯群組。</span><span class="sxs-lookup"><span data-stu-id="439a2-111">Azure organizes your role instances into logical groupings called upgrade domains (UD).</span></span> <span data-ttu-id="439a2-112">升級網域 (UD) 是角色執行個體的邏輯集合，會以群組方式進行更新。</span><span class="sxs-lookup"><span data-stu-id="439a2-112">Upgrade domains (UD) are logical sets of role instances that are updated as a group.</span></span>  <span data-ttu-id="439a2-113">Azure 會一次更新一個 UD 的一個雲端服務，讓其他 UD 中的執行個體能夠繼續處理流量。</span><span class="sxs-lookup"><span data-stu-id="439a2-113">Azure updates a cloud service one UD at a time, which allows instances in other UDs to continue serving traffic.</span></span>

<span data-ttu-id="439a2-114">預設的升級網域數目為 5。</span><span class="sxs-lookup"><span data-stu-id="439a2-114">The default number of upgrade domains is 5.</span></span> <span data-ttu-id="439a2-115">您可以在服務的定義檔 (.csdef) 中包含 upgradeDomainCount 屬性，以指定不同數目的升級網域。</span><span class="sxs-lookup"><span data-stu-id="439a2-115">You can specify a different number of upgrade domains by including the upgradeDomainCount attribute in the service’s definition file (.csdef).</span></span> <span data-ttu-id="439a2-116">如需有關 upgradeDomainCount 屬性的詳細資訊，請參閱 [WebRole 結構描述](https://msdn.microsoft.com/library/azure/gg557553.aspx)或 [WorkerRole 結構描述](https://msdn.microsoft.com/library/azure/gg557552.aspx)。</span><span class="sxs-lookup"><span data-stu-id="439a2-116">For more information about the upgradeDomainCount attribute, see [WebRole Schema](https://msdn.microsoft.com/library/azure/gg557553.aspx) or [WorkerRole Schema](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span></span>

<span data-ttu-id="439a2-117">當您在服務中執行一或多個角色的就地更新時，Azure 會根據所屬的升級網域來更新角色執行個體集合。</span><span class="sxs-lookup"><span data-stu-id="439a2-117">When you perform an in-place update of one or more roles in your service, Azure updates sets of role instances according to the upgrade domain to which they belong.</span></span> <span data-ttu-id="439a2-118">Azure 會更新指定的升級網域中的所有執行個體 (予以停止、更新、重新上線)，然後移到下一個網域。</span><span class="sxs-lookup"><span data-stu-id="439a2-118">Azure updates all of the instances in a given upgrade domain – stopping them, updating them, bringing them back on-line – then moves onto the next domain.</span></span> <span data-ttu-id="439a2-119">Azure 只會停止在目前升級網域中執行的執行個體，以確保更新儘可能對執行中的服務造成最小的影響。</span><span class="sxs-lookup"><span data-stu-id="439a2-119">By stopping only the instances running in the current upgrade domain, Azure makes sure that an update occurs with the least possible impact to the running service.</span></span> <span data-ttu-id="439a2-120">如需詳細資訊，請參閱本文後面的 [如何繼續進行更新](#howanupgradeproceeds) 。</span><span class="sxs-lookup"><span data-stu-id="439a2-120">For more information, see [How the update proceeds](#howanupgradeproceeds) later in this article.</span></span>

> [!NOTE]
> <span data-ttu-id="439a2-121">雖然 Azure 內容中的**更新**和**升級**有稍微不同的含義，但是在本文件中，這兩個詞彙可交替用於處理序和功能說明中。</span><span class="sxs-lookup"><span data-stu-id="439a2-121">While the terms **update** and **upgrade** have slightly different meaning in the context Azure, they can be used interchangeably for the processes and descriptions of the features in this document.</span></span>
>
>

<span data-ttu-id="439a2-122">您的服務必須定義一個角色至少有兩個執行個體，以便該角色在不需停機的狀況下進行就地升級。</span><span class="sxs-lookup"><span data-stu-id="439a2-122">Your service must define at least two instances of a role for that role to be updated in-place without downtime.</span></span> <span data-ttu-id="439a2-123">如果服務僅由一個角色的一個執行個體組成，您的服務要等到就地更新完成才可使用。</span><span class="sxs-lookup"><span data-stu-id="439a2-123">If the service consists of only one instance of one role, your service will be unavailable until the in-place update has finished.</span></span>

<span data-ttu-id="439a2-124">本主題涵蓋下列有關 Azure 更新的資訊：</span><span class="sxs-lookup"><span data-stu-id="439a2-124">This topic covers the following information about Azure updates:</span></span>

* [<span data-ttu-id="439a2-125">在更新期間允許的服務變更</span><span class="sxs-lookup"><span data-stu-id="439a2-125">Allowed service changes during an update</span></span>](#AllowedChanges)
* [<span data-ttu-id="439a2-126">如何繼續進行升級</span><span class="sxs-lookup"><span data-stu-id="439a2-126">How an upgrade proceeds</span></span>](#howanupgradeproceeds)
* [<span data-ttu-id="439a2-127">復原更新</span><span class="sxs-lookup"><span data-stu-id="439a2-127">Rollback of an update</span></span>](#RollbackofanUpdate)
* [<span data-ttu-id="439a2-128">在進行中的部署上起始多項變更作業</span><span class="sxs-lookup"><span data-stu-id="439a2-128">Initiating multiple mutating operations on an ongoing deployment</span></span>](#multiplemutatingoperations)
* [<span data-ttu-id="439a2-129">將角色散發於升級網域</span><span class="sxs-lookup"><span data-stu-id="439a2-129">Distribution of roles across upgrade domains</span></span>](#distributiondfroles)

<a name="AllowedChanges"></a>

## <a name="allowed-service-changes-during-an-update"></a><span data-ttu-id="439a2-130">在更新期間允許的服務變更</span><span class="sxs-lookup"><span data-stu-id="439a2-130">Allowed service changes during an update</span></span>
<span data-ttu-id="439a2-131">下表顯示在更新期間允許的服務變更：</span><span class="sxs-lookup"><span data-stu-id="439a2-131">The following table shows the allowed changes to a service during an update:</span></span>

| <span data-ttu-id="439a2-132">允許對主機、服務和角色進行的變更</span><span class="sxs-lookup"><span data-stu-id="439a2-132">Changes permitted to hosting, services, and roles</span></span> | <span data-ttu-id="439a2-133">就地更新</span><span class="sxs-lookup"><span data-stu-id="439a2-133">In-place update</span></span> | <span data-ttu-id="439a2-134">預備 (VIP 交換)</span><span class="sxs-lookup"><span data-stu-id="439a2-134">Staged (VIP swap)</span></span> | <span data-ttu-id="439a2-135">刪除並重新部署</span><span class="sxs-lookup"><span data-stu-id="439a2-135">Delete and re-deploy</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="439a2-136">作業系統版本</span><span class="sxs-lookup"><span data-stu-id="439a2-136">Operating system version</span></span> |<span data-ttu-id="439a2-137">是</span><span class="sxs-lookup"><span data-stu-id="439a2-137">Yes</span></span> |<span data-ttu-id="439a2-138">是</span><span class="sxs-lookup"><span data-stu-id="439a2-138">Yes</span></span> |<span data-ttu-id="439a2-139">是</span><span class="sxs-lookup"><span data-stu-id="439a2-139">Yes</span></span> |
| <span data-ttu-id="439a2-140">.NET 信任等級</span><span class="sxs-lookup"><span data-stu-id="439a2-140">.NET trust level</span></span> |<span data-ttu-id="439a2-141">是</span><span class="sxs-lookup"><span data-stu-id="439a2-141">Yes</span></span> |<span data-ttu-id="439a2-142">是</span><span class="sxs-lookup"><span data-stu-id="439a2-142">Yes</span></span> |<span data-ttu-id="439a2-143">是</span><span class="sxs-lookup"><span data-stu-id="439a2-143">Yes</span></span> |
| <span data-ttu-id="439a2-144">虛擬機器大小<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="439a2-144">Virtual machine size<sup>1</sup></span></span> |<span data-ttu-id="439a2-145">是<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="439a2-145">Yes<sup>2</sup></span></span> |<span data-ttu-id="439a2-146">是</span><span class="sxs-lookup"><span data-stu-id="439a2-146">Yes</span></span> |<span data-ttu-id="439a2-147">是</span><span class="sxs-lookup"><span data-stu-id="439a2-147">Yes</span></span> |
| <span data-ttu-id="439a2-148">本機儲存體設定</span><span class="sxs-lookup"><span data-stu-id="439a2-148">Local storage settings</span></span> |<span data-ttu-id="439a2-149">只會增加<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="439a2-149">Increase only<sup>2</sup></span></span> |<span data-ttu-id="439a2-150">是</span><span class="sxs-lookup"><span data-stu-id="439a2-150">Yes</span></span> |<span data-ttu-id="439a2-151">是</span><span class="sxs-lookup"><span data-stu-id="439a2-151">Yes</span></span> |
| <span data-ttu-id="439a2-152">在服務中新增或移除角色</span><span class="sxs-lookup"><span data-stu-id="439a2-152">Add or remove roles in a service</span></span> |<span data-ttu-id="439a2-153">是</span><span class="sxs-lookup"><span data-stu-id="439a2-153">Yes</span></span> |<span data-ttu-id="439a2-154">是</span><span class="sxs-lookup"><span data-stu-id="439a2-154">Yes</span></span> |<span data-ttu-id="439a2-155">是</span><span class="sxs-lookup"><span data-stu-id="439a2-155">Yes</span></span> |
| <span data-ttu-id="439a2-156">特定角色的執行個體數目</span><span class="sxs-lookup"><span data-stu-id="439a2-156">Number of instances of a particular role</span></span> |<span data-ttu-id="439a2-157">是</span><span class="sxs-lookup"><span data-stu-id="439a2-157">Yes</span></span> |<span data-ttu-id="439a2-158">是</span><span class="sxs-lookup"><span data-stu-id="439a2-158">Yes</span></span> |<span data-ttu-id="439a2-159">是</span><span class="sxs-lookup"><span data-stu-id="439a2-159">Yes</span></span> |
| <span data-ttu-id="439a2-160">服務端點的數目或類型</span><span class="sxs-lookup"><span data-stu-id="439a2-160">Number or type of endpoints for a service</span></span> |<span data-ttu-id="439a2-161">是<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="439a2-161">Yes<sup>2</sup></span></span> |<span data-ttu-id="439a2-162">否</span><span class="sxs-lookup"><span data-stu-id="439a2-162">No</span></span> |<span data-ttu-id="439a2-163">是</span><span class="sxs-lookup"><span data-stu-id="439a2-163">Yes</span></span> |
| <span data-ttu-id="439a2-164">組態設定的名稱和值</span><span class="sxs-lookup"><span data-stu-id="439a2-164">Names and values of configuration settings</span></span> |<span data-ttu-id="439a2-165">是</span><span class="sxs-lookup"><span data-stu-id="439a2-165">Yes</span></span> |<span data-ttu-id="439a2-166">是</span><span class="sxs-lookup"><span data-stu-id="439a2-166">Yes</span></span> |<span data-ttu-id="439a2-167">是</span><span class="sxs-lookup"><span data-stu-id="439a2-167">Yes</span></span> |
| <span data-ttu-id="439a2-168">組態設定的值 (而不是名稱)</span><span class="sxs-lookup"><span data-stu-id="439a2-168">Values (but not names) of configuration settings</span></span> |<span data-ttu-id="439a2-169">是</span><span class="sxs-lookup"><span data-stu-id="439a2-169">Yes</span></span> |<span data-ttu-id="439a2-170">是</span><span class="sxs-lookup"><span data-stu-id="439a2-170">Yes</span></span> |<span data-ttu-id="439a2-171">是</span><span class="sxs-lookup"><span data-stu-id="439a2-171">Yes</span></span> |
| <span data-ttu-id="439a2-172">加入新憑證</span><span class="sxs-lookup"><span data-stu-id="439a2-172">Add new certificates</span></span> |<span data-ttu-id="439a2-173">是</span><span class="sxs-lookup"><span data-stu-id="439a2-173">Yes</span></span> |<span data-ttu-id="439a2-174">是</span><span class="sxs-lookup"><span data-stu-id="439a2-174">Yes</span></span> |<span data-ttu-id="439a2-175">是</span><span class="sxs-lookup"><span data-stu-id="439a2-175">Yes</span></span> |
| <span data-ttu-id="439a2-176">變更現有的憑證</span><span class="sxs-lookup"><span data-stu-id="439a2-176">Change existing certificates</span></span> |<span data-ttu-id="439a2-177">是</span><span class="sxs-lookup"><span data-stu-id="439a2-177">Yes</span></span> |<span data-ttu-id="439a2-178">是</span><span class="sxs-lookup"><span data-stu-id="439a2-178">Yes</span></span> |<span data-ttu-id="439a2-179">是</span><span class="sxs-lookup"><span data-stu-id="439a2-179">Yes</span></span> |
| <span data-ttu-id="439a2-180">部署新程式碼</span><span class="sxs-lookup"><span data-stu-id="439a2-180">Deploy new code</span></span> |<span data-ttu-id="439a2-181">是</span><span class="sxs-lookup"><span data-stu-id="439a2-181">Yes</span></span> |<span data-ttu-id="439a2-182">是</span><span class="sxs-lookup"><span data-stu-id="439a2-182">Yes</span></span> |<span data-ttu-id="439a2-183">是</span><span class="sxs-lookup"><span data-stu-id="439a2-183">Yes</span></span> |

<span data-ttu-id="439a2-184"><sup>1</sup> 大小變更已限制為可供雲端服務使用的大小子集。</span><span class="sxs-lookup"><span data-stu-id="439a2-184"><sup>1</sup> Size change limited to the subset of sizes available for the cloud service.</span></span>

<span data-ttu-id="439a2-185"><sup>2</sup> 需要 Azure SDK 1.5 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="439a2-185"><sup>2</sup> Requires Azure SDK 1.5 or later versions.</span></span>

> [!WARNING]
> <span data-ttu-id="439a2-186">變更虛擬機器大小將會損毀本機資料。</span><span class="sxs-lookup"><span data-stu-id="439a2-186">Changing the virtual machine size will destroy local data.</span></span>
>
>

<span data-ttu-id="439a2-187">在更新期間不支援下列項目：</span><span class="sxs-lookup"><span data-stu-id="439a2-187">The following items are not supported during an update:</span></span>

* <span data-ttu-id="439a2-188">變更角色的名稱。</span><span class="sxs-lookup"><span data-stu-id="439a2-188">Changing the name of a role.</span></span> <span data-ttu-id="439a2-189">移除角色，而後加入採用新名稱的角色。</span><span class="sxs-lookup"><span data-stu-id="439a2-189">Remove and then add the role with the new name.</span></span>
* <span data-ttu-id="439a2-190">變更升級網域計數。</span><span class="sxs-lookup"><span data-stu-id="439a2-190">Changing of the Upgrade Domain count.</span></span>
* <span data-ttu-id="439a2-191">減少本機資源的大小。</span><span class="sxs-lookup"><span data-stu-id="439a2-191">Decreasing the size of the local resources.</span></span>

<span data-ttu-id="439a2-192">如果您對服務的定義進行其他更新 (例如降低本機資源的大小)，則必須改為執行 VIP 交換更新。</span><span class="sxs-lookup"><span data-stu-id="439a2-192">If you are making other updates to your service's definition, such as decreasing the size of local resource, you must perform a VIP swap update instead.</span></span> <span data-ttu-id="439a2-193">如需詳細資訊，請參閱 [交換部署](https://msdn.microsoft.com/library/azure/ee460814.aspx)。</span><span class="sxs-lookup"><span data-stu-id="439a2-193">For more information, see [Swap Deployment](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span></span>

<a name="howanupgradeproceeds"></a>

## <a name="how-an-upgrade-proceeds"></a><span data-ttu-id="439a2-194">如何繼續進行升級</span><span class="sxs-lookup"><span data-stu-id="439a2-194">How an upgrade proceeds</span></span>
<span data-ttu-id="439a2-195">您可以決定要更新服務中的所有角色或更新服務中的單一角色。</span><span class="sxs-lookup"><span data-stu-id="439a2-195">You can decide whether you want to update all of the roles in your service or a single role in the service.</span></span> <span data-ttu-id="439a2-196">在任一情況下，正在升級且屬於第一個升級網域的每個角色的所有執行個體都會停止、升級並重新上線。</span><span class="sxs-lookup"><span data-stu-id="439a2-196">In either case, all instances of each role that is being upgraded and belong to the first upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="439a2-197">一旦重新上線，第二個升級網域中的執行個體會停止、升級並重新上線。</span><span class="sxs-lookup"><span data-stu-id="439a2-197">Once they are back online, the instances in the second upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="439a2-198">雲端服務一次最多可有一個作用中的升級。</span><span class="sxs-lookup"><span data-stu-id="439a2-198">A cloud service can have at most one upgrade active at a time.</span></span> <span data-ttu-id="439a2-199">升級作業一律針對最新版本的雲端服務執行。</span><span class="sxs-lookup"><span data-stu-id="439a2-199">The upgrade is always performed against the latest version of the cloud service.</span></span>

<span data-ttu-id="439a2-200">下圖說明如果您要升級服務中的所有角色，如何繼續進行升級：</span><span class="sxs-lookup"><span data-stu-id="439a2-200">The following diagram illustrates how the upgrade proceeds if you are upgrading all of the roles in the service:</span></span>

<span data-ttu-id="439a2-201">![升級服務](media/cloud-services-update-azure-service/IC345879.png "升級服務")</span><span class="sxs-lookup"><span data-stu-id="439a2-201">![Upgrade service](media/cloud-services-update-azure-service/IC345879.png "Upgrade service")</span></span>

<span data-ttu-id="439a2-202">下圖說明如果您只要升級單一角色，如何繼續進行更新：</span><span class="sxs-lookup"><span data-stu-id="439a2-202">This next diagram illustrates how the update proceeds if you are upgrading only a single role:</span></span>

<span data-ttu-id="439a2-203">![升級角色](media/cloud-services-update-azure-service/IC345880.png "升級角色")</span><span class="sxs-lookup"><span data-stu-id="439a2-203">![Upgrade role](media/cloud-services-update-azure-service/IC345880.png "Upgrade role")</span></span>  

<span data-ttu-id="439a2-204">在自動更新期間，Azure 網狀架構控制器會定期評估雲端服務的健康狀態，以判斷何時可放心進行下一個 UD。</span><span class="sxs-lookup"><span data-stu-id="439a2-204">During an automatic update, the Azure Fabric Controller periodically evaluates the health of the cloud service to determine when it’s safe to walk the next UD.</span></span> <span data-ttu-id="439a2-205">此健康狀態評估會根據每一個角色執行，而且只考慮最新版本中的執行個體 (也就是 UD 中已進行的執行個體)。</span><span class="sxs-lookup"><span data-stu-id="439a2-205">This health evaluation is performed on a per-role basis and considers only instances in the latest version (i.e. instances from UDs that have already been walked).</span></span> <span data-ttu-id="439a2-206">它會確認每個角色的最少角色執行個體是否已達到令人滿意的終止狀態。</span><span class="sxs-lookup"><span data-stu-id="439a2-206">It verifies that a minimum number of role instances, for each role, have achieved a satisfactory terminal state.</span></span>

### <a name="role-instance-start-timeout"></a><span data-ttu-id="439a2-207">角色執行個體啟動逾時</span><span class="sxs-lookup"><span data-stu-id="439a2-207">Role Instance Start Timeout</span></span>
<span data-ttu-id="439a2-208">網狀架構控制器會等待 30 分鐘，讓每個角色執行個體達到啟動狀態。</span><span class="sxs-lookup"><span data-stu-id="439a2-208">The Fabric Controller will wait 30 minutes for each role instance to reach a Started state.</span></span> <span data-ttu-id="439a2-209">當逾時期間過去後，網狀架構控制器會繼續前進到下一個角色執行個體。</span><span class="sxs-lookup"><span data-stu-id="439a2-209">If the timeout duration elapses, the Fabric Controller will continue walking to the next role instance.</span></span>

### <a name="impact-to-drive-data-during-cloud-service-upgrades"></a><span data-ttu-id="439a2-210">雲端服務升級期間對磁碟機資料造成的影響</span><span class="sxs-lookup"><span data-stu-id="439a2-210">Impact to drive data during Cloud Service upgrades</span></span>

<span data-ttu-id="439a2-211">將服務從單一執行個體升級為多個執行個體時，由於 Azure 升級服務的方式，您的服務將會在執行升級時關閉。</span><span class="sxs-lookup"><span data-stu-id="439a2-211">When upgrading a service from a single instance to multiple instances your service will be brought down while the upgrade is performed due to the way Azure upgrades services.</span></span> <span data-ttu-id="439a2-212">保證服務可用性的服務等級協定僅適用於已部署多個執行個體的服務。</span><span class="sxs-lookup"><span data-stu-id="439a2-212">The service level agreement guaranteeing service availability only applies to services that are deployed with more than one instance.</span></span> <span data-ttu-id="439a2-213">下列清單說明每個 Azure 服務升級案例如何影響每個磁碟機上的資料：</span><span class="sxs-lookup"><span data-stu-id="439a2-213">The following list describes how the data on each drive is affected by each Azure service upgrade scenario:</span></span>

|<span data-ttu-id="439a2-214">案例</span><span class="sxs-lookup"><span data-stu-id="439a2-214">Scenario</span></span>|<span data-ttu-id="439a2-215">C 磁碟機</span><span class="sxs-lookup"><span data-stu-id="439a2-215">C Drive</span></span>|<span data-ttu-id="439a2-216">D 磁碟機</span><span class="sxs-lookup"><span data-stu-id="439a2-216">D Drive</span></span>|<span data-ttu-id="439a2-217">E 磁碟機</span><span class="sxs-lookup"><span data-stu-id="439a2-217">E Drive</span></span>|
|--------|-------|-------|-------|
|<span data-ttu-id="439a2-218">VM 重新啟動</span><span class="sxs-lookup"><span data-stu-id="439a2-218">VM reboot</span></span>|<span data-ttu-id="439a2-219">保留</span><span class="sxs-lookup"><span data-stu-id="439a2-219">Preserved</span></span>|<span data-ttu-id="439a2-220">保留</span><span class="sxs-lookup"><span data-stu-id="439a2-220">Preserved</span></span>|<span data-ttu-id="439a2-221">保留</span><span class="sxs-lookup"><span data-stu-id="439a2-221">Preserved</span></span>|
|<span data-ttu-id="439a2-222">入口網站重新啟動</span><span class="sxs-lookup"><span data-stu-id="439a2-222">Portal reboot</span></span>|<span data-ttu-id="439a2-223">保留</span><span class="sxs-lookup"><span data-stu-id="439a2-223">Preserved</span></span>|<span data-ttu-id="439a2-224">保留</span><span class="sxs-lookup"><span data-stu-id="439a2-224">Preserved</span></span>|<span data-ttu-id="439a2-225">終結</span><span class="sxs-lookup"><span data-stu-id="439a2-225">Destroyed</span></span>|
|<span data-ttu-id="439a2-226">入口網站重新安裝映像</span><span class="sxs-lookup"><span data-stu-id="439a2-226">Portal reimage</span></span>|<span data-ttu-id="439a2-227">保留</span><span class="sxs-lookup"><span data-stu-id="439a2-227">Preserved</span></span>|<span data-ttu-id="439a2-228">終結</span><span class="sxs-lookup"><span data-stu-id="439a2-228">Destroyed</span></span>|<span data-ttu-id="439a2-229">終結</span><span class="sxs-lookup"><span data-stu-id="439a2-229">Destroyed</span></span>|
|<span data-ttu-id="439a2-230">就地升級</span><span class="sxs-lookup"><span data-stu-id="439a2-230">In-Place Upgrade</span></span>|<span data-ttu-id="439a2-231">保留</span><span class="sxs-lookup"><span data-stu-id="439a2-231">Preserved</span></span>|<span data-ttu-id="439a2-232">保留</span><span class="sxs-lookup"><span data-stu-id="439a2-232">Preserved</span></span>|<span data-ttu-id="439a2-233">終結</span><span class="sxs-lookup"><span data-stu-id="439a2-233">Destroyed</span></span>|
|<span data-ttu-id="439a2-234">節點移轉</span><span class="sxs-lookup"><span data-stu-id="439a2-234">Node migration</span></span>|<span data-ttu-id="439a2-235">終結</span><span class="sxs-lookup"><span data-stu-id="439a2-235">Destroyed</span></span>|<span data-ttu-id="439a2-236">終結</span><span class="sxs-lookup"><span data-stu-id="439a2-236">Destroyed</span></span>|<span data-ttu-id="439a2-237">終結</span><span class="sxs-lookup"><span data-stu-id="439a2-237">Destroyed</span></span>|

<span data-ttu-id="439a2-238">請注意，在上述清單中，E: 磁碟機代表角色的根磁碟機，不應使用硬式編碼。</span><span class="sxs-lookup"><span data-stu-id="439a2-238">Note that, in the above list, the E: drive represents the role’s root drive, and should not be hard-coded.</span></span> <span data-ttu-id="439a2-239">請改用 **%RoleRoot%** 環境變數來代表此磁碟機。</span><span class="sxs-lookup"><span data-stu-id="439a2-239">Instead, use the **%RoleRoot%** environment variable to represent the drive.</span></span>

<span data-ttu-id="439a2-240">若要將升級單一執行個體服務時的停機時間最小化，請將新的多執行個體服務部署至預備伺服器並執行 VIP 交換。</span><span class="sxs-lookup"><span data-stu-id="439a2-240">To minimize the downtime when upgrading a single-instance service, deploy a new multi-instance service to the staging server and perform a VIP swap.</span></span>

<a name="RollbackofanUpdate"></a>

## <a name="rollback-of-an-update"></a><span data-ttu-id="439a2-241">復原更新</span><span class="sxs-lookup"><span data-stu-id="439a2-241">Rollback of an update</span></span>
<span data-ttu-id="439a2-242">Azure 讓您在 Azure 網狀架構控制器接受初始更新要求後，於服務上起始其他作業，以提供在更新期間管理服務的彈性。</span><span class="sxs-lookup"><span data-stu-id="439a2-242">Azure provides flexibility in managing services during an update by letting you initiate additional operations on a service, after the initial update request is accepted by the Azure Fabric Controller.</span></span> <span data-ttu-id="439a2-243">只有當部署上的更新 (組態變更) 或升級處於 **進行中** 狀態時，才能執行復原。</span><span class="sxs-lookup"><span data-stu-id="439a2-243">A rollback can only be performed when an update (configuration change) or upgrade is in the **in progress** state on the deployment.</span></span> <span data-ttu-id="439a2-244">只要服務有至少一個執行個體尚未更新為新版本，更新或升級就會被視為進行中。</span><span class="sxs-lookup"><span data-stu-id="439a2-244">An update or upgrade is considered to be in-progress as long as there is at least one instance of the service which has not yet been updated to the new version.</span></span> <span data-ttu-id="439a2-245">若要測試是否允許復原，請檢查[取得部署](https://msdn.microsoft.com/library/azure/ee460804.aspx)和[取得雲端服務屬性](https://msdn.microsoft.com/library/azure/ee460806.aspx)作業所傳回的 RollbackAllowed 旗標值是否設定為 true。</span><span class="sxs-lookup"><span data-stu-id="439a2-245">To test whether a rollback is allowed, check the value of the RollbackAllowed flag, returned by [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations, is set to true.</span></span>

> [!NOTE]
> <span data-ttu-id="439a2-246">只有對 **就地** 更新或升級呼叫 Rollback 才有意義，因為 VIP 交換升級牽涉到以另一個執行個體取代服務的一整個執行中執行個體。</span><span class="sxs-lookup"><span data-stu-id="439a2-246">It only makes sense to call Rollback on an **in-place** update or upgrade because VIP swap upgrades involve replacing one entire running instance of your service with another.</span></span>
>
>

<span data-ttu-id="439a2-247">復原進行中的更新會對部署造成下列影響：</span><span class="sxs-lookup"><span data-stu-id="439a2-247">Rollback of an in-progress update has the following effects on the deployment:</span></span>

* <span data-ttu-id="439a2-248">不會更新或升級尚未更新或升級為新版本的所有角色執行個體，因為這些執行個體已在執行服務的目標版本。</span><span class="sxs-lookup"><span data-stu-id="439a2-248">Any role instances which had not yet been updated or upgraded to the new version are not updated or upgraded, because those instances are already running the target version of the service.</span></span>
* <span data-ttu-id="439a2-249">已更新或升級為新版服務封裝 (\*.cspkg) 檔案或服務組態 (\*.cscfg) 檔案 (或這兩個檔案) 的所有角色執行個體，都會還原成這些檔案的升級前版本。</span><span class="sxs-lookup"><span data-stu-id="439a2-249">Any role instances which had already been updated or upgraded to the new version of the service package (\*.cspkg) file or the service configuration (\*.cscfg) file (or both files) are reverted to the pre-upgrade version of these files.</span></span>

<span data-ttu-id="439a2-250">此作用是由下列功能提供：</span><span class="sxs-lookup"><span data-stu-id="439a2-250">This functionally is provided by the following features:</span></span>

* <span data-ttu-id="439a2-251">[復原更新或升級](https://msdn.microsoft.com/library/azure/hh403977.aspx)作業：只要服務中有至少一個執行個體尚未更新為新版本，即可對組態更新 (藉由呼叫[變更部署組態](https://msdn.microsoft.com/library/azure/ee460809.aspx)來觸發) 或升級 (藉由呼叫[升級部署](https://msdn.microsoft.com/library/azure/ee460793.aspx)來觸發) 呼叫此作業。</span><span class="sxs-lookup"><span data-stu-id="439a2-251">The [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation, which can be called on a configuration update (triggered by calling [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx)) or an upgrade (triggered by calling [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx)) as long as there is at least one instance in the service which has not yet been updated to the new version.</span></span>
* <span data-ttu-id="439a2-252">Locked 項目和 RollbackAllowed 項目；這兩個項目可當作[取得部署](https://msdn.microsoft.com/library/azure/ee460804.aspx)和[取得雲端服務屬性](https://msdn.microsoft.com/library/azure/ee460806.aspx)作業的回應本文一部分傳回：</span><span class="sxs-lookup"><span data-stu-id="439a2-252">The Locked element and the RollbackAllowed element, which are returned as part of the response body of the [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations:</span></span>

  1. <span data-ttu-id="439a2-253">Locked 元素可讓您偵測何時可對指定的部署叫用變更作業。</span><span class="sxs-lookup"><span data-stu-id="439a2-253">The Locked element allows you to detect when a mutating operation can be invoked on a given deployment.</span></span>
  2. <span data-ttu-id="439a2-254">RollbackAllowed 項目可讓您偵測何時可對指定的部署呼叫 [復原更新或升級](https://msdn.microsoft.com/library/azure/hh403977.aspx) 作業。</span><span class="sxs-lookup"><span data-stu-id="439a2-254">The RollbackAllowed element allows you to detect when the [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation can be called on a given deployment.</span></span>

  <span data-ttu-id="439a2-255">若要執行復原，您不必同時檢查 Locked 和 RollbackAllowed 元素。</span><span class="sxs-lookup"><span data-stu-id="439a2-255">In order to perform a rollback, you do not have to check both the Locked and the RollbackAllowed elements.</span></span> <span data-ttu-id="439a2-256">就足以確認 RollbackAllowed 已設定為 true。</span><span class="sxs-lookup"><span data-stu-id="439a2-256">It suffices to confirm that RollbackAllowed is set to true.</span></span> <span data-ttu-id="439a2-257">只有在使用設定為 “x-ms-version: 2011-10-01” 或更新版本的要求標頭叫用這些方法時，才會傳回這些元素。</span><span class="sxs-lookup"><span data-stu-id="439a2-257">These elements are only returned if these methods are invoked by using the request header set to “x-ms-version: 2011-10-01” or a later version.</span></span> <span data-ttu-id="439a2-258">如需標頭版本控制的詳細資訊，請參閱 [服務管理版本控制](https://msdn.microsoft.com/library/azure/gg592580.aspx)。</span><span class="sxs-lookup"><span data-stu-id="439a2-258">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<span data-ttu-id="439a2-259">有某些情況下，不支援復原更新或升級，如下所示：</span><span class="sxs-lookup"><span data-stu-id="439a2-259">There are some situations where a rollback of an update or upgrade is not supported, these are as follows:</span></span>

* <span data-ttu-id="439a2-260">減少本機資源 - 如果更新增加角色的本機資源，則 Azure 平台不會允許復原。</span><span class="sxs-lookup"><span data-stu-id="439a2-260">Reduction in local resources - If the update increases the local resources for a role the Azure platform does not allow rolling back.</span></span>
* <span data-ttu-id="439a2-261">配額限制 - 如果更新是相應減少作業，您可能不再有足夠的計算配額來完成復原作業。</span><span class="sxs-lookup"><span data-stu-id="439a2-261">Quota limitations - If the update was a scale down operation you may no longer have sufficient compute quota to complete the rollback operation.</span></span> <span data-ttu-id="439a2-262">每個 Azure 訂用帳戶都有相關聯的配額，以指定屬於該訂用帳戶的所有託管服務可以取用的核心數目上限。</span><span class="sxs-lookup"><span data-stu-id="439a2-262">Each Azure subscription has a quota associated with it that specifies the maximum number of cores which can be consumed by all hosted services that belong to that subscription.</span></span> <span data-ttu-id="439a2-263">如果執行指定之更新的復原會讓您的訂用帳戶超出配額，則不會啟用復原。</span><span class="sxs-lookup"><span data-stu-id="439a2-263">If performing a rollback of a given update would put your subscription over quota then that a rollback will not be enabled.</span></span>
* <span data-ttu-id="439a2-264">競爭情形 - 如果已完成初始更新，則不可能進行復原。</span><span class="sxs-lookup"><span data-stu-id="439a2-264">Race condition - If the initial update has completed, a rollback is not possible.</span></span>

<span data-ttu-id="439a2-265">如果您在手動模式中使用 [升級部署](https://msdn.microsoft.com/library/azure/ee460793.aspx) 作業來控制您 Azure 託管服務的主要就地升級推展速率，復原更新可能很實用。</span><span class="sxs-lookup"><span data-stu-id="439a2-265">An example of when the rollback of an update might be useful is if you are using the [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) operation in manual mode to control the rate at which a major in-place upgrade to your Azure hosted service is rolled out.</span></span>

<span data-ttu-id="439a2-266">在升級推展期間，您會在手動模式中呼叫 [升級部署](https://msdn.microsoft.com/library/azure/ee460793.aspx) 並開始處理升級網域。</span><span class="sxs-lookup"><span data-stu-id="439a2-266">During the rollout of the upgrade you call [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) in manual mode and begin to walk upgrade domains.</span></span> <span data-ttu-id="439a2-267">如果在某個時間點，當您監視升級時，您注意到您檢查的第一個升級網域中有某些角色執行個體變得沒有回應，您可以在部署上呼叫 [復原更新或升級](https://msdn.microsoft.com/library/azure/hh403977.aspx) 作業，讓尚未升級的執行個體維持不變，而讓已升級的執行個體復原為先前的服務封裝和組態。</span><span class="sxs-lookup"><span data-stu-id="439a2-267">If at some point, as you monitor the upgrade, you note some role instances in the first upgrade domains that you examine have become unresponsive, you can call the [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation on the deployment, which will leave untouched the instances which had not yet been upgraded and rollback instances which had been upgraded to the previous service package and configuration.</span></span>

<a name="multiplemutatingoperations"></a>

## <a name="initiating-multiple-mutating-operations-on-an-ongoing-deployment"></a><span data-ttu-id="439a2-268">在進行中的部署上起始多項變更作業</span><span class="sxs-lookup"><span data-stu-id="439a2-268">Initiating multiple mutating operations on an ongoing deployment</span></span>
<span data-ttu-id="439a2-269">在某些情況下，您可能想要在進行中的部署上起始多項同時變更作業。</span><span class="sxs-lookup"><span data-stu-id="439a2-269">In some cases you may want to initiate multiple simultaneous mutating operations on an ongoing deployment.</span></span> <span data-ttu-id="439a2-270">例如，您可能執行服務更新，而當該更新推展於您的服務時，您想要進行一些變更，例如復原更新、套用不同的更新，或甚至刪除部署。</span><span class="sxs-lookup"><span data-stu-id="439a2-270">For example, you may perform a service update and, while that update is being rolled out across your service, you want to make some change, e.g. to roll the update back, apply a different update, or even delete the deployment.</span></span> <span data-ttu-id="439a2-271">如果服務升級包含會使已升級的角色執行個體反覆損毀的不良程式碼，則可能必須這麼做。</span><span class="sxs-lookup"><span data-stu-id="439a2-271">A case in which this might be necessary is if a service upgrade contains buggy code which causes an upgraded role instance to repeatedly crash.</span></span> <span data-ttu-id="439a2-272">在此情況下，Azure 網狀架構控制器將無法繼續套用該升級，因為已升級網域中的執行個體數目不足屬於正常狀況。</span><span class="sxs-lookup"><span data-stu-id="439a2-272">In this case, the Azure Fabric Controller will not be able to make progress in applying that upgrade because an insufficient number of instances in the upgraded domain are healthy.</span></span> <span data-ttu-id="439a2-273">此狀態稱為「停滯部署」 。</span><span class="sxs-lookup"><span data-stu-id="439a2-273">This state is referred to as a *stuck deployment*.</span></span> <span data-ttu-id="439a2-274">復原更新或在失敗的更新之上套用全新的更新，即可脫離停滯部署狀態。</span><span class="sxs-lookup"><span data-stu-id="439a2-274">You can unstick the deployment by rolling back the update or applying a fresh update over top of the failing one.</span></span>

<span data-ttu-id="439a2-275">一旦 Azure 網狀架構控制器收到更新或升級服務的初始要求，您就可以開始進行後續的變更作業。</span><span class="sxs-lookup"><span data-stu-id="439a2-275">Once the initial request to update or upgrade the service has been received by the Azure Fabric Controller, you can start subsequent mutating operations.</span></span> <span data-ttu-id="439a2-276">也就是說，您不必等候初始作業完成，即可開始進行另一個變更作業。</span><span class="sxs-lookup"><span data-stu-id="439a2-276">That is, you do not have to wait for the initial operation to complete before you can start another mutating operation.</span></span>

<span data-ttu-id="439a2-277">在第一個更新正在進行時起始第二個更新作業，將類似於執行復原作業。</span><span class="sxs-lookup"><span data-stu-id="439a2-277">Initiating a second update operation while the first update is ongoing will perform similar to the rollback operation.</span></span> <span data-ttu-id="439a2-278">如果第二個更新處於自動模式，則第一個升級網域將會立即升級，這可能會導致多個升級網域中的執行個體在同一時間離線。</span><span class="sxs-lookup"><span data-stu-id="439a2-278">If the second update is in automatic mode, the first upgrade domain will be upgraded immediately, possibly leading to instances from multiple upgrade domains being offline at the same point in time.</span></span>

<span data-ttu-id="439a2-279">變更作業如下：[變更部署組態](https://msdn.microsoft.com/library/azure/ee460809.aspx)、[升級部署](https://msdn.microsoft.com/library/azure/ee460793.aspx)、[更新部署狀態](https://msdn.microsoft.com/library/azure/ee460808.aspx)、[刪除部署](https://msdn.microsoft.com/library/azure/ee460815.aspx)及[復原更新或升級](https://msdn.microsoft.com/library/azure/hh403977.aspx)。</span><span class="sxs-lookup"><span data-stu-id="439a2-279">The mutating operations are as follows: [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Update Deployment Status](https://msdn.microsoft.com/library/azure/ee460808.aspx), [Delete Deployment](https://msdn.microsoft.com/library/azure/ee460815.aspx), and [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span></span>

<span data-ttu-id="439a2-280">[取得部署](https://msdn.microsoft.com/library/azure/ee460804.aspx)和[取得雲端服務屬性](https://msdn.microsoft.com/library/azure/ee460806.aspx)這兩項作業會傳回 Locked 旗標，檢查該旗標可以判斷是否可以在指定的部署上叫用變更作業。</span><span class="sxs-lookup"><span data-stu-id="439a2-280">Two operations, [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx), return the Locked flag which can be examined to determine whether a mutating operation can be invoked on a given deployment.</span></span>

<span data-ttu-id="439a2-281">若要呼叫可傳回 Locked 旗標的這些方法的版本，您必須將要求標頭設定為 “x-ms-version: 2011-10-01” 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="439a2-281">In order to call the version of these methods which returns the Locked flag, you must set request header to “x-ms-version: 2011-10-01” or a later.</span></span> <span data-ttu-id="439a2-282">如需標頭版本控制的詳細資訊，請參閱 [服務管理版本控制](https://msdn.microsoft.com/library/azure/gg592580.aspx)。</span><span class="sxs-lookup"><span data-stu-id="439a2-282">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<a name="distributiondfroles"></a>

## <a name="distribution-of-roles-across-upgrade-domains"></a><span data-ttu-id="439a2-283">將角色散發於升級網域</span><span class="sxs-lookup"><span data-stu-id="439a2-283">Distribution of roles across upgrade domains</span></span>
<span data-ttu-id="439a2-284">Azure 會將角色的執行個體平均分散於一組升級網域，而升級網域可設定為服務定義 (.csdef) 檔案的一部分。</span><span class="sxs-lookup"><span data-stu-id="439a2-284">Azure distributes instances of a role evenly across a set number of upgrade domains, which can be configured as part of the service definition (.csdef) file.</span></span> <span data-ttu-id="439a2-285">升級網域數目上限為 20，其預設值為 5。</span><span class="sxs-lookup"><span data-stu-id="439a2-285">The max number of upgrade domains is 20 and the default is 5.</span></span> <span data-ttu-id="439a2-286">如需如何修改服務定義檔的詳細資訊，請參閱 [Azure 服務定義結構描述 (.csdef 檔)](cloud-services-model-and-package.md#csdef)。</span><span class="sxs-lookup"><span data-stu-id="439a2-286">For more information about how to modify the service definition file, see [Azure Service Definition Schema (.csdef File)](cloud-services-model-and-package.md#csdef).</span></span>

<span data-ttu-id="439a2-287">例如，如果您的角色有 10 個執行個體，依預設每個升級網域包含 2 個執行個體。</span><span class="sxs-lookup"><span data-stu-id="439a2-287">For example, if your role has ten instances, by default each upgrade domain contains two instances.</span></span> <span data-ttu-id="439a2-288">如果您的角色有 14 個執行個體，則其中 4 個升級網域包含 3 個執行個體，而第 5 個網域包含 2 個執行個體。</span><span class="sxs-lookup"><span data-stu-id="439a2-288">If your role has 14 instances, then four of the upgrade domains contain three instances, and a fifth domain contains two.</span></span>

<span data-ttu-id="439a2-289">升級網域會使用以零為基底的索引進行識別：第一個升級網域的識別碼為 0，而第二個升級網域的識別碼為 1，依此類推。</span><span class="sxs-lookup"><span data-stu-id="439a2-289">Upgrade domains are identified with a zero-based index: the first upgrade domain has an ID of 0, and the second upgrade domain has an ID of 1, and so on.</span></span>

<span data-ttu-id="439a2-290">下圖說明當服務定義兩個升級網域時，如何散發包含兩個角色的服務。</span><span class="sxs-lookup"><span data-stu-id="439a2-290">The following diagram illustrates how a service than contains two roles are distributed when the service defines two upgrade domains.</span></span> <span data-ttu-id="439a2-291">此服務正在執行 Web 角色的 8 個執行個體以及背景工作角色的 9 個執行個體。</span><span class="sxs-lookup"><span data-stu-id="439a2-291">The service is running eight instances of the web role and nine instances of the worker role.</span></span>

<span data-ttu-id="439a2-292">![升級網域的分配](media/cloud-services-update-azure-service/IC345533.png "升級網域的分配")</span><span class="sxs-lookup"><span data-stu-id="439a2-292">![Distribution of Upgrade Domains](media/cloud-services-update-azure-service/IC345533.png "Distribution of Upgrade Domains")</span></span>

> [!NOTE]
> <span data-ttu-id="439a2-293">請注意，Azure 會控制執行個體配置於升級網域的方式。</span><span class="sxs-lookup"><span data-stu-id="439a2-293">Note that Azure controls how instances are allocated across upgrade domains.</span></span> <span data-ttu-id="439a2-294">您無法指定哪些執行個體會配置給哪一個網域。</span><span class="sxs-lookup"><span data-stu-id="439a2-294">It's not possible to specify which instances are allocated to which domain.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="439a2-295">後續步驟</span><span class="sxs-lookup"><span data-stu-id="439a2-295">Next steps</span></span>
[<span data-ttu-id="439a2-296">如何管理雲端服務</span><span class="sxs-lookup"><span data-stu-id="439a2-296">How to Manage Cloud Services</span></span>](cloud-services-how-to-manage.md)  
[<span data-ttu-id="439a2-297">如何監視雲端服務</span><span class="sxs-lookup"><span data-stu-id="439a2-297">How to Monitor Cloud Services</span></span>](cloud-services-how-to-monitor.md)  
[<span data-ttu-id="439a2-298">如何設定雲端服務</span><span class="sxs-lookup"><span data-stu-id="439a2-298">How to Configure Cloud Services</span></span>](cloud-services-how-to-configure.md)  
