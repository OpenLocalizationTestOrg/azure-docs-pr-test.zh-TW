---
title: "位於防火牆後方 aaaAccess 金鑰保存庫 |Microsoft 文件"
description: "了解如何 tooaccess Azure 金鑰保存庫位於防火牆後方的應用程式"
services: key-vault
documentationcenter: 
author: amitbapat
manager: mbaldwin
tags: azure-resource-manager
ms.assetid: 50d21774-2ee1-4212-8995-570c9de603c5
ms.service: key-vault
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 01/07/2017
ms.author: ambapat
ms.openlocfilehash: ab4bb0c27a41fef878a20dace6cab203df04e579
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="access-azure-key-vault-behind-a-firewall"></a><span data-ttu-id="81860-103">在防火牆後存取 Azure 金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="81860-103">Access Azure Key Vault behind a firewall</span></span>
### <a name="q-my-key-vault-client-application-needs-toobe-behind-a-firewall-what-ports-hosts-or-ip-addresses-should-i-open-tooenable-access-tooa-key-vault"></a><span data-ttu-id="81860-104">問： 我的金鑰保存庫用戶端應用程式需要在防火牆後面的 toobe。</span><span class="sxs-lookup"><span data-stu-id="81860-104">Q: My key vault client application needs toobe behind a firewall.</span></span> <span data-ttu-id="81860-105">哪些連接埠、 主機或 IP 位址應該開啟 tooenable 存取 tooa 金鑰保存庫？</span><span class="sxs-lookup"><span data-stu-id="81860-105">What ports, hosts, or IP addresses should I open tooenable access tooa key vault?</span></span>
<span data-ttu-id="81860-106">tooaccess 金鑰保存庫，用戶端應用程式金鑰保存庫有 tooaccess 多個端點的各種不同功能：</span><span class="sxs-lookup"><span data-stu-id="81860-106">tooaccess a key vault, your key vault client application has tooaccess multiple endpoints for various functionalities:</span></span>

* <span data-ttu-id="81860-107">透過 Azure Active Directory (Azure AD) 進行的驗證。</span><span class="sxs-lookup"><span data-stu-id="81860-107">Authentication via Azure Active Directory (Azure AD).</span></span>
* <span data-ttu-id="81860-108">Azure 金鑰保存庫的管理。</span><span class="sxs-lookup"><span data-stu-id="81860-108">Management of Azure Key Vault.</span></span> <span data-ttu-id="81860-109">這包括透過 Azure Resource Manager 建立、讀取、更新、刪除和設定存取原則。</span><span class="sxs-lookup"><span data-stu-id="81860-109">This includes creating, reading, updating, deleting, and setting access policies through Azure Resource Manager.</span></span>
* <span data-ttu-id="81860-110">存取和管理物件 （金鑰和密碼） 本身儲存在金鑰保存庫中，瀏覽 hello 金鑰保存庫特定端點 (例如， [https://yourvaultname.vault.azure.net](https://yourvaultname.vault.azure.net))。</span><span class="sxs-lookup"><span data-stu-id="81860-110">Accessing and managing objects (keys and secrets) stored in Key Vault itself, going through hello Key Vault-specific endpoint (for example, [https://yourvaultname.vault.azure.net](https://yourvaultname.vault.azure.net)).</span></span>  

<span data-ttu-id="81860-111">視您的組態和環境而定，會有一些變化。</span><span class="sxs-lookup"><span data-stu-id="81860-111">Depending on your configuration and environment, there are some variations.</span></span>   

## <a name="ports"></a><span data-ttu-id="81860-112">連接埠</span><span class="sxs-lookup"><span data-stu-id="81860-112">Ports</span></span>
<span data-ttu-id="81860-113">所有流量 tooa 金鑰保存庫的所有三個函式 （驗證、 管理和資料飛機存取） 都會透過 HTTPS： 通訊埠 443。</span><span class="sxs-lookup"><span data-stu-id="81860-113">All traffic tooa key vault for all three functions (authentication, management, and data plane access) goes over HTTPS: port 443.</span></span> <span data-ttu-id="81860-114">不過，偶爾會有 CRL 的 HTTP (連接埠 80) 流量。</span><span class="sxs-lookup"><span data-stu-id="81860-114">However, there will occasionally be HTTP (port 80) traffic for CRL.</span></span> <span data-ttu-id="81860-115">支援 OCSP 的用戶端不應該觸達 CRL，但可能偶爾會觸達 [http://cdp1.public-trust.com/CRL/Omniroot2025.crl](http://cdp1.public-trust.com/CRL/Omniroot2025.crl)。</span><span class="sxs-lookup"><span data-stu-id="81860-115">Clients that support OCSP shouldn't reach CRL, but may occasionally reach [http://cdp1.public-trust.com/CRL/Omniroot2025.crl](http://cdp1.public-trust.com/CRL/Omniroot2025.crl).</span></span>  

## <a name="authentication"></a><span data-ttu-id="81860-116">驗證</span><span class="sxs-lookup"><span data-stu-id="81860-116">Authentication</span></span>
<span data-ttu-id="81860-117">金鑰保存庫用戶端應用程式需要 tooaccess Azure Active Directory 端點進行驗證。</span><span class="sxs-lookup"><span data-stu-id="81860-117">Key vault client applications will need tooaccess Azure Active Directory endpoints for authentication.</span></span> <span data-ttu-id="81860-118">hello 端點是用定 hello Azure AD 租用戶的組態，主體 （使用者主體或服務主體） 和 hello hello 類型輸入的帳戶-例如，Microsoft 帳戶或工作或學校帳戶。</span><span class="sxs-lookup"><span data-stu-id="81860-118">hello endpoint used depends on hello Azure AD tenant configuration, hello type of principal (user principal or service principal), and hello type of account--for example, a Microsoft account or a work or school account.</span></span>  

| <span data-ttu-id="81860-119">主體類型</span><span class="sxs-lookup"><span data-stu-id="81860-119">Principal type</span></span> | <span data-ttu-id="81860-120">端點:連接埠</span><span class="sxs-lookup"><span data-stu-id="81860-120">Endpoint:port</span></span> |
| --- | --- |
| <span data-ttu-id="81860-121">使用 Microsoft 帳戶的使用者</span><span class="sxs-lookup"><span data-stu-id="81860-121">User using Microsoft account</span></span><br> <span data-ttu-id="81860-122">(例如， user@hotmail.com)</span><span class="sxs-lookup"><span data-stu-id="81860-122">(for example, user@hotmail.com)</span></span> |<span data-ttu-id="81860-123">**全域：**</span><span class="sxs-lookup"><span data-stu-id="81860-123">**Global:**</span></span><br> <span data-ttu-id="81860-124">login.microsoftonline.com:443</span><span class="sxs-lookup"><span data-stu-id="81860-124">login.microsoftonline.com:443</span></span><br><br> <span data-ttu-id="81860-125">**Azure 中國︰**</span><span class="sxs-lookup"><span data-stu-id="81860-125">**Azure China:**</span></span><br> <span data-ttu-id="81860-126">login.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="81860-126">login.chinacloudapi.cn:443</span></span><br><br><span data-ttu-id="81860-127">**Azure 美國政府︰**</span><span class="sxs-lookup"><span data-stu-id="81860-127">**Azure US Government:**</span></span><br> <span data-ttu-id="81860-128">login-us.microsoftonline.com:443</span><span class="sxs-lookup"><span data-stu-id="81860-128">login-us.microsoftonline.com:443</span></span><br><br><span data-ttu-id="81860-129">**Azure 德國︰**</span><span class="sxs-lookup"><span data-stu-id="81860-129">**Azure Germany:**</span></span><br> <span data-ttu-id="81860-130">login.microsoftonline.de:443</span><span class="sxs-lookup"><span data-stu-id="81860-130">login.microsoftonline.de:443</span></span><br><br> <span data-ttu-id="81860-131">和</span><span class="sxs-lookup"><span data-stu-id="81860-131">and</span></span> <br><span data-ttu-id="81860-132">login.live.com:443</span><span class="sxs-lookup"><span data-stu-id="81860-132">login.live.com:443</span></span> |
| <span data-ttu-id="81860-133">使用者或服務主體與 Azure AD 中使用工作或學校帳戶 (例如， user@contoso.com)</span><span class="sxs-lookup"><span data-stu-id="81860-133">User or service principal using a work or school account with Azure AD (for example, user@contoso.com)</span></span> |<span data-ttu-id="81860-134">**全域：**</span><span class="sxs-lookup"><span data-stu-id="81860-134">**Global:**</span></span><br> <span data-ttu-id="81860-135">login.microsoftonline.com:443</span><span class="sxs-lookup"><span data-stu-id="81860-135">login.microsoftonline.com:443</span></span><br><br> <span data-ttu-id="81860-136">**Azure 中國︰**</span><span class="sxs-lookup"><span data-stu-id="81860-136">**Azure China:**</span></span><br> <span data-ttu-id="81860-137">login.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="81860-137">login.chinacloudapi.cn:443</span></span><br><br><span data-ttu-id="81860-138">**Azure 美國政府︰**</span><span class="sxs-lookup"><span data-stu-id="81860-138">**Azure US Government:**</span></span><br> <span data-ttu-id="81860-139">login-us.microsoftonline.com:443</span><span class="sxs-lookup"><span data-stu-id="81860-139">login-us.microsoftonline.com:443</span></span><br><br><span data-ttu-id="81860-140">**Azure 德國︰**</span><span class="sxs-lookup"><span data-stu-id="81860-140">**Azure Germany:**</span></span><br> <span data-ttu-id="81860-141">login.microsoftonline.de:443</span><span class="sxs-lookup"><span data-stu-id="81860-141">login.microsoftonline.de:443</span></span> |
| <span data-ttu-id="81860-142">使用者或服務主體使用工作或學校帳戶，再加上 Active Directory Federation Services (AD FS) 或其他同盟的端點 (例如， user@contoso.com)</span><span class="sxs-lookup"><span data-stu-id="81860-142">User or service principal using a work or school account, plus Active Directory Federation Services (AD FS) or other federated endpoint (for example, user@contoso.com)</span></span> |<span data-ttu-id="81860-143">公司帳戶或學校帳戶的所有端點，加上 AD FS 或其他同盟端點</span><span class="sxs-lookup"><span data-stu-id="81860-143">All endpoints for a work or school account, plus AD FS or other federated endpoints</span></span> |

<span data-ttu-id="81860-144">還有其他可能的複雜案例。</span><span class="sxs-lookup"><span data-stu-id="81860-144">There are other possible complex scenarios.</span></span> <span data-ttu-id="81860-145">請參閱太[Azure Active Directory 驗證流程](/documentation/articles/active-directory-authentication-scenarios/)，[整合應用程式與 Azure Active Directory](/documentation/articles/active-directory-integrating-applications/)，和[Active Directory 驗證通訊協定](https://msdn.microsoft.com/library/azure/dn151124.aspx)如需詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="81860-145">Refer too[Azure Active Directory Authentication Flow](/documentation/articles/active-directory-authentication-scenarios/), [Integrating Applications with Azure Active Directory](/documentation/articles/active-directory-integrating-applications/), and [Active Directory Authentication Protocols](https://msdn.microsoft.com/library/azure/dn151124.aspx) for additional information.</span></span>  

## <a name="key-vault-management"></a><span data-ttu-id="81860-146">金鑰保存庫管理</span><span class="sxs-lookup"><span data-stu-id="81860-146">Key Vault management</span></span>
<span data-ttu-id="81860-147">金鑰保存庫管理 （CRUD 並設定存取原則），hello 金鑰保存庫用戶端應用程式需要 tooaccess Azure 資源管理員端點。</span><span class="sxs-lookup"><span data-stu-id="81860-147">For Key Vault management (CRUD and setting access policy), hello key vault client application needs tooaccess an Azure Resource Manager endpoint.</span></span>  

| <span data-ttu-id="81860-148">作業類型</span><span class="sxs-lookup"><span data-stu-id="81860-148">Type of operation</span></span> | <span data-ttu-id="81860-149">端點:連接埠</span><span class="sxs-lookup"><span data-stu-id="81860-149">Endpoint:port</span></span> |
| --- | --- |
| <span data-ttu-id="81860-150">透過 Azure Resource Manager 的</span><span class="sxs-lookup"><span data-stu-id="81860-150">Key Vault control plane operations</span></span><br> <span data-ttu-id="81860-151">金鑰保存庫控制項面作業</span><span class="sxs-lookup"><span data-stu-id="81860-151">via Azure Resource Manager</span></span> |<span data-ttu-id="81860-152">**全域：**</span><span class="sxs-lookup"><span data-stu-id="81860-152">**Global:**</span></span><br> <span data-ttu-id="81860-153">management.azure.com:443</span><span class="sxs-lookup"><span data-stu-id="81860-153">management.azure.com:443</span></span><br><br> <span data-ttu-id="81860-154">**Azure 中國︰**</span><span class="sxs-lookup"><span data-stu-id="81860-154">**Azure China:**</span></span><br> <span data-ttu-id="81860-155">management.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="81860-155">management.chinacloudapi.cn:443</span></span><br><br> <span data-ttu-id="81860-156">**Azure 美國政府︰**</span><span class="sxs-lookup"><span data-stu-id="81860-156">**Azure US Government:**</span></span><br> <span data-ttu-id="81860-157">management.usgovcloudapi.net:443</span><span class="sxs-lookup"><span data-stu-id="81860-157">management.usgovcloudapi.net:443</span></span><br><br> <span data-ttu-id="81860-158">**Azure 德國︰**</span><span class="sxs-lookup"><span data-stu-id="81860-158">**Azure Germany:**</span></span><br> <span data-ttu-id="81860-159">management.microsoftazure.de:443</span><span class="sxs-lookup"><span data-stu-id="81860-159">management.microsoftazure.de:443</span></span> |
| <span data-ttu-id="81860-160">Azure Active Directory 圖形 API</span><span class="sxs-lookup"><span data-stu-id="81860-160">Azure Active Directory Graph API</span></span> |<span data-ttu-id="81860-161">**全域：**</span><span class="sxs-lookup"><span data-stu-id="81860-161">**Global:**</span></span><br> <span data-ttu-id="81860-162">graph.windows.net:443</span><span class="sxs-lookup"><span data-stu-id="81860-162">graph.windows.net:443</span></span><br><br> <span data-ttu-id="81860-163">**Azure 中國︰**</span><span class="sxs-lookup"><span data-stu-id="81860-163">**Azure China:**</span></span><br> <span data-ttu-id="81860-164">graph.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="81860-164">graph.chinacloudapi.cn:443</span></span><br><br> <span data-ttu-id="81860-165">**Azure 美國政府︰**</span><span class="sxs-lookup"><span data-stu-id="81860-165">**Azure US Government:**</span></span><br> <span data-ttu-id="81860-166">graph.windows.net:443</span><span class="sxs-lookup"><span data-stu-id="81860-166">graph.windows.net:443</span></span><br><br> <span data-ttu-id="81860-167">**Azure 德國︰**</span><span class="sxs-lookup"><span data-stu-id="81860-167">**Azure Germany:**</span></span><br> <span data-ttu-id="81860-168">graph.cloudapi.de:443</span><span class="sxs-lookup"><span data-stu-id="81860-168">graph.cloudapi.de:443</span></span> |

## <a name="key-vault-operations"></a><span data-ttu-id="81860-169">金鑰保存庫作業</span><span class="sxs-lookup"><span data-stu-id="81860-169">Key Vault operations</span></span>
<span data-ttu-id="81860-170">對於所有金鑰保存庫物件 （金鑰和密碼） 管理與密碼編譯作業，hello 金鑰保存庫用戶端必須 tooaccess hello 金鑰保存庫端點。</span><span class="sxs-lookup"><span data-stu-id="81860-170">For all key vault object (keys and secrets) management and cryptographic operations, hello key vault client needs tooaccess hello key vault endpoint.</span></span> <span data-ttu-id="81860-171">hello 端點 DNS 尾碼的金鑰保存庫的 hello 位置而有所不同。</span><span class="sxs-lookup"><span data-stu-id="81860-171">hello endpoint DNS suffix varies depending on hello location of your key vault.</span></span> <span data-ttu-id="81860-172">hello 金鑰保存庫端點是否為 hello 格式*保存庫名稱*。*區域特定的 dns 尾碼*、 hello 下表中所述。</span><span class="sxs-lookup"><span data-stu-id="81860-172">hello key vault endpoint is of hello format *vault-name*.*region-specific-dns-suffix*, as described in hello following table.</span></span>  

| <span data-ttu-id="81860-173">作業類型</span><span class="sxs-lookup"><span data-stu-id="81860-173">Type of operation</span></span> | <span data-ttu-id="81860-174">端點:連接埠</span><span class="sxs-lookup"><span data-stu-id="81860-174">Endpoint:port</span></span> |
| --- | --- |
| <span data-ttu-id="81860-175">包括金鑰的密碼編譯作業在內的作業；建立、讀取、更新和刪除金鑰與密碼；對金鑰保存庫物件 (金鑰或密碼) 設定或取得標籤和其他屬性</span><span class="sxs-lookup"><span data-stu-id="81860-175">Operations including cryptographic operations on keys; creating, reading, updating, and deleting keys and secrets; setting or getting tags and other attributes on key vault objects (keys or secrets)</span></span> |<span data-ttu-id="81860-176">**全域：**</span><span class="sxs-lookup"><span data-stu-id="81860-176">**Global:**</span></span><br> <span data-ttu-id="81860-177">&lt;vault-name&gt;.vault.azure.net:443</span><span class="sxs-lookup"><span data-stu-id="81860-177">&lt;vault-name&gt;.vault.azure.net:443</span></span><br><br> <span data-ttu-id="81860-178">**Azure 中國︰**</span><span class="sxs-lookup"><span data-stu-id="81860-178">**Azure China:**</span></span><br> <span data-ttu-id="81860-179">&lt;vault-name&gt;.vault.azure.cn:443</span><span class="sxs-lookup"><span data-stu-id="81860-179">&lt;vault-name&gt;.vault.azure.cn:443</span></span><br><br> <span data-ttu-id="81860-180">**Azure 美國政府︰**</span><span class="sxs-lookup"><span data-stu-id="81860-180">**Azure US Government:**</span></span><br> <span data-ttu-id="81860-181">&lt;vault-name&gt;.vault.usgovcloudapi.net:443</span><span class="sxs-lookup"><span data-stu-id="81860-181">&lt;vault-name&gt;.vault.usgovcloudapi.net:443</span></span><br><br> <span data-ttu-id="81860-182">**Azure 德國︰**</span><span class="sxs-lookup"><span data-stu-id="81860-182">**Azure Germany:**</span></span><br> <span data-ttu-id="81860-183">&lt;vault-name&gt;.vault.microsoftazure.de:443</span><span class="sxs-lookup"><span data-stu-id="81860-183">&lt;vault-name&gt;.vault.microsoftazure.de:443</span></span> |

## <a name="ip-address-ranges"></a><span data-ttu-id="81860-184">IP 位址範圍</span><span class="sxs-lookup"><span data-stu-id="81860-184">IP address ranges</span></span>
<span data-ttu-id="81860-185">hello 金鑰保存庫服務會使用其他 Azure 資源，例如 PaaS 基礎結構。</span><span class="sxs-lookup"><span data-stu-id="81860-185">hello Key Vault service uses other Azure resources like PaaS infrastructure.</span></span> <span data-ttu-id="81860-186">如此就不可能 tooprovide 特定 IP 位址範圍，服務端點會有任何特定時間的金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="81860-186">So it's not possible tooprovide a specific range of IP addresses that Key Vault service endpoints will have at any particular time.</span></span> <span data-ttu-id="81860-187">如果您的防火牆支援 IP 位址範圍，請參閱 toohello [Microsoft Azure Datacenter IP 範圍](https://www.microsoft.com/download/details.aspx?id=41653)文件。</span><span class="sxs-lookup"><span data-stu-id="81860-187">If your firewall supports only IP address ranges, refer toohello [Microsoft Azure Datacenter IP Ranges](https://www.microsoft.com/download/details.aspx?id=41653) document.</span></span> <span data-ttu-id="81860-188">驗證和身分識別 (Azure Active Directory)，您的應用程式必須能夠 tooconnect toohello 端點中所述[驗證和身分識別位址](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2)。</span><span class="sxs-lookup"><span data-stu-id="81860-188">For authentication and identity (Azure Active Directory), your application must be able tooconnect toohello endpoints described in [Authentication and identity addresses](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2).</span></span>

## <a name="next-steps"></a><span data-ttu-id="81860-189">後續步驟</span><span class="sxs-lookup"><span data-stu-id="81860-189">Next steps</span></span>
<span data-ttu-id="81860-190">如果您有金鑰保存庫相關的問題，請瀏覽 hello [Azure 金鑰保存庫論壇](https://social.msdn.microsoft.com/forums/azure/home?forum=AzureKeyVault)。</span><span class="sxs-lookup"><span data-stu-id="81860-190">If you have questions about Key Vault, visit hello [Azure Key Vault Forums](https://social.msdn.microsoft.com/forums/azure/home?forum=AzureKeyVault).</span></span>

