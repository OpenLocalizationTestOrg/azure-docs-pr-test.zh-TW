---
title: "aaaSecure 您金鑰保存庫 |Microsoft 文件"
description: "管理金鑰保存庫的存取權限，來管理保存庫以及金鑰和密碼。 金鑰保存庫，和如何 toosecure 您金鑰保存庫的驗證和授權模型"
services: key-vault
documentationcenter: 
author: amitbapat
manager: mbaldwin
tags: azure-resource-manager
ms.assetid: e5b4e083-4a39-4410-8e3a-2832ad6db405
ms.service: key-vault
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 01/07/2017
ms.author: ambapat
ms.openlocfilehash: 84f5fc18142a1ad89babbd11f4f65eca105afc32
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="secure-your-key-vault"></a><span data-ttu-id="e1d8a-104">保護您的金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="e1d8a-104">Secure your key vault</span></span>
<span data-ttu-id="e1d8a-105">Azure 金鑰保存庫是用來保護雲端應用程式加密金鑰和密碼 (例如憑證、連接字串、密碼) 的雲端服務。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-105">Azure Key Vault is a cloud service that safeguards encryption keys and secrets (such as certificates, connection strings, passwords) for your cloud applications.</span></span> <span data-ttu-id="e1d8a-106">由於此資料區分和重要商務資料，您想要 toosecure 存取 tooyour 金鑰保存庫，如此只有獲得授權的應用程式，而使用者可以存取金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-106">Since this data is sensitive and business critical, you want toosecure access tooyour key vaults so that only authorized applications and users can access key vault.</span></span> <span data-ttu-id="e1d8a-107">這篇文章會提供金鑰保存庫存取模型的概觀，說明驗證和授權，並描述 toosecure 存取 tookey 為您的雲端應用程式，並以範例的保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-107">This article provides an overview of key vault access model, explains authentication and authorization, and describes how toosecure access tookey vault for your cloud applications with an example.</span></span>

## <a name="overview"></a><span data-ttu-id="e1d8a-108">概觀</span><span class="sxs-lookup"><span data-stu-id="e1d8a-108">Overview</span></span>
<span data-ttu-id="e1d8a-109">存取 tooa 金鑰保存庫由兩個不同的介面： 管理平面和資料飛機。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-109">Access tooa key vault is controlled through two separate interfaces: management plane and data plane.</span></span> <span data-ttu-id="e1d8a-110">對於這兩個平面適當的驗證和授權都需要之前 （使用者或應用程式） 的呼叫端可以取得存取 tookey 保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-110">For both planes proper authentication and authorization is required before a caller (a user or an application) can get access tookey vault.</span></span> <span data-ttu-id="e1d8a-111">授權會判斷哪些作業 hello 呼叫端允許 tooperform 時，驗證就會建立 hello 的 hello 的呼叫端的身分識別。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-111">Authentication establishes hello identity of hello caller, while authorization determines what operations hello caller is allowed tooperform.</span></span>

<span data-ttu-id="e1d8a-112">管理平面和資料平面都會使用 Azure Active Directory 來進行驗證。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-112">For authentication both management plane and data plane use Azure Active Directory.</span></span> <span data-ttu-id="e1d8a-113">至於授權，管理平面使用角色型存取控制 (RBAC)，資料平面則使用金鑰保存庫存取原則。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-113">For authorization, management plane uses role-based access control (RBAC) while data plane uses key vault access policy.</span></span>

<span data-ttu-id="e1d8a-114">以下是以概略認識 hello 所討論的主題：</span><span class="sxs-lookup"><span data-stu-id="e1d8a-114">Here is a brief overview of hello topics covered:</span></span>

<span data-ttu-id="e1d8a-115">[使用 Azure Active Directory 驗證](#authentication-using-azure-active-directory)-本章節將說明如何呼叫者向 Azure Active Directory tooaccess 管理平面和資料飛機透過金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-115">[Authentication using Azure Active Directory](#authentication-using-azure-active-directory) - This section explains how a caller authenticates with Azure Active Directory tooaccess a key vault via management plane and data plane.</span></span> 

<span data-ttu-id="e1d8a-116">[管理平面和資料平面](#management-plane-and-data-plane) - 管理平面和資料平面是用來存取金鑰保存庫的兩個存取平面。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-116">[Management plane and data plane](#management-plane-and-data-plane) - Management plane and data plane are two access planes used for accessing your key vault.</span></span> <span data-ttu-id="e1d8a-117">這兩個存取平面各支援特定作業。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-117">Each access plane supports specific operations.</span></span> <span data-ttu-id="e1d8a-118">本章節描述 hello 存取端點，支援，及存取控制方法的每個平面所使用的作業。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-118">This section describes hello access endpoints, operations supported, and access control method used by each plane.</span></span> 

<span data-ttu-id="e1d8a-119">[管理平面存取控制](#management-plane-access-control)-我們將探討允許存取 toomanagement 平面作業使用以角色為基礎的存取控制這一節。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-119">[Management plane access control](#management-plane-access-control) - In this section we'll look at allowing access toomanagement plane operations using role-based access control.</span></span>

<span data-ttu-id="e1d8a-120">[平面資料的存取控制](#data-plane-access-control)-本節描述如何 toouse 金鑰保存庫的存取原則 toocontrol 資料平面存取。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-120">[Data plane access control](#data-plane-access-control) - This section describes how toouse key vault access policy toocontrol data plane access.</span></span>

<span data-ttu-id="e1d8a-121">[範例](#example)-這個範例說明如何 toosetup 存取控制對金鑰保存庫 tooallow 三個不同小組 （安全性小組、 開發人員/operators 和稽核員） tooperform 特定工作 toodevelop，管理和監視 Azure 中的應用程式.</span><span class="sxs-lookup"><span data-stu-id="e1d8a-121">[Example](#example) - This example describes how toosetup access control for your key vault tooallow three different teams (security team, developers/operators, and auditors) tooperform specific tasks toodevelop, manage and monitor an application in Azure.</span></span>

## <a name="authentication-using-azure-active-directory"></a><span data-ttu-id="e1d8a-122">使用 Azure Active Directory 進行驗證</span><span class="sxs-lookup"><span data-stu-id="e1d8a-122">Authentication using Azure Active Directory</span></span>
<span data-ttu-id="e1d8a-123">當您在 Azure 訂用帳戶中建立金鑰保存庫時，它會自動關聯於 hello 訂用帳戶的 Azure Active Directory 租用戶。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-123">When you create a key vault in an Azure subscription, it is automatically associated with hello subscription's Azure Active Directory tenant.</span></span> <span data-ttu-id="e1d8a-124">（使用者和應用程式） 的所有呼叫端必須是在此租用戶 tooaccess 註冊此金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-124">All callers (users and applications) must be registered in this tenant tooaccess this key vault.</span></span> <span data-ttu-id="e1d8a-125">應用程式或使用者必須向 Azure Active Directory tooaccess 金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-125">An application or a user must authenticate with Azure Active Directory tooaccess key vault.</span></span> <span data-ttu-id="e1d8a-126">這適用於 tooboth 管理平面和資料飛機存取。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-126">This applies tooboth management plane and data plane access.</span></span> <span data-ttu-id="e1d8a-127">在這兩種情況中，應用程式可透過兩種方式存取金鑰保存庫︰</span><span class="sxs-lookup"><span data-stu-id="e1d8a-127">In both cases, an application can access key vault in two ways:</span></span>

* <span data-ttu-id="e1d8a-128">**使用者 + 應用程式的存取** - 這通常適用於代表登入之使用者存取金鑰保存庫的應用程式。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-128">**user+app access** - usually this is for applications that access key vault on behalf of a signed-in user.</span></span> <span data-ttu-id="e1d8a-129">舉例來說，Azure PowerShell 和 Azure 入口網站便是這類存取。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-129">Azure PowerShell, Azure Portal are examples of this type of access.</span></span> <span data-ttu-id="e1d8a-130">有兩種方式 toogrant 存取 toousers： 其中一種方式 toogrant 存取 toousers 讓他們可以從任何應用程式存取金鑰保存庫，而 hello 另一種方式 toogrant 使用者存取 tookey 保存庫才會使用特定的應用程式 （參考的 tooas 複合身分識別）。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-130">There are two ways toogrant access toousers: one way is toogrant access toousers so they can access key vault from any application and hello other way is toogrant a user access tookey vault only when they use a specific application (referred tooas compound identity).</span></span> 
* <span data-ttu-id="e1d8a-131">**僅限應用程式存取**-應用程式，執行服務精靈服務時，背景工作等 hello 應用程式的身分識別會授與存取 toohello 金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-131">**app-only access** - for applications that run daemon services, background jobs etc. hello application's identity is granted access toohello key vault.</span></span>

<span data-ttu-id="e1d8a-132">在這兩種類型的應用程式中，hello 應用程式向 Azure Active Directory 使用任何 hello[支援的驗證方法](../active-directory/active-directory-authentication-scenarios.md)並取得語彙基元。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-132">In both types of applications, hello application authenticates with Azure Active Directory using any of hello [supported authentication methods](../active-directory/active-directory-authentication-scenarios.md) and acquires a token.</span></span> <span data-ttu-id="e1d8a-133">使用驗證方法，取決於 hello 應用程式類型。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-133">Authentication method used depends on hello application type.</span></span> <span data-ttu-id="e1d8a-134">然後 hello 應用程式會使用此 token，並將傳送 REST API 要求 tookey 保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-134">Then hello application uses this token and sends REST API request tookey vault.</span></span> <span data-ttu-id="e1d8a-135">如果管理平面存取 hello 要求會透過 Azure 資源管理員端點傳送。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-135">In case of management plane access hello requests are routed through Azure Resource Manager endpoint.</span></span> <span data-ttu-id="e1d8a-136">當存取資料平面，hello 應用程式直接交談 tooa 金鑰保存庫端點。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-136">When accessing data plane, hello applications talks directly tooa key vault endpoint.</span></span> <span data-ttu-id="e1d8a-137">查看詳細 hello[整個驗證流程](../active-directory/active-directory-protocols-oauth-code.md)。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-137">See more details on hello [whole authentication flow](../active-directory/active-directory-protocols-oauth-code.md).</span></span> 

<span data-ttu-id="e1d8a-138">hello hello 應用程式要求權杖的資源名稱會有所不同 hello 應用程式是否存取管理平面或資料平面。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-138">hello resource name for which hello application requests a token is different depending on whether hello application is accessing management plane or data plane.</span></span> <span data-ttu-id="e1d8a-139">因此 hello 資源名稱是管理平面或資料平面端點，就是在更新版本的區段中，根據 hello Azure 環境的 hello 表所述。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-139">Hence hello resource name is either management plane or data plane endpoint described in hello table in a later section, depending on hello Azure environment.</span></span>

<span data-ttu-id="e1d8a-140">一個單一的機制來驗證 tooboth 管理和資料飛機會有它自己的優點：</span><span class="sxs-lookup"><span data-stu-id="e1d8a-140">Having one single mechanism for authentication tooboth management and data plane has its own benefits:</span></span>

* <span data-ttu-id="e1d8a-141">組織可以集中控制存取 tooall 金鑰保存庫中組織</span><span class="sxs-lookup"><span data-stu-id="e1d8a-141">Organizations can centrally control access tooall key vaults in their organization</span></span>
* <span data-ttu-id="e1d8a-142">如果使用者離職後，就立即無法存取 tooall hello 組織中的金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="e1d8a-142">If a user leaves, they instantly lose access tooall key vaults in hello organization</span></span>
* <span data-ttu-id="e1d8a-143">組織可以自訂驗證，透過 Azure Active Directory (例如，啟用 multi-factor authentication 提高安全性) 中的 hello 選項</span><span class="sxs-lookup"><span data-stu-id="e1d8a-143">Organizations can customize authentication via hello options in Azure Active Directory (for example, enabling multi-factor authentication for added security)</span></span>

## <a name="management-plane-and-data-plane"></a><span data-ttu-id="e1d8a-144">管理平面和資料平面</span><span class="sxs-lookup"><span data-stu-id="e1d8a-144">Management plane and data plane</span></span>
<span data-ttu-id="e1d8a-145">Azure 金鑰保存庫是一項可透過 Azure Resource Manager 部署模型取得的 Azure 服務。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-145">Azure Key Vault is an Azure service available via Azure Resource Manager deployment model.</span></span> <span data-ttu-id="e1d8a-146">當您建立金鑰保存庫時，就會獲得虛擬容器以供您在其中建立其他物件，像是金鑰、密碼和憑證。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-146">When you create a key vault, you get a virtual container inside which you can create other objects like keys, secrets, and certificates.</span></span> <span data-ttu-id="e1d8a-147">然後您可以存取金鑰保存庫中，使用管理平面和資料飛機 tooperform 特定作業。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-147">Then you access your key vault using management plane and data plane tooperform specific operations.</span></span> <span data-ttu-id="e1d8a-148">管理平面介面是您的金鑰保存庫本身，例如建立、 刪除、 更新金鑰保存庫屬性以及設定資料平面的存取原則，使用的 toomanage。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-148">Management plane interface is used toomanage your key vault itself, such as creating, deleting, updating key vault attributes and setting access policies for data plane.</span></span> <span data-ttu-id="e1d8a-149">資料平面介面是使用的 tooadd、 刪除、 修改及使用 hello 金鑰、 密碼，以及儲存在金鑰保存庫中的憑證。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-149">Data plane interface is used tooadd, delete, modify, and use hello keys, secrets, and certificates stored in your key vault.</span></span>

<span data-ttu-id="e1d8a-150">hello 管理平面和資料飛機介面是透過不同的端點 （請參閱資料表） 存取。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-150">hello management plane and data plane interfaces are accessed through different endpoints (see table).</span></span> <span data-ttu-id="e1d8a-151">hello hello 資料表中的第二個資料行描述這些端點在不同的 Azure 環境的 hello DNS 名稱。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-151">hello second column in hello table describes hello DNS names for these endpoints in different Azure environments.</span></span> <span data-ttu-id="e1d8a-152">hello 第三個資料行描述您可以從每個存取平面執行 hello 作業。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-152">hello third column describes hello operations you can perform from each access plane.</span></span> <span data-ttu-id="e1d8a-153">每個存取平面也有自己的存取控制機制︰管理平面使用 Azure Resource Manager 角色型存取控制 (RBAC) 來設定存取控制，資料平面則使用金鑰保存庫存取原則來設定存取控制。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-153">Each access plane also has its own access control mechanism: for management plane access control is set using Azure Resource Manager Role-Based Access Control (RBAC), while for data plane access control is set using key vault access policy.</span></span>

| <span data-ttu-id="e1d8a-154">存取平面</span><span class="sxs-lookup"><span data-stu-id="e1d8a-154">Access plane</span></span> | <span data-ttu-id="e1d8a-155">存取端點</span><span class="sxs-lookup"><span data-stu-id="e1d8a-155">Access endpoints</span></span> | <span data-ttu-id="e1d8a-156">作業</span><span class="sxs-lookup"><span data-stu-id="e1d8a-156">Operations</span></span> | <span data-ttu-id="e1d8a-157">存取控制機制</span><span class="sxs-lookup"><span data-stu-id="e1d8a-157">Access control mechanism</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="e1d8a-158">管理平面</span><span class="sxs-lookup"><span data-stu-id="e1d8a-158">Management plane</span></span> |<span data-ttu-id="e1d8a-159">**全域：**</span><span class="sxs-lookup"><span data-stu-id="e1d8a-159">**Global:**</span></span><br> <span data-ttu-id="e1d8a-160">management.azure.com:443</span><span class="sxs-lookup"><span data-stu-id="e1d8a-160">management.azure.com:443</span></span><br><br> <span data-ttu-id="e1d8a-161">**Azure 中國︰**</span><span class="sxs-lookup"><span data-stu-id="e1d8a-161">**Azure China:**</span></span><br> <span data-ttu-id="e1d8a-162">management.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="e1d8a-162">management.chinacloudapi.cn:443</span></span><br><br> <span data-ttu-id="e1d8a-163">**Azure 美國政府︰**</span><span class="sxs-lookup"><span data-stu-id="e1d8a-163">**Azure US Government:**</span></span><br> <span data-ttu-id="e1d8a-164">management.usgovcloudapi.net:443</span><span class="sxs-lookup"><span data-stu-id="e1d8a-164">management.usgovcloudapi.net:443</span></span><br><br> <span data-ttu-id="e1d8a-165">**Azure 德國︰**</span><span class="sxs-lookup"><span data-stu-id="e1d8a-165">**Azure Germany:**</span></span><br> <span data-ttu-id="e1d8a-166">management.microsoftazure.de:443</span><span class="sxs-lookup"><span data-stu-id="e1d8a-166">management.microsoftazure.de:443</span></span> |<span data-ttu-id="e1d8a-167">建立/讀取/更新/刪除金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="e1d8a-167">Create/Read/Update/Delete key vault</span></span> <br> <span data-ttu-id="e1d8a-168">設定金鑰保存庫的存取原則</span><span class="sxs-lookup"><span data-stu-id="e1d8a-168">Set access policies for key vault</span></span><br><span data-ttu-id="e1d8a-169">設定金鑰保存庫的標籤</span><span class="sxs-lookup"><span data-stu-id="e1d8a-169">Set tags for key vault</span></span> |<span data-ttu-id="e1d8a-170">Azure Resource Manager 角色型存取控制 (RBAC)</span><span class="sxs-lookup"><span data-stu-id="e1d8a-170">Azure Resource Manager Role-Based Access Control (RBAC)</span></span> |
| <span data-ttu-id="e1d8a-171">資料平面</span><span class="sxs-lookup"><span data-stu-id="e1d8a-171">Data plane</span></span> |<span data-ttu-id="e1d8a-172">**全域：**</span><span class="sxs-lookup"><span data-stu-id="e1d8a-172">**Global:**</span></span><br> <span data-ttu-id="e1d8a-173">&lt;vault-name&gt;.vault.azure.net:443</span><span class="sxs-lookup"><span data-stu-id="e1d8a-173">&lt;vault-name&gt;.vault.azure.net:443</span></span><br><br> <span data-ttu-id="e1d8a-174">**Azure 中國︰**</span><span class="sxs-lookup"><span data-stu-id="e1d8a-174">**Azure China:**</span></span><br> <span data-ttu-id="e1d8a-175">&lt;vault-name&gt;.vault.azure.cn:443</span><span class="sxs-lookup"><span data-stu-id="e1d8a-175">&lt;vault-name&gt;.vault.azure.cn:443</span></span><br><br> <span data-ttu-id="e1d8a-176">**Azure 美國政府︰**</span><span class="sxs-lookup"><span data-stu-id="e1d8a-176">**Azure US Government:**</span></span><br> <span data-ttu-id="e1d8a-177">&lt;vault-name&gt;.vault.usgovcloudapi.net:443</span><span class="sxs-lookup"><span data-stu-id="e1d8a-177">&lt;vault-name&gt;.vault.usgovcloudapi.net:443</span></span><br><br> <span data-ttu-id="e1d8a-178">**Azure 德國︰**</span><span class="sxs-lookup"><span data-stu-id="e1d8a-178">**Azure Germany:**</span></span><br> <span data-ttu-id="e1d8a-179">&lt;vault-name&gt;.vault.microsoftazure.de:443</span><span class="sxs-lookup"><span data-stu-id="e1d8a-179">&lt;vault-name&gt;.vault.microsoftazure.de:443</span></span> |<span data-ttu-id="e1d8a-180">針對金鑰︰解密、加密、解除包裝金鑰、包裝金鑰、驗證、簽署、取得、列出、更新、建立、匯入、刪除、備份、還原</span><span class="sxs-lookup"><span data-stu-id="e1d8a-180">For Keys: Decrypt, Encrypt, UnwrapKey, WrapKey, Verify, Sign, Get, List, Update, Create, Import, Delete, Backup, Restore</span></span><br><br> <span data-ttu-id="e1d8a-181">針對密碼︰取得、列出、設定、刪除</span><span class="sxs-lookup"><span data-stu-id="e1d8a-181">For secrets: Get, List, Set, Delete</span></span> |<span data-ttu-id="e1d8a-182">金鑰保存庫存取原則</span><span class="sxs-lookup"><span data-stu-id="e1d8a-182">Key vault access policy</span></span> |

<span data-ttu-id="e1d8a-183">hello 管理平面和資料飛機存取控制獨立工作。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-183">hello management plane and data plane access controls work independently.</span></span> <span data-ttu-id="e1d8a-184">例如，如果您想 toogrant 應用程式存取 toouse 金鑰的金鑰保存庫中，您只需要 toogrant 資料平面存取權限使用金鑰保存庫的存取原則並沒有管理平面為需要存取此應用程式。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-184">For example, if you want toogrant an application access toouse keys in a key vault, you only need toogrant data plane access permissions using key vault access policies and no management plane access is needed for this application.</span></span> <span data-ttu-id="e1d8a-185">相反地，如果您想使用者 toobe 無法 tooread 保存庫屬性和標記，但是沒有任何存取 tookeys、 密碼或憑證，您可以授與這位使用者，並需要使用 RBAC 和沒有存取 toodata 平面 'read' 存取。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-185">And conversely, if you want a user toobe able tooread vault properties and tags, but not have any access tookeys, secrets, or certificates, you can grant this user, 'read' access using RBAC and no access toodata plane is required.</span></span>

## <a name="management-plane-access-control"></a><span data-ttu-id="e1d8a-186">管理平面存取控制</span><span class="sxs-lookup"><span data-stu-id="e1d8a-186">Management plane access control</span></span>
<span data-ttu-id="e1d8a-187">hello 管理平面包含會影響本身的 hello 金鑰保存庫的作業。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-187">hello management plane consists of operations that affect hello key vault itself.</span></span> <span data-ttu-id="e1d8a-188">例如，您可以建立或刪除金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-188">For example, you can create or delete a key vault.</span></span> <span data-ttu-id="e1d8a-189">您可以取得訂用帳戶中的保存庫清單。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-189">You can get a list of vaults in a subscription.</span></span> <span data-ttu-id="e1d8a-190">您可以擷取金鑰保存庫屬性 （例如 SKU 標記)，並設定金鑰保存庫的存取原則以控制 hello 使用者和應用程式可以存取金鑰和秘密 hello 金鑰保存庫中。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-190">You can retrieve key vault properties (such as SKU, tags) and set key vault access policies that control hello users and applications that can access keys and secrets in hello key vault.</span></span> <span data-ttu-id="e1d8a-191">管理平面存取控制會使用 RBAC。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-191">Management plane access control uses RBAC.</span></span> <span data-ttu-id="e1d8a-192">請參閱 hello 的金鑰保存庫執行的作業，可以透過管理平面在前面章節中的 hello 資料表中的完整清單。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-192">See hello complete list of key vault operations that can be performed via management plane in hello table in preceding section.</span></span> 

### <a name="role-based-access-control-rbac"></a><span data-ttu-id="e1d8a-193">角色型存取控制 (RBAC)</span><span class="sxs-lookup"><span data-stu-id="e1d8a-193">Role-based Access Control (RBAC)</span></span>
<span data-ttu-id="e1d8a-194">每一個 Azure 訂用帳戶都具有 Azure Active Directory。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-194">Each Azure subscription has an Azure Active Directory.</span></span> <span data-ttu-id="e1d8a-195">使用者、 群組和應用程式從這個目錄可以授與存取 toomanage hello Azure 訂用帳戶中的使用資源 hello Azure Resource Manager 部署模型。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-195">Users, groups, and applications from this directory can be granted access toomanage resources in hello Azure subscription that use hello Azure Resource Manager deployment model.</span></span> <span data-ttu-id="e1d8a-196">這種類型的存取控制是參照的 tooas 角色型存取控制 (RBAC)。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-196">This type of access control is referred tooas Role-Based Access Control (RBAC).</span></span> <span data-ttu-id="e1d8a-197">toomanage 這存取，您可以使用 hello [Azure 入口網站](https://portal.azure.com/)，hello [Azure CLI 工具](../cli-install-nodejs.md)， [PowerShell](/powershell/azureps-cmdlets-docs)，或使用 hello [Azure 資源管理員 REST Api](https://msdn.microsoft.com/library/azure/dn906885.aspx).</span><span class="sxs-lookup"><span data-stu-id="e1d8a-197">toomanage this access, you can use hello [Azure portal](https://portal.azure.com/), hello [Azure CLI tools](../cli-install-nodejs.md), [PowerShell](/powershell/azureps-cmdlets-docs), or hello [Azure Resource Manager REST APIs](https://msdn.microsoft.com/library/azure/dn906885.aspx).</span></span>

<span data-ttu-id="e1d8a-198">使用 hello Azure Resource Manager 模型時，您建立金鑰保存庫資源群組和控制存取 toohello 管理平面中的此金鑰保存庫使用 Azure Active Directory。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-198">With hello Azure Resource Manager model, you create your key vault in a resource group and control access toohello management plane of this key vault by using Azure Active Directory.</span></span> <span data-ttu-id="e1d8a-199">例如，您可以授與使用者或群組能夠 toomanage 金鑰保存庫中特定資源群組。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-199">For example, you can grant users or a group ability toomanage key vaults in a specific resource group.</span></span>

<span data-ttu-id="e1d8a-200">您可以將適當的 RBAC 角色指派，以授與存取 toousers、 群組和應用程式在特定範圍。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-200">You can grant access toousers, groups and applications at a specific scope by assigning appropriate RBAC roles.</span></span> <span data-ttu-id="e1d8a-201">例如，toogrant 存取 tooa 使用者 toomanage 金鑰保存庫就像是將預先定義的角色 '金鑰保存庫參與者' 指派 toothis 使用者在特定範圍。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-201">For example, toogrant access tooa user toomanage key vaults you would assign a predefined role 'key vault Contributor' toothis user at a specific scope.</span></span> <span data-ttu-id="e1d8a-202">hello 範圍在此情況下會是訂用帳戶、 資源群組或只特定的金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-202">hello scope in this case would be either a subscription, a resource group, or just a specific key vault.</span></span> <span data-ttu-id="e1d8a-203">在訂用帳戶層級指派角色適用於 tooall 資源群組與該訂用帳戶內的資源。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-203">A role assigned at subscription level applies tooall resource groups and resources within that subscription.</span></span> <span data-ttu-id="e1d8a-204">在資源群組層級指派角色適用於 tooall 該資源群組中的資源。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-204">A role assigned at resource group level applies tooall resources in that resource group.</span></span> <span data-ttu-id="e1d8a-205">指派特定資源的角色僅適用於 toothat 資源。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-205">A role assigned for a specific resource only applies toothat resource.</span></span> <span data-ttu-id="e1d8a-206">有數個預先定義的角色 (請參閱[RBAC： 內建角色](../active-directory/role-based-access-built-in-roles.md))，和 hello 如果預先定義的角色不符合您需求，您也可以定義您自己的角色。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-206">There are several predefined roles (see [RBAC: Built-in roles](../active-directory/role-based-access-built-in-roles.md)), and if hello predefined roles do not fit your needs you can also define your own roles.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e1d8a-207">請注意，是否使用者具有參與者權限 (RBAC) tooa 金鑰保存庫管理平面，她可以授與自己存取 toodata 平面，藉由設定金鑰保存庫的存取原則控制存取 toodata 平面。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-207">Note that if a user has Contributor permissions (RBAC) tooa key vault management plane, she can grant herself access toodata plane, by setting key vault access policy, which controls access toodata plane.</span></span> <span data-ttu-id="e1d8a-208">因此，建議您使用 tootightly 控制著具有 '參與者' 存取 tooyour 金鑰保存庫 tooensure 只有獲得授權的人員可以存取和管理您的金鑰保存庫、 金鑰、 密碼和憑證。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-208">Therefore, it is recommended tootightly control who has 'Contributor' access tooyour key vaults tooensure only authorized persons can access and manage your key vaults, keys, secrets, and certificates.</span></span>
> 
> 

## <a name="data-plane-access-control"></a><span data-ttu-id="e1d8a-209">資料平面存取控制</span><span class="sxs-lookup"><span data-stu-id="e1d8a-209">Data plane access control</span></span>
<span data-ttu-id="e1d8a-210">hello 金鑰保存庫資料平面包含會影響在金鑰保存庫，例如金鑰、 密碼，以及憑證的 hello 物件的作業。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-210">hello key vault data plane consists of operations that affect hello objects in a key vault, such as keys, secrets, and certificates.</span></span>  <span data-ttu-id="e1d8a-211">這包括金鑰作業 (例如建立、匯入、更新、列出、備份和還原金鑰)、密碼編譯作業 (例如簽署、驗證、加密、解密、包裝和解除包裝)，以及為金鑰設定標籤和其他屬性。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-211">This includes key operations such as create, import, update, list, backup, and restore keys, cryptographic operations such as sign, verify, encrypt, decrypt, wrap, and unwrap, and set tags and other attributes for keys.</span></span> <span data-ttu-id="e1d8a-212">同樣地，針對密碼所包含的是取得、設定、列出、刪除。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-212">Similarly, for secrets it includes, get, set, list, delete.</span></span>

<span data-ttu-id="e1d8a-213">資料平面的存取權是藉由設定金鑰保存庫的存取原則來授與。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-213">Data plane access is granted by setting access policies for a key vault.</span></span> <span data-ttu-id="e1d8a-214">使用者、 群組或應用程式必須具有該金鑰的保存庫金鑰保存庫 toobe 無法 tooset 存取原則的管理平面的參與者權限 (RBAC)。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-214">A user, group, or an application must have Contributor permissions (RBAC) for management plane for a key vault toobe able tooset access policies for that key vault.</span></span> <span data-ttu-id="e1d8a-215">使用者、 群組或應用程式可以授與存取金鑰或金鑰保存庫中的機密 tooperform 特定作業。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-215">A user, group, or application can be granted access tooperform specific operations for keys or secrets in a key vault.</span></span> <span data-ttu-id="e1d8a-216">金鑰保存庫的 too16 存取原則項目上的金鑰保存庫支援。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-216">Key vault support up too16 access policy entries for a key vault.</span></span> <span data-ttu-id="e1d8a-217">建立 Azure Active Directory 安全性群組，並加入使用者 toothat 群組 toogrant 資料平面存取 tooseveral 使用者 tooa 金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-217">Create an Azure Active Directory security group and add users toothat group toogrant data plane access tooseveral users tooa key vault.</span></span>

### <a name="key-vault-access-policies"></a><span data-ttu-id="e1d8a-218">金鑰保存庫存取原則</span><span class="sxs-lookup"><span data-stu-id="e1d8a-218">Key vault Access Policies</span></span>
<span data-ttu-id="e1d8a-219">個別金鑰保存庫的存取原則授與權限 tookeys、 密碼和憑證。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-219">Key vault access policies grant permissions tookeys, secrets and certificates separately.</span></span> <span data-ttu-id="e1d8a-220">例如，您可以提供使用者存取 tooonly 索引鍵中，但沒有機密資料的權限。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-220">For example, you can give a user access tooonly keys, but no permissions for secrets.</span></span> <span data-ttu-id="e1d8a-221">不過，權限 tooaccess 金鑰或密碼或憑證是在 hello 保存庫層級。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-221">However, permissions tooaccess keys or secrets or certificates are at hello vault level.</span></span> <span data-ttu-id="e1d8a-222">換句話說，金鑰保存庫存取原則不支援物件層級權限。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-222">In other words, key vault access policy does not support object level permissions.</span></span> <span data-ttu-id="e1d8a-223">您可以使用[Azure 入口網站](https://portal.azure.com/)，hello [Azure CLI 工具](../cli-install-nodejs.md)， [PowerShell](/powershell/azureps-cmdlets-docs)，或使用 hello[管理 REST Api 的金鑰保存庫](https://msdn.microsoft.com/library/azure/mt620024.aspx)tooset 存取原則用於金鑰的保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-223">You can use [Azure portal](https://portal.azure.com/), hello [Azure CLI tools](../cli-install-nodejs.md), [PowerShell](/powershell/azureps-cmdlets-docs), or hello [key vault Management REST APIs](https://msdn.microsoft.com/library/azure/mt620024.aspx) tooset access policies for a key vault.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e1d8a-224">請注意，金鑰保存庫的存取原則會套用在 hello 保存庫層級。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-224">Note that key vault access policies apply at hello vault level.</span></span> <span data-ttu-id="e1d8a-225">比方說，當使用者被授與權限 toocreate 及 delete 鍵，她可以執行這些作業在所有的索引鍵上該金鑰的保存庫中。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-225">For example, when a user is granted permission toocreate and delete keys, she can perform those operations on all keys in that key vault.</span></span>
> 
> 

## <a name="example"></a><span data-ttu-id="e1d8a-226">範例</span><span class="sxs-lookup"><span data-stu-id="e1d8a-226">Example</span></span>
<span data-ttu-id="e1d8a-227">假設您正在開發的應用程式使用 SSL 憑證、使用 Azure 儲存體來儲存資料，並使用 RSA 2048 位元金鑰來進行簽署作業。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-227">Let's say you are developing an application that uses a certificate for SSL, Azure storage for storing data, and uses an RSA 2048-bit key for sign operations.</span></span> <span data-ttu-id="e1d8a-228">假設此應用程式正在 VM (或 VM 擴展集) 中執行。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-228">Let's say this application is running in a VM (or a VM Scale Set).</span></span> <span data-ttu-id="e1d8a-229">您可以使用所有 hello 應用程式密碼，並使用金鑰保存庫 toostore hello 啟動程序使用的憑證是 hello 與 Azure Active Directory 的應用程式 tooauthenticate 金鑰保存庫 toostore。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-229">You can use a key vault toostore all hello application secrets, and use key vault toostore hello bootstrap certificate that is used by hello application tooauthenticate with Azure Active Directory.</span></span>

<span data-ttu-id="e1d8a-230">因此，以下是所有 hello 金鑰和秘密 toobe 儲存在金鑰保存庫中的摘要。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-230">So, here's a summary of all hello keys and secrets toobe stored in a key vault.</span></span>

* <span data-ttu-id="e1d8a-231">**SSL 憑證** - 用於 SSL</span><span class="sxs-lookup"><span data-stu-id="e1d8a-231">**SSL Cert** - used for SSL</span></span>
* <span data-ttu-id="e1d8a-232">**儲存體金鑰**-使用 tooget 存取 tooStorage 帳戶</span><span class="sxs-lookup"><span data-stu-id="e1d8a-232">**Storage Key** - used tooget access tooStorage account</span></span>
* <span data-ttu-id="e1d8a-233">**RSA 2048 位元金鑰** - 用於簽署作業</span><span class="sxs-lookup"><span data-stu-id="e1d8a-233">**RSA 2048-bit key** - used for sign operations</span></span>
* <span data-ttu-id="e1d8a-234">**啟動程序憑證**-用於 tooauthenticate tooAzure Active Directory、 tooget 存取 tookey 保存庫 toofetch hello 儲存體金鑰和使用 hello RSA 金鑰簽章。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-234">**Bootstrap certificate** - used tooauthenticate tooAzure Active Directory, tooget access tookey vault toofetch hello storage key and use hello RSA key for signing.</span></span>

<span data-ttu-id="e1d8a-235">現在讓我們來符合 hello 人管理、 部署和稽核此應用程式。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-235">Now let's meet hello people who are managing, deploying and auditing this application.</span></span> <span data-ttu-id="e1d8a-236">在此範例中，我們會使用三種角色。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-236">We'll use three roles in this example.</span></span>

* <span data-ttu-id="e1d8a-237">**安全性小組**-這些通常是從 hello '辦公室的 hello CSO （首席安全性主管）' 的 IT 人員，或對等，負責 hello 的機密資料的適當保管例如 SSL 憑證，用於簽章，連接字串的 RSA 金鑰資料庫儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-237">**Security team** - These are typically IT staff from hello 'office of hello CSO (Chief Security Officer)' or equivalent, responsible for hello proper safekeeping of secrets such as SSL certificates, RSA keys used for signing, connection strings for databases, storage account keys.</span></span>
* <span data-ttu-id="e1d8a-238">**開發人員/operators** -這些是 hello 同仁開發此應用程式，然後再將它部署在 Azure 中。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-238">**Developers/operators** - These are hello folks who develop this application and then deploy it in Azure.</span></span> <span data-ttu-id="e1d8a-239">一般而言，它們不屬於 hello 安全性小組，並因此它們不應該有存取 tooany 敏感性資料，例如 SSL 憑證的 RSA 金鑰，但在部署的 hello 應用程式應該有存取 toothose。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-239">Typically, they are not part of hello security team, and hence they should not have access tooany sensitive data, such as SSL certificates, RSA keys, but hello application they deploy should have access toothose.</span></span>
* <span data-ttu-id="e1d8a-240">**稽核員**-這通常是一組不同的人，與 hello 開發人員和一般的 IT 人員隔離。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-240">**Auditors** - This is usually a different set of people, isolated from hello developers and general IT staff.</span></span> <span data-ttu-id="e1d8a-241">他們的責任 tooreview 正確使用和維護的憑證、 金鑰等，並確認與資料安全性標準符合。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-241">Their responsibility is tooreview proper use and maintenance of certificates, keys, etc. and ensure compliance with data security standards.</span></span> 

<span data-ttu-id="e1d8a-242">一個多個角色的此應用程式，但所述，相關這裡 toobe hello 範圍外而且 hello 訂用帳戶 （或資源群組），也就是系統管理員。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-242">There is one more role that is outside hello scope of this application, but relevant here toobe mentioned, and that would be hello subscription (or resource group) administrator.</span></span> <span data-ttu-id="e1d8a-243">訂用帳戶管理員設定 hello 安全性小組的初始存取權限。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-243">Subscription administrator sets up initial access permissions for hello security team.</span></span> <span data-ttu-id="e1d8a-244">這裡我們假設該 hello 訂用帳戶系統管理員已授與存取 toohello 安全性小組 tooa 資源群組中所有 hello 這個應用程式 reside 所需的資源。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-244">Here we assume that hello subscription administrator has granted access toohello security team tooa resource group in which all hello resources needed for this application reside.</span></span>

<span data-ttu-id="e1d8a-245">現在我們來看看每個角色在此應用程式的 hello 內容中執行哪些動作。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-245">Now let's see what actions each role performs in hello context of this application.</span></span>

* <span data-ttu-id="e1d8a-246">**安全性小組**</span><span class="sxs-lookup"><span data-stu-id="e1d8a-246">**Security team**</span></span>
  * <span data-ttu-id="e1d8a-247">建立金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="e1d8a-247">Create key vaults</span></span>
  * <span data-ttu-id="e1d8a-248">開啟金鑰保存庫記錄</span><span class="sxs-lookup"><span data-stu-id="e1d8a-248">Turns on key vault logging</span></span>
  * <span data-ttu-id="e1d8a-249">新增金鑰/密碼</span><span class="sxs-lookup"><span data-stu-id="e1d8a-249">Add keys/secrets</span></span>
  * <span data-ttu-id="e1d8a-250">建立金鑰備份以用於災害復原</span><span class="sxs-lookup"><span data-stu-id="e1d8a-250">Create backup of keys for disaster recovery</span></span>
  * <span data-ttu-id="e1d8a-251">設定金鑰保存庫的存取原則 toogrant 權限 toousers 和應用程式 tooperform 特定作業</span><span class="sxs-lookup"><span data-stu-id="e1d8a-251">Set key vault access policy toogrant permissions toousers and applications tooperform specific operations</span></span>
  * <span data-ttu-id="e1d8a-252">定期輪替金鑰/密碼</span><span class="sxs-lookup"><span data-stu-id="e1d8a-252">Periodically roll keys/secrets</span></span>
* <span data-ttu-id="e1d8a-253">**開發人員/操作員**</span><span class="sxs-lookup"><span data-stu-id="e1d8a-253">**Developers/operators**</span></span>
  * <span data-ttu-id="e1d8a-254">取得參考 toobootstrap 和 SSL 憑證 （指紋），儲存體金鑰 （密碼 URI） 和簽署金鑰 (金鑰 URI) 從安全性小組</span><span class="sxs-lookup"><span data-stu-id="e1d8a-254">Get references toobootstrap and SSL certs (thumbprints), storage key (secret URI) and signing key (Key URI) from security team</span></span>
  * <span data-ttu-id="e1d8a-255">開發和部署以程式設計方式存取金鑰和密碼的應用程式</span><span class="sxs-lookup"><span data-stu-id="e1d8a-255">Develop and deploy application that accesses keys and secrets programmatically</span></span>
* <span data-ttu-id="e1d8a-256">**稽核員**</span><span class="sxs-lookup"><span data-stu-id="e1d8a-256">**Auditors**</span></span>
  * <span data-ttu-id="e1d8a-257">檢閱使用方式記錄 tooconfirm 正確的金鑰/秘密金鑰用法和與資料安全性標準符合</span><span class="sxs-lookup"><span data-stu-id="e1d8a-257">Review usage logs tooconfirm proper key/secret use and compliance with data security standards</span></span>

<span data-ttu-id="e1d8a-258">現在讓我們來看看何種存取權限 tookey 保存庫所需的每個角色 （和 hello 應用程式） tooperform 指派的工作。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-258">Now let's see what access permissions tookey vault are needed by each role (and hello application) tooperform their assigned tasks.</span></span> 

| <span data-ttu-id="e1d8a-259">使用者角色</span><span class="sxs-lookup"><span data-stu-id="e1d8a-259">User Role</span></span> | <span data-ttu-id="e1d8a-260">管理平面權限</span><span class="sxs-lookup"><span data-stu-id="e1d8a-260">Management plane permissions</span></span> | <span data-ttu-id="e1d8a-261">資料平面權限</span><span class="sxs-lookup"><span data-stu-id="e1d8a-261">Data plane permissions</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e1d8a-262">安全性小組</span><span class="sxs-lookup"><span data-stu-id="e1d8a-262">Security Team</span></span> |<span data-ttu-id="e1d8a-263">金鑰保存庫參與者</span><span class="sxs-lookup"><span data-stu-id="e1d8a-263">key vault Contributor</span></span> |<span data-ttu-id="e1d8a-264">金鑰︰備份、建立、刪除、取得、匯入、列出、還原</span><span class="sxs-lookup"><span data-stu-id="e1d8a-264">Keys: backup, create, delete, get, import, list, restore</span></span> <br> <span data-ttu-id="e1d8a-265">密碼︰全部</span><span class="sxs-lookup"><span data-stu-id="e1d8a-265">Secrets: all</span></span> |
| <span data-ttu-id="e1d8a-266">開發人員/操作員</span><span class="sxs-lookup"><span data-stu-id="e1d8a-266">Developers/Operator</span></span> |<span data-ttu-id="e1d8a-267">金鑰保存庫部署權限，以便在部署的 hello Vm 可以從 hello 金鑰保存庫擷取密碼</span><span class="sxs-lookup"><span data-stu-id="e1d8a-267">key vault deploy permission so that hello VMs they deploy can fetch secrets from hello key vault</span></span> |<span data-ttu-id="e1d8a-268">None</span><span class="sxs-lookup"><span data-stu-id="e1d8a-268">None</span></span> |
| <span data-ttu-id="e1d8a-269">稽核員</span><span class="sxs-lookup"><span data-stu-id="e1d8a-269">Auditors</span></span> |<span data-ttu-id="e1d8a-270">None</span><span class="sxs-lookup"><span data-stu-id="e1d8a-270">None</span></span> |<span data-ttu-id="e1d8a-271">金鑰︰列出</span><span class="sxs-lookup"><span data-stu-id="e1d8a-271">Keys: list</span></span><br><span data-ttu-id="e1d8a-272">密碼︰列出</span><span class="sxs-lookup"><span data-stu-id="e1d8a-272">Secrets: list</span></span> |
| <span data-ttu-id="e1d8a-273">應用程式</span><span class="sxs-lookup"><span data-stu-id="e1d8a-273">Application</span></span> |<span data-ttu-id="e1d8a-274">None</span><span class="sxs-lookup"><span data-stu-id="e1d8a-274">None</span></span> |<span data-ttu-id="e1d8a-275">金鑰︰簽署</span><span class="sxs-lookup"><span data-stu-id="e1d8a-275">Keys: sign</span></span><br><span data-ttu-id="e1d8a-276">密碼︰取得</span><span class="sxs-lookup"><span data-stu-id="e1d8a-276">Secrets: get</span></span> |

> [!NOTE]
> <span data-ttu-id="e1d8a-277">稽核員需要清單的金鑰和密碼的權限，讓它們可以檢查屬性金鑰和秘密，不會發出 hello 記錄檔、 標記，例如啟動和到期日。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-277">Auditors need list permission for keys and secrets so they can inspect attributes for keys and secrets that are not emitted in hello logs, such as tags, activation and expiration dates.</span></span>
> 
> 

<span data-ttu-id="e1d8a-278">權限 tookey 保存庫，除了這三個角色也需要存取 tooother 資源。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-278">Besides permission tookey vault, all three roles also need access tooother resources.</span></span> <span data-ttu-id="e1d8a-279">例如，toobe 無法 toodeploy Vm （或 Web 應用程式等）。開發人員/運算子也需要 '參與者' 存取 toothose 資源類型。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-279">For example, toobe able toodeploy VMs (or Web Apps etc.) Developers/Operators also need 'Contributor' access toothose resource types.</span></span> <span data-ttu-id="e1d8a-280">稽核員必須 hello 金鑰保存庫的記錄檔的儲存位置的讀取權限 toohello 儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-280">Auditors need read access toohello storage account where hello key vault logs are stored.</span></span>

<span data-ttu-id="e1d8a-281">Hello 這篇文章的焦點會保護存取 tooyour 金鑰保存庫，因為我們只說明 hello 相關 toothis 主題的相關部分，並略過部署憑證、 存取金鑰和密碼以程式設計方式等詳細資料。這些詳細資料已在其他地方做過說明。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-281">Since hello focus of this article is securing access tooyour key vault, we only illustrate hello relevant portions pertaining toothis topic and skip details regarding deploying certificates, accessing keys and secrets programmatically etc. Those details are already covered elsewhere.</span></span> <span data-ttu-id="e1d8a-282">部署憑證儲存在金鑰保存庫 tooVMs 涵蓋[部落格文章](https://blogs.technet.microsoft.com/kv/2016/09/14/updated-deploy-certificates-to-vms-from-customer-managed-key-vault/)，而且沒有[範例程式碼](https://www.microsoft.com/download/details.aspx?id=45343)可用，說明如何啟動程序 toouse 憑證 tooauthenticate tooAzure AD tooget存取 tookey 保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-282">Deploying certificates stored in key vault tooVMs is covered in a [blog post](https://blogs.technet.microsoft.com/kv/2016/09/14/updated-deploy-certificates-to-vms-from-customer-managed-key-vault/), and there is [sample code](https://www.microsoft.com/download/details.aspx?id=45343) available that illustrates how toouse bootstrap certificate tooauthenticate tooAzure AD tooget access tookey vault.</span></span>

<span data-ttu-id="e1d8a-283">大部分的 hello 存取權限可授與使用 Azure 入口網站，但 toogrant 細微權限，您可能需要 toouse Azure PowerShell （或 Azure CLI） tooachieve hello 期望的結果。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-283">Most of hello access permissions can be granted using Azure portal, but toogrant granular permissions you may need toouse Azure PowerShell (or Azure CLI) tooachieve hello desired result.</span></span> 

<span data-ttu-id="e1d8a-284">下列 PowerShell 程式碼片段的 hello 假設：</span><span class="sxs-lookup"><span data-stu-id="e1d8a-284">hello following PowerShell snippets assume:</span></span>

* <span data-ttu-id="e1d8a-285">hello Azure Active Directory 系統管理員建立安全性群組，代表 hello 三個角色，也就是 Contoso 安全性團隊，Contoso 應用程式 Devops，Contoso 應用程式的稽核。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-285">hello Azure Active Directory administrator has created security groups that represent hello three roles, namely Contoso Security Team, Contoso App Devops, Contoso App Auditors.</span></span> <span data-ttu-id="e1d8a-286">hello 管理員也已加入其所屬使用者 toohello 群組。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-286">hello administrator has also added users toohello groups they belong.</span></span>
* <span data-ttu-id="e1d8a-287">**ContosoAppRG**是 hello 資源群組所有 hello 資源都所在的位置。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-287">**ContosoAppRG** is hello resource group where all hello resources reside.</span></span> <span data-ttu-id="e1d8a-288">**contosologstorage** hello 記錄檔來儲存。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-288">**contosologstorage** is where hello logs are stored.</span></span> 
* <span data-ttu-id="e1d8a-289">金鑰保存庫**ContosoKeyVault**和用於金鑰保存庫的記錄檔的儲存體帳戶**contosologstorage** hello 必須位於相同的 Azure 位置</span><span class="sxs-lookup"><span data-stu-id="e1d8a-289">Key vault **ContosoKeyVault** and storage account used for key vault logs **contosologstorage** must be in hello same Azure location</span></span>

<span data-ttu-id="e1d8a-290">第一個 hello 訂用帳戶管理員指派 「 '金鑰保存庫參與者' 和 ' 使用者存取系統管理員 角色 toohello 安全性小組。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-290">First hello subscription administrator assigns 'key vault Contributor' and 'User Access Administrator' roles toohello security team.</span></span> <span data-ttu-id="e1d8a-291">這允許 hello 安全性小組 toomanage 存取 tooother 資源，並管理 hello ContosoAppRG 的資源群組中的金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-291">This allows hello security team toomanage access tooother resources and manage key vaults in hello resource group ContosoAppRG.</span></span>

```
New-AzureRmRoleAssignment -ObjectId (Get-AzureRmADGroup -SearchString 'Contoso Security Team')[0].Id -RoleDefinitionName "key vault Contributor" -ResourceGroupName ContosoAppRG
New-AzureRmRoleAssignment -ObjectId (Get-AzureRmADGroup -SearchString 'Contoso Security Team')[0].Id -RoleDefinitionName "User Access Administrator" -ResourceGroupName ContosoAppRG
```

<span data-ttu-id="e1d8a-292">hello 下列指令碼將說明如何 hello 安全性小組可以建立金鑰保存庫、 設定記錄，及設定其他的角色和 hello 應用程式的存取權限。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-292">hello following script illustrates how hello security team can create a key vault, setup logging, and set access permissions for other roles and hello application.</span></span> 

```
# Create key vault and enable logging
$sa = Get-AzureRmStorageAccount -ResourceGroup ContosoAppRG -Name contosologstorage
$kv = New-AzureRmKeyVault -VaultName ContosoKeyVault -ResourceGroup ContosoAppRG -SKU premium -Location 'westus' -EnabledForDeployment
Set-AzureRmDiagnosticSetting -ResourceId $kv.ResourceId -StorageAccountId $sa.Id -Enabled $true -Categories AuditEvent

# Data plane permissions for Security team
Set-AzureRmKeyVaultAccessPolicy -VaultName ContosoKeyVault -ObjectId (Get-AzureRmADGroup -SearchString 'Contoso Security Team')[0].Id -PermissionsToKeys backup,create,delete,get,import,list,restore -PermissionsToSecrets all

# Management plane permissions for Dev/ops
# Create a new role from an existing role
$devopsrole = Get-AzureRmRoleDefinition -Name "Virtual Machine Contributor"
$devopsrole.Id = $null
$devopsrole.Name = "Contoso App Devops"
$devopsrole.Description = "Can deploy VMs that need secrets from key vault"
$devopsrole.AssignableScopes = @("/subscriptions/<SUBSCRIPTION-GUID>")

# Add permission for dev/ops so they can deploy VMs that have secrets deployed from key vaults
$devopsrole.Actions.Add("Microsoft.KeyVault/vaults/deploy/action")
New-AzureRmRoleDefinition -Role $devopsrole

# Assign this newly defined role tooDev ops security group
New-AzureRmRoleAssignment -ObjectId (Get-AzureRmADGroup -SearchString 'Contoso App Devops')[0].Id -RoleDefinitionName "Contoso App Devops" -ResourceGroupName ContosoAppRG

# Data plane permissions for Auditors
Set-AzureRmKeyVaultAccessPolicy -VaultName ContosoKeyVault -ObjectId (Get-AzureRmADGroup -SearchString 'Contoso App Auditors')[0].Id -PermissionsToKeys list -PermissionsToSecrets list
```

<span data-ttu-id="e1d8a-293">hello 自訂角色定義，只可指派 toohello 訂用帳戶建立 hello ContosoAppRG 資源群組的位置。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-293">hello custom role defined, is only assignable toohello subscription where hello ContosoAppRG resource group is created.</span></span> <span data-ttu-id="e1d8a-294">如果 hello 相同的自訂角色會使用其他訂用帳戶中的其他專案，它的範圍可能會有多個加入的訂閱。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-294">If hello same custom roles will be used for other projects in other subscriptions, it's scope could have more subscriptions added.</span></span>

<span data-ttu-id="e1d8a-295">hello 「 部署/動作 」 權限的 hello 開發人員/運算子的 hello 自訂角色指派是已設定領域的 toohello 資源群組。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-295">hello custom role assignment for hello developers/operators for hello "deploy/action" permission is scoped toohello resource group.</span></span> <span data-ttu-id="e1d8a-296">如此一來，只有 hello Vm 會建立 hello 'ContosoAppRG' 會收到 hello 機密資料 （的 SSL 憑證和啟動程序的憑證） 的資源群組中。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-296">This way only hello VMs created in hello resource group 'ContosoAppRG' will get hello secrets (SSL cert and bootstrap cert).</span></span> <span data-ttu-id="e1d8a-297">開發人員/操作團隊成員會建立其他資源群組中的所有 Vm 不會無法 tooget 這些密碼即使他們知道 hello 密碼 Uri。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-297">Any VMs that a member of dev/ops team creates in other resource group will not be able tooget these secrets even if they knew hello secret URIs.</span></span>

<span data-ttu-id="e1d8a-298">此範例描述的是簡單案例。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-298">This example depicts a simple scenario.</span></span> <span data-ttu-id="e1d8a-299">真實生活案例可能更複雜，而且您可能需要 tooadjust 權限 tooyour 金鑰保存庫根據您的需求。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-299">Real life scenarios may be more complex and you may need tooadjust permissions tooyour key vault based on your needs.</span></span> <span data-ttu-id="e1d8a-300">例如，在本例中，我們假設該安全性小組將會提供 hello 金鑰和秘密參考 （Uri 和指紋） 在其應用程式的開發人員/運算子小組需要 tooreference。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-300">For example, in our example, we assume that security team will provide hello key and secret references (URIs and thumbprints) that developers/operators team need tooreference in their applications.</span></span> <span data-ttu-id="e1d8a-301">因此，它們不需要開發人員/operators toogrant 平面的任何資料存取。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-301">Hence, they don't need toogrant developers/operators any data plane access.</span></span> <span data-ttu-id="e1d8a-302">另請注意，此範例的內容著重在保護金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-302">Also, note that this example focuses on securing your key vault.</span></span> <span data-ttu-id="e1d8a-303">類似考量 toosecure [Vm](https://azure.microsoft.com/services/virtual-machines/security/)，[儲存體帳戶](../storage/common/storage-security-guide.md)和其他 Azure 資源太。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-303">Similar consideration should be given toosecure [your VMs](https://azure.microsoft.com/services/virtual-machines/security/), [storage accounts](../storage/common/storage-security-guide.md) and other Azure resources too.</span></span>

> [!NOTE]
> <span data-ttu-id="e1d8a-304">注意︰此範例示範生產環境中會如何鎖定金鑰保存庫的存取權。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-304">Note: This example shows how key vault access will be locked down in production.</span></span> <span data-ttu-id="e1d8a-305">hello 開發人員應該有自己的訂用帳戶或資源群組具有完整權限 toomanage 其保存庫、 Vm 與儲存體帳戶他們用來開發 hello 應用程式。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-305">hello developers should have their own subscription or resourcegroup where they have full permissions toomanage their vaults, VMs and storage account where they develop hello application.</span></span>
> 
> 

## <a name="resources"></a><span data-ttu-id="e1d8a-306">資源</span><span class="sxs-lookup"><span data-stu-id="e1d8a-306">Resources</span></span>
* [<span data-ttu-id="e1d8a-307">Azure Active Directory 角色型存取控制</span><span class="sxs-lookup"><span data-stu-id="e1d8a-307">Azure Active Directory Role-based Access Control</span></span>](../active-directory/role-based-access-control-configure.md)
  
  <span data-ttu-id="e1d8a-308">這篇文章說明 hello Azure Active Directory 角色型存取控制和其運作方式。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-308">This article explains hello Azure Active Directory Role-based Access Control and how it works.</span></span>
* [<span data-ttu-id="e1d8a-309">RBAC：內建角色</span><span class="sxs-lookup"><span data-stu-id="e1d8a-309">RBAC: Built in Roles</span></span>](../active-directory/role-based-access-built-in-roles.md)
  
  <span data-ttu-id="e1d8a-310">本文詳細說明所有 hello 中 RBAC 中可用的內建角色。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-310">This article details all hello built-in roles available in RBAC.</span></span>
* [<span data-ttu-id="e1d8a-311">了解資源管理員部署和傳統部署</span><span class="sxs-lookup"><span data-stu-id="e1d8a-311">Understanding Resource Manager deployment and classic deployment</span></span>](../azure-resource-manager/resource-manager-deployment-model.md)
  
  <span data-ttu-id="e1d8a-312">本文說明 hello 資源管理員部署和傳統部署模型，並說明 hello 優點 hello 資源管理員和資源群組</span><span class="sxs-lookup"><span data-stu-id="e1d8a-312">This article explains hello Resource Manager deployment and classic deployment models, and explains hello benefits of using hello Resource Manager and resource groups</span></span>
* [<span data-ttu-id="e1d8a-313">使用 Azure PowerShell 管理角色型存取控制</span><span class="sxs-lookup"><span data-stu-id="e1d8a-313">Manage Role-Based Access Control with Azure PowerShell</span></span>](../active-directory/role-based-access-control-manage-access-powershell.md)
  
  <span data-ttu-id="e1d8a-314">這篇文章說明如何 toomanage 角色型存取控制使用 Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="e1d8a-314">This article explains how toomanage role-based access control with Azure PowerShell</span></span>
* [<span data-ttu-id="e1d8a-315">管理角色型存取控制以 hello REST API</span><span class="sxs-lookup"><span data-stu-id="e1d8a-315">Managing Role-Based Access Control with hello REST API</span></span>](../active-directory/role-based-access-control-manage-access-rest.md)
  
  <span data-ttu-id="e1d8a-316">本文將說明如何 toouse hello REST API toomanage RBAC。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-316">This article shows how toouse hello REST API toomanage RBAC.</span></span>
* [<span data-ttu-id="e1d8a-317">來自Ignite 且適用於 Microsoft Azure 的角色型存取控制</span><span class="sxs-lookup"><span data-stu-id="e1d8a-317">Role-Based Access Control for Microsoft Azure from Ignite</span></span>](https://channel9.msdn.com/events/Ignite/2015/BRK2707)
  
  <span data-ttu-id="e1d8a-318">這是連結 tooa 大會 hello 2015 MS Ignite 影片在 Channel 9 上。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-318">This is a link tooa video on Channel 9 from hello 2015 MS Ignite conference.</span></span> <span data-ttu-id="e1d8a-319">在此工作階段，它們討論存取管理和報告功能，在 Azure 中，並瀏覽保護存取 tooAzure 訂用帳戶使用 Azure Active Directory 的最佳作法。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-319">In this session, they talk about access management and reporting capabilities in Azure, and explore best practices around securing access tooAzure subscriptions using Azure Active Directory.</span></span>
* [<span data-ttu-id="e1d8a-320">授權存取 tooweb 應用程式使用 OAuth 2.0 和 Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="e1d8a-320">Authorize access tooweb applications using OAuth 2.0 and Azure Active Directory</span></span>](../active-directory/active-directory-protocols-oauth-code.md)
  
  <span data-ttu-id="e1d8a-321">本文說明向 Azure Active Directory 進行驗證的完整 OAuth 2.0 流程。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-321">This article describes complete OAuth 2.0 flow for authenticating with Azure Active Directory.</span></span>
* [<span data-ttu-id="e1d8a-322">金鑰保存庫管理 REST API</span><span class="sxs-lookup"><span data-stu-id="e1d8a-322">key vault Management REST APIs</span></span>](https://msdn.microsoft.com/library/azure/mt620024.aspx)
  
  <span data-ttu-id="e1d8a-323">這份文件是 hello hello REST Api toomanage 您金鑰保存庫以程式設計的方式，包括設定金鑰保存庫的存取原則。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-323">This document is hello reference for hello REST APIs toomanage your key vault programmatically, including setting key vault access policy.</span></span>
* [<span data-ttu-id="e1d8a-324">金鑰保存庫 REST API</span><span class="sxs-lookup"><span data-stu-id="e1d8a-324">key vault REST APIs</span></span>](https://msdn.microsoft.com/library/azure/dn903609.aspx)
  
  <span data-ttu-id="e1d8a-325">連結 tookey 保存庫 REST API 參考文件。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-325">Link tookey vault REST API reference documentation.</span></span>
* [<span data-ttu-id="e1d8a-326">金鑰存取控制</span><span class="sxs-lookup"><span data-stu-id="e1d8a-326">Key access control</span></span>](https://msdn.microsoft.com/library/azure/dn903623.aspx#BKMK_KeyAccessControl)
  
  <span data-ttu-id="e1d8a-327">連結 tooSecret 存取控制項的參考文件。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-327">Link tooSecret access control reference documentation.</span></span>
* [<span data-ttu-id="e1d8a-328">密碼存取控制</span><span class="sxs-lookup"><span data-stu-id="e1d8a-328">Secret access control</span></span>](https://msdn.microsoft.com/library/azure/dn903623.aspx#BKMK_SecretAccessControl)
  
  <span data-ttu-id="e1d8a-329">連結 tooKey 存取控制項的參考文件。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-329">Link tooKey access control reference documentation.</span></span>
* <span data-ttu-id="e1d8a-330">使用 PowerShell [設定](https://msdn.microsoft.com/library/mt603625.aspx)和[移除](https://msdn.microsoft.com/library/mt619427.aspx)金鑰保存庫存取原則</span><span class="sxs-lookup"><span data-stu-id="e1d8a-330">[Set](https://msdn.microsoft.com/library/mt603625.aspx) and [Remove](https://msdn.microsoft.com/library/mt619427.aspx) key vault access policy using PowerShell</span></span>
  
  <span data-ttu-id="e1d8a-331">連結的 PowerShell cmdlet toomanage 金鑰保存庫的存取原則的 tooreference 說明文件。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-331">Links tooreference documentation for PowerShell cmdlets toomanage key vault access policy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e1d8a-332">後續步驟</span><span class="sxs-lookup"><span data-stu-id="e1d8a-332">Next Steps</span></span>
<span data-ttu-id="e1d8a-333">如需適用於系統管理員的開始使用教學課程，請參閱[開始使用 Azure 金鑰保存庫](key-vault-get-started.md)。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-333">For a getting started tutorial for an administrator, see [Get Started with Azure key vault](key-vault-get-started.md).</span></span>

<span data-ttu-id="e1d8a-334">如需金鑰保存庫使用方法記錄的詳細資訊，請參閱 [Azure 金鑰保存庫記錄](key-vault-logging.md)。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-334">For more information about usage logging for key vault, see [Azure key vault Logging](key-vault-logging.md).</span></span>

<span data-ttu-id="e1d8a-335">如需搭配 Azure 金鑰保存庫使用金鑰和密碼的詳細資訊，請參閱[關於金鑰和密碼](https://msdn.microsoft.com/library/azure/dn903623.aspx)。</span><span class="sxs-lookup"><span data-stu-id="e1d8a-335">For more information about using keys and secrets with Azure key vault, see [About Keys and Secrets](https://msdn.microsoft.com/library/azure/dn903623.aspx).</span></span>

<span data-ttu-id="e1d8a-336">如果您有金鑰保存庫相關的問題，請瀏覽 hello [Azure 金鑰保存庫論壇](https://social.msdn.microsoft.com/forums/azure/home?forum=AzureKeyVault)</span><span class="sxs-lookup"><span data-stu-id="e1d8a-336">If you have questions about key vault, visit hello [Azure key vault Forums](https://social.msdn.microsoft.com/forums/azure/home?forum=AzureKeyVault)</span></span>

