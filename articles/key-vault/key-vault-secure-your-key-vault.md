---
title: "保護您的金鑰保存庫 | Microsoft Docs"
description: "管理金鑰保存庫的存取權限，來管理保存庫以及金鑰和密碼。 金鑰保存庫的驗證和授權模型以及如何保護金鑰保存庫"
services: key-vault
documentationcenter: 
author: amitbapat
manager: mbaldwin
tags: azure-resource-manager
ms.assetid: e5b4e083-4a39-4410-8e3a-2832ad6db405
ms.service: key-vault
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 01/07/2017
ms.author: ambapat
ms.openlocfilehash: b81791f0bce7e6f57782dfe7bc5fb5fc21369e7d
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="secure-your-key-vault"></a><span data-ttu-id="8bb70-104">保護您的金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="8bb70-104">Secure your key vault</span></span>
<span data-ttu-id="8bb70-105">Azure 金鑰保存庫是用來保護雲端應用程式加密金鑰和密碼 (例如憑證、連接字串、密碼) 的雲端服務。</span><span class="sxs-lookup"><span data-stu-id="8bb70-105">Azure Key Vault is a cloud service that safeguards encryption keys and secrets (such as certificates, connection strings, passwords) for your cloud applications.</span></span> <span data-ttu-id="8bb70-106">由於這項資料相當敏感且攸關業務，您會想要保護金鑰保存庫的存取權，讓只有獲得授權的應用程式和使用者可以存取金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="8bb70-106">Since this data is sensitive and business critical, you want to secure access to your key vaults so that only authorized applications and users can access key vault.</span></span> <span data-ttu-id="8bb70-107">本文提供金鑰保存庫存取模型概觀、說明驗證和授權，並透過範例描述如何保護雲端應用程式金鑰保存庫的存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-107">This article provides an overview of key vault access model, explains authentication and authorization, and describes how to secure access to key vault for your cloud applications with an example.</span></span>

## <a name="overview"></a><span data-ttu-id="8bb70-108">概觀</span><span class="sxs-lookup"><span data-stu-id="8bb70-108">Overview</span></span>
<span data-ttu-id="8bb70-109">金鑰保存庫的存取權可透過兩個不同介面來控制︰管理平面和資料平面。</span><span class="sxs-lookup"><span data-stu-id="8bb70-109">Access to a key vault is controlled through two separate interfaces: management plane and data plane.</span></span> <span data-ttu-id="8bb70-110">這兩個平面都需要先經過適當的驗證和授權，呼叫者 (使用者或應用程式) 才能取得金鑰保存庫的存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-110">For both planes proper authentication and authorization is required before a caller (a user or an application) can get access to key vault.</span></span> <span data-ttu-id="8bb70-111">驗證會建立呼叫者的身分識別，授權則會判斷呼叫者可以執行的作業。</span><span class="sxs-lookup"><span data-stu-id="8bb70-111">Authentication establishes the identity of the caller, while authorization determines what operations the caller is allowed to perform.</span></span>

<span data-ttu-id="8bb70-112">管理平面和資料平面都會使用 Azure Active Directory 來進行驗證。</span><span class="sxs-lookup"><span data-stu-id="8bb70-112">For authentication both management plane and data plane use Azure Active Directory.</span></span> <span data-ttu-id="8bb70-113">至於授權，管理平面使用角色型存取控制 (RBAC)，資料平面則使用金鑰保存庫存取原則。</span><span class="sxs-lookup"><span data-stu-id="8bb70-113">For authorization, management plane uses role-based access control (RBAC) while data plane uses key vault access policy.</span></span>

<span data-ttu-id="8bb70-114">以下是所涵蓋主題的簡短概觀︰</span><span class="sxs-lookup"><span data-stu-id="8bb70-114">Here is a brief overview of the topics covered:</span></span>

<span data-ttu-id="8bb70-115">[使用 Azure Active Directory 進行驗證](#authentication-using-azure-active-directory) - 本節說明呼叫者如何使用 Azure Active Directory 進行驗證，以透過管理平面和資料平面存取金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="8bb70-115">[Authentication using Azure Active Directory](#authentication-using-azure-active-directory) - This section explains how a caller authenticates with Azure Active Directory to access a key vault via management plane and data plane.</span></span> 

<span data-ttu-id="8bb70-116">[管理平面和資料平面](#management-plane-and-data-plane) - 管理平面和資料平面是用來存取金鑰保存庫的兩個存取平面。</span><span class="sxs-lookup"><span data-stu-id="8bb70-116">[Management plane and data plane](#management-plane-and-data-plane) - Management plane and data plane are two access planes used for accessing your key vault.</span></span> <span data-ttu-id="8bb70-117">這兩個存取平面各支援特定作業。</span><span class="sxs-lookup"><span data-stu-id="8bb70-117">Each access plane supports specific operations.</span></span> <span data-ttu-id="8bb70-118">本節描述各個平面所使用的存取端點、所支援作業和存取控制方法。</span><span class="sxs-lookup"><span data-stu-id="8bb70-118">This section describes the access endpoints, operations supported, and access control method used by each plane.</span></span> 

<span data-ttu-id="8bb70-119">[管理平面存取控制](#management-plane-access-control) - 在這一節，我們將探討如何使用角色型存取控制來允許管理平面作業的存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-119">[Management plane access control](#management-plane-access-control) - In this section we'll look at allowing access to management plane operations using role-based access control.</span></span>

<span data-ttu-id="8bb70-120">[資料平面存取控制](#data-plane-access-control) - 本節描述如何使用金鑰保存庫存取原則來控制資料平面存取。</span><span class="sxs-lookup"><span data-stu-id="8bb70-120">[Data plane access control](#data-plane-access-control) - This section describes how to use key vault access policy to control data plane access.</span></span>

<span data-ttu-id="8bb70-121">[範例](#example) - 此範例描述如何設定金鑰保存庫的存取控制，允許三個不同小組 (安全性小組、開發人員/操作員和稽核員) 執行特定工作，以在 Azure 中開發、管理和監視應用程式。</span><span class="sxs-lookup"><span data-stu-id="8bb70-121">[Example](#example) - This example describes how to setup access control for your key vault to allow three different teams (security team, developers/operators, and auditors) to perform specific tasks to develop, manage and monitor an application in Azure.</span></span>

## <a name="authentication-using-azure-active-directory"></a><span data-ttu-id="8bb70-122">使用 Azure Active Directory 進行驗證</span><span class="sxs-lookup"><span data-stu-id="8bb70-122">Authentication using Azure Active Directory</span></span>
<span data-ttu-id="8bb70-123">當您在 Azure 訂用帳戶中建立金鑰保存庫時，它會自動與該訂用帳戶的 Azure Active Directory 租用戶建立關聯。</span><span class="sxs-lookup"><span data-stu-id="8bb70-123">When you create a key vault in an Azure subscription, it is automatically associated with the subscription's Azure Active Directory tenant.</span></span> <span data-ttu-id="8bb70-124">所有呼叫者 (使用者和應用程式) 都必須在此租用戶中註冊，才能存取此金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="8bb70-124">All callers (users and applications) must be registered in this tenant to access this key vault.</span></span> <span data-ttu-id="8bb70-125">應用程式或使用者必須使用 Azure Active Directory 進行驗證，才能存取金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="8bb70-125">An application or a user must authenticate with Azure Active Directory to access key vault.</span></span> <span data-ttu-id="8bb70-126">管理平面和資料平面的存取皆適用此原則。</span><span class="sxs-lookup"><span data-stu-id="8bb70-126">This applies to both management plane and data plane access.</span></span> <span data-ttu-id="8bb70-127">在這兩種情況中，應用程式可透過兩種方式存取金鑰保存庫︰</span><span class="sxs-lookup"><span data-stu-id="8bb70-127">In both cases, an application can access key vault in two ways:</span></span>

* <span data-ttu-id="8bb70-128">**使用者 + 應用程式的存取** - 這通常適用於代表登入之使用者存取金鑰保存庫的應用程式。</span><span class="sxs-lookup"><span data-stu-id="8bb70-128">**user+app access** - usually this is for applications that access key vault on behalf of a signed-in user.</span></span> <span data-ttu-id="8bb70-129">舉例來說，Azure PowerShell 和 Azure 入口網站便是這類存取。</span><span class="sxs-lookup"><span data-stu-id="8bb70-129">Azure PowerShell, Azure Portal are examples of this type of access.</span></span> <span data-ttu-id="8bb70-130">有兩種方式可對使用者授與存取權︰一種方式是對使用者授與存取權，讓他們可以從任何應用程式存取金鑰保存庫，另一種方式則是，只在使用者使用特定應用程式 (稱為複合身分識別) 時，才對其授與金鑰保存庫的存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-130">There are two ways to grant access to users: one way is to grant access to users so they can access key vault from any application and the other way is to grant a user access to key vault only when they use a specific application (referred to as compound identity).</span></span> 
* <span data-ttu-id="8bb70-131">**僅應用程式的存取** - 適用於執行精靈服務、背景作業等項目的應用程式。該應用程式的身分識別會被授與金鑰保存庫的存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-131">**app-only access** - for applications that run daemon services, background jobs etc. The application's identity is granted access to the key vault.</span></span>

<span data-ttu-id="8bb70-132">在這兩種應用程式中，應用程式會使用任何[支援的驗證方法](../active-directory/active-directory-authentication-scenarios.md)向 Azure Active Directory 進行驗證，並取得權杖。</span><span class="sxs-lookup"><span data-stu-id="8bb70-132">In both types of applications, the application authenticates with Azure Active Directory using any of the [supported authentication methods](../active-directory/active-directory-authentication-scenarios.md) and acquires a token.</span></span> <span data-ttu-id="8bb70-133">使用何種驗證方法取決於應用程式類型。</span><span class="sxs-lookup"><span data-stu-id="8bb70-133">Authentication method used depends on the application type.</span></span> <span data-ttu-id="8bb70-134">然後，應用程式會使用此權杖，對金鑰保存庫傳送 REST API 要求。</span><span class="sxs-lookup"><span data-stu-id="8bb70-134">Then the application uses this token and sends REST API request to key vault.</span></span> <span data-ttu-id="8bb70-135">如果是管理平面存取，要求會透過 Azure Resource Manager 端點路由傳送。</span><span class="sxs-lookup"><span data-stu-id="8bb70-135">In case of management plane access the requests are routed through Azure Resource Manager endpoint.</span></span> <span data-ttu-id="8bb70-136">在存取資料平面時，應用程式則會直接與金鑰保存庫端點通訊。</span><span class="sxs-lookup"><span data-stu-id="8bb70-136">When accessing data plane, the applications talks directly to a key vault endpoint.</span></span> <span data-ttu-id="8bb70-137">如需詳細資訊，請參閱[整個驗證流程](../active-directory/active-directory-protocols-oauth-code.md)。</span><span class="sxs-lookup"><span data-stu-id="8bb70-137">See more details on the [whole authentication flow](../active-directory/active-directory-protocols-oauth-code.md).</span></span> 

<span data-ttu-id="8bb70-138">根據應用程式是存取管理平面還是資料平面，受到應用程式要求權杖的資源名稱會有所不同。</span><span class="sxs-lookup"><span data-stu-id="8bb70-138">The resource name for which the application requests a token is different depending on whether the application is accessing management plane or data plane.</span></span> <span data-ttu-id="8bb70-139">因此，視 Azure 環境而定，資源名稱將是稍後章節所含資料表中所述的管理平面或資料平面端點。</span><span class="sxs-lookup"><span data-stu-id="8bb70-139">Hence the resource name is either management plane or data plane endpoint described in the table in a later section, depending on the Azure environment.</span></span>

<span data-ttu-id="8bb70-140">管理平面和資料平面各有一個驗證機制會有它自己的優點︰</span><span class="sxs-lookup"><span data-stu-id="8bb70-140">Having one single mechanism for authentication to both management and data plane has its own benefits:</span></span>

* <span data-ttu-id="8bb70-141">組織可以集中控制其組織內所有金鑰保存庫的存取權</span><span class="sxs-lookup"><span data-stu-id="8bb70-141">Organizations can centrally control access to all key vaults in their organization</span></span>
* <span data-ttu-id="8bb70-142">使用者如果離職，就會立即失去組織中所有金鑰保存庫的存取權</span><span class="sxs-lookup"><span data-stu-id="8bb70-142">If a user leaves, they instantly lose access to all key vaults in the organization</span></span>
* <span data-ttu-id="8bb70-143">組織可以透過 Azure Active Directory 中的選項 (例如，啟用 Multi-Factor Authentication 以提升安全性) 自訂驗證</span><span class="sxs-lookup"><span data-stu-id="8bb70-143">Organizations can customize authentication via the options in Azure Active Directory (for example, enabling multi-factor authentication for added security)</span></span>

## <a name="management-plane-and-data-plane"></a><span data-ttu-id="8bb70-144">管理平面和資料平面</span><span class="sxs-lookup"><span data-stu-id="8bb70-144">Management plane and data plane</span></span>
<span data-ttu-id="8bb70-145">Azure 金鑰保存庫是一項可透過 Azure Resource Manager 部署模型取得的 Azure 服務。</span><span class="sxs-lookup"><span data-stu-id="8bb70-145">Azure Key Vault is an Azure service available via Azure Resource Manager deployment model.</span></span> <span data-ttu-id="8bb70-146">當您建立金鑰保存庫時，就會獲得虛擬容器以供您在其中建立其他物件，像是金鑰、密碼和憑證。</span><span class="sxs-lookup"><span data-stu-id="8bb70-146">When you create a key vault, you get a virtual container inside which you can create other objects like keys, secrets, and certificates.</span></span> <span data-ttu-id="8bb70-147">然後，您可以使用管理平面和資料平面存取金鑰保存庫，以執行特定作業。</span><span class="sxs-lookup"><span data-stu-id="8bb70-147">Then you access your key vault using management plane and data plane to perform specific operations.</span></span> <span data-ttu-id="8bb70-148">管理平面介面可用來管理金鑰保存庫本身，例如建立、刪除、更新金鑰保存庫屬性和設定資料平面的存取原則。</span><span class="sxs-lookup"><span data-stu-id="8bb70-148">Management plane interface is used to manage your key vault itself, such as creating, deleting, updating key vault attributes and setting access policies for data plane.</span></span> <span data-ttu-id="8bb70-149">資料平面介面可用來新增、刪除、修改和使用金鑰保存庫中儲存的金鑰、密碼和憑證。</span><span class="sxs-lookup"><span data-stu-id="8bb70-149">Data plane interface is used to add, delete, modify, and use the keys, secrets, and certificates stored in your key vault.</span></span>

<span data-ttu-id="8bb70-150">管理平面和資料平面介面需透過不同端點存取 (請參閱資料表)。</span><span class="sxs-lookup"><span data-stu-id="8bb70-150">The management plane and data plane interfaces are accessed through different endpoints (see table).</span></span> <span data-ttu-id="8bb70-151">資料表中的第二個資料行描述不同 Azure 環境中這些端點的 DNS 名稱。</span><span class="sxs-lookup"><span data-stu-id="8bb70-151">The second column in the table describes the DNS names for these endpoints in different Azure environments.</span></span> <span data-ttu-id="8bb70-152">第三個資料行描述可從每個存取平面執行的作業。</span><span class="sxs-lookup"><span data-stu-id="8bb70-152">The third column describes the operations you can perform from each access plane.</span></span> <span data-ttu-id="8bb70-153">每個存取平面也有自己的存取控制機制︰管理平面使用 Azure Resource Manager 角色型存取控制 (RBAC) 來設定存取控制，資料平面則使用金鑰保存庫存取原則來設定存取控制。</span><span class="sxs-lookup"><span data-stu-id="8bb70-153">Each access plane also has its own access control mechanism: for management plane access control is set using Azure Resource Manager Role-Based Access Control (RBAC), while for data plane access control is set using key vault access policy.</span></span>

| <span data-ttu-id="8bb70-154">存取平面</span><span class="sxs-lookup"><span data-stu-id="8bb70-154">Access plane</span></span> | <span data-ttu-id="8bb70-155">存取端點</span><span class="sxs-lookup"><span data-stu-id="8bb70-155">Access endpoints</span></span> | <span data-ttu-id="8bb70-156">作業</span><span class="sxs-lookup"><span data-stu-id="8bb70-156">Operations</span></span> | <span data-ttu-id="8bb70-157">存取控制機制</span><span class="sxs-lookup"><span data-stu-id="8bb70-157">Access control mechanism</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="8bb70-158">管理平面</span><span class="sxs-lookup"><span data-stu-id="8bb70-158">Management plane</span></span> |<span data-ttu-id="8bb70-159">**全域：**</span><span class="sxs-lookup"><span data-stu-id="8bb70-159">**Global:**</span></span><br> <span data-ttu-id="8bb70-160">management.azure.com:443</span><span class="sxs-lookup"><span data-stu-id="8bb70-160">management.azure.com:443</span></span><br><br> <span data-ttu-id="8bb70-161">**Azure 中國︰**</span><span class="sxs-lookup"><span data-stu-id="8bb70-161">**Azure China:**</span></span><br> <span data-ttu-id="8bb70-162">management.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="8bb70-162">management.chinacloudapi.cn:443</span></span><br><br> <span data-ttu-id="8bb70-163">**Azure 美國政府︰**</span><span class="sxs-lookup"><span data-stu-id="8bb70-163">**Azure US Government:**</span></span><br> <span data-ttu-id="8bb70-164">management.usgovcloudapi.net:443</span><span class="sxs-lookup"><span data-stu-id="8bb70-164">management.usgovcloudapi.net:443</span></span><br><br> <span data-ttu-id="8bb70-165">**Azure 德國︰**</span><span class="sxs-lookup"><span data-stu-id="8bb70-165">**Azure Germany:**</span></span><br> <span data-ttu-id="8bb70-166">management.microsoftazure.de:443</span><span class="sxs-lookup"><span data-stu-id="8bb70-166">management.microsoftazure.de:443</span></span> |<span data-ttu-id="8bb70-167">建立/讀取/更新/刪除金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="8bb70-167">Create/Read/Update/Delete key vault</span></span> <br> <span data-ttu-id="8bb70-168">設定金鑰保存庫的存取原則</span><span class="sxs-lookup"><span data-stu-id="8bb70-168">Set access policies for key vault</span></span><br><span data-ttu-id="8bb70-169">設定金鑰保存庫的標籤</span><span class="sxs-lookup"><span data-stu-id="8bb70-169">Set tags for key vault</span></span> |<span data-ttu-id="8bb70-170">Azure Resource Manager 角色型存取控制 (RBAC)</span><span class="sxs-lookup"><span data-stu-id="8bb70-170">Azure Resource Manager Role-Based Access Control (RBAC)</span></span> |
| <span data-ttu-id="8bb70-171">資料平面</span><span class="sxs-lookup"><span data-stu-id="8bb70-171">Data plane</span></span> |<span data-ttu-id="8bb70-172">**全域：**</span><span class="sxs-lookup"><span data-stu-id="8bb70-172">**Global:**</span></span><br> <span data-ttu-id="8bb70-173">&lt;vault-name&gt;.vault.azure.net:443</span><span class="sxs-lookup"><span data-stu-id="8bb70-173">&lt;vault-name&gt;.vault.azure.net:443</span></span><br><br> <span data-ttu-id="8bb70-174">**Azure 中國︰**</span><span class="sxs-lookup"><span data-stu-id="8bb70-174">**Azure China:**</span></span><br> <span data-ttu-id="8bb70-175">&lt;vault-name&gt;.vault.azure.cn:443</span><span class="sxs-lookup"><span data-stu-id="8bb70-175">&lt;vault-name&gt;.vault.azure.cn:443</span></span><br><br> <span data-ttu-id="8bb70-176">**Azure 美國政府︰**</span><span class="sxs-lookup"><span data-stu-id="8bb70-176">**Azure US Government:**</span></span><br> <span data-ttu-id="8bb70-177">&lt;vault-name&gt;.vault.usgovcloudapi.net:443</span><span class="sxs-lookup"><span data-stu-id="8bb70-177">&lt;vault-name&gt;.vault.usgovcloudapi.net:443</span></span><br><br> <span data-ttu-id="8bb70-178">**Azure 德國︰**</span><span class="sxs-lookup"><span data-stu-id="8bb70-178">**Azure Germany:**</span></span><br> <span data-ttu-id="8bb70-179">&lt;vault-name&gt;.vault.microsoftazure.de:443</span><span class="sxs-lookup"><span data-stu-id="8bb70-179">&lt;vault-name&gt;.vault.microsoftazure.de:443</span></span> |<span data-ttu-id="8bb70-180">針對金鑰︰解密、加密、解除包裝金鑰、包裝金鑰、驗證、簽署、取得、列出、更新、建立、匯入、刪除、備份、還原</span><span class="sxs-lookup"><span data-stu-id="8bb70-180">For Keys: Decrypt, Encrypt, UnwrapKey, WrapKey, Verify, Sign, Get, List, Update, Create, Import, Delete, Backup, Restore</span></span><br><br> <span data-ttu-id="8bb70-181">針對密碼︰取得、列出、設定、刪除</span><span class="sxs-lookup"><span data-stu-id="8bb70-181">For secrets: Get, List, Set, Delete</span></span> |<span data-ttu-id="8bb70-182">金鑰保存庫存取原則</span><span class="sxs-lookup"><span data-stu-id="8bb70-182">Key vault access policy</span></span> |

<span data-ttu-id="8bb70-183">管理平面和資料平面的存取控制在運作上互不相關。</span><span class="sxs-lookup"><span data-stu-id="8bb70-183">The management plane and data plane access controls work independently.</span></span> <span data-ttu-id="8bb70-184">比方說，如果您想要對應用程式授與金鑰保存庫中金鑰的使用權限，您只需要使用金鑰保存庫存取原則對資料平面授與存取權限，此應用程式完全不需要管理平面的存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-184">For example, if you want to grant an application access to use keys in a key vault, you only need to grant data plane access permissions using key vault access policies and no management plane access is needed for this application.</span></span> <span data-ttu-id="8bb70-185">相反地，如果您想要讓使用者能夠讀取保存庫屬性和標籤，但不讓他擁有金鑰、密碼或憑證的任何存取權，您可以使用 RBAC 對這位使用者授與「讀取」權限，但不需要授與資料平面的存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-185">And conversely, if you want a user to be able to read vault properties and tags, but not have any access to keys, secrets, or certificates, you can grant this user, 'read' access using RBAC and no access to data plane is required.</span></span>

## <a name="management-plane-access-control"></a><span data-ttu-id="8bb70-186">管理平面存取控制</span><span class="sxs-lookup"><span data-stu-id="8bb70-186">Management plane access control</span></span>
<span data-ttu-id="8bb70-187">管理平面是由會影響金鑰保存庫本身的作業所組成。</span><span class="sxs-lookup"><span data-stu-id="8bb70-187">The management plane consists of operations that affect the key vault itself.</span></span> <span data-ttu-id="8bb70-188">例如，您可以建立或刪除金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="8bb70-188">For example, you can create or delete a key vault.</span></span> <span data-ttu-id="8bb70-189">您可以取得訂用帳戶中的保存庫清單。</span><span class="sxs-lookup"><span data-stu-id="8bb70-189">You can get a list of vaults in a subscription.</span></span> <span data-ttu-id="8bb70-190">您可以擷取金鑰保存庫屬性 (例如 SKU、標籤)，並設定金鑰保存庫存取原則來控制可存取金鑰保存庫中金鑰和密碼的使用者和應用程式。</span><span class="sxs-lookup"><span data-stu-id="8bb70-190">You can retrieve key vault properties (such as SKU, tags) and set key vault access policies that control the users and applications that can access keys and secrets in the key vault.</span></span> <span data-ttu-id="8bb70-191">管理平面存取控制會使用 RBAC。</span><span class="sxs-lookup"><span data-stu-id="8bb70-191">Management plane access control uses RBAC.</span></span> <span data-ttu-id="8bb70-192">請參閱上一節的資料表中，可透過管理平面執行的金鑰保存庫作業完整清單。</span><span class="sxs-lookup"><span data-stu-id="8bb70-192">See the complete list of key vault operations that can be performed via management plane in the table in preceding section.</span></span> 

### <a name="role-based-access-control-rbac"></a><span data-ttu-id="8bb70-193">角色型存取控制 (RBAC)</span><span class="sxs-lookup"><span data-stu-id="8bb70-193">Role-based Access Control (RBAC)</span></span>
<span data-ttu-id="8bb70-194">每一個 Azure 訂用帳戶都具有 Azure Active Directory。</span><span class="sxs-lookup"><span data-stu-id="8bb70-194">Each Azure subscription has an Azure Active Directory.</span></span> <span data-ttu-id="8bb70-195">您可以為來自該目錄的使用者、群組和應用程式授與存取權，以便在使用 Azure Resource Manager 部署模型的 Azure 訂用帳戶中管理資源。</span><span class="sxs-lookup"><span data-stu-id="8bb70-195">Users, groups, and applications from this directory can be granted access to manage resources in the Azure subscription that use the Azure Resource Manager deployment model.</span></span> <span data-ttu-id="8bb70-196">這種存取控制稱為角色型存取控制 (RBAC)。</span><span class="sxs-lookup"><span data-stu-id="8bb70-196">This type of access control is referred to as Role-Based Access Control (RBAC).</span></span> <span data-ttu-id="8bb70-197">若要管理此存取權，您可以使用 [Azure 入口網站](https://portal.azure.com/)、[Azure CLI 工具](../cli-install-nodejs.md)、[PowerShell](/powershell/azureps-cmdlets-docs) 或 [Azure Resource Manager REST API](https://msdn.microsoft.com/library/azure/dn906885.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8bb70-197">To manage this access, you can use the [Azure portal](https://portal.azure.com/), the [Azure CLI tools](../cli-install-nodejs.md), [PowerShell](/powershell/azureps-cmdlets-docs), or the [Azure Resource Manager REST APIs](https://msdn.microsoft.com/library/azure/dn906885.aspx).</span></span>

<span data-ttu-id="8bb70-198">透過 Azure Resource Manager 模型，您可以在資源群組中建立金鑰保存庫，並使用 Azure Active Directory 來控制此金鑰保存庫之管理平面的存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-198">With the Azure Resource Manager model, you create your key vault in a resource group and control access to the management plane of this key vault by using Azure Active Directory.</span></span> <span data-ttu-id="8bb70-199">例如，您可以對使用者或群組授與在特定資源群組中管理金鑰保存庫的能力。</span><span class="sxs-lookup"><span data-stu-id="8bb70-199">For example, you can grant users or a group ability to manage key vaults in a specific resource group.</span></span>

<span data-ttu-id="8bb70-200">您可以藉由指派適當的 RBAC 角色，在特定範圍對使用者、群組和應用程式授與存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-200">You can grant access to users, groups and applications at a specific scope by assigning appropriate RBAC roles.</span></span> <span data-ttu-id="8bb70-201">例如，若要對使用者授與管理金鑰保存庫的權限，您會在特定範圍對此使用者指派預先定義的角色「金鑰保存庫參與者」。</span><span class="sxs-lookup"><span data-stu-id="8bb70-201">For example, to grant access to a user to manage key vaults you would assign a predefined role 'key vault Contributor' to this user at a specific scope.</span></span> <span data-ttu-id="8bb70-202">在此案例中，範圍會是訂用帳戶、資源群組或只是特定金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="8bb70-202">The scope in this case would be either a subscription, a resource group, or just a specific key vault.</span></span> <span data-ttu-id="8bb70-203">在訂用帳戶層級指派的角色，會套用至該訂用帳戶內的所有資源群組和資源。</span><span class="sxs-lookup"><span data-stu-id="8bb70-203">A role assigned at subscription level applies to all resource groups and resources within that subscription.</span></span> <span data-ttu-id="8bb70-204">在資源群組層級指派的角色，會套用至該資源群組內的所有資源。</span><span class="sxs-lookup"><span data-stu-id="8bb70-204">A role assigned at resource group level applies to all resources in that resource group.</span></span> <span data-ttu-id="8bb70-205">針對特定資源指派的角色，則只會套用至該資源。</span><span class="sxs-lookup"><span data-stu-id="8bb70-205">A role assigned for a specific resource only applies to that resource.</span></span> <span data-ttu-id="8bb70-206">有數個預先定義的角色 (請參閱 [RBAC︰內建角色](../active-directory/role-based-access-built-in-roles.md))，如果預先定義的角色不符合您的需求，您也可以定義自己的角色。</span><span class="sxs-lookup"><span data-stu-id="8bb70-206">There are several predefined roles (see [RBAC: Built-in roles](../active-directory/role-based-access-built-in-roles.md)), and if the predefined roles do not fit your needs you can also define your own roles.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8bb70-207">請注意，如果使用者具有金鑰保存庫管理平面的參與者權限 (RBAC)，她可以藉由設定可控制資料平面存取權的金鑰保存庫存取原則，對自己授與資料平面的存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-207">Note that if a user has Contributor permissions (RBAC) to a key vault management plane, she can grant herself access to data plane, by setting key vault access policy, which controls access to data plane.</span></span> <span data-ttu-id="8bb70-208">因此，建議您嚴格控制擁有金鑰保存庫「參與者」權限的人員，以確保只有獲得授權的人員可以存取和管理金鑰保存庫、金鑰、密碼和憑證。</span><span class="sxs-lookup"><span data-stu-id="8bb70-208">Therefore, it is recommended to tightly control who has 'Contributor' access to your key vaults to ensure only authorized persons can access and manage your key vaults, keys, secrets, and certificates.</span></span>
> 
> 

## <a name="data-plane-access-control"></a><span data-ttu-id="8bb70-209">資料平面存取控制</span><span class="sxs-lookup"><span data-stu-id="8bb70-209">Data plane access control</span></span>
<span data-ttu-id="8bb70-210">金鑰保存庫資料平面是由會影響金鑰保存庫物件 (例如金鑰、密碼和憑證) 的作業所組成。</span><span class="sxs-lookup"><span data-stu-id="8bb70-210">The key vault data plane consists of operations that affect the objects in a key vault, such as keys, secrets, and certificates.</span></span>  <span data-ttu-id="8bb70-211">這包括金鑰作業 (例如建立、匯入、更新、列出、備份和還原金鑰)、密碼編譯作業 (例如簽署、驗證、加密、解密、包裝和解除包裝)，以及為金鑰設定標籤和其他屬性。</span><span class="sxs-lookup"><span data-stu-id="8bb70-211">This includes key operations such as create, import, update, list, backup, and restore keys, cryptographic operations such as sign, verify, encrypt, decrypt, wrap, and unwrap, and set tags and other attributes for keys.</span></span> <span data-ttu-id="8bb70-212">同樣地，針對密碼所包含的是取得、設定、列出、刪除。</span><span class="sxs-lookup"><span data-stu-id="8bb70-212">Similarly, for secrets it includes, get, set, list, delete.</span></span>

<span data-ttu-id="8bb70-213">資料平面的存取權是藉由設定金鑰保存庫的存取原則來授與。</span><span class="sxs-lookup"><span data-stu-id="8bb70-213">Data plane access is granted by setting access policies for a key vault.</span></span> <span data-ttu-id="8bb70-214">使用者、群組或應用程式必須具有管理平面的參與者權限 (RBAC)，金鑰保存庫才能設定該金鑰保存庫的存取原則。</span><span class="sxs-lookup"><span data-stu-id="8bb70-214">A user, group, or an application must have Contributor permissions (RBAC) for management plane for a key vault to be able to set access policies for that key vault.</span></span> <span data-ttu-id="8bb70-215">您可以對使用者、群組或應用程式授與權限，來為金鑰保存庫中的金鑰或密碼執行特定作業。</span><span class="sxs-lookup"><span data-stu-id="8bb70-215">A user, group, or application can be granted access to perform specific operations for keys or secrets in a key vault.</span></span> <span data-ttu-id="8bb70-216">金鑰保存庫最多可支援 16 個存取原則項目。</span><span class="sxs-lookup"><span data-stu-id="8bb70-216">Key vault support up to 16 access policy entries for a key vault.</span></span> <span data-ttu-id="8bb70-217">建立 Azure Active Directory 安全性群組並在該群組中新增使用者，即可對數名使用者授與金鑰保存庫的資料平面存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-217">Create an Azure Active Directory security group and add users to that group to grant data plane access to several users to a key vault.</span></span>

### <a name="key-vault-access-policies"></a><span data-ttu-id="8bb70-218">金鑰保存庫存取原則</span><span class="sxs-lookup"><span data-stu-id="8bb70-218">Key vault Access Policies</span></span>
<span data-ttu-id="8bb70-219">金鑰保存庫存取原則可分別授與金鑰、密碼和憑證的權限。</span><span class="sxs-lookup"><span data-stu-id="8bb70-219">Key vault access policies grant permissions to keys, secrets and certificates separately.</span></span> <span data-ttu-id="8bb70-220">例如，您可以只提供金鑰存取權給使用者，但不提供密碼的權限。</span><span class="sxs-lookup"><span data-stu-id="8bb70-220">For example, you can give a user access to only keys, but no permissions for secrets.</span></span> <span data-ttu-id="8bb70-221">不過，金鑰、密碼或憑證的存取權限是在保存庫層級。</span><span class="sxs-lookup"><span data-stu-id="8bb70-221">However, permissions to access keys or secrets or certificates are at the vault level.</span></span> <span data-ttu-id="8bb70-222">換句話說，金鑰保存庫存取原則不支援物件層級權限。</span><span class="sxs-lookup"><span data-stu-id="8bb70-222">In other words, key vault access policy does not support object level permissions.</span></span> <span data-ttu-id="8bb70-223">您可以使用 [Azure 入口網站](https://portal.azure.com/)、[Azure CLI 工具](../cli-install-nodejs.md)、[PowerShell](/powershell/azureps-cmdlets-docs) 或[金鑰保存庫管理 REST API](https://msdn.microsoft.com/library/azure/mt620024.aspx) 來設定金鑰保存庫的存取原則。</span><span class="sxs-lookup"><span data-stu-id="8bb70-223">You can use [Azure portal](https://portal.azure.com/), the [Azure CLI tools](../cli-install-nodejs.md), [PowerShell](/powershell/azureps-cmdlets-docs), or the [key vault Management REST APIs](https://msdn.microsoft.com/library/azure/mt620024.aspx) to set access policies for a key vault.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8bb70-224">請注意，金鑰保存庫存取原則會套用在保存庫層級。</span><span class="sxs-lookup"><span data-stu-id="8bb70-224">Note that key vault access policies apply at the vault level.</span></span> <span data-ttu-id="8bb70-225">例如，對使用者授與金鑰的建立和刪除權限時，她就可以對該金鑰保存庫的所有金鑰執行這些作業。</span><span class="sxs-lookup"><span data-stu-id="8bb70-225">For example, when a user is granted permission to create and delete keys, she can perform those operations on all keys in that key vault.</span></span>
> 
> 

## <a name="example"></a><span data-ttu-id="8bb70-226">範例</span><span class="sxs-lookup"><span data-stu-id="8bb70-226">Example</span></span>
<span data-ttu-id="8bb70-227">假設您正在開發的應用程式使用 SSL 憑證、使用 Azure 儲存體來儲存資料，並使用 RSA 2048 位元金鑰來進行簽署作業。</span><span class="sxs-lookup"><span data-stu-id="8bb70-227">Let's say you are developing an application that uses a certificate for SSL, Azure storage for storing data, and uses an RSA 2048-bit key for sign operations.</span></span> <span data-ttu-id="8bb70-228">假設此應用程式正在 VM (或 VM 擴展集) 中執行。</span><span class="sxs-lookup"><span data-stu-id="8bb70-228">Let's say this application is running in a VM (or a VM Scale Set).</span></span> <span data-ttu-id="8bb70-229">您可以使用金鑰保存庫來儲存所有應用程式密碼，並使用金鑰保存庫來儲存應用程式用來向 Azure Active Directory 進行驗證的啟動程序憑證。</span><span class="sxs-lookup"><span data-stu-id="8bb70-229">You can use a key vault to store all the application secrets, and use key vault to store the bootstrap certificate that is used by the application to authenticate with Azure Active Directory.</span></span>

<span data-ttu-id="8bb70-230">那麼，以下是金鑰保存庫中儲存之所有金鑰和密碼的摘要。</span><span class="sxs-lookup"><span data-stu-id="8bb70-230">So, here's a summary of all the keys and secrets to be stored in a key vault.</span></span>

* <span data-ttu-id="8bb70-231">**SSL 憑證** - 用於 SSL</span><span class="sxs-lookup"><span data-stu-id="8bb70-231">**SSL Cert** - used for SSL</span></span>
* <span data-ttu-id="8bb70-232">**儲存體金鑰** - 用來取得儲存體帳戶的存取權</span><span class="sxs-lookup"><span data-stu-id="8bb70-232">**Storage Key** - used to get access to Storage account</span></span>
* <span data-ttu-id="8bb70-233">**RSA 2048 位元金鑰** - 用於簽署作業</span><span class="sxs-lookup"><span data-stu-id="8bb70-233">**RSA 2048-bit key** - used for sign operations</span></span>
* <span data-ttu-id="8bb70-234">**啟動程序憑證** - 用來向 Azure Active Directory 進行驗證，取得金鑰保存庫的存取權以擷取儲存體金鑰並使用 RSA 金鑰來進行簽署。</span><span class="sxs-lookup"><span data-stu-id="8bb70-234">**Bootstrap certificate** - used to authenticate to Azure Active Directory, to get access to key vault to fetch the storage key and use the RSA key for signing.</span></span>

<span data-ttu-id="8bb70-235">現在讓我們看看負責管理、部署和稽核此應用程式的人員。</span><span class="sxs-lookup"><span data-stu-id="8bb70-235">Now let's meet the people who are managing, deploying and auditing this application.</span></span> <span data-ttu-id="8bb70-236">在此範例中，我們會使用三種角色。</span><span class="sxs-lookup"><span data-stu-id="8bb70-236">We'll use three roles in this example.</span></span>

* <span data-ttu-id="8bb70-237">**安全性小組** - 這些人通常是「CSO (資訊安全長) 辦公室」的 IT 人員或地位相當的人員，需負責妥善保管機密資料，像是 SSL 憑證、用於進行簽署的 RSA 金鑰、資料庫的連接字串和儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="8bb70-237">**Security team** - These are typically IT staff from the 'office of the CSO (Chief Security Officer)' or equivalent, responsible for the proper safekeeping of secrets such as SSL certificates, RSA keys used for signing, connection strings for databases, storage account keys.</span></span>
* <span data-ttu-id="8bb70-238">**開發人員/操作員** - 這些人需負責開發此應用程式，然後將它部署在 Azure 中。</span><span class="sxs-lookup"><span data-stu-id="8bb70-238">**Developers/operators** - These are the folks who develop this application and then deploy it in Azure.</span></span> <span data-ttu-id="8bb70-239">一般而言，它們不屬於安全性小組，因此不應該擁有任何機密資料 (像是 SSL 憑證、RSA 金鑰) 的存取權，但他們所部署的應用程式應該擁有這些項目的存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-239">Typically, they are not part of the security team, and hence they should not have access to any sensitive data, such as SSL certificates, RSA keys, but the application they deploy should have access to those.</span></span>
* <span data-ttu-id="8bb70-240">**稽核員** - 這通常是一組不同人員，與開發人員和一般 IT 人員有所區隔。</span><span class="sxs-lookup"><span data-stu-id="8bb70-240">**Auditors** - This is usually a different set of people, isolated from the developers and general IT staff.</span></span> <span data-ttu-id="8bb70-241">他們的責任是檢閱憑證、金鑰等項目的使用和維護情形是否適當，並確保各項作業符合資料安全性標準。</span><span class="sxs-lookup"><span data-stu-id="8bb70-241">Their responsibility is to review proper use and maintenance of certificates, keys, etc. and ensure compliance with data security standards.</span></span> 

<span data-ttu-id="8bb70-242">還有一種角色不在此應用程式的涵蓋範圍內，但有所相關所以在此提出，該角色就是訂用帳戶 (或資源群組) 管理員。</span><span class="sxs-lookup"><span data-stu-id="8bb70-242">There is one more role that is outside the scope of this application, but relevant here to be mentioned, and that would be the subscription (or resource group) administrator.</span></span> <span data-ttu-id="8bb70-243">訂用帳戶管理員會設定安全性小組的初始存取權限。</span><span class="sxs-lookup"><span data-stu-id="8bb70-243">Subscription administrator sets up initial access permissions for the security team.</span></span> <span data-ttu-id="8bb70-244">這裡我們假設，訂用帳戶管理員已對安全性小組授與資源群組的存取權，該群組中含有此應用程式所需的所有資源。</span><span class="sxs-lookup"><span data-stu-id="8bb70-244">Here we assume that the subscription administrator has granted access to the security team to a resource group in which all the resources needed for this application reside.</span></span>

<span data-ttu-id="8bb70-245">現在我們來看看，每個角色會在此應用程式內容中執行的動作。</span><span class="sxs-lookup"><span data-stu-id="8bb70-245">Now let's see what actions each role performs in the context of this application.</span></span>

* <span data-ttu-id="8bb70-246">**安全性小組**</span><span class="sxs-lookup"><span data-stu-id="8bb70-246">**Security team**</span></span>
  * <span data-ttu-id="8bb70-247">建立金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="8bb70-247">Create key vaults</span></span>
  * <span data-ttu-id="8bb70-248">開啟金鑰保存庫記錄</span><span class="sxs-lookup"><span data-stu-id="8bb70-248">Turns on key vault logging</span></span>
  * <span data-ttu-id="8bb70-249">新增金鑰/密碼</span><span class="sxs-lookup"><span data-stu-id="8bb70-249">Add keys/secrets</span></span>
  * <span data-ttu-id="8bb70-250">建立金鑰備份以用於災害復原</span><span class="sxs-lookup"><span data-stu-id="8bb70-250">Create backup of keys for disaster recovery</span></span>
  * <span data-ttu-id="8bb70-251">設定金鑰保存庫存取原則，對使用者和應用程式授與執行特定作業的權限</span><span class="sxs-lookup"><span data-stu-id="8bb70-251">Set key vault access policy to grant permissions to users and applications to perform specific operations</span></span>
  * <span data-ttu-id="8bb70-252">定期輪替金鑰/密碼</span><span class="sxs-lookup"><span data-stu-id="8bb70-252">Periodically roll keys/secrets</span></span>
* <span data-ttu-id="8bb70-253">**開發人員/操作員**</span><span class="sxs-lookup"><span data-stu-id="8bb70-253">**Developers/operators**</span></span>
  * <span data-ttu-id="8bb70-254">從安全性小組取得啟動程序和 SSL 憑證 (指紋)、儲存體金鑰 (密碼 URI) 和簽署金鑰 (金鑰 URI) 的參考</span><span class="sxs-lookup"><span data-stu-id="8bb70-254">Get references to bootstrap and SSL certs (thumbprints), storage key (secret URI) and signing key (Key URI) from security team</span></span>
  * <span data-ttu-id="8bb70-255">開發和部署以程式設計方式存取金鑰和密碼的應用程式</span><span class="sxs-lookup"><span data-stu-id="8bb70-255">Develop and deploy application that accesses keys and secrets programmatically</span></span>
* <span data-ttu-id="8bb70-256">**稽核員**</span><span class="sxs-lookup"><span data-stu-id="8bb70-256">**Auditors**</span></span>
  * <span data-ttu-id="8bb70-257">檢閱使用記錄，確認金鑰/密碼的使用是否適當，以及是否符合資料安全性標準</span><span class="sxs-lookup"><span data-stu-id="8bb70-257">Review usage logs to confirm proper key/secret use and compliance with data security standards</span></span>

<span data-ttu-id="8bb70-258">現在讓我們看看，每個角色 (和應用程式) 需要哪些金鑰保存庫存取權限才能執行對其指派的工作。</span><span class="sxs-lookup"><span data-stu-id="8bb70-258">Now let's see what access permissions to key vault are needed by each role (and the application) to perform their assigned tasks.</span></span> 

| <span data-ttu-id="8bb70-259">使用者角色</span><span class="sxs-lookup"><span data-stu-id="8bb70-259">User Role</span></span> | <span data-ttu-id="8bb70-260">管理平面權限</span><span class="sxs-lookup"><span data-stu-id="8bb70-260">Management plane permissions</span></span> | <span data-ttu-id="8bb70-261">資料平面權限</span><span class="sxs-lookup"><span data-stu-id="8bb70-261">Data plane permissions</span></span> |
| --- | --- | --- |
| <span data-ttu-id="8bb70-262">安全性小組</span><span class="sxs-lookup"><span data-stu-id="8bb70-262">Security Team</span></span> |<span data-ttu-id="8bb70-263">金鑰保存庫參與者</span><span class="sxs-lookup"><span data-stu-id="8bb70-263">key vault Contributor</span></span> |<span data-ttu-id="8bb70-264">金鑰︰備份、建立、刪除、取得、匯入、列出、還原</span><span class="sxs-lookup"><span data-stu-id="8bb70-264">Keys: backup, create, delete, get, import, list, restore</span></span> <br> <span data-ttu-id="8bb70-265">密碼︰全部</span><span class="sxs-lookup"><span data-stu-id="8bb70-265">Secrets: all</span></span> |
| <span data-ttu-id="8bb70-266">開發人員/操作員</span><span class="sxs-lookup"><span data-stu-id="8bb70-266">Developers/Operator</span></span> |<span data-ttu-id="8bb70-267">金鑰保存庫部署權限，以便其所部署的 VM 可以擷取金鑰保存庫中的密碼</span><span class="sxs-lookup"><span data-stu-id="8bb70-267">key vault deploy permission so that the VMs they deploy can fetch secrets from the key vault</span></span> |<span data-ttu-id="8bb70-268">None</span><span class="sxs-lookup"><span data-stu-id="8bb70-268">None</span></span> |
| <span data-ttu-id="8bb70-269">稽核員</span><span class="sxs-lookup"><span data-stu-id="8bb70-269">Auditors</span></span> |<span data-ttu-id="8bb70-270">None</span><span class="sxs-lookup"><span data-stu-id="8bb70-270">None</span></span> |<span data-ttu-id="8bb70-271">金鑰︰列出</span><span class="sxs-lookup"><span data-stu-id="8bb70-271">Keys: list</span></span><br><span data-ttu-id="8bb70-272">密碼︰列出</span><span class="sxs-lookup"><span data-stu-id="8bb70-272">Secrets: list</span></span> |
| <span data-ttu-id="8bb70-273">應用程式</span><span class="sxs-lookup"><span data-stu-id="8bb70-273">Application</span></span> |<span data-ttu-id="8bb70-274">None</span><span class="sxs-lookup"><span data-stu-id="8bb70-274">None</span></span> |<span data-ttu-id="8bb70-275">金鑰︰簽署</span><span class="sxs-lookup"><span data-stu-id="8bb70-275">Keys: sign</span></span><br><span data-ttu-id="8bb70-276">密碼︰取得</span><span class="sxs-lookup"><span data-stu-id="8bb70-276">Secrets: get</span></span> |

> [!NOTE]
> <span data-ttu-id="8bb70-277">稽核員需要金鑰和密碼的列出權限，以便可以檢查記錄檔中不會顯現之金鑰和密碼的屬性，例如標籤、啟用日和到期日。</span><span class="sxs-lookup"><span data-stu-id="8bb70-277">Auditors need list permission for keys and secrets so they can inspect attributes for keys and secrets that are not emitted in the logs, such as tags, activation and expiration dates.</span></span>
> 
> 

<span data-ttu-id="8bb70-278">除了金鑰保存庫的權限外，這三個角色還需要其他資源的存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-278">Besides permission to key vault, all three roles also need access to other resources.</span></span> <span data-ttu-id="8bb70-279">例如，為了能夠部署 VM (或 Web Apps 等)。開發人員/操作員還需要這些資源類型的「參與者」存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-279">For example, to be able to deploy VMs (or Web Apps etc.) Developers/Operators also need 'Contributor' access to those resource types.</span></span> <span data-ttu-id="8bb70-280">稽核員需要金鑰保存庫記錄檔儲存所在之儲存體帳戶的讀取權限。</span><span class="sxs-lookup"><span data-stu-id="8bb70-280">Auditors need read access to the storage account where the key vault logs are stored.</span></span>

<span data-ttu-id="8bb70-281">本文的重點是保護金鑰保存庫的存取權，因此只說明與本主題相關的部分，並略過有關以程式設計方式部署憑證、存取金鑰和密碼等等的詳細資料。這些詳細資料已在其他地方做過說明。</span><span class="sxs-lookup"><span data-stu-id="8bb70-281">Since the focus of this article is securing access to your key vault, we only illustrate the relevant portions pertaining to this topic and skip details regarding deploying certificates, accessing keys and secrets programmatically etc. Those details are already covered elsewhere.</span></span> <span data-ttu-id="8bb70-282">將金鑰保存庫中儲存的憑證部署至 VM 是在[部落格文章](https://blogs.technet.microsoft.com/kv/2016/09/14/updated-deploy-certificates-to-vms-from-customer-managed-key-vault/)中說明，裡面有提供[範例程式碼](https://www.microsoft.com/download/details.aspx?id=45343)來說明，如何使用啟動程序憑證向 Azure AD 進行驗證以取得金鑰保存庫的存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-282">Deploying certificates stored in key vault to VMs is covered in a [blog post](https://blogs.technet.microsoft.com/kv/2016/09/14/updated-deploy-certificates-to-vms-from-customer-managed-key-vault/), and there is [sample code](https://www.microsoft.com/download/details.aspx?id=45343) available that illustrates how to use bootstrap certificate to authenticate to Azure AD to get access to key vault.</span></span>

<span data-ttu-id="8bb70-283">大多數存取權限皆可使用 Azure 入口網站來授與，但若要授與更細微的權限，您可能需要使用 Azure PowerShell (或 Azure CLI) 來達到所需結果。</span><span class="sxs-lookup"><span data-stu-id="8bb70-283">Most of the access permissions can be granted using Azure portal, but to grant granular permissions you may need to use Azure PowerShell (or Azure CLI) to achieve the desired result.</span></span> 

<span data-ttu-id="8bb70-284">下列 PowerShell 程式碼片段假設︰</span><span class="sxs-lookup"><span data-stu-id="8bb70-284">The following PowerShell snippets assume:</span></span>

* <span data-ttu-id="8bb70-285">Azure Active Directory 系統管理員已建立安全性群組來代表三種角色，分別是 Contoso Security Team、Contoso App Devops、Contoso App Auditors。</span><span class="sxs-lookup"><span data-stu-id="8bb70-285">The Azure Active Directory administrator has created security groups that represent the three roles, namely Contoso Security Team, Contoso App Devops, Contoso App Auditors.</span></span> <span data-ttu-id="8bb70-286">系統管理員也已將使用者新增至所屬群組。</span><span class="sxs-lookup"><span data-stu-id="8bb70-286">The administrator has also added users to the groups they belong.</span></span>
* <span data-ttu-id="8bb70-287">**ContosoAppRG** 是所有資源所在的資源群組。</span><span class="sxs-lookup"><span data-stu-id="8bb70-287">**ContosoAppRG** is the resource group where all the resources reside.</span></span> <span data-ttu-id="8bb70-288">**contosologstorage** 是記錄檔的儲存位置。</span><span class="sxs-lookup"><span data-stu-id="8bb70-288">**contosologstorage** is where the logs are stored.</span></span> 
* <span data-ttu-id="8bb70-289">金鑰保存庫 **ContosoKeyVault** 和用於金鑰保存庫記錄檔的儲存體帳戶 **contosologstorage** 必須位在相同的 Azure 位置</span><span class="sxs-lookup"><span data-stu-id="8bb70-289">Key vault **ContosoKeyVault** and storage account used for key vault logs **contosologstorage** must be in the same Azure location</span></span>

<span data-ttu-id="8bb70-290">首先，訂用帳戶管理員會對安全性小組指派「金鑰保存庫參與者」和「使用者存取系統管理員」角色。</span><span class="sxs-lookup"><span data-stu-id="8bb70-290">First the subscription administrator assigns 'key vault Contributor' and 'User Access Administrator' roles to the security team.</span></span> <span data-ttu-id="8bb70-291">這可讓安全性小組管理其他資源的存取權，以及管理資源群組 ContosoAppRG 中的金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="8bb70-291">This allows the security team to manage access to other resources and manage key vaults in the resource group ContosoAppRG.</span></span>

```
New-AzureRmRoleAssignment -ObjectId (Get-AzureRmADGroup -SearchString 'Contoso Security Team')[0].Id -RoleDefinitionName "key vault Contributor" -ResourceGroupName ContosoAppRG
New-AzureRmRoleAssignment -ObjectId (Get-AzureRmADGroup -SearchString 'Contoso Security Team')[0].Id -RoleDefinitionName "User Access Administrator" -ResourceGroupName ContosoAppRG
```

<span data-ttu-id="8bb70-292">下列指令碼說明安全性小組要如何建立金鑰保存庫、設定記錄，以及設定其他角色和應用程式的存取權限。</span><span class="sxs-lookup"><span data-stu-id="8bb70-292">The following script illustrates how the security team can create a key vault, setup logging, and set access permissions for other roles and the application.</span></span> 

```
# Create key vault and enable logging
$sa = Get-AzureRmStorageAccount -ResourceGroup ContosoAppRG -Name contosologstorage
$kv = New-AzureRmKeyVault -VaultName ContosoKeyVault -ResourceGroup ContosoAppRG -SKU premium -Location 'westus' -EnabledForDeployment
Set-AzureRmDiagnosticSetting -ResourceId $kv.ResourceId -StorageAccountId $sa.Id -Enabled $true -Categories AuditEvent

# Data plane permissions for Security team
Set-AzureRmKeyVaultAccessPolicy -VaultName ContosoKeyVault -ObjectId (Get-AzureRmADGroup -SearchString 'Contoso Security Team')[0].Id -PermissionsToKeys backup,create,delete,get,import,list,restore -PermissionsToSecrets all

# Management plane permissions for Dev/ops
# Create a new role from an existing role
$devopsrole = Get-AzureRmRoleDefinition -Name "Virtual Machine Contributor"
$devopsrole.Id = $null
$devopsrole.Name = "Contoso App Devops"
$devopsrole.Description = "Can deploy VMs that need secrets from key vault"
$devopsrole.AssignableScopes = @("/subscriptions/<SUBSCRIPTION-GUID>")

# Add permission for dev/ops so they can deploy VMs that have secrets deployed from key vaults
$devopsrole.Actions.Add("Microsoft.KeyVault/vaults/deploy/action")
New-AzureRmRoleDefinition -Role $devopsrole

# Assign this newly defined role to Dev ops security group
New-AzureRmRoleAssignment -ObjectId (Get-AzureRmADGroup -SearchString 'Contoso App Devops')[0].Id -RoleDefinitionName "Contoso App Devops" -ResourceGroupName ContosoAppRG

# Data plane permissions for Auditors
Set-AzureRmKeyVaultAccessPolicy -VaultName ContosoKeyVault -ObjectId (Get-AzureRmADGroup -SearchString 'Contoso App Auditors')[0].Id -PermissionsToKeys list -PermissionsToSecrets list
```

<span data-ttu-id="8bb70-293">所定義的自訂角色只能指派給 ContosoAppRG 資源群組建立所在的訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="8bb70-293">The custom role defined, is only assignable to the subscription where the ContosoAppRG resource group is created.</span></span> <span data-ttu-id="8bb70-294">如果相同的自訂角色會用於其他訂用帳戶中的其他專案，則其範圍可以新增更多訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="8bb70-294">If the same custom roles will be used for other projects in other subscriptions, it's scope could have more subscriptions added.</span></span>

<span data-ttu-id="8bb70-295">可為開發人員/操作員指派「部署/動作」權限的自訂角色侷限於資源群組。</span><span class="sxs-lookup"><span data-stu-id="8bb70-295">The custom role assignment for the developers/operators for the "deploy/action" permission is scoped to the resource group.</span></span> <span data-ttu-id="8bb70-296">如此一來，只有在資源群組「ContosoAppRG」中建立的 VM 會取得機密資料 (SSL 憑證和啟動程序憑證)。</span><span class="sxs-lookup"><span data-stu-id="8bb70-296">This way only the VMs created in the resource group 'ContosoAppRG' will get the secrets (SSL cert and bootstrap cert).</span></span> <span data-ttu-id="8bb70-297">開發人員/操作員小組成員在其他資源群組中建立的任何 VM 即使知道機密資料 URI，也無法取得這些機密資料。</span><span class="sxs-lookup"><span data-stu-id="8bb70-297">Any VMs that a member of dev/ops team creates in other resource group will not be able to get these secrets even if they knew the secret URIs.</span></span>

<span data-ttu-id="8bb70-298">此範例描述的是簡單案例。</span><span class="sxs-lookup"><span data-stu-id="8bb70-298">This example depicts a simple scenario.</span></span> <span data-ttu-id="8bb70-299">真實案例可能會更複雜，您可能需要根據需求調整金鑰保存庫的權限。</span><span class="sxs-lookup"><span data-stu-id="8bb70-299">Real life scenarios may be more complex and you may need to adjust permissions to your key vault based on your needs.</span></span> <span data-ttu-id="8bb70-300">例如，在我們所舉的範例中，我們假設該安全性小組會提供開發人員/操作員小組需要在其應用程式中參考的金鑰和密碼參考 (URI 和指紋)。</span><span class="sxs-lookup"><span data-stu-id="8bb70-300">For example, in our example, we assume that security team will provide the key and secret references (URIs and thumbprints) that developers/operators team need to reference in their applications.</span></span> <span data-ttu-id="8bb70-301">因此，他們不需要對開發人員/操作員授與任何資料平面存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-301">Hence, they don't need to grant developers/operators any data plane access.</span></span> <span data-ttu-id="8bb70-302">另請注意，此範例的內容著重在保護金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="8bb70-302">Also, note that this example focuses on securing your key vault.</span></span> <span data-ttu-id="8bb70-303">若要保護[您的 VM](https://azure.microsoft.com/services/virtual-machines/security/)、[儲存體帳戶](../storage/common/storage-security-guide.md)和其他 Azure 資源，也應提供類似考量。</span><span class="sxs-lookup"><span data-stu-id="8bb70-303">Similar consideration should be given to secure [your VMs](https://azure.microsoft.com/services/virtual-machines/security/), [storage accounts](../storage/common/storage-security-guide.md) and other Azure resources too.</span></span>

> [!NOTE]
> <span data-ttu-id="8bb70-304">注意︰此範例示範生產環境中會如何鎖定金鑰保存庫的存取權。</span><span class="sxs-lookup"><span data-stu-id="8bb70-304">Note: This example shows how key vault access will be locked down in production.</span></span> <span data-ttu-id="8bb70-305">開發人員應該有自己的訂用帳戶或資源群組，並擁有完整權限以便管理他們用來開發應用程式的保存庫、VM 和儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="8bb70-305">The developers should have their own subscription or resourcegroup where they have full permissions to manage their vaults, VMs and storage account where they develop the application.</span></span>
> 
> 

## <a name="resources"></a><span data-ttu-id="8bb70-306">資源</span><span class="sxs-lookup"><span data-stu-id="8bb70-306">Resources</span></span>
* [<span data-ttu-id="8bb70-307">Azure Active Directory 角色型存取控制</span><span class="sxs-lookup"><span data-stu-id="8bb70-307">Azure Active Directory Role-based Access Control</span></span>](../active-directory/role-based-access-control-configure.md)
  
  <span data-ttu-id="8bb70-308">本文說明 Azure Active Directory 角色型存取控制及其運作方式。</span><span class="sxs-lookup"><span data-stu-id="8bb70-308">This article explains the Azure Active Directory Role-based Access Control and how it works.</span></span>
* [<span data-ttu-id="8bb70-309">RBAC：內建角色</span><span class="sxs-lookup"><span data-stu-id="8bb70-309">RBAC: Built in Roles</span></span>](../active-directory/role-based-access-built-in-roles.md)
  
  <span data-ttu-id="8bb70-310">本文詳細說明 RBAC 中所有可用的內建角色。</span><span class="sxs-lookup"><span data-stu-id="8bb70-310">This article details all the built-in roles available in RBAC.</span></span>
* [<span data-ttu-id="8bb70-311">了解資源管理員部署和傳統部署</span><span class="sxs-lookup"><span data-stu-id="8bb70-311">Understanding Resource Manager deployment and classic deployment</span></span>](../azure-resource-manager/resource-manager-deployment-model.md)
  
  <span data-ttu-id="8bb70-312">本文說明資源管理員部署和傳統部署模型，並說明使用資源管理員和資源群組的優點</span><span class="sxs-lookup"><span data-stu-id="8bb70-312">This article explains the Resource Manager deployment and classic deployment models, and explains the benefits of using the Resource Manager and resource groups</span></span>
* [<span data-ttu-id="8bb70-313">使用 Azure PowerShell 管理角色型存取控制</span><span class="sxs-lookup"><span data-stu-id="8bb70-313">Manage Role-Based Access Control with Azure PowerShell</span></span>](../active-directory/role-based-access-control-manage-access-powershell.md)
  
  <span data-ttu-id="8bb70-314">本文說明如何使用 Azure PowerShell 管理角色型存取控制</span><span class="sxs-lookup"><span data-stu-id="8bb70-314">This article explains how to manage role-based access control with Azure PowerShell</span></span>
* [<span data-ttu-id="8bb70-315">使用 REST API 管理角色型存取控制</span><span class="sxs-lookup"><span data-stu-id="8bb70-315">Managing Role-Based Access Control with the REST API</span></span>](../active-directory/role-based-access-control-manage-access-rest.md)
  
  <span data-ttu-id="8bb70-316">本文說明如何使用 REST API 來管理 RBAC。</span><span class="sxs-lookup"><span data-stu-id="8bb70-316">This article shows how to use the REST API to manage RBAC.</span></span>
* [<span data-ttu-id="8bb70-317">來自Ignite 且適用於 Microsoft Azure 的角色型存取控制</span><span class="sxs-lookup"><span data-stu-id="8bb70-317">Role-Based Access Control for Microsoft Azure from Ignite</span></span>](https://channel9.msdn.com/events/Ignite/2015/BRK2707)
  
  <span data-ttu-id="8bb70-318">這個連結會連到 2015 MS Ignite 會議的 Channel 9 上的視訊。</span><span class="sxs-lookup"><span data-stu-id="8bb70-318">This is a link to a video on Channel 9 from the 2015 MS Ignite conference.</span></span> <span data-ttu-id="8bb70-319">在這個研討會中，他們討論 Azure 中的存取管理和報告功能，並探索使用 Azure Active Directory 安全存取 Azure 訂用帳戶的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="8bb70-319">In this session, they talk about access management and reporting capabilities in Azure, and explore best practices around securing access to Azure subscriptions using Azure Active Directory.</span></span>
* [<span data-ttu-id="8bb70-320">使用 OAuth 2.0 和 Azure Active Directory 授權存取 Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="8bb70-320">Authorize access to web applications using OAuth 2.0 and Azure Active Directory</span></span>](../active-directory/active-directory-protocols-oauth-code.md)
  
  <span data-ttu-id="8bb70-321">本文說明向 Azure Active Directory 進行驗證的完整 OAuth 2.0 流程。</span><span class="sxs-lookup"><span data-stu-id="8bb70-321">This article describes complete OAuth 2.0 flow for authenticating with Azure Active Directory.</span></span>
* [<span data-ttu-id="8bb70-322">金鑰保存庫管理 REST API</span><span class="sxs-lookup"><span data-stu-id="8bb70-322">key vault Management REST APIs</span></span>](https://msdn.microsoft.com/library/azure/mt620024.aspx)
  
  <span data-ttu-id="8bb70-323">本文件是可供以程式設計方式管理金鑰保存庫 (包括設定金鑰保存庫存取原則) 的 REST API 參考。</span><span class="sxs-lookup"><span data-stu-id="8bb70-323">This document is the reference for the REST APIs to manage your key vault programmatically, including setting key vault access policy.</span></span>
* [<span data-ttu-id="8bb70-324">金鑰保存庫 REST API</span><span class="sxs-lookup"><span data-stu-id="8bb70-324">key vault REST APIs</span></span>](https://msdn.microsoft.com/library/azure/dn903609.aspx)
  
  <span data-ttu-id="8bb70-325">金鑰保存庫 REST API 參考文件的連結。</span><span class="sxs-lookup"><span data-stu-id="8bb70-325">Link to key vault REST API reference documentation.</span></span>
* [<span data-ttu-id="8bb70-326">金鑰存取控制</span><span class="sxs-lookup"><span data-stu-id="8bb70-326">Key access control</span></span>](https://msdn.microsoft.com/library/azure/dn903623.aspx#BKMK_KeyAccessControl)
  
  <span data-ttu-id="8bb70-327">密碼存取控制參考文件的連結。</span><span class="sxs-lookup"><span data-stu-id="8bb70-327">Link to Secret access control reference documentation.</span></span>
* [<span data-ttu-id="8bb70-328">密碼存取控制</span><span class="sxs-lookup"><span data-stu-id="8bb70-328">Secret access control</span></span>](https://msdn.microsoft.com/library/azure/dn903623.aspx#BKMK_SecretAccessControl)
  
  <span data-ttu-id="8bb70-329">金鑰存取控制參考文件的連結。</span><span class="sxs-lookup"><span data-stu-id="8bb70-329">Link to Key access control reference documentation.</span></span>
* <span data-ttu-id="8bb70-330">使用 PowerShell [設定](https://msdn.microsoft.com/library/mt603625.aspx)和[移除](https://msdn.microsoft.com/library/mt619427.aspx)金鑰保存庫存取原則</span><span class="sxs-lookup"><span data-stu-id="8bb70-330">[Set](https://msdn.microsoft.com/library/mt603625.aspx) and [Remove](https://msdn.microsoft.com/library/mt619427.aspx) key vault access policy using PowerShell</span></span>
  
  <span data-ttu-id="8bb70-331">用來管理金鑰保存庫存取原則之 PowerShell Cmdlet 參考文件的連結。</span><span class="sxs-lookup"><span data-stu-id="8bb70-331">Links to reference documentation for PowerShell cmdlets to manage key vault access policy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8bb70-332">後續步驟</span><span class="sxs-lookup"><span data-stu-id="8bb70-332">Next Steps</span></span>
<span data-ttu-id="8bb70-333">如需適用於系統管理員的開始使用教學課程，請參閱[開始使用 Azure 金鑰保存庫](key-vault-get-started.md)。</span><span class="sxs-lookup"><span data-stu-id="8bb70-333">For a getting started tutorial for an administrator, see [Get Started with Azure key vault](key-vault-get-started.md).</span></span>

<span data-ttu-id="8bb70-334">如需金鑰保存庫使用方法記錄的詳細資訊，請參閱 [Azure 金鑰保存庫記錄](key-vault-logging.md)。</span><span class="sxs-lookup"><span data-stu-id="8bb70-334">For more information about usage logging for key vault, see [Azure key vault Logging](key-vault-logging.md).</span></span>

<span data-ttu-id="8bb70-335">如需搭配 Azure 金鑰保存庫使用金鑰和密碼的詳細資訊，請參閱[關於金鑰和密碼](https://msdn.microsoft.com/library/azure/dn903623.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8bb70-335">For more information about using keys and secrets with Azure key vault, see [About Keys and Secrets](https://msdn.microsoft.com/library/azure/dn903623.aspx).</span></span>

<span data-ttu-id="8bb70-336">如果您有關於金鑰保存庫的問題，請造訪 [Azure 金鑰保存庫論壇](https://social.msdn.microsoft.com/forums/azure/home?forum=AzureKeyVault)</span><span class="sxs-lookup"><span data-stu-id="8bb70-336">If you have questions about key vault, visit the [Azure key vault Forums](https://social.msdn.microsoft.com/forums/azure/home?forum=AzureKeyVault)</span></span>

