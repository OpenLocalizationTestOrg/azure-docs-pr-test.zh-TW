---
title: "在站台復原 aaaTest 容錯移轉 tooAzure |Microsoft 文件"
description: "了解如何從內部部署 tooAzure 執行測試容錯移轉"
services: site-recovery
documentationcenter: 
author: prateek9us
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 07/04/2017
ms.author: pratshar
ms.openlocfilehash: fa0a93f409cc9f2c2c06c2d91c65971dc90c507f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="test--failover-tooazure-in-site-recovery"></a><span data-ttu-id="1fbc9-103">在站台復原中測試容錯移轉 tooAzure</span><span class="sxs-lookup"><span data-stu-id="1fbc9-103">Test  Failover tooAzure in Site Recovery</span></span>



<span data-ttu-id="1fbc9-104">本文提供資訊，以使用 Azure 做為 hello 復原站台的站台復原所保護的指示執行測試容錯移轉或虛擬機器和實體伺服器的 DR 訓練。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-104">This article provides information and instructions for doing a test failover or a DR drill of virtual machines and physical servers that are protected with Site Recovery using Azure as hello recovery site.</span></span>

<span data-ttu-id="1fbc9-105">將任何註解或問題張貼在本文中，或在 hello hello 下方[Azure 復原服務論壇](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr)。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-105">Post any comments or questions at hello bottom of this article, or on hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

<span data-ttu-id="1fbc9-106">測試容錯移轉已執行 toovalidate 複寫策略，或執行災害復原訓練，沒有任何資料遺失或停機時間。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-106">Test failover is run toovalidate your replication strategy or perform a disaster recovery drill without any data loss or downtime.</span></span> <span data-ttu-id="1fbc9-107">Hello 進行中的複寫或實際執行環境上測試容錯移轉不會有任何影響。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-107">Doing a test failover doesn't have any impact on hello ongoing replication or on your production environment.</span></span> <span data-ttu-id="1fbc9-108">測試容錯移轉可在虛擬機器或[復原計劃](site-recovery-create-recovery-plans.md)上執行。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-108">Test failover can be done either on a virtual machine or a [recovery plan](site-recovery-create-recovery-plans.md).</span></span> <span data-ttu-id="1fbc9-109">當觸發測試容錯移轉，您會需要 toospecify hello 網路 toowhich 測試虛擬機器會連接到。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-109">When triggering a test failover, you need toospecify hello network toowhich test virtual machines would connect to.</span></span> <span data-ttu-id="1fbc9-110">一旦觸發測試容錯移轉時，您可以追蹤進度 hello**作業**頁面。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-110">Once a test failover is triggered, you can track progress in hello **Jobs** page.</span></span>  


## <a name="supported-scenarios"></a><span data-ttu-id="1fbc9-111">支援的案例</span><span class="sxs-lookup"><span data-stu-id="1fbc9-111">Supported scenarios</span></span>
<span data-ttu-id="1fbc9-112">除了支援所有的部署案例中測試容錯移轉[舊版 VMware 站台 tooAzure](site-recovery-vmware-to-azure-classic-legacy.md)。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-112">Test failover is supported in all deployment scenarios other than [legacy VMware site tooAzure](site-recovery-vmware-to-azure-classic-legacy.md).</span></span> <span data-ttu-id="1fbc9-113">虛擬機器已移轉 tooAzure 時，也不是支援測試容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-113">Test failover is also not supported when virtual machine has been failed over tooAzure.</span></span>  


## <a name="run-a-test-failover"></a><span data-ttu-id="1fbc9-114">執行測試容錯移轉</span><span class="sxs-lookup"><span data-stu-id="1fbc9-114">Run a test failover</span></span>
<span data-ttu-id="1fbc9-115">此程序描述如何 toorun 測試容錯移轉的復原計劃。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-115">This procedure describes how toorun a test failover for a recovery plan.</span></span> <span data-ttu-id="1fbc9-116">或者您也可以使用 hello 適當的選項，在其上執行測試容錯移轉的一部電腦。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-116">Alternatively you can also run test failover for a single machine by using hello appropriate option on it.</span></span>

![Test Failover](./media/site-recovery-test-failover-to-azure/TestFailover.png)


1. <span data-ttu-id="1fbc9-118">選取 [復原方案]  >  *recoveryplan_name*。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-118">Select **Recovery Plans** > *recoveryplan_name*.</span></span> <span data-ttu-id="1fbc9-119">按一下 [測試容錯移轉] 。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-119">Click **Test Failover**.</span></span>
1. <span data-ttu-id="1fbc9-120">選取**復原點**toofailover 至。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-120">Select a **Recovery Point** toofailover to.</span></span> <span data-ttu-id="1fbc9-121">您可以使用其中一個 hello 下列選項：</span><span class="sxs-lookup"><span data-stu-id="1fbc9-121">You can use one of hello following options:</span></span>
    1.  <span data-ttu-id="1fbc9-122">**最新版處理**: hello 復原計劃 toohello 最新復原點的站台復原服務已經處理的所有虛擬機器都容錯移轉這個選項。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-122">**Latest processed**: This option fails over all virtual machines of hello recovery plan toohello latest recovery point that has already been processed by Site Recovery service.</span></span> <span data-ttu-id="1fbc9-123">當您在進行測試容錯移轉的虛擬機器時，也會顯示 hello 最新的已處理的復原點的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-123">When you are doing test failover of a virtual machine, time stamp of hello latest processed recovery point is also shown.</span></span> <span data-ttu-id="1fbc9-124">如果您要復原計劃的容錯移轉，您可以移 tooindividual 虛擬機器，並查看**最新復原點**磚 tooget 這項資訊。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-124">If you are doing failover of a recovery plan, you can go tooindividual virtual machine and look at **Latest Recovery Points** tile tooget this information.</span></span> <span data-ttu-id="1fbc9-125">當沒有時間 tooprocess hello 未處理的資料時，此選項提供低 RTO （復原時間目標） 容錯移轉選項。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-125">As no time is spent tooprocess hello unprocessed data, this option provides a low RTO (Recovery Time Objective) failover option.</span></span>
    1.  <span data-ttu-id="1fbc9-126">**最新的應用程式一致**: hello 復原計劃 toohello 最新應用程式一致復原點的站台復原服務已經處理的所有虛擬機器都容錯移轉這個選項。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-126">**Latest app-consistent**: This option fails over all virtual machines of hello recovery plan toohello latest application consistent recovery point that has already been processed by Site Recovery service.</span></span> <span data-ttu-id="1fbc9-127">當您在進行測試容錯移轉的虛擬機器時，也會顯示 hello 最新的應用程式一致復原點的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-127">When you are doing test failover of a virtual machine, time stamp of hello latest app-consistent recovery point is also shown.</span></span> <span data-ttu-id="1fbc9-128">如果您要復原計劃的容錯移轉，您可以移 tooindividual 虛擬機器，並查看**最新復原點**磚 tooget 這項資訊。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-128">If you are doing failover of a recovery plan, you can go tooindividual virtual machine and look at **Latest Recovery Points** tile tooget this information.</span></span>
    1.  <span data-ttu-id="1fbc9-129">**最新**： 此選項會先處理所有 hello 資料它們容錯移轉 tooit 之前已傳送的 tooSite 復原服務 toocreate 每部虛擬機器的復原點。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-129">**Latest**: This option first processes all hello data that has been sent tooSite Recovery service toocreate a recovery point for each virtual machine before failing them over tooit.</span></span> <span data-ttu-id="1fbc9-130">此選項提供 hello 最低 RPO （復原點目標），為 hello 建立虛擬機器容錯移轉將會有所有的 hello 資料之後已觸發 hello 容錯移轉時，複寫 tooSite 復原服務。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-130">This option provides hello lowest RPO (Recovery Point Objective) as hello virtual machine created after failover will have all hello data that has been replicated tooSite Recovery service when hello failover was triggered.</span></span>
    1.  <span data-ttu-id="1fbc9-131">**已處理最近的多部虛擬機器**：此選項僅適用於至少一部虛擬機器已啟動多部虛擬機器一致性的復原計劃。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-131">**Latest multi-VM processed**: This option is only available for recovery plans that have at least one virtual machine with multi-VM consistency ON.</span></span> <span data-ttu-id="1fbc9-132">虛擬機器屬於複寫群組容錯移轉 toohello 最新通用多重 VM 一致性復原點。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-132">Virtual machines that are part of a replication group failover toohello latest common multi-VM consistent recovery point.</span></span> <span data-ttu-id="1fbc9-133">其他虛擬機器容錯移轉 tootheir 最近處理過的復原點。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-133">Other virtual machines failover tootheir latest processed recovery point.</span></span>  
    1.  <span data-ttu-id="1fbc9-134">**最近的多部虛擬機器應用程式一致**：此選項僅適用於至少一部虛擬機器已啟動多部虛擬機器一致性的復原計劃。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-134">**Latest multi-VM app-consistent**: This option is only available for recovery plans that have at least one virtual machine with multi-VM consistency ON.</span></span> <span data-ttu-id="1fbc9-135">虛擬機器屬於複寫群組容錯移轉 toohello 最新通用多部 VM 應用程式一致復原點。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-135">Virtual machines that are part of a replication group failover toohello latest common multi-VM application-consistent recovery point.</span></span> <span data-ttu-id="1fbc9-136">其他虛擬機器容錯移轉 tootheir 最新應用程式一致復原點。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-136">Other virtual machines failover tootheir latest application-consistent recovery point.</span></span> 
    1.  <span data-ttu-id="1fbc9-137">**自訂**： 如果您在進行測試容錯移轉的虛擬機器，則您可以使用此選項 toofailover tooa 特定的復原點。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-137">**Custom**: If you are doing test failover of a virtual machine, then you can use this option toofailover tooa particular recovery point.</span></span>
1. <span data-ttu-id="1fbc9-138">選取**Azure 虛擬網路**： 提供 Azure 虛擬網路會建立 hello 測試虛擬機器的位置。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-138">Select an **Azure virtual network**: Provide an Azure virtual network where hello test virtual machines would be created.</span></span> <span data-ttu-id="1fbc9-139">站台復原嘗試 toocreate 測試虛擬機器中相同名稱的子網路，以及使用 hello 與中提供的相同 IP**計算與網路**hello 虛擬機器的設定。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-139">Site Recovery attempts toocreate test virtual machines in a subnet of same name and using hello same IP as that provided in **Compute and Network** settings of hello virtual machine.</span></span> <span data-ttu-id="1fbc9-140">如果相同名稱的子網路不是 hello 為測試容錯移轉時，所提供的 Azure 虛擬網路中可用的則依字母順序建立 hello 第一個子網路中測試虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-140">If subnet of same name is not available in hello Azure virtual network provided for test failover, then test virtual machine is created in hello first subnet alphabetically.</span></span> <span data-ttu-id="1fbc9-141">如果 hello 子網路中沒有相同的 IP，虛擬機器取得另一個 hello 子網路中可用的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-141">If same IP is not available in hello subnet, then virtual machine gets another IP address available in hello subnet.</span></span> <span data-ttu-id="1fbc9-142">請參閱此節以[瞭解更多詳細資訊](#creating-a-network-for-test-failover)</span><span class="sxs-lookup"><span data-stu-id="1fbc9-142">Read this section for [more details](#creating-a-network-for-test-failover)</span></span>
1. <span data-ttu-id="1fbc9-143">如果您要容錯移轉 tooAzure 和啟用的資料加密，請在**加密金鑰**選取 hello 時啟用資料加密提供者安裝期間發出的憑證。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-143">If you're failing over tooAzure and data encryption is enabled, in **Encryption Key** select hello certificate that was issued when you enabled data encryption during Provider installation.</span></span> <span data-ttu-id="1fbc9-144">如果您尚未啟用 hello 虛擬機器上的加密，您可以忽略這個步驟。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-144">You can ignore this step if you have not enabled encryption on hello virtual machine.</span></span>
1. <span data-ttu-id="1fbc9-145">Hello 上追蹤容錯移轉的進度**作業** 索引標籤。您應該能夠 toosee hello 測試複本機器 hello Azure 入口網站中。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-145">Track failover progress on hello **Jobs** tab. You should be able toosee hello test replica machine in hello Azure portal.</span></span>
1. <span data-ttu-id="1fbc9-146">tooinitiate hello 虛擬機器的 RDP 連線，您將需要太[新增公用 ip](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) hello hello 的網路介面無法容錯移轉虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-146">tooinitiate an RDP connection on hello virtual machine, you will need too[add a public ip](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) on hello network interface of hello failed over virtual machine.</span></span> <span data-ttu-id="1fbc9-147">如果您容錯移轉 tooa 傳統虛擬機器，則您需要[將端點加入](../virtual-machines/windows/classic/setup-endpoints.md)上連接埠 3389</span><span class="sxs-lookup"><span data-stu-id="1fbc9-147">If you are failing over tooa Classic virtual machine, then you need too[add an endpoint](../virtual-machines/windows/classic/setup-endpoints.md) on port 3389</span></span>
1. <span data-ttu-id="1fbc9-148">一旦您完成時，按一下 **清除測試容錯移轉**hello 復原計劃。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-148">Once you're done, click **Cleanup test failover** on hello recovery plan.</span></span> <span data-ttu-id="1fbc9-149">在**備忘稿**記錄及儲存與 hello 測試容錯移轉相關聯的任何觀察。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-149">In **Notes** record and save any observations associated with hello test failover.</span></span> <span data-ttu-id="1fbc9-150">這會刪除 hello 測試容錯移轉期間所建立的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-150">This deletes hello virtual machines that were created during test failover.</span></span>


> [!TIP]
> <span data-ttu-id="1fbc9-151">站台復原嘗試 toocreate 測試虛擬機器中相同名稱的子網路，以及使用 hello 與中提供的相同 IP**計算與網路**hello 虛擬機器的設定。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-151">Site Recovery attempts toocreate test virtual machines in a subnet of same name and using hello same IP as that provided in **Compute and Network** settings of hello virtual machine.</span></span> <span data-ttu-id="1fbc9-152">如果相同名稱的子網路不是 hello 為測試容錯移轉時，所提供的 Azure 虛擬網路中可用的則依字母順序建立 hello 第一個子網路中測試虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-152">If subnet of same name is not available in hello Azure virtual network provided for test failover, then test virtual machine is created in hello first subnet alphabetically.</span></span> <span data-ttu-id="1fbc9-153">Hello 目標 IP 是 hello 選擇子網路的一部分，如果站台復原會嘗試 toocreate hello 測試容錯移轉虛擬機器使用 hello 目標 IP。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-153">If hello target IP is part of hello chosen subnet, then site recovery tries toocreate hello test failover virtual machine using hello target IP.</span></span> <span data-ttu-id="1fbc9-154">如果 hello 目標 IP 不屬於 hello 選擇子網路測試容錯移轉虛擬機器會建立在 hello 選擇子網路中使用任何可用的 IP。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-154">If hello target IP is not part of hello chosen subnet then test failover virtual machine gets created using any available IP in hello chosen subnet.</span></span>
>
>

## <a name="test-failover-job"></a><span data-ttu-id="1fbc9-155">測試容錯移轉作業</span><span class="sxs-lookup"><span data-stu-id="1fbc9-155">Test failover job</span></span>

![Test Failover](./media/site-recovery-test-failover-to-azure/TestFailoverJob.png)

<span data-ttu-id="1fbc9-157">觸發測試容錯移轉時會執行下列步驟︰</span><span class="sxs-lookup"><span data-stu-id="1fbc9-157">When a test failover is triggered, it involves following steps:</span></span>

1. <span data-ttu-id="1fbc9-158">先決條件檢查︰這個步驟可確保符合容錯移轉所需的所有條件</span><span class="sxs-lookup"><span data-stu-id="1fbc9-158">Prerequisites check: This step ensures that all conditions required for failover are met</span></span>
1. <span data-ttu-id="1fbc9-159">容錯移轉： 此步驟中處理 hello 資料，並讓它準備好，以便可以建立 Azure 虛擬機器，不使用。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-159">Failover: This step processes hello data and makes it ready so that an Azure virtual machine can be created out of it.</span></span> <span data-ttu-id="1fbc9-160">如果您已選擇**最新**復原點，此步驟中建立的復原點從 toohello 服務已傳送的 hello 資料。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-160">If you have chosen **Latest** recovery point, this step creates a recovery point from hello data that has been sent toohello service.</span></span>
1. <span data-ttu-id="1fbc9-161">開始： 此步驟中建立 Azure 虛擬機器使用 hello hello 上一個步驟中處理的資料。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-161">Start: This step creates an Azure virtual machine using hello data processed in hello previous step.</span></span>

## <a name="time-taken-for-failover"></a><span data-ttu-id="1fbc9-162">容錯移轉所花費的時間</span><span class="sxs-lookup"><span data-stu-id="1fbc9-162">Time taken for failover</span></span>

<span data-ttu-id="1fbc9-163">在某些情況下，虛擬機器的容錯移轉需要其他中繼步驟的程序通常需要約 8 too10 分鐘 toocomplete。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-163">In certain cases, failover of virtual machines requires an extra intermediate step that usually takes around 8  too10 minutes toocomplete.</span></span> <span data-ttu-id="1fbc9-164">這些情況如下所示︰</span><span class="sxs-lookup"><span data-stu-id="1fbc9-164">These cases are as following:</span></span>

* <span data-ttu-id="1fbc9-165">VMware 虛擬機器使用的 hello 9.8 比舊的行動服務版本</span><span class="sxs-lookup"><span data-stu-id="1fbc9-165">VMware virtual machines using a version of hello Mobility service older than 9.8</span></span>
* <span data-ttu-id="1fbc9-166">實體伺服器</span><span class="sxs-lookup"><span data-stu-id="1fbc9-166">Physical servers</span></span>
* <span data-ttu-id="1fbc9-167">VMware Linux 虛擬機器</span><span class="sxs-lookup"><span data-stu-id="1fbc9-167">VMware Linux virtual machines</span></span>
* <span data-ttu-id="1fbc9-168">如同實體伺服器般受到保護的 Hyper-V 虛擬機器</span><span class="sxs-lookup"><span data-stu-id="1fbc9-168">Hyper-V virtual machines protected as physical servers</span></span>
* <span data-ttu-id="1fbc9-169">沒有以下驅動程式作為開機驅動程式的 VMware 虛擬機器</span><span class="sxs-lookup"><span data-stu-id="1fbc9-169">VMware virtual machines where following drivers are not present as boot drivers</span></span>
    * <span data-ttu-id="1fbc9-170">storvsc</span><span class="sxs-lookup"><span data-stu-id="1fbc9-170">storvsc</span></span>
    * <span data-ttu-id="1fbc9-171">vmbus</span><span class="sxs-lookup"><span data-stu-id="1fbc9-171">vmbus</span></span>
    * <span data-ttu-id="1fbc9-172">storflt</span><span class="sxs-lookup"><span data-stu-id="1fbc9-172">storflt</span></span>
    * <span data-ttu-id="1fbc9-173">intelide</span><span class="sxs-lookup"><span data-stu-id="1fbc9-173">intelide</span></span>
    * <span data-ttu-id="1fbc9-174">atapi</span><span class="sxs-lookup"><span data-stu-id="1fbc9-174">atapi</span></span>
* <span data-ttu-id="1fbc9-175">沒有啟用 DHCP 服務的 VMware 虛擬機器，無論其是否正在使用 DHCP 或靜態 IP 位址</span><span class="sxs-lookup"><span data-stu-id="1fbc9-175">VMware virtual machines that don't have DHCP service enabled irrespective of whether they are using DHCP or static IP addresses</span></span>

<span data-ttu-id="1fbc9-176">在所有 hello 其他情況下此中繼步驟並不需要與 hello hello 容錯移轉所花費的時間會顯著降低。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-176">In all hello other cases this intermediate step is not required and hello time taken for hello failover is significantly lower.</span></span>


## <a name="creating-a-network-for-test-failover"></a><span data-ttu-id="1fbc9-177">建立測試容錯移轉的網路</span><span class="sxs-lookup"><span data-stu-id="1fbc9-177">Creating a network for test failover</span></span>
<span data-ttu-id="1fbc9-178">建議當您在進行測試容錯移轉，您會選擇與您在中提供您生產復原站台的網路隔離的網路**計算與網路**hello 虛擬機器的設定。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-178">It is recommended that when you are doing a test failover you choose a network that is isolated from your production recovery site network that you provided in **Compute and Network** settings for hello virtual machine.</span></span> <span data-ttu-id="1fbc9-179">根據預設，當您建立 Azure 虛擬網路時，它會與其他網路隔離。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-179">By default when you create an Azure virtual network, it is isolated from other networks.</span></span> <span data-ttu-id="1fbc9-180">此網路應模擬您的實際執行網路︰</span><span class="sxs-lookup"><span data-stu-id="1fbc9-180">This network should mimic your production network:</span></span>

1. <span data-ttu-id="1fbc9-181">測試網路應有相同數目的子網路與生產網路中，並以您的生產網路中的 hello 子網路的名稱相同的 hello。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-181">Test network should have same number of subnets as that in your production network and with hello same name as those of hello subnets in your production network.</span></span>
1. <span data-ttu-id="1fbc9-182">測試網路應該使用 hello 與生產網路的相同的 IP 範圍。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-182">Test network should use hello same IP range as that of your production network.</span></span>
1. <span data-ttu-id="1fbc9-183">更新 hello hello hello 作為目標 IP hello DNS 虛擬機器在您所提供的 IP 為測試網路的 DNS**計算與網路**設定。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-183">Update hello DNS of hello Test Network as hello IP that you gave as target IP for hello DNS virtual machine under **Compute and Network** settings.</span></span> <span data-ttu-id="1fbc9-184">如需詳細資訊，請參閱 [Active Directory 測試容錯移轉考量](site-recovery-active-directory.md#test-failover-considerations) 一節。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-184">Go through [test failover considerations for active directory](site-recovery-active-directory.md#test-failover-considerations) section for more details.</span></span>


## <a name="test-failover-tooa-production-network-on-recovery-site"></a><span data-ttu-id="1fbc9-185">測試容錯移轉 tooa 復原站台上的實際執行網路</span><span class="sxs-lookup"><span data-stu-id="1fbc9-185">Test failover tooa production network on recovery site</span></span>
<span data-ttu-id="1fbc9-186">建議當您在進行測試容錯移轉，您會選擇不同於您在中提供您生產復原站台網路的網路**計算與網路**hello 虛擬機器的設定。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-186">It is recommended that when you are doing a test failover you choose a network that is different from your production recovery site network that you provided in **Compute and Network** settings for hello virtual machine.</span></span> <span data-ttu-id="1fbc9-187">如果您真的想 toovalidate 結束 tooend 中失敗的網路連線，但容錯移轉虛擬機器，請注意下列點 hello:</span><span class="sxs-lookup"><span data-stu-id="1fbc9-187">But if you really want toovalidate end tooend network connectivity in a failed over virtual machine, note hello following points:</span></span>

1. <span data-ttu-id="1fbc9-188">請確定該 hello 主要虛擬機器已關閉，當您在進行 hello 測試容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-188">Make sure that hello primary virtual machine is shutdown when you are doing hello test failover.</span></span> <span data-ttu-id="1fbc9-189">如果您不要這樣做，將會以 hello 的兩部虛擬機器相同網路在 hello hello 中執行的相同身分識別相同的時間，可能會導致 tooundesired 後果。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-189">If you don't do so, there will be two virtual machines with hello same identity running in hello same network at hello same time and that can lead tooundesired consequences.</span></span>
1. <span data-ttu-id="1fbc9-190">Hello 測試容錯移轉虛擬機器進行任何變更將會遺失時您清除 hello 測試容錯移轉虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-190">Any changes that you make into hello test failover virtual machines would be lost when you cleanup hello test failover virtual machines.</span></span> <span data-ttu-id="1fbc9-191">這些變更將不會複寫後 toohello 主要虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-191">These changes will not be replicated back toohello primary virtual machine.</span></span>
1. <span data-ttu-id="1fbc9-192">這種方式，測試的實際執行應用程式的潛在客戶 tooa 停機時間。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-192">This way of doing testing leads tooa downtime of your production application.</span></span> <span data-ttu-id="1fbc9-193">Hello 應用程式的使用者應該 toonot 使用 hello 應用程式時 hello DR 向下切入正在進行中會被要求。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-193">Users of hello application should be asked toonot use hello application when hello DR drill is in progress.</span></span>  



## <a name="prepare-active-directory-and-dns"></a><span data-ttu-id="1fbc9-194">準備 Active Directory 和 DNS</span><span class="sxs-lookup"><span data-stu-id="1fbc9-194">Prepare Active Directory and DNS</span></span>
<span data-ttu-id="1fbc9-195">toorun 應用程式測試的測試容錯移轉，您會需要 hello 生產 Active Directory 環境的複本在您的測試環境中。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-195">toorun a test failover for application testing, you need a copy of hello production Active Directory environment in your test environment.</span></span> <span data-ttu-id="1fbc9-196">如需詳細資訊，請參閱 [Active Directory 測試容錯移轉考量](site-recovery-active-directory.md#test-failover-considerations) 一節。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-196">Go through [test failover considerations for active directory](site-recovery-active-directory.md#test-failover-considerations) section for more details.</span></span>

## <a name="prepare-tooconnect-tooazure-vms-after-failover"></a><span data-ttu-id="1fbc9-197">準備容錯移轉之後 tooconnect tooAzure Vm</span><span class="sxs-lookup"><span data-stu-id="1fbc9-197">Prepare tooconnect tooAzure VMs after failover</span></span>

<span data-ttu-id="1fbc9-198">如果您想 tooconnect tooAzure Vm 使用 RDP 容錯移轉之後，請確定您執行 hello hello 表中摘要說明的動作。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-198">If you want tooconnect tooAzure VMs using RDP after failover, make sure you do hello actions summarized in hello table.</span></span>

<span data-ttu-id="1fbc9-199">**容錯移轉**</span><span class="sxs-lookup"><span data-stu-id="1fbc9-199">**Failover**</span></span> | <span data-ttu-id="1fbc9-200">**位置**</span><span class="sxs-lookup"><span data-stu-id="1fbc9-200">**Location**</span></span> | <span data-ttu-id="1fbc9-201">**動作**</span><span class="sxs-lookup"><span data-stu-id="1fbc9-201">**Actions**</span></span>
--- | --- | ---
<span data-ttu-id="1fbc9-202">**執行 Windows 的 Azure VM**</span><span class="sxs-lookup"><span data-stu-id="1fbc9-202">**Azure VM running Windows**</span></span> | <span data-ttu-id="1fbc9-203">在容錯移轉前的內部部署機器上</span><span class="sxs-lookup"><span data-stu-id="1fbc9-203">On on-premises machine before failover</span></span> | <span data-ttu-id="1fbc9-204">tooaccess hello Azure VM 上 hello 網際網路、 啟用 RDP，請確定的 TCP 和 UDP 規則會加入 hello**公用**，並允許 RDP **Windows 防火牆** > **允許應用程式**，針對所有設定檔。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-204">tooaccess hello Azure VM over hello internet, enable RDP, make sure TCP, and UDP rules are added for hello **Public**, and that RDP is allowed in **Windows Firewall** > **Allowed Apps**, for all profiles.</span></span><br/><br/> <span data-ttu-id="1fbc9-205">透過站對站連線，tooaccess hello 機器上啟用 RDP，並確定 hello 中允許的 RDP **Windows 防火牆** -> **允許應用程式和功能**如**網域和私人**網路。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-205">tooaccess over a site-to-site connection, enable RDP on hello machine, and ensure that RDP is allowed in hello **Windows Firewall** -> **Allowed apps and features** for **Domain and Private** networks.</span></span><br/><br/>  <span data-ttu-id="1fbc9-206">請確定 hello 作業系統的 SAN 原則設定太**OnlineAll**。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-206">Make sure hello operating system's SAN policy is set too**OnlineAll**.</span></span> <span data-ttu-id="1fbc9-207">[深入了解](https://support.microsoft.com/kb/3031135)。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-207">[Learn more](https://support.microsoft.com/kb/3031135).</span></span><br/><br/> <span data-ttu-id="1fbc9-208">請確定沒有任何 Windows 更新擱置中的 hello 虛擬機器上時觸發容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-208">Make sure there are no Windows updates pending on hello virtual machine when you trigger a failover.</span></span> <span data-ttu-id="1fbc9-209">容錯移轉，您就可以 toologin toohello 虛擬機器 hello 更新作業完成之前，可能會啟動 Windows update。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-209">Windows update might start when you failover and you will not be able toologin toohello virtual machine until hello update completes.</span></span> <br/><br/>
<span data-ttu-id="1fbc9-210">**執行 Windows 的 Azure VM**</span><span class="sxs-lookup"><span data-stu-id="1fbc9-210">**Azure VM running Windows**</span></span> | <span data-ttu-id="1fbc9-211">在容錯移轉後的 Azure VM 上</span><span class="sxs-lookup"><span data-stu-id="1fbc9-211">On Azure VM after failover</span></span> | <span data-ttu-id="1fbc9-212">傳統的虛擬機器，[加入公用端點](../virtual-machines/windows/classic/setup-endpoints.md)hello RDP 通訊協定 （連接埠 3389）</span><span class="sxs-lookup"><span data-stu-id="1fbc9-212">For a classic virtual machine, [add a public endpoint](../virtual-machines/windows/classic/setup-endpoints.md) for hello RDP protocol (port 3389)</span></span><br/><br/>  <span data-ttu-id="1fbc9-213">若是在 Resource Manager 虛擬機器上，請[新增公用 IP](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine)。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-213">For a Resource Manager virtual machine, [add a public IP](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) on it.</span></span><br/><br/> <span data-ttu-id="1fbc9-214">hello 網路安全性群組規則上 hello 容錯移轉 VM，而且 hello 它所連接的 Azure 子網路 toowhich 需要 tooallow 連入連線 toohello RDP 連接埠。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-214">hello network security group rules on hello failed over VM, and hello Azure subnet toowhich it is connected, need tooallow incoming connections toohello RDP port.</span></span><br/><br/> <span data-ttu-id="1fbc9-215">資源管理員虛擬機器，您可以檢查**開機診斷**toolook 在 hello 虛擬機器的螢幕擷取畫面</span><span class="sxs-lookup"><span data-stu-id="1fbc9-215">For a Resource Manager virtual machine, you can check **Boot diagnostics** toolook at a screenshot of hello virtual machine</span></span><br/><br/> <span data-ttu-id="1fbc9-216">如果您無法連接，請檢查該 VM 正在執行中的 hello，然後查看這些[疑難排解提示](http://social.technet.microsoft.com/wiki/contents/articles/31666.troubleshooting-remote-desktop-connection-after-failover-using-asr.aspx)。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-216">If you can't connect, check that hello VM is running and then look at these [troubleshooting tips](http://social.technet.microsoft.com/wiki/contents/articles/31666.troubleshooting-remote-desktop-connection-after-failover-using-asr.aspx).</span></span><br/><br/>
<span data-ttu-id="1fbc9-217">**執行 Linux 的 Azure VM**</span><span class="sxs-lookup"><span data-stu-id="1fbc9-217">**Azure VM running Linux**</span></span> | <span data-ttu-id="1fbc9-218">在容錯移轉前的內部部署機器上</span><span class="sxs-lookup"><span data-stu-id="1fbc9-218">On on-premises machine before failover</span></span> | <span data-ttu-id="1fbc9-219">請確定該 hello hello Azure VM 上的 Secure Shell 服務會自動設定 toostart，在系統開機。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-219">Ensure that hello Secure Shell service on hello Azure VM is set toostart automatically on system boot.</span></span><br/><br/> <span data-ttu-id="1fbc9-220">請檢查防火牆規則允許 SSH 連線 tooit。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-220">Check that firewall rules allow an SSH connection tooit.</span></span>
<span data-ttu-id="1fbc9-221">**執行 Linux 的 Azure VM**</span><span class="sxs-lookup"><span data-stu-id="1fbc9-221">**Azure VM running Linux**</span></span> | <span data-ttu-id="1fbc9-222">容錯移轉後的 Azure VM</span><span class="sxs-lookup"><span data-stu-id="1fbc9-222">Azure VM after failover</span></span> | <span data-ttu-id="1fbc9-223">hello 網路安全性群組規則上 hello 容錯移轉 VM，而且 hello 它所連接的 Azure 子網路 toowhich 需要 tooallow 連入連線 toohello SSH 連接埠。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-223">hello network security group rules on hello failed over VM, and hello Azure subnet toowhich it is connected, need tooallow incoming connections toohello SSH port.</span></span><br/><br/> <span data-ttu-id="1fbc9-224">傳統的虛擬機器，[加入公用端點](../virtual-machines/windows/classic/setup-endpoints.md)應該建立，tooallow hello SSH 連接埠 （TCP 連接埠 22 依預設） 上的連入連線。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-224">For  a classic virtual machine, [add a public endpoint](../virtual-machines/windows/classic/setup-endpoints.md) should be created, tooallow incoming connections on hello SSH port (TCP port 22 by default).</span></span><br/><br/> <span data-ttu-id="1fbc9-225">若是在 Resource Manager 虛擬機器上，請[新增公用 IP](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine)。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-225">For a Resource Manager virtual machine, [add a public IP](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) on it.</span></span><br/><br/> <span data-ttu-id="1fbc9-226">資源管理員虛擬機器，您可以檢查**開機診斷**toolook 在 hello 虛擬機器的螢幕擷取畫面</span><span class="sxs-lookup"><span data-stu-id="1fbc9-226">For a Resource Manager virtual machine, you can check **Boot diagnostics** toolook at a screenshot of hello virtual machine</span></span><br/><br/>



## <a name="next-steps"></a><span data-ttu-id="1fbc9-227">後續步驟</span><span class="sxs-lookup"><span data-stu-id="1fbc9-227">Next steps</span></span>
<span data-ttu-id="1fbc9-228">一旦您成功嘗試測試容錯移轉之後，您就可以嘗試執行[容錯移轉](site-recovery-failover.md)。</span><span class="sxs-lookup"><span data-stu-id="1fbc9-228">Once you have successfully tried a test failover you can try doing a [failover](site-recovery-failover.md).</span></span>
