---
title: "在 Site Recovery 中測試容錯移轉到 Azure | Microsoft Docs"
description: "了解執行從內部部署到 Azure 的測試容錯移轉"
services: site-recovery
documentationcenter: 
author: prateek9us
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 07/04/2017
ms.author: pratshar
ms.openlocfilehash: 54f62af6abcdd38254fd5379b95baa05656dc90b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="test--failover-to-azure-in-site-recovery"></a><span data-ttu-id="c66d7-103">在 Site Recovery 中測試容錯移轉到 Azure</span><span class="sxs-lookup"><span data-stu-id="c66d7-103">Test  Failover to Azure in Site Recovery</span></span>



<span data-ttu-id="c66d7-104">本文提供使用 Azure 做為復原站台，對使用 Site Recovery 保護的虛擬機器與實體伺服器執行測試容錯移轉或 DR (災害復原) 訓練的相關資訊和指示。</span><span class="sxs-lookup"><span data-stu-id="c66d7-104">This article provides information and instructions for doing a test failover or a DR drill of virtual machines and physical servers that are protected with Site Recovery using Azure as the recovery site.</span></span>

<span data-ttu-id="c66d7-105">在這篇文章下方或 [Azure Recovery Services Forum (Azure 復原服務論壇)](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr)中張貼意見或問題。</span><span class="sxs-lookup"><span data-stu-id="c66d7-105">Post any comments or questions at the bottom of this article, or on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

<span data-ttu-id="c66d7-106">執行測試容錯移轉可驗證您的複寫策略，或在沒有資料遺失或停機時間的情況下執行災害復原訓練。</span><span class="sxs-lookup"><span data-stu-id="c66d7-106">Test failover is run to validate your replication strategy or perform a disaster recovery drill without any data loss or downtime.</span></span> <span data-ttu-id="c66d7-107">執行測試容錯移轉不會影響任何正在進行的複寫或生產環境。</span><span class="sxs-lookup"><span data-stu-id="c66d7-107">Doing a test failover doesn't have any impact on the ongoing replication or on your production environment.</span></span> <span data-ttu-id="c66d7-108">測試容錯移轉可在虛擬機器或[復原計劃](site-recovery-create-recovery-plans.md)上執行。</span><span class="sxs-lookup"><span data-stu-id="c66d7-108">Test failover can be done either on a virtual machine or a [recovery plan](site-recovery-create-recovery-plans.md).</span></span> <span data-ttu-id="c66d7-109">觸發測試容錯移轉時，您必須指定測試虛擬機器會連線的網路。</span><span class="sxs-lookup"><span data-stu-id="c66d7-109">When triggering a test failover, you need to specify the network to which test virtual machines would connect to.</span></span> <span data-ttu-id="c66d7-110">一旦觸發測試容錯移轉，您可以在 [作業] 頁面追蹤進度。</span><span class="sxs-lookup"><span data-stu-id="c66d7-110">Once a test failover is triggered, you can track progress in the **Jobs** page.</span></span>  


## <a name="supported-scenarios"></a><span data-ttu-id="c66d7-111">支援的案例</span><span class="sxs-lookup"><span data-stu-id="c66d7-111">Supported scenarios</span></span>
<span data-ttu-id="c66d7-112">除了[從舊版 VMware 站台到 Azure](site-recovery-vmware-to-azure-classic-legacy.md) 以外的部署案例，都支援測試容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="c66d7-112">Test failover is supported in all deployment scenarios other than [legacy VMware site to Azure](site-recovery-vmware-to-azure-classic-legacy.md).</span></span> <span data-ttu-id="c66d7-113">當虛擬機器已容錯移轉至 Azure 時也不支援測試容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="c66d7-113">Test failover is also not supported when virtual machine has been failed over to Azure.</span></span>  


## <a name="run-a-test-failover"></a><span data-ttu-id="c66d7-114">執行測試容錯移轉</span><span class="sxs-lookup"><span data-stu-id="c66d7-114">Run a test failover</span></span>
<span data-ttu-id="c66d7-115">此程序說明如何針對復原方案執行測試容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="c66d7-115">This procedure describes how to run a test failover for a recovery plan.</span></span> <span data-ttu-id="c66d7-116">或者，您也可以在單一機器上使用適當的選項來對其執行測試容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="c66d7-116">Alternatively you can also run test failover for a single machine by using the appropriate option on it.</span></span>

![Test Failover](./media/site-recovery-test-failover-to-azure/TestFailover.png)


1. <span data-ttu-id="c66d7-118">選取 [復原方案]  >  *recoveryplan_name*。</span><span class="sxs-lookup"><span data-stu-id="c66d7-118">Select **Recovery Plans** > *recoveryplan_name*.</span></span> <span data-ttu-id="c66d7-119">按一下 [測試容錯移轉] 。</span><span class="sxs-lookup"><span data-stu-id="c66d7-119">Click **Test Failover**.</span></span>
1. <span data-ttu-id="c66d7-120">選取要容錯移轉到的**復原點**。</span><span class="sxs-lookup"><span data-stu-id="c66d7-120">Select a **Recovery Point** to failover to.</span></span> <span data-ttu-id="c66d7-121">您可以使用下列其中一個選項：</span><span class="sxs-lookup"><span data-stu-id="c66d7-121">You can use one of the following options:</span></span>
    1.  <span data-ttu-id="c66d7-122">**最新處理**︰這個選項會將復原方案的所有虛擬機器容錯移轉至 Site Recovery 服務已處理的最新復原點。</span><span class="sxs-lookup"><span data-stu-id="c66d7-122">**Latest processed**: This option fails over all virtual machines of the recovery plan to the latest recovery point that has already been processed by Site Recovery service.</span></span> <span data-ttu-id="c66d7-123">當您進行虛擬機器的測試容錯移轉時，也會顯示最新處理復原點的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="c66d7-123">When you are doing test failover of a virtual machine, time stamp of the latest processed recovery point is also shown.</span></span> <span data-ttu-id="c66d7-124">如果您正在執行某個復原方案的容錯移轉，您可以移至個別的虛擬機器，並查看 [最新復原點] 圖格以取得此資訊。</span><span class="sxs-lookup"><span data-stu-id="c66d7-124">If you are doing failover of a recovery plan, you can go to individual virtual machine and look at **Latest Recovery Points** tile to get this information.</span></span> <span data-ttu-id="c66d7-125">因為沒有花時間處理未處理的資料，此選項提供低 RTO (復原時間目標) 容錯移轉選項。</span><span class="sxs-lookup"><span data-stu-id="c66d7-125">As no time is spent to process the unprocessed data, this option provides a low RTO (Recovery Time Objective) failover option.</span></span>
    1.  <span data-ttu-id="c66d7-126">**最新的應用程式一致**︰這個選項會將復原方案的所有虛擬機器容錯移轉至 Site Recovery 服務已處理的最新應用程式一致復原點。</span><span class="sxs-lookup"><span data-stu-id="c66d7-126">**Latest app-consistent**: This option fails over all virtual machines of the recovery plan to the latest application consistent recovery point that has already been processed by Site Recovery service.</span></span> <span data-ttu-id="c66d7-127">當您進行虛擬機器的測試容錯移轉時，也會顯示最新應用程式一致復原點的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="c66d7-127">When you are doing test failover of a virtual machine, time stamp of the latest app-consistent recovery point is also shown.</span></span> <span data-ttu-id="c66d7-128">如果您正在執行某個復原方案的容錯移轉，您可以移至個別的虛擬機器，並查看 [最新復原點] 圖格以取得此資訊。</span><span class="sxs-lookup"><span data-stu-id="c66d7-128">If you are doing failover of a recovery plan, you can go to individual virtual machine and look at **Latest Recovery Points** tile to get this information.</span></span>
    1.  <span data-ttu-id="c66d7-129">**最新**︰此選項會先處理已傳送到 Site Recovery 服務的所有資料，先為每個虛擬機器建立復原點後再進行容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="c66d7-129">**Latest**: This option first processes all the data that has been sent to Site Recovery service to create a recovery point for each virtual machine before failing them over to it.</span></span> <span data-ttu-id="c66d7-130">此選項提供最低的 RPO (復原點目標)，因為在容錯移轉後建立的虛擬機器會包含觸發容錯移轉時已複寫到 Site Recovery 服務的所有資料。</span><span class="sxs-lookup"><span data-stu-id="c66d7-130">This option provides the lowest RPO (Recovery Point Objective) as the virtual machine created after failover will have all the data that has been replicated to Site Recovery service when the failover was triggered.</span></span>
    1.  <span data-ttu-id="c66d7-131">**已處理最近的多部虛擬機器**：此選項僅適用於至少一部虛擬機器已啟動多部虛擬機器一致性的復原計劃。</span><span class="sxs-lookup"><span data-stu-id="c66d7-131">**Latest multi-VM processed**: This option is only available for recovery plans that have at least one virtual machine with multi-VM consistency ON.</span></span> <span data-ttu-id="c66d7-132">屬於最近一般多部虛擬機器一致復原點的複寫群組容錯移轉一部份的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="c66d7-132">Virtual machines that are part of a replication group failover to the latest common multi-VM consistent recovery point.</span></span> <span data-ttu-id="c66d7-133">對於最近處理的復原點進行的其他虛擬機器容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="c66d7-133">Other virtual machines failover to their latest processed recovery point.</span></span>  
    1.  <span data-ttu-id="c66d7-134">**最近的多部虛擬機器應用程式一致**：此選項僅適用於至少一部虛擬機器已啟動多部虛擬機器一致性的復原計劃。</span><span class="sxs-lookup"><span data-stu-id="c66d7-134">**Latest multi-VM app-consistent**: This option is only available for recovery plans that have at least one virtual machine with multi-VM consistency ON.</span></span> <span data-ttu-id="c66d7-135">屬於最近一般多部虛擬機器應用程式一致復原點的複寫群組容錯移轉一部份的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="c66d7-135">Virtual machines that are part of a replication group failover to the latest common multi-VM application-consistent recovery point.</span></span> <span data-ttu-id="c66d7-136">對於最近的應用程式一致復原點進行的其他虛擬機器容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="c66d7-136">Other virtual machines failover to their latest application-consistent recovery point.</span></span> 
    1.  <span data-ttu-id="c66d7-137">**自訂**︰如果您要執行虛擬機器的測試容錯移轉，您可以使用此選項以容錯移轉至特定復原點。</span><span class="sxs-lookup"><span data-stu-id="c66d7-137">**Custom**: If you are doing test failover of a virtual machine, then you can use this option to failover to a particular recovery point.</span></span>
1. <span data-ttu-id="c66d7-138">選取一個 **Azure 虛擬網路**︰提供一個 Azure 虛擬網路，測試虛擬機器會建立於該處。</span><span class="sxs-lookup"><span data-stu-id="c66d7-138">Select an **Azure virtual network**: Provide an Azure virtual network where the test virtual machines would be created.</span></span> <span data-ttu-id="c66d7-139">Site Recovery 會嘗試在名稱相同的子網路中建立測試虛擬機器，並使用虛擬機器的 [計算與網路] 設定中提供的 IP。</span><span class="sxs-lookup"><span data-stu-id="c66d7-139">Site Recovery attempts to create test virtual machines in a subnet of same name and using the same IP as that provided in **Compute and Network** settings of the virtual machine.</span></span> <span data-ttu-id="c66d7-140">如果針對測試容錯移轉提供的 Azure 虛擬網路中沒有名稱相同的子網路，則會在依字母順序的第一個子網路中建立測試虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="c66d7-140">If subnet of same name is not available in the Azure virtual network provided for test failover, then test virtual machine is created in the first subnet alphabetically.</span></span> <span data-ttu-id="c66d7-141">如果子網路中沒有相同的 IP，虛擬機器會取得子網路中另一個可用的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="c66d7-141">If same IP is not available in the subnet, then virtual machine gets another IP address available in the subnet.</span></span> <span data-ttu-id="c66d7-142">請參閱此節以[瞭解更多詳細資訊](#creating-a-network-for-test-failover)</span><span class="sxs-lookup"><span data-stu-id="c66d7-142">Read this section for [more details](#creating-a-network-for-test-failover)</span></span>
1. <span data-ttu-id="c66d7-143">如果您正在容錯移轉到 Azure 且已啟用資料加密，請在 [加密金鑰] 中，選取當您在提供者安裝期間啟用資料加密時所發出的憑證。</span><span class="sxs-lookup"><span data-stu-id="c66d7-143">If you're failing over to Azure and data encryption is enabled, in **Encryption Key** select the certificate that was issued when you enabled data encryption during Provider installation.</span></span> <span data-ttu-id="c66d7-144">如果您尚未在虛擬機器上啟用加密，您可以忽略此步驟。</span><span class="sxs-lookup"><span data-stu-id="c66d7-144">You can ignore this step if you have not enabled encryption on the virtual machine.</span></span>
1. <span data-ttu-id="c66d7-145">在 [工作]  索引標籤上追蹤容錯移轉進度。</span><span class="sxs-lookup"><span data-stu-id="c66d7-145">Track failover progress on the **Jobs** tab.</span></span> <span data-ttu-id="c66d7-146">您應該可以在 Azure 入口網站中看到測試複本機器。</span><span class="sxs-lookup"><span data-stu-id="c66d7-146">You should be able to see the test replica machine in the Azure portal.</span></span>
1. <span data-ttu-id="c66d7-147">若要在虛擬機器上初始化 RDP 連線，您必須在容錯移轉的虛擬機器的網路介面上[新增公用 IP](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine)。</span><span class="sxs-lookup"><span data-stu-id="c66d7-147">To initiate an RDP connection on the virtual machine, you will need to [add a public ip](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) on the network interface of the failed over virtual machine.</span></span> <span data-ttu-id="c66d7-148">如果您要容錯移轉到傳統虛擬機器，您必須在連接埠 3389 上[新增端點](../virtual-machines/windows/classic/setup-endpoints.md)</span><span class="sxs-lookup"><span data-stu-id="c66d7-148">If you are failing over to a Classic virtual machine, then you need to [add an endpoint](../virtual-machines/windows/classic/setup-endpoints.md) on port 3389</span></span>
1. <span data-ttu-id="c66d7-149">完成後，在復原方案上按一下 [清除測試容錯移轉]。</span><span class="sxs-lookup"><span data-stu-id="c66d7-149">Once you're done, click **Cleanup test failover** on the recovery plan.</span></span> <span data-ttu-id="c66d7-150">在 [記事]  中，記錄並儲存關於測試容錯移轉的任何觀察。</span><span class="sxs-lookup"><span data-stu-id="c66d7-150">In **Notes** record and save any observations associated with the test failover.</span></span> <span data-ttu-id="c66d7-151">這會刪除在測試容錯移轉期間所建立的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="c66d7-151">This deletes the virtual machines that were created during test failover.</span></span>


> [!TIP]
> <span data-ttu-id="c66d7-152">Site Recovery 會嘗試在名稱相同的子網路中建立測試虛擬機器，並使用虛擬機器的 [計算與網路] 設定中提供的 IP。</span><span class="sxs-lookup"><span data-stu-id="c66d7-152">Site Recovery attempts to create test virtual machines in a subnet of same name and using the same IP as that provided in **Compute and Network** settings of the virtual machine.</span></span> <span data-ttu-id="c66d7-153">如果針對測試容錯移轉提供的 Azure 虛擬網路中沒有名稱相同的子網路，則會在依字母順序的第一個子網路中建立測試虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="c66d7-153">If subnet of same name is not available in the Azure virtual network provided for test failover, then test virtual machine is created in the first subnet alphabetically.</span></span> <span data-ttu-id="c66d7-154">如果目標 IP 是所選子網路的一部分，則 Site Recovery 會使用目標 IP 嘗試建立測試容錯移轉虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="c66d7-154">If the target IP is part of the chosen subnet, then site recovery tries to create the test failover virtual machine using the target IP.</span></span> <span data-ttu-id="c66d7-155">如果目標 IP 不屬於所選子網路的一部分，則會使用所選子網路中的任何可用 IP 建立測試容錯移轉虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="c66d7-155">If the target IP is not part of the chosen subnet then test failover virtual machine gets created using any available IP in the chosen subnet.</span></span>
>
>

## <a name="test-failover-job"></a><span data-ttu-id="c66d7-156">測試容錯移轉作業</span><span class="sxs-lookup"><span data-stu-id="c66d7-156">Test failover job</span></span>

![Test Failover](./media/site-recovery-test-failover-to-azure/TestFailoverJob.png)

<span data-ttu-id="c66d7-158">觸發測試容錯移轉時會執行下列步驟︰</span><span class="sxs-lookup"><span data-stu-id="c66d7-158">When a test failover is triggered, it involves following steps:</span></span>

1. <span data-ttu-id="c66d7-159">先決條件檢查︰這個步驟可確保符合容錯移轉所需的所有條件</span><span class="sxs-lookup"><span data-stu-id="c66d7-159">Prerequisites check: This step ensures that all conditions required for failover are met</span></span>
1. <span data-ttu-id="c66d7-160">容錯移轉︰這個步驟會處理並備妥資料，以用來建立 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="c66d7-160">Failover: This step processes the data and makes it ready so that an Azure virtual machine can be created out of it.</span></span> <span data-ttu-id="c66d7-161">如果您已選擇 [最新] 復原點，此步驟會從已傳送至服務的資料建立復原點。</span><span class="sxs-lookup"><span data-stu-id="c66d7-161">If you have chosen **Latest** recovery point, this step creates a recovery point from the data that has been sent to the service.</span></span>
1. <span data-ttu-id="c66d7-162">開始︰這個步驟會使用上一個步驟中所處理的資料建立 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="c66d7-162">Start: This step creates an Azure virtual machine using the data processed in the previous step.</span></span>

## <a name="time-taken-for-failover"></a><span data-ttu-id="c66d7-163">容錯移轉所花費的時間</span><span class="sxs-lookup"><span data-stu-id="c66d7-163">Time taken for failover</span></span>

<span data-ttu-id="c66d7-164">在某些情況下，虛擬機器的容錯移轉會需要其他中繼步驟，通常會費時大約 8 到 10 分鐘才能完成。</span><span class="sxs-lookup"><span data-stu-id="c66d7-164">In certain cases, failover of virtual machines requires an extra intermediate step that usually takes around 8  to 10 minutes to complete.</span></span> <span data-ttu-id="c66d7-165">這些情況如下所示︰</span><span class="sxs-lookup"><span data-stu-id="c66d7-165">These cases are as following:</span></span>

* <span data-ttu-id="c66d7-166">VMware 虛擬機器使用的版本比行動服務版本 9.8 更早</span><span class="sxs-lookup"><span data-stu-id="c66d7-166">VMware virtual machines using a version of the Mobility service older than 9.8</span></span>
* <span data-ttu-id="c66d7-167">實體伺服器</span><span class="sxs-lookup"><span data-stu-id="c66d7-167">Physical servers</span></span>
* <span data-ttu-id="c66d7-168">VMware Linux 虛擬機器</span><span class="sxs-lookup"><span data-stu-id="c66d7-168">VMware Linux virtual machines</span></span>
* <span data-ttu-id="c66d7-169">如同實體伺服器般受到保護的 Hyper-V 虛擬機器</span><span class="sxs-lookup"><span data-stu-id="c66d7-169">Hyper-V virtual machines protected as physical servers</span></span>
* <span data-ttu-id="c66d7-170">沒有以下驅動程式作為開機驅動程式的 VMware 虛擬機器</span><span class="sxs-lookup"><span data-stu-id="c66d7-170">VMware virtual machines where following drivers are not present as boot drivers</span></span>
    * <span data-ttu-id="c66d7-171">storvsc</span><span class="sxs-lookup"><span data-stu-id="c66d7-171">storvsc</span></span>
    * <span data-ttu-id="c66d7-172">vmbus</span><span class="sxs-lookup"><span data-stu-id="c66d7-172">vmbus</span></span>
    * <span data-ttu-id="c66d7-173">storflt</span><span class="sxs-lookup"><span data-stu-id="c66d7-173">storflt</span></span>
    * <span data-ttu-id="c66d7-174">intelide</span><span class="sxs-lookup"><span data-stu-id="c66d7-174">intelide</span></span>
    * <span data-ttu-id="c66d7-175">atapi</span><span class="sxs-lookup"><span data-stu-id="c66d7-175">atapi</span></span>
* <span data-ttu-id="c66d7-176">沒有啟用 DHCP 服務的 VMware 虛擬機器，無論其是否正在使用 DHCP 或靜態 IP 位址</span><span class="sxs-lookup"><span data-stu-id="c66d7-176">VMware virtual machines that don't have DHCP service enabled irrespective of whether they are using DHCP or static IP addresses</span></span>

<span data-ttu-id="c66d7-177">在其他所有情況下則不需要此中繼步驟，且容錯移轉所花費的時間非常少。</span><span class="sxs-lookup"><span data-stu-id="c66d7-177">In all the other cases this intermediate step is not required and the time taken for the failover is significantly lower.</span></span>


## <a name="creating-a-network-for-test-failover"></a><span data-ttu-id="c66d7-178">建立測試容錯移轉的網路</span><span class="sxs-lookup"><span data-stu-id="c66d7-178">Creating a network for test failover</span></span>
<span data-ttu-id="c66d7-179">當您進行測試容錯移轉時，建議您選擇與您在虛擬機器的 [計算與網路] 設定中提供的實際執行復原站台網路隔離的網路。</span><span class="sxs-lookup"><span data-stu-id="c66d7-179">It is recommended that when you are doing a test failover you choose a network that is isolated from your production recovery site network that you provided in **Compute and Network** settings for the virtual machine.</span></span> <span data-ttu-id="c66d7-180">根據預設，當您建立 Azure 虛擬網路時，它會與其他網路隔離。</span><span class="sxs-lookup"><span data-stu-id="c66d7-180">By default when you create an Azure virtual network, it is isolated from other networks.</span></span> <span data-ttu-id="c66d7-181">此網路應模擬您的實際執行網路︰</span><span class="sxs-lookup"><span data-stu-id="c66d7-181">This network should mimic your production network:</span></span>

1. <span data-ttu-id="c66d7-182">測試網路應含有和您的實際執行網路相同的子網路數目，且名稱應和您的實際執行網路中的子網路相同。</span><span class="sxs-lookup"><span data-stu-id="c66d7-182">Test network should have same number of subnets as that in your production network and with the same name as those of the subnets in your production network.</span></span>
1. <span data-ttu-id="c66d7-183">測試網路應使用和實際執行網路相同的 IP 範圍。</span><span class="sxs-lookup"><span data-stu-id="c66d7-183">Test network should use the same IP range as that of your production network.</span></span>
1. <span data-ttu-id="c66d7-184">將測試網路的 DNS 更新為您在 [計算與網路] 設定下提供做為 DNS 虛擬機器的目標 IP 的 IP。</span><span class="sxs-lookup"><span data-stu-id="c66d7-184">Update the DNS of the Test Network as the IP that you gave as target IP for the DNS virtual machine under **Compute and Network** settings.</span></span> <span data-ttu-id="c66d7-185">如需詳細資訊，請參閱 [Active Directory 測試容錯移轉考量](site-recovery-active-directory.md#test-failover-considerations) 一節。</span><span class="sxs-lookup"><span data-stu-id="c66d7-185">Go through [test failover considerations for active directory](site-recovery-active-directory.md#test-failover-considerations) section for more details.</span></span>


## <a name="test-failover-to-a-production-network-on-recovery-site"></a><span data-ttu-id="c66d7-186">在復原站台上測試容錯移轉到實際執行網路</span><span class="sxs-lookup"><span data-stu-id="c66d7-186">Test failover to a production network on recovery site</span></span>
<span data-ttu-id="c66d7-187">當您進行測試容錯移轉時，建議您選擇與在虛擬機器的 [計算與網路] 設定中提供的實際執行復原站台網路不同的網路。</span><span class="sxs-lookup"><span data-stu-id="c66d7-187">It is recommended that when you are doing a test failover you choose a network that is different from your production recovery site network that you provided in **Compute and Network** settings for the virtual machine.</span></span> <span data-ttu-id="c66d7-188">但是，如果您真的想驗證容錯移轉的虛擬機器中的端對端網路連線，請注意下列幾點︰</span><span class="sxs-lookup"><span data-stu-id="c66d7-188">But if you really want to validate end to end network connectivity in a failed over virtual machine, note the following points:</span></span>

1. <span data-ttu-id="c66d7-189">進行測試容錯移轉時，請確定主要虛擬機器已關機。</span><span class="sxs-lookup"><span data-stu-id="c66d7-189">Make sure that the primary virtual machine is shutdown when you are doing the test failover.</span></span> <span data-ttu-id="c66d7-190">如果不這麼做，相同的網路中將有兩部虛擬機器以相同的身分識別執行，因而可能造成不良的後果。</span><span class="sxs-lookup"><span data-stu-id="c66d7-190">If you don't do so, there will be two virtual machines with the same identity running in the same network at the same time and that can lead to undesired consequences.</span></span>
1. <span data-ttu-id="c66d7-191">當您清除測試容錯移轉虛擬機器時，您對測試容錯移轉虛擬機器所做的任何變更將會遺失。</span><span class="sxs-lookup"><span data-stu-id="c66d7-191">Any changes that you make into the test failover virtual machines would be lost when you cleanup the test failover virtual machines.</span></span> <span data-ttu-id="c66d7-192">這些變更不會複寫回主要虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="c66d7-192">These changes will not be replicated back to the primary virtual machine.</span></span>
1. <span data-ttu-id="c66d7-193">這種測試會導致實際執行應用程式的停機時間。</span><span class="sxs-lookup"><span data-stu-id="c66d7-193">This way of doing testing leads to a downtime of your production application.</span></span> <span data-ttu-id="c66d7-194">進行 DR 訓練時，應要求應用程式的使用者不要使用應用程式。</span><span class="sxs-lookup"><span data-stu-id="c66d7-194">Users of the application should be asked to not use the application when the DR drill is in progress.</span></span>  



## <a name="prepare-active-directory-and-dns"></a><span data-ttu-id="c66d7-195">準備 Active Directory 和 DNS</span><span class="sxs-lookup"><span data-stu-id="c66d7-195">Prepare Active Directory and DNS</span></span>
<span data-ttu-id="c66d7-196">若要執行測試容錯移轉以進行應用程式測試，您需要在測試環境中具有 Active Directory 生產環境的複本。</span><span class="sxs-lookup"><span data-stu-id="c66d7-196">To run a test failover for application testing, you need a copy of the production Active Directory environment in your test environment.</span></span> <span data-ttu-id="c66d7-197">如需詳細資訊，請參閱 [Active Directory 測試容錯移轉考量](site-recovery-active-directory.md#test-failover-considerations) 一節。</span><span class="sxs-lookup"><span data-stu-id="c66d7-197">Go through [test failover considerations for active directory](site-recovery-active-directory.md#test-failover-considerations) section for more details.</span></span>

## <a name="prepare-to-connect-to-azure-vms-after-failover"></a><span data-ttu-id="c66d7-198">準備在容錯移轉後連接到 Azure VM</span><span class="sxs-lookup"><span data-stu-id="c66d7-198">Prepare to connect to Azure VMs after failover</span></span>

<span data-ttu-id="c66d7-199">如果您想要在容錯移轉後使用 RDP 連接到 Azure VM，請務必執行表格中摘要說明的動作。</span><span class="sxs-lookup"><span data-stu-id="c66d7-199">If you want to connect to Azure VMs using RDP after failover, make sure you do the actions summarized in the table.</span></span>

<span data-ttu-id="c66d7-200">**容錯移轉**</span><span class="sxs-lookup"><span data-stu-id="c66d7-200">**Failover**</span></span> | <span data-ttu-id="c66d7-201">**位置**</span><span class="sxs-lookup"><span data-stu-id="c66d7-201">**Location**</span></span> | <span data-ttu-id="c66d7-202">**動作**</span><span class="sxs-lookup"><span data-stu-id="c66d7-202">**Actions**</span></span>
--- | --- | ---
<span data-ttu-id="c66d7-203">**執行 Windows 的 Azure VM**</span><span class="sxs-lookup"><span data-stu-id="c66d7-203">**Azure VM running Windows**</span></span> | <span data-ttu-id="c66d7-204">在容錯移轉前的內部部署機器上</span><span class="sxs-lookup"><span data-stu-id="c66d7-204">On on-premises machine before failover</span></span> | <span data-ttu-id="c66d7-205">若要透過網際網路存取 Azure VM，請啟用 RDP，並確定已針對 [公用] 新增 TCP 和 UDP 規則，且在 [Windows 防火牆] > [允許的應用程式] 中已針對所有設定檔允許 RDP。</span><span class="sxs-lookup"><span data-stu-id="c66d7-205">To access the Azure VM over the internet, enable RDP, make sure TCP, and UDP rules are added for the **Public**, and that RDP is allowed in **Windows Firewall** > **Allowed Apps**, for all profiles.</span></span><br/><br/> <span data-ttu-id="c66d7-206">若要透過站對站連線進行存取，請在機器上啟用 RDP，並確定在 [Windows 防火牆]  ->  [允許的應用程式和功能] 中已針對 [網域] 和 [私人] 網路允許 RDP。</span><span class="sxs-lookup"><span data-stu-id="c66d7-206">To access over a site-to-site connection, enable RDP on the machine, and ensure that RDP is allowed in the **Windows Firewall** -> **Allowed apps and features** for **Domain and Private** networks.</span></span><br/><br/>  <span data-ttu-id="c66d7-207">確定作業系統的 SAN 原則已設為 **OnlineAll**。</span><span class="sxs-lookup"><span data-stu-id="c66d7-207">Make sure the operating system's SAN policy is set to **OnlineAll**.</span></span> <span data-ttu-id="c66d7-208">[深入了解](https://support.microsoft.com/kb/3031135)。</span><span class="sxs-lookup"><span data-stu-id="c66d7-208">[Learn more](https://support.microsoft.com/kb/3031135).</span></span><br/><br/> <span data-ttu-id="c66d7-209">觸發容錯移轉時，請確定虛擬機器上沒有任何暫止的 Windows 更新。</span><span class="sxs-lookup"><span data-stu-id="c66d7-209">Make sure there are no Windows updates pending on the virtual machine when you trigger a failover.</span></span> <span data-ttu-id="c66d7-210">容錯移轉時，可能會啟動 Windows 更新，必須等到更新完成，才能登入虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="c66d7-210">Windows update might start when you failover and you will not be able to login to the virtual machine until the update completes.</span></span> <br/><br/>
<span data-ttu-id="c66d7-211">**執行 Windows 的 Azure VM**</span><span class="sxs-lookup"><span data-stu-id="c66d7-211">**Azure VM running Windows**</span></span> | <span data-ttu-id="c66d7-212">在容錯移轉後的 Azure VM 上</span><span class="sxs-lookup"><span data-stu-id="c66d7-212">On Azure VM after failover</span></span> | <span data-ttu-id="c66d7-213">若是傳統虛擬機器，請為 RDP 通訊協定 (連接埠 3389) [新增公用端點](../virtual-machines/windows/classic/setup-endpoints.md)</span><span class="sxs-lookup"><span data-stu-id="c66d7-213">For a classic virtual machine, [add a public endpoint](../virtual-machines/windows/classic/setup-endpoints.md) for the RDP protocol (port 3389)</span></span><br/><br/>  <span data-ttu-id="c66d7-214">若是在 Resource Manager 虛擬機器上，請[新增公用 IP](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine)。</span><span class="sxs-lookup"><span data-stu-id="c66d7-214">For a Resource Manager virtual machine, [add a public IP](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) on it.</span></span><br/><br/> <span data-ttu-id="c66d7-215">已容錯移轉的 VM 上的網路安全性群組規則以及它所連線的 Azure 子網路必須允許 RDP 連接埠的連入連線。</span><span class="sxs-lookup"><span data-stu-id="c66d7-215">The network security group rules on the failed over VM, and the Azure subnet to which it is connected, need to allow incoming connections to the RDP port.</span></span><br/><br/> <span data-ttu-id="c66d7-216">若是 Resource Manager 虛擬機器，您可以檢查 [開機診斷]，查看虛擬機器的螢幕擷取畫面</span><span class="sxs-lookup"><span data-stu-id="c66d7-216">For a Resource Manager virtual machine, you can check **Boot diagnostics** to look at a screenshot of the virtual machine</span></span><br/><br/> <span data-ttu-id="c66d7-217">如果您無法連線，請檢查 VM 是否正在執行，然後查看這些[疑難排解秘訣](http://social.technet.microsoft.com/wiki/contents/articles/31666.troubleshooting-remote-desktop-connection-after-failover-using-asr.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c66d7-217">If you can't connect, check that the VM is running and then look at these [troubleshooting tips](http://social.technet.microsoft.com/wiki/contents/articles/31666.troubleshooting-remote-desktop-connection-after-failover-using-asr.aspx).</span></span><br/><br/>
<span data-ttu-id="c66d7-218">**執行 Linux 的 Azure VM**</span><span class="sxs-lookup"><span data-stu-id="c66d7-218">**Azure VM running Linux**</span></span> | <span data-ttu-id="c66d7-219">在容錯移轉前的內部部署機器上</span><span class="sxs-lookup"><span data-stu-id="c66d7-219">On on-premises machine before failover</span></span> | <span data-ttu-id="c66d7-220">確定 Azure VM 上的安全殼層服務已設定為在系統開機時自動啟動。</span><span class="sxs-lookup"><span data-stu-id="c66d7-220">Ensure that the Secure Shell service on the Azure VM is set to start automatically on system boot.</span></span><br/><br/> <span data-ttu-id="c66d7-221">請檢查防火牆規則是否允許 SSH 連線。</span><span class="sxs-lookup"><span data-stu-id="c66d7-221">Check that firewall rules allow an SSH connection to it.</span></span>
<span data-ttu-id="c66d7-222">**執行 Linux 的 Azure VM**</span><span class="sxs-lookup"><span data-stu-id="c66d7-222">**Azure VM running Linux**</span></span> | <span data-ttu-id="c66d7-223">容錯移轉後的 Azure VM</span><span class="sxs-lookup"><span data-stu-id="c66d7-223">Azure VM after failover</span></span> | <span data-ttu-id="c66d7-224">已容錯移轉的 VM 上的網路安全性群組規則以及它所連接的 Azure 子網路必須允許 SSH 連接埠的連入連線。</span><span class="sxs-lookup"><span data-stu-id="c66d7-224">The network security group rules on the failed over VM, and the Azure subnet to which it is connected, need to allow incoming connections to the SSH port.</span></span><br/><br/> <span data-ttu-id="c66d7-225">若是傳統虛擬機器，應建立[新增公用端點](../virtual-machines/windows/classic/setup-endpoints.md)，以允許 SSH 連接埠 (預設為 TCP 通訊埠 22) 上的連入連線。</span><span class="sxs-lookup"><span data-stu-id="c66d7-225">For  a classic virtual machine, [add a public endpoint](../virtual-machines/windows/classic/setup-endpoints.md) should be created, to allow incoming connections on the SSH port (TCP port 22 by default).</span></span><br/><br/> <span data-ttu-id="c66d7-226">若是在 Resource Manager 虛擬機器上，請[新增公用 IP](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine)。</span><span class="sxs-lookup"><span data-stu-id="c66d7-226">For a Resource Manager virtual machine, [add a public IP](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) on it.</span></span><br/><br/> <span data-ttu-id="c66d7-227">若是 Resource Manager 虛擬機器，您可以檢查 [開機診斷]，查看虛擬機器的螢幕擷取畫面</span><span class="sxs-lookup"><span data-stu-id="c66d7-227">For a Resource Manager virtual machine, you can check **Boot diagnostics** to look at a screenshot of the virtual machine</span></span><br/><br/>



## <a name="next-steps"></a><span data-ttu-id="c66d7-228">後續步驟</span><span class="sxs-lookup"><span data-stu-id="c66d7-228">Next steps</span></span>
<span data-ttu-id="c66d7-229">一旦您成功嘗試測試容錯移轉之後，您就可以嘗試執行[容錯移轉](site-recovery-failover.md)。</span><span class="sxs-lookup"><span data-stu-id="c66d7-229">Once you have successfully tried a test failover you can try doing a [failover](site-recovery-failover.md).</span></span>
