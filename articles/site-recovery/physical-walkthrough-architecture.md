---
title: "使用 Azure Site Recovery 的實體伺服器複寫 tooAzure aaaReview hello 架構 |Microsoft 文件"
description: "本文提供元件和複寫在內部部署實體伺服器 tooAzure 以 hello Azure Site Recovery 服務時使用的架構的概觀"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 09c9b136-35f5-465e-8d0f-f4c5d5d9f880
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: raynew
ms.openlocfilehash: 4f334c181fa6f0821adf978ebe9dbd7d36a3c753
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="step-1-review-hello-architecture-for-physical-server-replication-tooazure"></a><span data-ttu-id="17e20-103">步驟 1： 檢閱實體伺服器複寫 tooAzure hello 架構</span><span class="sxs-lookup"><span data-stu-id="17e20-103">Step 1: Review hello architecture for physical server replication tooAzure</span></span>

<span data-ttu-id="17e20-104">本文說明 hello 元件和處理序使用複寫在內部部署 Windows/Linux 實體伺服器 tooAzure，使用 hello 時[Azure Site Recovery](site-recovery-overview.md)服務。</span><span class="sxs-lookup"><span data-stu-id="17e20-104">This article describes hello components and processes used when you replicate on-premises Windows/Linux physical servers tooAzure, using hello [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="17e20-105">張貼於 hello 下方的本文中，任何註解或詢問問題中 hello [Azure 復原服務論壇](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr)。</span><span class="sxs-lookup"><span data-stu-id="17e20-105">Post any comments at hello bottom of this article, or ask questions in hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="17e20-106">架構元件</span><span class="sxs-lookup"><span data-stu-id="17e20-106">Architectural components</span></span>

<span data-ttu-id="17e20-107">hello 表格摘要說明您需要的 hello 元件。</span><span class="sxs-lookup"><span data-stu-id="17e20-107">hello table summarizes hello components you need.</span></span>

<span data-ttu-id="17e20-108">**元件**</span><span class="sxs-lookup"><span data-stu-id="17e20-108">**Component**</span></span> | <span data-ttu-id="17e20-109">**需求**</span><span class="sxs-lookup"><span data-stu-id="17e20-109">**Requirement**</span></span> | <span data-ttu-id="17e20-110">**詳細資料**</span><span class="sxs-lookup"><span data-stu-id="17e20-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="17e20-111">**Azure**</span><span class="sxs-lookup"><span data-stu-id="17e20-111">**Azure**</span></span> | <span data-ttu-id="17e20-112">您需要 Azure 帳戶、Azure 儲存體帳戶及 Azure 網路。</span><span class="sxs-lookup"><span data-stu-id="17e20-112">You need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="17e20-113">複寫的資料會儲存在 hello 儲存體帳戶，並發生容錯移轉時，將會建立與 hello 複寫資料的 Azure Vm。</span><span class="sxs-lookup"><span data-stu-id="17e20-113">Replicated data is stored in hello storage account, and Azure VMs are created with hello replicated data when failover occurs.</span></span> <span data-ttu-id="17e20-114">在建立時即，azure Vm 連接 toohello Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="17e20-114">Azure VMs connect toohello Azure virtual network when they're created.</span></span>
<span data-ttu-id="17e20-115">**組態伺服器**</span><span class="sxs-lookup"><span data-stu-id="17e20-115">**Configuration server**</span></span> | <span data-ttu-id="17e20-116">單一內部部署管理伺服器 （實體伺服器或 VMware VM） 執行所有 hello 內部部署站台復原元件。</span><span class="sxs-lookup"><span data-stu-id="17e20-116">A single on-premises management server (physical server or VMware VM) that runs all hello on-premises Site Recovery components.</span></span> <span data-ttu-id="17e20-117">這些包括組態伺服器、處理伺服器、主要目標伺服器。</span><span class="sxs-lookup"><span data-stu-id="17e20-117">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="17e20-118">hello 組態伺服器元件會協調在內部部署與 Azure 之間的通訊並管理資料複寫。</span><span class="sxs-lookup"><span data-stu-id="17e20-118">hello configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="17e20-119">**處理序伺服器**</span><span class="sxs-lookup"><span data-stu-id="17e20-119">**Process server**</span></span>  | <span data-ttu-id="17e20-120">Hello 組態伺服器上的預設安裝。</span><span class="sxs-lookup"><span data-stu-id="17e20-120">Installed by default on hello configuration server.</span></span> | <span data-ttu-id="17e20-121">會做為複寫閘道器。</span><span class="sxs-lookup"><span data-stu-id="17e20-121">Acts as a replication gateway.</span></span> <span data-ttu-id="17e20-122">接收複寫資料、 最佳化與快取、 壓縮和加密，並將它傳送 tooAzure 儲存體。</span><span class="sxs-lookup"><span data-stu-id="17e20-122">Receives replication data, optimizes it with caching, compression, and encryption, and sends it tooAzure storage.</span></span><br/><br/> <span data-ttu-id="17e20-123">hello 處理序伺服器也會處理推入安裝的 hello 行動服務 tooprotected 機器。</span><span class="sxs-lookup"><span data-stu-id="17e20-123">hello process server also handles push installation of hello Mobility service tooprotected machines.</span></span><br/><br/> <span data-ttu-id="17e20-124">您可以新增其他個別的專用處理序伺服器，toohandle 增加磁碟區的複寫流量。</span><span class="sxs-lookup"><span data-stu-id="17e20-124">You can add additional separate dedicated process servers, toohandle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="17e20-125">**主要目標伺服器**</span><span class="sxs-lookup"><span data-stu-id="17e20-125">**Master target server**</span></span> | <span data-ttu-id="17e20-126">Hello 在內部部署組態伺服器上的預設安裝。</span><span class="sxs-lookup"><span data-stu-id="17e20-126">Installed by default on hello on-premises configuration server.</span></span> | <span data-ttu-id="17e20-127">在從 Azure 容錯回復期間，處理複寫資料。</span><span class="sxs-lookup"><span data-stu-id="17e20-127">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="17e20-128">如果容錯回復的流量很高，您可以部署個別的主要目標伺服器來供容錯回復使用。</span><span class="sxs-lookup"><span data-stu-id="17e20-128">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="17e20-129">**複寫的伺服器**</span><span class="sxs-lookup"><span data-stu-id="17e20-129">**Replicated servers**</span></span> | <span data-ttu-id="17e20-130">hello 行動服務已安裝元件要 tooreplicate 每個 Windows/Linux 伺服器上。</span><span class="sxs-lookup"><span data-stu-id="17e20-130">hello Mobility service component is installed on each Windows/Linux server you want tooreplicate.</span></span> <span data-ttu-id="17e20-131">它可以手動安裝在每部電腦上，或從 hello 處理序伺服器推入安裝。</span><span class="sxs-lookup"><span data-stu-id="17e20-131">It can be installed manually on each machine, or with a push installation from hello process server.</span></span>
<span data-ttu-id="17e20-132">**容錯回復**</span><span class="sxs-lookup"><span data-stu-id="17e20-132">**Failback**</span></span> | <span data-ttu-id="17e20-133">若要進行容錯回復，必須要有 VMware 基礎結構。</span><span class="sxs-lookup"><span data-stu-id="17e20-133">For failback a VMware infrastructure is required.</span></span> <span data-ttu-id="17e20-134">您不能容錯回復 tooa 實體伺服器。</span><span class="sxs-lookup"><span data-stu-id="17e20-134">You can't fail back tooa physical server.</span></span>


<span data-ttu-id="17e20-135">**圖 1： 實體 tooAzure 元件**</span><span class="sxs-lookup"><span data-stu-id="17e20-135">**Figure 1: Physical tooAzure components**</span></span>

![元件](./media/physical-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="17e20-137">複寫程序</span><span class="sxs-lookup"><span data-stu-id="17e20-137">Replication process</span></span>

1. <span data-ttu-id="17e20-138">您設定 hello 部署，包括在內部部署和 Azure 元件。</span><span class="sxs-lookup"><span data-stu-id="17e20-138">You set up hello deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="17e20-139">在 hello 復原服務保存庫，您可以指定 hello 複寫來源和目標，設定 hello 組態伺服器，建立複寫原則，部署 hello 行動服務、 啟用複寫，並執行測試容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="17e20-139">In hello Recovery Services vault, you specify hello replication source and target, set up hello configuration server, create a replication policy, deploy hello Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="17e20-140">複寫的 tooAzure 儲存區是根據 hello 複寫原則，與 hello 資料的初始複本機器複寫。</span><span class="sxs-lookup"><span data-stu-id="17e20-140">Machines replicate in accordance with hello replication policy, and an initial copy of hello data is replicated tooAzure storage.</span></span>
4. <span data-ttu-id="17e20-141">初始複寫完成之後，便會開始複寫差異變更 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="17e20-141">After initial replication finishes, replication of delta changes tooAzure begins.</span></span> <span data-ttu-id="17e20-142">機器的追蹤變更會保存在 .hrl 檔案中。</span><span class="sxs-lookup"><span data-stu-id="17e20-142">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="17e20-143">複寫機器 hello 組態與伺服器通訊連接埠 HTTPS 443 輸入複寫管理的。</span><span class="sxs-lookup"><span data-stu-id="17e20-143">Replicating machines communicate with hello configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="17e20-144">複寫機器複寫資料 toohello 處理序伺服器連接埠上傳送 HTTPS 9443 輸入 （可以修改）。</span><span class="sxs-lookup"><span data-stu-id="17e20-144">Replicating machines send replication data toohello process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="17e20-145">hello 組態伺服器協調使用 Azure 的複寫管理透過 HTTPS 443 輸出連接埠。</span><span class="sxs-lookup"><span data-stu-id="17e20-145">hello configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="17e20-146">hello 處理序伺服器接收資料從來源機器、 最佳化及加密，並將它 tooAzure 儲存體傳送連接埠 443 輸出。</span><span class="sxs-lookup"><span data-stu-id="17e20-146">hello process server receives data from source machines, optimizes and encrypts it, and sends it tooAzure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="17e20-147">如果您啟用多重 VM 一致性，然後 hello 複寫群組中的電腦與對方進行通訊透過連接埠 20004。</span><span class="sxs-lookup"><span data-stu-id="17e20-147">If you enable multi-VM consistency, then machines in hello replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="17e20-148">如果您將多部機器群組為幾個共用當機時保持一致復原點和應用程式一致復原點的複寫群組，當這些群組在進行容錯移轉時，便會使用多部 VM。</span><span class="sxs-lookup"><span data-stu-id="17e20-148">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="17e20-149">這非常有用，如果電腦執行 hello 相同的工作負載，而且需要 toobe 一致。</span><span class="sxs-lookup"><span data-stu-id="17e20-149">This is useful if machines are running hello same workload and need toobe consistent.</span></span>
5. <span data-ttu-id="17e20-150">流量會複寫的 tooAzure 儲存體公用端點，超過 hello 網際網路。</span><span class="sxs-lookup"><span data-stu-id="17e20-150">Traffic is replicated tooAzure storage public endpoints, over hello internet.</span></span> <span data-ttu-id="17e20-151">或者，您可以使用 Azure ExpressRoute [公用對等](../expressroute/expressroute-circuit-peerings.md#public-peering)。</span><span class="sxs-lookup"><span data-stu-id="17e20-151">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="17e20-152">不支援透過站對站 VPN 從內部部署站台 tooAzure 複寫流量。</span><span class="sxs-lookup"><span data-stu-id="17e20-152">Replicating traffic over a site-to-site VPN from an on-premises site tooAzure isn't supported.</span></span>

<span data-ttu-id="17e20-153">**圖 2： 實體 tooAzure 複寫**</span><span class="sxs-lookup"><span data-stu-id="17e20-153">**Figure 2: Physical tooAzure replication**</span></span>

![增強](./media/physical-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="17e20-155">容錯移轉和容錯回復程序</span><span class="sxs-lookup"><span data-stu-id="17e20-155">Failover and failback process</span></span>

<span data-ttu-id="17e20-156">在您確認測試容錯移轉正常運作之後，您可以視需要執行未規劃的容錯移轉 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="17e20-156">After you verify that test failover is working as expected, you can run unplanned failovers tooAzure as required.</span></span> <span data-ttu-id="17e20-157">當您執行容錯移轉時，系統會從複寫的資料建立 Azure VM。</span><span class="sxs-lookup"><span data-stu-id="17e20-157">When you run a failover, Azure VMs are created from replicated data.</span></span> <span data-ttu-id="17e20-158">接著，當您的主要內部部署站台恢復可用時，您就可以容錯回復。</span><span class="sxs-lookup"><span data-stu-id="17e20-158">Then, when your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="17e20-159">請注意：</span><span class="sxs-lookup"><span data-stu-id="17e20-159">Note that:</span></span>

- <span data-ttu-id="17e20-160">不支援有計劃的容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="17e20-160">Planned failover isn't supported.</span></span>
- <span data-ttu-id="17e20-161">您可以容錯移轉單一電腦，或建立[復原計劃](site-recovery-create-recovery-plans.md)，toofail 在一起的多部電腦。</span><span class="sxs-lookup"><span data-stu-id="17e20-161">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), toofail over multiple machines together.</span></span>
- <span data-ttu-id="17e20-162">您從 Azure VM 的 hello 複本認可容錯移轉 toostart 存取 hello 工作負載。</span><span class="sxs-lookup"><span data-stu-id="17e20-162">You commit a failover toostart accessing hello workload from hello replica Azure VM.</span></span>
- <span data-ttu-id="17e20-163">Hello 主要站台再次可用時，您會從 hello 次要 toohello 主要站台複寫 hello 機器。</span><span class="sxs-lookup"><span data-stu-id="17e20-163">When hello primary site is available again, you replicate hello machine from hello secondary toohello primary site.</span></span> <span data-ttu-id="17e20-164">然後，執行未規劃的容錯移轉從 hello 次要站台。</span><span class="sxs-lookup"><span data-stu-id="17e20-164">Then, run an unplanned failover from hello secondary site.</span></span> <span data-ttu-id="17e20-165">確認此容錯移轉之後，資料將會回復在內部，並再次需要 tooenable 複寫 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="17e20-165">After you commit this failover, data will be back on-premises, and you need tooenable replication tooAzure again.</span></span>

<span data-ttu-id="17e20-166">容錯回復元件包括：</span><span class="sxs-lookup"><span data-stu-id="17e20-166">Failback components include:</span></span>

- <span data-ttu-id="17e20-167">**在 Azure 中的暫存處理序伺服器**： 您需要的處理序伺服器的 Azure VM tooact、 從 Azure toohandle 複寫向上 tooset。</span><span class="sxs-lookup"><span data-stu-id="17e20-167">**Temporary process server in Azure**: You need tooset up an Azure VM tooact as a process server, toohandle replication from Azure.</span></span> <span data-ttu-id="17e20-168">容錯回復完成後，您可以刪除此 VM。</span><span class="sxs-lookup"><span data-stu-id="17e20-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="17e20-169">**VPN 連線**： 您需要從 hello Azure 網路 toohello 在內部部署站台 VPN 連線 （或 Azure ExpressRoute）。</span><span class="sxs-lookup"><span data-stu-id="17e20-169">**VPN connection**: You need a VPN connection (or Azure ExpressRoute) from hello Azure network toohello on-premises site.</span></span>
- <span data-ttu-id="17e20-170">**另一個在內部部署主要目標伺服器**: hello （hello 組態伺服器上的預設安裝） 的內部部署主要目標伺服器會處理容錯回復。</span><span class="sxs-lookup"><span data-stu-id="17e20-170">**Separate on-premises master target server**: hello on-premises master target server (installed by default on hello configuration server) handles failback.</span></span> <span data-ttu-id="17e20-171">如果您要容錯回復大量流量，您應該針對此目的設定個別的內部部署主要目標伺服器。</span><span class="sxs-lookup"><span data-stu-id="17e20-171">If you fail back large volumes of traffic, you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="17e20-172">**容錯回復原則**：您需要一個容錯回復原則。</span><span class="sxs-lookup"><span data-stu-id="17e20-172">**Failback policy**: You need a failback policy.</span></span> <span data-ttu-id="17e20-173">此原則會在您建立複寫原則時自動建立。</span><span class="sxs-lookup"><span data-stu-id="17e20-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="17e20-174">**VMware 基礎結構**： 您必須容錯回復 tooan 內部部署 VMware VM。</span><span class="sxs-lookup"><span data-stu-id="17e20-174">**VMware infrastructure**: You must fail back tooan on-premises VMware VM.</span></span> <span data-ttu-id="17e20-175">這表示您需要在內部部署 VMware 基礎結構中，即使您要複寫在內部部署實體伺服器 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="17e20-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers tooAzure.</span></span>

<span data-ttu-id="17e20-176">**圖 3：實體伺服器容錯回復**</span><span class="sxs-lookup"><span data-stu-id="17e20-176">**Figure 3: Physical server failback**</span></span>

![容錯回復](./media/physical-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="17e20-178">後續步驟</span><span class="sxs-lookup"><span data-stu-id="17e20-178">Next steps</span></span>

<span data-ttu-id="17e20-179">跳過[步驟 2： 確認必要條件和限制](physical-walkthrough-prerequisites.md)</span><span class="sxs-lookup"><span data-stu-id="17e20-179">Go too[Step 2: Verify prerequisites and limitations](physical-walkthrough-prerequisites.md)</span></span>
