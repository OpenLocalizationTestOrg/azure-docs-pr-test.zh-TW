---
title: "在 VMM 中的 HYPER-V Vm 的 aaaEnable 複寫 tooAzure 雲端與 Azure Site Recovery |Microsoft 文件"
description: "說明在 VMM 中的 HYPER-V Vm 的 tooenable 複寫 tooAzure 的雲端方式，與 hello Azure Site Recovery 服務"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 89a2c4fc-7e03-4a86-a2c0-52831ccebc1a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/23/2017
ms.author: raynew
ms.openlocfilehash: 1a39bf65490c59a89a5e891184cadfacc2adee6d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="step-11-enable-replication-tooazure-for-hyper-v-vms-in-vmm-clouds"></a><span data-ttu-id="4c213-103">步驟 11： 啟用複寫 tooAzure 的 VMM 雲端中的 HYPER-V Vm</span><span class="sxs-lookup"><span data-stu-id="4c213-103">Step 11: Enable replication tooAzure for Hyper-V VMs in VMM clouds</span></span>

<span data-ttu-id="4c213-104">您已設定的複寫原則之後，請使用此發行項 tooenable 複寫在內部部署 HYPER-V 虛擬機器 (Vm) 的 System Center Virtual Machine Manager (VMM) 雲端中受管理），tooAzure，使用 hello [Azure Site Recovery](site-recovery-overview.md)hello Azure 入口網站中的服務。</span><span class="sxs-lookup"><span data-stu-id="4c213-104">After you've set up a replication policy, use this article tooenable replication for on-premises Hyper-V virtual machines (VMs) managed in System Center Virtual Machine Manager (VMM) clouds), tooAzure, using hello [Azure Site Recovery](site-recovery-overview.md) service in hello Azure portal.</span></span>

<span data-ttu-id="4c213-105">在本文中，或在 hello hello 下方張貼意見或疑問[Azure 復原服務論壇](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr)。</span><span class="sxs-lookup"><span data-stu-id="4c213-105">Post comments and questions at hello bottom of this article, or on hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="before-you-start"></a><span data-ttu-id="4c213-106">開始之前</span><span class="sxs-lookup"><span data-stu-id="4c213-106">Before you start</span></span>

<span data-ttu-id="4c213-107">請確定您的 Azure 帳戶具有正確的 hello[權限](site-recovery-role-based-linked-access-control.md#permissions-required-to-enable-replication-for-new-virtual-machines)toocreate Azure Vm。</span><span class="sxs-lookup"><span data-stu-id="4c213-107">Make sure your Azure account has hello correct [permissions](site-recovery-role-based-linked-access-control.md#permissions-required-to-enable-replication-for-new-virtual-machines)toocreate Azure VMs.</span></span> <span data-ttu-id="4c213-108">[深入了解](../active-directory/role-based-access-built-in-roles.md) Azure 角色型存取控制。</span><span class="sxs-lookup"><span data-stu-id="4c213-108">[Learn more](../active-directory/role-based-access-built-in-roles.md) about Azure role-based access control.</span></span>

## <a name="exclude-disks-from-replication"></a><span data-ttu-id="4c213-109">從複寫排除磁碟</span><span class="sxs-lookup"><span data-stu-id="4c213-109">Exclude disks from replication</span></span>

<span data-ttu-id="4c213-110">依預設會複寫電腦上的所有磁碟。</span><span class="sxs-lookup"><span data-stu-id="4c213-110">By default all disks on a machine are replicated.</span></span> <span data-ttu-id="4c213-111">您可以從複寫排除磁碟。</span><span class="sxs-lookup"><span data-stu-id="4c213-111">You can exclude disks from replication.</span></span> <span data-ttu-id="4c213-112">例如您可能不想 tooreplicate 磁碟具有暫存資料或重新整理每次在電腦的資料或應用程式重新啟動 （例如 pagefile.sys 或 SQL Server tempdb）。</span><span class="sxs-lookup"><span data-stu-id="4c213-112">For example you might not want tooreplicate disks with temporary data, or data that's refreshed each time a machine or application restarts (for example pagefile.sys or SQL Server tempdb).</span></span> [<span data-ttu-id="4c213-113">深入了解</span><span class="sxs-lookup"><span data-stu-id="4c213-113">Learn more</span></span>](site-recovery-exclude-disk.md)

## <a name="replicate-vms"></a><span data-ttu-id="4c213-114">複寫 VM</span><span class="sxs-lookup"><span data-stu-id="4c213-114">Replicate VMs</span></span>

<span data-ttu-id="4c213-115">啟用 VM 複寫，如下所示︰</span><span class="sxs-lookup"><span data-stu-id="4c213-115">Enable replication for VMs as follows:</span></span>  

1. <span data-ttu-id="4c213-116">按一下 [步驟 2: 複寫應用程式]  >  [來源]。</span><span class="sxs-lookup"><span data-stu-id="4c213-116">Click **Step 2: Replicate application** > **Source**.</span></span> <span data-ttu-id="4c213-117">您已啟用複寫 hello 第一次之後，請按一下**+ 複寫**中的其他機器 hello 保存庫 tooenable 複寫。</span><span class="sxs-lookup"><span data-stu-id="4c213-117">After you've enabled replication for hello first time, click **+Replicate** in hello vault tooenable replication for additional machines.</span></span>

    ![啟用複寫](./media/vmm-to-azure-walkthrough-enable-replication/enable-replication1.png)
2. <span data-ttu-id="4c213-119">在 hello**來源**刀鋒視窗中，選取 hello VMM 伺服器和 hello 雲端中的 hello HYPER-V 主機位於。</span><span class="sxs-lookup"><span data-stu-id="4c213-119">In hello **Source** blade, select hello VMM server, and hello cloud in which hello Hyper-V hosts are located.</span></span> <span data-ttu-id="4c213-120">然後按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="4c213-120">Then click **OK**.</span></span>

    ![啟用複寫](./media/vmm-to-azure-walkthrough-enable-replication/enable-replication-source.png)
3. <span data-ttu-id="4c213-122">在**目標**、 選取 hello 訂用帳戶，容錯移轉後的部署模型，以及 hello 您所使用的複寫資料的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="4c213-122">In **Target**, select hello subscription, post-failover deployment model, and hello storage account you're using for replicated data.</span></span>

    ![啟用複寫](./media/vmm-to-azure-walkthrough-enable-replication/enable-replication-target.png)
4. <span data-ttu-id="4c213-124">選取您想 toouse hello 儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="4c213-124">Select hello storage account you want toouse.</span></span> <span data-ttu-id="4c213-125">如果您想 toouse 您有不同的儲存體帳戶以外，您可以[建立一個](#set-up-an-azure-storage-account)。</span><span class="sxs-lookup"><span data-stu-id="4c213-125">If you want toouse a different storage account than those you have, you can [create one](#set-up-an-azure-storage-account).</span></span> <span data-ttu-id="4c213-126">如果您使用進階儲存體帳戶複寫資料，您需要 tooselect 額外標準儲存體帳戶 toostore 複寫記錄檔擷取進行中的變更 tooon 內部 data.toocreate 使用 hello 資源管理員模型的儲存體帳戶按一下**建立新**。</span><span class="sxs-lookup"><span data-stu-id="4c213-126">If you’re using a premium storage account for replicated data, you need tooselect  an additional standard storage account toostore replication logs that capture ongoing changes tooon-premises data.toocreate a storage account using hello Resource Manager model click **Create new**.</span></span> <span data-ttu-id="4c213-127">如果您想 toocreate 使用 hello 傳統模型的儲存體帳戶，這樣做， [hello Azure 入口網站中](../storage/common/storage-create-storage-account.md)。</span><span class="sxs-lookup"><span data-stu-id="4c213-127">If you want toocreate a storage account using hello classic model, do that [in hello Azure portal](../storage/common/storage-create-storage-account.md).</span></span> <span data-ttu-id="4c213-128">然後按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="4c213-128">Then click **OK**.</span></span>
5. <span data-ttu-id="4c213-129">在建立時即容錯移轉之後，將會連接選取 hello Azure 網路和子網路 toowhich Azure Vm。</span><span class="sxs-lookup"><span data-stu-id="4c213-129">Select hello Azure network and subnet toowhich Azure VMs will connect, when they're created after failover.</span></span> <span data-ttu-id="4c213-130">選取**現在選取的機器設定**，tooapply hello 網路設定 tooall 您選取的機器進行保護。</span><span class="sxs-lookup"><span data-stu-id="4c213-130">Select **Configure now for selected machines**, tooapply hello network setting tooall machines you select for protection.</span></span> <span data-ttu-id="4c213-131">選取**稍後設定**，tooselect hello 每部機器的 Azure 網路。</span><span class="sxs-lookup"><span data-stu-id="4c213-131">Select **Configure later**, tooselect hello Azure network per machine.</span></span> <span data-ttu-id="4c213-132">如果您想 toouse 與您有不同的網路，您可以[建立一個](#set-up-an-azure-network)。</span><span class="sxs-lookup"><span data-stu-id="4c213-132">If you want toouse a different network from those you have, you can [create one](#set-up-an-azure-network).</span></span> <span data-ttu-id="4c213-133">網路使用 toocreate hello 資源管理員模型中，按一下**建立新**。</span><span class="sxs-lookup"><span data-stu-id="4c213-133">toocreate a network using hello Resource Manager model click **Create new**.</span></span> <span data-ttu-id="4c213-134">如果您想 toocreate 網路使用 hello 傳統模式，這樣做， [hello Azure 入口網站中](../virtual-network/virtual-networks-create-vnet-classic-pportal.md)。</span><span class="sxs-lookup"><span data-stu-id="4c213-134">If you want toocreate a network using hello classic model, do that [in hello Azure portal](../virtual-network/virtual-networks-create-vnet-classic-pportal.md).</span></span> <span data-ttu-id="4c213-135">選取適用的子網路。</span><span class="sxs-lookup"><span data-stu-id="4c213-135">Select a subnet if applicable.</span></span> <span data-ttu-id="4c213-136">然後按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="4c213-136">Then click **OK**.</span></span>
6. <span data-ttu-id="4c213-137">在**虛擬機器** > **選取虛擬機器**，按一下並選取您想要 tooreplicate 每一部機器。</span><span class="sxs-lookup"><span data-stu-id="4c213-137">In **Virtual Machines** > **Select virtual machines**, click and select each machine you want tooreplicate.</span></span> <span data-ttu-id="4c213-138">您只能選取可以啟用複寫的機器。</span><span class="sxs-lookup"><span data-stu-id="4c213-138">You can only select machines for which replication can be enabled.</span></span> <span data-ttu-id="4c213-139">然後按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="4c213-139">Then click **OK**.</span></span>

    ![啟用複寫](./media/vmm-to-azure-walkthrough-enable-replication/enable-replication5.png)

7. <span data-ttu-id="4c213-141">在**屬性** > **設定屬性**hello 作業系統選取的 hello 選取 Vm，hello 作業系統磁碟。</span><span class="sxs-lookup"><span data-stu-id="4c213-141">In **Properties** > **Configure properties**, select hello operating system for hello selected VMs, and hello OS disk.</span></span>

    - <span data-ttu-id="4c213-142">確認該 hello Azure VM 名稱 （目標） 符合[Azure 虛擬機器需求](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements)。</span><span class="sxs-lookup"><span data-stu-id="4c213-142">Verify that hello Azure VM name (target name) complies with [Azure virtual machine requirements](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span></span>   
    - <span data-ttu-id="4c213-143">根據預設，所有 hello 磁碟的 hello VM 都選取複寫，但是您可以清除磁碟 tooexclude 它們。</span><span class="sxs-lookup"><span data-stu-id="4c213-143">By default all hello disks of hello VM are selected for replication, but you can clear disks tooexclude them.</span></span>

        - <span data-ttu-id="4c213-144">您可能想 tooexclude 磁碟 tooreduce 複寫的頻寬。</span><span class="sxs-lookup"><span data-stu-id="4c213-144">You might want tooexclude disks tooreduce replication bandwidth.</span></span> <span data-ttu-id="4c213-145">例如，您可能不想 tooreplicate 磁碟取代為暫存資料，或重新整理每次在電腦或應用程式的資料會重新啟動 （例如 pagefile.sys 或 Microsoft SQL Server tempdb）。</span><span class="sxs-lookup"><span data-stu-id="4c213-145">For example, you might not want tooreplicate disks with temporary data, or data that's refreshed each time a machine or apps restarts (such as pagefile.sys or Microsoft SQL Server tempdb).</span></span> <span data-ttu-id="4c213-146">您可以取消選取 hello 磁碟從複寫排除 hello 磁碟。</span><span class="sxs-lookup"><span data-stu-id="4c213-146">You can exclude hello disk from replication by unselecting hello disk.</span></span>
        - <span data-ttu-id="4c213-147">只有基本磁碟可以排除。</span><span class="sxs-lookup"><span data-stu-id="4c213-147">Only basic disks can be exclude.</span></span> <span data-ttu-id="4c213-148">您無法排除作業系統磁碟。</span><span class="sxs-lookup"><span data-stu-id="4c213-148">You can't exclude OS disks.</span></span>
        - <span data-ttu-id="4c213-149">我們建議不要排除動態磁碟。</span><span class="sxs-lookup"><span data-stu-id="4c213-149">We recommend that you don't exclude dynamic disks.</span></span> <span data-ttu-id="4c213-150">Site Recovery 無法識別客體 VM 內的虛擬硬碟為基本還是動態磁碟。</span><span class="sxs-lookup"><span data-stu-id="4c213-150">Site Recovery can't identify whether a virtual hard disk inside a guest VM is basic or dynamic.</span></span> <span data-ttu-id="4c213-151">如果所有相依的動態磁碟區磁碟不排除，hello 受保護的動態磁碟會顯示失敗的磁碟時 hello VM 容錯移轉，而且您無法存取該磁碟上的 hello 資料。</span><span class="sxs-lookup"><span data-stu-id="4c213-151">If all dependent dynamic volume disks aren't excluded, hello protected dynamic disk will show as a failed disk when hello VM fails over, and hello data on that disk won't be accessible.</span></span>
        - <span data-ttu-id="4c213-152">啟用複寫後，您無法加入或移除複寫的磁碟。</span><span class="sxs-lookup"><span data-stu-id="4c213-152">After replication is enabled, you can't add or remove disks for replication.</span></span> <span data-ttu-id="4c213-153">如果您想 tooadd 或排除磁碟，您需要 toodisable 保護 hello VM，並重新啟用它。</span><span class="sxs-lookup"><span data-stu-id="4c213-153">If you want tooadd or exclude a disk, you need toodisable protection for hello VM, and then re-enable it.</span></span>
        - <span data-ttu-id="4c213-154">您以手動方式在 Azure 中建立的磁碟將不會容錯回復。</span><span class="sxs-lookup"><span data-stu-id="4c213-154">Disks you create manually in Azure aren't failed back.</span></span> <span data-ttu-id="4c213-155">比方說，如果您無法超過三個磁碟，並建立兩個直接在 Azure VM 中，只有 hello 三個磁碟已容錯移轉將無法從 Azure tooHyper-V。</span><span class="sxs-lookup"><span data-stu-id="4c213-155">For example, if you fail over three disks, and create two directly in Azure VM, only hello three disks which were failed over will be failed back from Azure tooHyper-V.</span></span> <span data-ttu-id="4c213-156">您不能包含在容錯回復，或從 HYPER-V tooAzure 的反向複寫以手動方式建立的磁碟。</span><span class="sxs-lookup"><span data-stu-id="4c213-156">You can't include disks created manually in failback, or in reverse replication from Hyper-V tooAzure.</span></span>
        - <span data-ttu-id="4c213-157">如果您排除的應用程式 toooperate 所需的磁碟，在容錯移轉 tooAzure 之後您需要的 toocreate 它以手動方式在 Azure 中，因此該 hello 複寫應用程式可以執行。</span><span class="sxs-lookup"><span data-stu-id="4c213-157">If you exclude a disk that's needed for an application toooperate, after failover tooAzure you need toocreate it manually in Azure, so that hello replicated application can run.</span></span> <span data-ttu-id="4c213-158">或者，您無法將 Azure 自動化整合至復原計劃，hello 機器容錯移轉期間 toocreate hello 磁碟。</span><span class="sxs-lookup"><span data-stu-id="4c213-158">Alternatively, you could integrate Azure automation into a recovery plan, toocreate hello disk during failover of hello machine.</span></span>

    <span data-ttu-id="4c213-159">按一下**確定**toosave 變更。</span><span class="sxs-lookup"><span data-stu-id="4c213-159">Click **OK** toosave changes.</span></span> <span data-ttu-id="4c213-160">您可以稍後再設定其他屬性。</span><span class="sxs-lookup"><span data-stu-id="4c213-160">You can set additional properties later.</span></span>

    ![啟用複寫](./media/vmm-to-azure-walkthrough-enable-replication/enable-replication6-with-exclude-disk.png)

8. <span data-ttu-id="4c213-162">在**複寫設定** > **設定複寫設定**，選取您想 tooapply hello 受保護 Vm 的 hello 複寫原則。</span><span class="sxs-lookup"><span data-stu-id="4c213-162">In **Replication settings** > **Configure replication settings**, select hello replication policy you want tooapply for hello protected VMs.</span></span> <span data-ttu-id="4c213-163">然後按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="4c213-163">Then click **OK**.</span></span> <span data-ttu-id="4c213-164">您可以修改中的 hello 複寫原則**複寫原則**> 原則名稱 >**編輯設定**。</span><span class="sxs-lookup"><span data-stu-id="4c213-164">You can modify hello replication policy in **Replication policies** > policy name > **Edit Settings**.</span></span> <span data-ttu-id="4c213-165">您套用的變更用於已在複寫的機器和新的機器。</span><span class="sxs-lookup"><span data-stu-id="4c213-165">Changes you apply are used for machines that are already replicating, and new machines.</span></span>

   ![啟用複寫](./media/vmm-to-azure-walkthrough-enable-replication/enable-replication7.png)

<span data-ttu-id="4c213-167">您可以追蹤進度的 hello**啟用保護**作業中**作業** > **站台復原工作**。</span><span class="sxs-lookup"><span data-stu-id="4c213-167">You can track progress of hello **Enable Protection** job in **Jobs** > **Site Recovery jobs**.</span></span> <span data-ttu-id="4c213-168">之後 hello**完成保護**作業會執行，hello 機器是否已做好容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="4c213-168">After hello **Finalize Protection** job runs, hello machine is ready for failover.</span></span>



## <a name="next-steps"></a><span data-ttu-id="4c213-169">後續步驟</span><span class="sxs-lookup"><span data-stu-id="4c213-169">Next steps</span></span>

<span data-ttu-id="4c213-170">跳過[步驟 12： 執行測試容錯移轉](vmm-to-azure-walkthrough-test-failover.md)</span><span class="sxs-lookup"><span data-stu-id="4c213-170">Go too[Step 12: Run a test failover](vmm-to-azure-walkthrough-test-failover.md)</span></span>
