---
title: "aaaReplicate 應用程式，以 SQL Server 及 Azure Site Recovery |Microsoft 文件"
description: "本文說明如何 tooreplicate SQL Server 的 SQL Server 災害功能使用 Azure Site Recovery。"
services: site-recovery
documentationcenter: 
author: prateek9us
manager: gauravd
editor: 
ms.assetid: 9126f5e8-e9ed-4c31-b6b4-bf969c12c184
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: pratshar
ms.openlocfilehash: 99755f2cd2f7e924071f1e230ac4a0bda88f0a39
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="protect-sql-server-using-sql-server-disaster-recovery-and-azure-site-recovery"></a><span data-ttu-id="436e6-103">使用 SQL Server 災害復原和 Azure Site Recovery 保護 SQL Server</span><span class="sxs-lookup"><span data-stu-id="436e6-103">Protect SQL Server using SQL Server disaster recovery and Azure Site Recovery</span></span>

<span data-ttu-id="436e6-104">本文說明如何 tooprotect hello SQL Server 備份結尾使用的 SQL Server 業務續航力和災害復原 (BCDR) 技術，組合的應用程式和[Azure Site Recovery](site-recovery-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="436e6-104">This article describes how tooprotect hello SQL Server back end of an application using a combination of SQL Server business continuity and disaster recovery (BCDR) technologies, and [Azure Site Recovery](site-recovery-overview.md).</span></span>

<span data-ttu-id="436e6-105">開始之前，請確定您了解 SQL Server 災害復原功能，包括容錯移轉叢集、Always On 可用性群組、資料庫鏡像和記錄傳送。</span><span class="sxs-lookup"><span data-stu-id="436e6-105">Before you start, make sure you understand SQL Server disaster recovery capabilities, including failover clustering, Always On availability groups, database mirroring, and log shipping.</span></span>


## <a name="sql-server-deployments"></a><span data-ttu-id="436e6-106">SQL Server 部署</span><span class="sxs-lookup"><span data-stu-id="436e6-106">SQL Server deployments</span></span>

<span data-ttu-id="436e6-107">許多工作負載使用 SQL Server 為基礎，且它可以與應用程式，例如 SharePoint、 Dynamics 和 SAP、 tooimplement 資料服務整合。</span><span class="sxs-lookup"><span data-stu-id="436e6-107">Many workloads use SQL Server as a foundation, and it can be integrated with apps such as SharePoint, Dynamics, and SAP, tooimplement data services.</span></span>  <span data-ttu-id="436e6-108">有許多方法可以部署 SQL Server：</span><span class="sxs-lookup"><span data-stu-id="436e6-108">SQL Server can be deployed in a number of ways:</span></span>

* <span data-ttu-id="436e6-109">**獨立 SQL Server**：SQL Server 和所有資料庫都裝載在單一電腦 (實體或虛擬) 上。</span><span class="sxs-lookup"><span data-stu-id="436e6-109">**Standalone SQL Server**: SQL Server and all databases are hosted on a single machine (physical or a virtual).</span></span> <span data-ttu-id="436e6-110">如果是虛擬，則主機叢集用於高可用性。</span><span class="sxs-lookup"><span data-stu-id="436e6-110">When virtualized, host clustering is used for local high availability.</span></span> <span data-ttu-id="436e6-111">不實作來賓層級的高可用性。</span><span class="sxs-lookup"><span data-stu-id="436e6-111">Guest-level high availability isn't implemented.</span></span>
* <span data-ttu-id="436e6-112">**SQL Server 容錯移轉叢集執行個體 (Always ON FCI)**：在「Windows 容錯移轉」叢集中設定 2 個或更多個具有共用磁碟的 SQL Server 執行個體節點。</span><span class="sxs-lookup"><span data-stu-id="436e6-112">**SQL Server Failover Clustering Instances (Always On FCI)**: Two or more nodes running SQL Server instanced with shared disks are configured in a Windows Failover cluster.</span></span> <span data-ttu-id="436e6-113">如果節點已關閉，hello 叢集可以容錯 tooanother 執行個體的 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="436e6-113">If a node is down, hello cluster can fail SQL Server over tooanother instance.</span></span> <span data-ttu-id="436e6-114">此安裝程式的主要站台的一般常用的 tooimplement 高可用性。</span><span class="sxs-lookup"><span data-stu-id="436e6-114">This setup is typically used tooimplement high availability at a primary site.</span></span> <span data-ttu-id="436e6-115">此部署不防範失敗或中斷 hello 共用的儲存層。</span><span class="sxs-lookup"><span data-stu-id="436e6-115">This deployment doesn't protect against failure or outage in hello shared storage layer.</span></span> <span data-ttu-id="436e6-116">共用磁碟可以使用 iSCSI、光纖通道或共用 vhdx 來實作。</span><span class="sxs-lookup"><span data-stu-id="436e6-116">A shared disk can be implemented using iSCSI, fiber channel or shared vhdx.</span></span>
* <span data-ttu-id="436e6-117">**SQL Always On 可用性群組**：在不共用任何內容的叢集中設定兩個節點，其中此叢集的 SQL Server 資料庫是設定在具有同步複寫和自動容錯移轉功能的可用性群組中。</span><span class="sxs-lookup"><span data-stu-id="436e6-117">**SQL Always On Availability Groups**: Two or more nodes are set up in a shared nothing cluster, with SQL Server databases configured in an availability group, with synchronous replication and automatic failover.</span></span>

 <span data-ttu-id="436e6-118">這篇文章會利用下列復原資料庫 tooa 遠端站台的原生 SQL 災害復原技術的 hello:</span><span class="sxs-lookup"><span data-stu-id="436e6-118">This article leverages hello following native SQL disaster recovery technologies for recovering databases tooa remote site:</span></span>

* <span data-ttu-id="436e6-119">SQL Alwayson 可用性群組，tooprovide 嚴重損壞修復的 SQL Server 2012 或 2014 Enterprise edition。</span><span class="sxs-lookup"><span data-stu-id="436e6-119">SQL Always On Availability Groups, tooprovide for disaster recovery for SQL Server 2012 or 2014 Enterprise editions.</span></span>
* <span data-ttu-id="436e6-120">SQL Server Standard 版本 (任何版本) 或 SQL Server 2008 R2 的高安全性模式「SQL 資料庫鏡像」。</span><span class="sxs-lookup"><span data-stu-id="436e6-120">SQL database mirroring in high safety mode, for SQL Server Standard edition (any version), or for SQL Server 2008 R2.</span></span>

## <a name="site-recovery-support"></a><span data-ttu-id="436e6-121">Site Recovery 支援</span><span class="sxs-lookup"><span data-stu-id="436e6-121">Site Recovery support</span></span>

### <a name="supported-scenarios"></a><span data-ttu-id="436e6-122">支援的案例</span><span class="sxs-lookup"><span data-stu-id="436e6-122">Supported scenarios</span></span>
<span data-ttu-id="436e6-123">站台復原可以保護 hello 表中摘要說明 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="436e6-123">Site Recovery can protect SQL Server as summarized in hello table.</span></span>

<span data-ttu-id="436e6-124">**案例**</span><span class="sxs-lookup"><span data-stu-id="436e6-124">**Scenario**</span></span> | <span data-ttu-id="436e6-125">**tooa 次要站台**</span><span class="sxs-lookup"><span data-stu-id="436e6-125">**tooa secondary site**</span></span> | <span data-ttu-id="436e6-126">**tooAzure**</span><span class="sxs-lookup"><span data-stu-id="436e6-126">**tooAzure**</span></span>
--- | --- | ---
<span data-ttu-id="436e6-127">**Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="436e6-127">**Hyper-V**</span></span> | <span data-ttu-id="436e6-128">是</span><span class="sxs-lookup"><span data-stu-id="436e6-128">Yes</span></span> | <span data-ttu-id="436e6-129">是</span><span class="sxs-lookup"><span data-stu-id="436e6-129">Yes</span></span>
<span data-ttu-id="436e6-130">**VMware**</span><span class="sxs-lookup"><span data-stu-id="436e6-130">**VMware**</span></span> | <span data-ttu-id="436e6-131">是</span><span class="sxs-lookup"><span data-stu-id="436e6-131">Yes</span></span> | <span data-ttu-id="436e6-132">是</span><span class="sxs-lookup"><span data-stu-id="436e6-132">Yes</span></span>
<span data-ttu-id="436e6-133">**實體伺服器**</span><span class="sxs-lookup"><span data-stu-id="436e6-133">**Physical server**</span></span> | <span data-ttu-id="436e6-134">是</span><span class="sxs-lookup"><span data-stu-id="436e6-134">Yes</span></span> | <span data-ttu-id="436e6-135">是</span><span class="sxs-lookup"><span data-stu-id="436e6-135">Yes</span></span>

### <a name="supported-sql-server-versions"></a><span data-ttu-id="436e6-136">支援的 SQL Server 版本</span><span class="sxs-lookup"><span data-stu-id="436e6-136">Supported SQL Server versions</span></span>
<span data-ttu-id="436e6-137">這些 SQL Server 支援的版本，支援的 hello 案例：</span><span class="sxs-lookup"><span data-stu-id="436e6-137">These SQL Server versions are supported, for hello supported scenarios:</span></span>

* <span data-ttu-id="436e6-138">SQL Server 2016 Enterprise 和 Standard</span><span class="sxs-lookup"><span data-stu-id="436e6-138">SQL Server 2016 Enterprise and Standard</span></span>
* <span data-ttu-id="436e6-139">SQL Server 2014 Enterprise 和 Standard</span><span class="sxs-lookup"><span data-stu-id="436e6-139">SQL Server 2014 Enterprise and Standard</span></span>
* <span data-ttu-id="436e6-140">SQL Server 2012 Enterprise 和 Standard</span><span class="sxs-lookup"><span data-stu-id="436e6-140">SQL Server 2012 Enterprise and Standard</span></span>
* <span data-ttu-id="436e6-141">SQL Server 2008 R2 Enterprise 和 Standard</span><span class="sxs-lookup"><span data-stu-id="436e6-141">SQL Server 2008 R2 Enterprise and Standard</span></span>

### <a name="supported-sql-server-integration"></a><span data-ttu-id="436e6-142">支援的 SQL Server 整合</span><span class="sxs-lookup"><span data-stu-id="436e6-142">Supported SQL Server integration</span></span>

<span data-ttu-id="436e6-143">站台復原可以整合與 hello 表，tooprovide 災害復原方案中摘要說明原生 SQL Server BCDR 技術。</span><span class="sxs-lookup"><span data-stu-id="436e6-143">Site Recovery can be integrated with native SQL Server BCDR technologies summarized in hello table, tooprovide a disaster recovery solution.</span></span>

<span data-ttu-id="436e6-144">**功能**</span><span class="sxs-lookup"><span data-stu-id="436e6-144">**Feature**</span></span> | <span data-ttu-id="436e6-145">**詳細資料**</span><span class="sxs-lookup"><span data-stu-id="436e6-145">**Details**</span></span> | <span data-ttu-id="436e6-146">**SQL Server**</span><span class="sxs-lookup"><span data-stu-id="436e6-146">**SQL Server**</span></span> |
--- | --- | ---
<span data-ttu-id="436e6-147">**Always On 可用性群組**</span><span class="sxs-lookup"><span data-stu-id="436e6-147">**Always On availability group**</span></span> | <span data-ttu-id="436e6-148">多個 SQL Server 獨立執行個體中，每個都在含有多個節點的容錯移轉叢集中執行。</span><span class="sxs-lookup"><span data-stu-id="436e6-148">Multiple standalone instances of SQL Server each run in a failover cluster that has multiple nodes.</span></span><br/><br/><span data-ttu-id="436e6-149">資料庫可以分組到可以在 SQL Server 執行個體上複製 (鏡像) 的容錯移轉群組，因此不需要任何共用儲存體。</span><span class="sxs-lookup"><span data-stu-id="436e6-149">Databases can be grouped into failover groups that can be copied (mirrored) on SQL Server instances so that no shared storage is needed.</span></span><br/><br/><span data-ttu-id="436e6-150">在主要站台與一或多個次要站台之間提供災害復原功能。</span><span class="sxs-lookup"><span data-stu-id="436e6-150">Provides disaster recovery between a primary site and one or more secondary sites.</span></span> <span data-ttu-id="436e6-151">使用同步複寫與自動容錯移轉在可用性群組中設定 SQL Server 資料庫時，可以在不共用任何內容的叢集中設定兩個節點。</span><span class="sxs-lookup"><span data-stu-id="436e6-151">Two nodes can be set up in a shared nothing cluster with SQL Server databases configured in an availability group with synchronous replication and automatic failover.</span></span> | <span data-ttu-id="436e6-152">SQL Server 2014 和 2012 Enterprise 版本</span><span class="sxs-lookup"><span data-stu-id="436e6-152">SQL Server 2014 & 2012 Enterprise edition</span></span>
<span data-ttu-id="436e6-153">**容錯移轉叢集 (Always On FCI)**</span><span class="sxs-lookup"><span data-stu-id="436e6-153">**Failover clustering (Always On FCI)**</span></span> | <span data-ttu-id="436e6-154">SQL Server 會針對內部部署 SQL Server 工作負載的高可用性，運用 Windows 容錯移轉叢集。</span><span class="sxs-lookup"><span data-stu-id="436e6-154">SQL Server leverages Windows failover clustering for high availability of on-premises SQL Server workloads.</span></span><br/><br/><span data-ttu-id="436e6-155">使用共用磁碟執行 SQL Server 執行個體的節點是在容錯移轉叢集中設定。</span><span class="sxs-lookup"><span data-stu-id="436e6-155">Nodes running instances of SQL Server with shared disks are configured in a failover cluster.</span></span> <span data-ttu-id="436e6-156">如果執行個體已關閉 hello 叢集會容錯移轉 toodifferent 其中一個。</span><span class="sxs-lookup"><span data-stu-id="436e6-156">If an instance is down hello cluster fails over toodifferent one.</span></span><br/><br/><span data-ttu-id="436e6-157">hello 叢集不防範失敗或中斷共用存放裝置中。</span><span class="sxs-lookup"><span data-stu-id="436e6-157">hello cluster doesn't protect against failure or outages in shared storage.</span></span> <span data-ttu-id="436e6-158">hello 共用的磁碟可以使用 iSCSI、 光纖通道實作，或共用 Vhdx。</span><span class="sxs-lookup"><span data-stu-id="436e6-158">hello shared disk can be implemented with iSCSI, fiber channel, or shared VHDXs.</span></span> | <span data-ttu-id="436e6-159">SQL Server Enterprise Edition</span><span class="sxs-lookup"><span data-stu-id="436e6-159">SQL Server Enterprise editions</span></span><br/><br/><span data-ttu-id="436e6-160">SQL Server Standard edition （有限的 tootwo 節點）</span><span class="sxs-lookup"><span data-stu-id="436e6-160">SQL Server Standard edition (limited tootwo nodes only)</span></span>
<span data-ttu-id="436e6-161">**資料庫鏡像 (高安全性模式)**</span><span class="sxs-lookup"><span data-stu-id="436e6-161">**Database mirroring (high safety mode)**</span></span> | <span data-ttu-id="436e6-162">保護單一資料庫 tooa 單一次要複本。</span><span class="sxs-lookup"><span data-stu-id="436e6-162">Protects a single database tooa single secondary copy.</span></span> <span data-ttu-id="436e6-163">提供高安全性 (同步) 和高效能 (非同步) 複寫模式。</span><span class="sxs-lookup"><span data-stu-id="436e6-163">Available in both high safety (synchronous) and high performance (asynchronous) replication modes.</span></span> <span data-ttu-id="436e6-164">不需要容錯移轉叢集。</span><span class="sxs-lookup"><span data-stu-id="436e6-164">Doesn’t require a failover cluster.</span></span> | <span data-ttu-id="436e6-165">SQL Server 2008 R2</span><span class="sxs-lookup"><span data-stu-id="436e6-165">SQL Server 2008 R2</span></span><br/><br/><span data-ttu-id="436e6-166">SQL Server Enterprise 所有版本</span><span class="sxs-lookup"><span data-stu-id="436e6-166">SQL Server Enterprise all editions</span></span>
<span data-ttu-id="436e6-167">**獨立式 SQL Server**</span><span class="sxs-lookup"><span data-stu-id="436e6-167">**Standalone SQL Server**</span></span> | <span data-ttu-id="436e6-168">hello SQL Server 和資料庫裝載在單一伺服器 （實體或虛擬）。</span><span class="sxs-lookup"><span data-stu-id="436e6-168">hello SQL Server and database are hosted on a single server (physical or virtual).</span></span> <span data-ttu-id="436e6-169">如果 hello 伺服器為虛擬，主機叢集會使用高可用性。</span><span class="sxs-lookup"><span data-stu-id="436e6-169">Host clustering is used for high availability if hello server is virtual.</span></span> <span data-ttu-id="436e6-170">沒有來賓層級的高可用性。</span><span class="sxs-lookup"><span data-stu-id="436e6-170">No guest-level high availability.</span></span> | <span data-ttu-id="436e6-171">Enterprise 或 Standard Edition</span><span class="sxs-lookup"><span data-stu-id="436e6-171">Enterprise or Standard edition</span></span>

## <a name="deployment-recommendations"></a><span data-ttu-id="436e6-172">部署建議</span><span class="sxs-lookup"><span data-stu-id="436e6-172">Deployment recommendations</span></span>

<span data-ttu-id="436e6-173">下表摘要說明我們將 SQL Server BCDR 技術與 Site Recovery 整合的建議。</span><span class="sxs-lookup"><span data-stu-id="436e6-173">This table summarizes our recommendations for integrating SQL Server BCDR technologies with Site Recovery.</span></span>

| <span data-ttu-id="436e6-174">**版本**</span><span class="sxs-lookup"><span data-stu-id="436e6-174">**Version**</span></span> | <span data-ttu-id="436e6-175">**版本**</span><span class="sxs-lookup"><span data-stu-id="436e6-175">**Edition**</span></span> | <span data-ttu-id="436e6-176">**部署**</span><span class="sxs-lookup"><span data-stu-id="436e6-176">**Deployment**</span></span> | <span data-ttu-id="436e6-177">**內部 tooon 內部**</span><span class="sxs-lookup"><span data-stu-id="436e6-177">**On-prem tooon-prem**</span></span> | <span data-ttu-id="436e6-178">**內部 tooAzure**</span><span class="sxs-lookup"><span data-stu-id="436e6-178">**On-prem tooAzure**</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="436e6-179">SQL Server 2014 或 2012</span><span class="sxs-lookup"><span data-stu-id="436e6-179">SQL Server 2014 or 2012</span></span> |<span data-ttu-id="436e6-180">Enterprise</span><span class="sxs-lookup"><span data-stu-id="436e6-180">Enterprise</span></span> |<span data-ttu-id="436e6-181">容錯移轉叢集執行個體</span><span class="sxs-lookup"><span data-stu-id="436e6-181">Failover cluster instance</span></span> |<span data-ttu-id="436e6-182">Always On 可用性群組</span><span class="sxs-lookup"><span data-stu-id="436e6-182">Always On availability groups</span></span> |<span data-ttu-id="436e6-183">Always On 可用性群組</span><span class="sxs-lookup"><span data-stu-id="436e6-183">Always On availability groups</span></span> |
|| <span data-ttu-id="436e6-184">Enterprise</span><span class="sxs-lookup"><span data-stu-id="436e6-184">Enterprise</span></span> |<span data-ttu-id="436e6-185">高可用性的 Always On 可用性群組</span><span class="sxs-lookup"><span data-stu-id="436e6-185">Always On availability groups for high availability</span></span> |<span data-ttu-id="436e6-186">Always On 可用性群組</span><span class="sxs-lookup"><span data-stu-id="436e6-186">Always On availability groups</span></span> |<span data-ttu-id="436e6-187">Always On 可用性群組</span><span class="sxs-lookup"><span data-stu-id="436e6-187">Always On availability groups</span></span> | |
|| <span data-ttu-id="436e6-188">標準</span><span class="sxs-lookup"><span data-stu-id="436e6-188">Standard</span></span> |<span data-ttu-id="436e6-189">容錯移轉叢集執行個體 (FCI)</span><span class="sxs-lookup"><span data-stu-id="436e6-189">Failover cluster instance (FCI)</span></span> |<span data-ttu-id="436e6-190">包含本機鏡像的 Site Recovery 複寫</span><span class="sxs-lookup"><span data-stu-id="436e6-190">Site Recovery replication with local mirror</span></span> |<span data-ttu-id="436e6-191">包含本機鏡像的 Site Recovery 複寫</span><span class="sxs-lookup"><span data-stu-id="436e6-191">Site Recovery replication with local mirror</span></span> | |
|| <span data-ttu-id="436e6-192">Enterprise 或 Standard</span><span class="sxs-lookup"><span data-stu-id="436e6-192">Enterprise or Standard</span></span> |<span data-ttu-id="436e6-193">獨立</span><span class="sxs-lookup"><span data-stu-id="436e6-193">Standalone</span></span> |<span data-ttu-id="436e6-194">Site Recovery 複寫</span><span class="sxs-lookup"><span data-stu-id="436e6-194">Site Recovery replication</span></span> |<span data-ttu-id="436e6-195">Site Recovery 複寫</span><span class="sxs-lookup"><span data-stu-id="436e6-195">Site Recovery replication</span></span> | |
| <span data-ttu-id="436e6-196">SQL Server 2008 R2 或 2008</span><span class="sxs-lookup"><span data-stu-id="436e6-196">SQL Server 2008 R2 or 2008</span></span> |<span data-ttu-id="436e6-197">Enterprise 或 Standard</span><span class="sxs-lookup"><span data-stu-id="436e6-197">Enterprise or Standard</span></span> |<span data-ttu-id="436e6-198">容錯移轉叢集執行個體 (FCI)</span><span class="sxs-lookup"><span data-stu-id="436e6-198">Failover cluster instance (FCI)</span></span> |<span data-ttu-id="436e6-199">包含本機鏡像的 Site Recovery 複寫</span><span class="sxs-lookup"><span data-stu-id="436e6-199">Site Recovery replication with local mirror</span></span> |<span data-ttu-id="436e6-200">包含本機鏡像的 Site Recovery 複寫</span><span class="sxs-lookup"><span data-stu-id="436e6-200">Site Recovery replication with local mirror</span></span> |
|| <span data-ttu-id="436e6-201">Enterprise 或 Standard</span><span class="sxs-lookup"><span data-stu-id="436e6-201">Enterprise or Standard</span></span> |<span data-ttu-id="436e6-202">獨立</span><span class="sxs-lookup"><span data-stu-id="436e6-202">Standalone</span></span> |<span data-ttu-id="436e6-203">Site Recovery 複寫</span><span class="sxs-lookup"><span data-stu-id="436e6-203">Site Recovery replication</span></span> |<span data-ttu-id="436e6-204">Site Recovery 複寫</span><span class="sxs-lookup"><span data-stu-id="436e6-204">Site Recovery replication</span></span> | |
| <span data-ttu-id="436e6-205">SQL Server (任何版本)</span><span class="sxs-lookup"><span data-stu-id="436e6-205">SQL Server (Any version)</span></span> |<span data-ttu-id="436e6-206">Enterprise 或 Standard</span><span class="sxs-lookup"><span data-stu-id="436e6-206">Enterprise or Standard</span></span> |<span data-ttu-id="436e6-207">容錯移轉叢集執行個體 - DTC 應用程式</span><span class="sxs-lookup"><span data-stu-id="436e6-207">Failover cluster instance - DTC application</span></span> |<span data-ttu-id="436e6-208">Site Recovery 複寫</span><span class="sxs-lookup"><span data-stu-id="436e6-208">Site Recovery replication</span></span> |<span data-ttu-id="436e6-209">不支援</span><span class="sxs-lookup"><span data-stu-id="436e6-209">Not Supported</span></span> |

## <a name="deployment-prerequisites"></a><span data-ttu-id="436e6-210">部署必要條件</span><span class="sxs-lookup"><span data-stu-id="436e6-210">Deployment prerequisites</span></span>

* <span data-ttu-id="436e6-211">執行支援的 SQL Server 版本的內部部署 SQL Server 部署。</span><span class="sxs-lookup"><span data-stu-id="436e6-211">An on-premises SQL Server deployment, running a supported SQL Server version.</span></span> <span data-ttu-id="436e6-212">通常，您的 SQL Server 也需要 Active Directory。</span><span class="sxs-lookup"><span data-stu-id="436e6-212">Typically, you also need Active Directory for your SQL server.</span></span>
* <span data-ttu-id="436e6-213">hello 需求 hello 想 toodeploy 案例。</span><span class="sxs-lookup"><span data-stu-id="436e6-213">hello requirements for hello scenario you want toodeploy.</span></span> <span data-ttu-id="436e6-214">深入了解支援需求[複寫 tooAzure](site-recovery-support-matrix-to-azure.md)和[內部](site-recovery-support-matrix.md)，和[部署必要條件](site-recovery-prereq.md)。</span><span class="sxs-lookup"><span data-stu-id="436e6-214">Learn more about support requirements for [replication tooAzure](site-recovery-support-matrix-to-azure.md) and [on-premises](site-recovery-support-matrix.md), and [deployment prerequisites](site-recovery-prereq.md).</span></span>
* <span data-ttu-id="436e6-215">在 Azure 中，執行 hello 復原 tooset [Azure 虛擬機器整備評估](http://www.microsoft.com/download/details.aspx?id=40898)toomake 確定它們相容與 Azure Site Recovery 的工具 SQL Server 虛擬機器上。</span><span class="sxs-lookup"><span data-stu-id="436e6-215">tooset up recovery in Azure, run hello [Azure Virtual Machine Readiness Assessment](http://www.microsoft.com/download/details.aspx?id=40898) tool on your SQL Server virtual machines, toomake sure they're compatible with Azure and Site Recovery.</span></span>

## <a name="set-up-active-directory"></a><span data-ttu-id="436e6-216">設定 Active Directory</span><span class="sxs-lookup"><span data-stu-id="436e6-216">Set up Active Directory</span></span>

<span data-ttu-id="436e6-217">適當地設定 hello 復原次要站台，而 SQL Server toorun 中 Active Directory。</span><span class="sxs-lookup"><span data-stu-id="436e6-217">Set up Active Directory, in hello secondary recovery site, for SQL Server toorun properly.</span></span>

* <span data-ttu-id="436e6-218">**小型企業**— 少量應用程式和 hello 在內部部署站台的單一網域控制站，如果您想 toofail 透過 hello 整個站台，我們建議您使用站台復原複寫 tooreplicate hello 網域控制站toohello 次要資料中心或 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="436e6-218">**Small enterprise**—With a small number of applications, and single domain controller for hello on-premises site, if you want toofail over hello entire site, we recommend you use Site Recovery replication tooreplicate hello domain controller toohello secondary datacenter, or tooAzure.</span></span>
* <span data-ttu-id="436e6-219">**中度 toolarge 企業**— 如果您有大量的應用程式，Active Directory 樹系，而且您想 toofail 依應用程式或工作負載，我們建議您設定在 hello 次要資料中心或其他網域控制站Azure。</span><span class="sxs-lookup"><span data-stu-id="436e6-219">**Medium toolarge enterprise**—If you have a large number of applications, an Active Directory forest, and you want toofail over by application or workload, we recommend you set up an additional domain controller in hello secondary datacenter, or in Azure.</span></span> <span data-ttu-id="436e6-220">如果您使用 Alwayson 可用性群組 toorecover tooa 遠端站台，建議您設定另一個的額外網域控制站 hello 次要站台上或在 Azure 中，toouse hello 復原 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="436e6-220">If you're using Always On availability groups toorecover tooa remote site, we recommend you set up another additional domain controller on hello secondary site or in Azure, toouse for hello recovered SQL Server instance.</span></span>

<span data-ttu-id="436e6-221">這篇文章中的 hello 指示會假設為 hello 次要位置中的網域控制站為可用。</span><span class="sxs-lookup"><span data-stu-id="436e6-221">hello instructions in this article presume that a domain controller is available in hello secondary location.</span></span> <span data-ttu-id="436e6-222">[閱讀更多](site-recovery-active-directory.md) 有關使用 Site Recovery 保護 Active Directory。</span><span class="sxs-lookup"><span data-stu-id="436e6-222">[Read more](site-recovery-active-directory.md) about protecting Active Directory with Site Recovery.</span></span>


## <a name="integrate-with-sql-server-always-on-for-replication-tooazure"></a><span data-ttu-id="436e6-223">針對複寫 tooAzure 整合與 SQL Server Alwayson</span><span class="sxs-lookup"><span data-stu-id="436e6-223">Integrate with SQL Server Always On for replication tooAzure</span></span>

<span data-ttu-id="436e6-224">以下是您的需要 toodo:</span><span class="sxs-lookup"><span data-stu-id="436e6-224">Here's what you need toodo:</span></span>

1. <span data-ttu-id="436e6-225">將指令碼匯入您的 Azure 自動化帳戶。</span><span class="sxs-lookup"><span data-stu-id="436e6-225">Import scripts into your Azure Automation account.</span></span> <span data-ttu-id="436e6-226">這包含 hello 指令碼 toofailover SQL 可用性群組中[資源管理員虛擬機器](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/asr-automation-recovery/scripts/ASR-SQL-FailoverAG.ps1)和[傳統虛擬機器](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/asr-automation-recovery/scripts/ASR-SQL-FailoverAGClassic.ps1)。</span><span class="sxs-lookup"><span data-stu-id="436e6-226">This contains hello scripts toofailover SQL Availability Group in a [Resource Manager virtual machine](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/asr-automation-recovery/scripts/ASR-SQL-FailoverAG.ps1) and a [Classic virtual machine](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/asr-automation-recovery/scripts/ASR-SQL-FailoverAGClassic.ps1).</span></span>

    <span data-ttu-id="436e6-227">[![部署 tooAzure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span><span class="sxs-lookup"><span data-stu-id="436e6-227">[![Deploy tooAzure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span></span>


1. <span data-ttu-id="436e6-228">新增 ASR-SQL-FailoverAG 以 hello hello 復原方案的第一個群組前動作。</span><span class="sxs-lookup"><span data-stu-id="436e6-228">Add ASR-SQL-FailoverAG as a pre action of hello first group of hello recovery plan.</span></span>

1. <span data-ttu-id="436e6-229">請遵循 hello hello 可用性群組的可用 hello 指令碼 toocreate 自動化變數 tooprovide hello 名稱中的指示。</span><span class="sxs-lookup"><span data-stu-id="436e6-229">Follow hello instructions available in hello script toocreate an automation variable tooprovide hello name of hello availability groups.</span></span>

### <a name="steps-toodo-a-test-failover"></a><span data-ttu-id="436e6-230">步驟 toodo 測試容錯移轉</span><span class="sxs-lookup"><span data-stu-id="436e6-230">Steps toodo a test failover</span></span>

<span data-ttu-id="436e6-231">SQL Always On 原本就不支援測試容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="436e6-231">SQL Always On doesn’t natively support test failover.</span></span> <span data-ttu-id="436e6-232">因此，我們建議下列 hello:</span><span class="sxs-lookup"><span data-stu-id="436e6-232">Therefore, we recommend hello following:</span></span>

1. <span data-ttu-id="436e6-233">設定[Azure Backup](../backup/backup-azure-vms.md) hello 裝載在 Azure 中的 hello 可用性群組複本的虛擬機器上。</span><span class="sxs-lookup"><span data-stu-id="436e6-233">Set up [Azure Backup](../backup/backup-azure-vms.md) on hello virtual machine that hosts hello availability group replica in Azure.</span></span>

1. <span data-ttu-id="436e6-234">觸發 hello 復原計劃的測試容錯移轉之前, 復原 hello 備份是取自 hello 上一個步驟中的 hello 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="436e6-234">Before triggering test failover of hello recovery plan, recover hello virtual machine from hello backup taken in hello previous step.</span></span>

    ![<span data-ttu-id="436e6-235">從 Azure 備份還原</span><span class="sxs-lookup"><span data-stu-id="436e6-235">Restore from Azure Backup</span></span> ](./media/site-recovery-sql/restore-from-backup.png)

1. <span data-ttu-id="436e6-236">[強制仲裁](https://docs.microsoft.com/sql/sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum#PowerShellProcedure)hello 從備份還原的虛擬機器中。</span><span class="sxs-lookup"><span data-stu-id="436e6-236">[Force a quorum](https://docs.microsoft.com/sql/sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum#PowerShellProcedure) in hello virtual machine restored from backup.</span></span>

1. <span data-ttu-id="436e6-237">更新 hello 接聽程式 tooan IP hello 測試容錯移轉網路中可用的 IP。</span><span class="sxs-lookup"><span data-stu-id="436e6-237">Update IP of hello listener tooan IP available in hello test failover network.</span></span>

    ![更新接聽程式 IP](./media/site-recovery-sql/update-listener-ip.png)

1. <span data-ttu-id="436e6-239">使接聽程式上線。</span><span class="sxs-lookup"><span data-stu-id="436e6-239">Bring listener online.</span></span>

    ![使接聽程式上線](./media/site-recovery-sql/bring-listener-online.png)

1. <span data-ttu-id="436e6-241">前端 IP 集區對應 tooeach 可用性群組接聽程式底下建立一個 IP 與 hello SQL 虛擬機器加入 hello 後端集區中建立負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="436e6-241">Create a load balancer with one IP created under frontend IP pool corresponding tooeach availability group listener and with hello SQL virtual machine added in hello backend pool.</span></span>

     ![<span data-ttu-id="436e6-242">建立負載平衡器 - 前端 IP 集區</span><span class="sxs-lookup"><span data-stu-id="436e6-242">Create Load Balancer - Frontend IP pool</span></span> ](./media/site-recovery-sql/create-load-balancer1.png)

    ![<span data-ttu-id="436e6-243">建立負載平衡器 - 後端集區</span><span class="sxs-lookup"><span data-stu-id="436e6-243">Create Load Balancer - Backend pool</span></span> ](./media/site-recovery-sql/create-load-balancer2.png)

1. <span data-ttu-id="436e6-244">請勿 hello 復原計劃的測試容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="436e6-244">Do a test failover of hello recovery plan.</span></span>

### <a name="steps-toodo-a-failover"></a><span data-ttu-id="436e6-245">步驟 toodo 容錯移轉</span><span class="sxs-lookup"><span data-stu-id="436e6-245">Steps toodo a failover</span></span>

<span data-ttu-id="436e6-246">一旦您加入 hello 指令碼 hello 復原計劃和已驗證的 hello 復原方案中執行測試容錯移轉，您可以 hello 復原計劃的容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="436e6-246">Once you have added hello script in hello recovery plan and validated hello recovery plan by doing a test failover, you can do failover of hello recovery plan.</span></span>


## <a name="integrate-with-sql-server-always-on-for-replication-tooa-secondary-on-premises-site"></a><span data-ttu-id="436e6-247">整合複寫 tooa 次要內部部署站台的 SQL Server Alwayson</span><span class="sxs-lookup"><span data-stu-id="436e6-247">Integrate with SQL Server Always On for replication tooa secondary on-premises site</span></span>

<span data-ttu-id="436e6-248">如果 hello SQL Server 會使用高可用性 （或 FCI） 的可用性群組，建議使用 hello 復原網站上的可用性群組。</span><span class="sxs-lookup"><span data-stu-id="436e6-248">If hello SQL Server is using availability groups for high availability (or an FCI), we recommend using availability groups on hello recovery site as well.</span></span> <span data-ttu-id="436e6-249">請注意這適用於不使用分散式的交易的 tooapps。</span><span class="sxs-lookup"><span data-stu-id="436e6-249">Note that this applies tooapps that don't use distributed transactions.</span></span>

1. <span data-ttu-id="436e6-250">[設定資料庫](https://msdn.microsoft.com/library/hh213078.aspx) 。</span><span class="sxs-lookup"><span data-stu-id="436e6-250">[Configure databases](https://msdn.microsoft.com/library/hh213078.aspx) into availability groups.</span></span>
1. <span data-ttu-id="436e6-251">Hello 次要站台上建立虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="436e6-251">Create a virtual network on hello secondary site.</span></span>
1. <span data-ttu-id="436e6-252">設定站對站 VPN 連線之間 hello 虛擬網路和 hello 主要站台。</span><span class="sxs-lookup"><span data-stu-id="436e6-252">Set up a site-to-site VPN connection between hello virtual network, and hello primary site.</span></span>
1. <span data-ttu-id="436e6-253">虛擬機器上建立 hello 復原站台，並在其上安裝 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="436e6-253">Create a virtual machine on hello recovery site, and install SQL Server on it.</span></span>
1. <span data-ttu-id="436e6-254">擴充 hello 現有 Alwayson 可用性群組 toohello 新的 SQL Server VM。</span><span class="sxs-lookup"><span data-stu-id="436e6-254">Extend hello existing Always On availability groups toohello new SQL Server VM.</span></span> <span data-ttu-id="436e6-255">將此 SQL Server 執行個體設定為非同步複本。</span><span class="sxs-lookup"><span data-stu-id="436e6-255">Configure this SQL Server instance as an asynchronous replica copy.</span></span>
1. <span data-ttu-id="436e6-256">建立可用性群組接聽程式，或更新 hello 現有接聽程式 tooinclude hello 非同步複本虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="436e6-256">Create an availability group listener, or update hello existing listener tooinclude hello asynchronous replica virtual machine.</span></span>
1. <span data-ttu-id="436e6-257">請確定該 hello 應用程式伺服器陣列已設定使用 hello 接聽程式。</span><span class="sxs-lookup"><span data-stu-id="436e6-257">Make sure that hello application farm is set up using hello listener.</span></span> <span data-ttu-id="436e6-258">如果它是安裝程式使用 hello 資料庫伺服器名稱，來更新它 toouse hello 接聽程式，因此您不需要 tooreconfigure hello 容錯移轉之後。</span><span class="sxs-lookup"><span data-stu-id="436e6-258">If it's setup up using hello database server name, update it toouse hello listener, so you don't need tooreconfigure it after hello failover.</span></span>

<span data-ttu-id="436e6-259">對於使用分散式交易的應用程式，建議您使用 [VMware/實體伺服器站對站複寫](site-recovery-vmware-to-vmware.md)來部署 Site Recovery。</span><span class="sxs-lookup"><span data-stu-id="436e6-259">For applications that use distributed transactions, we recommend you deploy Site Recovery with [VMware/physical server site-to-site replication](site-recovery-vmware-to-vmware.md).</span></span>

### <a name="recovery-plan-considerations"></a><span data-ttu-id="436e6-260">復原計畫考量</span><span class="sxs-lookup"><span data-stu-id="436e6-260">Recovery plan considerations</span></span>
1. <span data-ttu-id="436e6-261">將這個範例指令碼 toohello VMM 程式庫，hello 主要和次要站台上。</span><span class="sxs-lookup"><span data-stu-id="436e6-261">Add this sample script toohello VMM library, on hello primary and secondary sites.</span></span>

        Param(
        [string]$SQLAvailabilityGroupPath
        )
        import-module sqlps
        Switch-SqlAvailabilityGroup -Path $SQLAvailabilityGroupPath -AllowDataLoss -force

1. <span data-ttu-id="436e6-262">當您建立 hello 應用程式的復原計劃時，新增一個前置動作 tooGroup 1 已編寫指令碼的步驟，移轉可用性群組叫用 hello 指令碼 toofail。</span><span class="sxs-lookup"><span data-stu-id="436e6-262">When you create a recovery plan for hello application, add a pre action tooGroup-1 scripted step, that invokes hello script toofail over availability groups.</span></span>

## <a name="protect-a-standalone-sql-server"></a><span data-ttu-id="436e6-263">保護獨立式 SQL Server</span><span class="sxs-lookup"><span data-stu-id="436e6-263">Protect a standalone SQL Server</span></span>

<span data-ttu-id="436e6-264">在此案例中，我們建議您使用站台復原複寫 tooprotect hello SQL Server 電腦。</span><span class="sxs-lookup"><span data-stu-id="436e6-264">In this scenario, we recommend that you use Site Recovery replication tooprotect hello SQL Server machine.</span></span> <span data-ttu-id="436e6-265">hello 確切步驟取決於 SQL Server 是否 VM 或實體伺服器上，以及是否要 tooreplicate tooAzure 或次要內部部署站台。</span><span class="sxs-lookup"><span data-stu-id="436e6-265">hello exact steps will depend whether SQL Server is a VM or a physical server, and whether you want tooreplicate tooAzure or a secondary on-premises site.</span></span> <span data-ttu-id="436e6-266">了解 [Site Recovery 案例](site-recovery-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="436e6-266">Learn about [Site Recovery scenarios](site-recovery-overview.md).</span></span>

## <a name="protect-a-sql-server-cluster-standard-editionwindows-server-2008-r2"></a><span data-ttu-id="436e6-267">保護 SQL Server 叢集 (標準版/Windows Server 2008 R2)</span><span class="sxs-lookup"><span data-stu-id="436e6-267">Protect a SQL Server cluster (standard edition/Windows Server 2008 R2)</span></span>

<span data-ttu-id="436e6-268">執行 SQL Server Standard edition 或 SQL Server 2008 R2 的叢集，我們建議您針對使用站台復原複寫 tooprotect SQL Server。</span><span class="sxs-lookup"><span data-stu-id="436e6-268">For a cluster running SQL Server Standard edition, or SQL Server 2008 R2, we recommend you use Site Recovery replication tooprotect SQL Server.</span></span>

### <a name="on-premises-tooon-premises"></a><span data-ttu-id="436e6-269">在內部部署內部部署 tooon</span><span class="sxs-lookup"><span data-stu-id="436e6-269">On-premises tooon-premises</span></span>

* <span data-ttu-id="436e6-270">如果 hello 應用程式使用分散式的交易我們建議您部署[使用 SAN 複寫的站台復原](site-recovery-vmm-san.md)HYPER-V 環境中，或[VMware/實體伺服器 tooVMware](site-recovery-vmware-to-vmware.md)的 VMware 環境。</span><span class="sxs-lookup"><span data-stu-id="436e6-270">If hello app uses distributed transactions we recommend you deploy [Site Recovery with SAN replication](site-recovery-vmm-san.md) for a Hyper-V environment, or [VMware/physical server tooVMware](site-recovery-vmware-to-vmware.md) for a VMware environment.</span></span>
* <span data-ttu-id="436e6-271">非 DTC 應用程式，使用上述方法 toorecover hello 叢集 hello 做為獨立伺服器，利用本機的高安全性資料庫鏡像。</span><span class="sxs-lookup"><span data-stu-id="436e6-271">For non-DTC applications, use hello above approach toorecover hello cluster as a standalone server, by leveraging a local high safety DB mirror.</span></span>

### <a name="on-premises-tooazure"></a><span data-ttu-id="436e6-272">在內部部署 tooAzure</span><span class="sxs-lookup"><span data-stu-id="436e6-272">On-premises tooAzure</span></span>

<span data-ttu-id="436e6-273">Site Recovery 並不提供客體叢集支援複寫 tooAzure 時。</span><span class="sxs-lookup"><span data-stu-id="436e6-273">Site Recovery doesn't provide guest cluster support when replicating tooAzure.</span></span> <span data-ttu-id="436e6-274">SQL Server 也不會為 Standard Edition 提供低成本的災害復原解決方案。</span><span class="sxs-lookup"><span data-stu-id="436e6-274">SQL Server also doesn't provide a low-cost disaster recovery solution for Standard edition.</span></span> <span data-ttu-id="436e6-275">在此案例中，我們建議您保護 hello 在內部部署 SQL Server 叢集 tooa 獨立 SQL Server，然後在 Azure 中進行復原。</span><span class="sxs-lookup"><span data-stu-id="436e6-275">In this scenario, we recommend you protect hello on-premises SQL Server cluster tooa standalone SQL Server, and recover it in Azure.</span></span>

1. <span data-ttu-id="436e6-276">Hello 在內部部署站台上設定其他的獨立 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="436e6-276">Configure an additional standalone SQL Server instance on hello on-premises site.</span></span>
1. <span data-ttu-id="436e6-277">Hello 資料庫您，做為鏡像設定 hello 執行個體 tooserve 想 tooprotect。</span><span class="sxs-lookup"><span data-stu-id="436e6-277">Configure hello instance tooserve as a mirror for hello databases you want tooprotect.</span></span> <span data-ttu-id="436e6-278">在高安全性模式下設定鏡像。</span><span class="sxs-lookup"><span data-stu-id="436e6-278">Configure mirroring in high safety mode.</span></span>
1. <span data-ttu-id="436e6-279">設定的 hello 在內部部署站台，站台復原 ([HYPER-V](site-recovery-hyper-v-site-to-azure.md)或[VMware Vm/實體伺服器)](site-recovery-vmware-to-azure-classic.md)。</span><span class="sxs-lookup"><span data-stu-id="436e6-279">Configure Site Recovery on hello on-premises site, for ([Hyper-V](site-recovery-hyper-v-site-to-azure.md) or [VMware VMs/physical servers)](site-recovery-vmware-to-azure-classic.md).</span></span>
1. <span data-ttu-id="436e6-280">使用站台復原複寫 tooreplicate hello 新 SQL Server 執行個體 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="436e6-280">Use Site Recovery replication tooreplicate hello new SQL Server instance tooAzure.</span></span> <span data-ttu-id="436e6-281">因為這是高安全性的鏡像副本，將與 hello 主要叢集中，同步處理，但實際上會使用站台復原複寫的複寫的 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="436e6-281">Since it's a high safety mirror copy, it will be synchronized with hello primary cluster, but it will be replicated tooAzure using Site Recovery replication.</span></span>


![標準叢集](./media/site-recovery-sql/standalone-cluster-local.png)

### <a name="failback-considerations"></a><span data-ttu-id="436e6-283">容錯回復考量</span><span class="sxs-lookup"><span data-stu-id="436e6-283">Failback considerations</span></span>

<span data-ttu-id="436e6-284">SQL Server Standard 的叢集，發生未規劃的容錯移轉後容錯回復需要 SQL server 備份及還原中，從 hello 鏡像執行個體 toohello 原始叢集 reestablishment hello 鏡像的一部分。</span><span class="sxs-lookup"><span data-stu-id="436e6-284">For SQL Server Standard clusters, failback after an unplanned failover requires a SQL server backup and restore, from hello mirror instance toohello original cluster, with reestablishment of hello mirror.</span></span>

## <a name="next-steps"></a><span data-ttu-id="436e6-285">後續步驟</span><span class="sxs-lookup"><span data-stu-id="436e6-285">Next steps</span></span>
<span data-ttu-id="436e6-286">[深入了解](site-recovery-components.md) Site Recovery 架構。</span><span class="sxs-lookup"><span data-stu-id="436e6-286">[Learn more](site-recovery-components.md) about Site Recovery architecture.</span></span>
