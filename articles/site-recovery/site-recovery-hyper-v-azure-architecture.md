---
title: "Site Recovery 中的 HYPER-V 複寫 tooAzure 運作 aaaHow？ | Microsoft Docs"
description: "這篇文章提供在 Azure Site Recovery 中 Hyper-V 複寫運作方式的概觀"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/14/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: site-recovery-architecture-hyper-v-to-azure
ms.openlocfilehash: e982806b4d6cdec2f71f82d8c73c17cc50ad3c33
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="how-does-hyper-v-replication-tooazure-work"></a><span data-ttu-id="8668c-104">HYPER-V 複寫 tooAzure 的運作方式為何？</span><span class="sxs-lookup"><span data-stu-id="8668c-104">How does Hyper-V replication tooAzure work?</span></span>

<span data-ttu-id="8668c-105">閱讀此文章 toounderstand hello 架構和工作流程中的 HYPER-V 複寫 tooAzure 使用 hello [Azure Site Recovery](site-recovery-overview.md)服務。</span><span class="sxs-lookup"><span data-stu-id="8668c-105">Read this article toounderstand hello architecture and workflows for Hyper-V replication tooAzure using hello [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="8668c-106">在本文中，或在 hello hello 下方張貼的任何註解[Azure 復原服務論壇](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr)。</span><span class="sxs-lookup"><span data-stu-id="8668c-106">Post any comments at hello bottom of this article, or in hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

<span data-ttu-id="8668c-107">您可以複製下列 tooAzure hello:</span><span class="sxs-lookup"><span data-stu-id="8668c-107">You can replicate hello following tooAzure:</span></span>
- <span data-ttu-id="8668c-108">**具有 VMM 的 Hyper-V**：位於內部部署 Hyper-V 主機的 VM 是在 System Center Virtual MAchine Manager (VMM) 雲端進行管理。</span><span class="sxs-lookup"><span data-stu-id="8668c-108">**Hyper-V with VMM**: VMs located on on-premises Hyper-V hosts managed in  System Center Virtual MAchine Manager (VMM) clouds.</span></span> <span data-ttu-id="8668c-109">主機可以執行任何[支援的作業系統](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers)。</span><span class="sxs-lookup"><span data-stu-id="8668c-109">Hosts can be running any [supported operating system](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span></span> <span data-ttu-id="8668c-110">您可以複寫 Hyper-V VM，執行 [Hyper-V 和 Azure 支援](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows)的任何客體作業系統。</span><span class="sxs-lookup"><span data-stu-id="8668c-110">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>
- <span data-ttu-id="8668c-111">**沒有 VMM 的 Hyper-V**：位於 Hyper-V 主機的內部部署 VM，不是在 VMM 雲端進行管理。</span><span class="sxs-lookup"><span data-stu-id="8668c-111">**Hyper-V without VMM**: On-premises VMs located on Hyper-V hosts that aren't managed in VMM clouds.</span></span> <span data-ttu-id="8668c-112">主機可以執行任何一個 hello[支援的作業系統](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions)。</span><span class="sxs-lookup"><span data-stu-id="8668c-112">Hosts can run any of hello [supported operating systems](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).</span></span> <span data-ttu-id="8668c-113">您可以複寫 Hyper-V VM，執行 [Hyper-V 和 Azure 支援](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows)的任何客體作業系統。</span><span class="sxs-lookup"><span data-stu-id="8668c-113">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="8668c-114">架構元件</span><span class="sxs-lookup"><span data-stu-id="8668c-114">Architectural components</span></span>

<span data-ttu-id="8668c-115">**領域**</span><span class="sxs-lookup"><span data-stu-id="8668c-115">**Area**</span></span> | <span data-ttu-id="8668c-116">**元件**</span><span class="sxs-lookup"><span data-stu-id="8668c-116">**Component**</span></span> | <span data-ttu-id="8668c-117">**詳細資料**</span><span class="sxs-lookup"><span data-stu-id="8668c-117">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="8668c-118">**Azure**</span><span class="sxs-lookup"><span data-stu-id="8668c-118">**Azure**</span></span> | <span data-ttu-id="8668c-119">在 Azure 中，您需要 Microsoft Azure 帳戶、Azure 儲存體帳戶和 Azure 網路。</span><span class="sxs-lookup"><span data-stu-id="8668c-119">In Azure you need a Microsoft Azure account, an Azure storage account, and a Azure network.</span></span> | <span data-ttu-id="8668c-120">儲存體和網路可以是 Resource Manager 型帳戶或傳統帳戶。</span><span class="sxs-lookup"><span data-stu-id="8668c-120">Storage and network can be Resource Manager-based, or classic accounts.</span></span><br/><br/> <span data-ttu-id="8668c-121">複寫的資料會儲存在 hello 儲存體帳戶，並從您的內部部署站台容錯移轉發生時，將會建立與 hello 複寫資料的 Azure Vm。</span><span class="sxs-lookup"><span data-stu-id="8668c-121">Replicated data is stored in hello storage account, and Azure VMs are created with hello replicated data when failover from your on-premises site occurs.</span></span><br/><br/> <span data-ttu-id="8668c-122">在建立時即 hello Azure Vm 會連線 toohello Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="8668c-122">hello Azure VMs connect toohello Azure virtual network when they're created.</span></span>
<span data-ttu-id="8668c-123">**VMM 伺服器**</span><span class="sxs-lookup"><span data-stu-id="8668c-123">**VMM server**</span></span> | <span data-ttu-id="8668c-124">位於 VMM 雲端中的 Hyper-V 主機</span><span class="sxs-lookup"><span data-stu-id="8668c-124">Hyper-V hosts located in VMM clouds</span></span> | <span data-ttu-id="8668c-125">如果 VMM 雲端中受管理 HYPER-V 主機，您會註冊的 hello 復原服務保存庫中的 hello VMM 伺服器。</span><span class="sxs-lookup"><span data-stu-id="8668c-125">If Hyper-V hosts are managed in VMM clouds, you register hello VMM server in hello Recovery Services vault.</span></span><br/><br/> <span data-ttu-id="8668c-126">Hello VMM 伺服器上您安裝 Azure hello Site Recovery Provider tooorchestrate 複寫。</span><span class="sxs-lookup"><span data-stu-id="8668c-126">On hello VMM server you install hello Site Recovery Provider tooorchestrate replication with Azure.</span></span><br/><br/> <span data-ttu-id="8668c-127">您需要邏輯和 VM 網路設定 tooconfigure 網路對應。</span><span class="sxs-lookup"><span data-stu-id="8668c-127">You need logical and VM networks set up tooconfigure network mapping.</span></span> <span data-ttu-id="8668c-128">VM 網路應連結的 tooa hello 雲端相關聯的邏輯網路。</span><span class="sxs-lookup"><span data-stu-id="8668c-128">A VM network should be linked tooa logical network that's associated with hello cloud.</span></span>
<span data-ttu-id="8668c-129">**Hyper-V 主機**</span><span class="sxs-lookup"><span data-stu-id="8668c-129">**Hyper-V host**</span></span> | <span data-ttu-id="8668c-130">可以部署包含或不包含 VMM 伺服器的 Hyper-V 伺服器。</span><span class="sxs-lookup"><span data-stu-id="8668c-130">Hyper-V servers can be deployed with or without VMM server.</span></span> | <span data-ttu-id="8668c-131">如果有任何 VMM 伺服器，hello hello 主機 tooorchestrate 複寫與站台復原已安裝站台復原提供者透過 hello 網際網路。</span><span class="sxs-lookup"><span data-stu-id="8668c-131">If there's no VMM server, hello Site Recovery Provider is installed on hello host tooorchestrate replication with Site Recovery over hello internet.</span></span> <span data-ttu-id="8668c-132">如果沒有 VMM 伺服器，hello 提供者會安裝它，而不是在 hello 主機。</span><span class="sxs-lookup"><span data-stu-id="8668c-132">If there's a VMM server, hello Provider is installed on it, and not on hello host.</span></span><br/><br/> <span data-ttu-id="8668c-133">hello 復原服務代理程式已安裝於 hello 主機 toohandle 資料複寫。</span><span class="sxs-lookup"><span data-stu-id="8668c-133">hello Recovery Services agent is installed on hello host toohandle data replication.</span></span><br/><br/> <span data-ttu-id="8668c-134">從提供者 hello 和 hello 代理程式的通訊是安全而且會加密。</span><span class="sxs-lookup"><span data-stu-id="8668c-134">Communications from both hello Provider and hello agent are secure and encrypted.</span></span> <span data-ttu-id="8668c-135">Azure 儲存體中的複寫的資料也會加密。</span><span class="sxs-lookup"><span data-stu-id="8668c-135">Replicated data in Azure storage is also encrypted.</span></span>
<span data-ttu-id="8668c-136">**Hyper-V VM**</span><span class="sxs-lookup"><span data-stu-id="8668c-136">**Hyper-V VMs**</span></span> | <span data-ttu-id="8668c-137">您需要 hello HYPER-V 主機伺服器上的一個或多個 Vm。</span><span class="sxs-lookup"><span data-stu-id="8668c-137">You need one or more VMs on hello Hyper-V host server.</span></span> | <span data-ttu-id="8668c-138">不需要安裝在 Vm 上的 tooexplicitly</span><span class="sxs-lookup"><span data-stu-id="8668c-138">Nothing needs tooexplicitly installed on VMs</span></span>

## <a name="deployment-steps"></a><span data-ttu-id="8668c-139">部署步驟</span><span class="sxs-lookup"><span data-stu-id="8668c-139">Deployment steps</span></span>

1. <span data-ttu-id="8668c-140">**Azure**： 您設定 hello Azure 元件。</span><span class="sxs-lookup"><span data-stu-id="8668c-140">**Azure**: You set up hello Azure components.</span></span> <span data-ttu-id="8668c-141">我們建議您先設定儲存體和網路帳戶，再開始 Site Recovery 部署。</span><span class="sxs-lookup"><span data-stu-id="8668c-141">We recommend you set up storage and network accounts before you begin Site Recovery deployment.</span></span>
2. <span data-ttu-id="8668c-142">**保存庫**︰您建立 Site Recovery 的復原服務保存庫，並設定保存庫設定，包括設定來源和目標設定、設定複寫原則，以及啟用複寫。</span><span class="sxs-lookup"><span data-stu-id="8668c-142">**Vault**: You create a Recovery Services vault for Site Recovery, and configure vault settings, including configuring source and target settings, setting up a replication policy, and enabling replication.</span></span>
3. <span data-ttu-id="8668c-143">**來源與目標**：</span><span class="sxs-lookup"><span data-stu-id="8668c-143">**Source and target**:</span></span>
    - <span data-ttu-id="8668c-144">**VMM 雲端中的 HYPER-V 主機**： 指定來源設定的一部分，您上下載並安裝 Azure Site Recovery Provider hello hello VMM 伺服器和每個 HYPER-V 主機上的 hello Azure 復原服務代理程式。</span><span class="sxs-lookup"><span data-stu-id="8668c-144">**Hyper-V hosts in VMM clouds**: As part of specifying source settings, you download and install hello Azure Site Recovery Provider on hello VMM server, and hello Azure Recovery Services agent on each Hyper-V host.</span></span> <span data-ttu-id="8668c-145">hello 來源將 hello VMM 伺服器。</span><span class="sxs-lookup"><span data-stu-id="8668c-145">hello source will be hello VMM server.</span></span> <span data-ttu-id="8668c-146">Azure hello 目標。</span><span class="sxs-lookup"><span data-stu-id="8668c-146">hello target is Azure.</span></span>
    - <span data-ttu-id="8668c-147">無 VMM 的 HYPER-V 主機： 當您指定來源設定時，下載並安裝在每部 HYPER-V 主機上的 hello 提供者和代理程式。</span><span class="sxs-lookup"><span data-stu-id="8668c-147">Hyper-V hosts without VMM: When you specify source settings, you download and install hello Provider and agent on each Hyper-V host.</span></span> <span data-ttu-id="8668c-148">在部署期間您會蒐集到 HYPER-V 站台的 hello 主機，並指定此站台 hello 來源。</span><span class="sxs-lookup"><span data-stu-id="8668c-148">During deployment you gather hello hosts into a Hyper-V site, and specify this site as hello source.</span></span> <span data-ttu-id="8668c-149">Azure hello 目標。</span><span class="sxs-lookup"><span data-stu-id="8668c-149">hello target is Azure.</span></span>

    <span data-ttu-id="8668c-150">![VMM/Hyper-v-V 複寫 tooAzure](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![HYPER-V 站台複寫 tooAzure](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span><span class="sxs-lookup"><span data-stu-id="8668c-150">![Hyper-V/VMM replication tooAzure](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![Hyper-V site replication tooAzure](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span></span>


4. <span data-ttu-id="8668c-151">**複寫原則**： 建立 hello HYPER-V 站台或 VMM 雲端的複寫原則。</span><span class="sxs-lookup"><span data-stu-id="8668c-151">**Replication policy**: You create a replication policy for hello Hyper-V site or VMM cloud.</span></span> <span data-ttu-id="8668c-152">hello 原則會套用的 tooall Vm 位於 hello 網站或雲端中的主機。</span><span class="sxs-lookup"><span data-stu-id="8668c-152">hello policy is applied tooall VMs located on hosts in hello site or cloud.</span></span>
5. <span data-ttu-id="8668c-153">**啟用複寫**：針對 Hyper-V VM 啟用複寫。</span><span class="sxs-lookup"><span data-stu-id="8668c-153">**Enable replication**: You enable replication for Hyper-V VMs.</span></span> <span data-ttu-id="8668c-154">根據 hello 複寫原則設定，就會發生初始複寫。</span><span class="sxs-lookup"><span data-stu-id="8668c-154">Initial replication occurs in accordance with hello replication policy settings.</span></span> <span data-ttu-id="8668c-155">會追蹤資料變更，並複寫差異變更 tooAzure 開始 hello 初始複寫完成之後。</span><span class="sxs-lookup"><span data-stu-id="8668c-155">Data changes are tracked, and replication of delta changes tooAzure begins after hello initial replication finishes.</span></span> <span data-ttu-id="8668c-156">項目的追蹤變更會保存在 .hrl 檔案中。</span><span class="sxs-lookup"><span data-stu-id="8668c-156">Tracked changes for an item are held in a .hrl file.</span></span>
6. <span data-ttu-id="8668c-157">**測試容錯移轉**： 執行測試容錯移轉 toomake 確定一切如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="8668c-157">**Test failover**:  You run a test failover toomake sure everything's working as expected.</span></span>

<span data-ttu-id="8668c-158">深入了解部署：</span><span class="sxs-lookup"><span data-stu-id="8668c-158">Learn more about deployment:</span></span>
- [<span data-ttu-id="8668c-159">開始使用 HYPER-V 虛擬機器複寫 tooAzure-與 VMM</span><span class="sxs-lookup"><span data-stu-id="8668c-159">Get started with Hyper-V VM replication tooAzure - with VMM</span></span>](site-recovery-vmm-to-azure.md)
- [<span data-ttu-id="8668c-160">開始使用 HYPER-V 虛擬機器複寫 tooAzure-無 VMM</span><span class="sxs-lookup"><span data-stu-id="8668c-160">Get started with Hyper-V VM replication tooAzure - without VMM</span></span>](site-recovery-hyper-v-site-to-azure.md)

## <a name="hyper-v-replication-workflow"></a><span data-ttu-id="8668c-161">Hyper-V 複寫工作流程</span><span class="sxs-lookup"><span data-stu-id="8668c-161">Hyper-V replication workflow</span></span>

### <a name="enable-protection"></a><span data-ttu-id="8668c-162">啟用保護。</span><span class="sxs-lookup"><span data-stu-id="8668c-162">Enable protection</span></span>

1. <span data-ttu-id="8668c-163">您針對 HYPER-V 虛擬機器啟用保護之後，在 hello Azure 入口網站或內部部署，hello**啟用保護**啟動。</span><span class="sxs-lookup"><span data-stu-id="8668c-163">After you enable protection for a Hyper-V VM, in hello Azure portal or on-premises, hello **Enable protection** starts.</span></span>
2. <span data-ttu-id="8668c-164">hello 工作會檢查該 hello 機器符合必要條件，再叫用 hello [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx)，tooset hello 設定已設定的複寫設定。</span><span class="sxs-lookup"><span data-stu-id="8668c-164">hello job checks that hello machine complies with prerequisites, before invoking hello [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx), tooset up replication with hello settings you've configured.</span></span>
3. <span data-ttu-id="8668c-165">hello 工作所叫用 hello 啟動初始複寫[StartReplication](https://msdn.microsoft.com/library/hh850303.aspx)方法、 tooinitialize 完整的 VM 複寫，以及傳送嗨 VM 的虛擬磁碟 tooAzure。</span><span class="sxs-lookup"><span data-stu-id="8668c-165">hello job starts initial replication by invoking hello [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx) method, tooinitialize a full VM replication, and send hello VM's virtual disks tooAzure.</span></span>
4. <span data-ttu-id="8668c-166">您可以監視 hello 作業在 hello**作業** 索引標籤。    ![作業清單](media/site-recovery-hyper-v-azure-architecture/image1.png) ![啟用保護向下鑽研](media/site-recovery-hyper-v-azure-architecture/image2.png)</span><span class="sxs-lookup"><span data-stu-id="8668c-166">You can monitor hello job in hello **Jobs** tab.      ![Jobs list](media/site-recovery-hyper-v-azure-architecture/image1.png) ![Enable protection drill down](media/site-recovery-hyper-v-azure-architecture/image2.png)</span></span>

### <a name="initial-replication"></a><span data-ttu-id="8668c-167">初始複寫</span><span class="sxs-lookup"><span data-stu-id="8668c-167">Initial replication</span></span>

1. <span data-ttu-id="8668c-168">系統會在初始複寫觸發時擷取 [Hyper-V VM 快照集](https://technet.microsoft.com/library/dd560637.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8668c-168">A [Hyper-V VM snapshot](https://technet.microsoft.com/library/dd560637.aspx) snapshot is taken when initial replication is triggered.</span></span>
2. <span data-ttu-id="8668c-169">虛擬硬碟才是所有的複製的 tooAzure 複寫的一個。</span><span class="sxs-lookup"><span data-stu-id="8668c-169">Virtual hard disks are replicated one by one until they're all copied tooAzure.</span></span> <span data-ttu-id="8668c-170">它可能需要一些時間，視 hello VM 大小和網路頻寬。</span><span class="sxs-lookup"><span data-stu-id="8668c-170">It could take a while, depending on hello VM size, and network bandwidth.</span></span> <span data-ttu-id="8668c-171">toooptimize 網路使用量，請參閱[如何 toomanage 內部 tooAzure 保護網路頻寬使用量](https://support.microsoft.com/kb/3056159)。</span><span class="sxs-lookup"><span data-stu-id="8668c-171">toooptimize your network usage, see [How toomanage on-premises tooAzure protection network bandwidth usage](https://support.microsoft.com/kb/3056159).</span></span>
3. <span data-ttu-id="8668c-172">如果磁碟上的變更會發生初始複寫正在進行時，hello HYPER-V 複本複寫追蹤器會追蹤這些變更為 HYPER-V 複寫記錄檔 (.hrl)。</span><span class="sxs-lookup"><span data-stu-id="8668c-172">If disk changes occur while initial replication is in progress, hello Hyper-V Replica Replication Tracker tracks those changes as Hyper-V Replication Logs (.hrl).</span></span> <span data-ttu-id="8668c-173">這些檔案位在 hello 與 hello 磁碟相同的資料夾。</span><span class="sxs-lookup"><span data-stu-id="8668c-173">These files are located in hello same folder as hello disks.</span></span> <span data-ttu-id="8668c-174">每個磁碟具有相關聯的.hrl 檔案傳送 toosecondary 儲存體。</span><span class="sxs-lookup"><span data-stu-id="8668c-174">Each disk has an associated .hrl file that will be sent toosecondary storage.</span></span>
4. <span data-ttu-id="8668c-175">初始複寫正在進行時，hello 快照集和記錄檔會消耗磁碟資源。</span><span class="sxs-lookup"><span data-stu-id="8668c-175">hello snapshot and log files consume disk resources while initial replication is in progress.</span></span>
5. <span data-ttu-id="8668c-176">Hello 初始複寫完成時，會刪除 hello VM 快照集。</span><span class="sxs-lookup"><span data-stu-id="8668c-176">When hello initial replication finishes, hello VM snapshot is deleted.</span></span> <span data-ttu-id="8668c-177">Hello 記錄檔中的差異磁碟變更為已同步處理和合併 toohello 父系磁碟。</span><span class="sxs-lookup"><span data-stu-id="8668c-177">Delta disk changes in hello log are synchronized and merged toohello parent disk.</span></span>


### <a name="finalize-protection"></a><span data-ttu-id="8668c-178">完成保護</span><span class="sxs-lookup"><span data-stu-id="8668c-178">Finalize protection</span></span>

1. <span data-ttu-id="8668c-179">Hello 初始複寫完成，hello 之後**完成 hello 虛擬機器上的保護**作業設定網路和其他複寫後續設定，以便 hello 虛擬機器時保護。</span><span class="sxs-lookup"><span data-stu-id="8668c-179">After hello initial replication finishes, hello **Finalize protection on hello virtual machine** job configures network and other post-replication settings, so that hello virtual machine is protected.</span></span>
    <span data-ttu-id="8668c-180">![完成保護作業](media/site-recovery-hyper-v-azure-architecture/image3.png)</span><span class="sxs-lookup"><span data-stu-id="8668c-180">![Finalize protection job](media/site-recovery-hyper-v-azure-architecture/image3.png)</span></span>
2. <span data-ttu-id="8668c-181">如果您要複寫 tooAzure，您可能需要 tootweak hello 設定 hello 虛擬機器，讓它準備好進行容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="8668c-181">If you're replicating tooAzure, you might need tootweak hello settings for hello virtual machine so that it's ready for failover.</span></span> <span data-ttu-id="8668c-182">此時，您可以執行測試容錯移轉 toocheck 一切如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="8668c-182">At this point you can run a test failover toocheck everything is working as expected.</span></span>

### <a name="delta-replication"></a><span data-ttu-id="8668c-183">差異複寫</span><span class="sxs-lookup"><span data-stu-id="8668c-183">Delta replication</span></span>

1. <span data-ttu-id="8668c-184">Hello 初始複寫之後，差異同步處理開始時，根據複寫設定。</span><span class="sxs-lookup"><span data-stu-id="8668c-184">After hello initial replication, delta synchronization begins, in accordance with replication settings.</span></span>
2. <span data-ttu-id="8668c-185">hello HYPER-V 複本複寫追蹤器會為.hrl 檔案追蹤 hello 變更 tooa 虛擬硬碟。</span><span class="sxs-lookup"><span data-stu-id="8668c-185">hello Hyper-V Replica Replication Tracker tracks hello changes tooa virtual hard disk as .hrl files.</span></span> <span data-ttu-id="8668c-186">每個設定用於複寫的磁碟都會有相關聯的 .hrl 檔案。</span><span class="sxs-lookup"><span data-stu-id="8668c-186">Each disk that's configured for replication has an associated .hrl file.</span></span> <span data-ttu-id="8668c-187">此記錄檔會在初始複寫完成之後傳送 toohello 客戶儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="8668c-187">This log is sent toohello customer's storage account after initial replication is complete.</span></span> <span data-ttu-id="8668c-188">在另一個記錄檔，在 hello 傳輸 tooAzure 記錄時，會追蹤 hello 變更 hello 主要磁碟相同的目錄。</span><span class="sxs-lookup"><span data-stu-id="8668c-188">When a log is in transit tooAzure, hello changes in hello primary disk are tracked in another log file, in hello same directory.</span></span>
3. <span data-ttu-id="8668c-189">初始和差異在複寫期間，您可以監視 hello VM 檢視中的 hello VM。</span><span class="sxs-lookup"><span data-stu-id="8668c-189">During initial and delta replication, you can monitor hello VM in hello VM view.</span></span> <span data-ttu-id="8668c-190">[深入了解](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines)。</span><span class="sxs-lookup"><span data-stu-id="8668c-190">[Learn more](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span></span>  

### <a name="replication-synchronization"></a><span data-ttu-id="8668c-191">複寫同步處理</span><span class="sxs-lookup"><span data-stu-id="8668c-191">Replication synchronization</span></span>

1. <span data-ttu-id="8668c-192">如果差異複寫失敗且完整複寫因為頻寬或時間需要大量成本，就會將 VM 標示為重新同步處理。</span><span class="sxs-lookup"><span data-stu-id="8668c-192">If delta replication fails, and a full replication would be costly in terms of bandwidth or time, then a VM is marked for resynchronization.</span></span> <span data-ttu-id="8668c-193">例如，如果 hello.hrl 檔案到達 hello 磁碟大小的 50%，然後 hello VM 將會標示為重新同步處理。</span><span class="sxs-lookup"><span data-stu-id="8668c-193">For example, if hello .hrl files reach 50% of hello disk size, then hello VM will be marked for resynchronization.</span></span>
2.  <span data-ttu-id="8668c-194">重新同步處理將 hello 會計算總和檢查碼的 hello 的來源和目標虛擬機器，並傳送 hello 差異資料傳送的資料量降到最低。</span><span class="sxs-lookup"><span data-stu-id="8668c-194">Resynchronization minimizes hello amount of data sent by computing checksums of hello source and target virtual machines, and sending only hello delta data.</span></span> <span data-ttu-id="8668c-195">重新同步處理會使用固定區塊的區塊處理演算法，將來源和目標檔案分成固定區塊。</span><span class="sxs-lookup"><span data-stu-id="8668c-195">Resynchronization uses a fixed-block chunking algorithm where source and target files are divided into fixed chunks.</span></span> <span data-ttu-id="8668c-196">總和檢查碼的每個區塊產生，則會比較，它會封鎖從 hello 來源需要 toobe 套用的 toohello 目標 toodetermine。</span><span class="sxs-lookup"><span data-stu-id="8668c-196">Checksums for each chunk are generated and then compared toodetermine which blocks from hello source need toobe applied toohello target.</span></span>
3. <span data-ttu-id="8668c-197">重新同步處理完成之後，應會繼續進行正常的差異複寫。</span><span class="sxs-lookup"><span data-stu-id="8668c-197">After resynchronization finishes, normal delta replication should resume.</span></span> <span data-ttu-id="8668c-198">預設重新同步處理排程的 toorun 自動外上班時間時，但是您可以手動重新同步虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="8668c-198">By default resynchronization is scheduled toorun automatically outside office hours, but you can resynchronize a virtual machine manually.</span></span> <span data-ttu-id="8668c-199">例如，若發生網路中斷或其他中斷情形，您可以繼續重新同步處理。</span><span class="sxs-lookup"><span data-stu-id="8668c-199">For example, you can resume resynchronization if a network outage or another outage occurs.</span></span> <span data-ttu-id="8668c-200">toodo hello 入口網站中的，選取 hello VM >**重新同步處理**。</span><span class="sxs-lookup"><span data-stu-id="8668c-200">toodo this, select hello VM in hello portal > **Resynchronize**.</span></span>

    ![手動重新同步處理](media/site-recovery-hyper-v-azure-architecture/image4.png)


### <a name="retries"></a><span data-ttu-id="8668c-202">重試</span><span class="sxs-lookup"><span data-stu-id="8668c-202">Retries</span></span>

<span data-ttu-id="8668c-203">如果發生複寫錯誤，會有內建的重試。</span><span class="sxs-lookup"><span data-stu-id="8668c-203">If a replication error occurs, there's a built-in retry.</span></span> <span data-ttu-id="8668c-204">此邏輯可分為以下兩種類別：</span><span class="sxs-lookup"><span data-stu-id="8668c-204">This logic can be classified into two categories:</span></span>

<span data-ttu-id="8668c-205">**類別**</span><span class="sxs-lookup"><span data-stu-id="8668c-205">**Category**</span></span> | <span data-ttu-id="8668c-206">**詳細資料**</span><span class="sxs-lookup"><span data-stu-id="8668c-206">**Details**</span></span>
--- | ---
<span data-ttu-id="8668c-207">**無法復原的錯誤**</span><span class="sxs-lookup"><span data-stu-id="8668c-207">**Non-recoverable errors**</span></span> | <span data-ttu-id="8668c-208">不嘗試重試。</span><span class="sxs-lookup"><span data-stu-id="8668c-208">No retry is attempted.</span></span> <span data-ttu-id="8668c-209">VM 狀態為**重大**，需要管理員介入處理。</span><span class="sxs-lookup"><span data-stu-id="8668c-209">VM status will be **Critical**, and administrator intervention is required.</span></span> <span data-ttu-id="8668c-210">這些錯誤的範例包括： 中斷 VHD 鏈結。Hello 複本 VM; 無效的狀態網路驗證錯誤： 授權錯誤。找不到錯誤 （適用於獨立 HYPER-V 伺服器） 的 VM</span><span class="sxs-lookup"><span data-stu-id="8668c-210">Examples of these errors include: broken VHD chain; Invalid state for hello replica VM; Network authentication errors: authorization errors; VM not found errors (for standalone Hyper-V servers)</span></span>
<span data-ttu-id="8668c-211">**可復原的錯誤**</span><span class="sxs-lookup"><span data-stu-id="8668c-211">**Recoverable errors**</span></span> | <span data-ttu-id="8668c-212">產生每個複寫間隔，使用指數型撤退，從而 hello 從 hello 開頭的 1、 2、 4、 8、 hello 第一次嘗試的重試間隔和 10 分鐘重試作業。</span><span class="sxs-lookup"><span data-stu-id="8668c-212">Retries occur every replication interval, using an exponential back-off that increases hello retry interval from hello start of hello first attempt by 1, 2, 4, 8, and 10 minutes.</span></span> <span data-ttu-id="8668c-213">如果錯誤持續發生，會每隔 30 分鐘重試一次。</span><span class="sxs-lookup"><span data-stu-id="8668c-213">If an error persists, retry every 30 minutes.</span></span> <span data-ttu-id="8668c-214">範例包括：網路錯誤；磁碟空間不足錯誤；記憶體不足情況</span><span class="sxs-lookup"><span data-stu-id="8668c-214">Examples include: network errors; low disk  errors; low memory conditions</span></span> |

## <a name="protection-and-recovery-lifecycle"></a><span data-ttu-id="8668c-215">保護和復原生命週期</span><span class="sxs-lookup"><span data-stu-id="8668c-215">Protection and recovery lifecycle</span></span>

![工作流程](./media/site-recovery-components/arch-hyperv-azure-workflow.png)

## <a name="next-steps"></a><span data-ttu-id="8668c-217">後續步驟</span><span class="sxs-lookup"><span data-stu-id="8668c-217">Next steps</span></span>

- [<span data-ttu-id="8668c-218">檢查部署必要條件</span><span class="sxs-lookup"><span data-stu-id="8668c-218">Check deployment prerequisites</span></span>](site-recovery-prereq.md)
- <span data-ttu-id="8668c-219">疑難排解：</span><span class="sxs-lookup"><span data-stu-id="8668c-219">Troubleshoot with:</span></span>
    - [<span data-ttu-id="8668c-220">針對保護進行監視和疑難排解</span><span class="sxs-lookup"><span data-stu-id="8668c-220">Monitor and troubleshoot protection</span></span>](site-recovery-monitoring-and-troubleshooting.md)
    - [<span data-ttu-id="8668c-221">Microsoft 支援的說明</span><span class="sxs-lookup"><span data-stu-id="8668c-221">Help from Microsoft support</span></span>](site-recovery-monitoring-and-troubleshooting.md#reach-out-for-microsoft-support)
    - [<span data-ttu-id="8668c-222">常見錯誤和解決方案</span><span class="sxs-lookup"><span data-stu-id="8668c-222">Common errors and resolutions</span></span>](site-recovery-monitoring-and-troubleshooting.md#common-azure-site-recovery-errors-and-their-resolutions)
