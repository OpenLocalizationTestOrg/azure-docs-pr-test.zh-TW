---
title: "在 Azure Site Recovery 中測試容錯移轉 (VMM 到 VMM) | Microsoft Docs"
description: "Azure Site Recovery 可協調虛擬機器和實體伺服器的複寫、容錯移轉及復原作業。 了解如何容錯移轉到 Azure 或次要資料中心。"
services: site-recovery
documentationcenter: 
author: prateek9us
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 06/05/2017
ms.author: pratshar
ms.openlocfilehash: afc4790d5714ce7145c8f4291a05acc2e9882a9b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="test-failover-vmm-to-vmm-in-site-recovery"></a><span data-ttu-id="2ef48-104">在 Site Recovery 中測試容錯移轉 (VMM 到 VMM)</span><span class="sxs-lookup"><span data-stu-id="2ef48-104">Test failover (VMM to VMM) in Site Recovery</span></span>


<span data-ttu-id="2ef48-105">針對以 Azure Site Recovery 保護的虛擬機器 (VM) 與實體伺服器所執行的測試容錯移轉或災害復原 (DR) 訓練，本文提供相關資訊和指示。</span><span class="sxs-lookup"><span data-stu-id="2ef48-105">This article provides information and instructions for doing a test failover or a disaster recovery (DR) drill of virtual machines (VMs) and physical servers that are protected with Azure Site Recovery.</span></span> <span data-ttu-id="2ef48-106">您將使用由 System Center Virtual Machine Manager (VMM) 管理的內部部署網站作為復原網站。</span><span class="sxs-lookup"><span data-stu-id="2ef48-106">You'll use a System Center Virtual Machine Manager (VMM)-managed on-premises site as the recovery site.</span></span>

<span data-ttu-id="2ef48-107">您執行測試容錯移轉來驗證您的複寫策略，或在沒有資料遺失或停機時間的情況下執行災害復原訓練。</span><span class="sxs-lookup"><span data-stu-id="2ef48-107">You run a test failover to validate your replication strategy or perform a DR drill without any data loss or downtime.</span></span> <span data-ttu-id="2ef48-108">測試容錯移轉不會影響任何正在進行的複寫或生產環境。</span><span class="sxs-lookup"><span data-stu-id="2ef48-108">A test failover doesn't have any impact on the ongoing replication or on your production environment.</span></span> <span data-ttu-id="2ef48-109">您可以在虛擬機器上執行測試容錯移轉，或依[復原方案](site-recovery-create-recovery-plans.md)執行。</span><span class="sxs-lookup"><span data-stu-id="2ef48-109">You can run it on either a virtual machine or a [recovery plan](site-recovery-create-recovery-plans.md).</span></span> <span data-ttu-id="2ef48-110">當您觸發測試容錯移轉時，必須指定測試虛擬機器將要連線的網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-110">When you're triggering a test failover, you need to specify the network that the test virtual machines will connect to.</span></span> <span data-ttu-id="2ef48-111">您可以在 [作業] 頁面中追蹤測試容錯移轉的進度。</span><span class="sxs-lookup"><span data-stu-id="2ef48-111">You can track the progress of the test failover on the **Jobs** page.</span></span>  

<span data-ttu-id="2ef48-112">如果您有任何意見或問題，請張貼在本文下方或 [Azure 復原服務論壇](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr)。</span><span class="sxs-lookup"><span data-stu-id="2ef48-112">If you have any comments or questions, post them at the bottom of this article or on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="prepare-the-infrastructure-for-test-failover"></a><span data-ttu-id="2ef48-113">準備測試容錯移轉的基礎結構</span><span class="sxs-lookup"><span data-stu-id="2ef48-113">Prepare the infrastructure for test failover</span></span>
<span data-ttu-id="2ef48-114">如果您想要使用現有網路來執行測試容錯移轉，請在該網路中準備好 Active Directory、DHCP 和 DNS。</span><span class="sxs-lookup"><span data-stu-id="2ef48-114">If you want to run a test failover by using an existing network, prepare Active Directory, DHCP, and DNS in that network.</span></span>

<span data-ttu-id="2ef48-115">如果您想要使用自動建立 VM 網路的選項來執行測試容錯移轉，請在您將用於測試容錯移轉之復原方案中的群組 1 前新增手動步驟。</span><span class="sxs-lookup"><span data-stu-id="2ef48-115">If you want to run a test failover by using the option to create VM networks automatically, add a manual step before Group-1 in the recovery plan that you’re going to use for the test failover.</span></span> <span data-ttu-id="2ef48-116">然後，將基礎結構資源新增到自動建立的網路，接著再執行測試容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="2ef48-116">Then, add the infrastructure resources to the automatically created network before you run the test failover.</span></span>

### <a name="things-to-note"></a><span data-ttu-id="2ef48-117">注意事項</span><span class="sxs-lookup"><span data-stu-id="2ef48-117">Things to note</span></span>
<span data-ttu-id="2ef48-118">複寫到次要網站時，複本機器所使用的網路類型不需要與用來測試容錯移轉的邏輯網路類型相符，但某些組合可能無法運作。</span><span class="sxs-lookup"><span data-stu-id="2ef48-118">When you're replicating to a secondary site, the type of network that the replica machine uses doesn’t need to match the type of logical network used for test failover, but some combinations might not work.</span></span> <span data-ttu-id="2ef48-119">如果複本會使用 DHCP 和 VLAN 架構的隔離，則複本的 VM 網路不需要靜態 IP 位址集區。</span><span class="sxs-lookup"><span data-stu-id="2ef48-119">If the replica uses DHCP and VLAN-based isolation, the VM network for the replica doesn't need a static IP address pool.</span></span> <span data-ttu-id="2ef48-120">因此，使用 Windows 網路虛擬化來測試容錯移轉將不會運作，因為沒有任何位址集區可供使用。</span><span class="sxs-lookup"><span data-stu-id="2ef48-120">So using Windows Network Virtualization for the test failover won't work because no address pools are available.</span></span> 

<span data-ttu-id="2ef48-121">此外，如果使用「未隔離」複本網路和「Windows 網路虛擬化」測試網路，則測試容錯移轉將無法運作。</span><span class="sxs-lookup"><span data-stu-id="2ef48-121">In addition, the test failover won't work if the replica network uses no isolation and the test network uses Windows Network Virtualization.</span></span> <span data-ttu-id="2ef48-122">這是因為「未隔離」的網路沒有建立 Windows 網路虛擬化網路所需的子網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-122">This is because the no-isolation network doesn't have the subnets required to create a Windows Network Virtualization network.</span></span>

<span data-ttu-id="2ef48-123">容錯移轉之後，用來將複本虛擬機器連線至對應 VM 網路的方式，取決於 VM 網路在 VMM 主控台中的設定方式。</span><span class="sxs-lookup"><span data-stu-id="2ef48-123">How replica virtual machines are connected to mapped VM networks after failover depends on how the VM network is configured in the VMM console.</span></span>

#### <a name="vm-network-configured-with-no-isolation-or-vlan-isolation"></a><span data-ttu-id="2ef48-124">設定為未隔離或 VLAN 隔離的 VM 網路</span><span class="sxs-lookup"><span data-stu-id="2ef48-124">VM network configured with no isolation or VLAN isolation</span></span>
<span data-ttu-id="2ef48-125">如果 VM 網路已定義 DHCP，則複本虛擬機器將透過針對相關聯邏輯網路中網路站台所指定的設定連線到 VLAN 識別碼。</span><span class="sxs-lookup"><span data-stu-id="2ef48-125">If DHCP is defined for the VM network, the replica virtual machine is connected to the VLAN ID through the settings that are specified for the network site in the associated logical network.</span></span> <span data-ttu-id="2ef48-126">虛擬機器從可用的 DHCP 伺服器接收其 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="2ef48-126">The virtual machine receives its IP address from the available DHCP server.</span></span> 

<span data-ttu-id="2ef48-127">您不需要為目標 VM 網路定義靜態 IP 位址集區。</span><span class="sxs-lookup"><span data-stu-id="2ef48-127">You don't need to define a static IP address pool for the target VM network.</span></span> <span data-ttu-id="2ef48-128">如果 VM 網路使用靜態 IP位址集區，則複本虛擬機器將透過針對相關聯邏輯網路中網路站台所指定的設定連線到 VLAN 識別碼。</span><span class="sxs-lookup"><span data-stu-id="2ef48-128">If a static IP address pool is used for the VM network, the replica virtual machine is connected to the VLAN ID through the settings that are specified for the network site in the associated logical network.</span></span>

<span data-ttu-id="2ef48-129">虛擬機器從 VM 網路所定義的集區接收其 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="2ef48-129">The virtual machine receives its IP address from the pool that's defined for the VM network.</span></span> <span data-ttu-id="2ef48-130">如果靜態 IP 位址集區未定義於目標 VM 網路上，則 IP 位址配置將會失敗。</span><span class="sxs-lookup"><span data-stu-id="2ef48-130">If a static IP address pool isn't defined on the target VM network, IP address allocation will fail.</span></span> <span data-ttu-id="2ef48-131">在您即將用來保護與復原的來源和目標 VMM 伺服器上，建立 IP 位址集區。</span><span class="sxs-lookup"><span data-stu-id="2ef48-131">Create the IP address pool on both the source and target VMM servers that you will use for protection and recovery.</span></span>

#### <a name="vm-network-with-windows-network-virtualization"></a><span data-ttu-id="2ef48-132">採用 Windows 網路虛擬化的 VM 網路</span><span class="sxs-lookup"><span data-stu-id="2ef48-132">VM network with Windows Network Virtualization</span></span>
<span data-ttu-id="2ef48-133">如果 VM 網路設定為 Windows 網路虛擬化，您應該為目標 VM 網路定義靜態集區，而不論來源 VM 網路是設定為使用 DHCP 或靜態 IP 位址集區。</span><span class="sxs-lookup"><span data-stu-id="2ef48-133">If a VM network is configured with Windows Network Virtualization, you should define a static pool for the target VM network, regardless of whether the source VM network is configured to use DHCP or a static IP address pool.</span></span> 

<span data-ttu-id="2ef48-134">如果您定義 DHCP，目標 VMM 伺服器將作為 DHCP 伺服器，並提供為目標 VM 網路定義之集區中的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="2ef48-134">If you define DHCP, the target VMM server acts as a DHCP server and provides an IP address from the pool that's defined for the target VM network.</span></span> <span data-ttu-id="2ef48-135">如果已定義來源伺服器使用靜態 IP 位址集區，則目標 VMM 伺服器會配置集區中的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="2ef48-135">If use of a static IP address pool is defined for the source server, the target VMM server allocates an IP address from the pool.</span></span> <span data-ttu-id="2ef48-136">在這兩種情況下，如果未定義靜態 IP 位址集區，IP 位址配置將會失敗。</span><span class="sxs-lookup"><span data-stu-id="2ef48-136">In both cases, IP address allocation will fail if a static IP address pool is not defined.</span></span>


### <a name="prepare-dhcp"></a><span data-ttu-id="2ef48-137">準備 DHCP</span><span class="sxs-lookup"><span data-stu-id="2ef48-137">Prepare DHCP</span></span>
<span data-ttu-id="2ef48-138">如果參與測試容錯移轉的虛擬機器使用 DHCP，請在基於測試容錯移轉目的而建立的隔離網路中建立測試 DHCP 伺服器。</span><span class="sxs-lookup"><span data-stu-id="2ef48-138">If the virtual machines involved in test failover use DHCP, create a test DHCP server within the isolated network for the purpose of test failover.</span></span>

### <a name="prepare-active-directory"></a><span data-ttu-id="2ef48-139">準備 Active Directory</span><span class="sxs-lookup"><span data-stu-id="2ef48-139">Prepare Active Directory</span></span>
<span data-ttu-id="2ef48-140">若要執行測試容錯移轉以進行應用程式測試，您需要在測試環境中具有 Active Directory 生產環境的複本。</span><span class="sxs-lookup"><span data-stu-id="2ef48-140">To run a test failover for application testing, you need a copy of the production Active Directory environment in your test environment.</span></span> <span data-ttu-id="2ef48-141">如需詳細資訊，請參閱 [Active Directory 的測試容錯移轉考量](site-recovery-active-directory.md#test-failover-considerations)。</span><span class="sxs-lookup"><span data-stu-id="2ef48-141">For more information, review the [test failover considerations for Active Directory](site-recovery-active-directory.md#test-failover-considerations).</span></span>

### <a name="prepare-dns"></a><span data-ttu-id="2ef48-142">準備 DNS</span><span class="sxs-lookup"><span data-stu-id="2ef48-142">Prepare DNS</span></span>
<span data-ttu-id="2ef48-143">準備 DNS 伺服器來進行測試容錯移轉，如下所示：</span><span class="sxs-lookup"><span data-stu-id="2ef48-143">Prepare a DNS server for the test failover as follows:</span></span>

* <span data-ttu-id="2ef48-144">**DHCP**：如果虛擬機器使用 DHCP，就應該在測試 DHCP 伺服器上更新測試 DNS 的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="2ef48-144">**DHCP**: If virtual machines use DHCP, the IP address of the test DNS should be updated on the test DHCP server.</span></span> <span data-ttu-id="2ef48-145">如果使用的是 Windows 網路虛擬化的網路類型，VMM 伺服器就會當做 DHCP 伺服器使用。</span><span class="sxs-lookup"><span data-stu-id="2ef48-145">If you’re using a network type of Windows Network Virtualization, the VMM server acts as the DHCP server.</span></span> <span data-ttu-id="2ef48-146">因此，應該在測試容錯移轉中更新 DNS 的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="2ef48-146">Therefore, the IP address of DNS should be updated in the test failover network.</span></span> <span data-ttu-id="2ef48-147">在此情況下，虛擬機器會向相關的 DNS 伺服器註冊其本身。</span><span class="sxs-lookup"><span data-stu-id="2ef48-147">In this case, the virtual machines register themselves to the relevant DNS server.</span></span>
* <span data-ttu-id="2ef48-148">**靜態位址**：如果虛擬機器使用靜態 IP 位址，就應該在測試容錯移轉中更新測試 DNS 伺服器的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="2ef48-148">**Static address**: If virtual machines use a static IP address, the IP address of the test DNS server should be updated in test failover network.</span></span> <span data-ttu-id="2ef48-149">您可能需要以測試虛擬機器的 IP 位址來更新 DNS。</span><span class="sxs-lookup"><span data-stu-id="2ef48-149">You might need to update DNS with the IP address of the test virtual machines.</span></span> <span data-ttu-id="2ef48-150">您可以基於此目的來使用下列指令碼範例：</span><span class="sxs-lookup"><span data-stu-id="2ef48-150">You can use the following sample script for this purpose:</span></span>

        Param(
        [string]$Zone,
        [string]$name,
        [string]$IP
        )
        $Record = Get-DnsServerResourceRecord -ZoneName $zone -Name $name
        $newrecord = $record.clone()
        $newrecord.RecordData[0].IPv4Address  =  $IP
        Set-DnsServerResourceRecord -zonename $zone -OldInputObject $record -NewInputObject $Newrecord



## <a name="run-a-test-failover"></a><span data-ttu-id="2ef48-151">執行測試容錯移轉</span><span class="sxs-lookup"><span data-stu-id="2ef48-151">Run a test failover</span></span>
<span data-ttu-id="2ef48-152">此程序說明如何針對復原方案執行測試容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="2ef48-152">This procedure describes how to run a test failover for a recovery plan.</span></span> <span data-ttu-id="2ef48-153">或者，您可以在 [虛擬機器] 索引標籤上針對單一虛擬機器執行容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="2ef48-153">Alternatively, you can run the failover for a single virtual machine on the **Virtual Machines** tab.</span></span>

![測試容錯移轉刀鋒視窗](./media/site-recovery-test-failover-vmm-to-vmm/TestFailover.png)

1. <span data-ttu-id="2ef48-155">選取 [復原方案]  >  *recoveryplan_name*。</span><span class="sxs-lookup"><span data-stu-id="2ef48-155">Select **Recovery Plans** > *recoveryplan_name*.</span></span> <span data-ttu-id="2ef48-156">按一下 [容錯移轉] **容錯移轉** > **Test 容錯移轉**中張貼意見或問題。</span><span class="sxs-lookup"><span data-stu-id="2ef48-156">Click **Failover** > **Test Failover**.</span></span>
1. <span data-ttu-id="2ef48-157">在 [測試容錯移轉] 刀鋒視窗上，指定虛擬機器在測試容錯移轉後應如何連接到網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-157">On the **Test Failover** blade, specify how virtual machines should be connected to networks after the test failover.</span></span> <span data-ttu-id="2ef48-158">如需詳細資訊，請參閱[網路選項](#network-options-in-site-recovery)。</span><span class="sxs-lookup"><span data-stu-id="2ef48-158">For more information, see the [network options](#network-options-in-site-recovery).</span></span>
1. <span data-ttu-id="2ef48-159">在 [工作]  索引標籤上追蹤容錯移轉進度。</span><span class="sxs-lookup"><span data-stu-id="2ef48-159">Track failover progress on the **Jobs** tab.</span></span>
1. <span data-ttu-id="2ef48-160">完成容錯移轉之後，請確認虛擬機器已成功啟動。</span><span class="sxs-lookup"><span data-stu-id="2ef48-160">After failover is complete, verify that the virtual machines start successfully.</span></span>
1. <span data-ttu-id="2ef48-161">完成後，按一下復原方案上的 [清除測試容錯移轉]。</span><span class="sxs-lookup"><span data-stu-id="2ef48-161">When you're done, click **Cleanup test failover** on the recovery plan.</span></span> <span data-ttu-id="2ef48-162">在 [記事] 中，記錄並儲存關於測試容錯移轉的任何觀察。</span><span class="sxs-lookup"><span data-stu-id="2ef48-162">In **Notes**, record and save any observations associated with the test failover.</span></span> <span data-ttu-id="2ef48-163">這個步驟會刪除在測試容錯移轉期間所建立的虛擬機器和網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-163">This step deletes the virtual machines and networks that were created during test failover.</span></span>


## <a name="network-options-in-site-recovery"></a><span data-ttu-id="2ef48-164">Site Recovery 中的網路選項</span><span class="sxs-lookup"><span data-stu-id="2ef48-164">Network options in Site Recovery</span></span>

<span data-ttu-id="2ef48-165">當您執行測試容錯移轉時，系統會要求您選取用以測試複本機器的網路設定。</span><span class="sxs-lookup"><span data-stu-id="2ef48-165">When you run a test failover, you're asked to select network settings for test replica machines.</span></span> <span data-ttu-id="2ef48-166">您可以很多選擇。</span><span class="sxs-lookup"><span data-stu-id="2ef48-166">You have multiple options.</span></span>  

| <span data-ttu-id="2ef48-167">**測試容錯移轉選項**</span><span class="sxs-lookup"><span data-stu-id="2ef48-167">**Test failover option**</span></span> | <span data-ttu-id="2ef48-168">**說明**</span><span class="sxs-lookup"><span data-stu-id="2ef48-168">**Description**</span></span> | <span data-ttu-id="2ef48-169">**容錯移轉檢查**</span><span class="sxs-lookup"><span data-stu-id="2ef48-169">**Failover check**</span></span> | <span data-ttu-id="2ef48-170">**詳細資料**</span><span class="sxs-lookup"><span data-stu-id="2ef48-170">**Details**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="2ef48-171">**容錯移轉到次要 VMM 網站 -- 無網路**</span><span class="sxs-lookup"><span data-stu-id="2ef48-171">**Fail over to a secondary VMM site--without network**</span></span> |<span data-ttu-id="2ef48-172">請勿選取 VM 網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-172">Don't select a VM network.</span></span> |<span data-ttu-id="2ef48-173">容錯移轉會檢查測試機器是否已建立。</span><span class="sxs-lookup"><span data-stu-id="2ef48-173">Failover checks that test machines are created.</span></span><br/><br/><span data-ttu-id="2ef48-174">測試虛擬機器會建立在與複本虛擬機器相同的主機上。</span><span class="sxs-lookup"><span data-stu-id="2ef48-174">The test virtual machine is created on the host where the replica virtual machine exists.</span></span> <span data-ttu-id="2ef48-175">它不會新增至複本虛擬機器所在的雲端。</span><span class="sxs-lookup"><span data-stu-id="2ef48-175">It isn’t added to the cloud where the replica virtual machine is located.</span></span> |<p><span data-ttu-id="2ef48-176">容錯移轉的機器不會連線至任何網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-176">The failed-over machine isn’t connected to any network.</span></span><br/><br/><span data-ttu-id="2ef48-177">此機器建立後可以連線至 VM 網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-177">The machine can be connected to a VM network after it has been created.</span></span> |
| <span data-ttu-id="2ef48-178">**容錯移轉到次要 VMM 網站 -- 有網路**</span><span class="sxs-lookup"><span data-stu-id="2ef48-178">**Fail over to a secondary VMM site--with network**</span></span> |<span data-ttu-id="2ef48-179">選取現有的 VM 網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-179">Select an existing VM network.</span></span> |<span data-ttu-id="2ef48-180">容錯移轉會檢查虛擬機器是否已建立。</span><span class="sxs-lookup"><span data-stu-id="2ef48-180">Failover checks that virtual machines are created.</span></span> |<span data-ttu-id="2ef48-181">測試虛擬機器會建立在與複本虛擬機器相同的主機上。</span><span class="sxs-lookup"><span data-stu-id="2ef48-181">The test virtual machine is created on the host where the replica virtual machine exists.</span></span> <span data-ttu-id="2ef48-182">它不會新增至複本虛擬機器所在的雲端。</span><span class="sxs-lookup"><span data-stu-id="2ef48-182">It isn’t added to the cloud where the replica virtual machine is located.</span></span><br/><br/><span data-ttu-id="2ef48-183">建立與您的生產網路隔離的 VM 網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-183">Create a VM network that's isolated from your production network.</span></span><br/><br/><span data-ttu-id="2ef48-184">如果您是使用 VLAN 網路，建議您在 VMM 中另外建立未用於生產網路的測試專用邏輯網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-184">If you're using a VLAN-based network, we recommend that you create a separate logical network (not used in production) in VMM for this purpose.</span></span> <span data-ttu-id="2ef48-185">此邏輯網路是用來建立測試容錯移轉的 VM 網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-185">This logical network is used to create VM networks for test failovers.</span></span><br/><br/><span data-ttu-id="2ef48-186">邏輯網路應該至少要與所有裝載虛擬機器之 Hyper-V 伺服器的其中一個網路介面卡相關聯。</span><span class="sxs-lookup"><span data-stu-id="2ef48-186">The logical network should be associated with at least one of the network adapters of all the Hyper-V servers that are hosting virtual machines.</span></span><br/><br/><span data-ttu-id="2ef48-187">若使用 VLAN 邏輯網路，應該要隔離您新增至邏輯網路的網路站台。</span><span class="sxs-lookup"><span data-stu-id="2ef48-187">For VLAN logical networks, the network sites that you add to the logical network should be isolated.</span></span><br/><br/><span data-ttu-id="2ef48-188">如果您是使用 Windows 網路虛擬化型邏輯網路，Azure Site Recovery 會自動建立隔離的 VM 網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-188">If you’re using a Windows Network Virtualization–based logical network, Azure Site Recovery automatically creates isolated VM networks.</span></span> |
| <span data-ttu-id="2ef48-189">**容錯移轉到次要 VMM 站台 -- 建立網路**</span><span class="sxs-lookup"><span data-stu-id="2ef48-189">**Fail over to a secondary VMM site--create a network**</span></span> |<span data-ttu-id="2ef48-190">暫時性測試網路將根據您在 [邏輯網路] 及其相關網路站台中指定的設定自動建立。</span><span class="sxs-lookup"><span data-stu-id="2ef48-190">A temporary test network is created automatically based on the setting that you specify in **Logical Network** and its related network sites.</span></span> |<span data-ttu-id="2ef48-191">容錯移轉會檢查虛擬機器是否已建立。</span><span class="sxs-lookup"><span data-stu-id="2ef48-191">Failover checks that virtual machines are created.</span></span> |<span data-ttu-id="2ef48-192">如果復原計畫使用多個 VM 網路，請使用這個選項。</span><span class="sxs-lookup"><span data-stu-id="2ef48-192">Use this option if the recovery plan uses more than one VM network.</span></span> <span data-ttu-id="2ef48-193">如果您使用的是 Windows 網路虛擬化網路，這個選項會使用複本虛擬機器網路中的相同設定 (子網路和 IP 位址集區) 自動建立 VM 網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-193">If you're using Windows Network Virtualization networks, this option can automatically create VM networks with the same settings (subnets and IP address pools) in the network of the replica virtual machine.</span></span> <span data-ttu-id="2ef48-194">在測試容錯移轉完成後，這些 VM 網路將自動清除。</span><span class="sxs-lookup"><span data-stu-id="2ef48-194">These VM networks are cleaned up automatically after the test failover is complete.</span></span></p><p><span data-ttu-id="2ef48-195">測試虛擬機器會建立在與複本虛擬機器相同的主機上。</span><span class="sxs-lookup"><span data-stu-id="2ef48-195">The test virtual machine is created on the host where the replica virtual machine exists.</span></span> <span data-ttu-id="2ef48-196">它不會新增至複本虛擬機器所在的雲端。</span><span class="sxs-lookup"><span data-stu-id="2ef48-196">It isn’t added to the cloud where the replica virtual machine is located.</span></span> |

> [!TIP]
> <span data-ttu-id="2ef48-197">測試容錯移轉期間提供給虛擬機器的 IP 位址，與計劃性或非計劃性容錯移轉時虛擬機器收到的 IP 位址相同 (假設該 IP 位址可用於測試容錯移轉網路)。</span><span class="sxs-lookup"><span data-stu-id="2ef48-197">The IP address given to a virtual machine during test failover is the same IP address that the virtual machine would receive for a planned or unplanned failover (presuming that the IP address is available in the test failover network).</span></span> <span data-ttu-id="2ef48-198">如果在測試容錯移轉網路中無法使用相同的 IP 位址，虛擬機器會收到另一個可用於測試容錯移轉網路的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="2ef48-198">If the same IP address isn't available in the test failover network, the virtual machine receives another IP address that's available in the test failover network.</span></span>
>
>


## <a name="test-failover-to-a-production-network-on-a-recovery-site"></a><span data-ttu-id="2ef48-199">在復原網路上測試容錯移轉到生產網路</span><span class="sxs-lookup"><span data-stu-id="2ef48-199">Test failover to a production network on a recovery site</span></span>
<span data-ttu-id="2ef48-200">當您進行測試容錯移轉時，建議您選擇與在 [網路對應](https://docs.microsoft.com/azure/site-recovery/site-recovery-network-mapping) 中提供的生產復原網站網路不同的網路。</span><span class="sxs-lookup"><span data-stu-id="2ef48-200">We recommend that when you're doing a test failover, you choose a network that is different from your production recovery site network that you provided in [network mapping](https://docs.microsoft.com/azure/site-recovery/site-recovery-network-mapping).</span></span> <span data-ttu-id="2ef48-201">但是，如果您真的想驗證容錯移轉的虛擬機器中的端對端網路連線，請注意下列幾點︰</span><span class="sxs-lookup"><span data-stu-id="2ef48-201">But if you really want to validate end-to-end network connectivity in a failed-over virtual machine, note the following points:</span></span>

* <span data-ttu-id="2ef48-202">進行測試容錯移轉時，請確定主要虛擬機器已關機。</span><span class="sxs-lookup"><span data-stu-id="2ef48-202">Make sure that the primary virtual machine is shut down when you're doing the test failover.</span></span> <span data-ttu-id="2ef48-203">如果不這麼做，相同的網路中將同時有兩部虛擬機器以相同的身分識別執行。</span><span class="sxs-lookup"><span data-stu-id="2ef48-203">If you don't, two virtual machines with the same identity will be running in the same network at the same time.</span></span> <span data-ttu-id="2ef48-204">這可能造成不良的後果。</span><span class="sxs-lookup"><span data-stu-id="2ef48-204">That situation can lead to undesired consequences.</span></span>
* <span data-ttu-id="2ef48-205">當您清除測試容錯移轉虛擬機器時，您對測試容錯移轉虛擬機器所做的任何變更將會遺失。</span><span class="sxs-lookup"><span data-stu-id="2ef48-205">Any changes that you make to the test failover virtual machines are lost when you clean up the test failover virtual machines.</span></span> <span data-ttu-id="2ef48-206">這些變更不會複寫回主要虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="2ef48-206">These changes are not replicated back to the primary virtual machine.</span></span>
* <span data-ttu-id="2ef48-207">這種測試方式會導致生產應用程式的停機時間。</span><span class="sxs-lookup"><span data-stu-id="2ef48-207">This way of doing testing leads to downtime for your production application.</span></span> <span data-ttu-id="2ef48-208">進行 DR 訓練時，要求應用程式的使用者不要使用應用程式。</span><span class="sxs-lookup"><span data-stu-id="2ef48-208">Ask users of the application not to use the application when the DR drill is in progress.</span></span>  


## <a name="next-steps"></a><span data-ttu-id="2ef48-209">後續步驟</span><span class="sxs-lookup"><span data-stu-id="2ef48-209">Next steps</span></span>
<span data-ttu-id="2ef48-210">成功執行測試容錯移轉之後，您就可以嘗試執行[容錯移轉](site-recovery-failover.md)。</span><span class="sxs-lookup"><span data-stu-id="2ef48-210">After you have successfully run a test failover, you can try a [failover](site-recovery-failover.md).</span></span>
