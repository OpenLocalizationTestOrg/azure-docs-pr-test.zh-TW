---
title: "加密 Azure 虛擬機器 | Microsoft Docs"
description: "本文件可協助您在收到 Azure 資訊安全中心所發出的警示後，加密 Azure 虛擬機器。"
services: security, security-center
documentationcenter: na
author: TomShinder
manager: swadhwa
editor: 
ms.assetid: f6c28bc4-1f79-4352-89d0-03659b2fa2f5
ms.service: security
ms.devlang: na
ms.topic: hero-article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/15/2017
ms.author: tomsh
ms.openlocfilehash: 8d39aafb0ab7b0e87afdf4d2f50f1e224b8d251f
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="encrypt-an-azure-virtual-machine"></a><span data-ttu-id="6e98e-103">加密 Azure 虛擬機器</span><span class="sxs-lookup"><span data-stu-id="6e98e-103">Encrypt an Azure Virtual Machine</span></span>
<span data-ttu-id="6e98e-104">Azure 資訊安全中心會在您有未加密的虛擬機器時對您發出警示。</span><span class="sxs-lookup"><span data-stu-id="6e98e-104">Azure Security Center will alert you if you have virtual machines that are not encrypted.</span></span> <span data-ttu-id="6e98e-105">這些警示會顯示為高嚴重性，因此建議您加密這些虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="6e98e-105">These alerts will show as High Severity and the recommendation is to encrypt these virtual machines.</span></span>

![磁碟加密建議](./media/security-center-disk-encryption/security-center-disk-encryption-fig1.png)

> [!NOTE]
> <span data-ttu-id="6e98e-107">這份文件中的資訊適用於加密虛擬機器，而不使用金鑰加密金鑰 (使用 Azure 備份來備份虛擬機器時需要)。</span><span class="sxs-lookup"><span data-stu-id="6e98e-107">The information in this document applies to encrypting virtual machines without using a Key Encryption Key (which is required for backing up virtual machines using Azure Backup).</span></span> <span data-ttu-id="6e98e-108">如需有關如何使用金鑰加密金鑰，以支援加密 Azure 虛擬機器之 Azure 備份的資訊，請參閱[適用於 Windows 和 Linux 虛擬機器的 Azure 磁碟加密](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption)一文。</span><span class="sxs-lookup"><span data-stu-id="6e98e-108">Please see the article [Azure Disk Encryption for Windows and Linux Azure Virtual Machines](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) for information on how to use a Key Encryption Key to support Azure Backup for encrypted Azure Virtual Machines.</span></span>
>
>

<span data-ttu-id="6e98e-109">若要加密已由 Azure 資訊安全中心識別為需要加密的 Azure 虛擬機器，建議您執行下列步驟︰</span><span class="sxs-lookup"><span data-stu-id="6e98e-109">To encrypt Azure Virtual Machines that have been identified by Azure Security Center as needing encryption, we recommend the following steps:</span></span>

* <span data-ttu-id="6e98e-110">安裝並設定 Azure PowerShell。</span><span class="sxs-lookup"><span data-stu-id="6e98e-110">Install and configure Azure PowerShell.</span></span> <span data-ttu-id="6e98e-111">這可讓您執行必要的 PowerShell 命令，以便設定用來加密 Azure 虛擬機器的必要先決條件。</span><span class="sxs-lookup"><span data-stu-id="6e98e-111">This will enable you to run the PowerShell commands required to set up the prerequisites required to encrypt Azure Virtual Machines.</span></span>
* <span data-ttu-id="6e98e-112">取得並執行 Azure 磁碟加密先決條件 Azure PowerShell 指令碼</span><span class="sxs-lookup"><span data-stu-id="6e98e-112">Obtain and run the Azure Disk Encryption Prerequisites Azure PowerShell script</span></span>
* <span data-ttu-id="6e98e-113">加密虛擬機器</span><span class="sxs-lookup"><span data-stu-id="6e98e-113">Encrypt your virtual machines</span></span>

<span data-ttu-id="6e98e-114">本文件的目標是讓您可以加密虛擬機器，即使您只略為了解或完全不了解 Azure PowerShell。</span><span class="sxs-lookup"><span data-stu-id="6e98e-114">The goal of this document is to enable you to encrypt your virtual machines, even if you have little or no background in Azure PowerShell.</span></span>
<span data-ttu-id="6e98e-115">本文件假設您使用 Windows 10 做為用戶端電腦，並從中設定 Azure 磁碟加密。</span><span class="sxs-lookup"><span data-stu-id="6e98e-115">This document assumes you are using Windows 10 as the client machine from which you will configure Azure Disk Encryption.</span></span>

<span data-ttu-id="6e98e-116">若要設定先決條件以及設定 Azure 虛擬機器的加密功能，可以使用的方法很多。</span><span class="sxs-lookup"><span data-stu-id="6e98e-116">There are many approaches that can be used to setup the prerequisites and to configure encryption for Azure Virtual Machines.</span></span> <span data-ttu-id="6e98e-117">如果您已經很熟悉 Azure PowerShell 或 Azure CLI，可能會想要使用其他方法。</span><span class="sxs-lookup"><span data-stu-id="6e98e-117">If you are already well-versed in Azure PowerShell or Azure CLI, then you may prefer to use alternate approaches.</span></span>

> [!NOTE]
> <span data-ttu-id="6e98e-118">若要深入了解其他可為 Azure 虛擬機器設定加密功能的方法，請參閱 [適用於 Windows 和 Linux Azure 虛擬機器的 Azure 磁碟加密](https://gallery.technet.microsoft.com/Azure-Disk-Encryption-for-a0018eb0)。</span><span class="sxs-lookup"><span data-stu-id="6e98e-118">To learn more about alternate approaches to configuring encryption for Azure virtual machines, please see [Azure Disk Encryption for Windows and Linux Azure Virtual Machines](https://gallery.technet.microsoft.com/Azure-Disk-Encryption-for-a0018eb0).</span></span>
>
>

## <a name="install-and-configure-azure-powershell"></a><span data-ttu-id="6e98e-119">安裝並設定 Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="6e98e-119">Install and configure Azure PowerShell</span></span>
<span data-ttu-id="6e98e-120">您的電腦上需要安裝 Azure PowerShell 1.2.1 版或更新版本。</span><span class="sxs-lookup"><span data-stu-id="6e98e-120">You need Azure PowerShell version 1.2.1 or above installed on your computer.</span></span> <span data-ttu-id="6e98e-121">[如何安裝和設定 Azure PowerShell](/powershell/azure/overview) 一文含有佈建電腦以使用 Azure PowerShell 的所有所需步驟。</span><span class="sxs-lookup"><span data-stu-id="6e98e-121">The article [How to install and configure Azure PowerShell](/powershell/azure/overview) contains all the steps you need to provision your computer to work with Azure PowerShell.</span></span> <span data-ttu-id="6e98e-122">最直接的方法是使用該文章所述的 Web PI 安裝方法。</span><span class="sxs-lookup"><span data-stu-id="6e98e-122">The most straightforward approach is to use the Web PI installation approach mentioned in that article.</span></span> <span data-ttu-id="6e98e-123">即使您已安裝 Azure PowerShell，仍請使用 Web PI 方法再安裝一次，以便擁有最新的 Azure PowerShell 版本。</span><span class="sxs-lookup"><span data-stu-id="6e98e-123">Even if you already have Azure PowerShell installed, install again using the Web PI approach so that you have the latest version of Azure PowerShell.</span></span>

## <a name="obtain-and-run-the-azure-disk-encryption-prerequisites-configuration-script"></a><span data-ttu-id="6e98e-124">取得並執行 Azure 磁碟加密先決條件組態指令碼</span><span class="sxs-lookup"><span data-stu-id="6e98e-124">Obtain and run the Azure disk encryption prerequisites configuration script</span></span>
<span data-ttu-id="6e98e-125">Azure 磁碟加密先決條件組態指令碼會設定用來加密 Azure 虛擬機器所需的所有先決條件。</span><span class="sxs-lookup"><span data-stu-id="6e98e-125">The Azure Disk Encryption Prerequisites Configuration Script will set up all the prerequisites required for encrypting your Azure Virtual Machines.</span></span>

1. <span data-ttu-id="6e98e-126">移至有 [Azure 磁碟加密先決條件設定指令碼](https://github.com/Azure/azure-powershell/blob/master/src/ResourceManager/Compute/Commands.Compute/Extension/AzureDiskEncryption/Scripts/AzureDiskEncryptionPreRequisiteSetup.ps1)的 GitHub 頁面。</span><span class="sxs-lookup"><span data-stu-id="6e98e-126">Go to the GitHub page that has the [Azure Disk Encryption Prerequisite Setup Script](https://github.com/Azure/azure-powershell/blob/master/src/ResourceManager/Compute/Commands.Compute/Extension/AzureDiskEncryption/Scripts/AzureDiskEncryptionPreRequisiteSetup.ps1).</span></span>
2. <span data-ttu-id="6e98e-127">在 GibHub 頁面上，按一下 [RAW]  按鈕。</span><span class="sxs-lookup"><span data-stu-id="6e98e-127">On the GibHub page, click the **Raw** button.</span></span>
3. <span data-ttu-id="6e98e-128">使用 **CTRL-A** 選取頁面上的所有文字，然後使用 **CTRL-C** 將頁面上的所有文字複製到剪貼簿。</span><span class="sxs-lookup"><span data-stu-id="6e98e-128">Use **CTRL-A** to select all the text on the page and then use **CTRL-C** to copy all the text on the page to the clipboard.</span></span>
4. <span data-ttu-id="6e98e-129">開啟 [記事本]  並將複製的文字貼入 [記事本]。</span><span class="sxs-lookup"><span data-stu-id="6e98e-129">Open **Notepad** and paste the copied text into Notepad.</span></span>
5. <span data-ttu-id="6e98e-130">在 C: 磁碟機上建立名為 **AzureADEScript**的新資料夾。</span><span class="sxs-lookup"><span data-stu-id="6e98e-130">Create a new folder on your C: drive named **AzureADEScript**.</span></span>
6. <span data-ttu-id="6e98e-131">儲存 [記事本] 檔案，方法是依序按一下 [檔案] 和 [另存新檔]。</span><span class="sxs-lookup"><span data-stu-id="6e98e-131">Save the Notepad file – click **File**, then click **Save As**.</span></span> <span data-ttu-id="6e98e-132">在 [檔案名稱] 文字方塊中，輸入 **“ADEPrereqScript.ps1”**，並按一下 [儲存]。</span><span class="sxs-lookup"><span data-stu-id="6e98e-132">In the File name textbox, enter **“ADEPrereqScript.ps1”** and click **Save**.</span></span> <span data-ttu-id="6e98e-133">(請務必在名稱前後加上引號，否則檔案將會儲存為 .txt 副檔名)。</span><span class="sxs-lookup"><span data-stu-id="6e98e-133">(make sure you put the quotation marks around the name, otherwise it will save the file with a .txt file extension).</span></span>

<span data-ttu-id="6e98e-134">您已儲存了指令碼內容，接下來請在 PowerShell ISE 中開啟指令碼︰</span><span class="sxs-lookup"><span data-stu-id="6e98e-134">Now that the script content is saved, open the script in the PowerShell ISE:</span></span>

1. <span data-ttu-id="6e98e-135">在 [開始] 功能表中，按一下 [Cortana]。</span><span class="sxs-lookup"><span data-stu-id="6e98e-135">In the Start Menu, click **Cortana**.</span></span> <span data-ttu-id="6e98e-136">在 Cortana 搜尋文字方塊中輸入 **PowerShell**，以向 **Cortana** 詢問 "PowerShell"。</span><span class="sxs-lookup"><span data-stu-id="6e98e-136">Ask **Cortana** “PowerShell” by typing **PowerShell** in the Cortana search text box.</span></span>
2. <span data-ttu-id="6e98e-137">用滑鼠右鍵按一下 [Windows PowerShell ISE]，然後按一下 [以系統管理員身分執行]。</span><span class="sxs-lookup"><span data-stu-id="6e98e-137">Right click **Windows PowerShell ISE** and click **Run as administrator**.</span></span>
3. <span data-ttu-id="6e98e-138">在 [系統管理員: Windows PowerShell ISE] 視窗中，依序按一下 [檢視] 和 [顯示指令碼窗格]。</span><span class="sxs-lookup"><span data-stu-id="6e98e-138">In the **Administrator: Windows PowerShell ISE** window, click **View** and then click **Show Script Pane**.</span></span>
4. <span data-ttu-id="6e98e-139">如果您在視窗右側看到 [命令] 窗格，請按一下窗格右上角的 **“x”** 以將它關閉。</span><span class="sxs-lookup"><span data-stu-id="6e98e-139">If you see the **Commands** pane on the right side of the window, click the **“x”** in the top right corner of the pane to close it.</span></span> <span data-ttu-id="6e98e-140">如果文字太小以致您看不清楚，請使用 **CTRL+加** (「加」是指「+」號)。</span><span class="sxs-lookup"><span data-stu-id="6e98e-140">If the text is too small for you to see, use **CTRL+Add** (“Add” is the “+” sign).</span></span> <span data-ttu-id="6e98e-141">如果文字太大，請使用 **CTRL+減** (「減」是指「-」號)。</span><span class="sxs-lookup"><span data-stu-id="6e98e-141">If the text is too large, use **CTRL+Subtract** (Subtract is the “-“ sign).</span></span>
5. <span data-ttu-id="6e98e-142">依序按一下 [檔案] 和 [開啟]。</span><span class="sxs-lookup"><span data-stu-id="6e98e-142">Click **File** and then click **Open**.</span></span> <span data-ttu-id="6e98e-143">瀏覽至 **C:\AzureADEScript** 資料夾，然後連按兩下 **ADEPrereqScript**。</span><span class="sxs-lookup"><span data-stu-id="6e98e-143">Navigate to the **C:\AzureADEScript** folder and the double-click on the **ADEPrereqScript**.</span></span>
6. <span data-ttu-id="6e98e-144">**ADEPrereqScript** 內容現在應該會出現在 PowerShell ISE 中，並且會加上色彩標示以幫助您更輕鬆地識別各種元件 (例如命令、參數和變數)。</span><span class="sxs-lookup"><span data-stu-id="6e98e-144">The **ADEPrereqScript** contents should now appear in the PowerShell ISE and is color-coded to help you see various components, such as commands, parameters and variables more easily.</span></span>

<span data-ttu-id="6e98e-145">您現在應該會看到類似下圖的內容：</span><span class="sxs-lookup"><span data-stu-id="6e98e-145">You should now see something like the figure below.</span></span>

![PowerShell ISE 視窗](./media/security-center-disk-encryption/security-center-disk-encryption-fig2.png)

<span data-ttu-id="6e98e-147">上方窗格稱為「指令碼窗格」，下方窗格則稱為「主控台」。</span><span class="sxs-lookup"><span data-stu-id="6e98e-147">The top pane is referred to as the “script pane” and the bottom pane is referred to as the “console”.</span></span> <span data-ttu-id="6e98e-148">本文稍後將會使用這些詞彙。</span><span class="sxs-lookup"><span data-stu-id="6e98e-148">We will use these terms later in this article.</span></span>

## <a name="run-the-azure-disk-encryption-prerequisites-powershell-command"></a><span data-ttu-id="6e98e-149">執行 Azure 磁碟加密先決條件 PowerShell 命令</span><span class="sxs-lookup"><span data-stu-id="6e98e-149">Run the Azure disk encryption prerequisites PowerShell command</span></span>
<span data-ttu-id="6e98e-150">在啟動 Azure 磁碟加密先決條件指令碼後，它會要求您提供下列資訊︰</span><span class="sxs-lookup"><span data-stu-id="6e98e-150">The Azure Disk Encryption Prerequisites script will ask you for the following information after you start the script:</span></span>

* <span data-ttu-id="6e98e-151">**資源群組名稱** - 您要用來放置金鑰保存庫的資源群組名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-151">**Resource Group Name** - Name of the Resource Group that you want to put the Key Vault into.</span></span>  <span data-ttu-id="6e98e-152">如果還未建立具有所輸入名稱的資源群組，則會以該名稱建立新的資源群組。</span><span class="sxs-lookup"><span data-stu-id="6e98e-152">A new Resource Group with the name you enter will be created if there isn’t already one with that name created.</span></span> <span data-ttu-id="6e98e-153">如果此訂用帳戶中已有您想要使用的資源群組，則請輸入該資源群組的名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-153">If you already have a Resource Group that you want to use in this subscription, then enter the name of that Resource Group.</span></span>
* <span data-ttu-id="6e98e-154">**金鑰保存庫名稱** - 要用來放置加密金鑰的金鑰保存庫名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-154">**Key Vault Name** - Name of the Key Vault in which encryption keys are to be placed.</span></span> <span data-ttu-id="6e98e-155">如果您沒有此名稱的金鑰保存庫，則會以此名稱建立新的金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="6e98e-155">A new Key Vault with this name will be created if you don’t already have a Key Vault with this name.</span></span> <span data-ttu-id="6e98e-156">如果您已有想要使用的金鑰保存庫，請輸入現有金鑰保存庫的名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-156">If you already have a Key Vault that you want to use, enter the name of the existing Key Vault.</span></span>
* <span data-ttu-id="6e98e-157">**位置** - 金鑰保存庫的位置。</span><span class="sxs-lookup"><span data-stu-id="6e98e-157">**Location** - Location of the Key Vault.</span></span> <span data-ttu-id="6e98e-158">請確定金鑰保存庫和要加密的 VM 位於相同位置。</span><span class="sxs-lookup"><span data-stu-id="6e98e-158">Make sure the Key Vault and VMs to be encrypted are in the same location.</span></span> <span data-ttu-id="6e98e-159">如果您不知道位置在哪，本文稍後會有示範如何尋找的步驟。</span><span class="sxs-lookup"><span data-stu-id="6e98e-159">If you don’t know the location, there are steps later in this article that will show you how to find out.</span></span>
* <span data-ttu-id="6e98e-160">**Azure Active Directory 應用程式名稱** - 用來將密碼寫入金鑰保存庫之 Azure Active Directory 應用程式的名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-160">**Azure Active Directory Application Name** - Name of the Azure Active Directory application that will be used to write secrets to the Key Vault.</span></span> <span data-ttu-id="6e98e-161">如果不存在此名稱的應用程式，將會以此名稱建立新的應用程式。</span><span class="sxs-lookup"><span data-stu-id="6e98e-161">A new application with this name will be created if one doesn't exist.</span></span> <span data-ttu-id="6e98e-162">如果您已有想要使用的 Azure Active Directory 應用程式，請輸入該 Azure Active Directory 應用程式的名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-162">If you already have an Azure Active Directory application that you want to use, enter the name of that Azure Active Directory application.</span></span>

> [!NOTE]
> <span data-ttu-id="6e98e-163">如果您想知道為何需要建立 Azure Active Directory 應用程式，請參閱 *開始使用 Azure 金鑰保存庫* 一文的 [向 Azure Active Directory 註冊應用程式](../key-vault/key-vault-get-started.md)章節。</span><span class="sxs-lookup"><span data-stu-id="6e98e-163">If you’re curious as to why you need to create an Azure Active Directory application, please see *Register an application with Azure Active Directory* section in the article [Getting Started with Azure Key Vault](../key-vault/key-vault-get-started.md).</span></span>
>
>

<span data-ttu-id="6e98e-164">執行下列步驟來加密 Azure 虛擬機器︰</span><span class="sxs-lookup"><span data-stu-id="6e98e-164">Perform the following steps to encrypt an Azure Virtual Machine:</span></span>

1. <span data-ttu-id="6e98e-165">如果您已關閉 PowerShell ISE，請開啟已提升權限的 PowerShell ISE 執行個體。</span><span class="sxs-lookup"><span data-stu-id="6e98e-165">If you closed the PowerShell ISE, open an elevated instance of the PowerShell ISE.</span></span> <span data-ttu-id="6e98e-166">如果尚未開啟 PowerShell ISE，請遵循本文稍早的指示。</span><span class="sxs-lookup"><span data-stu-id="6e98e-166">Follow the instructions earlier in this article if the PowerShell ISE is not already open.</span></span> <span data-ttu-id="6e98e-167">如果您已關閉指令碼，請開啟 **ADEPrereqScript.ps1**，方法是依序按一下 [檔案] 和 [開啟]，然後選取 **c:\AzureADEScript** 資料夾中的指令碼。</span><span class="sxs-lookup"><span data-stu-id="6e98e-167">If you closed the script, then open the **ADEPrereqScript.ps1** clicking **File**, then **Open** and selecting the script from the **c:\AzureADEScript** folder.</span></span> <span data-ttu-id="6e98e-168">如果您從一開始就遵循本文的指示進行，請直接移至下一個步驟。</span><span class="sxs-lookup"><span data-stu-id="6e98e-168">If you have followed this article from the start, then just move on to the next step.</span></span>
2. <span data-ttu-id="6e98e-169">在 PowerShell ISE 的主控台 (PowerShell ISE 的下方窗格) 中，將焦點變更至指令碼的本機位置，方法是輸入 **cd c:\AzureADEScript**，然後按 **ENTER** 鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-169">In the console of the PowerShell ISE (the bottom pane of the PowerShell ISE), change the focus to the local of the script by typing **cd c:\AzureADEScript** and press **ENTER**.</span></span>
3. <span data-ttu-id="6e98e-170">設定機器的執行原則以便可以執行指令碼。</span><span class="sxs-lookup"><span data-stu-id="6e98e-170">Set the execution policy on your machine so that you can run the script.</span></span> <span data-ttu-id="6e98e-171">在主控台輸入 **Set-ExecutionPolicy Unrestricted** ，然後按 ENTER 鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-171">Type **Set-ExecutionPolicy Unrestricted** in the console and then press ENTER.</span></span> <span data-ttu-id="6e98e-172">如果出現對話方塊指出執行原則變更所帶來的影響，請按一下 **[全部都是]** 或 **[是]** \(如果有看到 **[全部都是]**，請選取該選項；如果沒看到 **[全部都是]**，則請按一下 **[是]**)。</span><span class="sxs-lookup"><span data-stu-id="6e98e-172">If you see a dialog box telling about the effects of the change to execution policy, click either **Yes to all** or **Yes** (if you see **Yes to all**, select that option – if you do not see **Yes to all**, then click **Yes**).</span></span>
4. <span data-ttu-id="6e98e-173">登入 Azure 帳戶。</span><span class="sxs-lookup"><span data-stu-id="6e98e-173">Log into your Azure account.</span></span> <span data-ttu-id="6e98e-174">在主控台中輸入 **Login-AzureRmAccount**，然後按 **ENTER** 鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-174">In the console, type **Login-AzureRmAccount** and press **ENTER**.</span></span> <span data-ttu-id="6e98e-175">隨即會出現對話方塊供您輸入認證 (請確定您有變更虛擬機器的權限；如果沒有權限，就無法將其加密。</span><span class="sxs-lookup"><span data-stu-id="6e98e-175">A dialog box will appear in which you enter your credentials (make sure you have rights to change the virtual machines – if you do not have rights, you will not be able to encrypt them.</span></span> <span data-ttu-id="6e98e-176">如果不能確定，請詢問訂用帳戶擁有者或系統管理員)。</span><span class="sxs-lookup"><span data-stu-id="6e98e-176">If you are not sure, ask your subscription owner or administrator).</span></span> <span data-ttu-id="6e98e-177">您應該會看到您 **Environment**、**Account**、**TenantId**、**SubscriptionId** 和 **CurrentStorageAccount** 的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="6e98e-177">You should see information about your **Environment**, **Account**, **TenantId**, **SubscriptionId** and **CurrentStorageAccount**.</span></span> <span data-ttu-id="6e98e-178">請將 **SubscriptionId** 複製到 [記事本]。</span><span class="sxs-lookup"><span data-stu-id="6e98e-178">Copy the **SubscriptionId** to Notepad.</span></span> <span data-ttu-id="6e98e-179">步驟 6 會用到此資訊。</span><span class="sxs-lookup"><span data-stu-id="6e98e-179">You will need to use this in step #6.</span></span>
5. <span data-ttu-id="6e98e-180">尋找虛擬機器所隸屬的訂用帳戶以及虛擬機器的位置。</span><span class="sxs-lookup"><span data-stu-id="6e98e-180">Find what subscription your virtual machine belongs to and its location.</span></span> <span data-ttu-id="6e98e-181">移至 [https://portal.azure.com](ttps://portal.azure.com) 並登入。</span><span class="sxs-lookup"><span data-stu-id="6e98e-181">Go to [https://portal.azure.com](ttps://portal.azure.com) and log in.</span></span>  <span data-ttu-id="6e98e-182">在頁面左側按一下 [虛擬機器] 。</span><span class="sxs-lookup"><span data-stu-id="6e98e-182">On the left side of the page, click **Virtual Machines**.</span></span> <span data-ttu-id="6e98e-183">您將會看到虛擬機器和其所屬訂用帳戶的清單。</span><span class="sxs-lookup"><span data-stu-id="6e98e-183">You will see a list of your virtual machines and the subscriptions they belong to.</span></span>

   ![虛擬機器](./media/security-center-disk-encryption/security-center-disk-encryption-fig3.png)
6. <span data-ttu-id="6e98e-185">返回 PowerShell ISE。</span><span class="sxs-lookup"><span data-stu-id="6e98e-185">Return to the PowerShell ISE.</span></span> <span data-ttu-id="6e98e-186">設定用來執行指令碼的訂用帳戶內容。</span><span class="sxs-lookup"><span data-stu-id="6e98e-186">Set the subscription context in which the script will be run.</span></span> <span data-ttu-id="6e98e-187">在主控台中，輸入 **Select-AzureRmSubscription –SubscriptionId <your_subscription_Id>** (使用您的實際訂用帳戶識別碼取代 **< your_subscription_Id >**) 然後按 **ENTER**鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-187">In the console, type **Select-AzureRmSubscription –SubscriptionId <your_subscription_Id>** (replace **< your_subscription_Id >** with your actual Subscription ID) and press **ENTER**.</span></span> <span data-ttu-id="6e98e-188">您會看到您 Environment、**Account**、**TenantId**、**SubscriptionId** 和 **CurrentStorageAccount** 的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="6e98e-188">You will see information about the Environment, **Account**, **TenantId**, **SubscriptionId** and **CurrentStorageAccount**.</span></span>
7. <span data-ttu-id="6e98e-189">您現在可以開始執行指令碼。</span><span class="sxs-lookup"><span data-stu-id="6e98e-189">You are now ready to run the script.</span></span> <span data-ttu-id="6e98e-190">按一下 [執行指令碼] 按鈕或按鍵盤上的 **F5** 鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-190">Click the **Run Script** button or press **F5** on the keyboard.</span></span>

   ![執行 PowerShell 指令碼](./media/security-center-disk-encryption/security-center-disk-encryption-fig4.png)
8. <span data-ttu-id="6e98e-192">指令碼會要求輸入 [resourceGroupName:] - 輸入想要使用的資源群組名稱，然後按 **ENTER** 鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-192">The script asks for **resourceGroupName:** - enter the name of *Resource Group* you want to use, then press **ENTER**.</span></span> <span data-ttu-id="6e98e-193">如果您沒有資源群組，請輸入新的資源群組所要使用的名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-193">If you don’t have one, enter a name you want to use for a new one.</span></span> <span data-ttu-id="6e98e-194">如果您已有想要使用的 *資源群組* (例如虛擬機器所在的資源群組)，請輸入現有資源群組的名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-194">If you already have a *Resource Group* that you want to use (such as the one that your virtual machine is in), enter the name of the existing Resource Group.</span></span>
9. <span data-ttu-id="6e98e-195">指令碼會要求輸入 [keyVaultName:]  - 輸入想要使用的 *金鑰保存庫* 名稱，然後按 ENTER 鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-195">The script asks for **keyVaultName:** - enter the name of the *Key Vault* you want to use, then press ENTER.</span></span> <span data-ttu-id="6e98e-196">如果您沒有資源群組，請輸入新的資源群組所要使用的名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-196">If you don’t have one, enter a name you want to use for a new one.</span></span> <span data-ttu-id="6e98e-197">如果您已有想要使用的金鑰保存庫，請輸入現有 *金鑰保存庫*的名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-197">If you already have a Key Vault that you want to use, enter the name of the existing *Key Vault*.</span></span>
10. <span data-ttu-id="6e98e-198">指令碼會要求輸入 [位置:] - 輸入想要加密之 VM 所在位置的名稱，然後按 **ENTER** 鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-198">The script asks for **location:** - enter the name of the location in which the VM you want to encrypt is located, then press **ENTER**.</span></span> <span data-ttu-id="6e98e-199">如果不記得位置，請返回步驟 5。</span><span class="sxs-lookup"><span data-stu-id="6e98e-199">If you don’t remember the location, go back to step #5.</span></span>
11. <span data-ttu-id="6e98e-200">指令碼會要求輸入 [aadAppName:] - 輸入想要使用的 Azure Active Directory 應用程式名稱，然後按 **ENTER** 鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-200">The script asks for **aadAppName:** - enter the name of the *Azure Active Directory* application you want to use, then press **ENTER**.</span></span> <span data-ttu-id="6e98e-201">如果您沒有資源群組，請輸入新的資源群組所要使用的名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-201">If you don’t have one, enter a name you want to use for a new one.</span></span> <span data-ttu-id="6e98e-202">如果您已有想要使用的 Azure Active Directory 應用程式，請輸入現有 Azure Active Directory 應用程式的名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-202">If you already have an *Azure Active Directory application* that you want to use, enter the name of the existing *Azure Active Directory application*.</span></span>
12. <span data-ttu-id="6e98e-203">此時會出現登入對話方塊。</span><span class="sxs-lookup"><span data-stu-id="6e98e-203">A log in dialog box will appear.</span></span> <span data-ttu-id="6e98e-204">請提供您的認證 (沒錯，您已登入過一次，但現在您需要再做一次)。</span><span class="sxs-lookup"><span data-stu-id="6e98e-204">Provide your credentials (yes, you have logged in once, but now you need to do it again).</span></span>
13. <span data-ttu-id="6e98e-205">指令碼隨即執行，並且會於完成時要求您複製 **aadClientID**、**aadClientSecret**、**diskEncryptionKeyVaultUrl** 和 **keyVaultResourceId** 的值。</span><span class="sxs-lookup"><span data-stu-id="6e98e-205">The script runs and when complete it will ask you to copy the values of the **aadClientID**, **aadClientSecret**, **diskEncryptionKeyVaultUrl**, and **keyVaultResourceId**.</span></span> <span data-ttu-id="6e98e-206">將這些值各自複製到剪貼簿並貼入 [記事本]。</span><span class="sxs-lookup"><span data-stu-id="6e98e-206">Copy each of these values to the clipboard and paste them into Notepad.</span></span>
14. <span data-ttu-id="6e98e-207">返回 PowerShell ISE 並將游標放在最後一行結尾，然後按 **ENTER**鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-207">Return to the PowerShell ISE and place the cursor at the end of the last line, and press **ENTER**.</span></span>

<span data-ttu-id="6e98e-208">指令碼的輸出看起來應該會像以下畫面︰</span><span class="sxs-lookup"><span data-stu-id="6e98e-208">The output of the script should look something like the screen below:</span></span>

![PowerShell 輸出](./media/security-center-disk-encryption/security-center-disk-encryption-fig5.png)

## <a name="encrypt-the-azure-virtual-machine"></a><span data-ttu-id="6e98e-210">加密 Azure 虛擬機器</span><span class="sxs-lookup"><span data-stu-id="6e98e-210">Encrypt the Azure virtual machine</span></span>
<span data-ttu-id="6e98e-211">現在，您已準備好加密虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="6e98e-211">You are now ready to encrypt your virtual machine.</span></span> <span data-ttu-id="6e98e-212">如果虛擬機器和金鑰保存庫位於相同資源群組，您可以移至＜加密步驟＞一節。</span><span class="sxs-lookup"><span data-stu-id="6e98e-212">If your virtual machine is located in the same Resource Group as your Key Vault, you can move on to the encryption steps section.</span></span> <span data-ttu-id="6e98e-213">不過，如果虛擬機器和金鑰保存庫並非位在相同資源群組，則必須在 PowerShell ISE 的主控台中輸入下列命令︰</span><span class="sxs-lookup"><span data-stu-id="6e98e-213">However, if your virtual machine is not in the same Resource Group as your Key Vault, you will need to enter the following in the console in the PowerShell ISE:</span></span>

<span data-ttu-id="6e98e-214">**$resourceGroupName = <’Virtual_Machine_RG’>**</span><span class="sxs-lookup"><span data-stu-id="6e98e-214">**$resourceGroupName = <’Virtual_Machine_RG’>**</span></span>

<span data-ttu-id="6e98e-215">請將 **< Virtual_Machine_RG >** 更換為虛擬機器所在資源群組的名稱，並以單引號括住。</span><span class="sxs-lookup"><span data-stu-id="6e98e-215">Replace **< Virtual_Machine_RG >** with the name of the Resource Group in which your virtual machines are contained, surrounded by a single quote.</span></span> <span data-ttu-id="6e98e-216">然後按 **ENTER**鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-216">Then press **ENTER**.</span></span>
<span data-ttu-id="6e98e-217">若要確認輸入的資源群組名稱沒有錯誤，請在 PowerShell ISE 主控台中輸入下列命令︰</span><span class="sxs-lookup"><span data-stu-id="6e98e-217">To confirm that the correct Resource Group name was entered, type the following in the PowerShell ISE console:</span></span>

<span data-ttu-id="6e98e-218">**$resourceGroupName**</span><span class="sxs-lookup"><span data-stu-id="6e98e-218">**$resourceGroupName**</span></span>

<span data-ttu-id="6e98e-219">按 **ENTER**鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-219">Press **ENTER**.</span></span> <span data-ttu-id="6e98e-220">您應該會看到虛擬機器所在資源群組的名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-220">You should see the name of Resource Group that your virtual machines are located in.</span></span> <span data-ttu-id="6e98e-221">例如：</span><span class="sxs-lookup"><span data-stu-id="6e98e-221">For example:</span></span>

![PowerShell 輸出](./media/security-center-disk-encryption/security-center-disk-encryption-fig6.png)

### <a name="encryption-steps"></a><span data-ttu-id="6e98e-223">加密步驟</span><span class="sxs-lookup"><span data-stu-id="6e98e-223">Encryption steps</span></span>
<span data-ttu-id="6e98e-224">首先，您必須提供想要加密的虛擬機器名稱給 PowerShell。</span><span class="sxs-lookup"><span data-stu-id="6e98e-224">First, you need to tell PowerShell the name of the virtual machine you want to encrypt.</span></span> <span data-ttu-id="6e98e-225">在主控台中輸入︰</span><span class="sxs-lookup"><span data-stu-id="6e98e-225">In the console, type:</span></span>

<span data-ttu-id="6e98e-226">**$vmName = <’your_vm_name’>**</span><span class="sxs-lookup"><span data-stu-id="6e98e-226">**$vmName = <’your_vm_name’>**</span></span>

<span data-ttu-id="6e98e-227">將 **<’your_vm_name’>** 更換為 VM 的名稱 (請確定名稱已用單引號括住)，然後按 **ENTER** 鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-227">Replace **<’your_vm_name’>** with the name of your VM (make sure the name is surrounded by a single quote) and then press **ENTER**.</span></span>

<span data-ttu-id="6e98e-228">若要確認輸入的 VM 名稱沒有錯誤，請輸入︰</span><span class="sxs-lookup"><span data-stu-id="6e98e-228">To confirm that the correct VM name was entered, type:</span></span>

<span data-ttu-id="6e98e-229">**$vmName**</span><span class="sxs-lookup"><span data-stu-id="6e98e-229">**$vmName**</span></span>

<span data-ttu-id="6e98e-230">按 **ENTER**鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-230">Press **ENTER**.</span></span> <span data-ttu-id="6e98e-231">您應該會看到想要加密的虛擬機器名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-231">You should see the name of the virtual machine you want to encrypt.</span></span> <span data-ttu-id="6e98e-232">例如：</span><span class="sxs-lookup"><span data-stu-id="6e98e-232">For example:</span></span>

![PowerShell 輸出](./media/security-center-disk-encryption/security-center-disk-encryption-fig7.png)

<span data-ttu-id="6e98e-234">有兩種方法可執行加密命令，以將虛擬機器上的所有磁碟機加密。</span><span class="sxs-lookup"><span data-stu-id="6e98e-234">There are two methods to run the encryption command to encrypt all drives on the virtual machine.</span></span> <span data-ttu-id="6e98e-235">第一個方法是在 PowerShell ISE 主控台中輸入下列命令︰</span><span class="sxs-lookup"><span data-stu-id="6e98e-235">The first method is to type the following command in the PowerShell ISE console:</span></span>

~~~
Set-AzureRmVMDiskEncryptionExtension -ResourceGroupName $resourceGroupName -VMName $vmName -AadClientID $aadClientID -AadClientSecret $aadClientSecret -DiskEncryptionKeyVaultUrl $diskEncryptionKeyVaultUrl -DiskEncryptionKeyVaultId $keyVaultResourceId -VolumeType All
~~~

<span data-ttu-id="6e98e-236">在輸入此命令後，按 **ENTER**鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-236">After typing this command press **ENTER**.</span></span>

<span data-ttu-id="6e98e-237">第二個方法是在指令碼窗格 (PowerShell ISE 的上方窗格) 中按一下，然後向下捲動到指令碼底部。</span><span class="sxs-lookup"><span data-stu-id="6e98e-237">The second method is to click in the script pane (the top pane of the PowerShell ISE) and scroll down to the bottom of the script.</span></span> <span data-ttu-id="6e98e-238">反白顯示上面所列的命令並按一下滑鼠右鍵，然後按一下 [執行選取範圍] 或按鍵盤上的 **F8** 鍵。</span><span class="sxs-lookup"><span data-stu-id="6e98e-238">Highlight the command listed above, and then right click it and then click **Run Selection** or press **F8** on the keyboard.</span></span>

![PowerShell ISE](./media/security-center-disk-encryption/security-center-disk-encryption-fig8.png)

<span data-ttu-id="6e98e-240">不論您使用哪一種方法，都會出現對話方塊通知您，需要 10-15 分鐘才能完成作業。</span><span class="sxs-lookup"><span data-stu-id="6e98e-240">Regardless of the method you use, a dialog box will appear informing you that it will take 10-15 minutes for the operation to complete.</span></span> <span data-ttu-id="6e98e-241">按一下 [是] 。</span><span class="sxs-lookup"><span data-stu-id="6e98e-241">Click **Yes**.</span></span>

<span data-ttu-id="6e98e-242">加密程序進行時，您可以返回 Azure 入口網站，並查看虛擬機器的狀態。</span><span class="sxs-lookup"><span data-stu-id="6e98e-242">While the encryption process is taking place, you can return to the Azure Portal and see the status of the virtual machine.</span></span> <span data-ttu-id="6e98e-243">在頁面左側按一下 [虛擬機器]，然後在 [虛擬機器] 刀鋒視窗中按一下您要加密的虛擬機器名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-243">On the left side of the page, click **Virtual Machines**, then in the **Virtual Machines** blade, click the name of the virtual machine you’re encrypting.</span></span> <span data-ttu-id="6e98e-244">在出現的刀鋒視窗中，您會發現 [狀態] 指出其 [正在更新]。</span><span class="sxs-lookup"><span data-stu-id="6e98e-244">In the blade that appears, you’ll notice that the **Status** says that it’s **Updating**.</span></span> <span data-ttu-id="6e98e-245">下圖展示進行中的加密。</span><span class="sxs-lookup"><span data-stu-id="6e98e-245">This demonstrates that encryption is in process.</span></span>

![更多關於 VM 的詳細資料](./media/security-center-disk-encryption/security-center-disk-encryption-fig9.png)

<span data-ttu-id="6e98e-247">返回 PowerShell ISE。</span><span class="sxs-lookup"><span data-stu-id="6e98e-247">Return to the PowerShell ISE.</span></span> <span data-ttu-id="6e98e-248">指令碼完成時，您會看到下圖中所顯示的內容。</span><span class="sxs-lookup"><span data-stu-id="6e98e-248">When the script completes, you’ll see what appears in the figure below.</span></span>

![PowerShell 輸出](./media/security-center-disk-encryption/security-center-disk-encryption-fig10.png)

<span data-ttu-id="6e98e-250">為了證明虛擬機器現已加密，請返回 Azure 入口網站，然後按一下頁面左側的 [虛擬機器]  。</span><span class="sxs-lookup"><span data-stu-id="6e98e-250">To demonstrate that the virtual machine is now encrypted, return to the Azure Portal and click **Virtual Machines** on the left side of the page.</span></span> <span data-ttu-id="6e98e-251">按一下已加密之虛擬機器的名稱。</span><span class="sxs-lookup"><span data-stu-id="6e98e-251">Click the name of the virtual machine you encrypted.</span></span> <span data-ttu-id="6e98e-252">在 [設定] 刀鋒視窗中，按一下 [磁碟]。</span><span class="sxs-lookup"><span data-stu-id="6e98e-252">In the **Settings** blade, click **Disks**.</span></span>

![設定選項](./media/security-center-disk-encryption/security-center-disk-encryption-fig11.png)

<span data-ttu-id="6e98e-254">在 [磁碟] 刀鋒視窗中，您會看到 [加密] 是 [已啟用] 狀態。</span><span class="sxs-lookup"><span data-stu-id="6e98e-254">On the **Disks** blade, you will see that **Encryption** is **Enabled**.</span></span>

![磁碟屬性](./media/security-center-disk-encryption/security-center-disk-encryption-fig12.png)

## <a name="next-steps"></a><span data-ttu-id="6e98e-256">後續步驟</span><span class="sxs-lookup"><span data-stu-id="6e98e-256">Next steps</span></span>
<span data-ttu-id="6e98e-257">在本文件中，您已了解如何加密 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="6e98e-257">In this document, you learned how to encrypt an Azure Virtual Machine.</span></span> <span data-ttu-id="6e98e-258">若要深入了解「Azure 資訊安全中心」，請參閱下列主題：</span><span class="sxs-lookup"><span data-stu-id="6e98e-258">To learn more about Azure Security Center, see the following:</span></span>

* <span data-ttu-id="6e98e-259">[Azure 資訊安全中心的安全性健全狀況監視](security-center-monitoring.md) - 了解如何監視 Azure 資源的健全狀況</span><span class="sxs-lookup"><span data-stu-id="6e98e-259">[Security health monitoring in Azure Security Center](security-center-monitoring.md) – Learn how to monitor the health of your Azure resources</span></span>
* <span data-ttu-id="6e98e-260">[管理與回應 Azure 資訊安全中心的安全性警示](security-center-managing-and-responding-alerts.md) – 了解如何管理與回應安全性警示</span><span class="sxs-lookup"><span data-stu-id="6e98e-260">[Managing and responding to security alerts in Azure Security Center](security-center-managing-and-responding-alerts.md) - Learn how to manage and respond to security alerts</span></span>
* <span data-ttu-id="6e98e-261">[Azure 安全性中心常見問題集](security-center-faq.md) - 尋找使用服務的常見問題</span><span class="sxs-lookup"><span data-stu-id="6e98e-261">[Azure Security Center FAQ](security-center-faq.md) – Find frequently asked questions about using the service</span></span>
* <span data-ttu-id="6e98e-262">[Azure 安全性部落格](http://blogs.msdn.com/b/azuresecurity/) – 尋找有關 Azure 安全性與相容性的部落格文章</span><span class="sxs-lookup"><span data-stu-id="6e98e-262">[Azure Security Blog](http://blogs.msdn.com/b/azuresecurity/) – Find blog posts about Azure security and compliance</span></span>
