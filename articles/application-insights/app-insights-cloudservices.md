---
title: "Azure 雲端服務的 Application Insights | Microsoft Docs"
description: "使用 Application Insights 有效地監視您的 Web 和背景工作角色"
services: application-insights
documentationcenter: 
keywords: "WAD2AI, Azure 診斷"
author: CFreemanwa
manager: carmonm
editor: alancameronwills
ms.assetid: 5c7a5b34-329e-42b7-9330-9dcbb9ff1f88
ms.service: application-insights
ms.devlang: na
ms.tgt_pltfrm: ibiza
ms.topic: get-started-article
ms.workload: tbd
ms.date: 05/05/2017
ms.author: bwren
ms.openlocfilehash: c12b225aa351d0c272243469550791a6840091e0
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/18/2017
---
# <a name="application-insights-for-azure-cloud-services"></a><span data-ttu-id="a2de8-104">Azure 雲端服務的 Application Insights</span><span class="sxs-lookup"><span data-stu-id="a2de8-104">Application Insights for Azure Cloud Services</span></span>
<span data-ttu-id="a2de8-105">您可以透過 [Application Insights][start] 來監視 [Microsoft Azure 雲端服務應用程式](https://azure.microsoft.com/services/cloud-services/)，它會結合 Application Insights SDK 的資料與雲端服務的 [Azure 診斷](https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/azure-diagnostics)資料，來讓您了解應用程式的可用性、效能、失敗和使用情形。</span><span class="sxs-lookup"><span data-stu-id="a2de8-105">[Microsoft Azure Cloud service apps](https://azure.microsoft.com/services/cloud-services/) can be monitored by [Application Insights][start] for availability, performance, failures, and usage by combining data from Application Insights' SDKs with [Azure Diagnotics](https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/azure-diagnostics) data from your Cloud Services.</span></span> <span data-ttu-id="a2de8-106">當您取得有關應用程式在現實世界的效能和效率的意見反應時，您可以在每個開發生命週期中針對設計方向做出明智的抉擇。</span><span class="sxs-lookup"><span data-stu-id="a2de8-106">With the feedback you get about the performance and effectiveness of your app in the wild, you can make informed choices about the direction of the design in each development lifecycle.</span></span>

![範例](./media/app-insights-cloudservices/sample.png)

## <a name="before-you-start"></a><span data-ttu-id="a2de8-108">開始之前</span><span class="sxs-lookup"><span data-stu-id="a2de8-108">Before you start</span></span>
<span data-ttu-id="a2de8-109">您需要：</span><span class="sxs-lookup"><span data-stu-id="a2de8-109">You'll need:</span></span>

* <span data-ttu-id="a2de8-110">[Microsoft Azure](http://azure.com) 的訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="a2de8-110">A subscription with [Microsoft Azure](http://azure.com).</span></span> <span data-ttu-id="a2de8-111">使用 Microsoft 帳戶登入，可能是針對 Windows、XBox Live 或其他 Microsoft 雲端服務具備的帳戶。</span><span class="sxs-lookup"><span data-stu-id="a2de8-111">Sign in with a Microsoft account, which you might have for Windows, XBox Live, or other Microsoft cloud services.</span></span> 
* <span data-ttu-id="a2de8-112">Microsoft Azure 工具 2.9 或更新版本</span><span class="sxs-lookup"><span data-stu-id="a2de8-112">Microsoft Azure tools 2.9 or later</span></span>
* <span data-ttu-id="a2de8-113">開發人員分析工具 7.10 或更新版本</span><span class="sxs-lookup"><span data-stu-id="a2de8-113">Developer Analytics Tools 7.10 or later</span></span>

## <a name="quick-start"></a><span data-ttu-id="a2de8-114">快速入門</span><span class="sxs-lookup"><span data-stu-id="a2de8-114">Quick start</span></span>
<span data-ttu-id="a2de8-115">使用 Application Insights 來監視您雲端服務的最快、最簡單方式就是在將服務發佈到 Azure 時選擇該選項。</span><span class="sxs-lookup"><span data-stu-id="a2de8-115">The quickest and easiest way to monitor your cloud service with Application Insights is to choose that option when you publish your service to Azure.</span></span>

![範例](./media/app-insights-cloudservices/azure-cloud-application-insights.png)

<span data-ttu-id="a2de8-117">此選項會在執行階段檢測您的應用程式，為您提供監視您 Web 角色中的要求、例外狀況及相依性時所需的一切遙測，同時也提供來自背景工作角色的效能計數器。</span><span class="sxs-lookup"><span data-stu-id="a2de8-117">This option instruments your app at run time, giving you all the telemetry you need to monitor requests, exceptions, and dependencies in your web role, as well as performance counters from your worker roles.</span></span> <span data-ttu-id="a2de8-118">您應用程式產生的所有診斷追蹤資料也會一併傳送給 Application Insights。</span><span class="sxs-lookup"><span data-stu-id="a2de8-118">Any diagnostic traces generated by your app are also sent to Application Insights.</span></span>

<span data-ttu-id="a2de8-119">如果這就是您所需的一切，您就已大功告成！</span><span class="sxs-lookup"><span data-stu-id="a2de8-119">If that's all you need, you're done!</span></span> <span data-ttu-id="a2de8-120">接下來的步驟包括[檢視來自您應用程式的度量](app-insights-metrics-explorer.md)、[利用分析查詢您的資料](app-insights-analytics.md)，還可能包括設定[儀表板](app-insights-dashboards.md)。</span><span class="sxs-lookup"><span data-stu-id="a2de8-120">Next steps are [viewing metrics from your app](app-insights-metrics-explorer.md), [querying your data with Analytics](app-insights-analytics.md), and maybe setting up a [dashboard](app-insights-dashboards.md).</span></span> <span data-ttu-id="a2de8-121">您可以設定[可用性測試](app-insights-monitor-web-app-availability.md)及[在網頁中新增程式碼](app-insights-javascript.md)，以在瀏覽器中監視效能。</span><span class="sxs-lookup"><span data-stu-id="a2de8-121">You might want to set up [availability tests](app-insights-monitor-web-app-availability.md) and [add code to your web pages](app-insights-javascript.md) to monitor performance in the browser.</span></span>

<span data-ttu-id="a2de8-122">但是您也可以取得更多選項：</span><span class="sxs-lookup"><span data-stu-id="a2de8-122">But you can also get more options:</span></span>

* <span data-ttu-id="a2de8-123">將來自不同元件和組建組態的資料傳送給個別資源。</span><span class="sxs-lookup"><span data-stu-id="a2de8-123">Send data from different components and build configurations to separate resources.</span></span>
* <span data-ttu-id="a2de8-124">新增來自您應用程式的自訂遙測。</span><span class="sxs-lookup"><span data-stu-id="a2de8-124">Add custom telemetry from your app.</span></span>

<span data-ttu-id="a2de8-125">如果您對這些選項感興趣，請繼續閱讀本文。</span><span class="sxs-lookup"><span data-stu-id="a2de8-125">If those options are of interest to you, read on.</span></span>

## <a name="sample-application-instrumented-with-application-insights"></a><span data-ttu-id="a2de8-126">使用 Application Insights 檢測的範例應用程式</span><span class="sxs-lookup"><span data-stu-id="a2de8-126">Sample Application instrumented with Application Insights</span></span>
<span data-ttu-id="a2de8-127">看一看這個 [範例應用程式](https://github.com/Microsoft/ApplicationInsights-Home/tree/master/Samples/AzureEmailService) ，其中將 Application Insights 新增到雲端服務，搭配兩個背景工作角色託管於 Azure 中。</span><span class="sxs-lookup"><span data-stu-id="a2de8-127">Take a look at this [sample application](https://github.com/Microsoft/ApplicationInsights-Home/tree/master/Samples/AzureEmailService) in which Application Insights is added to a cloud service with two worker roles hosted in Azure.</span></span> 

<span data-ttu-id="a2de8-128">以下將告訴您如何透過相同的方式來調整您的雲端服務專案。</span><span class="sxs-lookup"><span data-stu-id="a2de8-128">What follows tells you how to adapt your own cloud service project in the same way.</span></span>

## <a name="plan-resources-and-resource-groups"></a><span data-ttu-id="a2de8-129">規劃資源和資源群組</span><span class="sxs-lookup"><span data-stu-id="a2de8-129">Plan resources and resource groups</span></span>
<span data-ttu-id="a2de8-130">來自您應用程式的遙測將會在 Application Insights 類型的 Azure 資源中儲存、分析及顯示。</span><span class="sxs-lookup"><span data-stu-id="a2de8-130">The telemetry from your app is stored, analyzed and displayed in an Azure resource of type Application Insights.</span></span> 

<span data-ttu-id="a2de8-131">每個資源只屬於一個資源群組。</span><span class="sxs-lookup"><span data-stu-id="a2de8-131">Each resource belongs to a resource group.</span></span> <span data-ttu-id="a2de8-132">資源群組可用來在經過協調的單一交易中，管理成本、將存取權授與小組成員，以及部署更新項目。</span><span class="sxs-lookup"><span data-stu-id="a2de8-132">Resource groups are used for managing costs, for granting access to team members, and to deploy updates in a single coordinated transaction.</span></span> <span data-ttu-id="a2de8-133">例如，您可以[撰寫指令碼來部署](../azure-resource-manager/resource-group-template-deploy.md)「Azure 雲端服務」及其 Application Insights 監視資源，全部都在一個作業中完成。</span><span class="sxs-lookup"><span data-stu-id="a2de8-133">For example, you could [write a script to deploy](../azure-resource-manager/resource-group-template-deploy.md) an Azure Cloud Service and its Application Insights monitoring resources all in one operation.</span></span>

### <a name="resources-for-components"></a><span data-ttu-id="a2de8-134">元件的資源</span><span class="sxs-lookup"><span data-stu-id="a2de8-134">Resources for components</span></span>
<span data-ttu-id="a2de8-135">建議的配置是為您應用程式的每個元件 (亦即，每個 Web 角色和背景工作角色) 建立個別的資源。</span><span class="sxs-lookup"><span data-stu-id="a2de8-135">The recommended scheme is to create a separate resource for each component of your application - that is, each web role and worker role.</span></span> <span data-ttu-id="a2de8-136">您可以個別分析每個元件，但建立一個[儀表板](app-insights-dashboards.md)來彙總所有元件的重要圖表，以便將它們一起做比較和進行監視。</span><span class="sxs-lookup"><span data-stu-id="a2de8-136">You can analyze each component separately, but can create a [dashboard](app-insights-dashboards.md) that brings together the key charts from all the components, so that you can compare and monitor them together.</span></span> 

<span data-ttu-id="a2de8-137">替代配置是將來自多個角色的遙測傳送給同一個資源，但[為每個遙測項目新增一個維度屬性](app-insights-api-filtering-sampling.md#add-properties-itelemetryinitializer)來識別其來源角色。</span><span class="sxs-lookup"><span data-stu-id="a2de8-137">An alternative scheme is to send the telemetry from more than one role to the same resource, but [add a dimension property to each telemetry item](app-insights-api-filtering-sampling.md#add-properties-itelemetryinitializer) that identifies its source role.</span></span> <span data-ttu-id="a2de8-138">在此配置中，計量圖表 (例如例外狀況) 通常會顯示來自不同角色之計數的彙總，但您可以視需要依角色識別碼分割該圖表。</span><span class="sxs-lookup"><span data-stu-id="a2de8-138">In this scheme, metric charts such as exceptions normally show an aggregation of the counts from the different roles, but you can segment the chart by the role identifier when required.</span></span> <span data-ttu-id="a2de8-139">您也可以用相同的維度來篩選搜尋。</span><span class="sxs-lookup"><span data-stu-id="a2de8-139">Searches can also be filtered by the same dimension.</span></span> <span data-ttu-id="a2de8-140">此替代方案可讓您稍微容易同時檢視每個項目，但也會造成角色之間的一些混淆。</span><span class="sxs-lookup"><span data-stu-id="a2de8-140">This alternative makes it a bit easier to view everything at the same time, but could also lead to some confusion between the roles.</span></span>

<span data-ttu-id="a2de8-141">瀏覽器遙測通常包含在與其伺服器端 Web 角色相同的資源中。</span><span class="sxs-lookup"><span data-stu-id="a2de8-141">Browser telemetry is usually included in the same resource as its server-side web role.</span></span>

<span data-ttu-id="a2de8-142">請將不同元件的 Application Insights 資源放在一個資源群組中。</span><span class="sxs-lookup"><span data-stu-id="a2de8-142">Put the Application Insights resources for the different components in one resource group.</span></span> <span data-ttu-id="a2de8-143">這可讓您容易一起管理它們。</span><span class="sxs-lookup"><span data-stu-id="a2de8-143">This makes it easy to manage them together.</span></span> 

### <a name="separating-development-test-and-production"></a><span data-ttu-id="a2de8-144">區分開發、測試及生產環境</span><span class="sxs-lookup"><span data-stu-id="a2de8-144">Separating development, test, and production</span></span>
<span data-ttu-id="a2de8-145">如果您是在上一個版本正在運作的情況下，為下一個功能開發自訂事件，您就會想要將開發遙測傳送給個別的 Application Insights 資源。</span><span class="sxs-lookup"><span data-stu-id="a2de8-145">If you are developing custom events for your next feature while the previous version is live, you want to send the development telemetry to a separate Application Insights resource.</span></span> <span data-ttu-id="a2de8-146">否則，將會很難在來自即時網站的所有流量中找出您的測試遙測。</span><span class="sxs-lookup"><span data-stu-id="a2de8-146">Otherwise it will be hard to find your test telemetry among all the traffic from the live site.</span></span>

<span data-ttu-id="a2de8-147">為了避免這種情況，請為您系統的每個組建組態或「戳記」(開發、測試、生產環境等) 建立個別的資源。</span><span class="sxs-lookup"><span data-stu-id="a2de8-147">To avoid this situation, create separate resources for each build configuration or 'stamp' (development, test, production, ...) of your system.</span></span> <span data-ttu-id="a2de8-148">請將每個組建組態的資源放在個別的資源群組中。</span><span class="sxs-lookup"><span data-stu-id="a2de8-148">Put the resources for each build configuration in a separate resource group.</span></span> 

<span data-ttu-id="a2de8-149">若要將遙測傳送給適當的資源，您可以安裝 Application Insights SDK，讓它根據組建組態挑選不同的檢測金鑰。</span><span class="sxs-lookup"><span data-stu-id="a2de8-149">To send the telemetry to the appropriate resources, you can set up the Application Insights SDK so that it picks up a different instrumentation key depending on the build configuration.</span></span> 

## <a name="create-an-application-insights-resource-for-each-role"></a><span data-ttu-id="a2de8-150">為每個角色建立 Application Insights 資源</span><span class="sxs-lookup"><span data-stu-id="a2de8-150">Create an Application Insights resource for each role</span></span>
<span data-ttu-id="a2de8-151">如果您已決定為每個角色建立個別的資源，或許也為每個組建組態建立一組個別的資源，則最簡單的方式就是全部都在 Application Insights 入口網站中建立。</span><span class="sxs-lookup"><span data-stu-id="a2de8-151">If you've decided to create a separate resource for each role - and perhaps a separate set for each build configuration - then it's easiest to create them all in the Application Insights portal.</span></span> <span data-ttu-id="a2de8-152">(如果您要建立很多資源，您可以[將程序自動化](app-insights-powershell.md))。</span><span class="sxs-lookup"><span data-stu-id="a2de8-152">(If you create resources a lot, you can [automate the process](app-insights-powershell.md).</span></span>

1. <span data-ttu-id="a2de8-153">在 [Azure 入口網站][portal]中，建立新的 Application Insights 資源。</span><span class="sxs-lookup"><span data-stu-id="a2de8-153">In the [Azure portal][portal], create a new Application Insights resource.</span></span> <span data-ttu-id="a2de8-154">針對應用程式類型，選擇 ASP.NET 應用程式。</span><span class="sxs-lookup"><span data-stu-id="a2de8-154">For application type, choose ASP.NET app.</span></span> 

    ![按一下 [新增]，然後按一下 [Application Insights]](./media/app-insights-cloudservices/01-new.png)
2. <span data-ttu-id="a2de8-156">請注意，每個資源都是以「檢測金鑰」作為識別。</span><span class="sxs-lookup"><span data-stu-id="a2de8-156">Note that each resource is identified by an Instrumentation Key.</span></span> <span data-ttu-id="a2de8-157">如果您想要手動設定或確認 SDK 的組態，稍後可能會需要此金鑰。</span><span class="sxs-lookup"><span data-stu-id="a2de8-157">You might need this later if you want to manually configure or verify the configuration of the SDK.</span></span>

    ![按一下 [屬性]，選取金鑰，然後按下 CTRL+C](./media/app-insights-cloudservices/02-props.png) 

## <a name="set-up-azure-diagnostics-for-each-role"></a><span data-ttu-id="a2de8-159">設定每個角色的 Azure 診斷</span><span class="sxs-lookup"><span data-stu-id="a2de8-159">Set up Azure Diagnostics for each role</span></span>
<span data-ttu-id="a2de8-160">設定此選項即可使用 Application Insights 來監視您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="a2de8-160">Set this option to monitor your app with Application Insights.</span></span> <span data-ttu-id="a2de8-161">針對 Web 角色，這除了提供使用情況分析之外，也提供效能監視、警示及診斷。</span><span class="sxs-lookup"><span data-stu-id="a2de8-161">For web roles, this provides performance monitoring, alerts, and diagnostics, as well as usage analysis.</span></span> <span data-ttu-id="a2de8-162">針對他角色，您可以搜尋和監視 Azure 診斷，例如重新啟動、效能計數器及對 System.Diagnostics.Trace 的呼叫。</span><span class="sxs-lookup"><span data-stu-id="a2de8-162">For other roles, you can search and monitor Azure diagnostics such as restart, performance counters, and calls to System.Diagnostics.Trace.</span></span> 

1. <span data-ttu-id="a2de8-163">在 Visual Studio [方案總管] 中的 [YourCloudService]&lt;&gt; 角色底下，開啟每個角色的屬性。</span><span class="sxs-lookup"><span data-stu-id="a2de8-163">In Visual Studio Solution Explorer, under &lt;YourCloudService&gt;, Roles, open the properties of each role.</span></span>
2. <span data-ttu-id="a2de8-164">在 [組態] 中設定 [傳送診斷資料至 Application Insights]，然後選取您先前建立的適當 Application Insights 資源。</span><span class="sxs-lookup"><span data-stu-id="a2de8-164">In **Configuration**, set **Send diagnostics data to Application Insights** and select the appropriate Application Insights resource that you created earlier.</span></span>

<span data-ttu-id="a2de8-165">如果您已決定針對每個組建組態使用個別的 Application Insights 資源，請先選取組態。</span><span class="sxs-lookup"><span data-stu-id="a2de8-165">If you have decided to use a separate Application Insights resource for each build configuration, select the configuration first.</span></span>

![在每個 Azure 角色的屬性中，設定 Application Insights](./media/app-insights-cloudservices/configure-azure-diagnostics.png)

<span data-ttu-id="a2de8-167">這會將您的 Application insights 檢測金鑰插入名為 `ServiceConfiguration.*.cscfg` 的檔案中。</span><span class="sxs-lookup"><span data-stu-id="a2de8-167">This has the effect of inserting your Application Insights instrumentation keys into the files named `ServiceConfiguration.*.cscfg`.</span></span> <span data-ttu-id="a2de8-168">([範例程式碼](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/AzureEmailService/ServiceConfiguration.Cloud.cscfg))。</span><span class="sxs-lookup"><span data-stu-id="a2de8-168">([Sample code](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/AzureEmailService/ServiceConfiguration.Cloud.cscfg)).</span></span>

<span data-ttu-id="a2de8-169">如果您想要變更傳送到 Application Insights 的診斷資訊層級，只要[直接編輯 `.cscfg` 檔案即可](app-insights-azure-diagnostics.md)。</span><span class="sxs-lookup"><span data-stu-id="a2de8-169">If you want to vary the level of diagnostic information sent to Application Insights, you can do so [by editing the `.cscfg` files directly](app-insights-azure-diagnostics.md).</span></span>

## <span data-ttu-id="a2de8-170"><a name="sdk"></a>在每個專案中安裝 SDK</span><span class="sxs-lookup"><span data-stu-id="a2de8-170"><a name="sdk"></a>Install the SDK in each project</span></span>
<span data-ttu-id="a2de8-171">此選項會新增將自訂業務遙測新增到任何角色的功能，可用來進一步分析您應用程式的使用和執行情況。</span><span class="sxs-lookup"><span data-stu-id="a2de8-171">This option adds the ability to add custom business telemetry to any role, for a closer analysis of how your application is used and performs.</span></span>

<span data-ttu-id="a2de8-172">在 Visual Studio 中，設定每個雲端應用程式專案的 Application Insights SDK。</span><span class="sxs-lookup"><span data-stu-id="a2de8-172">In Visual Studio, configure the Application Insights SDK for each cloud app project.</span></span>

1. <span data-ttu-id="a2de8-173">**Web 角色**：以滑鼠右鍵按一下專案，然後選擇 [設定 Application Insights] 或 [新增 > Application Insights 遙測]。</span><span class="sxs-lookup"><span data-stu-id="a2de8-173">**Web roles**: Right-click the project and choose **Configure Application Insights** or **Add > Application Insights telemetry**.</span></span>

2. <span data-ttu-id="a2de8-174">**背景工作角色**：</span><span class="sxs-lookup"><span data-stu-id="a2de8-174">**Worker roles**:</span></span> 
 * <span data-ttu-id="a2de8-175">以滑鼠右鍵按一下專案，然後選取 [管理 NuGet 套件]。</span><span class="sxs-lookup"><span data-stu-id="a2de8-175">Right-click the project and select **Manage Nuget Packages**.</span></span>
 * <span data-ttu-id="a2de8-176">新增[適用於 Windows 伺服器的 Application Insights](https://www.nuget.org/packages/Microsoft.ApplicationInsights.WindowsServer/)。</span><span class="sxs-lookup"><span data-stu-id="a2de8-176">Add [Application Insights for Windows Servers](https://www.nuget.org/packages/Microsoft.ApplicationInsights.WindowsServer/).</span></span>

    ![搜尋「Application Insights」](./media/app-insights-cloudservices/04-ai-nuget.png)

3. <span data-ttu-id="a2de8-178">設定 SDK 以將資料傳送給 Application Insights 資源。</span><span class="sxs-lookup"><span data-stu-id="a2de8-178">Configure the SDK to send data to the Application Insights resource.</span></span>

    <span data-ttu-id="a2de8-179">在適合的啟動函式中，從 .cscfg 檔案中的組態設定設定檢測金鑰：</span><span class="sxs-lookup"><span data-stu-id="a2de8-179">In a suitable startup function, set the instrumentation key from the configuration setting in the .cscfg file:</span></span>
 
    ```C#
   
     TelemetryConfiguration.Active.InstrumentationKey = RoleEnvironment.GetConfigurationSettingValue("APPINSIGHTS_INSTRUMENTATIONKEY");
    ```
   
    <span data-ttu-id="a2de8-180">對於應用程式中的每個角色執行這項操作。</span><span class="sxs-lookup"><span data-stu-id="a2de8-180">Do this for each role in your application.</span></span> <span data-ttu-id="a2de8-181">請參閱範例：</span><span class="sxs-lookup"><span data-stu-id="a2de8-181">See the examples:</span></span>
   
   * [<span data-ttu-id="a2de8-182">Web 角色</span><span class="sxs-lookup"><span data-stu-id="a2de8-182">Web role</span></span>](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/MvcWebRole/Global.asax.cs#L27)
   * [<span data-ttu-id="a2de8-183">背景工作角色</span><span class="sxs-lookup"><span data-stu-id="a2de8-183">Worker role</span></span>](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/WorkerRoleA/WorkerRoleA.cs#L232)
   * [<span data-ttu-id="a2de8-184">針對網頁</span><span class="sxs-lookup"><span data-stu-id="a2de8-184">For web pages</span></span>](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/MvcWebRole/Views/Shared/_Layout.cshtml#L13) 
4. <span data-ttu-id="a2de8-185">將 ApplicationInsights.config 設定為一律複製到輸出目錄。</span><span class="sxs-lookup"><span data-stu-id="a2de8-185">Set the ApplicationInsights.config file to be copied always to the output directory.</span></span> 
   
    <span data-ttu-id="a2de8-186">(在 .config 檔案中，您會看到訊息詢問您將檢測金鑰放至該處。</span><span class="sxs-lookup"><span data-stu-id="a2de8-186">(In the .config file, you'll see messages asking you to place the instrumentation key there.</span></span> <span data-ttu-id="a2de8-187">不過，針對雲端應用程式，最好是從 .cscfg 檔案中設定。</span><span class="sxs-lookup"><span data-stu-id="a2de8-187">However, for cloud applications it's better to set it from the .cscfg file.</span></span> <span data-ttu-id="a2de8-188">這可確保角色會在入口網站中正確識別。)</span><span class="sxs-lookup"><span data-stu-id="a2de8-188">This ensures that the role is correctly identified in the portal.)</span></span>

#### <a name="run-and-publish-the-app"></a><span data-ttu-id="a2de8-189">執行和發佈應用程式</span><span class="sxs-lookup"><span data-stu-id="a2de8-189">Run and publish the app</span></span>
<span data-ttu-id="a2de8-190">執行應用程式，並且登入 Azure。</span><span class="sxs-lookup"><span data-stu-id="a2de8-190">Run your app, and sign into Azure.</span></span> <span data-ttu-id="a2de8-191">開啟您建立的 Application Insights 資源，您會看到個別資料點顯示在[搜尋](app-insights-diagnostic-search.md)中，並且在[計量瀏覽器](app-insights-metrics-explorer.md)中彙總資料。</span><span class="sxs-lookup"><span data-stu-id="a2de8-191">Open the Application Insights resources you created, and you'll see individual data points appearing in [Search](app-insights-diagnostic-search.md), and aggregated data in [Metric Explorer](app-insights-metrics-explorer.md).</span></span> 

<span data-ttu-id="a2de8-192">新增更多遙測 - 請參閱以下章節 - 然後再發佈應用程式以取得即時診斷和使用方式的意見反應。</span><span class="sxs-lookup"><span data-stu-id="a2de8-192">Add more telemetry - see the sections below - and then publish your app to get live diagnostic and usage feedback.</span></span> 

#### <a name="no-data"></a><span data-ttu-id="a2de8-193">沒有資料？</span><span class="sxs-lookup"><span data-stu-id="a2de8-193">No data?</span></span>
* <span data-ttu-id="a2de8-194">開啟 [[搜尋][diagnostic]] 磚來查看個別事件。</span><span class="sxs-lookup"><span data-stu-id="a2de8-194">Open the [Search][diagnostic] tile, to see individual events.</span></span>
* <span data-ttu-id="a2de8-195">使用應用程式、開啟不同頁面，以產生一些遙測。</span><span class="sxs-lookup"><span data-stu-id="a2de8-195">Use the application, opening different pages so that it generates some telemetry.</span></span>
* <span data-ttu-id="a2de8-196">請稍等片刻，然後按一下 [重新整理]。</span><span class="sxs-lookup"><span data-stu-id="a2de8-196">Wait a few seconds and click Refresh.</span></span>
* <span data-ttu-id="a2de8-197">請參閱[疑難排解][qna]。</span><span class="sxs-lookup"><span data-stu-id="a2de8-197">See [Troubleshooting][qna].</span></span>

## <a name="view-azure-diagnostic-events"></a><span data-ttu-id="a2de8-198">檢視 Azure 診斷事件</span><span class="sxs-lookup"><span data-stu-id="a2de8-198">View Azure Diagnostic events</span></span>
<span data-ttu-id="a2de8-199">[Azure 診斷](https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/azure-diagnostics)資訊在 Application Insights 中的位置如下：</span><span class="sxs-lookup"><span data-stu-id="a2de8-199">Where to find the [Azure Diagnostics](https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/azure-diagnostics) information in Application Insights:</span></span>

* <span data-ttu-id="a2de8-200">效能計數器顯示為自訂度量。</span><span class="sxs-lookup"><span data-stu-id="a2de8-200">Performance counters are displayed as custom metrics.</span></span> 
* <span data-ttu-id="a2de8-201">Windows 事件記錄檔顯示為追蹤和自訂事件。</span><span class="sxs-lookup"><span data-stu-id="a2de8-201">Windows event logs are shown as traces and custom events.</span></span>
* <span data-ttu-id="a2de8-202">應用程式記錄檔、ETW 記錄檔和任何診斷基礎結構記錄檔顯示為追蹤。</span><span class="sxs-lookup"><span data-stu-id="a2de8-202">Application logs, ETW logs, and any diagnostics infrastructure logs appear as traces.</span></span>

<span data-ttu-id="a2de8-203">若要查看效能計數器和事件計數，開啟 [計量瀏覽器](app-insights-metrics-explorer.md) 並加入新的圖表：</span><span class="sxs-lookup"><span data-stu-id="a2de8-203">To see performance counters and counts of events, open [Metrics Explorer](app-insights-metrics-explorer.md) and add a new chart:</span></span>

![Azure 診斷資料](./media/app-insights-cloudservices/23-wad.png)

<span data-ttu-id="a2de8-205">使用[搜尋](app-insights-diagnostic-search.md)或[分析查詢](app-insights-analytics-tour.md)，在各種 Azure 診斷傳送的追蹤記錄檔中搜尋。</span><span class="sxs-lookup"><span data-stu-id="a2de8-205">Use [Search](app-insights-diagnostic-search.md) or an [Analytics query](app-insights-analytics-tour.md) to search across the various trace logs sent by Azure Diagnostics.</span></span> <span data-ttu-id="a2de8-206">例如，假設您有未處理的例外狀況導致角色損毀並需要回收。</span><span class="sxs-lookup"><span data-stu-id="a2de8-206">For example, suppose you have an unhandled exception which caused a Role to crash and recycle.</span></span> <span data-ttu-id="a2de8-207">這項資訊會出現在 Windows 事件記錄檔的「應用程式 (Application)」通道。</span><span class="sxs-lookup"><span data-stu-id="a2de8-207">That information would show up in the Application channel of Windows Event Log.</span></span> <span data-ttu-id="a2de8-208">您可以使用 [搜尋 (Search)] 來查看 Windows 事件記錄檔錯誤，並取得例外狀況的完整堆疊追蹤。</span><span class="sxs-lookup"><span data-stu-id="a2de8-208">You can use Search to look at the Windows Event Log error and get the full stack trace for the exception.</span></span> <span data-ttu-id="a2de8-209">這將協助您找出問題的根本原因。</span><span class="sxs-lookup"><span data-stu-id="a2de8-209">That will help you find the root cause of the issue.</span></span>

![Azure 診斷搜尋](./media/app-insights-cloudservices/25-wad.png)

## <a name="more-telemetry"></a><span data-ttu-id="a2de8-211">更多遙測</span><span class="sxs-lookup"><span data-stu-id="a2de8-211">More telemetry</span></span>
<span data-ttu-id="a2de8-212">以下各節說明如何從您的應用程式的不同層面取得其他的遙測。</span><span class="sxs-lookup"><span data-stu-id="a2de8-212">The sections below show how to get additional telemetry from different aspects of your application.</span></span>

## <a name="track-requests-from-worker-roles"></a><span data-ttu-id="a2de8-213">從背景工作角色追蹤要求</span><span class="sxs-lookup"><span data-stu-id="a2de8-213">Track Requests from Worker roles</span></span>
<span data-ttu-id="a2de8-214">在 Web 角色中，要求模組會自動收集有關 HTTP 要求的資料。</span><span class="sxs-lookup"><span data-stu-id="a2de8-214">In web roles, the requests module automatically collects data about HTTP requests.</span></span> <span data-ttu-id="a2de8-215">如需有關如何覆寫預設收集行為的範例，請參閱 [範例 MVCWebRole](https://github.com/Microsoft/ApplicationInsights-Home/tree/master/Samples/AzureEmailService/MvcWebRole) 。</span><span class="sxs-lookup"><span data-stu-id="a2de8-215">See the [sample MVCWebRole](https://github.com/Microsoft/ApplicationInsights-Home/tree/master/Samples/AzureEmailService/MvcWebRole) for examples of how you can override the default collection behavior.</span></span> 

<span data-ttu-id="a2de8-216">您可以藉由與追蹤 HTTP 要求相同的方式追蹤背景工作角色，來擷取背景工作角色呼叫的效能。</span><span class="sxs-lookup"><span data-stu-id="a2de8-216">You can capture the performance of calls to worker roles by tracking them in the same way as HTTP requests.</span></span> <span data-ttu-id="a2de8-217">在 Application Insights 中，要求遙測類型會測量一個單位的具名伺服器端工作，可以進行計時，而且可以獨立成功或失敗。</span><span class="sxs-lookup"><span data-stu-id="a2de8-217">In Application Insights, the Request telemetry type measures a unit of named server-side work that can be timed and can independently succeed or fail.</span></span> <span data-ttu-id="a2de8-218">由 SDK 會自動擷取 HTTP 要求時，您可以插入自己的程式碼，來追蹤對背景工作角色的要求。</span><span class="sxs-lookup"><span data-stu-id="a2de8-218">While HTTP requests are captured automatically by the SDK, you can insert your own code to track requests to worker roles.</span></span>

<span data-ttu-id="a2de8-219">請參閱檢測兩個範例背景工作角色以報告要求：[WorkerRoleA](https://github.com/Microsoft/ApplicationInsights-Home/tree/master/Samples/AzureEmailService/WorkerRoleA) 和 [WorkerRoleB](https://github.com/Microsoft/ApplicationInsights-Home/tree/master/Samples/AzureEmailService/WorkerRoleB)</span><span class="sxs-lookup"><span data-stu-id="a2de8-219">See the two sample worker roles instrumented to report requests: [WorkerRoleA](https://github.com/Microsoft/ApplicationInsights-Home/tree/master/Samples/AzureEmailService/WorkerRoleA) and [WorkerRoleB](https://github.com/Microsoft/ApplicationInsights-Home/tree/master/Samples/AzureEmailService/WorkerRoleB)</span></span>

## <a name="exceptions"></a><span data-ttu-id="a2de8-220">例外狀況</span><span class="sxs-lookup"><span data-stu-id="a2de8-220">Exceptions</span></span>
<span data-ttu-id="a2de8-221">如需如何從不同的 Web 應用程式類型收集未處理的例外狀況的資訊，請參閱 [在 Application Insights 中監視例外狀況](app-insights-asp-net-exceptions.md) 。</span><span class="sxs-lookup"><span data-stu-id="a2de8-221">See [Monitoring Exceptions in Application Insights](app-insights-asp-net-exceptions.md) for information on how you can collect unhandled exceptions from different web application types.</span></span>

<span data-ttu-id="a2de8-222">範例 Web 角色具有 MVC5 以及 Web API 2 控制器。</span><span class="sxs-lookup"><span data-stu-id="a2de8-222">The sample web role has MVC5 and Web API 2 controllers.</span></span> <span data-ttu-id="a2de8-223">來自這兩者的未處理例外狀況是使用下列處理常式擷取：</span><span class="sxs-lookup"><span data-stu-id="a2de8-223">The unhandled exceptions from the two are captured with the following handlers:</span></span>

* <span data-ttu-id="a2de8-224">針對 MVC5 控制器，[這裡](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/MvcWebRole/App_Start/FilterConfig.cs#L12)設定的 [AiHandleErrorAttribute](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/MvcWebRole/Telemetry/AiHandleErrorAttribute.cs)</span><span class="sxs-lookup"><span data-stu-id="a2de8-224">[AiHandleErrorAttribute](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/MvcWebRole/Telemetry/AiHandleErrorAttribute.cs) set up [here](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/MvcWebRole/App_Start/FilterConfig.cs#L12) for MVC5 controllers</span></span>
* <span data-ttu-id="a2de8-225">針對 Web API 2 控制器，[這裡](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/MvcWebRole/App_Start/WebApiConfig.cs#L25)設定的 [AiWebApiExceptionLogger](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/MvcWebRole/Telemetry/AiWebApiExceptionLogger.cs)</span><span class="sxs-lookup"><span data-stu-id="a2de8-225">[AiWebApiExceptionLogger](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/MvcWebRole/Telemetry/AiWebApiExceptionLogger.cs) set up [here](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/MvcWebRole/App_Start/WebApiConfig.cs#L25) for Web API 2 controllers</span></span>

<span data-ttu-id="a2de8-226">針對背景工作角色，有兩種方式來追蹤例外狀況：</span><span class="sxs-lookup"><span data-stu-id="a2de8-226">For worker roles, there are two ways to track exceptions:</span></span>

* <span data-ttu-id="a2de8-227">TrackException(ex)</span><span class="sxs-lookup"><span data-stu-id="a2de8-227">TrackException(ex)</span></span>
* <span data-ttu-id="a2de8-228">如果您已新增 Application Insights 追蹤接聽項 NuGet 套件，您可以使用 **System.Diagnostics.Trace** 來記錄例外狀況。</span><span class="sxs-lookup"><span data-stu-id="a2de8-228">If you have added the Application Insights trace listener NuGet package, you can use **System.Diagnostics.Trace** to log exceptions.</span></span> [<span data-ttu-id="a2de8-229">程式碼範例。</span><span class="sxs-lookup"><span data-stu-id="a2de8-229">Code example.</span></span>](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/WorkerRoleA/WorkerRoleA.cs#L107)

## <a name="performance-counters"></a><span data-ttu-id="a2de8-230">效能計數器</span><span class="sxs-lookup"><span data-stu-id="a2de8-230">Performance Counters</span></span>
<span data-ttu-id="a2de8-231">根據預設會收集下列計數器：</span><span class="sxs-lookup"><span data-stu-id="a2de8-231">The following counters are collected by default:</span></span>

    * <span data-ttu-id="a2de8-232">\Process(??APP_WIN32_PROC??)\%Processor Time</span><span class="sxs-lookup"><span data-stu-id="a2de8-232">\Process(??APP_WIN32_PROC??)\% Processor Time</span></span>
    * <span data-ttu-id="a2de8-233">\Memory\Available Bytes</span><span class="sxs-lookup"><span data-stu-id="a2de8-233">\Memory\Available Bytes</span></span>
    * <span data-ttu-id="a2de8-234">\.NET CLR Exceptions(??APP_CLR_PROC??)\# of Exceps Thrown / sec</span><span class="sxs-lookup"><span data-stu-id="a2de8-234">\.NET CLR Exceptions(??APP_CLR_PROC??)\# of Exceps Thrown / sec</span></span>
    * <span data-ttu-id="a2de8-235">\Process(??APP_WIN32_PROC??)\Private Bytes</span><span class="sxs-lookup"><span data-stu-id="a2de8-235">\Process(??APP_WIN32_PROC??)\Private Bytes</span></span>
    * <span data-ttu-id="a2de8-236">\Process(??APP_WIN32_PROC??)\IO Data Bytes/sec</span><span class="sxs-lookup"><span data-stu-id="a2de8-236">\Process(??APP_WIN32_PROC??)\IO Data Bytes/sec</span></span>
    * <span data-ttu-id="a2de8-237">\Processor(_Total)\% Processor Time</span><span class="sxs-lookup"><span data-stu-id="a2de8-237">\Processor(_Total)\% Processor Time</span></span>

<span data-ttu-id="a2de8-238">若是 Web 角色，也會收集這些計數器︰</span><span class="sxs-lookup"><span data-stu-id="a2de8-238">For web roles, these counters are also collected:</span></span>

    * <span data-ttu-id="a2de8-239">\ASP.NET Applications(??APP_W3SVC_PROC??)\Requests/Sec</span><span class="sxs-lookup"><span data-stu-id="a2de8-239">\ASP.NET Applications(??APP_W3SVC_PROC??)\Requests/Sec</span></span>
    * <span data-ttu-id="a2de8-240">\ASP.NET Applications(??APP_W3SVC_PROC??)\Request Execution Time</span><span class="sxs-lookup"><span data-stu-id="a2de8-240">\ASP.NET Applications(??APP_W3SVC_PROC??)\Request Execution Time</span></span>
    * <span data-ttu-id="a2de8-241">\ASP.NET Applications(??APP_W3SVC_PROC??)\Requests In Application Queue</span><span class="sxs-lookup"><span data-stu-id="a2de8-241">\ASP.NET Applications(??APP_W3SVC_PROC??)\Requests In Application Queue</span></span>

<span data-ttu-id="a2de8-242">您可以藉由編輯 ApplicationInsights.config 來指定額外的自訂或其他 Windows 效能計數器，[如此範例所示](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/WorkerRoleA/ApplicationInsights.config#L14)。</span><span class="sxs-lookup"><span data-stu-id="a2de8-242">You can specify additional custom or other windows performance counters by editing ApplicationInsights.config [as in this example](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/WorkerRoleA/ApplicationInsights.config#L14).</span></span>

  ![效能計數器](./media/app-insights-cloudservices/OLfMo2f.png)

## <a name="correlated-telemetry-for-worker-roles"></a><span data-ttu-id="a2de8-244">背景工作角色的相互關聯遙測</span><span class="sxs-lookup"><span data-stu-id="a2de8-244">Correlated Telemetry for Worker Roles</span></span>
<span data-ttu-id="a2de8-245">當您可以看見導致失敗或高延遲要求的原因時，診斷體驗會更加豐富。</span><span class="sxs-lookup"><span data-stu-id="a2de8-245">It is a rich diagnostic experience, when you can see what led to a failed or high latency request.</span></span> <span data-ttu-id="a2de8-246">使用 Web 角色，SDK 會在關聯的遙測間自動設定相互關聯。</span><span class="sxs-lookup"><span data-stu-id="a2de8-246">With web roles, the SDK automatically sets up correlation between related telemetry.</span></span> <span data-ttu-id="a2de8-247">針對背景工作角色，您可以使用自訂遙測初始設定式，來設定一個通用 Operation.Id 內容屬性，讓所有的遙測可以達到此目的。</span><span class="sxs-lookup"><span data-stu-id="a2de8-247">For worker roles, you can use a custom telemetry initializer to set a common Operation.Id context attribute for all the telemetry to achieve this.</span></span> <span data-ttu-id="a2de8-248">這可讓您查看是否因為相依性或程式碼導致延遲/失敗問題，一目了然！</span><span class="sxs-lookup"><span data-stu-id="a2de8-248">This allows you to see whether the latency/failure issue was caused due to a dependency or your code, at a glance!</span></span> 

<span data-ttu-id="a2de8-249">方式如下：</span><span class="sxs-lookup"><span data-stu-id="a2de8-249">Here's how:</span></span>

* <span data-ttu-id="a2de8-250">設定相互關聯識別碼到 CallContext 中，如 [這裡](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/WorkerRoleA/WorkerRoleA.cs#L36)所示。</span><span class="sxs-lookup"><span data-stu-id="a2de8-250">Set the correlation Id into a CallContext as shown [here](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/WorkerRoleA/WorkerRoleA.cs#L36).</span></span> <span data-ttu-id="a2de8-251">在此案例中，我們使用「要求 ID」做為相互關聯識別碼</span><span class="sxs-lookup"><span data-stu-id="a2de8-251">In this case, we are using the Request ID as the correlation id</span></span>
* <span data-ttu-id="a2de8-252">新增自訂的 TelemetryInitializer 實作，其會將 Operation.Id 設為前面所設定的 correlationId。</span><span class="sxs-lookup"><span data-stu-id="a2de8-252">Add a custom TelemetryInitializer implementation, to set the Operation.Id to the correlationId set above.</span></span> <span data-ttu-id="a2de8-253">範例如下：[ItemCorrelationTelemetryInitializer](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/WorkerRoleA/Telemetry/ItemCorrelationTelemetryInitializer.cs#L13)</span><span class="sxs-lookup"><span data-stu-id="a2de8-253">There's an example here: [ItemCorrelationTelemetryInitializer](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/WorkerRoleA/Telemetry/ItemCorrelationTelemetryInitializer.cs#L13)</span></span>
* <span data-ttu-id="a2de8-254">新增自訂的遙測初始設定式。</span><span class="sxs-lookup"><span data-stu-id="a2de8-254">Add the custom telemetry initializer.</span></span> <span data-ttu-id="a2de8-255">您可以在 ApplicationInsights.config 檔案，或在程式碼中執行，如 [這裡](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/WorkerRoleA/WorkerRoleA.cs#L233)</span><span class="sxs-lookup"><span data-stu-id="a2de8-255">You could do that in the ApplicationInsights.config file, or in code as shown [here](https://github.com/Microsoft/ApplicationInsights-Home/blob/master/Samples/AzureEmailService/WorkerRoleA/WorkerRoleA.cs#L233)</span></span>

<span data-ttu-id="a2de8-256">就這麼簡單！</span><span class="sxs-lookup"><span data-stu-id="a2de8-256">That's it!</span></span> <span data-ttu-id="a2de8-257">入口網站體驗已經準備好協助您一覽所有相關聯的遙測：</span><span class="sxs-lookup"><span data-stu-id="a2de8-257">The portal experience is already wired up to help you see all associated telemetry at a glance:</span></span>

![相互關聯的遙測](./media/app-insights-cloudservices/bHxuUhd.png)

## <a name="client-telemetry"></a><span data-ttu-id="a2de8-259">用戶端遙測</span><span class="sxs-lookup"><span data-stu-id="a2de8-259">Client telemetry</span></span>
<span data-ttu-id="a2de8-260">[將 JavaScript SDK 新增至網頁][client]以取得瀏覽器型遙測 (例如頁面檢視計數、頁面載入時間、指令碼例外狀況)，並讓您在頁面指令碼中撰寫自訂遙測。</span><span class="sxs-lookup"><span data-stu-id="a2de8-260">[Add the JavaScript SDK to your web pages][client] to get browser-based telemetry such as page view counts, page load times, script exceptions, and to let you write custom telemetry in your page scripts.</span></span>

## <a name="availability-tests"></a><span data-ttu-id="a2de8-261">可用性集合</span><span class="sxs-lookup"><span data-stu-id="a2de8-261">Availability tests</span></span>
<span data-ttu-id="a2de8-262">[設定 Web 測試][availability]，以確認應用程式處於線上狀態且能夠回應。</span><span class="sxs-lookup"><span data-stu-id="a2de8-262">[Set up web tests][availability] to make sure your application stays live and responsive.</span></span>

## <a name="display-everything-together"></a><span data-ttu-id="a2de8-263">將所有內容一起顯示</span><span class="sxs-lookup"><span data-stu-id="a2de8-263">Display everything together</span></span>
<span data-ttu-id="a2de8-264">若要了解您系統的整體情況，您可以將重要的監視圖表全部都彙總在一個[儀表板](app-insights-dashboards.md)上。</span><span class="sxs-lookup"><span data-stu-id="a2de8-264">To get an overall picture of your system, you can bring the key monitoring charts together on one [dashboard](app-insights-dashboards.md).</span></span> <span data-ttu-id="a2de8-265">例如，您可以釘選每個角色的要求和失敗計數。</span><span class="sxs-lookup"><span data-stu-id="a2de8-265">For example, you could pin the request and failure counts of each role.</span></span> 

<span data-ttu-id="a2de8-266">如果您的系統使用其他 Azure 服務 (例如「串流分析」)，請將它們的監視圖表一併納入。</span><span class="sxs-lookup"><span data-stu-id="a2de8-266">If your system uses other Azure services such as Stream Analytics, include their monitoring charts as well.</span></span> 

<span data-ttu-id="a2de8-267">如果您有用戶端行動應用程式，請插入一些會在進行主要使用者操作時傳送自訂事件的程式碼，並建立 [HockeyApp bridge](app-insights-hockeyapp-bridge-app.md)。</span><span class="sxs-lookup"><span data-stu-id="a2de8-267">If you have a client mobile app, insert some code to send custom events on key user operations, and create a [HockeyApp bridge](app-insights-hockeyapp-bridge-app.md).</span></span> <span data-ttu-id="a2de8-268">請在[分析](app-insights-analytics.md)中建立查詢以顯示事件計數，並將它們釘選到儀表板。</span><span class="sxs-lookup"><span data-stu-id="a2de8-268">Create queries in [Analytics](app-insights-analytics.md) to display the event counts, and pin them to the dashboard.</span></span>

## <a name="example"></a><span data-ttu-id="a2de8-269">範例</span><span class="sxs-lookup"><span data-stu-id="a2de8-269">Example</span></span>
<span data-ttu-id="a2de8-270">[此範例](https://github.com/Microsoft/ApplicationInsights-Home/tree/master/Samples/AzureEmailService) 監視具有 Web 角色和兩個背景工作角色的服務。</span><span class="sxs-lookup"><span data-stu-id="a2de8-270">[The example](https://github.com/Microsoft/ApplicationInsights-Home/tree/master/Samples/AzureEmailService) monitors a service that has a web role and two worker roles.</span></span>

## <a name="exception-method-not-found-on-running-in-azure-cloud-services"></a><span data-ttu-id="a2de8-271">在 Azure 雲端服務中執行時發生的「找不到方法」例外狀況</span><span class="sxs-lookup"><span data-stu-id="a2de8-271">Exception "method not found" on running in Azure Cloud Services</span></span>
<span data-ttu-id="a2de8-272">您是否已針對 .NET 4.6 組建？</span><span class="sxs-lookup"><span data-stu-id="a2de8-272">Did you build for .NET 4.6?</span></span> <span data-ttu-id="a2de8-273">Azure 雲端服務角色不自動支援 4.6。</span><span class="sxs-lookup"><span data-stu-id="a2de8-273">4.6 is not automatically supported in Azure Cloud Services roles.</span></span> <span data-ttu-id="a2de8-274">[在每個角色上安裝 4.6](../cloud-services/cloud-services-dotnet-install-dotnet.md) ，再執行您的 App。</span><span class="sxs-lookup"><span data-stu-id="a2de8-274">[Install 4.6 on each role](../cloud-services/cloud-services-dotnet-install-dotnet.md) before running your app.</span></span>

## <a name="video"></a><span data-ttu-id="a2de8-275">影片</span><span class="sxs-lookup"><span data-stu-id="a2de8-275">Video</span></span>

> [!VIDEO https://channel9.msdn.com/events/Connect/2016/100/player]

## <a name="next-steps"></a><span data-ttu-id="a2de8-276">後續步驟</span><span class="sxs-lookup"><span data-stu-id="a2de8-276">Next steps</span></span>
* [<span data-ttu-id="a2de8-277">設定將 Azure 診斷傳送至 Application Insights</span><span class="sxs-lookup"><span data-stu-id="a2de8-277">Configure sending Azure Diagnostics to Application Insights</span></span>](app-insights-azure-diagnostics.md)
* [<span data-ttu-id="a2de8-278">自動建立 Application Insights 資源</span><span class="sxs-lookup"><span data-stu-id="a2de8-278">Automate creation of Application Insights resources</span></span>](app-insights-powershell.md)
* [<span data-ttu-id="a2de8-279">自動執行 Azure 診斷</span><span class="sxs-lookup"><span data-stu-id="a2de8-279">Automate Azure diagnostics</span></span>](app-insights-powershell-azure-diagnostics.md)
* [<span data-ttu-id="a2de8-280">Azure Functions</span><span class="sxs-lookup"><span data-stu-id="a2de8-280">Azure Functions</span></span>](https://github.com/christopheranderson/azure-functions-app-insights-sample)

[api]: app-insights-api-custom-events-metrics.md
[availability]: app-insights-monitor-web-app-availability.md
[azure]: app-insights-azure.md
[client]: app-insights-javascript.md
[diagnostic]: app-insights-diagnostic-search.md
[netlogs]: app-insights-asp-net-trace-logs.md
[portal]: http://portal.azure.com/
[qna]: app-insights-troubleshoot-faq.md
[redfield]: app-insights-monitor-performance-live-website-now.md
[start]: app-insights-overview.md 
