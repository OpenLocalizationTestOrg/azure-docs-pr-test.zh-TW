---
title: "Application Insights 遙測相互關聯 | Microsoft Docs"
description: "Application Insights 遙測相互關聯"
services: application-insights
documentationcenter: .net
author: SergeyKanzhelev
manager: carmonm
ms.service: application-insights
ms.workload: TBD
ms.tgt_pltfrm: ibiza
ms.devlang: multiple
ms.topic: article
ms.date: 04/25/2017
ms.author: bwren
ms.openlocfilehash: 747c00842f4df9c7fbd816c99771ba8a267106a4
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/18/2017
---
# <a name="telemetry-correlation-in-application-insights"></a><span data-ttu-id="a80ba-103">Application Insights 中的遙測相互關聯</span><span class="sxs-lookup"><span data-stu-id="a80ba-103">Telemetry correlation in Application Insights</span></span>

<span data-ttu-id="a80ba-104">在微服務的世界裡，每個邏輯作業都需要在服務的各種元件中完成工作。</span><span class="sxs-lookup"><span data-stu-id="a80ba-104">In the world of micro services, every logical operation requires work done in various components of the service.</span></span> <span data-ttu-id="a80ba-105">每個元件都可分別使用 [Application Insights](app-insights-overview.md) 監視。</span><span class="sxs-lookup"><span data-stu-id="a80ba-105">Each of these components can be separately monitored by [Application Insights](app-insights-overview.md).</span></span> <span data-ttu-id="a80ba-106">Web 應用程式元件會與驗證提供者元件進行通訊以驗證使用者認證，並透過 API 元件取得視覺效果的資料。</span><span class="sxs-lookup"><span data-stu-id="a80ba-106">The web app component communicates with authentication provider component to validate user credentials, and with the API component to get data for visualization.</span></span> <span data-ttu-id="a80ba-107">API 元件本身可以查詢其他服務中的資料，並使用快取提供者元件及向計費元件通知這個呼叫。</span><span class="sxs-lookup"><span data-stu-id="a80ba-107">The API component in its turn can query data from other services and use cache-provider components and notify the billing component about this call.</span></span> <span data-ttu-id="a80ba-108">Application Insights 支援分散式遙測相互關聯。</span><span class="sxs-lookup"><span data-stu-id="a80ba-108">Application Insights supports distributed telemetry correlation.</span></span> <span data-ttu-id="a80ba-109">它可讓您偵測造成失敗或效能衰退的元件。</span><span class="sxs-lookup"><span data-stu-id="a80ba-109">It allows you to detect which component is responsible for failures or performance degradation.</span></span>

<span data-ttu-id="a80ba-110">本文說明 Application Insights 所使用的資料模型，以關聯多個元件所傳送的遙測。</span><span class="sxs-lookup"><span data-stu-id="a80ba-110">This article explains the data model used by Application Insights to correlate telemetry sent by multiple components.</span></span> <span data-ttu-id="a80ba-111">它涵蓋內容傳播技巧和通訊協定。</span><span class="sxs-lookup"><span data-stu-id="a80ba-111">It covers the context propagation techniques and protocols.</span></span> <span data-ttu-id="a80ba-112">它還包括實作不同語言和平台上的相互關聯概念。</span><span class="sxs-lookup"><span data-stu-id="a80ba-112">It also covers the implementation of the correlation concepts on different languages and platforms.</span></span>

## <a name="telemetry-correlation-data-model"></a><span data-ttu-id="a80ba-113">遙測相互關聯資料模型</span><span class="sxs-lookup"><span data-stu-id="a80ba-113">Telemetry correlation data model</span></span>

<span data-ttu-id="a80ba-114">Application Insights 會定義分散遙測相互關聯的[資料模型](application-insights-data-model.md)。</span><span class="sxs-lookup"><span data-stu-id="a80ba-114">Application Insights defines a [data model](application-insights-data-model.md) for distributed telemetry correlation.</span></span> <span data-ttu-id="a80ba-115">為了將遙測與邏輯作業相關聯，每個遙測項目都有稱為 `operation_Id` 的內容欄位。</span><span class="sxs-lookup"><span data-stu-id="a80ba-115">To associate telemetry with the logical operation, every telemetry item has a context field called `operation_Id`.</span></span> <span data-ttu-id="a80ba-116">每個遙測項目會在分散式追蹤內共用這個識別碼。</span><span class="sxs-lookup"><span data-stu-id="a80ba-116">This identifier is shared by every telemetry item in the distributed trace.</span></span> <span data-ttu-id="a80ba-117">因此即使單一層中遺失遙測，您仍然可以將其他元件所報告的遙測相關聯。</span><span class="sxs-lookup"><span data-stu-id="a80ba-117">So even with loss of telemetry from a single layer you still can associate telemetry reported by other components.</span></span>

<span data-ttu-id="a80ba-118">分散式邏輯作業通常包含一組較小的作業 - 要求由其中一個元件處理。</span><span class="sxs-lookup"><span data-stu-id="a80ba-118">Distributed logical operation typically consists of a set of smaller operations - requests processed by one of the components.</span></span> <span data-ttu-id="a80ba-119">這些作業是由[要求遙測](application-insights-data-model-request-telemetry.md)所定義。</span><span class="sxs-lookup"><span data-stu-id="a80ba-119">Those operations are defined by [request telemetry](application-insights-data-model-request-telemetry.md).</span></span> <span data-ttu-id="a80ba-120">每個要求遙測都有它自己的 `id`，可供全域唯一識別。</span><span class="sxs-lookup"><span data-stu-id="a80ba-120">Every request telemetry has its own `id` that uniquely globally identifies it.</span></span> <span data-ttu-id="a80ba-121">與這個要求關聯的所有遙測 - 追蹤、例外狀況等都應該將 `operation_parentId` 設定為 `id` 的要求值。</span><span class="sxs-lookup"><span data-stu-id="a80ba-121">And all telemetry - traces, exceptions, etc. associated with this request should set the `operation_parentId` to the value of the request `id`.</span></span>

<span data-ttu-id="a80ba-122">每個外寄的作業 (例如 http) 都會呼叫由[相依性遙測](application-insights-data-model-dependency-telemetry.md)所代表的另一個元件。</span><span class="sxs-lookup"><span data-stu-id="a80ba-122">Every outgoing operation like http call to another component represented by [dependency telemetry](application-insights-data-model-dependency-telemetry.md).</span></span> <span data-ttu-id="a80ba-123">相依性遙測也會定義它自己的全域唯一 `id`。</span><span class="sxs-lookup"><span data-stu-id="a80ba-123">Dependency telemetry also defines its own `id` that is globally unique.</span></span> <span data-ttu-id="a80ba-124">由這個相依性呼叫啟動的要求遙測會使用它作為 `operation_parentId`。</span><span class="sxs-lookup"><span data-stu-id="a80ba-124">Request telemetry, initiated by this dependency call, uses it as `operation_parentId`.</span></span>

<span data-ttu-id="a80ba-125">您可以將 `operation_Id`、`operation_parentId` 和 `request.id` 與 `dependency.id` 搭配使用，建置分散式邏輯作業的檢視。</span><span class="sxs-lookup"><span data-stu-id="a80ba-125">You can build the view of distributed logical operation using `operation_Id`, `operation_parentId`, and `request.id` with `dependency.id`.</span></span> <span data-ttu-id="a80ba-126">這些欄位也會定義遙測呼叫的因果順序。</span><span class="sxs-lookup"><span data-stu-id="a80ba-126">Those fields also define the causality order of telemetry calls.</span></span>

<span data-ttu-id="a80ba-127">在微服務環境中，來自元件的追蹤可能會移至不同的儲存體。</span><span class="sxs-lookup"><span data-stu-id="a80ba-127">In micro services environment, traces from components may go to the different storages.</span></span> <span data-ttu-id="a80ba-128">每個元件可能會在 Application Insights 中擁有自己的檢測金鑰。</span><span class="sxs-lookup"><span data-stu-id="a80ba-128">Every component may have its own instrumentation key in Application Insights.</span></span> <span data-ttu-id="a80ba-129">若要取得邏輯作業的遙測，您需要查詢每個儲存體中的資料。</span><span class="sxs-lookup"><span data-stu-id="a80ba-129">To get telemetry for the logical operation, you need to query data from every storage.</span></span> <span data-ttu-id="a80ba-130">當儲存體的數目很龐大時，您需要接下來要在何處尋找的相關提示。</span><span class="sxs-lookup"><span data-stu-id="a80ba-130">When number of storages is huge, you need to have a hint on where to look next.</span></span>

<span data-ttu-id="a80ba-131">Application Insights 資料模型會定義兩個欄位來解決這個問題：`request.source` 和 `dependency.target`。</span><span class="sxs-lookup"><span data-stu-id="a80ba-131">Application Insights data model defines two fields to solve this problem: `request.source` and `dependency.target`.</span></span> <span data-ttu-id="a80ba-132">第一個欄位會識別起始相依性要求的元件，而第二個欄位會識別傳回相依性呼叫回應的元件。</span><span class="sxs-lookup"><span data-stu-id="a80ba-132">The first field identifies the component that initiated the dependency request, and the second identifies which component returned the response of the dependency call.</span></span>


## <a name="example"></a><span data-ttu-id="a80ba-133">範例</span><span class="sxs-lookup"><span data-stu-id="a80ba-133">Example</span></span>

<span data-ttu-id="a80ba-134">讓我們以 STOCK PRICES 這個應用程式為例，它會使用稱為 STOCKS API 的外部 API 來顯示目前股票的市場價格。</span><span class="sxs-lookup"><span data-stu-id="a80ba-134">Let's take an example of an application STOCK PRICES showing the current market price of a stock using the external API called STOCKS API.</span></span> <span data-ttu-id="a80ba-135">STOCK PRICES 應用程式的 `Stock page` 頁面，是由用戶端網頁瀏覽器使用 `GET /Home/Stock` 所開啟。</span><span class="sxs-lookup"><span data-stu-id="a80ba-135">The STOCK PRICES application has a page `Stock page` opened by the client web browser using `GET /Home/Stock`.</span></span> <span data-ttu-id="a80ba-136">應用程式會使用 HTTP 呼叫 `GET /api/stock/value` 來查詢 STOCK API。</span><span class="sxs-lookup"><span data-stu-id="a80ba-136">The application queries the STOCK API by using an HTTP call `GET /api/stock/value`.</span></span>

<span data-ttu-id="a80ba-137">您可以分析執行查詢的結果遙測︰</span><span class="sxs-lookup"><span data-stu-id="a80ba-137">You can analyze resulting telemetry running a query:</span></span>

```
(requests | union dependencies | union pageViews) 
| where operation_Id == "STYz"
| project timestamp, itemType, name, id, operation_ParentId, operation_Id
```

<span data-ttu-id="a80ba-138">在結果檢視中，請注意所有遙測項目都會共用根目錄 `operation_Id`。</span><span class="sxs-lookup"><span data-stu-id="a80ba-138">In the result view note that all telemetry items share the root `operation_Id`.</span></span> <span data-ttu-id="a80ba-139">從此頁面發出 AJAX 呼叫時 - 會將新的唯一識別碼 `qJSXU` 指派給相依性遙測，並使用 pageView 的識別碼作為 `operation_ParentId`。</span><span class="sxs-lookup"><span data-stu-id="a80ba-139">When ajax call made from the page - new unique id `qJSXU` is assigned to the dependency telemetry and pageView's id is used as `operation_ParentId`.</span></span> <span data-ttu-id="a80ba-140">伺服器要求接著會使用 AJAX 的識別碼作為 `operation_ParentId` 等等。</span><span class="sxs-lookup"><span data-stu-id="a80ba-140">In turn server request uses ajax's id as `operation_ParentId`, etc.</span></span>

| <span data-ttu-id="a80ba-141">itemType</span><span class="sxs-lookup"><span data-stu-id="a80ba-141">itemType</span></span>   | <span data-ttu-id="a80ba-142">名稱</span><span class="sxs-lookup"><span data-stu-id="a80ba-142">name</span></span>                      | <span data-ttu-id="a80ba-143">id</span><span class="sxs-lookup"><span data-stu-id="a80ba-143">id</span></span>           | <span data-ttu-id="a80ba-144">operation_ParentId</span><span class="sxs-lookup"><span data-stu-id="a80ba-144">operation_ParentId</span></span> | <span data-ttu-id="a80ba-145">operation_Id</span><span class="sxs-lookup"><span data-stu-id="a80ba-145">operation_Id</span></span> |
|------------|---------------------------|--------------|--------------------|--------------|
| <span data-ttu-id="a80ba-146">pageView</span><span class="sxs-lookup"><span data-stu-id="a80ba-146">pageView</span></span>   | <span data-ttu-id="a80ba-147">Stock 頁面</span><span class="sxs-lookup"><span data-stu-id="a80ba-147">Stock page</span></span>                |              | <span data-ttu-id="a80ba-148">STYz</span><span class="sxs-lookup"><span data-stu-id="a80ba-148">STYz</span></span>               | <span data-ttu-id="a80ba-149">STYz</span><span class="sxs-lookup"><span data-stu-id="a80ba-149">STYz</span></span>         |
| <span data-ttu-id="a80ba-150">相依性</span><span class="sxs-lookup"><span data-stu-id="a80ba-150">dependency</span></span> | <span data-ttu-id="a80ba-151">GET /Home/Stock</span><span class="sxs-lookup"><span data-stu-id="a80ba-151">GET /Home/Stock</span></span>           | <span data-ttu-id="a80ba-152">qJSXU</span><span class="sxs-lookup"><span data-stu-id="a80ba-152">qJSXU</span></span>        | <span data-ttu-id="a80ba-153">STYz</span><span class="sxs-lookup"><span data-stu-id="a80ba-153">STYz</span></span>               | <span data-ttu-id="a80ba-154">STYz</span><span class="sxs-lookup"><span data-stu-id="a80ba-154">STYz</span></span>         |
| <span data-ttu-id="a80ba-155">要求</span><span class="sxs-lookup"><span data-stu-id="a80ba-155">request</span></span>    | <span data-ttu-id="a80ba-156">GET Home/Stock</span><span class="sxs-lookup"><span data-stu-id="a80ba-156">GET Home/Stock</span></span>            | <span data-ttu-id="a80ba-157">KqKwlrSt9PA=</span><span class="sxs-lookup"><span data-stu-id="a80ba-157">KqKwlrSt9PA=</span></span> | <span data-ttu-id="a80ba-158">qJSXU</span><span class="sxs-lookup"><span data-stu-id="a80ba-158">qJSXU</span></span>              | <span data-ttu-id="a80ba-159">STYz</span><span class="sxs-lookup"><span data-stu-id="a80ba-159">STYz</span></span>         |
| <span data-ttu-id="a80ba-160">相依性</span><span class="sxs-lookup"><span data-stu-id="a80ba-160">dependency</span></span> | <span data-ttu-id="a80ba-161">GET /api/stock/value</span><span class="sxs-lookup"><span data-stu-id="a80ba-161">GET /api/stock/value</span></span>      | <span data-ttu-id="a80ba-162">bBrf2L7mm2g=</span><span class="sxs-lookup"><span data-stu-id="a80ba-162">bBrf2L7mm2g=</span></span> | <span data-ttu-id="a80ba-163">KqKwlrSt9PA=</span><span class="sxs-lookup"><span data-stu-id="a80ba-163">KqKwlrSt9PA=</span></span>       | <span data-ttu-id="a80ba-164">STYz</span><span class="sxs-lookup"><span data-stu-id="a80ba-164">STYz</span></span>         |

<span data-ttu-id="a80ba-165">現在，當您向外部服務發出呼叫 `GET /api/stock/value` 時，您想要知道該伺服器的身分識別。</span><span class="sxs-lookup"><span data-stu-id="a80ba-165">Now when the call `GET /api/stock/value` made to an external service you want to know the identity of that server.</span></span> <span data-ttu-id="a80ba-166">所以您可以適當地設定 `dependency.target` 欄位。</span><span class="sxs-lookup"><span data-stu-id="a80ba-166">So you can set `dependency.target` field appropriately.</span></span> <span data-ttu-id="a80ba-167">當外部服務不支援監視時 - `target` 會設定為服務的主機名稱，例如 `stock-prices-api.com`。</span><span class="sxs-lookup"><span data-stu-id="a80ba-167">When the external service does not support monitoring - `target` is set to the host name of the service like `stock-prices-api.com`.</span></span> <span data-ttu-id="a80ba-168">不過，如果該服務是透過傳回預先定義的 HTTP 標頭來識別其本身 - `target` 包含的服務識別可讓 Application Insights 透過查詢該服務的遙測來建置分散式追蹤。</span><span class="sxs-lookup"><span data-stu-id="a80ba-168">However if that service identifies itself by returning a predefined HTTP header - `target` contains the service identity that allows Application Insights to build distributed trace by querying telemetry from that service.</span></span> 

## <a name="correlation-headers"></a><span data-ttu-id="a80ba-169">相互關聯標頭</span><span class="sxs-lookup"><span data-stu-id="a80ba-169">Correlation headers</span></span>

<span data-ttu-id="a80ba-170">我們正在進行[相互關聯 HTTP 通訊協定](https://github.com/lmolkova/correlation/blob/master/http_protocol_proposal_v1.md)的 RFC 提案。</span><span class="sxs-lookup"><span data-stu-id="a80ba-170">We are working on RFC proposal for the [correlation HTTP protocol](https://github.com/lmolkova/correlation/blob/master/http_protocol_proposal_v1.md).</span></span> <span data-ttu-id="a80ba-171">此提案會定義兩個標頭︰</span><span class="sxs-lookup"><span data-stu-id="a80ba-171">This proposal defines two headers:</span></span>

- <span data-ttu-id="a80ba-172">`Request-Id` 包含呼叫的全域唯一識別碼</span><span class="sxs-lookup"><span data-stu-id="a80ba-172">`Request-Id` carry the globally unique id of the call</span></span>
- <span data-ttu-id="a80ba-173">`Correlation-Context` - 包含分散式追蹤屬性的名稱值組集合</span><span class="sxs-lookup"><span data-stu-id="a80ba-173">`Correlation-Context` - carry the name value pairs collection of the distributed trace properties</span></span>

<span data-ttu-id="a80ba-174">標準也定義了 `Request-Id` 產生的兩個結構描述 - 平面及階層。</span><span class="sxs-lookup"><span data-stu-id="a80ba-174">The standard also defines two schemas of `Request-Id` generation - flat and hierarchical.</span></span> <span data-ttu-id="a80ba-175">利用一般的結構描述，會針對 `Correlation-Context` 集合定義已知的 `Id` 金鑰。</span><span class="sxs-lookup"><span data-stu-id="a80ba-175">With the flat schema, there is a well-known `Id` key defined for the `Correlation-Context` collection.</span></span>

<span data-ttu-id="a80ba-176">Application Insights 會定義相互關聯 HTTP 通訊協定的[延伸](https://github.com/lmolkova/correlation/blob/master/http_protocol_proposal_v2.md)。</span><span class="sxs-lookup"><span data-stu-id="a80ba-176">Application Insights defines the [extension](https://github.com/lmolkova/correlation/blob/master/http_protocol_proposal_v2.md) for the correlation HTTP protocol.</span></span> <span data-ttu-id="a80ba-177">它會使用 `Request-Context` 名稱值組，來傳播立即呼叫端或被呼叫端所使用的屬性集合。</span><span class="sxs-lookup"><span data-stu-id="a80ba-177">It uses `Request-Context` name value pairs to propagate the collection of properties used by the immediate caller or callee.</span></span> <span data-ttu-id="a80ba-178">Application Insights SDK 會使用此標頭來設定 `dependency.target` 和 `request.source` 欄位。</span><span class="sxs-lookup"><span data-stu-id="a80ba-178">Application Insights SDK uses this header to set `dependency.target` and `request.source` fields.</span></span>

## <a name="open-tracing-and-application-insights"></a><span data-ttu-id="a80ba-179">Open Tracing 與 Application Insights</span><span class="sxs-lookup"><span data-stu-id="a80ba-179">Open tracing and Application Insights</span></span>

<span data-ttu-id="a80ba-180">[Open Tracing](http://opentracing.io/) 和 Application Insights 的資料模型外觀</span><span class="sxs-lookup"><span data-stu-id="a80ba-180">[Open Tracing](http://opentracing.io/) and Application Insights data models looks</span></span> 

- <span data-ttu-id="a80ba-181">`request`、`pageView` 會使用 `span.kind = server` 對應至**範圍**</span><span class="sxs-lookup"><span data-stu-id="a80ba-181">`request`, `pageView` maps to **Span** with `span.kind = server`</span></span>
- <span data-ttu-id="a80ba-182">`dependency` 會使用 `span.kind = client` 對應至**範圍**</span><span class="sxs-lookup"><span data-stu-id="a80ba-182">`dependency` maps to **Span** with `span.kind = client`</span></span>
- <span data-ttu-id="a80ba-183">`request` 和 `dependency` 的 `id` 會對應至 **Span.Id**</span><span class="sxs-lookup"><span data-stu-id="a80ba-183">`id` of a `request` and `dependency` maps to **Span.Id**</span></span>
- <span data-ttu-id="a80ba-184">`operation_Id` 會對應至 **TraceId**</span><span class="sxs-lookup"><span data-stu-id="a80ba-184">`operation_Id` maps to **TraceId**</span></span>
- <span data-ttu-id="a80ba-185">`operation_ParentId` 會對應至 `ChileOf` 類型的**參考**</span><span class="sxs-lookup"><span data-stu-id="a80ba-185">`operation_ParentId` maps to **Reference** of type `ChileOf`</span></span>

<span data-ttu-id="a80ba-186">如需 Application Insights 類型和資料模型，請參閱[資料模型](application-insights-data-model.md)。</span><span class="sxs-lookup"><span data-stu-id="a80ba-186">See [data model](application-insights-data-model.md) for Application Insights types and data model.</span></span>

<span data-ttu-id="a80ba-187">如需 Open Tracing 概念的定義，請參閱[規格](https://github.com/opentracing/specification/blob/master/specification.md)和 [semantic_conventions](https://github.com/opentracing/specification/blob/master/semantic_conventions.md)。</span><span class="sxs-lookup"><span data-stu-id="a80ba-187">See [specification](https://github.com/opentracing/specification/blob/master/specification.md) and [semantic_conventions](https://github.com/opentracing/specification/blob/master/semantic_conventions.md) for definitions of Open Tracing concepts.</span></span>


## <a name="telemetry-correlation-in-net"></a><span data-ttu-id="a80ba-188">.NET 中的遙測相互關聯</span><span class="sxs-lookup"><span data-stu-id="a80ba-188">Telemetry correlation in .NET</span></span>

<span data-ttu-id="a80ba-189">經過一段時間，.NET 定義了數種相互關聯遙測和診斷記錄的方式。</span><span class="sxs-lookup"><span data-stu-id="a80ba-189">Over time .NET defined number of ways to correlate telemetry and diagnostics logs.</span></span> <span data-ttu-id="a80ba-190">`System.Diagnostics.CorrelationManager` 讓您可以追蹤 [LogicalOperationStack 和 ActivityId](https://msdn.microsoft.com/library/system.diagnostics.correlationmanager.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a80ba-190">There is `System.Diagnostics.CorrelationManager` allowing to track [LogicalOperationStack and ActivityId](https://msdn.microsoft.com/library/system.diagnostics.correlationmanager.aspx).</span></span> <span data-ttu-id="a80ba-191">`System.Diagnostics.Tracing.EventSource` 與 Windows ETW 會定義 [SetCurrentThreadActivityId](https://msdn.microsoft.com/library/system.diagnostics.tracing.eventsource.setcurrentthreadactivityid.aspx) 方法。</span><span class="sxs-lookup"><span data-stu-id="a80ba-191">`System.Diagnostics.Tracing.EventSource` and Windows ETW define the method [SetCurrentThreadActivityId](https://msdn.microsoft.com/library/system.diagnostics.tracing.eventsource.setcurrentthreadactivityid.aspx).</span></span> <span data-ttu-id="a80ba-192">`ILogger` 會使用[記錄範圍](https://docs.microsoft.com/aspnet/core/fundamentals/logging#log-scopes)。</span><span class="sxs-lookup"><span data-stu-id="a80ba-192">`ILogger` uses [Log Scopes](https://docs.microsoft.com/aspnet/core/fundamentals/logging#log-scopes).</span></span> <span data-ttu-id="a80ba-193">WCF 與 Http 連接「目前」的內容傳播。</span><span class="sxs-lookup"><span data-stu-id="a80ba-193">WCF and Http wire up "current" context propagation.</span></span>

<span data-ttu-id="a80ba-194">不過這些方法不會啟用自動分散式追蹤支援。</span><span class="sxs-lookup"><span data-stu-id="a80ba-194">However those methods didn't enable automatic distributed tracing support.</span></span> <span data-ttu-id="a80ba-195">`DiagnosticsSource` 是能夠支援自動跨電腦相互關聯的方法。</span><span class="sxs-lookup"><span data-stu-id="a80ba-195">`DiagnosticsSource` is a way to support automatic cross machine correlation.</span></span> <span data-ttu-id="a80ba-196">.NET 程式庫支援 Diagnostics Source，並允許透過如 http 的傳輸自動跨電腦傳播相互關聯內容。</span><span class="sxs-lookup"><span data-stu-id="a80ba-196">.NET libraries support Diagnostics Source and allow automatic cross machine propagation of the correlation context via the transport like http.</span></span>

<span data-ttu-id="a80ba-197">Diagnostics Source 中的[活動指南](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md)會說明追蹤活動的基本概念。</span><span class="sxs-lookup"><span data-stu-id="a80ba-197">The [guide to Activities](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md) in Diagnostics Source explains the basics of tracking Activities.</span></span> 

<span data-ttu-id="a80ba-198">ASP.NET Core 2.0 支援擷取 Http 標頭和啟動新的活動。</span><span class="sxs-lookup"><span data-stu-id="a80ba-198">ASP.NET Core 2.0 supports extraction of Http Headers and starting the new Activity.</span></span> 

<span data-ttu-id="a80ba-199">`System.Net.HttpClient` 起始版本 `<fill in>` 支援自動插入相互關聯 Http 標頭及追蹤 http 呼叫作為 Activity。</span><span class="sxs-lookup"><span data-stu-id="a80ba-199">`System.Net.HttpClient` starting version `<fill in>` supports automatic injection of the correlation Http Headers and tracking the http call as an Activity.</span></span>

<span data-ttu-id="a80ba-200">ASP.NET Classic 有新的 Http 模組 [Microsoft.AspNet.TelemetryCorrelation](https://www.nuget.org/packages/Microsoft.AspNet.TelemetryCorrelation/)。</span><span class="sxs-lookup"><span data-stu-id="a80ba-200">There is a new Http Module [Microsoft.AspNet.TelemetryCorrelation](https://www.nuget.org/packages/Microsoft.AspNet.TelemetryCorrelation/) for the ASP.NET Classic.</span></span> <span data-ttu-id="a80ba-201">此模組會使用 DiagnosticsSource 來實作遙測相互關聯。</span><span class="sxs-lookup"><span data-stu-id="a80ba-201">This module implements telemetry correlation using DiagnosticsSource.</span></span> <span data-ttu-id="a80ba-202">它會根據傳入的要求標頭來啟動活動。</span><span class="sxs-lookup"><span data-stu-id="a80ba-202">It starts activity based on incoming request headers.</span></span> <span data-ttu-id="a80ba-203">還會將不同要求處理階段的遙測相互關聯。</span><span class="sxs-lookup"><span data-stu-id="a80ba-203">It also correlates telemetry from the different stages of request processing.</span></span> <span data-ttu-id="a80ba-204">即使是當 IIS 處理的每個階段在不同管理執行緒上執行時也一樣。</span><span class="sxs-lookup"><span data-stu-id="a80ba-204">Even for the cases when every stage of IIS processing runs on a different manage threads.</span></span>

<span data-ttu-id="a80ba-205">Application Insights SDK 起始版本 `2.4.0-beta1` 會使用 DiagnosticsSource 和 Activity 來收集遙測，並將它與目前活動產生關聯。</span><span class="sxs-lookup"><span data-stu-id="a80ba-205">Application Insights SDK starting version `2.4.0-beta1` uses DiagnosticsSource and Activity to collect telemetry and associate it with the current activity.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="a80ba-206">後續步驟</span><span class="sxs-lookup"><span data-stu-id="a80ba-206">Next steps</span></span>

- [<span data-ttu-id="a80ba-207">撰寫自訂遙測</span><span class="sxs-lookup"><span data-stu-id="a80ba-207">Write custom telemetry</span></span>](app-insights-api-custom-events-metrics.md)
- <span data-ttu-id="a80ba-208">在 Application Insights 上將微服務的所有元件上架。</span><span class="sxs-lookup"><span data-stu-id="a80ba-208">Onboard all components of your micro service on Application Insights.</span></span> <span data-ttu-id="a80ba-209">查看[支援的平台](app-insights-platforms.md)。</span><span class="sxs-lookup"><span data-stu-id="a80ba-209">Check out [supported platforms](app-insights-platforms.md).</span></span>
- <span data-ttu-id="a80ba-210">如需 Application Insights 類型和資料模型，請參閱[資料模型](application-insights-data-model.md)。</span><span class="sxs-lookup"><span data-stu-id="a80ba-210">See [data model](application-insights-data-model.md) for Application Insights types and data model.</span></span>
- <span data-ttu-id="a80ba-211">了解如何[擴充和篩選遙測](app-insights-api-filtering-sampling.md)。</span><span class="sxs-lookup"><span data-stu-id="a80ba-211">Learn how to [extend and filter telemetry](app-insights-api-filtering-sampling.md).</span></span>
