---
title: "針對 Azure 診斷進行疑難排解 | Microsoft Docs"
description: "針對在 Azure 虛擬機器、Service Fabric 或 雲端服務中使用 Azure 診斷時出現的問題進行疑難排解。"
services: monitoring-and-diagnostics
documentationcenter: .net
author: rboucher
manager: carmonm
editor: 
ms.assetid: 66469bce-d457-4d1e-b550-a08d2be4d28c
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 07/12/2017
ms.author: robb
ms.openlocfilehash: a0cb529836b14df71e83616f4f625a002c535b7b
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/29/2017
---
# <a name="azure-diagnostics-troubleshooting"></a><span data-ttu-id="0c82e-103">Azure 診斷疑難排解</span><span class="sxs-lookup"><span data-stu-id="0c82e-103">Azure Diagnostics Troubleshooting</span></span>
<span data-ttu-id="0c82e-104">有關使用 Azure 診斷的疑難排解資訊。</span><span class="sxs-lookup"><span data-stu-id="0c82e-104">Troubleshooting information relevant to using Azure Diagnostics.</span></span> <span data-ttu-id="0c82e-105">如需有關 Azure 診斷的詳細資訊，請參閱 [Azure 診斷概觀](azure-diagnostics.md)。</span><span class="sxs-lookup"><span data-stu-id="0c82e-105">For more information on Azure diagnostics, see [Azure Diagnostics Overview](azure-diagnostics.md).</span></span>

## <a name="logical-components"></a><span data-ttu-id="0c82e-106">邏輯元件</span><span class="sxs-lookup"><span data-stu-id="0c82e-106">Logical Components</span></span>
<span data-ttu-id="0c82e-107">**診斷外掛程式啟動器 (DiagnosticsPluginLauncher.exe)**：啟動 Azure 診斷擴充功能。</span><span class="sxs-lookup"><span data-stu-id="0c82e-107">**Diagnostics Plugin Launcher (DiagnosticsPluginLauncher.exe)**: Launches the Azure Diagnostics extension.</span></span> <span data-ttu-id="0c82e-108">可作為進入點程序。</span><span class="sxs-lookup"><span data-stu-id="0c82e-108">Serves as the entry point process.</span></span>

<span data-ttu-id="0c82e-109">**診斷外掛程式 (DiagnosticsPlugin.exe)**：上述啟動器啟動的主要程序，而且該程序會設定監視代理程式，啟動代理程式，以及管理其存留期。</span><span class="sxs-lookup"><span data-stu-id="0c82e-109">**Diagnostics Plugin (DiagnosticsPlugin.exe)**: Main process that is launched by the launcher above and configures the Monitoring Agent, launches it and manages its lifetime.</span></span> 

<span data-ttu-id="0c82e-110">**監視代理程式 (MonAgent\*.exe 處理程序)**：這些處理程序會執行大量工作；也就是監視、收集及傳輸診斷資料。</span><span class="sxs-lookup"><span data-stu-id="0c82e-110">**Monitoring Agent (MonAgent\*.exe processes)**: These processes do the bulk of the work; i.e., monitoring, collection and transfer of the diagnostics data.</span></span>  

## <a name="logartifact-paths"></a><span data-ttu-id="0c82e-111">記錄檔/構件路徑</span><span class="sxs-lookup"><span data-stu-id="0c82e-111">Log/Artifact Paths</span></span>
<span data-ttu-id="0c82e-112">以下是一些重要記錄檔和構件的路徑。</span><span class="sxs-lookup"><span data-stu-id="0c82e-112">Here are the paths to some important logs and artifacts.</span></span> <span data-ttu-id="0c82e-113">我們會持續在文件的其餘部分參考這些項目：</span><span class="sxs-lookup"><span data-stu-id="0c82e-113">We keep referring to these throughout the rest of the document:</span></span>
### <a name="cloud-services"></a><span data-ttu-id="0c82e-114">雲端服務</span><span class="sxs-lookup"><span data-stu-id="0c82e-114">Cloud Services</span></span>
| <span data-ttu-id="0c82e-115">構件</span><span class="sxs-lookup"><span data-stu-id="0c82e-115">Artifact</span></span> | <span data-ttu-id="0c82e-116">路徑</span><span class="sxs-lookup"><span data-stu-id="0c82e-116">Path</span></span> |
| --- | --- |
| <span data-ttu-id="0c82e-117">**Azure 診斷組態檔**</span><span class="sxs-lookup"><span data-stu-id="0c82e-117">**Azure Diagnostics configuration file**</span></span> | <span data-ttu-id="0c82e-118">%SystemDrive%\Packages\Plugins\Microsoft.Azure.Diagnostics.PaaSDiagnostics\<version>\Config.txt</span><span class="sxs-lookup"><span data-stu-id="0c82e-118">%SystemDrive%\Packages\Plugins\Microsoft.Azure.Diagnostics.PaaSDiagnostics\<version>\Config.txt</span></span> |
| <span data-ttu-id="0c82e-119">**記錄檔**</span><span class="sxs-lookup"><span data-stu-id="0c82e-119">**Log files**</span></span> | <span data-ttu-id="0c82e-120">C:\Logs\Plugins\Microsoft.Azure.Diagnostics.PaaSDiagnostics\<version>\\</span><span class="sxs-lookup"><span data-stu-id="0c82e-120">C:\Logs\Plugins\Microsoft.Azure.Diagnostics.PaaSDiagnostics\<version>\\</span></span> |
| <span data-ttu-id="0c82e-121">**診斷資料的本機存放區**</span><span class="sxs-lookup"><span data-stu-id="0c82e-121">**Local store for diagnostics data**</span></span> | <span data-ttu-id="0c82e-122">C:\Resources\Directory\<CloudServiceDeploymentID>.\<RoleName>.DiagnosticStore\WAD0107\Tables</span><span class="sxs-lookup"><span data-stu-id="0c82e-122">C:\Resources\Directory\<CloudServiceDeploymentID>.\<RoleName>.DiagnosticStore\WAD0107\Tables</span></span> |
| <span data-ttu-id="0c82e-123">**監視代理程式組態檔**</span><span class="sxs-lookup"><span data-stu-id="0c82e-123">**Monitoring Agent configuration file**</span></span> | <span data-ttu-id="0c82e-124">C:\Resources\Directory\<CloudServiceDeploymentID>.\<RoleName>.DiagnosticStore\WAD0107\Configuration\MaConfig.xml</span><span class="sxs-lookup"><span data-stu-id="0c82e-124">C:\Resources\Directory\<CloudServiceDeploymentID>.\<RoleName>.DiagnosticStore\WAD0107\Configuration\MaConfig.xml</span></span> |
| <span data-ttu-id="0c82e-125">**Azure 診斷擴充功能套件**</span><span class="sxs-lookup"><span data-stu-id="0c82e-125">**Azure diagnostics extension package**</span></span> | <span data-ttu-id="0c82e-126">%SystemDrive%\Packages\Plugins\Microsoft.Azure.Diagnostics.PaaSDiagnostics\<version></span><span class="sxs-lookup"><span data-stu-id="0c82e-126">%SystemDrive%\Packages\Plugins\Microsoft.Azure.Diagnostics.PaaSDiagnostics\<version></span></span> |
| <span data-ttu-id="0c82e-127">**記錄集合公用程式路徑**</span><span class="sxs-lookup"><span data-stu-id="0c82e-127">**Log collection utility path**</span></span> | <span data-ttu-id="0c82e-128">%SystemDrive%\Packages\GuestAgent\\</span><span class="sxs-lookup"><span data-stu-id="0c82e-128">%SystemDrive%\Packages\GuestAgent\\</span></span> |
| <span data-ttu-id="0c82e-129">**MonAgentHost 記錄檔**</span><span class="sxs-lookup"><span data-stu-id="0c82e-129">**MonAgentHost log file**</span></span> | <span data-ttu-id="0c82e-130">C:\Resources\Directory\<CloudServiceDeploymentID>.\<RoleName>.DiagnosticStore\WAD0107\Configuration\MonAgentHost.<seq_num>.log</span><span class="sxs-lookup"><span data-stu-id="0c82e-130">C:\Resources\Directory\<CloudServiceDeploymentID>.\<RoleName>.DiagnosticStore\WAD0107\Configuration\MonAgentHost.<seq_num>.log</span></span> |

### <a name="virtual-machines"></a><span data-ttu-id="0c82e-131">虛擬機器</span><span class="sxs-lookup"><span data-stu-id="0c82e-131">Virtual Machines</span></span>
| <span data-ttu-id="0c82e-132">構件</span><span class="sxs-lookup"><span data-stu-id="0c82e-132">Artifact</span></span> | <span data-ttu-id="0c82e-133">路徑</span><span class="sxs-lookup"><span data-stu-id="0c82e-133">Path</span></span> |
| --- | --- |
| <span data-ttu-id="0c82e-134">**Azure 診斷組態檔**</span><span class="sxs-lookup"><span data-stu-id="0c82e-134">**Azure Diagnostics configuration file**</span></span> | <span data-ttu-id="0c82e-135">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<version>\RuntimeSettings</span><span class="sxs-lookup"><span data-stu-id="0c82e-135">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<version>\RuntimeSettings</span></span> |
| <span data-ttu-id="0c82e-136">**記錄檔**</span><span class="sxs-lookup"><span data-stu-id="0c82e-136">**Log files**</span></span> | <span data-ttu-id="0c82e-137">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<version>\Logs\\</span><span class="sxs-lookup"><span data-stu-id="0c82e-137">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<version>\Logs\\</span></span> |
| <span data-ttu-id="0c82e-138">**診斷資料的本機存放區**</span><span class="sxs-lookup"><span data-stu-id="0c82e-138">**Local store for diagnostics data**</span></span> | <span data-ttu-id="0c82e-139">C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<DiagnosticsVersion>\WAD0107\Tables</span><span class="sxs-lookup"><span data-stu-id="0c82e-139">C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<DiagnosticsVersion>\WAD0107\Tables</span></span> |
| <span data-ttu-id="0c82e-140">**監視代理程式組態檔**</span><span class="sxs-lookup"><span data-stu-id="0c82e-140">**Monitoring Agent configuration file**</span></span> | <span data-ttu-id="0c82e-141">C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<DiagnosticsVersion>\WAD0107\Configuration\MaConfig.xml</span><span class="sxs-lookup"><span data-stu-id="0c82e-141">C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<DiagnosticsVersion>\WAD0107\Configuration\MaConfig.xml</span></span> |
| <span data-ttu-id="0c82e-142">**狀態檔案**</span><span class="sxs-lookup"><span data-stu-id="0c82e-142">**Status file**</span></span> | <span data-ttu-id="0c82e-143">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<version>\Status</span><span class="sxs-lookup"><span data-stu-id="0c82e-143">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<version>\Status</span></span> |
| <span data-ttu-id="0c82e-144">**Azure 診斷擴充功能套件**</span><span class="sxs-lookup"><span data-stu-id="0c82e-144">**Azure diagnostics extension package**</span></span> | <span data-ttu-id="0c82e-145">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<DiagnosticsVersion></span><span class="sxs-lookup"><span data-stu-id="0c82e-145">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<DiagnosticsVersion></span></span>|
| <span data-ttu-id="0c82e-146">**記錄集合公用程式路徑**</span><span class="sxs-lookup"><span data-stu-id="0c82e-146">**Log collection utility path**</span></span> | <span data-ttu-id="0c82e-147">C:\WindowsAzure\Packages</span><span class="sxs-lookup"><span data-stu-id="0c82e-147">C:\WindowsAzure\Packages</span></span> |
| <span data-ttu-id="0c82e-148">**MonAgentHost 記錄檔**</span><span class="sxs-lookup"><span data-stu-id="0c82e-148">**MonAgentHost log file**</span></span> | <span data-ttu-id="0c82e-149">C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<DiagnosticsVersion>\WAD0107\Configuration\MonAgentHost.<seq_num>.log</span><span class="sxs-lookup"><span data-stu-id="0c82e-149">C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<DiagnosticsVersion>\WAD0107\Configuration\MonAgentHost.<seq_num>.log</span></span> |

## <a name="metric-data-doesnt-show-in-azure-portal"></a><span data-ttu-id="0c82e-150">計量資料不會出現在 Azure 入口網站</span><span class="sxs-lookup"><span data-stu-id="0c82e-150">Metric data doesn't show in Azure portal</span></span>
<span data-ttu-id="0c82e-151">Azure 診斷會提供一些計量資料，這些資料可以在 Azure 入口網站中顯示。</span><span class="sxs-lookup"><span data-stu-id="0c82e-151">Azure Diagnostics provides a bunch of metric data, which can be displayed in Azure portal.</span></span> <span data-ttu-id="0c82e-152">如果您在入口網站中看不到這些資料，請檢查診斷儲存體帳戶 -> WADMetrics\* 資料表，以查看是否有對應計量記錄。</span><span class="sxs-lookup"><span data-stu-id="0c82e-152">If you have problems with seeing these data in portal, check the diagnostics storage account -> WADMetrics\* table to see if the corresponding metric records are there.</span></span> <span data-ttu-id="0c82e-153">在這裡，資料表的 PartitionKey 是虛擬機器或虛擬機器擴展集的資源識別碼，而 RowKey 是計量名稱，也就是效能計數器名稱。</span><span class="sxs-lookup"><span data-stu-id="0c82e-153">Here, the PartitionKey of the table is the resource ID of virtual machine or virtual machine scale set, and the RowKey is the metric name i.e. performance counter name.</span></span>

<span data-ttu-id="0c82e-154">如果資源識別碼不正確，請檢查 [診斷設定] -> [計量] -> [資源識別碼]，以查看資源識別碼是否正確設定。</span><span class="sxs-lookup"><span data-stu-id="0c82e-154">If the resource ID is incorrect, check Diagnostics Configuration -> Metrics -> ResourceId to see if the resource ID is set correctly.</span></span>

<span data-ttu-id="0c82e-155">如果沒有特定計量的資料，請檢查 [診斷設定] -> [PerformanceCounter]，以查看是否包含計量 (效能計數器)。</span><span class="sxs-lookup"><span data-stu-id="0c82e-155">If there's no data for the specific metric, check Diagnostics Configuration -> PerformanceCounter to see if the metric(performance counter) is included.</span></span> <span data-ttu-id="0c82e-156">我們預設會啟用下列計數器。</span><span class="sxs-lookup"><span data-stu-id="0c82e-156">We enable the following counters by default.</span></span>
- <span data-ttu-id="0c82e-157">\Processor(_Total)\% Processor Time</span><span class="sxs-lookup"><span data-stu-id="0c82e-157">\Processor(_Total)\% Processor Time</span></span>
- <span data-ttu-id="0c82e-158">\Memory\Available Bytes</span><span class="sxs-lookup"><span data-stu-id="0c82e-158">\Memory\Available Bytes</span></span>
- <span data-ttu-id="0c82e-159">\ASP.NET Applications(__Total__)\Requests/Sec</span><span class="sxs-lookup"><span data-stu-id="0c82e-159">\ASP.NET Applications(__Total__)\Requests/Sec</span></span>
- <span data-ttu-id="0c82e-160">\ASP.NET Applications(__Total__)\Errors Total/Sec</span><span class="sxs-lookup"><span data-stu-id="0c82e-160">\ASP.NET Applications(__Total__)\Errors Total/Sec</span></span>
- <span data-ttu-id="0c82e-161">\ASP.NET\Requests Queued</span><span class="sxs-lookup"><span data-stu-id="0c82e-161">\ASP.NET\Requests Queued</span></span>
- <span data-ttu-id="0c82e-162">\ASP.NET\Requests Rejected</span><span class="sxs-lookup"><span data-stu-id="0c82e-162">\ASP.NET\Requests Rejected</span></span>
- <span data-ttu-id="0c82e-163">\Processor(w3wp)\% Processor Time</span><span class="sxs-lookup"><span data-stu-id="0c82e-163">\Processor(w3wp)\% Processor Time</span></span>
- <span data-ttu-id="0c82e-164">\Process(w3wp)\Private Bytes</span><span class="sxs-lookup"><span data-stu-id="0c82e-164">\Process(w3wp)\Private Bytes</span></span>
- <span data-ttu-id="0c82e-165">\Process(WaIISHost)\% Processor Time</span><span class="sxs-lookup"><span data-stu-id="0c82e-165">\Process(WaIISHost)\% Processor Time</span></span>
- <span data-ttu-id="0c82e-166">\Process(WaIISHost)\Private Bytes</span><span class="sxs-lookup"><span data-stu-id="0c82e-166">\Process(WaIISHost)\Private Bytes</span></span>
- <span data-ttu-id="0c82e-167">\Process(WaWorkerHost)\% Processor Time</span><span class="sxs-lookup"><span data-stu-id="0c82e-167">\Process(WaWorkerHost)\% Processor Time</span></span>
- <span data-ttu-id="0c82e-168">\Process(WaWorkerHost)\Private Bytes</span><span class="sxs-lookup"><span data-stu-id="0c82e-168">\Process(WaWorkerHost)\Private Bytes</span></span>
- <span data-ttu-id="0c82e-169">\Memory\Page Faults/sec</span><span class="sxs-lookup"><span data-stu-id="0c82e-169">\Memory\Page Faults/sec</span></span>
- <span data-ttu-id="0c82e-170">\.NET CLR Memory(_Global_)\% Time in GC</span><span class="sxs-lookup"><span data-stu-id="0c82e-170">\.NET CLR Memory(_Global_)\% Time in GC</span></span>
- <span data-ttu-id="0c82e-171">\LogicalDisk(C:)\Disk Write Bytes/sec</span><span class="sxs-lookup"><span data-stu-id="0c82e-171">\LogicalDisk(C:)\Disk Write Bytes/sec</span></span>
- <span data-ttu-id="0c82e-172">\LogicalDisk(C:)\Disk Read Bytes/sec</span><span class="sxs-lookup"><span data-stu-id="0c82e-172">\LogicalDisk(C:)\Disk Read Bytes/sec</span></span>
- <span data-ttu-id="0c82e-173">\LogicalDisk(D:)\Disk Write Bytes/sec</span><span class="sxs-lookup"><span data-stu-id="0c82e-173">\LogicalDisk(D:)\Disk Write Bytes/sec</span></span>
- <span data-ttu-id="0c82e-174">\LogicalDisk(D:)\Disk Read Bytes/sec</span><span class="sxs-lookup"><span data-stu-id="0c82e-174">\LogicalDisk(D:)\Disk Read Bytes/sec</span></span>

<span data-ttu-id="0c82e-175">如果設定正確，但是您仍然看不到計量資料，請遵循以下指導方針以進行進一步的調查。</span><span class="sxs-lookup"><span data-stu-id="0c82e-175">If the configuration is set correctly but you still cannot see the metric data, follow the guidelines below for the further investigation.</span></span>


## <a name="azure-diagnostics-is-not-starting"></a><span data-ttu-id="0c82e-176">Azure 診斷未啟動</span><span class="sxs-lookup"><span data-stu-id="0c82e-176">Azure Diagnostics is not Starting</span></span>
<span data-ttu-id="0c82e-177">從上述提供的記錄檔位置查看 **DiagnosticsPluginLauncher.log** 和 **DiagnosticsPlugin.log** 檔案，以取得診斷為何無法啟動的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="0c82e-177">Look at **DiagnosticsPluginLauncher.log** and **DiagnosticsPlugin.log** files from the location of the log files provided above for information on why diagnostics failed to start.</span></span> 

<span data-ttu-id="0c82e-178">如果這些記錄指出 `Monitoring Agent not reporting success after launch`，則表示啟動 MonAgentHost.exe 失敗。</span><span class="sxs-lookup"><span data-stu-id="0c82e-178">If these logs indicate `Monitoring Agent not reporting success after launch`, it means there was a failure launching MonAgentHost.exe.</span></span> <span data-ttu-id="0c82e-179">在針對上節中的 `MonAgentHost log file` 指示的位置，查看其記錄。</span><span class="sxs-lookup"><span data-stu-id="0c82e-179">Look at the logs for that in the location indicated for `MonAgentHost log file` in the section above.</span></span>

<span data-ttu-id="0c82e-180">記錄檔的最後一行包含結束代碼。</span><span class="sxs-lookup"><span data-stu-id="0c82e-180">The last line of the log files contains the exit code.</span></span>  

```
DiagnosticsPluginLauncher.exe Information: 0 : [4/16/2016 6:24:15 AM] DiagnosticPlugin exited with code 0
```
<span data-ttu-id="0c82e-181">如果您發現**負數**的結束代碼，請參閱[參考](#references)中的[結束代碼表格](#azure-diagnostics-plugin-exit-codes)。</span><span class="sxs-lookup"><span data-stu-id="0c82e-181">If you find a **negative** exit code, refer to the [exit code table](#azure-diagnostics-plugin-exit-codes) in the [References](#references).</span></span>

## <a name="diagnostics-data-is-not-logged-to-azure-storage"></a><span data-ttu-id="0c82e-182">診斷資料未記錄至 Azure 儲存體</span><span class="sxs-lookup"><span data-stu-id="0c82e-182">Diagnostics Data is Not Logged to Azure Storage</span></span>
<span data-ttu-id="0c82e-183">判斷是否沒有顯示任何資料，或只有部分資料未顯示。</span><span class="sxs-lookup"><span data-stu-id="0c82e-183">Determine if no data is showing up or only some of the data is not showing up.</span></span>

### <a name="diagnostics-infrastructure-logs"></a><span data-ttu-id="0c82e-184">診斷基礎結構記錄檔</span><span class="sxs-lookup"><span data-stu-id="0c82e-184">Diagnostics Infrastructure Logs</span></span>
<span data-ttu-id="0c82e-185">診斷基礎結構記錄檔是 Azure 診斷記錄任何所發生錯誤的所在位置。</span><span class="sxs-lookup"><span data-stu-id="0c82e-185">Diagnostics Infrastructure Logs is where azure diagnostics logs any errors that it runs into.</span></span> <span data-ttu-id="0c82e-186">確定您已經在設定中啟用 ([作法？](#how-to-check-diagnostics-extension-configuration)) 診斷基礎結構記錄的擷取功能，並快速尋找設定的儲存體帳戶中，於 `DiagnosticInfrastructureLogsTable` 資料表中顯示的任何相關錯誤。</span><span class="sxs-lookup"><span data-stu-id="0c82e-186">Make sure you have enabled ([how to?](#how-to-check-diagnostics-extension-configuration)) capturing of Diagnostics Infrastructure logs in your configuration and quickly look for any relevant errors that show up in the `DiagnosticInfrastructureLogsTable` table in your configured storage account.</span></span>

### <a name="no-data-is-showing-up"></a><span data-ttu-id="0c82e-187">未顯示任何資料</span><span class="sxs-lookup"><span data-stu-id="0c82e-187">No data is showing up</span></span>
<span data-ttu-id="0c82e-188">完全遺漏事件資料的最常見原因是不正確地定義儲存體帳戶資訊。</span><span class="sxs-lookup"><span data-stu-id="0c82e-188">The most common cause of event data entirely missing is incorrectly defined storage account information.</span></span>

<span data-ttu-id="0c82e-189">解決方法：更正診斷組態，並重新安裝診斷。</span><span class="sxs-lookup"><span data-stu-id="0c82e-189">Solution: Correct your Diagnostics configuration and reinstall Diagnostics.</span></span>

<span data-ttu-id="0c82e-190">如果已正確設定儲存體帳戶，請從遠端桌面連接到電腦，並確定 DiagnosticsPlugin.exe 和 MonAgentCore.exe 正在執行中。</span><span class="sxs-lookup"><span data-stu-id="0c82e-190">If the storage account is configured correctly, remote desktop into the machine and make sure DiagnosticsPlugin.exe and MonAgentCore.exe are running.</span></span> <span data-ttu-id="0c82e-191">如果它們並未執行，請依照 [Azure 診斷未啟動](#azure-diagnostics-is-not-starting)中的說明進行作業。</span><span class="sxs-lookup"><span data-stu-id="0c82e-191">If they are not running, follow [Azure Diagnostics is not Starting](#azure-diagnostics-is-not-starting).</span></span> <span data-ttu-id="0c82e-192">如果程序正在執行，請跳至[是否正在本機擷取資料](#is-data-getting-captured-locally)，並從那裡開始依照本指南進行作業。</span><span class="sxs-lookup"><span data-stu-id="0c82e-192">If the processes are running, jump to [Is data getting captured locally](#is-data-getting-captured-locally) and follow this guide from there on.</span></span>

### <a name="part-of-the-data-is-missing"></a><span data-ttu-id="0c82e-193">遺漏部分資料</span><span class="sxs-lookup"><span data-stu-id="0c82e-193">Part of the data is missing</span></span>
<span data-ttu-id="0c82e-194">如果您正在取得某些資料，但沒有取得其他資料。</span><span class="sxs-lookup"><span data-stu-id="0c82e-194">If you are getting some data but not other.</span></span> <span data-ttu-id="0c82e-195">這表示未正確設定資料收集/傳輸管線。</span><span class="sxs-lookup"><span data-stu-id="0c82e-195">This means the data collection / transfer pipeline is set correctly.</span></span> <span data-ttu-id="0c82e-196">請依照這裡的子小節縮小問題範圍以找出問題：</span><span class="sxs-lookup"><span data-stu-id="0c82e-196">Follow the subsections here to narrow down what the issue is:</span></span>
#### <a name="is-collection-configured"></a><span data-ttu-id="0c82e-197">是否已設定集合：</span><span class="sxs-lookup"><span data-stu-id="0c82e-197">Is Collection Configured:</span></span> 
<span data-ttu-id="0c82e-198">診斷組態包含指定要收集特定資料類型的部分。</span><span class="sxs-lookup"><span data-stu-id="0c82e-198">Diagnostics Configuration contains the part that instructs for a particular type of data to be collected.</span></span> <span data-ttu-id="0c82e-199">[檢閱您的設定](#how-to-check-diagnostics-extension-configuration)以確定您尋找的資料不是未設定要收集的資料。</span><span class="sxs-lookup"><span data-stu-id="0c82e-199">[Review your configuration](#how-to-check-diagnostics-extension-configuration) to make sure you are not looking for data you have not configured for collection.</span></span>
#### <a name="is-the-host-generating-data"></a><span data-ttu-id="0c82e-200">主機是否正在產生資料：</span><span class="sxs-lookup"><span data-stu-id="0c82e-200">Is the host generating data:</span></span>
- <span data-ttu-id="0c82e-201">**效能計數器**：開啟 Perfmon 並檢查計數器。</span><span class="sxs-lookup"><span data-stu-id="0c82e-201">**Performance Counters**: open perfmon and check the counter.</span></span>
- <span data-ttu-id="0c82e-202">**追蹤記錄檔**：從遠端桌面連接到 VM，並將 TextWriterTraceListener 新增至應用程式的組態檔。</span><span class="sxs-lookup"><span data-stu-id="0c82e-202">**Trace Logs**:  Remote desktop into the VM and add a TextWriterTraceListener to the app’s config file.</span></span>  <span data-ttu-id="0c82e-203">請參閱 http://msdn.microsoft.com/library/sk36c28t.aspx 設定文字接聽程式。</span><span class="sxs-lookup"><span data-stu-id="0c82e-203">See http://msdn.microsoft.com/library/sk36c28t.aspx to set up the text listener.</span></span>  <span data-ttu-id="0c82e-204">確定 `<trace>` 元素具有 `<trace autoflush="true">`。</span><span class="sxs-lookup"><span data-stu-id="0c82e-204">Make sure the `<trace>` element has `<trace autoflush="true">`.</span></span><br />
<span data-ttu-id="0c82e-205">如果您沒有看到系統正在產生追蹤記錄檔，請依照[關於遺漏追蹤記錄檔的詳細資訊](#more-about-trace-logs-missing)中的說明進行作業。</span><span class="sxs-lookup"><span data-stu-id="0c82e-205">If you don't see trace logs getting generated, follow [More About Trace Logs Missing](#more-about-trace-logs-missing).</span></span>
- <span data-ttu-id="0c82e-206">**ETW 追蹤**：從遠端桌面連接到 VM 並安裝 PerfView。</span><span class="sxs-lookup"><span data-stu-id="0c82e-206">**ETW traces**: Remote desktop into the VM and install PerfView.</span></span>  <span data-ttu-id="0c82e-207">在 PerfView 中執行 [File] \(檔案\) -> [User Command] \(使用者命令\) -> Listen etwprovder1,etwprovider2,etc。請注意，Listen 命令區分大小寫，而且在 ETW 提供者清單中，以逗號區隔的 ETW 提供者之間不能有空格。</span><span class="sxs-lookup"><span data-stu-id="0c82e-207">In PerfView run File -> User Command -> Listen etwprovder1, etwprovider2, etc.  Note that the Listen command is case-sensitive and there cannot be spaces between the comma-separated list of ETW providers.</span></span>  <span data-ttu-id="0c82e-208">如果命令執行失敗，您可以按一下 Perfview 工具右下方的 [Log] \(記錄\) 按鈕，即可查看已嘗試執行哪些動作與執行結果。</span><span class="sxs-lookup"><span data-stu-id="0c82e-208">If the command fails to run, you can click the 'Log' button in the bottom-right of the Perfview tool to see what was attempted to run and what the result was.</span></span>  <span data-ttu-id="0c82e-209">假設輸入正確，就會顯示一個新的視窗，並且您會在幾秒鐘內開始看到 ETW 追蹤。</span><span class="sxs-lookup"><span data-stu-id="0c82e-209">Assuming the input is correct then a new window will pop up and in a few seconds you will begin seeing ETW traces.</span></span>
- <span data-ttu-id="0c82e-210">**事件記錄檔**：從遠端桌面連接到 VM。</span><span class="sxs-lookup"><span data-stu-id="0c82e-210">**Event Logs**: Remote desktop into the VM.</span></span> <span data-ttu-id="0c82e-211">開啟 `Event Viewer` 並確認事件存在。</span><span class="sxs-lookup"><span data-stu-id="0c82e-211">Open `Event Viewer` and ensure the events exist.</span></span>
#### <a name="is-data-getting-captured-locally"></a><span data-ttu-id="0c82e-212">是否正在本機擷取資料：</span><span class="sxs-lookup"><span data-stu-id="0c82e-212">Is data getting captured locally:</span></span>
<span data-ttu-id="0c82e-213">接下來請確定正在本機擷取資料。</span><span class="sxs-lookup"><span data-stu-id="0c82e-213">Next make sure the data is getting captured locally.</span></span>
<span data-ttu-id="0c82e-214">資料儲存在[診斷資料的本機存放區](#log-artifacts-path)的本機 `*.tsf` 檔案中。</span><span class="sxs-lookup"><span data-stu-id="0c82e-214">The data is locally stored in `*.tsf` files in [the local store for diagnostics data](#log-artifacts-path).</span></span> <span data-ttu-id="0c82e-215">不同的 `.tsf` 檔案會收集不同類型的記錄。</span><span class="sxs-lookup"><span data-stu-id="0c82e-215">Different kinds of logs get collected in different `.tsf` files.</span></span> <span data-ttu-id="0c82e-216">名稱類似於 Azure 儲存體中的資料表名稱。</span><span class="sxs-lookup"><span data-stu-id="0c82e-216">The names are similar to the table names in azure storage.</span></span> <span data-ttu-id="0c82e-217">例如，`PerformanceCountersTable.tsf`中會收集 `Performance Counters`，`WindowsEventLogsTable.tsf` 中會收集事件記錄檔。</span><span class="sxs-lookup"><span data-stu-id="0c82e-217">For example `Performance Counters` get collected in `PerformanceCountersTable.tsf`, Event Logs get collected in `WindowsEventLogsTable.tsf`.</span></span> <span data-ttu-id="0c82e-218">請使用[本機記錄檔擷取](#local-log-extraction)一節中的指示開啟本機收集檔案，並確定您看到系統在磁碟上收集那些檔案。</span><span class="sxs-lookup"><span data-stu-id="0c82e-218">Use the instructions in [Local Log Extraction](#local-log-extraction) section to open the local collection files and make sure you see them getting collected on disk.</span></span>

<span data-ttu-id="0c82e-219">如果您沒有看到系統在本機收集記錄，且已經確認主機正在產生資料，可能是設定有問題。</span><span class="sxs-lookup"><span data-stu-id="0c82e-219">If you don't see logs getting collected locally and have already verified that the host is generating data, you likely have a configuration issue.</span></span> <span data-ttu-id="0c82e-220">請仔細檢閱適當區段的設定。</span><span class="sxs-lookup"><span data-stu-id="0c82e-220">Review your configuration carefully for the appropriate section.</span></span> <span data-ttu-id="0c82e-221">請一併檢閱針對 MonitoringAgent [MaConfig.xml](#log-artifacts-path) 產生的設定，並確定有描述相關記錄來源的部分區段，以及在 Azure 診斷組態和監視代理程式組態之間轉譯時，沒有造成遺失。</span><span class="sxs-lookup"><span data-stu-id="0c82e-221">Also review the configuration generated for MonitoringAgent [MaConfig.xml](#log-artifacts-path) and make sure there is some section describing the relevant log source and that it is not lost in translation between azure diagnostics configuration and monitoring agent configuration.</span></span>
#### <a name="is-data-getting-transferred"></a><span data-ttu-id="0c82e-222">是否正在傳輸資料：</span><span class="sxs-lookup"><span data-stu-id="0c82e-222">Is data getting transferred:</span></span>
<span data-ttu-id="0c82e-223">如果您已經確認正在本機擷取資料，但仍然沒有在儲存體帳戶中看到資料：</span><span class="sxs-lookup"><span data-stu-id="0c82e-223">If you have verified the data is getting captured locally but you still don't see it in your storage account:</span></span> 
- <span data-ttu-id="0c82e-224">首先且最重要的是，請確定您已經提供正確的儲存體帳戶，且您未變換所提供儲存體帳戶的金鑰等項目。</span><span class="sxs-lookup"><span data-stu-id="0c82e-224">First and foremost, make sure that you have provided a correct storage account and that you have not rolled over keys etc.for the given storage account.</span></span> <span data-ttu-id="0c82e-225">針對雲端服務，我們發現使用者有時候並未更新他們的 `useDevelopmentStorage=true`。</span><span class="sxs-lookup"><span data-stu-id="0c82e-225">For cloud services, sometimes we see that people don't update their `useDevelopmentStorage=true`.</span></span>
- <span data-ttu-id="0c82e-226">如果提供的儲存體帳戶正確。</span><span class="sxs-lookup"><span data-stu-id="0c82e-226">If provided storage account is correct.</span></span> <span data-ttu-id="0c82e-227">請確定您的網路沒有受到不允許元件連線公用儲存體端點的限制。</span><span class="sxs-lookup"><span data-stu-id="0c82e-227">Make sure you do not have some network restrictions that do not allow the components to reach public storage endpoints.</span></span> <span data-ttu-id="0c82e-228">那樣做的其中一個方法是從遠端桌面連接到電腦，然後嘗試自行將一些內容寫入到相同的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="0c82e-228">One way to do that is to remote desktop into the machine and try to write something to the same storage account yourself.</span></span>
- <span data-ttu-id="0c82e-229">最後，您可以嘗試及查看監視代理程式報告了哪些失敗項目。</span><span class="sxs-lookup"><span data-stu-id="0c82e-229">Finally, you can try and see what failure are being reported by Monitoring Agent.</span></span> <span data-ttu-id="0c82e-230">監視代理程式會將其記錄檔寫入位於[診斷資料的本機存放區](#log-artifacts-path)的 `maeventtable.tsf` 中。</span><span class="sxs-lookup"><span data-stu-id="0c82e-230">Monitoring agent writes its logs in `maeventtable.tsf` located in [the local store for diagnostics data](#log-artifacts-path).</span></span> <span data-ttu-id="0c82e-231">請依照[本機記錄檔擷取](#local-log-extraction)一節中的指示開啟此檔案，然後嘗試找出是否有指出讀取本機檔案或寫入儲存體失敗的 `errors`。</span><span class="sxs-lookup"><span data-stu-id="0c82e-231">Follow instructions in [Local Log Extraction](#local-log-extraction) section to open this file and try and figure out if there are `errors` indicating failures to read local files or write to storage.</span></span>

### <a name="capturing--archiving-logs"></a><span data-ttu-id="0c82e-232">擷取/封存記錄檔</span><span class="sxs-lookup"><span data-stu-id="0c82e-232">Capturing / Archiving logs</span></span>
<span data-ttu-id="0c82e-233">您依序執行了上述步驟，但無法找出問題所在，因此正在考慮連絡支援人員。</span><span class="sxs-lookup"><span data-stu-id="0c82e-233">You went through the above steps but could not figure out what was wrong and are thinking about contacting support.</span></span> <span data-ttu-id="0c82e-234">他們可能會要求您做的第一件事是收集電腦的記錄。</span><span class="sxs-lookup"><span data-stu-id="0c82e-234">The first thing they might ask you is to collect logs from your machine.</span></span> <span data-ttu-id="0c82e-235">您可以先自行執行該作業以節省時間。</span><span class="sxs-lookup"><span data-stu-id="0c82e-235">You can save time by doing that yourself.</span></span> <span data-ttu-id="0c82e-236">請執行位於[記錄集合公用程式路徑](#log-artifacts-path)的 `CollectGuestLogs.exe` 公用程式，它將會產生一個在同一資料夾中包含所有相關 Azure 記錄的壓縮檔。</span><span class="sxs-lookup"><span data-stu-id="0c82e-236">Run the `CollectGuestLogs.exe` utility at  [Log Collection Utility path](#log-artifacts-path) and it generates a zip file with all relevant azure logs in the same folder.</span></span>

## <a name="diagnostics-data-tables-not-found"></a><span data-ttu-id="0c82e-237">找不到診斷資料資料表</span><span class="sxs-lookup"><span data-stu-id="0c82e-237">Diagnostics data Tables not found</span></span>
<span data-ttu-id="0c82e-238">Azure 儲存體中的資料表保存了使用以下代碼命名的 ETW 事件：</span><span class="sxs-lookup"><span data-stu-id="0c82e-238">The tables in Azure storage holding ETW events are named using the following code:</span></span>

```C#
        if (String.IsNullOrEmpty(eventDestination)) {
            if (e == "DefaultEvents")
                tableName = "WADDefault" + MD5(provider);
            else
                tableName = "WADEvent" + MD5(provider) + eventId;
        }
        else
            tableName = "WAD" + eventDestination;
```

<span data-ttu-id="0c82e-239">下列是一個範例：</span><span class="sxs-lookup"><span data-stu-id="0c82e-239">Here is an example:</span></span>

```XML
        <EtwEventSourceProviderConfiguration provider="prov1">
          <Event id="1" />
          <Event id="2" eventDestination="dest1" />
          <DefaultEvents />
        </EtwEventSourceProviderConfiguration>
        <EtwEventSourceProviderConfiguration provider="prov2">
          <DefaultEvents eventDestination="dest2" />
        </EtwEventSourceProviderConfiguration>
```
```JSON
"EtwEventSourceProviderConfiguration": [
    {
        "provider": "prov1",
        "Event": [
            {
                "id": 1
            },
            {
                "id": 2,
                "eventDestination": "dest1"
            }
        ],
        "DefaultEvents": {
            "eventDestination": "DefaultEventDestination",
            "sinks": ""
        }
    },
    {
        "provider": "prov2",
        "DefaultEvents": {
            "eventDestination": "dest2"
        }
    }
]
```
<span data-ttu-id="0c82e-240">產生的 4 個資料表如下︰</span><span class="sxs-lookup"><span data-stu-id="0c82e-240">That generates 4 tables:</span></span>

| <span data-ttu-id="0c82e-241">Event</span><span class="sxs-lookup"><span data-stu-id="0c82e-241">Event</span></span> | <span data-ttu-id="0c82e-242">資料表名稱</span><span class="sxs-lookup"><span data-stu-id="0c82e-242">Table Name</span></span> |
| --- | --- |
| <span data-ttu-id="0c82e-243">provider=”prov1” &lt;Event id=”1” /&gt;</span><span class="sxs-lookup"><span data-stu-id="0c82e-243">provider=”prov1” &lt;Event id=”1” /&gt;</span></span> |<span data-ttu-id="0c82e-244">WADEvent+MD5(“prov1”)+”1”</span><span class="sxs-lookup"><span data-stu-id="0c82e-244">WADEvent+MD5(“prov1”)+”1”</span></span> |
| <span data-ttu-id="0c82e-245">provider=”prov1” &lt;Event id=”2” eventDestination=”dest1” /&gt;</span><span class="sxs-lookup"><span data-stu-id="0c82e-245">provider=”prov1” &lt;Event id=”2” eventDestination=”dest1” /&gt;</span></span> |<span data-ttu-id="0c82e-246">WADdest1</span><span class="sxs-lookup"><span data-stu-id="0c82e-246">WADdest1</span></span> |
| <span data-ttu-id="0c82e-247">provider=”prov1” &lt;DefaultEvents /&gt;</span><span class="sxs-lookup"><span data-stu-id="0c82e-247">provider=”prov1” &lt;DefaultEvents /&gt;</span></span> |<span data-ttu-id="0c82e-248">WADDefault+MD5(“prov1”)</span><span class="sxs-lookup"><span data-stu-id="0c82e-248">WADDefault+MD5(“prov1”)</span></span> |
| <span data-ttu-id="0c82e-249">provider=”prov2” &lt;DefaultEvents eventDestination=”dest2” /&gt;</span><span class="sxs-lookup"><span data-stu-id="0c82e-249">provider=”prov2” &lt;DefaultEvents eventDestination=”dest2” /&gt;</span></span> |<span data-ttu-id="0c82e-250">WADdest2</span><span class="sxs-lookup"><span data-stu-id="0c82e-250">WADdest2</span></span> |

## <a name="references"></a><span data-ttu-id="0c82e-251">參考</span><span class="sxs-lookup"><span data-stu-id="0c82e-251">References</span></span>

### <a name="how-to-check-diagnostics-extension-configuration"></a><span data-ttu-id="0c82e-252">如何檢查診斷延伸模組組態</span><span class="sxs-lookup"><span data-stu-id="0c82e-252">How to check Diagnostics Extension Configuration</span></span>
<span data-ttu-id="0c82e-253">檢查延伸模組組態最容易的方式是，瀏覽至 http://resources.azure.com，接著瀏覽至 Azure 診斷擴充功能 (IaaSDiagnostics / PaaDiagnostics) 有問題的虛擬機器或雲端服務。</span><span class="sxs-lookup"><span data-stu-id="0c82e-253">The easiest way to check your extension configuration is to navigate to http://resources.azure.com, navigate to the virtual machine or cloud service on which the Azure Diagnostics extension (IaaSDiagnostics / PaaDiagnostics) is in question.</span></span>

<span data-ttu-id="0c82e-254">或者，從遠端桌面連接到電腦，然後查看[這裡](#log-artifacts-path)的適當小節中描述的 Azure 診斷組態檔。</span><span class="sxs-lookup"><span data-stu-id="0c82e-254">Alternatively, remote desktop into the machine and look at the Azure Diagnostics Configuration file described in the appropriate section [here](#log-artifacts-path).</span></span>

<span data-ttu-id="0c82e-255">在任一情況下，都可以搜尋 **Microsoft.Azure.Diagnostics**，然後搜尋 **xmlCfg** 或 **WadCfg** 欄位。</span><span class="sxs-lookup"><span data-stu-id="0c82e-255">In either case search for **Microsoft.Azure.Diagnostics** then for the **xmlCfg** or **WadCfg** field.</span></span> 

<span data-ttu-id="0c82e-256">在使用虛擬機器的情況下，如果出現 WadCfg 欄位，表示組態在 JSON 中。</span><span class="sxs-lookup"><span data-stu-id="0c82e-256">In case of virtual machines, if the WadCfg field is present, it means the config is in JSON.</span></span> <span data-ttu-id="0c82e-257">如果出現 xmlCfg 欄位，表示組態在 XML 中且以 base64 編碼。</span><span class="sxs-lookup"><span data-stu-id="0c82e-257">If the xmlCfg field is present, it means the config is in XML and is base64 encoded.</span></span> <span data-ttu-id="0c82e-258">您必須將它[解碼](http://www.bing.com/search?q=base64+decoder)，才能查看診斷載入的 XML。</span><span class="sxs-lookup"><span data-stu-id="0c82e-258">You need to [decode it](http://www.bing.com/search?q=base64+decoder) to see the XML that was loaded by Diagnostics.</span></span>

<span data-ttu-id="0c82e-259">針對雲端服務角色，如果是從磁碟挑選設定，該資料會以 base64 編碼，因此需要[將它解碼](http://www.bing.com/search?q=base64+decoder)，才能查看診斷載入的 XML。</span><span class="sxs-lookup"><span data-stu-id="0c82e-259">For Cloud Service role, if you pick the configuration from disk, the data is base64 encoded so you’ll need to [decode it](http://www.bing.com/search?q=base64+decoder) to see the XML that was loaded by Diagnostics.</span></span>

### <a name="azure-diagnostics-plugin-exit-codes"></a><span data-ttu-id="0c82e-260">Azure 診斷外掛程式結束代碼</span><span class="sxs-lookup"><span data-stu-id="0c82e-260">Azure Diagnostics Plugin Exit Codes</span></span>
<span data-ttu-id="0c82e-261">外掛程式會傳回下列結束代碼：</span><span class="sxs-lookup"><span data-stu-id="0c82e-261">The plugin returns the following exit codes:</span></span>

| <span data-ttu-id="0c82e-262">結束代碼</span><span class="sxs-lookup"><span data-stu-id="0c82e-262">Exit Code</span></span> | <span data-ttu-id="0c82e-263">說明</span><span class="sxs-lookup"><span data-stu-id="0c82e-263">Description</span></span> |
| --- | --- |
| <span data-ttu-id="0c82e-264">0</span><span class="sxs-lookup"><span data-stu-id="0c82e-264">0</span></span> |<span data-ttu-id="0c82e-265">成功。</span><span class="sxs-lookup"><span data-stu-id="0c82e-265">Success.</span></span> |
| <span data-ttu-id="0c82e-266">-1</span><span class="sxs-lookup"><span data-stu-id="0c82e-266">-1</span></span> |<span data-ttu-id="0c82e-267">一般錯誤。</span><span class="sxs-lookup"><span data-stu-id="0c82e-267">Generic Error.</span></span> |
| <span data-ttu-id="0c82e-268">-2</span><span class="sxs-lookup"><span data-stu-id="0c82e-268">-2</span></span> |<span data-ttu-id="0c82e-269">無法載入 rcf 檔。</span><span class="sxs-lookup"><span data-stu-id="0c82e-269">Unable to load the rcf file.</span></span><p><span data-ttu-id="0c82e-270">此內部錯誤應只有當不正確地在 VM 上以手動方式叫用客體代理程式外掛程式啟動器時才會發生。</span><span class="sxs-lookup"><span data-stu-id="0c82e-270">This internal error should only happen if the guest agent plugin launcher is manually invoked, incorrectly, on the VM.</span></span> |
| <span data-ttu-id="0c82e-271">-3</span><span class="sxs-lookup"><span data-stu-id="0c82e-271">-3</span></span> |<span data-ttu-id="0c82e-272">無法載入診斷組態檔。</span><span class="sxs-lookup"><span data-stu-id="0c82e-272">Cannot load the Diagnostics configuration file.</span></span><p><p><span data-ttu-id="0c82e-273">解決方法：因組態檔未通過結構描述驗證而造成。</span><span class="sxs-lookup"><span data-stu-id="0c82e-273">Solution: Caused by a configuration file not passing schema validation.</span></span> <span data-ttu-id="0c82e-274">解決方法是提供以結構描述編譯的組態檔。</span><span class="sxs-lookup"><span data-stu-id="0c82e-274">The solution is to provide a configuration file that complies with the schema.</span></span> |
| <span data-ttu-id="0c82e-275">-4</span><span class="sxs-lookup"><span data-stu-id="0c82e-275">-4</span></span> |<span data-ttu-id="0c82e-276">診斷之監視代理程式的另一個執行個體已在使用本機資源目錄。</span><span class="sxs-lookup"><span data-stu-id="0c82e-276">Another instance of the monitoring agent Diagnostics is already using the local resource directory.</span></span><p><p><span data-ttu-id="0c82e-277">解決方法：為 **LocalResourceDirectory** 指定其他值。</span><span class="sxs-lookup"><span data-stu-id="0c82e-277">Solution: Specify a different value for **LocalResourceDirectory**.</span></span> |
| <span data-ttu-id="0c82e-278">-6</span><span class="sxs-lookup"><span data-stu-id="0c82e-278">-6</span></span> |<span data-ttu-id="0c82e-279">客體代理程式外掛程式啟動器嘗試使用無效的命令列來啟動診斷。</span><span class="sxs-lookup"><span data-stu-id="0c82e-279">The guest agent plugin launcher attempted to launch Diagnostics with an invalid command line.</span></span><p><p><span data-ttu-id="0c82e-280">此內部錯誤應只有當不正確地在 VM 上以手動方式叫用客體代理程式外掛程式啟動器時才會發生。</span><span class="sxs-lookup"><span data-stu-id="0c82e-280">This internal error should only happen if the guest agent plugin launcher is manually invoked, incorrectly, on the VM.</span></span> |
| <span data-ttu-id="0c82e-281">-10</span><span class="sxs-lookup"><span data-stu-id="0c82e-281">-10</span></span> |<span data-ttu-id="0c82e-282">診斷外掛程式結束並發生未處理的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="0c82e-282">The Diagnostics plugin exited with an unhandled exception.</span></span> |
| <span data-ttu-id="0c82e-283">-11</span><span class="sxs-lookup"><span data-stu-id="0c82e-283">-11</span></span> |<span data-ttu-id="0c82e-284">客體代理程式無法建立負責啟動及監視監視代理程式的處理序。</span><span class="sxs-lookup"><span data-stu-id="0c82e-284">The guest agent was unable to create the process responsible for launching and monitoring the monitoring agent.</span></span><p><p><span data-ttu-id="0c82e-285">解決方法：確認有足夠的系統資源，可啟動新的處理序。</span><span class="sxs-lookup"><span data-stu-id="0c82e-285">Solution: Verify that sufficient system resources are available to launch new processes.</span></span><p> |
| <span data-ttu-id="0c82e-286">-101</span><span class="sxs-lookup"><span data-stu-id="0c82e-286">-101</span></span> |<span data-ttu-id="0c82e-287">呼叫診斷外掛程式時的引數無效。</span><span class="sxs-lookup"><span data-stu-id="0c82e-287">Invalid arguments when calling the Diagnostics plugin.</span></span><p><p><span data-ttu-id="0c82e-288">此內部錯誤應只有當不正確地在 VM 上以手動方式叫用客體代理程式外掛程式啟動器時才會發生。</span><span class="sxs-lookup"><span data-stu-id="0c82e-288">This internal error should only happen if the guest agent plugin launcher is manually invoked, incorrectly, on the VM.</span></span> |
| <span data-ttu-id="0c82e-289">-102</span><span class="sxs-lookup"><span data-stu-id="0c82e-289">-102</span></span> |<span data-ttu-id="0c82e-290">外掛程式處理序無法對本身進行初始化。</span><span class="sxs-lookup"><span data-stu-id="0c82e-290">The plugin process is unable to initialize itself.</span></span><p><p><span data-ttu-id="0c82e-291">解決方法：確認有足夠的系統資源，可啟動新的處理序。</span><span class="sxs-lookup"><span data-stu-id="0c82e-291">Solution: Verify that sufficient system resources are available to launch new processes.</span></span> |
| <span data-ttu-id="0c82e-292">-103</span><span class="sxs-lookup"><span data-stu-id="0c82e-292">-103</span></span> |<span data-ttu-id="0c82e-293">外掛程式處理序無法對本身進行初始化。</span><span class="sxs-lookup"><span data-stu-id="0c82e-293">The plugin process is unable to initialize itself.</span></span> <span data-ttu-id="0c82e-294">具體而言，其無法建立記錄器物件。</span><span class="sxs-lookup"><span data-stu-id="0c82e-294">Specifically it is unable to create the logger object.</span></span><p><p><span data-ttu-id="0c82e-295">解決方法：確認有足夠的系統資源，可啟動新的處理序。</span><span class="sxs-lookup"><span data-stu-id="0c82e-295">Solution: Verify that sufficient system resources are available to launch new processes.</span></span> |
| <span data-ttu-id="0c82e-296">-104</span><span class="sxs-lookup"><span data-stu-id="0c82e-296">-104</span></span> |<span data-ttu-id="0c82e-297">無法載入客體代理程式提供的 rcf 檔。</span><span class="sxs-lookup"><span data-stu-id="0c82e-297">Unable to load the rcf file provided by the guest agent.</span></span><p><p><span data-ttu-id="0c82e-298">此內部錯誤應只有當不正確地在 VM 上以手動方式叫用客體代理程式外掛程式啟動器時才會發生。</span><span class="sxs-lookup"><span data-stu-id="0c82e-298">This internal error should only happen if the guest agent plugin launcher is manually invoked, incorrectly, on the VM.</span></span> |
| <span data-ttu-id="0c82e-299">-105</span><span class="sxs-lookup"><span data-stu-id="0c82e-299">-105</span></span> |<span data-ttu-id="0c82e-300">診斷外掛程式無法開啟診斷組態檔。</span><span class="sxs-lookup"><span data-stu-id="0c82e-300">The Diagnostics plugin cannot open the Diagnostics configuration file.</span></span><p><p><span data-ttu-id="0c82e-301">此內部錯誤應只有當不正確地在 VM 上以手動方式叫用診斷外掛程式時才會發生。</span><span class="sxs-lookup"><span data-stu-id="0c82e-301">This internal error should only happen if the Diagnostics plugin is manually invoked, incorrectly, on the VM.</span></span> |
| <span data-ttu-id="0c82e-302">-106</span><span class="sxs-lookup"><span data-stu-id="0c82e-302">-106</span></span> |<span data-ttu-id="0c82e-303">無法讀取診斷組態檔。</span><span class="sxs-lookup"><span data-stu-id="0c82e-303">Cannot read the Diagnostics configuration file.</span></span><p><p><span data-ttu-id="0c82e-304">解決方法：因組態檔未通過結構描述驗證而造成。</span><span class="sxs-lookup"><span data-stu-id="0c82e-304">Solution: Caused by a configuration file not passing schema validation.</span></span> <span data-ttu-id="0c82e-305">因此，解決方法是提供以結構描述編譯的組態檔。</span><span class="sxs-lookup"><span data-stu-id="0c82e-305">So the solution is to provide a configuration file that complies with the schema.</span></span> <span data-ttu-id="0c82e-306">請參閱[如何檢查診斷延伸模組組態](#how-to-check-diagnostics-extension-configuration)。</span><span class="sxs-lookup"><span data-stu-id="0c82e-306">See [How to check Diagnostics Extension Configuration](#how-to-check-diagnostics-extension-configuration).</span></span> |
| <span data-ttu-id="0c82e-307">-107</span><span class="sxs-lookup"><span data-stu-id="0c82e-307">-107</span></span> |<span data-ttu-id="0c82e-308">傳遞給監視代理程式的資源目錄無效。</span><span class="sxs-lookup"><span data-stu-id="0c82e-308">The resource directory pass to the monitoring agent is invalid.</span></span><p><p><span data-ttu-id="0c82e-309">此內部錯誤應只有當不正確地在 VM 上以手動方式叫用監視代理程式時才會發生。</span><span class="sxs-lookup"><span data-stu-id="0c82e-309">This internal error should only happen if the monitoring agent is manually invoked, incorrectly, on the VM.</span></span></p> |
| <span data-ttu-id="0c82e-310">-108</span><span class="sxs-lookup"><span data-stu-id="0c82e-310">-108</span></span> |<span data-ttu-id="0c82e-311">無法將診斷組態檔轉換成監視代理程式組態檔。</span><span class="sxs-lookup"><span data-stu-id="0c82e-311">Unable to convert the Diagnostics configuration file into the monitoring agent configuration file.</span></span><p><p><span data-ttu-id="0c82e-312">此內部錯誤應只有當使用無效的組態檔以手動方式叫用診斷外掛程式時才會發生。</span><span class="sxs-lookup"><span data-stu-id="0c82e-312">This internal error should only happen if the Diagnostics plugin is manually invoked with an invalid configuration file.</span></span> |
| <span data-ttu-id="0c82e-313">-110</span><span class="sxs-lookup"><span data-stu-id="0c82e-313">-110</span></span> |<span data-ttu-id="0c82e-314">一般診斷組態錯誤。</span><span class="sxs-lookup"><span data-stu-id="0c82e-314">General Diagnostics configuration error.</span></span><p><p><span data-ttu-id="0c82e-315">此內部錯誤應只有當使用無效的組態檔以手動方式叫用診斷外掛程式時才會發生。</span><span class="sxs-lookup"><span data-stu-id="0c82e-315">This internal error should only happen if the Diagnostics plugin is manually invoked with an invalid configuration file.</span></span> |
| <span data-ttu-id="0c82e-316">-111</span><span class="sxs-lookup"><span data-stu-id="0c82e-316">-111</span></span> |<span data-ttu-id="0c82e-317">無法啟動監視代理程式。</span><span class="sxs-lookup"><span data-stu-id="0c82e-317">Unable to start the monitoring agent.</span></span><p><p><span data-ttu-id="0c82e-318">解決方法：確認有足夠的系統資源可用。</span><span class="sxs-lookup"><span data-stu-id="0c82e-318">Solution: Verify that sufficient system resources are available.</span></span> |
| <span data-ttu-id="0c82e-319">-112</span><span class="sxs-lookup"><span data-stu-id="0c82e-319">-112</span></span> |<span data-ttu-id="0c82e-320">一般錯誤</span><span class="sxs-lookup"><span data-stu-id="0c82e-320">General error</span></span> |

### <a name="local-log-extraction"></a><span data-ttu-id="0c82e-321">本機記錄檔擷取</span><span class="sxs-lookup"><span data-stu-id="0c82e-321">Local Log Extraction</span></span>
<span data-ttu-id="0c82e-322">監視代理程式會以 `.tsf` 檔案的方式收集記錄和構件。</span><span class="sxs-lookup"><span data-stu-id="0c82e-322">The monitoring agent collects logs and artifacts as `.tsf` files.</span></span> <span data-ttu-id="0c82e-323">您無法讀取 `.tsf` 檔案，但可以將它轉換成 `.csv`，如下所示：</span><span class="sxs-lookup"><span data-stu-id="0c82e-323">`.tsf` file is not readable but you can convert it into a `.csv` as follows:</span></span> 

```
<Azure diagnostics extension package>\Monitor\x64\table2csv.exe <relevantLogFile>.tsf
```
<span data-ttu-id="0c82e-324">將會在同一路徑中建立一個名為 `<relevantLogFile>.csv` 的新檔案，作為相對應的 `.tsf` 檔案。</span><span class="sxs-lookup"><span data-stu-id="0c82e-324">A new file called `<relevantLogFile>.csv` will be created in the same path as the corresponding `.tsf` file.</span></span>

<span data-ttu-id="0c82e-325">**注意**：您只需要針對主要的 tsf 檔案 (例如 PerformanceCountersTable.tsf) 執行此公用程式。</span><span class="sxs-lookup"><span data-stu-id="0c82e-325">**NOTE**: You only need to run this utility against the main tsf file (e.g., PerformanceCountersTable.tsf).</span></span> <span data-ttu-id="0c82e-326">系統會自動處理隨附的檔案 (例如，PerformanceCountersTables_\*\*001.tsf、PerformanceCountersTables_\*\*002.tsf 等等)。</span><span class="sxs-lookup"><span data-stu-id="0c82e-326">The accompanying files (e.g., PerformanceCountersTables_\*\*001.tsf, PerformanceCountersTables_\*\*002.tsf etc.) will automatically be processed.</span></span>

### <a name="more-about-trace-logs-missing"></a><span data-ttu-id="0c82e-327">關於遺漏追蹤記錄檔的詳細資訊</span><span class="sxs-lookup"><span data-stu-id="0c82e-327">More About Trace Logs Missing</span></span>

<span data-ttu-id="0c82e-328">**注意：**除非您已經在於 IaaS VM 中執行的應用程式上設定 DiagnosticsMonitorTraceListener，否則這幾乎僅適用於雲端服務。</span><span class="sxs-lookup"><span data-stu-id="0c82e-328">**Note:** This mostly applies to cloud services only unless you have configured the DiagnosticsMonitorTraceListener on an application running on your IaaS VM.</span></span> 

- <span data-ttu-id="0c82e-329">請確定已在 web.config 或 app.config 中設定 DiagnosticMonitorTraceListener。雲端服務專案中會預設設定這個項目，但某些客戶認為這會導致診斷不會收集追蹤陳述式。</span><span class="sxs-lookup"><span data-stu-id="0c82e-329">Make sure the DiagnosticMonitorTraceListener is configured in the web.config or app.config.  This is configured by default in cloud service projects, but some customers comment it out which will cause the trace statements to not be collected by diagnostics.</span></span> 
- <span data-ttu-id="0c82e-330">如果未從 OnStart 或 Run 方法寫入記錄檔，請確定 app.config 中有 DiagnosticMonitorTraceListener。依照預設，它是位於 web.config 之中，但那僅適用於在 w3wp.exe 內執行的程式碼；所以您需要它位於 app.config 中，才能擷取在 WaIISHost.exe 中執行的追蹤。</span><span class="sxs-lookup"><span data-stu-id="0c82e-330">If logs are not getting written from the OnStart or Run method make sure the DiagnosticMonitorTraceListener is in the app.config.  By default it is in the web.config, but that only applies to code running within w3wp.exe; so you need it in app.config to capture traces running in WaIISHost.exe.</span></span>
- <span data-ttu-id="0c82e-331">請確定您使用的是 Diagnostics.Trace.TraceXXX，而不是 Diagnostics.Debug.WriteXXX。</span><span class="sxs-lookup"><span data-stu-id="0c82e-331">Make sure you are using Diagnostics.Trace.TraceXXX instead of Diagnostics.Debug.WriteXXX.</span></span>  <span data-ttu-id="0c82e-332">偵錯陳述式將從發行組建中移除。</span><span class="sxs-lookup"><span data-stu-id="0c82e-332">The Debug statements will be removed from a Release build.</span></span>
- <span data-ttu-id="0c82e-333">請確定已編譯的程式碼確實具有 Diagnostics.Trace 行 (使用 Reflector、ildasm 或 ILSpy 來驗證)。</span><span class="sxs-lookup"><span data-stu-id="0c82e-333">Make sure the compiled code actually has the Diagnostics.Trace lines (use Reflector, ildasm or ILSpy to verify).</span></span>  <span data-ttu-id="0c82e-334">Diagnostics.Trace 命令已從編譯的二進位檔中移除，除非您使用 TRACE 條件式編譯的符號。</span><span class="sxs-lookup"><span data-stu-id="0c82e-334">Diagnostics.Trace commands are removed from the compiled binary unless you use the TRACE conditional compilation symbol.</span></span>  <span data-ttu-id="0c82e-335">如果使用 msbuild 建置專案，這就會是一個常見的問題。</span><span class="sxs-lookup"><span data-stu-id="0c82e-335">If using msbuild to build the project then this is a common problem to run into.</span></span>

## <a name="known-issues-and-mitigations"></a><span data-ttu-id="0c82e-336">已知問題與緩解方式</span><span class="sxs-lookup"><span data-stu-id="0c82e-336">Known Issues and Mitigations</span></span>
<span data-ttu-id="0c82e-337">以下是已知問題和緩解方式的清單：</span><span class="sxs-lookup"><span data-stu-id="0c82e-337">Here is a list of known issues with known mitigations:</span></span>

<span data-ttu-id="0c82e-338">**1. .NET 4.5 相依性：**</span><span class="sxs-lookup"><span data-stu-id="0c82e-338">**1. .NET 4.5 dependency:**</span></span>

<span data-ttu-id="0c82e-339">WAD 在 .NET 4.5 Framework 或更新版本上具有執行階段相依性。</span><span class="sxs-lookup"><span data-stu-id="0c82e-339">WAD has a runtime dependency on .NET 4.5 framework or above.</span></span> <span data-ttu-id="0c82e-340">在撰寫這部分的內容時，所有針對雲端服務佈建的電腦，以及所有官方 Azure 虛擬機器基本映像，都已安裝 .NET 4.5 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="0c82e-340">At the time of writing this, all machines provisioned for cloud services as well as all official azure Virtual Machine base images have .NET 4.5 or above installed.</span></span> <span data-ttu-id="0c82e-341">但是，仍可能會發生您嘗試在沒有安裝 .NET 4.5 或更新版本的電腦上執行 WAD 的情況。</span><span class="sxs-lookup"><span data-stu-id="0c82e-341">It is still however possible to land in a situation where you try to run WAD on a machine which does not have .NET 4.5 or above.</span></span> <span data-ttu-id="0c82e-342">當您從舊映像或快照集建立電腦，或攜帶自己的自訂磁碟時，就可能會發生這個問題。</span><span class="sxs-lookup"><span data-stu-id="0c82e-342">This happens when you create your machine off of an old image or snapshot; or bring your own custom disk.</span></span>

<span data-ttu-id="0c82e-343">執行 DiagnosticsPluginLauncher.exe 時，這通常會以結束代碼 **255** 來表示。</span><span class="sxs-lookup"><span data-stu-id="0c82e-343">This generally manifests as an exit code **255** when running DiagnosticsPluginLauncher.exe.</span></span> <span data-ttu-id="0c82e-344">失敗原因為未處理的例外狀況：</span><span class="sxs-lookup"><span data-stu-id="0c82e-344">Failure happens due to the unhandled exception:</span></span> 
```
System.IO.FileLoadException: Could not load file or assembly 'System.Threading.Tasks, Version=1.5.11.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' or one of its dependencies
```

<span data-ttu-id="0c82e-345">**緩解方式：**在電腦上安裝 .NET 4.5 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="0c82e-345">**Mitigation:** Install .NET 4.5 or higher on your machine.</span></span>

<span data-ttu-id="0c82e-346">**2.儲存體中有效能計數器資料，但入口網站中沒有顯示**</span><span class="sxs-lookup"><span data-stu-id="0c82e-346">**2. Performance Counters data available in storage but not showing in portal**</span></span>

<span data-ttu-id="0c82e-347">虛擬機器入口網站體驗預設會顯示特定效能計數器。</span><span class="sxs-lookup"><span data-stu-id="0c82e-347">Virtual machines portal experience shows certain performance counters by default.</span></span> <span data-ttu-id="0c82e-348">如果您沒有看到那些計數器，但您知道系統已經產生資料，因為儲存體中有資料。</span><span class="sxs-lookup"><span data-stu-id="0c82e-348">If you don't see them and you know the data is getting generated because it is available in storage.</span></span> <span data-ttu-id="0c82e-349">勾選：</span><span class="sxs-lookup"><span data-stu-id="0c82e-349">Check:</span></span>
- <span data-ttu-id="0c82e-350">儲存體中的資料是否具有英文計數器名稱。</span><span class="sxs-lookup"><span data-stu-id="0c82e-350">If the data in storage has counter names in English.</span></span> <span data-ttu-id="0c82e-351">如果計數器名稱不是英文，入口網站計量圖表將無法辨識該計數器。</span><span class="sxs-lookup"><span data-stu-id="0c82e-351">If the counter names are not in English, portal metric chart will not be able to recognize it.</span></span>
- <span data-ttu-id="0c82e-352">如果您在效能計數器名稱中使用萬用字元 (\*)，入口網站將無法關聯設定和收集的計數器。</span><span class="sxs-lookup"><span data-stu-id="0c82e-352">If you are using wild cards (\*) in your performance counter names, the portal will not be able to correlate the configured and collected counter.</span></span>

<span data-ttu-id="0c82e-353">**緩解方式**：針對系統帳戶，將電腦的語言變更為英文。</span><span class="sxs-lookup"><span data-stu-id="0c82e-353">**Mitigation**: Change the machine's language to English for system accounts.</span></span> <span data-ttu-id="0c82e-354">[控制台] -> [地區] -> [系統管理] -> [複製設定] -> 取消選取 [歡迎畫面及系統帳戶]，就能讓自訂語言不會套用至系統帳戶。</span><span class="sxs-lookup"><span data-stu-id="0c82e-354">Control Panel -> Region -> Administrative -> Copy Settings -> uncheck "Welcome screen and system accounts" so that the custom language is not applied to system account.</span></span> <span data-ttu-id="0c82e-355">如果想要入口網站成為主要的使用體驗網站，也請確定沒有使用萬用字元。</span><span class="sxs-lookup"><span data-stu-id="0c82e-355">Also make sure you do not use wild cards if you want portal to be your primary consumption experience.</span></span>
