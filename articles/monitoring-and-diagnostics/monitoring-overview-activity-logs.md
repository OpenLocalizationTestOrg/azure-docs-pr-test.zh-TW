---
title: "Azure 活動記錄檔概觀 | Microsoft Docs"
description: "認識 Azure 活動記錄檔，並了解如何使用它來了解您的 Azure 訂用帳戶內發生的事件。"
author: johnkemnetz
manager: orenr
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: c274782f-039d-4c28-9ddb-f89ce21052c7
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/02/2017
ms.author: johnkem
ms.openlocfilehash: 8ff9f73fc0732cd2227b7e0cc1091e04d69014eb
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/18/2017
---
# <a name="monitor-subscription-activity-with-the-azure-activity-log"></a><span data-ttu-id="99d22-103">使用 Azure 活動記錄監視訂用帳戶活動</span><span class="sxs-lookup"><span data-stu-id="99d22-103">Monitor Subscription Activity with the Azure Activity Log</span></span>
<span data-ttu-id="99d22-104">**Azure 活動記錄**是訂用帳戶記錄，可讓您深入探索 Azure 中發生的訂用帳戶層級事件。</span><span class="sxs-lookup"><span data-stu-id="99d22-104">The **Azure Activity Log** is a subscription log that provides insight into subscription-level events that have occurred in Azure.</span></span> <span data-ttu-id="99d22-105">所涵蓋的資料範圍從 Azure Resource Manager 作業資料到服務健康情況事件的更新。</span><span class="sxs-lookup"><span data-stu-id="99d22-105">This includes a range of data, from Azure Resource Manager operational data to updates on Service Health events.</span></span> <span data-ttu-id="99d22-106">活動記錄之前稱為「稽核記錄」或「作業記錄」，因為系統管理類別會報告訂用帳戶中控制層面的事件。</span><span class="sxs-lookup"><span data-stu-id="99d22-106">The Activity Log was previously known as “Audit Logs” or “Operational Logs,” since the Administrative category reports control-plane events for your subscriptions.</span></span> <span data-ttu-id="99d22-107">您可以使用活動記錄檔來判斷訂用帳戶中的資源上任何寫入作業 (PUT、POST、DELETE) 的「內容、對象和時間」。</span><span class="sxs-lookup"><span data-stu-id="99d22-107">Using the Activity Log, you can determine the ‘what, who, and when’ for any write operations (PUT, POST, DELETE) taken on the resources in your subscription.</span></span> <span data-ttu-id="99d22-108">您也可以了解作業的狀態和其他相關屬性。</span><span class="sxs-lookup"><span data-stu-id="99d22-108">You can also understand the status of the operation and other relevant properties.</span></span> <span data-ttu-id="99d22-109">活動記錄不包含讀取 (GET) 作業，或是使用傳統/"RDFE" 模型之資源的作業。</span><span class="sxs-lookup"><span data-stu-id="99d22-109">The Activity Log does not include read (GET) operations or operations for resources that use the Classic/"RDFE" model.</span></span>

![<span data-ttu-id="99d22-110">活動記錄與其他類型的記錄</span><span class="sxs-lookup"><span data-stu-id="99d22-110">Activity Logs vs other types of logs</span></span> ](./media/monitoring-overview-activity-logs/Activity_Log_vs_other_logs_v5.png)

<span data-ttu-id="99d22-111">圖 1：活動記錄與其他類型的記錄</span><span class="sxs-lookup"><span data-stu-id="99d22-111">Figure 1: Activity Logs vs other types of logs</span></span>

<span data-ttu-id="99d22-112">活動記錄不同於[診斷記錄](monitoring-overview-of-diagnostic-logs.md)。</span><span class="sxs-lookup"><span data-stu-id="99d22-112">The Activity Log differs from [Diagnostic Logs](monitoring-overview-of-diagnostic-logs.md).</span></span> <span data-ttu-id="99d22-113">活動記錄會提供有關外部資源作業的資料 (控制層面)。</span><span class="sxs-lookup"><span data-stu-id="99d22-113">Activity Logs provide data about the operations on a resource from the outside (the "control plane").</span></span> <span data-ttu-id="99d22-114">診斷記錄是由資源所發出，會提供該資源作業的相關資訊 (資料層面)。</span><span class="sxs-lookup"><span data-stu-id="99d22-114">Diagnostics Logs are emitted by a resource and provide information about the operation of that resource (the "data plane").</span></span>

<span data-ttu-id="99d22-115">您可以使用 Azure 入口網站、CLI、PowerShell Cmdlet、Azure 監視器 REST API 從活動記錄檔擷取事件。</span><span class="sxs-lookup"><span data-stu-id="99d22-115">You can retrieve events from your Activity Log using the Azure portal, CLI, PowerShell cmdlets, and Azure Monitor REST API.</span></span>


> [!WARNING]
> <span data-ttu-id="99d22-116">Azure 活動記錄主要是針對 Azure Resource Manager 中發生的活動。</span><span class="sxs-lookup"><span data-stu-id="99d22-116">The Azure Activity Log is primarily for activities that occur in Azure Resource Manager.</span></span> <span data-ttu-id="99d22-117">此記錄不會追蹤使用傳統/RDFE 模型的資源。</span><span class="sxs-lookup"><span data-stu-id="99d22-117">It does not track resources using the Classic/RDFE model.</span></span> <span data-ttu-id="99d22-118">某些傳統資源類型在 Azure Resource Manager 中有 Proxy 資源提供者 (例如，Microsoft.ClassicCompute)。</span><span class="sxs-lookup"><span data-stu-id="99d22-118">Some Classic resource types have a proxy resource provider in Azure Resource Manager (for example, Microsoft.ClassicCompute).</span></span> <span data-ttu-id="99d22-119">如果您透過使用這些 Proxy 資源提供者的 Azure Resource Manager 來與傳統資源類型互動，則作業會顯示在活動記錄。</span><span class="sxs-lookup"><span data-stu-id="99d22-119">If you interact with a Classic resource type through Azure Resource Manager using these proxy resource providers, the operations appear in the Activity Log.</span></span> <span data-ttu-id="99d22-120">如果您在傳統入口網站或 Azure Resource Manager Proxy 之外與傳統資源類型互動，則您的動作只會記錄在「作業記錄」。</span><span class="sxs-lookup"><span data-stu-id="99d22-120">If you interact with a Classic resource type in the Classic portal or otherwise outside of the Azure Resource Manager proxies, your actions are only recorded in the Operation Log.</span></span> <span data-ttu-id="99d22-121">作業記錄只能在傳統入口網站中存取。</span><span class="sxs-lookup"><span data-stu-id="99d22-121">The Operation Log is accessible only in the Classic portal.</span></span>
>
>

<span data-ttu-id="99d22-122">檢視下列簡介活動記錄的影片。</span><span class="sxs-lookup"><span data-stu-id="99d22-122">View the following video introducing the Activity Log.</span></span>
> [!VIDEO https://channel9.msdn.com/Blogs/Seth-Juarez/Logs-John-Kemnetz/player]
> 
>

## <a name="categories-in-the-activity-log"></a><span data-ttu-id="99d22-123">活動記錄中的類別</span><span class="sxs-lookup"><span data-stu-id="99d22-123">Categories in the Activity Log</span></span>
<span data-ttu-id="99d22-124">活動記錄包含數個資料類別。</span><span class="sxs-lookup"><span data-stu-id="99d22-124">The Activity Log contains several categories of data.</span></span> <span data-ttu-id="99d22-125">如需這些類別結構描述的完整詳細資料，[請參閱這篇文章](monitoring-activity-log-schema.md)。</span><span class="sxs-lookup"><span data-stu-id="99d22-125">For full details on the schemata of these categories, [see this article](monitoring-activity-log-schema.md).</span></span> <span data-ttu-id="99d22-126">其中包含：</span><span class="sxs-lookup"><span data-stu-id="99d22-126">These include:</span></span>
* <span data-ttu-id="99d22-127">**系統管理** - 透過 Resource Manager 執行的所有建立、更新、刪除和動作作業皆記錄在此類別中。</span><span class="sxs-lookup"><span data-stu-id="99d22-127">**Administrative** - This category contains the record of all create, update, delete, and action operations performed through Resource Manager.</span></span> <span data-ttu-id="99d22-128">您可能會在此類別中看到的事件類型範例包括「建立虛擬機器」和「刪除網路安全性群組」。使用者或應用程式使用 Resource Manager 所執行的每個動作，都會成為特定資源類型上的作業模型。</span><span class="sxs-lookup"><span data-stu-id="99d22-128">Examples of the types of events you would see in this category include "create virtual machine" and "delete network security group" Every action taken by a user or application using Resource Manager is modeled as an operation on a particular resource type.</span></span> <span data-ttu-id="99d22-129">如果作業類型為「寫入」、「刪除」或「動作」，則該作業的啟動及成功或失敗記錄皆會記錄在「系統管理」類別。</span><span class="sxs-lookup"><span data-stu-id="99d22-129">If the operation type is Write, Delete, or Action, the records of both the start and success or fail of that operation are recorded in the Administrative category.</span></span> <span data-ttu-id="99d22-130">「系統管理」類別也包含訂用帳戶中角色型存取控制的所有變更。</span><span class="sxs-lookup"><span data-stu-id="99d22-130">The Administrative category also includes any changes to role-based access control in a subscription.</span></span>
* <span data-ttu-id="99d22-131">**服務健康情況** - 所有在 Azure 中發生的服務健康情況事件皆記錄在此類別中。</span><span class="sxs-lookup"><span data-stu-id="99d22-131">**Service Health** - This category contains the record of any service health incidents that have occurred in Azure.</span></span> <span data-ttu-id="99d22-132">您可能會在此類別中看到的事件類型範例為「美國東部的 SQL Azure 發生停機事件」。</span><span class="sxs-lookup"><span data-stu-id="99d22-132">An example of the type of event you would see in this category is "SQL Azure in East US is experiencing downtime."</span></span> <span data-ttu-id="99d22-133">服務健康情況事件有五個種類：必要動作、協助復原、事件、維護、資訊或安全性，這些情況只會在事件可能影響訂用帳戶中的資源時顯示。</span><span class="sxs-lookup"><span data-stu-id="99d22-133">Service health events come in five varieties: Action Required, Assisted Recovery, Incident, Maintenance, Information, or Security, and only appear if you have a resource in the subscription that would be impacted by the event.</span></span>
* <span data-ttu-id="99d22-134">**警示** - 此類別包含所有 Azure 警示的啟用記錄。</span><span class="sxs-lookup"><span data-stu-id="99d22-134">**Alert** - This category contains the record of all activations of Azure alerts.</span></span> <span data-ttu-id="99d22-135">您可能會在此類別中看到的事件類型範例為「myVM 上的 CPU 百分比在過去 5 分鐘內已超過 80」</span><span class="sxs-lookup"><span data-stu-id="99d22-135">An example of the type of event you would see in this category is "CPU % on myVM has been over 80 for the past 5 minutes."</span></span> <span data-ttu-id="99d22-136">各種 Azure 系統都有警示概念，您可以定義某種類型的規則，並在條件符合該規則時接收通知。</span><span class="sxs-lookup"><span data-stu-id="99d22-136">A variety of Azure systems have an alerting concept -- you can define a rule of some sort and receive a notification when conditions match that rule.</span></span> <span data-ttu-id="99d22-137">每次支援的 Azure 警示類型「啟動」時，或產生通知的條件符合時，該啟用記錄會也會推送至此類別的活動記錄。</span><span class="sxs-lookup"><span data-stu-id="99d22-137">Each time a supported Azure alert type 'activates,' or the conditions are met to generate a notification, a record of the activation is also pushed to this category of the Activity Log.</span></span>
* <span data-ttu-id="99d22-138">**自動調整規模** - 所有與自動調整規模引擎 (以訂用帳戶中定義的自動調整規模設定為基礎) 作業相關的所有事件皆記錄在此類別。</span><span class="sxs-lookup"><span data-stu-id="99d22-138">**Autoscale** - This category contains the record of any events related to the operation of the autoscale engine based on any autoscale settings you have defined in your subscription.</span></span> <span data-ttu-id="99d22-139">您可能會在此類別中看到的事件類型範例為「自動調整規模的相應增加動作失敗」</span><span class="sxs-lookup"><span data-stu-id="99d22-139">An example of the type of event you would see in this category is "Autoscale scale up action failed."</span></span> <span data-ttu-id="99d22-140">自動調整可讓您使用自動調整設定，依據每日時間和/或負載 (計量) 資料，自動相應放大或縮小受支援資源類型中的執行個體數目。</span><span class="sxs-lookup"><span data-stu-id="99d22-140">Using autoscale, you can automatically scale out or scale in the number of instances in a supported resource type based on time of day and/or load (metric) data using an autoscale setting.</span></span> <span data-ttu-id="99d22-141">符合相應增加或相應減少的條件時，啟動及成功或失敗事件會記錄在此類別中。</span><span class="sxs-lookup"><span data-stu-id="99d22-141">When the conditions are met to scale up or down, the start and succeeded or failed events are recorded in this category.</span></span>
* <span data-ttu-id="99d22-142">**建議** - 此類別包含來自特定資源類型 (如網站和 SQL 伺服器) 的建議事件。</span><span class="sxs-lookup"><span data-stu-id="99d22-142">**Recommendation** - This category contains recommendation events from certain resource types, such as web sites and SQL servers.</span></span> <span data-ttu-id="99d22-143">這些事件會提供如何充分運用資源的建議。</span><span class="sxs-lookup"><span data-stu-id="99d22-143">These events offer recommendations for how to better utilize your resources.</span></span> <span data-ttu-id="99d22-144">只有擁有會發出建議的資源時，您才會收到此類型的事件。</span><span class="sxs-lookup"><span data-stu-id="99d22-144">You only receive events of this type if you have resources that emit recommendations.</span></span>
* <span data-ttu-id="99d22-145">**原則、安全性及資源健康情況** - 這些類別不包含任何事件；僅保留以供未來使用。</span><span class="sxs-lookup"><span data-stu-id="99d22-145">**Policy, Security, and Resource Health** - These categories do not contain any events; they are reserved for future use.</span></span>

## <a name="event-schema-per-category"></a><span data-ttu-id="99d22-146">每個類別的事件結構描述</span><span class="sxs-lookup"><span data-stu-id="99d22-146">Event schema per category</span></span>
[<span data-ttu-id="99d22-147">請參閱這篇文章以了解每一類活動記錄事件的結構描述。</span><span class="sxs-lookup"><span data-stu-id="99d22-147">See this article to understand the Activity Log event schema per category.</span></span>](monitoring-activity-log-schema.md)

## <a name="what-you-can-do-with-the-activity-log"></a><span data-ttu-id="99d22-148">Azure 活動記錄檔的用途</span><span class="sxs-lookup"><span data-stu-id="99d22-148">What you can do with the Activity Log</span></span>
<span data-ttu-id="99d22-149">以下是您可以利用活動記錄檔進行的事：</span><span class="sxs-lookup"><span data-stu-id="99d22-149">Here are some of the things you can do with the Activity Log:</span></span>

![Azure 活動記錄](./media/monitoring-overview-activity-logs/Activity_Log_Overview_v3.png)


* <span data-ttu-id="99d22-151">在 **Azure 入口網站**中查詢和檢視活動記錄檔。</span><span class="sxs-lookup"><span data-stu-id="99d22-151">Query and view it in the **Azure portal**.</span></span>
* [<span data-ttu-id="99d22-152">根據活動記錄事件建立警示。</span><span class="sxs-lookup"><span data-stu-id="99d22-152">Create an alert on an Activity Log event.</span></span>](monitoring-activity-log-alerts.md)
* <span data-ttu-id="99d22-153">[將活動記錄檔串流至**事件中樞**](monitoring-stream-activity-logs-event-hubs.md)，以利第三方服務或自訂的分析解決方案 (如 PowerBI) 擷取。</span><span class="sxs-lookup"><span data-stu-id="99d22-153">[Stream it to an **Event Hub**](monitoring-stream-activity-logs-event-hubs.md) for ingestion by a third-party service or custom analytics solution such as PowerBI.</span></span>
* <span data-ttu-id="99d22-154">使用 [**PowerBI 內容套件**](https://powerbi.microsoft.com/documentation/powerbi-content-pack-azure-audit-logs/)在 PowerBI 中分析活動記錄檔。</span><span class="sxs-lookup"><span data-stu-id="99d22-154">Analyze it in PowerBI using the [**PowerBI content pack**](https://powerbi.microsoft.com/documentation/powerbi-content-pack-azure-audit-logs/).</span></span>
* <span data-ttu-id="99d22-155">[將活動記錄檔儲存到**儲存體帳戶**以供封存或手動檢查](monitoring-archive-activity-log.md)。</span><span class="sxs-lookup"><span data-stu-id="99d22-155">[Save it to a **Storage Account** for archival or manual inspection](monitoring-archive-activity-log.md).</span></span> <span data-ttu-id="99d22-156">您可以使用**記錄設定檔**指定保留時間 (以天為單位)。</span><span class="sxs-lookup"><span data-stu-id="99d22-156">You can specify the retention time (in days) using the **Log Profile**.</span></span>
* <span data-ttu-id="99d22-157">透過 PowerShell Cmdlet、CLI 或 REST API 查詢活動記錄。</span><span class="sxs-lookup"><span data-stu-id="99d22-157">Query it via PowerShell Cmdlet, CLI, or REST API.</span></span>

## <a name="query-the-activity-log-in-the-azure-portal"></a><span data-ttu-id="99d22-158">在 Azure 入口網站中查詢活動記錄</span><span class="sxs-lookup"><span data-stu-id="99d22-158">Query the Activity Log in the Azure portal</span></span>
<span data-ttu-id="99d22-159">在 Azure 入口網站中，您可以從幾個地方檢視活動記錄：</span><span class="sxs-lookup"><span data-stu-id="99d22-159">Within the Azure portal you can view your Activity Log in several places:</span></span>
* <span data-ttu-id="99d22-160">[活動記錄] 刀鋒視窗，您可以在左側瀏覽窗格的 [更多服務] 下搜尋活動記錄來存取此刀鋒視窗。</span><span class="sxs-lookup"><span data-stu-id="99d22-160">The **Activity Log blade**, which you can access by searching for the Activity Log under "More Services" in the left-hand navigation pane.</span></span>
* <span data-ttu-id="99d22-161">[監視器] 刀鋒視窗，預設會顯示在左側瀏覽窗格中。</span><span class="sxs-lookup"><span data-stu-id="99d22-161">The **Monitor blade**, which appears by default in the left-hand navigation pane.</span></span> <span data-ttu-id="99d22-162">[活動記錄] 會是此 [Azure 監視器] 刀鋒視窗的一個區段。</span><span class="sxs-lookup"><span data-stu-id="99d22-162">The Activity Log is one section of this Azure Monitor blade.</span></span>
* <span data-ttu-id="99d22-163">任何資源的**資源刀鋒視窗**，例如虛擬機器的設定刀鋒視窗。</span><span class="sxs-lookup"><span data-stu-id="99d22-163">Any resource's **resource blade**, for example, the configuration blade for a Virtual Machine.</span></span> <span data-ttu-id="99d22-164">[活動記錄] 會是大多數這類資源刀鋒視窗中的其中一個區段，按一下即可將事件自動篩選為與該特定資源相關的事件。</span><span class="sxs-lookup"><span data-stu-id="99d22-164">The Activity Log is be one of the sections on most of these resource blades, and clicking on it automatically filters the events to those related to that specific resource.</span></span>

<span data-ttu-id="99d22-165">在 Azure 入口網站中，您可以依下列欄位篩選活動記錄：</span><span class="sxs-lookup"><span data-stu-id="99d22-165">In the Azure portal, you can filter your Activity Log by these fields:</span></span>
* <span data-ttu-id="99d22-166">時間範圍 - 事件的開始和結束時間。</span><span class="sxs-lookup"><span data-stu-id="99d22-166">Timespan - The start and end time for events.</span></span>
* <span data-ttu-id="99d22-167">類別 - 如上所述的事件類別。</span><span class="sxs-lookup"><span data-stu-id="99d22-167">Category - The event category as described above.</span></span>
* <span data-ttu-id="99d22-168">訂用帳戶 - 一或多個 Azure 訂用帳戶名稱。</span><span class="sxs-lookup"><span data-stu-id="99d22-168">Subscription - One or more Azure subscription names.</span></span>
* <span data-ttu-id="99d22-169">資源群組 - 這些訂用帳戶中的一或多個資源群組。</span><span class="sxs-lookup"><span data-stu-id="99d22-169">Resource group - One or more resource groups within those subscriptions.</span></span>
* <span data-ttu-id="99d22-170">資源 (名稱) - 特定資源的名稱。</span><span class="sxs-lookup"><span data-stu-id="99d22-170">Resource (name) - The name of a specific resource.</span></span>
* <span data-ttu-id="99d22-171">資源類型 - 資源的類型，例如 Microsoft.Compute/virtualmachines。</span><span class="sxs-lookup"><span data-stu-id="99d22-171">Resource type - The type of resource, for example, Microsoft.Compute/virtualmachines.</span></span>
* <span data-ttu-id="99d22-172">作業名稱 - Azure Resource Manager 作業的名稱，例如 Microsoft.SQL/servers/Write。</span><span class="sxs-lookup"><span data-stu-id="99d22-172">Operation name - The name of an Azure Resource Manager operation, for example, Microsoft.SQL/servers/Write.</span></span>
* <span data-ttu-id="99d22-173">嚴重性 - 事件的嚴重性層級 (資訊、警告、錯誤、重大)。</span><span class="sxs-lookup"><span data-stu-id="99d22-173">Severity - The severity level of the event (Informational, Warning, Error, Critical).</span></span>
* <span data-ttu-id="99d22-174">事件起始者 -「呼叫者」或執行作業的使用者。</span><span class="sxs-lookup"><span data-stu-id="99d22-174">Event initiated by - The 'caller,' or user who performed the operation.</span></span>
* <span data-ttu-id="99d22-175">開啟搜尋 - 這是開啟文字搜尋方塊，可在所有事件的所有欄位中搜尋該字串。</span><span class="sxs-lookup"><span data-stu-id="99d22-175">Open search - This is an open text search box that searches for that string across all fields in all events.</span></span>

<span data-ttu-id="99d22-176">定義一組篩選之後，如果未來需要再次套用這些篩選以執行相同的查詢，您可以將它儲存為在工作階段間保存的查詢。</span><span class="sxs-lookup"><span data-stu-id="99d22-176">Once you have defined a set of filters, you can save it as a query that is persisted across sessions if you ever need to perform the same query with those filters applied again in the future.</span></span> <span data-ttu-id="99d22-177">您也可以將查詢釘選到 Azure 儀表板，以持續留意特定事件。</span><span class="sxs-lookup"><span data-stu-id="99d22-177">You can also pin a query to your Azure dashboard to always keep an eye on specific events.</span></span>

<span data-ttu-id="99d22-178">按一下 [套用] 執行您的查詢，並顯示所有相符的事件。</span><span class="sxs-lookup"><span data-stu-id="99d22-178">Clicking "Apply" runs your query and show all matching events.</span></span> <span data-ttu-id="99d22-179">按一下清單中的任何事件即可顯示該事件的摘要，以及該事件的完整原始 JSON。</span><span class="sxs-lookup"><span data-stu-id="99d22-179">Clicking on any event in the list shows the summary of that event as well as the full raw JSON of that event.</span></span>

<span data-ttu-id="99d22-180">若要取得更強大的功能，您可以按一下**記錄搜尋**圖示，以顯示 [Log Analytics 活動記錄分析解決方案](../log-analytics/log-analytics-activity.md)中的活動記錄資料。</span><span class="sxs-lookup"><span data-stu-id="99d22-180">For even more power, you can click the **Log Search** icon, which displays your Activity Log data in the [Log Analytics Activity Log Analytics solution](../log-analytics/log-analytics-activity.md).</span></span> <span data-ttu-id="99d22-181">[活動記錄] 刀鋒視窗提供記錄的基本篩選/瀏覽體驗，而 Log Analytics 則可讓您以更強大的方式對資料進行樞紐分析、查詢和視覺化。</span><span class="sxs-lookup"><span data-stu-id="99d22-181">The Activity Log blade offers a basic filter/browse experience on logs, but Log Analytics enables you to pivot, query, and visualize your data in more powerful ways.</span></span>

## <a name="export-the-activity-log-with-a-log-profile"></a><span data-ttu-id="99d22-182">使用記錄設定檔匯出活動記錄</span><span class="sxs-lookup"><span data-stu-id="99d22-182">Export the Activity Log with a Log Profile</span></span>
<span data-ttu-id="99d22-183">**記錄檔設定檔** 控制活動記錄檔的匯出方式。</span><span class="sxs-lookup"><span data-stu-id="99d22-183">A **Log Profile** controls how your Activity Log is exported.</span></span> <span data-ttu-id="99d22-184">使用記錄檔設定檔，您可以設定︰</span><span class="sxs-lookup"><span data-stu-id="99d22-184">Using a Log Profile, you can configure:</span></span>

* <span data-ttu-id="99d22-185">活動記錄檔應該要傳送至何處 (儲存體帳戶或事件中樞)</span><span class="sxs-lookup"><span data-stu-id="99d22-185">Where the Activity Log should be sent (Storage Account or Event Hubs)</span></span>
* <span data-ttu-id="99d22-186">應該要傳送何種事件分類 (Write、Delete、Action)。</span><span class="sxs-lookup"><span data-stu-id="99d22-186">Which event categories (Write, Delete, Action) should be sent.</span></span> <span data-ttu-id="99d22-187">*「類別」一詞在記錄設定檔和活動記錄事件中的意義並不相同。在記錄設定檔中，「類別」代表作業類型 (寫入、刪除、動作)。在活動記錄事件中，「類別」屬性代表事件的來源或類型 (例如，管理、ServiceHealth、警示等等)。*</span><span class="sxs-lookup"><span data-stu-id="99d22-187">*The meaning of "category" in Log Profiles and Activity Log events is different. In the Log Profile, "Category" represents the operation type (Write, Delete, Action). In an Activity Log event, the "category" property represents the source or type of event (for example, Administration, ServiceHealth, Alert, and more).*</span></span>
* <span data-ttu-id="99d22-188">應該要匯出哪一個區域 (位置)。</span><span class="sxs-lookup"><span data-stu-id="99d22-188">Which regions (locations) should be exported.</span></span> <span data-ttu-id="99d22-189">請務必包含「全域」，因為活動記錄中的許多事件都是全域事件。</span><span class="sxs-lookup"><span data-stu-id="99d22-189">Make sure to include "global," as many events in the Activity Log are global events.</span></span>
* <span data-ttu-id="99d22-190">活動記錄應該在儲存體帳戶中保留多久。</span><span class="sxs-lookup"><span data-stu-id="99d22-190">How long the Activity Log should be retained in a Storage Account.</span></span>
    - <span data-ttu-id="99d22-191">保留期為 0 天表示會永遠保留記錄。</span><span class="sxs-lookup"><span data-stu-id="99d22-191">A retention of zero days means logs are kept forever.</span></span> <span data-ttu-id="99d22-192">否則，此值可以是 1 到 2147483647 之間的任意天數。</span><span class="sxs-lookup"><span data-stu-id="99d22-192">Otherwise, the value can be any number of days between 1 and 2147483647.</span></span>
    - <span data-ttu-id="99d22-193">如果有設定保留原則，但將儲存體帳戶的記錄檔儲存停用 (例如，如果只選取事件中樞或 OMS 選項)，保留原則不會有任何作用。</span><span class="sxs-lookup"><span data-stu-id="99d22-193">If retention policies are set but storing logs in a Storage Account is disabled (for example, if only Event Hubs or OMS options are selected), the retention policies have no effect.</span></span>
    - <span data-ttu-id="99d22-194">保留原則是每天套用，因此在一天結束時 (UTC)，這一天超過保留原則的記錄會被刪除。</span><span class="sxs-lookup"><span data-stu-id="99d22-194">Retention policies are applied per-day, so at the end of a day (UTC), logs from the day that is now beyond the retention policy are deleted.</span></span> <span data-ttu-id="99d22-195">例如，如果您的保留原則為一天，在今天一開始，昨天之前的記錄檔會被刪除。</span><span class="sxs-lookup"><span data-stu-id="99d22-195">For example, if you had a retention policy of one day, at the beginning of the day today the logs from the day before yesterday would be deleted.</span></span>

<span data-ttu-id="99d22-196">您可以使用並非發出記錄的同一個訂用帳戶中的儲存體帳戶或事件中樞命名空間。</span><span class="sxs-lookup"><span data-stu-id="99d22-196">You can use a storage account or event hub namespace that is not in the same subscription as the one emitting logs.</span></span> <span data-ttu-id="99d22-197">進行此設定的使用者必須具有這兩個訂用帳戶的適當 RBAC 存取權。</span><span class="sxs-lookup"><span data-stu-id="99d22-197">The user who configures the setting must have the appropriate RBAC access to both subscriptions.</span></span>

<span data-ttu-id="99d22-198">這些設定可透過入口網站中 [活動記錄檔] 刀鋒視窗中的 [匯出] 選項來設定。</span><span class="sxs-lookup"><span data-stu-id="99d22-198">These settings can be configured via the “Export” option in the Activity Log blade in the portal.</span></span> <span data-ttu-id="99d22-199">也可以[使用 Azure 監視器 REST API](https://msdn.microsoft.com/library/azure/dn931927.aspx)、PowerShell Cmdlet 或 CLI 以程式設計方式設定。</span><span class="sxs-lookup"><span data-stu-id="99d22-199">They can also be configured programmatically [using the Azure Monitor REST API](https://msdn.microsoft.com/library/azure/dn931927.aspx), PowerShell cmdlets, or CLI.</span></span> <span data-ttu-id="99d22-200">一個訂用帳戶只能有一個記錄檔的設定檔。</span><span class="sxs-lookup"><span data-stu-id="99d22-200">A subscription can only have one log profile.</span></span>

### <a name="configure-log-profiles-using-the-azure-portal"></a><span data-ttu-id="99d22-201">使用 Azure 入口網站設定記錄檔設定檔</span><span class="sxs-lookup"><span data-stu-id="99d22-201">Configure log profiles using the Azure portal</span></span>
<span data-ttu-id="99d22-202">您可以將活動記錄檔串流至事件中樞，或在 Azure 入口網站中使用 [匯出] 選項將它們儲存在儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="99d22-202">You can stream the Activity Log to an Event Hub or store them in a Storage Account by using the “Export” option in the Azure portal.</span></span>

1. <span data-ttu-id="99d22-203">使用入口網站左側的功能表，瀏覽至 [活動記錄檔]  刀鋒視窗。</span><span class="sxs-lookup"><span data-stu-id="99d22-203">Navigate to the **Activity Log** blade using the menu on the left side of the portal.</span></span>

    ![在入口網站中瀏覽至活動記錄檔](./media/monitoring-overview-activity-logs/activity-logs-portal-navigate.png)
2. <span data-ttu-id="99d22-205">按一下刀鋒視窗頂端的 [匯出]  按鈕。</span><span class="sxs-lookup"><span data-stu-id="99d22-205">Click the **Export** button at the top of the blade.</span></span>

    ![入口網站中的匯出按鈕](./media/monitoring-overview-activity-logs/activity-logs-portal-export.png)
3. <span data-ttu-id="99d22-207">在出現的刀鋒視窗中，您可以選取︰</span><span class="sxs-lookup"><span data-stu-id="99d22-207">In the blade that appears, you can select:</span></span>  
  * <span data-ttu-id="99d22-208">您要匯出事件的區域</span><span class="sxs-lookup"><span data-stu-id="99d22-208">regions for which you would like to export events</span></span>
  * <span data-ttu-id="99d22-209">您要儲存事件的儲存體帳戶</span><span class="sxs-lookup"><span data-stu-id="99d22-209">the Storage Account to which you would like to save events</span></span>
  * <span data-ttu-id="99d22-210">您想要在儲存體中保留這些事件的天數。</span><span class="sxs-lookup"><span data-stu-id="99d22-210">the number of days you want to retain these events in storage.</span></span> <span data-ttu-id="99d22-211">如果設定為 0 天會永遠保留記錄檔。</span><span class="sxs-lookup"><span data-stu-id="99d22-211">A setting of 0 days retains the logs forever.</span></span>
  * <span data-ttu-id="99d22-212">服務匯流排命名空間，您要在其中建立事件中樞以對這些事件進行串流處理。</span><span class="sxs-lookup"><span data-stu-id="99d22-212">the Service Bus Namespace in which you would like an Event Hub to be created for streaming these events.</span></span>

     ![匯出活動記錄檔刀鋒視窗](./media/monitoring-overview-activity-logs/activity-logs-portal-export-blade.png)
4. <span data-ttu-id="99d22-214">按一下 [儲存]  來儲存這些設定。</span><span class="sxs-lookup"><span data-stu-id="99d22-214">Click **Save** to save these settings.</span></span> <span data-ttu-id="99d22-215">您的訂用帳戶時會立即套用設定。</span><span class="sxs-lookup"><span data-stu-id="99d22-215">The settings are immediately be applied to your subscription.</span></span>

### <a name="configure-log-profiles-using-the-azure-powershell-cmdlets"></a><span data-ttu-id="99d22-216">使用 Azure PowerShell Cmdlet 設定記錄檔設定檔</span><span class="sxs-lookup"><span data-stu-id="99d22-216">Configure log profiles using the Azure PowerShell Cmdlets</span></span>
#### <a name="get-existing-log-profile"></a><span data-ttu-id="99d22-217">取得現有的記錄檔設定檔</span><span class="sxs-lookup"><span data-stu-id="99d22-217">Get existing log profile</span></span>
```
Get-AzureRmLogProfile
```

#### <a name="add-a-log-profile"></a><span data-ttu-id="99d22-218">新增記錄檔設定檔</span><span class="sxs-lookup"><span data-stu-id="99d22-218">Add a log profile</span></span>
```
Add-AzureRmLogProfile -Name my_log_profile -StorageAccountId /subscriptions/s1/resourceGroups/myrg1/providers/Microsoft.Storage/storageAccounts/my_storage -serviceBusRuleId /subscriptions/s1/resourceGroups/Default-ServiceBus-EastUS/providers/Microsoft.ServiceBus/namespaces/mytestSB/authorizationrules/RootManageSharedAccessKey -Locations global,westus,eastus -RetentionInDays 90 -Categories Write,Delete,Action
```

| <span data-ttu-id="99d22-219">屬性</span><span class="sxs-lookup"><span data-stu-id="99d22-219">Property</span></span> | <span data-ttu-id="99d22-220">必要</span><span class="sxs-lookup"><span data-stu-id="99d22-220">Required</span></span> | <span data-ttu-id="99d22-221">說明</span><span class="sxs-lookup"><span data-stu-id="99d22-221">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="99d22-222">Name</span><span class="sxs-lookup"><span data-stu-id="99d22-222">Name</span></span> |<span data-ttu-id="99d22-223">是</span><span class="sxs-lookup"><span data-stu-id="99d22-223">Yes</span></span> |<span data-ttu-id="99d22-224">記錄檔設定檔的名稱。</span><span class="sxs-lookup"><span data-stu-id="99d22-224">Name of your log profile.</span></span> |
| <span data-ttu-id="99d22-225">StorageAccountId</span><span class="sxs-lookup"><span data-stu-id="99d22-225">StorageAccountId</span></span> |<span data-ttu-id="99d22-226">否</span><span class="sxs-lookup"><span data-stu-id="99d22-226">No</span></span> |<span data-ttu-id="99d22-227">資源識別碼，活動記錄檔應該要儲存至此儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="99d22-227">Resource ID of the Storage Account to which the Activity Log should be saved.</span></span> |
| <span data-ttu-id="99d22-228">serviceBusRuleId</span><span class="sxs-lookup"><span data-stu-id="99d22-228">serviceBusRuleId</span></span> |<span data-ttu-id="99d22-229">否</span><span class="sxs-lookup"><span data-stu-id="99d22-229">No</span></span> |<span data-ttu-id="99d22-230">服務匯流排規則識別碼，您想要在其中建立事件中樞的服務匯流排命名空間。</span><span class="sxs-lookup"><span data-stu-id="99d22-230">Service Bus Rule ID for the Service Bus namespace you would like to have event hubs created in.</span></span> <span data-ttu-id="99d22-231">將會是此格式的字串︰`{service bus resource ID}/authorizationrules/{key name}`。</span><span class="sxs-lookup"><span data-stu-id="99d22-231">Is a string with this format: `{service bus resource ID}/authorizationrules/{key name}`.</span></span> |
| <span data-ttu-id="99d22-232">位置</span><span class="sxs-lookup"><span data-stu-id="99d22-232">Locations</span></span> |<span data-ttu-id="99d22-233">是</span><span class="sxs-lookup"><span data-stu-id="99d22-233">Yes</span></span> |<span data-ttu-id="99d22-234">以逗號分隔的區域清單，其中列出您要收集的活動記錄檔事件的區域。</span><span class="sxs-lookup"><span data-stu-id="99d22-234">Comma-separated list of regions for which you would like to collect Activity Log events.</span></span> |
| <span data-ttu-id="99d22-235">RetentionInDays</span><span class="sxs-lookup"><span data-stu-id="99d22-235">RetentionInDays</span></span> |<span data-ttu-id="99d22-236">是</span><span class="sxs-lookup"><span data-stu-id="99d22-236">Yes</span></span> |<span data-ttu-id="99d22-237">事件應保留的天數，1 到 2147483647 之間。</span><span class="sxs-lookup"><span data-stu-id="99d22-237">Number of days for which events should be retained, between 1 and 2147483647.</span></span> <span data-ttu-id="99d22-238">值為 0 會無限期地 (永遠) 儲存記錄檔。</span><span class="sxs-lookup"><span data-stu-id="99d22-238">A value of zero stores the logs indefinitely (forever).</span></span> |
| <span data-ttu-id="99d22-239">類別</span><span class="sxs-lookup"><span data-stu-id="99d22-239">Categories</span></span> |<span data-ttu-id="99d22-240">否</span><span class="sxs-lookup"><span data-stu-id="99d22-240">No</span></span> |<span data-ttu-id="99d22-241">以逗號分隔的類別清單，其中列出應該收集的事件類別。</span><span class="sxs-lookup"><span data-stu-id="99d22-241">Comma-separated list of event categories that should be collected.</span></span> <span data-ttu-id="99d22-242">可能的值有 Write、Delete、Action。</span><span class="sxs-lookup"><span data-stu-id="99d22-242">Possible values are Write, Delete, and Action.</span></span> |

#### <a name="remove-a-log-profile"></a><span data-ttu-id="99d22-243">移除記錄檔設定檔</span><span class="sxs-lookup"><span data-stu-id="99d22-243">Remove a log profile</span></span>
```
Remove-AzureRmLogProfile -name my_log_profile
```

### <a name="configure-log-profiles-using-the-azure-cross-platform-cli"></a><span data-ttu-id="99d22-244">使用 Azure 跨平台 CLI 設定記錄檔設定檔</span><span class="sxs-lookup"><span data-stu-id="99d22-244">Configure log profiles Using the Azure Cross-Platform CLI</span></span>
#### <a name="get-existing-log-profile"></a><span data-ttu-id="99d22-245">取得現有的記錄檔設定檔</span><span class="sxs-lookup"><span data-stu-id="99d22-245">Get existing log profile</span></span>
```
azure insights logprofile list
```
```
azure insights logprofile get --name my_log_profile
```
<span data-ttu-id="99d22-246">`name` 屬性應該是您的記錄檔設定檔的名稱。</span><span class="sxs-lookup"><span data-stu-id="99d22-246">The `name` property should be the name of your log profile.</span></span>

#### <a name="add-a-log-profile"></a><span data-ttu-id="99d22-247">新增記錄檔設定檔</span><span class="sxs-lookup"><span data-stu-id="99d22-247">Add a log profile</span></span>
```
azure insights logprofile add --name my_log_profile --storageId /subscriptions/s1/resourceGroups/insights-integration/providers/Microsoft.Storage/storageAccounts/my_storage --serviceBusRuleId /subscriptions/s1/resourceGroups/Default-ServiceBus-EastUS/providers/Microsoft.ServiceBus/namespaces/mytestSB/authorizationrules/RootManageSharedAccessKey --locations global,westus,eastus,northeurope --retentionInDays 90 –categories Write,Delete,Action
```

| <span data-ttu-id="99d22-248">屬性</span><span class="sxs-lookup"><span data-stu-id="99d22-248">Property</span></span> | <span data-ttu-id="99d22-249">必要</span><span class="sxs-lookup"><span data-stu-id="99d22-249">Required</span></span> | <span data-ttu-id="99d22-250">說明</span><span class="sxs-lookup"><span data-stu-id="99d22-250">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="99d22-251">名稱</span><span class="sxs-lookup"><span data-stu-id="99d22-251">name</span></span> |<span data-ttu-id="99d22-252">是</span><span class="sxs-lookup"><span data-stu-id="99d22-252">Yes</span></span> |<span data-ttu-id="99d22-253">記錄檔設定檔的名稱。</span><span class="sxs-lookup"><span data-stu-id="99d22-253">Name of your log profile.</span></span> |
| <span data-ttu-id="99d22-254">storageId</span><span class="sxs-lookup"><span data-stu-id="99d22-254">storageId</span></span> |<span data-ttu-id="99d22-255">否</span><span class="sxs-lookup"><span data-stu-id="99d22-255">No</span></span> |<span data-ttu-id="99d22-256">資源識別碼，活動記錄檔應該要儲存至此儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="99d22-256">Resource ID of the Storage Account to which the Activity Log should be saved.</span></span> |
| <span data-ttu-id="99d22-257">serviceBusRuleId</span><span class="sxs-lookup"><span data-stu-id="99d22-257">serviceBusRuleId</span></span> |<span data-ttu-id="99d22-258">否</span><span class="sxs-lookup"><span data-stu-id="99d22-258">No</span></span> |<span data-ttu-id="99d22-259">服務匯流排規則識別碼，您想要在其中建立事件中樞的服務匯流排命名空間。</span><span class="sxs-lookup"><span data-stu-id="99d22-259">Service Bus Rule ID for the Service Bus namespace you would like to have event hubs created in.</span></span> <span data-ttu-id="99d22-260">將會是此格式的字串︰`{service bus resource ID}/authorizationrules/{key name}`。</span><span class="sxs-lookup"><span data-stu-id="99d22-260">Is a string with this format: `{service bus resource ID}/authorizationrules/{key name}`.</span></span> |
| <span data-ttu-id="99d22-261">位置</span><span class="sxs-lookup"><span data-stu-id="99d22-261">locations</span></span> |<span data-ttu-id="99d22-262">是</span><span class="sxs-lookup"><span data-stu-id="99d22-262">Yes</span></span> |<span data-ttu-id="99d22-263">以逗號分隔的區域清單，其中列出您要收集的活動記錄檔事件的區域。</span><span class="sxs-lookup"><span data-stu-id="99d22-263">Comma-separated list of regions for which you would like to collect Activity Log events.</span></span> |
| <span data-ttu-id="99d22-264">RetentionInDays</span><span class="sxs-lookup"><span data-stu-id="99d22-264">retentionInDays</span></span> |<span data-ttu-id="99d22-265">是</span><span class="sxs-lookup"><span data-stu-id="99d22-265">Yes</span></span> |<span data-ttu-id="99d22-266">事件應保留的天數，1 到 2147483647 之間。</span><span class="sxs-lookup"><span data-stu-id="99d22-266">Number of days for which events should be retained, between 1 and 2147483647.</span></span> <span data-ttu-id="99d22-267">值為 0 會無限期地 (永遠) 儲存記錄檔。</span><span class="sxs-lookup"><span data-stu-id="99d22-267">A value of zero stores the logs indefinitely (forever).</span></span> |
| <span data-ttu-id="99d22-268">類別</span><span class="sxs-lookup"><span data-stu-id="99d22-268">categories</span></span> |<span data-ttu-id="99d22-269">否</span><span class="sxs-lookup"><span data-stu-id="99d22-269">No</span></span> |<span data-ttu-id="99d22-270">以逗號分隔的類別清單，其中列出應該收集的事件類別。</span><span class="sxs-lookup"><span data-stu-id="99d22-270">Comma-separated list of event categories that should be collected.</span></span> <span data-ttu-id="99d22-271">可能的值有 Write、Delete、Action。</span><span class="sxs-lookup"><span data-stu-id="99d22-271">Possible values are Write, Delete, and Action.</span></span> |

#### <a name="remove-a-log-profile"></a><span data-ttu-id="99d22-272">移除記錄檔設定檔</span><span class="sxs-lookup"><span data-stu-id="99d22-272">Remove a log profile</span></span>
```
azure insights logprofile delete --name my_log_profile
```

## <a name="next-steps"></a><span data-ttu-id="99d22-273">後續步驟</span><span class="sxs-lookup"><span data-stu-id="99d22-273">Next Steps</span></span>
* [<span data-ttu-id="99d22-274">深入了解活動記錄檔 (之前的稽核記錄檔)</span><span class="sxs-lookup"><span data-stu-id="99d22-274">Learn more about the Activity Log (formerly Audit Logs)</span></span>](../azure-resource-manager/resource-group-audit.md)
* [<span data-ttu-id="99d22-275">將 Azure 活動記錄檔串流至事件中樞</span><span class="sxs-lookup"><span data-stu-id="99d22-275">Stream the Azure Activity Log to Event Hubs</span></span>](monitoring-stream-activity-logs-event-hubs.md)
