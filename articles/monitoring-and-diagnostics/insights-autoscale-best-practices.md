---
title: "自動調整規模 aaaBest 作法 |Microsoft 文件"
description: "在 Azure 中自動調整 Web 應用程式、虛擬機器擴展集和雲端服務的規模模式。"
author: anirudhcavale
manager: orenr
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: 9fa2b94b-dfa5-4106-96ff-74fd1fba4657
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/07/2017
ms.author: ancav
ms.openlocfilehash: eb731c15e440af93a2675210583878814d0d8818
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/06/2017
---
# <a name="best-practices-for-autoscale"></a><span data-ttu-id="46de1-103">自動調整規模的最佳做法</span><span class="sxs-lookup"><span data-stu-id="46de1-103">Best practices for Autoscale</span></span>
<span data-ttu-id="46de1-104">本文將說明在 Azure 中的最佳作法 tooautoscale。</span><span class="sxs-lookup"><span data-stu-id="46de1-104">This article teaches best practices tooautoscale in Azure.</span></span> <span data-ttu-id="46de1-105">Azure 監視的自動調整規模太只適用於[虛擬機器擴展集](https://azure.microsoft.com/services/virtual-machine-scale-sets/)，[雲端服務](https://azure.microsoft.com/services/cloud-services/)，和[應用程式服務-Web 應用程式](https://azure.microsoft.com/services/app-service/web/)。</span><span class="sxs-lookup"><span data-stu-id="46de1-105">Azure Monitor autoscale applies only too[Virtual Machine Scale Sets](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Cloud Services](https://azure.microsoft.com/services/cloud-services/), and [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/).</span></span> <span data-ttu-id="46de1-106">其他 Azure 服務使用不同的調整方法。</span><span class="sxs-lookup"><span data-stu-id="46de1-106">Other Azure services use different scaling methods.</span></span>

## <a name="autoscale-concepts"></a><span data-ttu-id="46de1-107">自動調整的概念</span><span class="sxs-lookup"><span data-stu-id="46de1-107">Autoscale concepts</span></span>
* <span data-ttu-id="46de1-108">資源可以只有「一項」  自動調整設定。</span><span class="sxs-lookup"><span data-stu-id="46de1-108">A resource can have only *one* autoscale setting</span></span>
* <span data-ttu-id="46de1-109">自動調整設定可有一或多個設定檔，而且每個設定檔都能有一或多項自動調整規則。</span><span class="sxs-lookup"><span data-stu-id="46de1-109">An autoscale setting can have one or more profiles and each profile can have one or more autoscale rules.</span></span>
* <span data-ttu-id="46de1-110">自動調整規模設定可調整執行個體的水平即*出*藉由增加 hello 執行個體和*中*藉由降低 hello 的執行個體的數目。</span><span class="sxs-lookup"><span data-stu-id="46de1-110">An autoscale setting scales instances horizontally, which is *out* by increasing hello instances and *in* by decreasing hello number of instances.</span></span>
  <span data-ttu-id="46de1-111">自動調整設定可設定執行個體數的最大值、最小值及預設值。</span><span class="sxs-lookup"><span data-stu-id="46de1-111">An autoscale setting has a maximum, minimum, and default value of instances.</span></span>
* <span data-ttu-id="46de1-112">自動調整規模作業一定會讀取 hello 相關聯的度量 tooscale 藉由檢查若它已越過 hello 為向外延展或向中設定的閾值。</span><span class="sxs-lookup"><span data-stu-id="46de1-112">An autoscale job always reads hello associated metric tooscale by, checking if it has crossed hello configured threshold for scale-out or scale-in.</span></span> <span data-ttu-id="46de1-113">您可以在 [Azure 監視器自動調整的常見度量](insights-autoscale-common-metrics.md)中，檢視自動調整據以調整的度量清單。</span><span class="sxs-lookup"><span data-stu-id="46de1-113">You can view a list of metrics that autoscale can scale by at [Azure Monitor autoscaling common metrics](insights-autoscale-common-metrics.md).</span></span>
* <span data-ttu-id="46de1-114">所有臨界值都是在執行個體層級計算。</span><span class="sxs-lookup"><span data-stu-id="46de1-114">All thresholds are calculated at an instance level.</span></span> <span data-ttu-id="46de1-115">比方說，「 逾時依 1 個執行個體調整當執行個體計數是 2 的平均 CPU > 80%"，當 hello 所有執行個體的平均 CPU 高於 80%時，表示向外延展。</span><span class="sxs-lookup"><span data-stu-id="46de1-115">For example, "scale out by 1 instance when average CPU > 80% when instance count is 2", means scale-out when hello average CPU across all instances is greater than 80%.</span></span>
* <span data-ttu-id="46de1-116">您一律會從電子郵件收到失敗通知。</span><span class="sxs-lookup"><span data-stu-id="46de1-116">You always receive failure notifications via email.</span></span> <span data-ttu-id="46de1-117">具體來說，hello 擁有者、 參與者與讀者 hello 目標資源會收到電子郵件。</span><span class="sxs-lookup"><span data-stu-id="46de1-117">Specifically, hello owner, contributor, and readers of hello target resource receive email.</span></span> <span data-ttu-id="46de1-118">當自動調整從失敗復原並開始正常運作時，您也一律會收到「復原」電子郵件。</span><span class="sxs-lookup"><span data-stu-id="46de1-118">You also always receive a *recovery* email when autoscale recovers from a failure and starts functioning normally.</span></span>
* <span data-ttu-id="46de1-119">您可以選擇加入的 tooreceive 成功延展動作通知電子郵件和 webhook。</span><span class="sxs-lookup"><span data-stu-id="46de1-119">You can opt-in tooreceive a successful scale action notification via email and webhooks.</span></span>

## <a name="autoscale-best-practices"></a><span data-ttu-id="46de1-120">自動調整最佳做法</span><span class="sxs-lookup"><span data-stu-id="46de1-120">Autoscale best practices</span></span>
<span data-ttu-id="46de1-121">使用下列最佳作法，當您使用自動調整規模的 hello。</span><span class="sxs-lookup"><span data-stu-id="46de1-121">Use hello following best practices as you use autoscale.</span></span>

### <a name="ensure-hello-maximum-and-minimum-values-are-different-and-have-an-adequate-margin-between-them"></a><span data-ttu-id="46de1-122">請 hello 最大和最小值不同，兩者之間有足夠的臨界值</span><span class="sxs-lookup"><span data-stu-id="46de1-122">Ensure hello maximum and minimum values are different and have an adequate margin between them</span></span>
<span data-ttu-id="46de1-123">如果您有設定具有最小值 = 2，最大值 = 2，而 hello 目前執行個體計數為 2，可能會發生任何調整規模動作。</span><span class="sxs-lookup"><span data-stu-id="46de1-123">If you have a setting that has minimum=2, maximum=2 and hello current instance count is 2, no scale action can occur.</span></span> <span data-ttu-id="46de1-124">保留足夠的邊界之間 hello 最大和最小執行個體計數，都包含在內。</span><span class="sxs-lookup"><span data-stu-id="46de1-124">Keep an adequate margin between hello maximum and minimum instance counts, which are inclusive.</span></span> <span data-ttu-id="46de1-125">在這些限制之間，一定律會自動調整。</span><span class="sxs-lookup"><span data-stu-id="46de1-125">Autoscale always scales between these limits.</span></span>

### <a name="manual-scaling-is-reset-by-autoscale-min-and-max"></a><span data-ttu-id="46de1-126">自動調整的最小值與最大值會重設手動調整</span><span class="sxs-lookup"><span data-stu-id="46de1-126">Manual scaling is reset by autoscale min and max</span></span>
<span data-ttu-id="46de1-127">如果您手動更新 hello 執行個體計數 tooa 值上方或下方 hello 上限 hello 自動調整引擎自動縮放後 toohello 最小值 （如果下方） 或 hello 最大值 （如果上方）。</span><span class="sxs-lookup"><span data-stu-id="46de1-127">If you manually update hello instance count tooa value above or below hello maximum, hello autoscale engine automatically scales back toohello minimum (if below) or hello maximum (if above).</span></span> <span data-ttu-id="46de1-128">例如，您可以設定 hello 範圍介於 3 到 6 之間。</span><span class="sxs-lookup"><span data-stu-id="46de1-128">For example, you set hello range between 3 and 6.</span></span> <span data-ttu-id="46de1-129">如果您有一個執行執行個體，hello 自動調整引擎會在下次執行縮放 too3 執行個體。</span><span class="sxs-lookup"><span data-stu-id="46de1-129">If you have one running instance, hello autoscale engine scales too3 instances on its next run.</span></span> <span data-ttu-id="46de1-130">同樣地，它會向單元 8 個執行個體在下次執行備份 too6。</span><span class="sxs-lookup"><span data-stu-id="46de1-130">Likewise, it would scale-in 8 instances back too6 on its next run.</span></span>  <span data-ttu-id="46de1-131">手動調整是非常暫時性的除非您重設 hello 自動調整規模規則。</span><span class="sxs-lookup"><span data-stu-id="46de1-131">Manual scaling is very temporary unless you reset hello autoscale rules as well.</span></span>

### <a name="always-use-a-scale-out-and-scale-in-rule-combination-that-performs-an-increase-and-decrease"></a><span data-ttu-id="46de1-132">請一律使用相應放大和相應縮小規則的組合來執行增加與減少。</span><span class="sxs-lookup"><span data-stu-id="46de1-132">Always use a scale-out and scale-in rule combination that performs an increase and decrease</span></span>
<span data-ttu-id="46de1-133">如果您使用只有一個 hello 組合的一部分時，自動調整規模規模單元單一 out 或，直到 hello 上限或最小值、 為止。</span><span class="sxs-lookup"><span data-stu-id="46de1-133">If you use only one part of hello combination, autoscale scale-in that single out, or in, until hello maximum, or minimum, is reached.</span></span>

### <a name="do-not-switch-between-hello-azure-portal-and-hello-azure-classic-portal-when-managing-autoscale"></a><span data-ttu-id="46de1-134">請勿在管理自動調整規模時不 hello Azure 入口網站和 hello Azure 傳統入口網站之間切換</span><span class="sxs-lookup"><span data-stu-id="46de1-134">Do not switch between hello Azure portal and hello Azure classic portal when managing Autoscale</span></span>
<span data-ttu-id="46de1-135">雲端服務和應用程式服務 （Web 應用程式），使用 hello Azure 入口網站 (portal.azure.com) toocreate 和管理自動調整規模設定。</span><span class="sxs-lookup"><span data-stu-id="46de1-135">For Cloud Services and App Services (Web Apps), use hello Azure portal (portal.azure.com) toocreate and manage autoscale settings.</span></span> <span data-ttu-id="46de1-136">虛擬機器擴展集，請使用 PowerShell、 CLI 或 REST API toocreate 和管理自動調整規模設定。</span><span class="sxs-lookup"><span data-stu-id="46de1-136">For Virtual Machine Scale Sets use PowerShell, CLI or REST API toocreate and manage autoscale setting.</span></span> <span data-ttu-id="46de1-137">不會轉換 hello Azure 傳統入口網站 (manage.windowsazure.com) 與 hello Azure 入口網站 (portal.azure.com) 之間時管理自動調整規模設定。</span><span class="sxs-lookup"><span data-stu-id="46de1-137">Do not switch between hello Azure classic portal (manage.windowsazure.com) and hello Azure portal (portal.azure.com) when managing autoscale configurations.</span></span> <span data-ttu-id="46de1-138">hello Azure 傳統入口網站，而且其基礎的後端有限制。</span><span class="sxs-lookup"><span data-stu-id="46de1-138">hello Azure classic portal and its underlying backend has limitations.</span></span> <span data-ttu-id="46de1-139">移動 toohello Azure 入口網站 toomanage 自動調整規模使用圖形化使用者介面。</span><span class="sxs-lookup"><span data-stu-id="46de1-139">Move toohello Azure portal toomanage autoscale using a graphical user interface.</span></span> <span data-ttu-id="46de1-140">hello 的選項為 toouse hello 自動調整規模 PowerShell、 CLI 或 REST API （透過 Azure 資源總管）。</span><span class="sxs-lookup"><span data-stu-id="46de1-140">hello options are toouse hello autoscale PowerShell, CLI or REST API (via Azure Resource Explorer).</span></span>

### <a name="choose-hello-appropriate-statistic-for-your-diagnostics-metric"></a><span data-ttu-id="46de1-141">選擇診斷度量 hello 適當統計資料</span><span class="sxs-lookup"><span data-stu-id="46de1-141">Choose hello appropriate statistic for your diagnostics metric</span></span>
<span data-ttu-id="46de1-142">診斷度量，您可以在選擇*平均*，*最小值*，*最大*和*總*為根據度量 tooscale。</span><span class="sxs-lookup"><span data-stu-id="46de1-142">For diagnostics metrics, you can choose among *Average*, *Minimum*, *Maximum* and *Total* as a metric tooscale by.</span></span> <span data-ttu-id="46de1-143">hello 最常見的統計資料是*平均*。</span><span class="sxs-lookup"><span data-stu-id="46de1-143">hello most common statistic is *Average*.</span></span>

### <a name="choose-hello-thresholds-carefully-for-all-metric-types"></a><span data-ttu-id="46de1-144">選擇仔細 hello 所有度量類型臨界值</span><span class="sxs-lookup"><span data-stu-id="46de1-144">Choose hello thresholds carefully for all metric types</span></span>
<span data-ttu-id="46de1-145">建議您根據實際情況，小心選擇不同的相應放大與相應縮小臨界值。</span><span class="sxs-lookup"><span data-stu-id="46de1-145">We recommend carefully choosing different thresholds for scale-out and scale-in based on practical situations.</span></span>

<span data-ttu-id="46de1-146">我們*不建議*自動調整規模設定，例如下方的 hello 範例與 hello 相同或相似的臨界值外，並在條件中：</span><span class="sxs-lookup"><span data-stu-id="46de1-146">We *do not recommend* autoscale settings like hello examples below with hello same or very similar threshold values for out and in conditions:</span></span>

* <span data-ttu-id="46de1-147">當執行緒計數 <= 600 時，增加 1 個執行個體</span><span class="sxs-lookup"><span data-stu-id="46de1-147">Increase instances by 1 count when Thread Count <= 600</span></span>
* <span data-ttu-id="46de1-148">當執行緒計數 >= 600 時，減少 1 個執行個體</span><span class="sxs-lookup"><span data-stu-id="46de1-148">Decrease instances by 1 count when Thread Count >= 600</span></span>

<span data-ttu-id="46de1-149">讓我們看看什麼可能會導致可能令人混淆的 tooa 行為的範例。</span><span class="sxs-lookup"><span data-stu-id="46de1-149">Let's look at an example of what can lead tooa behavior that may seem confusing.</span></span> <span data-ttu-id="46de1-150">請考慮下列順序的 hello。</span><span class="sxs-lookup"><span data-stu-id="46de1-150">Consider hello following sequence.</span></span>

1. <span data-ttu-id="46de1-151">假設有與 2 的執行個體 toobegin，然後 hello 平均每個執行個體的執行緒數目成長 too625。</span><span class="sxs-lookup"><span data-stu-id="46de1-151">Assume there are 2 instances toobegin with and then hello average number of threads per instance grows too625.</span></span>
2. <span data-ttu-id="46de1-152">自動調整會隨之相應放大，加入第 3 個執行個體。</span><span class="sxs-lookup"><span data-stu-id="46de1-152">Autoscale scales out adding a 3rd instance.</span></span>
3. <span data-ttu-id="46de1-153">接下來，假設 hello 平均執行緒計數，跨執行個體落 too575。</span><span class="sxs-lookup"><span data-stu-id="46de1-153">Next, assume that hello average thread count across instance falls too575.</span></span>
4. <span data-ttu-id="46de1-154">向下調整，之前，先自動調整規模會嘗試 tooestimate 哪些 hello 最終狀態將會是如果它以進行縮放。</span><span class="sxs-lookup"><span data-stu-id="46de1-154">Before scaling down, autoscale tries tooestimate what hello final state will be if it scaled in.</span></span> <span data-ttu-id="46de1-155">例如，575 x 3 (目前的執行個體計數) = 1,725 / 2 (相應減少後的最終執行個體數) = 862.5 個執行緒。</span><span class="sxs-lookup"><span data-stu-id="46de1-155">For example, 575 x  3 (current instance count) = 1,725 / 2 (final number of instances when scaled down) = 862.5 threads.</span></span> <span data-ttu-id="46de1-156">這表示自動調整規模會有向外延展 tooimmediately 再次即使它在中，調整 hello 平均執行緒計數會維持為 hello 相同或甚至落只有少量。</span><span class="sxs-lookup"><span data-stu-id="46de1-156">This means autoscale would have tooimmediately scale-out again even after it scaled in, if hello average thread count remains hello same or even falls only a small amount.</span></span> <span data-ttu-id="46de1-157">不過，如果它向上同樣地，請重複 hello 整個程序，導致 tooan 無限迴圈。</span><span class="sxs-lookup"><span data-stu-id="46de1-157">However, if it scaled up again, hello whole process would repeat, leading tooan infinite loop.</span></span>
5. <span data-ttu-id="46de1-158">tooavoid 這種情況下 （稱為 「 拍打"），自動調整規模並不向下調整完全。</span><span class="sxs-lookup"><span data-stu-id="46de1-158">tooavoid this situation (termed "flapping"), autoscale does not scale down at all.</span></span> <span data-ttu-id="46de1-159">相反地，它會略過，並會重新評估 hello 條件一次執行 hello 下一個時間 hello 服務的作業。</span><span class="sxs-lookup"><span data-stu-id="46de1-159">Instead, it skips and reevaluates hello condition again hello next time hello service's job executes.</span></span> <span data-ttu-id="46de1-160">這可能會因為 575 hello 平均執行緒計數時，自動調整不會出現 toowork 感到困惑許多人。</span><span class="sxs-lookup"><span data-stu-id="46de1-160">This could confuse many people because autoscale wouldn't appear toowork when hello average thread count was 575.</span></span>

<span data-ttu-id="46de1-161">小數位數在期間的估計是預定的 tooavoid"出現 flapping 的現象 」 的情況下，在標尺和向外延展動作持續在哪裡來回。</span><span class="sxs-lookup"><span data-stu-id="46de1-161">Estimation during a scale-in is intended tooavoid "flapping" situations, where scale-in and scale-out actions continually go back and forth.</span></span> <span data-ttu-id="46de1-162">當您選擇 hello 向外延展且有相同的臨界值時，請記住這種行為。</span><span class="sxs-lookup"><span data-stu-id="46de1-162">Keep this behavior in mind when you choose hello same thresholds for scale-out and in.</span></span>

<span data-ttu-id="46de1-163">我們建議您選擇適當的邊界，向外延展 hello 與在臨界值。</span><span class="sxs-lookup"><span data-stu-id="46de1-163">We recommend choosing an adequate margin between hello scale-out and in thresholds.</span></span> <span data-ttu-id="46de1-164">例如，請考慮下列更好的規則組合的 hello。</span><span class="sxs-lookup"><span data-stu-id="46de1-164">As an example, consider hello following better rule combination.</span></span>

* <span data-ttu-id="46de1-165">當 CPU% >= 80 時，增加 1 個執行個體</span><span class="sxs-lookup"><span data-stu-id="46de1-165">Increase instances by 1 count when CPU%  >= 80</span></span>
* <span data-ttu-id="46de1-166">當 CPU% <= 60 時，減少 1 個執行個體</span><span class="sxs-lookup"><span data-stu-id="46de1-166">Decrease instances by 1 count when CPU% <= 60</span></span>

<span data-ttu-id="46de1-167">在此案例中</span><span class="sxs-lookup"><span data-stu-id="46de1-167">In this case</span></span>  

1. <span data-ttu-id="46de1-168">假設有與 2 的執行個體 toostart。</span><span class="sxs-lookup"><span data-stu-id="46de1-168">Assume there are 2 instances toostart with.</span></span>
2. <span data-ttu-id="46de1-169">如果在執行個體之間 hello 平均 CPU %too80，自動調整縮放出加入的第三個執行個體。</span><span class="sxs-lookup"><span data-stu-id="46de1-169">If hello average CPU% across instances goes too80, autoscale scales out adding a third instance.</span></span>
3. <span data-ttu-id="46de1-170">現在，假設一段時間 hello CPU %落 too60。</span><span class="sxs-lookup"><span data-stu-id="46de1-170">Now assume that over time hello CPU% falls too60.</span></span>
4. <span data-ttu-id="46de1-171">自動調整規模的小數位數的規則評估 hello 最終狀態 tooscale 中一樣。</span><span class="sxs-lookup"><span data-stu-id="46de1-171">Autoscale's scale-in rule estimates hello final state if it were tooscale-in.</span></span> <span data-ttu-id="46de1-172">例如 60x3 (目前的執行個體計數) = 180/2 (相應減少時的最終執行個體數) = 90。</span><span class="sxs-lookup"><span data-stu-id="46de1-172">For example, 60 x 3 (current instance count) = 180 / 2 (final number of instances when scaled down) = 90.</span></span> <span data-ttu-id="46de1-173">因此自動調整規模不小數位數在因為它會立即再次有 tooscale 外。</span><span class="sxs-lookup"><span data-stu-id="46de1-173">So autoscale does not scale-in because it would have tooscale-out again immediately.</span></span> <span data-ttu-id="46de1-174">而會略過相應減少。</span><span class="sxs-lookup"><span data-stu-id="46de1-174">Instead, it skips scaling down.</span></span>
5. <span data-ttu-id="46de1-175">檢查 hello 下一次自動調整規模，hello CPU 繼續 toofall too50。</span><span class="sxs-lookup"><span data-stu-id="46de1-175">hello next time autoscale checks, hello CPU continues toofall too50.</span></span> <span data-ttu-id="46de1-176">它會評估一次-50 x 3 執行個體類別 = 150 / 2 執行個體 = 75，低於 hello 向外延展的臨界值為 80，所以它縮放成功 too2 執行個體中。</span><span class="sxs-lookup"><span data-stu-id="46de1-176">It estimates again -  50 x 3 instance = 150 / 2 instances = 75, which is below hello scale-out threshold of 80, so it scales in successfully too2 instances.</span></span>

### <a name="considerations-for-scaling-threshold-values-for-special-metrics"></a><span data-ttu-id="46de1-177">調整特殊度量之臨界值時的注意事項</span><span class="sxs-lookup"><span data-stu-id="46de1-177">Considerations for scaling threshold values for special metrics</span></span>
 <span data-ttu-id="46de1-178">針對特殊度量資訊，例如儲存體或服務匯流排佇列長度 」 指標，hello 臨界值會是 hello 訊息平均數目使用每個執行個體的目前數目。</span><span class="sxs-lookup"><span data-stu-id="46de1-178">For special metrics such as Storage or Service Bus Queue length metric, hello threshold is hello average number of messages available per current number of instances.</span></span> <span data-ttu-id="46de1-179">請小心選擇 hello 選擇 hello 臨界值，此度量。</span><span class="sxs-lookup"><span data-stu-id="46de1-179">Carefully choose hello choose hello threshold value for this metric.</span></span>

<span data-ttu-id="46de1-180">讓我們將其說明您了解與範例 tooensure hello 行為更好。</span><span class="sxs-lookup"><span data-stu-id="46de1-180">Let's illustrate it with an example tooensure you understand hello behavior better.</span></span>

* <span data-ttu-id="46de1-181">當儲存體佇列訊息計數 >= 50 時，增加 1 個執行個體</span><span class="sxs-lookup"><span data-stu-id="46de1-181">Increase instances by 1 count when Storage Queue message count >= 50</span></span>
* <span data-ttu-id="46de1-182">當儲存體佇列訊息計數 <= 10 時，減少 1 個執行個體</span><span class="sxs-lookup"><span data-stu-id="46de1-182">Decrease instances by 1 count when Storage Queue message count <= 10</span></span>

<span data-ttu-id="46de1-183">請考慮下列順序的 hello:</span><span class="sxs-lookup"><span data-stu-id="46de1-183">Consider hello following sequence:</span></span>

1. <span data-ttu-id="46de1-184">有 2 個儲存體佇列執行個體。</span><span class="sxs-lookup"><span data-stu-id="46de1-184">There are 2 storage queue instances.</span></span>
2. <span data-ttu-id="46de1-185">訊息保留下來，當您檢閱 hello 儲存體佇列，hello 總計數讀取 50。</span><span class="sxs-lookup"><span data-stu-id="46de1-185">Messages keep coming and when you review hello storage queue, hello total count reads 50.</span></span> <span data-ttu-id="46de1-186">您可能認為自動調整應執行相應放大動作。</span><span class="sxs-lookup"><span data-stu-id="46de1-186">You might assume that autoscale should start a scale-out action.</span></span> <span data-ttu-id="46de1-187">但請注意，自動調整仍然是每個執行個體 50/2 =  25 則訊息，</span><span class="sxs-lookup"><span data-stu-id="46de1-187">However, note that it is still 50/2 = 25 messages per instance.</span></span> <span data-ttu-id="46de1-188">因此不會進行相應放大。</span><span class="sxs-lookup"><span data-stu-id="46de1-188">So, scale-out does not occur.</span></span> <span data-ttu-id="46de1-189">第一個向外延展 toohappen hello，hello 儲存體佇列中的 hello 訊息總數應該是 100。</span><span class="sxs-lookup"><span data-stu-id="46de1-189">For hello first scale-out toohappen, hello total message count in hello storage queue should be 100.</span></span>
3. <span data-ttu-id="46de1-190">接下來，假設 hello 的總訊息計數達到 100。</span><span class="sxs-lookup"><span data-stu-id="46de1-190">Next, assume that hello total message count reaches 100.</span></span>
4. <span data-ttu-id="46de1-191">由於 tooa 向外延展動作加入的第 3 個儲存體佇列執行個體。</span><span class="sxs-lookup"><span data-stu-id="46de1-191">A 3rd storage queue instance is added due tooa scale-out action.</span></span>  <span data-ttu-id="46de1-192">hello 下一個向外延展動作就不會進行直到 hello 總 hello 佇列中的訊息計數達到 150，因為 150/3 = 50。</span><span class="sxs-lookup"><span data-stu-id="46de1-192">hello next scale-out action will not happen until hello total message count in hello queue reaches 150 because 150/3 = 50.</span></span>
5. <span data-ttu-id="46de1-193">現在 hello hello 佇列中的訊息數目會變小。</span><span class="sxs-lookup"><span data-stu-id="46de1-193">Now hello number of messages in hello queue gets smaller.</span></span> <span data-ttu-id="46de1-194">3 個執行個體，與 hello 第一個標尺的動作時發生 hello 中所有佇列的訊息總數相加 too30 因為 30/3 = 每個執行個體，也就是 hello 小數位數的臨界值的 10 個訊息。</span><span class="sxs-lookup"><span data-stu-id="46de1-194">With 3 instances, hello first scale-in action happens when hello total messages in all queues add up too30 because 30/3 = 10 messages per instance, which is hello scale-in threshold.</span></span>

### <a name="considerations-for-scaling-when-multiple-profiles-are-configured-in-an-autoscale-setting"></a><span data-ttu-id="46de1-195">當自動調整設定中設有多個設定檔時的調整注意事項</span><span class="sxs-lookup"><span data-stu-id="46de1-195">Considerations for scaling when multiple profiles are configured in an autoscale setting</span></span>
<span data-ttu-id="46de1-196">您可以在自動調整設定中選擇預設設定檔 (當沒有任何項目取決於排程或時間時套用)，也可以選擇週期性設定檔或期間固定的設定檔 (設有日期與時間範圍)。</span><span class="sxs-lookup"><span data-stu-id="46de1-196">In an autoscale setting, you can choose a default profile, which is always applied without any dependency on schedule or time, or you can choose a recurring profile or a profile for a fixed period with a date and time range.</span></span>

<span data-ttu-id="46de1-197">當自動調整規模服務處理它們時，它一定會檢查在 hello 順序：</span><span class="sxs-lookup"><span data-stu-id="46de1-197">When autoscale service processes them, it always checks in hello following order:</span></span>

1. <span data-ttu-id="46de1-198">固定日期設定檔</span><span class="sxs-lookup"><span data-stu-id="46de1-198">Fixed Date profile</span></span>
2. <span data-ttu-id="46de1-199">週期性設定檔</span><span class="sxs-lookup"><span data-stu-id="46de1-199">Recurring profile</span></span>
3. <span data-ttu-id="46de1-200">預設 (一律) 設定檔</span><span class="sxs-lookup"><span data-stu-id="46de1-200">Default ("Always") profile</span></span>

<span data-ttu-id="46de1-201">如果設定檔條件符合時，自動調整不會檢查其下的 hello 下一個設定檔條件。</span><span class="sxs-lookup"><span data-stu-id="46de1-201">If a profile condition is met, autoscale does not check hello next profile condition below it.</span></span> <span data-ttu-id="46de1-202">自動調整一次只會處理一個設定檔。</span><span class="sxs-lookup"><span data-stu-id="46de1-202">Autoscale only processes one profile at a time.</span></span> <span data-ttu-id="46de1-203">這表示如果您想 tooalso 包括處理條件，從較低層設定檔，您必須在 hello 目前的設定檔，以及包含這些規則。</span><span class="sxs-lookup"><span data-stu-id="46de1-203">This means if you want tooalso include a processing condition from a lower-tier profile, you must include those rules as well in hello current profile.</span></span>

<span data-ttu-id="46de1-204">請參考下列示範範例︰</span><span class="sxs-lookup"><span data-stu-id="46de1-204">Let's review this using an example:</span></span>

<span data-ttu-id="46de1-205">hello 圖顯示自動調整規模設定具有預設的設定檔的最小執行個體 = 2 和最大執行個體 = 10。</span><span class="sxs-lookup"><span data-stu-id="46de1-205">hello image below shows an autoscale setting with a default profile of minimum instances = 2 and maximum instances = 10.</span></span> <span data-ttu-id="46de1-206">在此範例中，規則時設定的 tooscale 外 hello 佇列中的 hello 訊息計數大於 10，小數位數在 hello 佇列中的 hello 訊息計數小於 3 時。</span><span class="sxs-lookup"><span data-stu-id="46de1-206">In this example, rules are configured tooscale-out when hello message count in hello queue is greater than 10 and scale-in when hello message count in hello queue is less than 3.</span></span> <span data-ttu-id="46de1-207">因此，現在 hello 資源可以調整 2 到 10 個執行個體之間。</span><span class="sxs-lookup"><span data-stu-id="46de1-207">So now hello resource can scale between 2 and 10 instances.</span></span>

<span data-ttu-id="46de1-208">此外，星期一設定成使用週期性設定檔，</span><span class="sxs-lookup"><span data-stu-id="46de1-208">In addition, there is a recurring profile set for Monday.</span></span> <span data-ttu-id="46de1-209">其中最小執行個體數 = 2，最大執行個體數 = 12。</span><span class="sxs-lookup"><span data-stu-id="46de1-209">It is set for minimum instances = 2 and maximum instances = 12.</span></span> <span data-ttu-id="46de1-210">這表示在星期一，hello 第一次自動調整規模會檢查這個條件，如果 hello 執行個體計數為 2，擴充為 3 toohello 新的最小。</span><span class="sxs-lookup"><span data-stu-id="46de1-210">This means on Monday, hello first time autoscale checks for this condition, if hello instance count is 2, it scales toohello new minimum of 3.</span></span> <span data-ttu-id="46de1-211">只要自動調整規模繼續進行此設定檔狀況比對 (Monday) toofind，它只會處理 hello CPU 型標尺出/入規則設定此設定檔。</span><span class="sxs-lookup"><span data-stu-id="46de1-211">As long as autoscale continues toofind this profile condition matched (Monday), it only processes hello CPU-based scale-out/in rules configured for this profile.</span></span> <span data-ttu-id="46de1-212">此時，它不會檢查 hello 佇列長度。</span><span class="sxs-lookup"><span data-stu-id="46de1-212">At this time, it does not check for hello queue length.</span></span> <span data-ttu-id="46de1-213">不過，如果您也想 hello 佇列長度條件 toobe 檢查，您應該包含這些規則從 hello 預設設定檔以及星期一設定檔中。</span><span class="sxs-lookup"><span data-stu-id="46de1-213">However, if you also want hello queue length condition toobe checked, you should include those rules from hello default profile as well in your Monday profile.</span></span>

<span data-ttu-id="46de1-214">同樣地，當自動調整規模切換後 toohello 預設設定檔時，它會先檢查是否 hello 最小和最大值符合條件的情況。</span><span class="sxs-lookup"><span data-stu-id="46de1-214">Similarly, when autoscale switches back toohello default profile, it first checks if hello minimum and maximum conditions are met.</span></span> <span data-ttu-id="46de1-215">如果在 hello 階段的執行個體的 hello 數目為 12，它縮放中 too10，hello 最大允許 hello 預設設定檔。</span><span class="sxs-lookup"><span data-stu-id="46de1-215">If hello number of instances at hello time is 12, it scales in too10, hello maximum allowed for hello default profile.</span></span>

![自動調整設定](./media/insights-autoscale-best-practices/insights-autoscale-best-practices-2.png)

### <a name="considerations-for-scaling-when-multiple-rules-are-configured-in-a-profile"></a><span data-ttu-id="46de1-217">當設定檔中設有多項規則時的調整注意事項</span><span class="sxs-lookup"><span data-stu-id="46de1-217">Considerations for scaling when multiple rules are configured in a profile</span></span>
<span data-ttu-id="46de1-218">有可能 tooset 多個規則中有一個設定檔的情況。</span><span class="sxs-lookup"><span data-stu-id="46de1-218">There are cases where you may have tooset multiple rules in a profile.</span></span> <span data-ttu-id="46de1-219">服務會使用設定多個規則時，會使用下列一組自動調整規模規則的 hello。</span><span class="sxs-lookup"><span data-stu-id="46de1-219">hello following set of autoscale rules are used by services use when multiple rules are set.</span></span>

<span data-ttu-id="46de1-220">對於「相應放大」，自動調整會在符合任何規則時執行。</span><span class="sxs-lookup"><span data-stu-id="46de1-220">On *scale out*, autoscale runs if any rule is met.</span></span>
<span data-ttu-id="46de1-221">在*標尺中*，自動調整規模要求 toobe 符合的所有規則。</span><span class="sxs-lookup"><span data-stu-id="46de1-221">On *scale-in*, autoscale require all rules toobe met.</span></span>

<span data-ttu-id="46de1-222">tooillustrate，假設您有下列 4 的自動調整規模規則的 hello:</span><span class="sxs-lookup"><span data-stu-id="46de1-222">tooillustrate, assume that you have hello following 4 autoscale rules:</span></span>

* <span data-ttu-id="46de1-223">當 CPU < 30% 時相應縮小 1</span><span class="sxs-lookup"><span data-stu-id="46de1-223">If CPU < 30 %, scale-in by 1</span></span>
* <span data-ttu-id="46de1-224">當記憶體 < 50% 時相應縮小 1​</span><span class="sxs-lookup"><span data-stu-id="46de1-224">If Memory < 50%, scale-in by 1</span></span>
* <span data-ttu-id="46de1-225">當 CPU > 75% 時相應放大 1</span><span class="sxs-lookup"><span data-stu-id="46de1-225">If CPU > 75%, scale-out by 1</span></span>
* <span data-ttu-id="46de1-226">當記憶體 > 75% 時相應放大 1​</span><span class="sxs-lookup"><span data-stu-id="46de1-226">If Memory > 75%, scale-out by 1</span></span>

<span data-ttu-id="46de1-227">然後就會發生 hello 遵循：</span><span class="sxs-lookup"><span data-stu-id="46de1-227">Then hello follow occurs:</span></span>

* <span data-ttu-id="46de1-228">當 CPU 為 76%，記憶體為 50% 時，會相應放大。</span><span class="sxs-lookup"><span data-stu-id="46de1-228">If CPU is 76% and Memory is 50%, we scale-out.</span></span>
* <span data-ttu-id="46de1-229">當 CPU 為 50%，記憶體為 76% 時，會相應放大。</span><span class="sxs-lookup"><span data-stu-id="46de1-229">If CPU is 50% and Memory is 76% we scale-out.</span></span>

<span data-ttu-id="46de1-230">如果 CPU 是 25%且記憶體 51%的自動調整規模並在 hello 相反地，**不**小數位數中。</span><span class="sxs-lookup"><span data-stu-id="46de1-230">On hello other hand, if CPU is 25% and memory is 51% autoscale does **not** scale-in.</span></span> <span data-ttu-id="46de1-231">為了 tooscale 中，CPU 必須 29%和記憶體 49%。</span><span class="sxs-lookup"><span data-stu-id="46de1-231">In order tooscale-in, CPU must be 29% and Memory 49%.</span></span>

### <a name="always-select-a-safe-default-instance-count"></a><span data-ttu-id="46de1-232">請一律選取安全的預設執行個體計數</span><span class="sxs-lookup"><span data-stu-id="46de1-232">Always select a safe default instance count</span></span>
<span data-ttu-id="46de1-233">hello 預設執行個體計數是重要度量都無法使用時，自動調整規模調整您服務 toothat 計數。</span><span class="sxs-lookup"><span data-stu-id="46de1-233">hello default instance count is important autoscale scales your service toothat count when metrics are not available.</span></span> <span data-ttu-id="46de1-234">因此，請選取對您工作負載而言最安全的預設執行個體計數。</span><span class="sxs-lookup"><span data-stu-id="46de1-234">Therefore, select a default instance count that's safe for your workloads.</span></span>

### <a name="configure-autoscale-notifications"></a><span data-ttu-id="46de1-235">設定自動調整通知</span><span class="sxs-lookup"><span data-stu-id="46de1-235">Configure autoscale notifications</span></span>
<span data-ttu-id="46de1-236">自動調整規模通知 hello 系統管理員和參與者的 hello 資源以電子郵件如果發生任何 hello 下列條件：</span><span class="sxs-lookup"><span data-stu-id="46de1-236">Autoscale notifies hello administrators and contributors of hello resource by email if any of hello following conditions occur:</span></span>

* <span data-ttu-id="46de1-237">自動調整規模服務失敗 tootake 動作。</span><span class="sxs-lookup"><span data-stu-id="46de1-237">autoscale service fails tootake an action.</span></span>
* <span data-ttu-id="46de1-238">度量不適用於自動調整規模服務 toomake 標尺決策。</span><span class="sxs-lookup"><span data-stu-id="46de1-238">Metrics are not available for autoscale service toomake a scale decision.</span></span>
* <span data-ttu-id="46de1-239">度量資訊是可用 （復原） 再次 toomake 標尺決策。</span><span class="sxs-lookup"><span data-stu-id="46de1-239">Metrics are available (recovery) again toomake a scale decision.</span></span>
  <span data-ttu-id="46de1-240">除了上述 toohello 條件，您可以設定電子郵件或 webhook 通知 tooget 收到成功的調整動作的通知。</span><span class="sxs-lookup"><span data-stu-id="46de1-240">In addition toohello conditions above, you can configure email or webhook notifications tooget notified for successful scale actions.</span></span>
  
<span data-ttu-id="46de1-241">您也可以使用 hello 自動調整引擎的活動記錄檔警示 toomonitor hello 健全狀況。</span><span class="sxs-lookup"><span data-stu-id="46de1-241">You can also use an Activity Log alert toomonitor hello health of hello autoscale engine.</span></span> <span data-ttu-id="46de1-242">以下是範例太[訂用帳戶上的所有自動調整引擎作業建立活動記錄警示 toomonitor](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert)或太[建立活動記錄警示 toomonitor 所有無法在自動調整規模 / 上縮放作業您的訂用帳戶](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert)。</span><span class="sxs-lookup"><span data-stu-id="46de1-242">Here are examples too[create an Activity Log Alert toomonitor all autoscale engine operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) or too[create an Activity Log Alert toomonitor all failed autoscale scale in/scale out operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span></span>

## <a name="next-steps"></a><span data-ttu-id="46de1-243">後續步驟</span><span class="sxs-lookup"><span data-stu-id="46de1-243">Next Steps</span></span>
- [<span data-ttu-id="46de1-244">建立活動記錄警示 toomonitor 訂用帳戶上的所有自動調整引擎作業。</span><span class="sxs-lookup"><span data-stu-id="46de1-244">Create an Activity Log Alert toomonitor all autoscale engine operations on your subscription.</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert)
- [<span data-ttu-id="46de1-245">建立活動記錄警示 toomonitor 所有無法在自動調整規模 / 調整您的訂用帳戶的作業</span><span class="sxs-lookup"><span data-stu-id="46de1-245">Create an Activity Log Alert toomonitor all failed autoscale scale in/scale out operations on your subscription</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert)
