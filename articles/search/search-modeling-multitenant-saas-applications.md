---
title: "在 Azure 搜尋服務中建立多租用戶模型 | Microsoft Docs"
description: "了解使用「Azure 搜尋服務」時常見的多租用戶 SaaS 應用程式設計模式。"
services: search
manager: jhubbard
author: ashmaka
documentationcenter: 
ms.assetid: 72e9696a-553b-47dc-9e05-a82db0ebf094
ms.service: search
ms.devlang: NA
ms.workload: search
ms.topic: article
ms.tgt_pltfrm: na
ms.date: 10/26/2016
ms.author: ashmaka
ms.openlocfilehash: fd1b0c7cc8210d27fdc500bf4e5641bedfe93cff
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/11/2017
---
# <a name="design-patterns-for-multitenant-saas-applications-and-azure-search"></a><span data-ttu-id="d3e0c-103">多租用戶 SaaS 應用程式與 Azure 搜尋服務的設計模式</span><span class="sxs-lookup"><span data-stu-id="d3e0c-103">Design patterns for multitenant SaaS applications and Azure Search</span></span>
<span data-ttu-id="d3e0c-104">多租用戶應用程式是為不能查看或共用任何其他租用戶之資料的租用戶提供相同服務和功能的應用程式，其中租用戶的數目並無限制。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-104">A multitenant application is one that provides the same services and capabilities to any number of tenants who cannot see or share the data of any other tenant.</span></span> <span data-ttu-id="d3e0c-105">本文件將討論以「Azure 搜尋服務」建置的多租用戶應用程式的租用戶隔離策略。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-105">This document discusses tenant isolation strategies for multitenant applications built with Azure Search.</span></span>

## <a name="azure-search-concepts"></a><span data-ttu-id="d3e0c-106">Azure 搜尋服務概念</span><span class="sxs-lookup"><span data-stu-id="d3e0c-106">Azure Search concepts</span></span>
<span data-ttu-id="d3e0c-107">「Azure 搜尋服務」是一個搜尋即服務解決方案，可讓開發人員不需管理任何基礎結構或成為搜尋專家，就能夠將豐富的搜尋體驗新增到應用程式中。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-107">As a search-as-a-service solution, Azure Search allows developers to add rich search experiences to applications without managing any infrastructure or becoming an expert in search.</span></span> <span data-ttu-id="d3e0c-108">資料會上傳至服務，然後儲存在雲端。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-108">Data is uploaded to the service and then stored in the cloud.</span></span> <span data-ttu-id="d3e0c-109">使用對「Azure 搜尋服務」API 的簡單要求，接著便可修改及搜尋資料。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-109">Using simple requests to the Azure Search API, the data can then be modified and searched.</span></span> <span data-ttu-id="d3e0c-110">如需此服務的概觀，請參閱 [這篇文章](http://aka.ms/whatisazsearch)。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-110">An overview of the service can be found in [this article](http://aka.ms/whatisazsearch).</span></span> <span data-ttu-id="d3e0c-111">在討論設計模式之前，請務必了解「Azure 搜尋服務」的一些概念。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-111">Before discussing design patterns, it is important to understand some concepts in Azure Search.</span></span>

### <a name="search-services-indexes-fields-and-documents"></a><span data-ttu-id="d3e0c-112">搜尋服務、索引、欄位及文件</span><span class="sxs-lookup"><span data-stu-id="d3e0c-112">Search services, indexes, fields, and documents</span></span>
<span data-ttu-id="d3e0c-113">使用「Azure 搜尋服務」時，使用者需訂閱「搜尋服務」 。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-113">When using Azure Search, one subscribes to a *search service*.</span></span> <span data-ttu-id="d3e0c-114">由於資料是上傳到「Azure 搜尋服務」，因此它會儲存在該搜尋服務內的「索引」  中。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-114">As data is uploaded to Azure Search, it is stored in an *index* within the search service.</span></span> <span data-ttu-id="d3e0c-115">單一服務內可能會有好幾個索引。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-115">There can be a number of indexes within a single service.</span></span> <span data-ttu-id="d3e0c-116">若要使用熟悉的資料庫概念，搜尋服務可以比喻為資料庫，而服務內的索引則可比喻為資料庫內的資料表。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-116">To use the familiar concepts of databases, the search service can be likened to a database while the indexes within a service can be likened to tables within a database.</span></span>

<span data-ttu-id="d3e0c-117">搜尋服務內的每個索引都有自己的結構描述，此結構描述是由一些可自訂的「欄位」 所定義。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-117">Each index within a search service has its own schema, which is defined by a number of customizable *fields*.</span></span> <span data-ttu-id="d3e0c-118">資料會以個別「文件」 的形式新增到「Azure 搜尋服務」索引中。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-118">Data is added to an Azure Search index in the form of individual *documents*.</span></span> <span data-ttu-id="d3e0c-119">每個文件都必須上傳至特定的索引，並且必須符合該索引的結構描述。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-119">Each document must be uploaded to a particular index and must fit that index's schema.</span></span> <span data-ttu-id="d3e0c-120">使用「Azure 搜尋服務」來搜尋資料時，會針對特定索引發出全文檢索搜尋查詢。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-120">When searching data using Azure Search, the full-text search queries are issued against a particular index.</span></span>  <span data-ttu-id="d3e0c-121">若要將這些概念比喻成資料庫的概念，則欄位可以比喻為資料表中的資料行，而文件則可以比喻為資料列。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-121">To compare these concepts to those of a database, fields can be likened to columns in a table and documents can be likened to rows.</span></span>

### <a name="scalability"></a><span data-ttu-id="d3e0c-122">延展性</span><span class="sxs-lookup"><span data-stu-id="d3e0c-122">Scalability</span></span>
<span data-ttu-id="d3e0c-123">「標準」 [定價層](https://azure.microsoft.com/pricing/details/search/) 中的任何「Azure 搜尋服務」服務都可以調整成兩個維度︰儲存體和可用性。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-123">Any Azure Search service in the Standard [pricing tier](https://azure.microsoft.com/pricing/details/search/) can scale in two dimensions: storage and availability.</span></span>

* <span data-ttu-id="d3e0c-124"> 來增加搜尋服務的儲存體。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-124">*Partitions* can be added to increase the storage of a search service.</span></span>
* <span data-ttu-id="d3e0c-125"> 可被新增到服務中，以增加搜尋服務所能處理的要求輸送量。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-125">*Replicas* can be added to a service to increase the throughput of requests that a search service can handle.</span></span>

<span data-ttu-id="d3e0c-126">新增及移除資料分割和複本將可讓搜尋服務的容量，隨著應用程式要求的資料量和流量成長。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-126">Adding and removing partitions and replicas at will allow the capacity of the search service to grow with the amount of data and traffic the application demands.</span></span> <span data-ttu-id="d3e0c-127">為了讓搜尋服務達到讀取 [SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/)，它將需要兩個複本。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-127">In order for a search service to achieve a read [SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/), it requires two replicas.</span></span> <span data-ttu-id="d3e0c-128">為了讓服務達到讀寫 [SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/)，它將需要三個複本。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-128">In order for a service to achieve a read-write [SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/), it requires three replicas.</span></span>

### <a name="service-and-index-limits-in-azure-search"></a><span data-ttu-id="d3e0c-129">Azure 搜尋服務中的服務和索引限制</span><span class="sxs-lookup"><span data-stu-id="d3e0c-129">Service and index limits in Azure Search</span></span>
<span data-ttu-id="d3e0c-130">Azure 搜尋服務有幾個不同的[定價層](https://azure.microsoft.com/pricing/details/search/)，每個層都有不同的[限制和配額](search-limits-quotas-capacity.md)。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-130">There are a few different [pricing tiers](https://azure.microsoft.com/pricing/details/search/) in Azure Search, each of the tiers has different [limits and quotas](search-limits-quotas-capacity.md).</span></span> <span data-ttu-id="d3e0c-131">這些限制當中有些在服務層級，有些在索引層級，有些則是在資料分割層級。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-131">Some of these limits are at the service-level, some are at the index-level, and some are at the partition-level.</span></span>

|  | <span data-ttu-id="d3e0c-132">基本</span><span class="sxs-lookup"><span data-stu-id="d3e0c-132">Basic</span></span> | <span data-ttu-id="d3e0c-133">Standard1</span><span class="sxs-lookup"><span data-stu-id="d3e0c-133">Standard1</span></span> | <span data-ttu-id="d3e0c-134">Standard2</span><span class="sxs-lookup"><span data-stu-id="d3e0c-134">Standard2</span></span> | <span data-ttu-id="d3e0c-135">Standard3</span><span class="sxs-lookup"><span data-stu-id="d3e0c-135">Standard3</span></span> | <span data-ttu-id="d3e0c-136">Standard3 HD</span><span class="sxs-lookup"><span data-stu-id="d3e0c-136">Standard3 HD</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="d3e0c-137">每項服務的複本數目上限</span><span class="sxs-lookup"><span data-stu-id="d3e0c-137">Maximum Replicas per Service</span></span> |<span data-ttu-id="d3e0c-138">3</span><span class="sxs-lookup"><span data-stu-id="d3e0c-138">3</span></span> |<span data-ttu-id="d3e0c-139">12</span><span class="sxs-lookup"><span data-stu-id="d3e0c-139">12</span></span> |<span data-ttu-id="d3e0c-140">12</span><span class="sxs-lookup"><span data-stu-id="d3e0c-140">12</span></span> |<span data-ttu-id="d3e0c-141">12</span><span class="sxs-lookup"><span data-stu-id="d3e0c-141">12</span></span> |<span data-ttu-id="d3e0c-142">12</span><span class="sxs-lookup"><span data-stu-id="d3e0c-142">12</span></span> |
| <span data-ttu-id="d3e0c-143">每項服務的資料分割數目上限</span><span class="sxs-lookup"><span data-stu-id="d3e0c-143">Maximum Partitions per Service</span></span> |<span data-ttu-id="d3e0c-144">1</span><span class="sxs-lookup"><span data-stu-id="d3e0c-144">1</span></span> |<span data-ttu-id="d3e0c-145">12</span><span class="sxs-lookup"><span data-stu-id="d3e0c-145">12</span></span> |<span data-ttu-id="d3e0c-146">12</span><span class="sxs-lookup"><span data-stu-id="d3e0c-146">12</span></span> |<span data-ttu-id="d3e0c-147">12</span><span class="sxs-lookup"><span data-stu-id="d3e0c-147">12</span></span> |<span data-ttu-id="d3e0c-148">1</span><span class="sxs-lookup"><span data-stu-id="d3e0c-148">1</span></span> |
| <span data-ttu-id="d3e0c-149">每項服務的搜尋單位數目上限 (複本數*資料分割數)</span><span class="sxs-lookup"><span data-stu-id="d3e0c-149">Maximum Search Units (Replicas*Partitions) per Service</span></span> |<span data-ttu-id="d3e0c-150">3</span><span class="sxs-lookup"><span data-stu-id="d3e0c-150">3</span></span> |<span data-ttu-id="d3e0c-151">36</span><span class="sxs-lookup"><span data-stu-id="d3e0c-151">36</span></span> |<span data-ttu-id="d3e0c-152">36</span><span class="sxs-lookup"><span data-stu-id="d3e0c-152">36</span></span> |<span data-ttu-id="d3e0c-153">36</span><span class="sxs-lookup"><span data-stu-id="d3e0c-153">36</span></span> |<span data-ttu-id="d3e0c-154">36 (最多 3 個資料分割)</span><span class="sxs-lookup"><span data-stu-id="d3e0c-154">36 (max 3 partitions)</span></span> |
| <span data-ttu-id="d3e0c-155">每項服務的文件數目上限</span><span class="sxs-lookup"><span data-stu-id="d3e0c-155">Maximum Documents per Service</span></span> |<span data-ttu-id="d3e0c-156">100 萬</span><span class="sxs-lookup"><span data-stu-id="d3e0c-156">1 million</span></span> |<span data-ttu-id="d3e0c-157">1 億 8000 萬</span><span class="sxs-lookup"><span data-stu-id="d3e0c-157">180 million</span></span> |<span data-ttu-id="d3e0c-158">7 億 2000 萬</span><span class="sxs-lookup"><span data-stu-id="d3e0c-158">720 million</span></span> |<span data-ttu-id="d3e0c-159">140 億</span><span class="sxs-lookup"><span data-stu-id="d3e0c-159">1.4 billion</span></span> |<span data-ttu-id="d3e0c-160">6 億</span><span class="sxs-lookup"><span data-stu-id="d3e0c-160">600 million</span></span> |
| <span data-ttu-id="d3e0c-161">每項服務的儲存體上限</span><span class="sxs-lookup"><span data-stu-id="d3e0c-161">Maximum Storage per Service</span></span> |<span data-ttu-id="d3e0c-162">2 GB</span><span class="sxs-lookup"><span data-stu-id="d3e0c-162">2 GB</span></span> |<span data-ttu-id="d3e0c-163">300 GB</span><span class="sxs-lookup"><span data-stu-id="d3e0c-163">300 GB</span></span> |<span data-ttu-id="d3e0c-164">1.2 TB</span><span class="sxs-lookup"><span data-stu-id="d3e0c-164">1.2 TB</span></span> |<span data-ttu-id="d3e0c-165">2.4 TB</span><span class="sxs-lookup"><span data-stu-id="d3e0c-165">2.4 TB</span></span> |<span data-ttu-id="d3e0c-166">600 GB</span><span class="sxs-lookup"><span data-stu-id="d3e0c-166">600 GB</span></span> |
| <span data-ttu-id="d3e0c-167">每個資料分割的文件數目上限</span><span class="sxs-lookup"><span data-stu-id="d3e0c-167">Maximum Documents per Partition</span></span> |<span data-ttu-id="d3e0c-168">100 萬</span><span class="sxs-lookup"><span data-stu-id="d3e0c-168">1 million</span></span> |<span data-ttu-id="d3e0c-169">1500 萬</span><span class="sxs-lookup"><span data-stu-id="d3e0c-169">15 million</span></span> |<span data-ttu-id="d3e0c-170">6000 萬</span><span class="sxs-lookup"><span data-stu-id="d3e0c-170">60 million</span></span> |<span data-ttu-id="d3e0c-171">1 億 2000 萬</span><span class="sxs-lookup"><span data-stu-id="d3e0c-171">120 million</span></span> |<span data-ttu-id="d3e0c-172">2 億</span><span class="sxs-lookup"><span data-stu-id="d3e0c-172">200 million</span></span> |
| <span data-ttu-id="d3e0c-173">每個資料分割的儲存體上限</span><span class="sxs-lookup"><span data-stu-id="d3e0c-173">Maximum Storage per Partition</span></span> |<span data-ttu-id="d3e0c-174">2 GB</span><span class="sxs-lookup"><span data-stu-id="d3e0c-174">2 GB</span></span> |<span data-ttu-id="d3e0c-175">25 GB</span><span class="sxs-lookup"><span data-stu-id="d3e0c-175">25 GB</span></span> |<span data-ttu-id="d3e0c-176">100 GB</span><span class="sxs-lookup"><span data-stu-id="d3e0c-176">100 GB</span></span> |<span data-ttu-id="d3e0c-177">200 GB</span><span class="sxs-lookup"><span data-stu-id="d3e0c-177">200 GB</span></span> |<span data-ttu-id="d3e0c-178">200 GB</span><span class="sxs-lookup"><span data-stu-id="d3e0c-178">200 GB</span></span> |
| <span data-ttu-id="d3e0c-179">每項服務的索引數目上限</span><span class="sxs-lookup"><span data-stu-id="d3e0c-179">Maximum Indexes per Service</span></span> |<span data-ttu-id="d3e0c-180">5</span><span class="sxs-lookup"><span data-stu-id="d3e0c-180">5</span></span> |<span data-ttu-id="d3e0c-181">50</span><span class="sxs-lookup"><span data-stu-id="d3e0c-181">50</span></span> |<span data-ttu-id="d3e0c-182">200</span><span class="sxs-lookup"><span data-stu-id="d3e0c-182">200</span></span> |<span data-ttu-id="d3e0c-183">200</span><span class="sxs-lookup"><span data-stu-id="d3e0c-183">200</span></span> |<span data-ttu-id="d3e0c-184">3000 (最多 1000 個索引/資料分割)</span><span class="sxs-lookup"><span data-stu-id="d3e0c-184">3000 (max 1000 indexes/partition)</span></span> |

#### <a name="s3-high-density"></a><span data-ttu-id="d3e0c-185">S3 高密度</span><span class="sxs-lookup"><span data-stu-id="d3e0c-185">S3 High Density'</span></span>
<span data-ttu-id="d3e0c-186">在「Azure 搜尋服務」的 S3 定價層中，有一個專門針對多租用戶案例設計的「高密度」(HD) 模式選項。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-186">In Azure Search’s S3 pricing tier, there is an option for the High Density (HD) mode designed specifically for multitenant scenarios.</span></span> <span data-ttu-id="d3e0c-187">在許多情況下，必須在單一服務下支援大量較小的租用戶，才能達到簡化和成本效益的好處。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-187">In many cases, it is necessary to support a large number of smaller tenants under a single service to achieve the benefits of simplicity and cost efficiency.</span></span>

<span data-ttu-id="d3e0c-188">S3 HD 會以使用資料分割相應放大索引的能力換取在單一服務中裝載更多索引的能力，來允許在單一搜尋服務的管理下封裝許多小型索引。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-188">S3 HD allows for the many small indexes to be packed under the management of a single search service by trading the ability to scale out indexes using partitions for the ability to host more indexes in a single service.</span></span>

<span data-ttu-id="d3e0c-189">具體而言，S3 服務可以擁有 1 到 200 個索引，總共可以裝載多達 14 億份文件。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-189">Concretely, an S3 service could have between 1 and 200 indexes that together could host up to 1.4 billion documents.</span></span> <span data-ttu-id="d3e0c-190">S3 HD 另一方面只會允許個別索引裝載多達 1 百萬份文件，但它可以在每個資料分割處理多達 1000 個索引 (每個服務多達 3000 個)，總計每個資料分割有 2 億份文件 (每個服務多達 6 億)。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-190">An S3 HD on the other hand would allow individual indexes to only go up to 1 million documents, but it can handle up to 1000 indexes per partition (up to 3000 per service) with a total document count of 200 million per partition (up to 600 million per service).</span></span>

## <a name="considerations-for-multitenant-applications"></a><span data-ttu-id="d3e0c-191">多租用戶應用程式的考量</span><span class="sxs-lookup"><span data-stu-id="d3e0c-191">Considerations for multitenant applications</span></span>
<span data-ttu-id="d3e0c-192">多租用戶應用程式必須有效地將資源分散到各個租用戶中，同時又在各個租用戶之間保留某種程度的隱私性。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-192">Multitenant applications must effectively distribute resources among the tenants while preserving some level of privacy between the various tenants.</span></span> <span data-ttu-id="d3e0c-193">設計這類應用程式的架構時，有幾個考量︰</span><span class="sxs-lookup"><span data-stu-id="d3e0c-193">There are a few considerations when designing the architecture for such an application:</span></span>

* <span data-ttu-id="d3e0c-194">*租用戶隔離︰* 應用程式開發人員需要採取適當措施，以確保沒有任何租用戶能夠在未經授權或不需要的情況下存取其他租用戶的資料。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-194">*Tenant isolation:* Application developers need to take appropriate measures to ensure that no tenants have unauthorized or unwanted access to the data of other tenants.</span></span> <span data-ttu-id="d3e0c-195">除了資料隱私性的觀點以外，租用戶隔離策略還需要有效的共用資源管理，以及對吵雜鄰居的防範。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-195">Beyond the perspective of data privacy, tenant isolation strategies require effective management of shared resources and protection from noisy neighbors.</span></span>
* <span data-ttu-id="d3e0c-196">*雲端資源成本︰* 與任何其他應用程式一樣，軟體解決方案作為多租用戶應用程式的元件，必須保有成本競爭力。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-196">*Cloud resource cost:* As with any other application, software solutions must remain cost competitive as a component of a multitenant application.</span></span>
* <span data-ttu-id="d3e0c-197">*操作輕鬆︰* 開發多租用戶架構時，對應用程式的作業與複雜性的影響是很重要的考量。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-197">*Ease of Operations:* When developing a multitenant architecture, the impact on the application's operations and complexity is an important consideration.</span></span> <span data-ttu-id="d3e0c-198">Azure 搜尋服務具有 [99.9% 的 SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/)。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-198">Azure Search has a [99.9% SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/).</span></span>
* <span data-ttu-id="d3e0c-199">*遍佈全球︰* 多租用戶應用程式可能需要有效地為分散在全球各地的租用戶提供服務。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-199">*Global footprint:* Multitenant applications may need to effectively serve tenants which are distributed across the globe.</span></span>
* <span data-ttu-id="d3e0c-200">*延展性︰* 應用程式開發人員需要考慮到要如何讓應用程式不要太複雜，而又要能設計應用程式來依租用戶數目及租用戶資料和工作負載大小做調整。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-200">*Scalability:* Application developers need to consider how they reconcile between maintaining a sufficiently low level of application complexity and designing the application to scale with number of tenants and the size of tenants' data and workload.</span></span>

<span data-ttu-id="d3e0c-201">「Azure 搜尋服務」提供一些可用來隔離租用戶資料和工作負載的界限。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-201">Azure Search offers a few boundaries that can be used to isolate tenants’ data and workload.</span></span>

## <a name="modeling-multitenancy-with-azure-search"></a><span data-ttu-id="d3e0c-202">使用 Azure 搜尋服務來建立多租用戶模型</span><span class="sxs-lookup"><span data-stu-id="d3e0c-202">Modeling multitenancy with Azure Search</span></span>
<span data-ttu-id="d3e0c-203">在多租用戶案例的情況中，應用程式開發人員會使用一或多個搜尋服務，然後將其租用戶劃分到服務、索引或兩者。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-203">In the case of a multitenant scenario, the application developer consumes one or more search services and divide their tenants among services, indexes, or both.</span></span> <span data-ttu-id="d3e0c-204">建立多租用戶案例模型時，「Azure 搜尋服務」有幾個常見的模式︰</span><span class="sxs-lookup"><span data-stu-id="d3e0c-204">Azure Search has a few common patterns when modeling a multitenant scenario:</span></span>

1. <span data-ttu-id="d3e0c-205">*每個租用戶都使用專屬索引︰* 每個租用戶在與其他租用戶共用的搜尋服務內都有自己的索引。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-205">*Index per tenant:* Each tenant has its own index within a search service that is shared with other tenants.</span></span>
2. <span data-ttu-id="d3e0c-206">*每個租用戶都使用專屬服務︰* 每個租用戶都有自己的專用「Azure 搜尋服務」服務，可提供最高層級的資料和工作負載分隔。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-206">*Service per tenant:* Each tenant has its own dedicated Azure Search service, offering highest level of data and workload separation.</span></span>
3. <span data-ttu-id="d3e0c-207">*兩者混合︰* 針對較大且較活躍的租用戶會指派專用服務，而針對較小的租用戶則會在共用服務內指派個別的索引。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-207">*Mix of both:* Larger, more-active tenants are assigned dedicated services while smaller tenants are assigned individual indexes within shared services.</span></span>

## <a name="1-index-per-tenant"></a><span data-ttu-id="d3e0c-208">1.每個租用戶都使用專屬索引</span><span class="sxs-lookup"><span data-stu-id="d3e0c-208">1. Index per tenant</span></span>
![「每個租用戶都使用專屬索引」模型的圖解](./media/search-modeling-multitenant-saas-applications/azure-search-index-per-tenant.png)

<span data-ttu-id="d3e0c-210">在「每個租用戶都使用專屬索引」模型中，多個租用戶會佔用單一的「Azure 搜尋服務」，其中每個租用戶都有自己的索引。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-210">In an index-per-tenant model, multiple tenants occupy a single Azure Search service where each tenant has their own index.</span></span>

<span data-ttu-id="d3e0c-211">租用戶可達到資料隔離的目的，因為所有搜尋要求和文件作業都是在「Azure 搜尋服務」的索引層級發出。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-211">Tenants achieve data isolation because all search requests and document operations are issued at an index level in Azure Search.</span></span> <span data-ttu-id="d3e0c-212">在應用程式層中，有需求感知，可將各個租用戶的流量導向到適當的索引，同時也管理所有租用戶的服務層級資源。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-212">In the application layer, there is the need awareness to direct the various tenants’ traffic to the proper indexes while also managing resources at the service level across all tenants.</span></span>

<span data-ttu-id="d3e0c-213">「每個租用戶都使用專屬索引」模型有一個關鍵屬性，就是能夠讓應用程式開發人員在應用程式的租用戶之間過度訂閱搜尋服務的容量。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-213">A key attribute of the index-per-tenant model is the ability for the application developer to oversubscribe the capacity of a search service among the application’s tenants.</span></span> <span data-ttu-id="d3e0c-214">如果租用戶的工作負載分配不平均，系統可以將最佳的租用戶組合分散到搜尋服務的各個索引，以因應一些非常活躍、耗用大量資源的租用戶需求，而同時仍為為數眾多但較不活躍的租用戶提供服務。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-214">If the tenants have an uneven distribution of workload, the optimal combination of tenants can be distributed across a search service’s indexes to accommodate a number of highly active, resource-intensive tenants while simultaneously serving a long tail of less active tenants.</span></span> <span data-ttu-id="d3e0c-215">取捨的結果是如果每個租用戶同時都非常活躍，此模型便無法處理。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-215">The trade-off is the inability of the model to handle situations where each tenant is concurrently highly active.</span></span>

<span data-ttu-id="d3e0c-216">「每個租用戶都使用專屬索引」模型提供了可變成本模型的基礎，其中需預先購置整個「Azure 搜尋服務」，然後再接著填入租用戶。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-216">The index-per-tenant model provides the basis for a variable cost model, where an entire Azure Search service is bought up-front and then subsequently filled with tenants.</span></span> <span data-ttu-id="d3e0c-217">這可讓您將未使用的容量指定給試用版和免費帳戶。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-217">This allows for unused capacity to be designated for trials and free accounts.</span></span>

<span data-ttu-id="d3e0c-218">對遍佈全球的應用程式來說，「每個租用戶都使用專屬索引」模型可能不是最有效率的模型。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-218">For applications with a global footprint, the index-per-tenant model may not be the most efficient.</span></span> <span data-ttu-id="d3e0c-219">如果應用程式的租用戶遍佈全球，每個區域可能就都需要個別的服務，而可能導致在各個區域產生重複的成本。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-219">If an application's tenants are distributed across the globe, a separate service may be necessary for each region which may duplicate costs across each of them.</span></span>

<span data-ttu-id="d3e0c-220">「Azure 搜尋服務」同時考量到了個別索引規模的擴大和索引總數的增加。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-220">Azure Search allows for the scale of both the individual indexes and the total number of indexes to grow.</span></span> <span data-ttu-id="d3e0c-221">如果選擇了適當的定價層，當服務內的個別索引在儲存體或流量方面成長得太大時，將可為整個搜尋服務新增資料分割和複本。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-221">If an appropriate pricing tier is chosen, partitions and replicas can be added to the entire search service when an individual index within the service grows too large in terms of storage or traffic.</span></span>

<span data-ttu-id="d3e0c-222">如果單一服務的索引總數成長得太大，則必須佈建另一個服務來容納新的租用戶。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-222">If the total number of indexes grows too large for a single service, another service has to be provisioned to accommodate the new tenants.</span></span> <span data-ttu-id="d3e0c-223">如果在新增新的服務時，必須在搜尋服務之間移動索引，您將必須手動將來自索引的資料從一個索引複製到另一個索引，因為「Azure 搜尋服務」並未考量到索引移動。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-223">If indexes have to be moved between search services as new services are added, the data from the index has to be manually copied from one index to the other as Azure Search does not allow for an index to be moved.</span></span>

## <a name="2-service-per-tenant"></a><span data-ttu-id="d3e0c-224">2.每個租用戶都使用專屬服務</span><span class="sxs-lookup"><span data-stu-id="d3e0c-224">2. Service per tenant</span></span>
![「每個租用戶都使用專屬服務」模型的圖解](./media/search-modeling-multitenant-saas-applications/azure-search-service-per-tenant.png)

<span data-ttu-id="d3e0c-226">在「每個租用戶都使用專屬服務」架構中，每個租用戶都有自己的搜尋服務。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-226">In a service-per-tenant architecture, each tenant has its own search service.</span></span>

<span data-ttu-id="d3e0c-227">在此模型中，應用程式可針對其租用戶達到最大程度的隔離。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-227">In this model, the application achieves the maximum level of isolation for its tenants.</span></span> <span data-ttu-id="d3e0c-228">每項服務除了有個別的 API 金鑰之外，還有專用的儲存體和輸送量來處理搜尋要求。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-228">Each service has dedicated storage and throughput for handling search request as well as separate API keys.</span></span>

<span data-ttu-id="d3e0c-229">如果應用程式的每個租用戶具有較大的使用量，或是租用戶之間的工作負載變化小，「每個租用戶都使用專屬服務」模型就是相當適當的選擇，因為資源不會在各個租用戶的工作負載之間共用。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-229">For applications where each tenant has a large footprint or the workload has little variability from tenant to tenant, the service-per-tenant model is an effective choice as resources are not shared across various tenants’ workloads.</span></span>

<span data-ttu-id="d3e0c-230">每個租用戶都使用專屬服務模型也提供可預測、固定成本模型的優點。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-230">A service per tenant model also offers the benefit of a predictable, fixed cost model.</span></span> <span data-ttu-id="d3e0c-231">整個搜尋服務在有租用戶填入之前，並不需要預先做任何投資，不過，每一租用戶的成本會高於「每個租用戶都使用專屬索引」模型。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-231">There is no up-front investment in an entire search service until there is a tenant to fill it, however the cost-per-tenant is higher than an index-per-tenant model.</span></span>

<span data-ttu-id="d3e0c-232">對遍佈全球的應用程式來說，「每個租用戶都使用專屬服務」模型是一個有效率的選擇。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-232">The service-per-tenant model is an efficient choice for applications with a global footprint.</span></span> <span data-ttu-id="d3e0c-233">當租用戶的地理位置相當分散時，讓每個租用戶的服務在適當的區域中相當簡單。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-233">With geographically-distributed tenants, it is easy to have each tenant's service in the appropriate region.</span></span>

<span data-ttu-id="d3e0c-234">當個別租用戶的成長速度超出其服務所能處理的範圍時，調整此模式的挑戰便隨之產生。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-234">The challenges in scaling this pattern arise when individual tenants outgrow their service.</span></span> <span data-ttu-id="d3e0c-235">「Azure 搜尋服務」目前不支援升級搜尋服務的定價層，因此所有資料都將必須手動複製到新的服務。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-235">Azure Search does not currently support upgrading the pricing tier of a search service, so all data would have to be manually copied to a new service.</span></span>

## <a name="3-mixing-both-models"></a><span data-ttu-id="d3e0c-236">3.混合兩種模型</span><span class="sxs-lookup"><span data-stu-id="d3e0c-236">3. Mixing both models</span></span>
<span data-ttu-id="d3e0c-237">建立多租用戶模型的另一種模式是將「每個租用戶都使用專屬索引」與「每個租用戶都使用專屬服務」策略混合。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-237">Another pattern for modeling multitenancy is mixing both index-per-tenant and service-per-tenant strategies.</span></span>

<span data-ttu-id="d3e0c-238">透過混合這兩種模式，應用程式的最大租用戶便可以佔用專用服務，而為數眾多的較不活躍且較小的租用戶則可以在共用服務中佔用索引。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-238">By mixing the two patterns, an application's largest tenants can occupy dedicated services while the long tail of less active, smaller tenants can occupy indexes in a shared service.</span></span> <span data-ttu-id="d3e0c-239">此模型可確保最大租用戶可以從服務一直享有高效能，同時又可協助保護較小的租用戶不受任何吵雜的鄰居干擾。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-239">This model ensures that the largest tenants have consistently high performance from the service while helping to protect the smaller tenants from any noisy neighbors.</span></span>

<span data-ttu-id="d3e0c-240">不過，實作此策略需要有遠見來預測哪些租用戶需要的是專用服務，而哪些租用戶需要的是共用服務中的索引。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-240">However, implementing this strategy relies foresight in predicting which tenants will require a dedicated service versus an index in a shared service.</span></span> <span data-ttu-id="d3e0c-241">當產生管理這兩個多租用戶模型的需求時，應用程式複雜性也隨之增加。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-241">Application complexity increases with the need to manage both of these multitenancy models.</span></span>

## <a name="achieving-even-finer-granularity"></a><span data-ttu-id="d3e0c-242">達到更精細的細微度</span><span class="sxs-lookup"><span data-stu-id="d3e0c-242">Achieving even finer granularity</span></span>
<span data-ttu-id="d3e0c-243">上述用來在「Azure 搜尋服務」中建立多租用戶案例模型的設計模式是假設一個一致的範圍，其中每個租用戶都是一個完整的應用程式執行個體。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-243">The above design patterns to model multitenant scenarios in Azure Search assume a uniform scope where each tenant is a whole instance of an application.</span></span> <span data-ttu-id="d3e0c-244">不過，應用程式有時可能是處理許多較小的範圍。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-244">However, applications can sometimes handle many smaller scopes.</span></span>

<span data-ttu-id="d3e0c-245">如果「每個租用戶都使用專屬服務」和「每個租用戶都使用專屬索引」模型的範圍不夠小，您可以建立索引模型來達到更精細的細微程度。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-245">If service-per-tenant and index-per-tenant models are not sufficiently small scopes, it is possible to model an index to achieve an even finer degree of granularity.</span></span>

<span data-ttu-id="d3e0c-246">若要讓單一索引針對不同的用戶端端點有不同的行為，您可以在索引中新增欄位來為每個可能的用戶端指定特定的值。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-246">To have a single index behave differently for different client endpoints, a field can be added to an index which designates a certain value for each possible client.</span></span> <span data-ttu-id="d3e0c-247">每次用戶端呼叫「Azure 搜尋服務」來查詢或修改索引時，來自用戶端應用程式的程式碼都會在查詢階段使用「Azure 搜尋服務」的 [篩選](https://msdn.microsoft.com/library/azure/dn798921.aspx) 功能，為該欄位指定適當的值。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-247">Each time a client calls Azure Search to query or modify an index, the code from the client application specifies the appropriate value for that field using Azure Search's [filter](https://msdn.microsoft.com/library/azure/dn798921.aspx) capability at query time.</span></span>

<span data-ttu-id="d3e0c-248">此方法可用來實現個別使用者帳戶的功能、分隔權限等級，甚至是完全分隔應用程式。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-248">This method can be used to achieve functionality of separate user accounts, separate permission levels, and even completely separate applications.</span></span>

> [!NOTE]
> <span data-ttu-id="d3e0c-249">使用上述方法來設定單一索引，為多個租用戶提供服務，進而影響搜尋結果的相關性。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-249">Using the approach described above to configure a single index to serve multiple tenants affects the relevance of search results.</span></span> <span data-ttu-id="d3e0c-250">搜尋相關性分數是在索引層級範圍計算，而不是在租用戶層級範圍計算，因此所有租用戶的資料都會併入相關性分數的基礎統計資料 (例如詞彙頻率)。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-250">Search relevance scores are computed at an index-level scope, not a tenant-level scope, so all tenants' data is incorporated in the relevance scores' underlying statistics such as term frequency.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="d3e0c-251">後續步驟</span><span class="sxs-lookup"><span data-stu-id="d3e0c-251">Next steps</span></span>
<span data-ttu-id="d3e0c-252">「Azure 搜尋服務」對許多應用程式而言是相當具吸引力的選擇，請 [深入了解此服務的強大功能](http://aka.ms/whatisazsearch)。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-252">Azure Search is a compelling choice for many applications, [read more about the service's robust capabilities](http://aka.ms/whatisazsearch).</span></span> <span data-ttu-id="d3e0c-253">評估多租用戶應用程式的各種設計模式時，請考量[各種定價層](https://azure.microsoft.com/pricing/details/search/)和個別的[服務限制](search-limits-quotas-capacity.md)，以便量身打造「Azure 搜尋服務」來配合各種規模的應用程式工作負載和架構。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-253">When evaluating the various design patterns for multitenant applications, consider the [various pricing tiers](https://azure.microsoft.com/pricing/details/search/) and the respective [service limits](search-limits-quotas-capacity.md) to best tailor Azure Search to fit application workloads and architectures of all sizes.</span></span>

<span data-ttu-id="d3e0c-254">如果您有任何關於「Azure 搜尋服務」和多租用戶案例的問題，都可以寄送郵件給 azuresearch_contact@microsoft.com。</span><span class="sxs-lookup"><span data-stu-id="d3e0c-254">Any questions about Azure Search and multitenant scenarios can be directed to azuresearch_contact@microsoft.com.</span></span>

