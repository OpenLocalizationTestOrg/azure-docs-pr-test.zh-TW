---
title: "分散式資料如何在 Azure SQL 資料倉儲運作 | Microsoft Docs"
description: "了解大量平行處理 (MPP) 如何分散資料，以及在 Azure SQL 資料倉儲和平行資料倉儲中分散資料表的選項。"
services: sql-data-warehouse
documentationcenter: NA
author: jrowlandjones
manager: jhubbard
editor: 
ms.assetid: bae494a6-7ac5-4c38-8ca3-ab2696c63a9f
ms.service: sql-data-warehouse
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-services
ms.custom: tables
ms.date: 07/12/2017
ms.author: jrj;barbkess
ms.openlocfilehash: 3c166acb17193caae32d7bad133ec510ff679353
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/03/2017
---
# <a name="distributed-data-and-distributed-tables-for-massively-parallel-processing-mpp"></a><span data-ttu-id="ef404-103">大量平行處理 (MPP) 的分散式資料和分散式資料表</span><span class="sxs-lookup"><span data-stu-id="ef404-103">Distributed data and distributed tables for Massively Parallel Processing (MPP)</span></span>
<span data-ttu-id="ef404-104">了解如何在 Microsoft 的大量平行處理 (MPP) 系統 Azure SQL 資料倉儲和平行資料倉儲中分散使用者資料。</span><span class="sxs-lookup"><span data-stu-id="ef404-104">Learn how user data is distributed in Azure SQL Data Warehouse and Parallel Data Warehouse, which are Microsoft's Massively Parallel Processing (MPP) systems.</span></span> <span data-ttu-id="ef404-105">設計您的資料倉儲以有效使用分散式資料，可協助您達成 MPP 架構的查詢處理優勢。</span><span class="sxs-lookup"><span data-stu-id="ef404-105">Designing your data warehouse to use distributed data effectively helps you to achieve the query processing benefits of the MPP architecture.</span></span> <span data-ttu-id="ef404-106">一些資料庫設計選擇可能會嚴重影響改善查詢效能。</span><span class="sxs-lookup"><span data-stu-id="ef404-106">A few database design choices can have a significant impact on improving query performance.</span></span>  

> [!NOTE]
> <span data-ttu-id="ef404-107">Azure SQL 資料倉儲和平行資料倉儲使用相同的大量平行處理 (MPP) 設計，但是由於基礎平台，它們會有一些差異。</span><span class="sxs-lookup"><span data-stu-id="ef404-107">Azure SQL Data Warehouse and Parallel Data Warehouse use the same Massively Parallel Processing (MPP) design, but they have a few differences because of the underlying platform.</span></span> <span data-ttu-id="ef404-108">SQL 資料倉儲是一種在 Azure 上執行的平台即服務 (PaaS)。</span><span class="sxs-lookup"><span data-stu-id="ef404-108">SQL Data Warehouse is a Platform as a Service (PaaS) that runs on Azure.</span></span> <span data-ttu-id="ef404-109">平行資料倉儲在分析平台系統 (AP) 上執行，也就是在 Windows Server 上執行的內部部署應用裝置。</span><span class="sxs-lookup"><span data-stu-id="ef404-109">Parallel Data Warehouse runs on Analytics Platform System (APS) which is an on-premises appliance that runs on Windows Server.</span></span>
> 
> 

## <a name="what-is-distributed-data"></a><span data-ttu-id="ef404-110">什麼是分散式資料？</span><span class="sxs-lookup"><span data-stu-id="ef404-110">What is distributed data?</span></span>
<span data-ttu-id="ef404-111">在 SQL 資料倉儲和平行資料倉儲中，分散式資料是指儲存在 MPP 系統多個位置的使用者資料。</span><span class="sxs-lookup"><span data-stu-id="ef404-111">In SQL Data Warehouse and Parallel Data Warehouse, distributed data refers to user data that is stored in multiple locations across the MPP system.</span></span> <span data-ttu-id="ef404-112">每個位置可做為獨立的儲存體運作，和在其一部分資料上執行查詢的處理單位。</span><span class="sxs-lookup"><span data-stu-id="ef404-112">Each of those locations functions as an independent storage and processing unit that runs queries on its portion of the data.</span></span> <span data-ttu-id="ef404-113">分散式資料是以平行方式執行查詢來達成高效能查詢的基礎。</span><span class="sxs-lookup"><span data-stu-id="ef404-113">Distributed data is fundamental to running queries in parallel to achieve high query performance.</span></span>

<span data-ttu-id="ef404-114">若要散發資料，資料倉儲會將使用者資料表的每個資料列指派至一個分散式位置。</span><span class="sxs-lookup"><span data-stu-id="ef404-114">To distribute data, the data warehouse assigns each row of a user table to one distributed location.</span></span>  <span data-ttu-id="ef404-115">您可以使用雜湊發佈方法或循環配置資源方法來散發資料表。</span><span class="sxs-lookup"><span data-stu-id="ef404-115">You can distribute tables with a hash-distribution method or a round-robin method.</span></span> <span data-ttu-id="ef404-116">發佈方法指定於 CREATE TABLE 陳述式中。</span><span class="sxs-lookup"><span data-stu-id="ef404-116">The distribution method is specified in the CREATE TABLE statement.</span></span> 

## <a name="hash-distributed-tables"></a><span data-ttu-id="ef404-117">雜湊分散式資料表</span><span class="sxs-lookup"><span data-stu-id="ef404-117">Hash-distributed tables</span></span>
<span data-ttu-id="ef404-118">下圖說明完整 (非分散式資料表) 會如何儲存為雜湊分散式資料表。</span><span class="sxs-lookup"><span data-stu-id="ef404-118">The following diagram illustrates how a full (non-distributed table) gets stored as a hash-distributed table.</span></span> <span data-ttu-id="ef404-119">具決定性的函式會將每個資料列指派給屬於一個發佈。</span><span class="sxs-lookup"><span data-stu-id="ef404-119">A deterministic function assigns each row to belong to one distribution.</span></span> <span data-ttu-id="ef404-120">在資料表定義中，其中一個資料行會指定為發佈資料行。</span><span class="sxs-lookup"><span data-stu-id="ef404-120">In the table definition, one of the columns is designated as the distribution column.</span></span> <span data-ttu-id="ef404-121">雜湊函式會使用發佈資料行中的值將每個資料列指派給發佈。</span><span class="sxs-lookup"><span data-stu-id="ef404-121">The hash function uses the value in the distribution column to assign each row to a distribution.</span></span>

<span data-ttu-id="ef404-122">選取發佈資料行有效能考量，例如區分、資料扭曲和在系統上執行的查詢類型。</span><span class="sxs-lookup"><span data-stu-id="ef404-122">There are performance considerations for the selection of a distribution column, such as distinctness, data skew, and the types of queries run on the system.</span></span>

<span data-ttu-id="ef404-123">![分散式資料表](media/sql-data-warehouse-distributed-data/hash-distributed-table.png "分散式資料表")</span><span class="sxs-lookup"><span data-stu-id="ef404-123">![Distributed table](media/sql-data-warehouse-distributed-data/hash-distributed-table.png "Distributed table")</span></span>  

* <span data-ttu-id="ef404-124">每個資料列屬於一種發佈。</span><span class="sxs-lookup"><span data-stu-id="ef404-124">Each row belongs to one distribution.</span></span>  
* <span data-ttu-id="ef404-125">具決定性的雜湊演算法會將每個資料列指派給一個發佈。</span><span class="sxs-lookup"><span data-stu-id="ef404-125">A deterministic hash algorithm assigns each row to one distribution.</span></span>  
* <span data-ttu-id="ef404-126">每個發佈的資料表資料列數目會隨著顯示不同資料表大小而有所不同。</span><span class="sxs-lookup"><span data-stu-id="ef404-126">The number of table rows per distribution varies as shown by the different sizes of tables.</span></span>

## <a name="round-robin-distributed-tables"></a><span data-ttu-id="ef404-127">循環配置資源分散式資料表</span><span class="sxs-lookup"><span data-stu-id="ef404-127">Round-robin distributed tables</span></span>
<span data-ttu-id="ef404-128">循環配置資源分散式資料表會發佈資料列，方法為以循序方式將每個資料列指派給發佈。</span><span class="sxs-lookup"><span data-stu-id="ef404-128">A round-robin distributed table distributes the rows by assigning each row to a distribution in a sequential manner.</span></span> <span data-ttu-id="ef404-129">將資料載入循環配置資源資料表很快速，但查詢效能可能會變慢。</span><span class="sxs-lookup"><span data-stu-id="ef404-129">It is quick to load data into a round-robin table, but query performance might be slower.</span></span>  <span data-ttu-id="ef404-130">將循環配置資源資料表合併通常需要改組，以讓查詢產生準確的結果，這會很花時間。</span><span class="sxs-lookup"><span data-stu-id="ef404-130">Joining a round-robin table usually requires reshuffling the rows to enable the query to produce an accurate result, which takes time.</span></span>

## <a name="distributed-storage-locations-are-called-distributions"></a><span data-ttu-id="ef404-131">分散式儲存體位置稱為發佈</span><span class="sxs-lookup"><span data-stu-id="ef404-131">Distributed storage locations are called distributions</span></span>
<span data-ttu-id="ef404-132">每個分散式位置稱為發佈。</span><span class="sxs-lookup"><span data-stu-id="ef404-132">Each distributed location is called a distribution.</span></span> <span data-ttu-id="ef404-133">當以平行方式執行查詢時，每個發佈會在其一部分的資料上執行 SQL 查詢。</span><span class="sxs-lookup"><span data-stu-id="ef404-133">When a query runs in parallel, each distribution performs a SQL query on its portion of the data.</span></span> <span data-ttu-id="ef404-134">SQL 資料倉儲會使用 SQL 資料庫執行查詢。</span><span class="sxs-lookup"><span data-stu-id="ef404-134">SQL Data Warehouse uses SQL Database to run the query.</span></span> <span data-ttu-id="ef404-135">平行資料倉儲會使用 SQL Server 執行查詢。</span><span class="sxs-lookup"><span data-stu-id="ef404-135">Parallel Data Warehouse uses SQL Server to run the query.</span></span> <span data-ttu-id="ef404-136">這種無共用架構設計是要達成向外延展平行運算的基礎。</span><span class="sxs-lookup"><span data-stu-id="ef404-136">This shared-nothing architecture design is fundamental to achieving scale-out parallel computing.</span></span>

### <a name="can-i-view-the-distributions"></a><span data-ttu-id="ef404-137">可以檢視發佈嗎？</span><span class="sxs-lookup"><span data-stu-id="ef404-137">Can I view the distributions?</span></span>
<span data-ttu-id="ef404-138">每個發佈有通訊群組 ID，且在有關 SQL 資料倉儲和平行資料倉儲的系統檢視中可以看見。</span><span class="sxs-lookup"><span data-stu-id="ef404-138">Each distribution has a distribution ID and is visible in system views that pertain to SQL Data Warehouse and Parallel Data Warehouse.</span></span> <span data-ttu-id="ef404-139">您可以使用發佈識別碼來疑難排解查詢效能及其他問題。</span><span class="sxs-lookup"><span data-stu-id="ef404-139">You can use the distribution ID to troubleshoot query performance and other problems.</span></span> <span data-ttu-id="ef404-140">如需系統檢視的清單，請參閱 [MPP 系統檢視](sql-data-warehouse-reference-tsql-statements.md)。</span><span class="sxs-lookup"><span data-stu-id="ef404-140">For a list of the system views, see the [MPP system view](sql-data-warehouse-reference-tsql-statements.md).</span></span>

## <a name="difference-between-a-distribution-and-a-compute-node"></a><span data-ttu-id="ef404-141">發佈與計算節點之間的差異</span><span class="sxs-lookup"><span data-stu-id="ef404-141">Difference between a distribution and a Compute node</span></span>
<span data-ttu-id="ef404-142">發佈是儲存分散式資料和處理平行查詢的基本單位。</span><span class="sxs-lookup"><span data-stu-id="ef404-142">A distribution is the basic unit for storing distributed data and processing parallel queries.</span></span> <span data-ttu-id="ef404-143">發佈會群組為計算節點。</span><span class="sxs-lookup"><span data-stu-id="ef404-143">Distributions are grouped into Compute nodes.</span></span> <span data-ttu-id="ef404-144">每個計算節點會追蹤一或多個發佈。</span><span class="sxs-lookup"><span data-stu-id="ef404-144">Each Compute node tracks one or more distributions.</span></span>  

* <span data-ttu-id="ef404-145">分析平台系統會使用節點做為硬體架構和向外擴充功能的中央元件。</span><span class="sxs-lookup"><span data-stu-id="ef404-145">Analytics Platform System uses Compute nodes as a central component of the hardware architecture and scale-out capabilities.</span></span> <span data-ttu-id="ef404-146">它每個計算節點一律使用八個發佈，如雜湊分散式資料表圖中所示。</span><span class="sxs-lookup"><span data-stu-id="ef404-146">It always uses eight distributions per Compute node, as shown in the diagram for hash-distributed tables.</span></span> <span data-ttu-id="ef404-147">計算節點數目，因此發佈數目是由您為裝置購買的計算節點數目所決定。</span><span class="sxs-lookup"><span data-stu-id="ef404-147">The number of Compute nodes, and therefore the number of distributions, is determined by the number of Compute nodes you purchase for the appliance.</span></span> <span data-ttu-id="ef404-148">例如，如果您購買八個計算節點，您會取得 64 個發佈 (8 個計算節點 x 8 個發佈/節點)。</span><span class="sxs-lookup"><span data-stu-id="ef404-148">For example, if you purchase eight Compute nodes, you get 64 distributions (8 Compute nodes x 8 distributions/node).</span></span> 
* <span data-ttu-id="ef404-149">SQL 資料倉儲的發佈數目固定為 60 個，而計算節點數目則為彈性。</span><span class="sxs-lookup"><span data-stu-id="ef404-149">SQL Data Warehouse has a fixed number of 60 distributions and a flexible number of Compute nodes.</span></span> <span data-ttu-id="ef404-150">會使用 Azure 計算和儲存體資源來實作計算節點。</span><span class="sxs-lookup"><span data-stu-id="ef404-150">The Compute nodes are implemented with Azure computing and storage resources.</span></span> <span data-ttu-id="ef404-151">計算節點的數目可能會根據後端服務工作負載和您針對資料倉儲指定的計算容量 (DWU) 而變更。</span><span class="sxs-lookup"><span data-stu-id="ef404-151">The number of Compute nodes can change according to the backend service workload and the computing capacity (DWUs) you specify for the data warehouse.</span></span> <span data-ttu-id="ef404-152">計算節點數目變更時，每個計算節點的發佈數目也會變更。</span><span class="sxs-lookup"><span data-stu-id="ef404-152">When the number of Compute nodes changes, the number of distributions per Compute node also changes.</span></span> 

### <a name="can-i-view-the-compute-nodes"></a><span data-ttu-id="ef404-153">可以檢視計算節點嗎？</span><span class="sxs-lookup"><span data-stu-id="ef404-153">Can I view the Compute nodes?</span></span>
<span data-ttu-id="ef404-154">每個計算節點有節點 ID，且在有關 SQL 資料倉儲和平行資料倉儲的系統檢視中可以看見。</span><span class="sxs-lookup"><span data-stu-id="ef404-154">Each Compute node has a node ID and is visible in system views that pertain to SQL Data Warehouse and Parallel Data Warehouse.</span></span>  <span data-ttu-id="ef404-155">您可以在名稱開頭為 sys.pdw_nodes 的系統檢視中尋找 node_id 資料行表來看到計算節點。</span><span class="sxs-lookup"><span data-stu-id="ef404-155">You can see the Compute node by looking for the node_id column in system views whose names begin with sys.pdw_nodes.</span></span> <span data-ttu-id="ef404-156">如需系統檢視的清單，請參閱 [MPP 系統檢視](sql-data-warehouse-reference-tsql-statements.md)。</span><span class="sxs-lookup"><span data-stu-id="ef404-156">For a list of the system views, see the [MPP system view](sql-data-warehouse-reference-tsql-statements.md).</span></span>

## <span data-ttu-id="ef404-157"><a name="Replicated"></a>複寫資料表</span><span class="sxs-lookup"><span data-stu-id="ef404-157"><a name="Replicated"></a>Replicated Tables</span></span>
<span data-ttu-id="ef404-158">複寫資料表會在每個計算節點上都儲存一份完整的資料表複本。</span><span class="sxs-lookup"><span data-stu-id="ef404-158">A table that is replicated has a fully copy of the table stored on each Compute node.</span></span> <span data-ttu-id="ef404-159">複寫資料表可使在進行聯結或彙總之前，不需要在計算節點之間傳輸資料。</span><span class="sxs-lookup"><span data-stu-id="ef404-159">Replicating a table removes the need to transfer data among Compute nodes before a join or aggregation.</span></span> <span data-ttu-id="ef404-160">由於在每個計算節點上儲存完整資料表所需的額外儲存體，因此複寫資料表僅在小型資料表才可行。</span><span class="sxs-lookup"><span data-stu-id="ef404-160">Replicated tables are only feasible with small tables because of the extra storage required to store the full table on each compute node.</span></span>  

<span data-ttu-id="ef404-161">下圖顯示儲存在每個計算節點上的複寫資料表。</span><span class="sxs-lookup"><span data-stu-id="ef404-161">The following diagram shows a replicated table that is stored on each Compute node.</span></span> <span data-ttu-id="ef404-162">對於「SQL 資料倉儲」，會將複寫資料表完整複製到每個計算節點上的散發資料庫。</span><span class="sxs-lookup"><span data-stu-id="ef404-162">For SQL Data Warehouse, the replicated table is fully copied to a distribution database on each Compute node.</span></span> <span data-ttu-id="ef404-163">針對平行處理資料倉儲，複寫資料表會儲存在指派給計算節點的所有磁碟上。</span><span class="sxs-lookup"><span data-stu-id="ef404-163">For Parallel Data Warehouse, the replicated table is stored across all disks assigned to the Compute node.</span></span>  <span data-ttu-id="ef404-164">此磁碟策略會使用 SQL Server 檔案群組來實作。</span><span class="sxs-lookup"><span data-stu-id="ef404-164">This disk strategy is implemented by using SQL Server filegroups.</span></span>  

<span data-ttu-id="ef404-165">![複寫的資料表](media/sql-data-warehouse-distributed-data/replicated-table.png "複寫的資料表")</span><span class="sxs-lookup"><span data-stu-id="ef404-165">![Replicated table](media/sql-data-warehouse-distributed-data/replicated-table.png "Replicated table")</span></span> 

## <a name="next-steps"></a><span data-ttu-id="ef404-166">後續步驟</span><span class="sxs-lookup"><span data-stu-id="ef404-166">Next steps</span></span>
<span data-ttu-id="ef404-167">若要有效使用分散式資料表，請參閱[在 SQL 資料倉儲中散發資料表](sql-data-warehouse-tables-distribute.md)</span><span class="sxs-lookup"><span data-stu-id="ef404-167">To use distributed tables effectively, see [Distributing tables in SQL Data Warehouse](sql-data-warehouse-tables-distribute.md)</span></span>  

