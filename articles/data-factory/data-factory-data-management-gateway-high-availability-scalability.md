---
title: "在 Azure Data Factory 中使用資料管理閘道來獲得高可用性 | Microsoft Docs"
description: "本文說明如何藉由新增更多節點來相應放大資料管理閘道，以及藉由增加節點中可以並行執行的作業數來相應增加。"
services: data-factory
documentationcenter: 
author: nabhishek
manager: jhubbard
editor: 
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: abnarain
ms.openlocfilehash: b6bf353a2bad28b0db3a88e971e5c6b209b7ab2b
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/18/2017
---
# <a name="data-management-gateway---high-availability-and-scalability-preview"></a><span data-ttu-id="04442-103">資料管理閘道 - 高可用性和延展性 (預覽)</span><span class="sxs-lookup"><span data-stu-id="04442-103">Data Management Gateway - high availability and scalability (Preview)</span></span>
<span data-ttu-id="04442-104">本文可協助您使用資料管理閘道來設定高可用性和延展性解決方案。</span><span class="sxs-lookup"><span data-stu-id="04442-104">This article helps you configure high availability and scalability solution with Data Management Gateway.</span></span>    

> [!NOTE]
> <span data-ttu-id="04442-105">本文假設您已熟悉資料管理閘道的基本概念。</span><span class="sxs-lookup"><span data-stu-id="04442-105">This article assumes that you are already familiar with basics of Data Management Gateway.</span></span> <span data-ttu-id="04442-106">如果您並不熟悉，請參閱[資料管理閘道](data-factory-data-management-gateway.md)。</span><span class="sxs-lookup"><span data-stu-id="04442-106">If you are not, see [Data Management Gateway](data-factory-data-management-gateway.md).</span></span>

><span data-ttu-id="04442-107">**資料管理閘道版本 2.12.xxxx.x 和更新版本正式支援此預覽功能**。</span><span class="sxs-lookup"><span data-stu-id="04442-107">**This preview feature is officially supported on Data Management Gateway version 2.12.xxxx.x and above**.</span></span> <span data-ttu-id="04442-108">請確定您使用版本 2.12.xxxx.x 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="04442-108">Please make sure you are using version 2.12.xxxx.x or above.</span></span> <span data-ttu-id="04442-109">在[此處](https://www.microsoft.com/download/details.aspx?id=39717)下載最新版本的資料管理閘道。</span><span class="sxs-lookup"><span data-stu-id="04442-109">Download the latest version of Data Management Gateway [here](https://www.microsoft.com/download/details.aspx?id=39717).</span></span>

## <a name="overview"></a><span data-ttu-id="04442-110">概觀</span><span class="sxs-lookup"><span data-stu-id="04442-110">Overview</span></span>
<span data-ttu-id="04442-111">您可以從入口網站，將安裝在多個內部部署機器上的資料管理閘道關聯到單一邏輯閘道。</span><span class="sxs-lookup"><span data-stu-id="04442-111">You can associate data management gateways that are installed on multiple on-premises machines with a single logical gateway from the portal.</span></span> <span data-ttu-id="04442-112">這些機器稱為**節點**。</span><span class="sxs-lookup"><span data-stu-id="04442-112">These machines are called **nodes**.</span></span> <span data-ttu-id="04442-113">您最多可以將**四個節點**關聯到一個邏輯閘道。</span><span class="sxs-lookup"><span data-stu-id="04442-113">You can have up to **four nodes** associated with a logical gateway.</span></span> <span data-ttu-id="04442-114">讓邏輯閘道擁有多個節點 (安裝了閘道的內部部署機器) 的好處如下：</span><span class="sxs-lookup"><span data-stu-id="04442-114">The benefits of having multiple nodes (on-premises machines with gateway installed) for a logical gateway are:</span></span>  

- <span data-ttu-id="04442-115">提升內部部署機器和雲端資料存放區之間的資料移動效能。</span><span class="sxs-lookup"><span data-stu-id="04442-115">Improve performance of data movement between on-premises and cloud data stores.</span></span>  
- <span data-ttu-id="04442-116">如果某個節點因為某些原因而關閉，其他節點仍可供用來移動資料。</span><span class="sxs-lookup"><span data-stu-id="04442-116">If one of the nodes goes down for some reason, other nodes are still available for moving the data.</span></span> 
- <span data-ttu-id="04442-117">如果某個節點必須離線以進行維護，其他節點仍可供用來移動資料。</span><span class="sxs-lookup"><span data-stu-id="04442-117">If one of the nodes need to be taken offline for maintenance, other nodes are still available for moving the data.</span></span>

<span data-ttu-id="04442-118">您也可以設定節點中可以執行的**並行資料移動作業**數目，以相應增加在內部部署機器與雲端資料存放區之間移動資料的能力。</span><span class="sxs-lookup"><span data-stu-id="04442-118">You can also configure the number of **concurrent data movement jobs** that can run on a node to scale up the capability of moving data between on-premises and cloud data stores.</span></span> 

<span data-ttu-id="04442-119">您可以使用 Azure 入口網站來監視這些節點的狀態，以幫助您決定是要在邏輯閘道中新增還是移除節點。</span><span class="sxs-lookup"><span data-stu-id="04442-119">Using the Azure portal, you can monitor the status of these nodes, which helps you decide whether to add or remove a node from the logical gateway.</span></span> 

## <a name="architecture"></a><span data-ttu-id="04442-120">架構</span><span class="sxs-lookup"><span data-stu-id="04442-120">Architecture</span></span> 
<span data-ttu-id="04442-121">下圖可概述資料管理閘道之延展性和可用性功能的架構：</span><span class="sxs-lookup"><span data-stu-id="04442-121">The following diagram provides the architecture overview of scalability and availability feature of the Data Management Gateway:</span></span> 

![資料管理閘道 - 高可用性和延展性](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-high-availability-and-scalability.png)

<span data-ttu-id="04442-123">**邏輯閘道**是您在 Azure 入口網站中新增至資料處理站的閘道。</span><span class="sxs-lookup"><span data-stu-id="04442-123">A **logical gateway** is the gateway you add to a data factory in the Azure portal.</span></span> <span data-ttu-id="04442-124">以前，您只能將一個內部部署 Windows 機器關聯到安裝了邏輯閘道的資料管理閘道。</span><span class="sxs-lookup"><span data-stu-id="04442-124">Earlier, you could associate only one on-premises Windows machine with Data Management Gateway installed with a logical gateway.</span></span> <span data-ttu-id="04442-125">這個內部部署閘道機器稱為節點。</span><span class="sxs-lookup"><span data-stu-id="04442-125">This on-premises gateway machine is called a node.</span></span> <span data-ttu-id="04442-126">現在，您最多可以將**四個實體節點**關聯到邏輯閘道。</span><span class="sxs-lookup"><span data-stu-id="04442-126">Now, you can associate up to **four physical nodes** with a logical gateway.</span></span> <span data-ttu-id="04442-127">具有多個節點的邏輯閘道稱為**多節點閘道**。</span><span class="sxs-lookup"><span data-stu-id="04442-127">A logical gateway with multiple nodes is called a **multi-node gateway**.</span></span>  

<span data-ttu-id="04442-128">而這些節點全都是**作用中**狀態。</span><span class="sxs-lookup"><span data-stu-id="04442-128">All these nodes are **active**.</span></span> <span data-ttu-id="04442-129">它們全都可以處理資料移動作業，以在內部部署機器和雲端資料存放區之間移動資料。</span><span class="sxs-lookup"><span data-stu-id="04442-129">They all can process data movement jobs to move data between on-premises and cloud data stores.</span></span> <span data-ttu-id="04442-130">其中一個節點會同時作為發送器節點和背景工作節點。</span><span class="sxs-lookup"><span data-stu-id="04442-130">One of the nodes act as both dispatcher and worker.</span></span> <span data-ttu-id="04442-131">群組中的其他節點則是背景工作節點。</span><span class="sxs-lookup"><span data-stu-id="04442-131">Other nodes in the groups are worker nodes.</span></span> <span data-ttu-id="04442-132">**發送器**節點會從雲端服務提取資料移動工作/作業，並將其發送到背景工作節點 (包括發送器節點本身)。</span><span class="sxs-lookup"><span data-stu-id="04442-132">A **dispatcher** node pulls data movement tasks/jobs from the cloud service and dispatches them to worker nodes (including itself).</span></span> <span data-ttu-id="04442-133">**背景工作**節點會執行資料移動作業，以在內部部署機器和雲端資料存放區之間移動資料。</span><span class="sxs-lookup"><span data-stu-id="04442-133">A **worker** node executes data movement jobs to move data between on-premises and cloud data stores.</span></span> <span data-ttu-id="04442-134">所有節點都是背景工作節點。</span><span class="sxs-lookup"><span data-stu-id="04442-134">All nodes are workers.</span></span> <span data-ttu-id="04442-135">只有一個節點可以既是發送器節點，又是背景工作節點。</span><span class="sxs-lookup"><span data-stu-id="04442-135">Only one node can be both dispatch and worker.</span></span>    

<span data-ttu-id="04442-136">一般來說，您一開始可以先建立一個節點，然後在現有節點已無法應付資料移動負載時**相應放大**以新增更多節點。</span><span class="sxs-lookup"><span data-stu-id="04442-136">You may typically start with one node and **scale out** to add more nodes as the existing node(s) are overwhelmed with the data movement load.</span></span> <span data-ttu-id="04442-137">您也可以藉由增加可以在節點上執行的並行作業數目，來**相應增加**閘道節點的資料移動能力。</span><span class="sxs-lookup"><span data-stu-id="04442-137">You can also **scale up** the data movement capability of a gateway node by increasing the number of concurrent jobs that are allowed to run on the node.</span></span> <span data-ttu-id="04442-138">單一節點的閘道也能擁有這樣的能力 (即使該閘道尚未啟用延展性和可用性功能)。</span><span class="sxs-lookup"><span data-stu-id="04442-138">This capability is also available with a single-node gateway (even when the scalability and availability feature is not enabled).</span></span> 

<span data-ttu-id="04442-139">具有多個節點的閘道會讓所有節點的資料存放區認證保持同步。</span><span class="sxs-lookup"><span data-stu-id="04442-139">A gateway with multiple nodes keeps the data store credentials in sync across all nodes.</span></span> <span data-ttu-id="04442-140">如果節點之間的連線發生問題，認證可能就不會同步。當您為使用閘道的內部部署資料存放區設定認證時，它會將認證儲存在發送器/背景工作節點上。</span><span class="sxs-lookup"><span data-stu-id="04442-140">If there is a node-to-node connectivity issue, the credentials may be out of sync. When you set credentials for an on-premises data store that uses a gateway, it saves credentials on the dispatcher/worker node.</span></span> <span data-ttu-id="04442-141">發送器節點會與其他背景工作節點進行同步處理。</span><span class="sxs-lookup"><span data-stu-id="04442-141">The dispatcher node syncs with other worker nodes.</span></span> <span data-ttu-id="04442-142">這個程序稱為**認證同步**。節點之間的通訊通道可以使用公開的 SSL/TLS 憑證來**加密**。</span><span class="sxs-lookup"><span data-stu-id="04442-142">This process is known as **credentials sync**. The communication channel between nodes can be **encrypted** by a public SSL/TLS certificate.</span></span> 

## <a name="set-up-a-multi-node-gateway"></a><span data-ttu-id="04442-143">設定多節點閘道</span><span class="sxs-lookup"><span data-stu-id="04442-143">Set up a multi-node gateway</span></span>
<span data-ttu-id="04442-144">本節假設您已經看過下列兩篇文章或熟悉這些文章中的概念：</span><span class="sxs-lookup"><span data-stu-id="04442-144">This section assumes that you have gone through the following two articles or familiar with concepts in these articles:</span></span> 

- <span data-ttu-id="04442-145">[資料管理閘道](data-factory-data-management-gateway.md) - 提供詳細的閘道概觀。</span><span class="sxs-lookup"><span data-stu-id="04442-145">[Data Management Gateway](data-factory-data-management-gateway.md) - provides a detailed overview of the gateway.</span></span>
- <span data-ttu-id="04442-146">[在內部部署和雲端資料存放區之間移動資料](data-factory-move-data-between-onprem-and-cloud.md) - 包含如何使用具有單一節點之閘道的逐步指示。</span><span class="sxs-lookup"><span data-stu-id="04442-146">[Move data between on-premises and cloud data stores](data-factory-move-data-between-onprem-and-cloud.md) - contains a walkthrough with step-by-step instructions for using a gateway with a single node.</span></span>  

> [!NOTE]
> <span data-ttu-id="04442-147">在內部部署 Windows 機器上安裝資料管理閘道之前，請先參閱[主要文章](data-factory-data-management-gateway.md#prerequisites)中所列出的必要條件。</span><span class="sxs-lookup"><span data-stu-id="04442-147">Before you install a data management gateway on an on-premises Windows machine, see prerequisites listed in [the main article](data-factory-data-management-gateway.md#prerequisites).</span></span>

1. <span data-ttu-id="04442-148">在[逐步解說](data-factory-move-data-between-onprem-and-cloud.md#create-gateway)中，於建立邏輯閘道時啟用**高可用性和延展性**功能。</span><span class="sxs-lookup"><span data-stu-id="04442-148">In the [walkthrough](data-factory-move-data-between-onprem-and-cloud.md#create-gateway), while creating a logical gateway, enable the **High Availability & Scalability** feature.</span></span> 

    ![資料管理閘道 - 啟用高可用性和延展性](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-enable-high-availability-scalability.png)
2. <span data-ttu-id="04442-150">在 [設定] 頁面上，使用 [快速設定] 或 [手動設定] 連結在第一個節點 (內部部署 Windows 機器) 上安裝閘道。</span><span class="sxs-lookup"><span data-stu-id="04442-150">In the **Configure** page, use either **Express Setup** or **Manual Setup** link to install a gateway on the first node (an on-premises Windows machine).</span></span>

    ![資料管理閘道 - 快速設定或手動設定](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-express-manual-setup.png)

    > [!NOTE]
    > <span data-ttu-id="04442-152">如果您使用 [快速設定] 選項，節點之間在通訊時不會加密。</span><span class="sxs-lookup"><span data-stu-id="04442-152">If you use the express setup option, the node-to-node communication is done without encryption.</span></span> <span data-ttu-id="04442-153">節點名稱和機器名稱相同。</span><span class="sxs-lookup"><span data-stu-id="04442-153">The node name is same as the machine name.</span></span> <span data-ttu-id="04442-154">如果節點之間的通訊需要加密，或是您想要指定您所選擇的節點名稱，請使用 [手動設定]。</span><span class="sxs-lookup"><span data-stu-id="04442-154">Use manual setup if the node-node communication needs to be encrypted or you want to specify a node name of your choice.</span></span> <span data-ttu-id="04442-155">您之後就無法編輯節點名稱。</span><span class="sxs-lookup"><span data-stu-id="04442-155">Node names cannot be edited later.</span></span>
3. <span data-ttu-id="04442-156">如果您選擇 [快速設定]</span><span class="sxs-lookup"><span data-stu-id="04442-156">If you choose **express setup**</span></span>
    1. <span data-ttu-id="04442-157">閘道安裝成功之後，您會看到下列訊息：</span><span class="sxs-lookup"><span data-stu-id="04442-157">You see the following message after the gateway is successfully installed:</span></span>

        ![資料管理閘道 - 快速設定成功](media/data-factory-data-management-gateway-high-availability-scalability/express-setup-success.png)
    2. <span data-ttu-id="04442-159">遵循[這些指示](data-factory-data-management-gateway.md#configuration-manager)來啟動「資料管理組態管理員」。</span><span class="sxs-lookup"><span data-stu-id="04442-159">Launch Data Management Configuration Manager for the gateway by following [these instructions](data-factory-data-management-gateway.md#configuration-manager).</span></span> <span data-ttu-id="04442-160">您會看到閘道名稱、節點名稱、狀態等資訊。</span><span class="sxs-lookup"><span data-stu-id="04442-160">You see the gateway name, node name, status, etc.</span></span>

        ![資料管理閘道 - 安裝成功](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-installation-success.png)
4. <span data-ttu-id="04442-162">如果您選擇 [手動設定]：</span><span class="sxs-lookup"><span data-stu-id="04442-162">If you choose **manual setup**:</span></span>
    1. <span data-ttu-id="04442-163">從 Microsoft 下載中心下載安裝套件，加以執行以在您的機器上安裝閘道。</span><span class="sxs-lookup"><span data-stu-id="04442-163">Download the installation package from the Microsoft Download Center, run it to install gateway on your machine.</span></span>
    2. <span data-ttu-id="04442-164">使用 [設定] 頁面中的 [驗證金鑰] 來註冊閘道。</span><span class="sxs-lookup"><span data-stu-id="04442-164">Use the **authentication key** from the **Configure** page to register the gateway.</span></span>
    
        ![資料管理閘道 - 安裝成功](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-authentication-key.png)
    3. <span data-ttu-id="04442-166">在 [新增閘道節點] 頁面上，您可以為閘道節點提供自訂**名稱**。</span><span class="sxs-lookup"><span data-stu-id="04442-166">In the **New gateway node** page, you can provide a custom **name** to the gateway node.</span></span> <span data-ttu-id="04442-167">根據預設，節點名稱和機器名稱相同。</span><span class="sxs-lookup"><span data-stu-id="04442-167">By default, node name is same as the machine name.</span></span>    

        ![資料管理閘道 - 指定名稱](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-name.png)
    4. <span data-ttu-id="04442-169">在下一頁中，您可以選擇是否要**為節點之間的通訊啟用加密**。</span><span class="sxs-lookup"><span data-stu-id="04442-169">In the next page, you can choose whether to **enable encryption for node-to-node communication**.</span></span> <span data-ttu-id="04442-170">按一下 [略過] 可停用加密 (預設)。</span><span class="sxs-lookup"><span data-stu-id="04442-170">Click **Skip** to disable encryption (default).</span></span>

        ![資料管理閘道 - 啟用加密](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-node-encryption.png)  
    
        > [!NOTE]
        > <span data-ttu-id="04442-172">在邏輯閘道中只有單一閘道節點時才支援變更加密模式。</span><span class="sxs-lookup"><span data-stu-id="04442-172">Changing of encryption mode is only supported when you have a single gateway node in the logical gateway.</span></span> <span data-ttu-id="04442-173">若要在閘道有多個節點時變更加密模式，請執行下列步驟：只留下一個節點，其他全都刪除，變更加密模式，然後重新新增節點。</span><span class="sxs-lookup"><span data-stu-id="04442-173">To change the encryption mode when a gateway has multiple nodes, do the following steps: delete all the nodes except one node, change the encryption mode, and then add the nodes again.</span></span>
        > 
        > <span data-ttu-id="04442-174">如需 TLS/SSL 憑證的使用需求清單，請參閱 [TLS/SSL 憑證需求](#tlsssl-certificate-requirements)一節。</span><span class="sxs-lookup"><span data-stu-id="04442-174">See [TLS/SSL certificate requirements](#tlsssl-certificate-requirements) section for a list of requirements for using an TLS/SSL certificate.</span></span> 
    5. <span data-ttu-id="04442-175">在閘道安裝成功之後，按一下 [啟動組態管理員]：</span><span class="sxs-lookup"><span data-stu-id="04442-175">After the gateway is successfully installed, click Launch Configuration Manager:</span></span>
    
        ![手動設定 - 啟動組態管理員](media/data-factory-data-management-gateway-high-availability-scalability/manual-setup-launch-configuration-manager.png)   
    6. <span data-ttu-id="04442-177">您會在節點 (內部部署 Windows 機器) 上看到「資料管理閘道組態管理員」，裡面會顯示連線狀態、**閘道名稱**和**節點名稱**。</span><span class="sxs-lookup"><span data-stu-id="04442-177">you see Data Management Gateway Configuration Manager on the node (on-premises Windows machine), which shows connectivity status, **gateway name**, and **node name**.</span></span>  

        ![資料管理閘道 - 安裝成功](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-installation-success.png)

        > [!NOTE]
        > <span data-ttu-id="04442-179">如果您要在 Azure VM 上佈建閘道，您可以使用 [GitHub 上的這個 Azure Resource Manager 範本](https://github.com/xiaoyingLJ/vms-with-multiple-data-management-gateway)。</span><span class="sxs-lookup"><span data-stu-id="04442-179">If you are provisioning the gateway on an Azure VM, you can use [this Azure Resource Manager template on GitHub](https://github.com/xiaoyingLJ/vms-with-multiple-data-management-gateway).</span></span> <span data-ttu-id="04442-180">這個指令碼會建立邏輯閘道、為安裝了資料管理閘道軟體的 VM 進行設定，並向邏輯閘道註冊這些 VM。</span><span class="sxs-lookup"><span data-stu-id="04442-180">This script creates a logical gateway, sets up VMs with Data Management Gateway software installed, and registers them with the logical gateway.</span></span> 
6. <span data-ttu-id="04442-181">在 Azure 入口網站啟動 [閘道] 頁面：</span><span class="sxs-lookup"><span data-stu-id="04442-181">In Azure portal, launch the **Gateway** page:</span></span> 
    1. <span data-ttu-id="04442-182">在入口網站中的資料處理站首頁上，按一下 [已連結的服務]。</span><span class="sxs-lookup"><span data-stu-id="04442-182">On the data factory home page in the portal, click **Linked Services**.</span></span>
    
        ![Data Factory 首頁](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-home-page.png)
    2. <span data-ttu-id="04442-184">選取**閘道**以查看 [閘道] 頁面：</span><span class="sxs-lookup"><span data-stu-id="04442-184">select the **gateway** to see the **Gateway** page:</span></span>
    
        ![Data Factory 首頁](media/data-factory-data-management-gateway-high-availability-scalability/linked-services-gateway.png)
    4. <span data-ttu-id="04442-186">您會看到 [閘道] 頁面：</span><span class="sxs-lookup"><span data-stu-id="04442-186">You see the **Gateway** page:</span></span>   

        ![具有單一節點之閘道的檢視](media/data-factory-data-management-gateway-high-availability-scalability/gateway-first-node-portal-view.png) 
7. <span data-ttu-id="04442-188">在工具列上按一下 [新增節點] 來對邏輯閘道新增節點。</span><span class="sxs-lookup"><span data-stu-id="04442-188">Click **Add Node** on the toolbar to add a node to the logical gateway.</span></span> <span data-ttu-id="04442-189">如果您打算使用快速設定，請從將新增為閘道節點的內部部署機器執行此步驟。</span><span class="sxs-lookup"><span data-stu-id="04442-189">If you are planning to use express setup, do this step from the on-premises machine that will be added as a node to the gateway.</span></span> 

    ![資料管理閘道 - 新增節點功能表](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-add-node-menu.png)
8. <span data-ttu-id="04442-191">步驟與第一個節點的設定類似。</span><span class="sxs-lookup"><span data-stu-id="04442-191">Steps are similar to setting up the first node.</span></span> <span data-ttu-id="04442-192">如果您選擇手動安裝選項，組態管理員 UI 可讓您設定節點名稱：</span><span class="sxs-lookup"><span data-stu-id="04442-192">The Configuration Manager UI lets you set the node name if you choose the manual installation option:</span></span> 

    ![組態管理員 - 安裝第二個閘道](media/data-factory-data-management-gateway-high-availability-scalability/install-second-gateway.png)
9. <span data-ttu-id="04442-194">成功在節點上安裝閘道之後，組態管理員工具會顯示下列畫面：</span><span class="sxs-lookup"><span data-stu-id="04442-194">After the gateway is installed successfully on the node, the Configuration Manager tool displays the following screen:</span></span>  

    ![組態管理員 - 安裝第二個閘道成功](media/data-factory-data-management-gateway-high-availability-scalability/second-gateway-installation-successful.png)
10. <span data-ttu-id="04442-196">如果您在入口網站中開啟 [閘道] 頁面，您現在會看到兩個閘道節點：</span><span class="sxs-lookup"><span data-stu-id="04442-196">If you open the **Gateway** page in the portal, you see two gateway nodes now:</span></span> 

    ![入口網站中具有兩個節點的閘道](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-multi-node-monitoring.png)
11. <span data-ttu-id="04442-198">若要刪除閘道節點，請在工具列上按一下 [刪除節點]，選取您要刪除的節點，然後在工具列中按一下 [刪除]。</span><span class="sxs-lookup"><span data-stu-id="04442-198">To delete a gateway node, click **Delete Node** on the toolbar, select the node you want to delete, and then click **Delete** from the toolbar.</span></span> <span data-ttu-id="04442-199">這個動作會從群組中刪除選取的節點。</span><span class="sxs-lookup"><span data-stu-id="04442-199">This action deletes the selected node from the group.</span></span> <span data-ttu-id="04442-200">請注意，此動作不會從節點 (內部部署 Windows 機器) 解除安裝資料管理閘道軟體。</span><span class="sxs-lookup"><span data-stu-id="04442-200">Note that this action does not uninstall the data management gateway software from the node (on-premises Windows machine).</span></span> <span data-ttu-id="04442-201">請在內部部署機器上使用控制台中的 [新增或移除程式] 來解除安裝閘道。</span><span class="sxs-lookup"><span data-stu-id="04442-201">Use **Add or remove programs** in Control Panel on the on-premises to uninstall the gateway.</span></span> <span data-ttu-id="04442-202">當您從節點中解除安裝閘道時，系統便會自動在入口網站中刪除該節點。</span><span class="sxs-lookup"><span data-stu-id="04442-202">When you uninstall gateway from the node, it's automatically deleted in the portal.</span></span>   

## <a name="upgrade-an-existing-gateway"></a><span data-ttu-id="04442-203">升級現有閘道</span><span class="sxs-lookup"><span data-stu-id="04442-203">Upgrade an existing gateway</span></span>
<span data-ttu-id="04442-204">您可以升級現有閘道來使用高可用性和延展性功能。</span><span class="sxs-lookup"><span data-stu-id="04442-204">You can upgrade an existing gateway to use the high availability and scalability feature.</span></span> <span data-ttu-id="04442-205">這項功能僅適用於資料管理閘道版本 >= 2.12.xxxx 的節點。</span><span class="sxs-lookup"><span data-stu-id="04442-205">This feature works only with nodes that have the data management gateway of version >= 2.12.xxxx.</span></span> <span data-ttu-id="04442-206">您可以在資料管理閘道組態管理員的 [說明] 索引標籤中查看機器上所安裝之資料管理閘道的版本。</span><span class="sxs-lookup"><span data-stu-id="04442-206">You can see the version of data management gateway installed on a machine in the **Help** tab of the Data Management Gateway Configuration Manager.</span></span> 

1. <span data-ttu-id="04442-207">從 [Microsoft 下載中心](https://www.microsoft.com/download/details.aspx?id=39717)下載並執行 MSI 安裝套件，以將內部部署機器上的閘道更新為最新版本。</span><span class="sxs-lookup"><span data-stu-id="04442-207">Update the gateway on the on-premises machine to the latest version by following by downloading and running an MSI setup package from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=39717).</span></span> <span data-ttu-id="04442-208">如需詳細資料，請參閱[安裝](data-factory-data-management-gateway.md#installation)一節。</span><span class="sxs-lookup"><span data-stu-id="04442-208">See [installation](data-factory-data-management-gateway.md#installation) section for details.</span></span>  
2. <span data-ttu-id="04442-209">瀏覽至 Azure 入口網站。</span><span class="sxs-lookup"><span data-stu-id="04442-209">Navigate to the Azure portal.</span></span> <span data-ttu-id="04442-210">啟動您資料處理站的 [Data Factory] 頁面。</span><span class="sxs-lookup"><span data-stu-id="04442-210">Launch the **Data Factory page** for your data factory.</span></span> <span data-ttu-id="04442-211">按一下 [已連結的服務] 圖格來啟動 [已連結的服務] 頁面。</span><span class="sxs-lookup"><span data-stu-id="04442-211">Click Linked services tile to launch the **linked services page**.</span></span> <span data-ttu-id="04442-212">選取閘道以啟動**閘道頁面**。</span><span class="sxs-lookup"><span data-stu-id="04442-212">Select the gateway to launch the **gateway page**.</span></span> <span data-ttu-id="04442-213">按一下並啟用 [預覽功能]，如下圖所示：</span><span class="sxs-lookup"><span data-stu-id="04442-213">Click and enable **Preview Feature** as shown in the following image:</span></span> 

    ![資料管理閘道 - 啟用預覽功能](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-existing-gateway-enable-high-availability.png)   
2. <span data-ttu-id="04442-215">在入口網站啟用預覽功能後，關閉所有頁面。</span><span class="sxs-lookup"><span data-stu-id="04442-215">Once the preview feature is enabled in the portal, close all pages.</span></span> <span data-ttu-id="04442-216">重新開啟**閘道頁面**以查看新的預覽使用者介面 (UI)。</span><span class="sxs-lookup"><span data-stu-id="04442-216">Reopen the **gateway page** to see the new preview user interface (UI).</span></span>
 
    ![資料管理閘道 - 啟用預覽功能成功](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-preview-success.png)

    ![資料管理閘道 - 預覽 UI](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-preview.png)

    > [!NOTE]
    > <span data-ttu-id="04442-219">在升級期間，第一個節點的名稱就是機器的名稱。</span><span class="sxs-lookup"><span data-stu-id="04442-219">During the upgrade, name of the first node is the name of the machine.</span></span> 
3. <span data-ttu-id="04442-220">現在，新增節點。</span><span class="sxs-lookup"><span data-stu-id="04442-220">Now, add a node.</span></span> <span data-ttu-id="04442-221">在 [閘道] 頁面上，按一下 [新增節點]。</span><span class="sxs-lookup"><span data-stu-id="04442-221">In the **Gateway** page, click **Add Node**.</span></span>  

    ![資料管理閘道 - 新增節點功能表](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-add-node-menu.png)

    <span data-ttu-id="04442-223">請遵循上一節的指示來設定節點。</span><span class="sxs-lookup"><span data-stu-id="04442-223">Follow instructions from the previous section to set up the node.</span></span> 

### <a name="installation-best-practices"></a><span data-ttu-id="04442-224">安裝最佳做法</span><span class="sxs-lookup"><span data-stu-id="04442-224">Installation best practices</span></span>

- <span data-ttu-id="04442-225">為閘道器設定主機電腦上的電源計劃，使電腦不休眠。</span><span class="sxs-lookup"><span data-stu-id="04442-225">Configure power plan on the host machine for the gateway so that the machine does not hibernate.</span></span> <span data-ttu-id="04442-226">如果主機電腦休眠，閘道器不會回應資料要求。</span><span class="sxs-lookup"><span data-stu-id="04442-226">If the host machine hibernates, the gateway does not respond to data requests.</span></span>
- <span data-ttu-id="04442-227">請備份與閘道器相關聯的憑證。</span><span class="sxs-lookup"><span data-stu-id="04442-227">Back up the certificate associated with the gateway.</span></span>
- <span data-ttu-id="04442-228">確定所有節點都有類似的設定 (建議選項) 以獲得理想的效能。</span><span class="sxs-lookup"><span data-stu-id="04442-228">Ensure all nodes are of similar configuration (recommended) for ideal performance.</span></span> 
- <span data-ttu-id="04442-229">至少新增兩個節點，以確保高可用性。</span><span class="sxs-lookup"><span data-stu-id="04442-229">Add at least two nodes to ensure high availability.</span></span>  

### <a name="tlsssl-certificate-requirements"></a><span data-ttu-id="04442-230">TLS/SSL 憑證需求</span><span class="sxs-lookup"><span data-stu-id="04442-230">TLS/SSL certificate requirements</span></span>
<span data-ttu-id="04442-231">以下是用來保護閘道節點間通訊之 TLS/SSL 憑證的需求：</span><span class="sxs-lookup"><span data-stu-id="04442-231">Here are the requirements for the TLS/SSL certificate that is used for securing communications between gateway nodes:</span></span>

- <span data-ttu-id="04442-232">憑證必須是受信任的 X509 v3 公開憑證。</span><span class="sxs-lookup"><span data-stu-id="04442-232">The certificate must be a publicly trusted X509 v3 certificate.</span></span>
- <span data-ttu-id="04442-233">所有閘道節點都必須信任此憑證。</span><span class="sxs-lookup"><span data-stu-id="04442-233">All gateway nodes must trust this certificate.</span></span> 
- <span data-ttu-id="04442-234">建議您使用公開 (第三方) 憑證授權單位 (CA) 所發出的憑證。</span><span class="sxs-lookup"><span data-stu-id="04442-234">We recommend that you use certificates that are issued by a public (third-party) certification authority (CA).</span></span>
- <span data-ttu-id="04442-235">支援 Windows Server 2012 R2 所支援的任何 SSL 憑證金鑰大小。</span><span class="sxs-lookup"><span data-stu-id="04442-235">Supports any key size supported by Windows Server 2012 R2 for SSL certificates.</span></span>
- <span data-ttu-id="04442-236">不支援使用 CNG 金鑰的憑證。</span><span class="sxs-lookup"><span data-stu-id="04442-236">Does not support certificates that use CNG keys.</span></span>
- <span data-ttu-id="04442-237">支援萬用字元憑證。</span><span class="sxs-lookup"><span data-stu-id="04442-237">Wild-card certificates are supported.</span></span> 


## <a name="monitor-a-multi-node-gateway"></a><span data-ttu-id="04442-238">監視多節點閘道</span><span class="sxs-lookup"><span data-stu-id="04442-238">Monitor a multi-node gateway</span></span>
### <a name="multi-node-gateway-monitoring"></a><span data-ttu-id="04442-239">多節點閘道監視</span><span class="sxs-lookup"><span data-stu-id="04442-239">Multi-node gateway monitoring</span></span>
<span data-ttu-id="04442-240">在 Azure 入口網站中，您可以檢視每個節點近乎即時的資源使用率 (CPU、記憶體、網路 (輸入/輸出) 等) 快照集以及閘道節點的狀態。</span><span class="sxs-lookup"><span data-stu-id="04442-240">In the Azure portal, you can view near-real time snapshot of resource utilization (CPU, memory, network(in/out), etc.) on each node along with statuses of gateway nodes.</span></span> 

![資料管理閘道 - 多節點監視](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-multi-node-monitoring.png)

<span data-ttu-id="04442-242">您可以在 [閘道] 頁面啟用 [進階設定] 以查看進階的計量，例如**網路** (輸入/輸出)、**角色和認證狀態** (有助於偵錯閘道問題) 和**並行作業** (執行中/限制) (可在效能微調期間據以修改/變更)。</span><span class="sxs-lookup"><span data-stu-id="04442-242">You can enable **Advanced Settings** in the **Gateway** page to see advanced metrics like **Network**(in/out), **Role & Credential Status**, which is helpful in debugging gateway issues, and **Concurrent Jobs** (Running/ Limit) which can be modified/ changed accordingly during performance tuning.</span></span> <span data-ttu-id="04442-243">下表說明 [閘道節點] 清單中的資料行：</span><span class="sxs-lookup"><span data-stu-id="04442-243">The following table provides descriptions of columns in the **Gateway Nodes** list:</span></span>  

<span data-ttu-id="04442-244">監視屬性</span><span class="sxs-lookup"><span data-stu-id="04442-244">Monitoring Property</span></span> | <span data-ttu-id="04442-245">說明</span><span class="sxs-lookup"><span data-stu-id="04442-245">Description</span></span>
:------------------ | :---------- 
<span data-ttu-id="04442-246">名稱</span><span class="sxs-lookup"><span data-stu-id="04442-246">Name</span></span> | <span data-ttu-id="04442-247">邏輯閘道和閘道相關聯節點的名稱。</span><span class="sxs-lookup"><span data-stu-id="04442-247">Name of the logical gateway and nodes associated with the gateway.</span></span>  
<span data-ttu-id="04442-248">狀態</span><span class="sxs-lookup"><span data-stu-id="04442-248">Status</span></span> | <span data-ttu-id="04442-249">邏輯閘道和閘道節點的狀態。</span><span class="sxs-lookup"><span data-stu-id="04442-249">Status of the logical gateway and the gateway nodes.</span></span> <span data-ttu-id="04442-250">範例：線上/離線/受限制/等等。如需這些狀態的相關資訊，請參閱[閘道狀態](#gateway-status)一節。</span><span class="sxs-lookup"><span data-stu-id="04442-250">Example: Online/Offline/Limited/etc. For information about these statuses, See [Gateway status](#gateway-status) section.</span></span> 
<span data-ttu-id="04442-251">版本</span><span class="sxs-lookup"><span data-stu-id="04442-251">Version</span></span> | <span data-ttu-id="04442-252">顯示邏輯閘道和每個閘道節點的版本。</span><span class="sxs-lookup"><span data-stu-id="04442-252">Shows the version of the logical gateway and each gateway node.</span></span> <span data-ttu-id="04442-253">邏輯閘道的版本取決於群組中大多數節點的版本。</span><span class="sxs-lookup"><span data-stu-id="04442-253">The version of the logical gateway is determined based on version of majority of nodes in the group.</span></span> <span data-ttu-id="04442-254">如果邏輯閘道設定中有不同版本的節點，則只有版本號碼和邏輯閘道相同的節點會正常運作。</span><span class="sxs-lookup"><span data-stu-id="04442-254">If there are nodes with different versions in the logical gateway setup, only the nodes with the same version number as the logical gateway function properly.</span></span> <span data-ttu-id="04442-255">其他節點會進入受限制模式，並需要加以手動更新 (如果自動更新失敗才需要這麼做)。</span><span class="sxs-lookup"><span data-stu-id="04442-255">Others are in the limited mode and need to be manually updated (only in case auto-update fails).</span></span> 
<span data-ttu-id="04442-256">可用的記憶體</span><span class="sxs-lookup"><span data-stu-id="04442-256">Available memory</span></span> | <span data-ttu-id="04442-257">閘道節點上可用的記憶體。</span><span class="sxs-lookup"><span data-stu-id="04442-257">Available memory on a gateway node.</span></span> <span data-ttu-id="04442-258">這個值是近乎即時的快照集。</span><span class="sxs-lookup"><span data-stu-id="04442-258">This value is a near real-time snapshot.</span></span> 
<span data-ttu-id="04442-259">CPU 使用率</span><span class="sxs-lookup"><span data-stu-id="04442-259">CPU utilization</span></span> | <span data-ttu-id="04442-260">閘道節點的 CPU 使用率。</span><span class="sxs-lookup"><span data-stu-id="04442-260">CPU utilization of a gateway node.</span></span> <span data-ttu-id="04442-261">這個值是近乎即時的快照集。</span><span class="sxs-lookup"><span data-stu-id="04442-261">This value is a near real-time snapshot.</span></span> 
<span data-ttu-id="04442-262">網路功能 (輸入/輸出)</span><span class="sxs-lookup"><span data-stu-id="04442-262">Networking (In/Out)</span></span> | <span data-ttu-id="04442-263">閘道節點的網路使用率。</span><span class="sxs-lookup"><span data-stu-id="04442-263">Network utilization of a gateway node.</span></span> <span data-ttu-id="04442-264">這個值是近乎即時的快照集。</span><span class="sxs-lookup"><span data-stu-id="04442-264">This value is a near real-time snapshot.</span></span> 
<span data-ttu-id="04442-265">並行作業 (執行中/限制)</span><span class="sxs-lookup"><span data-stu-id="04442-265">Concurrent Jobs (Running/ Limit)</span></span> | <span data-ttu-id="04442-266">每個節點上執行的作業或工作數目。</span><span class="sxs-lookup"><span data-stu-id="04442-266">Number of jobs or tasks running on each node.</span></span> <span data-ttu-id="04442-267">這個值是近乎即時的快照集。</span><span class="sxs-lookup"><span data-stu-id="04442-267">This value is a near real-time snapshot.</span></span> <span data-ttu-id="04442-268">限制表示每個節點的最大並行作業數。</span><span class="sxs-lookup"><span data-stu-id="04442-268">Limit signifies the maximum concurrent jobs for each node.</span></span> <span data-ttu-id="04442-269">這個值會根據機器大小來定義。</span><span class="sxs-lookup"><span data-stu-id="04442-269">This value is defined based on the machine size.</span></span> <span data-ttu-id="04442-270">您可以提高限制以在進階案例 (CPU/記憶體/網路並未充分使用，但活動會逾時的案例) 中相應增加並行作業執行能力。單一節點的閘道也能擁有這樣的能力 (即使該閘道尚未啟用延展性和可用性功能)。</span><span class="sxs-lookup"><span data-stu-id="04442-270">You can increase the limit to scale up concurrent job execution in advanced scenarios, where CPU/ memory/ network is under-utilized, but activities are timing out. This capability is also available with a single-node gateway (even when the scalability and availability feature is not enabled).</span></span> <span data-ttu-id="04442-271">如需詳細資訊，請參閱[調整考量](#scale-considerations)一節。</span><span class="sxs-lookup"><span data-stu-id="04442-271">For more information, see [scale considerations](#scale-considerations) section.</span></span> 
<span data-ttu-id="04442-272">角色</span><span class="sxs-lookup"><span data-stu-id="04442-272">Role</span></span> | <span data-ttu-id="04442-273">有兩種角色 – 發送器和背景工作角色。</span><span class="sxs-lookup"><span data-stu-id="04442-273">There are two types of roles – Dispatcher and worker.</span></span> <span data-ttu-id="04442-274">所有節點都是背景工作角色，這表示它們全都能用來執行作業。</span><span class="sxs-lookup"><span data-stu-id="04442-274">All nodes are workers, which means they can all be used to execute jobs.</span></span> <span data-ttu-id="04442-275">發送器節點只有一個，可用來提取雲端服務中的工作/作業，並發送到不同的背景工作節點 (包括發送器節點本身)。</span><span class="sxs-lookup"><span data-stu-id="04442-275">There is only one dispatcher node, which is used to pull tasks/jobs from cloud services and dispatch them to different worker nodes (including itself).</span></span> 

![資料管理閘道 - 進階的多節點監視](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-multi-node-monitoring-advanced.png)

### <a name="gateway-status"></a><span data-ttu-id="04442-277">閘道狀態</span><span class="sxs-lookup"><span data-stu-id="04442-277">Gateway status</span></span>

<span data-ttu-id="04442-278">下表提供**閘道節點**的可能狀態：</span><span class="sxs-lookup"><span data-stu-id="04442-278">The following table provides possible statuses of a **gateway node**:</span></span> 

<span data-ttu-id="04442-279">狀態</span><span class="sxs-lookup"><span data-stu-id="04442-279">Status</span></span>  | <span data-ttu-id="04442-280">註解/案例</span><span class="sxs-lookup"><span data-stu-id="04442-280">Comments/Scenarios</span></span>
:------- | :------------------
<span data-ttu-id="04442-281">線上</span><span class="sxs-lookup"><span data-stu-id="04442-281">Online</span></span> | <span data-ttu-id="04442-282">節點已連線至 Data Factory 服務。</span><span class="sxs-lookup"><span data-stu-id="04442-282">Node connected to Data Factory service.</span></span>
<span data-ttu-id="04442-283">離線</span><span class="sxs-lookup"><span data-stu-id="04442-283">Offline</span></span> | <span data-ttu-id="04442-284">節點已離線。</span><span class="sxs-lookup"><span data-stu-id="04442-284">Node is offline.</span></span>
<span data-ttu-id="04442-285">升級中</span><span class="sxs-lookup"><span data-stu-id="04442-285">Upgrading</span></span> | <span data-ttu-id="04442-286">節點正在自動更新。</span><span class="sxs-lookup"><span data-stu-id="04442-286">The node is being auto-updated.</span></span>
<span data-ttu-id="04442-287">限制</span><span class="sxs-lookup"><span data-stu-id="04442-287">Limited</span></span> | <span data-ttu-id="04442-288">由於連線問題。</span><span class="sxs-lookup"><span data-stu-id="04442-288">Due to Connectivity issue.</span></span> <span data-ttu-id="04442-289">可能是因為 HTTP 連接埠 8050 問題、服務匯流排連線問題或認證同步問題。</span><span class="sxs-lookup"><span data-stu-id="04442-289">May be due to HTTP port 8050 issue, service bus connectivity issue, or credential sync issue.</span></span> 
<span data-ttu-id="04442-290">非使用中</span><span class="sxs-lookup"><span data-stu-id="04442-290">Inactive</span></span> | <span data-ttu-id="04442-291">節點所在的組態不同於其他大多數節點的組態。</span><span class="sxs-lookup"><span data-stu-id="04442-291">Node is in a configuration different from the configuration of other majority nodes.</span></span><br/><br/> <span data-ttu-id="04442-292">節點無法連線至其他節點時，便會處於非使用中狀態。</span><span class="sxs-lookup"><span data-stu-id="04442-292">A node can be inactive when it cannot connect to other nodes.</span></span> 


<span data-ttu-id="04442-293">下表提供**邏輯閘道**的可能狀態。</span><span class="sxs-lookup"><span data-stu-id="04442-293">The following table provides possible statuses of a **logical gateway**.</span></span> <span data-ttu-id="04442-294">閘道的狀態取決於閘道節點的狀態。</span><span class="sxs-lookup"><span data-stu-id="04442-294">The gateway status depends on statuses of the gateway nodes.</span></span> 

<span data-ttu-id="04442-295">狀態</span><span class="sxs-lookup"><span data-stu-id="04442-295">Status</span></span> | <span data-ttu-id="04442-296">註解</span><span class="sxs-lookup"><span data-stu-id="04442-296">Comments</span></span>
:----- | :-------
<span data-ttu-id="04442-297">需要註冊</span><span class="sxs-lookup"><span data-stu-id="04442-297">Needs Registration</span></span> | <span data-ttu-id="04442-298">此邏輯閘道還沒有已註冊的節點</span><span class="sxs-lookup"><span data-stu-id="04442-298">No node is yet registered to this logical gateway</span></span>
<span data-ttu-id="04442-299">線上</span><span class="sxs-lookup"><span data-stu-id="04442-299">Online</span></span> | <span data-ttu-id="04442-300">閘道節點已連線</span><span class="sxs-lookup"><span data-stu-id="04442-300">Gateway Nodes are online</span></span>
<span data-ttu-id="04442-301">離線</span><span class="sxs-lookup"><span data-stu-id="04442-301">Offline</span></span> | <span data-ttu-id="04442-302">沒有處於線上狀態的節點。</span><span class="sxs-lookup"><span data-stu-id="04442-302">No node in online status.</span></span>
<span data-ttu-id="04442-303">限制</span><span class="sxs-lookup"><span data-stu-id="04442-303">Limited</span></span> | <span data-ttu-id="04442-304">此閘道中的節點並非全都處於健康情況良好的狀態。</span><span class="sxs-lookup"><span data-stu-id="04442-304">Not all nodes in this gateway are in healthy state.</span></span> <span data-ttu-id="04442-305">這個狀態是某些節點可能會關閉的警告！</span><span class="sxs-lookup"><span data-stu-id="04442-305">This status is a warning that some node might be down!</span></span> <br/><br/><span data-ttu-id="04442-306">可能是因為發送器/背景工作節點有認證同步問題。</span><span class="sxs-lookup"><span data-stu-id="04442-306">Could be due to credential sync issue on dispatcher/worker node.</span></span> 

### <a name="pipeline-activities-monitoring"></a><span data-ttu-id="04442-307">管線/活動監視</span><span class="sxs-lookup"><span data-stu-id="04442-307">Pipeline/ activities monitoring</span></span>
<span data-ttu-id="04442-308">Azure 入口網站可為管線監視提供細微的節點層級詳細資料。</span><span class="sxs-lookup"><span data-stu-id="04442-308">The Azure portal provides a pipeline monitoring experience with granular node level details.</span></span> <span data-ttu-id="04442-309">例如，它會顯示哪些活動在哪個節點上執行。</span><span class="sxs-lookup"><span data-stu-id="04442-309">For example, it shows which activities ran on which node.</span></span> <span data-ttu-id="04442-310">這項資訊有助於了解特定節點的效能問題 (例如由於網路節流而導致)。</span><span class="sxs-lookup"><span data-stu-id="04442-310">This information can be helpful in understanding performance issues on a particular node, say due to network throttling.</span></span> 

![資料管理閘道 - 管線的多節點監視](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-multi-node-monitoring-pipelines.png)

![資料管理閘道 - 管線詳細資料](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-multi-node-pipeline-details.png)

## <a name="scale-considerations"></a><span data-ttu-id="04442-313">調整考量</span><span class="sxs-lookup"><span data-stu-id="04442-313">Scale considerations</span></span>

### <a name="scale-out"></a><span data-ttu-id="04442-314">相應放大</span><span class="sxs-lookup"><span data-stu-id="04442-314">Scale out</span></span>
<span data-ttu-id="04442-315">當**可用記憶體偏低**而 **CPU 使用率偏高**時，新增節點有助於相應放大機器所能承受的負載。</span><span class="sxs-lookup"><span data-stu-id="04442-315">When the **available memory is low** and the **CPU usage is high**, adding a new node helps scale out the load across machines.</span></span> <span data-ttu-id="04442-316">如果活動因為逾時或閘道節點離線而失敗，對閘道新增節點將有所助益。</span><span class="sxs-lookup"><span data-stu-id="04442-316">If activities are failing due to time-out or gateway node being offline, it helps if you add a node to the gateway.</span></span>
 
### <a name="scale-up"></a><span data-ttu-id="04442-317">相應增加</span><span class="sxs-lookup"><span data-stu-id="04442-317">Scale up</span></span>
<span data-ttu-id="04442-318">當可用的記憶體和 CPU 並未充分使用，但閒置容量已為 0，就應該增加節點上可執行的並行作業數目來進行相應增加。</span><span class="sxs-lookup"><span data-stu-id="04442-318">When the available memory and CPU are not utilized well, but the idle capacity is 0, you should scale up by increasing the number of concurrent jobs that can run on a node.</span></span> <span data-ttu-id="04442-319">當閘道超載而導致活動逾時，您也可以相應增加。</span><span class="sxs-lookup"><span data-stu-id="04442-319">You may also want to scale up when activities are timing out because the gateway is overloaded.</span></span> <span data-ttu-id="04442-320">如下圖所示，您可以提高節點的容量上限。</span><span class="sxs-lookup"><span data-stu-id="04442-320">As shown in the following image, you can increase the maximum capacity for a node.</span></span> <span data-ttu-id="04442-321">建議您一開始先提高為兩倍。</span><span class="sxs-lookup"><span data-stu-id="04442-321">We suggest doubling it to start with.</span></span>  

![資料管理閘道 - 調整考量](media/data-factory-data-management-gateway-high-availability-scalability/data-factory-gateway-scale-considerations.png)


## <a name="known-issuesbreaking-changes"></a><span data-ttu-id="04442-323">已知問題/重大變更</span><span class="sxs-lookup"><span data-stu-id="04442-323">Known issues/breaking changes</span></span>

- <span data-ttu-id="04442-324">單一邏輯閘道目前最多可以有四個實體閘道節點。</span><span class="sxs-lookup"><span data-stu-id="04442-324">Currently, you can have up to four physical gateway nodes for a single logical gateway.</span></span> <span data-ttu-id="04442-325">如果基於效能考量而需要四個以上的節點，請傳送電子郵件給 [DMGHelp@microsoft.com](mailto:DMGHelp@microsoft.com)。</span><span class="sxs-lookup"><span data-stu-id="04442-325">If you need more than four nodes for performance reasons, send an email to [DMGHelp@microsoft.com](mailto:DMGHelp@microsoft.com).</span></span>
- <span data-ttu-id="04442-326">您無法從另一個邏輯閘道使用驗證金鑰來重新註冊閘道節點，以跳脫目前的邏輯閘道。</span><span class="sxs-lookup"><span data-stu-id="04442-326">You cannot re-register a gateway node with the authentication key from another logical gateway to switch from the current logical gateway.</span></span> <span data-ttu-id="04442-327">若要重新註冊，請從節點解除安裝閘道、重新安裝閘道，然後使用驗證金鑰向其他邏輯閘道進行註冊。</span><span class="sxs-lookup"><span data-stu-id="04442-327">To re-register, uninstall the gateway from the node, reinstall the gateway, and register it with the authentication key for the other logical gateway.</span></span> 
- <span data-ttu-id="04442-328">如果您的所有閘道節點需要 HTTP Proxy，請在 diahost.exe.config 和 diawp.exe.config 中設定該 Proxy，並使用伺服器管理員來確定所有節點都有相同的 diahost.exe.config 和 diawip.exe.config。如需詳細資訊，請參閱[設定 Proxy 設定](data-factory-data-management-gateway.md#configure-proxy-server-settings)一節。</span><span class="sxs-lookup"><span data-stu-id="04442-328">If HTTP proxy is required for all your gateway nodes, set the proxy in diahost.exe.config and diawp.exe.config, and use the server manager to make sure all nodes have the same diahost.exe.config and diawip.exe.config. See [configure proxy settings](data-factory-data-management-gateway.md#configure-proxy-server-settings) section for details.</span></span> 
- <span data-ttu-id="04442-329">若要在閘道組態管理員中變更節點間通訊的加密模式，請在入口網站中只留下一個節點而刪除其他所有節點。</span><span class="sxs-lookup"><span data-stu-id="04442-329">To change encryption mode for node-to-node communication in Gateway Configuration Manager, delete all the nodes in the portal except one.</span></span> <span data-ttu-id="04442-330">然後，於加密模式變更後重新新增節點。</span><span class="sxs-lookup"><span data-stu-id="04442-330">Then, add nodes back after changing the encryption mode.</span></span>
- <span data-ttu-id="04442-331">如果您選擇要加密節點間的通訊通道，請使用官方的 SSL 憑證。</span><span class="sxs-lookup"><span data-stu-id="04442-331">Use an official SSL certificate if you choose to encrypt the node-to-node communication channel.</span></span> <span data-ttu-id="04442-332">自我簽署憑證可能會造成連線問題，因為相同的憑證可能不會受到其他機器上的憑證授權單位清單所信任。</span><span class="sxs-lookup"><span data-stu-id="04442-332">Self-signed certificate may cause connectivity issues as the same certificate may not be trusted in certifying authority list on other machines.</span></span> 
- <span data-ttu-id="04442-333">當節點版本低於邏輯閘道版本時，您就無法向邏輯閘道註冊閘道節點。</span><span class="sxs-lookup"><span data-stu-id="04442-333">You cannot register a gateway node to a logical gateway when the node version is lower than the logical gateway version.</span></span> <span data-ttu-id="04442-334">請從入口網站中刪除邏輯閘道的所有節點，以便您可以註冊比它的版本還低的節點 (降級)。</span><span class="sxs-lookup"><span data-stu-id="04442-334">Delete all nodes of the logical gateway from portal so that you can register a lower version node(downgrade) it.</span></span> <span data-ttu-id="04442-335">如果您刪除邏輯閘道的所有節點，請以手動方式對該邏輯閘道安裝並註冊新的節點。</span><span class="sxs-lookup"><span data-stu-id="04442-335">If you delete all nodes of a logical gateway, manually install and register new nodes to that logical gateway.</span></span> <span data-ttu-id="04442-336">在此情況下不支援快速設定。</span><span class="sxs-lookup"><span data-stu-id="04442-336">Express setup is not supported in this case.</span></span>
- <span data-ttu-id="04442-337">您無法使用快速設定來對仍在使用雲端認證的現有邏輯閘道安裝節點。</span><span class="sxs-lookup"><span data-stu-id="04442-337">You cannot use express setup to install nodes to an existing logical gateway, which is still using cloud credentials.</span></span> <span data-ttu-id="04442-338">您可以從閘道組態管理員的 [設定] 索引標籤查看認證的儲存位置。</span><span class="sxs-lookup"><span data-stu-id="04442-338">You can check where the credentials are stored from the Gateway Configuration Manager on the Settings tab.</span></span>
- <span data-ttu-id="04442-339">您無法使用快速設定來對已啟用節點間加密的現有邏輯閘道安裝節點。</span><span class="sxs-lookup"><span data-stu-id="04442-339">You cannot use express setup to install nodes to an existing logical gateway, which has node-to-node encryption enabled.</span></span> <span data-ttu-id="04442-340">設定加密模式牽涉到手動新增憑證，因此您無法再選擇快速安裝。</span><span class="sxs-lookup"><span data-stu-id="04442-340">As setting the encryption mode involves manually adding certificates, express install is no more an option.</span></span> 
- <span data-ttu-id="04442-341">若要從內部部署環境複製檔案，請勿再使用 \\localhost 或 C:\files，因為您可能無法透過所有節點存取 localhost 或本機磁碟機。</span><span class="sxs-lookup"><span data-stu-id="04442-341">For a file copy from on-premises environment, you should not use \\localhost or C:\files anymore since localhost or local drive might not be accessible via all nodes.</span></span> <span data-ttu-id="04442-342">請改用 \\ServerName\files 來指定檔案的位置。</span><span class="sxs-lookup"><span data-stu-id="04442-342">Instead, use \\ServerName\files to specify files’ location.</span></span>


## <a name="rolling-back-from-the-preview"></a><span data-ttu-id="04442-343">從預覽復原</span><span class="sxs-lookup"><span data-stu-id="04442-343">Rolling back from the preview</span></span> 
<span data-ttu-id="04442-344">若要從預覽復原，請留下一個節點，其他的節點全都刪除。</span><span class="sxs-lookup"><span data-stu-id="04442-344">To roll back from the preview, delete all nodes but one node.</span></span> <span data-ttu-id="04442-345">刪除哪一個節點都行，但請確保邏輯閘道中至少有一個節點。</span><span class="sxs-lookup"><span data-stu-id="04442-345">It doesn’t matter which nodes you delete, but ensure you have at least one node in the logical gateway.</span></span> <span data-ttu-id="04442-346">您可以藉由在機器上解除安裝閘道或使用 Azure 入口網站來刪除節點。</span><span class="sxs-lookup"><span data-stu-id="04442-346">You can delete a node either by uninstalling gateway on the machine or by using the Azure portal.</span></span> <span data-ttu-id="04442-347">在 Azure 入口網站的 [Data Factory] 頁面中，按一下 [已連結的服務] 來啟動 [已連結的服務] 頁面。</span><span class="sxs-lookup"><span data-stu-id="04442-347">In the Azure portal, in the **Data Factory** page, click Linked services to launch the **Linked services** page.</span></span> <span data-ttu-id="04442-348">選取閘道以啟動 [閘道] 頁面。</span><span class="sxs-lookup"><span data-stu-id="04442-348">Select the gateway to launch the **Gateway** page.</span></span> <span data-ttu-id="04442-349">在 [閘道] 頁面中，您可以看到與閘道相關聯的節點。</span><span class="sxs-lookup"><span data-stu-id="04442-349">In the Gateway page, you can see the nodes associated with the gateway.</span></span> <span data-ttu-id="04442-350">該頁面可讓您從閘道中刪除節點。</span><span class="sxs-lookup"><span data-stu-id="04442-350">The page lets you delete a node from the gateway.</span></span>
 
<span data-ttu-id="04442-351">在刪除之後，按一下同一個 Azure 入口網站頁面中的 [預覽功能]，並停用預覽功能。</span><span class="sxs-lookup"><span data-stu-id="04442-351">After deleting, click **preview features** in the same Azure portal page, and disable the preview feature.</span></span> <span data-ttu-id="04442-352">您已將您的閘道重設為只有一個節點的 GA (正式上市) 閘道。</span><span class="sxs-lookup"><span data-stu-id="04442-352">You have reset your gateway to one node GA (general availability) gateway.</span></span>


## <a name="next-steps"></a><span data-ttu-id="04442-353">後續步驟</span><span class="sxs-lookup"><span data-stu-id="04442-353">Next steps</span></span>
<span data-ttu-id="04442-354">請檢閱下列文章：</span><span class="sxs-lookup"><span data-stu-id="04442-354">Review the following articles:</span></span>
- <span data-ttu-id="04442-355">[資料管理閘道](data-factory-data-management-gateway.md) - 提供詳細的閘道概觀。</span><span class="sxs-lookup"><span data-stu-id="04442-355">[Data Management Gateway](data-factory-data-management-gateway.md) - provides a detailed overview of the gateway.</span></span>
- <span data-ttu-id="04442-356">[在內部部署和雲端資料存放區之間移動資料](data-factory-move-data-between-onprem-and-cloud.md) - 包含如何使用具有單一節點之閘道的逐步指示。</span><span class="sxs-lookup"><span data-stu-id="04442-356">[Move data between on-premises and cloud data stores](data-factory-move-data-between-onprem-and-cloud.md) - contains a walkthrough with step-by-step instructions for using a gateway with a single node.</span></span> 
