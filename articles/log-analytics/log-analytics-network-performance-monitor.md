---
title: "Azure Log Analytics 中的網路效能監視器方案 | Microsoft Docs"
description: "Azure Log Analytics 中的網路效能監視器可協助您即時監視網路的效能，以偵測和找出網路效能瓶頸。"
services: log-analytics
documentationcenter: 
author: bandersmsft
manager: carmonm
editor: 
ms.assetid: 5b9c9c83-3435-488c-b4f6-7653003ae18a
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: banders
ms.openlocfilehash: c6568e491429f6046ab164ab5eacd0ae5846e201
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/18/2017
---
# <a name="network-performance-monitor-solution-in-log-analytics"></a><span data-ttu-id="c2650-103">Log Analytics 中的網路效能監視器解決方案</span><span class="sxs-lookup"><span data-stu-id="c2650-103">Network Performance Monitor solution in Log Analytics</span></span>

![網路效能監控符號](./media/log-analytics-network-performance-monitor/npm-symbol.png)

<span data-ttu-id="c2650-105">本文件說明如何設定和使用 Log Analytics 中的網路效能監視器方案，協助您即時監視網路的效能，以偵測和找出網路效能瓶頸。</span><span class="sxs-lookup"><span data-stu-id="c2650-105">This document describes how to set-up and use the Network Performance Monitor solution in Log Analytics, which helps you monitor the performance of your networks-in near real-time-to detect and locate network performance bottlenecks.</span></span> <span data-ttu-id="c2650-106">使用網路效能監視器方案，可以監視兩個網路、子網路或伺服器之間的遺失和延遲。</span><span class="sxs-lookup"><span data-stu-id="c2650-106">With the Network Performance Monitor solution, you can monitor the loss and latency between two networks, subnets or servers.</span></span> <span data-ttu-id="c2650-107">網路效能監視器會偵測網路問題，例如流量黑洞、路由錯誤，以及傳統網路監視方法無法偵測的問題。</span><span class="sxs-lookup"><span data-stu-id="c2650-107">Network Performance Monitor detects network issues like traffic blackholing, routing errors, and issues that conventional network monitoring methods are not able to detect.</span></span> <span data-ttu-id="c2650-108">網路效能監視器會產生警示，並違反網路連結的臨界值時發生通知。</span><span class="sxs-lookup"><span data-stu-id="c2650-108">Network Performance Monitor generates alerts and notifies as and when a threshold is breached for a network link.</span></span> <span data-ttu-id="c2650-109">系統可以自動學習這些臨界值，您也可以將其設定為使用自訂警示規則。</span><span class="sxs-lookup"><span data-stu-id="c2650-109">These thresholds can be learned automatically by the system or you can configure them to use custom alert rules.</span></span> <span data-ttu-id="c2650-110">網路效能監視器可確保及時偵測網路效能問題，並使問題的來源局限於特定網路區段或裝置。</span><span class="sxs-lookup"><span data-stu-id="c2650-110">Network Performance Monitor ensures timely detection of network performance issues and localizes the source of the problem to a particular network segment or device.</span></span>

<span data-ttu-id="c2650-111">您可以利用方案儀表板來偵測網路問題，其中顯示您的網路摘要資訊，包括最近的網路健康狀態事件、狀況不良的網路連結，以及正面臨高封包遺失和延遲的子網路連結。</span><span class="sxs-lookup"><span data-stu-id="c2650-111">You can detect network issues with the solution dashboard which displays summarized information about your network including recent network health events, unhealthy network links, and subnetwork links that are facing high packet loss and latency.</span></span> <span data-ttu-id="c2650-112">您可以向下切入至網路連結，以檢視子網路的目前健康狀態及節點間的連結。</span><span class="sxs-lookup"><span data-stu-id="c2650-112">You can drill-down into a network link to view the current health status of subnetwork links as well as node-to-node links.</span></span> <span data-ttu-id="c2650-113">您也可以檢視網路、子網路和節點對節點層級的遺失和延遲歷史趨勢。</span><span class="sxs-lookup"><span data-stu-id="c2650-113">You can also view the historical trend of loss and latency at the network, subnetwork, and node-to-node level.</span></span> <span data-ttu-id="c2650-114">您可以藉由檢視封包遺失和延遲的歷史趨勢圖表來偵測暫時性網路問題，並找出拓撲圖上的網路瓶頸。</span><span class="sxs-lookup"><span data-stu-id="c2650-114">You can detect transient network issues by viewing historical trend charts for packet loss and latency and locate network bottlenecks on a topology map.</span></span> <span data-ttu-id="c2650-115">互動式拓撲圖可讓您將逐一躍點的網路路由視覺化，並判斷問題的來源。</span><span class="sxs-lookup"><span data-stu-id="c2650-115">The interactive topology graph allows you to visualize the hop-by-hop network routes and determine the source of the problem.</span></span> <span data-ttu-id="c2650-116">如同任何其他方案，您可以將「記錄檔搜尋」用於各種分析需求，以根據網路效能監視器所收集的資料建立自訂報告。</span><span class="sxs-lookup"><span data-stu-id="c2650-116">Like any other solutions, you can use Log Search for various analytics requirements to create custom reports based on the data collected by Network Performance Monitor.</span></span>

<span data-ttu-id="c2650-117">此方案使用綜合交易做為主要機制來偵測網路錯誤。</span><span class="sxs-lookup"><span data-stu-id="c2650-117">The solution uses synthetic transactions as a primary mechanism to detect network faults.</span></span> <span data-ttu-id="c2650-118">因此，您可以使用它，而不需考慮特定網路裝置的廠商或模型。</span><span class="sxs-lookup"><span data-stu-id="c2650-118">So, you can use it without regard for a specific network device's vendor or model.</span></span> <span data-ttu-id="c2650-119">其適用於內部部署、雲端 (IaaS) 和混合式環境。</span><span class="sxs-lookup"><span data-stu-id="c2650-119">It works across on-premises, cloud (IaaS), and hybrid environments.</span></span> <span data-ttu-id="c2650-120">此方案會自動探索網路拓撲和網路中的各種路由。</span><span class="sxs-lookup"><span data-stu-id="c2650-120">The solution automatically discovers the network topology and various routes in your network.</span></span>

<span data-ttu-id="c2650-121">一般的網路監視產品著重於監視網路裝置 (路由器、交換器等) 健康狀態，但未深入解析兩點之間網路連線的實際品質，然而網路效能監視器卻辦得到。</span><span class="sxs-lookup"><span data-stu-id="c2650-121">Typical network monitoring products focus on monitoring the network device (routers, switches etc.) health but do not provide insights into the actual quality of network connectivity between two points, which Network Performance Monitor does.</span></span>

### <a name="using-the-solution-standalone"></a><span data-ttu-id="c2650-122">獨立使用此方案</span><span class="sxs-lookup"><span data-stu-id="c2650-122">Using the solution standalone</span></span>
<span data-ttu-id="c2650-123">如果您想要監視重要工作負載、網路、資料中心或公司網站之間的網路連線品質，則可以使用網路效能監視器方案本身來監視下列項目之間的連線健康狀態︰</span><span class="sxs-lookup"><span data-stu-id="c2650-123">If you want to monitor the quality of network connections between their critical workloads, networks, datacenters or office sites, then you can use the Network Performance Monitor solution by itself to monitor connectivity health between:</span></span>

* <span data-ttu-id="c2650-124">使用公用或私人網路連接的多個資料中心或公司網站</span><span class="sxs-lookup"><span data-stu-id="c2650-124">multiple datacenters or office sites that are connected using a public or private network</span></span>
* <span data-ttu-id="c2650-125">執行企業營運應用程式的重要工作負載</span><span class="sxs-lookup"><span data-stu-id="c2650-125">critical workloads that are running line of business applications</span></span>
* <span data-ttu-id="c2650-126">公用雲端服務 (如 Microsoft Azure 或 Amazon Web Services (AWS)) 與內部部署網路，前提是您有可用的 IaaS (VM) 並已將閘道設定為允許內部部署網路與雲端網路之間的通訊</span><span class="sxs-lookup"><span data-stu-id="c2650-126">public cloud services like Microsoft Azure or Amazon Web Services (AWS) and on-premises networks, if you have IaaS (VM) available and you have gateways configured to allow communication between on-premises networks and cloud networks</span></span>
* <span data-ttu-id="c2650-127">當您使用 ExpressRoute 時的 Azure 與內部部署網路</span><span class="sxs-lookup"><span data-stu-id="c2650-127">Azure and on-premises networks when you use Express Route</span></span>

### <a name="using-the-solution-with-other-networking-tools"></a><span data-ttu-id="c2650-128">使用此方案搭配其他網路工具</span><span class="sxs-lookup"><span data-stu-id="c2650-128">Using the solution with other networking tools</span></span>
<span data-ttu-id="c2650-129">如果您想要監視企業營運應用程式，您可以使用網路效能監視器方案做為其他網路工具的配對方案。</span><span class="sxs-lookup"><span data-stu-id="c2650-129">If you want to monitor a line of business application, you can use the Network Performance Monitor solution as a companion solution to other network tools.</span></span> <span data-ttu-id="c2650-130">低速網路可能會導致低速的應用程式，網路效能監視器可協助您調查由基礎網路問題所造成的應用程式效能問題。</span><span class="sxs-lookup"><span data-stu-id="c2650-130">A slow network can lead to slow applications and Network Performance Monitor can help you investigate application performance issues that are caused by underlying networking issues.</span></span> <span data-ttu-id="c2650-131">因為此方案不需要存取任何網路裝置，所以應用程式管理員不需要依賴網路小組提供網路對應用程式有何影響的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="c2650-131">Because the solution does not require any access to network devices, the application administrator doesn't need to rely on a networking team to provide information about how the network is affecting applications.</span></span>

<span data-ttu-id="c2650-132">此外，如果您已投資其他網路監視工具，此方案則可補足這些工具，因為大部分的傳統網路監視解決方案不會深入解析端對端網路效能計量，例如遺失和延遲。</span><span class="sxs-lookup"><span data-stu-id="c2650-132">Also, if you already invest in other network monitoring tools, then the solution can complement those tools because most traditional network monitoring solutions do not provide insights into end-to-end network performance metrics like loss and latency.</span></span>  <span data-ttu-id="c2650-133">網路效能監視器方案有助於填補該不足之處。</span><span class="sxs-lookup"><span data-stu-id="c2650-133">The Network Performance Monitor solution can help fill that gap.</span></span>

## <a name="installing-and-configuring-agents-for-the-solution"></a><span data-ttu-id="c2650-134">安裝和設定方案的代理程式</span><span class="sxs-lookup"><span data-stu-id="c2650-134">Installing and configuring agents for the solution</span></span>
<span data-ttu-id="c2650-135">使用[將 Windows 電腦連接到 Log Analytics](log-analytics-windows-agents.md) 和[將 Operations Manager 連接到Log Analytics](log-analytics-om-agents.md) 中的基本程序來安裝代理程式。</span><span class="sxs-lookup"><span data-stu-id="c2650-135">Use the basic processes to install agents at [Connect Windows computers to Log Analytics](log-analytics-windows-agents.md) and [Connect Operations Manager to Log Analytics](log-analytics-om-agents.md).</span></span>

> [!NOTE]
> <span data-ttu-id="c2650-136">您必須安裝至少 2 個代理程式，才能有足夠的資料來探索及監視網路資源。</span><span class="sxs-lookup"><span data-stu-id="c2650-136">You'll need to install at least 2 agents in order to have enough data to discover and monitor your network resources.</span></span> <span data-ttu-id="c2650-137">否則，此方案會保持設定中狀態，直到您安裝及設定其他代理程式為止。</span><span class="sxs-lookup"><span data-stu-id="c2650-137">Otherwise, the solution will remain in a configuring state until you install and configure additional agents.</span></span>
>
>

### <a name="where-to-install-the-agents"></a><span data-ttu-id="c2650-138">安裝代理程式的位置</span><span class="sxs-lookup"><span data-stu-id="c2650-138">Where to install the agents</span></span>
<span data-ttu-id="c2650-139">安裝代理程式之前，請考慮您的網路拓撲以及您想要監視的網路部分。</span><span class="sxs-lookup"><span data-stu-id="c2650-139">Before you install agents, consider the topology of your network and what parts of the network you want to monitor.</span></span> <span data-ttu-id="c2650-140">建議您針對想要監視的每個子網路安裝多個代理程式。</span><span class="sxs-lookup"><span data-stu-id="c2650-140">We recommend that you install more than one agent for each subnet that you want to monitor.</span></span> <span data-ttu-id="c2650-141">換句話說，針對您想要監視的每個子網路，選擇兩部或多部伺服器或 VM 並在其上安裝代理程式。</span><span class="sxs-lookup"><span data-stu-id="c2650-141">In other words, for every subnet that you want to monitor, choose two or more servers or VMs and install the agent on them.</span></span>

<span data-ttu-id="c2650-142">如果您不確定您的網路拓撲，請在具有重要工作負載且您想要監視網路效能的伺服器上安裝代理程式。</span><span class="sxs-lookup"><span data-stu-id="c2650-142">If you are unsure about the topology of your network, install the agents on servers with critical workloads where you want to monitor the network performance.</span></span> <span data-ttu-id="c2650-143">比方說，您可能想要追蹤 Web 伺服器與執行 SQL Server 的伺服器之間的網路連線。</span><span class="sxs-lookup"><span data-stu-id="c2650-143">For example, you might want to keep track of a network connection between a Web server and a server running SQL Server.</span></span> <span data-ttu-id="c2650-144">在此範例中，您會在兩部伺服器上安裝代理程式。</span><span class="sxs-lookup"><span data-stu-id="c2650-144">In this example, you'd install an agent on both servers.</span></span>

<span data-ttu-id="c2650-145">代理程式會監視主機之間的網路連線 (連結) - 而不是主機本身。</span><span class="sxs-lookup"><span data-stu-id="c2650-145">Agents monitor network connectivity (links) between hosts -- not the hosts themselves.</span></span> <span data-ttu-id="c2650-146">所以，若要監視網路連結，您必須在該連結的兩個端點上安裝代理程式。</span><span class="sxs-lookup"><span data-stu-id="c2650-146">So, to monitor a network link, you must install agents on both endpoints of that link.</span></span>

### <a name="configure-agents"></a><span data-ttu-id="c2650-147">設定代理程式</span><span class="sxs-lookup"><span data-stu-id="c2650-147">Configure agents</span></span>

<span data-ttu-id="c2650-148">如果您想要使用 ICMP 通訊協定進行綜合交易，您必須啟用下列防火牆規則，以便可靠地使用 ICMP：</span><span class="sxs-lookup"><span data-stu-id="c2650-148">If you intend to use the ICMP protocol for synthetic transactions, you need to enable the following firewall rules for reliably utilizing ICMP:</span></span>

```
netsh advfirewall firewall add rule name="NPMDICMPV4Echo" protocol="icmpv4:8,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV6Echo" protocol="icmpv6:128,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV4DestinationUnreachable" protocol="icmpv4:3,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV6DestinationUnreachable" protocol="icmpv6:1,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV4TimeExceeded" protocol="icmpv4:11,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV6TimeExceeded" protocol="icmpv6:3,any" dir=in action=allow
```


<span data-ttu-id="c2650-149">如果您要使用 TCP 通訊協定，必須開啟這些電腦的防火牆連接埠，確保代理程式可以通訊。</span><span class="sxs-lookup"><span data-stu-id="c2650-149">If you intend to use the TCP protocol you need to open firewall ports for those computers to ensure that agents can communicate.</span></span> <span data-ttu-id="c2650-150">您必須使用系統管理權限下載並執行 [EnableRules.ps1 PowerShell 指令碼](https://gallery.technet.microsoft.com/OMS-Network-Performance-04a66634)，而不需 PowerShell 視窗中的任何參數。</span><span class="sxs-lookup"><span data-stu-id="c2650-150">You need to download and then run the [EnableRules.ps1 PowerShell script](https://gallery.technet.microsoft.com/OMS-Network-Performance-04a66634) without any parameters in a PowerShell window with administrative privileges.</span></span>

<span data-ttu-id="c2650-151">此指令碼會建立網路效能監視器所需的登錄機碼並建立 Windows 防火牆規則，以允許代理程式彼此建立 TCP 連線。</span><span class="sxs-lookup"><span data-stu-id="c2650-151">The script creates registry keys required by the Network Performance Monitor and it creates Windows firewall rules to allow agents to create TCP connections with each other.</span></span> <span data-ttu-id="c2650-152">此指令碼建立的登錄機碼也會指定是否記錄偵錯記錄檔和記錄檔的路徑。</span><span class="sxs-lookup"><span data-stu-id="c2650-152">The registry keys created by the script also specify whether to log the debug logs and the path for the logs file.</span></span> <span data-ttu-id="c2650-153">它也會定義用於通訊的代理程式 TCP 連接埠。</span><span class="sxs-lookup"><span data-stu-id="c2650-153">It also defines the agent TCP port used for communication.</span></span> <span data-ttu-id="c2650-154">此指令碼會自動設定這些機碼的值，所以您不應手動變更這些機碼。</span><span class="sxs-lookup"><span data-stu-id="c2650-154">The values for these keys are automatically set by the script, so you should not manually change these keys.</span></span>

<span data-ttu-id="c2650-155">預設開啟的連接埠是 8084。</span><span class="sxs-lookup"><span data-stu-id="c2650-155">The port opened by default is 8084.</span></span> <span data-ttu-id="c2650-156">將 `portNumber` 參數提供給此指令碼，即可使用自訂連接埠。</span><span class="sxs-lookup"><span data-stu-id="c2650-156">You can use a custom port by providing the parameter `portNumber` to the script.</span></span> <span data-ttu-id="c2650-157">不過，相同的連接埠應使用於指令碼執行所在的所有電腦上。</span><span class="sxs-lookup"><span data-stu-id="c2650-157">However, the same port should be used on all the computers where the script is run.</span></span>

> [!NOTE]
> <span data-ttu-id="c2650-158">EnableRules.ps1 指令碼只能在指令碼執行所在的電腦上設定 Windows 防火牆規則。</span><span class="sxs-lookup"><span data-stu-id="c2650-158">The EnableRules.ps1 script configures Windows firewall rules only on the computer where the script is run.</span></span> <span data-ttu-id="c2650-159">如果您有網路防火牆，您應該確定它允許指向網路效能監視器所用 TCP 連接埠的流量。</span><span class="sxs-lookup"><span data-stu-id="c2650-159">If you have a network firewall, you should make sure that it allows traffic destined for the TCP port being used by Network Performance Monitor.</span></span>
>
>

## <a name="configuring-the-solution"></a><span data-ttu-id="c2650-160">設定方案</span><span class="sxs-lookup"><span data-stu-id="c2650-160">Configuring the solution</span></span>
<span data-ttu-id="c2650-161">請使用下列資訊來安裝和設定方案。</span><span class="sxs-lookup"><span data-stu-id="c2650-161">Use the following information to install and configure the solution.</span></span>

1. <span data-ttu-id="c2650-162">網路效能監視器方案可從執行 Windows Server 2008 SP1 或更新版本或 Windows 7 SP1 或更新版本的電腦取得資料，這與 Microsoft Monitoring Agent (MMA) 的需求相同。</span><span class="sxs-lookup"><span data-stu-id="c2650-162">The Network Performance Monitor solution acquires data from computers running Windows Server 2008 SP 1 or later or Windows 7 SP1 or later, which are the same requirements as the Microsoft Monitoring Agent (MMA).</span></span> <span data-ttu-id="c2650-163">NPM 代理程式也可以在 Windows 桌面/用戶端作業系統 (Windows 10、Windows 8.1、Windows 8 和 Windows 7) 上執行。</span><span class="sxs-lookup"><span data-stu-id="c2650-163">NPM agents can also run on Windows desktop/client operating systems (Windows 10, Windows 8.1, Windows 8 and Windows 7).</span></span>
    >[!NOTE]
    ><span data-ttu-id="c2650-164">Windows 伺服器作業系統的代理程式支援 TCP 和 ICMP 做為綜合交易的通訊協定。</span><span class="sxs-lookup"><span data-stu-id="c2650-164">The agents for Windows server operating systems support both TCP and ICMP as the protocols for synthetic transaction.</span></span> <span data-ttu-id="c2650-165">不過，Windows 用戶端作業系統的代理程式僅支援 ICMP 做為綜合交易的通訊協定。</span><span class="sxs-lookup"><span data-stu-id="c2650-165">However, the agents for Windows client operating systems only support ICMP as the protocol for synthetic transaction.</span></span>

2. <span data-ttu-id="c2650-166">從 [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.NetworkMonitoringOMS?tab=Overview) 或使用[從方案庫新增 Log Analytics 方案](log-analytics-add-solutions.md)中所述的程序，將網路效能監視器方案新增至您的工作區。</span><span class="sxs-lookup"><span data-stu-id="c2650-166">Add the Network Performance Monitor solution to your workspace from [Azure marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.NetworkMonitoringOMS?tab=Overview) or by using the process described in [Add Log Analytics solutions from the Solutions Gallery](log-analytics-add-solutions.md).</span></span>  
   <span data-ttu-id="c2650-167">![網路效能監視器符號](./media/log-analytics-network-performance-monitor/npm-symbol.png)</span><span class="sxs-lookup"><span data-stu-id="c2650-167">![Network Performance Monitor symbol](./media/log-analytics-network-performance-monitor/npm-symbol.png)</span></span>
3. <span data-ttu-id="c2650-168">在 OMS 入口網站中，您會看到標題為 [網路效能監視器] 的新圖格以及「方案需要額外設定」訊息。</span><span class="sxs-lookup"><span data-stu-id="c2650-168">In the OMS portal, you'll see a new tile titled **Network Performance Monitor** with the message *Solution requires additional configuration*.</span></span> <span data-ttu-id="c2650-169">您必須將方案設定為根據代理程式探索到的子網路和節點新增網路。</span><span class="sxs-lookup"><span data-stu-id="c2650-169">You'll need to configure the solution to add networks based on subnetworks and nodes that are discovered by agents.</span></span> <span data-ttu-id="c2650-170">按一下 [網路效能監視器] 開始設定預設網路。</span><span class="sxs-lookup"><span data-stu-id="c2650-170">Click **Network Performance Monitor** to start configuring the default network.</span></span>  
   <span data-ttu-id="c2650-171">![方案需要額外設定](./media/log-analytics-network-performance-monitor/npm-config.png)</span><span class="sxs-lookup"><span data-stu-id="c2650-171">![solution requires additional configuration](./media/log-analytics-network-performance-monitor/npm-config.png)</span></span>

### <a name="configure-the-solution-with-a-default-network"></a><span data-ttu-id="c2650-172">使用預設網路設定方案</span><span class="sxs-lookup"><span data-stu-id="c2650-172">Configure the solution with a default network</span></span>
<span data-ttu-id="c2650-173">在設定頁面上，您會看到名為 [預設] 的單一網路。</span><span class="sxs-lookup"><span data-stu-id="c2650-173">On the configuration page, you'll see a single network named **Default**.</span></span> <span data-ttu-id="c2650-174">如果尚未定義任何網路，則所有自動探索的子網路都會放在預設網路中。</span><span class="sxs-lookup"><span data-stu-id="c2650-174">When you haven't defined any networks, all the automatically-discovered subnets are placed in the Default network.</span></span>

<span data-ttu-id="c2650-175">每當您建立網路時，您會新增其子網路，而該子網路會從預設網路中移除。</span><span class="sxs-lookup"><span data-stu-id="c2650-175">Whenever you create a network, you add a subnet to it and that subnet is removed from the Default network.</span></span> <span data-ttu-id="c2650-176">如果您刪除網路，其所有子網路都會自動回到預設網路。</span><span class="sxs-lookup"><span data-stu-id="c2650-176">If you delete a network, all its subnets are automatically returned to the Default network.</span></span>

<span data-ttu-id="c2650-177">換句話說，預設網路是所有未包含於使用者定義網路之子網路的容器。</span><span class="sxs-lookup"><span data-stu-id="c2650-177">In other words, the Default network is the container for all the subnets that are not contained in any user-defined network.</span></span> <span data-ttu-id="c2650-178">您無法編輯或刪除預設網路。</span><span class="sxs-lookup"><span data-stu-id="c2650-178">You cannot edit or delete the Default network.</span></span> <span data-ttu-id="c2650-179">它一定會保留在系統中。</span><span class="sxs-lookup"><span data-stu-id="c2650-179">It always remains in the system.</span></span> <span data-ttu-id="c2650-180">不果，您可以視需要建立任意數量的網路。</span><span class="sxs-lookup"><span data-stu-id="c2650-180">However, you can create as many networks as you need.</span></span>

<span data-ttu-id="c2650-181">在大部分情況下，組織中的子網路會安排在多個網路中，您應該建立一或多個網路，才能以邏輯方式將子網路分組。</span><span class="sxs-lookup"><span data-stu-id="c2650-181">In most cases, the subnets in your organization will be arranged in more than one network and you should create one or more networks to logically group your subnets.</span></span>

### <a name="create-new-networks"></a><span data-ttu-id="c2650-182">建立新網路</span><span class="sxs-lookup"><span data-stu-id="c2650-182">Create new networks</span></span>
<span data-ttu-id="c2650-183">網路效能監視器中的網路是子網路的容器。</span><span class="sxs-lookup"><span data-stu-id="c2650-183">A network in Network Performance Monitor is a container for subnets.</span></span> <span data-ttu-id="c2650-184">您可以使用您所要的任何名稱來建立網路，並將子網路新增到該網路。</span><span class="sxs-lookup"><span data-stu-id="c2650-184">You can create a network with any name that you want and add subnets to the network.</span></span> <span data-ttu-id="c2650-185">例如，您可以建立名為 Building1 的網路，然後新增子網路，也可以建立名為 DMZ 的網路，然後將所有屬於非軍事區的子網路新增至此網路。</span><span class="sxs-lookup"><span data-stu-id="c2650-185">For example, you can create a network named *Building1* and then add subnets, or you can create a network named *DMZ* and then add all subnets belonging to demilitarized zone to this network.</span></span>

#### <a name="to-create-a-new-network"></a><span data-ttu-id="c2650-186">若要建立新網路</span><span class="sxs-lookup"><span data-stu-id="c2650-186">To create a new network</span></span>
1. <span data-ttu-id="c2650-187">按一下 [新增網路]，然後輸入網路名稱和描述。</span><span class="sxs-lookup"><span data-stu-id="c2650-187">Click **Add network** and then type the network name and description.</span></span>
2. <span data-ttu-id="c2650-188">選取一或多個子網路，然後按一下 [新增]。</span><span class="sxs-lookup"><span data-stu-id="c2650-188">Select one or more subnets, and then click **Add**.</span></span>
3. <span data-ttu-id="c2650-189">按一下 [儲存] 儲存組態。</span><span class="sxs-lookup"><span data-stu-id="c2650-189">Click **Save** to save the configuration.</span></span>  
   <span data-ttu-id="c2650-190">![新增網路](./media/log-analytics-network-performance-monitor/npm-add-network.png)</span><span class="sxs-lookup"><span data-stu-id="c2650-190">![add network](./media/log-analytics-network-performance-monitor/npm-add-network.png)</span></span>

### <a name="wait-for-data-aggregation"></a><span data-ttu-id="c2650-191">等候資料彙總</span><span class="sxs-lookup"><span data-stu-id="c2650-191">Wait for data aggregation</span></span>
<span data-ttu-id="c2650-192">第一次儲存組態之後，解決方案就會開始收集代理程式安裝所在節點之間的網路封包遺失和延遲資訊。</span><span class="sxs-lookup"><span data-stu-id="c2650-192">After you've saved the configuration for first time, the solution starts collecting network packet loss and latency information between the nodes where agents are installed.</span></span> <span data-ttu-id="c2650-193">此程序可能需要一些時間，有時候超過 30 分鐘。</span><span class="sxs-lookup"><span data-stu-id="c2650-193">This process can take a while, sometimes over 30 minutes.</span></span> <span data-ttu-id="c2650-194">在此狀態下，概觀頁面中的 [網路效能監視器] 圖格會顯示一則訊息，表示「資料彙總進行中」。</span><span class="sxs-lookup"><span data-stu-id="c2650-194">During this state, the Network Performance Monitor tile in the overview page displays a message stating *Data aggregation in process*.</span></span>

![資料彙總進行中](./media/log-analytics-network-performance-monitor/npm-aggregation.png)

<span data-ttu-id="c2650-196">資料上傳後，您會看到更新後的 [網路效能監視器] 圖格顯示資料。</span><span class="sxs-lookup"><span data-stu-id="c2650-196">When the data has been uploaded, you'll see the Network Performance Monitor tile updated showing data.</span></span>

![網路效能監視器圖格](./media/log-analytics-network-performance-monitor/npm-tile.png)

<span data-ttu-id="c2650-198">按一下此圖格可檢視網路效能監視器儀表板。</span><span class="sxs-lookup"><span data-stu-id="c2650-198">Click the tile to view the Network Performance Monitor dashboard.</span></span>

![網路效能監視器儀表板](./media/log-analytics-network-performance-monitor/npm-dash01.png)

### <a name="edit-monitoring-settings-for-subnets"></a><span data-ttu-id="c2650-200">編輯子網路的監視設定</span><span class="sxs-lookup"><span data-stu-id="c2650-200">Edit monitoring settings for subnets</span></span>
<span data-ttu-id="c2650-201">至少安裝一個代理程式的所有子網路都會列在設定頁面的 [子網路] 索引標籤上。</span><span class="sxs-lookup"><span data-stu-id="c2650-201">All subnets where at least one agent was installed are listed on the **Subnetworks** tab in the configuration page.</span></span>

#### <a name="to-enable-or-disable-monitoring-for-particular-subnetworks"></a><span data-ttu-id="c2650-202">啟用或停用特定子網路的監視</span><span class="sxs-lookup"><span data-stu-id="c2650-202">To enable or disable monitoring for particular subnetworks</span></span>
1. <span data-ttu-id="c2650-203">選取或清除 [子網路識別碼] 旁邊的方塊，然後確定已視情況選取或清除 [用於監視]。</span><span class="sxs-lookup"><span data-stu-id="c2650-203">Select or clear the box next to the **subnetwork ID** and then ensure that **Use for Monitoring** is selected or cleared, as appropriate.</span></span> <span data-ttu-id="c2650-204">您可以選取或清除多個子網路。</span><span class="sxs-lookup"><span data-stu-id="c2650-204">You can select or clear multiple subnets.</span></span> <span data-ttu-id="c2650-205">停用後，子網路就不受監視，因為代理程式將會更新為停止 ping 其他代理程式。</span><span class="sxs-lookup"><span data-stu-id="c2650-205">When disabled, subnetworks are not monitored as the agents will be updated to stop pinging other agents.</span></span>
2. <span data-ttu-id="c2650-206">從清單中選取特定子網路，並且在包含未受監視和受監視節點的清單之間移動所需的節點，即可選擇您想要監視之子網路的節點。</span><span class="sxs-lookup"><span data-stu-id="c2650-206">Choose the nodes that you want to monitor for a particular subnetwork by selecting the subnetwork from the list and moving the required nodes between the lists containing unmonitored and monitored nodes.</span></span>
   <span data-ttu-id="c2650-207">您可以視需要新增子網路的自訂**描述**。</span><span class="sxs-lookup"><span data-stu-id="c2650-207">You can add a custom **description** to the subnetwork, if you like.</span></span>
3. <span data-ttu-id="c2650-208">按一下 [儲存] 儲存組態。</span><span class="sxs-lookup"><span data-stu-id="c2650-208">Click **Save** to save the configuration.</span></span>  
   <span data-ttu-id="c2650-209">![編輯子網路](./media/log-analytics-network-performance-monitor/npm-edit-subnet.png)</span><span class="sxs-lookup"><span data-stu-id="c2650-209">![edit subnet](./media/log-analytics-network-performance-monitor/npm-edit-subnet.png)</span></span>

### <a name="choose-nodes-to-monitor"></a><span data-ttu-id="c2650-210">選擇要監視的節點</span><span class="sxs-lookup"><span data-stu-id="c2650-210">Choose nodes to monitor</span></span>
<span data-ttu-id="c2650-211">所有已安裝代理程式的節點會都列在 [節點] 索引標籤中。</span><span class="sxs-lookup"><span data-stu-id="c2650-211">All the nodes that have an agent installed on them are listed in the **Nodes** tab.</span></span>

#### <a name="to-enable-or-disable-monitoring-for-nodes"></a><span data-ttu-id="c2650-212">若要啟用或停用節點的監視</span><span class="sxs-lookup"><span data-stu-id="c2650-212">To enable or disable monitoring for nodes</span></span>
1. <span data-ttu-id="c2650-213">選取或清除您要監視或停止監視的節點。</span><span class="sxs-lookup"><span data-stu-id="c2650-213">Select or clear the nodes that you want to monitor or stop monitoring.</span></span>
2. <span data-ttu-id="c2650-214">視需要按一下 [用於監視]，或加以清除。</span><span class="sxs-lookup"><span data-stu-id="c2650-214">Click **Use for Monitoring**, or clear it, as appropriate.</span></span>
3. <span data-ttu-id="c2650-215">按一下 [儲存] 。</span><span class="sxs-lookup"><span data-stu-id="c2650-215">Click **Save**.</span></span>  
   <span data-ttu-id="c2650-216">![啟用節點監視](./media/log-analytics-network-performance-monitor/npm-enable-node-monitor.png)</span><span class="sxs-lookup"><span data-stu-id="c2650-216">![enable node monitoring](./media/log-analytics-network-performance-monitor/npm-enable-node-monitor.png)</span></span>

### <a name="set-monitoring-rules"></a><span data-ttu-id="c2650-217">設定監視規則</span><span class="sxs-lookup"><span data-stu-id="c2650-217">Set monitoring rules</span></span>
<span data-ttu-id="c2650-218">網路效能監視器會在違反臨界值時，產生有關一對節點、子網路或網路連結之間連線的健康狀態事件。</span><span class="sxs-lookup"><span data-stu-id="c2650-218">Network Performance Monitor generates health events about the connectivity between a pair of nodes or subnetwork or network links when a threshold is breached.</span></span> <span data-ttu-id="c2650-219">系統可以自動學習這些臨界值，您也可以將其設定為自訂警示規則。</span><span class="sxs-lookup"><span data-stu-id="c2650-219">These thresholds can be learned automatically by the system or you can configure them custom alert rules.</span></span>

<span data-ttu-id="c2650-220">系統會建立「預設規則」，並且在任何一對網路或子網路連結之間的遺失或延遲違反系統所了解的臨界值時建立健康狀態事件。</span><span class="sxs-lookup"><span data-stu-id="c2650-220">The *Default rule* is created by the system and it creates a health event whenever loss or latency between any pair of networks or subnetwork links breaches the system-learned threshold.</span></span> <span data-ttu-id="c2650-221">您可以選擇停用預設規則並建立自訂監視規則</span><span class="sxs-lookup"><span data-stu-id="c2650-221">You can choose to disable the default rule and create custom monitoring rules</span></span>

#### <a name="to-create-custom-monitoring-rules"></a><span data-ttu-id="c2650-222">若要建立自訂監視規則</span><span class="sxs-lookup"><span data-stu-id="c2650-222">To create custom monitoring rules</span></span>
1. <span data-ttu-id="c2650-223">按一下 [監視] 索引標籤中的 [新增規則]，然後輸入規則名稱和描述。</span><span class="sxs-lookup"><span data-stu-id="c2650-223">Click **Add Rule** in the **Monitor** tab and enter the rule name and description.</span></span>
2. <span data-ttu-id="c2650-224">從清單中選取一對要監視的網路或子網路連結。</span><span class="sxs-lookup"><span data-stu-id="c2650-224">Select the pair of network or subnetwork links to monitor from the lists.</span></span>
3. <span data-ttu-id="c2650-225">先從網路下拉式清單中選取包含第一個感興趣子網路的網路，然後再從對應的子網路下拉式清單中選取子網路。</span><span class="sxs-lookup"><span data-stu-id="c2650-225">First select the network in which the first subnetwork/s of interest is contained from the network dropdown, and then select the subnetwork/s from the corresponding subnetwork dropdown.</span></span>
   <span data-ttu-id="c2650-226">如果您要監視網路連結中的所有子網路，請選取 [所有子網路]。</span><span class="sxs-lookup"><span data-stu-id="c2650-226">Select **All subnetworks** if you want to monitor all the subnetworks in a network link.</span></span> <span data-ttu-id="c2650-227">同樣地，選取其他感興趣的子網路。</span><span class="sxs-lookup"><span data-stu-id="c2650-227">Similarly select the other subnetwork/s of interest.</span></span> <span data-ttu-id="c2650-228">而且，您可以按一下 [新增例外狀況]，從您所做的選取範圍中排除特定子網路連結的監視。</span><span class="sxs-lookup"><span data-stu-id="c2650-228">And, you can click **Add Exception** to exclude monitoring for particular subnetwork links from the selection you've made.</span></span>
4. <span data-ttu-id="c2650-229">在 ICMP 和 TCP 通訊協定之間選擇，供您用來執行綜合交易。</span><span class="sxs-lookup"><span data-stu-id="c2650-229">Choose between ICMP and TCP protocols for executing synthetic transactions.</span></span>
5. <span data-ttu-id="c2650-230">如果您不想建立所選項目的健康狀態事件，則清除 [在此規則所涵蓋的連結上啟用健康狀態監視]。</span><span class="sxs-lookup"><span data-stu-id="c2650-230">If you don't want to create health events for the items you've selected, then clear **Enable health monitoring on the links covered by this rule**.</span></span>
6. <span data-ttu-id="c2650-231">選擇監視條件。</span><span class="sxs-lookup"><span data-stu-id="c2650-231">Choose monitoring conditions.</span></span>
   <span data-ttu-id="c2650-232">您可以輸入臨界值，以設定健康狀態事件產生的自訂臨界值。</span><span class="sxs-lookup"><span data-stu-id="c2650-232">You can set custom thresholds for health event generation by typing threshold values.</span></span> <span data-ttu-id="c2650-233">只要條件的值高於針對所選網路/子網路配對選取的臨界值時，就會產生健康狀態事件。</span><span class="sxs-lookup"><span data-stu-id="c2650-233">Whenever the value of the condition goes above its selected threshold for the selected network/subnetwork pair, a health event is generated.</span></span>
7. <span data-ttu-id="c2650-234">按一下 [儲存] 儲存組態。</span><span class="sxs-lookup"><span data-stu-id="c2650-234">Click **Save** to save the configuration.</span></span>  
   <span data-ttu-id="c2650-235">![建立自訂監視規則](./media/log-analytics-network-performance-monitor/npm-monitor-rule.png)</span><span class="sxs-lookup"><span data-stu-id="c2650-235">![create custom monitoring rule](./media/log-analytics-network-performance-monitor/npm-monitor-rule.png)</span></span>

<span data-ttu-id="c2650-236">儲存監視規則之後，您可以按一下**建立警示**，使用警示管理整合該規則。</span><span class="sxs-lookup"><span data-stu-id="c2650-236">After you save a monitoring rule, you can integrate that rule with Alert Management by clicking **Create Alert**.</span></span> <span data-ttu-id="c2650-237">警示規則會使用搜尋查詢自動建立，且其他必要參數會自動填滿。</span><span class="sxs-lookup"><span data-stu-id="c2650-237">An alert rule is automatically created with the search query and other required parameters automatically filled-in.</span></span> <span data-ttu-id="c2650-238">使用警示規則，除了 NPM 內現有的警示，您還可以接收電子郵件型警示。</span><span class="sxs-lookup"><span data-stu-id="c2650-238">Using an alert rule, you can receive email-based alerts, in addition to the existing alerts within NPM.</span></span> <span data-ttu-id="c2650-239">警示也會使用 runbook 觸發修復動作，或可以使用 webhook 與現有的服務管理解決方案整合。</span><span class="sxs-lookup"><span data-stu-id="c2650-239">Alerts can also trigger remedial actions with runbooks or they can integrate with existing service management solutions using webhooks.</span></span> <span data-ttu-id="c2650-240">您可以按一下**管理警示**以編輯警示設定。</span><span class="sxs-lookup"><span data-stu-id="c2650-240">You can click **Manage Alert** to edit the alert settings.</span></span>

### <a name="choose-the-right-protocol-icmp-or-tcp"></a><span data-ttu-id="c2650-241">選擇正確的通訊協定：ICMP 或 TCP</span><span class="sxs-lookup"><span data-stu-id="c2650-241">Choose the right protocol-ICMP or TCP</span></span>

<span data-ttu-id="c2650-242">網路效能監視器 (NPM) 使用綜合交易來計算網路效能度量，例如封包遺失和連結延遲。</span><span class="sxs-lookup"><span data-stu-id="c2650-242">Network Performance Monitor (NPM) uses synthetic transactions to calculate network performance metrics like packet loss and link latency.</span></span> <span data-ttu-id="c2650-243">若要進一步了解，請想像連接到網路連結一端的 NPM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="c2650-243">To understand this better, consider an NPM agent connected to one end of a network link.</span></span> <span data-ttu-id="c2650-244">這個 NPM 代理程式會傳送探查封包至連接到網路另一端的第二個 NPM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="c2650-244">This NPM agent sends probe packets to a second NPM agent connected to another end of the network.</span></span> <span data-ttu-id="c2650-245">第二個代理程式會以回應封包回覆。</span><span class="sxs-lookup"><span data-stu-id="c2650-245">The second agent replies with response packets.</span></span> <span data-ttu-id="c2650-246">此程序會重複幾次。</span><span class="sxs-lookup"><span data-stu-id="c2650-246">This process is repeated a few times.</span></span> <span data-ttu-id="c2650-247">藉由測量回應的數目及接收每個回應所花費的時間，第一個 NPM 代理程式就可評估連結延遲和封包遺失。</span><span class="sxs-lookup"><span data-stu-id="c2650-247">By measuring the number of replies and time taken to receive each reply, the first NPM agent assesses link latency and packet drops.</span></span>

<span data-ttu-id="c2650-248">您在建立監視規則時所選擇的通訊協定，會決定這些封包的格式、大小和順序。</span><span class="sxs-lookup"><span data-stu-id="c2650-248">The format, size and sequence of these packets is determined by the protocol that you choose when you create monitoring rules.</span></span> <span data-ttu-id="c2650-249">根據封包的通訊協定，中繼網路裝置 (路由器、交換器等等) 可能會以不同的方式處理這些封包。</span><span class="sxs-lookup"><span data-stu-id="c2650-249">Based on protocol of the packets, the intermediate network devices (routers, switches etc.) might process these packets differently.</span></span> <span data-ttu-id="c2650-250">因此，您的通訊協定選擇會影響結果的精確度。</span><span class="sxs-lookup"><span data-stu-id="c2650-250">Consequently, your protocol choice affects the accuracy of the results.</span></span> <span data-ttu-id="c2650-251">另外，您的通訊協定選擇也會決定在您部署 NPM 解決方案後，是否必須採取任何手動步驟。</span><span class="sxs-lookup"><span data-stu-id="c2650-251">And, your protocol choice also determines whether you must take any manual steps after you deploy the NPM solution.</span></span>

<span data-ttu-id="c2650-252">NPM 提供 ICMP 和 TCP 通訊協定選項，供您用來執行綜合交易。</span><span class="sxs-lookup"><span data-stu-id="c2650-252">NPM offers you the choice between ICMP and TCP protocols for executing synthetic transactions.</span></span>
<span data-ttu-id="c2650-253">如果您在建立綜合交易規則時選擇 ICMP，NPM 代理程式會使用 ICMP ECHO 訊息來計算網路延遲和封包遺失。</span><span class="sxs-lookup"><span data-stu-id="c2650-253">If you choose ICMP when you create a synthetic transaction rule, the NPM agents use ICMP ECHO messages to calculate the network latency and packet loss.</span></span> <span data-ttu-id="c2650-254">ICMP ECHO 使用的訊息與傳統 Ping 公用程式傳送的訊息相同。</span><span class="sxs-lookup"><span data-stu-id="c2650-254">ICMP ECHO uses the same message that is sent by the conventional Ping utility.</span></span> <span data-ttu-id="c2650-255">當您使用 TCP 做為通訊協定時，NPM 代理程式會透過網路傳送 TCP SYN 封包。</span><span class="sxs-lookup"><span data-stu-id="c2650-255">When you use TCP as the protocol, NPM agents send TCP SYN packet over the network.</span></span> <span data-ttu-id="c2650-256">接著 TCP 交握完成，然後移除使用 RST 封包的連線。</span><span class="sxs-lookup"><span data-stu-id="c2650-256">This is followed by a TCP handshake completion and then removing the connection using RST packets.</span></span>

#### <a name="points-to-consider-before-choosing-the-protocol"></a><span data-ttu-id="c2650-257">選擇通訊協定前應考慮的重點</span><span class="sxs-lookup"><span data-stu-id="c2650-257">Points to consider before choosing the protocol</span></span>
<span data-ttu-id="c2650-258">選擇通訊協定之前，您應該考慮下列資訊：</span><span class="sxs-lookup"><span data-stu-id="c2650-258">Consider the following information before you choose a protocol to use:</span></span>

##### <a name="discovering-multiple-network-routes"></a><span data-ttu-id="c2650-259">探索多個網路路由</span><span class="sxs-lookup"><span data-stu-id="c2650-259">Discovering multiple network routes</span></span>
<span data-ttu-id="c2650-260">TCP 在探索多個路由時精確度較高，而且在每個子網路中需要的代理程式較少。</span><span class="sxs-lookup"><span data-stu-id="c2650-260">TCP is more accurate when discovering multiple routes and it needs fewer agents in each subnet.</span></span> <span data-ttu-id="c2650-261">例如，只要有一或二個使用 TCP 的代理程式，就可以探索子網路之間的所有備援路徑。</span><span class="sxs-lookup"><span data-stu-id="c2650-261">For example, one or two agents using TCP can discover all redundant paths between subnets.</span></span> <span data-ttu-id="c2650-262">不過，使用 ICMP 時，需要數個代理程式才能達到類似的結果。</span><span class="sxs-lookup"><span data-stu-id="c2650-262">However, you need several agents using ICMP to achieve similar results.</span></span> <span data-ttu-id="c2650-263">如果使用 ICMP，假設您在兩個子網路間有 *N* 個路由，您在來源或目標子網路就需要超過 5*N* 個代理程式。</span><span class="sxs-lookup"><span data-stu-id="c2650-263">Using ICMP, if you have *N* number of routes between two subnets you need more than 5*N* agents in either a source or destination subnet.</span></span>

##### <a name="accuracy-of-results"></a><span data-ttu-id="c2650-264">結果的精確度</span><span class="sxs-lookup"><span data-stu-id="c2650-264">Accuracy of results</span></span>
<span data-ttu-id="c2650-265">路由器和交換器對於 ICMP ECHO 封包會指派比 TCP 封包較低的優先順序。</span><span class="sxs-lookup"><span data-stu-id="c2650-265">Routers and switches tend to assign lower priority to ICMP ECHO packets compared to TCP packets.</span></span> <span data-ttu-id="c2650-266">在某些情況下，當網路裝置處於大量負載狀態時，透過 TCP 取得的資料會更貼切地反映應用程式發生的遺失和延遲。</span><span class="sxs-lookup"><span data-stu-id="c2650-266">In certain situations, when network devices are heavily loaded, the data obtained by TCP more closely reflects the loss and latency experienced by applications.</span></span> <span data-ttu-id="c2650-267">這是因為大部分的應用程式流量都是透過 TCP 傳送。</span><span class="sxs-lookup"><span data-stu-id="c2650-267">This occurs because most of the application traffic flows over TCP.</span></span> <span data-ttu-id="c2650-268">在這種情況下，ICMP 提供的結果精確度就不及 TCP。</span><span class="sxs-lookup"><span data-stu-id="c2650-268">In such cases, ICMP provides less accurate results compared to TCP.</span></span>

##### <a name="firewall-configuration"></a><span data-ttu-id="c2650-269">防火牆設定</span><span class="sxs-lookup"><span data-stu-id="c2650-269">Firewall configuration</span></span>
<span data-ttu-id="c2650-270">TCP 通訊協定會要求 TCP 封包傳送至目的地連接埠。</span><span class="sxs-lookup"><span data-stu-id="c2650-270">TCP protocol requires that TCP packets are sent to a destination port.</span></span> <span data-ttu-id="c2650-271">NPM 代理程式使用的預設連接埠是 8084，不過您可以在設定代理程式時變更。</span><span class="sxs-lookup"><span data-stu-id="c2650-271">The default port used by NPM agents is 8084, however you can change this when you configure agents.</span></span> <span data-ttu-id="c2650-272">因此，您必須確定網路防火牆或 NSG 規則 (在 Azure 中) 允許該連接埠的流量。</span><span class="sxs-lookup"><span data-stu-id="c2650-272">So, you need to ensure that your network firewalls or NSG rules (in Azure) are allowing traffic on the port.</span></span> <span data-ttu-id="c2650-273">您也必須確定安裝代理程式的電腦本機防火牆設定為允許這個連接埠的流量。</span><span class="sxs-lookup"><span data-stu-id="c2650-273">You also need to make sure that the local firewall on the computers where agents are installed is configured to allow traffic on this port.</span></span>

<span data-ttu-id="c2650-274">您可以使用 PowerShell 指令碼來設定執行 Windows 之電腦上的防火牆規則，不過您必須手動設定網路防火牆。</span><span class="sxs-lookup"><span data-stu-id="c2650-274">You can use PowerShell scripts to configure firewall rules on your computers running Windows, however you need to configure your network firewall manually.</span></span>

<span data-ttu-id="c2650-275">相反地，ICMP 運作不使用連接埠。</span><span class="sxs-lookup"><span data-stu-id="c2650-275">In contrast, ICMP does not operate using port.</span></span> <span data-ttu-id="c2650-276">在大部分的企業案例中，會允許 ICMP 流量通過防火牆，讓您可以使用如 Ping 公用程式的網路診斷工具。</span><span class="sxs-lookup"><span data-stu-id="c2650-276">In most enterprise scenarios, ICMP traffic is permitted through the firewalls to allow you to use network diagnostics tools like the Ping utility.</span></span> <span data-ttu-id="c2650-277">因此，如果您可以從另一部電腦 Ping 某部電腦，則您可以使用 ICMP 通訊協定，而不需要手動設定防火牆。</span><span class="sxs-lookup"><span data-stu-id="c2650-277">So, if you can Ping one machine from another, then you can use the ICMP protocol without having to configure firewalls manually.</span></span>

> [!NOTE]
> <span data-ttu-id="c2650-278">如果您不確定要使用哪個通訊協定，可以選擇從 ICMP 開始。</span><span class="sxs-lookup"><span data-stu-id="c2650-278">In case you are not sure what protocol to use, choose ICMP to start with.</span></span> <span data-ttu-id="c2650-279">如果您不滿意結果，在稍後隨時可以切換為 TCP。</span><span class="sxs-lookup"><span data-stu-id="c2650-279">If you are not satisfied with the results, you can always switch to TCP later.</span></span>


#### <a name="how-to-switch-the-protocol"></a><span data-ttu-id="c2650-280">如何切換通訊協定</span><span class="sxs-lookup"><span data-stu-id="c2650-280">How to switch the protocol</span></span>

<span data-ttu-id="c2650-281">如果您在部署期間選擇使用 ICMP，您可以隨時編輯預設監視規則來切換為 TCP。</span><span class="sxs-lookup"><span data-stu-id="c2650-281">If you chose to use ICMP during deployment, you can switch to TCP at any time by editing the default monitoring rule.</span></span>

##### <a name="to-edit-the-default-monitoring-rule"></a><span data-ttu-id="c2650-282">編輯預設監視規則</span><span class="sxs-lookup"><span data-stu-id="c2650-282">To edit the default monitoring rule</span></span>
1.  <span data-ttu-id="c2650-283">瀏覽至 [網路效能]  >  [監視]  >  [設定]  >  [監視]，然後按一下 [預設規則]。</span><span class="sxs-lookup"><span data-stu-id="c2650-283">Navigate to **Network Performance** > **Monitor** > **Configure** > **Monitor** and then click **Default rule**.</span></span>
2.  <span data-ttu-id="c2650-284">捲動至 [通訊協定] 區段，然後選取您要使用的通訊協定。</span><span class="sxs-lookup"><span data-stu-id="c2650-284">Scroll to the **Protocol** section and select the protocol that you want to use.</span></span>
3.  <span data-ttu-id="c2650-285">按一下 [儲存] 來套用設定。</span><span class="sxs-lookup"><span data-stu-id="c2650-285">Click **Save** to apply the setting.</span></span>

<span data-ttu-id="c2650-286">即使預設規則正在使用特定的通訊協定，您也能以其他通訊協定建立新規則。</span><span class="sxs-lookup"><span data-stu-id="c2650-286">Even if the default rule is using a specific protocol, you can create new rules with a different protocol.</span></span> <span data-ttu-id="c2650-287">您甚至可以建立混合規則，其中某些規則使用 ICMP，而其他使用 TCP。</span><span class="sxs-lookup"><span data-stu-id="c2650-287">You can even create a mix of rules where some of the rules use ICMP and another uses TCP.</span></span>




## <a name="data-collection-details"></a><span data-ttu-id="c2650-288">資料收集詳細資料</span><span class="sxs-lookup"><span data-stu-id="c2650-288">Data collection details</span></span>
<span data-ttu-id="c2650-289">當選取 TCP 時，網路效能監視器會使用 TCP SYN-SYNACK-ACK 交握封包，當選取 ICMP 做為收集中斷和延遲資訊的通訊協定時，會使用 ICMP ECHO ICMP ECHO REPLY。</span><span class="sxs-lookup"><span data-stu-id="c2650-289">Network Performance Monitor uses TCP SYN-SYNACK-ACK handshake packets when TCP is chosen and ICMP ECHO ICMP ECHO REPLY when ICMP is chosen as the protocol to collect loss and latency information.</span></span> <span data-ttu-id="c2650-290">追蹤路由也用來取得拓撲資訊。</span><span class="sxs-lookup"><span data-stu-id="c2650-290">Traceroute is also used to get topology information.</span></span>

<span data-ttu-id="c2650-291">下表顯示網路效能監視器的資料收集方法，以及有關如何收集資料的其他詳細資料。</span><span class="sxs-lookup"><span data-stu-id="c2650-291">The following table shows data collection methods and other details about how data is collected for Network Performance Monitor.</span></span>

| <span data-ttu-id="c2650-292">平台</span><span class="sxs-lookup"><span data-stu-id="c2650-292">platform</span></span> | <span data-ttu-id="c2650-293">直接代理程式</span><span class="sxs-lookup"><span data-stu-id="c2650-293">Direct Agent</span></span> | <span data-ttu-id="c2650-294">SCOM 代理程式</span><span class="sxs-lookup"><span data-stu-id="c2650-294">SCOM agent</span></span> | <span data-ttu-id="c2650-295">Azure 儲存體</span><span class="sxs-lookup"><span data-stu-id="c2650-295">Azure Storage</span></span> | <span data-ttu-id="c2650-296">SCOM 是否為必要項目？</span><span class="sxs-lookup"><span data-stu-id="c2650-296">SCOM required?</span></span> | <span data-ttu-id="c2650-297">透過管理群組傳送的 SCOM 代理程式資料</span><span class="sxs-lookup"><span data-stu-id="c2650-297">SCOM agent data sent via management group</span></span> | <span data-ttu-id="c2650-298">收集頻率</span><span class="sxs-lookup"><span data-stu-id="c2650-298">collection frequency</span></span> |
| --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="c2650-299">Windows</span><span class="sxs-lookup"><span data-stu-id="c2650-299">Windows</span></span> | <span data-ttu-id="c2650-300">&#8226;</span><span class="sxs-lookup"><span data-stu-id="c2650-300">&#8226;</span></span> | <span data-ttu-id="c2650-301">&#8226;</span><span class="sxs-lookup"><span data-stu-id="c2650-301">&#8226;</span></span> |  |  |  |<span data-ttu-id="c2650-302">TCP 交握/ICMP ECHO 訊息會每 5 秒進行一次，而資料會每 3 分鐘傳送一次</span><span class="sxs-lookup"><span data-stu-id="c2650-302">TCP handshakes/ICMP ECHO messages every 5 seconds, data sent every 3 minutes</span></span> |

<span data-ttu-id="c2650-303">此方案會使用綜合交易來評估網路的健全狀況。</span><span class="sxs-lookup"><span data-stu-id="c2650-303">The solution uses synthetic transactions to assess the health of the network.</span></span> <span data-ttu-id="c2650-304">OMS 代理程式已安裝在網路交換 TCP 封包或 ICMP Echo (取決於已選取要監視的通訊協定) 各種點。</span><span class="sxs-lookup"><span data-stu-id="c2650-304">OMS agents installed at various point in the network exchange TCP packets or ICMP Echo (depending on the protocol selected for monitoring) with one another.</span></span> <span data-ttu-id="c2650-305">在過程中，代理程式會了解來回行程時間和封包遺失 (如果有的話)。</span><span class="sxs-lookup"><span data-stu-id="c2650-305">In the process, agents learn the round-trip time and packet loss, if any.</span></span> <span data-ttu-id="c2650-306">此外，每個代理程式也會定期執行其他代理程式的路徑追蹤，以找出網路中必須測試的所有各種路由。</span><span class="sxs-lookup"><span data-stu-id="c2650-306">Periodically, each agent also performs a trace route to other agents to find all the various routes in the network that must be tested.</span></span> <span data-ttu-id="c2650-307">使用這項資料，代理程式就能夠推論網路延遲和封包遺失數字。</span><span class="sxs-lookup"><span data-stu-id="c2650-307">Using this data, the agents can deduce the network latency and packet loss figures.</span></span> <span data-ttu-id="c2650-308">測試會每 5 秒重複一次，而代理程式會先彙總三分鐘的資料，再將資料上傳至 Log Analytics 服務。</span><span class="sxs-lookup"><span data-stu-id="c2650-308">The tests are repeated every five seconds and data is aggregated for a period of three minutes by the agents before uploading it to the Log Analytics service.</span></span>

> [!NOTE]
> <span data-ttu-id="c2650-309">雖然代理程式會經常彼此通訊，但是在進行測試時不會產生大量網路流量。</span><span class="sxs-lookup"><span data-stu-id="c2650-309">Although agents communicate with each other frequently, they do not generate a lot of network traffic while conducting the tests.</span></span> <span data-ttu-id="c2650-310">代理程式只依賴 TCP SYN-SYNACK-ACK 交握封包來判斷遺失和延遲 - 不會交換任何資料封包。</span><span class="sxs-lookup"><span data-stu-id="c2650-310">Agents rely only on TCP SYN-SYNACK-ACK handshake packets to determine the loss and latency -- no data packets are exchanged.</span></span> <span data-ttu-id="c2650-311">在此過程中，代理程式只會在需要時彼此通訊，而且代理程式通訊拓撲已最佳化以減少網路流量。</span><span class="sxs-lookup"><span data-stu-id="c2650-311">During this process, agents communicate with each other only when needed and the agent communication topology is optimized to reduce network traffic.</span></span>
>
>

## <a name="using-the-solution"></a><span data-ttu-id="c2650-312">使用解決方案</span><span class="sxs-lookup"><span data-stu-id="c2650-312">Using the solution</span></span>
<span data-ttu-id="c2650-313">本節說明所有儀表板函式及其使用方式。</span><span class="sxs-lookup"><span data-stu-id="c2650-313">This section explains all the dashboard functions and how to use them.</span></span>

### <a name="solution-overview-tile"></a><span data-ttu-id="c2650-314">解決方案概觀圖格</span><span class="sxs-lookup"><span data-stu-id="c2650-314">Solution Overview tile</span></span>
<span data-ttu-id="c2650-315">啟用網路效能監視器方案之後，[OMS 概觀] 頁面上的方案圖格會提供網路健康狀態的快速概觀。</span><span class="sxs-lookup"><span data-stu-id="c2650-315">After you've enabled the Network Performance Monitor solution, the solution tile on the OMS Overview page provides a quick overview of the network health.</span></span> <span data-ttu-id="c2650-316">它會顯示一個環圈圖，其中顯示狀況良好和狀況不良的子網路連結數目。</span><span class="sxs-lookup"><span data-stu-id="c2650-316">It displays a doughnut chart showing the number of healthy and unhealthy subnetwork links.</span></span> <span data-ttu-id="c2650-317">當您按一下圖格時，方案儀表板隨即開啟。</span><span class="sxs-lookup"><span data-stu-id="c2650-317">When you click the tile, it opens the solution dashboard.</span></span>

![網路效能監視器圖格](./media/log-analytics-network-performance-monitor/npm-tile.png)

### <a name="network-performance-monitor-solution-dashboard"></a><span data-ttu-id="c2650-319">網路效能監視器方案儀表板</span><span class="sxs-lookup"><span data-stu-id="c2650-319">Network Performance Monitor solution dashboard</span></span>
<span data-ttu-id="c2650-320">[網路摘要] 刀鋒視窗會顯示網路摘要以及其相對大小。</span><span class="sxs-lookup"><span data-stu-id="c2650-320">The **Network Summary** blade shows a summary of the networks along with their relative size.</span></span> <span data-ttu-id="c2650-321">其後面接續的圖格會顯示系統中網路連結、子網路連結和路徑的總數 (路徑包含代理程式的兩部主機 IP 位址和它們之間的所有躍點)。</span><span class="sxs-lookup"><span data-stu-id="c2650-321">This is followed by tiles showing total number of network links, subnet links and paths in the system (a path consists of the IP addresses of two hosts with agents and all the hops between them).</span></span>

<span data-ttu-id="c2650-322">[頂端網路健康狀態事件] 刀鋒視窗會列出系統中最近的健康狀態事件和警示，以及事件變成作用中的時間。</span><span class="sxs-lookup"><span data-stu-id="c2650-322">The **Top Network Health Events** blade provides a list of most recent health events and alerts in the system and the time since the event has been active.</span></span> <span data-ttu-id="c2650-323">每當網路或子網路連結的封包遺失或延遲超過臨界值時，就會產生健康狀態事件或警示。</span><span class="sxs-lookup"><span data-stu-id="c2650-323">A health event or alert is generated whenever the packet loss or latency of a network or subnetwork link exceeds a threshold.</span></span>

<span data-ttu-id="c2650-324">[頂端狀況不良的網路連結] 刀鋒視窗會顯示狀況不良的網路連結清單。</span><span class="sxs-lookup"><span data-stu-id="c2650-324">The **Top Unhealthy Network Links** blade shows a list of unhealthy network links.</span></span> <span data-ttu-id="c2650-325">這些是當時有一或多個負面健康狀態事件的網路連結。</span><span class="sxs-lookup"><span data-stu-id="c2650-325">These are the network links that have one or more adverse health event for them at the moment.</span></span>

<span data-ttu-id="c2650-326">[遺失最多的頂端子網路連結] 和 [延遲最多的子網路連結] 刀鋒視窗分別顯示依封包遺失的頂端子網路連結和依延遲的頂端子網路連結。</span><span class="sxs-lookup"><span data-stu-id="c2650-326">The **Top Subnetwork Links with Most Loss** and **Subnetwork Links with Most Latency** blades show the top subnetwork links by packet loss and top subnetwork links by latency respectively.</span></span> <span data-ttu-id="c2650-327">特定網路連結上可能會有高度延遲或某些數量的封包遺失。</span><span class="sxs-lookup"><span data-stu-id="c2650-327">High latency or some amount of packet loss might be expected on certain network links.</span></span> <span data-ttu-id="c2650-328">這類連結會顯示在前十大清單中，但未標示為狀況不良。</span><span class="sxs-lookup"><span data-stu-id="c2650-328">Such links appear in the top ten lists but are not marked unhealthy.</span></span>

<span data-ttu-id="c2650-329">[常用查詢] 刀鋒視窗包含一組搜尋查詢，可直接擷取原始的網路監視資料。</span><span class="sxs-lookup"><span data-stu-id="c2650-329">The **Common Queries** blade contains a set of search queries that fetch raw network monitoring data directly.</span></span> <span data-ttu-id="c2650-330">您可以使用這些查詢做為起點，建立自己的查詢以供自訂報告。</span><span class="sxs-lookup"><span data-stu-id="c2650-330">You can use these queries as a starting point for creating your own queries for customized reporting.</span></span>

![網路效能監視器儀表板](./media/log-analytics-network-performance-monitor/npm-dash01.png)

### <a name="drill-down-for-depth"></a><span data-ttu-id="c2650-332">深入鑽研</span><span class="sxs-lookup"><span data-stu-id="c2650-332">Drill-down for depth</span></span>
<span data-ttu-id="c2650-333">您可以按一下方案儀表板上的各種連結，更深入鑽研任何感興趣的區域。</span><span class="sxs-lookup"><span data-stu-id="c2650-333">You can click various links on the solution dashboard to drill-down deeper into any area of interest.</span></span> <span data-ttu-id="c2650-334">例如，當您看到儀表板上出現警示或狀況不良的網路連結時，您可以按一下它，進一步調查。</span><span class="sxs-lookup"><span data-stu-id="c2650-334">For example, when you see an alert or an unhealthy network link appear on the dashboard, you can click it to investigate further.</span></span> <span data-ttu-id="c2650-335">接著顯示的頁面會列出特定網路連結的所有子網路連結。</span><span class="sxs-lookup"><span data-stu-id="c2650-335">You'll be taken to a page that lists all the subnetwork links for the particular network link.</span></span> <span data-ttu-id="c2650-336">您將可看到每個子網路連結的遺失、延遲和健康狀態，並快速找出哪些子網路連結造成此問題。</span><span class="sxs-lookup"><span data-stu-id="c2650-336">You will be able to see the loss, latency and health status of each subnetwork link and quickly find out what subnetwork links are causing the problem.</span></span> <span data-ttu-id="c2650-337">您可以接著按一下 [檢視節點連結]，查看狀況不良子網路連結的所有節點連結。</span><span class="sxs-lookup"><span data-stu-id="c2650-337">You can then click **View node links** to see all the node links for the unhealthy subnet link.</span></span> <span data-ttu-id="c2650-338">然後，您可以看到個別的節點間連結並尋找狀況不良的節點連結。</span><span class="sxs-lookup"><span data-stu-id="c2650-338">Then, you can see individual node-to-node links and find the unhealthy node links.</span></span>

<span data-ttu-id="c2650-339">您可以按一下 [檢視拓撲]，檢視來源與目的地節點之間路由的逐一躍點拓撲。</span><span class="sxs-lookup"><span data-stu-id="c2650-339">You can click **View topology** to view the hop-by-hop topology of the routes between the source and destination nodes.</span></span> <span data-ttu-id="c2650-340">狀況不良的路由或躍點會顯示為紅色，以便您快速識別特定網路部分的問題。</span><span class="sxs-lookup"><span data-stu-id="c2650-340">The unhealthy routes or hops are shown in red so that you can quickly identify the problem to a particular portion of the network.</span></span>

![向下鑽研資料](./media/log-analytics-network-performance-monitor/npm-drill.png)

### <a name="network-state-recorder"></a><span data-ttu-id="c2650-342">網路狀態錄製器</span><span class="sxs-lookup"><span data-stu-id="c2650-342">Network State Recorder</span></span>

<span data-ttu-id="c2650-343">每個檢視會在特定時間點顯示您網路健全狀況的快照集。</span><span class="sxs-lookup"><span data-stu-id="c2650-343">Each view displays a snapshot of your network health at a particular point in time.</span></span> <span data-ttu-id="c2650-344">根據預設，會顯示最新狀態。</span><span class="sxs-lookup"><span data-stu-id="c2650-344">By default, the most recent state is shown.</span></span> <span data-ttu-id="c2650-345">在頁面頂端的列會顯示狀態正在顯示的時間點。</span><span class="sxs-lookup"><span data-stu-id="c2650-345">The bar at the top of the page shows the point in time for which the state is being displayed.</span></span> <span data-ttu-id="c2650-346">您可以按一下 [動作] 上的列，選擇回到過去並檢視您網路健全狀況的快照集。</span><span class="sxs-lookup"><span data-stu-id="c2650-346">You can choose to go back in time and view the snapshot of your network health by clicking on the bar on **Actions**.</span></span> <span data-ttu-id="c2650-347">您也可以在檢視最新狀態時，選擇啟用或停用任何頁面的自動重新整理。</span><span class="sxs-lookup"><span data-stu-id="c2650-347">You can also choose to enable or disable auto-refresh for any page while you view the latest state.</span></span>

![網路狀態](./media/log-analytics-network-performance-monitor/network-state.png)

#### <a name="trend-charts"></a><span data-ttu-id="c2650-349">趨勢圖</span><span class="sxs-lookup"><span data-stu-id="c2650-349">Trend charts</span></span>
<span data-ttu-id="c2650-350">在您向下鑽研的每個層級，您可以看到網路連結的遺失和延遲趨勢。</span><span class="sxs-lookup"><span data-stu-id="c2650-350">At each level that you drill-down, you can see the trend of loss and latency for a network link.</span></span> <span data-ttu-id="c2650-351">趨勢圖也可以用於子網路和節點連結。</span><span class="sxs-lookup"><span data-stu-id="c2650-351">Trend charts are also available for Subnetwork and Node links.</span></span> <span data-ttu-id="c2650-352">您可以使用圖形頂端的時間控制項，變更要繪製之圖表的時間間隔。</span><span class="sxs-lookup"><span data-stu-id="c2650-352">You can change the time interval for the graph to plot by using the time control at the top of the chart.</span></span>

<span data-ttu-id="c2650-353">趨勢圖會顯示網路連結效能的歷程記錄觀點。</span><span class="sxs-lookup"><span data-stu-id="c2650-353">Trend charts show you a historical perspective of the performance of a network link.</span></span> <span data-ttu-id="c2650-354">某些網路問題的本質是暫時的，很難只透過查看網路的目前狀態來攔截。</span><span class="sxs-lookup"><span data-stu-id="c2650-354">Some network issues are transient in nature and would be hard to catch only by looking at the current state of the network.</span></span> <span data-ttu-id="c2650-355">這是因為問題可能會在有人注意前迅速浮現而後消失，只會在稍後的時間點再度出現。</span><span class="sxs-lookup"><span data-stu-id="c2650-355">This is because issues can surface quickly and disappear before anyone notices, only to reappear at a later point in time.</span></span> <span data-ttu-id="c2650-356">應用程式管理員也可能難以發現這類暫時性問題，因為即使所有的應用程式元件都看似執行順暢，當應用程式的回應時間莫名增加時，通常會出現這些問題。</span><span class="sxs-lookup"><span data-stu-id="c2650-356">Such transient issues can also be difficult for application administrators because those issues often surface as unexplained increases in application response time, even when all application components appear to run smoothly.</span></span>

<span data-ttu-id="c2650-357">您可以查看問題將顯示為網路延遲或封包遺失突增的趨勢圖，即可輕鬆地偵測這些種類的問題。</span><span class="sxs-lookup"><span data-stu-id="c2650-357">You can easily detect those kinds of issues by looking at a trend chart where the issue will appear as a sudden spike in network latency or packet loss.</span></span>

![趨勢圖](./media/log-analytics-network-performance-monitor/npm-trend.png)

#### <a name="hop-by-hop-topology-map"></a><span data-ttu-id="c2650-359">逐一躍點的拓撲圖</span><span class="sxs-lookup"><span data-stu-id="c2650-359">Hop-by-hop topology map</span></span>
<span data-ttu-id="c2650-360">網路效能監視器會在互動式拓撲圖上顯示兩個節點之間路由的逐一躍點拓撲。</span><span class="sxs-lookup"><span data-stu-id="c2650-360">Network Performance Monitor shows you the hop-by-hop topology of routes between two nodes on an interactive topology map.</span></span> <span data-ttu-id="c2650-361">選取節點連結，然後按一下 [檢視拓撲]，即可檢視拓撲圖。</span><span class="sxs-lookup"><span data-stu-id="c2650-361">You can view the topology map by selecting a node link and then clicking **View topology**.</span></span> <span data-ttu-id="c2650-362">此外，按一下儀表板上的 [路徑] 圖格，也可以檢視拓撲圖。</span><span class="sxs-lookup"><span data-stu-id="c2650-362">Also, you can view the topology map by clicking **Paths** tile on the dashboard.</span></span> <span data-ttu-id="c2650-363">當您按一下儀表板上的 [路徑] 時，您必須從左側面板中選取來源和目的地節點，然後按一下 [繪圖] 以繪製兩個節點之間的路由。</span><span class="sxs-lookup"><span data-stu-id="c2650-363">When you click **Paths** on the dashboard, you'll have to select the source and destination nodes from the left hand panel and then click **Plot** to plot the routes between the two nodes.</span></span>

<span data-ttu-id="c2650-364">拓撲圖會顯示兩個節點之間有多少個路由，以及資料封包所採用的路徑。</span><span class="sxs-lookup"><span data-stu-id="c2650-364">The topology map displays how many routes are between the two nodes and what paths the data packets take.</span></span> <span data-ttu-id="c2650-365">在拓撲圖上，網路效能瓶頸會標示為紅色。</span><span class="sxs-lookup"><span data-stu-id="c2650-365">Network performance bottlenecks are marked in red on the topology map.</span></span> <span data-ttu-id="c2650-366">您可以查看拓撲圖上的紅色項目，找出錯誤的網路連線或錯誤的網路裝置。</span><span class="sxs-lookup"><span data-stu-id="c2650-366">You can locate a faulty network connection or a faulty network device by looking at red colored elements on the topology map.</span></span>

<span data-ttu-id="c2650-367">當您按一下節點或將滑鼠移至拓撲圖上的該節點，您會看到節點的屬性 (如 FQDN 和 IP 位址)。</span><span class="sxs-lookup"><span data-stu-id="c2650-367">When you click a node or hover over it on the topology map, you'll see the properties of the node like FQDN and IP address.</span></span> <span data-ttu-id="c2650-368">按一下躍點以查看其 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="c2650-368">Click a hop to see it's IP address.</span></span> <span data-ttu-id="c2650-369">您可以使用可摺疊動作窗格中的篩選器來選擇篩選特定的路徑。</span><span class="sxs-lookup"><span data-stu-id="c2650-369">You can choose to filter particular routes by using the filters in the collapsible action pane.</span></span> <span data-ttu-id="c2650-370">而且，您也可以使用動作窗格中的滑桿隱藏中繼躍點，來簡化網路拓樸。</span><span class="sxs-lookup"><span data-stu-id="c2650-370">And, you can also simplify the network topologies by hiding the intermediate hops using the slider in the action pane.</span></span> <span data-ttu-id="c2650-371">您可以使用滑鼠滾輪來放大或縮小拓撲圖。</span><span class="sxs-lookup"><span data-stu-id="c2650-371">You can zoom-in or out of the topology map by using your mouse wheel.</span></span>

<span data-ttu-id="c2650-372">請注意，圖中顯示的拓撲是第 3 層拓撲，不包含第 2 層裝置和連線。</span><span class="sxs-lookup"><span data-stu-id="c2650-372">Note that the topology shown in the map is layer 3 topology and doesn't contain layer 2 devices and connections.</span></span>

![逐一躍點的拓撲圖](./media/log-analytics-network-performance-monitor/npm-topology.png)

#### <a name="fault-localization"></a><span data-ttu-id="c2650-374">錯誤局部化</span><span class="sxs-lookup"><span data-stu-id="c2650-374">Fault localization</span></span>
<span data-ttu-id="c2650-375">網路效能監視器不需連接到網路裝置，就能夠找出網路瓶頸。</span><span class="sxs-lookup"><span data-stu-id="c2650-375">Network Performance Monitor is able to find the network bottlenecks without connecting to the network devices.</span></span> <span data-ttu-id="c2650-376">網路效能監視器會根據它從網路蒐集來的資料，在網路圖上套用進階演算法，對最可能是問題來源的網路部分進行可能性預估。</span><span class="sxs-lookup"><span data-stu-id="c2650-376">Based on the data that it gathers from the network and by applying advanced algorithms on the network graph, Network Performance Monitor makes a probabilistic estimate of the parts of network that are most likely the source of the problem.</span></span>

<span data-ttu-id="c2650-377">這個方法很適合用來判斷無法存取躍點時的網路瓶頸，因為它不需要從網路裝置 (例如路由器或交換器) 蒐集任何資料。</span><span class="sxs-lookup"><span data-stu-id="c2650-377">This approach is useful to determine the network bottlenecks when access to hops isn't available because it doesn't require any data to be gathered from the network devices such as routers or switches.</span></span> <span data-ttu-id="c2650-378">當兩個節點之間的躍點不在您的管理控制時，這個方法也很有用。</span><span class="sxs-lookup"><span data-stu-id="c2650-378">This is also useful when the hops between two nodes are not in your administrative control.</span></span> <span data-ttu-id="c2650-379">例如，躍點可能是 ISP 路由器。</span><span class="sxs-lookup"><span data-stu-id="c2650-379">For example, the hops may be ISP routers.</span></span>

### <a name="log-analytics-search"></a><span data-ttu-id="c2650-380">Log Analytics 搜尋</span><span class="sxs-lookup"><span data-stu-id="c2650-380">Log Analytics search</span></span>
<span data-ttu-id="c2650-381">以圖形方式透過網路效能監視器儀表板和向下鑽研頁面公開的所有資料，原本也可以在 Log Analytics 搜尋中取得。</span><span class="sxs-lookup"><span data-stu-id="c2650-381">All data that is exposed graphically through the Network Performance Monitor dashboard and drill-down pages is also available natively in Log Analytics search.</span></span> <span data-ttu-id="c2650-382">您可以使用搜尋查詢語言來查詢資料，並藉由將資料匯出到 Excel 或 PowerBI 來建立自訂報告。</span><span class="sxs-lookup"><span data-stu-id="c2650-382">You can query the data using the search query language and create custom reports by exporting the data to Excel or PowerBI.</span></span> <span data-ttu-id="c2650-383">儀表板中的 [常用查詢] 刀鋒視窗有一些實用的查詢，您可以這些查詢做為起點來建立自己的查詢和報告。</span><span class="sxs-lookup"><span data-stu-id="c2650-383">The **Common Queries** blade in the dashboard has some useful queries that you can use as the starting point for creating your own queries and reports.</span></span>

![搜尋查詢](./media/log-analytics-network-performance-monitor/npm-queries.png)

## <a name="investigate-the-root-cause-of-a-health-alert"></a><span data-ttu-id="c2650-385">調查健康狀態警示的根本原因</span><span class="sxs-lookup"><span data-stu-id="c2650-385">Investigate the root cause of a health alert</span></span>
<span data-ttu-id="c2650-386">既然您已深入了解網路效能監視器，讓我們看看簡單的健康狀態事件根本原因調查。</span><span class="sxs-lookup"><span data-stu-id="c2650-386">Now that you've read about Network Performance Monitor, let's look at a simple investigation into the root-cause for a health event.</span></span>

1. <span data-ttu-id="c2650-387">在 [概觀] 頁面上，觀察 [網路效能監視器] 圖格，您可以快速概略了解您的網路健康狀態。</span><span class="sxs-lookup"><span data-stu-id="c2650-387">On the Overview page, you'll get a quick snapshot of the health of your network by observing the **Network Performance Monitor** tile.</span></span> <span data-ttu-id="c2650-388">請注意，在 6 個受監視的子網路連結中，有 2 個狀況不良。</span><span class="sxs-lookup"><span data-stu-id="c2650-388">Notice that out of the 6 subnetworks links being monitored, 2 are unhealthy.</span></span> <span data-ttu-id="c2650-389">這值得調查一下。</span><span class="sxs-lookup"><span data-stu-id="c2650-389">This warrants investigation.</span></span> <span data-ttu-id="c2650-390">按一下此圖格以檢視方案儀表板。</span><span class="sxs-lookup"><span data-stu-id="c2650-390">Click the tile to view the solution dashboard.</span></span>  
   <span data-ttu-id="c2650-391">![網路效能監視器圖格](./media/log-analytics-network-performance-monitor/npm-investigation01.png)</span><span class="sxs-lookup"><span data-stu-id="c2650-391">![Network Performance Monitor tile](./media/log-analytics-network-performance-monitor/npm-investigation01.png)</span></span>
2. <span data-ttu-id="c2650-392">在下列範例映像中，您會發現有網路連結狀況不佳的健全狀況事件。</span><span class="sxs-lookup"><span data-stu-id="c2650-392">In the example image below, you'll notice that there is a health event a network link that is unhealthy.</span></span> <span data-ttu-id="c2650-393">您決定要調查此問題，按一下 **DMZ2-DMZ1** 網路連結，以找出問題的根源。</span><span class="sxs-lookup"><span data-stu-id="c2650-393">You decide to investigate the issue and click on the **DMZ2-DMZ1** network link to find out the root of the problem.</span></span>  
   <span data-ttu-id="c2650-394">![狀況不良的網路連結範例](./media/log-analytics-network-performance-monitor/npm-investigation02.png)</span><span class="sxs-lookup"><span data-stu-id="c2650-394">![unhealthy network link example](./media/log-analytics-network-performance-monitor/npm-investigation02.png)</span></span>
3. <span data-ttu-id="c2650-395">向下鑽研頁面會顯示 **DMZ2-DMZ1** 網路連結中的所有子網路連結。</span><span class="sxs-lookup"><span data-stu-id="c2650-395">The drill-down page shows all the subnetwork links in **DMZ2-DMZ1** network link.</span></span> <span data-ttu-id="c2650-396">您會發現，這兩個子網路連結的延遲已超過臨界值，以致網路連結狀況不良。</span><span class="sxs-lookup"><span data-stu-id="c2650-396">You'll notice that for both the subnetwork links, the latency has crossed the threshold making the network link unhealthy.</span></span> <span data-ttu-id="c2650-397">您也可以查看這兩個子網路連結的延遲趨勢。</span><span class="sxs-lookup"><span data-stu-id="c2650-397">You can also see the latency trends of both the subnetwork links.</span></span> <span data-ttu-id="c2650-398">您可以使用圖形中的時間選取控制項，將焦點放在所需的時間範圍。</span><span class="sxs-lookup"><span data-stu-id="c2650-398">You can use the time selection control in the graph to focus on the required time range.</span></span> <span data-ttu-id="c2650-399">您可以看到一天當中達到延遲尖峰的時間。</span><span class="sxs-lookup"><span data-stu-id="c2650-399">You can see the time of the day when latency has reached its peak.</span></span> <span data-ttu-id="c2650-400">您稍後可以在記錄檔中搜尋此時間，以調查問題。</span><span class="sxs-lookup"><span data-stu-id="c2650-400">You can later search the logs for this time period to investigate the issue.</span></span> <span data-ttu-id="c2650-401">按一下 [檢視節點連結] 進一步深入鑽研。</span><span class="sxs-lookup"><span data-stu-id="c2650-401">Click **View node links** to drill-down further.</span></span>  
   <span data-ttu-id="c2650-402">![狀況不良的子網路連結範例](./media/log-analytics-network-performance-monitor/npm-investigation03.png)</span><span class="sxs-lookup"><span data-stu-id="c2650-402">![unhealthy subnet links example](./media/log-analytics-network-performance-monitor/npm-investigation03.png)</span></span>
4. <span data-ttu-id="c2650-403">類似於前一頁，特定子網路連結的向下鑽研頁面會列出其構成的節點連結。</span><span class="sxs-lookup"><span data-stu-id="c2650-403">Similar to the previous page, the drill-down page for the particular subnetwork link lists down its constituent node links.</span></span> <span data-ttu-id="c2650-404">您可以在此執行類似上一個步驟中的動作。</span><span class="sxs-lookup"><span data-stu-id="c2650-404">You can perform similar actions  here as you did in the previous step.</span></span> <span data-ttu-id="c2650-405">按一下 [檢視拓撲] 可檢視 2 個節點之間的拓撲。</span><span class="sxs-lookup"><span data-stu-id="c2650-405">Click **View topology** to view the topology between the 2 nodes.</span></span>  
   <span data-ttu-id="c2650-406">![狀況不良的節點連結範例](./media/log-analytics-network-performance-monitor/npm-investigation04.png)</span><span class="sxs-lookup"><span data-stu-id="c2650-406">![unhealthy node links example](./media/log-analytics-network-performance-monitor/npm-investigation04.png)</span></span>
5. <span data-ttu-id="c2650-407">2 個選定節點之間的所有路徑都會繪製於拓撲圖。</span><span class="sxs-lookup"><span data-stu-id="c2650-407">All the paths between the 2 selected nodes are plotted in the topology map.</span></span> <span data-ttu-id="c2650-408">您可以在拓撲圖上呈現這兩個節點之間路由的逐一躍點拓撲。</span><span class="sxs-lookup"><span data-stu-id="c2650-408">You can visualize the hop-by-hop topology of routes between two nodes on the topology map.</span></span> <span data-ttu-id="c2650-409">拓撲圖會清楚顯示兩個節點之間有多少個路由，以及資料封包所採用的路徑。</span><span class="sxs-lookup"><span data-stu-id="c2650-409">It gives you a clear picture of how many routes exist between the two nodes and what paths the data packets are taking.</span></span> <span data-ttu-id="c2650-410">網路效能瓶頸會標示為紅色。</span><span class="sxs-lookup"><span data-stu-id="c2650-410">Network performance bottlenecks are marked in red color.</span></span> <span data-ttu-id="c2650-411">您可以查看拓撲圖上的紅色項目，找出錯誤的網路連線或錯誤的網路裝置。</span><span class="sxs-lookup"><span data-stu-id="c2650-411">You can locate a faulty network connection or a faulty network device by looking at red colored elements on the topology map.</span></span>  
   ![狀況不良的拓撲檢視範例](./media/log-analytics-network-performance-monitor/npm-investigation05.png)
6. <span data-ttu-id="c2650-413">在 [動作] 窗格中可以檢閱每個路徑中的遺失、延遲和躍點數目。</span><span class="sxs-lookup"><span data-stu-id="c2650-413">The loss, latency, and the number of hops in each path can be reviewed in the **Action** pane.</span></span> <span data-ttu-id="c2650-414">使用捲軸來檢視這些狀況不良路徑的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="c2650-414">Use the scrollbar to view the details of those unhealthy paths.</span></span>  <span data-ttu-id="c2650-415">使用篩選器選取具有狀況不良躍點的路徑，以便僅繪製選取路徑的拓撲。</span><span class="sxs-lookup"><span data-stu-id="c2650-415">Use the filters to select the paths with the unhealthy hop so that the topology for only the selected paths is plotted.</span></span> <span data-ttu-id="c2650-416">您可以使用滑鼠滾輪來放大或縮小拓撲圖。</span><span class="sxs-lookup"><span data-stu-id="c2650-416">You can use your mouse wheel to zoom in or out of the topology map.</span></span>

   <span data-ttu-id="c2650-417">在下面的圖像中，藉由查看紅色的路徑和躍點，即可清楚看到特定網路區段中問題區域的根本原因。</span><span class="sxs-lookup"><span data-stu-id="c2650-417">In the below image you can clearly see the root-cause of the problem areas to the specific section of the network by looking at the paths and hops in red color.</span></span> <span data-ttu-id="c2650-418">按一下拓撲圖中的節點，即可顯示該節點的屬性，包括 FQDN 和 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="c2650-418">Clicking on a node in the topology map reveals the properties of the node, including the FQDN, and IP address.</span></span> <span data-ttu-id="c2650-419">按一下躍點可顯示該躍點的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="c2650-419">Clicking on a hop shows the IP address of the hop.</span></span>  
   ![狀況不良的拓撲 - 路徑詳細資料範例](./media/log-analytics-network-performance-monitor/npm-investigation06.png)

## <a name="provide-feedback"></a><span data-ttu-id="c2650-421">提供意見反應</span><span class="sxs-lookup"><span data-stu-id="c2650-421">Provide feedback</span></span>

- <span data-ttu-id="c2650-422">**UserVoice** - 您可以張貼您對於希望我們改善之網路效能監視器功能的想法。</span><span class="sxs-lookup"><span data-stu-id="c2650-422">**UserVoice** - You can post your ideas for Network Performance Monitor features that you want us to work on.</span></span> <span data-ttu-id="c2650-423">造訪 [UserVoice 頁面](https://feedback.azure.com/forums/267889-log-analytics/category/188146-network-monitoring)。</span><span class="sxs-lookup"><span data-stu-id="c2650-423">Visit our [UserVoice page](https://feedback.azure.com/forums/267889-log-analytics/category/188146-network-monitoring).</span></span>
- <span data-ttu-id="c2650-424">**加入我們的社群** - 我們竭誠歡迎新客戶加入我們的社群。</span><span class="sxs-lookup"><span data-stu-id="c2650-424">**Join our cohort** - We’re always interested in having new customers join our cohort.</span></span> <span data-ttu-id="c2650-425">加入其中，您就能夠提早存取新功能，並協助我們改善網路效能監視器。</span><span class="sxs-lookup"><span data-stu-id="c2650-425">As part of it, you'll get early access to new features and help us improve Network Performance Monitor.</span></span> <span data-ttu-id="c2650-426">如果您想加入，請填妥這份[快速問卷調查](https://aka.ms/npmcohort)。</span><span class="sxs-lookup"><span data-stu-id="c2650-426">If you're interested in joining, fill-out this [quick survey](https://aka.ms/npmcohort).</span></span>

## <a name="next-steps"></a><span data-ttu-id="c2650-427">後續步驟</span><span class="sxs-lookup"><span data-stu-id="c2650-427">Next steps</span></span>
* <span data-ttu-id="c2650-428">[搜尋記錄檔](log-analytics-log-searches.md)以檢視詳細的網路效能資料記錄。</span><span class="sxs-lookup"><span data-stu-id="c2650-428">[Search logs](log-analytics-log-searches.md) to view detailed network performance data records.</span></span>
