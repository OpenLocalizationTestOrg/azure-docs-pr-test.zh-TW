## <a name="prepare-for-akv-integration"></a><span data-ttu-id="e1364-101">準備進行 AKV 整合</span><span class="sxs-lookup"><span data-stu-id="e1364-101">Prepare for AKV Integration</span></span>
<span data-ttu-id="e1364-102">toouse Azure 金鑰保存庫整合 tooconfigure SQL Server VM，有數個先決條件：</span><span class="sxs-lookup"><span data-stu-id="e1364-102">toouse Azure Key Vault Integration tooconfigure your SQL Server VM, there are several prerequisites:</span></span> 

1. [<span data-ttu-id="e1364-103">安裝 Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="e1364-103">Install Azure Powershell</span></span>](#install-azure-powershell)
2. [<span data-ttu-id="e1364-104">建立 Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="e1364-104">Create an Azure Active Directory</span></span>](#create-an-azure-active-directory)
3. [<span data-ttu-id="e1364-105">建立金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="e1364-105">Create a key vault</span></span>](#create-a-key-vault)

<span data-ttu-id="e1364-106">hello 下列各節說明這些先決條件和 hello 需要 toocollect toolater 執行 hello PowerShell cmdlet 的資訊。</span><span class="sxs-lookup"><span data-stu-id="e1364-106">hello following sections describe these prerequisites and hello information you need toocollect toolater run hello PowerShell cmdlets.</span></span>

### <a name="install-azure-powershell"></a><span data-ttu-id="e1364-107">安裝 Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="e1364-107">Install Azure PowerShell</span></span>
<span data-ttu-id="e1364-108">請確定您已安裝 hello 最新的 Azure PowerShell SDK。</span><span class="sxs-lookup"><span data-stu-id="e1364-108">Make sure you have installed hello latest Azure PowerShell SDK.</span></span> <span data-ttu-id="e1364-109">如需詳細資訊，請參閱[如何 tooinstall 和設定 Azure PowerShell](/powershell/azureps-cmdlets-docs)。</span><span class="sxs-lookup"><span data-stu-id="e1364-109">For more information, see [How tooinstall and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

### <a name="create-an-azure-active-directory"></a><span data-ttu-id="e1364-110">建立 Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="e1364-110">Create an Azure Active Directory</span></span>
<span data-ttu-id="e1364-111">首先，您需要 toohave [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) 您的訂用帳戶中。</span><span class="sxs-lookup"><span data-stu-id="e1364-111">First, you need toohave an [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) in your subscription.</span></span> <span data-ttu-id="e1364-112">許多優點，這可讓您 toogrant 權限 tooyour 金鑰保存庫特定的使用者和應用程式。</span><span class="sxs-lookup"><span data-stu-id="e1364-112">Among many benefits, this allows you toogrant permission tooyour key vault for certain users and applications.</span></span>

<span data-ttu-id="e1364-113">接下來，向 AAD 註冊應用程式。</span><span class="sxs-lookup"><span data-stu-id="e1364-113">Next, register an application with AAD.</span></span> <span data-ttu-id="e1364-114">如此可讓您的服務主體帳戶具有存取 tooyour 金鑰保存庫必須在您的 VM。</span><span class="sxs-lookup"><span data-stu-id="e1364-114">This will give you a Service Principal account that has access tooyour key vault which your VM will need.</span></span> <span data-ttu-id="e1364-115">本文 hello Azure 金鑰保存庫，您可以在 hello 中找到這些步驟[與 Azure Active Directory 註冊應用程式](../articles/key-vault/key-vault-get-started.md#register) 區段中，或者您可以看到在 hello 螢幕擷取畫面和步驟，hello **hello 應用程式取得身分識別區段**的[此部落格文章](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx)。</span><span class="sxs-lookup"><span data-stu-id="e1364-115">In hello Azure Key Vault article, you can find these steps in hello [Register an application with Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) section, or you can see hello steps with screen shots in hello **Get an identity for hello application section** of [this blog post](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span></span> <span data-ttu-id="e1364-116">在之前完成這些步驟，請注意，您需要下列資訊，當您啟用 SQL VM 上的 Azure 金鑰保存庫整合之後需要這個註冊期間 toocollect hello。</span><span class="sxs-lookup"><span data-stu-id="e1364-116">Before completing these steps, note that you need toocollect hello following information during this registration that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

* <span data-ttu-id="e1364-117">Hello 應用程式會加入後，會發現 hello**用戶端識別碼**上 hello**設定** 索引標籤。 ![Azure Active Directory 用戶端識別碼](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span><span class="sxs-lookup"><span data-stu-id="e1364-117">After hello application is added, find hello **CLIENT ID**  on hello **CONFIGURE** tab.   ![Azure Active Directory Client ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span></span>
  
    <span data-ttu-id="e1364-118">hello 用戶端識別碼指派更新 toohello **$spName** hello PowerShell 指令碼 tooenable Azure 金鑰保存庫整合在 （服務主體名稱） 參數。</span><span class="sxs-lookup"><span data-stu-id="e1364-118">hello client ID is assigned later toohello **$spName** (Service Principal name) parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span> 
* <span data-ttu-id="e1364-119">此外，在這些步驟當您建立您的金鑰，複製您金鑰的 hello 密碼 hello 下列螢幕擷取畫面所示。</span><span class="sxs-lookup"><span data-stu-id="e1364-119">Also, during these steps when you create your key, copy hello secret for your key as is shown in hello following screenshot.</span></span> <span data-ttu-id="e1364-120">此金鑰的密碼指派更新 toohello **$spSecret** hello PowerShell 指令碼中的 （服務主體機密） 參數。</span><span class="sxs-lookup"><span data-stu-id="e1364-120">This key secret is assigned later toohello **$spSecret** (Service Principal secret) parameter in hello PowerShell script.</span></span>  
    <span data-ttu-id="e1364-121">![Azure Active Directory 密碼](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span><span class="sxs-lookup"><span data-stu-id="e1364-121">![Azure Active Directory Secret](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span></span>
* <span data-ttu-id="e1364-122">您必須授權下列存取權限這個新用戶端識別碼 toohave hello:**加密**，**解密**， **wrapKey**， **unwrapKey**，**登**，和**確認**。</span><span class="sxs-lookup"><span data-stu-id="e1364-122">You must authorize this new client ID toohave hello following access permissions: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign**, and **verify**.</span></span> <span data-ttu-id="e1364-123">這是以 hello [Set-azurermkeyvaultaccesspolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet。</span><span class="sxs-lookup"><span data-stu-id="e1364-123">This is done with hello [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span></span> <span data-ttu-id="e1364-124">如需詳細資訊，請參閱[授權 hello 應用程式 toouse hello 金鑰或密碼](../articles/key-vault/key-vault-get-started.md#authorize)。</span><span class="sxs-lookup"><span data-stu-id="e1364-124">For more information see [Authorize hello application toouse hello key or secret](../articles/key-vault/key-vault-get-started.md#authorize).</span></span>

### <a name="create-a-key-vault"></a><span data-ttu-id="e1364-125">建立金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="e1364-125">Create a key vault</span></span>
<span data-ttu-id="e1364-126">在訂單 toouse Azure 金鑰保存庫 toostore hello 金鑰，您會在 VM 中使用加密，您會需要存取 tooa 金鑰保存庫。</span><span class="sxs-lookup"><span data-stu-id="e1364-126">In order toouse Azure Key Vault toostore hello keys you will use for encryption in your VM, you need access tooa key vault.</span></span> <span data-ttu-id="e1364-127">如果尚未設定金鑰保存庫，建立一個 hello 中的 hello 步驟[開始使用 Azure 金鑰保存庫](../articles/key-vault/key-vault-get-started.md)主題。</span><span class="sxs-lookup"><span data-stu-id="e1364-127">If you have not already set up your key vault, create one by following hello steps in hello [Getting Started with Azure Key Vault](../articles/key-vault/key-vault-get-started.md) topic.</span></span> <span data-ttu-id="e1364-128">之前完成這些步驟，請注意，當您啟用 SQL VM 上的 Azure 金鑰保存庫整合之後需要一些資訊，您需要 toocollect 期間，此設定。</span><span class="sxs-lookup"><span data-stu-id="e1364-128">Before completing these steps, note that there is some information you need toocollect during this set up that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

<span data-ttu-id="e1364-129">當您取得 toohello 建立金鑰保存庫的步驟中，注意 hello 傳回**vaultUri**屬性，這是 hello 金鑰保存庫 URL。</span><span class="sxs-lookup"><span data-stu-id="e1364-129">When you get toohello Create a key vault step, note hello returned **vaultUri** property, which is hello key vault URL.</span></span> <span data-ttu-id="e1364-130">在該，如下所示的步驟中所提供的 hello 範例 hello 金鑰保存庫名稱為 ContosoKeyVault，因此 hello 金鑰保存庫 URL 會是 https://contosokeyvault.vault.azure.net/。</span><span class="sxs-lookup"><span data-stu-id="e1364-130">In hello example provided in that step, shown below, hello key vault name is ContosoKeyVault, therefore hello key vault URL would be https://contosokeyvault.vault.azure.net/.</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="e1364-131">hello 金鑰保存庫 URL 指派更新 toohello **$akvURL** hello PowerShell 指令碼 tooenable Azure 金鑰保存庫整合中的參數。</span><span class="sxs-lookup"><span data-stu-id="e1364-131">hello key vault URL is assigned later toohello **$akvURL** parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span>

