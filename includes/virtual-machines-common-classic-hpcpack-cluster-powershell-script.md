



<span data-ttu-id="37f98-101">根據您的環境和選擇，指令碼可建立所有的叢集基礎結構，包括 Azure 虛擬網路、儲存體帳戶、雲端服務、網域控制站、遠端或本機 SQL Database、前端節點、及其他叢集節點。</span><span class="sxs-lookup"><span data-stu-id="37f98-101">Depending on your environment and choices, the script can create all the cluster infrastructure, including the Azure virtual network, storage accounts, cloud services, domain controller, remote or local SQL databases, head node, and additional cluster nodes.</span></span> <span data-ttu-id="37f98-102">或者，指令碼可使用既有的 Azure 基礎結構，然後只建立 HPC 叢集節點。</span><span class="sxs-lookup"><span data-stu-id="37f98-102">Alternatively, the script can use pre-existing Azure infrastructure and create only the HPC cluster nodes.</span></span>

<span data-ttu-id="37f98-103">如需規劃 HPC Pack 2012 R2 叢集的背景資訊，請參閱 HPC Pack TechNet 文件庫中的[產品評估及規劃](https://technet.microsoft.com/library/jj899596.aspx)和[快速入門](https://technet.microsoft.com/library/jj899590.aspx)內容。</span><span class="sxs-lookup"><span data-stu-id="37f98-103">For background information about planning an HPC Pack cluster, see the [Product Evaluation and Planning](https://technet.microsoft.com/library/jj899596.aspx) and [Getting Started](https://technet.microsoft.com/library/jj899590.aspx) content in the HPC Pack 2012 R2 TechNet Library.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="37f98-104">必要條件</span><span class="sxs-lookup"><span data-stu-id="37f98-104">Prerequisites</span></span>
* <span data-ttu-id="37f98-105">**Azure 訂用帳戶**：您可以使用「Azure 全球」或「Azure 中國」服務中的訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="37f98-105">**Azure subscription**: You can use a subscription in either the Azure Global or Azure China service.</span></span> <span data-ttu-id="37f98-106">您的訂用帳戶限制將會影響到您可以部署的叢集節點類型與數量。</span><span class="sxs-lookup"><span data-stu-id="37f98-106">Your subscription limits affect the number and type of cluster nodes you can deploy.</span></span> <span data-ttu-id="37f98-107">如需相關資訊，請參閱 [Azure 訂用帳戶和服務限制、配額與條件約束](../articles/azure-subscription-service-limits.md)。</span><span class="sxs-lookup"><span data-stu-id="37f98-107">For information, see [Azure subscription and service limits, quotas, and constraints](../articles/azure-subscription-service-limits.md).</span></span>
* <span data-ttu-id="37f98-108">**已安裝並設定 Azure PowerShell 0.8.10 或更新版本的 Windows 用戶端電腦**：如需連線至 Azure 訂用帳戶的安裝指示和步驟，請參閱[始使用 Azure PowerShell](/powershell/azureps-cmdlets-docs)。</span><span class="sxs-lookup"><span data-stu-id="37f98-108">**Windows client computer with Azure PowerShell 0.8.10 or later installed and configured**: See [Get started with Azure PowerShell](/powershell/azureps-cmdlets-docs) for installation instructions and steps to connect to your Azure subscription.</span></span>
* <span data-ttu-id="37f98-109">**HPC Pack IaaS 部署指令碼**：從 [Microsoft 下載中心](https://www.microsoft.com/download/details.aspx?id=44949)下載並解壓縮最新版的指令碼。</span><span class="sxs-lookup"><span data-stu-id="37f98-109">**HPC Pack IaaS deployment script**: Download and unpack the latest version of the script from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=44949).</span></span> <span data-ttu-id="37f98-110">執行 `New-HPCIaaSCluster.ps1 –Version`以檢查指令碼的版本。</span><span class="sxs-lookup"><span data-stu-id="37f98-110">Check the version of the script by running `New-HPCIaaSCluster.ps1 –Version`.</span></span> <span data-ttu-id="37f98-111">這篇文章是根據 4.5.2 版的指令碼撰寫的。</span><span class="sxs-lookup"><span data-stu-id="37f98-111">This article is based on version 4.5.2 of the script.</span></span>
* <span data-ttu-id="37f98-112">**指令碼組態檔**：建立讓指令碼用來設定 HPC 叢集的 XML 檔案。</span><span class="sxs-lookup"><span data-stu-id="37f98-112">**Script configuration file**: Create an XML file that the script uses to configure the HPC cluster.</span></span> <span data-ttu-id="37f98-113">如需相關資訊和範例，請參閱本文稍後的章節以及部署指令碼隨附的 Manual.rtf 檔。</span><span class="sxs-lookup"><span data-stu-id="37f98-113">For information and examples, see sections later in this article and the file Manual.rtf that accompanies the deployment script.</span></span>

## <a name="syntax"></a><span data-ttu-id="37f98-114">語法</span><span class="sxs-lookup"><span data-stu-id="37f98-114">Syntax</span></span>
```PowerShell
New-HPCIaaSCluster.ps1 [-ConfigFile] <String> [-AdminUserName]<String> [[-AdminPassword] <String>] [[-HPCImageName] <String>] [[-LogFile] <String>] [-Force] [-NoCleanOnFailure] [-PSSessionSkipCACheck] [<CommonParameters>]
```
> [!NOTE]
> <span data-ttu-id="37f98-115">以系統管理員身分執行指令碼。</span><span class="sxs-lookup"><span data-stu-id="37f98-115">Run the script as an administrator.</span></span>
> 
> 

### <a name="parameters"></a><span data-ttu-id="37f98-116">參數</span><span class="sxs-lookup"><span data-stu-id="37f98-116">Parameters</span></span>
* <span data-ttu-id="37f98-117">**/ConfigFile**：指定說明 HPC 叢集之組態檔的檔案路徑。</span><span class="sxs-lookup"><span data-stu-id="37f98-117">**ConfigFile**: Specifies the file path of the configuration file to describe the HPC cluster.</span></span> <span data-ttu-id="37f98-118">詳細資訊請參閱本主題中的組態檔，或指令碼所在之資料夾中的 Manual.rtf 檔。</span><span class="sxs-lookup"><span data-stu-id="37f98-118">See more about the configuration file in this topic, or in the file Manual.rtf in the folder containing the script.</span></span>
* <span data-ttu-id="37f98-119">**AdminUserName**：指定使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="37f98-119">**AdminUserName**: Specifies the user name.</span></span> <span data-ttu-id="37f98-120">如果網域樹系是由指令碼所建立，這將會成為所有 VM 的本機系統管理員使用者名稱和網域系統管理員名稱。</span><span class="sxs-lookup"><span data-stu-id="37f98-120">If the domain forest is created by the script, this becomes the local administrator user name for all VMs and the domain administrator name.</span></span> <span data-ttu-id="37f98-121">如果網域樹系已存在，則會將網域使用者指定為安裝 HPC Pack 的本機系統管理員使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="37f98-121">If the domain forest already exists, this specifies the domain user as the local administrator user name to install HPC Pack.</span></span>
* <span data-ttu-id="37f98-122">**AdminPassword**：指定系統管理員的密碼。</span><span class="sxs-lookup"><span data-stu-id="37f98-122">**AdminPassword**: Specifies the administrator’s password.</span></span> <span data-ttu-id="37f98-123">如果未在命令列中指定，指令碼會提示您輸入密碼。</span><span class="sxs-lookup"><span data-stu-id="37f98-123">If not specified in the command line, the script prompts you to input the password.</span></span>
* <span data-ttu-id="37f98-124">**HPCImageName** (選擇性)：指定用來部署 HPC 叢集的 HPC Pack VM 映像名稱。</span><span class="sxs-lookup"><span data-stu-id="37f98-124">**HPCImageName** (optional): Specifies the HPC Pack VM image name used to deploy the HPC cluster.</span></span> <span data-ttu-id="37f98-125">它必須是 Microsoft 在 Azure Marketplace 中提供的 HPC Pack 映像。</span><span class="sxs-lookup"><span data-stu-id="37f98-125">It must be a Microsoft-provided HPC Pack image from the Azure Marketplace.</span></span> <span data-ttu-id="37f98-126">如果未指定 (通常會建議使用)，指令碼會選擇最新發佈的 [HPC Pack 2012 R2 映像](https://azure.microsoft.com/marketplace/partners/microsoft/hpcpack2012r2onwindowsserver2012r2/)。</span><span class="sxs-lookup"><span data-stu-id="37f98-126">If not specified (recommended usually), the script chooses the latest published [HPC Pack 2012 R2 image](https://azure.microsoft.com/marketplace/partners/microsoft/hpcpack2012r2onwindowsserver2012r2/).</span></span> <span data-ttu-id="37f98-127">最新的映像是基於已安裝 HPC Pack 2012 R2 Update 3 的 Windows Server 2012 R2 Datacenter。</span><span class="sxs-lookup"><span data-stu-id="37f98-127">The latest image is based on Windows Server 2012 R2 Datacenter with HPC Pack 2012 R2 Update 3 installed.</span></span>
  
  > [!NOTE]
  > <span data-ttu-id="37f98-128">若未指定有效的 HPC Pack 映像，部署將會失敗。</span><span class="sxs-lookup"><span data-stu-id="37f98-128">Deployment fails if you don't specify a valid HPC Pack image.</span></span>
  > 
  > 
* <span data-ttu-id="37f98-129">**LogFile** (選擇性)：指定部署記錄檔路徑。</span><span class="sxs-lookup"><span data-stu-id="37f98-129">**LogFile** (optional): Specifies the deployment log file path.</span></span> <span data-ttu-id="37f98-130">若未指定，指令碼會在執行指令碼之電腦的暫存目錄中建立記錄檔。</span><span class="sxs-lookup"><span data-stu-id="37f98-130">If not specified, the script creates a log file in the temp directory of the computer running the script.</span></span>
* <span data-ttu-id="37f98-131">**Force** (選擇性)：抑制所有的確認提示。</span><span class="sxs-lookup"><span data-stu-id="37f98-131">**Force** (optional): Suppresses all the confirmation prompts.</span></span>
* <span data-ttu-id="37f98-132">**NoCleanOnFailure** (選擇性)：指定未成功部署的 Azure VM 將不會移除。</span><span class="sxs-lookup"><span data-stu-id="37f98-132">**NoCleanOnFailure** (optional): Specifies that the Azure VMs that are not successfully deployed are not removed.</span></span> <span data-ttu-id="37f98-133">請先手動移除這些 VM 才能重新執行指令碼以繼續部署，否則部署可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="37f98-133">Remove these VMs manually before rerunning the script to continue the deployment, or the deployment may fail.</span></span>
* <span data-ttu-id="37f98-134">**PSSessionSkipCACheck** (選擇性)：針對每個使用此指令碼部署 VM 的雲端服務，都會由 Azure 自動產生自我簽署憑證，且雲端服務中的所有 VM 都會使用此憑證做為預設 Windows 遠端管理 (WinRM) 憑證。</span><span class="sxs-lookup"><span data-stu-id="37f98-134">**PSSessionSkipCACheck** (optional): For every cloud service with VMs deployed by this script, a self-signed certificate is automatically generated by Azure, and all the VMs in the cloud service use this certificate as the default Windows Remote Management (WinRM) certificate.</span></span> <span data-ttu-id="37f98-135">為了在這些 Azure VM 中部署 HPC 功能，指令碼會依預設將這些憑證暫時安裝在用戶端電腦的「本機電腦\\信任的根憑證授權單位」存放區中，以抑制指令碼執行期間的「不受信任的 CA」安全性錯誤；</span><span class="sxs-lookup"><span data-stu-id="37f98-135">To deploy HPC features in these Azure VMs, the script by default temporarily installs these certificates in the Local Computer\\Trusted Root Certification Authorities store of the client computer to suppress the “not trusted CA” security error during script execution.</span></span> <span data-ttu-id="37f98-136">指令碼完成時即會移除憑證。</span><span class="sxs-lookup"><span data-stu-id="37f98-136">The certificates are removed when the script finishes.</span></span> <span data-ttu-id="37f98-137">如果指定此參數，則不會在用戶端電腦上安裝憑證，並且會抑制安全性警告。</span><span class="sxs-lookup"><span data-stu-id="37f98-137">If this parameter is specified, the certificates are not installed in the client computer, and the security warning is suppressed.</span></span>
  
  > [!IMPORTANT]
  > <span data-ttu-id="37f98-138">此參數不建議用於生產部署。</span><span class="sxs-lookup"><span data-stu-id="37f98-138">This parameter is not recommended for production deployments.</span></span>
  > 
  > 

### <a name="example"></a><span data-ttu-id="37f98-139">範例</span><span class="sxs-lookup"><span data-stu-id="37f98-139">Example</span></span>
<span data-ttu-id="37f98-140">下列範例會使用組態檔 *MyConfigFile.xml*建立新的 HPC Pack 叢集，並指定用來安裝叢集的管理員認證。</span><span class="sxs-lookup"><span data-stu-id="37f98-140">The following example creates an HPC Pack cluster using the configuration file *MyConfigFile.xml*, and specifies administrator credentials for installing the cluster.</span></span>

```PowerShell
.\New-HPCIaaSCluster.ps1 –ConfigFile MyConfigFile.xml -AdminUserName <username> –AdminPassword <password>
```

### <a name="additional-considerations"></a><span data-ttu-id="37f98-141">其他考量</span><span class="sxs-lookup"><span data-stu-id="37f98-141">Additional considerations</span></span>
* <span data-ttu-id="37f98-142">指令碼可選擇性地讓工作透過 HPC Pack Web 入口網站或 HPC Pack REST API 來提交。</span><span class="sxs-lookup"><span data-stu-id="37f98-142">The script can optionally enable job submission through the HPC Pack web portal or the HPC Pack REST API.</span></span>
* <span data-ttu-id="37f98-143">如果您想要安裝其他軟體或進行其他設定，指令碼可以選擇性地在前端節點上執行自訂的前置和後置組態指令碼。</span><span class="sxs-lookup"><span data-stu-id="37f98-143">The script can optionally run custom pre- and post-configuration scripts on the head node if you want to install additional software or configure other settings.</span></span>

## <a name="configuration-file"></a><span data-ttu-id="37f98-144">組態檔</span><span class="sxs-lookup"><span data-stu-id="37f98-144">Configuration file</span></span>
<span data-ttu-id="37f98-145">部署指令碼的組態檔是 XML 檔案。</span><span class="sxs-lookup"><span data-stu-id="37f98-145">The configuration file for the deployment script is an XML file.</span></span> <span data-ttu-id="37f98-146">結構描述檔案 HPCIaaSClusterConfig.xsd 位於 HPC Pack IaaS 部署指令碼資料夾中。</span><span class="sxs-lookup"><span data-stu-id="37f98-146">The schema file HPCIaaSClusterConfig.xsd is in the HPC Pack IaaS deployment script folder.</span></span> <span data-ttu-id="37f98-147">**IaaSClusterConfig** 是組態檔的根元素，其中包含相關子元素用以說明部署指令碼資料夾中的檔案 Manual.rtf。</span><span class="sxs-lookup"><span data-stu-id="37f98-147">**IaaSClusterConfig** is the root element of the configuration file, which contains the child elements described in detail in the file Manual.rtf in the deployment script folder.</span></span>

