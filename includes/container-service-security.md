# <a name="securing-docker-containers-in-azure-container-service"></a><span data-ttu-id="35e14-101">保護 Azure Container Service 中的 Docker 容器</span><span class="sxs-lookup"><span data-stu-id="35e14-101">Securing Docker containers in Azure Container Service</span></span>

<span data-ttu-id="35e14-102">本文將介紹為部署在 Azure Container Service 中的 Docker 容器提供保護時的注意事項和建議。</span><span class="sxs-lookup"><span data-stu-id="35e14-102">This article introduces considerations and recommendations for securing Docker containers deployed in Azure Container Service.</span></span> <span data-ttu-id="35e14-103">許多這些考量通常套用 tooDocker 容器部署在 Azure 或其他環境。</span><span class="sxs-lookup"><span data-stu-id="35e14-103">Many of these considerations apply generally tooDocker containers deployed in Azure or other environments.</span></span> 

## <a name="image-security"></a><span data-ttu-id="35e14-104">映像安全性</span><span class="sxs-lookup"><span data-stu-id="35e14-104">Image security</span></span>

<span data-ttu-id="35e14-105">容器是透過一或多個存放庫中所儲存的映像來建立的。</span><span class="sxs-lookup"><span data-stu-id="35e14-105">Containers are built from images that are stored in one or more repositories.</span></span> <span data-ttu-id="35e14-106">這些機制可以隸屬 toopublic 或私用容器。</span><span class="sxs-lookup"><span data-stu-id="35e14-106">These repositories can belong toopublic or private container registries.</span></span> <span data-ttu-id="35e14-107">公用登錄的範例是 [Docker Hub](https://hub.docker.com/)。</span><span class="sxs-lookup"><span data-stu-id="35e14-107">An example of a public registry is [Docker Hub](https://hub.docker.com/).</span></span> <span data-ttu-id="35e14-108">私用登錄的範例為 hello [Docker Trusted Registry](https://docs.docker.com/datacenter/dtr/2.0/)，它可以是安裝在內部部署或虛擬的私人雲端中。</span><span class="sxs-lookup"><span data-stu-id="35e14-108">An example of a private registry is hello [Docker Trusted Registry](https://docs.docker.com/datacenter/dtr/2.0/), which can be installed on-premises or in a virtual private cloud.</span></span> <span data-ttu-id="35e14-109">另外還有以雲端為基礎的私人容器登錄服務，包括 [Azure Container Registry](../articles/container-registry/container-registry-intro.md)。</span><span class="sxs-lookup"><span data-stu-id="35e14-109">There are also cloud-based private container registry services including [Azure Container Registry](../articles/container-registry/container-registry-intro.md).</span></span>

### <a name="public-and-private-images"></a><span data-ttu-id="35e14-110">公用和私人映像</span><span class="sxs-lookup"><span data-stu-id="35e14-110">Public and private images</span></span>
<span data-ttu-id="35e14-111">一般情況下，可公開取得的容器映像並無法保證安全性，這個情況就和任何已公開發佈的軟體套件一樣。</span><span class="sxs-lookup"><span data-stu-id="35e14-111">In general, as with any publicly published software package, a publicly available container image does not guarantee security.</span></span> <span data-ttu-id="35e14-112">容器映像包含多個軟體層，每個軟體層可能各有弱點。</span><span class="sxs-lookup"><span data-stu-id="35e14-112">Container images consist of multiple software layers, and each software layer could have vulnerabilities.</span></span> <span data-ttu-id="35e14-113">它是 hello 容器映像的索引鍵 toounderstand hello 原點、 hello hello 映像 (toodetermine 如果不可靠的來源) 的擁有者包括 hello 軟體層而它所組成，而且 hello 軟體版本。</span><span class="sxs-lookup"><span data-stu-id="35e14-113">It is key toounderstand hello origin of hello container image, including hello owner of hello image (toodetermine if it is a reliable source or not), hello software layers it consists of, and hello software versions.</span></span> 

<span data-ttu-id="35e14-114">比方說，如果您移 toohello 官方[nginx 儲存機制](https://hub.docker.com/_/nginx/)Docker 中樞中，瀏覽 toohello**標記**索引標籤上，您會看到每個映像中的弱點可能會以色彩標示。</span><span class="sxs-lookup"><span data-stu-id="35e14-114">For example, if you go toohello official [nginx repository](https://hub.docker.com/_/nginx/) in Docker Hub and navigate toohello **Tags** tab, you see color-coded vulnerabilities in each image.</span></span> <span data-ttu-id="35e14-115">每個色彩描述 hello 弱點 hello 映像的軟體層。</span><span class="sxs-lookup"><span data-stu-id="35e14-115">Each color depicts hello vulnerability of a software layer of hello image.</span></span> <span data-ttu-id="35e14-116">如需有關 Docker Hub 弱點掃描的詳細資訊，請參閱[了解 Docker Hub 的官方存放庫](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/)。</span><span class="sxs-lookup"><span data-stu-id="35e14-116">For more about vulnerability scanning in Docker Hub, see [Understanding official repos on Docker Hub](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/).</span></span>

![Docker Hub 中的 Nginx 映像](./media/container-service-security/docker-hub-nginx.png)

<span data-ttu-id="35e14-118">企業深處理有關的安全性和 tooprotect 本身受到安全性攻擊應該儲存，以及從私人登錄中，例如 Azure 容器登錄中或 Docker Trusted Registry 擷取映像。</span><span class="sxs-lookup"><span data-stu-id="35e14-118">Enterprises care deeply about security, and tooprotect themselves from security attack should store and retrieve images from a private registry, such as Azure Container Registry or Docker Trusted Registry.</span></span> <span data-ttu-id="35e14-119">在加法 tooproviding 受管理的私人登錄，Azure 容器登錄中支援[服務主體為基礎的驗證](../articles/container-registry/container-registry-authentication.md)透過 Azure Active Directory 的基本驗證的流量，包括以角色為基礎的存取唯讀、 寫入和擁有者權限。</span><span class="sxs-lookup"><span data-stu-id="35e14-119">In addition tooproviding a managed private registry, Azure Container Registry supports [service principal-based authentication](../articles/container-registry/container-registry-authentication.md) through Azure Active Directory for basic authentication flows, including role-based access for read-only, write, and owner permissions.</span></span>

### <a name="image-security-scanning"></a><span data-ttu-id="35e14-120">映像安全性掃描</span><span class="sxs-lookup"><span data-stu-id="35e14-120">Image security scanning</span></span>

<span data-ttu-id="35e14-121">即使使用私用的登錄，它就會是個不錯的主意 toouse 的映像，掃描其他安全性驗證的方案。</span><span class="sxs-lookup"><span data-stu-id="35e14-121">Even when using a private registry, it is a good idea toouse image scanning solutions for additional security validation.</span></span> <span data-ttu-id="35e14-122">容器映像中的每個軟體層是獨立的 hello 容器映像中的其他圖層可能容易出錯 toovulnerabilities。</span><span class="sxs-lookup"><span data-stu-id="35e14-122">Each software layer in a container image is potentially prone toovulnerabilities independent of other layers in hello container image.</span></span> <span data-ttu-id="35e14-123">當越來越多公司開始部署其容器技術為基礎的生產工作負載時，掃描映像會變成重要 tooensure 防止對其組織的安全性威脅。</span><span class="sxs-lookup"><span data-stu-id="35e14-123">As increasingly companies start deploying their production workloads based on container technologies, image scanning becomes important tooensure prevention of security threats against their organizations.</span></span> 

<span data-ttu-id="35e14-124">監視和掃描的解決方案，例如安全性[Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry)和[青色安全性](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry)，和其他項目，可以使用的 tooscan 私人登錄中的容器映像並識別潛在的弱點。</span><span class="sxs-lookup"><span data-stu-id="35e14-124">Security monitoring and scanning solutions such as [Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry) and [Aqua Security](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry), among others, can be used tooscan container images in a private registry and identify potential vulnerabilities.</span></span> <span data-ttu-id="35e14-125">請務必提供 toounderstand hello 深度掃描該 hello 不同解決方案。</span><span class="sxs-lookup"><span data-stu-id="35e14-125">It is important toounderstand hello depth of scanning that hello different solutions provide.</span></span> <span data-ttu-id="35e14-126">例如，某些解決方案可能只會就已知弱點對映像層進行交叉驗證。</span><span class="sxs-lookup"><span data-stu-id="35e14-126">For example, some solutions might only cross-verify image layers against known vulnerabilities.</span></span> <span data-ttu-id="35e14-127">這些解決方案可能無法建置透過特定的封裝管理員軟體可以 tooverify 映像層軟體。</span><span class="sxs-lookup"><span data-stu-id="35e14-127">These solutions might not be able tooverify image-layer software built through certain package manager software.</span></span> <span data-ttu-id="35e14-128">其他解決方案則可能已更加深入地整合掃描功能，因此可以找出任何已封裝軟體中的弱點。</span><span class="sxs-lookup"><span data-stu-id="35e14-128">Other solutions have deeper scanning integration and can find vulnerabilities in any packaged software.</span></span>

### <a name="production-deployment-rules-and-audit"></a><span data-ttu-id="35e14-129">生產部署的規則和稽核</span><span class="sxs-lookup"><span data-stu-id="35e14-129">Production deployment rules and audit</span></span>
<span data-ttu-id="35e14-130">一旦應用程式部署在生產環境中，就是不可或缺的 tooset 映像用於實際執行環境的一些規則 tooensure 安全，而且包含沒有弱點。</span><span class="sxs-lookup"><span data-stu-id="35e14-130">Once an application is deployed in production, it is essential tooset a few rules tooensure that images used in production environments are secure and contain no vulnerabilities.</span></span>

* <span data-ttu-id="35e14-131">一般而言，弱點，即使次要、 映像應該不允許 toorun 實際執行環境中。</span><span class="sxs-lookup"><span data-stu-id="35e14-131">As a rule, images with vulnerabilities, even minor, should not be allowed toorun in a production environment.</span></span> <span data-ttu-id="35e14-132">此外，在生產環境中部署的所有映像應該在理想情況下儲存在私人登錄存取 tooa 選取少。</span><span class="sxs-lookup"><span data-stu-id="35e14-132">In addition, all images deployed in production should ideally be saved in a private registry accessible tooa select few.</span></span> <span data-ttu-id="35e14-133">它也是重要 tookeep hello 數的實際執行映像小 tooensure，它們可以受到管理有效。</span><span class="sxs-lookup"><span data-stu-id="35e14-133">It is also important tookeep hello number of production images small tooensure that they can be managed effectively.</span></span>

* <span data-ttu-id="35e14-134">因為硬碟 toopinpoint hello 原點的公開可用的容器映像從軟體，是很好的作法 toobuild 映像中的 hello 圖層的 hello 原始來源 tooensure 知識。</span><span class="sxs-lookup"><span data-stu-id="35e14-134">Since it is hard toopinpoint hello origin of software from a publicly available container image, it is a good practice toobuild images from source tooensure knowledge of hello origin of hello layer.</span></span> <span data-ttu-id="35e14-135">當內建自我容器映像中的弱點可能會呈現時，客戶就可以找到更快速的路徑 tooa 解析。</span><span class="sxs-lookup"><span data-stu-id="35e14-135">When a vulnerability surfaces in a self-built container image, customers can find a quicker path tooa resolution.</span></span> <span data-ttu-id="35e14-136">具有公用的映像，客戶需要 toofind hello 根目錄的 公用映像 toofix 它，或從 hello 發行者取得另一個安全映像。</span><span class="sxs-lookup"><span data-stu-id="35e14-136">With a public image, customers would need toofind hello root of a public image toofix it or obtain another secure image from hello publisher.</span></span>

* <span data-ttu-id="35e14-137">部署在生產環境中徹底掃描的影像不保證向上 toodate toobe hello hello 應用程式存留期。</span><span class="sxs-lookup"><span data-stu-id="35e14-137">A thoroughly scanned image deployed in production is not guaranteed toobe up toodate for hello lifetime of hello application.</span></span> <span data-ttu-id="35e14-138">安全性弱點可能會報告 hello 映像層上，不知道先前或引進之後 hello 生產環境部署。</span><span class="sxs-lookup"><span data-stu-id="35e14-138">Security vulnerabilities might be reported for layers of hello image that were not previously known or were introduced after hello production deployment.</span></span> <span data-ttu-id="35e14-139">定期稽核的映像部署在生產環境中是已過期或尚未更新一點的必要 tooidentify 映像。</span><span class="sxs-lookup"><span data-stu-id="35e14-139">Periodic auditing of images deployed in production is necessary tooidentify images that are out of date or have not been updated in a while.</span></span> <span data-ttu-id="35e14-140">其中一個可能會使用藍綠色部署方法，並輪流升級的機制 tooupdate 容器映像，而不需要停機。</span><span class="sxs-lookup"><span data-stu-id="35e14-140">One might use blue-green deployment methodologies and rolling upgrade mechanisms tooupdate container images without downtime.</span></span> <span data-ttu-id="35e14-141">掃描映像可以利用 hello 前面一節中所述的工具來完成。</span><span class="sxs-lookup"><span data-stu-id="35e14-141">Image scanning can be done with tools described in hello preceding section.</span></span> 

* <span data-ttu-id="35e14-142">持續整合 (CI) 管線 toobuild 映像和整合式的安全性掃描可以協助維護安全的私人登錄，以安全的容器映像。</span><span class="sxs-lookup"><span data-stu-id="35e14-142">A continuous integration (CI) pipeline toobuild images and integrated security scanning can help maintain secure private registries with secure container images.</span></span> <span data-ttu-id="35e14-143">hello hello CI 解決方案內建的弱點可能會掃描可確保通過 hello 的所有測試的映像會推入 toohello 私人登錄從哪一個實際執行部署工作負載。</span><span class="sxs-lookup"><span data-stu-id="35e14-143">hello vulnerability scanning built into hello CI solution ensures that images that pass all hello tests are pushed toohello private registry from which production workloads are deployed.</span></span> <span data-ttu-id="35e14-144">CI 管線失敗可確保易受攻擊的映像不會用於實際執行工作負載部署的 hello 私人登錄推入。</span><span class="sxs-lookup"><span data-stu-id="35e14-144">A CI pipeline failure ensures that vulnerable images are not pushed into hello private registry used for production workload deployments.</span></span> <span data-ttu-id="35e14-145">它也會在有大量映像時自動掃描映像是否安全。</span><span class="sxs-lookup"><span data-stu-id="35e14-145">It also automates image security scanning if there are a significant number of images.</span></span> <span data-ttu-id="35e14-146">否則，手動稽核映像中是否有安全性弱點會是一件痛苦、冗長又容易出錯的工作。</span><span class="sxs-lookup"><span data-stu-id="35e14-146">Otherwise, manually auditing images for security vulnerabilities can be painstakingly lengthy and error prone.</span></span>

## <a name="host-level-container-isolation"></a><span data-ttu-id="35e14-147">主機層級的容器隔離</span><span class="sxs-lookup"><span data-stu-id="35e14-147">Host-level container isolation</span></span>
<span data-ttu-id="35e14-148">當客戶在 Azure 資源上部署容器應用程式時，這些應用程式會部署在資源群組的訂用帳戶層級，而且不會是多租用戶。</span><span class="sxs-lookup"><span data-stu-id="35e14-148">When a customer deploys container applications on Azure resources, they are deployed at a subscription level in resource groups and are not multi-tenant.</span></span> <span data-ttu-id="35e14-149">這表示如果客戶與其他人共用訂用帳戶，沒有界限可建置 hello 中的兩個部署之間相同訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="35e14-149">This means that if a customer shares a subscription with others, there are no boundaries that can be built between two deployments in hello same subscription.</span></span> <span data-ttu-id="35e14-150">因此，系統無法保證容器層級的安全性。</span><span class="sxs-lookup"><span data-stu-id="35e14-150">Therefore, container-level security is not guaranteed.</span></span> 

<span data-ttu-id="35e14-151">它也是關鍵 toounderstand 容器共用核心 hello 與 hello 資源 hello 主機 （這在 Azure 容器服務是在叢集中的 Azure VM）。</span><span class="sxs-lookup"><span data-stu-id="35e14-151">It is also critical toounderstand that containers share hello kernel and hello resources of hello host (which in Azure Container Service is an Azure VM in a cluster).</span></span> <span data-ttu-id="35e14-152">因此，在生產環境中執行的容器必須以不具權限的使用者模式執行。</span><span class="sxs-lookup"><span data-stu-id="35e14-152">Therefore, containers running in production must be run in non-privileged user mode.</span></span> <span data-ttu-id="35e14-153">以根權限執行的容器可能會危害整個環境的 hello。</span><span class="sxs-lookup"><span data-stu-id="35e14-153">Running a container with root privileges can compromise hello entire environment.</span></span> <span data-ttu-id="35e14-154">透過在容器中的根層級存取權，駭客就可以存取 toohello hello 主機上的完整根權限。</span><span class="sxs-lookup"><span data-stu-id="35e14-154">With root-level access in a container, a hacker can gain access toohello full root privileges on hello host.</span></span> <span data-ttu-id="35e14-155">此外，它是唯讀的檔案系統的重要 toorun 容器。</span><span class="sxs-lookup"><span data-stu-id="35e14-155">In addition, it is important toorun containers with read-only file systems.</span></span> <span data-ttu-id="35e14-156">這可防止其他人已存取 toohello 危害容器 toowrite 惡意指令碼 toohello 檔案系統，以及存取 tooother 檔案。</span><span class="sxs-lookup"><span data-stu-id="35e14-156">This prevents someone who has access toohello compromised container toowrite malicious scripts toohello file system and gain access tooother files.</span></span> <span data-ttu-id="35e14-157">同樣地，它是重要的 toolimit hello 配置的資源 （例如記憶體、 CPU 和網路頻寬） tooa 容器。</span><span class="sxs-lookup"><span data-stu-id="35e14-157">Similarly, it is important toolimit hello resources (such as memory, CPU, and network bandwidth) allocated tooa container.</span></span> <span data-ttu-id="35e14-158">這有助於防止駭客，阻止霸佔資源以及不合法的活動，例如信用卡詐欺或 bitcoin 採礦，可防止其他容器 hello 主機或叢集上執行。</span><span class="sxs-lookup"><span data-stu-id="35e14-158">This helps prevent hackers from hogging resources and pursuing illegal activities such as credit card fraud or bitcoin mining, which could prevent other containers from running on hello host or cluster.</span></span>

## <a name="orchestrator-considerations"></a><span data-ttu-id="35e14-159">Orchestrator 的注意事項</span><span class="sxs-lookup"><span data-stu-id="35e14-159">Orchestrator considerations</span></span>

<span data-ttu-id="35e14-160">Azure Container Service 中提供的每個 Orchestrator 都有它自己的安全性注意事項。</span><span class="sxs-lookup"><span data-stu-id="35e14-160">Each orchestrator available in Azure Container Service has its own security considerations.</span></span> <span data-ttu-id="35e14-161">例如，您應該限制直接 SSH 存取 tooorchestrator 容器服務中的節點。</span><span class="sxs-lookup"><span data-stu-id="35e14-161">For example, you should limit direct SSH access tooorchestrator nodes in Container Service.</span></span> <span data-ttu-id="35e14-162">相反地，您應該使用每個 orchestrator UI 或命令列工具 (例如`kubectl`如 Kubernetes) 沒有存取主機 hello toomanage hello 容器的環境。</span><span class="sxs-lookup"><span data-stu-id="35e14-162">Instead, you should use each orchestrator's UI or command-line tools (such as `kubectl` for Kubernetes) toomanage hello container environment without accessing hello hosts.</span></span> <span data-ttu-id="35e14-163">如需詳細資訊，請參閱[進行遠端連線 tooa Kubernetes、 DC/作業系統，或 Docker Swarm 叢集](../articles/container-service/kubernetes/container-service-connect.md)。</span><span class="sxs-lookup"><span data-stu-id="35e14-163">For more information, see [Make a remote connection tooa Kubernetes, DC/OS, or Docker Swarm cluster](../articles/container-service/kubernetes/container-service-connect.md).</span></span>

<span data-ttu-id="35e14-164">其他 orchestrator 特定安全性資訊，請參閱下列資源的 hello:</span><span class="sxs-lookup"><span data-stu-id="35e14-164">For additional orchestrator-specific security information, see hello following resources:</span></span>

* <span data-ttu-id="35e14-165">**Kubernetes**：[Kubernetes 部署的安全性最佳做法](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html)</span><span class="sxs-lookup"><span data-stu-id="35e14-165">**Kubernetes**: [Security Best Practices for Kubernetes Deployment](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html)</span></span>

* <span data-ttu-id="35e14-166">**DC/OS**：[保護您的叢集](https://dcos.io/docs/1.8/administration/securing-your-cluster/)</span><span class="sxs-lookup"><span data-stu-id="35e14-166">**DC/OS**: [Securing Your Cluster](https://dcos.io/docs/1.8/administration/securing-your-cluster/)</span></span>

* <span data-ttu-id="35e14-167">**Docker Swarm**：[Docker 安全性](https://www.docker.com/docker-security)</span><span class="sxs-lookup"><span data-stu-id="35e14-167">**Docker Swarm**: [Docker Security](https://www.docker.com/docker-security)</span></span>

## <a name="next-steps"></a><span data-ttu-id="35e14-168">後續步驟</span><span class="sxs-lookup"><span data-stu-id="35e14-168">Next steps</span></span>

* <span data-ttu-id="35e14-169">如需 Docker 架構和容器的安全性相關資訊，請參閱[簡介 tooContainer 安全性](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf)。</span><span class="sxs-lookup"><span data-stu-id="35e14-169">For more about Docker architecture and container security, see [Introduction tooContainer Security](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf).</span></span>

* <span data-ttu-id="35e14-170">如需 Azure 平台安全性的資訊，請參閱 hello [Azure 資訊安全中心](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure)。</span><span class="sxs-lookup"><span data-stu-id="35e14-170">For information about Azure platform security, see hello [Azure Security Center](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure).</span></span>
