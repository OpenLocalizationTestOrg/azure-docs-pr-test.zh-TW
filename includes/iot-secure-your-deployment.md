# <a name="secure-your-iot-deployment"></a><span data-ttu-id="b5ec2-101">保護您的 IoT 部署</span><span class="sxs-lookup"><span data-stu-id="b5ec2-101">Secure your IoT deployment</span></span>
<span data-ttu-id="b5ec2-102">本文針對以 Azure IoT 為主的物聯網 (IoT) 基礎結構提供更進一層的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-102">This article provides the next level of detail for securing the Azure IoT-based Internet of Things (IoT) infrastructure.</span></span> <span data-ttu-id="b5ec2-103">它會連結到設定及部署每個元件的實作層級詳細資料。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-103">It links to implementation level details for configuring and deploying each component.</span></span> <span data-ttu-id="b5ec2-104">另外也會提供各種競爭方法之間的比較和選擇。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-104">It also provides comparisons and choices between various competing methods.</span></span>

<span data-ttu-id="b5ec2-105">保護 Azure IoT 部署可分為下列三個安全性區域：</span><span class="sxs-lookup"><span data-stu-id="b5ec2-105">Securing the Azure IoT deployment can be divided into the following three security areas:</span></span>

* <span data-ttu-id="b5ec2-106">**裝置安全性**：在真實世界中部署 IoT 裝置時保護裝置安全。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-106">**Device Security**: Securing the IoT device while it is deployed in the wild.</span></span>
* <span data-ttu-id="b5ec2-107">**連線安全性**︰確保在 IoT 裝置與 IoT 中樞之間傳輸的所有資料均有加密並防止竄改。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-107">**Connection Security**: Ensuring all data transmitted between the IoT device and IoT Hub is confidential and tamper-proof.</span></span>
* <span data-ttu-id="b5ec2-108">**雲端安全性**：提供方法保護資料在雲端移動和儲存的安全性。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-108">**Cloud Security**: Providing a means to secure data while it moves through, and is stored in the cloud.</span></span>

![三個安全性區域][img-overview]

## <a name="secure-device-provisioning-and-authentication"></a><span data-ttu-id="b5ec2-110">保護裝置佈建和驗證</span><span class="sxs-lookup"><span data-stu-id="b5ec2-110">Secure device provisioning and authentication</span></span>
<span data-ttu-id="b5ec2-111">Azure IoT 套件利用下列兩種方法保護 IoT 裝置：</span><span class="sxs-lookup"><span data-stu-id="b5ec2-111">The Azure IoT Suite secures IoT devices by the following two methods:</span></span>

* <span data-ttu-id="b5ec2-112">提供每部裝置唯一識別金鑰 (安全性權杖)，裝置可使用這個金鑰與 IoT 中樞通訊。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-112">By providing a unique identity key (security tokens) for each device, which can be used by the device to communicate with the IoT Hub.</span></span>
* <span data-ttu-id="b5ec2-113">使用裝置上的 [X.509 憑證][lnk-x509]和私密金鑰做為向 IoT 中樞驗證裝置的方法。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-113">By using an on-device [X.509 certificate][lnk-x509] and private key as a means to authenticate the device to the IoT Hub.</span></span> <span data-ttu-id="b5ec2-114">這種驗證方法可在任何時候確保無法從裝置外部知道裝置上的私密金鑰，提供較高的安全性等級。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-114">This authentication method ensures that the private key on the device is not known outside the device at any time, providing a higher level of security.</span></span>

<span data-ttu-id="b5ec2-115">安全性權杖方法藉由將裝置對 IoT 中樞所進行的每個呼叫與對稱金鑰建立關聯，提供每個呼叫的驗證。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-115">The security token method provides authentication for each call made by the device to IoT Hub by associating the symmetric key to each call.</span></span> <span data-ttu-id="b5ec2-116">X.509 型驗證允許實體層 IoT 裝置的驗證做為 TLS 連線建立作業的一部份。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-116">X.509-based authentication allows authentication of an IoT device at the physical layer as part of the TLS connection establishment.</span></span> <span data-ttu-id="b5ec2-117">安全性權杖型方法可不搭配 X.509 驗證使用，該驗證是較不安全的模式。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-117">The security-token-based method can be used without the X.509 authentication which is a less secure pattern.</span></span> <span data-ttu-id="b5ec2-118">這兩種方法的選擇主要取決於裝置驗證所需的安全性有多高，以及裝置上安全存放裝置的可用性 (以安全地儲存私密金鑰)。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-118">The choice between the two methods is primarily dictated by how secure the device authentication needs to be, and availability of secure storage on the device (to store the private key securely).</span></span>

## <a name="iot-hub-security-tokens"></a><span data-ttu-id="b5ec2-119">IoT 中樞安全性權杖</span><span class="sxs-lookup"><span data-stu-id="b5ec2-119">IoT Hub security tokens</span></span>
<span data-ttu-id="b5ec2-120">IoT 中樞使用安全性權杖來驗證裝置和服務，以避免透過網路傳送金鑰。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-120">IoT Hub uses security tokens to authenticate devices and services to avoid sending keys on the network.</span></span> <span data-ttu-id="b5ec2-121">此外，安全性權杖有時效性和範圍的限制。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-121">Additionally, security tokens are limited in time validity and scope.</span></span> <span data-ttu-id="b5ec2-122">Azure IoT SDK 能在不需要任何特殊組態的情況下自動產生權杖。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-122">Azure IoT SDKs automatically generate tokens without requiring any special configuration.</span></span> <span data-ttu-id="b5ec2-123">不過在某些案例中，使用者必須直接產生及使用安全性權杖。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-123">Some scenarios, however, require the user to generate and use security tokens directly.</span></span> <span data-ttu-id="b5ec2-124">這些案例包括直接使用 MQTT、AMQP 或 HTTP 介面，或實作權杖服務模式。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-124">These include the direct use of the MQTT, AMQP, or HTTP surfaces, or the implementation of the token service pattern.</span></span>

<span data-ttu-id="b5ec2-125">如需安全性權杖的結構與其用法的詳細資料，請參閱下列文章：</span><span class="sxs-lookup"><span data-stu-id="b5ec2-125">More details on the structure of the security token and its usage can be found in the following articles:</span></span>

* <span data-ttu-id="b5ec2-126">[安全性權杖結構][lnk-security-tokens]</span><span class="sxs-lookup"><span data-stu-id="b5ec2-126">[Security token structure][lnk-security-tokens]</span></span>
* <span data-ttu-id="b5ec2-127">[將 SAS 權杖當做裝置][lnk-sas-tokens]</span><span class="sxs-lookup"><span data-stu-id="b5ec2-127">[Using SAS tokens as a device][lnk-sas-tokens]</span></span>

<span data-ttu-id="b5ec2-128">每個 IoT 中樞都有一個[身分識別登錄][lnk-identity-registry]，可用來在服務中建立各裝置的資源 (例如含有傳送中雲端到裝置訊息的佇列)，以及允許存取裝置面向端點。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-128">Each IoT Hub has an [identity registry][lnk-identity-registry] that can be used to create per-device resources in the service, such as a queue that contains in-flight cloud-to-device messages, and to allow access to the device-facing endpoints.</span></span> <span data-ttu-id="b5ec2-129">IoT 中樞身分識別登錄會針對方案，為裝置身分識別和安全性金鑰提供安全的儲存體。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-129">The IoT Hub identity registry provides secure storage of device identities and security keys for a solution.</span></span> <span data-ttu-id="b5ec2-130">個別或群組的裝置身分識別可以新增到允許的清單或封鎖清單，以便完整控制裝置存取。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-130">Individual or groups of device identities can be added to an allow list, or a block list, enabling complete control over device access.</span></span> <span data-ttu-id="b5ec2-131">下列文章提供身分識別登錄結構和所支援作業的更詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-131">The following articles provide more details on the structure of the identity registry and supported operations.</span></span>

<span data-ttu-id="b5ec2-132">[IoT 中樞支援 MQTT、AMQP 和 HTTP][lnk-protocols] 之類的通訊協定。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-132">[IoT Hub supports protocols such as MQTT, AMQP, and HTTP][lnk-protocols].</span></span> <span data-ttu-id="b5ec2-133">這些通訊協定會各自以不同的方式使用 IoT 裝置到 IoT 中樞的安全性權杖：</span><span class="sxs-lookup"><span data-stu-id="b5ec2-133">Each of these protocols use security tokens from the IoT device to IoT Hub differently:</span></span>

* <span data-ttu-id="b5ec2-134">AMQP：SASL PLAIN 和 AMQP 宣告式安全性 (如果是 IoT 中樞層級權杖時為 {policyName}@sas.root.{iothubName}；如果是裝置範圍權杖時為 {deviceId})。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-134">AMQP: SASL PLAIN and AMQP Claims-based security ({policyName}@sas.root.{iothubName} in the case of IoT hub-level tokens; {deviceId} in case of device-scoped tokens).</span></span>
* <span data-ttu-id="b5ec2-135">MQTT: CONNECT 封包使用 {deviceId} 做為 {ClientId}，在 [使用者名稱] 欄位中具有 {IoThubhostname}/{deviceId}，在 [密碼] 欄位中具有 SAS 權杖。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-135">MQTT: CONNECT packet uses {deviceId} as the {ClientId}, {IoThubhostname}/{deviceId} in the **Username** field and a SAS token in the **Password** field.</span></span>
* <span data-ttu-id="b5ec2-136">HTTP︰有效權杖位於驗證要求標頭中。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-136">HTTP: Valid token is in the authorization request header.</span></span>

<span data-ttu-id="b5ec2-137">IoT 中樞身分識別登錄可用來設定每一裝置的安全性認證和存取控制。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-137">IoT Hub identity registry can be used to configure per-device security credentials and access control.</span></span> <span data-ttu-id="b5ec2-138">但是，如果 IoT 解決方案已經大幅投資[自訂裝置身分識別登錄及/或驗證配置][lnk-custom-auth]，則可藉由建立權杖服務，將現有基礎結構與 IoT 中樞整合。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-138">However, if an IoT solution already has a significant investment in a [custom device identity registry and/or authentication scheme][lnk-custom-auth], it can be integrated into an existing infrastructure with IoT Hub by creating a token service.</span></span>

### <a name="x509-certificate-based-device-authentication"></a><span data-ttu-id="b5ec2-139">X.509 憑證型裝置驗證</span><span class="sxs-lookup"><span data-stu-id="b5ec2-139">X.509 certificate-based device authentication</span></span>
<span data-ttu-id="b5ec2-140">使用[裝置型 X.509 憑證][lnk-use-x509]與其相關聯的私密和公用金鑰組，就可在實體層提供額外驗證。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-140">The use of a [device-based X.509 certificate][lnk-use-x509] and its associated private and public key pair allows additional authentication at the physical layer.</span></span> <span data-ttu-id="b5ec2-141">私密金鑰安全地儲存在裝置中，並且無法從裝置外部探索。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-141">The private key is stored securely in the device and is not discoverable outside the device.</span></span> <span data-ttu-id="b5ec2-142">X.509 憑證包含裝置的相關資訊，例如裝置識別碼和其他與組織有關的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-142">The X.509 certificate contains information about the device, such as device ID, and other organizational details.</span></span> <span data-ttu-id="b5ec2-143">憑證的簽章是使用私密金鑰來產生。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-143">A signature of the certificate is generated by using the private key.</span></span>

<span data-ttu-id="b5ec2-144">高層級裝置佈建流程：</span><span class="sxs-lookup"><span data-stu-id="b5ec2-144">High-level device provisioning flow:</span></span>

* <span data-ttu-id="b5ec2-145">將識別碼與實體裝置建立關聯 – 在裝置的製造或是委任期間，將裝置身分識別和/或 X.509 憑證與裝置建立關聯。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-145">Associate an identifier to a physical device – device identity and/or X.509 certificate associated to the device during device manufacturing or commissioning.</span></span>
* <span data-ttu-id="b5ec2-146">在 IoT 中樞建立相對應的身分識別項目 - IoT 中樞身分識別登錄中的裝置身分識別與相關聯的裝置資訊。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-146">Create a corresponding identity entry in IoT Hub – device identity and associated device information in the IoT Hub identity registry.</span></span>
* <span data-ttu-id="b5ec2-147">在 IoT 中樞身分識別登錄中安全地儲存 X.509 憑證指紋。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-147">Securely store X.509 certificate thumbprint in IoT Hub identity registry.</span></span>

### <a name="root-certificate-on-device"></a><span data-ttu-id="b5ec2-148">裝置上的根憑證</span><span class="sxs-lookup"><span data-stu-id="b5ec2-148">Root certificate on device</span></span>
<span data-ttu-id="b5ec2-149">使用 IoT 中樞建立安全的 TLS 連線時， IoT 裝置會使用裝置 SDK 中的根憑證驗證 IoT 中樞。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-149">While establishing a secure TLS connection with IoT Hub, the IoT device authenticates IoT Hub using a root certificate which is part of the device SDK.</span></span> <span data-ttu-id="b5ec2-150">針對 C 用戶端 SDK，憑證位於儲存機制根目錄底下的 "\\c\\certs" 資料夾。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-150">For the C client SDK the certificate is located under the folder "\\c\\certs" under the root of the repo.</span></span> <span data-ttu-id="b5ec2-151">雖然這些根憑證是長效的，但它們仍會過期或遭到撤銷。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-151">Though these root certificates are long-lived, they still may expire or be revoked.</span></span> <span data-ttu-id="b5ec2-152">如果沒有方法更新裝置上的憑證，裝置可能就無法再連線到 IoT 中樞 (或任何其他雲端服務)。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-152">If there is no way of updating the certificate on the device, the device may not be able to subsequently connect to the IoT Hub (or any other cloud service).</span></span> <span data-ttu-id="b5ec2-153">在 IoT 裝置部署後提供更新根憑證的方法，會有效地降低此風險。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-153">Having a means to update the root certificate once the IoT device is deployed will effectively mitigate this risk.</span></span>

## <a name="securing-the-connection"></a><span data-ttu-id="b5ec2-154">保護連線安全</span><span class="sxs-lookup"><span data-stu-id="b5ec2-154">Securing the connection</span></span>
<span data-ttu-id="b5ec2-155">IoT 裝置與 IoT 中樞之間的網際網路連線，是使用傳輸層安全性 (TLS) 標準進行保護。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-155">Internet connection between the IoT device and IoT Hub is secured using the Transport Layer Security (TLS) standard.</span></span> <span data-ttu-id="b5ec2-156">Azure IoT 支援 [TLS 1.2][lnk-tls12]、TLS 1.1 和 TLS 1.0 (依此順序)。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-156">Azure IoT supports [TLS 1.2][lnk-tls12], TLS 1.1 and TLS 1.0, in this order.</span></span> <span data-ttu-id="b5ec2-157">針對 TLS 1.0 的支援僅為提供回溯相容性。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-157">Support for TLS 1.0 is provided for backward compatibility only.</span></span> <span data-ttu-id="b5ec2-158">建議使用 TLS 1.2，因為它提供最高的安全性。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-158">It is recommended to use TLS 1.2 since it provides the most security.</span></span>

<span data-ttu-id="b5ec2-159">Azure IoT 套件支援下列加密套件 (依此順序)。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-159">Azure IoT Suite supports the following Cipher Suites, in this order.</span></span>

| <span data-ttu-id="b5ec2-160">加密套件</span><span class="sxs-lookup"><span data-stu-id="b5ec2-160">Cipher Suite</span></span> | <span data-ttu-id="b5ec2-161">長度</span><span class="sxs-lookup"><span data-stu-id="b5ec2-161">Length</span></span> |
| --- | --- |
| <span data-ttu-id="b5ec2-162">TLS\_ECDHE\_RSA\_WITH\_AES\_256\_CBC\_SHA384 (0xc028) ECDH secp384r1 (相等於</span><span class="sxs-lookup"><span data-stu-id="b5ec2-162">TLS\_ECDHE\_RSA\_WITH\_AES\_256\_CBC\_SHA384 (0xc028) ECDH secp384r1 (eq.</span></span> <span data-ttu-id="b5ec2-163">7680 位元 RSA) FS</span><span class="sxs-lookup"><span data-stu-id="b5ec2-163">7680 bits RSA) FS</span></span> |<span data-ttu-id="b5ec2-164">256</span><span class="sxs-lookup"><span data-stu-id="b5ec2-164">256</span></span> |
| <span data-ttu-id="b5ec2-165">TLS\_ECDHE\_RSA\_WITH\_AES\_128\_CBC\_SHA256 (0xc027) ECDH secp256r1 (相等於</span><span class="sxs-lookup"><span data-stu-id="b5ec2-165">TLS\_ECDHE\_RSA\_WITH\_AES\_128\_CBC\_SHA256 (0xc027) ECDH secp256r1 (eq.</span></span> <span data-ttu-id="b5ec2-166">3072 位元 RSA) FS</span><span class="sxs-lookup"><span data-stu-id="b5ec2-166">3072 bits RSA) FS</span></span> |<span data-ttu-id="b5ec2-167">128</span><span class="sxs-lookup"><span data-stu-id="b5ec2-167">128</span></span> |
| <span data-ttu-id="b5ec2-168">TLS\_ECDHE\_RSA\_WITH\_AES\_256\_CBC\_SHA (0xc014) ECDH secp384r1 (相等於</span><span class="sxs-lookup"><span data-stu-id="b5ec2-168">TLS\_ECDHE\_RSA\_WITH\_AES\_256\_CBC\_SHA (0xc014) ECDH secp384r1 (eq.</span></span> <span data-ttu-id="b5ec2-169">7680 位元 RSA) FS</span><span class="sxs-lookup"><span data-stu-id="b5ec2-169">7680 bits RSA) FS</span></span> |<span data-ttu-id="b5ec2-170">256</span><span class="sxs-lookup"><span data-stu-id="b5ec2-170">256</span></span> |
| <span data-ttu-id="b5ec2-171">TLS\_ECDHE\_RSA\_WITH\_AES\_128\_CBC\_SHA (0xc013) ECDH secp256r1 (相等於</span><span class="sxs-lookup"><span data-stu-id="b5ec2-171">TLS\_ECDHE\_RSA\_WITH\_AES\_128\_CBC\_SHA (0xc013) ECDH secp256r1 (eq.</span></span> <span data-ttu-id="b5ec2-172">3072 位元 RSA) FS</span><span class="sxs-lookup"><span data-stu-id="b5ec2-172">3072 bits RSA) FS</span></span> |<span data-ttu-id="b5ec2-173">128</span><span class="sxs-lookup"><span data-stu-id="b5ec2-173">128</span></span> |
| <span data-ttu-id="b5ec2-174">TLS\_RSA\_WITH\_AES\_256\_GCM\_SHA384 (0x9d)</span><span class="sxs-lookup"><span data-stu-id="b5ec2-174">TLS\_RSA\_WITH\_AES\_256\_GCM\_SHA384 (0x9d)</span></span> |<span data-ttu-id="b5ec2-175">256</span><span class="sxs-lookup"><span data-stu-id="b5ec2-175">256</span></span> |
| <span data-ttu-id="b5ec2-176">TLS\_RSA\_WITH\_AES\_128\_GCM\_SHA256 (0x9c)</span><span class="sxs-lookup"><span data-stu-id="b5ec2-176">TLS\_RSA\_WITH\_AES\_128\_GCM\_SHA256 (0x9c)</span></span> |<span data-ttu-id="b5ec2-177">128</span><span class="sxs-lookup"><span data-stu-id="b5ec2-177">128</span></span> |
| <span data-ttu-id="b5ec2-178">TLS\_RSA\_WITH\_AES\_256\_CBC\_SHA256 (0x3d)</span><span class="sxs-lookup"><span data-stu-id="b5ec2-178">TLS\_RSA\_WITH\_AES\_256\_CBC\_SHA256 (0x3d)</span></span> |<span data-ttu-id="b5ec2-179">256</span><span class="sxs-lookup"><span data-stu-id="b5ec2-179">256</span></span> |
| <span data-ttu-id="b5ec2-180">TLS\_RSA\_WITH\_AES\_128\_CBC\_SHA256 (0x3c)</span><span class="sxs-lookup"><span data-stu-id="b5ec2-180">TLS\_RSA\_WITH\_AES\_128\_CBC\_SHA256 (0x3c)</span></span> |<span data-ttu-id="b5ec2-181">128</span><span class="sxs-lookup"><span data-stu-id="b5ec2-181">128</span></span> |
| <span data-ttu-id="b5ec2-182">TLS\_RSA\_WITH\_AES\_256\_CBC\_SHA (0x35)</span><span class="sxs-lookup"><span data-stu-id="b5ec2-182">TLS\_RSA\_WITH\_AES\_256\_CBC\_SHA (0x35)</span></span> |<span data-ttu-id="b5ec2-183">256</span><span class="sxs-lookup"><span data-stu-id="b5ec2-183">256</span></span> |
| <span data-ttu-id="b5ec2-184">TLS\_RSA\_WITH\_AES\_128\_CBC\_SHA (0x2f)</span><span class="sxs-lookup"><span data-stu-id="b5ec2-184">TLS\_RSA\_WITH\_AES\_128\_CBC\_SHA (0x2f)</span></span> |<span data-ttu-id="b5ec2-185">128</span><span class="sxs-lookup"><span data-stu-id="b5ec2-185">128</span></span> |
| <span data-ttu-id="b5ec2-186">TLS\_RSA\_WITH\_3DES\_EDE\_CBC\_SHA (0xa)</span><span class="sxs-lookup"><span data-stu-id="b5ec2-186">TLS\_RSA\_WITH\_3DES\_EDE\_CBC\_SHA (0xa)</span></span> |<span data-ttu-id="b5ec2-187">112</span><span class="sxs-lookup"><span data-stu-id="b5ec2-187">112</span></span> |

## <a name="securing-the-cloud"></a><span data-ttu-id="b5ec2-188">保護雲端</span><span class="sxs-lookup"><span data-stu-id="b5ec2-188">Securing the cloud</span></span>
<span data-ttu-id="b5ec2-189">Azure IoT 中樞允許針對每個安全性金鑰定義[存取控制原則][lnk-protocols]。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-189">Azure IoT Hub allows definition of [access control policies][lnk-protocols] for each security key.</span></span> <span data-ttu-id="b5ec2-190">它使用下列權限組，授與每個 IoT 中樞端點的存取權。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-190">It uses the following set of permissions to grant access to each of IoT Hub's endpoints.</span></span> <span data-ttu-id="b5ec2-191">權限可根據功能限制 IoT 中樞的存取權。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-191">Permissions limit the access to an IoT Hub based on functionality.</span></span>

* <span data-ttu-id="b5ec2-192">**RegistryRead**。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-192">**RegistryRead**.</span></span> <span data-ttu-id="b5ec2-193">為身分識別登錄授與讀取權限。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-193">Grants read access to the identity registry.</span></span> <span data-ttu-id="b5ec2-194">如需詳細資訊，請參閱[身分識別登錄][lnk-identity-registry]。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-194">For more information, see [identity registry][lnk-identity-registry].</span></span>
* <span data-ttu-id="b5ec2-195">**RegistryReadWrite**。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-195">**RegistryReadWrite**.</span></span> <span data-ttu-id="b5ec2-196">為身分識別登錄授與讀取和寫入權限。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-196">Grants read and write access to the identity registry.</span></span> <span data-ttu-id="b5ec2-197">如需詳細資訊，請參閱[身分識別登錄][lnk-identity-registry]。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-197">For more information, see [identity registry][lnk-identity-registry].</span></span>
* <span data-ttu-id="b5ec2-198">**ServiceConnect**。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-198">**ServiceConnect**.</span></span> <span data-ttu-id="b5ec2-199">授與雲端服務面向通訊和監視端點的存取權。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-199">Grants access to cloud service-facing communication and monitoring endpoints.</span></span> <span data-ttu-id="b5ec2-200">例如，它授權後端雲端服務接收裝置到雲端的訊息、傳送雲端到裝置的訊息，以及擷取相對應的傳遞通知。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-200">For example, it grants permission to back-end cloud services to receive device-to-cloud messages, send cloud-to-device messages, and retrieve the corresponding delivery acknowledgments.</span></span>
* <span data-ttu-id="b5ec2-201">**DeviceConnect**。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-201">**DeviceConnect**.</span></span> <span data-ttu-id="b5ec2-202">授與裝置面向端點的存取權。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-202">Grants access to device-facing endpoints.</span></span> <span data-ttu-id="b5ec2-203">例如，它會授與傳送裝置到雲端的訊息和接收雲端到裝置的訊息的權限。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-203">For example, it grants permission to send device-to-cloud messages and receive cloud-to-device messages.</span></span> <span data-ttu-id="b5ec2-204">裝置會使用此權限。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-204">This permission is used by devices.</span></span>

<span data-ttu-id="b5ec2-205">利用[安全性權杖][lnk-sas-tokens]取得 IoT 中樞之 **DeviceConnect** 權限的方法有兩種：使用裝置身分識別金鑰，或使用共用存取金鑰。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-205">There are two ways to obtain **DeviceConnect** permissions with IoT Hub with [security tokens][lnk-sas-tokens]: using a device identity key, or a shared access key.</span></span> <span data-ttu-id="b5ec2-206">此外，請務必注意所有可從裝置存取的功能，在設計上會於前置詞為 `/devices/{deviceId}`的端點公開。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-206">Moreover, it is important to note that all functionality accessible from devices is exposed by design on endpoints with prefix `/devices/{deviceId}`.</span></span>

<span data-ttu-id="b5ec2-207">服務元件只能使用授與適當權限的共用存取原則來[產生安全性權杖][lnk-service-tokens]。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-207">[Service components can only generate security tokens][lnk-service-tokens] using shared access policies granting the appropriate permissions.</span></span>

<span data-ttu-id="b5ec2-208">Azure IoT 中樞和可能是解決方案一部份的其他服務，允許使用 Azure Active Directory 管理使用者。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-208">Azure IoT Hub and other services which may be part of the solution allow management of users using the Azure Active Directory.</span></span>

<span data-ttu-id="b5ec2-209">由 Azure IoT 中樞內嵌的資料可供各種不同服務使用，例如 Azure 串流分析和 Azure Blob 儲存體。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-209">Data ingested by Azure IoT Hub can be consumed by a variety of services such as Azure Stream Analytics and Azure blob storage.</span></span> <span data-ttu-id="b5ec2-210">這些服務允許管理存取。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-210">These services allow management access.</span></span> <span data-ttu-id="b5ec2-211">在下面深入了解這些服務和可用選項：</span><span class="sxs-lookup"><span data-stu-id="b5ec2-211">Read more about these services and available options below:</span></span>

* <span data-ttu-id="b5ec2-212">[Azure DocumentDB][lnk-docdb]：可調整且已完全編製索引的資料庫服務，適用於半結構化資料，可管理您所佈建裝置的中繼資料，例如，屬性、組態及安全性內容。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-212">[Azure DocumentDB][lnk-docdb]: A scalable, fully-indexed database service for semi-structured data that manages metadata for the devices you provision, such as attributes, configuration, and security properties.</span></span> <span data-ttu-id="b5ec2-213">DocumentDB 提供高效能且高輸送量的處理、無從驗證結構描述且編製索引的資料，以及豐富的 SQL 查詢介面。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-213">DocumentDB offers high-performance and high-throughput processing, schema-agnostic indexing of data, and a rich SQL query interface.</span></span>
* <span data-ttu-id="b5ec2-214">[Azure 串流分析][lnk-asa]：雲端中處理的即時串流讓您能夠快速開發並部署低成本的分析方案，以在第一時間提供裝置、感應器、基礎結構與應用程式的深入剖析資料。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-214">[Azure Stream Analytics][lnk-asa]: Real-time stream processing in the cloud that enables you to rapidly develop and deploy a low-cost analytics solution to uncover real-time insights from devices, sensors, infrastructure, and applications.</span></span> <span data-ttu-id="b5ec2-215">來自這個完全受管理服務的資料可調整為任何數量，但仍可達到高輸送量、低遲性和恢復功能。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-215">The data from this fully-managed service can scale to any volume while still achieving high throughput, low latency, and resiliency.</span></span>
* <span data-ttu-id="b5ec2-216">[Azure App Service][lnk-appservices]：一個雲端平台，可供建置功能強大的 Web 和行動應用程式來連接各地的資料；不論是在雲端還是內部部署環境內。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-216">[Azure App Services][lnk-appservices]: A cloud platform to build powerful web and mobile apps that connect to data anywhere; in the cloud or on-premises.</span></span> <span data-ttu-id="b5ec2-217">建置吸引客戶參與的 iOS、Android 和 Windows 版行動應用程式。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-217">Build engaging mobile apps for iOS, Android, and Windows.</span></span> <span data-ttu-id="b5ec2-218">與軟體即服務 (SaaS) 和企業應用程式整合，讓您能夠立即連線到數十種雲端服務和企業應用程式。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-218">Integrate with your Software as a Service (SaaS) and enterprise applications with out-of-the-box connectivity to dozens of cloud-based services and enterprise applications.</span></span> <span data-ttu-id="b5ec2-219">使用您愛用的語言 (.NET、Node.JS、PHP、Python 或 Java) 和整合式開發環境 (IDE) 撰寫程式碼，以前所未有的速度建置 Web 應用程式和 API。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-219">Code in your favorite language and IDE (.NET, Node.js, PHP, Python, or Java) to build web apps and APIs faster than ever.</span></span>
* <span data-ttu-id="b5ec2-220">[Logic Apps][lnk-logicapps]：Azure App Service 的 Logic Apps 功能可協助您將 IoT 解決方案整合到現有的企業營運系統並自動化工作流程處理。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-220">[Logic Apps][lnk-logicapps]: The Logic Apps feature of Azure App Service helps integrate your IoT solution to your existing line-of-business systems and automate workflow processes.</span></span> <span data-ttu-id="b5ec2-221">Logic Apps 可讓開發人員設計從觸發程序開始，然後執行一系列步驟的工作流程 — 使用功能強大的連接器來與您的商務程序整合的規則和動作。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-221">Logic Apps enables developers to design workflows that start from a trigger and then execute a series of steps—rules and actions that use powerful connectors to integrate with your business processes.</span></span> <span data-ttu-id="b5ec2-222">Logic Apps 提供與 SaaS、雲端架構及內部部署應用程式的廣大生態系統的即時連接。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-222">Logic Apps offers out-of-the-box connectivity to a vast ecosystem of SaaS, cloud-based, and on-premises applications.</span></span>
* <span data-ttu-id="b5ec2-223">[Azure Blob 儲存體][lnk-blob]：可靠且符合經濟效益的雲端儲存體，適用於裝置要傳送到雲端的資料。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-223">[Azure blob storage][lnk-blob]: Reliable, economical cloud storage for the data that your devices send to the cloud.</span></span>

## <a name="conclusion"></a><span data-ttu-id="b5ec2-224">結論</span><span class="sxs-lookup"><span data-stu-id="b5ec2-224">Conclusion</span></span>
<span data-ttu-id="b5ec2-225">本文提供使用 Azure IoT 設計和部署 IoT 基礎結構的實作層級詳細資料概觀。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-225">This article provides overview of implementation level details for designing and deploying an IoT infrastructure using Azure IoT.</span></span> <span data-ttu-id="b5ec2-226">設定每個元件的安全保護，對於保護整體 IoT 基礎結構非常重要。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-226">Configuring each component to be secure is key in securing the overall IoT infrastructure.</span></span> <span data-ttu-id="b5ec2-227">Azure IoT 中可用的設計選項提供了某種程度的彈性和選擇 ；不過，每個選擇都可能會影響安全性。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-227">The design choices available in Azure IoT provide some level of flexibility and choice; however, each choice may have security implications.</span></span> <span data-ttu-id="b5ec2-228">建議您透過風險/成本評估謹慎評估每個選擇。</span><span class="sxs-lookup"><span data-stu-id="b5ec2-228">It is recommended that each of these choices be evaluated through a risk/cost assessment.</span></span>

[img-overview]: media/iot-secure-your-deployment/overview.png

[lnk-security-tokens]: ../articles/iot-hub/iot-hub-devguide-security.md#security-token-structure
[lnk-sas-tokens]: ../articles/iot-hub/iot-hub-devguide-security.md#use-sas-tokens-in-a-device-app
[lnk-identity-registry]: ../articles/iot-hub/iot-hub-devguide-identity-registry.md
[lnk-protocols]: ../articles/iot-hub/iot-hub-devguide-security.md
[lnk-custom-auth]: ../articles/iot-hub/iot-hub-devguide-security.md#custom-device-authentication
[lnk-x509]: http://www.itu.int/rec/T-REC-X.509-201210-I/en
[lnk-use-x509]: ../articles/iot-hub/iot-hub-devguide-security.md
[lnk-tls12]: https://tools.ietf.org/html/rfc5246
[lnk-service-tokens]: ../articles/iot-hub/iot-hub-devguide-security.md#use-security-tokens-from-service-components
[lnk-docdb]: https://azure.microsoft.com/services/documentdb/
[lnk-asa]: https://azure.microsoft.com/services/stream-analytics/
[lnk-appservices]: https://azure.microsoft.com/services/app-service/
[lnk-logicapps]: https://azure.microsoft.com/services/app-service/logic/
[lnk-blob]: https://azure.microsoft.com/services/storage/
