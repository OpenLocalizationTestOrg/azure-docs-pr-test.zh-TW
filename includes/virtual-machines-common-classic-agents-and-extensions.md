

<span data-ttu-id="193d5-101">VM 擴充功能可協助您：</span><span class="sxs-lookup"><span data-stu-id="193d5-101">VM extensions can help you:</span></span>

* <span data-ttu-id="193d5-102">修改安全性與身分識別的功能，例如重設帳戶值和使用反惡意程式碼</span><span class="sxs-lookup"><span data-stu-id="193d5-102">Modify security and identity features, such as resetting account values and using antimalware</span></span>
* <span data-ttu-id="193d5-103">啟動、停止或設定監視和診斷</span><span class="sxs-lookup"><span data-stu-id="193d5-103">Start, stop, or configure monitoring and diagnostics</span></span>
* <span data-ttu-id="193d5-104">重設或安裝連線功能，例如 RDP 和 SSH</span><span class="sxs-lookup"><span data-stu-id="193d5-104">Reset or install connectivity features, such as RDP and SSH</span></span>
* <span data-ttu-id="193d5-105">診斷、監視和管理您的 VM</span><span class="sxs-lookup"><span data-stu-id="193d5-105">Diagnose, monitor, and manage your VMs</span></span>

<span data-ttu-id="193d5-106">也有許多其他功能。</span><span class="sxs-lookup"><span data-stu-id="193d5-106">There are many other features as well.</span></span> <span data-ttu-id="193d5-107">會定期發行新的 VM 擴充功能。</span><span class="sxs-lookup"><span data-stu-id="193d5-107">New VM Extension features are released regularly.</span></span> <span data-ttu-id="193d5-108">這篇文章描述 Windows 和 Linux 的 Azure VM 代理程式，以及它們如何支援 VM 擴充功能。</span><span class="sxs-lookup"><span data-stu-id="193d5-108">This article describes the Azure VM Agents for Windows and Linux, and how they support VM Extension functionality.</span></span> <span data-ttu-id="193d5-109">如需依功能分類的 VM 延伸模組清單，請參閱 [Azure VM 延伸模組與功能](../articles/virtual-machines/windows/extensions-features.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)。</span><span class="sxs-lookup"><span data-stu-id="193d5-109">For a listing of VM Extensions by feature category, see [Azure VM Extensions and Features](../articles/virtual-machines/windows/extensions-features.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

## <a name="azure-vm-agents-for-windows-and-linux"></a><span data-ttu-id="193d5-110">適用於 Windows 和 Linux 的 Azure VM 代理程式</span><span class="sxs-lookup"><span data-stu-id="193d5-110">Azure VM Agents for Windows and Linux</span></span>
<span data-ttu-id="193d5-111">Azure 虛擬機器代理程式 (VM 代理程式) 是一個安全、輕量級程序，它會安裝、設定和移除 Azure 虛擬機器執行個體上的 VM 擴充功能。</span><span class="sxs-lookup"><span data-stu-id="193d5-111">The Azure Virtual Machines Agent (VM Agent) is a secured, light-weight process that installs, configures, and removes VM extensions on instances of Azure Virtual Machines.</span></span> <span data-ttu-id="193d5-112">VM 代理程式會做為 Azure VM 的安全本機控制服務。</span><span class="sxs-lookup"><span data-stu-id="193d5-112">The VM Agent acts as the secure local control service for your Azure VM.</span></span> <span data-ttu-id="193d5-113">代理程式載入的擴充功能提供特定功能，以提升使用執行個體時的產能。</span><span class="sxs-lookup"><span data-stu-id="193d5-113">The extensions that the agent loads provide specific features to increase your productivity using the instance.</span></span>

<span data-ttu-id="193d5-114">有兩個 Azure VM 代理程式存在，一個適用於 Windows VM，一個適用於 Linux VM。</span><span class="sxs-lookup"><span data-stu-id="193d5-114">Two Azure VM Agents exist, one for Windows VMs and one for Linux VMs.</span></span>

<span data-ttu-id="193d5-115">如果您想要讓虛擬機器執行個體使用一或多個 VM 擴充功能，執行個體必須安裝 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="193d5-115">If you want a virtual machine instance to use one or more VM extensions, the instance must have an installed VM Agent.</span></span> <span data-ttu-id="193d5-116">藉由使用 Azure 入口網站和來自 **Marketplace** 之映像所建立的虛擬機器映像，會在建立程序中自動安裝 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="193d5-116">A virtual machine image created by using the Azure portal and an image from the **Marketplace** automatically installs a VM Agent in the creation process.</span></span> <span data-ttu-id="193d5-117">如果虛擬機器執行個體沒有 VM 代理程式，您可以在建立虛擬機器執行個體之後安裝 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="193d5-117">If a virtual machine instance lacks a VM Agent, you can install the VM Agent after the virtual machine instance is created.</span></span> <span data-ttu-id="193d5-118">或者，您可以在您稍後上傳的自訂 VM 映像中安裝代理程式。</span><span class="sxs-lookup"><span data-stu-id="193d5-118">Or, you can install the agent in a custom VM image that you then upload.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="193d5-119">這些 VM 代理程式非常精簡的服務，能夠進行虛擬機器執行個體的安全管理。</span><span class="sxs-lookup"><span data-stu-id="193d5-119">These VM Agents are very light-weight, services that enable secured administration of virtual machine instances.</span></span> <span data-ttu-id="193d5-120">有些情況下您可能不想使用 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="193d5-120">There might be cases in which you do not want the VM Agent.</span></span> <span data-ttu-id="193d5-121">若是如此，請務必建立不會使用 Azure CLI 或 PowerShell 安裝 VM 代理程式的 VM。</span><span class="sxs-lookup"><span data-stu-id="193d5-121">If so, be sure to create VMs that do not have the VM Agent installed using the Azure CLI or PowerShell.</span></span> <span data-ttu-id="193d5-122">雖然可以實際移除 VM 代理程式，但是執行個體上的 VM 擴充功能的行為並未定義。</span><span class="sxs-lookup"><span data-stu-id="193d5-122">Although the VM Agent can be removed physically, the behavior of VM Extensions on the instance is undefined.</span></span> <span data-ttu-id="193d5-123">因此，不支援移除已安裝的 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="193d5-123">As a result, removing an installed VM Agent is not supported.</span></span>
>

<span data-ttu-id="193d5-124">在下列情況下會啟用 VM 代理程式：</span><span class="sxs-lookup"><span data-stu-id="193d5-124">The VM Agent is enabled in the following situations:</span></span>

* <span data-ttu-id="193d5-125">當您使用 Azure 入口網站和從 **Marketplace** 選取映像來建立 VM 的執行個體時，</span><span class="sxs-lookup"><span data-stu-id="193d5-125">When you create an instance of a VM by using the Azure portal and selecting an image from the **Marketplace**,</span></span>
* <span data-ttu-id="193d5-126">當您使用 [New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx) 或 [New-AzureQuickVM](https://msdn.microsoft.com/library/azure/dn495183.aspx) Cmdlet 來建立 VM 的執行個體時。</span><span class="sxs-lookup"><span data-stu-id="193d5-126">When you create an instance of a VM by using the [New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx) or the [New-AzureQuickVM](https://msdn.microsoft.com/library/azure/dn495183.aspx) cmdlet.</span></span> <span data-ttu-id="193d5-127">您可以藉由將 **–DisableGuestAgent** 參數新增至 [Add-AzureProvisioningConfig](https://msdn.microsoft.com/library/azure/dn495299.aspx) Cmdlet，來建立沒有 VM 代理程式的 VM。</span><span class="sxs-lookup"><span data-stu-id="193d5-127">You can create a VM without a VM Agent by adding the **–DisableGuestAgent** parameter to the [Add-AzureProvisioningConfig](https://msdn.microsoft.com/library/azure/dn495299.aspx) cmdlet,</span></span>

* <span data-ttu-id="193d5-128">當您在現有 VM 執行個體上手動下載並安裝 VM 代理程式時，將 **ProvisionGuestAgent** 值設定為 **true**。</span><span class="sxs-lookup"><span data-stu-id="193d5-128">When you manually download and install the VM Agent on an existing VM instance, and set the **ProvisionGuestAgent** value to **true**.</span></span> <span data-ttu-id="193d5-129">您可以藉由使用 PowerShell 命令或 REST 呼叫，針對 Windows 和 Linux 代理程式使用這項技術。</span><span class="sxs-lookup"><span data-stu-id="193d5-129">You can use this technique for Windows and Linux agents, by using a PowerShell command or a REST call.</span></span> <span data-ttu-id="193d5-130">(如果您以手動方式安裝 VM 代理程式之後未設定 **ProvisionGuestAgent** 值，則不會正確偵測到新增 VM 代理程式。)下列程式碼範例示範如何使用 PowerShell 執行此動作，其中 `$svc` 和 `$name` 引數都已經確定：</span><span class="sxs-lookup"><span data-stu-id="193d5-130">(If you do not set the **ProvisionGuestAgent** value after manually installing the VM Agent, the addition of the VM Agent is not detected properly.) The following code example shows how to do this using PowerShell where the `$svc` and `$name` arguments have already been determined:</span></span>

      $vm = Get-AzureVM –ServiceName $svc –Name $name
      $vm.VM.ProvisionGuestAgent = $TRUE
      Update-AzureVM –Name $name –VM $vm.VM –ServiceName $svc

* <span data-ttu-id="193d5-131">當您建立 VM 映像時，會包含已安裝的 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="193d5-131">When you create a VM image that includes an installed VM Agent.</span></span> <span data-ttu-id="193d5-132">一旦具有 VM 代理程式的映像存在，您可以將該映像上傳至 Azure。</span><span class="sxs-lookup"><span data-stu-id="193d5-132">Once the image with the VM Agent exists, you can upload that image to Azure.</span></span> <span data-ttu-id="193d5-133">若為 Windows VM，請下載 [Windows VM Agent.msi 檔案](http://go.microsoft.com/fwlink/?LinkID=394789) ，然後安裝 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="193d5-133">For a Windows VM, download the [Windows VM Agent .msi file](http://go.microsoft.com/fwlink/?LinkID=394789) and install the VM Agent.</span></span> <span data-ttu-id="193d5-134">若為 Linux VM，從位於 <https://github.com/Azure/WALinuxAgent> 的 GitHub 儲存機制安裝 VM 代理程式。</span><span class="sxs-lookup"><span data-stu-id="193d5-134">For a Linux VM, install the VM Agent from the GitHub repository located at <https://github.com/Azure/WALinuxAgent>.</span></span> <span data-ttu-id="193d5-135">如需如何在 Linux 上安裝 VM 代理程式的詳細資訊，請參閱[Azure Linux VM 代理程式使用者指南](../articles/virtual-machines/linux/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)。</span><span class="sxs-lookup"><span data-stu-id="193d5-135">For more information on how to install the VM Agent on Linux, see the [Azure Linux VM Agent User Guide](../articles/virtual-machines/linux/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>

> [!NOTE]
> <span data-ttu-id="193d5-136">在 PaaS 中，VM 代理程式稱為 **WindowsAzureGuestAgent**，且在 Web 和背景工作角色 VM 中皆可使用。</span><span class="sxs-lookup"><span data-stu-id="193d5-136">In PaaS, the VM Agent is called **WindowsAzureGuestAgent**, and is always available on Web and Worker Role VMs.</span></span> <span data-ttu-id="193d5-137">(如需詳細資訊，請參閱 [Azure 角色架構](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx))。角色 VM 的 VM 代理程式現已可將延伸模組加入雲端服務 VM，其方法與永續性虛擬機器相同。</span><span class="sxs-lookup"><span data-stu-id="193d5-137">(For more information, see [Azure Role Architecture](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx).) The VM Agent for Role VMs can now add extensions to the cloud service VMs in the same way that it does for persistent Virtual Machines.</span></span> <span data-ttu-id="193d5-138">角色 VM 和永續性 VM 上 VM 擴充功能之間最大的差異是新增 VM 擴充功能的時機。</span><span class="sxs-lookup"><span data-stu-id="193d5-138">The biggest difference between VM Extensions on role VMs and persistent VMs is when the VM extensions are added.</span></span> <span data-ttu-id="193d5-139">使用角色 VM 時，擴充功能會先新增至雲端服務，然後新增至該雲端服務內的部署。</span><span class="sxs-lookup"><span data-stu-id="193d5-139">With role VMs, extensions are added first to the cloud service, then to the deployments within that cloud service.</span></span>
>
> <span data-ttu-id="193d5-140">使用 [Get AzureServiceAvailableExtension](https://msdn.microsoft.com/library/azure/dn722498.aspx) Cmdlet，來列出所有可用的角色 VM 延伸模組。</span><span class="sxs-lookup"><span data-stu-id="193d5-140">Use the [Get-AzureServiceAvailableExtension](https://msdn.microsoft.com/library/azure/dn722498.aspx) cmdlet to list all available role VM extensions.</span></span>
>
>

## <a name="find-add-update-and-remove-vm-extensions"></a><span data-ttu-id="193d5-141">尋找、加入、更新和移除 VM 擴充功能</span><span class="sxs-lookup"><span data-stu-id="193d5-141">Find, Add, Update, and Remove VM Extensions</span></span>
<span data-ttu-id="193d5-142">如需這些工作的詳細資訊，請參閱[加入、尋找、更新及移除 Azure VM 延伸模組](../articles/virtual-machines/windows/classic/manage-extensions.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json)。</span><span class="sxs-lookup"><span data-stu-id="193d5-142">For details on these tasks, see [Add, Find, Update, and Remove Azure VM Extensions](../articles/virtual-machines/windows/classic/manage-extensions.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span></span>
