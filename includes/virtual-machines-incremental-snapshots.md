# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="4dd3b-101">以遞增快照集備份 Azure 非受控 VM 磁碟</span><span class="sxs-lookup"><span data-stu-id="4dd3b-101">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="4dd3b-102">概觀</span><span class="sxs-lookup"><span data-stu-id="4dd3b-102">Overview</span></span>
<span data-ttu-id="4dd3b-103">Azure 儲存體提供 hello 功能 tootake 快照集的 blob。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-103">Azure Storage provides hello capability tootake snapshots of blobs.</span></span> <span data-ttu-id="4dd3b-104">快照集時間中該時間點擷取 hello blob 狀態。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-104">Snapshots capture hello blob state at that point in time.</span></span> <span data-ttu-id="4dd3b-105">在本文中，我們會說明使用快照集維護虛擬機器磁碟備份的案例。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-105">In this article, we describe a scenario in which you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="4dd3b-106">您可以使用這種方法，當您選擇不 toouse Azure 備份和復原服務，以及想 toocreate 自訂備份策略的虛擬機器磁碟。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-106">You can use this methodology when you choose not toouse Azure Backup and Recovery Service, and wish toocreate a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="4dd3b-107">Azure 虛擬機器磁碟在 Azure 儲存體中會儲存為分頁 Blob。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-107">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="4dd3b-108">因為我們描述這篇文章中的虛擬機器磁碟的備份策略時，我們 toosnapshots hello 的分頁 blob 的內容中。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-108">Since we are describing a backup strategy for virtual machine disks in this article, we refer toosnapshots in hello context of page blobs.</span></span> <span data-ttu-id="4dd3b-109">toolearn 進一步了解快照集，請參閱太[建立 Blob 的快照集](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob)。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-109">toolearn more about snapshots, refer too[Creating a Snapshot of a Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="4dd3b-110">什麼是快照？</span><span class="sxs-lookup"><span data-stu-id="4dd3b-110">What is a snapshot?</span></span>
<span data-ttu-id="4dd3b-111">Blob 快照是在某個時間點擷取的 Blob 唯讀版本。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-111">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="4dd3b-112">一旦建立快照集後，即可加以讀取、複製或刪除，但不能修改。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-112">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="4dd3b-113">快照集提供 blob 向上方式 tooback 出現在時間點。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-113">Snapshots provide a way tooback up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="4dd3b-114">其他版本 2015年-04-05，直到您有 hello 能力 toocopy 完整快照集。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-114">Until REST version 2015-04-05, you had hello ability toocopy full snapshots.</span></span> <span data-ttu-id="4dd3b-115">Hello REST 2015-07-08 版或更新版本，您也可以複製增量快照。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-115">With hello REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="4dd3b-116">完整快照複製</span><span class="sxs-lookup"><span data-stu-id="4dd3b-116">Full snapshot copy</span></span>
<span data-ttu-id="4dd3b-117">可以是快照集以 hello 基底 blob 的 blob tookeep 備份複製 tooanother 儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-117">Snapshots can be copied tooanother storage account as a blob tookeep backups of hello base blob.</span></span> <span data-ttu-id="4dd3b-118">您也可以透過其基底 blob，就像還原 hello blob tooan 複製快照集較舊版本。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-118">You can also copy a snapshot over its base blob, which is like restoring hello blob tooan earlier version.</span></span> <span data-ttu-id="4dd3b-119">從一個儲存體帳戶 tooanother 複製快照集時，會佔用的 hello 相同空間為 hello 基底的分頁 blob。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-119">When a snapshot is copied from one storage account tooanother, it occupies hello same space as hello base page blob.</span></span> <span data-ttu-id="4dd3b-120">因此，從一個儲存體帳戶 tooanother 複製整個快照集太慢，而且會耗用太多空間 hello 目標儲存體帳戶中。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-120">Therefore, copying whole snapshots from one storage account tooanother is slow and consumes much space in hello target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="4dd3b-121">如果您複製 hello 基底 blob tooanother 目的地，以及它將不會複製 hello hello blob 的快照集。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-121">If you copy hello base blob tooanother destination, hello snapshots of hello blob are not copied along with it.</span></span> <span data-ttu-id="4dd3b-122">同樣地，如果您要覆寫基底 blob 的複本，與 hello 基底 blob 相關聯的快照集不會受到影響，並保持 hello 基底 blob 名稱下保持不變。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-122">Similarly, if you overwrite a base blob with a copy, snapshots associated with hello base blob are not affected and stay intact under hello base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="4dd3b-123">使用快照集備份磁碟</span><span class="sxs-lookup"><span data-stu-id="4dd3b-123">Back up disks using snapshots</span></span>
<span data-ttu-id="4dd3b-124">做為虛擬機器磁碟備份策略，您可以建立定期的 hello 磁碟或分頁 blob 的快照集，並將其複製 tooanother 儲存體帳戶使用的 puttygen 等工具[複製 Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob)作業或[AzCopy](../articles/storage/common/storage-use-azcopy.md)。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-124">As a backup strategy for your virtual machine disks, you can take periodic snapshots of hello disk or page blob, and copy them tooanother storage account using tools like [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) operation or [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span></span> <span data-ttu-id="4dd3b-125">您可以複製的快照集 tooa 目的地分頁 blob 以不同的名稱。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-125">You can copy a snapshot tooa destination page blob with a different name.</span></span> <span data-ttu-id="4dd3b-126">可寫入分頁 blob 而不是快照集 hello 結果的目的地分頁 blob。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-126">hello resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="4dd3b-127">在本文中，稍後我們將描述步驟 tootake 備份的虛擬機器磁碟使用快照集。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-127">Later in this article, we describe steps tootake backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="4dd3b-128">使用快照還原磁碟</span><span class="sxs-lookup"><span data-stu-id="4dd3b-128">Restore disks using snapshots</span></span>
<span data-ttu-id="4dd3b-129">時間 toorestore 磁碟 tooa 穩定中 hello 備份快照集的其中一個先前擷取的版本時，您可以透過 hello 基底的分頁 blob 複製快照集。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-129">When it is time toorestore your disk tooa stable version that was previously captured in one of hello backup snapshots, you can copy a snapshot over hello base page blob.</span></span> <span data-ttu-id="4dd3b-130">Hello 快照集升級的 toohello 基底的分頁 blob 之後，hello 快照集會保留，但會覆寫其來源的副本，可以同時讀取和寫入。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-130">After hello snapshot is promoted toohello base page blob, hello snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="4dd3b-131">本文中稍後我們將描述步驟 toorestore 舊版您從其快照集的磁碟。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-131">Later in this article we describe steps toorestore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="4dd3b-132">實作完整快照複製</span><span class="sxs-lookup"><span data-stu-id="4dd3b-132">Implementing full snapshot copy</span></span>
<span data-ttu-id="4dd3b-133">您可以藉由 hello 下列實作完整的快照集複製</span><span class="sxs-lookup"><span data-stu-id="4dd3b-133">You can implement a full snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="4dd3b-134">首先，建立使用 hello hello 基底 blob 的快照[快照集 Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob)作業。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-134">First, take a snapshot of hello base blob using hello [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) operation.</span></span>
* <span data-ttu-id="4dd3b-135">然後，複製 hello 快照 tooa 目標儲存體帳戶使用[複製 Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob)。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-135">Then, copy hello snapshot tooa target storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span>
* <span data-ttu-id="4dd3b-136">重複此程序 toomaintain 備份您的基底 blob。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-136">Repeat this process toomaintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="4dd3b-137">增量快照複製</span><span class="sxs-lookup"><span data-stu-id="4dd3b-137">Incremental snapshot copy</span></span>
<span data-ttu-id="4dd3b-138">hello hello 中的新功能[GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API 提供更更好的方式 tooback 向上 hello 分頁 blob 或磁碟的快照集。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-138">hello new feature in hello [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API provides a much better way tooback up hello snapshots of your page blobs or disks.</span></span> <span data-ttu-id="4dd3b-139">hello API 傳回 hello 清單變更 hello 基底 blob 之間 hello 快照集，可減少 hello 用於 hello 備份帳戶的儲存空間的數量。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-139">hello API returns hello list of changes between hello base blob and hello snapshots, which reduces hello amount of storage space used on hello backup account.</span></span> <span data-ttu-id="4dd3b-140">hello 應用程式開發介面支援進階儲存體，以及標準儲存體上的分頁 blob。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-140">hello API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="4dd3b-141">您現在可以使用此 API，為 Azure VM 建置更快速且更有效率的備份解決方案。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-141">Using this API, you can build faster and more efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="4dd3b-142">這個 API 會使用 hello REST 2015-07-08 版及更高版本。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-142">This API will be available with hello REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="4dd3b-143">累加快照集複製可讓您從儲存體帳戶 tooanother hello 之間的差異在於 toocopy</span><span class="sxs-lookup"><span data-stu-id="4dd3b-143">Incremental Snapshot Copy allows you toocopy from one storage account tooanother hello difference between,</span></span>

* <span data-ttu-id="4dd3b-144">基底 Blob 及其快照，或</span><span class="sxs-lookup"><span data-stu-id="4dd3b-144">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="4dd3b-145">Hello 基底 blob 的任何兩個快照集</span><span class="sxs-lookup"><span data-stu-id="4dd3b-145">Any two snapshots of hello base blob</span></span>

<span data-ttu-id="4dd3b-146">提供符合下列條件的 hello，</span><span class="sxs-lookup"><span data-stu-id="4dd3b-146">Provided hello following conditions are met,</span></span>

* <span data-ttu-id="4dd3b-147">Jan 1 2016年或更新版本建立 hello blob。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-147">hello blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="4dd3b-148">不 hello blob 會覆寫與[PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page)或[複製 Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob)兩個快照之間。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-148">hello blob was not overwritten with [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) or [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) between two snapshots.</span></span>

<span data-ttu-id="4dd3b-149">**注意**︰此功能適用於進階和標準 Azure 分頁 Blob。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-149">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="4dd3b-150">當您使用快照集的自訂備份策略時，複製 hello 快照集從一個儲存體帳戶 tooanother 可以會降低，而且可以使用儲存空間。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-150">When you have a custom backup strategy using snapshots, copying hello snapshots from one storage account tooanother can be slow and can consume much storage space.</span></span> <span data-ttu-id="4dd3b-151">而不需要複製 hello 整個快照集 tooa 備份儲存體帳戶，您可以撰寫 hello 連續快照集 tooa 備份的分頁 blob 的差異。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-151">Instead of copying hello entire snapshot tooa backup storage account, you can write hello difference between consecutive snapshots tooa backup page blob.</span></span> <span data-ttu-id="4dd3b-152">如此一來，大幅減少 hello 時間 toocopy 和 hello 空間 toostore 備份。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-152">This way, hello time toocopy and hello space toostore backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="4dd3b-153">實作增量快照複製</span><span class="sxs-lookup"><span data-stu-id="4dd3b-153">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="4dd3b-154">您可以藉由 hello 下列實作累加快照集複製</span><span class="sxs-lookup"><span data-stu-id="4dd3b-154">You can implement incremental snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="4dd3b-155">擷取快照的 hello 基底 blob 使用[快照集 Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob)。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-155">Take a snapshot of hello base blob using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span></span>
* <span data-ttu-id="4dd3b-156">複製 hello 快照 toohello 目標備份儲存體帳戶使用[複製 Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob)。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-156">Copy hello snapshot toohello target backup storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span> <span data-ttu-id="4dd3b-157">這是 hello 備份的分頁 blob。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-157">This is hello backup page blob.</span></span> <span data-ttu-id="4dd3b-158">建立 hello 備份的分頁 blob 的快照，然後將它儲存在 hello 備份的帳戶。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-158">Take a snapshot of hello backup page blob and store it in hello backup account.</span></span>
* <span data-ttu-id="4dd3b-159">取得另一個使用快照集 Blob hello 基底 blob 的快照集。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-159">Take another snapshot of hello base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="4dd3b-160">取得 hello hello hello 基底 blob 使用的第一個和第二個快照之間的差異[GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges)。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-160">Get hello difference between hello first and second snapshots of hello base blob using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span></span> <span data-ttu-id="4dd3b-161">使用新參數的 hello **prevsnapshot**，toospecify hello hello 想與 tooget hello 差異的快照集的日期時間值。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-161">Use hello new parameter **prevsnapshot**, toospecify hello DateTime value of hello snapshot you want tooget hello difference with.</span></span> <span data-ttu-id="4dd3b-162">這個參數時，hello REST 回應只包含 hello 頁面目標快照與上一個快照，包括清除頁面之間變更。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-162">When this parameter is present, hello REST response includes only hello pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="4dd3b-163">使用[PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) tooapply 這些變更 toohello 備份的分頁 blob。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-163">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) tooapply these changes toohello backup page blob.</span></span>
* <span data-ttu-id="4dd3b-164">最後，建立 hello 備份的分頁 blob 的快照，然後將它儲存在 hello 備份儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-164">Finally, take a snapshot of hello backup page blob and store it in hello backup storage account.</span></span>

<span data-ttu-id="4dd3b-165">Hello 下一節，我們將更詳細描述可以維護備份的磁碟使用累加快照集複製的方式</span><span class="sxs-lookup"><span data-stu-id="4dd3b-165">In hello next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="4dd3b-166">案例</span><span class="sxs-lookup"><span data-stu-id="4dd3b-166">Scenario</span></span>
<span data-ttu-id="4dd3b-167">在本節中，我們會使用快照說明涉及虛擬機器磁碟的自訂備份策略的案例。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-167">In this section, we describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="4dd3b-168">請考慮使用連接進階儲存體 P30 磁碟的 DS 系列 Azure VM。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-168">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="4dd3b-169">名為 hello P30 磁碟*mypremiumdisk*儲存在名為 premium 儲存體帳戶*mypremiumaccount*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-169">hello P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="4dd3b-170">標準儲存體帳戶呼叫*mybackupstdaccount*用來儲存備份 hello *mypremiumdisk*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-170">A standard storage account called *mybackupstdaccount* is used for storing hello backup of *mypremiumdisk*.</span></span> <span data-ttu-id="4dd3b-171">我們希望 tookeep 快照集的*mypremiumdisk*每隔 12 小時。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-171">We would like tookeep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="4dd3b-172">toolearn 有關建立儲存體帳戶和磁碟，請參閱太[關於 Azure 儲存體帳戶](../articles/storage/storage-create-storage-account.md)。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-172">toolearn about creating storage account and disks, refer too[About Azure storage accounts](../articles/storage/storage-create-storage-account.md).</span></span>

<span data-ttu-id="4dd3b-173">關於備份 Azure Vm toolearn 參照太[計劃 Azure VM 備份](../articles/backup/backup-azure-vms-introduction.md)。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-173">toolearn about backing up Azure VMs, refer too[Plan Azure VM backups](../articles/backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-toomaintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="4dd3b-174">步驟 toomaintain 備份的磁碟，使用累加快照集</span><span class="sxs-lookup"><span data-stu-id="4dd3b-174">Steps toomaintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="4dd3b-175">hello 下列步驟說明如何 tootake 快照*mypremiumdisk*和維護中的 hello 備份*mybackupstdaccount*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-175">hello following steps describe how tootake snapshots of *mypremiumdisk* and maintain hello backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="4dd3b-176">hello 備份是標準分頁 blob 呼叫*mybackupstdpageblob*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-176">hello backup is a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="4dd3b-177">hello 備份的分頁 blob 一律會反映為 hello 最後一次快照的相同狀態的 hello *mypremiumdisk*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-177">hello backup page blob always reflects hello same state as hello last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="4dd3b-178">擷取的快照集，藉此建立 hello 備份的分頁 blob，為您的 premium 儲存體磁碟*mypremiumdisk*呼叫*mypremiumdisk_ss1*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-178">Create hello backup page blob for your premium storage disk, by taking a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="4dd3b-179">將此快照集 toomybackupstdaccount 複製為分頁 blob 呼叫*mybackupstdpageblob*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-179">Copy this snapshot toomybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="4dd3b-180">使用[快照集 Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) 建立稱為 *mybackupstdpageblob_ss1* 的 *mybackupstdpageblob* 快照集，並將其儲存在 *mybackupstdaccount* 中。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-180">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="4dd3b-181">Hello 備份時間範圍期間建立的另一個快照*mypremiumdisk*、 說*mypremiumdisk_ss2*，並將它存放在*mypremiumaccount*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-181">During hello backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="4dd3b-182">取得 hello hello 兩個快照之間的累加變更*mypremiumdisk_ss2*和*mypremiumdisk_ss1*，並使用[GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges)上*mypremiumdisk_ss2*以 hello **prevsnapshot**參數設定 toohello 時間戳記*mypremiumdisk_ss1*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-182">Get hello incremental changes between hello two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) on *mypremiumdisk_ss2* with hello **prevsnapshot** parameter set toohello timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="4dd3b-183">撰寫這些累加變更 toohello 備份的分頁 blob *mybackupstdpageblob*中*mybackupstdaccount*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-183">Write these incremental changes toohello backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="4dd3b-184">如果 hello 累加變更有已刪除的範圍，他們必須從 hello 備份的分頁 blob 中清除。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-184">If there are deleted ranges in hello incremental changes, they must be cleared from hello backup page blob.</span></span> <span data-ttu-id="4dd3b-185">使用[PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) toowrite 累加變更 toohello 備份的分頁 blob。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-185">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) toowrite incremental changes toohello backup page blob.</span></span>
6. <span data-ttu-id="4dd3b-186">Hello 備份的分頁 blob 的快照*mybackupstdpageblob*，稱為*mybackupstdpageblob_ss2*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-186">Take a snapshot of hello backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="4dd3b-187">刪除上一個快照的 hello *mypremiumdisk_ss1*進階儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-187">Delete hello previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="4dd3b-188">在每個備份時間範圍期間重複步驟 4-6。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-188">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="4dd3b-189">如此一來，您可以維護標準儲存體帳戶中的 *mypremiumdisk* 備份。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-189">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![使用增量快照集備份磁碟](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-toorestore-a-disk-from-snapshots"></a><span data-ttu-id="4dd3b-191">步驟 toorestore 從快照集的磁碟</span><span class="sxs-lookup"><span data-stu-id="4dd3b-191">Steps toorestore a disk from snapshots</span></span>
<span data-ttu-id="4dd3b-192">hello 下列步驟中，描述如何 toorestore hello premium 磁碟*mypremiumdisk*稍早的快照集從 hello 備份儲存體帳戶的 tooan *mybackupstdaccount*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-192">hello following steps, describe how toorestore hello premium disk, *mypremiumdisk* tooan earlier snapshot from hello backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="4dd3b-193">識別 hello 時間點您想要 toorestore hello 高階磁碟。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-193">Identify hello point in time that you wish toorestore hello premium disk to.</span></span> <span data-ttu-id="4dd3b-194">假設為 snapshot *mybackupstdpageblob_ss2*，儲存在 hello 備份儲存體帳戶*mybackupstdaccount*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-194">Let's say that it is snapshot *mybackupstdpageblob_ss2*, which is stored in hello backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="4dd3b-195">Mybackupstdaccount，在將升級 hello 快照*mybackupstdpageblob_ss2* hello 新備份的基底分頁 blob 當做*mybackupstdpageblobrestored*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-195">In mybackupstdaccount, promote hello snapshot *mybackupstdpageblob_ss2* as hello new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="4dd3b-196">建立稱為 *mybackupstdpageblobrestored_ss1* 的這個已還原備份分頁 Blob 的快照集。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-196">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="4dd3b-197">複製 hello 還原分頁 blob *mybackupstdpageblobrestored*從*mybackupstdaccount*太*mypremiumaccount*為 hello 新 premium 磁碟*mypremiumdiskrestored*。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-197">Copy hello restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* too*mypremiumaccount* as hello new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="4dd3b-198">建立稱為 *mypremiumdiskrestored_ss1* 的 *mypremiumdiskrestored* 快照集，以進行未來的增量備份。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-198">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="4dd3b-199">點 hello DS 系列 VM toohello 還原磁碟*mypremiumdiskrestored*和卸離舊 hello *mypremiumdisk*從 hello VM。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-199">Point hello DS series VM toohello restored disk *mypremiumdiskrestored* and detach hello old *mypremiumdisk* from hello VM.</span></span>
7. <span data-ttu-id="4dd3b-200">開始 hello hello 還原磁碟上一節中所述的備份程序*mypremiumdiskrestored*，使用 hello *mybackupstdpageblobrestored*為 hello 備份的分頁 blob。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-200">Begin hello Backup process described in previous section for hello restored disk *mypremiumdiskrestored*, using hello *mybackupstdpageblobrestored* as hello backup page blob.</span></span>

![從快照還原磁碟](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="4dd3b-202">後續步驟</span><span class="sxs-lookup"><span data-stu-id="4dd3b-202">Next Steps</span></span>
<span data-ttu-id="4dd3b-203">使用 hello 下列連結 toolearn 深入了解建立 blob 的快照集，並規劃您 VM 備份的基礎結構。</span><span class="sxs-lookup"><span data-stu-id="4dd3b-203">Use hello following links toolearn more about creating snapshots of a blob and planning your VM backup infrastructure.</span></span>

* [<span data-ttu-id="4dd3b-204">建立 Blob 的快照集</span><span class="sxs-lookup"><span data-stu-id="4dd3b-204">Creating a Snapshot of a Blob</span></span>](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob)
* [<span data-ttu-id="4dd3b-205">規劃 VM 備份基礎結構</span><span class="sxs-lookup"><span data-stu-id="4dd3b-205">Plan your VM Backup Infrastructure</span></span>](../articles/backup/backup-azure-vms-introduction.md)

