<span data-ttu-id="bd73b-101">為提升虛擬機器之主機基礎結構的可靠性、效能和安全性，Azure 會定期執行更新。</span><span class="sxs-lookup"><span data-stu-id="bd73b-101">Azure periodically performs updates to improve the reliability, performance, and security of the host infrastructure for virtual machines.</span></span> <span data-ttu-id="bd73b-102">這些更新的範圍，從在主控環境 (像是作業系統、Hypervisor 和各種在主機上部署的代理程式) 中修補軟體元件、升級網路元件，以至硬體解除委任。</span><span class="sxs-lookup"><span data-stu-id="bd73b-102">These updates range from patching software components in the hosting environment (like operating system, hypervisor, and various agents deployed on the host), upgrading networking components, to hardware decommissioning.</span></span> <span data-ttu-id="bd73b-103">這些更新大多數都會在不影響託管虛擬機器的情況下執行。</span><span class="sxs-lookup"><span data-stu-id="bd73b-103">The majority of these updates are performed without any impact to the hosted virtual machines.</span></span> <span data-ttu-id="bd73b-104">不過，更新在某些情況下確實會造成影響：</span><span class="sxs-lookup"><span data-stu-id="bd73b-104">However, there are cases where updates do have an impact:</span></span>

- <span data-ttu-id="bd73b-105">如果維護不需要重新開機，Azure 會在主機更新時使用就地移轉來暫停 VM。</span><span class="sxs-lookup"><span data-stu-id="bd73b-105">If the maintenance does not require a reboot, Azure uses in-place migration to pause the VM while the host is updated.</span></span>

- <span data-ttu-id="bd73b-106">如果維護需要重新開機，您會在規劃維護時收到通知。</span><span class="sxs-lookup"><span data-stu-id="bd73b-106">If maintenance requires a reboot, you get a notice of when the maintenance is planned.</span></span> <span data-ttu-id="bd73b-107">在這些情況下，您也將獲得一個時間範圍，您可以在適合您的時間自行開始維護。</span><span class="sxs-lookup"><span data-stu-id="bd73b-107">In these cases, you'll also be given a time window where you can start the maintenance yourself, at a time that works for you.</span></span>

<span data-ttu-id="bd73b-108">本頁面說明 Microsoft Azure 如何執行這兩種類型的維護。</span><span class="sxs-lookup"><span data-stu-id="bd73b-108">This page describes how Microsoft Azure performs both types of maintenance.</span></span> <span data-ttu-id="bd73b-109">如需非計劃性事件 (中斷) 的詳細資訊，請參閱〈管理 [Windows] (../articles/virtual-machines/windows/manage-availability.md) 或 [Linux](../articles/virtual-machines/linux/manage-availability.md) 虛擬機器的可用性〉。</span><span class="sxs-lookup"><span data-stu-id="bd73b-109">For more information about unplanned events (outages), see Manage the availability of virtual machines for [Windows] (../articles/virtual-machines/windows/manage-availability.md) or [Linux](../articles/virtual-machines/linux/manage-availability.md).</span></span>

<span data-ttu-id="bd73b-110">在虛擬機器中執行的應用程式可以使用適用於 [Windows](../articles/virtual-machines/windows/instance-metadata-service.md)或 [Linux] (../articles/virtual-machines/linux/instance-metadata-service.md) 的Azure 中繼資料服務，蒐集近期更新的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="bd73b-110">Applications running in a virtual machine can gather information about upcoming updates by using the Azure Metadata Service for [Windows](../articles/virtual-machines/windows/instance-metadata-service.md) or [Linux] (../articles/virtual-machines/linux/instance-metadata-service.md).</span></span>

## <a name="in-place-vm-migration"></a><span data-ttu-id="bd73b-111">就地 VM 移轉</span><span class="sxs-lookup"><span data-stu-id="bd73b-111">In-place VM migration</span></span>

<span data-ttu-id="bd73b-112">當更新不需要完整重新開機時，則會使用就地即時移轉。</span><span class="sxs-lookup"><span data-stu-id="bd73b-112">When updates don't require a full reboot, an in-place live migration is used.</span></span> <span data-ttu-id="bd73b-113">在更新期間，虛擬機器會暫停 30 秒並將記憶體保留在 RAM 中，而主控環境會套用必要的更新和修補程式。</span><span class="sxs-lookup"><span data-stu-id="bd73b-113">During the update the virtual machine is paused for about 30 seconds, preserving the memory in RAM, while the hosting environment applies the necessary updates and patches.</span></span> <span data-ttu-id="bd73b-114">虛擬機器會接著繼續執行，而系統會自動同步虛擬機器的時鐘。</span><span class="sxs-lookup"><span data-stu-id="bd73b-114">The virtual machine is then resumed and the clock of the virtual machine is automatically synchronized.</span></span>

<span data-ttu-id="bd73b-115">對於可用性設定組中的 VM，更新網域會一次更新一個。</span><span class="sxs-lookup"><span data-stu-id="bd73b-115">For VMs in availability sets, update domains are updated one at a time.</span></span> <span data-ttu-id="bd73b-116">在計劃性維護移至下一個 UD 之前，一個更新網域 (UD) 中的所有 VM 會暫停、更新，而後繼續進行。</span><span class="sxs-lookup"><span data-stu-id="bd73b-116">All VMs in one update domain (UD) are paused, updated and then resumed before planned maintenance moves on to the next UD.</span></span>

<span data-ttu-id="bd73b-117">這些類型的更新會對某些應用程式造成影響。</span><span class="sxs-lookup"><span data-stu-id="bd73b-117">Some applications may be impacted by these types of updates.</span></span> <span data-ttu-id="bd73b-118">執行即時事件處理 (如媒體串流處理或轉碼，或高輸送量網路服務案例) 的應用程式，其設計可能不會容許暫停 30 秒。</span><span class="sxs-lookup"><span data-stu-id="bd73b-118">Applications that perform real-time event processing, like media streaming or transcoding, or high throughput networking scenarios, may not be designed to tolerate a 30 second pause.</span></span> <!-- sooooo, what should they do? --> 


## <a name="maintenance-requiring-a-reboot"></a><span data-ttu-id="bd73b-119">維護需要重新開機</span><span class="sxs-lookup"><span data-stu-id="bd73b-119">Maintenance requiring a reboot</span></span>

<span data-ttu-id="bd73b-120">如果 VM 需要針對計劃性維護重新啟動，您會事先收到通知。</span><span class="sxs-lookup"><span data-stu-id="bd73b-120">When VMs need to be rebooted for planned maintenance, you are notified in advance.</span></span> <span data-ttu-id="bd73b-121">計劃性維護有兩個階段：自助式期間和排程維護期間。</span><span class="sxs-lookup"><span data-stu-id="bd73b-121">Planned maintenance has two phases: the self-service window and a scheduled maintenance window.</span></span>

<span data-ttu-id="bd73b-122">**自助式期間**可讓您在您的 VM 上起始維護。</span><span class="sxs-lookup"><span data-stu-id="bd73b-122">The **self-service window** lets you initiate the maintenance on your VMs.</span></span> <span data-ttu-id="bd73b-123">在此期間，您可以查詢每個 VM 來查看其狀態，並檢查上次維護要求的結果。</span><span class="sxs-lookup"><span data-stu-id="bd73b-123">During this time, you can query each VM to see their status and check the result of your last maintenance request.</span></span>

<span data-ttu-id="bd73b-124">當您開始自助式維護時，VM 會移至已更新的節點，然後重新開機。</span><span class="sxs-lookup"><span data-stu-id="bd73b-124">When you start self-service maintenance, your VM is moved to a node that has already been updated and then powers it back on.</span></span> <span data-ttu-id="bd73b-125">因為 VM 會重新開機，所以暫存磁碟會遺失，而系統會更新與虛擬網路介面關聯的動態 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="bd73b-125">Because the VM reboots, the temporary disk is lost and dynamic IP addresses associated with virtual network interface are updated.</span></span>

<span data-ttu-id="bd73b-126">如果您開始自助式維護且在此過程忠發生錯誤，此作業就會停止，系統不會更新 VM，而且會將它從計劃性維護反覆運算中移除。</span><span class="sxs-lookup"><span data-stu-id="bd73b-126">If you start self-service maintenance and there is an error during the process, the operation is stopped, the VM is not updated and it is also removed from the planned maintenance iteration.</span></span> <span data-ttu-id="bd73b-127">稍後有新的排程時會連絡您，讓您有新的機會進行自助式維護。</span><span class="sxs-lookup"><span data-stu-id="bd73b-127">You will be contacted in a later time with a new schedule and offered a new opportunity to do self-service maintenance.</span></span> 

<span data-ttu-id="bd73b-128">當自助式期間過後，**排程的維護期間**隨即開始。</span><span class="sxs-lookup"><span data-stu-id="bd73b-128">When the self-service window has passed, the **scheduled maintenance window** begins.</span></span> <span data-ttu-id="bd73b-129">在這段期間內，您仍然可以查詢維護期間，但是無法再自行開始維護。</span><span class="sxs-lookup"><span data-stu-id="bd73b-129">During this time window, you can still query for the maintenance window, but no longer be able to start the maintenance yourself.</span></span>

## <a name="availability-considerations-during-planned-maintenance"></a><span data-ttu-id="bd73b-130">規劃維護期間的可用性考量</span><span class="sxs-lookup"><span data-stu-id="bd73b-130">Availability Considerations during Planned Maintenance</span></span> 

<span data-ttu-id="bd73b-131">如果您決定等到計劃性維護期間，維護 VM 的最高可用性時需考慮下列事項。</span><span class="sxs-lookup"><span data-stu-id="bd73b-131">If you decide to wait until the planned maintenance window, there are a few things to consider for maintaining the highest availabilty of your VMs.</span></span> 

### <a name="paired-regions"></a><span data-ttu-id="bd73b-132">配對的區域</span><span class="sxs-lookup"><span data-stu-id="bd73b-132">Paired Regions</span></span>

<span data-ttu-id="bd73b-133">每個 Azure 區域都會與相同地理位置內的另一個區域配對，以共同形成區域配對。</span><span class="sxs-lookup"><span data-stu-id="bd73b-133">Each Azure region is paired with another region within the same geography, together they make a regional pair.</span></span> <span data-ttu-id="bd73b-134">在計劃性維護期間，Azure 只會更新區域配對中單一區域的 VM。</span><span class="sxs-lookup"><span data-stu-id="bd73b-134">During planned maintenance, Azure will only update the VMs in a single region of a region pair.</span></span> <span data-ttu-id="bd73b-135">舉例來說，Azure 在更新美國中北部的虛擬機器時，就不會同時更新任何在美國中南部的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="bd73b-135">For example, when updating the Virtual Machines in North Central US, Azure will not update any Virtual Machines in South Central US at the same time.</span></span> <span data-ttu-id="bd73b-136">不過，像是北歐等其他區域可以和美國東部一同進行維護。</span><span class="sxs-lookup"><span data-stu-id="bd73b-136">However, other regions such as North Europe can be under maintenance at the same time as East US.</span></span> <span data-ttu-id="bd73b-137">了解區域配對的運作方式可協助您將 VM 更妥善地分散於各區域。</span><span class="sxs-lookup"><span data-stu-id="bd73b-137">Understanding how region pairs work can help you better distribute your VMs across regions.</span></span> <span data-ttu-id="bd73b-138">如需詳細資訊，請參閱 [Azure 區域配對](https://docs.microsoft.com/azure/best-practices-availability-paired-regions)。</span><span class="sxs-lookup"><span data-stu-id="bd73b-138">For more information, see [Azure region pairs](https://docs.microsoft.com/azure/best-practices-availability-paired-regions).</span></span>

### <a name="availability-sets-and-scale-sets"></a><span data-ttu-id="bd73b-139">可用性設定組和擴展集</span><span class="sxs-lookup"><span data-stu-id="bd73b-139">Availability sets and scale sets</span></span>

<span data-ttu-id="bd73b-140">在 Azure VM 上部署工作負載時，您可以在一個可用性設定組內建立 VM，以便為應用程式提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="bd73b-140">When deploying a workload on Azure VMs, you can create the VMs within an availability set to provide high availability to your application.</span></span> <span data-ttu-id="bd73b-141">這可確保在中斷或維護事件期間，至少有一部虛擬機器可供使用。</span><span class="sxs-lookup"><span data-stu-id="bd73b-141">This ensures that during either an outage or maintenance events, at least one virtual machine is available.</span></span>

<span data-ttu-id="bd73b-142">在可用性設定組內，個別 VM 會散佈在多達 20 個更新網域 (UD)。</span><span class="sxs-lookup"><span data-stu-id="bd73b-142">Within an availability set, individual VMs are spread across up to 20 update domains (UDs).</span></span> <span data-ttu-id="bd73b-143">在規劃維護期間，在任何指定時間只有單一更新網域受影響。</span><span class="sxs-lookup"><span data-stu-id="bd73b-143">During planned maintenance, only a single update domain is impacted at any given time.</span></span> <span data-ttu-id="bd73b-144">請注意，受影響的更新網域順序不一定會循序發生。</span><span class="sxs-lookup"><span data-stu-id="bd73b-144">Be aware that the order of update domains being impacted does not necessarily happen sequentially.</span></span> 

<span data-ttu-id="bd73b-145">虛擬機器擴展集是一個可讓您以單一資源的形式，部署和管理一組相同 VM 的 Azure 計算資源。</span><span class="sxs-lookup"><span data-stu-id="bd73b-145">Virtual machine scale sets are an Azure compute resource that enables you to deploy and manage a set of identical VMs as a single resource.</span></span> <span data-ttu-id="bd73b-146">擴展集會自動部署於更新網域，如可用性設定組中的 VM。</span><span class="sxs-lookup"><span data-stu-id="bd73b-146">The scale set is automatically deployed across update domains, like VMs in an availability set.</span></span> <span data-ttu-id="bd73b-147">就如同可用性設定組，使用擴展集，在任何指定時間只有單一更新網域受影響。</span><span class="sxs-lookup"><span data-stu-id="bd73b-147">Just like with availability sets, with scale sets only a single update domain is impacted at any given time.</span></span>

<span data-ttu-id="bd73b-148">如需設定虛擬機器以提供高可用性的詳細資訊，請參閱〈管理 Windows (../articles/virtual-machines/windows/manage-availability.md) 或 [Linux](../articles/virtual-machines/linux/manage-availability.md) 虛擬機器的可用性〉。</span><span class="sxs-lookup"><span data-stu-id="bd73b-148">For more information about configuring your virtual machines for high availability, see Manage the availability of your virtual machines for Windows (../articles/virtual-machines/windows/manage-availability.md) or [Linux](../articles/virtual-machines/linux/manage-availability.md).</span></span>